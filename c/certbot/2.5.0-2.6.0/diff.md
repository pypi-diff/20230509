# Comparing `tmp/certbot-2.5.0.tar.gz` & `tmp/certbot-2.6.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/certbot-2.5.0.tar", last modified: Tue Apr  4 15:06:42 2023, max compression
+gzip compressed data, was "certbot-2.6.0.tar", last modified: Tue May  9 19:44:37 2023, max compression
```

## Comparing `certbot-2.5.0.tar` & `certbot-2.6.0.tar`

### file list

```diff
@@ -1,253 +1,253 @@
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/
--rw-r--r--   0 bmw        (501) staff       (20)   113513 2023-04-04 15:06:41.000000 certbot-2.5.0/CHANGELOG.md
--rw-r--r--   0 bmw        (501) staff       (20)    11456 2023-04-04 15:06:41.000000 certbot-2.5.0/LICENSE.txt
--rw-r--r--   0 bmw        (501) staff       (20)      267 2023-04-04 15:06:41.000000 certbot-2.5.0/MANIFEST.in
--rw-r--r--   0 bmw        (501) staff       (20)     7072 2023-04-04 15:06:42.000000 certbot-2.5.0/PKG-INFO
--rw-r--r--   0 bmw        (501) staff       (20)     5835 2023-04-04 15:06:41.000000 certbot-2.5.0/README.rst
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/
--rw-r--r--   0 bmw        (501) staff       (20)      112 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/__init__.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/
--rw-r--r--   0 bmw        (501) staff       (20)      184 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    14642 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/account.py
--rw-r--r--   0 bmw        (501) staff       (20)    21078 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/auth_handler.py
--rw-r--r--   0 bmw        (501) staff       (20)    18610 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cert_manager.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/cli/
--rw-r--r--   0 bmw        (501) staff       (20)    29022 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)     4024 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/cli_constants.py
--rw-r--r--   0 bmw        (501) staff       (20)     9489 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/cli_utils.py
--rw-r--r--   0 bmw        (501) staff       (20)     1073 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/group_adder.py
--rw-r--r--   0 bmw        (501) staff       (20)    21123 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/helpful.py
--rw-r--r--   0 bmw        (501) staff       (20)     2055 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/paths_parser.py
--rw-r--r--   0 bmw        (501) staff       (20)     6210 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/plugins_parsing.py
--rw-r--r--   0 bmw        (501) staff       (20)     4162 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/subparsers.py
--rw-r--r--   0 bmw        (501) staff       (20)     5223 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/cli/verb_help.py
--rw-r--r--   0 bmw        (501) staff       (20)    35664 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/client.py
--rw-r--r--   0 bmw        (501) staff       (20)     6962 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/constants.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/display/
--rw-r--r--   0 bmw        (501) staff       (20)       33 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/display/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)     2645 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/display/completer.py
--rw-r--r--   0 bmw        (501) staff       (20)      811 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/display/dummy_readline.py
--rw-r--r--   0 bmw        (501) staff       (20)    22469 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/display/obj.py
--rw-r--r--   0 bmw        (501) staff       (20)     3456 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/display/util.py
--rw-r--r--   0 bmw        (501) staff       (20)     4484 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/eff.py
--rw-r--r--   0 bmw        (501) staff       (20)     7452 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/error_handler.py
--rw-r--r--   0 bmw        (501) staff       (20)     8928 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/hooks.py
--rw-r--r--   0 bmw        (501) staff       (20)    10226 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/lock.py
--rw-r--r--   0 bmw        (501) staff       (20)    15384 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/log.py
--rw-r--r--   0 bmw        (501) staff       (20)    73237 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/main.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/plugins/
--rw-r--r--   0 bmw        (501) staff       (20)       23 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    10678 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/disco.py
--rw-r--r--   0 bmw        (501) staff       (20)    11966 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/manual.py
--rw-r--r--   0 bmw        (501) staff       (20)     1579 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/null.py
--rw-r--r--   0 bmw        (501) staff       (20)    15748 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/selection.py
--rw-r--r--   0 bmw        (501) staff       (20)     9340 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/standalone.py
--rw-r--r--   0 bmw        (501) staff       (20)    15984 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/plugins/webroot.py
--rw-r--r--   0 bmw        (501) staff       (20)    25775 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/renewal.py
--rw-r--r--   0 bmw        (501) staff       (20)     3706 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/snap_config.py
--rw-r--r--   0 bmw        (501) staff       (20)    53470 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/storage.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/tests/
--rw-r--r--   0 bmw        (501) staff       (20)       20 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    14284 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/account_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    25022 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/auth_handler_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    31128 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/cert_manager_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    20428 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/cli_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    45411 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/client_test.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/tests/compat/
--rw-r--r--   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/compat/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    27416 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/compat/filesystem_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     1747 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/compat/misc_test.py
--rw-r--r--   0 bmw        (501) staff       (20)      604 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/compat/os_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     6922 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/configuration_test.py
--rw-r--r--   0 bmw        (501) staff       (20)      140 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/conftest.py
--rw-r--r--   0 bmw        (501) staff       (20)    18932 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/crypto_util_test.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/tests/display/
--rw-r--r--   0 bmw        (501) staff       (20)       28 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/display/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)     3716 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/display/completer_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     5153 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/display/internal_util_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    13201 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/display/obj_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    20275 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/display/ops_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     2375 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/display/util_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     6676 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/eff_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     5202 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/error_handler_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     1956 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/errors_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     8830 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/helpful_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    16661 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/hook_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     5060 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/lock_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    15949 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/log_test.py
--rw-r--r--   0 bmw        (501) staff       (20)   120835 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/main_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    17503 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/ocsp_test.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/_internal/tests/plugins/
--rw-r--r--   0 bmw        (501) staff       (20)       28 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    14446 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/common_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    10233 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/disco_test.py
--rw-r--r--   0 bmw        (501) staff       (20)      700 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/dns_common_lexicon_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     8522 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/dns_common_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     2340 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/enhancements_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     7425 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/manual_test.py
--rw-r--r--   0 bmw        (501) staff       (20)      674 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/null_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     9718 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/selection_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     6817 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/standalone_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     5541 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/storage_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     1511 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/util_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    15386 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/plugins/webroot_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    14130 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/renewal_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     5509 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/renewupdater_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    17001 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/reverter_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    44293 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/storage_test.py
--rw-r--r--   0 bmw        (501) staff       (20)    23207 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/tests/util_test.py
--rw-r--r--   0 bmw        (501) staff       (20)     4747 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/_internal/updater.py
--rw-r--r--   0 bmw        (501) staff       (20)     1807 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/achallenges.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/compat/
--rw-r--r--   0 bmw        (501) staff       (20)      249 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/compat/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)     1797 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/compat/_path.py
--rw-r--r--   0 bmw        (501) staff       (20)    30478 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/compat/filesystem.py
--rw-r--r--   0 bmw        (501) staff       (20)     5412 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/compat/misc.py
--rw-r--r--   0 bmw        (501) staff       (20)     9511 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/compat/os.py
--rw-r--r--   0 bmw        (501) staff       (20)    11960 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/configuration.py
--rw-r--r--   0 bmw        (501) staff       (20)    24587 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/crypto_util.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/display/
--rw-r--r--   0 bmw        (501) staff       (20)       33 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/display/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    13522 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/display/ops.py
--rw-r--r--   0 bmw        (501) staff       (20)     7268 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/display/util.py
--rw-r--r--   0 bmw        (501) staff       (20)     2786 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/errors.py
--rw-r--r--   0 bmw        (501) staff       (20)    15584 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/interfaces.py
--rw-r--r--   0 bmw        (501) staff       (20)      535 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/main.py
--rw-r--r--   0 bmw        (501) staff       (20)    15036 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/ocsp.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/plugins/
--rw-r--r--   0 bmw        (501) staff       (20)       23 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)    17325 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/common.py
--rw-r--r--   0 bmw        (501) staff       (20)    13986 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/dns_common.py
--rw-r--r--   0 bmw        (501) staff       (20)     5957 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/dns_common_lexicon.py
--rw-r--r--   0 bmw        (501) staff       (20)     2552 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/dns_test_common.py
--rw-r--r--   0 bmw        (501) staff       (20)     7473 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/dns_test_common_lexicon.py
--rw-r--r--   0 bmw        (501) staff       (20)     6809 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/enhancements.py
--rw-r--r--   0 bmw        (501) staff       (20)     4294 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/storage.py
--rw-r--r--   0 bmw        (501) staff       (20)     1811 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/plugins/util.py
--rw-r--r--   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/py.typed
--rw-r--r--   0 bmw        (501) staff       (20)    22069 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/reverter.py
--rw-r--r--   0 bmw        (501) staff       (20)      424 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/ssl-dhparams.pem
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/tests/
--rw-r--r--   0 bmw        (501) staff       (20)       42 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/__init__.py
--rw-r--r--   0 bmw        (501) staff       (20)     2763 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/acme_util.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/tests/testdata/
--rw-r--r--   0 bmw        (501) staff       (20)      642 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/README
--rw-r--r--   0 bmw        (501) staff       (20)      952 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert-5sans_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      623 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert-nosans_nistp256.pem
--rw-r--r--   0 bmw        (501) staff       (20)      786 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert-san_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1200 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_2048.pem
--rw-r--r--   0 bmw        (501) staff       (20)      709 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      887 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_512_bad.pem
--rw-r--r--   0 bmw        (501) staff       (20)     2400 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_fullchain_2048.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1208 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_intermediate_1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1208 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_intermediate_2.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1220 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cert_leaf.pem
--rw-r--r--   0 bmw        (501) staff       (20)       25 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/cli.ini
--rw-r--r--   0 bmw        (501) staff       (20)      502 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-6sans_512.conf
--rw-r--r--   0 bmw        (501) staff       (20)      676 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-6sans_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      420 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-nonames_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      277 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-nosans_512.conf
--rw-r--r--   0 bmw        (501) staff       (20)      493 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-nosans_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      452 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-nosans_nistp256.pem
--rw-r--r--   0 bmw        (501) staff       (20)      574 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr-san_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      281 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr_512.der
--rw-r--r--   0 bmw        (501) staff       (20)      452 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/csr_512.pem
--rw-r--r--   0 bmw        (501) staff       (20)      302 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/ec_prime256v1_key.pem
--rw-r--r--   0 bmw        (501) staff       (20)      359 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/ec_secp384r1_key.pem
--rw-r--r--   0 bmw        (501) staff       (20)      436 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/ec_secp521r1_key.pem
--rw-r--r--   0 bmw        (501) staff       (20)      227 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/nistp256_key.pem
--rw-r--r--   0 bmw        (501) staff       (20)     2273 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/ocsp_certificate.pem
--rw-r--r--   0 bmw        (501) staff       (20)     2247 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/ocsp_issuer_certificate.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1671 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/ocsp_responder_certificate.pem
--rw-r--r--   0 bmw        (501) staff       (20)      190 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/os-release
--rw-r--r--   0 bmw        (501) staff       (20)     1708 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/rsa2048_key.pem
--rw-r--r--   0 bmw        (501) staff       (20)      298 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/rsa256_key.pem
--rw-r--r--   0 bmw        (501) staff       (20)      493 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/rsa512_key.pem
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive/
--rw-r--r--   0 bmw        (501) staff       (20)     1736 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive/cert1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1123 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive/chain1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     2859 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive/fullchain1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1704 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive/privkey1.pem
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/
--rw-r--r--   0 bmw        (501) staff       (20)     1050 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/cert1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1208 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/chain1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     2258 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/fullchain1.pem
--rw-r--r--   0 bmw        (501) staff       (20)      241 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/privkey1.pem
--rw-r--r--   0 bmw        (501) staff       (20)     1877 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-renewal-ancient.conf
--rw-r--r--   0 bmw        (501) staff       (20)      553 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-renewal-deprecated-option.conf
--rw-r--r--   0 bmw        (501) staff       (20)     1970 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-renewal-ec.conf
--rw-r--r--   0 bmw        (501) staff       (20)     1911 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/sample-renewal.conf
--rw-r--r--   0 bmw        (501) staff       (20)       54 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/testdata/webrootconftest.ini
--rw-r--r--   0 bmw        (501) staff       (20)    17677 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/tests/util.py
--rw-r--r--   0 bmw        (501) staff       (20)    22217 2023-04-04 15:06:41.000000 certbot-2.5.0/certbot/util.py
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/
--rw-r--r--   0 bmw        (501) staff       (20)     7072 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/PKG-INFO
--rw-r--r--   0 bmw        (501) staff       (20)     7747 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/SOURCES.txt
--rw-r--r--   0 bmw        (501) staff       (20)        1 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/dependency_links.txt
--rw-r--r--   0 bmw        (501) staff       (20)      291 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/entry_points.txt
--rw-r--r--   0 bmw        (501) staff       (20)      859 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/requires.txt
--rw-r--r--   0 bmw        (501) staff       (20)        8 2023-04-04 15:06:42.000000 certbot-2.5.0/certbot.egg-info/top_level.txt
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/docs/
--rw-r--r--   0 bmw        (501) staff       (20)        9 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/.gitignore
--rw-r--r--   0 bmw        (501) staff       (20)     7073 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/Makefile
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/docs/_static/
--rw-r--r--   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/_static/.gitignore
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/docs/_templates/
--rw-r--r--   0 bmw        (501) staff       (20)     2004 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/_templates/footer.html
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/docs/api/
--rw-r--r--   0 bmw        (501) staff       (20)      148 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.achallenges.rst
--rw-r--r--   0 bmw        (501) staff       (20)      166 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.compat.filesystem.rst
--rw-r--r--   0 bmw        (501) staff       (20)      148 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.compat.misc.rst
--rw-r--r--   0 bmw        (501) staff       (20)      180 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.compat.os.rst
--rw-r--r--   0 bmw        (501) staff       (20)      247 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.compat.rst
--rw-r--r--   0 bmw        (501) staff       (20)      150 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.crypto_util.rst
--rw-r--r--   0 bmw        (501) staff       (20)      148 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.display.ops.rst
--rw-r--r--   0 bmw        (501) staff       (20)      224 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.display.rst
--rw-r--r--   0 bmw        (501) staff       (20)      151 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.display.util.rst
--rw-r--r--   0 bmw        (501) staff       (20)      133 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.errors.rst
--rw-r--r--   0 bmw        (501) staff       (20)      145 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.interfaces.rst
--rw-r--r--   0 bmw        (501) staff       (20)      127 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.main.rst
--rw-r--r--   0 bmw        (501) staff       (20)      131 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.ocsp.rst
--rw-r--r--   0 bmw        (501) staff       (20)      157 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.common.rst
--rw-r--r--   0 bmw        (501) staff       (20)      171 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.dns_common.rst
--rw-r--r--   0 bmw        (501) staff       (20)      197 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.dns_common_lexicon.rst
--rw-r--r--   0 bmw        (501) staff       (20)      188 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.dns_test_common.rst
--rw-r--r--   0 bmw        (501) staff       (20)      214 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.dns_test_common_lexicon.rst
--rw-r--r--   0 bmw        (501) staff       (20)      175 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.enhancements.rst
--rw-r--r--   0 bmw        (501) staff       (20)      432 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.rst
--rw-r--r--   0 bmw        (501) staff       (20)      160 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.storage.rst
--rw-r--r--   0 bmw        (501) staff       (20)      151 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.plugins.util.rst
--rw-r--r--   0 bmw        (501) staff       (20)      139 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.reverter.rst
--rw-r--r--   0 bmw        (501) staff       (20)      424 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.rst
--rw-r--r--   0 bmw        (501) staff       (20)      162 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.tests.acme_util.rst
--rw-r--r--   0 bmw        (501) staff       (20)      220 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.tests.rst
--rw-r--r--   0 bmw        (501) staff       (20)      145 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.tests.util.rst
--rw-r--r--   0 bmw        (501) staff       (20)      127 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api/certbot.util.rst
--rw-r--r--   0 bmw        (501) staff       (20)      100 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/api.rst
--rw-r--r--   0 bmw        (501) staff       (20)     4701 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/challenges.rst
--rw-r--r--   0 bmw        (501) staff       (20)    15001 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/ciphers.rst
--rw-r--r--   0 bmw        (501) staff       (20)    40339 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/cli-help.txt
--rw-r--r--   0 bmw        (501) staff       (20)     2001 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/compatibility.rst
--rw-r--r--   0 bmw        (501) staff       (20)    10737 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/conf.py
--rw-r--r--   0 bmw        (501) staff       (20)    26651 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/contributing.rst
--rw-r--r--   0 bmw        (501) staff       (20)      347 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/index.rst
--rw-r--r--   0 bmw        (501) staff       (20)     5935 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/install.rst
--rw-r--r--   0 bmw        (501) staff       (20)      258 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/intro.rst
--rw-r--r--   0 bmw        (501) staff       (20)     7259 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/make.bat
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/docs/man/
--rw-r--r--   0 bmw        (501) staff       (20)      751 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/man/certbot.rst
--rw-r--r--   0 bmw        (501) staff       (20)     2906 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/packaging.rst
--rw-r--r--   0 bmw        (501) staff       (20)      147 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/resources.rst
--rw-r--r--   0 bmw        (501) staff       (20)    57042 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/using.rst
--rw-r--r--   0 bmw        (501) staff       (20)     1712 2023-04-04 15:06:41.000000 certbot-2.5.0/docs/what.rst
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/examples/
--rw-r--r--   0 bmw        (501) staff       (20)       36 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/.gitignore
--rw-r--r--   0 bmw        (501) staff       (20)     1283 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/cli.ini
--rw-r--r--   0 bmw        (501) staff       (20)      453 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/dev-cli.ini
--rwxr-xr-x   0 bmw        (501) staff       (20)      721 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/generate-csr.sh
--rw-r--r--   0 bmw        (501) staff       (20)      114 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/openssl.cnf
-drwxr-xr-x   0 bmw        (501) staff       (20)        0 2023-04-04 15:06:42.000000 certbot-2.5.0/examples/plugins/
--rw-r--r--   0 bmw        (501) staff       (20)      674 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/plugins/certbot_example_plugins.py
--rw-r--r--   0 bmw        (501) staff       (20)      378 2023-04-04 15:06:41.000000 certbot-2.5.0/examples/plugins/setup.py
--rw-r--r--   0 bmw        (501) staff       (20)       38 2023-04-04 15:06:42.000000 certbot-2.5.0/setup.cfg
--rw-r--r--   0 bmw        (501) staff       (20)     5728 2023-04-04 15:06:41.000000 certbot-2.5.0/setup.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.348909 certbot-2.6.0/
+-rw-rw-r--   0 erica     (1001) erica     (1001)   115868 2023-05-09 19:44:36.000000 certbot-2.6.0/CHANGELOG.md
+-rw-rw-r--   0 erica     (1001) erica     (1001)    11456 2023-05-09 19:44:36.000000 certbot-2.6.0/LICENSE.txt
+-rw-rw-r--   0 erica     (1001) erica     (1001)      267 2023-05-09 19:44:36.000000 certbot-2.6.0/MANIFEST.in
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7072 2023-05-09 19:44:37.344910 certbot-2.6.0/PKG-INFO
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5835 2023-05-09 19:44:36.000000 certbot-2.6.0/README.rst
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.328915 certbot-2.6.0/certbot/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      112 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot/__init__.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.328915 certbot-2.6.0/certbot/_internal/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      184 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    14642 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/account.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    21072 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/auth_handler.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    18610 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cert_manager.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.328915 certbot-2.6.0/certbot/_internal/cli/
+-rw-rw-r--   0 erica     (1001) erica     (1001)    28878 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     4024 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/cli_constants.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     9489 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/cli_utils.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1073 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/group_adder.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    21123 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/helpful.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2055 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/paths_parser.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     6210 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/plugins_parsing.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     4162 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/subparsers.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5223 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/cli/verb_help.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    36861 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/client.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     6962 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/constants.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.328915 certbot-2.6.0/certbot/_internal/display/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       33 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/display/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2645 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/display/completer.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      811 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/display/dummy_readline.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    22469 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/display/obj.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     3456 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/display/util.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     4484 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/eff.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7452 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/error_handler.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     8928 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/hooks.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    10226 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/lock.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15384 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/log.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    73237 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/main.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.332914 certbot-2.6.0/certbot/_internal/plugins/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       23 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    10678 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/disco.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    11966 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/manual.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1579 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/null.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15772 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/selection.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     9340 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/standalone.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15984 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/plugins/webroot.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    25775 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/renewal.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     3706 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/snap_config.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    53470 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/storage.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.332914 certbot-2.6.0/certbot/_internal/tests/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       20 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    14284 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/account_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    25036 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/auth_handler_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    31128 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/cert_manager_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    20428 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/cli_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    46400 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/client_test.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.332914 certbot-2.6.0/certbot/_internal/tests/compat/
+-rw-rw-r--   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/compat/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    27416 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/compat/filesystem_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1747 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/compat/misc_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      604 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/compat/os_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     6922 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/configuration_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      140 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/conftest.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    18932 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/crypto_util_test.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.336913 certbot-2.6.0/certbot/_internal/tests/display/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       28 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/display/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     3716 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/display/completer_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5153 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/display/internal_util_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    13201 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/display/obj_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    20275 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/display/ops_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2375 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/display/util_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     6676 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/eff_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5202 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/error_handler_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1956 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/errors_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     8830 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/helpful_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    16661 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/hook_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5060 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/lock_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15949 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/log_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)   121447 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/main_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    17503 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/ocsp_test.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.336913 certbot-2.6.0/certbot/_internal/tests/plugins/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       28 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    14446 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/common_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    10233 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/disco_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      700 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/dns_common_lexicon_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     8522 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/dns_common_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2340 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/enhancements_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7425 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/manual_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      674 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/null_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    10002 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/selection_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     6817 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/standalone_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5541 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/storage_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1511 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/util_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15386 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/plugins/webroot_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    14130 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/renewal_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5509 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/renewupdater_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    17001 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/reverter_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    44293 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/storage_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    23207 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/tests/util_test.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     4747 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/_internal/updater.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2024 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/achallenges.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.336913 certbot-2.6.0/certbot/compat/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      249 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/compat/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1797 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/compat/_path.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    30470 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/compat/filesystem.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5412 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/compat/misc.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     9511 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/compat/os.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    11960 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/configuration.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    24587 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/crypto_util.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.336913 certbot-2.6.0/certbot/display/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       33 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/display/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    13522 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/display/ops.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7268 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/display/util.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2786 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/errors.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15584 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/interfaces.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      535 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/main.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15036 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/ocsp.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.336913 certbot-2.6.0/certbot/plugins/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       23 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    17325 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/common.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    14028 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/dns_common.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5957 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/dns_common_lexicon.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2552 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/dns_test_common.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7473 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/dns_test_common_lexicon.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     6809 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/enhancements.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     4294 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/storage.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1811 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/plugins/util.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/py.typed
+-rw-rw-r--   0 erica     (1001) erica     (1001)    22069 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/reverter.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      424 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/ssl-dhparams.pem
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.336913 certbot-2.6.0/certbot/tests/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       42 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/__init__.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2763 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/acme_util.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.340911 certbot-2.6.0/certbot/tests/testdata/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      642 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/README
+-rw-rw-r--   0 erica     (1001) erica     (1001)      952 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert-5sans_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      623 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert-nosans_nistp256.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      786 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert-san_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1200 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_2048.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      709 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      887 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_512_bad.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2400 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_fullchain_2048.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1208 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_intermediate_1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1208 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_intermediate_2.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1220 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cert_leaf.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)       25 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/cli.ini
+-rw-rw-r--   0 erica     (1001) erica     (1001)      502 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-6sans_512.conf
+-rw-rw-r--   0 erica     (1001) erica     (1001)      676 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-6sans_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      420 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-nonames_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      277 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-nosans_512.conf
+-rw-rw-r--   0 erica     (1001) erica     (1001)      493 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-nosans_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      452 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-nosans_nistp256.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      574 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr-san_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      281 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr_512.der
+-rw-rw-r--   0 erica     (1001) erica     (1001)      452 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/csr_512.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      302 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/ec_prime256v1_key.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      359 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/ec_secp384r1_key.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      436 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/ec_secp521r1_key.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      227 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/nistp256_key.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2273 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/ocsp_certificate.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2247 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/ocsp_issuer_certificate.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1671 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/ocsp_responder_certificate.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      190 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/os-release
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1708 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/rsa2048_key.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      298 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/rsa256_key.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      493 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/rsa512_key.pem
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.340911 certbot-2.6.0/certbot/tests/testdata/sample-archive/
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1736 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive/cert1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1123 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive/chain1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2859 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive/fullchain1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1704 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive/privkey1.pem
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.340911 certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1050 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/cert1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1208 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/chain1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2258 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/fullchain1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)      241 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/privkey1.pem
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1877 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-renewal-ancient.conf
+-rw-rw-r--   0 erica     (1001) erica     (1001)      553 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-renewal-deprecated-option.conf
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1970 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-renewal-ec.conf
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1911 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/sample-renewal.conf
+-rw-rw-r--   0 erica     (1001) erica     (1001)       54 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/testdata/webrootconftest.ini
+-rw-rw-r--   0 erica     (1001) erica     (1001)    17677 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/tests/util.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    22217 2023-05-09 19:44:36.000000 certbot-2.6.0/certbot/util.py
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.328915 certbot-2.6.0/certbot.egg-info/
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7072 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot.egg-info/PKG-INFO
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7747 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot.egg-info/SOURCES.txt
+-rw-rw-r--   0 erica     (1001) erica     (1001)        1 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot.egg-info/dependency_links.txt
+-rw-rw-r--   0 erica     (1001) erica     (1001)      291 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot.egg-info/entry_points.txt
+-rw-rw-r--   0 erica     (1001) erica     (1001)      917 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot.egg-info/requires.txt
+-rw-rw-r--   0 erica     (1001) erica     (1001)        8 2023-05-09 19:44:37.000000 certbot-2.6.0/certbot.egg-info/top_level.txt
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/docs/
+-rw-rw-r--   0 erica     (1001) erica     (1001)        9 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/.gitignore
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7073 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/Makefile
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/docs/_static/
+-rw-rw-r--   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/_static/.gitignore
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/docs/_templates/
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2004 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/_templates/footer.html
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/docs/api/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      148 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.achallenges.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      166 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.compat.filesystem.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      148 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.compat.misc.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      180 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.compat.os.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      247 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.compat.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      150 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.crypto_util.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      148 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.display.ops.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      224 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.display.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      151 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.display.util.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      133 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.errors.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      145 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.interfaces.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      127 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.main.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      131 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.ocsp.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      157 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.common.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      171 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.dns_common.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      197 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.dns_common_lexicon.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      188 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.dns_test_common.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      214 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.dns_test_common_lexicon.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      175 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.enhancements.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      432 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      160 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.storage.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      151 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.plugins.util.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      139 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.reverter.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      424 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      162 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.tests.acme_util.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      220 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.tests.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      145 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.tests.util.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      127 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api/certbot.util.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      100 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/api.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)     4701 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/challenges.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)    15001 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/ciphers.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)    40798 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/cli-help.txt
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2001 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/compatibility.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)    10737 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/conf.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)    25522 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/contributing.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      347 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/index.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5935 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/install.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      258 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/intro.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)     7259 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/make.bat
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/docs/man/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      751 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/man/certbot.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)     2906 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/packaging.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)      147 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/resources.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)    57123 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/using.rst
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1712 2023-05-09 19:44:36.000000 certbot-2.6.0/docs/what.rst
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/examples/
+-rw-rw-r--   0 erica     (1001) erica     (1001)       36 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/.gitignore
+-rw-rw-r--   0 erica     (1001) erica     (1001)     1283 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/cli.ini
+-rw-rw-r--   0 erica     (1001) erica     (1001)      453 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/dev-cli.ini
+-rwxrwxr-x   0 erica     (1001) erica     (1001)      721 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/generate-csr.sh
+-rw-rw-r--   0 erica     (1001) erica     (1001)      114 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/openssl.cnf
+drwxrwxr-x   0 erica     (1001) erica     (1001)        0 2023-05-09 19:44:37.344910 certbot-2.6.0/examples/plugins/
+-rw-rw-r--   0 erica     (1001) erica     (1001)      674 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/plugins/certbot_example_plugins.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)      378 2023-05-09 19:44:36.000000 certbot-2.6.0/examples/plugins/setup.py
+-rw-rw-r--   0 erica     (1001) erica     (1001)       38 2023-05-09 19:44:37.348909 certbot-2.6.0/setup.cfg
+-rw-rw-r--   0 erica     (1001) erica     (1001)     5771 2023-05-09 19:44:36.000000 certbot-2.6.0/setup.py
```

### filetype from file(1)

```diff
@@ -1 +1 @@
-POSIX tar archive (GNU)
+POSIX tar archive
```

### Comparing `certbot-2.5.0/CHANGELOG.md` & `certbot-2.6.0/CHANGELOG.md`

 * *Files 0% similar despite different names*

```diff
@@ -1,11 +1,51 @@
 # Certbot change log
 
 Certbot adheres to [Semantic Versioning](https://semver.org/).
 
+## 2.6.0 - 2023-05-09
+
+### Added
+
+* `--dns-google-project` optionally allows for specifying the project that the DNS zone(s) reside in,
+  which allows for Certbot usage in scenarios where the auth credentials reside in a different
+  project to the zone(s) that are being managed.
+* There is now a new `Other` annotated challenge object to allow plugins to support entirely novel challenges.
+
+### Changed
+
+* Optionally sign the SOA query for dns-rfc2136, to help resolve problems with split-view
+  DNS setups and hidden primary setups.
+  * Certbot versions prior to v1.32.0 did not sign queries with the specified TSIG key
+    resulting in difficulty with split-horizon implementations.
+  * Certbot v1.32.0 through v2.5.0 signed queries by default, potentially causing
+    incompatibility with hidden primary setups with `allow-update-forwarding` enabled
+    if the secondary did not also have the TSIG key within its config.
+  * Certbot v2.6.0 and later no longer signs queries by default, but allows
+    the user to optionally sign these queries by explicit configuration using the
+    `dns_rfc2136_sign_query` option in the credentials .ini file.
+* Lineage name validity is performed for new lineages. `--cert-name` may no longer contain
+  filepath separators (i.e. `/` or `\`, depending on the platform).
+* `certbot-dns-google` now loads credentials using the standard [Application Default
+  Credentials](https://cloud.google.com/docs/authentication/application-default-credentials) strategy,
+  rather than explicitly requiring the Google Compute metadata server to be present if a service account
+  is not provided using `--dns-google-credentials`.
+* `--dns-google-credentials` now supports additional types of file-based credential, such as
+  [External Account Credentials](https://google.aip.dev/auth/4117) created by Workload Identity
+  Federation. All file-based credentials implemented by the Google Auth library are supported.
+
+### Fixed
+
+* `certbot-dns-google` no longer requires deprecated `oauth2client` library.
+* Certbot will no longer try to invoke plugins which do not subclass from the proper
+  `certbot.interfaces.{Installer,Authenticator}` interface (e.g. `certbot -i standalone`
+  will now be ignored). See [GH-9664](https://github.com/certbot/certbot/issues/9664).
+
+More details about these changes can be found on our GitHub repo.
+
 ## 2.5.0 - 2023-04-04
 
 ### Added
 
 * `acme.messages.OrderResource` now supports being round-tripped
   through JSON
 * acme.client.ClientV2 now provides separate `begin_finalization`
```

### Comparing `certbot-2.5.0/LICENSE.txt` & `certbot-2.6.0/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/PKG-INFO` & `certbot-2.6.0/PKG-INFO`

 * *Files identical despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: certbot
-Version: 2.5.0
+Version: 2.6.0
 Summary: ACME client
 Home-page: https://github.com/letsencrypt/letsencrypt
 Author: Certbot Project
 Author-email: certbot-dev@eff.org
 License: Apache License 2.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `certbot-2.5.0/README.rst` & `certbot-2.6.0/README.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/account.py` & `certbot-2.6.0/certbot/_internal/account.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/auth_handler.py` & `certbot-2.6.0/certbot/_internal/auth_handler.py`

 * *Files 1% similar despite different names*

```diff
@@ -380,15 +380,16 @@
     logger.info("%s challenge for %s", chall.typ, domain)
 
     if isinstance(chall, challenges.KeyAuthorizationChallenge):
         return achallenges.KeyAuthorizationAnnotatedChallenge(
             challb=challb, domain=domain, account_key=account_key)
     elif isinstance(chall, challenges.DNS):
         return achallenges.DNS(challb=challb, domain=domain)
-    raise errors.Error(f"Received unsupported challenge of type: {chall.typ}")
+    else:
+        return achallenges.Other(challb=challb, domain=domain)
 
 
 def gen_challenge_path(challbs: List[messages.ChallengeBody],
                        preferences: List[Type[challenges.Challenge]]) -> Tuple[int, ...]:
     """Generate a plan to get authority over the identity.
 
     :param tuple challbs: A tuple of challenges
```

### Comparing `certbot-2.5.0/certbot/_internal/cert_manager.py` & `certbot-2.6.0/certbot/_internal/cert_manager.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/__init__.py` & `certbot-2.6.0/certbot/_internal/cli/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -135,32 +135,31 @@
     )
     helpful.add(
         [None, "run", "certonly", "manage", "delete", "certificates",
          "renew", "enhance", "reconfigure"], "--cert-name", dest="certname",
         metavar="CERTNAME", default=flag_default("certname"),
         help="Certificate name to apply. This name is used by Certbot for housekeeping "
              "and in file paths; it doesn't affect the content of the certificate itself. "
+             "Certificate name cannot contain filepath separators (i.e. '/' or '\\', depending "
+             "on the platform). "
              "To see certificate names, run 'certbot certificates'. "
              "When creating a new certificate, specifies the new certificate's name. "
              "(default: the first provided domain or the name of an existing "
              "certificate on your system for the same domains)")
     helpful.add(
         [None, "testing", "renew", "certonly"],
         "--dry-run", action="store_true", dest="dry_run",
         default=flag_default("dry_run"),
-        help="Perform a test run of the client, obtaining test (invalid) certificates"
-             " but not saving them to disk. This can currently only be used"
-             " with the 'certonly' and 'renew' subcommands. \nNote: Although --dry-run"
-             " tries to avoid making any persistent changes on a system, it "
-             " is not completely side-effect free: if used with webserver authenticator plugins"
-             " like apache and nginx, it makes and then reverts temporary config changes"
-             " in order to obtain test certificates, and reloads webservers to deploy and then"
-             " roll back those changes.  It also calls --pre-hook and --post-hook commands"
-             " if they are defined because they may be necessary to accurately simulate"
-             " renewal. --deploy-hook commands are not called.")
+        help="Perform a test run against the Let's Encrypt staging server, obtaining test"
+             " (invalid) certificates but not saving them to disk. This can only be used with the"
+             " 'certonly' and 'renew' subcommands. It may trigger webserver reloads to "
+             " temporarily modify & roll back configuration files."
+             " --pre-hook and --post-hook commands run by default."
+             " --deploy-hook commands do not run, unless enabled by --run-deploy-hooks."
+             " The test server may be overridden with --server.")
     helpful.add(
         ["testing", "renew", "certonly", "reconfigure"],
         "--run-deploy-hooks", action="store_true", dest="run_deploy_hooks",
         default=flag_default("run_deploy_hooks"),
         help="When performing a test run using `--dry-run` or `reconfigure`, run any applicable"
              " deploy hooks. This includes hooks set on the command line, saved in the"
              " certificate's renewal configuration file, or present in the renewal-hooks directory."
@@ -264,16 +263,16 @@
         "-q", "--quiet", dest="quiet", action="store_true",
         default=flag_default("quiet"),
         help="Silence all output except errors. Useful for automation via cron."
              " Implies --non-interactive.")
     # overwrites server, handled in HelpfulArgumentParser.parse_args()
     helpful.add(["testing", "revoke", "run"], "--test-cert", "--staging",
         dest="staging", action="store_true", default=flag_default("staging"),
-        help="Use the staging server to obtain or revoke test (invalid) certificates; equivalent"
-             " to --server " + constants.STAGING_URI)
+        help="Use the Let's Encrypt staging server to obtain or revoke test (invalid) "
+             "certificates; equivalent to --server " + constants.STAGING_URI)
     helpful.add(
         "testing", "--debug", action="store_true", default=flag_default("debug"),
         help="Show tracebacks in case of errors")
     helpful.add(
         [None, "certonly", "run"], "--debug-challenges", action="store_true",
         default=flag_default("debug_challenges"),
         help="After setting up challenges, wait for user input before "
```

### Comparing `certbot-2.5.0/certbot/_internal/cli/cli_constants.py` & `certbot-2.6.0/certbot/_internal/cli/cli_constants.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/cli_utils.py` & `certbot-2.6.0/certbot/_internal/cli/cli_utils.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/group_adder.py` & `certbot-2.6.0/certbot/_internal/cli/group_adder.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/helpful.py` & `certbot-2.6.0/certbot/_internal/cli/helpful.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/paths_parser.py` & `certbot-2.6.0/certbot/_internal/cli/paths_parser.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/plugins_parsing.py` & `certbot-2.6.0/certbot/_internal/cli/plugins_parsing.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/subparsers.py` & `certbot-2.6.0/certbot/_internal/cli/subparsers.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/cli/verb_help.py` & `certbot-2.6.0/certbot/_internal/cli/verb_help.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/client.py` & `certbot-2.6.0/certbot/_internal/client.py`

 * *Files 2% similar despite different names*

```diff
@@ -509,24 +509,23 @@
         :param certname: requested name of lineage
         :type certname: `str` or `None`
 
         :returns: A new :class:`certbot._internal.storage.RenewableCert` instance
             referred to the enrolled cert lineage, or None if doing a successful dry run.
 
         """
+        new_name = self._choose_lineagename(domains, certname)
         cert, chain, key, _ = self.obtain_certificate(domains)
 
         if (self.config.config_dir != constants.CLI_DEFAULTS["config_dir"] or
                 self.config.work_dir != constants.CLI_DEFAULTS["work_dir"]):
             logger.info(
                 "Non-standard path(s), might not work with crontab installed "
                 "by your operating system package manager")
 
-        new_name = self._choose_lineagename(domains, certname)
-
         if self.config.dry_run:
             logger.debug("Dry run: Skipping creating new lineage for %s", new_name)
             return None
         return storage.RenewableCert.new_lineage(
             new_name, cert,
             key.pem, chain,
             self.config)
@@ -555,21 +554,49 @@
         :type domains: `list` of `str`
         :param certname: requested name of lineage
         :type certname: `str` or `None`
 
         :returns: lineage name that should be used
         :rtype: str
 
+        :raises errors.Error: If the chosen lineage name is invalid.
+
         """
+        # Remember chosen name for new lineage
+        lineagename = None
         if certname:
-            return certname
+            lineagename = certname
         elif util.is_wildcard_domain(domains[0]):
             # Don't make files and directories starting with *.
-            return domains[0][2:]
-        return domains[0]
+            lineagename = domains[0][2:]
+        else:
+            lineagename = domains[0]
+        # Verify whether chosen lineage is valid
+        if self._is_valid_lineagename(lineagename):
+            return lineagename
+        else:
+            raise errors.Error(
+                "The provided certname cannot be used as a lineage name because it contains "
+                "an illegal character (i.e. filepath separator)." if certname else
+                "Cannot use domain name as lineage name because it contains an illegal "
+                "character (i.e. filepath separator). Specify an explicit lineage name "
+                "with --cert-name.")
+
+    def _is_valid_lineagename(self, name: str) -> bool:
+        """Determines whether the provided name is a valid lineagename. A lineagename
+        is invalid when it contains filepath separators.
+
+        :param name: the lineage name to determine validity for
+        :type name: `str`
+
+        :returns: Whether the provided string constitutes a valid lineage name.
+        :rtype: bool
+
+        """
+        return os.path.sep not in name
 
     def save_certificate(self, cert_pem: bytes, chain_pem: bytes,
                          cert_path: str, chain_path: str, fullchain_path: str
                          ) -> Tuple[str, str, str]:
         """Saves the certificate received from the ACME server.
 
         :param bytes cert_pem:
```

### Comparing `certbot-2.5.0/certbot/_internal/constants.py` & `certbot-2.6.0/certbot/_internal/constants.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/display/completer.py` & `certbot-2.6.0/certbot/_internal/display/completer.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/display/dummy_readline.py` & `certbot-2.6.0/certbot/_internal/display/dummy_readline.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/display/obj.py` & `certbot-2.6.0/certbot/_internal/display/obj.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/display/util.py` & `certbot-2.6.0/certbot/_internal/display/util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/eff.py` & `certbot-2.6.0/certbot/_internal/eff.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/error_handler.py` & `certbot-2.6.0/certbot/_internal/error_handler.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/hooks.py` & `certbot-2.6.0/certbot/_internal/hooks.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/lock.py` & `certbot-2.6.0/certbot/_internal/lock.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/log.py` & `certbot-2.6.0/certbot/_internal/log.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/main.py` & `certbot-2.6.0/certbot/_internal/main.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/plugins/disco.py` & `certbot-2.6.0/certbot/_internal/plugins/disco.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/plugins/manual.py` & `certbot-2.6.0/certbot/_internal/plugins/manual.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/plugins/null.py` & `certbot-2.6.0/certbot/_internal/plugins/null.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/plugins/selection.py` & `certbot-2.6.0/certbot/_internal/plugins/selection.py`

 * *Files 0% similar despite different names*

```diff
@@ -108,16 +108,17 @@
             raise errors.MissingCommandlineFlag(
                 "Missing command line flags. For non-interactive execution, "
                 "you will need to specify a plugin on the command line.  Run "
                 "with '--help plugins' to see a list of options, and see "
                 "https://eff.org/letsencrypt-plugins for more detail on what "
                 "the plugins do and how to use them.")
 
-        filtered = plugins.visible().ifaces(ifaces)
+        filtered = plugins.visible()
 
+    filtered = filtered.ifaces(ifaces)
     filtered.init(config)
     filtered.prepare()
     prepared = filtered.available()
 
     if len(prepared) > 1:
         logger.debug("Multiple candidate plugins: %s", prepared)
         plugin_ep1 = choose_plugin(list(prepared.values()), question)
```

### Comparing `certbot-2.5.0/certbot/_internal/plugins/standalone.py` & `certbot-2.6.0/certbot/_internal/plugins/standalone.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/plugins/webroot.py` & `certbot-2.6.0/certbot/_internal/plugins/webroot.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/renewal.py` & `certbot-2.6.0/certbot/_internal/renewal.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/snap_config.py` & `certbot-2.6.0/certbot/_internal/snap_config.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/storage.py` & `certbot-2.6.0/certbot/_internal/storage.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/account_test.py` & `certbot-2.6.0/certbot/_internal/tests/account_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/auth_handler_test.py` & `certbot-2.6.0/certbot/_internal/tests/auth_handler_test.py`

 * *Files 1% similar despite different names*

```diff
@@ -42,20 +42,20 @@
     def test_one_http(self):
         achalls = self.handler._challenge_factory(self.authzr, [0])
 
         assert [achall.chall for achall in achalls] == [acme_util.HTTP01]
 
     def test_unrecognized(self):
         authzr = acme_util.gen_authzr(
-             messages.STATUS_PENDING, "test",
-             [mock.Mock(chall="chall", typ="unrecognized")],
-             [messages.STATUS_PENDING])
+            messages.STATUS_PENDING, "test",
+            [mock.Mock(chall="chall", typ="unrecognized")],
+            [messages.STATUS_PENDING])
 
-        with pytest.raises(errors.Error):
-            self.handler._challenge_factory(authzr, [0])
+        achalls = self.handler._challenge_factory(authzr, [0])
+        assert type(achalls[0]) == achallenges.Other
 
 
 class HandleAuthorizationsTest(unittest.TestCase):
     """handle_authorizations test.
 
     This tests everything except for all functions under _poll_challenges.
```

### Comparing `certbot-2.5.0/certbot/_internal/tests/cert_manager_test.py` & `certbot-2.6.0/certbot/_internal/tests/cert_manager_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/cli_test.py` & `certbot-2.6.0/certbot/_internal/tests/cli_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/client_test.py` & `certbot-2.6.0/certbot/_internal/tests/client_test.py`

 * *Files 2% similar despite different names*

```diff
@@ -811,14 +811,33 @@
             self.client.deploy_certificate(["foo.bar"], "key", "cert", "chain", "fullchain")
         assert mock_logger.error.call_count == 1
         assert 'An error occurred and we failed to restore your config' in \
             mock_logger.error.call_args[0][0]
         installer.rollback_checkpoints.assert_called_once_with()
         assert installer.restart.call_count == 1
 
+    def test_choose_lineage_name(self):
+        sep = os.path.sep
+        invalid_domains = [f"exam{sep}ple.com"]
+        valid_domains = ["example.com"]
+        invalid_certname = f"foo{sep}.bar"
+        valid_certname = "foo.bar"
+        invalid_wildcard_domain = [f"*.exam{sep}ple.com"]
+        # Verify errors are raised when invalid lineagename is chosen.
+        with pytest.raises(errors.Error):
+            self.client._choose_lineagename(invalid_domains, None)
+        with pytest.raises(errors.Error):
+            self.client._choose_lineagename(invalid_domains, invalid_certname)
+        with pytest.raises(errors.Error):
+            self.client._choose_lineagename(valid_domains, invalid_certname)
+        with pytest.raises(errors.Error):
+            self.client._choose_lineagename(invalid_wildcard_domain, None)
+        # Verify no error is raised when invalid domain is overriden by valid certname.
+        self.client._choose_lineagename(invalid_domains, valid_certname)
+
 
 class EnhanceConfigTest(ClientTestCommon):
     """Tests for certbot._internal.client.Client.enhance_config."""
 
     def setUp(self):
         super().setUp()
```

### Comparing `certbot-2.5.0/certbot/_internal/tests/compat/filesystem_test.py` & `certbot-2.6.0/certbot/_internal/tests/compat/filesystem_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/compat/misc_test.py` & `certbot-2.6.0/certbot/_internal/tests/compat/misc_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/compat/os_test.py` & `certbot-2.6.0/certbot/_internal/tests/compat/os_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/configuration_test.py` & `certbot-2.6.0/certbot/_internal/tests/configuration_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/crypto_util_test.py` & `certbot-2.6.0/certbot/_internal/tests/crypto_util_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/display/completer_test.py` & `certbot-2.6.0/certbot/_internal/tests/display/completer_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/display/internal_util_test.py` & `certbot-2.6.0/certbot/_internal/tests/display/internal_util_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/display/obj_test.py` & `certbot-2.6.0/certbot/_internal/tests/display/obj_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/display/ops_test.py` & `certbot-2.6.0/certbot/_internal/tests/display/ops_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/display/util_test.py` & `certbot-2.6.0/certbot/_internal/tests/display/util_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/eff_test.py` & `certbot-2.6.0/certbot/_internal/tests/eff_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/error_handler_test.py` & `certbot-2.6.0/certbot/_internal/tests/error_handler_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/errors_test.py` & `certbot-2.6.0/certbot/_internal/tests/errors_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/helpful_test.py` & `certbot-2.6.0/certbot/_internal/tests/helpful_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/hook_test.py` & `certbot-2.6.0/certbot/_internal/tests/hook_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/lock_test.py` & `certbot-2.6.0/certbot/_internal/tests/lock_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/log_test.py` & `certbot-2.6.0/certbot/_internal/tests/log_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/main_test.py` & `certbot-2.6.0/certbot/_internal/tests/main_test.py`

 * *Files 0% similar despite different names*

```diff
@@ -1027,6527 +1027,6565 @@
 00004020: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
 00004030: 6c28 2763 6572 746f 6e6c 7920 2d2d 6e67  l('certonly --ng
 00004040: 696e 7820 2d64 2065 7861 6d70 6c65 2e63  inx -d example.c
 00004050: 6f6d 202d 2d64 7279 2d72 756e 272e 7370  om --dry-run'.sp
 00004060: 6c69 7428 2929 0a20 2020 2020 2020 206d  lit()).        m
 00004070: 6f63 6b5f 696e 7374 616c 6c65 722e 7265  ock_installer.re
 00004080: 7374 6172 742e 6173 7365 7274 5f6e 6f74  start.assert_not
-00004090: 5f63 616c 6c65 6428 290a 0a0a 636c 6173  _called()...clas
-000040a0: 7320 4669 6e64 446f 6d61 696e 734f 7243  s FindDomainsOrC
-000040b0: 6572 746e 616d 6554 6573 7428 756e 6974  ertnameTest(unit
-000040c0: 7465 7374 2e54 6573 7443 6173 6529 3a0a  test.TestCase):.
-000040d0: 2020 2020 2222 2254 6573 7473 2066 6f72      """Tests for
-000040e0: 2063 6572 7462 6f74 2e5f 696e 7465 726e   certbot._intern
-000040f0: 616c 2e6d 6169 6e2e 5f66 696e 645f 646f  al.main._find_do
-00004100: 6d61 696e 735f 6f72 5f63 6572 746e 616d  mains_or_certnam
-00004110: 652e 2222 220a 0a20 2020 2040 6d6f 636b  e."""..    @mock
-00004120: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-00004130: 6469 7370 6c61 792e 6f70 732e 6368 6f6f  display.ops.choo
-00004140: 7365 5f6e 616d 6573 2729 0a20 2020 2064  se_names').    d
-00004150: 6566 2074 6573 745f 6469 7370 6c61 795f  ef test_display_
-00004160: 6f70 7328 7365 6c66 2c20 6d6f 636b 5f63  ops(self, mock_c
-00004170: 686f 6f73 655f 6e61 6d65 7329 3a0a 2020  hoose_names):.  
-00004180: 2020 2020 2020 6d6f 636b 5f63 6f6e 6669        mock_confi
-00004190: 6720 3d20 6d6f 636b 2e4d 6f63 6b28 646f  g = mock.Mock(do
-000041a0: 6d61 696e 733d 4e6f 6e65 2c20 6365 7274  mains=None, cert
-000041b0: 6e61 6d65 3d4e 6f6e 6529 0a20 2020 2020  name=None).     
-000041c0: 2020 206d 6f63 6b5f 6368 6f6f 7365 5f6e     mock_choose_n
-000041d0: 616d 6573 2e72 6574 7572 6e5f 7661 6c75  ames.return_valu
-000041e0: 6520 3d20 2264 6f6d 6169 6e6e 616d 6522  e = "domainname"
-000041f0: 0a20 2020 2020 2020 2023 2070 796c 696e  .        # pylin
-00004200: 743a 2064 6973 6162 6c65 3d70 726f 7465  t: disable=prote
-00004210: 6374 6564 2d61 6363 6573 730a 2020 2020  cted-access.    
-00004220: 2020 2020 6173 7365 7274 206d 6169 6e2e      assert main.
-00004230: 5f66 696e 645f 646f 6d61 696e 735f 6f72  _find_domains_or
-00004240: 5f63 6572 746e 616d 6528 6d6f 636b 5f63  _certname(mock_c
-00004250: 6f6e 6669 672c 204e 6f6e 6529 203d 3d20  onfig, None) == 
-00004260: 2822 646f 6d61 696e 6e61 6d65 222c 204e  ("domainname", N
-00004270: 6f6e 6529 0a0a 2020 2020 406d 6f63 6b2e  one)..    @mock.
-00004280: 7061 7463 6828 2763 6572 7462 6f74 2e64  patch('certbot.d
-00004290: 6973 706c 6179 2e6f 7073 2e63 686f 6f73  isplay.ops.choos
-000042a0: 655f 6e61 6d65 7327 290a 2020 2020 6465  e_names').    de
-000042b0: 6620 7465 7374 5f6e 6f5f 7265 7375 6c74  f test_no_result
-000042c0: 7328 7365 6c66 2c20 6d6f 636b 5f63 686f  s(self, mock_cho
-000042d0: 6f73 655f 6e61 6d65 7329 3a0a 2020 2020  ose_names):.    
-000042e0: 2020 2020 6d6f 636b 5f63 6f6e 6669 6720      mock_config 
-000042f0: 3d20 6d6f 636b 2e4d 6f63 6b28 646f 6d61  = mock.Mock(doma
-00004300: 696e 733d 4e6f 6e65 2c20 6365 7274 6e61  ins=None, certna
-00004310: 6d65 3d4e 6f6e 6529 0a20 2020 2020 2020  me=None).       
-00004320: 206d 6f63 6b5f 6368 6f6f 7365 5f6e 616d   mock_choose_nam
-00004330: 6573 2e72 6574 7572 6e5f 7661 6c75 6520  es.return_value 
-00004340: 3d20 5b5d 0a20 2020 2020 2020 2023 2070  = [].        # p
-00004350: 796c 696e 743a 2064 6973 6162 6c65 3d70  ylint: disable=p
-00004360: 726f 7465 6374 6564 2d61 6363 6573 730a  rotected-access.
-00004370: 2020 2020 2020 2020 7769 7468 2070 7974          with pyt
-00004380: 6573 742e 7261 6973 6573 2865 7272 6f72  est.raises(error
-00004390: 732e 4572 726f 7229 3a0a 2020 2020 2020  s.Error):.      
-000043a0: 2020 2020 2020 6d61 696e 2e5f 6669 6e64        main._find
-000043b0: 5f64 6f6d 6169 6e73 5f6f 725f 6365 7274  _domains_or_cert
-000043c0: 6e61 6d65 286d 6f63 6b5f 636f 6e66 6967  name(mock_config
-000043d0: 2c20 4e6f 6e65 290a 0a20 2020 2040 6d6f  , None)..    @mo
-000043e0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-000043f0: 742e 5f69 6e74 6572 6e61 6c2e 6365 7274  t._internal.cert
-00004400: 5f6d 616e 6167 6572 2e64 6f6d 6169 6e73  _manager.domains
-00004410: 5f66 6f72 5f63 6572 746e 616d 6527 290a  _for_certname').
-00004420: 2020 2020 6465 6620 7465 7374 5f67 7261      def test_gra
-00004430: 625f 646f 6d61 696e 7328 7365 6c66 2c20  b_domains(self, 
-00004440: 6d6f 636b 5f64 6f6d 6169 6e73 293a 0a20  mock_domains):. 
-00004450: 2020 2020 2020 206d 6f63 6b5f 636f 6e66         mock_conf
-00004460: 6967 203d 206d 6f63 6b2e 4d6f 636b 2864  ig = mock.Mock(d
-00004470: 6f6d 6169 6e73 3d4e 6f6e 652c 2063 6572  omains=None, cer
-00004480: 746e 616d 653d 226f 6e65 2e63 6f6d 2229  tname="one.com")
-00004490: 0a20 2020 2020 2020 206d 6f63 6b5f 646f  .        mock_do
-000044a0: 6d61 696e 732e 7265 7475 726e 5f76 616c  mains.return_val
-000044b0: 7565 203d 205b 226f 6e65 2e63 6f6d 222c  ue = ["one.com",
-000044c0: 2022 7477 6f2e 636f 6d22 5d0a 2020 2020   "two.com"].    
-000044d0: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
-000044e0: 7361 626c 653d 7072 6f74 6563 7465 642d  sable=protected-
-000044f0: 6163 6365 7373 0a20 2020 2020 2020 2061  access.        a
-00004500: 7373 6572 7420 6d61 696e 2e5f 6669 6e64  ssert main._find
-00004510: 5f64 6f6d 6169 6e73 5f6f 725f 6365 7274  _domains_or_cert
-00004520: 6e61 6d65 286d 6f63 6b5f 636f 6e66 6967  name(mock_config
-00004530: 2c20 4e6f 6e65 2920 3d3d 205c 0a20 2020  , None) == \.   
-00004540: 2020 2020 2020 2020 2028 5b22 6f6e 652e           (["one.
-00004550: 636f 6d22 2c20 2274 776f 2e63 6f6d 225d  com", "two.com"]
-00004560: 2c20 226f 6e65 2e63 6f6d 2229 0a0a 0a63  , "one.com")...c
-00004570: 6c61 7373 2052 6576 6f6b 6554 6573 7428  lass RevokeTest(
-00004580: 7465 7374 5f75 7469 6c2e 5465 6d70 4469  test_util.TempDi
-00004590: 7254 6573 7443 6173 6529 3a0a 2020 2020  rTestCase):.    
-000045a0: 2222 2254 6573 7473 2066 6f72 2063 6572  """Tests for cer
-000045b0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-000045c0: 6169 6e2e 7265 766f 6b65 2e22 2222 0a0a  ain.revoke."""..
-000045d0: 2020 2020 6465 6620 7365 7455 7028 7365      def setUp(se
-000045e0: 6c66 293a 0a20 2020 2020 2020 2073 7570  lf):.        sup
-000045f0: 6572 2829 2e73 6574 5570 2829 0a0a 2020  er().setUp()..  
-00004600: 2020 2020 2020 7368 7574 696c 2e63 6f70        shutil.cop
-00004610: 7928 4345 5254 5f50 4154 482c 2073 656c  y(CERT_PATH, sel
-00004620: 662e 7465 6d70 6469 7229 0a20 2020 2020  f.tempdir).     
-00004630: 2020 2073 656c 662e 746d 705f 6365 7274     self.tmp_cert
-00004640: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
-00004650: 6162 7370 6174 6828 6f73 2e70 6174 682e  abspath(os.path.
-00004660: 6a6f 696e 2873 656c 662e 7465 6d70 6469  join(self.tempdi
-00004670: 722c 2027 6365 7274 5f35 3132 2e70 656d  r, 'cert_512.pem
-00004680: 2729 290a 0a20 2020 2020 2020 2070 6174  '))..        pat
-00004690: 6368 6573 203d 205b 0a20 2020 2020 2020  ches = [.       
-000046a0: 2020 2020 206d 6f63 6b2e 7061 7463 6828       mock.patch(
-000046b0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-000046c0: 616c 2e63 6c69 656e 742e 6163 6d65 5f63  al.client.acme_c
-000046d0: 6c69 656e 7427 292c 0a20 2020 2020 2020  lient'),.       
-000046e0: 2020 2020 206d 6f63 6b2e 7061 7463 6828       mock.patch(
-000046f0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00004700: 616c 2e63 6c69 656e 742e 436c 6965 6e74  al.client.Client
-00004710: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00004720: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00004730: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-00004740: 696e 2e5f 6465 7465 726d 696e 655f 6163  in._determine_ac
-00004750: 636f 756e 7427 292c 0a20 2020 2020 2020  count'),.       
-00004760: 2020 2020 206d 6f63 6b2e 7061 7463 6828       mock.patch(
-00004770: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00004780: 616c 2e6d 6169 6e2e 6469 7370 6c61 795f  al.main.display_
-00004790: 6f70 732e 7375 6363 6573 735f 7265 766f  ops.success_revo
-000047a0: 6361 7469 6f6e 2729 0a20 2020 2020 2020  cation').       
-000047b0: 205d 0a20 2020 2020 2020 2073 656c 662e   ].        self.
-000047c0: 6d6f 636b 5f61 636d 655f 636c 6965 6e74  mock_acme_client
-000047d0: 203d 2070 6174 6368 6573 5b30 5d2e 7374   = patches[0].st
-000047e0: 6172 7428 292e 436c 6965 6e74 5632 0a20  art().ClientV2. 
-000047f0: 2020 2020 2020 2070 6174 6368 6573 5b31         patches[1
-00004800: 5d2e 7374 6172 7428 290a 2020 2020 2020  ].start().      
-00004810: 2020 7365 6c66 2e6d 6f63 6b5f 6465 7465    self.mock_dete
-00004820: 726d 696e 655f 6163 636f 756e 7420 3d20  rmine_account = 
-00004830: 7061 7463 6865 735b 325d 2e73 7461 7274  patches[2].start
-00004840: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00004850: 6d6f 636b 5f73 7563 6365 7373 5f72 6576  mock_success_rev
-00004860: 6f6b 6520 3d20 7061 7463 6865 735b 335d  oke = patches[3]
-00004870: 2e73 7461 7274 2829 0a20 2020 2020 2020  .start().       
-00004880: 2066 6f72 2070 6174 6368 2069 6e20 7061   for patch in pa
-00004890: 7463 6865 733a 0a20 2020 2020 2020 2020  tches:.         
-000048a0: 2020 2073 656c 662e 6164 6443 6c65 616e     self.addClean
-000048b0: 7570 2870 6174 6368 2e73 746f 7029 0a0a  up(patch.stop)..
-000048c0: 2020 2020 2020 2020 6672 6f6d 2063 6572          from cer
-000048d0: 7462 6f74 2e5f 696e 7465 726e 616c 2e61  tbot._internal.a
-000048e0: 6363 6f75 6e74 2069 6d70 6f72 7420 4163  ccount import Ac
-000048f0: 636f 756e 740a 0a20 2020 2020 2020 2073  count..        s
-00004900: 656c 662e 7265 6772 203d 206d 6f63 6b2e  elf.regr = mock.
-00004910: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
-00004920: 2020 2020 7365 6c66 2e6d 6574 6120 3d20      self.meta = 
-00004930: 4163 636f 756e 742e 4d65 7461 280a 2020  Account.Meta(.  
-00004940: 2020 2020 2020 2020 2020 6372 6561 7469            creati
-00004950: 6f6e 5f68 6f73 743d 2274 6573 742e 6365  on_host="test.ce
-00004960: 7274 626f 742e 6f72 6722 2c0a 2020 2020  rtbot.org",.    
-00004970: 2020 2020 2020 2020 6372 6561 7469 6f6e          creation
-00004980: 5f64 743d 6461 7465 7469 6d65 2e64 6174  _dt=datetime.dat
-00004990: 6574 696d 6528 0a20 2020 2020 2020 2020  etime(.         
-000049a0: 2020 2020 2020 2032 3031 352c 2037 2c20         2015, 7, 
-000049b0: 342c 2031 342c 2034 2c20 3130 2c20 747a  4, 14, 4, 10, tz
-000049c0: 696e 666f 3d70 7974 7a2e 5554 4329 290a  info=pytz.UTC)).
-000049d0: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
-000049e0: 203d 2041 6363 6f75 6e74 2873 656c 662e   = Account(self.
-000049f0: 7265 6772 2c20 4a57 4b2c 2073 656c 662e  regr, JWK, self.
-00004a00: 6d65 7461 290a 0a20 2020 2020 2020 2073  meta)..        s
-00004a10: 656c 662e 6d6f 636b 5f64 6574 6572 6d69  elf.mock_determi
-00004a20: 6e65 5f61 6363 6f75 6e74 2e72 6574 7572  ne_account.retur
-00004a30: 6e5f 7661 6c75 6520 3d20 2873 656c 662e  n_value = (self.
-00004a40: 6163 632c 204e 6f6e 6529 0a0a 2020 2020  acc, None)..    
-00004a50: 6465 6620 5f63 616c 6c28 7365 6c66 2c20  def _call(self, 
-00004a60: 6172 6773 3d4e 6f6e 6529 3a0a 2020 2020  args=None):.    
-00004a70: 2020 2020 6966 206e 6f74 2061 7267 733a      if not args:
-00004a80: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-00004a90: 7320 3d20 2772 6576 6f6b 6520 2d2d 6365  s = 'revoke --ce
-00004aa0: 7274 2d70 6174 683d 7b30 7d20 270a 2020  rt-path={0} '.  
-00004ab0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
-00004ac0: 2061 7267 732e 666f 726d 6174 2873 656c   args.format(sel
-00004ad0: 662e 746d 705f 6365 7274 5f70 6174 6829  f.tmp_cert_path)
-00004ae0: 2e73 706c 6974 2829 0a20 2020 2020 2020  .split().       
-00004af0: 2070 6c75 6769 6e73 203d 2064 6973 636f   plugins = disco
-00004b00: 2e50 6c75 6769 6e73 5265 6769 7374 7279  .PluginsRegistry
-00004b10: 2e66 696e 645f 616c 6c28 290a 2020 2020  .find_all().    
-00004b20: 2020 2020 636f 6e66 6967 203d 2063 6f6e      config = con
-00004b30: 6669 6775 7261 7469 6f6e 2e4e 616d 6573  figuration.Names
-00004b40: 7061 6365 436f 6e66 6967 280a 2020 2020  paceConfig(.    
-00004b50: 2020 2020 2020 2020 636c 692e 7072 6570          cli.prep
-00004b60: 6172 655f 616e 645f 7061 7273 655f 6172  are_and_parse_ar
-00004b70: 6773 2870 6c75 6769 6e73 2c20 6172 6773  gs(plugins, args
-00004b80: 2929 0a0a 2020 2020 2020 2020 6672 6f6d  ))..        from
-00004b90: 2063 6572 7462 6f74 2e5f 696e 7465 726e   certbot._intern
-00004ba0: 616c 2e6d 6169 6e20 696d 706f 7274 2072  al.main import r
-00004bb0: 6576 6f6b 650a 2020 2020 2020 2020 7265  evoke.        re
-00004bc0: 766f 6b65 2863 6f6e 6669 672c 2070 6c75  voke(config, plu
-00004bd0: 6769 6e73 290a 0a20 2020 2064 6566 205f  gins)..    def _
-00004be0: 6d6f 636b 5f73 6574 5f62 795f 636c 6928  mock_set_by_cli(
-00004bf0: 7365 6c66 2c20 6d6f 636b 6564 3a20 6d6f  self, mocked: mo
-00004c00: 636b 2e4d 6167 6963 4d6f 636b 2c20 6b65  ck.MagicMock, ke
-00004c10: 793a 2073 7472 2c20 7661 6c75 653a 2062  y: str, value: b
-00004c20: 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a 2020  ool) -> None:.  
-00004c30: 2020 2020 2020 6465 6620 7365 745f 6279        def set_by
-00004c40: 5f63 6c69 286b 3a20 7374 7229 202d 3e20  _cli(k: str) -> 
-00004c50: 626f 6f6c 3a0a 2020 2020 2020 2020 2020  bool:.          
-00004c60: 2020 6966 206b 6579 203d 3d20 6b3a 0a20    if key == k:. 
-00004c70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004c80: 6574 7572 6e20 7661 6c75 650a 2020 2020  eturn value.    
-00004c90: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00004ca0: 6f63 6b2e 4445 4641 554c 540a 2020 2020  ock.DEFAULT.    
-00004cb0: 2020 2020 6d6f 636b 6564 2e73 6964 655f      mocked.side_
-00004cc0: 6566 6665 6374 203d 2073 6574 5f62 795f  effect = set_by_
-00004cd0: 636c 690a 0a20 2020 2040 6d6f 636b 2e70  cli..    @mock.p
-00004ce0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00004cf0: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 6465  nternal.main._de
-00004d00: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
-00004d10: 6174 6527 290a 2020 2020 406d 6f63 6b2e  ate').    @mock.
-00004d20: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00004d30: 696e 7465 726e 616c 2e6d 6169 6e2e 636c  internal.main.cl
-00004d40: 6965 6e74 2e61 636d 655f 636c 6965 6e74  ient.acme_client
-00004d50: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
-00004d60: 7265 766f 6b65 5f77 6974 685f 7265 6173  revoke_with_reas
-00004d70: 6f6e 2873 656c 662c 206d 6f63 6b5f 6163  on(self, mock_ac
-00004d80: 6d65 5f63 6c69 656e 742c 0a20 2020 2020  me_client,.     
-00004d90: 2020 2020 2020 206d 6f63 6b5f 6465 6c65         mock_dele
-00004da0: 7465 5f69 665f 6170 7072 6f70 7269 6174  te_if_appropriat
-00004db0: 6529 3a0a 2020 2020 2020 2020 6d6f 636b  e):.        mock
-00004dc0: 5f64 656c 6574 655f 6966 5f61 7070 726f  _delete_if_appro
-00004dd0: 7072 6961 7465 2e72 6574 7572 6e5f 7661  priate.return_va
-00004de0: 6c75 6520 3d20 4661 6c73 650a 2020 2020  lue = False.    
-00004df0: 2020 2020 6d6f 636b 5f72 6576 6f6b 6520      mock_revoke 
-00004e00: 3d20 6d6f 636b 5f61 636d 655f 636c 6965  = mock_acme_clie
-00004e10: 6e74 2e43 6c69 656e 7456 3228 292e 7265  nt.ClientV2().re
-00004e20: 766f 6b65 0a20 2020 2020 2020 2065 7870  voke.        exp
-00004e30: 6563 7465 6420 3d20 5b5d 0a20 2020 2020  ected = [].     
-00004e40: 2020 2066 6f72 2072 6561 736f 6e2c 2063     for reason, c
-00004e50: 6f64 6520 696e 2063 6f6e 7374 616e 7473  ode in constants
-00004e60: 2e52 4556 4f43 4154 494f 4e5f 5245 4153  .REVOCATION_REAS
-00004e70: 4f4e 532e 6974 656d 7328 293a 0a20 2020  ONS.items():.   
-00004e80: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
-00004e90: 2772 6576 6f6b 6520 2d2d 6365 7274 2d70  'revoke --cert-p
-00004ea0: 6174 683d 7b30 7d20 2d2d 7265 6173 6f6e  ath={0} --reason
-00004eb0: 207b 317d 272e 666f 726d 6174 2873 656c   {1}'.format(sel
-00004ec0: 662e 746d 705f 6365 7274 5f70 6174 682c  f.tmp_cert_path,
-00004ed0: 2072 6561 736f 6e29 2e73 706c 6974 2829   reason).split()
-00004ee0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004ef0: 662e 5f63 616c 6c28 6172 6773 290a 2020  f._call(args).  
-00004f00: 2020 2020 2020 2020 2020 6578 7065 6374            expect
-00004f10: 6564 2e61 7070 656e 6428 6d6f 636b 2e63  ed.append(mock.c
-00004f20: 616c 6c28 6d6f 636b 2e41 4e59 2c20 636f  all(mock.ANY, co
-00004f30: 6465 2929 0a20 2020 2020 2020 2020 2020  de)).           
-00004f40: 2061 7267 7320 3d20 2772 6576 6f6b 6520   args = 'revoke 
-00004f50: 2d2d 6365 7274 2d70 6174 683d 7b30 7d20  --cert-path={0} 
-00004f60: 2d2d 7265 6173 6f6e 207b 317d 272e 666f  --reason {1}'.fo
-00004f70: 726d 6174 2873 656c 662e 746d 705f 6365  rmat(self.tmp_ce
-00004f80: 7274 5f70 6174 682c 0a20 2020 2020 2020  rt_path,.       
-00004f90: 2020 2020 2020 2020 2020 2020 2072 6561               rea
-00004fa0: 736f 6e2e 7570 7065 7228 2929 2e73 706c  son.upper()).spl
-00004fb0: 6974 2829 0a20 2020 2020 2020 2020 2020  it().           
-00004fc0: 2073 656c 662e 5f63 616c 6c28 6172 6773   self._call(args
-00004fd0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00004fe0: 7065 6374 6564 2e61 7070 656e 6428 6d6f  pected.append(mo
-00004ff0: 636b 2e63 616c 6c28 6d6f 636b 2e41 4e59  ck.call(mock.ANY
-00005000: 2c20 636f 6465 2929 0a20 2020 2020 2020  , code)).       
-00005010: 2061 7373 6572 7420 6578 7065 6374 6564   assert expected
-00005020: 203d 3d20 6d6f 636b 5f72 6576 6f6b 652e   == mock_revoke.
-00005030: 6361 6c6c 5f61 7267 735f 6c69 7374 0a0a  call_args_list..
-00005040: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-00005050: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00005060: 616c 2e6d 6169 6e2e 5f64 656c 6574 655f  al.main._delete_
-00005070: 6966 5f61 7070 726f 7072 6961 7465 2729  if_appropriate')
-00005080: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-00005090: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-000050a0: 6e61 6c2e 7374 6f72 6167 652e 5265 6e65  nal.storage.Rene
-000050b0: 7761 626c 6543 6572 7427 290a 2020 2020  wableCert').    
-000050c0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-000050d0: 7462 6f74 2e5f 696e 7465 726e 616c 2e73  tbot._internal.s
-000050e0: 746f 7261 6765 2e72 656e 6577 616c 5f66  torage.renewal_f
-000050f0: 696c 655f 666f 725f 6365 7274 6e61 6d65  ile_for_certname
-00005100: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-00005110: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-00005120: 6572 6e61 6c2e 636c 6965 6e74 2e61 636d  ernal.client.acm
-00005130: 655f 6672 6f6d 5f63 6f6e 6669 675f 6b65  e_from_config_ke
-00005140: 7927 290a 2020 2020 406d 6f63 6b2e 7061  y').    @mock.pa
-00005150: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00005160: 7465 726e 616c 2e63 6c69 2e73 6574 5f62  ternal.cli.set_b
-00005170: 795f 636c 6927 290a 2020 2020 6465 6620  y_cli').    def 
-00005180: 7465 7374 5f72 6576 6f6b 655f 6279 5f63  test_revoke_by_c
-00005190: 6572 746e 616d 6528 7365 6c66 2c20 6d6f  ertname(self, mo
-000051a0: 636b 5f73 6574 5f62 795f 636c 692c 206d  ck_set_by_cli, m
-000051b0: 6f63 6b5f 6163 6d65 5f66 726f 6d5f 636f  ock_acme_from_co
-000051c0: 6e66 6967 2c0a 2020 2020 2020 2020 2020  nfig,.          
-000051d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051e0: 2020 2020 2020 756e 7573 6564 5f6d 6f63        unused_moc
-000051f0: 6b5f 7265 6e65 7761 6c5f 6669 6c65 5f66  k_renewal_file_f
-00005200: 6f72 5f63 6572 746e 616d 652c 206d 6f63  or_certname, moc
-00005210: 6b5f 6365 7274 2c0a 2020 2020 2020 2020  k_cert,.        
-00005220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005230: 2020 2020 2020 2020 6d6f 636b 5f64 656c          mock_del
-00005240: 6574 655f 6966 5f61 7070 726f 7072 6961  ete_if_appropria
-00005250: 7465 293a 0a20 2020 2020 2020 2073 656c  te):.        sel
-00005260: 662e 5f6d 6f63 6b5f 7365 745f 6279 5f63  f._mock_set_by_c
-00005270: 6c69 286d 6f63 6b5f 7365 745f 6279 5f63  li(mock_set_by_c
-00005280: 6c69 2c20 2273 6572 7665 7222 2c20 4661  li, "server", Fa
-00005290: 6c73 6529 0a20 2020 2020 2020 206d 6f63  lse).        moc
-000052a0: 6b5f 6163 6d65 5f66 726f 6d5f 636f 6e66  k_acme_from_conf
-000052b0: 6967 2e72 6574 7572 6e5f 7661 6c75 6520  ig.return_value 
-000052c0: 3d20 7365 6c66 2e6d 6f63 6b5f 6163 6d65  = self.mock_acme
-000052d0: 5f63 6c69 656e 740a 2020 2020 2020 2020  _client.        
-000052e0: 6d6f 636b 5f63 6572 742e 7265 7475 726e  mock_cert.return
-000052f0: 5f76 616c 7565 203d 206d 6f63 6b2e 4d61  _value = mock.Ma
-00005300: 6769 634d 6f63 6b28 6365 7274 5f70 6174  gicMock(cert_pat
-00005310: 683d 7365 6c66 2e74 6d70 5f63 6572 745f  h=self.tmp_cert_
-00005320: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-00005330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005350: 2020 2020 2020 7365 7276 6572 3d22 6874        server="ht
-00005360: 7470 733a 2f2f 6163 6d65 2e65 7861 6d70  tps://acme.examp
-00005370: 6c65 2229 0a20 2020 2020 2020 2061 7267  le").        arg
-00005380: 7320 3d20 2772 6576 6f6b 6520 2d2d 6365  s = 'revoke --ce
-00005390: 7274 2d6e 616d 653d 6578 616d 706c 652e  rt-name=example.
-000053a0: 636f 6d27 2e73 706c 6974 2829 0a20 2020  com'.split().   
-000053b0: 2020 2020 206d 6f63 6b5f 6465 6c65 7465       mock_delete
-000053c0: 5f69 665f 6170 7072 6f70 7269 6174 652e  _if_appropriate.
-000053d0: 7265 7475 726e 5f76 616c 7565 203d 2046  return_value = F
-000053e0: 616c 7365 0a20 2020 2020 2020 2073 656c  alse.        sel
-000053f0: 662e 5f63 616c 6c28 6172 6773 290a 2020  f._call(args).  
-00005400: 2020 2020 2020 6173 7365 7274 206d 6f63        assert moc
-00005410: 6b5f 6163 6d65 5f66 726f 6d5f 636f 6e66  k_acme_from_conf
-00005420: 6967 2e63 616c 6c5f 6172 6773 5f6c 6973  ig.call_args_lis
-00005430: 745b 305d 5b30 5d5b 305d 2e73 6572 7665  t[0][0][0].serve
-00005440: 7220 3d3d 205c 0a20 2020 2020 2020 2020  r == \.         
-00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005460: 2768 7474 7073 3a2f 2f61 636d 652e 6578  'https://acme.ex
-00005470: 616d 706c 6527 0a20 2020 2020 2020 2073  ample'.        s
-00005480: 656c 662e 6d6f 636b 5f73 7563 6365 7373  elf.mock_success
-00005490: 5f72 6576 6f6b 652e 6173 7365 7274 5f63  _revoke.assert_c
-000054a0: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
-000054b0: 7365 6c66 2e74 6d70 5f63 6572 745f 7061  self.tmp_cert_pa
-000054c0: 7468 290a 0a20 2020 2040 6d6f 636b 2e70  th)..    @mock.p
-000054d0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000054e0: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 6465  nternal.main._de
-000054f0: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
-00005500: 6174 6527 290a 2020 2020 406d 6f63 6b2e  ate').    @mock.
-00005510: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00005520: 696e 7465 726e 616c 2e73 746f 7261 6765  internal.storage
-00005530: 2e52 656e 6577 6162 6c65 4365 7274 2729  .RenewableCert')
-00005540: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-00005550: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-00005560: 6e61 6c2e 7374 6f72 6167 652e 7265 6e65  nal.storage.rene
-00005570: 7761 6c5f 6669 6c65 5f66 6f72 5f63 6572  wal_file_for_cer
-00005580: 746e 616d 6527 290a 2020 2020 406d 6f63  tname').    @moc
-00005590: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-000055a0: 2e5f 696e 7465 726e 616c 2e63 6c69 656e  ._internal.clien
-000055b0: 742e 6163 6d65 5f66 726f 6d5f 636f 6e66  t.acme_from_conf
-000055c0: 6967 5f6b 6579 2729 0a20 2020 2040 6d6f  ig_key').    @mo
-000055d0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-000055e0: 742e 5f69 6e74 6572 6e61 6c2e 636c 692e  t._internal.cli.
-000055f0: 7365 745f 6279 5f63 6c69 2729 0a20 2020  set_by_cli').   
-00005600: 2064 6566 2074 6573 745f 7265 766f 6b65   def test_revoke
-00005610: 5f62 795f 6365 7274 6e61 6d65 5f61 6e64  _by_certname_and
-00005620: 5f73 6572 7665 7228 7365 6c66 2c20 6d6f  _server(self, mo
-00005630: 636b 5f73 6574 5f62 795f 636c 692c 206d  ck_set_by_cli, m
-00005640: 6f63 6b5f 6163 6d65 5f66 726f 6d5f 636f  ock_acme_from_co
-00005650: 6e66 6967 2c0a 2020 2020 2020 2020 2020  nfig,.          
-00005660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005680: 2075 6e75 7365 645f 6d6f 636b 5f72 656e   unused_mock_ren
-00005690: 6577 616c 5f66 696c 655f 666f 725f 6365  ewal_file_for_ce
-000056a0: 7274 6e61 6d65 2c20 6d6f 636b 5f63 6572  rtname, mock_cer
-000056b0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-000056c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056d0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000056e0: 636b 5f64 656c 6574 655f 6966 5f61 7070  ck_delete_if_app
-000056f0: 726f 7072 6961 7465 293a 0a20 2020 2020  ropriate):.     
-00005700: 2020 2022 2222 5265 766f 6b69 6e67 2077     """Revoking w
-00005710: 6974 6820 2d2d 7365 7276 6572 2073 686f  ith --server sho
-00005720: 756c 6420 7573 6520 7468 6520 7365 7276  uld use the serv
-00005730: 6572 2066 726f 6d20 7468 6520 434c 4922  er from the CLI"
-00005740: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00005750: 5f6d 6f63 6b5f 7365 745f 6279 5f63 6c69  _mock_set_by_cli
-00005760: 286d 6f63 6b5f 7365 745f 6279 5f63 6c69  (mock_set_by_cli
-00005770: 2c20 2273 6572 7665 7222 2c20 5472 7565  , "server", True
-00005780: 290a 2020 2020 2020 2020 6d6f 636b 5f63  ).        mock_c
-00005790: 6572 742e 7265 7475 726e 5f76 616c 7565  ert.return_value
-000057a0: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
-000057b0: 6b28 6365 7274 5f70 6174 683d 7365 6c66  k(cert_path=self
-000057c0: 2e74 6d70 5f63 6572 745f 7061 7468 2c0a  .tmp_cert_path,.
-000057d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005800: 7365 7276 6572 3d22 6874 7470 733a 2f2f  server="https://
-00005810: 6163 6d65 2e65 7861 6d70 6c65 2229 0a20  acme.example"). 
-00005820: 2020 2020 2020 2061 7267 7320 3d20 2772         args = 'r
-00005830: 6576 6f6b 6520 2d2d 6365 7274 2d6e 616d  evoke --cert-nam
-00005840: 653d 6578 616d 706c 652e 636f 6d20 2d2d  e=example.com --
-00005850: 7365 7276 6572 2068 7474 7073 3a2f 2f6f  server https://o
-00005860: 7468 6572 2e65 7861 6d70 6c65 272e 7370  ther.example'.sp
-00005870: 6c69 7428 290a 2020 2020 2020 2020 6d6f  lit().        mo
-00005880: 636b 5f64 656c 6574 655f 6966 5f61 7070  ck_delete_if_app
-00005890: 726f 7072 6961 7465 2e72 6574 7572 6e5f  ropriate.return_
-000058a0: 7661 6c75 6520 3d20 4661 6c73 650a 2020  value = False.  
-000058b0: 2020 2020 2020 7365 6c66 2e5f 6361 6c6c        self._call
-000058c0: 2861 7267 7329 0a20 2020 2020 2020 2061  (args).        a
-000058d0: 7373 6572 7420 6d6f 636b 5f61 636d 655f  ssert mock_acme_
-000058e0: 6672 6f6d 5f63 6f6e 6669 672e 6361 6c6c  from_config.call
-000058f0: 5f61 7267 735f 6c69 7374 5b30 5d5b 305d  _args_list[0][0]
-00005900: 5b30 5d2e 7365 7276 6572 203d 3d20 5c0a  [0].server == \.
-00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005920: 2020 2020 2020 2020 2027 6874 7470 733a           'https:
-00005930: 2f2f 6f74 6865 722e 6578 616d 706c 6527  //other.example'
-00005940: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-00005950: 636b 5f73 7563 6365 7373 5f72 6576 6f6b  ck_success_revok
-00005960: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
-00005970: 6f6e 6365 5f77 6974 6828 7365 6c66 2e74  once_with(self.t
-00005980: 6d70 5f63 6572 745f 7061 7468 290a 0a20  mp_cert_path).. 
-00005990: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-000059a0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-000059b0: 6c2e 6d61 696e 2e5f 6465 6c65 7465 5f69  l.main._delete_i
-000059c0: 665f 6170 7072 6f70 7269 6174 6527 290a  f_appropriate').
-000059d0: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-000059e0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-000059f0: 616c 2e73 746f 7261 6765 2e52 656e 6577  al.storage.Renew
-00005a00: 6162 6c65 4365 7274 2729 0a20 2020 2040  ableCert').    @
-00005a10: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00005a20: 626f 742e 5f69 6e74 6572 6e61 6c2e 7374  bot._internal.st
-00005a30: 6f72 6167 652e 7265 6e65 7761 6c5f 6669  orage.renewal_fi
-00005a40: 6c65 5f66 6f72 5f63 6572 746e 616d 6527  le_for_certname'
-00005a50: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
-00005a60: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-00005a70: 726e 616c 2e63 6c69 656e 742e 6163 6d65  rnal.client.acme
-00005a80: 5f66 726f 6d5f 636f 6e66 6967 5f6b 6579  _from_config_key
-00005a90: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-00005aa0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-00005ab0: 6572 6e61 6c2e 636c 692e 7365 745f 6279  ernal.cli.set_by
-00005ac0: 5f63 6c69 2729 0a20 2020 2064 6566 2074  _cli').    def t
-00005ad0: 6573 745f 7265 766f 6b65 5f62 795f 6365  est_revoke_by_ce
-00005ae0: 7274 6e61 6d65 5f65 6d70 7479 5f73 6572  rtname_empty_ser
-00005af0: 7665 7228 7365 6c66 2c20 6d6f 636b 5f73  ver(self, mock_s
-00005b00: 6574 5f62 795f 636c 692c 206d 6f63 6b5f  et_by_cli, mock_
-00005b10: 6163 6d65 5f66 726f 6d5f 636f 6e66 6967  acme_from_config
-00005b20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00005b50: 6e75 7365 645f 6d6f 636b 5f72 656e 6577  nused_mock_renew
-00005b60: 616c 5f66 696c 655f 666f 725f 6365 7274  al_file_for_cert
-00005b70: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00005b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ba0: 2020 206d 6f63 6b5f 6365 7274 2c20 6d6f     mock_cert, mo
-00005bb0: 636b 5f64 656c 6574 655f 6966 5f61 7070  ck_delete_if_app
-00005bc0: 726f 7072 6961 7465 293a 0a20 2020 2020  ropriate):.     
-00005bd0: 2020 2022 2222 5265 766f 6b69 6e67 2077     """Revoking w
-00005be0: 6974 6820 2d2d 6365 7274 2d6e 616d 6520  ith --cert-name 
-00005bf0: 7768 6572 6520 7468 6520 6c69 6e65 6167  where the lineag
-00005c00: 6520 7365 7276 6572 2069 7320 656d 7074  e server is empt
-00005c10: 7920 7368 6f75 6c64 6e27 7420 6372 6173  y shouldn't cras
-00005c20: 6820 2222 220a 2020 2020 2020 2020 6d6f  h """.        mo
-00005c30: 636b 5f63 6572 742e 7265 7475 726e 5f76  ck_cert.return_v
-00005c40: 616c 7565 203d 206d 6f63 6b2e 4d61 6769  alue = mock.Magi
-00005c50: 634d 6f63 6b28 6365 7274 5f70 6174 683d  cMock(cert_path=
-00005c60: 7365 6c66 2e74 6d70 5f63 6572 745f 7061  self.tmp_cert_pa
-00005c70: 7468 2c20 7365 7276 6572 3d4e 6f6e 6529  th, server=None)
-00005c80: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
-00005c90: 2772 6576 6f6b 6520 2d2d 6365 7274 2d6e  'revoke --cert-n
-00005ca0: 616d 653d 6578 616d 706c 652e 636f 6d27  ame=example.com'
-00005cb0: 2e73 706c 6974 2829 0a20 2020 2020 2020  .split().       
-00005cc0: 206d 6f63 6b5f 6465 6c65 7465 5f69 665f   mock_delete_if_
-00005cd0: 6170 7072 6f70 7269 6174 652e 7265 7475  appropriate.retu
-00005ce0: 726e 5f76 616c 7565 203d 2046 616c 7365  rn_value = False
-00005cf0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00005d00: 616c 6c28 6172 6773 290a 2020 2020 2020  all(args).      
-00005d10: 2020 6173 7365 7274 206d 6f63 6b5f 6163    assert mock_ac
-00005d20: 6d65 5f66 726f 6d5f 636f 6e66 6967 2e63  me_from_config.c
-00005d30: 616c 6c5f 6172 6773 5f6c 6973 745b 305d  all_args_list[0]
-00005d40: 5b30 5d5b 305d 2e73 6572 7665 7220 3d3d  [0][0].server ==
-00005d50: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00005d60: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
-00005d70: 7461 6e74 732e 434c 495f 4445 4641 554c  tants.CLI_DEFAUL
-00005d80: 5453 5b27 7365 7276 6572 275d 0a20 2020  TS['server'].   
-00005d90: 2020 2020 2073 656c 662e 6d6f 636b 5f73       self.mock_s
-00005da0: 7563 6365 7373 5f72 6576 6f6b 652e 6173  uccess_revoke.as
-00005db0: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
-00005dc0: 5f77 6974 6828 7365 6c66 2e74 6d70 5f63  _with(self.tmp_c
-00005dd0: 6572 745f 7061 7468 290a 0a20 2020 2040  ert_path)..    @
-00005de0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00005df0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-00005e00: 696e 2e5f 6465 6c65 7465 5f69 665f 6170  in._delete_if_ap
-00005e10: 7072 6f70 7269 6174 6527 290a 2020 2020  propriate').    
-00005e20: 6465 6620 7465 7374 5f72 6576 6f63 6174  def test_revocat
-00005e30: 696f 6e5f 7375 6363 6573 7328 7365 6c66  ion_success(self
-00005e40: 2c20 6d6f 636b 5f64 656c 6574 655f 6966  , mock_delete_if
-00005e50: 5f61 7070 726f 7072 6961 7465 293a 0a20  _appropriate):. 
-00005e60: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
-00005e70: 6c28 290a 2020 2020 2020 2020 6d6f 636b  l().        mock
-00005e80: 5f64 656c 6574 655f 6966 5f61 7070 726f  _delete_if_appro
-00005e90: 7072 6961 7465 2e72 6574 7572 6e5f 7661  priate.return_va
-00005ea0: 6c75 6520 3d20 4661 6c73 650a 2020 2020  lue = False.    
-00005eb0: 2020 2020 7365 6c66 2e6d 6f63 6b5f 7375      self.mock_su
-00005ec0: 6363 6573 735f 7265 766f 6b65 2e61 7373  ccess_revoke.ass
-00005ed0: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
-00005ee0: 7769 7468 2873 656c 662e 746d 705f 6365  with(self.tmp_ce
-00005ef0: 7274 5f70 6174 6829 0a0a 2020 2020 6465  rt_path)..    de
-00005f00: 6620 7465 7374 5f72 6576 6f63 6174 696f  f test_revocatio
-00005f10: 6e5f 6572 726f 7228 7365 6c66 293a 0a20  n_error(self):. 
-00005f20: 2020 2020 2020 2066 726f 6d20 6163 6d65         from acme
-00005f30: 2069 6d70 6f72 7420 6572 726f 7273 2061   import errors a
-00005f40: 7320 6163 6d65 5f65 7272 6f72 730a 2020  s acme_errors.  
-00005f50: 2020 2020 2020 7365 6c66 2e6d 6f63 6b5f        self.mock_
-00005f60: 6163 6d65 5f63 6c69 656e 742e 7369 6465  acme_client.side
-00005f70: 5f65 6666 6563 7420 3d20 6163 6d65 5f65  _effect = acme_e
-00005f80: 7272 6f72 732e 436c 6965 6e74 4572 726f  rrors.ClientErro
-00005f90: 7228 290a 2020 2020 2020 2020 7769 7468  r().        with
-00005fa0: 2070 7974 6573 742e 7261 6973 6573 2861   pytest.raises(a
-00005fb0: 636d 655f 6572 726f 7273 2e43 6c69 656e  cme_errors.Clien
-00005fc0: 7445 7272 6f72 293a 0a20 2020 2020 2020  tError):.       
-00005fd0: 2020 2020 2073 656c 662e 5f63 616c 6c28       self._call(
-00005fe0: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
-00005ff0: 6f63 6b5f 7375 6363 6573 735f 7265 766f  ock_success_revo
-00006000: 6b65 2e61 7373 6572 745f 6e6f 745f 6361  ke.assert_not_ca
-00006010: 6c6c 6564 2829 0a0a 2020 2020 406d 6f63  lled()..    @moc
-00006020: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00006030: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00006040: 5f64 656c 6574 655f 6966 5f61 7070 726f  _delete_if_appro
-00006050: 7072 6961 7465 2729 0a20 2020 2040 6d6f  priate').    @mo
-00006060: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00006070: 742e 5f69 6e74 6572 6e61 6c2e 6365 7274  t._internal.cert
-00006080: 5f6d 616e 6167 6572 2e64 656c 6574 6527  _manager.delete'
-00006090: 290a 2020 2020 4074 6573 745f 7574 696c  ).    @test_util
-000060a0: 2e70 6174 6368 5f64 6973 706c 6179 5f75  .patch_display_u
-000060b0: 7469 6c28 290a 2020 2020 6465 6620 7465  til().    def te
-000060c0: 7374 5f72 6576 6f63 6174 696f 6e5f 7769  st_revocation_wi
-000060d0: 7468 5f70 726f 6d70 7428 7365 6c66 2c20  th_prompt(self, 
-000060e0: 6d6f 636b 5f67 6574 5f75 7469 6c69 7479  mock_get_utility
-000060f0: 2c0a 2020 2020 2020 2020 2020 2020 6d6f  ,.            mo
-00006100: 636b 5f64 656c 6574 652c 206d 6f63 6b5f  ck_delete, mock_
-00006110: 6465 6c65 7465 5f69 665f 6170 7072 6f70  delete_if_approp
-00006120: 7269 6174 6529 3a0a 2020 2020 2020 2020  riate):.        
-00006130: 6d6f 636b 5f67 6574 5f75 7469 6c69 7479  mock_get_utility
-00006140: 2829 2e79 6573 6e6f 2e72 6574 7572 6e5f  ().yesno.return_
-00006150: 7661 6c75 6520 3d20 4661 6c73 650a 2020  value = False.  
-00006160: 2020 2020 2020 6d6f 636b 5f64 656c 6574        mock_delet
-00006170: 655f 6966 5f61 7070 726f 7072 6961 7465  e_if_appropriate
-00006180: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00006190: 4661 6c73 650a 2020 2020 2020 2020 7365  False.        se
-000061a0: 6c66 2e5f 6361 6c6c 2829 0a20 2020 2020  lf._call().     
-000061b0: 2020 2061 7373 6572 7420 6d6f 636b 5f64     assert mock_d
-000061c0: 656c 6574 652e 6361 6c6c 6564 2069 7320  elete.called is 
-000061d0: 4661 6c73 650a 0a0a 636c 6173 7320 5265  False...class Re
-000061e0: 636f 6e66 6967 7572 6554 6573 7428 7465  configureTest(te
-000061f0: 7374 5f75 7469 6c2e 5465 6d70 4469 7254  st_util.TempDirT
-00006200: 6573 7443 6173 6529 3a0a 2020 2020 2222  estCase):.    ""
-00006210: 2254 6573 7473 2066 6f72 2063 6572 7462  "Tests for certb
-00006220: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00006230: 6e2e 7265 636f 6e66 6967 7572 6522 2222  n.reconfigure"""
-00006240: 0a0a 2020 2020 6465 6620 7365 7455 7028  ..    def setUp(
-00006250: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-00006260: 7570 6572 2829 2e73 6574 5570 2829 0a20  uper().setUp(). 
-00006270: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-00006280: 7574 696c 6974 795f 7061 7463 6820 3d20  utility_patch = 
-00006290: 7465 7374 5f75 7469 6c2e 7061 7463 685f  test_util.patch_
-000062a0: 6469 7370 6c61 795f 7574 696c 2829 0a20  display_util(). 
-000062b0: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
-000062c0: 5f67 6574 5f75 7469 6c69 7479 203d 2073  _get_utility = s
-000062d0: 656c 662e 6765 745f 7574 696c 6974 795f  elf.get_utility_
-000062e0: 7061 7463 682e 7374 6172 7428 290a 2020  patch.start().  
-000062f0: 2020 2020 2020 7365 6c66 2e70 6174 6368        self.patch
-00006300: 6572 7320 3d20 7b0a 2020 2020 2020 2020  ers = {.        
-00006310: 2020 2020 2763 6865 636b 5f73 796d 6c69      'check_symli
-00006320: 6e6b 7327 3a20 6d6f 636b 2e70 6174 6368  nks': mock.patch
-00006330: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-00006340: 6e61 6c2e 7374 6f72 6167 652e 5265 6e65  nal.storage.Rene
-00006350: 7761 626c 6543 6572 742e 5f63 6865 636b  wableCert._check
-00006360: 5f73 796d 6c69 6e6b 7327 292c 0a20 2020  _symlinks'),.   
-00006370: 2020 2020 2020 2020 2027 6365 7274 5f6e           'cert_n
-00006380: 616d 6573 273a 206d 6f63 6b2e 7061 7463  ames': mock.patc
-00006390: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-000063a0: 726e 616c 2e73 746f 7261 6765 2e52 656e  rnal.storage.Ren
-000063b0: 6577 6162 6c65 4365 7274 2e6e 616d 6573  ewableCert.names
-000063c0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-000063d0: 2770 6963 6b5f 696e 7374 616c 6c65 7227  'pick_installer'
-000063e0: 3a20 6d6f 636b 2e70 6174 6368 2827 6365  : mock.patch('ce
-000063f0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-00006400: 706c 7567 696e 732e 7365 6c65 6374 696f  plugins.selectio
-00006410: 6e2e 7069 636b 5f69 6e73 7461 6c6c 6572  n.pick_installer
-00006420: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00006430: 2770 6963 6b5f 6175 7468 273a 206d 6f63  'pick_auth': moc
-00006440: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00006450: 2e5f 696e 7465 726e 616c 2e70 6c75 6769  ._internal.plugi
-00006460: 6e73 2e73 656c 6563 7469 6f6e 2e70 6963  ns.selection.pic
-00006470: 6b5f 6175 7468 656e 7469 6361 746f 7227  k_authenticator'
-00006480: 292c 0a20 2020 2020 2020 2020 2020 2027  ),.            '
-00006490: 6669 6e64 5f69 6e69 7427 3a20 6d6f 636b  find_init': mock
-000064a0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-000064b0: 5f69 6e74 6572 6e61 6c2e 706c 7567 696e  _internal.plugin
-000064c0: 732e 6469 7363 6f2e 506c 7567 696e 7352  s.disco.PluginsR
-000064d0: 6567 6973 7472 792e 6669 6e64 5f69 6e69  egistry.find_ini
-000064e0: 7427 292c 0a20 2020 2020 2020 2020 2020  t'),.           
-000064f0: 2027 5f67 6574 5f61 6e64 5f73 6176 655f   '_get_and_save_
-00006500: 6365 7274 273a 206d 6f63 6b2e 7061 7463  cert': mock.patc
-00006510: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-00006520: 726e 616c 2e6d 6169 6e2e 5f67 6574 5f61  rnal.main._get_a
-00006530: 6e64 5f73 6176 655f 6365 7274 2729 2c0a  nd_save_cert'),.
-00006540: 2020 2020 2020 2020 2020 2020 275f 696e              '_in
-00006550: 6974 5f6c 655f 636c 6965 6e74 273a 206d  it_le_client': m
-00006560: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00006570: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00006580: 6e2e 5f69 6e69 745f 6c65 5f63 6c69 656e  n._init_le_clien
-00006590: 7427 292c 0a20 2020 2020 2020 2020 2020  t'),.           
-000065a0: 2027 6c69 7374 5f68 6f6f 6b73 273a 206d   'list_hooks': m
-000065b0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-000065c0: 6f74 2e5f 696e 7465 726e 616c 2e68 6f6f  ot._internal.hoo
-000065d0: 6b73 2e6c 6973 745f 686f 6f6b 7327 292c  ks.list_hooks'),
-000065e0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-000065f0: 2020 2073 656c 662e 6d6f 636b 7320 3d20     self.mocks = 
-00006600: 7b6b 3a20 762e 7374 6172 7428 2920 666f  {k: v.start() fo
-00006610: 7220 6b2c 2076 2069 6e20 7365 6c66 2e70  r k, v in self.p
-00006620: 6174 6368 6572 732e 6974 656d 7328 297d  atchers.items()}
-00006630: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-00006640: 636b 735b 2763 6572 745f 6e61 6d65 7327  cks['cert_names'
-00006650: 5d2e 7265 7475 726e 5f76 616c 7565 203d  ].return_value =
-00006660: 205b 2765 7861 6d70 6c65 2e63 6f6d 275d   ['example.com']
-00006670: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00006680: 6f6e 6669 675f 6469 7220 3d20 6f73 2e70  onfig_dir = os.p
-00006690: 6174 682e 6a6f 696e 2873 656c 662e 7465  ath.join(self.te
-000066a0: 6d70 6469 722c 2027 636f 6e66 6967 2729  mpdir, 'config')
-000066b0: 0a20 2020 2020 2020 2072 656e 6577 616c  .        renewal
-000066c0: 5f63 6f6e 6669 6773 5f64 6972 203d 206f  _configs_dir = o
-000066d0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-000066e0: 2e63 6f6e 6669 675f 6469 722c 2027 7265  .config_dir, 're
-000066f0: 6e65 7761 6c27 290a 2020 2020 2020 2020  newal').        
-00006700: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
-00006710: 7869 7374 7328 7265 6e65 7761 6c5f 636f  xists(renewal_co
-00006720: 6e66 6967 735f 6469 7229 3a0a 2020 2020  nfigs_dir):.    
-00006730: 2020 2020 2020 2020 6669 6c65 7379 7374          filesyst
-00006740: 656d 2e6d 616b 6564 6972 7328 7265 6e65  em.makedirs(rene
-00006750: 7761 6c5f 636f 6e66 6967 735f 6469 7229  wal_configs_dir)
-00006760: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
-00006770: 6e65 7761 6c5f 6669 6c65 203d 206f 732e  newal_file = os.
-00006780: 7061 7468 2e6a 6f69 6e28 7265 6e65 7761  path.join(renewa
-00006790: 6c5f 636f 6e66 6967 735f 6469 722c 2027  l_configs_dir, '
-000067a0: 6578 616d 706c 652e 636f 6d2e 636f 6e66  example.com.conf
-000067b0: 2729 0a20 2020 2020 2020 206f 7269 6769  ').        origi
-000067c0: 6e61 6c5f 636f 6e66 6967 203d 2022 2222  nal_config = """
-000067d0: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
-000067e0: 7369 6f6e 203d 2031 2e33 322e 300a 2020  sion = 1.32.0.  
-000067f0: 2020 2020 2020 2020 2020 6172 6368 6976            archiv
-00006800: 655f 6469 7220 3d20 2f65 7463 2f6c 6574  e_dir = /etc/let
-00006810: 7365 6e63 7279 7074 2f61 7263 6869 7665  sencrypt/archive
-00006820: 2f65 7861 6d70 6c65 2e63 6f6d 0a20 2020  /example.com.   
-00006830: 2020 2020 2020 2020 2063 6572 7420 3d20           cert = 
-00006840: 2f65 7463 2f6c 6574 7365 6e63 7279 7074  /etc/letsencrypt
-00006850: 2f6c 6976 652f 6578 616d 706c 652e 636f  /live/example.co
-00006860: 6d2f 6365 7274 2e70 656d 0a20 2020 2020  m/cert.pem.     
-00006870: 2020 2020 2020 2070 7269 766b 6579 203d         privkey =
-00006880: 202f 6574 632f 6c65 7473 656e 6372 7970   /etc/letsencryp
-00006890: 742f 6c69 7665 2f65 7861 6d70 6c65 2e63  t/live/example.c
-000068a0: 6f6d 2f70 7269 766b 6579 2e70 656d 0a20  om/privkey.pem. 
-000068b0: 2020 2020 2020 2020 2020 2063 6861 696e             chain
-000068c0: 203d 202f 6574 632f 6c65 7473 656e 6372   = /etc/letsencr
-000068d0: 7970 742f 6c69 7665 2f65 7861 6d70 6c65  ypt/live/example
-000068e0: 2e63 6f6d 2f63 6861 696e 2e70 656d 0a20  .com/chain.pem. 
-000068f0: 2020 2020 2020 2020 2020 2066 756c 6c63             fullc
-00006900: 6861 696e 203d 202f 6574 632f 6c65 7473  hain = /etc/lets
-00006910: 656e 6372 7970 742f 6c69 7665 2f65 7861  encrypt/live/exa
-00006920: 6d70 6c65 2e63 6f6d 2f66 756c 6c63 6861  mple.com/fullcha
-00006930: 696e 2e70 656d 0a0a 2020 2020 2020 2020  in.pem..        
-00006940: 2020 2020 2320 4f70 7469 6f6e 7320 7573      # Options us
-00006950: 6564 2069 6e20 7468 6520 7265 6e65 7761  ed in the renewa
-00006960: 6c20 7072 6f63 6573 730a 2020 2020 2020  l process.      
-00006970: 2020 2020 2020 5b72 656e 6577 616c 7061        [renewalpa
-00006980: 7261 6d73 5d0a 2020 2020 2020 2020 2020  rams].          
-00006990: 2020 6163 636f 756e 7420 3d20 6565 3433    account = ee43
-000069a0: 3633 3464 6230 6161 3465 3638 3034 6631  634db0aa4e6804f1
-000069b0: 3532 6265 3339 3939 3065 3661 0a20 2020  52be39990e6a.   
-000069c0: 2020 2020 2020 2020 2073 6572 7665 7220           server 
-000069d0: 3d20 6874 7470 733a 2f2f 6163 6d65 2d73  = https://acme-s
-000069e0: 7461 6769 6e67 2d76 3032 2e61 7069 2e6c  taging-v02.api.l
-000069f0: 6574 7365 6e63 7279 7074 2e6f 7267 2f64  etsencrypt.org/d
-00006a00: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
-00006a10: 2020 2020 2061 7574 6865 6e74 6963 6174       authenticat
-00006a20: 6f72 203d 206e 6769 6e78 0a20 2020 2020  or = nginx.     
-00006a30: 2020 2020 2020 2069 6e73 7461 6c6c 6572         installer
-00006a40: 203d 206e 6769 6e78 0a20 2020 2020 2020   = nginx.       
-00006a50: 2020 2020 206b 6579 5f74 7970 6520 3d20       key_type = 
-00006a60: 7273 610a 2020 2020 2020 2020 2222 220a  rsa.        """.
-00006a70: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00006a80: 6e28 7365 6c66 2e72 656e 6577 616c 5f66  n(self.renewal_f
-00006a90: 696c 652c 2027 7727 2920 6173 2066 3a0a  ile, 'w') as f:.
-00006aa0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-00006ab0: 6974 6528 6f72 6967 696e 616c 5f63 6f6e  ite(original_con
-00006ac0: 6669 6729 0a20 2020 2020 2020 2077 6974  fig).        wit
-00006ad0: 6820 6f70 656e 2873 656c 662e 7265 6e65  h open(self.rene
-00006ae0: 7761 6c5f 6669 6c65 2c20 2772 2729 2061  wal_file, 'r') a
-00006af0: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
-00006b00: 2073 656c 662e 6f72 6967 696e 616c 5f63   self.original_c
-00006b10: 6f6e 6669 6720 3d20 636f 6e66 6967 6f62  onfig = configob
-00006b20: 6a2e 436f 6e66 6967 4f62 6a28 662c 0a20  j.ConfigObj(f,. 
-00006b30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00006b40: 6e63 6f64 696e 673d 2775 7466 2d38 272c  ncoding='utf-8',
-00006b50: 2064 6566 6175 6c74 5f65 6e63 6f64 696e   default_encodin
-00006b60: 673d 2775 7466 2d38 2729 0a0a 0a20 2020  g='utf-8')...   
-00006b70: 2064 6566 2074 6561 7244 6f77 6e28 7365   def tearDown(se
-00006b80: 6c66 293a 0a20 2020 2020 2020 2073 7570  lf):.        sup
-00006b90: 6572 2829 2e74 6561 7244 6f77 6e28 290a  er().tearDown().
-00006ba0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00006bb0: 5f75 7469 6c69 7479 5f70 6174 6368 2e73  _utility_patch.s
-00006bc0: 746f 7028 290a 2020 2020 2020 2020 666f  top().        fo
-00006bd0: 7220 7061 7463 6820 696e 2073 656c 662e  r patch in self.
-00006be0: 7061 7463 6865 7273 2e76 616c 7565 7328  patchers.values(
-00006bf0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00006c00: 6174 6368 2e73 746f 7028 290a 0a20 2020  atch.stop()..   
-00006c10: 2064 6566 205f 6361 6c6c 2873 656c 662c   def _call(self,
-00006c20: 2070 6173 7365 645f 6172 6773 293a 0a20   passed_args):. 
-00006c30: 2020 2020 2020 2066 756c 6c5f 6172 6773         full_args
-00006c40: 203d 2070 6173 7365 645f 6172 6773 202b   = passed_args +
-00006c50: 205b 272d 2d63 6f6e 6669 672d 6469 7227   ['--config-dir'
-00006c60: 2c20 7365 6c66 2e63 6f6e 6669 675f 6469  , self.config_di
-00006c70: 725d 0a20 2020 2020 2020 2070 6c75 6769  r].        plugi
-00006c80: 6e73 203d 2064 6973 636f 2e50 6c75 6769  ns = disco.Plugi
-00006c90: 6e73 5265 6769 7374 7279 2e66 696e 645f  nsRegistry.find_
-00006ca0: 616c 6c28 290a 2020 2020 2020 2020 636f  all().        co
-00006cb0: 6e66 6967 203d 2063 6f6e 6669 6775 7261  nfig = configura
-00006cc0: 7469 6f6e 2e4e 616d 6573 7061 6365 436f  tion.NamespaceCo
-00006cd0: 6e66 6967 280a 2020 2020 2020 2020 2020  nfig(.          
-00006ce0: 2020 636c 692e 7072 6570 6172 655f 616e    cli.prepare_an
-00006cf0: 645f 7061 7273 655f 6172 6773 2870 6c75  d_parse_args(plu
-00006d00: 6769 6e73 2c20 6675 6c6c 5f61 7267 7329  gins, full_args)
-00006d10: 290a 0a20 2020 2020 2020 2066 726f 6d20  )..        from 
-00006d20: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00006d30: 6c2e 6d61 696e 2069 6d70 6f72 7420 7265  l.main import re
-00006d40: 636f 6e66 6967 7572 650a 2020 2020 2020  configure.      
-00006d50: 2020 7265 636f 6e66 6967 7572 6528 636f    reconfigure(co
-00006d60: 6e66 6967 2c20 706c 7567 696e 7329 0a0a  nfig, plugins)..
-00006d70: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00006d80: 6e28 7365 6c66 2e72 656e 6577 616c 5f66  n(self.renewal_f
-00006d90: 696c 652c 2027 7227 2920 6173 2066 3a0a  ile, 'r') as f:.
-00006da0: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-00006db0: 7465 645f 636f 6e66 203d 2063 6f6e 6669  ted_conf = confi
-00006dc0: 676f 626a 2e43 6f6e 6669 674f 626a 2866  gobj.ConfigObj(f
-00006dd0: 2c20 656e 636f 6469 6e67 3d27 7574 662d  , encoding='utf-
-00006de0: 3827 2c20 6465 6661 756c 745f 656e 636f  8', default_enco
-00006df0: 6469 6e67 3d27 7574 662d 3827 290a 0a20  ding='utf-8').. 
-00006e00: 2020 2020 2020 2072 6574 7572 6e20 7570         return up
-00006e10: 6461 7465 645f 636f 6e66 0a0a 2020 2020  dated_conf..    
-00006e20: 6465 6620 7465 7374 5f64 6f6d 6169 6e73  def test_domains
-00006e30: 5f73 6574 2873 656c 6629 3a0a 2020 2020  _set(self):.    
-00006e40: 2020 2020 7769 7468 2070 7974 6573 742e      with pytest.
-00006e50: 7261 6973 6573 2865 7272 6f72 732e 436f  raises(errors.Co
-00006e60: 6e66 6967 7572 6174 696f 6e45 7272 6f72  nfigurationError
-00006e70: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00006e80: 656c 662e 5f63 616c 6c28 272d 2d63 6572  elf._call('--cer
-00006e90: 742d 6e61 6d65 2063 6572 7431 202d 6420  t-name cert1 -d 
-00006ea0: 6f6e 652e 6365 7274 2e63 6f6d 272e 7370  one.cert.com'.sp
-00006eb0: 6c69 7428 2929 0a0a 2020 2020 406d 6f63  lit())..    @moc
-00006ec0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00006ed0: 2e5f 696e 7465 726e 616c 2e63 6572 745f  ._internal.cert_
-00006ee0: 6d61 6e61 6765 722e 6765 745f 6365 7274  manager.get_cert
-00006ef0: 6e61 6d65 7327 290a 2020 2020 6465 6620  names').    def 
-00006f00: 7465 7374 5f61 736b 735f 666f 725f 6365  test_asks_for_ce
-00006f10: 7274 6e61 6d65 2873 656c 662c 206d 6f63  rtname(self, moc
-00006f20: 6b5f 6365 7274 5f6d 616e 6167 6572 293a  k_cert_manager):
-00006f30: 0a20 2020 2020 2020 206d 6f63 6b5f 6365  .        mock_ce
-00006f40: 7274 5f6d 616e 6167 6572 2e72 6574 7572  rt_manager.retur
-00006f50: 6e5f 7661 6c75 6520 3d20 5b27 6578 616d  n_value = ['exam
-00006f60: 706c 652e 636f 6d27 5d0a 2020 2020 2020  ple.com'].      
-00006f70: 2020 7365 6c66 2e5f 6361 6c6c 2827 2d2d    self._call('--
-00006f80: 6e67 696e 7827 2e73 706c 6974 2829 290a  nginx'.split()).
-00006f90: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-00006fa0: 6f63 6b5f 6365 7274 5f6d 616e 6167 6572  ock_cert_manager
-00006fb0: 2e63 616c 6c5f 636f 756e 7420 3d3d 2031  .call_count == 1
-00006fc0: 0a0a 2020 2020 6465 6620 7465 7374 5f75  ..    def test_u
-00006fd0: 7064 6174 655f 636f 6e66 6967 7572 6174  pdate_configurat
-00006fe0: 6f72 2873 656c 6629 3a0a 2020 2020 2020  or(self):.      
-00006ff0: 2020 6e61 6d65 645f 6d6f 636b 203d 206d    named_mock = m
-00007000: 6f63 6b2e 4d6f 636b 2829 0a20 2020 2020  ock.Mock().     
-00007010: 2020 206e 616d 6564 5f6d 6f63 6b2e 6e61     named_mock.na
-00007020: 6d65 203d 2027 6170 6163 6865 270a 0a20  me = 'apache'.. 
-00007030: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
-00007040: 735b 2770 6963 6b5f 696e 7374 616c 6c65  s['pick_installe
-00007050: 7227 5d2e 7265 7475 726e 5f76 616c 7565  r'].return_value
-00007060: 203d 206e 616d 6564 5f6d 6f63 6b0a 2020   = named_mock.  
-00007070: 2020 2020 2020 7365 6c66 2e6d 6f63 6b73        self.mocks
-00007080: 5b27 7069 636b 5f61 7574 6827 5d2e 7265  ['pick_auth'].re
-00007090: 7475 726e 5f76 616c 7565 203d 206e 616d  turn_value = nam
-000070a0: 6564 5f6d 6f63 6b0a 2020 2020 2020 2020  ed_mock.        
-000070b0: 7365 6c66 2e6d 6f63 6b73 5b27 6669 6e64  self.mocks['find
-000070c0: 5f69 6e69 7427 5d2e 7265 7475 726e 5f76  _init'].return_v
-000070d0: 616c 7565 203d 206e 616d 6564 5f6d 6f63  alue = named_moc
-000070e0: 6b0a 0a20 2020 2020 2020 206e 6577 5f63  k..        new_c
-000070f0: 6f6e 6669 6720 3d20 7365 6c66 2e5f 6361  onfig = self._ca
-00007100: 6c6c 2827 2d2d 6365 7274 2d6e 616d 6520  ll('--cert-name 
-00007110: 6578 616d 706c 652e 636f 6d20 2d2d 6170  example.com --ap
-00007120: 6163 6865 272e 7370 6c69 7428 2929 0a20  ache'.split()). 
-00007130: 2020 2020 2020 2061 7373 6572 7420 6e65         assert ne
-00007140: 775f 636f 6e66 6967 5b27 7265 6e65 7761  w_config['renewa
-00007150: 6c70 6172 616d 7327 5d5b 2761 7574 6865  lparams']['authe
-00007160: 6e74 6963 6174 6f72 275d 203d 3d20 2761  nticator'] == 'a
-00007170: 7061 6368 6527 0a0a 2020 2020 406d 6f63  pache'..    @moc
-00007180: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00007190: 2e5f 696e 7465 726e 616c 2e68 6f6f 6b73  ._internal.hooks
-000071a0: 2e76 616c 6964 6174 655f 686f 6f6b 7327  .validate_hooks'
-000071b0: 290a 2020 2020 6465 6620 7465 7374 5f75  ).    def test_u
-000071c0: 7064 6174 655f 686f 6f6b 7328 7365 6c66  pdate_hooks(self
-000071d0: 2c20 756e 7573 6564 5f76 616c 6964 6174  , unused_validat
-000071e0: 655f 686f 6f6b 7329 3a0a 2020 2020 2020  e_hooks):.      
-000071f0: 2020 6173 7365 7274 2027 7072 655f 686f    assert 'pre_ho
-00007200: 6f6b 2720 6e6f 7420 696e 2073 656c 662e  ok' not in self.
-00007210: 6f72 6967 696e 616c 5f63 6f6e 6669 670a  original_config.
-00007220: 2020 2020 2020 2020 2320 7465 7374 2073          # test s
-00007230: 6574 0a20 2020 2020 2020 206e 6577 5f63  et.        new_c
-00007240: 6f6e 6669 6720 3d20 7365 6c66 2e5f 6361  onfig = self._ca
-00007250: 6c6c 2827 2d2d 6365 7274 2d6e 616d 6520  ll('--cert-name 
-00007260: 6578 616d 706c 652e 636f 6d20 2d2d 7072  example.com --pr
-00007270: 652d 686f 6f6b 272e 7370 6c69 7428 2920  e-hook'.split() 
-00007280: 2b20 5b27 6563 686f 2070 7265 275d 290a  + ['echo pre']).
-00007290: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
-000072a0: 6577 5f63 6f6e 6669 675b 2772 656e 6577  ew_config['renew
-000072b0: 616c 7061 7261 6d73 275d 5b27 7072 655f  alparams']['pre_
-000072c0: 686f 6f6b 275d 203d 3d20 2765 6368 6f20  hook'] == 'echo 
-000072d0: 7072 6527 0a20 2020 2020 2020 2023 2074  pre'.        # t
-000072e0: 6573 7420 7570 6461 7465 0a20 2020 2020  est update.     
-000072f0: 2020 206e 6577 5f63 6f6e 6669 6720 3d20     new_config = 
-00007300: 7365 6c66 2e5f 6361 6c6c 2827 2d2d 6365  self._call('--ce
-00007310: 7274 2d6e 616d 6520 6578 616d 706c 652e  rt-name example.
-00007320: 636f 6d20 2d2d 7072 652d 686f 6f6b 272e  com --pre-hook'.
-00007330: 7370 6c69 7428 2920 2b20 5b27 6563 686f  split() + ['echo
-00007340: 2070 7265 3227 5d29 0a20 2020 2020 2020   pre2']).       
-00007350: 2061 7373 6572 7420 6e65 775f 636f 6e66   assert new_conf
-00007360: 6967 5b27 7265 6e65 7761 6c70 6172 616d  ig['renewalparam
-00007370: 7327 5d5b 2770 7265 5f68 6f6f 6b27 5d20  s']['pre_hook'] 
-00007380: 3d3d 2027 6563 686f 2070 7265 3227 0a0a  == 'echo pre2'..
-00007390: 2020 2020 2020 2020 2320 7465 7374 2064          # test d
-000073a0: 6570 6c6f 7920 686f 6f6b 2069 7320 7365  eploy hook is se
-000073b0: 7420 6576 656e 2074 686f 7567 6820 7765  t even though we
-000073c0: 2064 6964 2061 2064 7279 2072 756e 0a20   did a dry run. 
-000073d0: 2020 2020 2020 2061 7373 6572 7420 2772         assert 'r
-000073e0: 656e 6577 5f68 6f6f 6b27 206e 6f74 2069  enew_hook' not i
-000073f0: 6e20 7365 6c66 2e6f 7269 6769 6e61 6c5f  n self.original_
-00007400: 636f 6e66 6967 0a20 2020 2020 2020 206e  config.        n
-00007410: 6577 5f63 6f6e 6669 6720 3d20 7365 6c66  ew_config = self
-00007420: 2e5f 6361 6c6c 2827 2d2d 6365 7274 2d6e  ._call('--cert-n
-00007430: 616d 6520 6578 616d 706c 652e 636f 6d20  ame example.com 
-00007440: 2d2d 6465 706c 6f79 2d68 6f6f 6b27 2e73  --deploy-hook'.s
-00007450: 706c 6974 2829 202b 205b 2765 6368 6f20  plit() + ['echo 
-00007460: 6465 706c 6f79 275d 290a 2020 2020 2020  deploy']).      
-00007470: 2020 6173 7365 7274 206e 6577 5f63 6f6e    assert new_con
-00007480: 6669 675b 2772 656e 6577 616c 7061 7261  fig['renewalpara
-00007490: 6d73 275d 5b27 7265 6e65 775f 686f 6f6b  ms']['renew_hook
-000074a0: 275d 203d 3d20 2765 6368 6f20 6465 706c  '] == 'echo depl
-000074b0: 6f79 270a 0a20 2020 2064 6566 2074 6573  oy'..    def tes
-000074c0: 745f 6472 795f 7275 6e5f 6661 696c 7328  t_dry_run_fails(
-000074d0: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-000074e0: 2073 6574 2073 6964 6520 6566 6665 6374   set side effect
-000074f0: 206f 6620 7261 6973 696e 6720 6572 726f   of raising erro
-00007500: 720a 2020 2020 2020 2020 7365 6c66 2e6d  r.        self.m
-00007510: 6f63 6b73 5b27 5f67 6574 5f61 6e64 5f73  ocks['_get_and_s
-00007520: 6176 655f 6365 7274 275d 2e73 6964 655f  ave_cert'].side_
-00007530: 6566 6665 6374 203d 2065 7272 6f72 732e  effect = errors.
-00007540: 4572 726f 720a 0a20 2020 2020 2020 2074  Error..        t
-00007550: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00007560: 7365 6c66 2e5f 6361 6c6c 2827 2d2d 6365  self._call('--ce
-00007570: 7274 2d6e 616d 6520 6578 616d 706c 652e  rt-name example.
-00007580: 636f 6d20 2d2d 6170 6163 6865 272e 7370  com --apache'.sp
-00007590: 6c69 7428 2929 0a20 2020 2020 2020 2065  lit()).        e
-000075a0: 7863 6570 7420 6572 726f 7273 2e45 7272  xcept errors.Err
-000075b0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-000075c0: 7061 7373 0a0a 2020 2020 2020 2020 2320  pass..        # 
-000075d0: 6368 6563 6b20 7468 6174 2063 6f6e 6669  check that confi
-000075e0: 6720 6973 6e27 7420 6d6f 6469 6669 6564  g isn't modified
-000075f0: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00007600: 656e 2873 656c 662e 7265 6e65 7761 6c5f  en(self.renewal_
-00007610: 6669 6c65 2c20 2772 2729 2061 7320 663a  file, 'r') as f:
-00007620: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00007630: 5f63 6f6e 6669 6720 3d20 636f 6e66 6967  _config = config
-00007640: 6f62 6a2e 436f 6e66 6967 4f62 6a28 662c  obj.ConfigObj(f,
-00007650: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
-00007660: 272c 2064 6566 6175 6c74 5f65 6e63 6f64  ', default_encod
-00007670: 696e 673d 2775 7466 2d38 2729 0a20 2020  ing='utf-8').   
-00007680: 2020 2020 2061 7373 6572 7420 6e65 775f       assert new_
-00007690: 636f 6e66 6967 5b27 7265 6e65 7761 6c70  config['renewalp
-000076a0: 6172 616d 7327 5d5b 2761 7574 6865 6e74  arams']['authent
-000076b0: 6963 6174 6f72 275d 203d 3d20 276e 6769  icator'] == 'ngi
-000076c0: 6e78 270a 0a20 2020 2040 6d6f 636b 2e70  nx'..    @mock.p
-000076d0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000076e0: 6e74 6572 6e61 6c2e 6d61 696e 2e64 6973  nternal.main.dis
-000076f0: 706c 6179 5f75 7469 6c2e 6e6f 7469 6679  play_util.notify
-00007700: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
-00007710: 7265 706f 7274 5f72 6573 756c 7473 2873  report_results(s
-00007720: 656c 662c 206d 6f63 6b5f 6e6f 7469 6679  elf, mock_notify
-00007730: 293a 0a20 2020 2020 2020 2023 206d 616b  ):.        # mak
-00007740: 6520 7375 7265 2072 6570 6f72 7420 7265  e sure report re
-00007750: 7375 6c74 7320 776f 726b 7320 7768 656e  sults works when
-00007760: 2063 6f6e 6669 6720 6861 7320 6120 7765   config has a we
-00007770: 6272 6f6f 7420 6d61 700a 2020 2020 2020  broot map.      
-00007780: 2020 6f72 6967 696e 616c 5f63 6f6e 6669    original_confi
-00007790: 6720 3d20 2222 220a 2020 2020 2020 2020  g = """.        
-000077a0: 2020 2020 7665 7273 696f 6e20 3d20 322e      version = 2.
-000077b0: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-000077c0: 6172 6368 6976 655f 6469 7220 3d20 2f65  archive_dir = /e
-000077d0: 7463 2f6c 6574 7365 6e63 7279 7074 2f61  tc/letsencrypt/a
-000077e0: 7263 6869 7665 2f65 7861 6d70 6c65 2e63  rchive/example.c
-000077f0: 6f6d 0a20 2020 2020 2020 2020 2020 2063  om.            c
-00007800: 6572 7420 3d20 2f65 7463 2f6c 6574 7365  ert = /etc/letse
-00007810: 6e63 7279 7074 2f6c 6976 652f 6578 616d  ncrypt/live/exam
-00007820: 706c 652e 636f 6d2f 6365 7274 2e70 656d  ple.com/cert.pem
-00007830: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00007840: 766b 6579 203d 202f 6574 632f 6c65 7473  vkey = /etc/lets
-00007850: 656e 6372 7970 742f 6c69 7665 2f65 7861  encrypt/live/exa
-00007860: 6d70 6c65 2e63 6f6d 2f70 7269 766b 6579  mple.com/privkey
-00007870: 2e70 656d 0a20 2020 2020 2020 2020 2020  .pem.           
-00007880: 2063 6861 696e 203d 202f 6574 632f 6c65   chain = /etc/le
-00007890: 7473 656e 6372 7970 742f 6c69 7665 2f65  tsencrypt/live/e
-000078a0: 7861 6d70 6c65 2e63 6f6d 2f63 6861 696e  xample.com/chain
-000078b0: 2e70 656d 0a20 2020 2020 2020 2020 2020  .pem.           
-000078c0: 2066 756c 6c63 6861 696e 203d 202f 6574   fullchain = /et
-000078d0: 632f 6c65 7473 656e 6372 7970 742f 6c69  c/letsencrypt/li
-000078e0: 7665 2f65 7861 6d70 6c65 2e63 6f6d 2f66  ve/example.com/f
-000078f0: 756c 6c63 6861 696e 2e70 656d 0a0a 2020  ullchain.pem..  
-00007900: 2020 2020 2020 2020 2020 2320 4f70 7469            # Opti
-00007910: 6f6e 7320 7573 6564 2069 6e20 7468 6520  ons used in the 
-00007920: 7265 6e65 7761 6c20 7072 6f63 6573 730a  renewal process.
-00007930: 2020 2020 2020 2020 2020 2020 5b72 656e              [ren
-00007940: 6577 616c 7061 7261 6d73 5d0a 2020 2020  ewalparams].    
-00007950: 2020 2020 2020 2020 6163 636f 756e 7420          account 
-00007960: 3d20 6565 3433 3633 3464 6230 6161 3465  = ee43634db0aa4e
-00007970: 3638 3034 6631 3532 6265 3339 3939 3065  6804f152be39990e
-00007980: 3661 0a20 2020 2020 2020 2020 2020 2073  6a.            s
-00007990: 6572 7665 7220 3d20 6874 7470 733a 2f2f  erver = https://
-000079a0: 6163 6d65 2d73 7461 6769 6e67 2d76 3032  acme-staging-v02
-000079b0: 2e61 7069 2e6c 6574 7365 6e63 7279 7074  .api.letsencrypt
-000079c0: 2e6f 7267 2f64 6972 6563 746f 7279 0a20  .org/directory. 
-000079d0: 2020 2020 2020 2020 2020 2061 7574 6865             authe
-000079e0: 6e74 6963 6174 6f72 203d 2077 6562 726f  nticator = webro
-000079f0: 6f74 0a20 2020 2020 2020 2020 2020 2069  ot.            i
-00007a00: 6e73 7461 6c6c 6572 203d 206e 6769 6e78  nstaller = nginx
-00007a10: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
-00007a20: 5f74 7970 6520 3d20 6563 6473 610a 2020  _type = ecdsa.  
-00007a30: 2020 2020 2020 2020 2020 7765 6272 6f6f            webroo
-00007a40: 745f 7061 7468 203d 202f 7661 722f 7777  t_path = /var/ww
-00007a50: 772f 6874 6d6c 2c0a 2020 2020 2020 2020  w/html,.        
-00007a60: 2020 2020 5b5b 7765 6272 6f6f 745f 6d61      [[webroot_ma
-00007a70: 705d 5d0a 2020 2020 2020 2020 2020 2020  p]].            
-00007a80: 6578 616d 706c 652e 636f 6d20 3d20 2f76  example.com = /v
-00007a90: 6172 2f77 7777 2f68 746d 6c0a 2020 2020  ar/www/html.    
-00007aa0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007ab0: 7769 7468 206f 7065 6e28 7365 6c66 2e72  with open(self.r
-00007ac0: 656e 6577 616c 5f66 696c 652c 2027 7727  enewal_file, 'w'
-00007ad0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-00007ae0: 2020 2020 662e 7772 6974 6528 6f72 6967      f.write(orig
-00007af0: 696e 616c 5f63 6f6e 6669 6729 0a20 2020  inal_config).   
-00007b00: 2020 2020 2077 6974 6820 6f70 656e 2873       with open(s
-00007b10: 656c 662e 7265 6e65 7761 6c5f 6669 6c65  elf.renewal_file
-00007b20: 2c20 2772 2729 2061 7320 663a 0a20 2020  , 'r') as f:.   
-00007b30: 2020 2020 2020 2020 2073 656c 662e 6f72           self.or
-00007b40: 6967 696e 616c 5f63 6f6e 6669 6720 3d20  iginal_config = 
-00007b50: 636f 6e66 6967 6f62 6a2e 436f 6e66 6967  configobj.Config
-00007b60: 4f62 6a28 662c 0a20 2020 2020 2020 2020  Obj(f,.         
-00007b70: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
-00007b80: 2775 7466 2d38 272c 2064 6566 6175 6c74  'utf-8', default
-00007b90: 5f65 6e63 6f64 696e 673d 2775 7466 2d38  _encoding='utf-8
-00007ba0: 2729 0a0a 2020 2020 2020 2020 6e61 6d65  ')..        name
-00007bb0: 645f 6d6f 636b 203d 206d 6f63 6b2e 4d6f  d_mock = mock.Mo
-00007bc0: 636b 2829 0a20 2020 2020 2020 206e 616d  ck().        nam
-00007bd0: 6564 5f6d 6f63 6b2e 6e61 6d65 203d 2027  ed_mock.name = '
-00007be0: 6e67 696e 7827 0a0a 2020 2020 2020 2020  nginx'..        
-00007bf0: 7365 6c66 2e6d 6f63 6b73 5b27 7069 636b  self.mocks['pick
-00007c00: 5f61 7574 6827 5d2e 7265 7475 726e 5f76  _auth'].return_v
-00007c10: 616c 7565 203d 206e 616d 6564 5f6d 6f63  alue = named_moc
-00007c20: 6b0a 2020 2020 2020 2020 7365 6c66 2e6d  k.        self.m
-00007c30: 6f63 6b73 5b27 6669 6e64 5f69 6e69 7427  ocks['find_init'
-00007c40: 5d2e 7265 7475 726e 5f76 616c 7565 203d  ].return_value =
-00007c50: 206e 616d 6564 5f6d 6f63 6b0a 0a20 2020   named_mock..   
-00007c60: 2020 2020 206e 6577 5f63 6f6e 6669 6720       new_config 
-00007c70: 3d20 7365 6c66 2e5f 6361 6c6c 2827 2d2d  = self._call('--
-00007c80: 6365 7274 2d6e 616d 6520 6578 616d 706c  cert-name exampl
-00007c90: 652e 636f 6d20 2d2d 6e67 696e 7827 2e73  e.com --nginx'.s
-00007ca0: 706c 6974 2829 290a 2020 2020 2020 2020  plit()).        
-00007cb0: 6173 7365 7274 206e 6577 5f63 6f6e 6669  assert new_confi
-00007cc0: 675b 2772 656e 6577 616c 7061 7261 6d73  g['renewalparams
-00007cd0: 275d 5b27 6175 7468 656e 7469 6361 746f  ']['authenticato
-00007ce0: 7227 5d20 3d3d 2027 6e67 696e 7827 0a20  r'] == 'nginx'. 
-00007cf0: 2020 2020 2020 206d 6f63 6b5f 6e6f 7469         mock_noti
-00007d00: 6679 2e61 7373 6572 745f 6361 6c6c 6564  fy.assert_called
-00007d10: 5f77 6974 6828 0a20 2020 2020 2020 2020  _with(.         
-00007d20: 2020 2027 5c6e 5375 6363 6573 7366 756c     '\nSuccessful
-00007d30: 6c79 2075 7064 6174 6564 2063 6f6e 6669  ly updated confi
-00007d40: 6775 7261 7469 6f6e 2e27 2b0a 2020 2020  guration.'+.    
-00007d50: 2020 2020 2020 2020 275c 6e43 6861 6e67          '\nChang
-00007d60: 6573 2077 696c 6c20 6170 706c 7920 7768  es will apply wh
-00007d70: 656e 2074 6865 2063 6572 7469 6669 6361  en the certifica
-00007d80: 7465 2072 656e 6577 732e 2729 0a0a 0a63  te renews.')...c
-00007d90: 6c61 7373 2044 656c 6574 6549 6641 7070  lass DeleteIfApp
-00007da0: 726f 7072 6961 7465 5465 7374 2874 6573  ropriateTest(tes
-00007db0: 745f 7574 696c 2e43 6f6e 6669 6754 6573  t_util.ConfigTes
-00007dc0: 7443 6173 6529 3a0a 2020 2020 2222 2254  tCase):.    """T
-00007dd0: 6573 7473 2066 6f72 2063 6572 7462 6f74  ests for certbot
-00007de0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00007df0: 5f64 656c 6574 655f 6966 5f61 7070 726f  _delete_if_appro
-00007e00: 7072 6961 7465 2022 2222 0a0a 2020 2020  priate """..    
-00007e10: 6465 6620 5f63 616c 6c28 7365 6c66 2c20  def _call(self, 
-00007e20: 6d6f 636b 5f63 6f6e 6669 6729 3a0a 2020  mock_config):.  
-00007e30: 2020 2020 2020 6672 6f6d 2063 6572 7462        from certb
-00007e40: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00007e50: 6e20 696d 706f 7274 205f 6465 6c65 7465  n import _delete
-00007e60: 5f69 665f 6170 7072 6f70 7269 6174 650a  _if_appropriate.
-00007e70: 2020 2020 2020 2020 5f64 656c 6574 655f          _delete_
-00007e80: 6966 5f61 7070 726f 7072 6961 7465 286d  if_appropriate(m
-00007e90: 6f63 6b5f 636f 6e66 6967 290a 0a20 2020  ock_config)..   
-00007ea0: 2064 6566 205f 7465 7374 5f64 656c 6574   def _test_delet
-00007eb0: 655f 6f70 745f 6f75 745f 636f 6d6d 6f6e  e_opt_out_common
-00007ec0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00007ed0: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
-00007ee0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00007ef0: 616c 2e63 6572 745f 6d61 6e61 6765 722e  al.cert_manager.
-00007f00: 6465 6c65 7465 2729 2061 7320 6d6f 636b  delete') as mock
-00007f10: 5f64 656c 6574 653a 0a20 2020 2020 2020  _delete:.       
-00007f20: 2020 2020 2073 656c 662e 5f63 616c 6c28       self._call(
-00007f30: 7365 6c66 2e63 6f6e 6669 6729 0a20 2020  self.config).   
-00007f40: 2020 2020 206d 6f63 6b5f 6465 6c65 7465       mock_delete
-00007f50: 2e61 7373 6572 745f 6e6f 745f 6361 6c6c  .assert_not_call
-00007f60: 6564 2829 0a0a 2020 2020 4074 6573 745f  ed()..    @test_
-00007f70: 7574 696c 2e70 6174 6368 5f64 6973 706c  util.patch_displ
-00007f80: 6179 5f75 7469 6c28 290a 2020 2020 6465  ay_util().    de
-00007f90: 6620 7465 7374 5f64 656c 6574 655f 666c  f test_delete_fl
-00007fa0: 6167 5f6f 7074 5f6f 7574 2873 656c 662c  ag_opt_out(self,
-00007fb0: 2075 6e75 7365 645f 6d6f 636b 5f67 6574   unused_mock_get
-00007fc0: 5f75 7469 6c69 7479 293a 0a20 2020 2020  _utility):.     
-00007fd0: 2020 2073 656c 662e 636f 6e66 6967 2e64     self.config.d
-00007fe0: 656c 6574 655f 6166 7465 725f 7265 766f  elete_after_revo
-00007ff0: 6b65 203d 2046 616c 7365 0a20 2020 2020  ke = False.     
-00008000: 2020 2073 656c 662e 5f74 6573 745f 6465     self._test_de
-00008010: 6c65 7465 5f6f 7074 5f6f 7574 5f63 6f6d  lete_opt_out_com
-00008020: 6d6f 6e28 290a 0a20 2020 2040 7465 7374  mon()..    @test
-00008030: 5f75 7469 6c2e 7061 7463 685f 6469 7370  _util.patch_disp
-00008040: 6c61 795f 7574 696c 2829 0a20 2020 2064  lay_util().    d
-00008050: 6566 2074 6573 745f 6465 6c65 7465 5f70  ef test_delete_p
-00008060: 726f 6d70 745f 6f70 745f 6f75 7428 7365  rompt_opt_out(se
-00008070: 6c66 2c20 6d6f 636b 5f67 6574 5f75 7469  lf, mock_get_uti
-00008080: 6c69 7479 293a 0a20 2020 2020 2020 2075  lity):.        u
-00008090: 7469 6c5f 6d6f 636b 203d 206d 6f63 6b5f  til_mock = mock_
-000080a0: 6765 745f 7574 696c 6974 7928 290a 2020  get_utility().  
-000080b0: 2020 2020 2020 7574 696c 5f6d 6f63 6b2e        util_mock.
-000080c0: 7965 736e 6f2e 7265 7475 726e 5f76 616c  yesno.return_val
-000080d0: 7565 203d 2046 616c 7365 0a20 2020 2020  ue = False.     
-000080e0: 2020 2073 656c 662e 5f74 6573 745f 6465     self._test_de
-000080f0: 6c65 7465 5f6f 7074 5f6f 7574 5f63 6f6d  lete_opt_out_com
-00008100: 6d6f 6e28 290a 0a20 2020 2040 6d6f 636b  mon()..    @mock
-00008110: 2e70 6174 6368 2822 6365 7274 626f 742e  .patch("certbot.
-00008120: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e6c  _internal.main.l
-00008130: 6f67 6765 722e 7761 726e 696e 6722 290a  ogger.warning").
-00008140: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-00008150: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00008160: 616c 2e73 746f 7261 6765 2e72 656e 6577  al.storage.renew
-00008170: 616c 5f66 696c 655f 666f 725f 6365 7274  al_file_for_cert
-00008180: 6e61 6d65 2729 0a20 2020 2040 6d6f 636b  name').    @mock
-00008190: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-000081a0: 5f69 6e74 6572 6e61 6c2e 6365 7274 5f6d  _internal.cert_m
-000081b0: 616e 6167 6572 2e64 656c 6574 6527 290a  anager.delete').
-000081c0: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-000081d0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-000081e0: 616c 2e63 6572 745f 6d61 6e61 6765 722e  al.cert_manager.
-000081f0: 6d61 7463 685f 616e 645f 6368 6563 6b5f  match_and_check_
-00008200: 6f76 6572 6c61 7073 2729 0a20 2020 2040  overlaps').    @
-00008210: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00008220: 626f 742e 5f69 6e74 6572 6e61 6c2e 7374  bot._internal.st
-00008230: 6f72 6167 652e 6675 6c6c 5f61 7263 6869  orage.full_archi
-00008240: 7665 5f70 6174 6827 290a 2020 2020 406d  ve_path').    @m
-00008250: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00008260: 6f74 2e5f 696e 7465 726e 616c 2e63 6572  ot._internal.cer
-00008270: 745f 6d61 6e61 6765 722e 6365 7274 5f70  t_manager.cert_p
-00008280: 6174 685f 746f 5f6c 696e 6561 6765 2729  ath_to_lineage')
-00008290: 0a20 2020 2040 7465 7374 5f75 7469 6c2e  .    @test_util.
-000082a0: 7061 7463 685f 6469 7370 6c61 795f 7574  patch_display_ut
-000082b0: 696c 2829 0a20 2020 2064 6566 2074 6573  il().    def tes
-000082c0: 745f 6f76 6572 6c61 7070 696e 675f 6172  t_overlapping_ar
-000082d0: 6368 6976 655f 6469 7273 2873 656c 662c  chive_dirs(self,
-000082e0: 206d 6f63 6b5f 6765 745f 7574 696c 6974   mock_get_utilit
-000082f0: 792c 0a20 2020 2020 2020 2020 2020 206d  y,.            m
-00008300: 6f63 6b5f 6365 7274 5f70 6174 685f 746f  ock_cert_path_to
-00008310: 5f6c 696e 6561 6765 2c20 6d6f 636b 5f61  _lineage, mock_a
-00008320: 7263 6869 7665 2c0a 2020 2020 2020 2020  rchive,.        
-00008330: 2020 2020 6d6f 636b 5f6d 6174 6368 5f61      mock_match_a
-00008340: 6e64 5f63 6865 636b 5f6f 7665 726c 6170  nd_check_overlap
-00008350: 732c 206d 6f63 6b5f 6465 6c65 7465 2c0a  s, mock_delete,.
-00008360: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
-00008370: 5f72 656e 6577 616c 5f66 696c 655f 666f  _renewal_file_fo
-00008380: 725f 6365 7274 6e61 6d65 2c20 6d6f 636b  r_certname, mock
-00008390: 5f77 6172 6e69 6e67 293a 0a20 2020 2020  _warning):.     
-000083a0: 2020 2023 2070 796c 696e 743a 2064 6973     # pylint: dis
-000083b0: 6162 6c65 203d 2075 6e75 7365 642d 6172  able = unused-ar
-000083c0: 6775 6d65 6e74 0a20 2020 2020 2020 2063  gument.        c
-000083d0: 6f6e 6669 6720 3d20 7365 6c66 2e63 6f6e  onfig = self.con
-000083e0: 6669 670a 2020 2020 2020 2020 636f 6e66  fig.        conf
-000083f0: 6967 2e63 6572 745f 7061 7468 203d 2022  ig.cert_path = "
-00008400: 2f73 6f6d 652f 7265 6173 6f6e 6162 6c65  /some/reasonable
-00008410: 2f70 6174 6822 0a20 2020 2020 2020 2063  /path".        c
-00008420: 6f6e 6669 672e 6365 7274 6e61 6d65 203d  onfig.certname =
-00008430: 2022 220a 2020 2020 2020 2020 6d6f 636b   "".        mock
-00008440: 5f63 6572 745f 7061 7468 5f74 6f5f 6c69  _cert_path_to_li
-00008450: 6e65 6167 652e 7265 7475 726e 5f76 616c  neage.return_val
-00008460: 7565 203d 2022 6578 616d 706c 652e 636f  ue = "example.co
-00008470: 6d22 0a20 2020 2020 2020 206d 6f63 6b5f  m".        mock_
-00008480: 6d61 7463 685f 616e 645f 6368 6563 6b5f  match_and_check_
-00008490: 6f76 6572 6c61 7073 2e73 6964 655f 6566  overlaps.side_ef
-000084a0: 6665 6374 203d 2065 7272 6f72 732e 4f76  fect = errors.Ov
-000084b0: 6572 6c61 7070 696e 674d 6174 6368 466f  erlappingMatchFo
-000084c0: 756e 6428 290a 2020 2020 2020 2020 7365  und().        se
-000084d0: 6c66 2e5f 6361 6c6c 2863 6f6e 6669 6729  lf._call(config)
-000084e0: 0a20 2020 2020 2020 206d 6f63 6b5f 6465  .        mock_de
-000084f0: 6c65 7465 2e61 7373 6572 745f 6e6f 745f  lete.assert_not_
-00008500: 6361 6c6c 6564 2829 0a20 2020 2020 2020  called().       
-00008510: 2061 7373 6572 7420 6d6f 636b 5f77 6172   assert mock_war
-00008520: 6e69 6e67 2e63 616c 6c5f 636f 756e 7420  ning.call_count 
-00008530: 3d3d 2031 0a0a 2020 2020 406d 6f63 6b2e  == 1..    @mock.
-00008540: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00008550: 696e 7465 726e 616c 2e73 746f 7261 6765  internal.storage
-00008560: 2e72 656e 6577 616c 5f66 696c 655f 666f  .renewal_file_fo
-00008570: 725f 6365 7274 6e61 6d65 2729 0a20 2020  r_certname').   
-00008580: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
-00008590: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-000085a0: 6365 7274 5f6d 616e 6167 6572 2e6d 6174  cert_manager.mat
-000085b0: 6368 5f61 6e64 5f63 6865 636b 5f6f 7665  ch_and_check_ove
-000085c0: 726c 6170 7327 290a 2020 2020 406d 6f63  rlaps').    @moc
-000085d0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-000085e0: 2e5f 696e 7465 726e 616c 2e73 746f 7261  ._internal.stora
-000085f0: 6765 2e66 756c 6c5f 6172 6368 6976 655f  ge.full_archive_
-00008600: 7061 7468 2729 0a20 2020 2040 6d6f 636b  path').    @mock
-00008610: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-00008620: 5f69 6e74 6572 6e61 6c2e 6365 7274 5f6d  _internal.cert_m
-00008630: 616e 6167 6572 2e64 656c 6574 6527 290a  anager.delete').
-00008640: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-00008650: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00008660: 616c 2e63 6572 745f 6d61 6e61 6765 722e  al.cert_manager.
-00008670: 6365 7274 5f70 6174 685f 746f 5f6c 696e  cert_path_to_lin
-00008680: 6561 6765 2729 0a20 2020 2040 7465 7374  eage').    @test
-00008690: 5f75 7469 6c2e 7061 7463 685f 6469 7370  _util.patch_disp
-000086a0: 6c61 795f 7574 696c 2829 0a20 2020 2064  lay_util().    d
-000086b0: 6566 2074 6573 745f 6365 7274 5f70 6174  ef test_cert_pat
-000086c0: 685f 6f6e 6c79 2873 656c 662c 206d 6f63  h_only(self, moc
-000086d0: 6b5f 6765 745f 7574 696c 6974 792c 0a20  k_get_utility,. 
-000086e0: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
-000086f0: 6365 7274 5f70 6174 685f 746f 5f6c 696e  cert_path_to_lin
-00008700: 6561 6765 2c20 6d6f 636b 5f64 656c 6574  eage, mock_delet
-00008710: 652c 206d 6f63 6b5f 6172 6368 6976 652c  e, mock_archive,
-00008720: 0a20 2020 2020 2020 2020 2020 206d 6f63  .            moc
-00008730: 6b5f 6f76 6572 6c61 7070 696e 675f 6172  k_overlapping_ar
-00008740: 6368 6976 655f 6469 7273 2c20 6d6f 636b  chive_dirs, mock
-00008750: 5f72 656e 6577 616c 5f66 696c 655f 666f  _renewal_file_fo
-00008760: 725f 6365 7274 6e61 6d65 293a 0a20 2020  r_certname):.   
-00008770: 2020 2020 2023 2070 796c 696e 743a 2064       # pylint: d
-00008780: 6973 6162 6c65 203d 2075 6e75 7365 642d  isable = unused-
-00008790: 6172 6775 6d65 6e74 0a20 2020 2020 2020  argument.       
-000087a0: 2063 6f6e 6669 6720 3d20 7365 6c66 2e63   config = self.c
-000087b0: 6f6e 6669 670a 2020 2020 2020 2020 636f  onfig.        co
-000087c0: 6e66 6967 2e63 6572 745f 7061 7468 203d  nfig.cert_path =
-000087d0: 2022 2f73 6f6d 652f 7265 6173 6f6e 6162   "/some/reasonab
-000087e0: 6c65 2f70 6174 6822 0a20 2020 2020 2020  le/path".       
-000087f0: 2063 6f6e 6669 672e 6365 7274 6e61 6d65   config.certname
-00008800: 203d 2022 220a 2020 2020 2020 2020 6d6f   = "".        mo
-00008810: 636b 5f63 6572 745f 7061 7468 5f74 6f5f  ck_cert_path_to_
-00008820: 6c69 6e65 6167 652e 7265 7475 726e 5f76  lineage.return_v
-00008830: 616c 7565 203d 2022 6578 616d 706c 652e  alue = "example.
-00008840: 636f 6d22 0a20 2020 2020 2020 206d 6f63  com".        moc
-00008850: 6b5f 6f76 6572 6c61 7070 696e 675f 6172  k_overlapping_ar
-00008860: 6368 6976 655f 6469 7273 2e72 6574 7572  chive_dirs.retur
-00008870: 6e5f 7661 6c75 6520 3d20 4661 6c73 650a  n_value = False.
-00008880: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
-00008890: 6c6c 2863 6f6e 6669 6729 0a20 2020 2020  ll(config).     
-000088a0: 2020 2061 7373 6572 7420 6d6f 636b 5f64     assert mock_d
-000088b0: 656c 6574 652e 6361 6c6c 5f63 6f75 6e74  elete.call_count
-000088c0: 203d 3d20 310a 0a20 2020 2040 6d6f 636b   == 1..    @mock
-000088d0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-000088e0: 5f69 6e74 6572 6e61 6c2e 7374 6f72 6167  _internal.storag
-000088f0: 652e 7265 6e65 7761 6c5f 6669 6c65 5f66  e.renewal_file_f
-00008900: 6f72 5f63 6572 746e 616d 6527 290a 2020  or_certname').  
-00008910: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
-00008920: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-00008930: 2e63 6572 745f 6d61 6e61 6765 722e 6d61  .cert_manager.ma
-00008940: 7463 685f 616e 645f 6368 6563 6b5f 6f76  tch_and_check_ov
-00008950: 6572 6c61 7073 2729 0a20 2020 2040 6d6f  erlaps').    @mo
-00008960: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00008970: 742e 5f69 6e74 6572 6e61 6c2e 7374 6f72  t._internal.stor
-00008980: 6167 652e 6675 6c6c 5f61 7263 6869 7665  age.full_archive
-00008990: 5f70 6174 6827 290a 2020 2020 406d 6f63  _path').    @moc
-000089a0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-000089b0: 2e5f 696e 7465 726e 616c 2e63 6572 745f  ._internal.cert_
-000089c0: 6d61 6e61 6765 722e 6365 7274 5f70 6174  manager.cert_pat
-000089d0: 685f 746f 5f6c 696e 6561 6765 2729 0a20  h_to_lineage'). 
-000089e0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-000089f0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00008a00: 6c2e 6365 7274 5f6d 616e 6167 6572 2e64  l.cert_manager.d
-00008a10: 656c 6574 6527 290a 2020 2020 4074 6573  elete').    @tes
-00008a20: 745f 7574 696c 2e70 6174 6368 5f64 6973  t_util.patch_dis
-00008a30: 706c 6179 5f75 7469 6c28 290a 2020 2020  play_util().    
-00008a40: 6465 6620 7465 7374 5f6e 6f6e 696e 7465  def test_noninte
-00008a50: 7261 6374 6976 655f 6465 6c65 7469 6f6e  ractive_deletion
-00008a60: 2873 656c 662c 206d 6f63 6b5f 6765 745f  (self, mock_get_
-00008a70: 7574 696c 6974 792c 206d 6f63 6b5f 6465  utility, mock_de
-00008a80: 6c65 7465 2c0a 2020 2020 2020 2020 2020  lete,.          
-00008a90: 2020 6d6f 636b 5f63 6572 745f 7061 7468    mock_cert_path
-00008aa0: 5f74 6f5f 6c69 6e65 6167 652c 206d 6f63  _to_lineage, moc
-00008ab0: 6b5f 6675 6c6c 5f61 7263 6869 7665 5f64  k_full_archive_d
-00008ac0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
-00008ad0: 6d6f 636b 5f6d 6174 6368 5f61 6e64 5f63  mock_match_and_c
-00008ae0: 6865 636b 5f6f 7665 726c 6170 732c 206d  heck_overlaps, m
-00008af0: 6f63 6b5f 7265 6e65 7761 6c5f 6669 6c65  ock_renewal_file
-00008b00: 5f66 6f72 5f63 6572 746e 616d 6529 3a0a  _for_certname):.
-00008b10: 2020 2020 2020 2020 2320 7079 6c69 6e74          # pylint
-00008b20: 3a20 6469 7361 626c 6520 3d20 756e 7573  : disable = unus
-00008b30: 6564 2d61 7267 756d 656e 740a 2020 2020  ed-argument.    
-00008b40: 2020 2020 636f 6e66 6967 203d 2073 656c      config = sel
-00008b50: 662e 636f 6e66 6967 0a20 2020 2020 2020  f.config.       
-00008b60: 2063 6f6e 6669 672e 6e61 6d65 7370 6163   config.namespac
-00008b70: 652e 6e6f 6e69 6e74 6572 6163 7469 7665  e.noninteractive
-00008b80: 5f6d 6f64 6520 3d20 5472 7565 0a20 2020  _mode = True.   
-00008b90: 2020 2020 2063 6f6e 6669 672e 6365 7274       config.cert
-00008ba0: 5f70 6174 6820 3d20 222f 736f 6d65 2f72  _path = "/some/r
-00008bb0: 6561 736f 6e61 626c 652f 7061 7468 220a  easonable/path".
-00008bc0: 2020 2020 2020 2020 636f 6e66 6967 2e63          config.c
-00008bd0: 6572 746e 616d 6520 3d20 2222 0a20 2020  ertname = "".   
-00008be0: 2020 2020 206d 6f63 6b5f 6365 7274 5f70       mock_cert_p
-00008bf0: 6174 685f 746f 5f6c 696e 6561 6765 2e72  ath_to_lineage.r
-00008c00: 6574 7572 6e5f 7661 6c75 6520 3d20 2265  eturn_value = "e
-00008c10: 7861 6d70 6c65 2e63 6f6d 220a 2020 2020  xample.com".    
-00008c20: 2020 2020 6d6f 636b 5f66 756c 6c5f 6172      mock_full_ar
-00008c30: 6368 6976 655f 6469 722e 7265 7475 726e  chive_dir.return
-00008c40: 5f76 616c 7565 203d 2022 220a 2020 2020  _value = "".    
-00008c50: 2020 2020 6d6f 636b 5f6d 6174 6368 5f61      mock_match_a
-00008c60: 6e64 5f63 6865 636b 5f6f 7665 726c 6170  nd_check_overlap
-00008c70: 732e 7265 7475 726e 5f76 616c 7565 203d  s.return_value =
-00008c80: 2022 220a 2020 2020 2020 2020 7365 6c66   "".        self
-00008c90: 2e5f 6361 6c6c 2863 6f6e 6669 6729 0a20  ._call(config). 
-00008ca0: 2020 2020 2020 2061 7373 6572 7420 6d6f         assert mo
-00008cb0: 636b 5f64 656c 6574 652e 6361 6c6c 5f63  ck_delete.call_c
-00008cc0: 6f75 6e74 203d 3d20 310a 0a20 2020 2040  ount == 1..    @
-00008cd0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00008ce0: 626f 742e 5f69 6e74 6572 6e61 6c2e 7374  bot._internal.st
-00008cf0: 6f72 6167 652e 7265 6e65 7761 6c5f 6669  orage.renewal_fi
-00008d00: 6c65 5f66 6f72 5f63 6572 746e 616d 6527  le_for_certname'
-00008d10: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
-00008d20: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-00008d30: 726e 616c 2e63 6572 745f 6d61 6e61 6765  rnal.cert_manage
-00008d40: 722e 6d61 7463 685f 616e 645f 6368 6563  r.match_and_chec
-00008d50: 6b5f 6f76 6572 6c61 7073 2729 0a20 2020  k_overlaps').   
-00008d60: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
-00008d70: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-00008d80: 7374 6f72 6167 652e 6675 6c6c 5f61 7263  storage.full_arc
-00008d90: 6869 7665 5f70 6174 6827 290a 2020 2020  hive_path').    
-00008da0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-00008db0: 7462 6f74 2e5f 696e 7465 726e 616c 2e63  tbot._internal.c
-00008dc0: 6572 745f 6d61 6e61 6765 722e 6365 7274  ert_manager.cert
-00008dd0: 5f70 6174 685f 746f 5f6c 696e 6561 6765  _path_to_lineage
-00008de0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-00008df0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-00008e00: 6572 6e61 6c2e 6365 7274 5f6d 616e 6167  ernal.cert_manag
-00008e10: 6572 2e64 656c 6574 6527 290a 2020 2020  er.delete').    
-00008e20: 4074 6573 745f 7574 696c 2e70 6174 6368  @test_util.patch
-00008e30: 5f64 6973 706c 6179 5f75 7469 6c28 290a  _display_util().
-00008e40: 2020 2020 6465 6620 7465 7374 5f6f 7074      def test_opt
-00008e50: 5f69 6e5f 6465 6c65 7469 6f6e 2873 656c  _in_deletion(sel
-00008e60: 662c 206d 6f63 6b5f 6765 745f 7574 696c  f, mock_get_util
-00008e70: 6974 792c 206d 6f63 6b5f 6465 6c65 7465  ity, mock_delete
-00008e80: 2c0a 2020 2020 2020 2020 2020 2020 6d6f  ,.            mo
-00008e90: 636b 5f63 6572 745f 7061 7468 5f74 6f5f  ck_cert_path_to_
-00008ea0: 6c69 6e65 6167 652c 206d 6f63 6b5f 6675  lineage, mock_fu
-00008eb0: 6c6c 5f61 7263 6869 7665 5f64 6972 2c0a  ll_archive_dir,.
-00008ec0: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
-00008ed0: 5f6d 6174 6368 5f61 6e64 5f63 6865 636b  _match_and_check
-00008ee0: 5f6f 7665 726c 6170 732c 206d 6f63 6b5f  _overlaps, mock_
-00008ef0: 7265 6e65 7761 6c5f 6669 6c65 5f66 6f72  renewal_file_for
-00008f00: 5f63 6572 746e 616d 6529 3a0a 2020 2020  _certname):.    
-00008f10: 2020 2020 636f 6e66 6967 203d 2073 656c      config = sel
-00008f20: 662e 636f 6e66 6967 0a20 2020 2020 2020  f.config.       
-00008f30: 2063 6f6e 6669 672e 6e61 6d65 7370 6163   config.namespac
-00008f40: 652e 6465 6c65 7465 5f61 6674 6572 5f72  e.delete_after_r
-00008f50: 6576 6f6b 6520 3d20 5472 7565 0a20 2020  evoke = True.   
-00008f60: 2020 2020 2063 6f6e 6669 672e 6365 7274       config.cert
-00008f70: 5f70 6174 6820 3d20 222f 736f 6d65 2f72  _path = "/some/r
-00008f80: 6561 736f 6e61 626c 652f 7061 7468 220a  easonable/path".
-00008f90: 2020 2020 2020 2020 636f 6e66 6967 2e63          config.c
-00008fa0: 6572 746e 616d 6520 3d20 2222 0a20 2020  ertname = "".   
-00008fb0: 2020 2020 206d 6f63 6b5f 6365 7274 5f70       mock_cert_p
-00008fc0: 6174 685f 746f 5f6c 696e 6561 6765 2e72  ath_to_lineage.r
-00008fd0: 6574 7572 6e5f 7661 6c75 6520 3d20 2265  eturn_value = "e
-00008fe0: 7861 6d70 6c65 2e63 6f6d 220a 2020 2020  xample.com".    
-00008ff0: 2020 2020 6d6f 636b 5f66 756c 6c5f 6172      mock_full_ar
-00009000: 6368 6976 655f 6469 722e 7265 7475 726e  chive_dir.return
-00009010: 5f76 616c 7565 203d 2022 220a 2020 2020  _value = "".    
-00009020: 2020 2020 6d6f 636b 5f6d 6174 6368 5f61      mock_match_a
-00009030: 6e64 5f63 6865 636b 5f6f 7665 726c 6170  nd_check_overlap
-00009040: 732e 7265 7475 726e 5f76 616c 7565 203d  s.return_value =
-00009050: 2022 220a 2020 2020 2020 2020 7365 6c66   "".        self
-00009060: 2e5f 6361 6c6c 2863 6f6e 6669 6729 0a20  ._call(config). 
-00009070: 2020 2020 2020 2061 7373 6572 7420 6d6f         assert mo
-00009080: 636b 5f64 656c 6574 652e 6361 6c6c 5f63  ck_delete.call_c
-00009090: 6f75 6e74 203d 3d20 310a 2020 2020 2020  ount == 1.      
-000090a0: 2020 6173 7365 7274 206e 6f74 206d 6f63    assert not moc
-000090b0: 6b5f 6765 745f 7574 696c 6974 7928 292e  k_get_utility().
-000090c0: 7965 736e 6f2e 6361 6c6c 6564 0a0a 0a63  yesno.called...c
-000090d0: 6c61 7373 2044 6574 6572 6d69 6e65 4163  lass DetermineAc
-000090e0: 636f 756e 7454 6573 7428 7465 7374 5f75  countTest(test_u
-000090f0: 7469 6c2e 436f 6e66 6967 5465 7374 4361  til.ConfigTestCa
-00009100: 7365 293a 0a20 2020 2022 2222 5465 7374  se):.    """Test
-00009110: 7320 666f 7220 6365 7274 626f 742e 5f69  s for certbot._i
-00009120: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 6465  nternal.main._de
-00009130: 7465 726d 696e 655f 6163 636f 756e 742e  termine_account.
-00009140: 2222 220a 0a20 2020 2064 6566 2073 6574  """..    def set
-00009150: 5570 2873 656c 6629 3a0a 2020 2020 2020  Up(self):.      
-00009160: 2020 7375 7065 7228 292e 7365 7455 7028    super().setUp(
-00009170: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-00009180: 6f6e 6669 672e 6163 636f 756e 7420 3d20  onfig.account = 
-00009190: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
-000091a0: 662e 636f 6e66 6967 2e65 6d61 696c 203d  f.config.email =
-000091b0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-000091c0: 6c66 2e63 6f6e 6669 672e 7265 6769 7374  lf.config.regist
-000091d0: 6572 5f75 6e73 6166 656c 795f 7769 7468  er_unsafely_with
-000091e0: 6f75 745f 656d 6169 6c20 3d20 4661 6c73  out_email = Fals
-000091f0: 650a 2020 2020 2020 2020 7365 6c66 2e61  e.        self.a
-00009200: 6363 7320 3d20 5b6d 6f63 6b2e 4d61 6769  ccs = [mock.Magi
-00009210: 634d 6f63 6b28 6964 3d27 7827 292c 206d  cMock(id='x'), m
-00009220: 6f63 6b2e 4d61 6769 634d 6f63 6b28 6964  ock.MagicMock(id
-00009230: 3d27 7927 295d 0a20 2020 2020 2020 2073  ='y')].        s
-00009240: 656c 662e 6163 636f 756e 745f 7374 6f72  elf.account_stor
-00009250: 6167 6520 3d20 6163 636f 756e 742e 4163  age = account.Ac
-00009260: 636f 756e 744d 656d 6f72 7953 746f 7261  countMemoryStora
-00009270: 6765 2829 0a20 2020 2020 2020 2023 2046  ge().        # F
-00009280: 6f72 2075 7365 2069 6e20 7361 7669 6e67  or use in saving
-00009290: 2061 6363 6f75 6e74 733a 2066 616b 6520   accounts: fake 
-000092a0: 6f75 7420 7468 6520 6e65 775f 6175 7468  out the new_auth
-000092b0: 7a20 5552 4c2e 0a20 2020 2020 2020 2073  z URL..        s
-000092c0: 656c 662e 6d6f 636b 5f63 6c69 656e 7420  elf.mock_client 
-000092d0: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-000092e0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000092f0: 6d6f 636b 5f63 6c69 656e 742e 6469 7265  mock_client.dire
-00009300: 6374 6f72 792e 6e65 775f 6175 7468 7a20  ctory.new_authz 
-00009310: 3d20 2268 6922 0a0a 0a20 2020 2064 6566  = "hi"...    def
-00009320: 205f 6361 6c6c 2873 656c 6629 3a0a 2020   _call(self):.  
-00009330: 2020 2020 2020 2320 7079 6c69 6e74 3a20        # pylint: 
-00009340: 6469 7361 626c 653d 7072 6f74 6563 7465  disable=protecte
-00009350: 642d 6163 6365 7373 0a20 2020 2020 2020  d-access.       
-00009360: 2066 726f 6d20 6365 7274 626f 742e 5f69   from certbot._i
-00009370: 6e74 6572 6e61 6c2e 6d61 696e 2069 6d70  nternal.main imp
-00009380: 6f72 7420 5f64 6574 6572 6d69 6e65 5f61  ort _determine_a
-00009390: 6363 6f75 6e74 0a20 2020 2020 2020 2077  ccount.        w
-000093a0: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
-000093b0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-000093c0: 6c2e 6d61 696e 2e61 6363 6f75 6e74 2e41  l.main.account.A
-000093d0: 6363 6f75 6e74 4669 6c65 5374 6f72 6167  ccountFileStorag
-000093e0: 6527 2920 6173 206d 6f63 6b5f 7374 6f72  e') as mock_stor
-000093f0: 6167 652c 205c 0a20 2020 2020 2020 2020  age, \.         
-00009400: 2020 2020 7465 7374 5f75 7469 6c2e 7061      test_util.pa
-00009410: 7463 685f 6469 7370 6c61 795f 7574 696c  tch_display_util
-00009420: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00009430: 6d6f 636b 5f73 746f 7261 6765 2e72 6574  mock_storage.ret
-00009440: 7572 6e5f 7661 6c75 6520 3d20 7365 6c66  urn_value = self
-00009450: 2e61 6363 6f75 6e74 5f73 746f 7261 6765  .account_storage
-00009460: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00009470: 7572 6e20 5f64 6574 6572 6d69 6e65 5f61  urn _determine_a
-00009480: 6363 6f75 6e74 2873 656c 662e 636f 6e66  ccount(self.conf
-00009490: 6967 290a 0a20 2020 2040 6d6f 636b 2e70  ig)..    @mock.p
-000094a0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000094b0: 6e74 6572 6e61 6c2e 636c 6965 6e74 2e72  nternal.client.r
-000094c0: 6567 6973 7465 7227 290a 2020 2020 406d  egister').    @m
-000094d0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-000094e0: 6f74 2e5f 696e 7465 726e 616c 2e63 6c69  ot._internal.cli
-000094f0: 656e 742e 6469 7370 6c61 795f 6f70 732e  ent.display_ops.
-00009500: 6765 745f 656d 6169 6c27 290a 2020 2020  get_email').    
-00009510: 6465 6620 5f72 6567 6973 7465 725f 6572  def _register_er
-00009520: 726f 725f 636f 6d6d 6f6e 2873 656c 662c  ror_common(self,
-00009530: 2065 7272 5f6d 7367 2c20 6578 6365 7074   err_msg, except
-00009540: 696f 6e2c 206d 6f63 6b5f 6765 745f 656d  ion, mock_get_em
-00009550: 6169 6c2c 206d 6f63 6b5f 7265 6769 7374  ail, mock_regist
-00009560: 6572 293a 0a20 2020 2020 2020 206d 6f63  er):.        moc
-00009570: 6b5f 6765 745f 656d 6169 6c2e 7265 7475  k_get_email.retu
-00009580: 726e 5f76 616c 7565 203d 2027 666f 6f40  rn_value = 'foo@
-00009590: 6261 722e 6261 7a27 0a20 2020 2020 2020  bar.baz'.       
-000095a0: 206d 6f63 6b5f 7265 6769 7374 6572 2e73   mock_register.s
-000095b0: 6964 655f 6566 6665 6374 203d 2065 7863  ide_effect = exc
-000095c0: 6570 7469 6f6e 0a20 2020 2020 2020 2074  eption.        t
-000095d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000095e0: 7365 6c66 2e5f 6361 6c6c 2829 0a20 2020  self._call().   
-000095f0: 2020 2020 2065 7863 6570 7420 6572 726f       except erro
-00009600: 7273 2e45 7272 6f72 2061 7320 6572 723a  rs.Error as err:
-00009610: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00009620: 6572 7420 6622 556e 6162 6c65 2074 6f20  ert f"Unable to 
-00009630: 7265 6769 7374 6572 2061 6e20 6163 636f  register an acco
-00009640: 756e 7420 7769 7468 2041 434d 4520 7365  unt with ACME se
-00009650: 7276 6572 2e20 7b65 7272 5f6d 7367 7d22  rver. {err_msg}"
-00009660: 203d 3d20 5c0a 2020 2020 2020 2020 2020   == \.          
-00009670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009680: 2020 2073 7472 2865 7272 290a 0a20 2020     str(err)..   
-00009690: 2064 6566 2074 6573 745f 6172 6773 5f61   def test_args_a
-000096a0: 6363 6f75 6e74 5f73 6574 2873 656c 6629  ccount_set(self)
-000096b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e61  :.        self.a
-000096c0: 6363 6f75 6e74 5f73 746f 7261 6765 2e73  ccount_storage.s
-000096d0: 6176 6528 7365 6c66 2e61 6363 735b 315d  ave(self.accs[1]
-000096e0: 2c20 7365 6c66 2e6d 6f63 6b5f 636c 6965  , self.mock_clie
-000096f0: 6e74 290a 2020 2020 2020 2020 7365 6c66  nt).        self
-00009700: 2e63 6f6e 6669 672e 6163 636f 756e 7420  .config.account 
-00009710: 3d20 7365 6c66 2e61 6363 735b 315d 2e69  = self.accs[1].i
-00009720: 640a 2020 2020 2020 2020 6173 7365 7274  d.        assert
-00009730: 2028 7365 6c66 2e61 6363 735b 315d 2c20   (self.accs[1], 
-00009740: 4e6f 6e65 2920 3d3d 2073 656c 662e 5f63  None) == self._c
-00009750: 616c 6c28 290a 2020 2020 2020 2020 6173  all().        as
-00009760: 7365 7274 2073 656c 662e 6163 6373 5b31  sert self.accs[1
-00009770: 5d2e 6964 203d 3d20 7365 6c66 2e63 6f6e  ].id == self.con
-00009780: 6669 672e 6163 636f 756e 740a 2020 2020  fig.account.    
-00009790: 2020 2020 6173 7365 7274 2073 656c 662e      assert self.
-000097a0: 636f 6e66 6967 2e65 6d61 696c 2069 7320  config.email is 
-000097b0: 4e6f 6e65 0a0a 2020 2020 6465 6620 7465  None..    def te
-000097c0: 7374 5f73 696e 676c 655f 6163 636f 756e  st_single_accoun
-000097d0: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-000097e0: 2073 656c 662e 6163 636f 756e 745f 7374   self.account_st
-000097f0: 6f72 6167 652e 7361 7665 2873 656c 662e  orage.save(self.
-00009800: 6163 6373 5b30 5d2c 2073 656c 662e 6d6f  accs[0], self.mo
-00009810: 636b 5f63 6c69 656e 7429 0a20 2020 2020  ck_client).     
-00009820: 2020 2061 7373 6572 7420 2873 656c 662e     assert (self.
-00009830: 6163 6373 5b30 5d2c 204e 6f6e 6529 203d  accs[0], None) =
-00009840: 3d20 7365 6c66 2e5f 6361 6c6c 2829 0a20  = self._call(). 
-00009850: 2020 2020 2020 2061 7373 6572 7420 7365         assert se
-00009860: 6c66 2e61 6363 735b 305d 2e69 6420 3d3d  lf.accs[0].id ==
-00009870: 2073 656c 662e 636f 6e66 6967 2e61 6363   self.config.acc
-00009880: 6f75 6e74 0a20 2020 2020 2020 2061 7373  ount.        ass
-00009890: 6572 7420 7365 6c66 2e63 6f6e 6669 672e  ert self.config.
-000098a0: 656d 6169 6c20 6973 204e 6f6e 650a 0a20  email is None.. 
-000098b0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-000098c0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-000098d0: 6c2e 636c 6965 6e74 2e64 6973 706c 6179  l.client.display
-000098e0: 5f6f 7073 2e63 686f 6f73 655f 6163 636f  _ops.choose_acco
-000098f0: 756e 7427 290a 2020 2020 6465 6620 7465  unt').    def te
-00009900: 7374 5f6d 756c 7469 706c 655f 6163 636f  st_multiple_acco
-00009910: 756e 7473 2873 656c 662c 206d 6f63 6b5f  unts(self, mock_
-00009920: 6368 6f6f 7365 5f61 6363 6f75 6e74 7329  choose_accounts)
-00009930: 3a0a 2020 2020 2020 2020 666f 7220 6163  :.        for ac
-00009940: 6320 696e 2073 656c 662e 6163 6373 3a0a  c in self.accs:.
-00009950: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009960: 2e61 6363 6f75 6e74 5f73 746f 7261 6765  .account_storage
-00009970: 2e73 6176 6528 6163 632c 2073 656c 662e  .save(acc, self.
-00009980: 6d6f 636b 5f63 6c69 656e 7429 0a20 2020  mock_client).   
-00009990: 2020 2020 206d 6f63 6b5f 6368 6f6f 7365       mock_choose
-000099a0: 5f61 6363 6f75 6e74 732e 7265 7475 726e  _accounts.return
-000099b0: 5f76 616c 7565 203d 2073 656c 662e 6163  _value = self.ac
-000099c0: 6373 5b31 5d0a 2020 2020 2020 2020 6173  cs[1].        as
-000099d0: 7365 7274 2028 7365 6c66 2e61 6363 735b  sert (self.accs[
-000099e0: 315d 2c20 4e6f 6e65 2920 3d3d 2073 656c  1], None) == sel
-000099f0: 662e 5f63 616c 6c28 290a 2020 2020 2020  f._call().      
-00009a00: 2020 6173 7365 7274 2073 6574 286d 6f63    assert set(moc
-00009a10: 6b5f 6368 6f6f 7365 5f61 6363 6f75 6e74  k_choose_account
-00009a20: 732e 6361 6c6c 5f61 7267 735b 305d 5b30  s.call_args[0][0
-00009a30: 5d29 203d 3d20 7365 7428 7365 6c66 2e61  ]) == set(self.a
-00009a40: 6363 7329 0a20 2020 2020 2020 2061 7373  ccs).        ass
-00009a50: 6572 7420 7365 6c66 2e61 6363 735b 315d  ert self.accs[1]
-00009a60: 2e69 6420 3d3d 2073 656c 662e 636f 6e66  .id == self.conf
-00009a70: 6967 2e61 6363 6f75 6e74 0a20 2020 2020  ig.account.     
-00009a80: 2020 2061 7373 6572 7420 7365 6c66 2e63     assert self.c
-00009a90: 6f6e 6669 672e 656d 6169 6c20 6973 204e  onfig.email is N
-00009aa0: 6f6e 650a 0a20 2020 2040 6d6f 636b 2e70  one..    @mock.p
-00009ab0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00009ac0: 6e74 6572 6e61 6c2e 636c 6965 6e74 2e64  nternal.client.d
-00009ad0: 6973 706c 6179 5f6f 7073 2e63 686f 6f73  isplay_ops.choos
-00009ae0: 655f 6163 636f 756e 7427 290a 2020 2020  e_account').    
-00009af0: 6465 6620 7465 7374 5f6d 756c 7469 706c  def test_multipl
-00009b00: 655f 6163 636f 756e 7473 5f63 616e 6365  e_accounts_cance
-00009b10: 6c65 6428 7365 6c66 2c20 6d6f 636b 5f63  led(self, mock_c
-00009b20: 686f 6f73 655f 6163 636f 756e 7473 293a  hoose_accounts):
-00009b30: 0a20 2020 2020 2020 2066 6f72 2061 6363  .        for acc
-00009b40: 2069 6e20 7365 6c66 2e61 6363 733a 0a20   in self.accs:. 
-00009b50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009b60: 6163 636f 756e 745f 7374 6f72 6167 652e  account_storage.
-00009b70: 7361 7665 2861 6363 2c20 7365 6c66 2e6d  save(acc, self.m
-00009b80: 6f63 6b5f 636c 6965 6e74 290a 2020 2020  ock_client).    
-00009b90: 2020 2020 6d6f 636b 5f63 686f 6f73 655f      mock_choose_
-00009ba0: 6163 636f 756e 7473 2e72 6574 7572 6e5f  accounts.return_
-00009bb0: 7661 6c75 6520 3d20 4e6f 6e65 0a20 2020  value = None.   
-00009bc0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00009bd0: 2020 2020 2020 7365 6c66 2e5f 6361 6c6c        self._call
-00009be0: 2829 0a20 2020 2020 2020 2065 7863 6570  ().        excep
-00009bf0: 7420 6572 726f 7273 2e45 7272 6f72 2061  t errors.Error a
-00009c00: 7320 6572 723a 0a20 2020 2020 2020 2020  s err:.         
-00009c10: 2020 2061 7373 6572 7420 224e 6f20 6163     assert "No ac
-00009c20: 636f 756e 7420 6861 7320 6265 656e 2063  count has been c
-00009c30: 686f 7365 6e22 2069 6e20 7374 7228 6572  hosen" in str(er
-00009c40: 7229 0a0a 2020 2020 406d 6f63 6b2e 7061  r)..    @mock.pa
-00009c50: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00009c60: 7465 726e 616c 2e63 6c69 656e 742e 6469  ternal.client.di
-00009c70: 7370 6c61 795f 6f70 732e 6765 745f 656d  splay_ops.get_em
-00009c80: 6169 6c27 290a 2020 2020 406d 6f63 6b2e  ail').    @mock.
-00009c90: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00009ca0: 696e 7465 726e 616c 2e6d 6169 6e2e 6469  internal.main.di
-00009cb0: 7370 6c61 795f 7574 696c 2e6e 6f74 6966  splay_util.notif
-00009cc0: 7927 290a 2020 2020 6465 6620 7465 7374  y').    def test
-00009cd0: 5f6e 6f5f 6163 636f 756e 7473 5f6e 6f5f  _no_accounts_no_
-00009ce0: 656d 6169 6c28 7365 6c66 2c20 6d6f 636b  email(self, mock
-00009cf0: 5f6e 6f74 6966 792c 206d 6f63 6b5f 6765  _notify, mock_ge
-00009d00: 745f 656d 6169 6c29 3a0a 2020 2020 2020  t_email):.      
-00009d10: 2020 6d6f 636b 5f67 6574 5f65 6d61 696c    mock_get_email
-00009d20: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00009d30: 2766 6f6f 4062 6172 2e62 617a 270a 0a20  'foo@bar.baz'.. 
-00009d40: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-00009d50: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-00009d60: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e63  _internal.main.c
-00009d70: 6c69 656e 7427 2920 6173 2063 6c69 656e  lient') as clien
-00009d80: 743a 0a20 2020 2020 2020 2020 2020 2063  t:.            c
-00009d90: 6c69 656e 742e 7265 6769 7374 6572 2e72  lient.register.r
-00009da0: 6574 7572 6e5f 7661 6c75 6520 3d20 280a  eturn_value = (.
-00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dc0: 7365 6c66 2e61 6363 735b 305d 2c20 6d6f  self.accs[0], mo
-00009dd0: 636b 2e73 656e 7469 6e65 6c2e 6163 6d65  ck.sentinel.acme
-00009de0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00009df0: 7365 7274 2028 7365 6c66 2e61 6363 735b  sert (self.accs[
-00009e00: 305d 2c20 6d6f 636b 2e73 656e 7469 6e65  0], mock.sentine
-00009e10: 6c2e 6163 6d65 2920 3d3d 2073 656c 662e  l.acme) == self.
-00009e20: 5f63 616c 6c28 290a 2020 2020 2020 2020  _call().        
-00009e30: 636c 6965 6e74 2e72 6567 6973 7465 722e  client.register.
-00009e40: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-00009e50: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
-00009e60: 2020 2020 2073 656c 662e 636f 6e66 6967       self.config
-00009e70: 2c20 7365 6c66 2e61 6363 6f75 6e74 5f73  , self.account_s
-00009e80: 746f 7261 6765 2c20 746f 735f 6362 3d6d  torage, tos_cb=m
-00009e90: 6f63 6b2e 414e 5929 0a0a 2020 2020 2020  ock.ANY)..      
-00009ea0: 2020 6173 7365 7274 2073 656c 662e 6163    assert self.ac
-00009eb0: 6373 5b30 5d2e 6964 203d 3d20 7365 6c66  cs[0].id == self
-00009ec0: 2e63 6f6e 6669 672e 6163 636f 756e 740a  .config.account.
-00009ed0: 2020 2020 2020 2020 6173 7365 7274 2027          assert '
-00009ee0: 666f 6f40 6261 722e 6261 7a27 203d 3d20  foo@bar.baz' == 
-00009ef0: 7365 6c66 2e63 6f6e 6669 672e 656d 6169  self.config.emai
-00009f00: 6c0a 2020 2020 2020 2020 6d6f 636b 5f6e  l.        mock_n
-00009f10: 6f74 6966 792e 6173 7365 7274 5f63 616c  otify.assert_cal
-00009f20: 6c65 645f 6f6e 6365 5f77 6974 6828 2741  led_once_with('A
-00009f30: 6363 6f75 6e74 2072 6567 6973 7465 7265  ccount registere
-00009f40: 642e 2729 0a0a 2020 2020 6465 6620 7465  d.')..    def te
-00009f50: 7374 5f6e 6f5f 6163 636f 756e 7473 5f65  st_no_accounts_e
-00009f60: 6d61 696c 2873 656c 6629 3a0a 2020 2020  mail(self):.    
-00009f70: 2020 2020 7365 6c66 2e63 6f6e 6669 672e      self.config.
-00009f80: 656d 6169 6c20 3d20 276f 7468 6572 2065  email = 'other e
-00009f90: 6d61 696c 270a 2020 2020 2020 2020 7769  mail'.        wi
-00009fa0: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
-00009fb0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-00009fc0: 2e6d 6169 6e2e 636c 6965 6e74 2729 2061  .main.client') a
-00009fd0: 7320 636c 6965 6e74 3a0a 2020 2020 2020  s client:.      
-00009fe0: 2020 2020 2020 636c 6965 6e74 2e72 6567        client.reg
-00009ff0: 6973 7465 722e 7265 7475 726e 5f76 616c  ister.return_val
-0000a000: 7565 203d 2028 7365 6c66 2e61 6363 735b  ue = (self.accs[
-0000a010: 315d 2c20 6d6f 636b 2e73 656e 7469 6e65  1], mock.sentine
-0000a020: 6c2e 6163 6d65 290a 2020 2020 2020 2020  l.acme).        
-0000a030: 2020 2020 7365 6c66 2e5f 6361 6c6c 2829      self._call()
-0000a040: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0000a050: 7365 6c66 2e61 6363 735b 315d 2e69 6420  self.accs[1].id 
-0000a060: 3d3d 2073 656c 662e 636f 6e66 6967 2e61  == self.config.a
-0000a070: 6363 6f75 6e74 0a20 2020 2020 2020 2061  ccount.        a
-0000a080: 7373 6572 7420 276f 7468 6572 2065 6d61  ssert 'other ema
-0000a090: 696c 2720 3d3d 2073 656c 662e 636f 6e66  il' == self.conf
-0000a0a0: 6967 2e65 6d61 696c 0a0a 2020 2020 6465  ig.email..    de
-0000a0b0: 6620 7465 7374 5f72 6567 6973 7465 725f  f test_register_
-0000a0c0: 6572 726f 725f 6365 7274 626f 7428 7365  error_certbot(se
-0000a0d0: 6c66 293a 0a20 2020 2020 2020 2065 7272  lf):.        err
-0000a0e0: 5f6d 7367 203d 2022 536f 6d65 2065 7272  _msg = "Some err
-0000a0f0: 6f72 206d 6573 7361 6765 2072 6169 7365  or message raise
-0000a100: 6420 6279 2043 6572 7462 6f74 220a 2020  d by Certbot".  
-0000a110: 2020 2020 2020 7365 6c66 2e5f 7265 6769        self._regi
-0000a120: 7374 6572 5f65 7272 6f72 5f63 6f6d 6d6f  ster_error_commo
-0000a130: 6e28 6572 725f 6d73 672c 2065 7272 6f72  n(err_msg, error
-0000a140: 732e 4572 726f 7228 6572 725f 6d73 6729  s.Error(err_msg)
-0000a150: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000a160: 7265 6769 7374 6572 5f65 7272 6f72 5f61  register_error_a
-0000a170: 636d 655f 7479 7065 5f61 6e64 5f64 6574  cme_type_and_det
-0000a180: 6169 6c28 7365 6c66 293a 0a20 2020 2020  ail(self):.     
-0000a190: 2020 2065 7272 5f6d 7367 203d 2028 2245     err_msg = ("E
-0000a1a0: 7272 6f72 2072 6574 7572 6e65 6420 6279  rror returned by
-0000a1b0: 2074 6865 2041 434d 4520 7365 7276 6572   the ACME server
-0000a1c0: 3a20 6d75 7374 2061 6772 6565 2074 6f20  : must agree to 
-0000a1d0: 7465 726d 7320 6f66 2073 6572 7669 6365  terms of service
-0000a1e0: 2229 0a20 2020 2020 2020 2065 7863 6570  ").        excep
-0000a1f0: 7469 6f6e 203d 2061 636d 655f 6572 726f  tion = acme_erro
-0000a200: 7228 7479 7020 3d20 2275 726e 3a69 6574  r(typ = "urn:iet
-0000a210: 663a 7061 7261 6d73 3a61 636d 653a 6572  f:params:acme:er
-0000a220: 726f 723a 6d61 6c66 6f72 6d65 6422 2c0a  ror:malformed",.
-0000a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a240: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000a250: 6574 6169 6c20 3d20 226d 7573 7420 6167  etail = "must ag
-0000a260: 7265 6520 746f 2074 6572 6d73 206f 6620  ree to terms of 
-0000a270: 7365 7276 6963 6522 290a 2020 2020 2020  service").      
-0000a280: 2020 7365 6c66 2e5f 7265 6769 7374 6572    self._register
-0000a290: 5f65 7272 6f72 5f63 6f6d 6d6f 6e28 6572  _error_common(er
-0000a2a0: 725f 6d73 672c 2065 7863 6570 7469 6f6e  r_msg, exception
-0000a2b0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000a2c0: 7265 6769 7374 6572 5f65 7272 6f72 5f61  register_error_a
-0000a2d0: 636d 655f 7479 7065 5f6f 6e6c 7928 7365  cme_type_only(se
-0000a2e0: 6c66 293a 0a20 2020 2020 2020 2065 7272  lf):.        err
-0000a2f0: 5f6d 7367 203d 2028 2245 7272 6f72 2072  _msg = ("Error r
-0000a300: 6574 7572 6e65 6420 6279 2074 6865 2041  eturned by the A
-0000a310: 434d 4520 7365 7276 6572 3a20 5468 6520  CME server: The 
-0000a320: 7365 7276 6572 2065 7870 6572 6965 6e63  server experienc
-0000a330: 6564 2061 6e20 696e 7465 726e 616c 2065  ed an internal e
-0000a340: 7272 6f72 2229 0a20 2020 2020 2020 2065  rror").        e
-0000a350: 7863 6570 7469 6f6e 203d 2061 636d 655f  xception = acme_
-0000a360: 6572 726f 7228 7479 7020 3d20 2275 726e  error(typ = "urn
-0000a370: 3a69 6574 663a 7061 7261 6d73 3a61 636d  :ietf:params:acm
-0000a380: 653a 6572 726f 723a 7365 7276 6572 496e  e:error:serverIn
-0000a390: 7465 726e 616c 2229 0a20 2020 2020 2020  ternal").       
-0000a3a0: 2073 656c 662e 5f72 6567 6973 7465 725f   self._register_
-0000a3b0: 6572 726f 725f 636f 6d6d 6f6e 2865 7272  error_common(err
-0000a3c0: 5f6d 7367 2c20 6578 6365 7074 696f 6e29  _msg, exception)
-0000a3d0: 0a0a 0a63 6c61 7373 204d 6169 6e54 6573  ...class MainTes
-0000a3e0: 7428 7465 7374 5f75 7469 6c2e 436f 6e66  t(test_util.Conf
-0000a3f0: 6967 5465 7374 4361 7365 293a 0a20 2020  igTestCase):.   
-0000a400: 2022 2222 5465 7374 7320 666f 7220 6469   """Tests for di
-0000a410: 6666 6572 656e 7420 636f 6d6d 616e 6473  fferent commands
-0000a420: 2e22 2222 0a0a 2020 2020 6465 6620 7365  ."""..    def se
-0000a430: 7455 7028 7365 6c66 293a 0a20 2020 2020  tUp(self):.     
-0000a440: 2020 2073 7570 6572 2829 2e73 6574 5570     super().setUp
-0000a450: 2829 0a0a 2020 2020 2020 2020 6669 6c65  ()..        file
-0000a460: 7379 7374 656d 2e6d 6b64 6972 2873 656c  system.mkdir(sel
-0000a470: 662e 636f 6e66 6967 2e6c 6f67 735f 6469  f.config.logs_di
-0000a480: 7229 0a20 2020 2020 2020 2073 656c 662e  r).        self.
-0000a490: 7374 616e 6461 7264 5f61 7267 7320 3d20  standard_args = 
-0000a4a0: 5b27 2d2d 636f 6e66 6967 2d64 6972 272c  ['--config-dir',
-0000a4b0: 2073 656c 662e 636f 6e66 6967 2e63 6f6e   self.config.con
-0000a4c0: 6669 675f 6469 722c 0a20 2020 2020 2020  fig_dir,.       
-0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4e0: 2020 2020 2020 2027 2d2d 776f 726b 2d64         '--work-d
-0000a4f0: 6972 272c 2073 656c 662e 636f 6e66 6967  ir', self.config
-0000a500: 2e77 6f72 6b5f 6469 722c 0a20 2020 2020  .work_dir,.     
-0000a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a520: 2020 2020 2020 2020 2027 2d2d 6c6f 6773           '--logs
-0000a530: 2d64 6972 272c 2073 656c 662e 636f 6e66  -dir', self.conf
-0000a540: 6967 2e6c 6f67 735f 6469 722c 2027 2d2d  ig.logs_dir, '--
-0000a550: 7465 7874 275d 0a0a 2020 2020 2020 2020  text']..        
-0000a560: 7365 6c66 2e6d 6f63 6b5f 736c 6565 7020  self.mock_sleep 
-0000a570: 3d20 6d6f 636b 2e70 6174 6368 2827 7469  = mock.patch('ti
-0000a580: 6d65 2e73 6c65 6570 2729 2e73 7461 7274  me.sleep').start
-0000a590: 2829 0a0a 2020 2020 6465 6620 7465 6172  ()..    def tear
-0000a5a0: 446f 776e 2873 656c 6629 3a0a 2020 2020  Down(self):.    
-0000a5b0: 2020 2020 2320 5265 7365 7420 676c 6f62      # Reset glob
-0000a5c0: 616c 7320 696e 2063 6c69 0a20 2020 2020  als in cli.     
-0000a5d0: 2020 2072 656c 6f61 645f 6d6f 6475 6c65     reload_module
-0000a5e0: 2863 6c69 290a 0a20 2020 2020 2020 2073  (cli)..        s
-0000a5f0: 7570 6572 2829 2e74 6561 7244 6f77 6e28  uper().tearDown(
-0000a600: 290a 0a20 2020 2064 6566 205f 6361 6c6c  )..    def _call
-0000a610: 2873 656c 662c 2061 7267 732c 2073 7464  (self, args, std
-0000a620: 6f75 743d 4e6f 6e65 2c20 6d6f 636b 6973  out=None, mockis
-0000a630: 6669 6c65 3d46 616c 7365 293a 0a20 2020  file=False):.   
-0000a640: 2020 2020 2022 2222 5275 6e20 7468 6520       """Run the 
-0000a650: 636c 6920 7769 7468 206f 7574 7075 7420  cli with output 
-0000a660: 7374 7265 616d 732c 2061 6374 7561 6c20  streams, actual 
-0000a670: 636c 6965 6e74 2061 6e64 206f 7074 696f  client and optio
-0000a680: 6e61 6c6c 790a 2020 2020 2020 2020 6f73  nally.        os
-0000a690: 2e70 6174 682e 6973 6669 6c65 2829 206d  .path.isfile() m
-0000a6a0: 6f63 6b65 6420 6f75 7422 2222 0a0a 2020  ocked out"""..  
-0000a6b0: 2020 2020 2020 6966 206d 6f63 6b69 7366        if mockisf
-0000a6c0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0000a6d0: 206f 7269 675f 6f70 656e 203d 206f 732e   orig_open = os.
-0000a6e0: 7061 7468 2e69 7366 696c 650a 0a20 2020  path.isfile..   
-0000a6f0: 2020 2020 2020 2020 2064 6566 206d 6f63           def moc
-0000a700: 6b5f 6973 6669 6c65 2866 6e2c 202a 6172  k_isfile(fn, *ar
-0000a710: 6773 2c20 2a2a 6b77 6172 6773 293a 2020  gs, **kwargs):  
-0000a720: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
-0000a730: 653d 756e 7573 6564 2d61 7267 756d 656e  e=unused-argumen
-0000a740: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000a750: 2020 2222 224d 6f63 6b20 6f73 2e70 6174    """Mock os.pat
-0000a760: 682e 6973 6669 6c65 2829 2222 220a 2020  h.isfile()""".  
-0000a770: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000a780: 2028 666e 2e65 6e64 7377 6974 6828 2263   (fn.endswith("c
-0000a790: 6572 7422 2920 6f72 0a20 2020 2020 2020  ert") or.       
-0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7b0: 2066 6e2e 656e 6473 7769 7468 2822 6368   fn.endswith("ch
-0000a7c0: 6169 6e22 2920 6f72 0a20 2020 2020 2020  ain") or.       
-0000a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7e0: 2066 6e2e 656e 6473 7769 7468 2822 7072   fn.endswith("pr
-0000a7f0: 6976 6b65 7922 2929 3a0a 2020 2020 2020  ivkey")):.      
-0000a800: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000a810: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0000a820: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000a830: 206f 7269 675f 6f70 656e 2866 6e29 0a0a   orig_open(fn)..
-0000a840: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000a850: 206d 6f63 6b2e 7061 7463 6828 2263 6572   mock.patch("cer
-0000a860: 7462 6f74 2e63 6f6d 7061 742e 6f73 2e70  tbot.compat.os.p
-0000a870: 6174 682e 6973 6669 6c65 2229 2061 7320  ath.isfile") as 
-0000a880: 6d6f 636b 5f69 663a 0a20 2020 2020 2020  mock_if:.       
-0000a890: 2020 2020 2020 2020 206d 6f63 6b5f 6966           mock_if
-0000a8a0: 2e73 6964 655f 6566 6665 6374 203d 206d  .side_effect = m
-0000a8b0: 6f63 6b5f 6973 6669 6c65 0a20 2020 2020  ock_isfile.     
-0000a8c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000a8d0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0000a8e0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-0000a8f0: 696e 2e63 6c69 656e 7427 2920 6173 2063  in.client') as c
-0000a900: 6c69 656e 743a 0a20 2020 2020 2020 2020  lient:.         
-0000a910: 2020 2020 2020 2020 2020 2072 6574 2c20             ret, 
-0000a920: 7374 646f 7574 2c20 7374 6465 7272 203d  stdout, stderr =
-0000a930: 2073 656c 662e 5f63 616c 6c5f 6e6f 5f63   self._call_no_c
-0000a940: 6c69 656e 746d 6f63 6b28 6172 6773 2c20  lientmock(args, 
-0000a950: 7374 646f 7574 290a 2020 2020 2020 2020  stdout).        
-0000a960: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a970: 726e 2072 6574 2c20 7374 646f 7574 2c20  rn ret, stdout, 
-0000a980: 7374 6465 7272 2c20 636c 6965 6e74 0a20  stderr, client. 
-0000a990: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a9a0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
-0000a9b0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-0000a9c0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-0000a9d0: 2e63 6c69 656e 7427 2920 6173 2063 6c69  .client') as cli
-0000a9e0: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-0000a9f0: 2020 2020 2072 6574 2c20 7374 646f 7574       ret, stdout
-0000aa00: 2c20 7374 6465 7272 203d 2073 656c 662e  , stderr = self.
-0000aa10: 5f63 616c 6c5f 6e6f 5f63 6c69 656e 746d  _call_no_clientm
-0000aa20: 6f63 6b28 6172 6773 2c20 7374 646f 7574  ock(args, stdout
-0000aa30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000aa40: 2020 7265 7475 726e 2072 6574 2c20 7374    return ret, st
-0000aa50: 646f 7574 2c20 7374 6465 7272 2c20 636c  dout, stderr, cl
-0000aa60: 6965 6e74 0a0a 2020 2020 6465 6620 5f63  ient..    def _c
-0000aa70: 616c 6c5f 6e6f 5f63 6c69 656e 746d 6f63  all_no_clientmoc
-0000aa80: 6b28 7365 6c66 2c20 6172 6773 2c20 7374  k(self, args, st
-0000aa90: 646f 7574 3d4e 6f6e 6529 3a0a 2020 2020  dout=None):.    
-0000aaa0: 2020 2020 2222 2252 756e 2074 6865 2063      """Run the c
-0000aab0: 6c69 656e 7420 7769 7468 206f 7574 7075  lient with outpu
-0000aac0: 7420 7374 7265 616d 7320 6d6f 636b 6564  t streams mocked
-0000aad0: 206f 7574 2222 220a 2020 2020 2020 2020   out""".        
-0000aae0: 6172 6773 203d 2073 656c 662e 7374 616e  args = self.stan
-0000aaf0: 6461 7264 5f61 7267 7320 2b20 6172 6773  dard_args + args
-0000ab00: 0a0a 2020 2020 2020 2020 746f 795f 7374  ..        toy_st
-0000ab10: 646f 7574 203d 2073 7464 6f75 7420 6966  dout = stdout if
-0000ab20: 2073 7464 6f75 7420 656c 7365 2069 6f2e   stdout else io.
-0000ab30: 5374 7269 6e67 494f 2829 0a20 2020 2020  StringIO().     
-0000ab40: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
-0000ab50: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-0000ab60: 6572 6e61 6c2e 6d61 696e 2e73 7973 2e73  ernal.main.sys.s
-0000ab70: 7464 6f75 7427 2c20 6e65 773d 746f 795f  tdout', new=toy_
-0000ab80: 7374 646f 7574 293a 0a20 2020 2020 2020  stdout):.       
-0000ab90: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-0000aba0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-0000abb0: 6e74 6572 6e61 6c2e 6d61 696e 2e73 7973  nternal.main.sys
-0000abc0: 2e73 7464 6572 7227 2920 6173 2073 7464  .stderr') as std
-0000abd0: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
-0000abe0: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-0000abf0: 6174 6368 2822 6365 7274 626f 742e 7574  atch("certbot.ut
-0000ac00: 696c 2e61 7465 7869 7422 293a 0a20 2020  il.atexit"):.   
-0000ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac20: 2072 6574 203d 206d 6169 6e2e 6d61 696e   ret = main.main
-0000ac30: 2861 7267 735b 3a5d 2920 2023 204e 4f54  (args[:])  # NOT
-0000ac40: 453a 2070 6172 7365 7220 6361 6e20 616c  E: parser can al
-0000ac50: 7465 7220 6974 7320 6172 6773 210a 2020  ter its args!.  
-0000ac60: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
-0000ac70: 2c20 746f 795f 7374 646f 7574 2c20 7374  , toy_stdout, st
-0000ac80: 6465 7272 0a0a 2020 2020 6465 6620 7465  derr..    def te
-0000ac90: 7374 5f6e 6f5f 666c 6167 7328 7365 6c66  st_no_flags(self
-0000aca0: 293a 0a20 2020 2020 2020 2077 6974 6820  ):.        with 
-0000acb0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0000acc0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-0000acd0: 696e 2e72 756e 2729 2061 7320 6d6f 636b  in.run') as mock
-0000ace0: 5f72 756e 3a0a 2020 2020 2020 2020 2020  _run:.          
-0000acf0: 2020 7365 6c66 2e5f 6361 6c6c 285b 5d29    self._call([])
-0000ad00: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000ad10: 6572 7420 3120 3d3d 206d 6f63 6b5f 7275  ert 1 == mock_ru
-0000ad20: 6e2e 6361 6c6c 5f63 6f75 6e74 0a0a 2020  n.call_count..  
-0000ad30: 2020 6465 6620 7465 7374 5f76 6572 7369    def test_versi
-0000ad40: 6f6e 5f73 7472 696e 675f 7072 6f67 7261  on_string_progra
-0000ad50: 6d5f 6e61 6d65 2873 656c 6629 3a0a 2020  m_name(self):.  
-0000ad60: 2020 2020 2020 746f 795f 6f75 7420 3d20        toy_out = 
-0000ad70: 696f 2e53 7472 696e 6749 4f28 290a 2020  io.StringIO().  
-0000ad80: 2020 2020 2020 746f 795f 6572 7220 3d20        toy_err = 
-0000ad90: 696f 2e53 7472 696e 6749 4f28 290a 2020  io.StringIO().  
-0000ada0: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
-0000adb0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-0000adc0: 696e 7465 726e 616c 2e6d 6169 6e2e 7379  internal.main.sy
-0000add0: 732e 7374 646f 7574 272c 206e 6577 3d74  s.stdout', new=t
-0000ade0: 6f79 5f6f 7574 293a 0a20 2020 2020 2020  oy_out):.       
-0000adf0: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-0000ae00: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-0000ae10: 6e74 6572 6e61 6c2e 6d61 696e 2e73 7973  nternal.main.sys
-0000ae20: 2e73 7464 6572 7227 2c20 6e65 773d 746f  .stderr', new=to
-0000ae30: 795f 6572 7229 3a0a 2020 2020 2020 2020  y_err):.        
-0000ae40: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae60: 206d 6169 6e2e 6d61 696e 285b 222d 2d76   main.main(["--v
-0000ae70: 6572 7369 6f6e 225d 290a 2020 2020 2020  ersion"]).      
-0000ae80: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000ae90: 2053 7973 7465 6d45 7869 743a 0a20 2020   SystemExit:.   
-0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aeb0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-0000aec0: 2020 2020 2020 6669 6e61 6c6c 793a 0a20        finally:. 
-0000aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aee0: 2020 206f 7574 7075 7420 3d20 746f 795f     output = toy_
-0000aef0: 6f75 742e 6765 7476 616c 7565 2829 206f  out.getvalue() o
-0000af00: 7220 746f 795f 6572 722e 6765 7476 616c  r toy_err.getval
-0000af10: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-0000af20: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0000af30: 2263 6572 7462 6f74 2220 696e 206f 7574  "certbot" in out
-0000af40: 7075 742c 2022 4f75 7470 7574 2069 7320  put, "Output is 
-0000af50: 7b30 7d22 2e66 6f72 6d61 7428 6f75 7470  {0}".format(outp
-0000af60: 7574 290a 0a20 2020 2064 6566 205f 636c  ut)..    def _cl
-0000af70: 695f 6d69 7373 696e 675f 666c 6167 2873  i_missing_flag(s
-0000af80: 656c 662c 2061 7267 732c 206d 6573 7361  elf, args, messa
-0000af90: 6765 293a 0a20 2020 2020 2020 2022 456e  ge):.        "En
-0000afa0: 7375 7265 2074 6861 7420 6120 7061 7274  sure that a part
-0000afb0: 6963 756c 6172 2065 7272 6f72 2072 6169  icular error rai
-0000afc0: 7365 7320 6120 6d69 7373 696e 6720 636c  ses a missing cl
-0000afd0: 6920 666c 6167 2065 7272 6f72 2063 6f6e  i flag error con
-0000afe0: 7461 696e 696e 6720 6d65 7373 6167 6522  taining message"
-0000aff0: 0a20 2020 2020 2020 2065 7863 203d 204e  .        exc = N
-0000b000: 6f6e 650a 2020 2020 2020 2020 7472 793a  one.        try:
-0000b010: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000b020: 6820 6d6f 636b 2e70 6174 6368 2827 6365  h mock.patch('ce
-0000b030: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-0000b040: 6d61 696e 2e73 7973 2e73 7464 6572 7227  main.sys.stderr'
-0000b050: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b060: 2020 206d 6169 6e2e 6d61 696e 2873 656c     main.main(sel
-0000b070: 662e 7374 616e 6461 7264 5f61 7267 7320  f.standard_args 
-0000b080: 2b20 6172 6773 5b3a 5d29 2020 2320 4e4f  + args[:])  # NO
-0000b090: 5445 3a20 7061 7273 6572 2063 616e 2061  TE: parser can a
-0000b0a0: 6c74 6572 2069 7473 2061 7267 7321 0a20  lter its args!. 
-0000b0b0: 2020 2020 2020 2065 7863 6570 7420 6572         except er
-0000b0c0: 726f 7273 2e4d 6973 7369 6e67 436f 6d6d  rors.MissingComm
-0000b0d0: 616e 646c 696e 6546 6c61 6720 6173 2065  andlineFlag as e
-0000b0e0: 7863 5f3a 0a20 2020 2020 2020 2020 2020  xc_:.           
-0000b0f0: 2065 7863 203d 2065 7863 5f0a 2020 2020   exc = exc_.    
-0000b100: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-0000b110: 6573 7361 6765 2069 6e20 7374 7228 6578  essage in str(ex
-0000b120: 6329 0a20 2020 2020 2020 2061 7373 6572  c).        asser
-0000b130: 7420 6578 6320 6973 206e 6f74 204e 6f6e  t exc is not Non
-0000b140: 650a 0a20 2020 2040 6d6f 636b 2e70 6174  e..    @mock.pat
-0000b150: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-0000b160: 6572 6e61 6c2e 6c6f 672e 706f 7374 5f61  ernal.log.post_a
-0000b170: 7267 5f70 6172 7365 5f73 6574 7570 2729  rg_parse_setup')
-0000b180: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
-0000b190: 6e69 6e74 6572 6163 7469 7665 2873 656c  ninteractive(sel
-0000b1a0: 662c 205f 293a 0a20 2020 2020 2020 2061  f, _):.        a
-0000b1b0: 7267 7320 3d20 5b27 2d6e 272c 2027 6365  rgs = ['-n', 'ce
-0000b1c0: 7274 6f6e 6c79 275d 0a20 2020 2020 2020  rtonly'].       
-0000b1d0: 2073 656c 662e 5f63 6c69 5f6d 6973 7369   self._cli_missi
-0000b1e0: 6e67 5f66 6c61 6728 6172 6773 2c20 2273  ng_flag(args, "s
-0000b1f0: 7065 6369 6679 2061 2070 6c75 6769 6e22  pecify a plugin"
-0000b200: 290a 2020 2020 2020 2020 6172 6773 2e65  ).        args.e
-0000b210: 7874 656e 6428 5b27 2d2d 7374 616e 6461  xtend(['--standa
-0000b220: 6c6f 6e65 272c 2027 2d64 272c 2027 6567  lone', '-d', 'eg
-0000b230: 2e69 7327 5d29 0a20 2020 2020 2020 2073  .is']).        s
-0000b240: 656c 662e 5f63 6c69 5f6d 6973 7369 6e67  elf._cli_missing
-0000b250: 5f66 6c61 6728 6172 6773 2c20 2272 6567  _flag(args, "reg
-0000b260: 6973 7465 7220 6265 666f 7265 2072 756e  ister before run
-0000b270: 6e69 6e67 2229 0a0a 2020 2020 406d 6f63  ning")..    @moc
-0000b280: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-0000b290: 2e5f 696e 7465 726e 616c 2e65 6666 2e68  ._internal.eff.h
-0000b2a0: 616e 646c 655f 7375 6273 6372 6970 7469  andle_subscripti
-0000b2b0: 6f6e 2729 0a20 2020 2040 6d6f 636b 2e70  on').    @mock.p
-0000b2c0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-0000b2d0: 6e74 6572 6e61 6c2e 6c6f 672e 706f 7374  nternal.log.post
-0000b2e0: 5f61 7267 5f70 6172 7365 5f73 6574 7570  _arg_parse_setup
-0000b2f0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-0000b300: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-0000b310: 6572 6e61 6c2e 6d61 696e 2e5f 7265 706f  ernal.main._repo
-0000b320: 7274 5f6e 6577 5f63 6572 7427 290a 2020  rt_new_cert').  
-0000b330: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
-0000b340: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-0000b350: 2e6d 6169 6e2e 5f64 6574 6572 6d69 6e65  .main._determine
-0000b360: 5f61 6363 6f75 6e74 2729 0a20 2020 2040  _account').    @
-0000b370: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0000b380: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-0000b390: 696e 2e63 6c69 656e 742e 436c 6965 6e74  in.client.Client
-0000b3a0: 2e6f 6274 6169 6e5f 616e 645f 656e 726f  .obtain_and_enro
-0000b3b0: 6c6c 5f63 6572 7469 6669 6361 7465 2729  ll_certificate')
-0000b3c0: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-0000b3d0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-0000b3e0: 6e61 6c2e 6d61 696e 2e5f 6765 745f 616e  nal.main._get_an
-0000b3f0: 645f 7361 7665 5f63 6572 7427 290a 2020  d_save_cert').  
-0000b400: 2020 6465 6620 7465 7374 5f75 7365 725f    def test_user_
-0000b410: 6167 656e 7428 7365 6c66 2c20 6773 632c  agent(self, gsc,
-0000b420: 205f 6f62 742c 2064 6574 2c20 5f2c 205f   _obt, det, _, _
-0000b430: 5f2c 205f 5f5f 293a 0a20 2020 2020 2020  _, ___):.       
-0000b440: 2023 204e 6f72 6d61 6c6c 7920 7468 6520   # Normally the 
-0000b450: 636c 6965 6e74 2069 7320 746f 7461 6c6c  client is totall
-0000b460: 7920 6d6f 636b 6564 206f 7574 2c20 6275  y mocked out, bu
-0000b470: 7420 6865 7265 2077 6520 6e65 6564 206d  t here we need m
-0000b480: 6f72 650a 2020 2020 2020 2020 2320 6172  ore.        # ar
-0000b490: 6775 6d65 6e74 7320 746f 2061 7574 6f6d  guments to autom
-0000b4a0: 6174 6520 6974 2e2e 2e0a 2020 2020 2020  ate it....      
-0000b4b0: 2020 6172 6773 203d 205b 222d 2d73 7461    args = ["--sta
-0000b4c0: 6e64 616c 6f6e 6522 2c20 2263 6572 746f  ndalone", "certo
-0000b4d0: 6e6c 7922 2c20 222d 6d22 2c20 226e 6f6e  nly", "-m", "non
-0000b4e0: 6540 6e6f 6e65 2e63 6f6d 222c 0a20 2020  e@none.com",.   
-0000b4f0: 2020 2020 2020 2020 2020 2020 2022 2d64               "-d
-0000b500: 222c 2022 6578 616d 706c 652e 636f 6d22  ", "example.com"
-0000b510: 2c20 272d 2d61 6772 6565 2d74 6f73 275d  , '--agree-tos']
-0000b520: 202b 2073 656c 662e 7374 616e 6461 7264   + self.standard
-0000b530: 5f61 7267 730a 2020 2020 2020 2020 6465  _args.        de
-0000b540: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
-0000b550: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-0000b560: 292c 204e 6f6e 650a 2020 2020 2020 2020  ), None.        
-0000b570: 6773 632e 7265 7475 726e 5f76 616c 7565  gsc.return_value
-0000b580: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
-0000b590: 6b28 290a 0a20 2020 2020 2020 2077 6974  k()..        wit
-0000b5a0: 6820 6d6f 636b 2e70 6174 6368 2827 6365  h mock.patch('ce
-0000b5b0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-0000b5c0: 6d61 696e 2e63 6c69 656e 742e 6163 6d65  main.client.acme
-0000b5d0: 5f63 6c69 656e 7427 2920 6173 2061 636d  _client') as acm
-0000b5e0: 655f 636c 6965 6e74 3a0a 2020 2020 2020  e_client:.      
-0000b5f0: 2020 2020 2020 6163 6d65 5f6e 6574 203d        acme_net =
-0000b600: 2061 636d 655f 636c 6965 6e74 2e43 6c69   acme_client.Cli
-0000b610: 656e 744e 6574 776f 726b 0a20 2020 2020  entNetwork.     
-0000b620: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
-0000b630: 6c5f 6e6f 5f63 6c69 656e 746d 6f63 6b28  l_no_clientmock(
-0000b640: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
-0000b650: 2020 6f73 5f76 6572 203d 2075 7469 6c2e    os_ver = util.
-0000b660: 6765 745f 6f73 5f69 6e66 6f5f 7561 2829  get_os_info_ua()
-0000b670: 0a20 2020 2020 2020 2020 2020 2075 6120  .            ua 
-0000b680: 3d20 6163 6d65 5f6e 6574 2e63 616c 6c5f  = acme_net.call_
-0000b690: 6172 6773 5b31 5d5b 2275 7365 725f 6167  args[1]["user_ag
-0000b6a0: 656e 7422 5d0a 2020 2020 2020 2020 2020  ent"].          
-0000b6b0: 2020 6173 7365 7274 206f 735f 7665 7220    assert os_ver 
-0000b6c0: 696e 2075 610a 2020 2020 2020 2020 2020  in ua.          
-0000b6d0: 2020 696d 706f 7274 2070 6c61 7466 6f72    import platfor
-0000b6e0: 6d0a 2020 2020 2020 2020 2020 2020 706c  m.            pl
-0000b6f0: 6174 203d 2070 6c61 7466 6f72 6d2e 706c  at = platform.pl
-0000b700: 6174 666f 726d 2829 0a20 2020 2020 2020  atform().       
-0000b710: 2020 2020 2069 6620 226c 696e 7578 2220       if "linux" 
-0000b720: 696e 2070 6c61 742e 6c6f 7765 7228 293a  in plat.lower():
-0000b730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b740: 2061 7373 6572 7420 7574 696c 2e67 6574   assert util.get
-0000b750: 5f6f 735f 696e 666f 5f75 6128 2920 696e  _os_info_ua() in
-0000b760: 2075 610a 0a20 2020 2020 2020 2077 6974   ua..        wit
-0000b770: 6820 6d6f 636b 2e70 6174 6368 2827 6365  h mock.patch('ce
-0000b780: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-0000b790: 6d61 696e 2e63 6c69 656e 742e 6163 6d65  main.client.acme
-0000b7a0: 5f63 6c69 656e 7427 2920 6173 2061 636d  _client') as acm
-0000b7b0: 655f 636c 6965 6e74 3a0a 2020 2020 2020  e_client:.      
-0000b7c0: 2020 2020 2020 6163 6d65 5f6e 6574 203d        acme_net =
-0000b7d0: 2061 636d 655f 636c 6965 6e74 2e43 6c69   acme_client.Cli
-0000b7e0: 656e 744e 6574 776f 726b 0a20 2020 2020  entNetwork.     
-0000b7f0: 2020 2020 2020 2075 6120 3d20 2262 616e         ua = "ban
-0000b800: 6465 7273 6e61 7463 6822 0a20 2020 2020  dersnatch".     
-0000b810: 2020 2020 2020 2061 7267 7320 2b3d 205b         args += [
-0000b820: 222d 2d75 7365 722d 6167 656e 7422 2c20  "--user-agent", 
-0000b830: 7561 5d0a 2020 2020 2020 2020 2020 2020  ua].            
-0000b840: 7365 6c66 2e5f 6361 6c6c 5f6e 6f5f 636c  self._call_no_cl
-0000b850: 6965 6e74 6d6f 636b 2861 7267 7329 0a20  ientmock(args). 
-0000b860: 2020 2020 2020 2020 2020 2061 636d 655f             acme_
-0000b870: 6e65 742e 6173 7365 7274 5f63 616c 6c65  net.assert_calle
-0000b880: 645f 6f6e 6365 5f77 6974 6828 6d6f 636b  d_once_with(mock
-0000b890: 2e41 4e59 2c20 6163 636f 756e 743d 6d6f  .ANY, account=mo
-0000b8a0: 636b 2e41 4e59 2c20 7665 7269 6679 5f73  ck.ANY, verify_s
-0000b8b0: 736c 3d54 7275 652c 0a20 2020 2020 2020  sl=True,.       
-0000b8c0: 2020 2020 2020 2020 2075 7365 725f 6167           user_ag
-0000b8d0: 656e 743d 7561 2c20 616c 673d 6a6f 7365  ent=ua, alg=jose
-0000b8e0: 2e52 5332 3536 290a 0a20 2020 2040 6d6f  .RS256)..    @mo
-0000b8f0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-0000b900: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-0000b910: 2e70 6c75 675f 7365 6c2e 7265 636f 7264  .plug_sel.record
-0000b920: 5f63 686f 7365 6e5f 706c 7567 696e 7327  _chosen_plugins'
-0000b930: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
-0000b940: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-0000b950: 726e 616c 2e6d 6169 6e2e 706c 7567 5f73  rnal.main.plug_s
-0000b960: 656c 2e70 6963 6b5f 696e 7374 616c 6c65  el.pick_installe
-0000b970: 7227 290a 2020 2020 6465 6620 7465 7374  r').    def test
-0000b980: 5f69 6e73 7461 6c6c 6572 5f73 656c 6563  _installer_selec
-0000b990: 7469 6f6e 2873 656c 662c 206d 6f63 6b5f  tion(self, mock_
-0000b9a0: 7069 636b 5f69 6e73 7461 6c6c 6572 2c20  pick_installer, 
-0000b9b0: 5f72 6563 293a 0a20 2020 2020 2020 2073  _rec):.        s
-0000b9c0: 656c 662e 5f63 616c 6c28 5b27 696e 7374  elf._call(['inst
-0000b9d0: 616c 6c27 2c20 272d 2d64 6f6d 6169 6e73  all', '--domains
-0000b9e0: 272c 2027 666f 6f2e 6261 7227 2c20 272d  ', 'foo.bar', '-
-0000b9f0: 2d63 6572 742d 7061 7468 272c 2027 6365  -cert-path', 'ce
-0000ba00: 7274 272c 0a20 2020 2020 2020 2020 2020  rt',.           
-0000ba10: 2020 2020 2020 2020 2027 2d2d 6b65 792d           '--key-
-0000ba20: 7061 7468 272c 2027 7072 6976 6b65 7927  path', 'privkey'
-0000ba30: 2c20 272d 2d63 6861 696e 2d70 6174 6827  , '--chain-path'
-0000ba40: 2c20 2763 6861 696e 275d 2c20 6d6f 636b  , 'chain'], mock
-0000ba50: 6973 6669 6c65 3d54 7275 6529 0a20 2020  isfile=True).   
-0000ba60: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
-0000ba70: 5f70 6963 6b5f 696e 7374 616c 6c65 722e  _pick_installer.
-0000ba80: 6361 6c6c 5f63 6f75 6e74 203d 3d20 310a  call_count == 1.
-0000ba90: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-0000baa0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-0000bab0: 6e61 6c2e 6d61 696e 2e5f 696e 7374 616c  nal.main._instal
-0000bac0: 6c5f 6365 7274 2729 0a20 2020 2040 6d6f  l_cert').    @mo
-0000bad0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-0000bae0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-0000baf0: 2e70 6c75 675f 7365 6c2e 7265 636f 7264  .plug_sel.record
-0000bb00: 5f63 686f 7365 6e5f 706c 7567 696e 7327  _chosen_plugins'
-0000bb10: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
-0000bb20: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-0000bb30: 726e 616c 2e6d 6169 6e2e 706c 7567 5f73  rnal.main.plug_s
-0000bb40: 656c 2e70 6963 6b5f 696e 7374 616c 6c65  el.pick_installe
-0000bb50: 7227 290a 2020 2020 6465 6620 7465 7374  r').    def test
-0000bb60: 5f69 6e73 7461 6c6c 6572 5f63 6572 746e  _installer_certn
-0000bb70: 616d 6528 7365 6c66 2c20 5f69 6e73 742c  ame(self, _inst,
-0000bb80: 205f 7265 632c 206d 6f63 6b5f 696e 7374   _rec, mock_inst
-0000bb90: 616c 6c29 3a0a 2020 2020 2020 2020 6d6f  all):.        mo
-0000bba0: 636b 5f6c 696e 6561 6765 203d 206d 6f63  ck_lineage = moc
-0000bbb0: 6b2e 4d61 6769 634d 6f63 6b28 6365 7274  k.MagicMock(cert
-0000bbc0: 5f70 6174 683d 7465 7374 5f75 7469 6c2e  _path=test_util.
-0000bbd0: 7465 6d70 5f6a 6f69 6e28 2763 6572 7427  temp_join('cert'
-0000bbe0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc00: 2020 2020 2020 2020 2063 6861 696e 5f70           chain_p
-0000bc10: 6174 683d 7465 7374 5f75 7469 6c2e 7465  ath=test_util.te
-0000bc20: 6d70 5f6a 6f69 6e28 2763 6861 696e 2729  mp_join('chain')
-0000bc30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc50: 2020 2020 2020 2020 6675 6c6c 6368 6169          fullchai
-0000bc60: 6e5f 7061 7468 3d74 6573 745f 7574 696c  n_path=test_util
-0000bc70: 2e74 656d 705f 6a6f 696e 2827 6368 6169  .temp_join('chai
-0000bc80: 6e27 292c 0a20 2020 2020 2020 2020 2020  n'),.           
-0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bca0: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
-0000bcb0: 6174 683d 7465 7374 5f75 7469 6c2e 7465  ath=test_util.te
-0000bcc0: 6d70 5f6a 6f69 6e28 2770 7269 766b 6579  mp_join('privkey
-0000bcd0: 2729 290a 0a20 2020 2020 2020 2077 6974  '))..        wit
-0000bce0: 6820 6d6f 636b 2e70 6174 6368 2822 6365  h mock.patch("ce
-0000bcf0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-0000bd00: 6365 7274 5f6d 616e 6167 6572 2e6c 696e  cert_manager.lin
-0000bd10: 6561 6765 5f66 6f72 5f63 6572 746e 616d  eage_for_certnam
-0000bd20: 6522 2920 6173 206d 6f63 6b5f 6765 746c  e") as mock_getl
-0000bd30: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
-0000bd40: 6d6f 636b 5f67 6574 6c69 6e2e 7265 7475  mock_getlin.retu
-0000bd50: 726e 5f76 616c 7565 203d 206d 6f63 6b5f  rn_value = mock_
-0000bd60: 6c69 6e65 6167 650a 2020 2020 2020 2020  lineage.        
-0000bd70: 2020 2020 7365 6c66 2e5f 6361 6c6c 285b      self._call([
-0000bd80: 2769 6e73 7461 6c6c 272c 2027 2d2d 6365  'install', '--ce
-0000bd90: 7274 2d6e 616d 6527 2c20 2777 6861 7465  rt-name', 'whate
-0000bda0: 7665 7227 5d2c 206d 6f63 6b69 7366 696c  ver'], mockisfil
-0000bdb0: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-0000bdc0: 2020 2020 6361 6c6c 5f63 6f6e 6669 6720      call_config 
-0000bdd0: 3d20 6d6f 636b 5f69 6e73 7461 6c6c 2e63  = mock_install.c
-0000bde0: 616c 6c5f 6172 6773 5b30 5d5b 305d 0a20  all_args[0][0]. 
-0000bdf0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0000be00: 7420 6361 6c6c 5f63 6f6e 6669 672e 6365  t call_config.ce
-0000be10: 7274 5f70 6174 6820 3d3d 2074 6573 745f  rt_path == test_
-0000be20: 7574 696c 2e74 656d 705f 6a6f 696e 2827  util.temp_join('
-0000be30: 6365 7274 2729 0a20 2020 2020 2020 2020  cert').         
-0000be40: 2020 2061 7373 6572 7420 6361 6c6c 5f63     assert call_c
-0000be50: 6f6e 6669 672e 6675 6c6c 6368 6169 6e5f  onfig.fullchain_
-0000be60: 7061 7468 203d 3d20 7465 7374 5f75 7469  path == test_uti
-0000be70: 6c2e 7465 6d70 5f6a 6f69 6e28 2763 6861  l.temp_join('cha
-0000be80: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
-0000be90: 2061 7373 6572 7420 6361 6c6c 5f63 6f6e   assert call_con
-0000bea0: 6669 672e 6b65 795f 7061 7468 203d 3d20  fig.key_path == 
-0000beb0: 7465 7374 5f75 7469 6c2e 7465 6d70 5f6a  test_util.temp_j
-0000bec0: 6f69 6e28 2770 7269 766b 6579 2729 0a0a  oin('privkey')..
-0000bed0: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-0000bee0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-0000bef0: 616c 2e6c 6f67 2e70 6f73 745f 6172 675f  al.log.post_arg_
-0000bf00: 7061 7273 655f 7365 7475 7027 290a 2020  parse_setup').  
-0000bf10: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
-0000bf20: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-0000bf30: 2e6d 6169 6e2e 5f69 6e73 7461 6c6c 5f63  .main._install_c
-0000bf40: 6572 7427 290a 2020 2020 406d 6f63 6b2e  ert').    @mock.
-0000bf50: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-0000bf60: 696e 7465 726e 616c 2e6d 6169 6e2e 706c  internal.main.pl
-0000bf70: 7567 5f73 656c 2e72 6563 6f72 645f 6368  ug_sel.record_ch
-0000bf80: 6f73 656e 5f70 6c75 6769 6e73 2729 0a20  osen_plugins'). 
-0000bf90: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-0000bfa0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-0000bfb0: 6c2e 6d61 696e 2e70 6c75 675f 7365 6c2e  l.main.plug_sel.
-0000bfc0: 7069 636b 5f69 6e73 7461 6c6c 6572 2729  pick_installer')
-0000bfd0: 0a20 2020 2064 6566 2074 6573 745f 696e  .    def test_in
-0000bfe0: 7374 616c 6c65 725f 7061 7261 6d5f 6f76  staller_param_ov
-0000bff0: 6572 7269 6465 2873 656c 662c 205f 696e  erride(self, _in
-0000c000: 7374 2c20 5f72 6563 2c20 6d6f 636b 5f69  st, _rec, mock_i
-0000c010: 6e73 7461 6c6c 2c20 5f29 3a0a 2020 2020  nstall, _):.    
-0000c020: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
-0000c030: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
-0000c040: 6b28 6365 7274 5f70 6174 683d 7465 7374  k(cert_path=test
-0000c050: 5f75 7469 6c2e 7465 6d70 5f6a 6f69 6e28  _util.temp_join(
-0000c060: 2763 6572 7427 292c 0a20 2020 2020 2020  'cert'),.       
-0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c080: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000c090: 6861 696e 5f70 6174 683d 7465 7374 5f75  hain_path=test_u
-0000c0a0: 7469 6c2e 7465 6d70 5f6a 6f69 6e28 2763  til.temp_join('c
-0000c0b0: 6861 696e 2729 2c0a 2020 2020 2020 2020  hain'),.        
-0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0d0: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0000c0e0: 6c6c 6368 6169 6e5f 7061 7468 3d74 6573  llchain_path=tes
-0000c0f0: 745f 7574 696c 2e74 656d 705f 6a6f 696e  t_util.temp_join
-0000c100: 2827 6368 6169 6e27 292c 0a20 2020 2020  ('chain'),.     
-0000c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c130: 206b 6579 5f70 6174 683d 7465 7374 5f75   key_path=test_u
-0000c140: 7469 6c2e 7465 6d70 5f6a 6f69 6e28 2770  til.temp_join('p
-0000c150: 7269 766b 6579 2729 290a 2020 2020 2020  rivkey')).      
-0000c160: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
-0000c170: 6828 2263 6572 7462 6f74 2e5f 696e 7465  h("certbot._inte
-0000c180: 726e 616c 2e63 6572 745f 6d61 6e61 6765  rnal.cert_manage
-0000c190: 722e 6c69 6e65 6167 655f 666f 725f 6365  r.lineage_for_ce
-0000c1a0: 7274 6e61 6d65 2229 2061 7320 6d6f 636b  rtname") as mock
-0000c1b0: 5f67 6574 6c69 6e3a 0a20 2020 2020 2020  _getlin:.       
-0000c1c0: 2020 2020 206d 6f63 6b5f 6765 746c 696e       mock_getlin
-0000c1d0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-0000c1e0: 6d6f 636b 5f6c 696e 6561 6765 0a20 2020  mock_lineage.   
-0000c1f0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000c200: 616c 6c28 5b27 696e 7374 616c 6c27 2c20  all(['install', 
-0000c210: 272d 2d63 6572 742d 6e61 6d65 272c 2027  '--cert-name', '
-0000c220: 7768 6174 6576 6572 272c 0a20 2020 2020  whatever',.     
-0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c240: 2020 2027 2d2d 6b65 792d 7061 7468 272c     '--key-path',
-0000c250: 2074 6573 745f 7574 696c 2e74 656d 705f   test_util.temp_
-0000c260: 6a6f 696e 2827 6f76 6572 7269 6469 6e67  join('overriding
-0000c270: 5f70 7269 766b 6579 2729 5d2c 206d 6f63  _privkey')], moc
-0000c280: 6b69 7366 696c 653d 5472 7565 290a 2020  kisfile=True).  
-0000c290: 2020 2020 2020 2020 2020 6361 6c6c 5f63            call_c
-0000c2a0: 6f6e 6669 6720 3d20 6d6f 636b 5f69 6e73  onfig = mock_ins
-0000c2b0: 7461 6c6c 2e63 616c 6c5f 6172 6773 5b30  tall.call_args[0
-0000c2c0: 5d5b 305d 0a20 2020 2020 2020 2020 2020  ][0].           
-0000c2d0: 2061 7373 6572 7420 6361 6c6c 5f63 6f6e   assert call_con
-0000c2e0: 6669 672e 6365 7274 5f70 6174 6820 3d3d  fig.cert_path ==
-0000c2f0: 2074 6573 745f 7574 696c 2e74 656d 705f   test_util.temp_
-0000c300: 6a6f 696e 2827 6365 7274 2729 0a20 2020  join('cert').   
-0000c310: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0000c320: 6361 6c6c 5f63 6f6e 6669 672e 6675 6c6c  call_config.full
-0000c330: 6368 6169 6e5f 7061 7468 203d 3d20 7465  chain_path == te
-0000c340: 7374 5f75 7469 6c2e 7465 6d70 5f6a 6f69  st_util.temp_joi
-0000c350: 6e28 2763 6861 696e 2729 0a20 2020 2020  n('chain').     
-0000c360: 2020 2020 2020 2061 7373 6572 7420 6361         assert ca
-0000c370: 6c6c 5f63 6f6e 6669 672e 6368 6169 6e5f  ll_config.chain_
-0000c380: 7061 7468 203d 3d20 7465 7374 5f75 7469  path == test_uti
-0000c390: 6c2e 7465 6d70 5f6a 6f69 6e28 2763 6861  l.temp_join('cha
-0000c3a0: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
-0000c3b0: 2061 7373 6572 7420 6361 6c6c 5f63 6f6e   assert call_con
-0000c3c0: 6669 672e 6b65 795f 7061 7468 203d 3d20  fig.key_path == 
-0000c3d0: 7465 7374 5f75 7469 6c2e 7465 6d70 5f6a  test_util.temp_j
-0000c3e0: 6f69 6e28 276f 7665 7272 6964 696e 675f  oin('overriding_
-0000c3f0: 7072 6976 6b65 7927 290a 0a20 2020 2020  privkey')..     
-0000c400: 2020 2020 2020 206d 6f63 6b5f 696e 7374         mock_inst
-0000c410: 616c 6c2e 7265 7365 7428 290a 0a20 2020  all.reset()..   
-0000c420: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000c430: 616c 6c28 5b27 696e 7374 616c 6c27 2c20  all(['install', 
-0000c440: 272d 2d63 6572 742d 6e61 6d65 272c 2027  '--cert-name', '
-0000c450: 7768 6174 6576 6572 272c 0a20 2020 2020  whatever',.     
-0000c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c470: 2020 2027 2d2d 6365 7274 2d70 6174 6827     '--cert-path'
-0000c480: 2c20 7465 7374 5f75 7469 6c2e 7465 6d70  , test_util.temp
-0000c490: 5f6a 6f69 6e28 276f 7665 7272 6964 696e  _join('overridin
-0000c4a0: 675f 6365 7274 2729 5d2c 206d 6f63 6b69  g_cert')], mocki
-0000c4b0: 7366 696c 653d 5472 7565 290a 2020 2020  sfile=True).    
-0000c4c0: 2020 2020 2020 2020 6361 6c6c 5f63 6f6e          call_con
-0000c4d0: 6669 6720 3d20 6d6f 636b 5f69 6e73 7461  fig = mock_insta
-0000c4e0: 6c6c 2e63 616c 6c5f 6172 6773 5b30 5d5b  ll.call_args[0][
-0000c4f0: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
-0000c500: 7373 6572 7420 6361 6c6c 5f63 6f6e 6669  ssert call_confi
-0000c510: 672e 6365 7274 5f70 6174 6820 3d3d 2074  g.cert_path == t
-0000c520: 6573 745f 7574 696c 2e74 656d 705f 6a6f  est_util.temp_jo
-0000c530: 696e 2827 6f76 6572 7269 6469 6e67 5f63  in('overriding_c
-0000c540: 6572 7427 290a 2020 2020 2020 2020 2020  ert').          
-0000c550: 2020 6173 7365 7274 2063 616c 6c5f 636f    assert call_co
-0000c560: 6e66 6967 2e66 756c 6c63 6861 696e 5f70  nfig.fullchain_p
-0000c570: 6174 6820 3d3d 2074 6573 745f 7574 696c  ath == test_util
-0000c580: 2e74 656d 705f 6a6f 696e 2827 6368 6169  .temp_join('chai
-0000c590: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-0000c5a0: 6173 7365 7274 2063 616c 6c5f 636f 6e66  assert call_conf
-0000c5b0: 6967 2e6b 6579 5f70 6174 6820 3d3d 2074  ig.key_path == t
-0000c5c0: 6573 745f 7574 696c 2e74 656d 705f 6a6f  est_util.temp_jo
-0000c5d0: 696e 2827 7072 6976 6b65 7927 290a 0a20  in('privkey').. 
-0000c5e0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-0000c5f0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-0000c600: 6c2e 6d61 696e 2e70 6c75 675f 7365 6c2e  l.main.plug_sel.
-0000c610: 7265 636f 7264 5f63 686f 7365 6e5f 706c  record_chosen_pl
-0000c620: 7567 696e 7327 290a 2020 2020 406d 6f63  ugins').    @moc
-0000c630: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-0000c640: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-0000c650: 706c 7567 5f73 656c 2e70 6963 6b5f 696e  plug_sel.pick_in
-0000c660: 7374 616c 6c65 7227 290a 2020 2020 6465  staller').    de
-0000c670: 6620 7465 7374 5f69 6e73 7461 6c6c 6572  f test_installer
-0000c680: 5f70 6172 616d 5f65 7272 6f72 2873 656c  _param_error(sel
-0000c690: 662c 205f 696e 7374 2c20 5f72 6563 293a  f, _inst, _rec):
-0000c6a0: 0a20 2020 2020 2020 2077 6974 6820 7079  .        with py
-0000c6b0: 7465 7374 2e72 6169 7365 7328 6572 726f  test.raises(erro
-0000c6c0: 7273 2e43 6f6e 6669 6775 7261 7469 6f6e  rs.Configuration
-0000c6d0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-0000c6e0: 2020 2020 7365 6c66 2e5f 6361 6c6c 285b      self._call([
-0000c6f0: 2769 6e73 7461 6c6c 272c 2027 2d2d 6365  'install', '--ce
-0000c700: 7274 2d6e 616d 6527 2c20 276e 6f74 666f  rt-name', 'notfo
-0000c710: 756e 6427 2c0a 2020 2020 2020 2020 2020  und',.          
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c730: 2027 2d2d 6b65 792d 7061 7468 272c 2027   '--key-path', '
-0000c740: 696e 7661 6c69 6427 5d29 0a0a 2020 2020  invalid'])..    
-0000c750: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-0000c760: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-0000c770: 6169 6e2e 706c 7567 5f73 656c 2e72 6563  ain.plug_sel.rec
-0000c780: 6f72 645f 6368 6f73 656e 5f70 6c75 6769  ord_chosen_plugi
-0000c790: 6e73 2729 0a20 2020 2040 6d6f 636b 2e70  ns').    @mock.p
-0000c7a0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-0000c7b0: 6e74 6572 6e61 6c2e 6d61 696e 2e70 6c75  nternal.main.plu
-0000c7c0: 675f 7365 6c2e 7069 636b 5f69 6e73 7461  g_sel.pick_insta
-0000c7d0: 6c6c 6572 2729 0a20 2020 2040 6d6f 636b  ller').    @mock
-0000c7e0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0000c7f0: 5f69 6e74 6572 6e61 6c2e 6365 7274 5f6d  _internal.cert_m
-0000c800: 616e 6167 6572 2e67 6574 5f63 6572 746e  anager.get_certn
-0000c810: 616d 6573 2729 0a20 2020 2040 6d6f 636b  ames').    @mock
-0000c820: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0000c830: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e5f  _internal.main._
-0000c840: 696e 7374 616c 6c5f 6365 7274 2729 0a20  install_cert'). 
-0000c850: 2020 2064 6566 2074 6573 745f 696e 7374     def test_inst
-0000c860: 616c 6c65 725f 7365 6c65 6374 5f63 6572  aller_select_cer
-0000c870: 7428 7365 6c66 2c20 6d6f 636b 5f69 6e73  t(self, mock_ins
-0000c880: 742c 206d 6f63 6b5f 6765 7463 6572 742c  t, mock_getcert,
-0000c890: 205f 696e 7374 2c20 5f72 6563 293a 0a20   _inst, _rec):. 
-0000c8a0: 2020 2020 2020 206d 6f63 6b5f 6c69 6e65         mock_line
-0000c8b0: 6167 6520 3d20 6d6f 636b 2e4d 6167 6963  age = mock.Magic
-0000c8c0: 4d6f 636b 2863 6572 745f 7061 7468 3d74  Mock(cert_path=t
-0000c8d0: 6573 745f 7574 696c 2e74 656d 705f 6a6f  est_util.temp_jo
-0000c8e0: 696e 2827 6365 7274 2729 2c0a 2020 2020  in('cert'),.    
-0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c910: 2020 6368 6169 6e5f 7061 7468 3d74 6573    chain_path=tes
-0000c920: 745f 7574 696c 2e74 656d 705f 6a6f 696e  t_util.temp_join
-0000c930: 2827 6368 6169 6e27 292c 0a20 2020 2020  ('chain'),.     
-0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c960: 2066 756c 6c63 6861 696e 5f70 6174 683d   fullchain_path=
-0000c970: 7465 7374 5f75 7469 6c2e 7465 6d70 5f6a  test_util.temp_j
-0000c980: 6f69 6e28 2763 6861 696e 2729 2c0a 2020  oin('chain'),.  
-0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9b0: 2020 2020 6b65 795f 7061 7468 3d74 6573      key_path=tes
-0000c9c0: 745f 7574 696c 2e74 656d 705f 6a6f 696e  t_util.temp_join
-0000c9d0: 2827 7072 6976 6b65 7927 2929 0a20 2020  ('privkey')).   
-0000c9e0: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-0000c9f0: 6174 6368 2822 6365 7274 626f 742e 5f69  atch("certbot._i
-0000ca00: 6e74 6572 6e61 6c2e 6365 7274 5f6d 616e  nternal.cert_man
-0000ca10: 6167 6572 2e6c 696e 6561 6765 5f66 6f72  ager.lineage_for
-0000ca20: 5f63 6572 746e 616d 6522 2920 6173 206d  _certname") as m
-0000ca30: 6f63 6b5f 6765 746c 696e 3a0a 2020 2020  ock_getlin:.    
-0000ca40: 2020 2020 2020 2020 6d6f 636b 5f67 6574          mock_get
-0000ca50: 6c69 6e2e 7265 7475 726e 5f76 616c 7565  lin.return_value
-0000ca60: 203d 206d 6f63 6b5f 6c69 6e65 6167 650a   = mock_lineage.
-0000ca70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ca80: 2e5f 6361 6c6c 285b 2769 6e73 7461 6c6c  ._call(['install
-0000ca90: 275d 2c20 6d6f 636b 6973 6669 6c65 3d54  '], mockisfile=T
-0000caa0: 7275 6529 0a20 2020 2020 2020 2061 7373  rue).        ass
-0000cab0: 6572 7420 6d6f 636b 5f67 6574 6365 7274  ert mock_getcert
-0000cac0: 2e63 616c 6c65 640a 2020 2020 2020 2020  .called.        
-0000cad0: 6173 7365 7274 206d 6f63 6b5f 696e 7374  assert mock_inst
-0000cae0: 2e63 616c 6c65 640a 0a20 2020 2040 6d6f  .called..    @mo
-0000caf0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-0000cb00: 742e 5f69 6e74 6572 6e61 6c2e 6566 662e  t._internal.eff.
-0000cb10: 6861 6e64 6c65 5f73 7562 7363 7269 7074  handle_subscript
-0000cb20: 696f 6e27 290a 2020 2020 406d 6f63 6b2e  ion').    @mock.
-0000cb30: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-0000cb40: 696e 7465 726e 616c 2e6c 6f67 2e70 6f73  internal.log.pos
-0000cb50: 745f 6172 675f 7061 7273 655f 7365 7475  t_arg_parse_setu
-0000cb60: 7027 290a 2020 2020 406d 6f63 6b2e 7061  p').    @mock.pa
-0000cb70: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-0000cb80: 7465 726e 616c 2e6d 6169 6e2e 5f72 6570  ternal.main._rep
-0000cb90: 6f72 745f 6e65 775f 6365 7274 2729 0a20  ort_new_cert'). 
-0000cba0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-0000cbb0: 6365 7274 626f 742e 7574 696c 2e65 7865  certbot.util.exe
-0000cbc0: 5f65 7869 7374 7327 290a 2020 2020 6465  _exists').    de
-0000cbd0: 6620 7465 7374 5f63 6f6e 6669 6775 7261  f test_configura
-0000cbe0: 746f 725f 7365 6c65 6374 696f 6e28 7365  tor_selection(se
-0000cbf0: 6c66 2c20 6d6f 636b 5f65 7865 5f65 7869  lf, mock_exe_exi
-0000cc00: 7374 732c 205f 2c20 5f5f 2c20 5f5f 5f29  sts, _, __, ___)
-0000cc10: 3a0a 2020 2020 2020 2020 6d6f 636b 5f65  :.        mock_e
-0000cc20: 7865 5f65 7869 7374 732e 7265 7475 726e  xe_exists.return
-0000cc30: 5f76 616c 7565 203d 2054 7275 650a 2020  _value = True.  
-0000cc40: 2020 2020 2020 7265 616c 5f70 6c75 6769        real_plugi
-0000cc50: 6e73 203d 2064 6973 636f 2e50 6c75 6769  ns = disco.Plugi
-0000cc60: 6e73 5265 6769 7374 7279 2e66 696e 645f  nsRegistry.find_
-0000cc70: 616c 6c28 290a 2020 2020 2020 2020 6172  all().        ar
-0000cc80: 6773 203d 205b 272d 2d61 7061 6368 6527  gs = ['--apache'
-0000cc90: 2c20 272d 2d61 7574 6865 6e74 6963 6174  , '--authenticat
-0000cca0: 6f72 272c 2027 7374 616e 6461 6c6f 6e65  or', 'standalone
-0000ccb0: 275d 0a0a 2020 2020 2020 2020 2320 5468  ']..        # Th
-0000ccc0: 6973 206e 6565 6465 6420 7477 6f20 6361  is needed two ca
-0000ccd0: 6c6c 7320 746f 2066 696e 645f 616c 6c28  lls to find_all(
-0000cce0: 292c 2077 6869 6368 2077 6527 7265 2061  ), which we're a
-0000ccf0: 766f 6964 696e 6720 666f 7220 6e6f 770a  voiding for now.
-0000cd00: 2020 2020 2020 2020 2320 6265 6361 7573          # becaus
-0000cd10: 6520 6f66 2070 6f73 7369 626c 6520 7369  e of possible si
-0000cd20: 6465 2065 6666 6563 7473 3a0a 2020 2020  de effects:.    
-0000cd30: 2020 2020 2320 6874 7470 733a 2f2f 6769      # https://gi
-0000cd40: 7468 7562 2e63 6f6d 2f6c 6574 7365 6e63  thub.com/letsenc
-0000cd50: 7279 7074 2f6c 6574 7365 6e63 7279 7074  rypt/letsencrypt
-0000cd60: 2f63 6f6d 6d69 742f 3531 6564 3262 3638  /commit/51ed2b68
-0000cd70: 3166 3837 6231 6562 3239 3038 3864 6434  1f87b1eb29088dd4
-0000cd80: 3837 3138 6135 3466 3430 3165 3438 3535  8718a54f401e4855
-0000cd90: 0a20 2020 2020 2020 2023 2077 6974 6820  .        # with 
-0000cda0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0000cdb0: 626f 742e 5f69 6e74 6572 6e61 6c2e 636c  bot._internal.cl
-0000cdc0: 692e 706c 7567 696e 735f 7465 7374 6162  i.plugins_testab
-0000cdd0: 6c65 2729 2061 7320 706c 7567 696e 733a  le') as plugins:
-0000cde0: 0a20 2020 2020 2020 2023 2020 2020 706c  .        #    pl
-0000cdf0: 7567 696e 732e 7265 7475 726e 5f76 616c  ugins.return_val
-0000ce00: 7565 203d 207b 2261 7061 6368 6522 3a20  ue = {"apache": 
-0000ce10: 5472 7565 2c20 226e 6769 6e78 223a 2054  True, "nginx": T
-0000ce20: 7275 657d 0a20 2020 2020 2020 2023 2020  rue}.        #  
-0000ce30: 2020 7265 742c 205f 2c20 5f2c 205f 203d    ret, _, _, _ =
-0000ce40: 2073 656c 662e 5f63 616c 6c28 6172 6773   self._call(args
-0000ce50: 290a 2020 2020 2020 2020 2320 2020 2073  ).        #    s
-0000ce60: 656c 662e 6173 7365 7274 5472 7565 2822  elf.assertTrue("
-0000ce70: 546f 6f20 6d61 6e79 2066 6c61 6773 2073  Too many flags s
-0000ce80: 6574 7469 6e67 2220 696e 2072 6574 290a  etting" in ret).
-0000ce90: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
-0000cea0: 5b22 696e 7374 616c 6c22 2c20 222d 2d6e  ["install", "--n
-0000ceb0: 6769 6e78 222c 2022 2d2d 6365 7274 2d70  ginx", "--cert-p
-0000cec0: 6174 6822 2c0a 2020 2020 2020 2020 2020  ath",.          
-0000ced0: 2020 2020 2020 7465 7374 5f75 7469 6c2e        test_util.
-0000cee0: 7465 6d70 5f6a 6f69 6e28 2762 6c61 6827  temp_join('blah'
-0000cef0: 292c 2022 2d2d 6b65 792d 7061 7468 222c  ), "--key-path",
-0000cf00: 2074 6573 745f 7574 696c 2e74 656d 705f   test_util.temp_
-0000cf10: 6a6f 696e 2827 626c 6168 2729 2c0a 2020  join('blah'),.  
-0000cf20: 2020 2020 2020 2020 2020 2020 2020 222d                "-
-0000cf30: 2d6e 6769 6e78 2d73 6572 7665 722d 726f  -nginx-server-ro
-0000cf40: 6f74 222c 2022 2f6e 6f6e 6578 6973 7465  ot", "/nonexiste
-0000cf50: 6e74 2f74 6869 6e67 222c 2022 2d64 222c  nt/thing", "-d",
-0000cf60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf70: 2022 6578 616d 706c 652e 636f 6d22 2c20   "example.com", 
-0000cf80: 222d 2d64 6562 7567 225d 0a20 2020 2020  "--debug"].     
-0000cf90: 2020 2069 6620 226e 6769 6e78 2220 696e     if "nginx" in
-0000cfa0: 2072 6561 6c5f 706c 7567 696e 733a 0a20   real_plugins:. 
-0000cfb0: 2020 2020 2020 2020 2020 2023 2053 656e             # Sen
-0000cfc0: 6469 6e67 206e 6769 6e78 2061 206e 6f6e  ding nginx a non
-0000cfd0: 2d65 7869 7374 656e 7420 636f 6e66 2064  -existent conf d
-0000cfe0: 6972 2077 696c 6c20 7369 6d75 6c61 7465  ir will simulate
-0000cff0: 206d 6973 636f 6e66 6967 7572 6174 696f   misconfiguratio
-0000d000: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
-0000d010: 2877 6520 6361 6e20 6f6e 6c79 2064 6f20  (we can only do 
-0000d020: 7468 6174 2069 6620 6365 7274 626f 742d  that if certbot-
-0000d030: 6e67 696e 7820 6973 2061 6374 7561 6c6c  nginx is actuall
-0000d040: 7920 7072 6573 656e 7429 0a20 2020 2020  y present).     
-0000d050: 2020 2020 2020 2072 6574 2c20 5f2c 205f         ret, _, _
-0000d060: 2c20 5f20 3d20 7365 6c66 2e5f 6361 6c6c  , _ = self._call
-0000d070: 2861 7267 7329 0a20 2020 2020 2020 2020  (args).         
-0000d080: 2020 2061 7373 6572 7420 2254 6865 206e     assert "The n
-0000d090: 6769 6e78 2070 6c75 6769 6e20 6973 206e  ginx plugin is n
-0000d0a0: 6f74 2077 6f72 6b69 6e67 2220 696e 2072  ot working" in r
-0000d0b0: 6574 0a20 2020 2020 2020 2020 2020 2061  et.            a
-0000d0c0: 7373 6572 7420 224d 6973 636f 6e66 6967  ssert "Misconfig
-0000d0d0: 7572 6174 696f 6e45 7272 6f72 2220 696e  urationError" in
-0000d0e0: 2072 6574 0a0a 2020 2020 2020 2020 7365   ret..        se
-0000d0f0: 6c66 2e5f 636c 695f 6d69 7373 696e 675f  lf._cli_missing_
-0000d100: 666c 6167 285b 222d 2d73 7461 6e64 616c  flag(["--standal
-0000d110: 6f6e 6522 5d2c 2022 5769 7468 2074 6865  one"], "With the
-0000d120: 2073 7461 6e64 616c 6f6e 6520 706c 7567   standalone plug
-0000d130: 696e 2c20 796f 7520 7072 6f62 6162 6c79  in, you probably
-0000d140: 2229 0a0a 2020 2020 2020 2020 7769 7468  ")..        with
-0000d150: 206d 6f63 6b2e 7061 7463 6828 2263 6572   mock.patch("cer
-0000d160: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-0000d170: 6169 6e2e 5f69 6e69 745f 6c65 5f63 6c69  ain._init_le_cli
-0000d180: 656e 7422 2920 6173 206d 6f63 6b5f 696e  ent") as mock_in
-0000d190: 6974 3a0a 2020 2020 2020 2020 2020 2020  it:.            
-0000d1a0: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
-0000d1b0: 2263 6572 7462 6f74 2e5f 696e 7465 726e  "certbot._intern
-0000d1c0: 616c 2e6d 6169 6e2e 5f67 6574 5f61 6e64  al.main._get_and
-0000d1d0: 5f73 6176 655f 6365 7274 2229 2061 7320  _save_cert") as 
-0000d1e0: 6d6f 636b 5f67 7363 3a0a 2020 2020 2020  mock_gsc:.      
-0000d1f0: 2020 2020 2020 2020 2020 6d6f 636b 5f67            mock_g
-0000d200: 7363 2e72 6574 7572 6e5f 7661 6c75 6520  sc.return_value 
-0000d210: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-0000d220: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000d230: 2020 2073 656c 662e 5f63 616c 6c28 5b22     self._call(["
-0000d240: 6365 7274 6f6e 6c79 222c 2022 2d2d 6d61  certonly", "--ma
-0000d250: 6e75 616c 222c 2022 2d64 222c 2022 666f  nual", "-d", "fo
-0000d260: 6f2e 6261 7222 5d29 0a20 2020 2020 2020  o.bar"]).       
-0000d270: 2020 2020 2020 2020 2075 6e75 7365 645f           unused_
-0000d280: 636f 6e66 6967 2c20 6175 7468 2c20 756e  config, auth, un
-0000d290: 7573 6564 5f69 6e73 7461 6c6c 6572 203d  used_installer =
-0000d2a0: 206d 6f63 6b5f 696e 6974 2e63 616c 6c5f   mock_init.call_
-0000d2b0: 6172 6773 5b30 5d0a 2020 2020 2020 2020  args[0].        
-0000d2c0: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
-0000d2d0: 7369 6e73 7461 6e63 6528 6175 7468 2c20  sinstance(auth, 
-0000d2e0: 6d61 6e75 616c 2e41 7574 6865 6e74 6963  manual.Authentic
-0000d2f0: 6174 6f72 290a 0a20 2020 2020 2020 2077  ator)..        w
-0000d300: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
-0000d310: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-0000d320: 6c2e 6d61 696e 2e63 6572 746f 6e6c 7927  l.main.certonly'
-0000d330: 2920 6173 206d 6f63 6b5f 6365 7274 6f6e  ) as mock_certon
-0000d340: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0000d350: 7365 6c66 2e5f 6361 6c6c 285b 2261 7574  self._call(["aut
-0000d360: 6822 2c20 222d 2d73 7461 6e64 616c 6f6e  h", "--standalon
-0000d370: 6522 5d29 0a20 2020 2020 2020 2020 2020  e"]).           
-0000d380: 2061 7373 6572 7420 3120 3d3d 206d 6f63   assert 1 == moc
-0000d390: 6b5f 6365 7274 6f6e 6c79 2e63 616c 6c5f  k_certonly.call_
-0000d3a0: 636f 756e 740a 0a20 2020 2040 6d6f 636b  count..    @mock
-0000d3b0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0000d3c0: 5f69 6e74 6572 6e61 6c2e 6c6f 672e 706f  _internal.log.po
-0000d3d0: 7374 5f61 7267 5f70 6172 7365 5f73 6574  st_arg_parse_set
-0000d3e0: 7570 2729 0a20 2020 2064 6566 2074 6573  up').    def tes
-0000d3f0: 745f 726f 6c6c 6261 636b 2873 656c 662c  t_rollback(self,
-0000d400: 205f 293a 0a20 2020 2020 2020 205f 2c20   _):.        _, 
-0000d410: 5f2c 205f 2c20 636c 6965 6e74 203d 2073  _, _, client = s
-0000d420: 656c 662e 5f63 616c 6c28 5b27 726f 6c6c  elf._call(['roll
-0000d430: 6261 636b 275d 290a 2020 2020 2020 2020  back']).        
-0000d440: 6173 7365 7274 2031 203d 3d20 636c 6965  assert 1 == clie
-0000d450: 6e74 2e72 6f6c 6c62 6163 6b2e 6361 6c6c  nt.rollback.call
-0000d460: 5f63 6f75 6e74 0a0a 2020 2020 2020 2020  _count..        
-0000d470: 5f2c 205f 2c20 5f2c 2063 6c69 656e 7420  _, _, _, client 
-0000d480: 3d20 7365 6c66 2e5f 6361 6c6c 285b 2772  = self._call(['r
-0000d490: 6f6c 6c62 6163 6b27 2c20 272d 2d63 6865  ollback', '--che
-0000d4a0: 636b 706f 696e 7473 272c 2027 3132 3327  ckpoints', '123'
-0000d4b0: 5d29 0a20 2020 2020 2020 2063 6c69 656e  ]).        clien
-0000d4c0: 742e 726f 6c6c 6261 636b 2e61 7373 6572  t.rollback.asser
-0000d4d0: 745f 6361 6c6c 6564 5f6f 6e63 655f 7769  t_called_once_wi
-0000d4e0: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
-0000d4f0: 6d6f 636b 2e41 4e59 2c20 3132 332c 206d  mock.ANY, 123, m
-0000d500: 6f63 6b2e 414e 592c 206d 6f63 6b2e 414e  ock.ANY, mock.AN
-0000d510: 5929 0a0a 2020 2020 406d 6f63 6b2e 7061  Y)..    @mock.pa
-0000d520: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-0000d530: 7465 726e 616c 2e63 6572 745f 6d61 6e61  ternal.cert_mana
-0000d540: 6765 722e 7570 6461 7465 5f6c 6976 655f  ger.update_live_
-0000d550: 7379 6d6c 696e 6b73 2729 0a20 2020 2064  symlinks').    d
-0000d560: 6566 2074 6573 745f 7570 6461 7465 5f73  ef test_update_s
-0000d570: 796d 6c69 6e6b 7328 7365 6c66 2c20 6d6f  ymlinks(self, mo
-0000d580: 636b 5f63 6572 745f 6d61 6e61 6765 7229  ck_cert_manager)
-0000d590: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0000d5a0: 6361 6c6c 5f6e 6f5f 636c 6965 6e74 6d6f  call_no_clientmo
-0000d5b0: 636b 285b 2775 7064 6174 655f 7379 6d6c  ck(['update_syml
-0000d5c0: 696e 6b73 275d 290a 2020 2020 2020 2020  inks']).        
-0000d5d0: 6173 7365 7274 2031 203d 3d20 6d6f 636b  assert 1 == mock
-0000d5e0: 5f63 6572 745f 6d61 6e61 6765 722e 6361  _cert_manager.ca
-0000d5f0: 6c6c 5f63 6f75 6e74 0a0a 2020 2020 406d  ll_count..    @m
-0000d600: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0000d610: 6f74 2e5f 696e 7465 726e 616c 2e63 6572  ot._internal.cer
-0000d620: 745f 6d61 6e61 6765 722e 6365 7274 6966  t_manager.certif
-0000d630: 6963 6174 6573 2729 0a20 2020 2064 6566  icates').    def
-0000d640: 2074 6573 745f 6365 7274 6966 6963 6174   test_certificat
-0000d650: 6573 2873 656c 662c 206d 6f63 6b5f 6365  es(self, mock_ce
-0000d660: 7274 5f6d 616e 6167 6572 293a 0a20 2020  rt_manager):.   
-0000d670: 2020 2020 2073 656c 662e 5f63 616c 6c5f       self._call_
-0000d680: 6e6f 5f63 6c69 656e 746d 6f63 6b28 5b27  no_clientmock(['
-0000d690: 6365 7274 6966 6963 6174 6573 275d 290a  certificates']).
-0000d6a0: 2020 2020 2020 2020 6173 7365 7274 2031          assert 1
-0000d6b0: 203d 3d20 6d6f 636b 5f63 6572 745f 6d61   == mock_cert_ma
-0000d6c0: 6e61 6765 722e 6361 6c6c 5f63 6f75 6e74  nager.call_count
-0000d6d0: 0a0a 2020 2020 406d 6f63 6b2e 7061 7463  ..    @mock.patc
-0000d6e0: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-0000d6f0: 726e 616c 2e63 6572 745f 6d61 6e61 6765  rnal.cert_manage
-0000d700: 722e 6465 6c65 7465 2729 0a20 2020 2064  r.delete').    d
-0000d710: 6566 2074 6573 745f 6465 6c65 7465 2873  ef test_delete(s
-0000d720: 656c 662c 206d 6f63 6b5f 6365 7274 5f6d  elf, mock_cert_m
-0000d730: 616e 6167 6572 293a 0a20 2020 2020 2020  anager):.       
-0000d740: 2073 656c 662e 5f63 616c 6c5f 6e6f 5f63   self._call_no_c
-0000d750: 6c69 656e 746d 6f63 6b28 5b27 6465 6c65  lientmock(['dele
-0000d760: 7465 275d 290a 2020 2020 2020 2020 6173  te']).        as
-0000d770: 7365 7274 2031 203d 3d20 6d6f 636b 5f63  sert 1 == mock_c
-0000d780: 6572 745f 6d61 6e61 6765 722e 6361 6c6c  ert_manager.call
-0000d790: 5f63 6f75 6e74 0a0a 2020 2020 406d 6f63  _count..    @moc
-0000d7a0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-0000d7b0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-0000d7c0: 706c 7567 696e 735f 6469 7363 6f27 290a  plugins_disco').
-0000d7d0: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-0000d7e0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-0000d7f0: 616c 2e6d 6169 6e2e 636c 692e 4865 6c70  al.main.cli.Help
-0000d800: 6675 6c41 7267 756d 656e 7450 6172 7365  fulArgumentParse
-0000d810: 722e 6465 7465 726d 696e 655f 6865 6c70  r.determine_help
-0000d820: 5f74 6f70 6963 7327 290a 2020 2020 406d  _topics').    @m
-0000d830: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0000d840: 6f74 2e5f 696e 7465 726e 616c 2e6c 6f67  ot._internal.log
-0000d850: 2e70 6f73 745f 6172 675f 7061 7273 655f  .post_arg_parse_
-0000d860: 7365 7475 7027 290a 2020 2020 6465 6620  setup').    def 
-0000d870: 7465 7374 5f70 6c75 6769 6e73 2873 656c  test_plugins(sel
-0000d880: 662c 205f 2c20 5f64 6574 2c20 6d6f 636b  f, _, _det, mock
-0000d890: 5f64 6973 636f 293a 0a20 2020 2020 2020  _disco):.       
-0000d8a0: 2066 6c61 6773 203d 205b 272d 2d69 6e69   flags = ['--ini
-0000d8b0: 7427 2c20 272d 2d70 7265 7061 7265 272c  t', '--prepare',
-0000d8c0: 2027 2d2d 6175 7468 656e 7469 6361 746f   '--authenticato
-0000d8d0: 7273 272c 2027 2d2d 696e 7374 616c 6c65  rs', '--installe
-0000d8e0: 7273 275d 0a20 2020 2020 2020 2066 6f72  rs'].        for
-0000d8f0: 2061 7267 7320 696e 2069 7465 7274 6f6f   args in itertoo
-0000d900: 6c73 2e63 6861 696e 280a 2020 2020 2020  ls.chain(.      
-0000d910: 2020 2020 2020 2020 2020 2a28 6974 6572            *(iter
-0000d920: 746f 6f6c 732e 636f 6d62 696e 6174 696f  tools.combinatio
-0000d930: 6e73 2866 6c61 6773 2c20 7229 0a20 2020  ns(flags, r).   
-0000d940: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d950: 6f72 2072 2069 6e20 7261 6e67 6528 6c65  or r in range(le
-0000d960: 6e28 666c 6167 7329 2929 293a 0a20 2020  n(flags)))):.   
-0000d970: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000d980: 616c 6c28 5b27 706c 7567 696e 7327 5d20  all(['plugins'] 
-0000d990: 2b20 6c69 7374 2861 7267 7329 290a 0a20  + list(args)).. 
-0000d9a0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-0000d9b0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-0000d9c0: 6c2e 6d61 696e 2e70 6c75 6769 6e73 5f64  l.main.plugins_d
-0000d9d0: 6973 636f 2729 0a20 2020 2040 6d6f 636b  isco').    @mock
-0000d9e0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0000d9f0: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e63  _internal.main.c
-0000da00: 6c69 2e48 656c 7066 756c 4172 6775 6d65  li.HelpfulArgume
-0000da10: 6e74 5061 7273 6572 2e64 6574 6572 6d69  ntParser.determi
-0000da20: 6e65 5f68 656c 705f 746f 7069 6373 2729  ne_help_topics')
-0000da30: 0a20 2020 2064 6566 2074 6573 745f 706c  .    def test_pl
-0000da40: 7567 696e 735f 6e6f 5f61 7267 7328 7365  ugins_no_args(se
-0000da50: 6c66 2c20 5f64 6574 2c20 6d6f 636b 5f64  lf, _det, mock_d
-0000da60: 6973 636f 293a 0a20 2020 2020 2020 2069  isco):.        i
-0000da70: 6661 6365 733a 204c 6973 745b 696e 7465  faces: List[inte
-0000da80: 7266 6163 6573 2e50 6c75 6769 6e5d 203d  rfaces.Plugin] =
-0000da90: 205b 5d0a 2020 2020 2020 2020 706c 7567   [].        plug
-0000daa0: 696e 7320 3d20 6d6f 636b 5f64 6973 636f  ins = mock_disco
-0000dab0: 2e50 6c75 6769 6e73 5265 6769 7374 7279  .PluginsRegistry
-0000dac0: 2e66 696e 645f 616c 6c28 290a 0a20 2020  .find_all()..   
-0000dad0: 2020 2020 2073 7464 6f75 7420 3d20 696f       stdout = io
-0000dae0: 2e53 7472 696e 6749 4f28 290a 2020 2020  .StringIO().    
-0000daf0: 2020 2020 7769 7468 2074 6573 745f 7574      with test_ut
-0000db00: 696c 2e70 6174 6368 5f64 6973 706c 6179  il.patch_display
-0000db10: 5f75 7469 6c5f 7769 7468 5f73 7464 6f75  _util_with_stdou
-0000db20: 7428 7374 646f 7574 3d73 7464 6f75 7429  t(stdout=stdout)
-0000db30: 3a0a 2020 2020 2020 2020 2020 2020 5f2c  :.            _,
-0000db40: 2073 7464 6f75 742c 205f 2c20 5f20 3d20   stdout, _, _ = 
-0000db50: 7365 6c66 2e5f 6361 6c6c 285b 2770 6c75  self._call(['plu
-0000db60: 6769 6e73 275d 2c20 7374 646f 7574 290a  gins'], stdout).
-0000db70: 0a20 2020 2020 2020 2070 6c75 6769 6e73  .        plugins
-0000db80: 2e76 6973 6962 6c65 2e61 7373 6572 745f  .visible.assert_
-0000db90: 6361 6c6c 6564 5f6f 6e63 655f 7769 7468  called_once_with
-0000dba0: 2829 0a20 2020 2020 2020 2070 6c75 6769  ().        plugi
-0000dbb0: 6e73 2e76 6973 6962 6c65 2829 2e69 6661  ns.visible().ifa
-0000dbc0: 6365 732e 6173 7365 7274 5f63 616c 6c65  ces.assert_calle
-0000dbd0: 645f 6f6e 6365 5f77 6974 6828 6966 6163  d_once_with(ifac
-0000dbe0: 6573 290a 2020 2020 2020 2020 6669 6c74  es).        filt
-0000dbf0: 6572 6564 203d 2070 6c75 6769 6e73 2e76  ered = plugins.v
-0000dc00: 6973 6962 6c65 2829 2e69 6661 6365 7328  isible().ifaces(
-0000dc10: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-0000dc20: 2073 7464 6f75 742e 6765 7476 616c 7565   stdout.getvalue
-0000dc30: 2829 2e73 7472 6970 2829 203d 3d20 7374  ().strip() == st
-0000dc40: 7228 6669 6c74 6572 6564 290a 0a20 2020  r(filtered)..   
-0000dc50: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
-0000dc60: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-0000dc70: 6d61 696e 2e70 6c75 6769 6e73 5f64 6973  main.plugins_dis
-0000dc80: 636f 2729 0a20 2020 2040 6d6f 636b 2e70  co').    @mock.p
-0000dc90: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-0000dca0: 6e74 6572 6e61 6c2e 6d61 696e 2e63 6c69  nternal.main.cli
-0000dcb0: 2e48 656c 7066 756c 4172 6775 6d65 6e74  .HelpfulArgument
-0000dcc0: 5061 7273 6572 2e64 6574 6572 6d69 6e65  Parser.determine
-0000dcd0: 5f68 656c 705f 746f 7069 6373 2729 0a20  _help_topics'). 
-0000dce0: 2020 2064 6566 2074 6573 745f 706c 7567     def test_plug
-0000dcf0: 696e 735f 6e6f 5f61 7267 735f 756e 7072  ins_no_args_unpr
-0000dd00: 6976 696c 6567 6564 2873 656c 662c 205f  ivileged(self, _
-0000dd10: 6465 742c 206d 6f63 6b5f 6469 7363 6f29  det, mock_disco)
-0000dd20: 3a0a 2020 2020 2020 2020 6966 6163 6573  :.        ifaces
-0000dd30: 3a20 4c69 7374 5b69 6e74 6572 6661 6365  : List[interface
-0000dd40: 732e 506c 7567 696e 5d20 3d20 5b5d 0a20  s.Plugin] = []. 
-0000dd50: 2020 2020 2020 2070 6c75 6769 6e73 203d         plugins =
-0000dd60: 206d 6f63 6b5f 6469 7363 6f2e 506c 7567   mock_disco.Plug
-0000dd70: 696e 7352 6567 6973 7472 792e 6669 6e64  insRegistry.find
-0000dd80: 5f61 6c6c 2829 0a0a 2020 2020 2020 2020  _all()..        
-0000dd90: 6465 6620 7468 726f 775f 6572 726f 7228  def throw_error(
-0000dda0: 6469 7265 6374 6f72 792c 206d 6f64 652c  directory, mode,
-0000ddb0: 2073 7472 6963 7429 3a0a 2020 2020 2020   strict):.      
-0000ddc0: 2020 2020 2020 2222 2252 6169 7365 7320        """Raises 
-0000ddd0: 6572 726f 722e 4572 726f 722e 2222 220a  error.Error.""".
-0000dde0: 2020 2020 2020 2020 2020 2020 5f2c 205f              _, _
-0000ddf0: 2c20 5f20 3d20 6469 7265 6374 6f72 792c  , _ = directory,
-0000de00: 206d 6f64 652c 2073 7472 6963 740a 2020   mode, strict.  
-0000de10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000de20: 6572 726f 7273 2e45 7272 6f72 2829 0a0a  errors.Error()..
-0000de30: 2020 2020 2020 2020 7374 646f 7574 203d          stdout =
-0000de40: 2069 6f2e 5374 7269 6e67 494f 2829 0a20   io.StringIO(). 
-0000de50: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-0000de60: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0000de70: 7574 696c 2e73 6574 5f75 705f 636f 7265  util.set_up_core
-0000de80: 5f64 6972 2729 2061 7320 6d6f 636b 5f73  _dir') as mock_s
-0000de90: 6574 5f75 705f 636f 7265 5f64 6972 3a0a  et_up_core_dir:.
-0000dea0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000deb0: 2074 6573 745f 7574 696c 2e70 6174 6368   test_util.patch
-0000dec0: 5f64 6973 706c 6179 5f75 7469 6c5f 7769  _display_util_wi
-0000ded0: 7468 5f73 7464 6f75 7428 7374 646f 7574  th_stdout(stdout
-0000dee0: 3d73 7464 6f75 7429 3a0a 2020 2020 2020  =stdout):.      
-0000def0: 2020 2020 2020 2020 2020 6d6f 636b 5f73            mock_s
-0000df00: 6574 5f75 705f 636f 7265 5f64 6972 2e73  et_up_core_dir.s
-0000df10: 6964 655f 6566 6665 6374 203d 2074 6872  ide_effect = thr
-0000df20: 6f77 5f65 7272 6f72 0a20 2020 2020 2020  ow_error.       
-0000df30: 2020 2020 2020 2020 205f 2c20 7374 646f           _, stdo
-0000df40: 7574 2c20 5f2c 205f 203d 2073 656c 662e  ut, _, _ = self.
-0000df50: 5f63 616c 6c28 5b27 706c 7567 696e 7327  _call(['plugins'
-0000df60: 5d2c 2073 7464 6f75 7429 0a0a 2020 2020  ], stdout)..    
-0000df70: 2020 2020 706c 7567 696e 732e 7669 7369      plugins.visi
-0000df80: 626c 652e 6173 7365 7274 5f63 616c 6c65  ble.assert_calle
-0000df90: 645f 6f6e 6365 5f77 6974 6828 290a 2020  d_once_with().  
-0000dfa0: 2020 2020 2020 706c 7567 696e 732e 7669        plugins.vi
-0000dfb0: 7369 626c 6528 292e 6966 6163 6573 2e61  sible().ifaces.a
-0000dfc0: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
-0000dfd0: 655f 7769 7468 2869 6661 6365 7329 0a20  e_with(ifaces). 
-0000dfe0: 2020 2020 2020 2066 696c 7465 7265 6420         filtered 
-0000dff0: 3d20 706c 7567 696e 732e 7669 7369 626c  = plugins.visibl
-0000e000: 6528 292e 6966 6163 6573 2829 0a20 2020  e().ifaces().   
-0000e010: 2020 2020 2061 7373 6572 7420 7374 646f       assert stdo
-0000e020: 7574 2e67 6574 7661 6c75 6528 292e 7374  ut.getvalue().st
-0000e030: 7269 7028 2920 3d3d 2073 7472 2866 696c  rip() == str(fil
-0000e040: 7465 7265 6429 0a0a 2020 2020 406d 6f63  tered)..    @moc
-0000e050: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-0000e060: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-0000e070: 706c 7567 696e 735f 6469 7363 6f27 290a  plugins_disco').
-0000e080: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-0000e090: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-0000e0a0: 616c 2e6d 6169 6e2e 636c 692e 4865 6c70  al.main.cli.Help
-0000e0b0: 6675 6c41 7267 756d 656e 7450 6172 7365  fulArgumentParse
-0000e0c0: 722e 6465 7465 726d 696e 655f 6865 6c70  r.determine_help
-0000e0d0: 5f74 6f70 6963 7327 290a 2020 2020 6465  _topics').    de
-0000e0e0: 6620 7465 7374 5f70 6c75 6769 6e73 5f69  f test_plugins_i
-0000e0f0: 6e69 7428 7365 6c66 2c20 5f64 6574 2c20  nit(self, _det, 
-0000e100: 6d6f 636b 5f64 6973 636f 293a 0a20 2020  mock_disco):.   
-0000e110: 2020 2020 2069 6661 6365 733a 204c 6973       ifaces: Lis
-0000e120: 745b 696e 7465 7266 6163 6573 2e50 6c75  t[interfaces.Plu
-0000e130: 6769 6e5d 203d 205b 5d0a 2020 2020 2020  gin] = [].      
-0000e140: 2020 706c 7567 696e 7320 3d20 6d6f 636b    plugins = mock
-0000e150: 5f64 6973 636f 2e50 6c75 6769 6e73 5265  _disco.PluginsRe
-0000e160: 6769 7374 7279 2e66 696e 645f 616c 6c28  gistry.find_all(
-0000e170: 290a 0a20 2020 2020 2020 2073 7464 6f75  )..        stdou
-0000e180: 7420 3d20 696f 2e53 7472 696e 6749 4f28  t = io.StringIO(
-0000e190: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
-0000e1a0: 6573 745f 7574 696c 2e70 6174 6368 5f64  est_util.patch_d
-0000e1b0: 6973 706c 6179 5f75 7469 6c5f 7769 7468  isplay_util_with
-0000e1c0: 5f73 7464 6f75 7428 7374 646f 7574 3d73  _stdout(stdout=s
-0000e1d0: 7464 6f75 7429 3a0a 2020 2020 2020 2020  tdout):.        
-0000e1e0: 2020 2020 5f2c 2073 7464 6f75 742c 205f      _, stdout, _
-0000e1f0: 2c20 5f20 3d20 7365 6c66 2e5f 6361 6c6c  , _ = self._call
-0000e200: 285b 2770 6c75 6769 6e73 272c 2027 2d2d  (['plugins', '--
-0000e210: 696e 6974 275d 2c20 7374 646f 7574 290a  init'], stdout).
-0000e220: 0a20 2020 2020 2020 2070 6c75 6769 6e73  .        plugins
-0000e230: 2e76 6973 6962 6c65 2e61 7373 6572 745f  .visible.assert_
-0000e240: 6361 6c6c 6564 5f6f 6e63 655f 7769 7468  called_once_with
-0000e250: 2829 0a20 2020 2020 2020 2070 6c75 6769  ().        plugi
-0000e260: 6e73 2e76 6973 6962 6c65 2829 2e69 6661  ns.visible().ifa
-0000e270: 6365 732e 6173 7365 7274 5f63 616c 6c65  ces.assert_calle
-0000e280: 645f 6f6e 6365 5f77 6974 6828 6966 6163  d_once_with(ifac
-0000e290: 6573 290a 2020 2020 2020 2020 6669 6c74  es).        filt
-0000e2a0: 6572 6564 203d 2070 6c75 6769 6e73 2e76  ered = plugins.v
-0000e2b0: 6973 6962 6c65 2829 2e69 6661 6365 7328  isible().ifaces(
-0000e2c0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-0000e2d0: 2066 696c 7465 7265 642e 696e 6974 2e63   filtered.init.c
-0000e2e0: 616c 6c5f 636f 756e 7420 3d3d 2031 0a20  all_count == 1. 
-0000e2f0: 2020 2020 2020 2061 7373 6572 7420 7374         assert st
-0000e300: 646f 7574 2e67 6574 7661 6c75 6528 292e  dout.getvalue().
-0000e310: 7374 7269 7028 2920 3d3d 2073 7472 2866  strip() == str(f
-0000e320: 696c 7465 7265 6429 0a0a 2020 2020 406d  iltered)..    @m
-0000e330: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0000e340: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-0000e350: 6e2e 706c 7567 696e 735f 6469 7363 6f27  n.plugins_disco'
-0000e360: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
-0000e370: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-0000e380: 726e 616c 2e6d 6169 6e2e 636c 692e 4865  rnal.main.cli.He
-0000e390: 6c70 6675 6c41 7267 756d 656e 7450 6172  lpfulArgumentPar
-0000e3a0: 7365 722e 6465 7465 726d 696e 655f 6865  ser.determine_he
-0000e3b0: 6c70 5f74 6f70 6963 7327 290a 2020 2020  lp_topics').    
-0000e3c0: 6465 6620 7465 7374 5f70 6c75 6769 6e73  def test_plugins
-0000e3d0: 5f70 7265 7061 7265 2873 656c 662c 205f  _prepare(self, _
-0000e3e0: 6465 742c 206d 6f63 6b5f 6469 7363 6f29  det, mock_disco)
-0000e3f0: 3a0a 2020 2020 2020 2020 6966 6163 6573  :.        ifaces
-0000e400: 3a20 4c69 7374 5b69 6e74 6572 6661 6365  : List[interface
-0000e410: 732e 506c 7567 696e 5d20 3d20 5b5d 0a20  s.Plugin] = []. 
-0000e420: 2020 2020 2020 2070 6c75 6769 6e73 203d         plugins =
-0000e430: 206d 6f63 6b5f 6469 7363 6f2e 506c 7567   mock_disco.Plug
-0000e440: 696e 7352 6567 6973 7472 792e 6669 6e64  insRegistry.find
-0000e450: 5f61 6c6c 2829 0a0a 2020 2020 2020 2020  _all()..        
-0000e460: 7374 646f 7574 203d 2069 6f2e 5374 7269  stdout = io.Stri
-0000e470: 6e67 494f 2829 0a20 2020 2020 2020 2077  ngIO().        w
-0000e480: 6974 6820 7465 7374 5f75 7469 6c2e 7061  ith test_util.pa
-0000e490: 7463 685f 6469 7370 6c61 795f 7574 696c  tch_display_util
-0000e4a0: 5f77 6974 685f 7374 646f 7574 2873 7464  _with_stdout(std
-0000e4b0: 6f75 743d 7374 646f 7574 293a 0a20 2020  out=stdout):.   
-0000e4c0: 2020 2020 2020 2020 205f 2c20 7374 646f           _, stdo
-0000e4d0: 7574 2c20 5f2c 205f 203d 2073 656c 662e  ut, _, _ = self.
-0000e4e0: 5f63 616c 6c28 5b27 706c 7567 696e 7327  _call(['plugins'
-0000e4f0: 2c20 272d 2d69 6e69 7427 2c20 272d 2d70  , '--init', '--p
-0000e500: 7265 7061 7265 275d 2c20 7374 646f 7574  repare'], stdout
-0000e510: 290a 0a20 2020 2020 2020 2070 6c75 6769  )..        plugi
-0000e520: 6e73 2e76 6973 6962 6c65 2e61 7373 6572  ns.visible.asser
-0000e530: 745f 6361 6c6c 6564 5f6f 6e63 655f 7769  t_called_once_wi
-0000e540: 7468 2829 0a20 2020 2020 2020 2070 6c75  th().        plu
-0000e550: 6769 6e73 2e76 6973 6962 6c65 2829 2e69  gins.visible().i
-0000e560: 6661 6365 732e 6173 7365 7274 5f63 616c  faces.assert_cal
-0000e570: 6c65 645f 6f6e 6365 5f77 6974 6828 6966  led_once_with(if
-0000e580: 6163 6573 290a 2020 2020 2020 2020 6669  aces).        fi
-0000e590: 6c74 6572 6564 203d 2070 6c75 6769 6e73  ltered = plugins
-0000e5a0: 2e76 6973 6962 6c65 2829 2e69 6661 6365  .visible().iface
-0000e5b0: 7328 290a 2020 2020 2020 2020 6173 7365  s().        asse
-0000e5c0: 7274 2066 696c 7465 7265 642e 696e 6974  rt filtered.init
-0000e5d0: 2e63 616c 6c5f 636f 756e 7420 3d3d 2031  .call_count == 1
-0000e5e0: 0a20 2020 2020 2020 2066 696c 7465 7265  .        filtere
-0000e5f0: 642e 7072 6570 6172 652e 6173 7365 7274  d.prepare.assert
-0000e600: 5f63 616c 6c65 645f 6f6e 6365 5f77 6974  _called_once_wit
-0000e610: 6828 290a 2020 2020 2020 2020 6669 6c74  h().        filt
-0000e620: 6572 6564 2e61 7661 696c 6162 6c65 2e61  ered.available.a
-0000e630: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
-0000e640: 655f 7769 7468 2829 0a20 2020 2020 2020  e_with().       
-0000e650: 2061 7661 696c 6162 6c65 203d 2066 696c   available = fil
-0000e660: 7465 7265 642e 6176 6169 6c61 626c 6528  tered.available(
-0000e670: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-0000e680: 2073 7464 6f75 742e 6765 7476 616c 7565   stdout.getvalue
-0000e690: 2829 2e73 7472 6970 2829 203d 3d20 7374  ().strip() == st
-0000e6a0: 7228 6176 6169 6c61 626c 6529 0a0a 2020  r(available)..  
-0000e6b0: 2020 6465 6620 7465 7374 5f63 6572 746f    def test_certo
-0000e6c0: 6e6c 795f 6162 7370 6174 6828 7365 6c66  nly_abspath(self
-0000e6d0: 293a 0a20 2020 2020 2020 2063 6572 7420  ):.        cert 
-0000e6e0: 3d20 2763 6572 7427 0a20 2020 2020 2020  = 'cert'.       
-0000e6f0: 206b 6579 203d 2027 6b65 7927 0a20 2020   key = 'key'.   
-0000e700: 2020 2020 2063 6861 696e 203d 2027 6368       chain = 'ch
-0000e710: 6169 6e27 0a20 2020 2020 2020 2066 756c  ain'.        ful
-0000e720: 6c63 6861 696e 203d 2027 6675 6c6c 6368  lchain = 'fullch
-0000e730: 6169 6e27 0a0a 2020 2020 2020 2020 7769  ain'..        wi
-0000e740: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
-0000e750: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-0000e760: 2e6d 6169 6e2e 6365 7274 6f6e 6c79 2729  .main.certonly')
-0000e770: 2061 7320 6d6f 636b 5f63 6572 746f 6e6c   as mock_certonl
-0000e780: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-0000e790: 656c 662e 5f63 616c 6c28 5b27 6365 7274  elf._call(['cert
-0000e7a0: 6f6e 6c79 272c 2027 2d2d 6365 7274 2d70  only', '--cert-p
-0000e7b0: 6174 6827 2c20 6365 7274 2c20 272d 2d6b  ath', cert, '--k
-0000e7c0: 6579 2d70 6174 6827 2c20 276b 6579 272c  ey-path', 'key',
-0000e7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e7e0: 2020 2020 2020 2020 2027 2d2d 6368 6169           '--chai
-0000e7f0: 6e2d 7061 7468 272c 2027 6368 6169 6e27  n-path', 'chain'
-0000e800: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e810: 2020 2020 2020 2020 2020 272d 2d66 756c            '--ful
-0000e820: 6c63 6861 696e 2d70 6174 6827 2c20 2766  lchain-path', 'f
-0000e830: 756c 6c63 6861 696e 275d 290a 0a20 2020  ullchain'])..   
-0000e840: 2020 2020 2063 6f6e 6669 672c 2075 6e75       config, unu
-0000e850: 7365 645f 706c 7567 696e 7320 3d20 6d6f  sed_plugins = mo
-0000e860: 636b 5f63 6572 746f 6e6c 792e 6361 6c6c  ck_certonly.call
-0000e870: 5f61 7267 735b 305d 0a20 2020 2020 2020  _args[0].       
-0000e880: 2061 7373 6572 7420 636f 6e66 6967 2e63   assert config.c
-0000e890: 6572 745f 7061 7468 203d 3d20 6f73 2e70  ert_path == os.p
-0000e8a0: 6174 682e 6162 7370 6174 6828 6365 7274  ath.abspath(cert
-0000e8b0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-0000e8c0: 2063 6f6e 6669 672e 6b65 795f 7061 7468   config.key_path
-0000e8d0: 203d 3d20 6f73 2e70 6174 682e 6162 7370   == os.path.absp
-0000e8e0: 6174 6828 6b65 7929 0a20 2020 2020 2020  ath(key).       
-0000e8f0: 2061 7373 6572 7420 636f 6e66 6967 2e63   assert config.c
-0000e900: 6861 696e 5f70 6174 6820 3d3d 206f 732e  hain_path == os.
-0000e910: 7061 7468 2e61 6273 7061 7468 2863 6861  path.abspath(cha
-0000e920: 696e 290a 2020 2020 2020 2020 6173 7365  in).        asse
-0000e930: 7274 2063 6f6e 6669 672e 6675 6c6c 6368  rt config.fullch
-0000e940: 6169 6e5f 7061 7468 203d 3d20 6f73 2e70  ain_path == os.p
-0000e950: 6174 682e 6162 7370 6174 6828 6675 6c6c  ath.abspath(full
-0000e960: 6368 6169 6e29 0a0a 2020 2020 6465 6620  chain)..    def 
-0000e970: 7465 7374 5f63 6572 746f 6e6c 795f 6261  test_certonly_ba
-0000e980: 645f 6172 6773 2873 656c 6629 3a0a 2020  d_args(self):.  
-0000e990: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e9a0: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
-0000e9b0: 6c28 5b27 2d61 272c 2027 6261 645f 6175  l(['-a', 'bad_au
-0000e9c0: 7468 272c 2027 6365 7274 6f6e 6c79 275d  th', 'certonly']
-0000e9d0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-0000e9e0: 7365 7274 2046 616c 7365 2c20 2245 7863  sert False, "Exc
-0000e9f0: 6570 7469 6f6e 2073 686f 756c 6420 6861  eption should ha
-0000ea00: 7665 2062 6565 6e20 7261 6973 6564 220a  ve been raised".
-0000ea10: 2020 2020 2020 2020 6578 6365 7074 2065          except e
-0000ea20: 7272 6f72 732e 506c 7567 696e 5365 6c65  rrors.PluginSele
-0000ea30: 6374 696f 6e45 7272 6f72 2061 7320 653a  ctionError as e:
-0000ea40: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000ea50: 6572 7420 2754 6865 2072 6571 7565 7374  ert 'The request
-0000ea60: 6564 2062 6164 5f61 7574 6820 706c 7567  ed bad_auth plug
-0000ea70: 696e 2064 6f65 7320 6e6f 7420 6170 7065  in does not appe
-0000ea80: 6172 2720 696e 2073 7472 2865 290a 0a20  ar' in str(e).. 
-0000ea90: 2020 2064 6566 2074 6573 745f 6368 6563     def test_chec
-0000eaa0: 6b5f 636f 6e66 6967 5f73 616e 6974 795f  k_config_sanity_
-0000eab0: 646f 6d61 696e 2873 656c 6629 3a0a 2020  domain(self):.  
-0000eac0: 2020 2020 2020 2320 4651 444e 0a20 2020        # FQDN.   
-0000ead0: 2020 2020 2077 6974 6820 7079 7465 7374       with pytest
-0000eae0: 2e72 6169 7365 7328 6572 726f 7273 2e43  .raises(errors.C
-0000eaf0: 6f6e 6669 6775 7261 7469 6f6e 4572 726f  onfigurationErro
-0000eb00: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0000eb10: 7365 6c66 2e5f 6361 6c6c 285b 272d 6427  self._call(['-d'
-0000eb20: 2c20 2761 2720 2a20 3634 5d29 0a20 2020  , 'a' * 64]).   
-0000eb30: 2020 2020 2023 2046 5144 4e20 320a 2020       # FQDN 2.  
-0000eb40: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
-0000eb50: 742e 7261 6973 6573 2865 7272 6f72 732e  t.raises(errors.
-0000eb60: 436f 6e66 6967 7572 6174 696f 6e45 7272  ConfigurationErr
-0000eb70: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0000eb80: 2073 656c 662e 5f63 616c 6c28 5b27 2d64   self._call(['-d
-0000eb90: 272c 2028 2827 6127 202a 2035 3029 202b  ', (('a' * 50) +
-0000eba0: 2027 2e27 2920 2a20 3130 5d29 0a20 2020   '.') * 10]).   
-0000ebb0: 2020 2020 2023 2042 6172 6520 4950 2061       # Bare IP a
-0000ebc0: 6464 7265 7373 2028 7468 6973 2069 7320  ddress (this is 
-0000ebd0: 6163 7475 616c 6c79 2061 2064 6966 6665  actually a diffe
-0000ebe0: 7265 6e74 2065 7272 6f72 206d 6573 7361  rent error messa
-0000ebf0: 6765 206e 6f77 290a 2020 2020 2020 2020  ge now).        
-0000ec00: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
-0000ec10: 6573 2865 7272 6f72 732e 436f 6e66 6967  es(errors.Config
-0000ec20: 7572 6174 696f 6e45 7272 6f72 293a 0a20  urationError):. 
-0000ec30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000ec40: 5f63 616c 6c28 5b27 2d64 272c 2027 3230  _call(['-d', '20
-0000ec50: 342e 3131 2e32 3331 2e33 3527 5d29 0a20  4.11.231.35']). 
-0000ec60: 2020 2020 2020 2023 2042 6172 6520 4950         # Bare IP
-0000ec70: 7636 2061 6464 7265 7373 0a20 2020 2020  v6 address.     
-0000ec80: 2020 2077 6974 6820 7079 7465 7374 2e72     with pytest.r
-0000ec90: 6169 7365 7328 6572 726f 7273 2e43 6f6e  aises(errors.Con
-0000eca0: 6669 6775 7261 7469 6f6e 4572 726f 7229  figurationError)
-0000ecb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000ecc0: 6c66 2e5f 6361 6c6c 285b 272d 6427 2c20  lf._call(['-d', 
-0000ecd0: 2732 3030 313a 6462 383a 6163 3639 3a33  '2001:db8:ac69:3
-0000ece0: 6666 3a62 3163 623a 6338 6336 3a35 6138  ff:b1cb:c8c6:5a8
-0000ecf0: 343a 6133 3162 275d 290a 0a20 2020 2064  4:a31b'])..    d
-0000ed00: 6566 2074 6573 745f 6373 725f 7769 7468  ef test_csr_with
-0000ed10: 5f62 6573 7465 6666 6f72 7428 7365 6c66  _besteffort(self
-0000ed20: 293a 0a20 2020 2020 2020 2077 6974 6820  ):.        with 
-0000ed30: 7079 7465 7374 2e72 6169 7365 7328 6572  pytest.raises(er
-0000ed40: 726f 7273 2e45 7272 6f72 293a 0a20 2020  rors.Error):.   
-0000ed50: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000ed60: 616c 6c28 2763 6572 746f 6e6c 7920 2d2d  all('certonly --
-0000ed70: 6373 7220 7b30 7d20 2d2d 616c 6c6f 772d  csr {0} --allow-
-0000ed80: 7375 6273 6574 2d6f 662d 6e61 6d65 7327  subset-of-names'
-0000ed90: 2e66 6f72 6d61 7428 4353 5229 2e73 706c  .format(CSR).spl
-0000eda0: 6974 2829 290a 0a20 2020 2064 6566 2074  it())..    def t
-0000edb0: 6573 745f 7275 6e5f 7769 7468 5f63 7372  est_run_with_csr
-0000edc0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000edd0: 2320 5468 6973 2069 7320 616e 2065 7272  # This is an err
-0000ede0: 6f72 2062 6563 6175 7365 2079 6f75 2063  or because you c
-0000edf0: 616e 206f 6e6c 7920 7573 6520 2d2d 6373  an only use --cs
-0000ee00: 7220 7769 7468 2063 6572 746f 6e6c 790a  r with certonly.
-0000ee10: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000ee20: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0000ee30: 616c 6c28 5b27 2d2d 6373 7227 2c20 4353  all(['--csr', CS
-0000ee40: 525d 290a 2020 2020 2020 2020 6578 6365  R]).        exce
-0000ee50: 7074 2065 7272 6f72 732e 4572 726f 7220  pt errors.Error 
-0000ee60: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000ee70: 2020 6173 7365 7274 2022 506c 6561 7365    assert "Please
-0000ee80: 2074 7279 2074 6865 2063 6572 746f 6e6c   try the certonl
-0000ee90: 7922 2069 6e20 7265 7072 2865 290a 2020  y" in repr(e).  
-0000eea0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000eeb0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0000eec0: 4661 6c73 652c 2022 4578 7065 6374 6564  False, "Expected
-0000eed0: 2073 7570 706c 7969 6e67 202d 2d63 7372   supplying --csr
-0000eee0: 2074 6f20 6661 696c 2077 6974 6820 6465   to fail with de
-0000eef0: 6661 756c 7420 7665 7262 220a 0a20 2020  fault verb"..   
-0000ef00: 2064 6566 2074 6573 745f 6373 725f 7769   def test_csr_wi
-0000ef10: 7468 5f6e 6f5f 646f 6d61 696e 7328 7365  th_no_domains(se
-0000ef20: 6c66 293a 0a20 2020 2020 2020 2077 6974  lf):.        wit
-0000ef30: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
-0000ef40: 6572 726f 7273 2e45 7272 6f72 293a 0a20  errors.Error):. 
-0000ef50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000ef60: 5f63 616c 6c28 2763 6572 746f 6e6c 7920  _call('certonly 
-0000ef70: 2d2d 6373 7220 7b30 7d27 2e66 6f72 6d61  --csr {0}'.forma
-0000ef80: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000ef90: 2020 2074 6573 745f 7574 696c 2e76 6563     test_util.vec
-0000efa0: 746f 725f 7061 7468 2827 6373 722d 6e6f  tor_path('csr-no
-0000efb0: 6e61 6d65 735f 3531 322e 7065 6d27 2929  names_512.pem'))
-0000efc0: 2e73 706c 6974 2829 290a 0a20 2020 2064  .split())..    d
-0000efd0: 6566 2074 6573 745f 6373 725f 7769 7468  ef test_csr_with
-0000efe0: 5f69 6e63 6f6e 7369 7374 656e 745f 646f  _inconsistent_do
-0000eff0: 6d61 696e 7328 7365 6c66 293a 0a20 2020  mains(self):.   
-0000f000: 2020 2020 2077 6974 6820 7079 7465 7374       with pytest
-0000f010: 2e72 6169 7365 7328 6572 726f 7273 2e45  .raises(errors.E
-0000f020: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-0000f030: 2020 2073 656c 662e 5f63 616c 6c28 2763     self._call('c
-0000f040: 6572 746f 6e6c 7920 2d64 2065 7861 6d70  ertonly -d examp
-0000f050: 6c65 2e6f 7267 202d 2d63 7372 207b 307d  le.org --csr {0}
-0000f060: 272e 666f 726d 6174 2843 5352 292e 7370  '.format(CSR).sp
-0000f070: 6c69 7428 2929 0a0a 2020 2020 6465 6620  lit())..    def 
-0000f080: 5f63 6572 746f 6e6c 795f 6e65 775f 7265  _certonly_new_re
-0000f090: 7175 6573 745f 636f 6d6d 6f6e 2873 656c  quest_common(sel
-0000f0a0: 662c 206d 6f63 6b5f 636c 6965 6e74 2c20  f, mock_client, 
-0000f0b0: 6172 6773 3d4e 6f6e 6529 3a0a 2020 2020  args=None):.    
-0000f0c0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000f0d0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-0000f0e0: 7465 726e 616c 2e6d 6169 6e2e 5f66 696e  ternal.main._fin
-0000f0f0: 645f 6c69 6e65 6167 655f 666f 725f 646f  d_lineage_for_do
-0000f100: 6d61 696e 735f 616e 645f 6365 7274 6e61  mains_and_certna
-0000f110: 6d65 2729 205c 0a20 2020 2020 2020 2020  me') \.         
-0000f120: 2020 2061 7320 6d6f 636b 5f72 656e 6577     as mock_renew
-0000f130: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
-0000f140: 6d6f 636b 5f72 656e 6577 616c 2e72 6574  mock_renewal.ret
-0000f150: 7572 6e5f 7661 6c75 6520 3d20 2822 6e65  urn_value = ("ne
-0000f160: 7763 6572 7422 2c20 4e6f 6e65 290a 2020  wcert", None).  
-0000f170: 2020 2020 2020 2020 2020 7769 7468 206d            with m
-0000f180: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0000f190: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-0000f1a0: 6e2e 5f69 6e69 745f 6c65 5f63 6c69 656e  n._init_le_clien
-0000f1b0: 7427 2920 6173 206d 6f63 6b5f 696e 6974  t') as mock_init
-0000f1c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f1d0: 2020 6d6f 636b 5f69 6e69 742e 7265 7475    mock_init.retu
-0000f1e0: 726e 5f76 616c 7565 203d 206d 6f63 6b5f  rn_value = mock_
-0000f1f0: 636c 6965 6e74 0a20 2020 2020 2020 2020  client.         
-0000f200: 2020 2020 2020 2069 6620 6172 6773 2069         if args i
-0000f210: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000f220: 2020 2020 2020 2020 2020 2020 6172 6773              args
-0000f230: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0000f240: 2020 2020 2020 6172 6773 202b 3d20 272d        args += '-
-0000f250: 6420 666f 6f2e 6261 7220 2d61 2073 7461  d foo.bar -a sta
-0000f260: 6e64 616c 6f6e 6520 6365 7274 6f6e 6c79  ndalone certonly
-0000f270: 272e 7370 6c69 7428 290a 2020 2020 2020  '.split().      
-0000f280: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000f290: 6361 6c6c 2861 7267 7329 0a0a 2020 2020  call(args)..    
-0000f2a0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-0000f2b0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-0000f2c0: 6169 6e2e 5f72 6570 6f72 745f 6e65 775f  ain._report_new_
-0000f2d0: 6365 7274 2729 0a20 2020 2064 6566 2074  cert').    def t
-0000f2e0: 6573 745f 6365 7274 6f6e 6c79 5f64 7279  est_certonly_dry
-0000f2f0: 5f72 756e 5f6e 6577 5f72 6571 7565 7374  _run_new_request
-0000f300: 5f73 7563 6365 7373 2873 656c 662c 206d  _success(self, m
-0000f310: 6f63 6b5f 7265 706f 7274 293a 0a20 2020  ock_report):.   
-0000f320: 2020 2020 206d 6f63 6b5f 636c 6965 6e74       mock_client
-0000f330: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
-0000f340: 6b28 290a 2020 2020 2020 2020 6d6f 636b  k().        mock
-0000f350: 5f63 6c69 656e 742e 6f62 7461 696e 5f61  _client.obtain_a
-0000f360: 6e64 5f65 6e72 6f6c 6c5f 6365 7274 6966  nd_enroll_certif
-0000f370: 6963 6174 652e 7265 7475 726e 5f76 616c  icate.return_val
-0000f380: 7565 203d 204e 6f6e 650a 2020 2020 2020  ue = None.      
-0000f390: 2020 7365 6c66 2e5f 6365 7274 6f6e 6c79    self._certonly
-0000f3a0: 5f6e 6577 5f72 6571 7565 7374 5f63 6f6d  _new_request_com
-0000f3b0: 6d6f 6e28 6d6f 636b 5f63 6c69 656e 742c  mon(mock_client,
-0000f3c0: 205b 272d 2d64 7279 2d72 756e 275d 290a   ['--dry-run']).
-0000f3d0: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-0000f3e0: 6f63 6b5f 636c 6965 6e74 2e6f 6274 6169  ock_client.obtai
-0000f3f0: 6e5f 616e 645f 656e 726f 6c6c 5f63 6572  n_and_enroll_cer
-0000f400: 7469 6669 6361 7465 2e63 616c 6c5f 636f  tificate.call_co
-0000f410: 756e 7420 3d3d 2031 0a20 2020 2020 2020  unt == 1.       
-0000f420: 2061 7373 6572 7420 6d6f 636b 5f72 6570   assert mock_rep
-0000f430: 6f72 742e 6361 6c6c 5f63 6f75 6e74 203d  ort.call_count =
-0000f440: 3d20 310a 2020 2020 2020 2020 6173 7365  = 1.        asse
-0000f450: 7274 206d 6f63 6b5f 7265 706f 7274 2e63  rt mock_report.c
-0000f460: 616c 6c5f 6172 6773 5b30 5d5b 305d 2e64  all_args[0][0].d
-0000f470: 7279 5f72 756e 2069 7320 5472 7565 0a0a  ry_run is True..
-0000f480: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-0000f490: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-0000f4a0: 616c 2e6d 6169 6e2e 5f72 6570 6f72 745f  al.main._report_
-0000f4b0: 6e65 775f 6365 7274 2729 0a20 2020 2040  new_cert').    @
-0000f4c0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0000f4d0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-0000f4e0: 696e 2e75 7469 6c2e 6174 6578 6974 5f72  in.util.atexit_r
-0000f4f0: 6567 6973 7465 7227 290a 2020 2020 406d  egister').    @m
-0000f500: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0000f510: 6f74 2e5f 696e 7465 726e 616c 2e65 6666  ot._internal.eff
-0000f520: 2e68 616e 646c 655f 7375 6273 6372 6970  .handle_subscrip
-0000f530: 7469 6f6e 2729 0a20 2020 2040 6d6f 636b  tion').    @mock
-0000f540: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0000f550: 6372 7970 746f 5f75 7469 6c2e 6e6f 7441  crypto_util.notA
-0000f560: 6674 6572 2729 0a20 2020 2064 6566 2074  fter').    def t
-0000f570: 6573 745f 6365 7274 6f6e 6c79 5f6e 6577  est_certonly_new
-0000f580: 5f72 6571 7565 7374 5f73 7563 6365 7373  _request_success
-0000f590: 2873 656c 662c 206d 6f63 6b5f 6e6f 7441  (self, mock_notA
-0000f5a0: 6674 6572 2c0a 2020 2020 2020 2020 2020  fter,.          
-0000f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5d0: 6d6f 636b 5f73 7562 7363 7269 7074 696f  mock_subscriptio
-0000f5e0: 6e2c 206d 6f63 6b5f 7265 6769 7374 6572  n, mock_register
-0000f5f0: 2c20 6d6f 636b 5f72 6570 6f72 7429 3a0a  , mock_report):.
-0000f600: 2020 2020 2020 2020 6365 7274 5f70 6174          cert_pat
-0000f610: 6820 3d20 6f73 2e70 6174 682e 6e6f 726d  h = os.path.norm
-0000f620: 7061 7468 286f 732e 7061 7468 2e6a 6f69  path(os.path.joi
-0000f630: 6e28 7365 6c66 2e63 6f6e 6669 672e 636f  n(self.config.co
-0000f640: 6e66 6967 5f64 6972 2c20 276c 6976 652f  nfig_dir, 'live/
-0000f650: 666f 6f2e 6261 7227 2929 0a20 2020 2020  foo.bar')).     
-0000f660: 2020 206b 6579 5f70 6174 6820 3d20 6f73     key_path = os
-0000f670: 2e70 6174 682e 6e6f 726d 7061 7468 286f  .path.normpath(o
-0000f680: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-0000f690: 2e63 6f6e 6669 672e 636f 6e66 6967 5f64  .config.config_d
-0000f6a0: 6972 2c20 276c 6976 652f 6261 7a2e 7175  ir, 'live/baz.qu
-0000f6b0: 7827 2929 0a20 2020 2020 2020 2064 6174  x')).        dat
-0000f6c0: 6520 3d20 2731 3937 302d 3031 2d30 3127  e = '1970-01-01'
-0000f6d0: 0a20 2020 2020 2020 206d 6f63 6b5f 6e6f  .        mock_no
-0000f6e0: 7441 6674 6572 2829 2e64 6174 652e 7265  tAfter().date.re
-0000f6f0: 7475 726e 5f76 616c 7565 203d 2064 6174  turn_value = dat
-0000f700: 650a 0a20 2020 2020 2020 206d 6f63 6b5f  e..        mock_
-0000f710: 6c69 6e65 6167 6520 3d20 6d6f 636b 2e4d  lineage = mock.M
-0000f720: 6167 6963 4d6f 636b 2863 6572 743d 6365  agicMock(cert=ce
-0000f730: 7274 5f70 6174 682c 2066 756c 6c63 6861  rt_path, fullcha
-0000f740: 696e 3d63 6572 745f 7061 7468 2c0a 2020  in=cert_path,.  
-0000f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f770: 2020 2020 6675 6c6c 6368 6169 6e5f 7061      fullchain_pa
-0000f780: 7468 3d63 6572 745f 7061 7468 2c20 6b65  th=cert_path, ke
-0000f790: 795f 7061 7468 3d6b 6579 5f70 6174 6829  y_path=key_path)
-0000f7a0: 0a20 2020 2020 2020 206d 6f63 6b5f 636c  .        mock_cl
-0000f7b0: 6965 6e74 203d 206d 6f63 6b2e 4d61 6769  ient = mock.Magi
-0000f7c0: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-0000f7d0: 6d6f 636b 5f63 6c69 656e 742e 6f62 7461  mock_client.obta
-0000f7e0: 696e 5f61 6e64 5f65 6e72 6f6c 6c5f 6365  in_and_enroll_ce
-0000f7f0: 7274 6966 6963 6174 652e 7265 7475 726e  rtificate.return
-0000f800: 5f76 616c 7565 203d 206d 6f63 6b5f 6c69  _value = mock_li
-0000f810: 6e65 6167 650a 2020 2020 2020 2020 7365  neage.        se
-0000f820: 6c66 2e5f 6365 7274 6f6e 6c79 5f6e 6577  lf._certonly_new
-0000f830: 5f72 6571 7565 7374 5f63 6f6d 6d6f 6e28  _request_common(
-0000f840: 6d6f 636b 5f63 6c69 656e 7429 0a20 2020  mock_client).   
-0000f850: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
-0000f860: 5f63 6c69 656e 742e 6f62 7461 696e 5f61  _client.obtain_a
-0000f870: 6e64 5f65 6e72 6f6c 6c5f 6365 7274 6966  nd_enroll_certif
-0000f880: 6963 6174 652e 6361 6c6c 5f63 6f75 6e74  icate.call_count
-0000f890: 203d 3d20 310a 2020 2020 2020 2020 6173   == 1.        as
-0000f8a0: 7365 7274 206d 6f63 6b5f 7265 706f 7274  sert mock_report
-0000f8b0: 2e63 616c 6c5f 636f 756e 7420 3d3d 2031  .call_count == 1
-0000f8c0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0000f8d0: 6365 7274 5f70 6174 6820 696e 206d 6f63  cert_path in moc
-0000f8e0: 6b5f 7265 706f 7274 2e63 616c 6c5f 6172  k_report.call_ar
-0000f8f0: 6773 5b30 5d5b 325d 0a20 2020 2020 2020  gs[0][2].       
-0000f900: 2061 7373 6572 7420 6b65 795f 7061 7468   assert key_path
-0000f910: 2069 6e20 6d6f 636b 5f72 6570 6f72 742e   in mock_report.
-0000f920: 6361 6c6c 5f61 7267 735b 305d 5b33 5d0a  call_args[0][3].
-0000f930: 2020 2020 2020 2020 6173 7365 7274 2027          assert '
-0000f940: 646f 6e61 7465 2720 696e 206d 6f63 6b5f  donate' in mock_
-0000f950: 7265 6769 7374 6572 2e63 616c 6c5f 6172  register.call_ar
-0000f960: 6773 5b30 5d5b 315d 0a20 2020 2020 2020  gs[0][1].       
-0000f970: 2061 7373 6572 7420 6d6f 636b 5f73 7562   assert mock_sub
-0000f980: 7363 7269 7074 696f 6e2e 6361 6c6c 6564  scription.called
-0000f990: 2069 7320 5472 7565 0a0a 2020 2020 406d   is True..    @m
-0000f9a0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0000f9b0: 6f74 2e5f 696e 7465 726e 616c 2e65 6666  ot._internal.eff
-0000f9c0: 2e68 616e 646c 655f 7375 6273 6372 6970  .handle_subscrip
-0000f9d0: 7469 6f6e 2729 0a20 2020 2064 6566 2074  tion').    def t
-0000f9e0: 6573 745f 6365 7274 6f6e 6c79 5f6e 6577  est_certonly_new
-0000f9f0: 5f72 6571 7565 7374 5f66 6169 6c75 7265  _request_failure
-0000fa00: 2873 656c 662c 206d 6f63 6b5f 7375 6273  (self, mock_subs
-0000fa10: 6372 6970 7469 6f6e 293a 0a20 2020 2020  cription):.     
-0000fa20: 2020 206d 6f63 6b5f 636c 6965 6e74 203d     mock_client =
-0000fa30: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-0000fa40: 290a 2020 2020 2020 2020 6d6f 636b 5f63  ).        mock_c
-0000fa50: 6c69 656e 742e 6f62 7461 696e 5f61 6e64  lient.obtain_and
-0000fa60: 5f65 6e72 6f6c 6c5f 6365 7274 6966 6963  _enroll_certific
-0000fa70: 6174 652e 7265 7475 726e 5f76 616c 7565  ate.return_value
-0000fa80: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0000fa90: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
-0000faa0: 7365 7328 6572 726f 7273 2e45 7272 6f72  ses(errors.Error
-0000fab0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000fac0: 656c 662e 5f63 6572 746f 6e6c 795f 6e65  elf._certonly_ne
-0000fad0: 775f 7265 7175 6573 745f 636f 6d6d 6f6e  w_request_common
-0000fae0: 286d 6f63 6b5f 636c 6965 6e74 290a 2020  (mock_client).  
-0000faf0: 2020 2020 2020 6173 7365 7274 206d 6f63        assert moc
-0000fb00: 6b5f 7375 6273 6372 6970 7469 6f6e 2e63  k_subscription.c
-0000fb10: 616c 6c65 6420 6973 2046 616c 7365 0a0a  alled is False..
-0000fb20: 2020 2020 6465 6620 5f74 6573 745f 7265      def _test_re
-0000fb30: 6e65 7761 6c5f 636f 6d6d 6f6e 2873 656c  newal_common(sel
-0000fb40: 662c 2064 7565 5f66 6f72 5f72 656e 6577  f, due_for_renew
-0000fb50: 616c 2c20 6578 7472 615f 6172 6773 2c20  al, extra_args, 
-0000fb60: 6c6f 675f 6f75 743d 4e6f 6e65 2c0a 2020  log_out=None,.  
-0000fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb80: 2020 2020 2020 2020 2020 2061 7267 733d             args=
-0000fb90: 4e6f 6e65 2c20 7368 6f75 6c64 5f72 656e  None, should_ren
-0000fba0: 6577 3d54 7275 652c 2065 7272 6f72 5f65  ew=True, error_e
-0000fbb0: 7870 6563 7465 643d 4661 6c73 652c 0a20  xpected=False,. 
-0000fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbd0: 2020 2020 2020 2020 2020 2020 7175 6965              quie
-0000fbe0: 745f 6d6f 6465 3d46 616c 7365 2c20 6578  t_mode=False, ex
-0000fbf0: 7069 7279 5f64 6174 653d 6461 7465 7469  piry_date=dateti
-0000fc00: 6d65 2e64 6174 6574 696d 652e 6e6f 7728  me.datetime.now(
-0000fc10: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc30: 7265 7573 655f 6b65 793d 4661 6c73 652c  reuse_key=False,
-0000fc40: 206e 6577 5f6b 6579 3d46 616c 7365 293a   new_key=False):
-0000fc50: 0a20 2020 2020 2020 2063 6572 745f 7061  .        cert_pa
-0000fc60: 7468 203d 2074 6573 745f 7574 696c 2e76  th = test_util.v
-0000fc70: 6563 746f 725f 7061 7468 2827 6365 7274  ector_path('cert
-0000fc80: 5f35 3132 2e70 656d 2729 0a20 2020 2020  _512.pem').     
-0000fc90: 2020 2063 6861 696e 5f70 6174 6820 3d20     chain_path = 
-0000fca0: 6f73 2e70 6174 682e 6e6f 726d 7061 7468  os.path.normpath
-0000fcb0: 286f 732e 7061 7468 2e6a 6f69 6e28 7365  (os.path.join(se
-0000fcc0: 6c66 2e63 6f6e 6669 672e 636f 6e66 6967  lf.config.config
-0000fcd0: 5f64 6972 2c0a 2020 2020 2020 2020 2020  _dir,.          
-0000fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd00: 2020 2020 2020 2020 2027 6c69 7665 2f66           'live/f
-0000fd10: 6f6f 2e62 6172 2f66 756c 6c63 6861 696e  oo.bar/fullchain
-0000fd20: 2e70 656d 2729 290a 2020 2020 2020 2020  .pem')).        
-0000fd30: 6d6f 636b 5f6c 696e 6561 6765 203d 206d  mock_lineage = m
-0000fd40: 6f63 6b2e 4d61 6769 634d 6f63 6b28 6365  ock.MagicMock(ce
-0000fd50: 7274 3d63 6572 745f 7061 7468 2c20 6675  rt=cert_path, fu
-0000fd60: 6c6c 6368 6169 6e3d 6368 6169 6e5f 7061  llchain=chain_pa
-0000fd70: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-0000fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd90: 2020 2020 2020 2020 2020 6365 7274 5f70            cert_p
-0000fda0: 6174 683d 6365 7274 5f70 6174 682c 2066  ath=cert_path, f
-0000fdb0: 756c 6c63 6861 696e 5f70 6174 683d 6368  ullchain_path=ch
-0000fdc0: 6169 6e5f 7061 7468 290a 2020 2020 2020  ain_path).      
-0000fdd0: 2020 6d6f 636b 5f6c 696e 6561 6765 2e73    mock_lineage.s
-0000fde0: 686f 756c 645f 6175 746f 7265 6e65 772e  hould_autorenew.
-0000fdf0: 7265 7475 726e 5f76 616c 7565 203d 2064  return_value = d
-0000fe00: 7565 5f66 6f72 5f72 656e 6577 616c 0a20  ue_for_renewal. 
-0000fe10: 2020 2020 2020 206d 6f63 6b5f 6c69 6e65         mock_line
-0000fe20: 6167 652e 6861 735f 7065 6e64 696e 675f  age.has_pending_
-0000fe30: 6465 706c 6f79 6d65 6e74 2e72 6574 7572  deployment.retur
-0000fe40: 6e5f 7661 6c75 6520 3d20 4661 6c73 650a  n_value = False.
-0000fe50: 2020 2020 2020 2020 6d6f 636b 5f6c 696e          mock_lin
-0000fe60: 6561 6765 2e6e 616d 6573 2e72 6574 7572  eage.names.retur
-0000fe70: 6e5f 7661 6c75 6520 3d20 5b27 6973 6e6f  n_value = ['isno
-0000fe80: 742e 6f72 6727 5d0a 2020 2020 2020 2020  t.org'].        
-0000fe90: 6d6f 636b 5f6c 696e 6561 6765 2e70 7269  mock_lineage.pri
-0000fea0: 7661 7465 5f6b 6579 5f74 7970 6520 3d20  vate_key_type = 
-0000feb0: 2765 6364 7361 270a 2020 2020 2020 2020  'ecdsa'.        
-0000fec0: 6d6f 636b 5f6c 696e 6561 6765 2e65 6c6c  mock_lineage.ell
-0000fed0: 6970 7469 635f 6375 7276 6520 3d20 2773  iptic_curve = 's
-0000fee0: 6563 7032 3536 7231 270a 2020 2020 2020  ecp256r1'.      
-0000fef0: 2020 6d6f 636b 5f6c 696e 6561 6765 2e72    mock_lineage.r
-0000ff00: 6575 7365 5f6b 6579 203d 2072 6575 7365  euse_key = reuse
-0000ff10: 5f6b 6579 0a20 2020 2020 2020 206d 6f63  _key.        moc
-0000ff20: 6b5f 6365 7274 7220 3d20 6d6f 636b 2e4d  k_certr = mock.M
-0000ff30: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-0000ff40: 2020 206d 6f63 6b5f 6b65 7920 3d20 6d6f     mock_key = mo
-0000ff50: 636b 2e4d 6167 6963 4d6f 636b 2870 656d  ck.MagicMock(pem
-0000ff60: 3d27 7065 6d5f 6b65 7927 290a 2020 2020  ='pem_key').    
-0000ff70: 2020 2020 6d6f 636b 5f63 6c69 656e 7420      mock_client 
-0000ff80: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-0000ff90: 2829 0a20 2020 2020 2020 2073 7464 6f75  ().        stdou
-0000ffa0: 7420 3d20 696f 2e53 7472 696e 6749 4f28  t = io.StringIO(
-0000ffb0: 290a 2020 2020 2020 2020 6d6f 636b 5f63  ).        mock_c
-0000ffc0: 6c69 656e 742e 6f62 7461 696e 5f63 6572  lient.obtain_cer
-0000ffd0: 7469 6669 6361 7465 2e72 6574 7572 6e5f  tificate.return_
-0000ffe0: 7661 6c75 6520 3d20 286d 6f63 6b5f 6365  value = (mock_ce
-0000fff0: 7274 722c 2027 6368 6169 6e27 2c0a 2020  rtr, 'chain',.  
-00010000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010030: 2020 2020 206d 6f63 6b5f 6b65 792c 2027       mock_key, '
-00010040: 6373 7227 290a 0a20 2020 2020 2020 2064  csr')..        d
-00010050: 6566 2077 7269 7465 5f6d 7367 286d 6573  ef write_msg(mes
-00010060: 7361 6765 2c20 2a61 7267 732c 202a 2a6b  sage, *args, **k
-00010070: 7761 7267 7329 3a20 2023 2070 796c 696e  wargs):  # pylin
-00010080: 743a 2064 6973 6162 6c65 3d75 6e75 7365  t: disable=unuse
-00010090: 642d 6172 6775 6d65 6e74 0a20 2020 2020  d-argument.     
-000100a0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-000100b0: 6d65 7373 6167 6520 746f 2073 7464 6f75  message to stdou
-000100c0: 742e 2222 220a 2020 2020 2020 2020 2020  t.""".          
-000100d0: 2020 7374 646f 7574 2e77 7269 7465 286d    stdout.write(m
-000100e0: 6573 7361 6765 290a 0a20 2020 2020 2020  essage)..       
-000100f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00010100: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
-00010110: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-00010120: 726e 616c 2e63 6572 745f 6d61 6e61 6765  rnal.cert_manage
-00010130: 722e 6669 6e64 5f64 7570 6c69 6361 7469  r.find_duplicati
-00010140: 7665 5f63 6572 7473 2729 2061 7320 6d6f  ve_certs') as mo
-00010150: 636b 5f66 6463 3a0a 2020 2020 2020 2020  ck_fdc:.        
-00010160: 2020 2020 2020 2020 6d6f 636b 5f66 6463          mock_fdc
-00010170: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00010180: 286d 6f63 6b5f 6c69 6e65 6167 652c 204e  (mock_lineage, N
-00010190: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-000101a0: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-000101b0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000101c0: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 696e  nternal.main._in
-000101d0: 6974 5f6c 655f 636c 6965 6e74 2729 2061  it_le_client') a
-000101e0: 7320 6d6f 636b 5f69 6e69 743a 0a20 2020  s mock_init:.   
-000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010200: 206d 6f63 6b5f 696e 6974 2e72 6574 7572   mock_init.retur
-00010210: 6e5f 7661 6c75 6520 3d20 6d6f 636b 5f63  n_value = mock_c
-00010220: 6c69 656e 740a 2020 2020 2020 2020 2020  lient.          
-00010230: 2020 2020 2020 2020 2020 7769 7468 206d            with m
-00010240: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00010250: 6f74 2e5f 696e 7465 726e 616c 2e64 6973  ot._internal.dis
-00010260: 706c 6179 2e6f 626a 2e67 6574 5f64 6973  play.obj.get_dis
-00010270: 706c 6179 2729 2061 7320 6d6f 636b 5f64  play') as mock_d
-00010280: 6973 706c 6179 3a0a 2020 2020 2020 2020  isplay:.        
-00010290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102a0: 6966 206e 6f74 2071 7569 6574 5f6d 6f64  if not quiet_mod
-000102b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000102c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000102d0: 6f63 6b5f 6469 7370 6c61 7928 292e 6e6f  ock_display().no
-000102e0: 7469 6669 6361 7469 6f6e 2e73 6964 655f  tification.side_
-000102f0: 6566 6665 6374 203d 2077 7269 7465 5f6d  effect = write_m
-00010300: 7367 0a20 2020 2020 2020 2020 2020 2020  sg.             
-00010310: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00010320: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00010330: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-00010340: 696e 2e72 656e 6577 616c 2e63 7279 7074  in.renewal.crypt
-00010350: 6f5f 7574 696c 2729 205c 0a20 2020 2020  o_util') \.     
-00010360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010370: 2020 2020 2020 2061 7320 6d6f 636b 5f63         as mock_c
-00010380: 7279 7074 6f5f 7574 696c 3a0a 2020 2020  rypto_util:.    
-00010390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103a0: 2020 2020 2020 2020 6d6f 636b 5f63 7279          mock_cry
-000103b0: 7074 6f5f 7574 696c 2e6e 6f74 4166 7465  pto_util.notAfte
-000103c0: 722e 7265 7475 726e 5f76 616c 7565 203d  r.return_value =
-000103d0: 2065 7870 6972 795f 6461 7465 0a20 2020   expiry_date.   
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103f0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
-00010400: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00010410: 742e 5f69 6e74 6572 6e61 6c2e 6566 662e  t._internal.eff.
-00010420: 6861 6e64 6c65 5f73 7562 7363 7269 7074  handle_subscript
-00010430: 696f 6e27 293a 0a20 2020 2020 2020 2020  ion'):.         
-00010440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010450: 2020 2020 2020 2069 6620 6e6f 7420 6172         if not ar
-00010460: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00010470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010480: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-00010490: 272d 6427 2c20 2769 736e 6f74 2e6f 7267  '-d', 'isnot.org
-000104a0: 272c 2027 2d61 272c 2027 7374 616e 6461  ', '-a', 'standa
-000104b0: 6c6f 6e65 272c 2027 6365 7274 6f6e 6c79  lone', 'certonly
-000104c0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-000104d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104e0: 2020 2069 6620 6578 7472 615f 6172 6773     if extra_args
-000104f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010510: 2020 2020 2020 6172 6773 202b 3d20 6578        args += ex
-00010520: 7472 615f 6172 6773 0a20 2020 2020 2020  tra_args.       
-00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010540: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010570: 2020 7265 742c 2073 7464 6f75 742c 205f    ret, stdout, _
-00010580: 2c20 5f20 3d20 7365 6c66 2e5f 6361 6c6c  , _ = self._call
-00010590: 2861 7267 732c 2073 7464 6f75 7429 0a20  (args, stdout). 
-000105a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105c0: 2020 2069 6620 7265 743a 0a20 2020 2020     if ret:.     
-000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105f0: 2020 2070 7269 6e74 2822 5265 7475 726e     print("Return
-00010600: 6564 222c 2072 6574 290a 2020 2020 2020  ed", ret).      
-00010610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010630: 2020 7261 6973 6520 4173 7365 7274 696f    raise Assertio
-00010640: 6e45 7272 6f72 2872 6574 290a 2020 2020  nError(ret).    
-00010650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010670: 6173 7365 7274 206e 6f74 2065 7272 6f72  assert not error
-00010680: 5f65 7870 6563 7465 642c 2022 7265 6e65  _expected, "rene
-00010690: 7761 6c20 7368 6f75 6c64 2068 6176 6520  wal should have 
-000106a0: 6572 726f 7265 6422 0a20 2020 2020 2020  errored".       
-000106b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106c0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-000106d0: 2023 2070 796c 696e 743a 2064 6973 6162   # pylint: disab
-000106e0: 6c65 3d62 6172 652d 6578 6365 7074 0a20  le=bare-except. 
-000106f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010710: 2020 2069 6620 6e6f 7420 6572 726f 725f     if not error_
-00010720: 6578 7065 6374 6564 3a0a 2020 2020 2020  expected:.      
+00004090: 5f63 616c 6c65 6428 290a 0a20 2020 2040  _called()..    @
+000040a0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+000040b0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+000040c0: 696e 2e5f 7265 706f 7274 5f6e 6578 745f  in._report_next_
+000040d0: 7374 6570 7327 290a 2020 2020 406d 6f63  steps').    @moc
+000040e0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+000040f0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00004100: 5f72 6570 6f72 745f 6e65 775f 6365 7274  _report_new_cert
+00004110: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+00004120: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00004130: 6572 6e61 6c2e 6d61 696e 2e5f 6669 6e64  ernal.main._find
+00004140: 5f63 6572 7427 290a 2020 2020 406d 6f63  _cert').    @moc
+00004150: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+00004160: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00004170: 5f67 6574 5f61 6e64 5f73 6176 655f 6365  _get_and_save_ce
+00004180: 7274 2729 0a20 2020 2064 6566 2074 6573  rt').    def tes
+00004190: 745f 696e 7661 6c69 645f 696e 7374 616c  t_invalid_instal
+000041a0: 6c65 7228 7365 6c66 2c20 6d6f 636b 5f67  ler(self, mock_g
+000041b0: 6574 5f63 6572 742c 206d 6f63 6b5f 6669  et_cert, mock_fi
+000041c0: 6e64 5f63 6572 742c 0a20 2020 2020 2020  nd_cert,.       
+000041d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041e0: 2020 2020 2020 2020 756e 7573 6564 5f72          unused_r
+000041f0: 6570 6f72 745f 6e65 772c 2075 6e75 7365  eport_new, unuse
+00004200: 645f 7265 706f 7274 5f6e 6578 7429 3a0a  d_report_next):.
+00004210: 2020 2020 2020 2020 6d6f 636b 5f67 6574          mock_get
+00004220: 5f63 6572 742e 7265 7475 726e 5f76 616c  _cert.return_val
+00004230: 7565 203d 206d 6f63 6b2e 4d61 6769 634d  ue = mock.MagicM
+00004240: 6f63 6b28 290a 2020 2020 2020 2020 6d6f  ock().        mo
+00004250: 636b 5f66 696e 645f 6365 7274 2e72 6574  ck_find_cert.ret
+00004260: 7572 6e5f 7661 6c75 6520 3d20 2854 7275  urn_value = (Tru
+00004270: 652c 204e 6f6e 6529 0a20 2020 2020 2020  e, None).       
+00004280: 2073 656c 662e 5f63 616c 6c28 2866 2763   self._call((f'c
+00004290: 6572 746f 6e6c 7920 2d2d 7765 6272 6f6f  ertonly --webroo
+000042a0: 7420 2d77 207b 7465 6d70 6669 6c65 2e67  t -w {tempfile.g
+000042b0: 6574 7465 6d70 6469 7228 297d 2027 202b  ettempdir()} ' +
+000042c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000042d0: 2020 2020 2027 2d69 2073 7461 6e64 616c       '-i standal
+000042e0: 6f6e 6520 2d64 2065 7861 6d70 6c65 2e63  one -d example.c
+000042f0: 6f6d 2729 2e73 706c 6974 2829 290a 0a0a  om').split())...
+00004300: 636c 6173 7320 4669 6e64 446f 6d61 696e  class FindDomain
+00004310: 734f 7243 6572 746e 616d 6554 6573 7428  sOrCertnameTest(
+00004320: 756e 6974 7465 7374 2e54 6573 7443 6173  unittest.TestCas
+00004330: 6529 3a0a 2020 2020 2222 2254 6573 7473  e):.    """Tests
+00004340: 2066 6f72 2063 6572 7462 6f74 2e5f 696e   for certbot._in
+00004350: 7465 726e 616c 2e6d 6169 6e2e 5f66 696e  ternal.main._fin
+00004360: 645f 646f 6d61 696e 735f 6f72 5f63 6572  d_domains_or_cer
+00004370: 746e 616d 652e 2222 220a 0a20 2020 2040  tname."""..    @
+00004380: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00004390: 626f 742e 6469 7370 6c61 792e 6f70 732e  bot.display.ops.
+000043a0: 6368 6f6f 7365 5f6e 616d 6573 2729 0a20  choose_names'). 
+000043b0: 2020 2064 6566 2074 6573 745f 6469 7370     def test_disp
+000043c0: 6c61 795f 6f70 7328 7365 6c66 2c20 6d6f  lay_ops(self, mo
+000043d0: 636b 5f63 686f 6f73 655f 6e61 6d65 7329  ck_choose_names)
+000043e0: 3a0a 2020 2020 2020 2020 6d6f 636b 5f63  :.        mock_c
+000043f0: 6f6e 6669 6720 3d20 6d6f 636b 2e4d 6f63  onfig = mock.Moc
+00004400: 6b28 646f 6d61 696e 733d 4e6f 6e65 2c20  k(domains=None, 
+00004410: 6365 7274 6e61 6d65 3d4e 6f6e 6529 0a20  certname=None). 
+00004420: 2020 2020 2020 206d 6f63 6b5f 6368 6f6f         mock_choo
+00004430: 7365 5f6e 616d 6573 2e72 6574 7572 6e5f  se_names.return_
+00004440: 7661 6c75 6520 3d20 2264 6f6d 6169 6e6e  value = "domainn
+00004450: 616d 6522 0a20 2020 2020 2020 2023 2070  ame".        # p
+00004460: 796c 696e 743a 2064 6973 6162 6c65 3d70  ylint: disable=p
+00004470: 726f 7465 6374 6564 2d61 6363 6573 730a  rotected-access.
+00004480: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
+00004490: 6169 6e2e 5f66 696e 645f 646f 6d61 696e  ain._find_domain
+000044a0: 735f 6f72 5f63 6572 746e 616d 6528 6d6f  s_or_certname(mo
+000044b0: 636b 5f63 6f6e 6669 672c 204e 6f6e 6529  ck_config, None)
+000044c0: 203d 3d20 2822 646f 6d61 696e 6e61 6d65   == ("domainname
+000044d0: 222c 204e 6f6e 6529 0a0a 2020 2020 406d  ", None)..    @m
+000044e0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+000044f0: 6f74 2e64 6973 706c 6179 2e6f 7073 2e63  ot.display.ops.c
+00004500: 686f 6f73 655f 6e61 6d65 7327 290a 2020  hoose_names').  
+00004510: 2020 6465 6620 7465 7374 5f6e 6f5f 7265    def test_no_re
+00004520: 7375 6c74 7328 7365 6c66 2c20 6d6f 636b  sults(self, mock
+00004530: 5f63 686f 6f73 655f 6e61 6d65 7329 3a0a  _choose_names):.
+00004540: 2020 2020 2020 2020 6d6f 636b 5f63 6f6e          mock_con
+00004550: 6669 6720 3d20 6d6f 636b 2e4d 6f63 6b28  fig = mock.Mock(
+00004560: 646f 6d61 696e 733d 4e6f 6e65 2c20 6365  domains=None, ce
+00004570: 7274 6e61 6d65 3d4e 6f6e 6529 0a20 2020  rtname=None).   
+00004580: 2020 2020 206d 6f63 6b5f 6368 6f6f 7365       mock_choose
+00004590: 5f6e 616d 6573 2e72 6574 7572 6e5f 7661  _names.return_va
+000045a0: 6c75 6520 3d20 5b5d 0a20 2020 2020 2020  lue = [].       
+000045b0: 2023 2070 796c 696e 743a 2064 6973 6162   # pylint: disab
+000045c0: 6c65 3d70 726f 7465 6374 6564 2d61 6363  le=protected-acc
+000045d0: 6573 730a 2020 2020 2020 2020 7769 7468  ess.        with
+000045e0: 2070 7974 6573 742e 7261 6973 6573 2865   pytest.raises(e
+000045f0: 7272 6f72 732e 4572 726f 7229 3a0a 2020  rrors.Error):.  
+00004600: 2020 2020 2020 2020 2020 6d61 696e 2e5f            main._
+00004610: 6669 6e64 5f64 6f6d 6169 6e73 5f6f 725f  find_domains_or_
+00004620: 6365 7274 6e61 6d65 286d 6f63 6b5f 636f  certname(mock_co
+00004630: 6e66 6967 2c20 4e6f 6e65 290a 0a20 2020  nfig, None)..   
+00004640: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00004650: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00004660: 6365 7274 5f6d 616e 6167 6572 2e64 6f6d  cert_manager.dom
+00004670: 6169 6e73 5f66 6f72 5f63 6572 746e 616d  ains_for_certnam
+00004680: 6527 290a 2020 2020 6465 6620 7465 7374  e').    def test
+00004690: 5f67 7261 625f 646f 6d61 696e 7328 7365  _grab_domains(se
+000046a0: 6c66 2c20 6d6f 636b 5f64 6f6d 6169 6e73  lf, mock_domains
+000046b0: 293a 0a20 2020 2020 2020 206d 6f63 6b5f  ):.        mock_
+000046c0: 636f 6e66 6967 203d 206d 6f63 6b2e 4d6f  config = mock.Mo
+000046d0: 636b 2864 6f6d 6169 6e73 3d4e 6f6e 652c  ck(domains=None,
+000046e0: 2063 6572 746e 616d 653d 226f 6e65 2e63   certname="one.c
+000046f0: 6f6d 2229 0a20 2020 2020 2020 206d 6f63  om").        moc
+00004700: 6b5f 646f 6d61 696e 732e 7265 7475 726e  k_domains.return
+00004710: 5f76 616c 7565 203d 205b 226f 6e65 2e63  _value = ["one.c
+00004720: 6f6d 222c 2022 7477 6f2e 636f 6d22 5d0a  om", "two.com"].
+00004730: 2020 2020 2020 2020 2320 7079 6c69 6e74          # pylint
+00004740: 3a20 6469 7361 626c 653d 7072 6f74 6563  : disable=protec
+00004750: 7465 642d 6163 6365 7373 0a20 2020 2020  ted-access.     
+00004760: 2020 2061 7373 6572 7420 6d61 696e 2e5f     assert main._
+00004770: 6669 6e64 5f64 6f6d 6169 6e73 5f6f 725f  find_domains_or_
+00004780: 6365 7274 6e61 6d65 286d 6f63 6b5f 636f  certname(mock_co
+00004790: 6e66 6967 2c20 4e6f 6e65 2920 3d3d 205c  nfig, None) == \
+000047a0: 0a20 2020 2020 2020 2020 2020 2028 5b22  .            (["
+000047b0: 6f6e 652e 636f 6d22 2c20 2274 776f 2e63  one.com", "two.c
+000047c0: 6f6d 225d 2c20 226f 6e65 2e63 6f6d 2229  om"], "one.com")
+000047d0: 0a0a 0a63 6c61 7373 2052 6576 6f6b 6554  ...class RevokeT
+000047e0: 6573 7428 7465 7374 5f75 7469 6c2e 5465  est(test_util.Te
+000047f0: 6d70 4469 7254 6573 7443 6173 6529 3a0a  mpDirTestCase):.
+00004800: 2020 2020 2222 2254 6573 7473 2066 6f72      """Tests for
+00004810: 2063 6572 7462 6f74 2e5f 696e 7465 726e   certbot._intern
+00004820: 616c 2e6d 6169 6e2e 7265 766f 6b65 2e22  al.main.revoke."
+00004830: 2222 0a0a 2020 2020 6465 6620 7365 7455  ""..    def setU
+00004840: 7028 7365 6c66 293a 0a20 2020 2020 2020  p(self):.       
+00004850: 2073 7570 6572 2829 2e73 6574 5570 2829   super().setUp()
+00004860: 0a0a 2020 2020 2020 2020 7368 7574 696c  ..        shutil
+00004870: 2e63 6f70 7928 4345 5254 5f50 4154 482c  .copy(CERT_PATH,
+00004880: 2073 656c 662e 7465 6d70 6469 7229 0a20   self.tempdir). 
+00004890: 2020 2020 2020 2073 656c 662e 746d 705f         self.tmp_
+000048a0: 6365 7274 5f70 6174 6820 3d20 6f73 2e70  cert_path = os.p
+000048b0: 6174 682e 6162 7370 6174 6828 6f73 2e70  ath.abspath(os.p
+000048c0: 6174 682e 6a6f 696e 2873 656c 662e 7465  ath.join(self.te
+000048d0: 6d70 6469 722c 2027 6365 7274 5f35 3132  mpdir, 'cert_512
+000048e0: 2e70 656d 2729 290a 0a20 2020 2020 2020  .pem'))..       
+000048f0: 2070 6174 6368 6573 203d 205b 0a20 2020   patches = [.   
+00004900: 2020 2020 2020 2020 206d 6f63 6b2e 7061           mock.pa
+00004910: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+00004920: 7465 726e 616c 2e63 6c69 656e 742e 6163  ternal.client.ac
+00004930: 6d65 5f63 6c69 656e 7427 292c 0a20 2020  me_client'),.   
+00004940: 2020 2020 2020 2020 206d 6f63 6b2e 7061           mock.pa
+00004950: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+00004960: 7465 726e 616c 2e63 6c69 656e 742e 436c  ternal.client.Cl
+00004970: 6965 6e74 2729 2c0a 2020 2020 2020 2020  ient'),.        
+00004980: 2020 2020 6d6f 636b 2e70 6174 6368 2827      mock.patch('
+00004990: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+000049a0: 6c2e 6d61 696e 2e5f 6465 7465 726d 696e  l.main._determin
+000049b0: 655f 6163 636f 756e 7427 292c 0a20 2020  e_account'),.   
+000049c0: 2020 2020 2020 2020 206d 6f63 6b2e 7061           mock.pa
+000049d0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+000049e0: 7465 726e 616c 2e6d 6169 6e2e 6469 7370  ternal.main.disp
+000049f0: 6c61 795f 6f70 732e 7375 6363 6573 735f  lay_ops.success_
+00004a00: 7265 766f 6361 7469 6f6e 2729 0a20 2020  revocation').   
+00004a10: 2020 2020 205d 0a20 2020 2020 2020 2073       ].        s
+00004a20: 656c 662e 6d6f 636b 5f61 636d 655f 636c  elf.mock_acme_cl
+00004a30: 6965 6e74 203d 2070 6174 6368 6573 5b30  ient = patches[0
+00004a40: 5d2e 7374 6172 7428 292e 436c 6965 6e74  ].start().Client
+00004a50: 5632 0a20 2020 2020 2020 2070 6174 6368  V2.        patch
+00004a60: 6573 5b31 5d2e 7374 6172 7428 290a 2020  es[1].start().  
+00004a70: 2020 2020 2020 7365 6c66 2e6d 6f63 6b5f        self.mock_
+00004a80: 6465 7465 726d 696e 655f 6163 636f 756e  determine_accoun
+00004a90: 7420 3d20 7061 7463 6865 735b 325d 2e73  t = patches[2].s
+00004aa0: 7461 7274 2829 0a20 2020 2020 2020 2073  tart().        s
+00004ab0: 656c 662e 6d6f 636b 5f73 7563 6365 7373  elf.mock_success
+00004ac0: 5f72 6576 6f6b 6520 3d20 7061 7463 6865  _revoke = patche
+00004ad0: 735b 335d 2e73 7461 7274 2829 0a20 2020  s[3].start().   
+00004ae0: 2020 2020 2066 6f72 2070 6174 6368 2069       for patch i
+00004af0: 6e20 7061 7463 6865 733a 0a20 2020 2020  n patches:.     
+00004b00: 2020 2020 2020 2073 656c 662e 6164 6443         self.addC
+00004b10: 6c65 616e 7570 2870 6174 6368 2e73 746f  leanup(patch.sto
+00004b20: 7029 0a0a 2020 2020 2020 2020 6672 6f6d  p)..        from
+00004b30: 2063 6572 7462 6f74 2e5f 696e 7465 726e   certbot._intern
+00004b40: 616c 2e61 6363 6f75 6e74 2069 6d70 6f72  al.account impor
+00004b50: 7420 4163 636f 756e 740a 0a20 2020 2020  t Account..     
+00004b60: 2020 2073 656c 662e 7265 6772 203d 206d     self.regr = m
+00004b70: 6f63 6b2e 4d61 6769 634d 6f63 6b28 290a  ock.MagicMock().
+00004b80: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00004b90: 6120 3d20 4163 636f 756e 742e 4d65 7461  a = Account.Meta
+00004ba0: 280a 2020 2020 2020 2020 2020 2020 6372  (.            cr
+00004bb0: 6561 7469 6f6e 5f68 6f73 743d 2274 6573  eation_host="tes
+00004bc0: 742e 6365 7274 626f 742e 6f72 6722 2c0a  t.certbot.org",.
+00004bd0: 2020 2020 2020 2020 2020 2020 6372 6561              crea
+00004be0: 7469 6f6e 5f64 743d 6461 7465 7469 6d65  tion_dt=datetime
+00004bf0: 2e64 6174 6574 696d 6528 0a20 2020 2020  .datetime(.     
+00004c00: 2020 2020 2020 2020 2020 2032 3031 352c             2015,
+00004c10: 2037 2c20 342c 2031 342c 2034 2c20 3130   7, 4, 14, 4, 10
+00004c20: 2c20 747a 696e 666f 3d70 7974 7a2e 5554  , tzinfo=pytz.UT
+00004c30: 4329 290a 2020 2020 2020 2020 7365 6c66  C)).        self
+00004c40: 2e61 6363 203d 2041 6363 6f75 6e74 2873  .acc = Account(s
+00004c50: 656c 662e 7265 6772 2c20 4a57 4b2c 2073  elf.regr, JWK, s
+00004c60: 656c 662e 6d65 7461 290a 0a20 2020 2020  elf.meta)..     
+00004c70: 2020 2073 656c 662e 6d6f 636b 5f64 6574     self.mock_det
+00004c80: 6572 6d69 6e65 5f61 6363 6f75 6e74 2e72  ermine_account.r
+00004c90: 6574 7572 6e5f 7661 6c75 6520 3d20 2873  eturn_value = (s
+00004ca0: 656c 662e 6163 632c 204e 6f6e 6529 0a0a  elf.acc, None)..
+00004cb0: 2020 2020 6465 6620 5f63 616c 6c28 7365      def _call(se
+00004cc0: 6c66 2c20 6172 6773 3d4e 6f6e 6529 3a0a  lf, args=None):.
+00004cd0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
+00004ce0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00004cf0: 2061 7267 7320 3d20 2772 6576 6f6b 6520   args = 'revoke 
+00004d00: 2d2d 6365 7274 2d70 6174 683d 7b30 7d20  --cert-path={0} 
+00004d10: 270a 2020 2020 2020 2020 2020 2020 6172  '.            ar
+00004d20: 6773 203d 2061 7267 732e 666f 726d 6174  gs = args.format
+00004d30: 2873 656c 662e 746d 705f 6365 7274 5f70  (self.tmp_cert_p
+00004d40: 6174 6829 2e73 706c 6974 2829 0a20 2020  ath).split().   
+00004d50: 2020 2020 2070 6c75 6769 6e73 203d 2064       plugins = d
+00004d60: 6973 636f 2e50 6c75 6769 6e73 5265 6769  isco.PluginsRegi
+00004d70: 7374 7279 2e66 696e 645f 616c 6c28 290a  stry.find_all().
+00004d80: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
+00004d90: 2063 6f6e 6669 6775 7261 7469 6f6e 2e4e   configuration.N
+00004da0: 616d 6573 7061 6365 436f 6e66 6967 280a  amespaceConfig(.
+00004db0: 2020 2020 2020 2020 2020 2020 636c 692e              cli.
+00004dc0: 7072 6570 6172 655f 616e 645f 7061 7273  prepare_and_pars
+00004dd0: 655f 6172 6773 2870 6c75 6769 6e73 2c20  e_args(plugins, 
+00004de0: 6172 6773 2929 0a0a 2020 2020 2020 2020  args))..        
+00004df0: 6672 6f6d 2063 6572 7462 6f74 2e5f 696e  from certbot._in
+00004e00: 7465 726e 616c 2e6d 6169 6e20 696d 706f  ternal.main impo
+00004e10: 7274 2072 6576 6f6b 650a 2020 2020 2020  rt revoke.      
+00004e20: 2020 7265 766f 6b65 2863 6f6e 6669 672c    revoke(config,
+00004e30: 2070 6c75 6769 6e73 290a 0a20 2020 2064   plugins)..    d
+00004e40: 6566 205f 6d6f 636b 5f73 6574 5f62 795f  ef _mock_set_by_
+00004e50: 636c 6928 7365 6c66 2c20 6d6f 636b 6564  cli(self, mocked
+00004e60: 3a20 6d6f 636b 2e4d 6167 6963 4d6f 636b  : mock.MagicMock
+00004e70: 2c20 6b65 793a 2073 7472 2c20 7661 6c75  , key: str, valu
+00004e80: 653a 2062 6f6f 6c29 202d 3e20 4e6f 6e65  e: bool) -> None
+00004e90: 3a0a 2020 2020 2020 2020 6465 6620 7365  :.        def se
+00004ea0: 745f 6279 5f63 6c69 286b 3a20 7374 7229  t_by_cli(k: str)
+00004eb0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00004ec0: 2020 2020 2020 6966 206b 6579 203d 3d20        if key == 
+00004ed0: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
+00004ee0: 2020 2072 6574 7572 6e20 7661 6c75 650a     return value.
+00004ef0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00004f00: 726e 206d 6f63 6b2e 4445 4641 554c 540a  rn mock.DEFAULT.
+00004f10: 2020 2020 2020 2020 6d6f 636b 6564 2e73          mocked.s
+00004f20: 6964 655f 6566 6665 6374 203d 2073 6574  ide_effect = set
+00004f30: 5f62 795f 636c 690a 0a20 2020 2040 6d6f  _by_cli..    @mo
+00004f40: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00004f50: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00004f60: 2e5f 6465 6c65 7465 5f69 665f 6170 7072  ._delete_if_appr
+00004f70: 6f70 7269 6174 6527 290a 2020 2020 406d  opriate').    @m
+00004f80: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00004f90: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+00004fa0: 6e2e 636c 6965 6e74 2e61 636d 655f 636c  n.client.acme_cl
+00004fb0: 6965 6e74 2729 0a20 2020 2064 6566 2074  ient').    def t
+00004fc0: 6573 745f 7265 766f 6b65 5f77 6974 685f  est_revoke_with_
+00004fd0: 7265 6173 6f6e 2873 656c 662c 206d 6f63  reason(self, moc
+00004fe0: 6b5f 6163 6d65 5f63 6c69 656e 742c 0a20  k_acme_client,. 
+00004ff0: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
+00005000: 6465 6c65 7465 5f69 665f 6170 7072 6f70  delete_if_approp
+00005010: 7269 6174 6529 3a0a 2020 2020 2020 2020  riate):.        
+00005020: 6d6f 636b 5f64 656c 6574 655f 6966 5f61  mock_delete_if_a
+00005030: 7070 726f 7072 6961 7465 2e72 6574 7572  ppropriate.retur
+00005040: 6e5f 7661 6c75 6520 3d20 4661 6c73 650a  n_value = False.
+00005050: 2020 2020 2020 2020 6d6f 636b 5f72 6576          mock_rev
+00005060: 6f6b 6520 3d20 6d6f 636b 5f61 636d 655f  oke = mock_acme_
+00005070: 636c 6965 6e74 2e43 6c69 656e 7456 3228  client.ClientV2(
+00005080: 292e 7265 766f 6b65 0a20 2020 2020 2020  ).revoke.       
+00005090: 2065 7870 6563 7465 6420 3d20 5b5d 0a20   expected = []. 
+000050a0: 2020 2020 2020 2066 6f72 2072 6561 736f         for reaso
+000050b0: 6e2c 2063 6f64 6520 696e 2063 6f6e 7374  n, code in const
+000050c0: 616e 7473 2e52 4556 4f43 4154 494f 4e5f  ants.REVOCATION_
+000050d0: 5245 4153 4f4e 532e 6974 656d 7328 293a  REASONS.items():
+000050e0: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+000050f0: 7320 3d20 2772 6576 6f6b 6520 2d2d 6365  s = 'revoke --ce
+00005100: 7274 2d70 6174 683d 7b30 7d20 2d2d 7265  rt-path={0} --re
+00005110: 6173 6f6e 207b 317d 272e 666f 726d 6174  ason {1}'.format
+00005120: 2873 656c 662e 746d 705f 6365 7274 5f70  (self.tmp_cert_p
+00005130: 6174 682c 2072 6561 736f 6e29 2e73 706c  ath, reason).spl
+00005140: 6974 2829 0a20 2020 2020 2020 2020 2020  it().           
+00005150: 2073 656c 662e 5f63 616c 6c28 6172 6773   self._call(args
+00005160: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+00005170: 7065 6374 6564 2e61 7070 656e 6428 6d6f  pected.append(mo
+00005180: 636b 2e63 616c 6c28 6d6f 636b 2e41 4e59  ck.call(mock.ANY
+00005190: 2c20 636f 6465 2929 0a20 2020 2020 2020  , code)).       
+000051a0: 2020 2020 2061 7267 7320 3d20 2772 6576       args = 'rev
+000051b0: 6f6b 6520 2d2d 6365 7274 2d70 6174 683d  oke --cert-path=
+000051c0: 7b30 7d20 2d2d 7265 6173 6f6e 207b 317d  {0} --reason {1}
+000051d0: 272e 666f 726d 6174 2873 656c 662e 746d  '.format(self.tm
+000051e0: 705f 6365 7274 5f70 6174 682c 0a20 2020  p_cert_path,.   
+000051f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005200: 2072 6561 736f 6e2e 7570 7065 7228 2929   reason.upper())
+00005210: 2e73 706c 6974 2829 0a20 2020 2020 2020  .split().       
+00005220: 2020 2020 2073 656c 662e 5f63 616c 6c28       self._call(
+00005230: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
+00005240: 2020 6578 7065 6374 6564 2e61 7070 656e    expected.appen
+00005250: 6428 6d6f 636b 2e63 616c 6c28 6d6f 636b  d(mock.call(mock
+00005260: 2e41 4e59 2c20 636f 6465 2929 0a20 2020  .ANY, code)).   
+00005270: 2020 2020 2061 7373 6572 7420 6578 7065       assert expe
+00005280: 6374 6564 203d 3d20 6d6f 636b 5f72 6576  cted == mock_rev
+00005290: 6f6b 652e 6361 6c6c 5f61 7267 735f 6c69  oke.call_args_li
+000052a0: 7374 0a0a 2020 2020 406d 6f63 6b2e 7061  st..    @mock.pa
+000052b0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+000052c0: 7465 726e 616c 2e6d 6169 6e2e 5f64 656c  ternal.main._del
+000052d0: 6574 655f 6966 5f61 7070 726f 7072 6961  ete_if_appropria
+000052e0: 7465 2729 0a20 2020 2040 6d6f 636b 2e70  te').    @mock.p
+000052f0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+00005300: 6e74 6572 6e61 6c2e 7374 6f72 6167 652e  nternal.storage.
+00005310: 5265 6e65 7761 626c 6543 6572 7427 290a  RenewableCert').
+00005320: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+00005330: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+00005340: 616c 2e73 746f 7261 6765 2e72 656e 6577  al.storage.renew
+00005350: 616c 5f66 696c 655f 666f 725f 6365 7274  al_file_for_cert
+00005360: 6e61 6d65 2729 0a20 2020 2040 6d6f 636b  name').    @mock
+00005370: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00005380: 5f69 6e74 6572 6e61 6c2e 636c 6965 6e74  _internal.client
+00005390: 2e61 636d 655f 6672 6f6d 5f63 6f6e 6669  .acme_from_confi
+000053a0: 675f 6b65 7927 290a 2020 2020 406d 6f63  g_key').    @moc
+000053b0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+000053c0: 2e5f 696e 7465 726e 616c 2e63 6c69 2e73  ._internal.cli.s
+000053d0: 6574 5f62 795f 636c 6927 290a 2020 2020  et_by_cli').    
+000053e0: 6465 6620 7465 7374 5f72 6576 6f6b 655f  def test_revoke_
+000053f0: 6279 5f63 6572 746e 616d 6528 7365 6c66  by_certname(self
+00005400: 2c20 6d6f 636b 5f73 6574 5f62 795f 636c  , mock_set_by_cl
+00005410: 692c 206d 6f63 6b5f 6163 6d65 5f66 726f  i, mock_acme_fro
+00005420: 6d5f 636f 6e66 6967 2c0a 2020 2020 2020  m_config,.      
+00005430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005440: 2020 2020 2020 2020 2020 756e 7573 6564            unused
+00005450: 5f6d 6f63 6b5f 7265 6e65 7761 6c5f 6669  _mock_renewal_fi
+00005460: 6c65 5f66 6f72 5f63 6572 746e 616d 652c  le_for_certname,
+00005470: 206d 6f63 6b5f 6365 7274 2c0a 2020 2020   mock_cert,.    
+00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005490: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
+000054a0: 5f64 656c 6574 655f 6966 5f61 7070 726f  _delete_if_appro
+000054b0: 7072 6961 7465 293a 0a20 2020 2020 2020  priate):.       
+000054c0: 2073 656c 662e 5f6d 6f63 6b5f 7365 745f   self._mock_set_
+000054d0: 6279 5f63 6c69 286d 6f63 6b5f 7365 745f  by_cli(mock_set_
+000054e0: 6279 5f63 6c69 2c20 2273 6572 7665 7222  by_cli, "server"
+000054f0: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
+00005500: 206d 6f63 6b5f 6163 6d65 5f66 726f 6d5f   mock_acme_from_
+00005510: 636f 6e66 6967 2e72 6574 7572 6e5f 7661  config.return_va
+00005520: 6c75 6520 3d20 7365 6c66 2e6d 6f63 6b5f  lue = self.mock_
+00005530: 6163 6d65 5f63 6c69 656e 740a 2020 2020  acme_client.    
+00005540: 2020 2020 6d6f 636b 5f63 6572 742e 7265      mock_cert.re
+00005550: 7475 726e 5f76 616c 7565 203d 206d 6f63  turn_value = moc
+00005560: 6b2e 4d61 6769 634d 6f63 6b28 6365 7274  k.MagicMock(cert
+00005570: 5f70 6174 683d 7365 6c66 2e74 6d70 5f63  _path=self.tmp_c
+00005580: 6572 745f 7061 7468 2c0a 2020 2020 2020  ert_path,.      
+00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055b0: 2020 2020 2020 2020 2020 7365 7276 6572            server
+000055c0: 3d22 6874 7470 733a 2f2f 6163 6d65 2e65  ="https://acme.e
+000055d0: 7861 6d70 6c65 2229 0a20 2020 2020 2020  xample").       
+000055e0: 2061 7267 7320 3d20 2772 6576 6f6b 6520   args = 'revoke 
+000055f0: 2d2d 6365 7274 2d6e 616d 653d 6578 616d  --cert-name=exam
+00005600: 706c 652e 636f 6d27 2e73 706c 6974 2829  ple.com'.split()
+00005610: 0a20 2020 2020 2020 206d 6f63 6b5f 6465  .        mock_de
+00005620: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
+00005630: 6174 652e 7265 7475 726e 5f76 616c 7565  ate.return_value
+00005640: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00005650: 2073 656c 662e 5f63 616c 6c28 6172 6773   self._call(args
+00005660: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00005670: 206d 6f63 6b5f 6163 6d65 5f66 726f 6d5f   mock_acme_from_
+00005680: 636f 6e66 6967 2e63 616c 6c5f 6172 6773  config.call_args
+00005690: 5f6c 6973 745b 305d 5b30 5d5b 305d 2e73  _list[0][0][0].s
+000056a0: 6572 7665 7220 3d3d 205c 0a20 2020 2020  erver == \.     
+000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056c0: 2020 2020 2768 7474 7073 3a2f 2f61 636d      'https://acm
+000056d0: 652e 6578 616d 706c 6527 0a20 2020 2020  e.example'.     
+000056e0: 2020 2073 656c 662e 6d6f 636b 5f73 7563     self.mock_suc
+000056f0: 6365 7373 5f72 6576 6f6b 652e 6173 7365  cess_revoke.asse
+00005700: 7274 5f63 616c 6c65 645f 6f6e 6365 5f77  rt_called_once_w
+00005710: 6974 6828 7365 6c66 2e74 6d70 5f63 6572  ith(self.tmp_cer
+00005720: 745f 7061 7468 290a 0a20 2020 2040 6d6f  t_path)..    @mo
+00005730: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00005740: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00005750: 2e5f 6465 6c65 7465 5f69 665f 6170 7072  ._delete_if_appr
+00005760: 6f70 7269 6174 6527 290a 2020 2020 406d  opriate').    @m
+00005770: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00005780: 6f74 2e5f 696e 7465 726e 616c 2e73 746f  ot._internal.sto
+00005790: 7261 6765 2e52 656e 6577 6162 6c65 4365  rage.RenewableCe
+000057a0: 7274 2729 0a20 2020 2040 6d6f 636b 2e70  rt').    @mock.p
+000057b0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+000057c0: 6e74 6572 6e61 6c2e 7374 6f72 6167 652e  nternal.storage.
+000057d0: 7265 6e65 7761 6c5f 6669 6c65 5f66 6f72  renewal_file_for
+000057e0: 5f63 6572 746e 616d 6527 290a 2020 2020  _certname').    
+000057f0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00005800: 7462 6f74 2e5f 696e 7465 726e 616c 2e63  tbot._internal.c
+00005810: 6c69 656e 742e 6163 6d65 5f66 726f 6d5f  lient.acme_from_
+00005820: 636f 6e66 6967 5f6b 6579 2729 0a20 2020  config_key').   
+00005830: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00005840: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00005850: 636c 692e 7365 745f 6279 5f63 6c69 2729  cli.set_by_cli')
+00005860: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+00005870: 766f 6b65 5f62 795f 6365 7274 6e61 6d65  voke_by_certname
+00005880: 5f61 6e64 5f73 6572 7665 7228 7365 6c66  _and_server(self
+00005890: 2c20 6d6f 636b 5f73 6574 5f62 795f 636c  , mock_set_by_cl
+000058a0: 692c 206d 6f63 6b5f 6163 6d65 5f66 726f  i, mock_acme_fro
+000058b0: 6d5f 636f 6e66 6967 2c0a 2020 2020 2020  m_config,.      
+000058c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058e0: 2020 2020 2075 6e75 7365 645f 6d6f 636b       unused_mock
+000058f0: 5f72 656e 6577 616c 5f66 696c 655f 666f  _renewal_file_fo
+00005900: 725f 6365 7274 6e61 6d65 2c20 6d6f 636b  r_certname, mock
+00005910: 5f63 6572 742c 0a20 2020 2020 2020 2020  _cert,.         
+00005920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005940: 2020 6d6f 636b 5f64 656c 6574 655f 6966    mock_delete_if
+00005950: 5f61 7070 726f 7072 6961 7465 293a 0a20  _appropriate):. 
+00005960: 2020 2020 2020 2022 2222 5265 766f 6b69         """Revoki
+00005970: 6e67 2077 6974 6820 2d2d 7365 7276 6572  ng with --server
+00005980: 2073 686f 756c 6420 7573 6520 7468 6520   should use the 
+00005990: 7365 7276 6572 2066 726f 6d20 7468 6520  server from the 
+000059a0: 434c 4922 2222 0a20 2020 2020 2020 2073  CLI""".        s
+000059b0: 656c 662e 5f6d 6f63 6b5f 7365 745f 6279  elf._mock_set_by
+000059c0: 5f63 6c69 286d 6f63 6b5f 7365 745f 6279  _cli(mock_set_by
+000059d0: 5f63 6c69 2c20 2273 6572 7665 7222 2c20  _cli, "server", 
+000059e0: 5472 7565 290a 2020 2020 2020 2020 6d6f  True).        mo
+000059f0: 636b 5f63 6572 742e 7265 7475 726e 5f76  ck_cert.return_v
+00005a00: 616c 7565 203d 206d 6f63 6b2e 4d61 6769  alue = mock.Magi
+00005a10: 634d 6f63 6b28 6365 7274 5f70 6174 683d  cMock(cert_path=
+00005a20: 7365 6c66 2e74 6d70 5f63 6572 745f 7061  self.tmp_cert_pa
+00005a30: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a60: 2020 2020 7365 7276 6572 3d22 6874 7470      server="http
+00005a70: 733a 2f2f 6163 6d65 2e65 7861 6d70 6c65  s://acme.example
+00005a80: 2229 0a20 2020 2020 2020 2061 7267 7320  ").        args 
+00005a90: 3d20 2772 6576 6f6b 6520 2d2d 6365 7274  = 'revoke --cert
+00005aa0: 2d6e 616d 653d 6578 616d 706c 652e 636f  -name=example.co
+00005ab0: 6d20 2d2d 7365 7276 6572 2068 7474 7073  m --server https
+00005ac0: 3a2f 2f6f 7468 6572 2e65 7861 6d70 6c65  ://other.example
+00005ad0: 272e 7370 6c69 7428 290a 2020 2020 2020  '.split().      
+00005ae0: 2020 6d6f 636b 5f64 656c 6574 655f 6966    mock_delete_if
+00005af0: 5f61 7070 726f 7072 6961 7465 2e72 6574  _appropriate.ret
+00005b00: 7572 6e5f 7661 6c75 6520 3d20 4661 6c73  urn_value = Fals
+00005b10: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
+00005b20: 6361 6c6c 2861 7267 7329 0a20 2020 2020  call(args).     
+00005b30: 2020 2061 7373 6572 7420 6d6f 636b 5f61     assert mock_a
+00005b40: 636d 655f 6672 6f6d 5f63 6f6e 6669 672e  cme_from_config.
+00005b50: 6361 6c6c 5f61 7267 735f 6c69 7374 5b30  call_args_list[0
+00005b60: 5d5b 305d 5b30 5d2e 7365 7276 6572 203d  ][0][0].server =
+00005b70: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
+00005b80: 2020 2020 2020 2020 2020 2020 2027 6874               'ht
+00005b90: 7470 733a 2f2f 6f74 6865 722e 6578 616d  tps://other.exam
+00005ba0: 706c 6527 0a20 2020 2020 2020 2073 656c  ple'.        sel
+00005bb0: 662e 6d6f 636b 5f73 7563 6365 7373 5f72  f.mock_success_r
+00005bc0: 6576 6f6b 652e 6173 7365 7274 5f63 616c  evoke.assert_cal
+00005bd0: 6c65 645f 6f6e 6365 5f77 6974 6828 7365  led_once_with(se
+00005be0: 6c66 2e74 6d70 5f63 6572 745f 7061 7468  lf.tmp_cert_path
+00005bf0: 290a 0a20 2020 2040 6d6f 636b 2e70 6174  )..    @mock.pat
+00005c00: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00005c10: 6572 6e61 6c2e 6d61 696e 2e5f 6465 6c65  ernal.main._dele
+00005c20: 7465 5f69 665f 6170 7072 6f70 7269 6174  te_if_appropriat
+00005c30: 6527 290a 2020 2020 406d 6f63 6b2e 7061  e').    @mock.pa
+00005c40: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+00005c50: 7465 726e 616c 2e73 746f 7261 6765 2e52  ternal.storage.R
+00005c60: 656e 6577 6162 6c65 4365 7274 2729 0a20  enewableCert'). 
+00005c70: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+00005c80: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+00005c90: 6c2e 7374 6f72 6167 652e 7265 6e65 7761  l.storage.renewa
+00005ca0: 6c5f 6669 6c65 5f66 6f72 5f63 6572 746e  l_file_for_certn
+00005cb0: 616d 6527 290a 2020 2020 406d 6f63 6b2e  ame').    @mock.
+00005cc0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00005cd0: 696e 7465 726e 616c 2e63 6c69 656e 742e  internal.client.
+00005ce0: 6163 6d65 5f66 726f 6d5f 636f 6e66 6967  acme_from_config
+00005cf0: 5f6b 6579 2729 0a20 2020 2040 6d6f 636b  _key').    @mock
+00005d00: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00005d10: 5f69 6e74 6572 6e61 6c2e 636c 692e 7365  _internal.cli.se
+00005d20: 745f 6279 5f63 6c69 2729 0a20 2020 2064  t_by_cli').    d
+00005d30: 6566 2074 6573 745f 7265 766f 6b65 5f62  ef test_revoke_b
+00005d40: 795f 6365 7274 6e61 6d65 5f65 6d70 7479  y_certname_empty
+00005d50: 5f73 6572 7665 7228 7365 6c66 2c20 6d6f  _server(self, mo
+00005d60: 636b 5f73 6574 5f62 795f 636c 692c 206d  ck_set_by_cli, m
+00005d70: 6f63 6b5f 6163 6d65 5f66 726f 6d5f 636f  ock_acme_from_co
+00005d80: 6e66 6967 2c0a 2020 2020 2020 2020 2020  nfig,.          
+00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005db0: 2020 2075 6e75 7365 645f 6d6f 636b 5f72     unused_mock_r
+00005dc0: 656e 6577 616c 5f66 696c 655f 666f 725f  enewal_file_for_
+00005dd0: 6365 7274 6e61 6d65 2c0a 2020 2020 2020  certname,.      
+00005de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e00: 2020 2020 2020 206d 6f63 6b5f 6365 7274         mock_cert
+00005e10: 2c20 6d6f 636b 5f64 656c 6574 655f 6966  , mock_delete_if
+00005e20: 5f61 7070 726f 7072 6961 7465 293a 0a20  _appropriate):. 
+00005e30: 2020 2020 2020 2022 2222 5265 766f 6b69         """Revoki
+00005e40: 6e67 2077 6974 6820 2d2d 6365 7274 2d6e  ng with --cert-n
+00005e50: 616d 6520 7768 6572 6520 7468 6520 6c69  ame where the li
+00005e60: 6e65 6167 6520 7365 7276 6572 2069 7320  neage server is 
+00005e70: 656d 7074 7920 7368 6f75 6c64 6e27 7420  empty shouldn't 
+00005e80: 6372 6173 6820 2222 220a 2020 2020 2020  crash """.      
+00005e90: 2020 6d6f 636b 5f63 6572 742e 7265 7475    mock_cert.retu
+00005ea0: 726e 5f76 616c 7565 203d 206d 6f63 6b2e  rn_value = mock.
+00005eb0: 4d61 6769 634d 6f63 6b28 6365 7274 5f70  MagicMock(cert_p
+00005ec0: 6174 683d 7365 6c66 2e74 6d70 5f63 6572  ath=self.tmp_cer
+00005ed0: 745f 7061 7468 2c20 7365 7276 6572 3d4e  t_path, server=N
+00005ee0: 6f6e 6529 0a20 2020 2020 2020 2061 7267  one).        arg
+00005ef0: 7320 3d20 2772 6576 6f6b 6520 2d2d 6365  s = 'revoke --ce
+00005f00: 7274 2d6e 616d 653d 6578 616d 706c 652e  rt-name=example.
+00005f10: 636f 6d27 2e73 706c 6974 2829 0a20 2020  com'.split().   
+00005f20: 2020 2020 206d 6f63 6b5f 6465 6c65 7465       mock_delete
+00005f30: 5f69 665f 6170 7072 6f70 7269 6174 652e  _if_appropriate.
+00005f40: 7265 7475 726e 5f76 616c 7565 203d 2046  return_value = F
+00005f50: 616c 7365 0a20 2020 2020 2020 2073 656c  alse.        sel
+00005f60: 662e 5f63 616c 6c28 6172 6773 290a 2020  f._call(args).  
+00005f70: 2020 2020 2020 6173 7365 7274 206d 6f63        assert moc
+00005f80: 6b5f 6163 6d65 5f66 726f 6d5f 636f 6e66  k_acme_from_conf
+00005f90: 6967 2e63 616c 6c5f 6172 6773 5f6c 6973  ig.call_args_lis
+00005fa0: 745b 305d 5b30 5d5b 305d 2e73 6572 7665  t[0][0][0].serve
+00005fb0: 7220 3d3d 205c 0a20 2020 2020 2020 2020  r == \.         
+00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fd0: 636f 6e73 7461 6e74 732e 434c 495f 4445  constants.CLI_DE
+00005fe0: 4641 554c 5453 5b27 7365 7276 6572 275d  FAULTS['server']
+00005ff0: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00006000: 636b 5f73 7563 6365 7373 5f72 6576 6f6b  ck_success_revok
+00006010: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
+00006020: 6f6e 6365 5f77 6974 6828 7365 6c66 2e74  once_with(self.t
+00006030: 6d70 5f63 6572 745f 7061 7468 290a 0a20  mp_cert_path).. 
+00006040: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+00006050: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+00006060: 6c2e 6d61 696e 2e5f 6465 6c65 7465 5f69  l.main._delete_i
+00006070: 665f 6170 7072 6f70 7269 6174 6527 290a  f_appropriate').
+00006080: 2020 2020 6465 6620 7465 7374 5f72 6576      def test_rev
+00006090: 6f63 6174 696f 6e5f 7375 6363 6573 7328  ocation_success(
+000060a0: 7365 6c66 2c20 6d6f 636b 5f64 656c 6574  self, mock_delet
+000060b0: 655f 6966 5f61 7070 726f 7072 6961 7465  e_if_appropriate
+000060c0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+000060d0: 5f63 616c 6c28 290a 2020 2020 2020 2020  _call().        
+000060e0: 6d6f 636b 5f64 656c 6574 655f 6966 5f61  mock_delete_if_a
+000060f0: 7070 726f 7072 6961 7465 2e72 6574 7572  ppropriate.retur
+00006100: 6e5f 7661 6c75 6520 3d20 4661 6c73 650a  n_value = False.
+00006110: 2020 2020 2020 2020 7365 6c66 2e6d 6f63          self.moc
+00006120: 6b5f 7375 6363 6573 735f 7265 766f 6b65  k_success_revoke
+00006130: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
+00006140: 6e63 655f 7769 7468 2873 656c 662e 746d  nce_with(self.tm
+00006150: 705f 6365 7274 5f70 6174 6829 0a0a 2020  p_cert_path)..  
+00006160: 2020 6465 6620 7465 7374 5f72 6576 6f63    def test_revoc
+00006170: 6174 696f 6e5f 6572 726f 7228 7365 6c66  ation_error(self
+00006180: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+00006190: 6163 6d65 2069 6d70 6f72 7420 6572 726f  acme import erro
+000061a0: 7273 2061 7320 6163 6d65 5f65 7272 6f72  rs as acme_error
+000061b0: 730a 2020 2020 2020 2020 7365 6c66 2e6d  s.        self.m
+000061c0: 6f63 6b5f 6163 6d65 5f63 6c69 656e 742e  ock_acme_client.
+000061d0: 7369 6465 5f65 6666 6563 7420 3d20 6163  side_effect = ac
+000061e0: 6d65 5f65 7272 6f72 732e 436c 6965 6e74  me_errors.Client
+000061f0: 4572 726f 7228 290a 2020 2020 2020 2020  Error().        
+00006200: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
+00006210: 6573 2861 636d 655f 6572 726f 7273 2e43  es(acme_errors.C
+00006220: 6c69 656e 7445 7272 6f72 293a 0a20 2020  lientError):.   
+00006230: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00006240: 616c 6c28 290a 2020 2020 2020 2020 7365  all().        se
+00006250: 6c66 2e6d 6f63 6b5f 7375 6363 6573 735f  lf.mock_success_
+00006260: 7265 766f 6b65 2e61 7373 6572 745f 6e6f  revoke.assert_no
+00006270: 745f 6361 6c6c 6564 2829 0a0a 2020 2020  t_called()..    
+00006280: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00006290: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+000062a0: 6169 6e2e 5f64 656c 6574 655f 6966 5f61  ain._delete_if_a
+000062b0: 7070 726f 7072 6961 7465 2729 0a20 2020  ppropriate').   
+000062c0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+000062d0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+000062e0: 6365 7274 5f6d 616e 6167 6572 2e64 656c  cert_manager.del
+000062f0: 6574 6527 290a 2020 2020 4074 6573 745f  ete').    @test_
+00006300: 7574 696c 2e70 6174 6368 5f64 6973 706c  util.patch_displ
+00006310: 6179 5f75 7469 6c28 290a 2020 2020 6465  ay_util().    de
+00006320: 6620 7465 7374 5f72 6576 6f63 6174 696f  f test_revocatio
+00006330: 6e5f 7769 7468 5f70 726f 6d70 7428 7365  n_with_prompt(se
+00006340: 6c66 2c20 6d6f 636b 5f67 6574 5f75 7469  lf, mock_get_uti
+00006350: 6c69 7479 2c0a 2020 2020 2020 2020 2020  lity,.          
+00006360: 2020 6d6f 636b 5f64 656c 6574 652c 206d    mock_delete, m
+00006370: 6f63 6b5f 6465 6c65 7465 5f69 665f 6170  ock_delete_if_ap
+00006380: 7072 6f70 7269 6174 6529 3a0a 2020 2020  propriate):.    
+00006390: 2020 2020 6d6f 636b 5f67 6574 5f75 7469      mock_get_uti
+000063a0: 6c69 7479 2829 2e79 6573 6e6f 2e72 6574  lity().yesno.ret
+000063b0: 7572 6e5f 7661 6c75 6520 3d20 4661 6c73  urn_value = Fals
+000063c0: 650a 2020 2020 2020 2020 6d6f 636b 5f64  e.        mock_d
+000063d0: 656c 6574 655f 6966 5f61 7070 726f 7072  elete_if_appropr
+000063e0: 6961 7465 2e72 6574 7572 6e5f 7661 6c75  iate.return_valu
+000063f0: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
+00006400: 2020 7365 6c66 2e5f 6361 6c6c 2829 0a20    self._call(). 
+00006410: 2020 2020 2020 2061 7373 6572 7420 6d6f         assert mo
+00006420: 636b 5f64 656c 6574 652e 6361 6c6c 6564  ck_delete.called
+00006430: 2069 7320 4661 6c73 650a 0a0a 636c 6173   is False...clas
+00006440: 7320 5265 636f 6e66 6967 7572 6554 6573  s ReconfigureTes
+00006450: 7428 7465 7374 5f75 7469 6c2e 5465 6d70  t(test_util.Temp
+00006460: 4469 7254 6573 7443 6173 6529 3a0a 2020  DirTestCase):.  
+00006470: 2020 2222 2254 6573 7473 2066 6f72 2063    """Tests for c
+00006480: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00006490: 2e6d 6169 6e2e 7265 636f 6e66 6967 7572  .main.reconfigur
+000064a0: 6522 2222 0a0a 2020 2020 6465 6620 7365  e"""..    def se
+000064b0: 7455 7028 7365 6c66 293a 0a20 2020 2020  tUp(self):.     
+000064c0: 2020 2073 7570 6572 2829 2e73 6574 5570     super().setUp
+000064d0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000064e0: 6765 745f 7574 696c 6974 795f 7061 7463  get_utility_patc
+000064f0: 6820 3d20 7465 7374 5f75 7469 6c2e 7061  h = test_util.pa
+00006500: 7463 685f 6469 7370 6c61 795f 7574 696c  tch_display_util
+00006510: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00006520: 6d6f 636b 5f67 6574 5f75 7469 6c69 7479  mock_get_utility
+00006530: 203d 2073 656c 662e 6765 745f 7574 696c   = self.get_util
+00006540: 6974 795f 7061 7463 682e 7374 6172 7428  ity_patch.start(
+00006550: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+00006560: 6174 6368 6572 7320 3d20 7b0a 2020 2020  atchers = {.    
+00006570: 2020 2020 2020 2020 2763 6865 636b 5f73          'check_s
+00006580: 796d 6c69 6e6b 7327 3a20 6d6f 636b 2e70  ymlinks': mock.p
+00006590: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+000065a0: 6e74 6572 6e61 6c2e 7374 6f72 6167 652e  nternal.storage.
+000065b0: 5265 6e65 7761 626c 6543 6572 742e 5f63  RenewableCert._c
+000065c0: 6865 636b 5f73 796d 6c69 6e6b 7327 292c  heck_symlinks'),
+000065d0: 0a20 2020 2020 2020 2020 2020 2027 6365  .            'ce
+000065e0: 7274 5f6e 616d 6573 273a 206d 6f63 6b2e  rt_names': mock.
+000065f0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00006600: 696e 7465 726e 616c 2e73 746f 7261 6765  internal.storage
+00006610: 2e52 656e 6577 6162 6c65 4365 7274 2e6e  .RenewableCert.n
+00006620: 616d 6573 2729 2c0a 2020 2020 2020 2020  ames'),.        
+00006630: 2020 2020 2770 6963 6b5f 696e 7374 616c      'pick_instal
+00006640: 6c65 7227 3a20 6d6f 636b 2e70 6174 6368  ler': mock.patch
+00006650: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+00006660: 6e61 6c2e 706c 7567 696e 732e 7365 6c65  nal.plugins.sele
+00006670: 6374 696f 6e2e 7069 636b 5f69 6e73 7461  ction.pick_insta
+00006680: 6c6c 6572 2729 2c0a 2020 2020 2020 2020  ller'),.        
+00006690: 2020 2020 2770 6963 6b5f 6175 7468 273a      'pick_auth':
+000066a0: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
+000066b0: 7462 6f74 2e5f 696e 7465 726e 616c 2e70  tbot._internal.p
+000066c0: 6c75 6769 6e73 2e73 656c 6563 7469 6f6e  lugins.selection
+000066d0: 2e70 6963 6b5f 6175 7468 656e 7469 6361  .pick_authentica
+000066e0: 746f 7227 292c 0a20 2020 2020 2020 2020  tor'),.         
+000066f0: 2020 2027 6669 6e64 5f69 6e69 7427 3a20     'find_init': 
+00006700: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00006710: 626f 742e 5f69 6e74 6572 6e61 6c2e 706c  bot._internal.pl
+00006720: 7567 696e 732e 6469 7363 6f2e 506c 7567  ugins.disco.Plug
+00006730: 696e 7352 6567 6973 7472 792e 6669 6e64  insRegistry.find
+00006740: 5f69 6e69 7427 292c 0a20 2020 2020 2020  _init'),.       
+00006750: 2020 2020 2027 5f67 6574 5f61 6e64 5f73       '_get_and_s
+00006760: 6176 655f 6365 7274 273a 206d 6f63 6b2e  ave_cert': mock.
+00006770: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00006780: 696e 7465 726e 616c 2e6d 6169 6e2e 5f67  internal.main._g
+00006790: 6574 5f61 6e64 5f73 6176 655f 6365 7274  et_and_save_cert
+000067a0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+000067b0: 275f 696e 6974 5f6c 655f 636c 6965 6e74  '_init_le_client
+000067c0: 273a 206d 6f63 6b2e 7061 7463 6828 2763  ': mock.patch('c
+000067d0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+000067e0: 2e6d 6169 6e2e 5f69 6e69 745f 6c65 5f63  .main._init_le_c
+000067f0: 6c69 656e 7427 292c 0a20 2020 2020 2020  lient'),.       
+00006800: 2020 2020 2027 6c69 7374 5f68 6f6f 6b73       'list_hooks
+00006810: 273a 206d 6f63 6b2e 7061 7463 6828 2763  ': mock.patch('c
+00006820: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00006830: 2e68 6f6f 6b73 2e6c 6973 745f 686f 6f6b  .hooks.list_hook
+00006840: 7327 292c 0a20 2020 2020 2020 207d 0a20  s'),.        }. 
+00006850: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
+00006860: 7320 3d20 7b6b 3a20 762e 7374 6172 7428  s = {k: v.start(
+00006870: 2920 666f 7220 6b2c 2076 2069 6e20 7365  ) for k, v in se
+00006880: 6c66 2e70 6174 6368 6572 732e 6974 656d  lf.patchers.item
+00006890: 7328 297d 0a20 2020 2020 2020 2073 656c  s()}.        sel
+000068a0: 662e 6d6f 636b 735b 2763 6572 745f 6e61  f.mocks['cert_na
+000068b0: 6d65 7327 5d2e 7265 7475 726e 5f76 616c  mes'].return_val
+000068c0: 7565 203d 205b 2765 7861 6d70 6c65 2e63  ue = ['example.c
+000068d0: 6f6d 275d 0a0a 2020 2020 2020 2020 7365  om']..        se
+000068e0: 6c66 2e63 6f6e 6669 675f 6469 7220 3d20  lf.config_dir = 
+000068f0: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
+00006900: 662e 7465 6d70 6469 722c 2027 636f 6e66  f.tempdir, 'conf
+00006910: 6967 2729 0a20 2020 2020 2020 2072 656e  ig').        ren
+00006920: 6577 616c 5f63 6f6e 6669 6773 5f64 6972  ewal_configs_dir
+00006930: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00006940: 7365 6c66 2e63 6f6e 6669 675f 6469 722c  self.config_dir,
+00006950: 2027 7265 6e65 7761 6c27 290a 2020 2020   'renewal').    
+00006960: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+00006970: 7468 2e65 7869 7374 7328 7265 6e65 7761  th.exists(renewa
+00006980: 6c5f 636f 6e66 6967 735f 6469 7229 3a0a  l_configs_dir):.
+00006990: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000069a0: 7379 7374 656d 2e6d 616b 6564 6972 7328  system.makedirs(
+000069b0: 7265 6e65 7761 6c5f 636f 6e66 6967 735f  renewal_configs_
+000069c0: 6469 7229 0a20 2020 2020 2020 2073 656c  dir).        sel
+000069d0: 662e 7265 6e65 7761 6c5f 6669 6c65 203d  f.renewal_file =
+000069e0: 206f 732e 7061 7468 2e6a 6f69 6e28 7265   os.path.join(re
+000069f0: 6e65 7761 6c5f 636f 6e66 6967 735f 6469  newal_configs_di
+00006a00: 722c 2027 6578 616d 706c 652e 636f 6d2e  r, 'example.com.
+00006a10: 636f 6e66 2729 0a20 2020 2020 2020 206f  conf').        o
+00006a20: 7269 6769 6e61 6c5f 636f 6e66 6967 203d  riginal_config =
+00006a30: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+00006a40: 2076 6572 7369 6f6e 203d 2031 2e33 322e   version = 1.32.
+00006a50: 300a 2020 2020 2020 2020 2020 2020 6172  0.            ar
+00006a60: 6368 6976 655f 6469 7220 3d20 2f65 7463  chive_dir = /etc
+00006a70: 2f6c 6574 7365 6e63 7279 7074 2f61 7263  /letsencrypt/arc
+00006a80: 6869 7665 2f65 7861 6d70 6c65 2e63 6f6d  hive/example.com
+00006a90: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
+00006aa0: 7420 3d20 2f65 7463 2f6c 6574 7365 6e63  t = /etc/letsenc
+00006ab0: 7279 7074 2f6c 6976 652f 6578 616d 706c  rypt/live/exampl
+00006ac0: 652e 636f 6d2f 6365 7274 2e70 656d 0a20  e.com/cert.pem. 
+00006ad0: 2020 2020 2020 2020 2020 2070 7269 766b             privk
+00006ae0: 6579 203d 202f 6574 632f 6c65 7473 656e  ey = /etc/letsen
+00006af0: 6372 7970 742f 6c69 7665 2f65 7861 6d70  crypt/live/examp
+00006b00: 6c65 2e63 6f6d 2f70 7269 766b 6579 2e70  le.com/privkey.p
+00006b10: 656d 0a20 2020 2020 2020 2020 2020 2063  em.            c
+00006b20: 6861 696e 203d 202f 6574 632f 6c65 7473  hain = /etc/lets
+00006b30: 656e 6372 7970 742f 6c69 7665 2f65 7861  encrypt/live/exa
+00006b40: 6d70 6c65 2e63 6f6d 2f63 6861 696e 2e70  mple.com/chain.p
+00006b50: 656d 0a20 2020 2020 2020 2020 2020 2066  em.            f
+00006b60: 756c 6c63 6861 696e 203d 202f 6574 632f  ullchain = /etc/
+00006b70: 6c65 7473 656e 6372 7970 742f 6c69 7665  letsencrypt/live
+00006b80: 2f65 7861 6d70 6c65 2e63 6f6d 2f66 756c  /example.com/ful
+00006b90: 6c63 6861 696e 2e70 656d 0a0a 2020 2020  lchain.pem..    
+00006ba0: 2020 2020 2020 2020 2320 4f70 7469 6f6e          # Option
+00006bb0: 7320 7573 6564 2069 6e20 7468 6520 7265  s used in the re
+00006bc0: 6e65 7761 6c20 7072 6f63 6573 730a 2020  newal process.  
+00006bd0: 2020 2020 2020 2020 2020 5b72 656e 6577            [renew
+00006be0: 616c 7061 7261 6d73 5d0a 2020 2020 2020  alparams].      
+00006bf0: 2020 2020 2020 6163 636f 756e 7420 3d20        account = 
+00006c00: 6565 3433 3633 3464 6230 6161 3465 3638  ee43634db0aa4e68
+00006c10: 3034 6631 3532 6265 3339 3939 3065 3661  04f152be39990e6a
+00006c20: 0a20 2020 2020 2020 2020 2020 2073 6572  .            ser
+00006c30: 7665 7220 3d20 6874 7470 733a 2f2f 6163  ver = https://ac
+00006c40: 6d65 2d73 7461 6769 6e67 2d76 3032 2e61  me-staging-v02.a
+00006c50: 7069 2e6c 6574 7365 6e63 7279 7074 2e6f  pi.letsencrypt.o
+00006c60: 7267 2f64 6972 6563 746f 7279 0a20 2020  rg/directory.   
+00006c70: 2020 2020 2020 2020 2061 7574 6865 6e74           authent
+00006c80: 6963 6174 6f72 203d 206e 6769 6e78 0a20  icator = nginx. 
+00006c90: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
+00006ca0: 6c6c 6572 203d 206e 6769 6e78 0a20 2020  ller = nginx.   
+00006cb0: 2020 2020 2020 2020 206b 6579 5f74 7970           key_typ
+00006cc0: 6520 3d20 7273 610a 2020 2020 2020 2020  e = rsa.        
+00006cd0: 2222 220a 2020 2020 2020 2020 7769 7468  """.        with
+00006ce0: 206f 7065 6e28 7365 6c66 2e72 656e 6577   open(self.renew
+00006cf0: 616c 5f66 696c 652c 2027 7727 2920 6173  al_file, 'w') as
+00006d00: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00006d10: 662e 7772 6974 6528 6f72 6967 696e 616c  f.write(original
+00006d20: 5f63 6f6e 6669 6729 0a20 2020 2020 2020  _config).       
+00006d30: 2077 6974 6820 6f70 656e 2873 656c 662e   with open(self.
+00006d40: 7265 6e65 7761 6c5f 6669 6c65 2c20 2772  renewal_file, 'r
+00006d50: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00006d60: 2020 2020 2073 656c 662e 6f72 6967 696e       self.origin
+00006d70: 616c 5f63 6f6e 6669 6720 3d20 636f 6e66  al_config = conf
+00006d80: 6967 6f62 6a2e 436f 6e66 6967 4f62 6a28  igobj.ConfigObj(
+00006d90: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+00006da0: 2020 2065 6e63 6f64 696e 673d 2775 7466     encoding='utf
+00006db0: 2d38 272c 2064 6566 6175 6c74 5f65 6e63  -8', default_enc
+00006dc0: 6f64 696e 673d 2775 7466 2d38 2729 0a0a  oding='utf-8')..
+00006dd0: 0a20 2020 2064 6566 2074 6561 7244 6f77  .    def tearDow
+00006de0: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
+00006df0: 2073 7570 6572 2829 2e74 6561 7244 6f77   super().tearDow
+00006e00: 6e28 290a 2020 2020 2020 2020 7365 6c66  n().        self
+00006e10: 2e67 6574 5f75 7469 6c69 7479 5f70 6174  .get_utility_pat
+00006e20: 6368 2e73 746f 7028 290a 2020 2020 2020  ch.stop().      
+00006e30: 2020 666f 7220 7061 7463 6820 696e 2073    for patch in s
+00006e40: 656c 662e 7061 7463 6865 7273 2e76 616c  elf.patchers.val
+00006e50: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
+00006e60: 2020 2070 6174 6368 2e73 746f 7028 290a     patch.stop().
+00006e70: 0a20 2020 2064 6566 205f 6361 6c6c 2873  .    def _call(s
+00006e80: 656c 662c 2070 6173 7365 645f 6172 6773  elf, passed_args
+00006e90: 293a 0a20 2020 2020 2020 2066 756c 6c5f  ):.        full_
+00006ea0: 6172 6773 203d 2070 6173 7365 645f 6172  args = passed_ar
+00006eb0: 6773 202b 205b 272d 2d63 6f6e 6669 672d  gs + ['--config-
+00006ec0: 6469 7227 2c20 7365 6c66 2e63 6f6e 6669  dir', self.confi
+00006ed0: 675f 6469 725d 0a20 2020 2020 2020 2070  g_dir].        p
+00006ee0: 6c75 6769 6e73 203d 2064 6973 636f 2e50  lugins = disco.P
+00006ef0: 6c75 6769 6e73 5265 6769 7374 7279 2e66  luginsRegistry.f
+00006f00: 696e 645f 616c 6c28 290a 2020 2020 2020  ind_all().      
+00006f10: 2020 636f 6e66 6967 203d 2063 6f6e 6669    config = confi
+00006f20: 6775 7261 7469 6f6e 2e4e 616d 6573 7061  guration.Namespa
+00006f30: 6365 436f 6e66 6967 280a 2020 2020 2020  ceConfig(.      
+00006f40: 2020 2020 2020 636c 692e 7072 6570 6172        cli.prepar
+00006f50: 655f 616e 645f 7061 7273 655f 6172 6773  e_and_parse_args
+00006f60: 2870 6c75 6769 6e73 2c20 6675 6c6c 5f61  (plugins, full_a
+00006f70: 7267 7329 290a 0a20 2020 2020 2020 2066  rgs))..        f
+00006f80: 726f 6d20 6365 7274 626f 742e 5f69 6e74  rom certbot._int
+00006f90: 6572 6e61 6c2e 6d61 696e 2069 6d70 6f72  ernal.main impor
+00006fa0: 7420 7265 636f 6e66 6967 7572 650a 2020  t reconfigure.  
+00006fb0: 2020 2020 2020 7265 636f 6e66 6967 7572        reconfigur
+00006fc0: 6528 636f 6e66 6967 2c20 706c 7567 696e  e(config, plugin
+00006fd0: 7329 0a0a 2020 2020 2020 2020 7769 7468  s)..        with
+00006fe0: 206f 7065 6e28 7365 6c66 2e72 656e 6577   open(self.renew
+00006ff0: 616c 5f66 696c 652c 2027 7227 2920 6173  al_file, 'r') as
+00007000: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00007010: 7570 6461 7465 645f 636f 6e66 203d 2063  updated_conf = c
+00007020: 6f6e 6669 676f 626a 2e43 6f6e 6669 674f  onfigobj.ConfigO
+00007030: 626a 2866 2c20 656e 636f 6469 6e67 3d27  bj(f, encoding='
+00007040: 7574 662d 3827 2c20 6465 6661 756c 745f  utf-8', default_
+00007050: 656e 636f 6469 6e67 3d27 7574 662d 3827  encoding='utf-8'
+00007060: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00007070: 6e20 7570 6461 7465 645f 636f 6e66 0a0a  n updated_conf..
+00007080: 2020 2020 6465 6620 7465 7374 5f64 6f6d      def test_dom
+00007090: 6169 6e73 5f73 6574 2873 656c 6629 3a0a  ains_set(self):.
+000070a0: 2020 2020 2020 2020 7769 7468 2070 7974          with pyt
+000070b0: 6573 742e 7261 6973 6573 2865 7272 6f72  est.raises(error
+000070c0: 732e 436f 6e66 6967 7572 6174 696f 6e45  s.ConfigurationE
+000070d0: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+000070e0: 2020 2073 656c 662e 5f63 616c 6c28 272d     self._call('-
+000070f0: 2d63 6572 742d 6e61 6d65 2063 6572 7431  -cert-name cert1
+00007100: 202d 6420 6f6e 652e 6365 7274 2e63 6f6d   -d one.cert.com
+00007110: 272e 7370 6c69 7428 2929 0a0a 2020 2020  '.split())..    
+00007120: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00007130: 7462 6f74 2e5f 696e 7465 726e 616c 2e63  tbot._internal.c
+00007140: 6572 745f 6d61 6e61 6765 722e 6765 745f  ert_manager.get_
+00007150: 6365 7274 6e61 6d65 7327 290a 2020 2020  certnames').    
+00007160: 6465 6620 7465 7374 5f61 736b 735f 666f  def test_asks_fo
+00007170: 725f 6365 7274 6e61 6d65 2873 656c 662c  r_certname(self,
+00007180: 206d 6f63 6b5f 6365 7274 5f6d 616e 6167   mock_cert_manag
+00007190: 6572 293a 0a20 2020 2020 2020 206d 6f63  er):.        moc
+000071a0: 6b5f 6365 7274 5f6d 616e 6167 6572 2e72  k_cert_manager.r
+000071b0: 6574 7572 6e5f 7661 6c75 6520 3d20 5b27  eturn_value = ['
+000071c0: 6578 616d 706c 652e 636f 6d27 5d0a 2020  example.com'].  
+000071d0: 2020 2020 2020 7365 6c66 2e5f 6361 6c6c        self._call
+000071e0: 2827 2d2d 6e67 696e 7827 2e73 706c 6974  ('--nginx'.split
+000071f0: 2829 290a 2020 2020 2020 2020 6173 7365  ()).        asse
+00007200: 7274 206d 6f63 6b5f 6365 7274 5f6d 616e  rt mock_cert_man
+00007210: 6167 6572 2e63 616c 6c5f 636f 756e 7420  ager.call_count 
+00007220: 3d3d 2031 0a0a 2020 2020 6465 6620 7465  == 1..    def te
+00007230: 7374 5f75 7064 6174 655f 636f 6e66 6967  st_update_config
+00007240: 7572 6174 6f72 2873 656c 6629 3a0a 2020  urator(self):.  
+00007250: 2020 2020 2020 6e61 6d65 645f 6d6f 636b        named_mock
+00007260: 203d 206d 6f63 6b2e 4d6f 636b 2829 0a20   = mock.Mock(). 
+00007270: 2020 2020 2020 206e 616d 6564 5f6d 6f63         named_moc
+00007280: 6b2e 6e61 6d65 203d 2027 6170 6163 6865  k.name = 'apache
+00007290: 270a 0a20 2020 2020 2020 2073 656c 662e  '..        self.
+000072a0: 6d6f 636b 735b 2770 6963 6b5f 696e 7374  mocks['pick_inst
+000072b0: 616c 6c65 7227 5d2e 7265 7475 726e 5f76  aller'].return_v
+000072c0: 616c 7565 203d 206e 616d 6564 5f6d 6f63  alue = named_moc
+000072d0: 6b0a 2020 2020 2020 2020 7365 6c66 2e6d  k.        self.m
+000072e0: 6f63 6b73 5b27 7069 636b 5f61 7574 6827  ocks['pick_auth'
+000072f0: 5d2e 7265 7475 726e 5f76 616c 7565 203d  ].return_value =
+00007300: 206e 616d 6564 5f6d 6f63 6b0a 2020 2020   named_mock.    
+00007310: 2020 2020 7365 6c66 2e6d 6f63 6b73 5b27      self.mocks['
+00007320: 6669 6e64 5f69 6e69 7427 5d2e 7265 7475  find_init'].retu
+00007330: 726e 5f76 616c 7565 203d 206e 616d 6564  rn_value = named
+00007340: 5f6d 6f63 6b0a 0a20 2020 2020 2020 206e  _mock..        n
+00007350: 6577 5f63 6f6e 6669 6720 3d20 7365 6c66  ew_config = self
+00007360: 2e5f 6361 6c6c 2827 2d2d 6365 7274 2d6e  ._call('--cert-n
+00007370: 616d 6520 6578 616d 706c 652e 636f 6d20  ame example.com 
+00007380: 2d2d 6170 6163 6865 272e 7370 6c69 7428  --apache'.split(
+00007390: 2929 0a20 2020 2020 2020 2061 7373 6572  )).        asser
+000073a0: 7420 6e65 775f 636f 6e66 6967 5b27 7265  t new_config['re
+000073b0: 6e65 7761 6c70 6172 616d 7327 5d5b 2761  newalparams']['a
+000073c0: 7574 6865 6e74 6963 6174 6f72 275d 203d  uthenticator'] =
+000073d0: 3d20 2761 7061 6368 6527 0a0a 2020 2020  = 'apache'..    
+000073e0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+000073f0: 7462 6f74 2e5f 696e 7465 726e 616c 2e68  tbot._internal.h
+00007400: 6f6f 6b73 2e76 616c 6964 6174 655f 686f  ooks.validate_ho
+00007410: 6f6b 7327 290a 2020 2020 6465 6620 7465  oks').    def te
+00007420: 7374 5f75 7064 6174 655f 686f 6f6b 7328  st_update_hooks(
+00007430: 7365 6c66 2c20 756e 7573 6564 5f76 616c  self, unused_val
+00007440: 6964 6174 655f 686f 6f6b 7329 3a0a 2020  idate_hooks):.  
+00007450: 2020 2020 2020 6173 7365 7274 2027 7072        assert 'pr
+00007460: 655f 686f 6f6b 2720 6e6f 7420 696e 2073  e_hook' not in s
+00007470: 656c 662e 6f72 6967 696e 616c 5f63 6f6e  elf.original_con
+00007480: 6669 670a 2020 2020 2020 2020 2320 7465  fig.        # te
+00007490: 7374 2073 6574 0a20 2020 2020 2020 206e  st set.        n
+000074a0: 6577 5f63 6f6e 6669 6720 3d20 7365 6c66  ew_config = self
+000074b0: 2e5f 6361 6c6c 2827 2d2d 6365 7274 2d6e  ._call('--cert-n
+000074c0: 616d 6520 6578 616d 706c 652e 636f 6d20  ame example.com 
+000074d0: 2d2d 7072 652d 686f 6f6b 272e 7370 6c69  --pre-hook'.spli
+000074e0: 7428 2920 2b20 5b27 6563 686f 2070 7265  t() + ['echo pre
+000074f0: 275d 290a 2020 2020 2020 2020 6173 7365  ']).        asse
+00007500: 7274 206e 6577 5f63 6f6e 6669 675b 2772  rt new_config['r
+00007510: 656e 6577 616c 7061 7261 6d73 275d 5b27  enewalparams']['
+00007520: 7072 655f 686f 6f6b 275d 203d 3d20 2765  pre_hook'] == 'e
+00007530: 6368 6f20 7072 6527 0a20 2020 2020 2020  cho pre'.       
+00007540: 2023 2074 6573 7420 7570 6461 7465 0a20   # test update. 
+00007550: 2020 2020 2020 206e 6577 5f63 6f6e 6669         new_confi
+00007560: 6720 3d20 7365 6c66 2e5f 6361 6c6c 2827  g = self._call('
+00007570: 2d2d 6365 7274 2d6e 616d 6520 6578 616d  --cert-name exam
+00007580: 706c 652e 636f 6d20 2d2d 7072 652d 686f  ple.com --pre-ho
+00007590: 6f6b 272e 7370 6c69 7428 2920 2b20 5b27  ok'.split() + ['
+000075a0: 6563 686f 2070 7265 3227 5d29 0a20 2020  echo pre2']).   
+000075b0: 2020 2020 2061 7373 6572 7420 6e65 775f       assert new_
+000075c0: 636f 6e66 6967 5b27 7265 6e65 7761 6c70  config['renewalp
+000075d0: 6172 616d 7327 5d5b 2770 7265 5f68 6f6f  arams']['pre_hoo
+000075e0: 6b27 5d20 3d3d 2027 6563 686f 2070 7265  k'] == 'echo pre
+000075f0: 3227 0a0a 2020 2020 2020 2020 2320 7465  2'..        # te
+00007600: 7374 2064 6570 6c6f 7920 686f 6f6b 2069  st deploy hook i
+00007610: 7320 7365 7420 6576 656e 2074 686f 7567  s set even thoug
+00007620: 6820 7765 2064 6964 2061 2064 7279 2072  h we did a dry r
+00007630: 756e 0a20 2020 2020 2020 2061 7373 6572  un.        asser
+00007640: 7420 2772 656e 6577 5f68 6f6f 6b27 206e  t 'renew_hook' n
+00007650: 6f74 2069 6e20 7365 6c66 2e6f 7269 6769  ot in self.origi
+00007660: 6e61 6c5f 636f 6e66 6967 0a20 2020 2020  nal_config.     
+00007670: 2020 206e 6577 5f63 6f6e 6669 6720 3d20     new_config = 
+00007680: 7365 6c66 2e5f 6361 6c6c 2827 2d2d 6365  self._call('--ce
+00007690: 7274 2d6e 616d 6520 6578 616d 706c 652e  rt-name example.
+000076a0: 636f 6d20 2d2d 6465 706c 6f79 2d68 6f6f  com --deploy-hoo
+000076b0: 6b27 2e73 706c 6974 2829 202b 205b 2765  k'.split() + ['e
+000076c0: 6368 6f20 6465 706c 6f79 275d 290a 2020  cho deploy']).  
+000076d0: 2020 2020 2020 6173 7365 7274 206e 6577        assert new
+000076e0: 5f63 6f6e 6669 675b 2772 656e 6577 616c  _config['renewal
+000076f0: 7061 7261 6d73 275d 5b27 7265 6e65 775f  params']['renew_
+00007700: 686f 6f6b 275d 203d 3d20 2765 6368 6f20  hook'] == 'echo 
+00007710: 6465 706c 6f79 270a 0a20 2020 2064 6566  deploy'..    def
+00007720: 2074 6573 745f 6472 795f 7275 6e5f 6661   test_dry_run_fa
+00007730: 696c 7328 7365 6c66 293a 0a20 2020 2020  ils(self):.     
+00007740: 2020 2023 2073 6574 2073 6964 6520 6566     # set side ef
+00007750: 6665 6374 206f 6620 7261 6973 696e 6720  fect of raising 
+00007760: 6572 726f 720a 2020 2020 2020 2020 7365  error.        se
+00007770: 6c66 2e6d 6f63 6b73 5b27 5f67 6574 5f61  lf.mocks['_get_a
+00007780: 6e64 5f73 6176 655f 6365 7274 275d 2e73  nd_save_cert'].s
+00007790: 6964 655f 6566 6665 6374 203d 2065 7272  ide_effect = err
+000077a0: 6f72 732e 4572 726f 720a 0a20 2020 2020  ors.Error..     
+000077b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+000077c0: 2020 2020 7365 6c66 2e5f 6361 6c6c 2827      self._call('
+000077d0: 2d2d 6365 7274 2d6e 616d 6520 6578 616d  --cert-name exam
+000077e0: 706c 652e 636f 6d20 2d2d 6170 6163 6865  ple.com --apache
+000077f0: 272e 7370 6c69 7428 2929 0a20 2020 2020  '.split()).     
+00007800: 2020 2065 7863 6570 7420 6572 726f 7273     except errors
+00007810: 2e45 7272 6f72 3a0a 2020 2020 2020 2020  .Error:.        
+00007820: 2020 2020 7061 7373 0a0a 2020 2020 2020      pass..      
+00007830: 2020 2320 6368 6563 6b20 7468 6174 2063    # check that c
+00007840: 6f6e 6669 6720 6973 6e27 7420 6d6f 6469  onfig isn't modi
+00007850: 6669 6564 0a20 2020 2020 2020 2077 6974  fied.        wit
+00007860: 6820 6f70 656e 2873 656c 662e 7265 6e65  h open(self.rene
+00007870: 7761 6c5f 6669 6c65 2c20 2772 2729 2061  wal_file, 'r') a
+00007880: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+00007890: 206e 6577 5f63 6f6e 6669 6720 3d20 636f   new_config = co
+000078a0: 6e66 6967 6f62 6a2e 436f 6e66 6967 4f62  nfigobj.ConfigOb
+000078b0: 6a28 662c 2065 6e63 6f64 696e 673d 2775  j(f, encoding='u
+000078c0: 7466 2d38 272c 2064 6566 6175 6c74 5f65  tf-8', default_e
+000078d0: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
+000078e0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+000078f0: 6e65 775f 636f 6e66 6967 5b27 7265 6e65  new_config['rene
+00007900: 7761 6c70 6172 616d 7327 5d5b 2761 7574  walparams']['aut
+00007910: 6865 6e74 6963 6174 6f72 275d 203d 3d20  henticator'] == 
+00007920: 276e 6769 6e78 270a 0a20 2020 2040 6d6f  'nginx'..    @mo
+00007930: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00007940: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00007950: 2e64 6973 706c 6179 5f75 7469 6c2e 6e6f  .display_util.no
+00007960: 7469 6679 2729 0a20 2020 2064 6566 2074  tify').    def t
+00007970: 6573 745f 7265 706f 7274 5f72 6573 756c  est_report_resul
+00007980: 7473 2873 656c 662c 206d 6f63 6b5f 6e6f  ts(self, mock_no
+00007990: 7469 6679 293a 0a20 2020 2020 2020 2023  tify):.        #
+000079a0: 206d 616b 6520 7375 7265 2072 6570 6f72   make sure repor
+000079b0: 7420 7265 7375 6c74 7320 776f 726b 7320  t results works 
+000079c0: 7768 656e 2063 6f6e 6669 6720 6861 7320  when config has 
+000079d0: 6120 7765 6272 6f6f 7420 6d61 700a 2020  a webroot map.  
+000079e0: 2020 2020 2020 6f72 6967 696e 616c 5f63        original_c
+000079f0: 6f6e 6669 6720 3d20 2222 220a 2020 2020  onfig = """.    
+00007a00: 2020 2020 2020 2020 7665 7273 696f 6e20          version 
+00007a10: 3d20 322e 302e 300a 2020 2020 2020 2020  = 2.0.0.        
+00007a20: 2020 2020 6172 6368 6976 655f 6469 7220      archive_dir 
+00007a30: 3d20 2f65 7463 2f6c 6574 7365 6e63 7279  = /etc/letsencry
+00007a40: 7074 2f61 7263 6869 7665 2f65 7861 6d70  pt/archive/examp
+00007a50: 6c65 2e63 6f6d 0a20 2020 2020 2020 2020  le.com.         
+00007a60: 2020 2063 6572 7420 3d20 2f65 7463 2f6c     cert = /etc/l
+00007a70: 6574 7365 6e63 7279 7074 2f6c 6976 652f  etsencrypt/live/
+00007a80: 6578 616d 706c 652e 636f 6d2f 6365 7274  example.com/cert
+00007a90: 2e70 656d 0a20 2020 2020 2020 2020 2020  .pem.           
+00007aa0: 2070 7269 766b 6579 203d 202f 6574 632f   privkey = /etc/
+00007ab0: 6c65 7473 656e 6372 7970 742f 6c69 7665  letsencrypt/live
+00007ac0: 2f65 7861 6d70 6c65 2e63 6f6d 2f70 7269  /example.com/pri
+00007ad0: 766b 6579 2e70 656d 0a20 2020 2020 2020  vkey.pem.       
+00007ae0: 2020 2020 2063 6861 696e 203d 202f 6574       chain = /et
+00007af0: 632f 6c65 7473 656e 6372 7970 742f 6c69  c/letsencrypt/li
+00007b00: 7665 2f65 7861 6d70 6c65 2e63 6f6d 2f63  ve/example.com/c
+00007b10: 6861 696e 2e70 656d 0a20 2020 2020 2020  hain.pem.       
+00007b20: 2020 2020 2066 756c 6c63 6861 696e 203d       fullchain =
+00007b30: 202f 6574 632f 6c65 7473 656e 6372 7970   /etc/letsencryp
+00007b40: 742f 6c69 7665 2f65 7861 6d70 6c65 2e63  t/live/example.c
+00007b50: 6f6d 2f66 756c 6c63 6861 696e 2e70 656d  om/fullchain.pem
+00007b60: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00007b70: 4f70 7469 6f6e 7320 7573 6564 2069 6e20  Options used in 
+00007b80: 7468 6520 7265 6e65 7761 6c20 7072 6f63  the renewal proc
+00007b90: 6573 730a 2020 2020 2020 2020 2020 2020  ess.            
+00007ba0: 5b72 656e 6577 616c 7061 7261 6d73 5d0a  [renewalparams].
+00007bb0: 2020 2020 2020 2020 2020 2020 6163 636f              acco
+00007bc0: 756e 7420 3d20 6565 3433 3633 3464 6230  unt = ee43634db0
+00007bd0: 6161 3465 3638 3034 6631 3532 6265 3339  aa4e6804f152be39
+00007be0: 3939 3065 3661 0a20 2020 2020 2020 2020  990e6a.         
+00007bf0: 2020 2073 6572 7665 7220 3d20 6874 7470     server = http
+00007c00: 733a 2f2f 6163 6d65 2d73 7461 6769 6e67  s://acme-staging
+00007c10: 2d76 3032 2e61 7069 2e6c 6574 7365 6e63  -v02.api.letsenc
+00007c20: 7279 7074 2e6f 7267 2f64 6972 6563 746f  rypt.org/directo
+00007c30: 7279 0a20 2020 2020 2020 2020 2020 2061  ry.            a
+00007c40: 7574 6865 6e74 6963 6174 6f72 203d 2077  uthenticator = w
+00007c50: 6562 726f 6f74 0a20 2020 2020 2020 2020  ebroot.         
+00007c60: 2020 2069 6e73 7461 6c6c 6572 203d 206e     installer = n
+00007c70: 6769 6e78 0a20 2020 2020 2020 2020 2020  ginx.           
+00007c80: 206b 6579 5f74 7970 6520 3d20 6563 6473   key_type = ecds
+00007c90: 610a 2020 2020 2020 2020 2020 2020 7765  a.            we
+00007ca0: 6272 6f6f 745f 7061 7468 203d 202f 7661  broot_path = /va
+00007cb0: 722f 7777 772f 6874 6d6c 2c0a 2020 2020  r/www/html,.    
+00007cc0: 2020 2020 2020 2020 5b5b 7765 6272 6f6f          [[webroo
+00007cd0: 745f 6d61 705d 5d0a 2020 2020 2020 2020  t_map]].        
+00007ce0: 2020 2020 6578 616d 706c 652e 636f 6d20      example.com 
+00007cf0: 3d20 2f76 6172 2f77 7777 2f68 746d 6c0a  = /var/www/html.
+00007d00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00007d10: 2020 2020 7769 7468 206f 7065 6e28 7365      with open(se
+00007d20: 6c66 2e72 656e 6577 616c 5f66 696c 652c  lf.renewal_file,
+00007d30: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
+00007d40: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00007d50: 6f72 6967 696e 616c 5f63 6f6e 6669 6729  original_config)
+00007d60: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00007d70: 656e 2873 656c 662e 7265 6e65 7761 6c5f  en(self.renewal_
+00007d80: 6669 6c65 2c20 2772 2729 2061 7320 663a  file, 'r') as f:
+00007d90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007da0: 662e 6f72 6967 696e 616c 5f63 6f6e 6669  f.original_confi
+00007db0: 6720 3d20 636f 6e66 6967 6f62 6a2e 436f  g = configobj.Co
+00007dc0: 6e66 6967 4f62 6a28 662c 0a20 2020 2020  nfigObj(f,.     
+00007dd0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
+00007de0: 696e 673d 2775 7466 2d38 272c 2064 6566  ing='utf-8', def
+00007df0: 6175 6c74 5f65 6e63 6f64 696e 673d 2775  ault_encoding='u
+00007e00: 7466 2d38 2729 0a0a 2020 2020 2020 2020  tf-8')..        
+00007e10: 6e61 6d65 645f 6d6f 636b 203d 206d 6f63  named_mock = moc
+00007e20: 6b2e 4d6f 636b 2829 0a20 2020 2020 2020  k.Mock().       
+00007e30: 206e 616d 6564 5f6d 6f63 6b2e 6e61 6d65   named_mock.name
+00007e40: 203d 2027 6e67 696e 7827 0a0a 2020 2020   = 'nginx'..    
+00007e50: 2020 2020 7365 6c66 2e6d 6f63 6b73 5b27      self.mocks['
+00007e60: 7069 636b 5f61 7574 6827 5d2e 7265 7475  pick_auth'].retu
+00007e70: 726e 5f76 616c 7565 203d 206e 616d 6564  rn_value = named
+00007e80: 5f6d 6f63 6b0a 2020 2020 2020 2020 7365  _mock.        se
+00007e90: 6c66 2e6d 6f63 6b73 5b27 6669 6e64 5f69  lf.mocks['find_i
+00007ea0: 6e69 7427 5d2e 7265 7475 726e 5f76 616c  nit'].return_val
+00007eb0: 7565 203d 206e 616d 6564 5f6d 6f63 6b0a  ue = named_mock.
+00007ec0: 0a20 2020 2020 2020 206e 6577 5f63 6f6e  .        new_con
+00007ed0: 6669 6720 3d20 7365 6c66 2e5f 6361 6c6c  fig = self._call
+00007ee0: 2827 2d2d 6365 7274 2d6e 616d 6520 6578  ('--cert-name ex
+00007ef0: 616d 706c 652e 636f 6d20 2d2d 6e67 696e  ample.com --ngin
+00007f00: 7827 2e73 706c 6974 2829 290a 2020 2020  x'.split()).    
+00007f10: 2020 2020 6173 7365 7274 206e 6577 5f63      assert new_c
+00007f20: 6f6e 6669 675b 2772 656e 6577 616c 7061  onfig['renewalpa
+00007f30: 7261 6d73 275d 5b27 6175 7468 656e 7469  rams']['authenti
+00007f40: 6361 746f 7227 5d20 3d3d 2027 6e67 696e  cator'] == 'ngin
+00007f50: 7827 0a20 2020 2020 2020 206d 6f63 6b5f  x'.        mock_
+00007f60: 6e6f 7469 6679 2e61 7373 6572 745f 6361  notify.assert_ca
+00007f70: 6c6c 6564 5f77 6974 6828 0a20 2020 2020  lled_with(.     
+00007f80: 2020 2020 2020 2027 5c6e 5375 6363 6573         '\nSucces
+00007f90: 7366 756c 6c79 2075 7064 6174 6564 2063  sfully updated c
+00007fa0: 6f6e 6669 6775 7261 7469 6f6e 2e27 2b0a  onfiguration.'+.
+00007fb0: 2020 2020 2020 2020 2020 2020 275c 6e43              '\nC
+00007fc0: 6861 6e67 6573 2077 696c 6c20 6170 706c  hanges will appl
+00007fd0: 7920 7768 656e 2074 6865 2063 6572 7469  y when the certi
+00007fe0: 6669 6361 7465 2072 656e 6577 732e 2729  ficate renews.')
+00007ff0: 0a0a 0a63 6c61 7373 2044 656c 6574 6549  ...class DeleteI
+00008000: 6641 7070 726f 7072 6961 7465 5465 7374  fAppropriateTest
+00008010: 2874 6573 745f 7574 696c 2e43 6f6e 6669  (test_util.Confi
+00008020: 6754 6573 7443 6173 6529 3a0a 2020 2020  gTestCase):.    
+00008030: 2222 2254 6573 7473 2066 6f72 2063 6572  """Tests for cer
+00008040: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00008050: 6169 6e2e 5f64 656c 6574 655f 6966 5f61  ain._delete_if_a
+00008060: 7070 726f 7072 6961 7465 2022 2222 0a0a  ppropriate """..
+00008070: 2020 2020 6465 6620 5f63 616c 6c28 7365      def _call(se
+00008080: 6c66 2c20 6d6f 636b 5f63 6f6e 6669 6729  lf, mock_config)
+00008090: 3a0a 2020 2020 2020 2020 6672 6f6d 2063  :.        from c
+000080a0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+000080b0: 2e6d 6169 6e20 696d 706f 7274 205f 6465  .main import _de
+000080c0: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
+000080d0: 6174 650a 2020 2020 2020 2020 5f64 656c  ate.        _del
+000080e0: 6574 655f 6966 5f61 7070 726f 7072 6961  ete_if_appropria
+000080f0: 7465 286d 6f63 6b5f 636f 6e66 6967 290a  te(mock_config).
+00008100: 0a20 2020 2064 6566 205f 7465 7374 5f64  .    def _test_d
+00008110: 656c 6574 655f 6f70 745f 6f75 745f 636f  elete_opt_out_co
+00008120: 6d6d 6f6e 2873 656c 6629 3a0a 2020 2020  mmon(self):.    
+00008130: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+00008140: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+00008150: 7465 726e 616c 2e63 6572 745f 6d61 6e61  ternal.cert_mana
+00008160: 6765 722e 6465 6c65 7465 2729 2061 7320  ger.delete') as 
+00008170: 6d6f 636b 5f64 656c 6574 653a 0a20 2020  mock_delete:.   
+00008180: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00008190: 616c 6c28 7365 6c66 2e63 6f6e 6669 6729  all(self.config)
+000081a0: 0a20 2020 2020 2020 206d 6f63 6b5f 6465  .        mock_de
+000081b0: 6c65 7465 2e61 7373 6572 745f 6e6f 745f  lete.assert_not_
+000081c0: 6361 6c6c 6564 2829 0a0a 2020 2020 4074  called()..    @t
+000081d0: 6573 745f 7574 696c 2e70 6174 6368 5f64  est_util.patch_d
+000081e0: 6973 706c 6179 5f75 7469 6c28 290a 2020  isplay_util().  
+000081f0: 2020 6465 6620 7465 7374 5f64 656c 6574    def test_delet
+00008200: 655f 666c 6167 5f6f 7074 5f6f 7574 2873  e_flag_opt_out(s
+00008210: 656c 662c 2075 6e75 7365 645f 6d6f 636b  elf, unused_mock
+00008220: 5f67 6574 5f75 7469 6c69 7479 293a 0a20  _get_utility):. 
+00008230: 2020 2020 2020 2073 656c 662e 636f 6e66         self.conf
+00008240: 6967 2e64 656c 6574 655f 6166 7465 725f  ig.delete_after_
+00008250: 7265 766f 6b65 203d 2046 616c 7365 0a20  revoke = False. 
+00008260: 2020 2020 2020 2073 656c 662e 5f74 6573         self._tes
+00008270: 745f 6465 6c65 7465 5f6f 7074 5f6f 7574  t_delete_opt_out
+00008280: 5f63 6f6d 6d6f 6e28 290a 0a20 2020 2040  _common()..    @
+00008290: 7465 7374 5f75 7469 6c2e 7061 7463 685f  test_util.patch_
+000082a0: 6469 7370 6c61 795f 7574 696c 2829 0a20  display_util(). 
+000082b0: 2020 2064 6566 2074 6573 745f 6465 6c65     def test_dele
+000082c0: 7465 5f70 726f 6d70 745f 6f70 745f 6f75  te_prompt_opt_ou
+000082d0: 7428 7365 6c66 2c20 6d6f 636b 5f67 6574  t(self, mock_get
+000082e0: 5f75 7469 6c69 7479 293a 0a20 2020 2020  _utility):.     
+000082f0: 2020 2075 7469 6c5f 6d6f 636b 203d 206d     util_mock = m
+00008300: 6f63 6b5f 6765 745f 7574 696c 6974 7928  ock_get_utility(
+00008310: 290a 2020 2020 2020 2020 7574 696c 5f6d  ).        util_m
+00008320: 6f63 6b2e 7965 736e 6f2e 7265 7475 726e  ock.yesno.return
+00008330: 5f76 616c 7565 203d 2046 616c 7365 0a20  _value = False. 
+00008340: 2020 2020 2020 2073 656c 662e 5f74 6573         self._tes
+00008350: 745f 6465 6c65 7465 5f6f 7074 5f6f 7574  t_delete_opt_out
+00008360: 5f63 6f6d 6d6f 6e28 290a 0a20 2020 2040  _common()..    @
+00008370: 6d6f 636b 2e70 6174 6368 2822 6365 7274  mock.patch("cert
+00008380: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+00008390: 696e 2e6c 6f67 6765 722e 7761 726e 696e  in.logger.warnin
+000083a0: 6722 290a 2020 2020 406d 6f63 6b2e 7061  g").    @mock.pa
+000083b0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+000083c0: 7465 726e 616c 2e73 746f 7261 6765 2e72  ternal.storage.r
+000083d0: 656e 6577 616c 5f66 696c 655f 666f 725f  enewal_file_for_
+000083e0: 6365 7274 6e61 6d65 2729 0a20 2020 2040  certname').    @
+000083f0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00008400: 626f 742e 5f69 6e74 6572 6e61 6c2e 6365  bot._internal.ce
+00008410: 7274 5f6d 616e 6167 6572 2e64 656c 6574  rt_manager.delet
+00008420: 6527 290a 2020 2020 406d 6f63 6b2e 7061  e').    @mock.pa
+00008430: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+00008440: 7465 726e 616c 2e63 6572 745f 6d61 6e61  ternal.cert_mana
+00008450: 6765 722e 6d61 7463 685f 616e 645f 6368  ger.match_and_ch
+00008460: 6563 6b5f 6f76 6572 6c61 7073 2729 0a20  eck_overlaps'). 
+00008470: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+00008480: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+00008490: 6c2e 7374 6f72 6167 652e 6675 6c6c 5f61  l.storage.full_a
+000084a0: 7263 6869 7665 5f70 6174 6827 290a 2020  rchive_path').  
+000084b0: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+000084c0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+000084d0: 2e63 6572 745f 6d61 6e61 6765 722e 6365  .cert_manager.ce
+000084e0: 7274 5f70 6174 685f 746f 5f6c 696e 6561  rt_path_to_linea
+000084f0: 6765 2729 0a20 2020 2040 7465 7374 5f75  ge').    @test_u
+00008500: 7469 6c2e 7061 7463 685f 6469 7370 6c61  til.patch_displa
+00008510: 795f 7574 696c 2829 0a20 2020 2064 6566  y_util().    def
+00008520: 2074 6573 745f 6f76 6572 6c61 7070 696e   test_overlappin
+00008530: 675f 6172 6368 6976 655f 6469 7273 2873  g_archive_dirs(s
+00008540: 656c 662c 206d 6f63 6b5f 6765 745f 7574  elf, mock_get_ut
+00008550: 696c 6974 792c 0a20 2020 2020 2020 2020  ility,.         
+00008560: 2020 206d 6f63 6b5f 6365 7274 5f70 6174     mock_cert_pat
+00008570: 685f 746f 5f6c 696e 6561 6765 2c20 6d6f  h_to_lineage, mo
+00008580: 636b 5f61 7263 6869 7665 2c0a 2020 2020  ck_archive,.    
+00008590: 2020 2020 2020 2020 6d6f 636b 5f6d 6174          mock_mat
+000085a0: 6368 5f61 6e64 5f63 6865 636b 5f6f 7665  ch_and_check_ove
+000085b0: 726c 6170 732c 206d 6f63 6b5f 6465 6c65  rlaps, mock_dele
+000085c0: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
+000085d0: 6d6f 636b 5f72 656e 6577 616c 5f66 696c  mock_renewal_fil
+000085e0: 655f 666f 725f 6365 7274 6e61 6d65 2c20  e_for_certname, 
+000085f0: 6d6f 636b 5f77 6172 6e69 6e67 293a 0a20  mock_warning):. 
+00008600: 2020 2020 2020 2023 2070 796c 696e 743a         # pylint:
+00008610: 2064 6973 6162 6c65 203d 2075 6e75 7365   disable = unuse
+00008620: 642d 6172 6775 6d65 6e74 0a20 2020 2020  d-argument.     
+00008630: 2020 2063 6f6e 6669 6720 3d20 7365 6c66     config = self
+00008640: 2e63 6f6e 6669 670a 2020 2020 2020 2020  .config.        
+00008650: 636f 6e66 6967 2e63 6572 745f 7061 7468  config.cert_path
+00008660: 203d 2022 2f73 6f6d 652f 7265 6173 6f6e   = "/some/reason
+00008670: 6162 6c65 2f70 6174 6822 0a20 2020 2020  able/path".     
+00008680: 2020 2063 6f6e 6669 672e 6365 7274 6e61     config.certna
+00008690: 6d65 203d 2022 220a 2020 2020 2020 2020  me = "".        
+000086a0: 6d6f 636b 5f63 6572 745f 7061 7468 5f74  mock_cert_path_t
+000086b0: 6f5f 6c69 6e65 6167 652e 7265 7475 726e  o_lineage.return
+000086c0: 5f76 616c 7565 203d 2022 6578 616d 706c  _value = "exampl
+000086d0: 652e 636f 6d22 0a20 2020 2020 2020 206d  e.com".        m
+000086e0: 6f63 6b5f 6d61 7463 685f 616e 645f 6368  ock_match_and_ch
+000086f0: 6563 6b5f 6f76 6572 6c61 7073 2e73 6964  eck_overlaps.sid
+00008700: 655f 6566 6665 6374 203d 2065 7272 6f72  e_effect = error
+00008710: 732e 4f76 6572 6c61 7070 696e 674d 6174  s.OverlappingMat
+00008720: 6368 466f 756e 6428 290a 2020 2020 2020  chFound().      
+00008730: 2020 7365 6c66 2e5f 6361 6c6c 2863 6f6e    self._call(con
+00008740: 6669 6729 0a20 2020 2020 2020 206d 6f63  fig).        moc
+00008750: 6b5f 6465 6c65 7465 2e61 7373 6572 745f  k_delete.assert_
+00008760: 6e6f 745f 6361 6c6c 6564 2829 0a20 2020  not_called().   
+00008770: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
+00008780: 5f77 6172 6e69 6e67 2e63 616c 6c5f 636f  _warning.call_co
+00008790: 756e 7420 3d3d 2031 0a0a 2020 2020 406d  unt == 1..    @m
+000087a0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+000087b0: 6f74 2e5f 696e 7465 726e 616c 2e73 746f  ot._internal.sto
+000087c0: 7261 6765 2e72 656e 6577 616c 5f66 696c  rage.renewal_fil
+000087d0: 655f 666f 725f 6365 7274 6e61 6d65 2729  e_for_certname')
+000087e0: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
+000087f0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+00008800: 6e61 6c2e 6365 7274 5f6d 616e 6167 6572  nal.cert_manager
+00008810: 2e6d 6174 6368 5f61 6e64 5f63 6865 636b  .match_and_check
+00008820: 5f6f 7665 726c 6170 7327 290a 2020 2020  _overlaps').    
+00008830: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00008840: 7462 6f74 2e5f 696e 7465 726e 616c 2e73  tbot._internal.s
+00008850: 746f 7261 6765 2e66 756c 6c5f 6172 6368  torage.full_arch
+00008860: 6976 655f 7061 7468 2729 0a20 2020 2040  ive_path').    @
+00008870: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00008880: 626f 742e 5f69 6e74 6572 6e61 6c2e 6365  bot._internal.ce
+00008890: 7274 5f6d 616e 6167 6572 2e64 656c 6574  rt_manager.delet
+000088a0: 6527 290a 2020 2020 406d 6f63 6b2e 7061  e').    @mock.pa
+000088b0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+000088c0: 7465 726e 616c 2e63 6572 745f 6d61 6e61  ternal.cert_mana
+000088d0: 6765 722e 6365 7274 5f70 6174 685f 746f  ger.cert_path_to
+000088e0: 5f6c 696e 6561 6765 2729 0a20 2020 2040  _lineage').    @
+000088f0: 7465 7374 5f75 7469 6c2e 7061 7463 685f  test_util.patch_
+00008900: 6469 7370 6c61 795f 7574 696c 2829 0a20  display_util(). 
+00008910: 2020 2064 6566 2074 6573 745f 6365 7274     def test_cert
+00008920: 5f70 6174 685f 6f6e 6c79 2873 656c 662c  _path_only(self,
+00008930: 206d 6f63 6b5f 6765 745f 7574 696c 6974   mock_get_utilit
+00008940: 792c 0a20 2020 2020 2020 2020 2020 206d  y,.            m
+00008950: 6f63 6b5f 6365 7274 5f70 6174 685f 746f  ock_cert_path_to
+00008960: 5f6c 696e 6561 6765 2c20 6d6f 636b 5f64  _lineage, mock_d
+00008970: 656c 6574 652c 206d 6f63 6b5f 6172 6368  elete, mock_arch
+00008980: 6976 652c 0a20 2020 2020 2020 2020 2020  ive,.           
+00008990: 206d 6f63 6b5f 6f76 6572 6c61 7070 696e   mock_overlappin
+000089a0: 675f 6172 6368 6976 655f 6469 7273 2c20  g_archive_dirs, 
+000089b0: 6d6f 636b 5f72 656e 6577 616c 5f66 696c  mock_renewal_fil
+000089c0: 655f 666f 725f 6365 7274 6e61 6d65 293a  e_for_certname):
+000089d0: 0a20 2020 2020 2020 2023 2070 796c 696e  .        # pylin
+000089e0: 743a 2064 6973 6162 6c65 203d 2075 6e75  t: disable = unu
+000089f0: 7365 642d 6172 6775 6d65 6e74 0a20 2020  sed-argument.   
+00008a00: 2020 2020 2063 6f6e 6669 6720 3d20 7365       config = se
+00008a10: 6c66 2e63 6f6e 6669 670a 2020 2020 2020  lf.config.      
+00008a20: 2020 636f 6e66 6967 2e63 6572 745f 7061    config.cert_pa
+00008a30: 7468 203d 2022 2f73 6f6d 652f 7265 6173  th = "/some/reas
+00008a40: 6f6e 6162 6c65 2f70 6174 6822 0a20 2020  onable/path".   
+00008a50: 2020 2020 2063 6f6e 6669 672e 6365 7274       config.cert
+00008a60: 6e61 6d65 203d 2022 220a 2020 2020 2020  name = "".      
+00008a70: 2020 6d6f 636b 5f63 6572 745f 7061 7468    mock_cert_path
+00008a80: 5f74 6f5f 6c69 6e65 6167 652e 7265 7475  _to_lineage.retu
+00008a90: 726e 5f76 616c 7565 203d 2022 6578 616d  rn_value = "exam
+00008aa0: 706c 652e 636f 6d22 0a20 2020 2020 2020  ple.com".       
+00008ab0: 206d 6f63 6b5f 6f76 6572 6c61 7070 696e   mock_overlappin
+00008ac0: 675f 6172 6368 6976 655f 6469 7273 2e72  g_archive_dirs.r
+00008ad0: 6574 7572 6e5f 7661 6c75 6520 3d20 4661  eturn_value = Fa
+00008ae0: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
+00008af0: 2e5f 6361 6c6c 2863 6f6e 6669 6729 0a20  ._call(config). 
+00008b00: 2020 2020 2020 2061 7373 6572 7420 6d6f         assert mo
+00008b10: 636b 5f64 656c 6574 652e 6361 6c6c 5f63  ck_delete.call_c
+00008b20: 6f75 6e74 203d 3d20 310a 0a20 2020 2040  ount == 1..    @
+00008b30: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00008b40: 626f 742e 5f69 6e74 6572 6e61 6c2e 7374  bot._internal.st
+00008b50: 6f72 6167 652e 7265 6e65 7761 6c5f 6669  orage.renewal_fi
+00008b60: 6c65 5f66 6f72 5f63 6572 746e 616d 6527  le_for_certname'
+00008b70: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
+00008b80: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+00008b90: 726e 616c 2e63 6572 745f 6d61 6e61 6765  rnal.cert_manage
+00008ba0: 722e 6d61 7463 685f 616e 645f 6368 6563  r.match_and_chec
+00008bb0: 6b5f 6f76 6572 6c61 7073 2729 0a20 2020  k_overlaps').   
+00008bc0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00008bd0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00008be0: 7374 6f72 6167 652e 6675 6c6c 5f61 7263  storage.full_arc
+00008bf0: 6869 7665 5f70 6174 6827 290a 2020 2020  hive_path').    
+00008c00: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00008c10: 7462 6f74 2e5f 696e 7465 726e 616c 2e63  tbot._internal.c
+00008c20: 6572 745f 6d61 6e61 6765 722e 6365 7274  ert_manager.cert
+00008c30: 5f70 6174 685f 746f 5f6c 696e 6561 6765  _path_to_lineage
+00008c40: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+00008c50: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00008c60: 6572 6e61 6c2e 6365 7274 5f6d 616e 6167  ernal.cert_manag
+00008c70: 6572 2e64 656c 6574 6527 290a 2020 2020  er.delete').    
+00008c80: 4074 6573 745f 7574 696c 2e70 6174 6368  @test_util.patch
+00008c90: 5f64 6973 706c 6179 5f75 7469 6c28 290a  _display_util().
+00008ca0: 2020 2020 6465 6620 7465 7374 5f6e 6f6e      def test_non
+00008cb0: 696e 7465 7261 6374 6976 655f 6465 6c65  interactive_dele
+00008cc0: 7469 6f6e 2873 656c 662c 206d 6f63 6b5f  tion(self, mock_
+00008cd0: 6765 745f 7574 696c 6974 792c 206d 6f63  get_utility, moc
+00008ce0: 6b5f 6465 6c65 7465 2c0a 2020 2020 2020  k_delete,.      
+00008cf0: 2020 2020 2020 6d6f 636b 5f63 6572 745f        mock_cert_
+00008d00: 7061 7468 5f74 6f5f 6c69 6e65 6167 652c  path_to_lineage,
+00008d10: 206d 6f63 6b5f 6675 6c6c 5f61 7263 6869   mock_full_archi
+00008d20: 7665 5f64 6972 2c0a 2020 2020 2020 2020  ve_dir,.        
+00008d30: 2020 2020 6d6f 636b 5f6d 6174 6368 5f61      mock_match_a
+00008d40: 6e64 5f63 6865 636b 5f6f 7665 726c 6170  nd_check_overlap
+00008d50: 732c 206d 6f63 6b5f 7265 6e65 7761 6c5f  s, mock_renewal_
+00008d60: 6669 6c65 5f66 6f72 5f63 6572 746e 616d  file_for_certnam
+00008d70: 6529 3a0a 2020 2020 2020 2020 2320 7079  e):.        # py
+00008d80: 6c69 6e74 3a20 6469 7361 626c 6520 3d20  lint: disable = 
+00008d90: 756e 7573 6564 2d61 7267 756d 656e 740a  unused-argument.
+00008da0: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
+00008db0: 2073 656c 662e 636f 6e66 6967 0a20 2020   self.config.   
+00008dc0: 2020 2020 2063 6f6e 6669 672e 6e61 6d65       config.name
+00008dd0: 7370 6163 652e 6e6f 6e69 6e74 6572 6163  space.noninterac
+00008de0: 7469 7665 5f6d 6f64 6520 3d20 5472 7565  tive_mode = True
+00008df0: 0a20 2020 2020 2020 2063 6f6e 6669 672e  .        config.
+00008e00: 6365 7274 5f70 6174 6820 3d20 222f 736f  cert_path = "/so
+00008e10: 6d65 2f72 6561 736f 6e61 626c 652f 7061  me/reasonable/pa
+00008e20: 7468 220a 2020 2020 2020 2020 636f 6e66  th".        conf
+00008e30: 6967 2e63 6572 746e 616d 6520 3d20 2222  ig.certname = ""
+00008e40: 0a20 2020 2020 2020 206d 6f63 6b5f 6365  .        mock_ce
+00008e50: 7274 5f70 6174 685f 746f 5f6c 696e 6561  rt_path_to_linea
+00008e60: 6765 2e72 6574 7572 6e5f 7661 6c75 6520  ge.return_value 
+00008e70: 3d20 2265 7861 6d70 6c65 2e63 6f6d 220a  = "example.com".
+00008e80: 2020 2020 2020 2020 6d6f 636b 5f66 756c          mock_ful
+00008e90: 6c5f 6172 6368 6976 655f 6469 722e 7265  l_archive_dir.re
+00008ea0: 7475 726e 5f76 616c 7565 203d 2022 220a  turn_value = "".
+00008eb0: 2020 2020 2020 2020 6d6f 636b 5f6d 6174          mock_mat
+00008ec0: 6368 5f61 6e64 5f63 6865 636b 5f6f 7665  ch_and_check_ove
+00008ed0: 726c 6170 732e 7265 7475 726e 5f76 616c  rlaps.return_val
+00008ee0: 7565 203d 2022 220a 2020 2020 2020 2020  ue = "".        
+00008ef0: 7365 6c66 2e5f 6361 6c6c 2863 6f6e 6669  self._call(confi
+00008f00: 6729 0a20 2020 2020 2020 2061 7373 6572  g).        asser
+00008f10: 7420 6d6f 636b 5f64 656c 6574 652e 6361  t mock_delete.ca
+00008f20: 6c6c 5f63 6f75 6e74 203d 3d20 310a 0a20  ll_count == 1.. 
+00008f30: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+00008f40: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+00008f50: 6c2e 7374 6f72 6167 652e 7265 6e65 7761  l.storage.renewa
+00008f60: 6c5f 6669 6c65 5f66 6f72 5f63 6572 746e  l_file_for_certn
+00008f70: 616d 6527 290a 2020 2020 406d 6f63 6b2e  ame').    @mock.
+00008f80: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00008f90: 696e 7465 726e 616c 2e63 6572 745f 6d61  internal.cert_ma
+00008fa0: 6e61 6765 722e 6d61 7463 685f 616e 645f  nager.match_and_
+00008fb0: 6368 6563 6b5f 6f76 6572 6c61 7073 2729  check_overlaps')
+00008fc0: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
+00008fd0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+00008fe0: 6e61 6c2e 7374 6f72 6167 652e 6675 6c6c  nal.storage.full
+00008ff0: 5f61 7263 6869 7665 5f70 6174 6827 290a  _archive_path').
+00009000: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+00009010: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+00009020: 616c 2e63 6572 745f 6d61 6e61 6765 722e  al.cert_manager.
+00009030: 6365 7274 5f70 6174 685f 746f 5f6c 696e  cert_path_to_lin
+00009040: 6561 6765 2729 0a20 2020 2040 6d6f 636b  eage').    @mock
+00009050: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00009060: 5f69 6e74 6572 6e61 6c2e 6365 7274 5f6d  _internal.cert_m
+00009070: 616e 6167 6572 2e64 656c 6574 6527 290a  anager.delete').
+00009080: 2020 2020 4074 6573 745f 7574 696c 2e70      @test_util.p
+00009090: 6174 6368 5f64 6973 706c 6179 5f75 7469  atch_display_uti
+000090a0: 6c28 290a 2020 2020 6465 6620 7465 7374  l().    def test
+000090b0: 5f6f 7074 5f69 6e5f 6465 6c65 7469 6f6e  _opt_in_deletion
+000090c0: 2873 656c 662c 206d 6f63 6b5f 6765 745f  (self, mock_get_
+000090d0: 7574 696c 6974 792c 206d 6f63 6b5f 6465  utility, mock_de
+000090e0: 6c65 7465 2c0a 2020 2020 2020 2020 2020  lete,.          
+000090f0: 2020 6d6f 636b 5f63 6572 745f 7061 7468    mock_cert_path
+00009100: 5f74 6f5f 6c69 6e65 6167 652c 206d 6f63  _to_lineage, moc
+00009110: 6b5f 6675 6c6c 5f61 7263 6869 7665 5f64  k_full_archive_d
+00009120: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+00009130: 6d6f 636b 5f6d 6174 6368 5f61 6e64 5f63  mock_match_and_c
+00009140: 6865 636b 5f6f 7665 726c 6170 732c 206d  heck_overlaps, m
+00009150: 6f63 6b5f 7265 6e65 7761 6c5f 6669 6c65  ock_renewal_file
+00009160: 5f66 6f72 5f63 6572 746e 616d 6529 3a0a  _for_certname):.
+00009170: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
+00009180: 2073 656c 662e 636f 6e66 6967 0a20 2020   self.config.   
+00009190: 2020 2020 2063 6f6e 6669 672e 6e61 6d65       config.name
+000091a0: 7370 6163 652e 6465 6c65 7465 5f61 6674  space.delete_aft
+000091b0: 6572 5f72 6576 6f6b 6520 3d20 5472 7565  er_revoke = True
+000091c0: 0a20 2020 2020 2020 2063 6f6e 6669 672e  .        config.
+000091d0: 6365 7274 5f70 6174 6820 3d20 222f 736f  cert_path = "/so
+000091e0: 6d65 2f72 6561 736f 6e61 626c 652f 7061  me/reasonable/pa
+000091f0: 7468 220a 2020 2020 2020 2020 636f 6e66  th".        conf
+00009200: 6967 2e63 6572 746e 616d 6520 3d20 2222  ig.certname = ""
+00009210: 0a20 2020 2020 2020 206d 6f63 6b5f 6365  .        mock_ce
+00009220: 7274 5f70 6174 685f 746f 5f6c 696e 6561  rt_path_to_linea
+00009230: 6765 2e72 6574 7572 6e5f 7661 6c75 6520  ge.return_value 
+00009240: 3d20 2265 7861 6d70 6c65 2e63 6f6d 220a  = "example.com".
+00009250: 2020 2020 2020 2020 6d6f 636b 5f66 756c          mock_ful
+00009260: 6c5f 6172 6368 6976 655f 6469 722e 7265  l_archive_dir.re
+00009270: 7475 726e 5f76 616c 7565 203d 2022 220a  turn_value = "".
+00009280: 2020 2020 2020 2020 6d6f 636b 5f6d 6174          mock_mat
+00009290: 6368 5f61 6e64 5f63 6865 636b 5f6f 7665  ch_and_check_ove
+000092a0: 726c 6170 732e 7265 7475 726e 5f76 616c  rlaps.return_val
+000092b0: 7565 203d 2022 220a 2020 2020 2020 2020  ue = "".        
+000092c0: 7365 6c66 2e5f 6361 6c6c 2863 6f6e 6669  self._call(confi
+000092d0: 6729 0a20 2020 2020 2020 2061 7373 6572  g).        asser
+000092e0: 7420 6d6f 636b 5f64 656c 6574 652e 6361  t mock_delete.ca
+000092f0: 6c6c 5f63 6f75 6e74 203d 3d20 310a 2020  ll_count == 1.  
+00009300: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
+00009310: 206d 6f63 6b5f 6765 745f 7574 696c 6974   mock_get_utilit
+00009320: 7928 292e 7965 736e 6f2e 6361 6c6c 6564  y().yesno.called
+00009330: 0a0a 0a63 6c61 7373 2044 6574 6572 6d69  ...class Determi
+00009340: 6e65 4163 636f 756e 7454 6573 7428 7465  neAccountTest(te
+00009350: 7374 5f75 7469 6c2e 436f 6e66 6967 5465  st_util.ConfigTe
+00009360: 7374 4361 7365 293a 0a20 2020 2022 2222  stCase):.    """
+00009370: 5465 7374 7320 666f 7220 6365 7274 626f  Tests for certbo
+00009380: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00009390: 2e5f 6465 7465 726d 696e 655f 6163 636f  ._determine_acco
+000093a0: 756e 742e 2222 220a 0a20 2020 2064 6566  unt."""..    def
+000093b0: 2073 6574 5570 2873 656c 6629 3a0a 2020   setUp(self):.  
+000093c0: 2020 2020 2020 7375 7065 7228 292e 7365        super().se
+000093d0: 7455 7028 290a 2020 2020 2020 2020 7365  tUp().        se
+000093e0: 6c66 2e63 6f6e 6669 672e 6163 636f 756e  lf.config.accoun
+000093f0: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+00009400: 2073 656c 662e 636f 6e66 6967 2e65 6d61   self.config.ema
+00009410: 696c 203d 204e 6f6e 650a 2020 2020 2020  il = None.      
+00009420: 2020 7365 6c66 2e63 6f6e 6669 672e 7265    self.config.re
+00009430: 6769 7374 6572 5f75 6e73 6166 656c 795f  gister_unsafely_
+00009440: 7769 7468 6f75 745f 656d 6169 6c20 3d20  without_email = 
+00009450: 4661 6c73 650a 2020 2020 2020 2020 7365  False.        se
+00009460: 6c66 2e61 6363 7320 3d20 5b6d 6f63 6b2e  lf.accs = [mock.
+00009470: 4d61 6769 634d 6f63 6b28 6964 3d27 7827  MagicMock(id='x'
+00009480: 292c 206d 6f63 6b2e 4d61 6769 634d 6f63  ), mock.MagicMoc
+00009490: 6b28 6964 3d27 7927 295d 0a20 2020 2020  k(id='y')].     
+000094a0: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
+000094b0: 7374 6f72 6167 6520 3d20 6163 636f 756e  storage = accoun
+000094c0: 742e 4163 636f 756e 744d 656d 6f72 7953  t.AccountMemoryS
+000094d0: 746f 7261 6765 2829 0a20 2020 2020 2020  torage().       
+000094e0: 2023 2046 6f72 2075 7365 2069 6e20 7361   # For use in sa
+000094f0: 7669 6e67 2061 6363 6f75 6e74 733a 2066  ving accounts: f
+00009500: 616b 6520 6f75 7420 7468 6520 6e65 775f  ake out the new_
+00009510: 6175 7468 7a20 5552 4c2e 0a20 2020 2020  authz URL..     
+00009520: 2020 2073 656c 662e 6d6f 636b 5f63 6c69     self.mock_cli
+00009530: 656e 7420 3d20 6d6f 636b 2e4d 6167 6963  ent = mock.Magic
+00009540: 4d6f 636b 2829 0a20 2020 2020 2020 2073  Mock().        s
+00009550: 656c 662e 6d6f 636b 5f63 6c69 656e 742e  elf.mock_client.
+00009560: 6469 7265 6374 6f72 792e 6e65 775f 6175  directory.new_au
+00009570: 7468 7a20 3d20 2268 6922 0a0a 0a20 2020  thz = "hi"...   
+00009580: 2064 6566 205f 6361 6c6c 2873 656c 6629   def _call(self)
+00009590: 3a0a 2020 2020 2020 2020 2320 7079 6c69  :.        # pyli
+000095a0: 6e74 3a20 6469 7361 626c 653d 7072 6f74  nt: disable=prot
+000095b0: 6563 7465 642d 6163 6365 7373 0a20 2020  ected-access.   
+000095c0: 2020 2020 2066 726f 6d20 6365 7274 626f       from certbo
+000095d0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+000095e0: 2069 6d70 6f72 7420 5f64 6574 6572 6d69   import _determi
+000095f0: 6e65 5f61 6363 6f75 6e74 0a20 2020 2020  ne_account.     
+00009600: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
+00009610: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00009620: 6572 6e61 6c2e 6d61 696e 2e61 6363 6f75  ernal.main.accou
+00009630: 6e74 2e41 6363 6f75 6e74 4669 6c65 5374  nt.AccountFileSt
+00009640: 6f72 6167 6527 2920 6173 206d 6f63 6b5f  orage') as mock_
+00009650: 7374 6f72 6167 652c 205c 0a20 2020 2020  storage, \.     
+00009660: 2020 2020 2020 2020 7465 7374 5f75 7469          test_uti
+00009670: 6c2e 7061 7463 685f 6469 7370 6c61 795f  l.patch_display_
+00009680: 7574 696c 2829 3a0a 2020 2020 2020 2020  util():.        
+00009690: 2020 2020 6d6f 636b 5f73 746f 7261 6765      mock_storage
+000096a0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+000096b0: 7365 6c66 2e61 6363 6f75 6e74 5f73 746f  self.account_sto
+000096c0: 7261 6765 0a20 2020 2020 2020 2020 2020  rage.           
+000096d0: 2072 6574 7572 6e20 5f64 6574 6572 6d69   return _determi
+000096e0: 6e65 5f61 6363 6f75 6e74 2873 656c 662e  ne_account(self.
+000096f0: 636f 6e66 6967 290a 0a20 2020 2040 6d6f  config)..    @mo
+00009700: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00009710: 742e 5f69 6e74 6572 6e61 6c2e 636c 6965  t._internal.clie
+00009720: 6e74 2e72 6567 6973 7465 7227 290a 2020  nt.register').  
+00009730: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+00009740: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00009750: 2e63 6c69 656e 742e 6469 7370 6c61 795f  .client.display_
+00009760: 6f70 732e 6765 745f 656d 6169 6c27 290a  ops.get_email').
+00009770: 2020 2020 6465 6620 5f72 6567 6973 7465      def _registe
+00009780: 725f 6572 726f 725f 636f 6d6d 6f6e 2873  r_error_common(s
+00009790: 656c 662c 2065 7272 5f6d 7367 2c20 6578  elf, err_msg, ex
+000097a0: 6365 7074 696f 6e2c 206d 6f63 6b5f 6765  ception, mock_ge
+000097b0: 745f 656d 6169 6c2c 206d 6f63 6b5f 7265  t_email, mock_re
+000097c0: 6769 7374 6572 293a 0a20 2020 2020 2020  gister):.       
+000097d0: 206d 6f63 6b5f 6765 745f 656d 6169 6c2e   mock_get_email.
+000097e0: 7265 7475 726e 5f76 616c 7565 203d 2027  return_value = '
+000097f0: 666f 6f40 6261 722e 6261 7a27 0a20 2020  foo@bar.baz'.   
+00009800: 2020 2020 206d 6f63 6b5f 7265 6769 7374       mock_regist
+00009810: 6572 2e73 6964 655f 6566 6665 6374 203d  er.side_effect =
+00009820: 2065 7863 6570 7469 6f6e 0a20 2020 2020   exception.     
+00009830: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00009840: 2020 2020 7365 6c66 2e5f 6361 6c6c 2829      self._call()
+00009850: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00009860: 6572 726f 7273 2e45 7272 6f72 2061 7320  errors.Error as 
+00009870: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
+00009880: 2061 7373 6572 7420 6622 556e 6162 6c65   assert f"Unable
+00009890: 2074 6f20 7265 6769 7374 6572 2061 6e20   to register an 
+000098a0: 6163 636f 756e 7420 7769 7468 2041 434d  account with ACM
+000098b0: 4520 7365 7276 6572 2e20 7b65 7272 5f6d  E server. {err_m
+000098c0: 7367 7d22 203d 3d20 5c0a 2020 2020 2020  sg}" == \.      
+000098d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098e0: 2020 2020 2020 2073 7472 2865 7272 290a         str(err).
+000098f0: 0a20 2020 2064 6566 2074 6573 745f 6172  .    def test_ar
+00009900: 6773 5f61 6363 6f75 6e74 5f73 6574 2873  gs_account_set(s
+00009910: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+00009920: 6c66 2e61 6363 6f75 6e74 5f73 746f 7261  lf.account_stora
+00009930: 6765 2e73 6176 6528 7365 6c66 2e61 6363  ge.save(self.acc
+00009940: 735b 315d 2c20 7365 6c66 2e6d 6f63 6b5f  s[1], self.mock_
+00009950: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
+00009960: 7365 6c66 2e63 6f6e 6669 672e 6163 636f  self.config.acco
+00009970: 756e 7420 3d20 7365 6c66 2e61 6363 735b  unt = self.accs[
+00009980: 315d 2e69 640a 2020 2020 2020 2020 6173  1].id.        as
+00009990: 7365 7274 2028 7365 6c66 2e61 6363 735b  sert (self.accs[
+000099a0: 315d 2c20 4e6f 6e65 2920 3d3d 2073 656c  1], None) == sel
+000099b0: 662e 5f63 616c 6c28 290a 2020 2020 2020  f._call().      
+000099c0: 2020 6173 7365 7274 2073 656c 662e 6163    assert self.ac
+000099d0: 6373 5b31 5d2e 6964 203d 3d20 7365 6c66  cs[1].id == self
+000099e0: 2e63 6f6e 6669 672e 6163 636f 756e 740a  .config.account.
+000099f0: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
+00009a00: 656c 662e 636f 6e66 6967 2e65 6d61 696c  elf.config.email
+00009a10: 2069 7320 4e6f 6e65 0a0a 2020 2020 6465   is None..    de
+00009a20: 6620 7465 7374 5f73 696e 676c 655f 6163  f test_single_ac
+00009a30: 636f 756e 7428 7365 6c66 293a 0a20 2020  count(self):.   
+00009a40: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
+00009a50: 745f 7374 6f72 6167 652e 7361 7665 2873  t_storage.save(s
+00009a60: 656c 662e 6163 6373 5b30 5d2c 2073 656c  elf.accs[0], sel
+00009a70: 662e 6d6f 636b 5f63 6c69 656e 7429 0a20  f.mock_client). 
+00009a80: 2020 2020 2020 2061 7373 6572 7420 2873         assert (s
+00009a90: 656c 662e 6163 6373 5b30 5d2c 204e 6f6e  elf.accs[0], Non
+00009aa0: 6529 203d 3d20 7365 6c66 2e5f 6361 6c6c  e) == self._call
+00009ab0: 2829 0a20 2020 2020 2020 2061 7373 6572  ().        asser
+00009ac0: 7420 7365 6c66 2e61 6363 735b 305d 2e69  t self.accs[0].i
+00009ad0: 6420 3d3d 2073 656c 662e 636f 6e66 6967  d == self.config
+00009ae0: 2e61 6363 6f75 6e74 0a20 2020 2020 2020  .account.       
+00009af0: 2061 7373 6572 7420 7365 6c66 2e63 6f6e   assert self.con
+00009b00: 6669 672e 656d 6169 6c20 6973 204e 6f6e  fig.email is Non
+00009b10: 650a 0a20 2020 2040 6d6f 636b 2e70 6174  e..    @mock.pat
+00009b20: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00009b30: 6572 6e61 6c2e 636c 6965 6e74 2e64 6973  ernal.client.dis
+00009b40: 706c 6179 5f6f 7073 2e63 686f 6f73 655f  play_ops.choose_
+00009b50: 6163 636f 756e 7427 290a 2020 2020 6465  account').    de
+00009b60: 6620 7465 7374 5f6d 756c 7469 706c 655f  f test_multiple_
+00009b70: 6163 636f 756e 7473 2873 656c 662c 206d  accounts(self, m
+00009b80: 6f63 6b5f 6368 6f6f 7365 5f61 6363 6f75  ock_choose_accou
+00009b90: 6e74 7329 3a0a 2020 2020 2020 2020 666f  nts):.        fo
+00009ba0: 7220 6163 6320 696e 2073 656c 662e 6163  r acc in self.ac
+00009bb0: 6373 3a0a 2020 2020 2020 2020 2020 2020  cs:.            
+00009bc0: 7365 6c66 2e61 6363 6f75 6e74 5f73 746f  self.account_sto
+00009bd0: 7261 6765 2e73 6176 6528 6163 632c 2073  rage.save(acc, s
+00009be0: 656c 662e 6d6f 636b 5f63 6c69 656e 7429  elf.mock_client)
+00009bf0: 0a20 2020 2020 2020 206d 6f63 6b5f 6368  .        mock_ch
+00009c00: 6f6f 7365 5f61 6363 6f75 6e74 732e 7265  oose_accounts.re
+00009c10: 7475 726e 5f76 616c 7565 203d 2073 656c  turn_value = sel
+00009c20: 662e 6163 6373 5b31 5d0a 2020 2020 2020  f.accs[1].      
+00009c30: 2020 6173 7365 7274 2028 7365 6c66 2e61    assert (self.a
+00009c40: 6363 735b 315d 2c20 4e6f 6e65 2920 3d3d  ccs[1], None) ==
+00009c50: 2073 656c 662e 5f63 616c 6c28 290a 2020   self._call().  
+00009c60: 2020 2020 2020 6173 7365 7274 2073 6574        assert set
+00009c70: 286d 6f63 6b5f 6368 6f6f 7365 5f61 6363  (mock_choose_acc
+00009c80: 6f75 6e74 732e 6361 6c6c 5f61 7267 735b  ounts.call_args[
+00009c90: 305d 5b30 5d29 203d 3d20 7365 7428 7365  0][0]) == set(se
+00009ca0: 6c66 2e61 6363 7329 0a20 2020 2020 2020  lf.accs).       
+00009cb0: 2061 7373 6572 7420 7365 6c66 2e61 6363   assert self.acc
+00009cc0: 735b 315d 2e69 6420 3d3d 2073 656c 662e  s[1].id == self.
+00009cd0: 636f 6e66 6967 2e61 6363 6f75 6e74 0a20  config.account. 
+00009ce0: 2020 2020 2020 2061 7373 6572 7420 7365         assert se
+00009cf0: 6c66 2e63 6f6e 6669 672e 656d 6169 6c20  lf.config.email 
+00009d00: 6973 204e 6f6e 650a 0a20 2020 2040 6d6f  is None..    @mo
+00009d10: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00009d20: 742e 5f69 6e74 6572 6e61 6c2e 636c 6965  t._internal.clie
+00009d30: 6e74 2e64 6973 706c 6179 5f6f 7073 2e63  nt.display_ops.c
+00009d40: 686f 6f73 655f 6163 636f 756e 7427 290a  hoose_account').
+00009d50: 2020 2020 6465 6620 7465 7374 5f6d 756c      def test_mul
+00009d60: 7469 706c 655f 6163 636f 756e 7473 5f63  tiple_accounts_c
+00009d70: 616e 6365 6c65 6428 7365 6c66 2c20 6d6f  anceled(self, mo
+00009d80: 636b 5f63 686f 6f73 655f 6163 636f 756e  ck_choose_accoun
+00009d90: 7473 293a 0a20 2020 2020 2020 2066 6f72  ts):.        for
+00009da0: 2061 6363 2069 6e20 7365 6c66 2e61 6363   acc in self.acc
+00009db0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+00009dc0: 656c 662e 6163 636f 756e 745f 7374 6f72  elf.account_stor
+00009dd0: 6167 652e 7361 7665 2861 6363 2c20 7365  age.save(acc, se
+00009de0: 6c66 2e6d 6f63 6b5f 636c 6965 6e74 290a  lf.mock_client).
+00009df0: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
+00009e00: 6f73 655f 6163 636f 756e 7473 2e72 6574  ose_accounts.ret
+00009e10: 7572 6e5f 7661 6c75 6520 3d20 4e6f 6e65  urn_value = None
+00009e20: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00009e30: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009e40: 6361 6c6c 2829 0a20 2020 2020 2020 2065  call().        e
+00009e50: 7863 6570 7420 6572 726f 7273 2e45 7272  xcept errors.Err
+00009e60: 6f72 2061 7320 6572 723a 0a20 2020 2020  or as err:.     
+00009e70: 2020 2020 2020 2061 7373 6572 7420 224e         assert "N
+00009e80: 6f20 6163 636f 756e 7420 6861 7320 6265  o account has be
+00009e90: 656e 2063 686f 7365 6e22 2069 6e20 7374  en chosen" in st
+00009ea0: 7228 6572 7229 0a0a 2020 2020 406d 6f63  r(err)..    @moc
+00009eb0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+00009ec0: 2e5f 696e 7465 726e 616c 2e63 6c69 656e  ._internal.clien
+00009ed0: 742e 6469 7370 6c61 795f 6f70 732e 6765  t.display_ops.ge
+00009ee0: 745f 656d 6169 6c27 290a 2020 2020 406d  t_email').    @m
+00009ef0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00009f00: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+00009f10: 6e2e 6469 7370 6c61 795f 7574 696c 2e6e  n.display_util.n
+00009f20: 6f74 6966 7927 290a 2020 2020 6465 6620  otify').    def 
+00009f30: 7465 7374 5f6e 6f5f 6163 636f 756e 7473  test_no_accounts
+00009f40: 5f6e 6f5f 656d 6169 6c28 7365 6c66 2c20  _no_email(self, 
+00009f50: 6d6f 636b 5f6e 6f74 6966 792c 206d 6f63  mock_notify, moc
+00009f60: 6b5f 6765 745f 656d 6169 6c29 3a0a 2020  k_get_email):.  
+00009f70: 2020 2020 2020 6d6f 636b 5f67 6574 5f65        mock_get_e
+00009f80: 6d61 696c 2e72 6574 7572 6e5f 7661 6c75  mail.return_valu
+00009f90: 6520 3d20 2766 6f6f 4062 6172 2e62 617a  e = 'foo@bar.baz
+00009fa0: 270a 0a20 2020 2020 2020 2077 6974 6820  '..        with 
+00009fb0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00009fc0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+00009fd0: 696e 2e63 6c69 656e 7427 2920 6173 2063  in.client') as c
+00009fe0: 6c69 656e 743a 0a20 2020 2020 2020 2020  lient:.         
+00009ff0: 2020 2063 6c69 656e 742e 7265 6769 7374     client.regist
+0000a000: 6572 2e72 6574 7572 6e5f 7661 6c75 6520  er.return_value 
+0000a010: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000a020: 2020 2020 7365 6c66 2e61 6363 735b 305d      self.accs[0]
+0000a030: 2c20 6d6f 636b 2e73 656e 7469 6e65 6c2e  , mock.sentinel.
+0000a040: 6163 6d65 290a 2020 2020 2020 2020 2020  acme).          
+0000a050: 2020 6173 7365 7274 2028 7365 6c66 2e61    assert (self.a
+0000a060: 6363 735b 305d 2c20 6d6f 636b 2e73 656e  ccs[0], mock.sen
+0000a070: 7469 6e65 6c2e 6163 6d65 2920 3d3d 2073  tinel.acme) == s
+0000a080: 656c 662e 5f63 616c 6c28 290a 2020 2020  elf._call().    
+0000a090: 2020 2020 636c 6965 6e74 2e72 6567 6973      client.regis
+0000a0a0: 7465 722e 6173 7365 7274 5f63 616c 6c65  ter.assert_calle
+0000a0b0: 645f 6f6e 6365 5f77 6974 6828 0a20 2020  d_once_with(.   
+0000a0c0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+0000a0d0: 6e66 6967 2c20 7365 6c66 2e61 6363 6f75  nfig, self.accou
+0000a0e0: 6e74 5f73 746f 7261 6765 2c20 746f 735f  nt_storage, tos_
+0000a0f0: 6362 3d6d 6f63 6b2e 414e 5929 0a0a 2020  cb=mock.ANY)..  
+0000a100: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
+0000a110: 662e 6163 6373 5b30 5d2e 6964 203d 3d20  f.accs[0].id == 
+0000a120: 7365 6c66 2e63 6f6e 6669 672e 6163 636f  self.config.acco
+0000a130: 756e 740a 2020 2020 2020 2020 6173 7365  unt.        asse
+0000a140: 7274 2027 666f 6f40 6261 722e 6261 7a27  rt 'foo@bar.baz'
+0000a150: 203d 3d20 7365 6c66 2e63 6f6e 6669 672e   == self.config.
+0000a160: 656d 6169 6c0a 2020 2020 2020 2020 6d6f  email.        mo
+0000a170: 636b 5f6e 6f74 6966 792e 6173 7365 7274  ck_notify.assert
+0000a180: 5f63 616c 6c65 645f 6f6e 6365 5f77 6974  _called_once_wit
+0000a190: 6828 2741 6363 6f75 6e74 2072 6567 6973  h('Account regis
+0000a1a0: 7465 7265 642e 2729 0a0a 2020 2020 6465  tered.')..    de
+0000a1b0: 6620 7465 7374 5f6e 6f5f 6163 636f 756e  f test_no_accoun
+0000a1c0: 7473 5f65 6d61 696c 2873 656c 6629 3a0a  ts_email(self):.
+0000a1d0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+0000a1e0: 6669 672e 656d 6169 6c20 3d20 276f 7468  fig.email = 'oth
+0000a1f0: 6572 2065 6d61 696c 270a 2020 2020 2020  er email'.      
+0000a200: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+0000a210: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+0000a220: 726e 616c 2e6d 6169 6e2e 636c 6965 6e74  rnal.main.client
+0000a230: 2729 2061 7320 636c 6965 6e74 3a0a 2020  ') as client:.  
+0000a240: 2020 2020 2020 2020 2020 636c 6965 6e74            client
+0000a250: 2e72 6567 6973 7465 722e 7265 7475 726e  .register.return
+0000a260: 5f76 616c 7565 203d 2028 7365 6c66 2e61  _value = (self.a
+0000a270: 6363 735b 315d 2c20 6d6f 636b 2e73 656e  ccs[1], mock.sen
+0000a280: 7469 6e65 6c2e 6163 6d65 290a 2020 2020  tinel.acme).    
+0000a290: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+0000a2a0: 6c6c 2829 0a20 2020 2020 2020 2061 7373  ll().        ass
+0000a2b0: 6572 7420 7365 6c66 2e61 6363 735b 315d  ert self.accs[1]
+0000a2c0: 2e69 6420 3d3d 2073 656c 662e 636f 6e66  .id == self.conf
+0000a2d0: 6967 2e61 6363 6f75 6e74 0a20 2020 2020  ig.account.     
+0000a2e0: 2020 2061 7373 6572 7420 276f 7468 6572     assert 'other
+0000a2f0: 2065 6d61 696c 2720 3d3d 2073 656c 662e   email' == self.
+0000a300: 636f 6e66 6967 2e65 6d61 696c 0a0a 2020  config.email..  
+0000a310: 2020 6465 6620 7465 7374 5f72 6567 6973    def test_regis
+0000a320: 7465 725f 6572 726f 725f 6365 7274 626f  ter_error_certbo
+0000a330: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+0000a340: 2065 7272 5f6d 7367 203d 2022 536f 6d65   err_msg = "Some
+0000a350: 2065 7272 6f72 206d 6573 7361 6765 2072   error message r
+0000a360: 6169 7365 6420 6279 2043 6572 7462 6f74  aised by Certbot
+0000a370: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
+0000a380: 7265 6769 7374 6572 5f65 7272 6f72 5f63  register_error_c
+0000a390: 6f6d 6d6f 6e28 6572 725f 6d73 672c 2065  ommon(err_msg, e
+0000a3a0: 7272 6f72 732e 4572 726f 7228 6572 725f  rrors.Error(err_
+0000a3b0: 6d73 6729 290a 0a20 2020 2064 6566 2074  msg))..    def t
+0000a3c0: 6573 745f 7265 6769 7374 6572 5f65 7272  est_register_err
+0000a3d0: 6f72 5f61 636d 655f 7479 7065 5f61 6e64  or_acme_type_and
+0000a3e0: 5f64 6574 6169 6c28 7365 6c66 293a 0a20  _detail(self):. 
+0000a3f0: 2020 2020 2020 2065 7272 5f6d 7367 203d         err_msg =
+0000a400: 2028 2245 7272 6f72 2072 6574 7572 6e65   ("Error returne
+0000a410: 6420 6279 2074 6865 2041 434d 4520 7365  d by the ACME se
+0000a420: 7276 6572 3a20 6d75 7374 2061 6772 6565  rver: must agree
+0000a430: 2074 6f20 7465 726d 7320 6f66 2073 6572   to terms of ser
+0000a440: 7669 6365 2229 0a20 2020 2020 2020 2065  vice").        e
+0000a450: 7863 6570 7469 6f6e 203d 2061 636d 655f  xception = acme_
+0000a460: 6572 726f 7228 7479 7020 3d20 2275 726e  error(typ = "urn
+0000a470: 3a69 6574 663a 7061 7261 6d73 3a61 636d  :ietf:params:acm
+0000a480: 653a 6572 726f 723a 6d61 6c66 6f72 6d65  e:error:malforme
+0000a490: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 2020 2064 6574 6169 6c20 3d20 226d 7573     detail = "mus
+0000a4c0: 7420 6167 7265 6520 746f 2074 6572 6d73  t agree to terms
+0000a4d0: 206f 6620 7365 7276 6963 6522 290a 2020   of service").  
+0000a4e0: 2020 2020 2020 7365 6c66 2e5f 7265 6769        self._regi
+0000a4f0: 7374 6572 5f65 7272 6f72 5f63 6f6d 6d6f  ster_error_commo
+0000a500: 6e28 6572 725f 6d73 672c 2065 7863 6570  n(err_msg, excep
+0000a510: 7469 6f6e 290a 0a20 2020 2064 6566 2074  tion)..    def t
+0000a520: 6573 745f 7265 6769 7374 6572 5f65 7272  est_register_err
+0000a530: 6f72 5f61 636d 655f 7479 7065 5f6f 6e6c  or_acme_type_onl
+0000a540: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
+0000a550: 2065 7272 5f6d 7367 203d 2028 2245 7272   err_msg = ("Err
+0000a560: 6f72 2072 6574 7572 6e65 6420 6279 2074  or returned by t
+0000a570: 6865 2041 434d 4520 7365 7276 6572 3a20  he ACME server: 
+0000a580: 5468 6520 7365 7276 6572 2065 7870 6572  The server exper
+0000a590: 6965 6e63 6564 2061 6e20 696e 7465 726e  ienced an intern
+0000a5a0: 616c 2065 7272 6f72 2229 0a20 2020 2020  al error").     
+0000a5b0: 2020 2065 7863 6570 7469 6f6e 203d 2061     exception = a
+0000a5c0: 636d 655f 6572 726f 7228 7479 7020 3d20  cme_error(typ = 
+0000a5d0: 2275 726e 3a69 6574 663a 7061 7261 6d73  "urn:ietf:params
+0000a5e0: 3a61 636d 653a 6572 726f 723a 7365 7276  :acme:error:serv
+0000a5f0: 6572 496e 7465 726e 616c 2229 0a20 2020  erInternal").   
+0000a600: 2020 2020 2073 656c 662e 5f72 6567 6973       self._regis
+0000a610: 7465 725f 6572 726f 725f 636f 6d6d 6f6e  ter_error_common
+0000a620: 2865 7272 5f6d 7367 2c20 6578 6365 7074  (err_msg, except
+0000a630: 696f 6e29 0a0a 0a63 6c61 7373 204d 6169  ion)...class Mai
+0000a640: 6e54 6573 7428 7465 7374 5f75 7469 6c2e  nTest(test_util.
+0000a650: 436f 6e66 6967 5465 7374 4361 7365 293a  ConfigTestCase):
+0000a660: 0a20 2020 2022 2222 5465 7374 7320 666f  .    """Tests fo
+0000a670: 7220 6469 6666 6572 656e 7420 636f 6d6d  r different comm
+0000a680: 616e 6473 2e22 2222 0a0a 2020 2020 6465  ands."""..    de
+0000a690: 6620 7365 7455 7028 7365 6c66 293a 0a20  f setUp(self):. 
+0000a6a0: 2020 2020 2020 2073 7570 6572 2829 2e73         super().s
+0000a6b0: 6574 5570 2829 0a0a 2020 2020 2020 2020  etUp()..        
+0000a6c0: 6669 6c65 7379 7374 656d 2e6d 6b64 6972  filesystem.mkdir
+0000a6d0: 2873 656c 662e 636f 6e66 6967 2e6c 6f67  (self.config.log
+0000a6e0: 735f 6469 7229 0a20 2020 2020 2020 2073  s_dir).        s
+0000a6f0: 656c 662e 7374 616e 6461 7264 5f61 7267  elf.standard_arg
+0000a700: 7320 3d20 5b27 2d2d 636f 6e66 6967 2d64  s = ['--config-d
+0000a710: 6972 272c 2073 656c 662e 636f 6e66 6967  ir', self.config
+0000a720: 2e63 6f6e 6669 675f 6469 722c 0a20 2020  .config_dir,.   
+0000a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a740: 2020 2020 2020 2020 2020 2027 2d2d 776f             '--wo
+0000a750: 726b 2d64 6972 272c 2073 656c 662e 636f  rk-dir', self.co
+0000a760: 6e66 6967 2e77 6f72 6b5f 6469 722c 0a20  nfig.work_dir,. 
+0000a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a780: 2020 2020 2020 2020 2020 2020 2027 2d2d               '--
+0000a790: 6c6f 6773 2d64 6972 272c 2073 656c 662e  logs-dir', self.
+0000a7a0: 636f 6e66 6967 2e6c 6f67 735f 6469 722c  config.logs_dir,
+0000a7b0: 2027 2d2d 7465 7874 275d 0a0a 2020 2020   '--text']..    
+0000a7c0: 2020 2020 7365 6c66 2e6d 6f63 6b5f 736c      self.mock_sl
+0000a7d0: 6565 7020 3d20 6d6f 636b 2e70 6174 6368  eep = mock.patch
+0000a7e0: 2827 7469 6d65 2e73 6c65 6570 2729 2e73  ('time.sleep').s
+0000a7f0: 7461 7274 2829 0a0a 2020 2020 6465 6620  tart()..    def 
+0000a800: 7465 6172 446f 776e 2873 656c 6629 3a0a  tearDown(self):.
+0000a810: 2020 2020 2020 2020 2320 5265 7365 7420          # Reset 
+0000a820: 676c 6f62 616c 7320 696e 2063 6c69 0a20  globals in cli. 
+0000a830: 2020 2020 2020 2072 656c 6f61 645f 6d6f         reload_mo
+0000a840: 6475 6c65 2863 6c69 290a 0a20 2020 2020  dule(cli)..     
+0000a850: 2020 2073 7570 6572 2829 2e74 6561 7244     super().tearD
+0000a860: 6f77 6e28 290a 0a20 2020 2064 6566 205f  own()..    def _
+0000a870: 6361 6c6c 2873 656c 662c 2061 7267 732c  call(self, args,
+0000a880: 2073 7464 6f75 743d 4e6f 6e65 2c20 6d6f   stdout=None, mo
+0000a890: 636b 6973 6669 6c65 3d46 616c 7365 293a  ckisfile=False):
+0000a8a0: 0a20 2020 2020 2020 2022 2222 5275 6e20  .        """Run 
+0000a8b0: 7468 6520 636c 6920 7769 7468 206f 7574  the cli with out
+0000a8c0: 7075 7420 7374 7265 616d 732c 2061 6374  put streams, act
+0000a8d0: 7561 6c20 636c 6965 6e74 2061 6e64 206f  ual client and o
+0000a8e0: 7074 696f 6e61 6c6c 790a 2020 2020 2020  ptionally.      
+0000a8f0: 2020 6f73 2e70 6174 682e 6973 6669 6c65    os.path.isfile
+0000a900: 2829 206d 6f63 6b65 6420 6f75 7422 2222  () mocked out"""
+0000a910: 0a0a 2020 2020 2020 2020 6966 206d 6f63  ..        if moc
+0000a920: 6b69 7366 696c 653a 0a20 2020 2020 2020  kisfile:.       
+0000a930: 2020 2020 206f 7269 675f 6f70 656e 203d       orig_open =
+0000a940: 206f 732e 7061 7468 2e69 7366 696c 650a   os.path.isfile.
+0000a950: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+0000a960: 206d 6f63 6b5f 6973 6669 6c65 2866 6e2c   mock_isfile(fn,
+0000a970: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+0000a980: 293a 2020 2320 7079 6c69 6e74 3a20 6469  ):  # pylint: di
+0000a990: 7361 626c 653d 756e 7573 6564 2d61 7267  sable=unused-arg
+0000a9a0: 756d 656e 740a 2020 2020 2020 2020 2020  ument.          
+0000a9b0: 2020 2020 2020 2222 224d 6f63 6b20 6f73        """Mock os
+0000a9c0: 2e70 6174 682e 6973 6669 6c65 2829 2222  .path.isfile()""
+0000a9d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000a9e0: 2020 6966 2028 666e 2e65 6e64 7377 6974    if (fn.endswit
+0000a9f0: 6828 2263 6572 7422 2920 6f72 0a20 2020  h("cert") or.   
+0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa10: 2020 2020 2066 6e2e 656e 6473 7769 7468       fn.endswith
+0000aa20: 2822 6368 6169 6e22 2920 6f72 0a20 2020  ("chain") or.   
+0000aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa40: 2020 2020 2066 6e2e 656e 6473 7769 7468       fn.endswith
+0000aa50: 2822 7072 6976 6b65 7922 2929 3a0a 2020  ("privkey")):.  
+0000aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa70: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000aa80: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000aa90: 7475 726e 206f 7269 675f 6f70 656e 2866  turn orig_open(f
+0000aaa0: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
+0000aab0: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+0000aac0: 2263 6572 7462 6f74 2e63 6f6d 7061 742e  "certbot.compat.
+0000aad0: 6f73 2e70 6174 682e 6973 6669 6c65 2229  os.path.isfile")
+0000aae0: 2061 7320 6d6f 636b 5f69 663a 0a20 2020   as mock_if:.   
+0000aaf0: 2020 2020 2020 2020 2020 2020 206d 6f63               moc
+0000ab00: 6b5f 6966 2e73 6964 655f 6566 6665 6374  k_if.side_effect
+0000ab10: 203d 206d 6f63 6b5f 6973 6669 6c65 0a20   = mock_isfile. 
+0000ab20: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000ab30: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+0000ab40: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0000ab50: 6c2e 6d61 696e 2e63 6c69 656e 7427 2920  l.main.client') 
+0000ab60: 6173 2063 6c69 656e 743a 0a20 2020 2020  as client:.     
+0000ab70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ab80: 6574 2c20 7374 646f 7574 2c20 7374 6465  et, stdout, stde
+0000ab90: 7272 203d 2073 656c 662e 5f63 616c 6c5f  rr = self._call_
+0000aba0: 6e6f 5f63 6c69 656e 746d 6f63 6b28 6172  no_clientmock(ar
+0000abb0: 6773 2c20 7374 646f 7574 290a 2020 2020  gs, stdout).    
+0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abd0: 7265 7475 726e 2072 6574 2c20 7374 646f  return ret, stdo
+0000abe0: 7574 2c20 7374 6465 7272 2c20 636c 6965  ut, stderr, clie
+0000abf0: 6e74 0a20 2020 2020 2020 2065 6c73 653a  nt.        else:
+0000ac00: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000ac10: 6820 6d6f 636b 2e70 6174 6368 2827 6365  h mock.patch('ce
+0000ac20: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+0000ac30: 6d61 696e 2e63 6c69 656e 7427 2920 6173  main.client') as
+0000ac40: 2063 6c69 656e 743a 0a20 2020 2020 2020   client:.       
+0000ac50: 2020 2020 2020 2020 2072 6574 2c20 7374           ret, st
+0000ac60: 646f 7574 2c20 7374 6465 7272 203d 2073  dout, stderr = s
+0000ac70: 656c 662e 5f63 616c 6c5f 6e6f 5f63 6c69  elf._call_no_cli
+0000ac80: 656e 746d 6f63 6b28 6172 6773 2c20 7374  entmock(args, st
+0000ac90: 646f 7574 290a 2020 2020 2020 2020 2020  dout).          
+0000aca0: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
+0000acb0: 2c20 7374 646f 7574 2c20 7374 6465 7272  , stdout, stderr
+0000acc0: 2c20 636c 6965 6e74 0a0a 2020 2020 6465  , client..    de
+0000acd0: 6620 5f63 616c 6c5f 6e6f 5f63 6c69 656e  f _call_no_clien
+0000ace0: 746d 6f63 6b28 7365 6c66 2c20 6172 6773  tmock(self, args
+0000acf0: 2c20 7374 646f 7574 3d4e 6f6e 6529 3a0a  , stdout=None):.
+0000ad00: 2020 2020 2020 2020 2222 2252 756e 2074          """Run t
+0000ad10: 6865 2063 6c69 656e 7420 7769 7468 206f  he client with o
+0000ad20: 7574 7075 7420 7374 7265 616d 7320 6d6f  utput streams mo
+0000ad30: 636b 6564 206f 7574 2222 220a 2020 2020  cked out""".    
+0000ad40: 2020 2020 6172 6773 203d 2073 656c 662e      args = self.
+0000ad50: 7374 616e 6461 7264 5f61 7267 7320 2b20  standard_args + 
+0000ad60: 6172 6773 0a0a 2020 2020 2020 2020 746f  args..        to
+0000ad70: 795f 7374 646f 7574 203d 2073 7464 6f75  y_stdout = stdou
+0000ad80: 7420 6966 2073 7464 6f75 7420 656c 7365  t if stdout else
+0000ad90: 2069 6f2e 5374 7269 6e67 494f 2829 0a20   io.StringIO(). 
+0000ada0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
+0000adb0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+0000adc0: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e73  _internal.main.s
+0000add0: 7973 2e73 7464 6f75 7427 2c20 6e65 773d  ys.stdout', new=
+0000ade0: 746f 795f 7374 646f 7574 293a 0a20 2020  toy_stdout):.   
+0000adf0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+0000ae00: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+0000ae10: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+0000ae20: 2e73 7973 2e73 7464 6572 7227 2920 6173  .sys.stderr') as
+0000ae30: 2073 7464 6572 723a 0a20 2020 2020 2020   stderr:.       
+0000ae40: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+0000ae50: 636b 2e70 6174 6368 2822 6365 7274 626f  ck.patch("certbo
+0000ae60: 742e 7574 696c 2e61 7465 7869 7422 293a  t.util.atexit"):
+0000ae70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ae80: 2020 2020 2072 6574 203d 206d 6169 6e2e       ret = main.
+0000ae90: 6d61 696e 2861 7267 735b 3a5d 2920 2023  main(args[:])  #
+0000aea0: 204e 4f54 453a 2070 6172 7365 7220 6361   NOTE: parser ca
+0000aeb0: 6e20 616c 7465 7220 6974 7320 6172 6773  n alter its args
+0000aec0: 210a 2020 2020 2020 2020 7265 7475 726e  !.        return
+0000aed0: 2072 6574 2c20 746f 795f 7374 646f 7574   ret, toy_stdout
+0000aee0: 2c20 7374 6465 7272 0a0a 2020 2020 6465  , stderr..    de
+0000aef0: 6620 7465 7374 5f6e 6f5f 666c 6167 7328  f test_no_flags(
+0000af00: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
+0000af10: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+0000af20: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0000af30: 6c2e 6d61 696e 2e72 756e 2729 2061 7320  l.main.run') as 
+0000af40: 6d6f 636b 5f72 756e 3a0a 2020 2020 2020  mock_run:.      
+0000af50: 2020 2020 2020 7365 6c66 2e5f 6361 6c6c        self._call
+0000af60: 285b 5d29 0a20 2020 2020 2020 2020 2020  ([]).           
+0000af70: 2061 7373 6572 7420 3120 3d3d 206d 6f63   assert 1 == moc
+0000af80: 6b5f 7275 6e2e 6361 6c6c 5f63 6f75 6e74  k_run.call_count
+0000af90: 0a0a 2020 2020 6465 6620 7465 7374 5f76  ..    def test_v
+0000afa0: 6572 7369 6f6e 5f73 7472 696e 675f 7072  ersion_string_pr
+0000afb0: 6f67 7261 6d5f 6e61 6d65 2873 656c 6629  ogram_name(self)
+0000afc0: 3a0a 2020 2020 2020 2020 746f 795f 6f75  :.        toy_ou
+0000afd0: 7420 3d20 696f 2e53 7472 696e 6749 4f28  t = io.StringIO(
+0000afe0: 290a 2020 2020 2020 2020 746f 795f 6572  ).        toy_er
+0000aff0: 7220 3d20 696f 2e53 7472 696e 6749 4f28  r = io.StringIO(
+0000b000: 290a 2020 2020 2020 2020 7769 7468 206d  ).        with m
+0000b010: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+0000b020: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+0000b030: 6e2e 7379 732e 7374 646f 7574 272c 206e  n.sys.stdout', n
+0000b040: 6577 3d74 6f79 5f6f 7574 293a 0a20 2020  ew=toy_out):.   
+0000b050: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+0000b060: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+0000b070: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+0000b080: 2e73 7973 2e73 7464 6572 7227 2c20 6e65  .sys.stderr', ne
+0000b090: 773d 746f 795f 6572 7229 3a0a 2020 2020  w=toy_err):.    
+0000b0a0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b0c0: 2020 2020 206d 6169 6e2e 6d61 696e 285b       main.main([
+0000b0d0: 222d 2d76 6572 7369 6f6e 225d 290a 2020  "--version"]).  
+0000b0e0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000b0f0: 6365 7074 2053 7973 7465 6d45 7869 743a  cept SystemExit:
+0000b100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b110: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0000b120: 2020 2020 2020 2020 2020 6669 6e61 6c6c            finall
+0000b130: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000b140: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+0000b150: 746f 795f 6f75 742e 6765 7476 616c 7565  toy_out.getvalue
+0000b160: 2829 206f 7220 746f 795f 6572 722e 6765  () or toy_err.ge
+0000b170: 7476 616c 7565 2829 0a20 2020 2020 2020  tvalue().       
+0000b180: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0000b190: 6572 7420 2263 6572 7462 6f74 2220 696e  ert "certbot" in
+0000b1a0: 206f 7574 7075 742c 2022 4f75 7470 7574   output, "Output
+0000b1b0: 2069 7320 7b30 7d22 2e66 6f72 6d61 7428   is {0}".format(
+0000b1c0: 6f75 7470 7574 290a 0a20 2020 2064 6566  output)..    def
+0000b1d0: 205f 636c 695f 6d69 7373 696e 675f 666c   _cli_missing_fl
+0000b1e0: 6167 2873 656c 662c 2061 7267 732c 206d  ag(self, args, m
+0000b1f0: 6573 7361 6765 293a 0a20 2020 2020 2020  essage):.       
+0000b200: 2022 456e 7375 7265 2074 6861 7420 6120   "Ensure that a 
+0000b210: 7061 7274 6963 756c 6172 2065 7272 6f72  particular error
+0000b220: 2072 6169 7365 7320 6120 6d69 7373 696e   raises a missin
+0000b230: 6720 636c 6920 666c 6167 2065 7272 6f72  g cli flag error
+0000b240: 2063 6f6e 7461 696e 696e 6720 6d65 7373   containing mess
+0000b250: 6167 6522 0a20 2020 2020 2020 2065 7863  age".        exc
+0000b260: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000b270: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000b280: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+0000b290: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+0000b2a0: 6e61 6c2e 6d61 696e 2e73 7973 2e73 7464  nal.main.sys.std
+0000b2b0: 6572 7227 293a 0a20 2020 2020 2020 2020  err'):.         
+0000b2c0: 2020 2020 2020 206d 6169 6e2e 6d61 696e         main.main
+0000b2d0: 2873 656c 662e 7374 616e 6461 7264 5f61  (self.standard_a
+0000b2e0: 7267 7320 2b20 6172 6773 5b3a 5d29 2020  rgs + args[:])  
+0000b2f0: 2320 4e4f 5445 3a20 7061 7273 6572 2063  # NOTE: parser c
+0000b300: 616e 2061 6c74 6572 2069 7473 2061 7267  an alter its arg
+0000b310: 7321 0a20 2020 2020 2020 2065 7863 6570  s!.        excep
+0000b320: 7420 6572 726f 7273 2e4d 6973 7369 6e67  t errors.Missing
+0000b330: 436f 6d6d 616e 646c 696e 6546 6c61 6720  CommandlineFlag 
+0000b340: 6173 2065 7863 5f3a 0a20 2020 2020 2020  as exc_:.       
+0000b350: 2020 2020 2065 7863 203d 2065 7863 5f0a       exc = exc_.
+0000b360: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000b370: 7274 206d 6573 7361 6765 2069 6e20 7374  rt message in st
+0000b380: 7228 6578 6329 0a20 2020 2020 2020 2061  r(exc).        a
+0000b390: 7373 6572 7420 6578 6320 6973 206e 6f74  ssert exc is not
+0000b3a0: 204e 6f6e 650a 0a20 2020 2040 6d6f 636b   None..    @mock
+0000b3b0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+0000b3c0: 5f69 6e74 6572 6e61 6c2e 6c6f 672e 706f  _internal.log.po
+0000b3d0: 7374 5f61 7267 5f70 6172 7365 5f73 6574  st_arg_parse_set
+0000b3e0: 7570 2729 0a20 2020 2064 6566 2074 6573  up').    def tes
+0000b3f0: 745f 6e6f 6e69 6e74 6572 6163 7469 7665  t_noninteractive
+0000b400: 2873 656c 662c 205f 293a 0a20 2020 2020  (self, _):.     
+0000b410: 2020 2061 7267 7320 3d20 5b27 2d6e 272c     args = ['-n',
+0000b420: 2027 6365 7274 6f6e 6c79 275d 0a20 2020   'certonly'].   
+0000b430: 2020 2020 2073 656c 662e 5f63 6c69 5f6d       self._cli_m
+0000b440: 6973 7369 6e67 5f66 6c61 6728 6172 6773  issing_flag(args
+0000b450: 2c20 2273 7065 6369 6679 2061 2070 6c75  , "specify a plu
+0000b460: 6769 6e22 290a 2020 2020 2020 2020 6172  gin").        ar
+0000b470: 6773 2e65 7874 656e 6428 5b27 2d2d 7374  gs.extend(['--st
+0000b480: 616e 6461 6c6f 6e65 272c 2027 2d64 272c  andalone', '-d',
+0000b490: 2027 6567 2e69 7327 5d29 0a20 2020 2020   'eg.is']).     
+0000b4a0: 2020 2073 656c 662e 5f63 6c69 5f6d 6973     self._cli_mis
+0000b4b0: 7369 6e67 5f66 6c61 6728 6172 6773 2c20  sing_flag(args, 
+0000b4c0: 2272 6567 6973 7465 7220 6265 666f 7265  "register before
+0000b4d0: 2072 756e 6e69 6e67 2229 0a0a 2020 2020   running")..    
+0000b4e0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+0000b4f0: 7462 6f74 2e5f 696e 7465 726e 616c 2e65  tbot._internal.e
+0000b500: 6666 2e68 616e 646c 655f 7375 6273 6372  ff.handle_subscr
+0000b510: 6970 7469 6f6e 2729 0a20 2020 2040 6d6f  iption').    @mo
+0000b520: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+0000b530: 742e 5f69 6e74 6572 6e61 6c2e 6c6f 672e  t._internal.log.
+0000b540: 706f 7374 5f61 7267 5f70 6172 7365 5f73  post_arg_parse_s
+0000b550: 6574 7570 2729 0a20 2020 2040 6d6f 636b  etup').    @mock
+0000b560: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+0000b570: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e5f  _internal.main._
+0000b580: 7265 706f 7274 5f6e 6577 5f63 6572 7427  report_new_cert'
+0000b590: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
+0000b5a0: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+0000b5b0: 726e 616c 2e6d 6169 6e2e 5f64 6574 6572  rnal.main._deter
+0000b5c0: 6d69 6e65 5f61 6363 6f75 6e74 2729 0a20  mine_account'). 
+0000b5d0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+0000b5e0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0000b5f0: 6c2e 6d61 696e 2e63 6c69 656e 742e 436c  l.main.client.Cl
+0000b600: 6965 6e74 2e6f 6274 6169 6e5f 616e 645f  ient.obtain_and_
+0000b610: 656e 726f 6c6c 5f63 6572 7469 6669 6361  enroll_certifica
+0000b620: 7465 2729 0a20 2020 2040 6d6f 636b 2e70  te').    @mock.p
+0000b630: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+0000b640: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 6765  nternal.main._ge
+0000b650: 745f 616e 645f 7361 7665 5f63 6572 7427  t_and_save_cert'
+0000b660: 290a 2020 2020 6465 6620 7465 7374 5f75  ).    def test_u
+0000b670: 7365 725f 6167 656e 7428 7365 6c66 2c20  ser_agent(self, 
+0000b680: 6773 632c 205f 6f62 742c 2064 6574 2c20  gsc, _obt, det, 
+0000b690: 5f2c 205f 5f2c 205f 5f5f 293a 0a20 2020  _, __, ___):.   
+0000b6a0: 2020 2020 2023 204e 6f72 6d61 6c6c 7920       # Normally 
+0000b6b0: 7468 6520 636c 6965 6e74 2069 7320 746f  the client is to
+0000b6c0: 7461 6c6c 7920 6d6f 636b 6564 206f 7574  tally mocked out
+0000b6d0: 2c20 6275 7420 6865 7265 2077 6520 6e65  , but here we ne
+0000b6e0: 6564 206d 6f72 650a 2020 2020 2020 2020  ed more.        
+0000b6f0: 2320 6172 6775 6d65 6e74 7320 746f 2061  # arguments to a
+0000b700: 7574 6f6d 6174 6520 6974 2e2e 2e0a 2020  utomate it....  
+0000b710: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
+0000b720: 2d73 7461 6e64 616c 6f6e 6522 2c20 2263  -standalone", "c
+0000b730: 6572 746f 6e6c 7922 2c20 222d 6d22 2c20  ertonly", "-m", 
+0000b740: 226e 6f6e 6540 6e6f 6e65 2e63 6f6d 222c  "none@none.com",
+0000b750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b760: 2022 2d64 222c 2022 6578 616d 706c 652e   "-d", "example.
+0000b770: 636f 6d22 2c20 272d 2d61 6772 6565 2d74  com", '--agree-t
+0000b780: 6f73 275d 202b 2073 656c 662e 7374 616e  os'] + self.stan
+0000b790: 6461 7264 5f61 7267 730a 2020 2020 2020  dard_args.      
+0000b7a0: 2020 6465 742e 7265 7475 726e 5f76 616c    det.return_val
+0000b7b0: 7565 203d 206d 6f63 6b2e 4d61 6769 634d  ue = mock.MagicM
+0000b7c0: 6f63 6b28 292c 204e 6f6e 650a 2020 2020  ock(), None.    
+0000b7d0: 2020 2020 6773 632e 7265 7475 726e 5f76      gsc.return_v
+0000b7e0: 616c 7565 203d 206d 6f63 6b2e 4d61 6769  alue = mock.Magi
+0000b7f0: 634d 6f63 6b28 290a 0a20 2020 2020 2020  cMock()..       
+0000b800: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+0000b810: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+0000b820: 6e61 6c2e 6d61 696e 2e63 6c69 656e 742e  nal.main.client.
+0000b830: 6163 6d65 5f63 6c69 656e 7427 2920 6173  acme_client') as
+0000b840: 2061 636d 655f 636c 6965 6e74 3a0a 2020   acme_client:.  
+0000b850: 2020 2020 2020 2020 2020 6163 6d65 5f6e            acme_n
+0000b860: 6574 203d 2061 636d 655f 636c 6965 6e74  et = acme_client
+0000b870: 2e43 6c69 656e 744e 6574 776f 726b 0a20  .ClientNetwork. 
+0000b880: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b890: 5f63 616c 6c5f 6e6f 5f63 6c69 656e 746d  _call_no_clientm
+0000b8a0: 6f63 6b28 6172 6773 290a 2020 2020 2020  ock(args).      
+0000b8b0: 2020 2020 2020 6f73 5f76 6572 203d 2075        os_ver = u
+0000b8c0: 7469 6c2e 6765 745f 6f73 5f69 6e66 6f5f  til.get_os_info_
+0000b8d0: 7561 2829 0a20 2020 2020 2020 2020 2020  ua().           
+0000b8e0: 2075 6120 3d20 6163 6d65 5f6e 6574 2e63   ua = acme_net.c
+0000b8f0: 616c 6c5f 6172 6773 5b31 5d5b 2275 7365  all_args[1]["use
+0000b900: 725f 6167 656e 7422 5d0a 2020 2020 2020  r_agent"].      
+0000b910: 2020 2020 2020 6173 7365 7274 206f 735f        assert os_
+0000b920: 7665 7220 696e 2075 610a 2020 2020 2020  ver in ua.      
+0000b930: 2020 2020 2020 696d 706f 7274 2070 6c61        import pla
+0000b940: 7466 6f72 6d0a 2020 2020 2020 2020 2020  tform.          
+0000b950: 2020 706c 6174 203d 2070 6c61 7466 6f72    plat = platfor
+0000b960: 6d2e 706c 6174 666f 726d 2829 0a20 2020  m.platform().   
+0000b970: 2020 2020 2020 2020 2069 6620 226c 696e           if "lin
+0000b980: 7578 2220 696e 2070 6c61 742e 6c6f 7765  ux" in plat.lowe
+0000b990: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+0000b9a0: 2020 2020 2061 7373 6572 7420 7574 696c       assert util
+0000b9b0: 2e67 6574 5f6f 735f 696e 666f 5f75 6128  .get_os_info_ua(
+0000b9c0: 2920 696e 2075 610a 0a20 2020 2020 2020  ) in ua..       
+0000b9d0: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+0000b9e0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+0000b9f0: 6e61 6c2e 6d61 696e 2e63 6c69 656e 742e  nal.main.client.
+0000ba00: 6163 6d65 5f63 6c69 656e 7427 2920 6173  acme_client') as
+0000ba10: 2061 636d 655f 636c 6965 6e74 3a0a 2020   acme_client:.  
+0000ba20: 2020 2020 2020 2020 2020 6163 6d65 5f6e            acme_n
+0000ba30: 6574 203d 2061 636d 655f 636c 6965 6e74  et = acme_client
+0000ba40: 2e43 6c69 656e 744e 6574 776f 726b 0a20  .ClientNetwork. 
+0000ba50: 2020 2020 2020 2020 2020 2075 6120 3d20             ua = 
+0000ba60: 2262 616e 6465 7273 6e61 7463 6822 0a20  "bandersnatch". 
+0000ba70: 2020 2020 2020 2020 2020 2061 7267 7320             args 
+0000ba80: 2b3d 205b 222d 2d75 7365 722d 6167 656e  += ["--user-agen
+0000ba90: 7422 2c20 7561 5d0a 2020 2020 2020 2020  t", ua].        
+0000baa0: 2020 2020 7365 6c66 2e5f 6361 6c6c 5f6e      self._call_n
+0000bab0: 6f5f 636c 6965 6e74 6d6f 636b 2861 7267  o_clientmock(arg
+0000bac0: 7329 0a20 2020 2020 2020 2020 2020 2061  s).            a
+0000bad0: 636d 655f 6e65 742e 6173 7365 7274 5f63  cme_net.assert_c
+0000bae0: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
+0000baf0: 6d6f 636b 2e41 4e59 2c20 6163 636f 756e  mock.ANY, accoun
+0000bb00: 743d 6d6f 636b 2e41 4e59 2c20 7665 7269  t=mock.ANY, veri
+0000bb10: 6679 5f73 736c 3d54 7275 652c 0a20 2020  fy_ssl=True,.   
+0000bb20: 2020 2020 2020 2020 2020 2020 2075 7365               use
+0000bb30: 725f 6167 656e 743d 7561 2c20 616c 673d  r_agent=ua, alg=
+0000bb40: 6a6f 7365 2e52 5332 3536 290a 0a20 2020  jose.RS256)..   
+0000bb50: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+0000bb60: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+0000bb70: 6d61 696e 2e70 6c75 675f 7365 6c2e 7265  main.plug_sel.re
+0000bb80: 636f 7264 5f63 686f 7365 6e5f 706c 7567  cord_chosen_plug
+0000bb90: 696e 7327 290a 2020 2020 406d 6f63 6b2e  ins').    @mock.
+0000bba0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+0000bbb0: 696e 7465 726e 616c 2e6d 6169 6e2e 706c  internal.main.pl
+0000bbc0: 7567 5f73 656c 2e70 6963 6b5f 696e 7374  ug_sel.pick_inst
+0000bbd0: 616c 6c65 7227 290a 2020 2020 6465 6620  aller').    def 
+0000bbe0: 7465 7374 5f69 6e73 7461 6c6c 6572 5f73  test_installer_s
+0000bbf0: 656c 6563 7469 6f6e 2873 656c 662c 206d  election(self, m
+0000bc00: 6f63 6b5f 7069 636b 5f69 6e73 7461 6c6c  ock_pick_install
+0000bc10: 6572 2c20 5f72 6563 293a 0a20 2020 2020  er, _rec):.     
+0000bc20: 2020 2073 656c 662e 5f63 616c 6c28 5b27     self._call(['
+0000bc30: 696e 7374 616c 6c27 2c20 272d 2d64 6f6d  install', '--dom
+0000bc40: 6169 6e73 272c 2027 666f 6f2e 6261 7227  ains', 'foo.bar'
+0000bc50: 2c20 272d 2d63 6572 742d 7061 7468 272c  , '--cert-path',
+0000bc60: 2027 6365 7274 272c 0a20 2020 2020 2020   'cert',.       
+0000bc70: 2020 2020 2020 2020 2020 2020 2027 2d2d               '--
+0000bc80: 6b65 792d 7061 7468 272c 2027 7072 6976  key-path', 'priv
+0000bc90: 6b65 7927 2c20 272d 2d63 6861 696e 2d70  key', '--chain-p
+0000bca0: 6174 6827 2c20 2763 6861 696e 275d 2c20  ath', 'chain'], 
+0000bcb0: 6d6f 636b 6973 6669 6c65 3d54 7275 6529  mockisfile=True)
+0000bcc0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0000bcd0: 6d6f 636b 5f70 6963 6b5f 696e 7374 616c  mock_pick_instal
+0000bce0: 6c65 722e 6361 6c6c 5f63 6f75 6e74 203d  ler.call_count =
+0000bcf0: 3d20 310a 0a20 2020 2040 6d6f 636b 2e70  = 1..    @mock.p
+0000bd00: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+0000bd10: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 696e  nternal.main._in
+0000bd20: 7374 616c 6c5f 6365 7274 2729 0a20 2020  stall_cert').   
+0000bd30: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+0000bd40: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+0000bd50: 6d61 696e 2e70 6c75 675f 7365 6c2e 7265  main.plug_sel.re
+0000bd60: 636f 7264 5f63 686f 7365 6e5f 706c 7567  cord_chosen_plug
+0000bd70: 696e 7327 290a 2020 2020 406d 6f63 6b2e  ins').    @mock.
+0000bd80: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+0000bd90: 696e 7465 726e 616c 2e6d 6169 6e2e 706c  internal.main.pl
+0000bda0: 7567 5f73 656c 2e70 6963 6b5f 696e 7374  ug_sel.pick_inst
+0000bdb0: 616c 6c65 7227 290a 2020 2020 6465 6620  aller').    def 
+0000bdc0: 7465 7374 5f69 6e73 7461 6c6c 6572 5f63  test_installer_c
+0000bdd0: 6572 746e 616d 6528 7365 6c66 2c20 5f69  ertname(self, _i
+0000bde0: 6e73 742c 205f 7265 632c 206d 6f63 6b5f  nst, _rec, mock_
+0000bdf0: 696e 7374 616c 6c29 3a0a 2020 2020 2020  install):.      
+0000be00: 2020 6d6f 636b 5f6c 696e 6561 6765 203d    mock_lineage =
+0000be10: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
+0000be20: 6365 7274 5f70 6174 683d 7465 7374 5f75  cert_path=test_u
+0000be30: 7469 6c2e 7465 6d70 5f6a 6f69 6e28 2763  til.temp_join('c
+0000be40: 6572 7427 292c 0a20 2020 2020 2020 2020  ert'),.         
+0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be60: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+0000be70: 696e 5f70 6174 683d 7465 7374 5f75 7469  in_path=test_uti
+0000be80: 6c2e 7465 6d70 5f6a 6f69 6e28 2763 6861  l.temp_join('cha
+0000be90: 696e 2729 2c0a 2020 2020 2020 2020 2020  in'),.          
+0000bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000beb0: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
+0000bec0: 6368 6169 6e5f 7061 7468 3d74 6573 745f  chain_path=test_
+0000bed0: 7574 696c 2e74 656d 705f 6a6f 696e 2827  util.temp_join('
+0000bee0: 6368 6169 6e27 292c 0a20 2020 2020 2020  chain'),.       
+0000bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000bf10: 6579 5f70 6174 683d 7465 7374 5f75 7469  ey_path=test_uti
+0000bf20: 6c2e 7465 6d70 5f6a 6f69 6e28 2770 7269  l.temp_join('pri
+0000bf30: 766b 6579 2729 290a 0a20 2020 2020 2020  vkey'))..       
+0000bf40: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+0000bf50: 2822 6365 7274 626f 742e 5f69 6e74 6572  ("certbot._inter
+0000bf60: 6e61 6c2e 6365 7274 5f6d 616e 6167 6572  nal.cert_manager
+0000bf70: 2e6c 696e 6561 6765 5f66 6f72 5f63 6572  .lineage_for_cer
+0000bf80: 746e 616d 6522 2920 6173 206d 6f63 6b5f  tname") as mock_
+0000bf90: 6765 746c 696e 3a0a 2020 2020 2020 2020  getlin:.        
+0000bfa0: 2020 2020 6d6f 636b 5f67 6574 6c69 6e2e      mock_getlin.
+0000bfb0: 7265 7475 726e 5f76 616c 7565 203d 206d  return_value = m
+0000bfc0: 6f63 6b5f 6c69 6e65 6167 650a 2020 2020  ock_lineage.    
+0000bfd0: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+0000bfe0: 6c6c 285b 2769 6e73 7461 6c6c 272c 2027  ll(['install', '
+0000bff0: 2d2d 6365 7274 2d6e 616d 6527 2c20 2777  --cert-name', 'w
+0000c000: 6861 7465 7665 7227 5d2c 206d 6f63 6b69  hatever'], mocki
+0000c010: 7366 696c 653d 5472 7565 290a 2020 2020  sfile=True).    
+0000c020: 2020 2020 2020 2020 6361 6c6c 5f63 6f6e          call_con
+0000c030: 6669 6720 3d20 6d6f 636b 5f69 6e73 7461  fig = mock_insta
+0000c040: 6c6c 2e63 616c 6c5f 6172 6773 5b30 5d5b  ll.call_args[0][
+0000c050: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
+0000c060: 7373 6572 7420 6361 6c6c 5f63 6f6e 6669  ssert call_confi
+0000c070: 672e 6365 7274 5f70 6174 6820 3d3d 2074  g.cert_path == t
+0000c080: 6573 745f 7574 696c 2e74 656d 705f 6a6f  est_util.temp_jo
+0000c090: 696e 2827 6365 7274 2729 0a20 2020 2020  in('cert').     
+0000c0a0: 2020 2020 2020 2061 7373 6572 7420 6361         assert ca
+0000c0b0: 6c6c 5f63 6f6e 6669 672e 6675 6c6c 6368  ll_config.fullch
+0000c0c0: 6169 6e5f 7061 7468 203d 3d20 7465 7374  ain_path == test
+0000c0d0: 5f75 7469 6c2e 7465 6d70 5f6a 6f69 6e28  _util.temp_join(
+0000c0e0: 2763 6861 696e 2729 0a20 2020 2020 2020  'chain').       
+0000c0f0: 2020 2020 2061 7373 6572 7420 6361 6c6c       assert call
+0000c100: 5f63 6f6e 6669 672e 6b65 795f 7061 7468  _config.key_path
+0000c110: 203d 3d20 7465 7374 5f75 7469 6c2e 7465   == test_util.te
+0000c120: 6d70 5f6a 6f69 6e28 2770 7269 766b 6579  mp_join('privkey
+0000c130: 2729 0a0a 2020 2020 406d 6f63 6b2e 7061  ')..    @mock.pa
+0000c140: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+0000c150: 7465 726e 616c 2e6c 6f67 2e70 6f73 745f  ternal.log.post_
+0000c160: 6172 675f 7061 7273 655f 7365 7475 7027  arg_parse_setup'
+0000c170: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
+0000c180: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+0000c190: 726e 616c 2e6d 6169 6e2e 5f69 6e73 7461  rnal.main._insta
+0000c1a0: 6c6c 5f63 6572 7427 290a 2020 2020 406d  ll_cert').    @m
+0000c1b0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+0000c1c0: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+0000c1d0: 6e2e 706c 7567 5f73 656c 2e72 6563 6f72  n.plug_sel.recor
+0000c1e0: 645f 6368 6f73 656e 5f70 6c75 6769 6e73  d_chosen_plugins
+0000c1f0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+0000c200: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+0000c210: 6572 6e61 6c2e 6d61 696e 2e70 6c75 675f  ernal.main.plug_
+0000c220: 7365 6c2e 7069 636b 5f69 6e73 7461 6c6c  sel.pick_install
+0000c230: 6572 2729 0a20 2020 2064 6566 2074 6573  er').    def tes
+0000c240: 745f 696e 7374 616c 6c65 725f 7061 7261  t_installer_para
+0000c250: 6d5f 6f76 6572 7269 6465 2873 656c 662c  m_override(self,
+0000c260: 205f 696e 7374 2c20 5f72 6563 2c20 6d6f   _inst, _rec, mo
+0000c270: 636b 5f69 6e73 7461 6c6c 2c20 5f29 3a0a  ck_install, _):.
+0000c280: 2020 2020 2020 2020 6d6f 636b 5f6c 696e          mock_lin
+0000c290: 6561 6765 203d 206d 6f63 6b2e 4d61 6769  eage = mock.Magi
+0000c2a0: 634d 6f63 6b28 6365 7274 5f70 6174 683d  cMock(cert_path=
+0000c2b0: 7465 7374 5f75 7469 6c2e 7465 6d70 5f6a  test_util.temp_j
+0000c2c0: 6f69 6e28 2763 6572 7427 292c 0a20 2020  oin('cert'),.   
+0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2f0: 2020 2063 6861 696e 5f70 6174 683d 7465     chain_path=te
+0000c300: 7374 5f75 7469 6c2e 7465 6d70 5f6a 6f69  st_util.temp_joi
+0000c310: 6e28 2763 6861 696e 2729 2c0a 2020 2020  n('chain'),.    
+0000c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c340: 2020 6675 6c6c 6368 6169 6e5f 7061 7468    fullchain_path
+0000c350: 3d74 6573 745f 7574 696c 2e74 656d 705f  =test_util.temp_
+0000c360: 6a6f 696e 2827 6368 6169 6e27 292c 0a20  join('chain'),. 
+0000c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c390: 2020 2020 206b 6579 5f70 6174 683d 7465       key_path=te
+0000c3a0: 7374 5f75 7469 6c2e 7465 6d70 5f6a 6f69  st_util.temp_joi
+0000c3b0: 6e28 2770 7269 766b 6579 2729 290a 2020  n('privkey')).  
+0000c3c0: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+0000c3d0: 7061 7463 6828 2263 6572 7462 6f74 2e5f  patch("certbot._
+0000c3e0: 696e 7465 726e 616c 2e63 6572 745f 6d61  internal.cert_ma
+0000c3f0: 6e61 6765 722e 6c69 6e65 6167 655f 666f  nager.lineage_fo
+0000c400: 725f 6365 7274 6e61 6d65 2229 2061 7320  r_certname") as 
+0000c410: 6d6f 636b 5f67 6574 6c69 6e3a 0a20 2020  mock_getlin:.   
+0000c420: 2020 2020 2020 2020 206d 6f63 6b5f 6765           mock_ge
+0000c430: 746c 696e 2e72 6574 7572 6e5f 7661 6c75  tlin.return_valu
+0000c440: 6520 3d20 6d6f 636b 5f6c 696e 6561 6765  e = mock_lineage
+0000c450: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000c460: 662e 5f63 616c 6c28 5b27 696e 7374 616c  f._call(['instal
+0000c470: 6c27 2c20 272d 2d63 6572 742d 6e61 6d65  l', '--cert-name
+0000c480: 272c 2027 7768 6174 6576 6572 272c 0a20  ', 'whatever',. 
+0000c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4a0: 2020 2020 2020 2027 2d2d 6b65 792d 7061         '--key-pa
+0000c4b0: 7468 272c 2074 6573 745f 7574 696c 2e74  th', test_util.t
+0000c4c0: 656d 705f 6a6f 696e 2827 6f76 6572 7269  emp_join('overri
+0000c4d0: 6469 6e67 5f70 7269 766b 6579 2729 5d2c  ding_privkey')],
+0000c4e0: 206d 6f63 6b69 7366 696c 653d 5472 7565   mockisfile=True
+0000c4f0: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
+0000c500: 6c6c 5f63 6f6e 6669 6720 3d20 6d6f 636b  ll_config = mock
+0000c510: 5f69 6e73 7461 6c6c 2e63 616c 6c5f 6172  _install.call_ar
+0000c520: 6773 5b30 5d5b 305d 0a20 2020 2020 2020  gs[0][0].       
+0000c530: 2020 2020 2061 7373 6572 7420 6361 6c6c       assert call
+0000c540: 5f63 6f6e 6669 672e 6365 7274 5f70 6174  _config.cert_pat
+0000c550: 6820 3d3d 2074 6573 745f 7574 696c 2e74  h == test_util.t
+0000c560: 656d 705f 6a6f 696e 2827 6365 7274 2729  emp_join('cert')
+0000c570: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000c580: 6572 7420 6361 6c6c 5f63 6f6e 6669 672e  ert call_config.
+0000c590: 6675 6c6c 6368 6169 6e5f 7061 7468 203d  fullchain_path =
+0000c5a0: 3d20 7465 7374 5f75 7469 6c2e 7465 6d70  = test_util.temp
+0000c5b0: 5f6a 6f69 6e28 2763 6861 696e 2729 0a20  _join('chain'). 
+0000c5c0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000c5d0: 7420 6361 6c6c 5f63 6f6e 6669 672e 6368  t call_config.ch
+0000c5e0: 6169 6e5f 7061 7468 203d 3d20 7465 7374  ain_path == test
+0000c5f0: 5f75 7469 6c2e 7465 6d70 5f6a 6f69 6e28  _util.temp_join(
+0000c600: 2763 6861 696e 2729 0a20 2020 2020 2020  'chain').       
+0000c610: 2020 2020 2061 7373 6572 7420 6361 6c6c       assert call
+0000c620: 5f63 6f6e 6669 672e 6b65 795f 7061 7468  _config.key_path
+0000c630: 203d 3d20 7465 7374 5f75 7469 6c2e 7465   == test_util.te
+0000c640: 6d70 5f6a 6f69 6e28 276f 7665 7272 6964  mp_join('overrid
+0000c650: 696e 675f 7072 6976 6b65 7927 290a 0a20  ing_privkey').. 
+0000c660: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
+0000c670: 696e 7374 616c 6c2e 7265 7365 7428 290a  install.reset().
+0000c680: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000c690: 662e 5f63 616c 6c28 5b27 696e 7374 616c  f._call(['instal
+0000c6a0: 6c27 2c20 272d 2d63 6572 742d 6e61 6d65  l', '--cert-name
+0000c6b0: 272c 2027 7768 6174 6576 6572 272c 0a20  ', 'whatever',. 
+0000c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6d0: 2020 2020 2020 2027 2d2d 6365 7274 2d70         '--cert-p
+0000c6e0: 6174 6827 2c20 7465 7374 5f75 7469 6c2e  ath', test_util.
+0000c6f0: 7465 6d70 5f6a 6f69 6e28 276f 7665 7272  temp_join('overr
+0000c700: 6964 696e 675f 6365 7274 2729 5d2c 206d  iding_cert')], m
+0000c710: 6f63 6b69 7366 696c 653d 5472 7565 290a  ockisfile=True).
+0000c720: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+0000c730: 5f63 6f6e 6669 6720 3d20 6d6f 636b 5f69  _config = mock_i
+0000c740: 6e73 7461 6c6c 2e63 616c 6c5f 6172 6773  nstall.call_args
+0000c750: 5b30 5d5b 305d 0a20 2020 2020 2020 2020  [0][0].         
+0000c760: 2020 2061 7373 6572 7420 6361 6c6c 5f63     assert call_c
+0000c770: 6f6e 6669 672e 6365 7274 5f70 6174 6820  onfig.cert_path 
+0000c780: 3d3d 2074 6573 745f 7574 696c 2e74 656d  == test_util.tem
+0000c790: 705f 6a6f 696e 2827 6f76 6572 7269 6469  p_join('overridi
+0000c7a0: 6e67 5f63 6572 7427 290a 2020 2020 2020  ng_cert').      
+0000c7b0: 2020 2020 2020 6173 7365 7274 2063 616c        assert cal
+0000c7c0: 6c5f 636f 6e66 6967 2e66 756c 6c63 6861  l_config.fullcha
+0000c7d0: 696e 5f70 6174 6820 3d3d 2074 6573 745f  in_path == test_
+0000c7e0: 7574 696c 2e74 656d 705f 6a6f 696e 2827  util.temp_join('
+0000c7f0: 6368 6169 6e27 290a 2020 2020 2020 2020  chain').        
+0000c800: 2020 2020 6173 7365 7274 2063 616c 6c5f      assert call_
+0000c810: 636f 6e66 6967 2e6b 6579 5f70 6174 6820  config.key_path 
+0000c820: 3d3d 2074 6573 745f 7574 696c 2e74 656d  == test_util.tem
+0000c830: 705f 6a6f 696e 2827 7072 6976 6b65 7927  p_join('privkey'
+0000c840: 290a 0a20 2020 2040 6d6f 636b 2e70 6174  )..    @mock.pat
+0000c850: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+0000c860: 6572 6e61 6c2e 6d61 696e 2e70 6c75 675f  ernal.main.plug_
+0000c870: 7365 6c2e 7265 636f 7264 5f63 686f 7365  sel.record_chose
+0000c880: 6e5f 706c 7567 696e 7327 290a 2020 2020  n_plugins').    
+0000c890: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+0000c8a0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+0000c8b0: 6169 6e2e 706c 7567 5f73 656c 2e70 6963  ain.plug_sel.pic
+0000c8c0: 6b5f 696e 7374 616c 6c65 7227 290a 2020  k_installer').  
+0000c8d0: 2020 6465 6620 7465 7374 5f69 6e73 7461    def test_insta
+0000c8e0: 6c6c 6572 5f70 6172 616d 5f65 7272 6f72  ller_param_error
+0000c8f0: 2873 656c 662c 205f 696e 7374 2c20 5f72  (self, _inst, _r
+0000c900: 6563 293a 0a20 2020 2020 2020 2077 6974  ec):.        wit
+0000c910: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
+0000c920: 6572 726f 7273 2e43 6f6e 6669 6775 7261  errors.Configura
+0000c930: 7469 6f6e 4572 726f 7229 3a0a 2020 2020  tionError):.    
+0000c940: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+0000c950: 6c6c 285b 2769 6e73 7461 6c6c 272c 2027  ll(['install', '
+0000c960: 2d2d 6365 7274 2d6e 616d 6527 2c20 276e  --cert-name', 'n
+0000c970: 6f74 666f 756e 6427 2c0a 2020 2020 2020  otfound',.      
+0000c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c990: 2020 2020 2027 2d2d 6b65 792d 7061 7468       '--key-path
+0000c9a0: 272c 2027 696e 7661 6c69 6427 5d29 0a0a  ', 'invalid'])..
+0000c9b0: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+0000c9c0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+0000c9d0: 616c 2e6d 6169 6e2e 706c 7567 5f73 656c  al.main.plug_sel
+0000c9e0: 2e72 6563 6f72 645f 6368 6f73 656e 5f70  .record_chosen_p
+0000c9f0: 6c75 6769 6e73 2729 0a20 2020 2040 6d6f  lugins').    @mo
+0000ca00: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+0000ca10: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+0000ca20: 2e70 6c75 675f 7365 6c2e 7069 636b 5f69  .plug_sel.pick_i
+0000ca30: 6e73 7461 6c6c 6572 2729 0a20 2020 2040  nstaller').    @
+0000ca40: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0000ca50: 626f 742e 5f69 6e74 6572 6e61 6c2e 6365  bot._internal.ce
+0000ca60: 7274 5f6d 616e 6167 6572 2e67 6574 5f63  rt_manager.get_c
+0000ca70: 6572 746e 616d 6573 2729 0a20 2020 2040  ertnames').    @
+0000ca80: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0000ca90: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+0000caa0: 696e 2e5f 696e 7374 616c 6c5f 6365 7274  in._install_cert
+0000cab0: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
+0000cac0: 696e 7374 616c 6c65 725f 7365 6c65 6374  installer_select
+0000cad0: 5f63 6572 7428 7365 6c66 2c20 6d6f 636b  _cert(self, mock
+0000cae0: 5f69 6e73 742c 206d 6f63 6b5f 6765 7463  _inst, mock_getc
+0000caf0: 6572 742c 205f 696e 7374 2c20 5f72 6563  ert, _inst, _rec
+0000cb00: 293a 0a20 2020 2020 2020 206d 6f63 6b5f  ):.        mock_
+0000cb10: 6c69 6e65 6167 6520 3d20 6d6f 636b 2e4d  lineage = mock.M
+0000cb20: 6167 6963 4d6f 636b 2863 6572 745f 7061  agicMock(cert_pa
+0000cb30: 7468 3d74 6573 745f 7574 696c 2e74 656d  th=test_util.tem
+0000cb40: 705f 6a6f 696e 2827 6365 7274 2729 2c0a  p_join('cert'),.
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb70: 2020 2020 2020 6368 6169 6e5f 7061 7468        chain_path
+0000cb80: 3d74 6573 745f 7574 696c 2e74 656d 705f  =test_util.temp_
+0000cb90: 6a6f 696e 2827 6368 6169 6e27 292c 0a20  join('chain'),. 
+0000cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbc0: 2020 2020 2066 756c 6c63 6861 696e 5f70       fullchain_p
+0000cbd0: 6174 683d 7465 7374 5f75 7469 6c2e 7465  ath=test_util.te
+0000cbe0: 6d70 5f6a 6f69 6e28 2763 6861 696e 2729  mp_join('chain')
+0000cbf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc10: 2020 2020 2020 2020 6b65 795f 7061 7468          key_path
+0000cc20: 3d74 6573 745f 7574 696c 2e74 656d 705f  =test_util.temp_
+0000cc30: 6a6f 696e 2827 7072 6976 6b65 7927 2929  join('privkey'))
+0000cc40: 0a20 2020 2020 2020 2077 6974 6820 6d6f  .        with mo
+0000cc50: 636b 2e70 6174 6368 2822 6365 7274 626f  ck.patch("certbo
+0000cc60: 742e 5f69 6e74 6572 6e61 6c2e 6365 7274  t._internal.cert
+0000cc70: 5f6d 616e 6167 6572 2e6c 696e 6561 6765  _manager.lineage
+0000cc80: 5f66 6f72 5f63 6572 746e 616d 6522 2920  _for_certname") 
+0000cc90: 6173 206d 6f63 6b5f 6765 746c 696e 3a0a  as mock_getlin:.
+0000cca0: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
+0000ccb0: 5f67 6574 6c69 6e2e 7265 7475 726e 5f76  _getlin.return_v
+0000ccc0: 616c 7565 203d 206d 6f63 6b5f 6c69 6e65  alue = mock_line
+0000ccd0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
+0000cce0: 7365 6c66 2e5f 6361 6c6c 285b 2769 6e73  self._call(['ins
+0000ccf0: 7461 6c6c 275d 2c20 6d6f 636b 6973 6669  tall'], mockisfi
+0000cd00: 6c65 3d54 7275 6529 0a20 2020 2020 2020  le=True).       
+0000cd10: 2061 7373 6572 7420 6d6f 636b 5f67 6574   assert mock_get
+0000cd20: 6365 7274 2e63 616c 6c65 640a 2020 2020  cert.called.    
+0000cd30: 2020 2020 6173 7365 7274 206d 6f63 6b5f      assert mock_
+0000cd40: 696e 7374 2e63 616c 6c65 640a 0a20 2020  inst.called..   
+0000cd50: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+0000cd60: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+0000cd70: 6566 662e 6861 6e64 6c65 5f73 7562 7363  eff.handle_subsc
+0000cd80: 7269 7074 696f 6e27 290a 2020 2020 406d  ription').    @m
+0000cd90: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+0000cda0: 6f74 2e5f 696e 7465 726e 616c 2e6c 6f67  ot._internal.log
+0000cdb0: 2e70 6f73 745f 6172 675f 7061 7273 655f  .post_arg_parse_
+0000cdc0: 7365 7475 7027 290a 2020 2020 406d 6f63  setup').    @moc
+0000cdd0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+0000cde0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+0000cdf0: 5f72 6570 6f72 745f 6e65 775f 6365 7274  _report_new_cert
+0000ce00: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+0000ce10: 6368 2827 6365 7274 626f 742e 7574 696c  ch('certbot.util
+0000ce20: 2e65 7865 5f65 7869 7374 7327 290a 2020  .exe_exists').  
+0000ce30: 2020 6465 6620 7465 7374 5f63 6f6e 6669    def test_confi
+0000ce40: 6775 7261 746f 725f 7365 6c65 6374 696f  gurator_selectio
+0000ce50: 6e28 7365 6c66 2c20 6d6f 636b 5f65 7865  n(self, mock_exe
+0000ce60: 5f65 7869 7374 732c 205f 2c20 5f5f 2c20  _exists, _, __, 
+0000ce70: 5f5f 5f29 3a0a 2020 2020 2020 2020 6d6f  ___):.        mo
+0000ce80: 636b 5f65 7865 5f65 7869 7374 732e 7265  ck_exe_exists.re
+0000ce90: 7475 726e 5f76 616c 7565 203d 2054 7275  turn_value = Tru
+0000cea0: 650a 2020 2020 2020 2020 7265 616c 5f70  e.        real_p
+0000ceb0: 6c75 6769 6e73 203d 2064 6973 636f 2e50  lugins = disco.P
+0000cec0: 6c75 6769 6e73 5265 6769 7374 7279 2e66  luginsRegistry.f
+0000ced0: 696e 645f 616c 6c28 290a 2020 2020 2020  ind_all().      
+0000cee0: 2020 6172 6773 203d 205b 272d 2d61 7061    args = ['--apa
+0000cef0: 6368 6527 2c20 272d 2d61 7574 6865 6e74  che', '--authent
+0000cf00: 6963 6174 6f72 272c 2027 7374 616e 6461  icator', 'standa
+0000cf10: 6c6f 6e65 275d 0a0a 2020 2020 2020 2020  lone']..        
+0000cf20: 2320 5468 6973 206e 6565 6465 6420 7477  # This needed tw
+0000cf30: 6f20 6361 6c6c 7320 746f 2066 696e 645f  o calls to find_
+0000cf40: 616c 6c28 292c 2077 6869 6368 2077 6527  all(), which we'
+0000cf50: 7265 2061 766f 6964 696e 6720 666f 7220  re avoiding for 
+0000cf60: 6e6f 770a 2020 2020 2020 2020 2320 6265  now.        # be
+0000cf70: 6361 7573 6520 6f66 2070 6f73 7369 626c  cause of possibl
+0000cf80: 6520 7369 6465 2065 6666 6563 7473 3a0a  e side effects:.
+0000cf90: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
+0000cfa0: 2f2f 6769 7468 7562 2e63 6f6d 2f6c 6574  //github.com/let
+0000cfb0: 7365 6e63 7279 7074 2f6c 6574 7365 6e63  sencrypt/letsenc
+0000cfc0: 7279 7074 2f63 6f6d 6d69 742f 3531 6564  rypt/commit/51ed
+0000cfd0: 3262 3638 3166 3837 6231 6562 3239 3038  2b681f87b1eb2908
+0000cfe0: 3864 6434 3837 3138 6135 3466 3430 3165  8dd48718a54f401e
+0000cff0: 3438 3535 0a20 2020 2020 2020 2023 2077  4855.        # w
+0000d000: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+0000d010: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0000d020: 6c2e 636c 692e 706c 7567 696e 735f 7465  l.cli.plugins_te
+0000d030: 7374 6162 6c65 2729 2061 7320 706c 7567  stable') as plug
+0000d040: 696e 733a 0a20 2020 2020 2020 2023 2020  ins:.        #  
+0000d050: 2020 706c 7567 696e 732e 7265 7475 726e    plugins.return
+0000d060: 5f76 616c 7565 203d 207b 2261 7061 6368  _value = {"apach
+0000d070: 6522 3a20 5472 7565 2c20 226e 6769 6e78  e": True, "nginx
+0000d080: 223a 2054 7275 657d 0a20 2020 2020 2020  ": True}.       
+0000d090: 2023 2020 2020 7265 742c 205f 2c20 5f2c   #    ret, _, _,
+0000d0a0: 205f 203d 2073 656c 662e 5f63 616c 6c28   _ = self._call(
+0000d0b0: 6172 6773 290a 2020 2020 2020 2020 2320  args).        # 
+0000d0c0: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
+0000d0d0: 7565 2822 546f 6f20 6d61 6e79 2066 6c61  ue("Too many fla
+0000d0e0: 6773 2073 6574 7469 6e67 2220 696e 2072  gs setting" in r
+0000d0f0: 6574 290a 0a20 2020 2020 2020 2061 7267  et)..        arg
+0000d100: 7320 3d20 5b22 696e 7374 616c 6c22 2c20  s = ["install", 
+0000d110: 222d 2d6e 6769 6e78 222c 2022 2d2d 6365  "--nginx", "--ce
+0000d120: 7274 2d70 6174 6822 2c0a 2020 2020 2020  rt-path",.      
+0000d130: 2020 2020 2020 2020 2020 7465 7374 5f75            test_u
+0000d140: 7469 6c2e 7465 6d70 5f6a 6f69 6e28 2762  til.temp_join('b
+0000d150: 6c61 6827 292c 2022 2d2d 6b65 792d 7061  lah'), "--key-pa
+0000d160: 7468 222c 2074 6573 745f 7574 696c 2e74  th", test_util.t
+0000d170: 656d 705f 6a6f 696e 2827 626c 6168 2729  emp_join('blah')
+0000d180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d190: 2020 222d 2d6e 6769 6e78 2d73 6572 7665    "--nginx-serve
+0000d1a0: 722d 726f 6f74 222c 2022 2f6e 6f6e 6578  r-root", "/nonex
+0000d1b0: 6973 7465 6e74 2f74 6869 6e67 222c 2022  istent/thing", "
+0000d1c0: 2d64 222c 0a20 2020 2020 2020 2020 2020  -d",.           
+0000d1d0: 2020 2020 2022 6578 616d 706c 652e 636f       "example.co
+0000d1e0: 6d22 2c20 222d 2d64 6562 7567 225d 0a20  m", "--debug"]. 
+0000d1f0: 2020 2020 2020 2069 6620 226e 6769 6e78         if "nginx
+0000d200: 2220 696e 2072 6561 6c5f 706c 7567 696e  " in real_plugin
+0000d210: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+0000d220: 2053 656e 6469 6e67 206e 6769 6e78 2061   Sending nginx a
+0000d230: 206e 6f6e 2d65 7869 7374 656e 7420 636f   non-existent co
+0000d240: 6e66 2064 6972 2077 696c 6c20 7369 6d75  nf dir will simu
+0000d250: 6c61 7465 206d 6973 636f 6e66 6967 7572  late misconfigur
+0000d260: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+0000d270: 2020 2320 2877 6520 6361 6e20 6f6e 6c79    # (we can only
+0000d280: 2064 6f20 7468 6174 2069 6620 6365 7274   do that if cert
+0000d290: 626f 742d 6e67 696e 7820 6973 2061 6374  bot-nginx is act
+0000d2a0: 7561 6c6c 7920 7072 6573 656e 7429 0a20  ually present). 
+0000d2b0: 2020 2020 2020 2020 2020 2072 6574 2c20             ret, 
+0000d2c0: 5f2c 205f 2c20 5f20 3d20 7365 6c66 2e5f  _, _, _ = self._
+0000d2d0: 6361 6c6c 2861 7267 7329 0a20 2020 2020  call(args).     
+0000d2e0: 2020 2020 2020 2061 7373 6572 7420 2254         assert "T
+0000d2f0: 6865 206e 6769 6e78 2070 6c75 6769 6e20  he nginx plugin 
+0000d300: 6973 206e 6f74 2077 6f72 6b69 6e67 2220  is not working" 
+0000d310: 696e 2072 6574 0a20 2020 2020 2020 2020  in ret.         
+0000d320: 2020 2061 7373 6572 7420 224d 6973 636f     assert "Misco
+0000d330: 6e66 6967 7572 6174 696f 6e45 7272 6f72  nfigurationError
+0000d340: 2220 696e 2072 6574 0a0a 2020 2020 2020  " in ret..      
+0000d350: 2020 7365 6c66 2e5f 636c 695f 6d69 7373    self._cli_miss
+0000d360: 696e 675f 666c 6167 285b 222d 2d73 7461  ing_flag(["--sta
+0000d370: 6e64 616c 6f6e 6522 5d2c 2022 5769 7468  ndalone"], "With
+0000d380: 2074 6865 2073 7461 6e64 616c 6f6e 6520   the standalone 
+0000d390: 706c 7567 696e 2c20 796f 7520 7072 6f62  plugin, you prob
+0000d3a0: 6162 6c79 2229 0a0a 2020 2020 2020 2020  ably")..        
+0000d3b0: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+0000d3c0: 2263 6572 7462 6f74 2e5f 696e 7465 726e  "certbot._intern
+0000d3d0: 616c 2e6d 6169 6e2e 5f69 6e69 745f 6c65  al.main._init_le
+0000d3e0: 5f63 6c69 656e 7422 2920 6173 206d 6f63  _client") as moc
+0000d3f0: 6b5f 696e 6974 3a0a 2020 2020 2020 2020  k_init:.        
+0000d400: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+0000d410: 7463 6828 2263 6572 7462 6f74 2e5f 696e  tch("certbot._in
+0000d420: 7465 726e 616c 2e6d 6169 6e2e 5f67 6574  ternal.main._get
+0000d430: 5f61 6e64 5f73 6176 655f 6365 7274 2229  _and_save_cert")
+0000d440: 2061 7320 6d6f 636b 5f67 7363 3a0a 2020   as mock_gsc:.  
+0000d450: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0000d460: 636b 5f67 7363 2e72 6574 7572 6e5f 7661  ck_gsc.return_va
+0000d470: 6c75 6520 3d20 6d6f 636b 2e4d 6167 6963  lue = mock.Magic
+0000d480: 4d6f 636b 2829 0a20 2020 2020 2020 2020  Mock().         
+0000d490: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
+0000d4a0: 6c28 5b22 6365 7274 6f6e 6c79 222c 2022  l(["certonly", "
+0000d4b0: 2d2d 6d61 6e75 616c 222c 2022 2d64 222c  --manual", "-d",
+0000d4c0: 2022 666f 6f2e 6261 7222 5d29 0a20 2020   "foo.bar"]).   
+0000d4d0: 2020 2020 2020 2020 2020 2020 2075 6e75               unu
+0000d4e0: 7365 645f 636f 6e66 6967 2c20 6175 7468  sed_config, auth
+0000d4f0: 2c20 756e 7573 6564 5f69 6e73 7461 6c6c  , unused_install
+0000d500: 6572 203d 206d 6f63 6b5f 696e 6974 2e63  er = mock_init.c
+0000d510: 616c 6c5f 6172 6773 5b30 5d0a 2020 2020  all_args[0].    
+0000d520: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000d530: 7274 2069 7369 6e73 7461 6e63 6528 6175  rt isinstance(au
+0000d540: 7468 2c20 6d61 6e75 616c 2e41 7574 6865  th, manual.Authe
+0000d550: 6e74 6963 6174 6f72 290a 0a20 2020 2020  nticator)..     
+0000d560: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
+0000d570: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+0000d580: 6572 6e61 6c2e 6d61 696e 2e63 6572 746f  ernal.main.certo
+0000d590: 6e6c 7927 2920 6173 206d 6f63 6b5f 6365  nly') as mock_ce
+0000d5a0: 7274 6f6e 6c79 3a0a 2020 2020 2020 2020  rtonly:.        
+0000d5b0: 2020 2020 7365 6c66 2e5f 6361 6c6c 285b      self._call([
+0000d5c0: 2261 7574 6822 2c20 222d 2d73 7461 6e64  "auth", "--stand
+0000d5d0: 616c 6f6e 6522 5d29 0a20 2020 2020 2020  alone"]).       
+0000d5e0: 2020 2020 2061 7373 6572 7420 3120 3d3d       assert 1 ==
+0000d5f0: 206d 6f63 6b5f 6365 7274 6f6e 6c79 2e63   mock_certonly.c
+0000d600: 616c 6c5f 636f 756e 740a 0a20 2020 2040  all_count..    @
+0000d610: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0000d620: 626f 742e 5f69 6e74 6572 6e61 6c2e 6c6f  bot._internal.lo
+0000d630: 672e 706f 7374 5f61 7267 5f70 6172 7365  g.post_arg_parse
+0000d640: 5f73 6574 7570 2729 0a20 2020 2064 6566  _setup').    def
+0000d650: 2074 6573 745f 726f 6c6c 6261 636b 2873   test_rollback(s
+0000d660: 656c 662c 205f 293a 0a20 2020 2020 2020  elf, _):.       
+0000d670: 205f 2c20 5f2c 205f 2c20 636c 6965 6e74   _, _, _, client
+0000d680: 203d 2073 656c 662e 5f63 616c 6c28 5b27   = self._call(['
+0000d690: 726f 6c6c 6261 636b 275d 290a 2020 2020  rollback']).    
+0000d6a0: 2020 2020 6173 7365 7274 2031 203d 3d20      assert 1 == 
+0000d6b0: 636c 6965 6e74 2e72 6f6c 6c62 6163 6b2e  client.rollback.
+0000d6c0: 6361 6c6c 5f63 6f75 6e74 0a0a 2020 2020  call_count..    
+0000d6d0: 2020 2020 5f2c 205f 2c20 5f2c 2063 6c69      _, _, _, cli
+0000d6e0: 656e 7420 3d20 7365 6c66 2e5f 6361 6c6c  ent = self._call
+0000d6f0: 285b 2772 6f6c 6c62 6163 6b27 2c20 272d  (['rollback', '-
+0000d700: 2d63 6865 636b 706f 696e 7473 272c 2027  -checkpoints', '
+0000d710: 3132 3327 5d29 0a20 2020 2020 2020 2063  123']).        c
+0000d720: 6c69 656e 742e 726f 6c6c 6261 636b 2e61  lient.rollback.a
+0000d730: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
+0000d740: 655f 7769 7468 280a 2020 2020 2020 2020  e_with(.        
+0000d750: 2020 2020 6d6f 636b 2e41 4e59 2c20 3132      mock.ANY, 12
+0000d760: 332c 206d 6f63 6b2e 414e 592c 206d 6f63  3, mock.ANY, moc
+0000d770: 6b2e 414e 5929 0a0a 2020 2020 406d 6f63  k.ANY)..    @moc
+0000d780: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+0000d790: 2e5f 696e 7465 726e 616c 2e63 6572 745f  ._internal.cert_
+0000d7a0: 6d61 6e61 6765 722e 7570 6461 7465 5f6c  manager.update_l
+0000d7b0: 6976 655f 7379 6d6c 696e 6b73 2729 0a20  ive_symlinks'). 
+0000d7c0: 2020 2064 6566 2074 6573 745f 7570 6461     def test_upda
+0000d7d0: 7465 5f73 796d 6c69 6e6b 7328 7365 6c66  te_symlinks(self
+0000d7e0: 2c20 6d6f 636b 5f63 6572 745f 6d61 6e61  , mock_cert_mana
+0000d7f0: 6765 7229 3a0a 2020 2020 2020 2020 7365  ger):.        se
+0000d800: 6c66 2e5f 6361 6c6c 5f6e 6f5f 636c 6965  lf._call_no_clie
+0000d810: 6e74 6d6f 636b 285b 2775 7064 6174 655f  ntmock(['update_
+0000d820: 7379 6d6c 696e 6b73 275d 290a 2020 2020  symlinks']).    
+0000d830: 2020 2020 6173 7365 7274 2031 203d 3d20      assert 1 == 
+0000d840: 6d6f 636b 5f63 6572 745f 6d61 6e61 6765  mock_cert_manage
+0000d850: 722e 6361 6c6c 5f63 6f75 6e74 0a0a 2020  r.call_count..  
+0000d860: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+0000d870: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0000d880: 2e63 6572 745f 6d61 6e61 6765 722e 6365  .cert_manager.ce
+0000d890: 7274 6966 6963 6174 6573 2729 0a20 2020  rtificates').   
+0000d8a0: 2064 6566 2074 6573 745f 6365 7274 6966   def test_certif
+0000d8b0: 6963 6174 6573 2873 656c 662c 206d 6f63  icates(self, moc
+0000d8c0: 6b5f 6365 7274 5f6d 616e 6167 6572 293a  k_cert_manager):
+0000d8d0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+0000d8e0: 616c 6c5f 6e6f 5f63 6c69 656e 746d 6f63  all_no_clientmoc
+0000d8f0: 6b28 5b27 6365 7274 6966 6963 6174 6573  k(['certificates
+0000d900: 275d 290a 2020 2020 2020 2020 6173 7365  ']).        asse
+0000d910: 7274 2031 203d 3d20 6d6f 636b 5f63 6572  rt 1 == mock_cer
+0000d920: 745f 6d61 6e61 6765 722e 6361 6c6c 5f63  t_manager.call_c
+0000d930: 6f75 6e74 0a0a 2020 2020 406d 6f63 6b2e  ount..    @mock.
+0000d940: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+0000d950: 696e 7465 726e 616c 2e63 6572 745f 6d61  internal.cert_ma
+0000d960: 6e61 6765 722e 6465 6c65 7465 2729 0a20  nager.delete'). 
+0000d970: 2020 2064 6566 2074 6573 745f 6465 6c65     def test_dele
+0000d980: 7465 2873 656c 662c 206d 6f63 6b5f 6365  te(self, mock_ce
+0000d990: 7274 5f6d 616e 6167 6572 293a 0a20 2020  rt_manager):.   
+0000d9a0: 2020 2020 2073 656c 662e 5f63 616c 6c5f       self._call_
+0000d9b0: 6e6f 5f63 6c69 656e 746d 6f63 6b28 5b27  no_clientmock(['
+0000d9c0: 6465 6c65 7465 275d 290a 2020 2020 2020  delete']).      
+0000d9d0: 2020 6173 7365 7274 2031 203d 3d20 6d6f    assert 1 == mo
+0000d9e0: 636b 5f63 6572 745f 6d61 6e61 6765 722e  ck_cert_manager.
+0000d9f0: 6361 6c6c 5f63 6f75 6e74 0a0a 2020 2020  call_count..    
+0000da00: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+0000da10: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+0000da20: 6169 6e2e 706c 7567 696e 735f 6469 7363  ain.plugins_disc
+0000da30: 6f27 290a 2020 2020 406d 6f63 6b2e 7061  o').    @mock.pa
+0000da40: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+0000da50: 7465 726e 616c 2e6d 6169 6e2e 636c 692e  ternal.main.cli.
+0000da60: 4865 6c70 6675 6c41 7267 756d 656e 7450  HelpfulArgumentP
+0000da70: 6172 7365 722e 6465 7465 726d 696e 655f  arser.determine_
+0000da80: 6865 6c70 5f74 6f70 6963 7327 290a 2020  help_topics').  
+0000da90: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+0000daa0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0000dab0: 2e6c 6f67 2e70 6f73 745f 6172 675f 7061  .log.post_arg_pa
+0000dac0: 7273 655f 7365 7475 7027 290a 2020 2020  rse_setup').    
+0000dad0: 6465 6620 7465 7374 5f70 6c75 6769 6e73  def test_plugins
+0000dae0: 2873 656c 662c 205f 2c20 5f64 6574 2c20  (self, _, _det, 
+0000daf0: 6d6f 636b 5f64 6973 636f 293a 0a20 2020  mock_disco):.   
+0000db00: 2020 2020 2066 6c61 6773 203d 205b 272d       flags = ['-
+0000db10: 2d69 6e69 7427 2c20 272d 2d70 7265 7061  -init', '--prepa
+0000db20: 7265 272c 2027 2d2d 6175 7468 656e 7469  re', '--authenti
+0000db30: 6361 746f 7273 272c 2027 2d2d 696e 7374  cators', '--inst
+0000db40: 616c 6c65 7273 275d 0a20 2020 2020 2020  allers'].       
+0000db50: 2066 6f72 2061 7267 7320 696e 2069 7465   for args in ite
+0000db60: 7274 6f6f 6c73 2e63 6861 696e 280a 2020  rtools.chain(.  
+0000db70: 2020 2020 2020 2020 2020 2020 2020 2a28                *(
+0000db80: 6974 6572 746f 6f6c 732e 636f 6d62 696e  itertools.combin
+0000db90: 6174 696f 6e73 2866 6c61 6773 2c20 7229  ations(flags, r)
+0000dba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dbb0: 2020 2066 6f72 2072 2069 6e20 7261 6e67     for r in rang
+0000dbc0: 6528 6c65 6e28 666c 6167 7329 2929 293a  e(len(flags)))):
+0000dbd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000dbe0: 662e 5f63 616c 6c28 5b27 706c 7567 696e  f._call(['plugin
+0000dbf0: 7327 5d20 2b20 6c69 7374 2861 7267 7329  s'] + list(args)
+0000dc00: 290a 0a20 2020 2040 6d6f 636b 2e70 6174  )..    @mock.pat
+0000dc10: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+0000dc20: 6572 6e61 6c2e 6d61 696e 2e70 6c75 6769  ernal.main.plugi
+0000dc30: 6e73 5f64 6973 636f 2729 0a20 2020 2040  ns_disco').    @
+0000dc40: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0000dc50: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+0000dc60: 696e 2e63 6c69 2e48 656c 7066 756c 4172  in.cli.HelpfulAr
+0000dc70: 6775 6d65 6e74 5061 7273 6572 2e64 6574  gumentParser.det
+0000dc80: 6572 6d69 6e65 5f68 656c 705f 746f 7069  ermine_help_topi
+0000dc90: 6373 2729 0a20 2020 2064 6566 2074 6573  cs').    def tes
+0000dca0: 745f 706c 7567 696e 735f 6e6f 5f61 7267  t_plugins_no_arg
+0000dcb0: 7328 7365 6c66 2c20 5f64 6574 2c20 6d6f  s(self, _det, mo
+0000dcc0: 636b 5f64 6973 636f 293a 0a20 2020 2020  ck_disco):.     
+0000dcd0: 2020 2069 6661 6365 733a 204c 6973 745b     ifaces: List[
+0000dce0: 696e 7465 7266 6163 6573 2e50 6c75 6769  interfaces.Plugi
+0000dcf0: 6e5d 203d 205b 5d0a 2020 2020 2020 2020  n] = [].        
+0000dd00: 706c 7567 696e 7320 3d20 6d6f 636b 5f64  plugins = mock_d
+0000dd10: 6973 636f 2e50 6c75 6769 6e73 5265 6769  isco.PluginsRegi
+0000dd20: 7374 7279 2e66 696e 645f 616c 6c28 290a  stry.find_all().
+0000dd30: 0a20 2020 2020 2020 2073 7464 6f75 7420  .        stdout 
+0000dd40: 3d20 696f 2e53 7472 696e 6749 4f28 290a  = io.StringIO().
+0000dd50: 2020 2020 2020 2020 7769 7468 2074 6573          with tes
+0000dd60: 745f 7574 696c 2e70 6174 6368 5f64 6973  t_util.patch_dis
+0000dd70: 706c 6179 5f75 7469 6c5f 7769 7468 5f73  play_util_with_s
+0000dd80: 7464 6f75 7428 7374 646f 7574 3d73 7464  tdout(stdout=std
+0000dd90: 6f75 7429 3a0a 2020 2020 2020 2020 2020  out):.          
+0000dda0: 2020 5f2c 2073 7464 6f75 742c 205f 2c20    _, stdout, _, 
+0000ddb0: 5f20 3d20 7365 6c66 2e5f 6361 6c6c 285b  _ = self._call([
+0000ddc0: 2770 6c75 6769 6e73 275d 2c20 7374 646f  'plugins'], stdo
+0000ddd0: 7574 290a 0a20 2020 2020 2020 2070 6c75  ut)..        plu
+0000dde0: 6769 6e73 2e76 6973 6962 6c65 2e61 7373  gins.visible.ass
+0000ddf0: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
+0000de00: 7769 7468 2829 0a20 2020 2020 2020 2070  with().        p
+0000de10: 6c75 6769 6e73 2e76 6973 6962 6c65 2829  lugins.visible()
+0000de20: 2e69 6661 6365 732e 6173 7365 7274 5f63  .ifaces.assert_c
+0000de30: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
+0000de40: 6966 6163 6573 290a 2020 2020 2020 2020  ifaces).        
+0000de50: 6669 6c74 6572 6564 203d 2070 6c75 6769  filtered = plugi
+0000de60: 6e73 2e76 6973 6962 6c65 2829 2e69 6661  ns.visible().ifa
+0000de70: 6365 7328 290a 2020 2020 2020 2020 6173  ces().        as
+0000de80: 7365 7274 2073 7464 6f75 742e 6765 7476  sert stdout.getv
+0000de90: 616c 7565 2829 2e73 7472 6970 2829 203d  alue().strip() =
+0000dea0: 3d20 7374 7228 6669 6c74 6572 6564 290a  = str(filtered).
+0000deb0: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
+0000dec0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+0000ded0: 6e61 6c2e 6d61 696e 2e70 6c75 6769 6e73  nal.main.plugins
+0000dee0: 5f64 6973 636f 2729 0a20 2020 2040 6d6f  _disco').    @mo
+0000def0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+0000df00: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+0000df10: 2e63 6c69 2e48 656c 7066 756c 4172 6775  .cli.HelpfulArgu
+0000df20: 6d65 6e74 5061 7273 6572 2e64 6574 6572  mentParser.deter
+0000df30: 6d69 6e65 5f68 656c 705f 746f 7069 6373  mine_help_topics
+0000df40: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
+0000df50: 706c 7567 696e 735f 6e6f 5f61 7267 735f  plugins_no_args_
+0000df60: 756e 7072 6976 696c 6567 6564 2873 656c  unprivileged(sel
+0000df70: 662c 205f 6465 742c 206d 6f63 6b5f 6469  f, _det, mock_di
+0000df80: 7363 6f29 3a0a 2020 2020 2020 2020 6966  sco):.        if
+0000df90: 6163 6573 3a20 4c69 7374 5b69 6e74 6572  aces: List[inter
+0000dfa0: 6661 6365 732e 506c 7567 696e 5d20 3d20  faces.Plugin] = 
+0000dfb0: 5b5d 0a20 2020 2020 2020 2070 6c75 6769  [].        plugi
+0000dfc0: 6e73 203d 206d 6f63 6b5f 6469 7363 6f2e  ns = mock_disco.
+0000dfd0: 506c 7567 696e 7352 6567 6973 7472 792e  PluginsRegistry.
+0000dfe0: 6669 6e64 5f61 6c6c 2829 0a0a 2020 2020  find_all()..    
+0000dff0: 2020 2020 6465 6620 7468 726f 775f 6572      def throw_er
+0000e000: 726f 7228 6469 7265 6374 6f72 792c 206d  ror(directory, m
+0000e010: 6f64 652c 2073 7472 6963 7429 3a0a 2020  ode, strict):.  
+0000e020: 2020 2020 2020 2020 2020 2222 2252 6169            """Rai
+0000e030: 7365 7320 6572 726f 722e 4572 726f 722e  ses error.Error.
+0000e040: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0000e050: 5f2c 205f 2c20 5f20 3d20 6469 7265 6374  _, _, _ = direct
+0000e060: 6f72 792c 206d 6f64 652c 2073 7472 6963  ory, mode, stric
+0000e070: 740a 2020 2020 2020 2020 2020 2020 7261  t.            ra
+0000e080: 6973 6520 6572 726f 7273 2e45 7272 6f72  ise errors.Error
+0000e090: 2829 0a0a 2020 2020 2020 2020 7374 646f  ()..        stdo
+0000e0a0: 7574 203d 2069 6f2e 5374 7269 6e67 494f  ut = io.StringIO
+0000e0b0: 2829 0a20 2020 2020 2020 2077 6974 6820  ().        with 
+0000e0c0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0000e0d0: 626f 742e 7574 696c 2e73 6574 5f75 705f  bot.util.set_up_
+0000e0e0: 636f 7265 5f64 6972 2729 2061 7320 6d6f  core_dir') as mo
+0000e0f0: 636b 5f73 6574 5f75 705f 636f 7265 5f64  ck_set_up_core_d
+0000e100: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+0000e110: 7769 7468 2074 6573 745f 7574 696c 2e70  with test_util.p
+0000e120: 6174 6368 5f64 6973 706c 6179 5f75 7469  atch_display_uti
+0000e130: 6c5f 7769 7468 5f73 7464 6f75 7428 7374  l_with_stdout(st
+0000e140: 646f 7574 3d73 7464 6f75 7429 3a0a 2020  dout=stdout):.  
+0000e150: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0000e160: 636b 5f73 6574 5f75 705f 636f 7265 5f64  ck_set_up_core_d
+0000e170: 6972 2e73 6964 655f 6566 6665 6374 203d  ir.side_effect =
+0000e180: 2074 6872 6f77 5f65 7272 6f72 0a20 2020   throw_error.   
+0000e190: 2020 2020 2020 2020 2020 2020 205f 2c20               _, 
+0000e1a0: 7374 646f 7574 2c20 5f2c 205f 203d 2073  stdout, _, _ = s
+0000e1b0: 656c 662e 5f63 616c 6c28 5b27 706c 7567  elf._call(['plug
+0000e1c0: 696e 7327 5d2c 2073 7464 6f75 7429 0a0a  ins'], stdout)..
+0000e1d0: 2020 2020 2020 2020 706c 7567 696e 732e          plugins.
+0000e1e0: 7669 7369 626c 652e 6173 7365 7274 5f63  visible.assert_c
+0000e1f0: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
+0000e200: 290a 2020 2020 2020 2020 706c 7567 696e  ).        plugin
+0000e210: 732e 7669 7369 626c 6528 292e 6966 6163  s.visible().ifac
+0000e220: 6573 2e61 7373 6572 745f 6361 6c6c 6564  es.assert_called
+0000e230: 5f6f 6e63 655f 7769 7468 2869 6661 6365  _once_with(iface
+0000e240: 7329 0a20 2020 2020 2020 2066 696c 7465  s).        filte
+0000e250: 7265 6420 3d20 706c 7567 696e 732e 7669  red = plugins.vi
+0000e260: 7369 626c 6528 292e 6966 6163 6573 2829  sible().ifaces()
+0000e270: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0000e280: 7374 646f 7574 2e67 6574 7661 6c75 6528  stdout.getvalue(
+0000e290: 292e 7374 7269 7028 2920 3d3d 2073 7472  ).strip() == str
+0000e2a0: 2866 696c 7465 7265 6429 0a0a 2020 2020  (filtered)..    
+0000e2b0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+0000e2c0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+0000e2d0: 6169 6e2e 706c 7567 696e 735f 6469 7363  ain.plugins_disc
+0000e2e0: 6f27 290a 2020 2020 406d 6f63 6b2e 7061  o').    @mock.pa
+0000e2f0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+0000e300: 7465 726e 616c 2e6d 6169 6e2e 636c 692e  ternal.main.cli.
+0000e310: 4865 6c70 6675 6c41 7267 756d 656e 7450  HelpfulArgumentP
+0000e320: 6172 7365 722e 6465 7465 726d 696e 655f  arser.determine_
+0000e330: 6865 6c70 5f74 6f70 6963 7327 290a 2020  help_topics').  
+0000e340: 2020 6465 6620 7465 7374 5f70 6c75 6769    def test_plugi
+0000e350: 6e73 5f69 6e69 7428 7365 6c66 2c20 5f64  ns_init(self, _d
+0000e360: 6574 2c20 6d6f 636b 5f64 6973 636f 293a  et, mock_disco):
+0000e370: 0a20 2020 2020 2020 2069 6661 6365 733a  .        ifaces:
+0000e380: 204c 6973 745b 696e 7465 7266 6163 6573   List[interfaces
+0000e390: 2e50 6c75 6769 6e5d 203d 205b 5d0a 2020  .Plugin] = [].  
+0000e3a0: 2020 2020 2020 706c 7567 696e 7320 3d20        plugins = 
+0000e3b0: 6d6f 636b 5f64 6973 636f 2e50 6c75 6769  mock_disco.Plugi
+0000e3c0: 6e73 5265 6769 7374 7279 2e66 696e 645f  nsRegistry.find_
+0000e3d0: 616c 6c28 290a 0a20 2020 2020 2020 2073  all()..        s
+0000e3e0: 7464 6f75 7420 3d20 696f 2e53 7472 696e  tdout = io.Strin
+0000e3f0: 6749 4f28 290a 2020 2020 2020 2020 7769  gIO().        wi
+0000e400: 7468 2074 6573 745f 7574 696c 2e70 6174  th test_util.pat
+0000e410: 6368 5f64 6973 706c 6179 5f75 7469 6c5f  ch_display_util_
+0000e420: 7769 7468 5f73 7464 6f75 7428 7374 646f  with_stdout(stdo
+0000e430: 7574 3d73 7464 6f75 7429 3a0a 2020 2020  ut=stdout):.    
+0000e440: 2020 2020 2020 2020 5f2c 2073 7464 6f75          _, stdou
+0000e450: 742c 205f 2c20 5f20 3d20 7365 6c66 2e5f  t, _, _ = self._
+0000e460: 6361 6c6c 285b 2770 6c75 6769 6e73 272c  call(['plugins',
+0000e470: 2027 2d2d 696e 6974 275d 2c20 7374 646f   '--init'], stdo
+0000e480: 7574 290a 0a20 2020 2020 2020 2070 6c75  ut)..        plu
+0000e490: 6769 6e73 2e76 6973 6962 6c65 2e61 7373  gins.visible.ass
+0000e4a0: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
+0000e4b0: 7769 7468 2829 0a20 2020 2020 2020 2070  with().        p
+0000e4c0: 6c75 6769 6e73 2e76 6973 6962 6c65 2829  lugins.visible()
+0000e4d0: 2e69 6661 6365 732e 6173 7365 7274 5f63  .ifaces.assert_c
+0000e4e0: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
+0000e4f0: 6966 6163 6573 290a 2020 2020 2020 2020  ifaces).        
+0000e500: 6669 6c74 6572 6564 203d 2070 6c75 6769  filtered = plugi
+0000e510: 6e73 2e76 6973 6962 6c65 2829 2e69 6661  ns.visible().ifa
+0000e520: 6365 7328 290a 2020 2020 2020 2020 6173  ces().        as
+0000e530: 7365 7274 2066 696c 7465 7265 642e 696e  sert filtered.in
+0000e540: 6974 2e63 616c 6c5f 636f 756e 7420 3d3d  it.call_count ==
+0000e550: 2031 0a20 2020 2020 2020 2061 7373 6572   1.        asser
+0000e560: 7420 7374 646f 7574 2e67 6574 7661 6c75  t stdout.getvalu
+0000e570: 6528 292e 7374 7269 7028 2920 3d3d 2073  e().strip() == s
+0000e580: 7472 2866 696c 7465 7265 6429 0a0a 2020  tr(filtered)..  
+0000e590: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+0000e5a0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0000e5b0: 2e6d 6169 6e2e 706c 7567 696e 735f 6469  .main.plugins_di
+0000e5c0: 7363 6f27 290a 2020 2020 406d 6f63 6b2e  sco').    @mock.
+0000e5d0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+0000e5e0: 696e 7465 726e 616c 2e6d 6169 6e2e 636c  internal.main.cl
+0000e5f0: 692e 4865 6c70 6675 6c41 7267 756d 656e  i.HelpfulArgumen
+0000e600: 7450 6172 7365 722e 6465 7465 726d 696e  tParser.determin
+0000e610: 655f 6865 6c70 5f74 6f70 6963 7327 290a  e_help_topics').
+0000e620: 2020 2020 6465 6620 7465 7374 5f70 6c75      def test_plu
+0000e630: 6769 6e73 5f70 7265 7061 7265 2873 656c  gins_prepare(sel
+0000e640: 662c 205f 6465 742c 206d 6f63 6b5f 6469  f, _det, mock_di
+0000e650: 7363 6f29 3a0a 2020 2020 2020 2020 6966  sco):.        if
+0000e660: 6163 6573 3a20 4c69 7374 5b69 6e74 6572  aces: List[inter
+0000e670: 6661 6365 732e 506c 7567 696e 5d20 3d20  faces.Plugin] = 
+0000e680: 5b5d 0a20 2020 2020 2020 2070 6c75 6769  [].        plugi
+0000e690: 6e73 203d 206d 6f63 6b5f 6469 7363 6f2e  ns = mock_disco.
+0000e6a0: 506c 7567 696e 7352 6567 6973 7472 792e  PluginsRegistry.
+0000e6b0: 6669 6e64 5f61 6c6c 2829 0a0a 2020 2020  find_all()..    
+0000e6c0: 2020 2020 7374 646f 7574 203d 2069 6f2e      stdout = io.
+0000e6d0: 5374 7269 6e67 494f 2829 0a20 2020 2020  StringIO().     
+0000e6e0: 2020 2077 6974 6820 7465 7374 5f75 7469     with test_uti
+0000e6f0: 6c2e 7061 7463 685f 6469 7370 6c61 795f  l.patch_display_
+0000e700: 7574 696c 5f77 6974 685f 7374 646f 7574  util_with_stdout
+0000e710: 2873 7464 6f75 743d 7374 646f 7574 293a  (stdout=stdout):
+0000e720: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
+0000e730: 7374 646f 7574 2c20 5f2c 205f 203d 2073  stdout, _, _ = s
+0000e740: 656c 662e 5f63 616c 6c28 5b27 706c 7567  elf._call(['plug
+0000e750: 696e 7327 2c20 272d 2d69 6e69 7427 2c20  ins', '--init', 
+0000e760: 272d 2d70 7265 7061 7265 275d 2c20 7374  '--prepare'], st
+0000e770: 646f 7574 290a 0a20 2020 2020 2020 2070  dout)..        p
+0000e780: 6c75 6769 6e73 2e76 6973 6962 6c65 2e61  lugins.visible.a
+0000e790: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
+0000e7a0: 655f 7769 7468 2829 0a20 2020 2020 2020  e_with().       
+0000e7b0: 2070 6c75 6769 6e73 2e76 6973 6962 6c65   plugins.visible
+0000e7c0: 2829 2e69 6661 6365 732e 6173 7365 7274  ().ifaces.assert
+0000e7d0: 5f63 616c 6c65 645f 6f6e 6365 5f77 6974  _called_once_wit
+0000e7e0: 6828 6966 6163 6573 290a 2020 2020 2020  h(ifaces).      
+0000e7f0: 2020 6669 6c74 6572 6564 203d 2070 6c75    filtered = plu
+0000e800: 6769 6e73 2e76 6973 6962 6c65 2829 2e69  gins.visible().i
+0000e810: 6661 6365 7328 290a 2020 2020 2020 2020  faces().        
+0000e820: 6173 7365 7274 2066 696c 7465 7265 642e  assert filtered.
+0000e830: 696e 6974 2e63 616c 6c5f 636f 756e 7420  init.call_count 
+0000e840: 3d3d 2031 0a20 2020 2020 2020 2066 696c  == 1.        fil
+0000e850: 7465 7265 642e 7072 6570 6172 652e 6173  tered.prepare.as
+0000e860: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
+0000e870: 5f77 6974 6828 290a 2020 2020 2020 2020  _with().        
+0000e880: 6669 6c74 6572 6564 2e61 7661 696c 6162  filtered.availab
+0000e890: 6c65 2e61 7373 6572 745f 6361 6c6c 6564  le.assert_called
+0000e8a0: 5f6f 6e63 655f 7769 7468 2829 0a20 2020  _once_with().   
+0000e8b0: 2020 2020 2061 7661 696c 6162 6c65 203d       available =
+0000e8c0: 2066 696c 7465 7265 642e 6176 6169 6c61   filtered.availa
+0000e8d0: 626c 6528 290a 2020 2020 2020 2020 6173  ble().        as
+0000e8e0: 7365 7274 2073 7464 6f75 742e 6765 7476  sert stdout.getv
+0000e8f0: 616c 7565 2829 2e73 7472 6970 2829 203d  alue().strip() =
+0000e900: 3d20 7374 7228 6176 6169 6c61 626c 6529  = str(available)
+0000e910: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
+0000e920: 6572 746f 6e6c 795f 6162 7370 6174 6828  ertonly_abspath(
+0000e930: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
+0000e940: 6572 7420 3d20 2763 6572 7427 0a20 2020  ert = 'cert'.   
+0000e950: 2020 2020 206b 6579 203d 2027 6b65 7927       key = 'key'
+0000e960: 0a20 2020 2020 2020 2063 6861 696e 203d  .        chain =
+0000e970: 2027 6368 6169 6e27 0a20 2020 2020 2020   'chain'.       
+0000e980: 2066 756c 6c63 6861 696e 203d 2027 6675   fullchain = 'fu
+0000e990: 6c6c 6368 6169 6e27 0a0a 2020 2020 2020  llchain'..      
+0000e9a0: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+0000e9b0: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+0000e9c0: 726e 616c 2e6d 6169 6e2e 6365 7274 6f6e  rnal.main.certon
+0000e9d0: 6c79 2729 2061 7320 6d6f 636b 5f63 6572  ly') as mock_cer
+0000e9e0: 746f 6e6c 793a 0a20 2020 2020 2020 2020  tonly:.         
+0000e9f0: 2020 2073 656c 662e 5f63 616c 6c28 5b27     self._call(['
+0000ea00: 6365 7274 6f6e 6c79 272c 2027 2d2d 6365  certonly', '--ce
+0000ea10: 7274 2d70 6174 6827 2c20 6365 7274 2c20  rt-path', cert, 
+0000ea20: 272d 2d6b 6579 2d70 6174 6827 2c20 276b  '--key-path', 'k
+0000ea30: 6579 272c 0a20 2020 2020 2020 2020 2020  ey',.           
+0000ea40: 2020 2020 2020 2020 2020 2020 2027 2d2d               '--
+0000ea50: 6368 6169 6e2d 7061 7468 272c 2027 6368  chain-path', 'ch
+0000ea60: 6169 6e27 2c0a 2020 2020 2020 2020 2020  ain',.          
+0000ea70: 2020 2020 2020 2020 2020 2020 2020 272d                '-
+0000ea80: 2d66 756c 6c63 6861 696e 2d70 6174 6827  -fullchain-path'
+0000ea90: 2c20 2766 756c 6c63 6861 696e 275d 290a  , 'fullchain']).
+0000eaa0: 0a20 2020 2020 2020 2063 6f6e 6669 672c  .        config,
+0000eab0: 2075 6e75 7365 645f 706c 7567 696e 7320   unused_plugins 
+0000eac0: 3d20 6d6f 636b 5f63 6572 746f 6e6c 792e  = mock_certonly.
+0000ead0: 6361 6c6c 5f61 7267 735b 305d 0a20 2020  call_args[0].   
+0000eae0: 2020 2020 2061 7373 6572 7420 636f 6e66       assert conf
+0000eaf0: 6967 2e63 6572 745f 7061 7468 203d 3d20  ig.cert_path == 
+0000eb00: 6f73 2e70 6174 682e 6162 7370 6174 6828  os.path.abspath(
+0000eb10: 6365 7274 290a 2020 2020 2020 2020 6173  cert).        as
+0000eb20: 7365 7274 2063 6f6e 6669 672e 6b65 795f  sert config.key_
+0000eb30: 7061 7468 203d 3d20 6f73 2e70 6174 682e  path == os.path.
+0000eb40: 6162 7370 6174 6828 6b65 7929 0a20 2020  abspath(key).   
+0000eb50: 2020 2020 2061 7373 6572 7420 636f 6e66       assert conf
+0000eb60: 6967 2e63 6861 696e 5f70 6174 6820 3d3d  ig.chain_path ==
+0000eb70: 206f 732e 7061 7468 2e61 6273 7061 7468   os.path.abspath
+0000eb80: 2863 6861 696e 290a 2020 2020 2020 2020  (chain).        
+0000eb90: 6173 7365 7274 2063 6f6e 6669 672e 6675  assert config.fu
+0000eba0: 6c6c 6368 6169 6e5f 7061 7468 203d 3d20  llchain_path == 
+0000ebb0: 6f73 2e70 6174 682e 6162 7370 6174 6828  os.path.abspath(
+0000ebc0: 6675 6c6c 6368 6169 6e29 0a0a 2020 2020  fullchain)..    
+0000ebd0: 6465 6620 7465 7374 5f63 6572 746f 6e6c  def test_certonl
+0000ebe0: 795f 6261 645f 6172 6773 2873 656c 6629  y_bad_args(self)
+0000ebf0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+0000ec00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ec10: 5f63 616c 6c28 5b27 2d61 272c 2027 6261  _call(['-a', 'ba
+0000ec20: 645f 6175 7468 272c 2027 6365 7274 6f6e  d_auth', 'certon
+0000ec30: 6c79 275d 290a 2020 2020 2020 2020 2020  ly']).          
+0000ec40: 2020 6173 7365 7274 2046 616c 7365 2c20    assert False, 
+0000ec50: 2245 7863 6570 7469 6f6e 2073 686f 756c  "Exception shoul
+0000ec60: 6420 6861 7665 2062 6565 6e20 7261 6973  d have been rais
+0000ec70: 6564 220a 2020 2020 2020 2020 6578 6365  ed".        exce
+0000ec80: 7074 2065 7272 6f72 732e 506c 7567 696e  pt errors.Plugin
+0000ec90: 5365 6c65 6374 696f 6e45 7272 6f72 2061  SelectionError a
+0000eca0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000ecb0: 2061 7373 6572 7420 2754 6865 2072 6571   assert 'The req
+0000ecc0: 7565 7374 6564 2062 6164 5f61 7574 6820  uested bad_auth 
+0000ecd0: 706c 7567 696e 2064 6f65 7320 6e6f 7420  plugin does not 
+0000ece0: 6170 7065 6172 2720 696e 2073 7472 2865  appear' in str(e
+0000ecf0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000ed00: 6368 6563 6b5f 636f 6e66 6967 5f73 616e  check_config_san
+0000ed10: 6974 795f 646f 6d61 696e 2873 656c 6629  ity_domain(self)
+0000ed20: 3a0a 2020 2020 2020 2020 2320 4651 444e  :.        # FQDN
+0000ed30: 0a20 2020 2020 2020 2077 6974 6820 7079  .        with py
+0000ed40: 7465 7374 2e72 6169 7365 7328 6572 726f  test.raises(erro
+0000ed50: 7273 2e43 6f6e 6669 6775 7261 7469 6f6e  rs.Configuration
+0000ed60: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+0000ed70: 2020 2020 7365 6c66 2e5f 6361 6c6c 285b      self._call([
+0000ed80: 272d 6427 2c20 2761 2720 2a20 3634 5d29  '-d', 'a' * 64])
+0000ed90: 0a20 2020 2020 2020 2023 2046 5144 4e20  .        # FQDN 
+0000eda0: 320a 2020 2020 2020 2020 7769 7468 2070  2.        with p
+0000edb0: 7974 6573 742e 7261 6973 6573 2865 7272  ytest.raises(err
+0000edc0: 6f72 732e 436f 6e66 6967 7572 6174 696f  ors.Configuratio
+0000edd0: 6e45 7272 6f72 293a 0a20 2020 2020 2020  nError):.       
+0000ede0: 2020 2020 2073 656c 662e 5f63 616c 6c28       self._call(
+0000edf0: 5b27 2d64 272c 2028 2827 6127 202a 2035  ['-d', (('a' * 5
+0000ee00: 3029 202b 2027 2e27 2920 2a20 3130 5d29  0) + '.') * 10])
+0000ee10: 0a20 2020 2020 2020 2023 2042 6172 6520  .        # Bare 
+0000ee20: 4950 2061 6464 7265 7373 2028 7468 6973  IP address (this
+0000ee30: 2069 7320 6163 7475 616c 6c79 2061 2064   is actually a d
+0000ee40: 6966 6665 7265 6e74 2065 7272 6f72 206d  ifferent error m
+0000ee50: 6573 7361 6765 206e 6f77 290a 2020 2020  essage now).    
+0000ee60: 2020 2020 7769 7468 2070 7974 6573 742e      with pytest.
+0000ee70: 7261 6973 6573 2865 7272 6f72 732e 436f  raises(errors.Co
+0000ee80: 6e66 6967 7572 6174 696f 6e45 7272 6f72  nfigurationError
+0000ee90: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000eea0: 656c 662e 5f63 616c 6c28 5b27 2d64 272c  elf._call(['-d',
+0000eeb0: 2027 3230 342e 3131 2e32 3331 2e33 3527   '204.11.231.35'
+0000eec0: 5d29 0a20 2020 2020 2020 2023 2042 6172  ]).        # Bar
+0000eed0: 6520 4950 7636 2061 6464 7265 7373 0a20  e IPv6 address. 
+0000eee0: 2020 2020 2020 2077 6974 6820 7079 7465         with pyte
+0000eef0: 7374 2e72 6169 7365 7328 6572 726f 7273  st.raises(errors
+0000ef00: 2e43 6f6e 6669 6775 7261 7469 6f6e 4572  .ConfigurationEr
+0000ef10: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+0000ef20: 2020 7365 6c66 2e5f 6361 6c6c 285b 272d    self._call(['-
+0000ef30: 6427 2c20 2732 3030 313a 6462 383a 6163  d', '2001:db8:ac
+0000ef40: 3639 3a33 6666 3a62 3163 623a 6338 6336  69:3ff:b1cb:c8c6
+0000ef50: 3a35 6138 343a 6133 3162 275d 290a 0a20  :5a84:a31b']).. 
+0000ef60: 2020 2064 6566 2074 6573 745f 6373 725f     def test_csr_
+0000ef70: 7769 7468 5f62 6573 7465 6666 6f72 7428  with_besteffort(
+0000ef80: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
+0000ef90: 6974 6820 7079 7465 7374 2e72 6169 7365  ith pytest.raise
+0000efa0: 7328 6572 726f 7273 2e45 7272 6f72 293a  s(errors.Error):
+0000efb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000efc0: 662e 5f63 616c 6c28 2763 6572 746f 6e6c  f._call('certonl
+0000efd0: 7920 2d2d 6373 7220 7b30 7d20 2d2d 616c  y --csr {0} --al
+0000efe0: 6c6f 772d 7375 6273 6574 2d6f 662d 6e61  low-subset-of-na
+0000eff0: 6d65 7327 2e66 6f72 6d61 7428 4353 5229  mes'.format(CSR)
+0000f000: 2e73 706c 6974 2829 290a 0a20 2020 2064  .split())..    d
+0000f010: 6566 2074 6573 745f 7275 6e5f 7769 7468  ef test_run_with
+0000f020: 5f63 7372 2873 656c 6629 3a0a 2020 2020  _csr(self):.    
+0000f030: 2020 2020 2320 5468 6973 2069 7320 616e      # This is an
+0000f040: 2065 7272 6f72 2062 6563 6175 7365 2079   error because y
+0000f050: 6f75 2063 616e 206f 6e6c 7920 7573 6520  ou can only use 
+0000f060: 2d2d 6373 7220 7769 7468 2063 6572 746f  --csr with certo
+0000f070: 6e6c 790a 2020 2020 2020 2020 7472 793a  nly.        try:
+0000f080: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f090: 662e 5f63 616c 6c28 5b27 2d2d 6373 7227  f._call(['--csr'
+0000f0a0: 2c20 4353 525d 290a 2020 2020 2020 2020  , CSR]).        
+0000f0b0: 6578 6365 7074 2065 7272 6f72 732e 4572  except errors.Er
+0000f0c0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0000f0d0: 2020 2020 2020 6173 7365 7274 2022 506c        assert "Pl
+0000f0e0: 6561 7365 2074 7279 2074 6865 2063 6572  ease try the cer
+0000f0f0: 746f 6e6c 7922 2069 6e20 7265 7072 2865  tonly" in repr(e
+0000f100: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000f110: 7475 726e 0a20 2020 2020 2020 2061 7373  turn.        ass
+0000f120: 6572 7420 4661 6c73 652c 2022 4578 7065  ert False, "Expe
+0000f130: 6374 6564 2073 7570 706c 7969 6e67 202d  cted supplying -
+0000f140: 2d63 7372 2074 6f20 6661 696c 2077 6974  -csr to fail wit
+0000f150: 6820 6465 6661 756c 7420 7665 7262 220a  h default verb".
+0000f160: 0a20 2020 2064 6566 2074 6573 745f 6373  .    def test_cs
+0000f170: 725f 7769 7468 5f6e 6f5f 646f 6d61 696e  r_with_no_domain
+0000f180: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000f190: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+0000f1a0: 7365 7328 6572 726f 7273 2e45 7272 6f72  ses(errors.Error
+0000f1b0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000f1c0: 656c 662e 5f63 616c 6c28 2763 6572 746f  elf._call('certo
+0000f1d0: 6e6c 7920 2d2d 6373 7220 7b30 7d27 2e66  nly --csr {0}'.f
+0000f1e0: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
+0000f1f0: 2020 2020 2020 2074 6573 745f 7574 696c         test_util
+0000f200: 2e76 6563 746f 725f 7061 7468 2827 6373  .vector_path('cs
+0000f210: 722d 6e6f 6e61 6d65 735f 3531 322e 7065  r-nonames_512.pe
+0000f220: 6d27 2929 2e73 706c 6974 2829 290a 0a20  m')).split()).. 
+0000f230: 2020 2064 6566 2074 6573 745f 6373 725f     def test_csr_
+0000f240: 7769 7468 5f69 6e63 6f6e 7369 7374 656e  with_inconsisten
+0000f250: 745f 646f 6d61 696e 7328 7365 6c66 293a  t_domains(self):
+0000f260: 0a20 2020 2020 2020 2077 6974 6820 7079  .        with py
+0000f270: 7465 7374 2e72 6169 7365 7328 6572 726f  test.raises(erro
+0000f280: 7273 2e45 7272 6f72 293a 0a20 2020 2020  rs.Error):.     
+0000f290: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
+0000f2a0: 6c28 2763 6572 746f 6e6c 7920 2d64 2065  l('certonly -d e
+0000f2b0: 7861 6d70 6c65 2e6f 7267 202d 2d63 7372  xample.org --csr
+0000f2c0: 207b 307d 272e 666f 726d 6174 2843 5352   {0}'.format(CSR
+0000f2d0: 292e 7370 6c69 7428 2929 0a0a 2020 2020  ).split())..    
+0000f2e0: 6465 6620 5f63 6572 746f 6e6c 795f 6e65  def _certonly_ne
+0000f2f0: 775f 7265 7175 6573 745f 636f 6d6d 6f6e  w_request_common
+0000f300: 2873 656c 662c 206d 6f63 6b5f 636c 6965  (self, mock_clie
+0000f310: 6e74 2c20 6172 6773 3d4e 6f6e 6529 3a0a  nt, args=None):.
+0000f320: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+0000f330: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+0000f340: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+0000f350: 5f66 696e 645f 6c69 6e65 6167 655f 666f  _find_lineage_fo
+0000f360: 725f 646f 6d61 696e 735f 616e 645f 6365  r_domains_and_ce
+0000f370: 7274 6e61 6d65 2729 205c 0a20 2020 2020  rtname') \.     
+0000f380: 2020 2020 2020 2061 7320 6d6f 636b 5f72         as mock_r
+0000f390: 656e 6577 616c 3a0a 2020 2020 2020 2020  enewal:.        
+0000f3a0: 2020 2020 6d6f 636b 5f72 656e 6577 616c      mock_renewal
+0000f3b0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+0000f3c0: 2822 6e65 7763 6572 7422 2c20 4e6f 6e65  ("newcert", None
+0000f3d0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+0000f3e0: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
+0000f3f0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0000f400: 2e6d 6169 6e2e 5f69 6e69 745f 6c65 5f63  .main._init_le_c
+0000f410: 6c69 656e 7427 2920 6173 206d 6f63 6b5f  lient') as mock_
+0000f420: 696e 6974 3a0a 2020 2020 2020 2020 2020  init:.          
+0000f430: 2020 2020 2020 6d6f 636b 5f69 6e69 742e        mock_init.
+0000f440: 7265 7475 726e 5f76 616c 7565 203d 206d  return_value = m
+0000f450: 6f63 6b5f 636c 6965 6e74 0a20 2020 2020  ock_client.     
+0000f460: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
+0000f470: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
+0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f490: 6172 6773 203d 205b 5d0a 2020 2020 2020  args = [].      
+0000f4a0: 2020 2020 2020 2020 2020 6172 6773 202b            args +
+0000f4b0: 3d20 272d 6420 666f 6f2e 6261 7220 2d61  = '-d foo.bar -a
+0000f4c0: 2073 7461 6e64 616c 6f6e 6520 6365 7274   standalone cert
+0000f4d0: 6f6e 6c79 272e 7370 6c69 7428 290a 2020  only'.split().  
+0000f4e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f4f0: 6c66 2e5f 6361 6c6c 2861 7267 7329 0a0a  lf._call(args)..
+0000f500: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+0000f510: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+0000f520: 616c 2e6d 6169 6e2e 5f72 6570 6f72 745f  al.main._report_
+0000f530: 6e65 775f 6365 7274 2729 0a20 2020 2064  new_cert').    d
+0000f540: 6566 2074 6573 745f 6365 7274 6f6e 6c79  ef test_certonly
+0000f550: 5f64 7279 5f72 756e 5f6e 6577 5f72 6571  _dry_run_new_req
+0000f560: 7565 7374 5f73 7563 6365 7373 2873 656c  uest_success(sel
+0000f570: 662c 206d 6f63 6b5f 7265 706f 7274 293a  f, mock_report):
+0000f580: 0a20 2020 2020 2020 206d 6f63 6b5f 636c  .        mock_cl
+0000f590: 6965 6e74 203d 206d 6f63 6b2e 4d61 6769  ient = mock.Magi
+0000f5a0: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
+0000f5b0: 6d6f 636b 5f63 6c69 656e 742e 6f62 7461  mock_client.obta
+0000f5c0: 696e 5f61 6e64 5f65 6e72 6f6c 6c5f 6365  in_and_enroll_ce
+0000f5d0: 7274 6966 6963 6174 652e 7265 7475 726e  rtificate.return
+0000f5e0: 5f76 616c 7565 203d 204e 6f6e 650a 2020  _value = None.  
+0000f5f0: 2020 2020 2020 7365 6c66 2e5f 6365 7274        self._cert
+0000f600: 6f6e 6c79 5f6e 6577 5f72 6571 7565 7374  only_new_request
+0000f610: 5f63 6f6d 6d6f 6e28 6d6f 636b 5f63 6c69  _common(mock_cli
+0000f620: 656e 742c 205b 272d 2d64 7279 2d72 756e  ent, ['--dry-run
+0000f630: 275d 290a 2020 2020 2020 2020 6173 7365  ']).        asse
+0000f640: 7274 206d 6f63 6b5f 636c 6965 6e74 2e6f  rt mock_client.o
+0000f650: 6274 6169 6e5f 616e 645f 656e 726f 6c6c  btain_and_enroll
+0000f660: 5f63 6572 7469 6669 6361 7465 2e63 616c  _certificate.cal
+0000f670: 6c5f 636f 756e 7420 3d3d 2031 0a20 2020  l_count == 1.   
+0000f680: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
+0000f690: 5f72 6570 6f72 742e 6361 6c6c 5f63 6f75  _report.call_cou
+0000f6a0: 6e74 203d 3d20 310a 2020 2020 2020 2020  nt == 1.        
+0000f6b0: 6173 7365 7274 206d 6f63 6b5f 7265 706f  assert mock_repo
+0000f6c0: 7274 2e63 616c 6c5f 6172 6773 5b30 5d5b  rt.call_args[0][
+0000f6d0: 305d 2e64 7279 5f72 756e 2069 7320 5472  0].dry_run is Tr
+0000f6e0: 7565 0a0a 2020 2020 406d 6f63 6b2e 7061  ue..    @mock.pa
+0000f6f0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+0000f700: 7465 726e 616c 2e6d 6169 6e2e 5f72 6570  ternal.main._rep
+0000f710: 6f72 745f 6e65 775f 6365 7274 2729 0a20  ort_new_cert'). 
+0000f720: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+0000f730: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0000f740: 6c2e 6d61 696e 2e75 7469 6c2e 6174 6578  l.main.util.atex
+0000f750: 6974 5f72 6567 6973 7465 7227 290a 2020  it_register').  
+0000f760: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+0000f770: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0000f780: 2e65 6666 2e68 616e 646c 655f 7375 6273  .eff.handle_subs
+0000f790: 6372 6970 7469 6f6e 2729 0a20 2020 2040  cription').    @
+0000f7a0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0000f7b0: 626f 742e 6372 7970 746f 5f75 7469 6c2e  bot.crypto_util.
+0000f7c0: 6e6f 7441 6674 6572 2729 0a20 2020 2064  notAfter').    d
+0000f7d0: 6566 2074 6573 745f 6365 7274 6f6e 6c79  ef test_certonly
+0000f7e0: 5f6e 6577 5f72 6571 7565 7374 5f73 7563  _new_request_suc
+0000f7f0: 6365 7373 2873 656c 662c 206d 6f63 6b5f  cess(self, mock_
+0000f800: 6e6f 7441 6674 6572 2c0a 2020 2020 2020  notAfter,.      
+0000f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f830: 2020 2020 6d6f 636b 5f73 7562 7363 7269      mock_subscri
+0000f840: 7074 696f 6e2c 206d 6f63 6b5f 7265 6769  ption, mock_regi
+0000f850: 7374 6572 2c20 6d6f 636b 5f72 6570 6f72  ster, mock_repor
+0000f860: 7429 3a0a 2020 2020 2020 2020 6365 7274  t):.        cert
+0000f870: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+0000f880: 6e6f 726d 7061 7468 286f 732e 7061 7468  normpath(os.path
+0000f890: 2e6a 6f69 6e28 7365 6c66 2e63 6f6e 6669  .join(self.confi
+0000f8a0: 672e 636f 6e66 6967 5f64 6972 2c20 276c  g.config_dir, 'l
+0000f8b0: 6976 652f 666f 6f2e 6261 7227 2929 0a20  ive/foo.bar')). 
+0000f8c0: 2020 2020 2020 206b 6579 5f70 6174 6820         key_path 
+0000f8d0: 3d20 6f73 2e70 6174 682e 6e6f 726d 7061  = os.path.normpa
+0000f8e0: 7468 286f 732e 7061 7468 2e6a 6f69 6e28  th(os.path.join(
+0000f8f0: 7365 6c66 2e63 6f6e 6669 672e 636f 6e66  self.config.conf
+0000f900: 6967 5f64 6972 2c20 276c 6976 652f 6261  ig_dir, 'live/ba
+0000f910: 7a2e 7175 7827 2929 0a20 2020 2020 2020  z.qux')).       
+0000f920: 2064 6174 6520 3d20 2731 3937 302d 3031   date = '1970-01
+0000f930: 2d30 3127 0a20 2020 2020 2020 206d 6f63  -01'.        moc
+0000f940: 6b5f 6e6f 7441 6674 6572 2829 2e64 6174  k_notAfter().dat
+0000f950: 652e 7265 7475 726e 5f76 616c 7565 203d  e.return_value =
+0000f960: 2064 6174 650a 0a20 2020 2020 2020 206d   date..        m
+0000f970: 6f63 6b5f 6c69 6e65 6167 6520 3d20 6d6f  ock_lineage = mo
+0000f980: 636b 2e4d 6167 6963 4d6f 636b 2863 6572  ck.MagicMock(cer
+0000f990: 743d 6365 7274 5f70 6174 682c 2066 756c  t=cert_path, ful
+0000f9a0: 6c63 6861 696e 3d63 6572 745f 7061 7468  lchain=cert_path
+0000f9b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9d0: 2020 2020 2020 2020 6675 6c6c 6368 6169          fullchai
+0000f9e0: 6e5f 7061 7468 3d63 6572 745f 7061 7468  n_path=cert_path
+0000f9f0: 2c20 6b65 795f 7061 7468 3d6b 6579 5f70  , key_path=key_p
+0000fa00: 6174 6829 0a20 2020 2020 2020 206d 6f63  ath).        moc
+0000fa10: 6b5f 636c 6965 6e74 203d 206d 6f63 6b2e  k_client = mock.
+0000fa20: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+0000fa30: 2020 2020 6d6f 636b 5f63 6c69 656e 742e      mock_client.
+0000fa40: 6f62 7461 696e 5f61 6e64 5f65 6e72 6f6c  obtain_and_enrol
+0000fa50: 6c5f 6365 7274 6966 6963 6174 652e 7265  l_certificate.re
+0000fa60: 7475 726e 5f76 616c 7565 203d 206d 6f63  turn_value = moc
+0000fa70: 6b5f 6c69 6e65 6167 650a 2020 2020 2020  k_lineage.      
+0000fa80: 2020 7365 6c66 2e5f 6365 7274 6f6e 6c79    self._certonly
+0000fa90: 5f6e 6577 5f72 6571 7565 7374 5f63 6f6d  _new_request_com
+0000faa0: 6d6f 6e28 6d6f 636b 5f63 6c69 656e 7429  mon(mock_client)
+0000fab0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0000fac0: 6d6f 636b 5f63 6c69 656e 742e 6f62 7461  mock_client.obta
+0000fad0: 696e 5f61 6e64 5f65 6e72 6f6c 6c5f 6365  in_and_enroll_ce
+0000fae0: 7274 6966 6963 6174 652e 6361 6c6c 5f63  rtificate.call_c
+0000faf0: 6f75 6e74 203d 3d20 310a 2020 2020 2020  ount == 1.      
+0000fb00: 2020 6173 7365 7274 206d 6f63 6b5f 7265    assert mock_re
+0000fb10: 706f 7274 2e63 616c 6c5f 636f 756e 7420  port.call_count 
+0000fb20: 3d3d 2031 0a20 2020 2020 2020 2061 7373  == 1.        ass
+0000fb30: 6572 7420 6365 7274 5f70 6174 6820 696e  ert cert_path in
+0000fb40: 206d 6f63 6b5f 7265 706f 7274 2e63 616c   mock_report.cal
+0000fb50: 6c5f 6172 6773 5b30 5d5b 325d 0a20 2020  l_args[0][2].   
+0000fb60: 2020 2020 2061 7373 6572 7420 6b65 795f       assert key_
+0000fb70: 7061 7468 2069 6e20 6d6f 636b 5f72 6570  path in mock_rep
+0000fb80: 6f72 742e 6361 6c6c 5f61 7267 735b 305d  ort.call_args[0]
+0000fb90: 5b33 5d0a 2020 2020 2020 2020 6173 7365  [3].        asse
+0000fba0: 7274 2027 646f 6e61 7465 2720 696e 206d  rt 'donate' in m
+0000fbb0: 6f63 6b5f 7265 6769 7374 6572 2e63 616c  ock_register.cal
+0000fbc0: 6c5f 6172 6773 5b30 5d5b 315d 0a20 2020  l_args[0][1].   
+0000fbd0: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
+0000fbe0: 5f73 7562 7363 7269 7074 696f 6e2e 6361  _subscription.ca
+0000fbf0: 6c6c 6564 2069 7320 5472 7565 0a0a 2020  lled is True..  
+0000fc00: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+0000fc10: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0000fc20: 2e65 6666 2e68 616e 646c 655f 7375 6273  .eff.handle_subs
+0000fc30: 6372 6970 7469 6f6e 2729 0a20 2020 2064  cription').    d
+0000fc40: 6566 2074 6573 745f 6365 7274 6f6e 6c79  ef test_certonly
+0000fc50: 5f6e 6577 5f72 6571 7565 7374 5f66 6169  _new_request_fai
+0000fc60: 6c75 7265 2873 656c 662c 206d 6f63 6b5f  lure(self, mock_
+0000fc70: 7375 6273 6372 6970 7469 6f6e 293a 0a20  subscription):. 
+0000fc80: 2020 2020 2020 206d 6f63 6b5f 636c 6965         mock_clie
+0000fc90: 6e74 203d 206d 6f63 6b2e 4d61 6769 634d  nt = mock.MagicM
+0000fca0: 6f63 6b28 290a 2020 2020 2020 2020 6d6f  ock().        mo
+0000fcb0: 636b 5f63 6c69 656e 742e 6f62 7461 696e  ck_client.obtain
+0000fcc0: 5f61 6e64 5f65 6e72 6f6c 6c5f 6365 7274  _and_enroll_cert
+0000fcd0: 6966 6963 6174 652e 7265 7475 726e 5f76  ificate.return_v
+0000fce0: 616c 7565 203d 2046 616c 7365 0a20 2020  alue = False.   
+0000fcf0: 2020 2020 2077 6974 6820 7079 7465 7374       with pytest
+0000fd00: 2e72 6169 7365 7328 6572 726f 7273 2e45  .raises(errors.E
+0000fd10: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+0000fd20: 2020 2073 656c 662e 5f63 6572 746f 6e6c     self._certonl
+0000fd30: 795f 6e65 775f 7265 7175 6573 745f 636f  y_new_request_co
+0000fd40: 6d6d 6f6e 286d 6f63 6b5f 636c 6965 6e74  mmon(mock_client
+0000fd50: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+0000fd60: 206d 6f63 6b5f 7375 6273 6372 6970 7469   mock_subscripti
+0000fd70: 6f6e 2e63 616c 6c65 6420 6973 2046 616c  on.called is Fal
+0000fd80: 7365 0a0a 2020 2020 6465 6620 5f74 6573  se..    def _tes
+0000fd90: 745f 7265 6e65 7761 6c5f 636f 6d6d 6f6e  t_renewal_common
+0000fda0: 2873 656c 662c 2064 7565 5f66 6f72 5f72  (self, due_for_r
+0000fdb0: 656e 6577 616c 2c20 6578 7472 615f 6172  enewal, extra_ar
+0000fdc0: 6773 2c20 6c6f 675f 6f75 743d 4e6f 6e65  gs, log_out=None
+0000fdd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fde0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000fdf0: 7267 733d 4e6f 6e65 2c20 7368 6f75 6c64  rgs=None, should
+0000fe00: 5f72 656e 6577 3d54 7275 652c 2065 7272  _renew=True, err
+0000fe10: 6f72 5f65 7870 6563 7465 643d 4661 6c73  or_expected=Fals
+0000fe20: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe40: 7175 6965 745f 6d6f 6465 3d46 616c 7365  quiet_mode=False
+0000fe50: 2c20 6578 7069 7279 5f64 6174 653d 6461  , expiry_date=da
+0000fe60: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0000fe70: 6e6f 7728 292c 0a20 2020 2020 2020 2020  now(),.         
+0000fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe90: 2020 2020 7265 7573 655f 6b65 793d 4661      reuse_key=Fa
+0000fea0: 6c73 652c 206e 6577 5f6b 6579 3d46 616c  lse, new_key=Fal
+0000feb0: 7365 293a 0a20 2020 2020 2020 2063 6572  se):.        cer
+0000fec0: 745f 7061 7468 203d 2074 6573 745f 7574  t_path = test_ut
+0000fed0: 696c 2e76 6563 746f 725f 7061 7468 2827  il.vector_path('
+0000fee0: 6365 7274 5f35 3132 2e70 656d 2729 0a20  cert_512.pem'). 
+0000fef0: 2020 2020 2020 2063 6861 696e 5f70 6174         chain_pat
+0000ff00: 6820 3d20 6f73 2e70 6174 682e 6e6f 726d  h = os.path.norm
+0000ff10: 7061 7468 286f 732e 7061 7468 2e6a 6f69  path(os.path.joi
+0000ff20: 6e28 7365 6c66 2e63 6f6e 6669 672e 636f  n(self.config.co
+0000ff30: 6e66 6967 5f64 6972 2c0a 2020 2020 2020  nfig_dir,.      
+0000ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff60: 2020 2020 2020 2020 2020 2020 2027 6c69               'li
+0000ff70: 7665 2f66 6f6f 2e62 6172 2f66 756c 6c63  ve/foo.bar/fullc
+0000ff80: 6861 696e 2e70 656d 2729 290a 2020 2020  hain.pem')).    
+0000ff90: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
+0000ffa0: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
+0000ffb0: 6b28 6365 7274 3d63 6572 745f 7061 7468  k(cert=cert_path
+0000ffc0: 2c20 6675 6c6c 6368 6169 6e3d 6368 6169  , fullchain=chai
+0000ffd0: 6e5f 7061 7468 2c0a 2020 2020 2020 2020  n_path,.        
+0000ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fff0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00010000: 7274 5f70 6174 683d 6365 7274 5f70 6174  rt_path=cert_pat
+00010010: 682c 2066 756c 6c63 6861 696e 5f70 6174  h, fullchain_pat
+00010020: 683d 6368 6169 6e5f 7061 7468 290a 2020  h=chain_path).  
+00010030: 2020 2020 2020 6d6f 636b 5f6c 696e 6561        mock_linea
+00010040: 6765 2e73 686f 756c 645f 6175 746f 7265  ge.should_autore
+00010050: 6e65 772e 7265 7475 726e 5f76 616c 7565  new.return_value
+00010060: 203d 2064 7565 5f66 6f72 5f72 656e 6577   = due_for_renew
+00010070: 616c 0a20 2020 2020 2020 206d 6f63 6b5f  al.        mock_
+00010080: 6c69 6e65 6167 652e 6861 735f 7065 6e64  lineage.has_pend
+00010090: 696e 675f 6465 706c 6f79 6d65 6e74 2e72  ing_deployment.r
+000100a0: 6574 7572 6e5f 7661 6c75 6520 3d20 4661  eturn_value = Fa
+000100b0: 6c73 650a 2020 2020 2020 2020 6d6f 636b  lse.        mock
+000100c0: 5f6c 696e 6561 6765 2e6e 616d 6573 2e72  _lineage.names.r
+000100d0: 6574 7572 6e5f 7661 6c75 6520 3d20 5b27  eturn_value = ['
+000100e0: 6973 6e6f 742e 6f72 6727 5d0a 2020 2020  isnot.org'].    
+000100f0: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
+00010100: 2e70 7269 7661 7465 5f6b 6579 5f74 7970  .private_key_typ
+00010110: 6520 3d20 2765 6364 7361 270a 2020 2020  e = 'ecdsa'.    
+00010120: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
+00010130: 2e65 6c6c 6970 7469 635f 6375 7276 6520  .elliptic_curve 
+00010140: 3d20 2773 6563 7032 3536 7231 270a 2020  = 'secp256r1'.  
+00010150: 2020 2020 2020 6d6f 636b 5f6c 696e 6561        mock_linea
+00010160: 6765 2e72 6575 7365 5f6b 6579 203d 2072  ge.reuse_key = r
+00010170: 6575 7365 5f6b 6579 0a20 2020 2020 2020  euse_key.       
+00010180: 206d 6f63 6b5f 6365 7274 7220 3d20 6d6f   mock_certr = mo
+00010190: 636b 2e4d 6167 6963 4d6f 636b 2829 0a20  ck.MagicMock(). 
+000101a0: 2020 2020 2020 206d 6f63 6b5f 6b65 7920         mock_key 
+000101b0: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
+000101c0: 2870 656d 3d27 7065 6d5f 6b65 7927 290a  (pem='pem_key').
+000101d0: 2020 2020 2020 2020 6d6f 636b 5f63 6c69          mock_cli
+000101e0: 656e 7420 3d20 6d6f 636b 2e4d 6167 6963  ent = mock.Magic
+000101f0: 4d6f 636b 2829 0a20 2020 2020 2020 2073  Mock().        s
+00010200: 7464 6f75 7420 3d20 696f 2e53 7472 696e  tdout = io.Strin
+00010210: 6749 4f28 290a 2020 2020 2020 2020 6d6f  gIO().        mo
+00010220: 636b 5f63 6c69 656e 742e 6f62 7461 696e  ck_client.obtain
+00010230: 5f63 6572 7469 6669 6361 7465 2e72 6574  _certificate.ret
+00010240: 7572 6e5f 7661 6c75 6520 3d20 286d 6f63  urn_value = (moc
+00010250: 6b5f 6365 7274 722c 2027 6368 6169 6e27  k_certr, 'chain'
+00010260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010290: 2020 2020 2020 2020 206d 6f63 6b5f 6b65           mock_ke
+000102a0: 792c 2027 6373 7227 290a 0a20 2020 2020  y, 'csr')..     
+000102b0: 2020 2064 6566 2077 7269 7465 5f6d 7367     def write_msg
+000102c0: 286d 6573 7361 6765 2c20 2a61 7267 732c  (message, *args,
+000102d0: 202a 2a6b 7761 7267 7329 3a20 2023 2070   **kwargs):  # p
+000102e0: 796c 696e 743a 2064 6973 6162 6c65 3d75  ylint: disable=u
+000102f0: 6e75 7365 642d 6172 6775 6d65 6e74 0a20  nused-argument. 
+00010300: 2020 2020 2020 2020 2020 2022 2222 5772             """Wr
+00010310: 6974 6520 6d65 7373 6167 6520 746f 2073  ite message to s
+00010320: 7464 6f75 742e 2222 220a 2020 2020 2020  tdout.""".      
+00010330: 2020 2020 2020 7374 646f 7574 2e77 7269        stdout.wri
+00010340: 7465 286d 6573 7361 6765 290a 0a20 2020  te(message)..   
+00010350: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00010360: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+00010370: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00010380: 696e 7465 726e 616c 2e63 6572 745f 6d61  internal.cert_ma
+00010390: 6e61 6765 722e 6669 6e64 5f64 7570 6c69  nager.find_dupli
+000103a0: 6361 7469 7665 5f63 6572 7473 2729 2061  cative_certs') a
+000103b0: 7320 6d6f 636b 5f66 6463 3a0a 2020 2020  s mock_fdc:.    
+000103c0: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
+000103d0: 5f66 6463 2e72 6574 7572 6e5f 7661 6c75  _fdc.return_valu
+000103e0: 6520 3d20 286d 6f63 6b5f 6c69 6e65 6167  e = (mock_lineag
+000103f0: 652c 204e 6f6e 6529 0a20 2020 2020 2020  e, None).       
+00010400: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+00010410: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00010420: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00010430: 2e5f 696e 6974 5f6c 655f 636c 6965 6e74  ._init_le_client
+00010440: 2729 2061 7320 6d6f 636b 5f69 6e69 743a  ') as mock_init:
+00010450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010460: 2020 2020 206d 6f63 6b5f 696e 6974 2e72       mock_init.r
+00010470: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
+00010480: 636b 5f63 6c69 656e 740a 2020 2020 2020  ck_client.      
+00010490: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+000104a0: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
+000104b0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+000104c0: 2e64 6973 706c 6179 2e6f 626a 2e67 6574  .display.obj.get
+000104d0: 5f64 6973 706c 6179 2729 2061 7320 6d6f  _display') as mo
+000104e0: 636b 5f64 6973 706c 6179 3a0a 2020 2020  ck_display:.    
+000104f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010500: 2020 2020 6966 206e 6f74 2071 7569 6574      if not quiet
+00010510: 5f6d 6f64 653a 0a20 2020 2020 2020 2020  _mode:.         
+00010520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010530: 2020 206d 6f63 6b5f 6469 7370 6c61 7928     mock_display(
+00010540: 292e 6e6f 7469 6669 6361 7469 6f6e 2e73  ).notification.s
+00010550: 6964 655f 6566 6665 6374 203d 2077 7269  ide_effect = wri
+00010560: 7465 5f6d 7367 0a20 2020 2020 2020 2020  te_msg.         
+00010570: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00010580: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+00010590: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+000105a0: 6c2e 6d61 696e 2e72 656e 6577 616c 2e63  l.main.renewal.c
+000105b0: 7279 7074 6f5f 7574 696c 2729 205c 0a20  rypto_util') \. 
+000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105d0: 2020 2020 2020 2020 2020 2061 7320 6d6f             as mo
+000105e0: 636b 5f63 7279 7074 6f5f 7574 696c 3a0a  ck_crypto_util:.
+000105f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010600: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
+00010610: 5f63 7279 7074 6f5f 7574 696c 2e6e 6f74  _crypto_util.not
+00010620: 4166 7465 722e 7265 7475 726e 5f76 616c  After.return_val
+00010630: 7565 203d 2065 7870 6972 795f 6461 7465  ue = expiry_date
+00010640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010650: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+00010660: 6820 6d6f 636b 2e70 6174 6368 2827 6365  h mock.patch('ce
+00010670: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00010680: 6566 662e 6861 6e64 6c65 5f73 7562 7363  eff.handle_subsc
+00010690: 7269 7074 696f 6e27 293a 0a20 2020 2020  ription'):.     
+000106a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000106c0: 7420 6172 6773 3a0a 2020 2020 2020 2020  t args:.        
+000106d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106e0: 2020 2020 2020 2020 2020 2020 6172 6773              args
+000106f0: 203d 205b 272d 6427 2c20 2769 736e 6f74   = ['-d', 'isnot
+00010700: 2e6f 7267 272c 2027 2d61 272c 2027 7374  .org', '-a', 'st
+00010710: 616e 6461 6c6f 6e65 272c 2027 6365 7274  andalone', 'cert
+00010720: 6f6e 6c79 275d 0a20 2020 2020 2020 2020  only'].         
 00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010750: 2020 7261 6973 6520 4173 7365 7274 696f    raise Assertio
-00010760: 6e45 7272 6f72 280a 2020 2020 2020 2020  nError(.        
-00010770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010790: 2020 2020 2255 6e65 7870 6563 7465 6420      "Unexpected 
-000107a0: 7265 6e65 7761 6c20 6572 726f 723a 5c6e  renewal error:\n
-000107b0: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
+00010740: 2020 2020 2020 2069 6620 6578 7472 615f         if extra_
+00010750: 6172 6773 3a0a 2020 2020 2020 2020 2020  args:.          
+00010760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010770: 2020 2020 2020 2020 2020 6172 6773 202b            args +
+00010780: 3d20 6578 7472 615f 6172 6773 0a20 2020  = extra_args.   
+00010790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107a0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+000107b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 000107c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107e0: 7472 6163 6562 6163 6b2e 666f 726d 6174  traceback.format
-000107f0: 5f65 7863 2829 290a 0a20 2020 2020 2020  _exc())..       
-00010800: 2020 2020 2069 6620 7368 6f75 6c64 5f72       if should_r
-00010810: 656e 6577 3a0a 2020 2020 2020 2020 2020  enew:.          
-00010820: 2020 2020 2020 6966 2072 6575 7365 5f6b        if reuse_k
-00010830: 6579 2061 6e64 206e 6f74 206e 6577 5f6b  ey and not new_k
-00010840: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
-00010850: 2020 2020 2020 2020 2320 5468 6520 6c6f          # The lo
-00010860: 6361 7469 6f6e 206f 6620 7468 6520 7072  cation of the pr
-00010870: 6576 696f 7573 206c 6976 6520 7072 6976  evious live priv
-00010880: 6b65 792e 7065 6d20 6973 2070 6173 7365  key.pem is passe
-00010890: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-000108a0: 2020 2020 2020 2320 746f 206f 6274 6169        # to obtai
-000108b0: 6e5f 6365 7274 6966 6963 6174 650a 2020  n_certificate.  
+000107d0: 2020 2020 2020 7265 742c 2073 7464 6f75        ret, stdou
+000107e0: 742c 205f 2c20 5f20 3d20 7365 6c66 2e5f  t, _, _ = self._
+000107f0: 6361 6c6c 2861 7267 732c 2073 7464 6f75  call(args, stdou
+00010800: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00010810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010820: 2020 2020 2020 2069 6620 7265 743a 0a20         if ret:. 
+00010830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010850: 2020 2020 2020 2070 7269 6e74 2822 5265         print("Re
+00010860: 7475 726e 6564 222c 2072 6574 290a 2020  turned", ret).  
+00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010890: 2020 2020 2020 7261 6973 6520 4173 7365        raise Asse
+000108a0: 7274 696f 6e45 7272 6f72 2872 6574 290a  rtionError(ret).
+000108b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000108c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108d0: 2020 6d6f 636b 5f63 6c69 656e 742e 6f62    mock_client.ob
-000108e0: 7461 696e 5f63 6572 7469 6669 6361 7465  tain_certificate
-000108f0: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
-00010900: 6e63 655f 7769 7468 285b 6d6f 636b 2e41  nce_with([mock.A
-00010910: 4e59 5d2c 0a20 2020 2020 2020 2020 2020  NY],.           
-00010920: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00010930: 7061 7468 2e6e 6f72 6d70 6174 6828 6f73  path.normpath(os
-00010940: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
-00010950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010960: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00010970: 6669 672e 636f 6e66 6967 5f64 6972 2c20  fig.config_dir, 
-00010980: 226c 6976 652f 7361 6d70 6c65 2d72 656e  "live/sample-ren
-00010990: 6577 616c 2f70 7269 766b 6579 2e70 656d  ewal/privkey.pem
-000109a0: 2229 2929 0a20 2020 2020 2020 2020 2020  "))).           
-000109b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000109c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000109d0: 6f63 6b5f 636c 6965 6e74 2e6f 6274 6169  ock_client.obtai
-000109e0: 6e5f 6365 7274 6966 6963 6174 652e 6173  n_certificate.as
-000109f0: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
-00010a00: 5f77 6974 6828 5b6d 6f63 6b2e 414e 595d  _with([mock.ANY]
-00010a10: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-00010a20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00010a30: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00010a40: 206d 6f63 6b5f 636c 6965 6e74 2e6f 6274   mock_client.obt
-00010a50: 6169 6e5f 6365 7274 6966 6963 6174 652e  ain_certificate.
-00010a60: 6361 6c6c 5f63 6f75 6e74 203d 3d20 300a  call_count == 0.
-00010a70: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00010a80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010a90: 2e5f 6475 6d70 5f6c 6f67 2829 0a20 2020  ._dump_log().   
-00010aa0: 2020 2020 2020 2020 2072 6169 7365 0a20           raise. 
-00010ab0: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
-00010ac0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00010ad0: 6f67 5f6f 7574 3a0a 2020 2020 2020 2020  og_out:.        
-00010ae0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00010af0: 6e28 6f73 2e70 6174 682e 6a6f 696e 2873  n(os.path.join(s
-00010b00: 656c 662e 636f 6e66 6967 2e6c 6f67 735f  elf.config.logs_
-00010b10: 6469 722c 2022 6c65 7473 656e 6372 7970  dir, "letsencryp
-00010b20: 742e 6c6f 6722 2929 2061 7320 6c66 3a0a  t.log")) as lf:.
-00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b40: 2020 2020 6173 7365 7274 206c 6f67 5f6f      assert log_o
-00010b50: 7574 2069 6e20 6c66 2e72 6561 6428 290a  ut in lf.read().
-00010b60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010b70: 6d6f 636b 5f6c 696e 6561 6765 2c20 6d6f  mock_lineage, mo
-00010b80: 636b 5f64 6973 706c 6179 2c20 7374 646f  ck_display, stdo
-00010b90: 7574 0a0a 2020 2020 406d 6f63 6b2e 7061  ut..    @mock.pa
-00010ba0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00010bb0: 7465 726e 616c 2e6d 6169 6e2e 5f72 6570  ternal.main._rep
-00010bc0: 6f72 745f 6e65 775f 6365 7274 2729 0a20  ort_new_cert'). 
-00010bd0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-00010be0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00010bf0: 6c2e 6d61 696e 2e75 7469 6c2e 6174 6578  l.main.util.atex
-00010c00: 6974 5f72 6567 6973 7465 7227 290a 2020  it_register').  
-00010c10: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
-00010c20: 6572 7462 6f74 2e63 7279 7074 6f5f 7574  ertbot.crypto_ut
-00010c30: 696c 2e6e 6f74 4166 7465 7227 290a 2020  il.notAfter').  
-00010c40: 2020 6465 6620 7465 7374 5f63 6572 746f    def test_certo
-00010c50: 6e6c 795f 7265 6e65 7761 6c28 7365 6c66  nly_renewal(self
-00010c60: 2c20 5f2c 206d 6f63 6b5f 7265 6769 7374  , _, mock_regist
-00010c70: 6572 2c20 6d6f 636b 5f72 6570 6f72 7429  er, mock_report)
-00010c80: 3a0a 2020 2020 2020 2020 6c69 6e65 6167  :.        lineag
-00010c90: 652c 205f 2c20 5f20 3d20 7365 6c66 2e5f  e, _, _ = self._
-00010ca0: 7465 7374 5f72 656e 6577 616c 5f63 6f6d  test_renewal_com
-00010cb0: 6d6f 6e28 5472 7565 2c20 5b5d 290a 2020  mon(True, []).  
-00010cc0: 2020 2020 2020 6173 7365 7274 206c 696e        assert lin
-00010cd0: 6561 6765 2e73 6176 655f 7375 6363 6573  eage.save_succes
-00010ce0: 736f 722e 6361 6c6c 5f63 6f75 6e74 203d  sor.call_count =
-00010cf0: 3d20 310a 2020 2020 2020 2020 6c69 6e65  = 1.        line
-00010d00: 6167 652e 7570 6461 7465 5f61 6c6c 5f6c  age.update_all_l
-00010d10: 696e 6b73 5f74 6f2e 6173 7365 7274 5f63  inks_to.assert_c
-00010d20: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
-00010d30: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-00010d40: 6561 6765 2e6c 6174 6573 745f 636f 6d6d  eage.latest_comm
-00010d50: 6f6e 5f76 6572 7369 6f6e 2829 290a 2020  on_version()).  
-00010d60: 2020 2020 2020 6173 7365 7274 206d 6f63        assert moc
-00010d70: 6b5f 7265 706f 7274 2e63 616c 6c5f 636f  k_report.call_co
-00010d80: 756e 7420 3d3d 2031 0a20 2020 2020 2020  unt == 1.       
-00010d90: 2061 7373 6572 7420 2766 756c 6c63 6861   assert 'fullcha
-00010da0: 696e 2e70 656d 2720 696e 206d 6f63 6b5f  in.pem' in mock_
-00010db0: 7265 706f 7274 2e63 616c 6c5f 6172 6773  report.call_args
-00010dc0: 5b30 5d5b 325d 0a20 2020 2020 2020 2061  [0][2].        a
-00010dd0: 7373 6572 7420 2764 6f6e 6174 6527 2069  ssert 'donate' i
-00010de0: 6e20 6d6f 636b 5f72 6567 6973 7465 722e  n mock_register.
-00010df0: 6361 6c6c 5f61 7267 735b 305d 5b31 5d0a  call_args[0][1].
-00010e00: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-00010e10: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-00010e20: 6e61 6c2e 6d61 696e 2e64 6973 706c 6179  nal.main.display
-00010e30: 5f75 7469 6c2e 6e6f 7469 6679 2729 0a20  _util.notify'). 
-00010e40: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-00010e50: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00010e60: 6c2e 6c6f 672e 6c6f 6767 696e 672e 6861  l.log.logging.ha
-00010e70: 6e64 6c65 7273 2e52 6f74 6174 696e 6746  ndlers.RotatingF
-00010e80: 696c 6548 616e 646c 6572 2e64 6f52 6f6c  ileHandler.doRol
-00010e90: 6c6f 7665 7227 290a 2020 2020 406d 6f63  lover').    @moc
-00010ea0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00010eb0: 2e63 7279 7074 6f5f 7574 696c 2e6e 6f74  .crypto_util.not
-00010ec0: 4166 7465 7227 290a 2020 2020 6465 6620  After').    def 
-00010ed0: 7465 7374 5f63 6572 746f 6e6c 795f 7265  test_certonly_re
-00010ee0: 6e65 7761 6c5f 7472 6967 6765 7273 2873  newal_triggers(s
-00010ef0: 656c 662c 205f 2c20 5f5f 2c20 6d6f 636b  elf, _, __, mock
-00010f00: 5f6e 6f74 6966 7929 3a0a 2020 2020 2020  _notify):.      
-00010f10: 2020 2320 2d2d 6472 792d 7275 6e20 7368    # --dry-run sh
-00010f20: 6f75 6c64 2066 6f72 6365 2072 656e 6577  ould force renew
-00010f30: 616c 0a20 2020 2020 2020 205f 2c20 5f2c  al.        _, _,
-00010f40: 205f 203d 2073 656c 662e 5f74 6573 745f   _ = self._test_
-00010f50: 7265 6e65 7761 6c5f 636f 6d6d 6f6e 2846  renewal_common(F
-00010f60: 616c 7365 2c20 5b27 2d2d 6472 792d 7275  alse, ['--dry-ru
-00010f70: 6e27 2c20 272d 2d6b 6565 7027 5d2c 0a20  n', '--keep'],. 
-00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fb0: 2020 2020 206c 6f67 5f6f 7574 3d22 7369       log_out="si
-00010fc0: 6d75 6c61 7469 6e67 2072 656e 6577 616c  mulating renewal
-00010fd0: 2229 0a20 2020 2020 2020 206d 6f63 6b5f  ").        mock_
-00010fe0: 6e6f 7469 6679 2e61 7373 6572 745f 616e  notify.assert_an
-00010ff0: 795f 6361 6c6c 2827 5468 6520 6472 7920  y_call('The dry 
-00011000: 7275 6e20 7761 7320 7375 6363 6573 7366  run was successf
-00011010: 756c 2e27 290a 0a20 2020 2020 2020 2073  ul.')..        s
-00011020: 656c 662e 5f74 6573 745f 7265 6e65 7761  elf._test_renewa
-00011030: 6c5f 636f 6d6d 6f6e 2846 616c 7365 2c20  l_common(False, 
-00011040: 5b27 2d2d 7265 6e65 772d 6279 2d64 6566  ['--renew-by-def
-00011050: 6175 6c74 272c 2027 2d74 7676 272c 2027  ault', '-tvv', '
-00011060: 2d2d 6465 6275 6727 5d2c 0a20 2020 2020  --debug'],.     
-00011070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011080: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-00011090: 5f6f 7574 3d22 4175 746f 2d72 656e 6577  _out="Auto-renew
-000110a0: 616c 2066 6f72 6365 6422 290a 0a20 2020  al forced")..   
-000110b0: 2020 2020 205f 2c20 6d6f 636b 5f64 6973       _, mock_dis
-000110c0: 706c 6179 6572 2c20 5f20 3d20 7365 6c66  player, _ = self
-000110d0: 2e5f 7465 7374 5f72 656e 6577 616c 5f63  ._test_renewal_c
-000110e0: 6f6d 6d6f 6e28 4661 6c73 652c 205b 272d  ommon(False, ['-
-000110f0: 7476 7627 2c20 272d 2d64 6562 7567 272c  tvv', '--debug',
-00011100: 2027 2d2d 6b65 6570 275d 2c0a 2020 2020   '--keep'],.    
-00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011120: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00011130: 6f75 6c64 5f72 656e 6577 3d46 616c 7365  ould_renew=False
-00011140: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00011150: 2027 6e6f 7420 7965 7420 6475 6527 2069   'not yet due' i
-00011160: 6e20 6d6f 636b 5f64 6973 706c 6179 6572  n mock_displayer
-00011170: 2829 2e6e 6f74 6966 6963 6174 696f 6e2e  ().notification.
-00011180: 6361 6c6c 5f61 7267 735b 305d 5b30 5d0a  call_args[0][0].
-00011190: 0a20 2020 2064 6566 205f 6475 6d70 5f6c  .    def _dump_l
-000111a0: 6f67 2873 656c 6629 3a0a 2020 2020 2020  og(self):.      
-000111b0: 2020 7072 696e 7428 224c 6f67 733a 2229    print("Logs:")
-000111c0: 0a20 2020 2020 2020 206c 6f67 5f70 6174  .        log_pat
-000111d0: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
-000111e0: 2873 656c 662e 636f 6e66 6967 2e6c 6f67  (self.config.log
-000111f0: 735f 6469 722c 2022 6c65 7473 656e 6372  s_dir, "letsencr
-00011200: 7970 742e 6c6f 6722 290a 2020 2020 2020  ypt.log").      
-00011210: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00011220: 7374 7328 6c6f 675f 7061 7468 293a 0a20  sts(log_path):. 
-00011230: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00011240: 6f70 656e 286c 6f67 5f70 6174 6829 2061  open(log_path) a
-00011250: 7320 6c66 3a0a 2020 2020 2020 2020 2020  s lf:.          
-00011260: 2020 2020 2020 7072 696e 7428 6c66 2e72        print(lf.r
-00011270: 6561 6428 2929 0a0a 2020 2020 6465 6620  ead())..    def 
-00011280: 7465 7374 5f72 656e 6577 5f76 6572 6228  test_renew_verb(
-00011290: 7365 6c66 293a 0a20 2020 2020 2020 2074  self):.        t
-000112a0: 6573 745f 7574 696c 2e6d 616b 655f 6c69  est_util.make_li
-000112b0: 6e65 6167 6528 7365 6c66 2e63 6f6e 6669  neage(self.confi
-000112c0: 672e 636f 6e66 6967 5f64 6972 2c20 2773  g.config_dir, 's
-000112d0: 616d 706c 652d 7265 6e65 7761 6c2e 636f  ample-renewal.co
-000112e0: 6e66 2729 0a20 2020 2020 2020 2061 7267  nf').        arg
-000112f0: 7320 3d20 5b22 7265 6e65 7722 2c20 222d  s = ["renew", "-
-00011300: 2d64 7279 2d72 756e 222c 2022 2d74 7676  -dry-run", "-tvv
-00011310: 225d 0a20 2020 2020 2020 2073 656c 662e  "].        self.
-00011320: 5f74 6573 745f 7265 6e65 7761 6c5f 636f  _test_renewal_co
-00011330: 6d6d 6f6e 2854 7275 652c 205b 5d2c 2061  mmon(True, [], a
-00011340: 7267 733d 6172 6773 2c20 7368 6f75 6c64  rgs=args, should
-00011350: 5f72 656e 6577 3d54 7275 6529 0a0a 2020  _renew=True)..  
-00011360: 2020 6465 6620 7465 7374 5f72 6575 7365    def test_reuse
-00011370: 5f6b 6579 2873 656c 6629 3a0a 2020 2020  _key(self):.    
-00011380: 2020 2020 7465 7374 5f75 7469 6c2e 6d61      test_util.ma
-00011390: 6b65 5f6c 696e 6561 6765 2873 656c 662e  ke_lineage(self.
-000113a0: 636f 6e66 6967 2e63 6f6e 6669 675f 6469  config.config_di
-000113b0: 722c 2027 7361 6d70 6c65 2d72 656e 6577  r, 'sample-renew
-000113c0: 616c 2e63 6f6e 6627 2c20 6563 3d46 616c  al.conf', ec=Fal
-000113d0: 7365 290a 2020 2020 2020 2020 6172 6773  se).        args
-000113e0: 203d 205b 2272 656e 6577 222c 2022 2d2d   = ["renew", "--
-000113f0: 6472 792d 7275 6e22 2c20 222d 2d72 6575  dry-run", "--reu
-00011400: 7365 2d6b 6579 225d 0a20 2020 2020 2020  se-key"].       
-00011410: 2073 656c 662e 5f74 6573 745f 7265 6e65   self._test_rene
-00011420: 7761 6c5f 636f 6d6d 6f6e 2854 7275 652c  wal_common(True,
-00011430: 205b 5d2c 2061 7267 733d 6172 6773 2c20   [], args=args, 
-00011440: 7368 6f75 6c64 5f72 656e 6577 3d54 7275  should_renew=Tru
-00011450: 652c 2072 6575 7365 5f6b 6579 3d54 7275  e, reuse_key=Tru
-00011460: 6529 0a0a 2020 2020 406d 6f63 6b2e 7061  e)..    @mock.pa
-00011470: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00011480: 7465 726e 616c 2e73 746f 7261 6765 2e52  ternal.storage.R
-00011490: 656e 6577 6162 6c65 4365 7274 2e73 6176  enewableCert.sav
-000114a0: 655f 7375 6363 6573 736f 7227 290a 2020  e_successor').  
-000114b0: 2020 6465 6620 7465 7374 5f72 6575 7365    def test_reuse
-000114c0: 5f6b 6579 5f6e 6f5f 6472 795f 7275 6e28  _key_no_dry_run(
-000114d0: 7365 6c66 2c20 756e 7573 6564 5f73 6176  self, unused_sav
-000114e0: 655f 7375 6363 6573 736f 7229 3a0a 2020  e_successor):.  
-000114f0: 2020 2020 2020 7465 7374 5f75 7469 6c2e        test_util.
-00011500: 6d61 6b65 5f6c 696e 6561 6765 2873 656c  make_lineage(sel
-00011510: 662e 636f 6e66 6967 2e63 6f6e 6669 675f  f.config.config_
-00011520: 6469 722c 2027 7361 6d70 6c65 2d72 656e  dir, 'sample-ren
-00011530: 6577 616c 2e63 6f6e 6627 2c20 6563 3d46  ewal.conf', ec=F
-00011540: 616c 7365 290a 2020 2020 2020 2020 6172  alse).        ar
-00011550: 6773 203d 205b 2272 656e 6577 222c 2022  gs = ["renew", "
-00011560: 2d2d 7265 7573 652d 6b65 7922 5d0a 2020  --reuse-key"].  
-00011570: 2020 2020 2020 7365 6c66 2e5f 7465 7374        self._test
-00011580: 5f72 656e 6577 616c 5f63 6f6d 6d6f 6e28  _renewal_common(
-00011590: 5472 7565 2c20 5b5d 2c20 6172 6773 3d61  True, [], args=a
-000115a0: 7267 732c 2073 686f 756c 645f 7265 6e65  rgs, should_rene
-000115b0: 773d 5472 7565 2c20 7265 7573 655f 6b65  w=True, reuse_ke
-000115c0: 793d 5472 7565 290a 0a20 2020 2040 6d6f  y=True)..    @mo
-000115d0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-000115e0: 742e 5f69 6e74 6572 6e61 6c2e 7374 6f72  t._internal.stor
-000115f0: 6167 652e 5265 6e65 7761 626c 6543 6572  age.RenewableCer
-00011600: 742e 7361 7665 5f73 7563 6365 7373 6f72  t.save_successor
-00011610: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
-00011620: 6e65 775f 6b65 7928 7365 6c66 2c20 756e  new_key(self, un
-00011630: 7573 6564 5f73 6176 655f 7375 6363 6573  used_save_succes
-00011640: 736f 7229 3a0a 2020 2020 2020 2020 7465  sor):.        te
-00011650: 7374 5f75 7469 6c2e 6d61 6b65 5f6c 696e  st_util.make_lin
-00011660: 6561 6765 2873 656c 662e 636f 6e66 6967  eage(self.config
-00011670: 2e63 6f6e 6669 675f 6469 722c 2027 7361  .config_dir, 'sa
-00011680: 6d70 6c65 2d72 656e 6577 616c 2e63 6f6e  mple-renewal.con
-00011690: 6627 290a 2020 2020 2020 2020 6172 6773  f').        args
-000116a0: 203d 205b 2272 656e 6577 222c 2022 2d2d   = ["renew", "--
-000116b0: 7265 7573 652d 6b65 7922 2c20 222d 2d6e  reuse-key", "--n
-000116c0: 6577 2d6b 6579 225d 0a20 2020 2020 2020  ew-key"].       
-000116d0: 2073 656c 662e 5f74 6573 745f 7265 6e65   self._test_rene
-000116e0: 7761 6c5f 636f 6d6d 6f6e 2854 7275 652c  wal_common(True,
-000116f0: 205b 5d2c 2061 7267 733d 6172 6773 2c20   [], args=args, 
-00011700: 7368 6f75 6c64 5f72 656e 6577 3d54 7275  should_renew=Tru
-00011710: 652c 2072 6575 7365 5f6b 6579 3d54 7275  e, reuse_key=Tru
-00011720: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00011730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011740: 2020 2020 206e 6577 5f6b 6579 3d54 7275       new_key=Tru
-00011750: 6529 0a0a 2020 2020 406d 6f63 6b2e 7061  e)..    @mock.pa
-00011760: 7463 6828 2773 7973 2e73 7464 696e 2729  tch('sys.stdin')
-00011770: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
-00011780: 6e69 6e74 6572 6163 7469 7665 5f72 656e  ninteractive_ren
-00011790: 6577 616c 5f64 656c 6179 2873 656c 662c  ewal_delay(self,
-000117a0: 2073 7464 696e 293a 0a20 2020 2020 2020   stdin):.       
-000117b0: 2073 7464 696e 2e69 7361 7474 792e 7265   stdin.isatty.re
-000117c0: 7475 726e 5f76 616c 7565 203d 2046 616c  turn_value = Fal
-000117d0: 7365 0a20 2020 2020 2020 2074 6573 745f  se.        test_
-000117e0: 7574 696c 2e6d 616b 655f 6c69 6e65 6167  util.make_lineag
-000117f0: 6528 7365 6c66 2e63 6f6e 6669 672e 636f  e(self.config.co
-00011800: 6e66 6967 5f64 6972 2c20 2773 616d 706c  nfig_dir, 'sampl
-00011810: 652d 7265 6e65 7761 6c2e 636f 6e66 2729  e-renewal.conf')
-00011820: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
-00011830: 5b22 7265 6e65 7722 2c20 222d 2d64 7279  ["renew", "--dry
-00011840: 2d72 756e 222c 2022 2d74 7676 225d 0a20  -run", "-tvv"]. 
-00011850: 2020 2020 2020 2073 656c 662e 5f74 6573         self._tes
-00011860: 745f 7265 6e65 7761 6c5f 636f 6d6d 6f6e  t_renewal_common
-00011870: 2854 7275 652c 205b 5d2c 2061 7267 733d  (True, [], args=
-00011880: 6172 6773 2c20 7368 6f75 6c64 5f72 656e  args, should_ren
-00011890: 6577 3d54 7275 6529 0a20 2020 2020 2020  ew=True).       
-000118a0: 2061 7373 6572 7420 7365 6c66 2e6d 6f63   assert self.moc
-000118b0: 6b5f 736c 6565 702e 6361 6c6c 5f63 6f75  k_sleep.call_cou
-000118c0: 6e74 203d 3d20 310a 2020 2020 2020 2020  nt == 1.        
-000118d0: 2320 696e 206d 6169 6e2e 7079 3a0a 2020  # in main.py:.  
-000118e0: 2020 2020 2020 2320 2020 2020 736c 6565        #     slee
-000118f0: 705f 7469 6d65 203d 2072 616e 646f 6d2e  p_time = random.
-00011900: 7261 6e64 696e 7428 312c 2036 302a 3829  randint(1, 60*8)
-00011910: 0a20 2020 2020 2020 2073 6c65 6570 5f63  .        sleep_c
-00011920: 616c 6c5f 6172 6720 3d20 7365 6c66 2e6d  all_arg = self.m
-00011930: 6f63 6b5f 736c 6565 702e 6361 6c6c 5f61  ock_sleep.call_a
-00011940: 7267 735b 305d 5b30 5d0a 2020 2020 2020  rgs[0][0].      
-00011950: 2020 6173 7365 7274 2031 203c 3d20 736c    assert 1 <= sl
-00011960: 6565 705f 6361 6c6c 5f61 7267 203c 3d20  eep_call_arg <= 
-00011970: 3630 2a38 0a0a 2020 2020 406d 6f63 6b2e  60*8..    @mock.
-00011980: 7061 7463 6828 2773 7973 2e73 7464 696e  patch('sys.stdin
-00011990: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
-000119a0: 696e 7465 7261 6374 6976 655f 6e6f 5f72  interactive_no_r
-000119b0: 656e 6577 616c 5f64 656c 6179 2873 656c  enewal_delay(sel
-000119c0: 662c 2073 7464 696e 293a 0a20 2020 2020  f, stdin):.     
-000119d0: 2020 2073 7464 696e 2e69 7361 7474 792e     stdin.isatty.
-000119e0: 7265 7475 726e 5f76 616c 7565 203d 2054  return_value = T
-000119f0: 7275 650a 2020 2020 2020 2020 7465 7374  rue.        test
-00011a00: 5f75 7469 6c2e 6d61 6b65 5f6c 696e 6561  _util.make_linea
-00011a10: 6765 2873 656c 662e 636f 6e66 6967 2e63  ge(self.config.c
-00011a20: 6f6e 6669 675f 6469 722c 2027 7361 6d70  onfig_dir, 'samp
-00011a30: 6c65 2d72 656e 6577 616c 2e63 6f6e 6627  le-renewal.conf'
-00011a40: 290a 2020 2020 2020 2020 6172 6773 203d  ).        args =
-00011a50: 205b 2272 656e 6577 222c 2022 2d2d 6472   ["renew", "--dr
-00011a60: 792d 7275 6e22 2c20 222d 7476 7622 5d0a  y-run", "-tvv"].
-00011a70: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
-00011a80: 7374 5f72 656e 6577 616c 5f63 6f6d 6d6f  st_renewal_commo
-00011a90: 6e28 5472 7565 2c20 5b5d 2c20 6172 6773  n(True, [], args
-00011aa0: 3d61 7267 732c 2073 686f 756c 645f 7265  =args, should_re
-00011ab0: 6e65 773d 5472 7565 290a 2020 2020 2020  new=True).      
-00011ac0: 2020 6173 7365 7274 2073 656c 662e 6d6f    assert self.mo
-00011ad0: 636b 5f73 6c65 6570 2e63 616c 6c5f 636f  ck_sleep.call_co
-00011ae0: 756e 7420 3d3d 2030 0a0a 2020 2020 406d  unt == 0..    @m
-00011af0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00011b00: 6f74 2e5f 696e 7465 726e 616c 2e72 656e  ot._internal.ren
-00011b10: 6577 616c 2e73 686f 756c 645f 7265 6e65  ewal.should_rene
-00011b20: 7727 290a 2020 2020 6465 6620 7465 7374  w').    def test
-00011b30: 5f72 656e 6577 5f73 6b69 7073 5f72 6563  _renew_skips_rec
-00011b40: 656e 745f 6365 7274 7328 7365 6c66 2c20  ent_certs(self, 
-00011b50: 7368 6f75 6c64 5f72 656e 6577 293a 0a20  should_renew):. 
-00011b60: 2020 2020 2020 2073 686f 756c 645f 7265         should_re
-00011b70: 6e65 772e 7265 7475 726e 5f76 616c 7565  new.return_value
-00011b80: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00011b90: 2074 6573 745f 7574 696c 2e6d 616b 655f   test_util.make_
-00011ba0: 6c69 6e65 6167 6528 7365 6c66 2e63 6f6e  lineage(self.con
-00011bb0: 6669 672e 636f 6e66 6967 5f64 6972 2c20  fig.config_dir, 
-00011bc0: 2773 616d 706c 652d 7265 6e65 7761 6c2e  'sample-renewal.
-00011bd0: 636f 6e66 2729 0a20 2020 2020 2020 2065  conf').        e
-00011be0: 7870 6972 7920 3d20 6461 7465 7469 6d65  xpiry = datetime
-00011bf0: 2e64 6174 6574 696d 652e 6e6f 7728 2920  .datetime.now() 
-00011c00: 2b20 6461 7465 7469 6d65 2e74 696d 6564  + datetime.timed
-00011c10: 656c 7461 2864 6179 733d 3930 290a 2020  elta(days=90).  
-00011c20: 2020 2020 2020 5f2c 205f 2c20 7374 646f        _, _, stdo
-00011c30: 7574 203d 2073 656c 662e 5f74 6573 745f  ut = self._test_
-00011c40: 7265 6e65 7761 6c5f 636f 6d6d 6f6e 2846  renewal_common(F
-00011c50: 616c 7365 2c20 6578 7472 615f 6172 6773  alse, extra_args
-00011c60: 3d4e 6f6e 652c 2073 686f 756c 645f 7265  =None, should_re
-00011c70: 6e65 773d 4661 6c73 652c 0a20 2020 2020  new=False,.     
-00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ca0: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00011cb0: 3d5b 2772 656e 6577 275d 2c20 6578 7069  =['renew'], expi
-00011cc0: 7279 5f64 6174 653d 6578 7069 7279 290a  ry_date=expiry).
-00011cd0: 2020 2020 2020 2020 6173 7365 7274 2027          assert '
-00011ce0: 4e6f 2072 656e 6577 616c 7320 7765 7265  No renewals were
-00011cf0: 2061 7474 656d 7074 6564 2e27 2069 6e20   attempted.' in 
-00011d00: 7374 646f 7574 2e67 6574 7661 6c75 6528  stdout.getvalue(
-00011d10: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00011d20: 2027 5468 6520 666f 6c6c 6f77 696e 6720   'The following 
-00011d30: 6365 7274 6966 6963 6174 6573 2061 7265  certificates are
-00011d40: 206e 6f74 2064 7565 2066 6f72 2072 656e   not due for ren
-00011d50: 6577 616c 2079 6574 3a27 2069 6e20 7374  ewal yet:' in st
-00011d60: 646f 7574 2e67 6574 7661 6c75 6528 290a  dout.getvalue().
-00011d70: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-00011d80: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-00011d90: 6e61 6c2e 6c6f 672e 706f 7374 5f61 7267  nal.log.post_arg
-00011da0: 5f70 6172 7365 5f73 6574 7570 2729 0a20  _parse_setup'). 
-00011db0: 2020 2064 6566 2074 6573 745f 7175 6965     def test_quie
-00011dc0: 745f 7265 6e65 7728 7365 6c66 2c20 5f29  t_renew(self, _)
-00011dd0: 3a0a 2020 2020 2020 2020 7465 7374 5f75  :.        test_u
-00011de0: 7469 6c2e 6d61 6b65 5f6c 696e 6561 6765  til.make_lineage
-00011df0: 2873 656c 662e 636f 6e66 6967 2e63 6f6e  (self.config.con
-00011e00: 6669 675f 6469 722c 2027 7361 6d70 6c65  fig_dir, 'sample
-00011e10: 2d72 656e 6577 616c 2e63 6f6e 6627 290a  -renewal.conf').
-00011e20: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-00011e30: 2272 656e 6577 222c 2022 2d2d 6472 792d  "renew", "--dry-
-00011e40: 7275 6e22 5d0a 2020 2020 2020 2020 5f2c  run"].        _,
-00011e50: 205f 2c20 7374 646f 7574 203d 2073 656c   _, stdout = sel
-00011e60: 662e 5f74 6573 745f 7265 6e65 7761 6c5f  f._test_renewal_
-00011e70: 636f 6d6d 6f6e 2854 7275 652c 205b 5d2c  common(True, [],
-00011e80: 2061 7267 733d 6172 6773 2c20 7368 6f75   args=args, shou
-00011e90: 6c64 5f72 656e 6577 3d54 7275 6529 0a20  ld_renew=True). 
-00011ea0: 2020 2020 2020 206f 7574 203d 2073 7464         out = std
-00011eb0: 6f75 742e 6765 7476 616c 7565 2829 0a20  out.getvalue(). 
-00011ec0: 2020 2020 2020 2061 7373 6572 7420 2272         assert "r
-00011ed0: 656e 6577 2220 696e 206f 7574 0a0a 2020  enew" in out..  
-00011ee0: 2020 2020 2020 6172 6773 203d 205b 2272        args = ["r
-00011ef0: 656e 6577 222c 2022 2d2d 6472 792d 7275  enew", "--dry-ru
-00011f00: 6e22 2c20 222d 7122 5d0a 2020 2020 2020  n", "-q"].      
-00011f10: 2020 5f2c 205f 2c20 7374 646f 7574 203d    _, _, stdout =
-00011f20: 2073 656c 662e 5f74 6573 745f 7265 6e65   self._test_rene
-00011f30: 7761 6c5f 636f 6d6d 6f6e 2854 7275 652c  wal_common(True,
-00011f40: 205b 5d2c 2061 7267 733d 6172 6773 2c0a   [], args=args,.
-00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f80: 2073 686f 756c 645f 7265 6e65 773d 5472   should_renew=Tr
-00011f90: 7565 2c20 7175 6965 745f 6d6f 6465 3d54  ue, quiet_mode=T
-00011fa0: 7275 6529 0a20 2020 2020 2020 206f 7574  rue).        out
-00011fb0: 203d 2073 7464 6f75 742e 6765 7476 616c   = stdout.getval
-00011fc0: 7565 2829 0a20 2020 2020 2020 2061 7373  ue().        ass
-00011fd0: 6572 7420 2222 203d 3d20 6f75 740a 0a20  ert "" == out.. 
-00011fe0: 2020 2064 6566 2074 6573 745f 7265 6e65     def test_rene
-00011ff0: 775f 686f 6f6b 5f76 616c 6964 6174 696f  w_hook_validatio
-00012000: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-00012010: 2074 6573 745f 7574 696c 2e6d 616b 655f   test_util.make_
-00012020: 6c69 6e65 6167 6528 7365 6c66 2e63 6f6e  lineage(self.con
-00012030: 6669 672e 636f 6e66 6967 5f64 6972 2c20  fig.config_dir, 
-00012040: 2773 616d 706c 652d 7265 6e65 7761 6c2e  'sample-renewal.
-00012050: 636f 6e66 2729 0a20 2020 2020 2020 2061  conf').        a
-00012060: 7267 7320 3d20 5b22 7265 6e65 7722 2c20  rgs = ["renew", 
-00012070: 222d 2d64 7279 2d72 756e 222c 2022 2d2d  "--dry-run", "--
-00012080: 706f 7374 2d68 6f6f 6b3d 6e6f 2d73 7563  post-hook=no-suc
-00012090: 682d 636f 6d6d 616e 6422 5d0a 2020 2020  h-command"].    
-000120a0: 2020 2020 7365 6c66 2e5f 7465 7374 5f72      self._test_r
-000120b0: 656e 6577 616c 5f63 6f6d 6d6f 6e28 5472  enewal_common(Tr
-000120c0: 7565 2c20 5b5d 2c20 6172 6773 3d61 7267  ue, [], args=arg
-000120d0: 732c 2073 686f 756c 645f 7265 6e65 773d  s, should_renew=
-000120e0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-000120f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012100: 2020 2020 2020 2020 2065 7272 6f72 5f65           error_e
-00012110: 7870 6563 7465 643d 5472 7565 290a 0a20  xpected=True).. 
-00012120: 2020 2064 6566 2074 6573 745f 7265 6e65     def test_rene
-00012130: 775f 6e6f 5f68 6f6f 6b5f 7661 6c69 6461  w_no_hook_valida
-00012140: 7469 6f6e 2873 656c 6629 3a0a 2020 2020  tion(self):.    
-00012150: 2020 2020 7465 7374 5f75 7469 6c2e 6d61      test_util.ma
-00012160: 6b65 5f6c 696e 6561 6765 2873 656c 662e  ke_lineage(self.
-00012170: 636f 6e66 6967 2e63 6f6e 6669 675f 6469  config.config_di
-00012180: 722c 2027 7361 6d70 6c65 2d72 656e 6577  r, 'sample-renew
-00012190: 616c 2e63 6f6e 6627 290a 2020 2020 2020  al.conf').      
-000121a0: 2020 6172 6773 203d 205b 2272 656e 6577    args = ["renew
-000121b0: 222c 2022 2d2d 6472 792d 7275 6e22 2c20  ", "--dry-run", 
-000121c0: 222d 2d70 6f73 742d 686f 6f6b 3d6e 6f2d  "--post-hook=no-
-000121d0: 7375 6368 2d63 6f6d 6d61 6e64 222c 0a20  such-command",. 
-000121e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000121f0: 2d2d 6469 7361 626c 652d 686f 6f6b 2d76  --disable-hook-v
-00012200: 616c 6964 6174 696f 6e22 5d0a 2020 2020  alidation"].    
-00012210: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-00012220: 7463 6828 2263 6572 7462 6f74 2e5f 696e  tch("certbot._in
-00012230: 7465 726e 616c 2e68 6f6f 6b73 2e70 6f73  ternal.hooks.pos
-00012240: 745f 686f 6f6b 2229 3a0a 2020 2020 2020  t_hook"):.      
-00012250: 2020 2020 2020 7365 6c66 2e5f 7465 7374        self._test
-00012260: 5f72 656e 6577 616c 5f63 6f6d 6d6f 6e28  _renewal_common(
-00012270: 5472 7565 2c20 5b5d 2c20 6172 6773 3d61  True, [], args=a
-00012280: 7267 732c 2073 686f 756c 645f 7265 6e65  rgs, should_rene
-00012290: 773d 5472 7565 2c0a 2020 2020 2020 2020  w=True,.        
-000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122b0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-000122c0: 726f 725f 6578 7065 6374 6564 3d46 616c  ror_expected=Fal
-000122d0: 7365 290a 0a20 2020 2064 6566 2074 6573  se)..    def tes
-000122e0: 745f 7265 6e65 775f 7665 7262 5f65 6d70  t_renew_verb_emp
-000122f0: 7479 5f63 6f6e 6669 6728 7365 6c66 293a  ty_config(self):
-00012300: 0a20 2020 2020 2020 2072 6420 3d20 6f73  .        rd = os
-00012310: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
-00012320: 636f 6e66 6967 2e63 6f6e 6669 675f 6469  config.config_di
-00012330: 722c 2027 7265 6e65 7761 6c27 290a 2020  r, 'renewal').  
-00012340: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-00012350: 7061 7468 2e65 7869 7374 7328 7264 293a  path.exists(rd):
-00012360: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00012370: 6573 7973 7465 6d2e 6d61 6b65 6469 7273  esystem.makedirs
-00012380: 2872 6429 0a20 2020 2020 2020 2077 6974  (rd).        wit
-00012390: 6820 6f70 656e 286f 732e 7061 7468 2e6a  h open(os.path.j
-000123a0: 6f69 6e28 7264 2c20 2765 6d70 7479 2e63  oin(rd, 'empty.c
-000123b0: 6f6e 6627 292c 2027 7727 293a 0a20 2020  onf'), 'w'):.   
-000123c0: 2020 2020 2020 2020 2070 6173 7320 2023           pass  #
-000123d0: 206c 6561 7665 2074 6865 2066 696c 6520   leave the file 
-000123e0: 656d 7074 790a 2020 2020 2020 2020 6172  empty.        ar
-000123f0: 6773 203d 205b 2272 656e 6577 222c 2022  gs = ["renew", "
-00012400: 2d2d 6472 792d 7275 6e22 2c20 222d 7476  --dry-run", "-tv
-00012410: 7622 5d0a 2020 2020 2020 2020 7365 6c66  v"].        self
-00012420: 2e5f 7465 7374 5f72 656e 6577 616c 5f63  ._test_renewal_c
-00012430: 6f6d 6d6f 6e28 4661 6c73 652c 205b 5d2c  ommon(False, [],
-00012440: 2061 7267 733d 6172 6773 2c20 7368 6f75   args=args, shou
-00012450: 6c64 5f72 656e 6577 3d46 616c 7365 2c20  ld_renew=False, 
-00012460: 6572 726f 725f 6578 7065 6374 6564 3d54  error_expected=T
-00012470: 7275 6529 0a0a 2020 2020 6465 6620 7465  rue)..    def te
-00012480: 7374 5f72 656e 6577 5f77 6974 685f 6365  st_renew_with_ce
-00012490: 7274 6e61 6d65 2873 656c 6629 3a0a 2020  rtname(self):.  
-000124a0: 2020 2020 2020 7465 7374 5f75 7469 6c2e        test_util.
-000124b0: 6d61 6b65 5f6c 696e 6561 6765 2873 656c  make_lineage(sel
-000124c0: 662e 636f 6e66 6967 2e63 6f6e 6669 675f  f.config.config_
-000124d0: 6469 722c 2027 7361 6d70 6c65 2d72 656e  dir, 'sample-ren
-000124e0: 6577 616c 2e63 6f6e 6627 290a 2020 2020  ewal.conf').    
-000124f0: 2020 2020 7365 6c66 2e5f 7465 7374 5f72      self._test_r
-00012500: 656e 6577 616c 5f63 6f6d 6d6f 6e28 5472  enewal_common(Tr
-00012510: 7565 2c20 5b5d 2c20 7368 6f75 6c64 5f72  ue, [], should_r
-00012520: 656e 6577 3d54 7275 652c 0a20 2020 2020  enew=True,.     
-00012530: 2020 2020 2020 2061 7267 733d 5b27 7265         args=['re
-00012540: 6e65 7727 2c20 272d 2d64 7279 2d72 756e  new', '--dry-run
-00012550: 272c 2027 2d2d 6365 7274 2d6e 616d 6527  ', '--cert-name'
-00012560: 2c20 2773 616d 706c 652d 7265 6e65 7761  , 'sample-renewa
-00012570: 6c27 5d29 0a0a 2020 2020 6465 6620 7465  l'])..    def te
-00012580: 7374 5f72 656e 6577 5f77 6974 685f 6261  st_renew_with_ba
-00012590: 645f 6365 7274 6e61 6d65 2873 656c 6629  d_certname(self)
-000125a0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-000125b0: 7465 7374 5f72 656e 6577 616c 5f63 6f6d  test_renewal_com
-000125c0: 6d6f 6e28 5472 7565 2c20 5b5d 2c20 7368  mon(True, [], sh
-000125d0: 6f75 6c64 5f72 656e 6577 3d46 616c 7365  ould_renew=False
-000125e0: 2c0a 2020 2020 2020 2020 2020 2020 6172  ,.            ar
-000125f0: 6773 3d5b 2772 656e 6577 272c 2027 2d2d  gs=['renew', '--
-00012600: 6472 792d 7275 6e27 2c20 272d 2d63 6572  dry-run', '--cer
-00012610: 742d 6e61 6d65 272c 2027 7361 6d70 6c65  t-name', 'sample
-00012620: 2d72 656e 6577 616c 275d 2c0a 2020 2020  -renewal'],.    
-00012630: 2020 2020 2020 2020 6572 726f 725f 6578          error_ex
-00012640: 7065 6374 6564 3d54 7275 6529 0a0a 2020  pected=True)..  
-00012650: 2020 6465 6620 5f6d 616b 655f 6475 6d6d    def _make_dumm
-00012660: 795f 7265 6e65 7761 6c5f 636f 6e66 6967  y_renewal_config
-00012670: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00012680: 7265 6e65 7765 725f 636f 6e66 6967 735f  renewer_configs_
-00012690: 6469 7220 3d20 6f73 2e70 6174 682e 6a6f  dir = os.path.jo
-000126a0: 696e 2873 656c 662e 636f 6e66 6967 2e63  in(self.config.c
-000126b0: 6f6e 6669 675f 6469 722c 2027 7265 6e65  onfig_dir, 'rene
-000126c0: 7761 6c27 290a 2020 2020 2020 2020 6669  wal').        fi
-000126d0: 6c65 7379 7374 656d 2e6d 616b 6564 6972  lesystem.makedir
-000126e0: 7328 7265 6e65 7765 725f 636f 6e66 6967  s(renewer_config
-000126f0: 735f 6469 7229 0a20 2020 2020 2020 2077  s_dir).        w
-00012700: 6974 6820 6f70 656e 286f 732e 7061 7468  ith open(os.path
-00012710: 2e6a 6f69 6e28 7265 6e65 7765 725f 636f  .join(renewer_co
-00012720: 6e66 6967 735f 6469 722c 2027 7465 7374  nfigs_dir, 'test
-00012730: 2e63 6f6e 6627 292c 2027 7727 2920 6173  .conf'), 'w') as
-00012740: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00012750: 662e 7772 6974 6528 224d 7920 636f 6e74  f.write("My cont
-00012760: 656e 7473 2064 6f6e 2774 206d 6174 7465  ents don't matte
-00012770: 7222 290a 0a20 2020 2064 6566 205f 7465  r")..    def _te
-00012780: 7374 5f72 656e 6577 5f63 6f6d 6d6f 6e28  st_renew_common(
-00012790: 7365 6c66 2c20 7265 6e65 7761 6c70 6172  self, renewalpar
-000127a0: 616d 733d 4e6f 6e65 2c20 6e61 6d65 733d  ams=None, names=
-000127b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000127c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127d0: 2061 7373 6572 745f 6f63 5f63 616c 6c65   assert_oc_calle
-000127e0: 643d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  d=None, **kwargs
-000127f0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00012800: 5f6d 616b 655f 6475 6d6d 795f 7265 6e65  _make_dummy_rene
-00012810: 7761 6c5f 636f 6e66 6967 2829 0a20 2020  wal_config().   
-00012820: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-00012830: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00012840: 6e74 6572 6e61 6c2e 7374 6f72 6167 652e  nternal.storage.
-00012850: 5265 6e65 7761 626c 6543 6572 7427 2920  RenewableCert') 
-00012860: 6173 206d 6f63 6b5f 7263 3a0a 2020 2020  as mock_rc:.    
-00012870: 2020 2020 2020 2020 6d6f 636b 5f6c 696e          mock_lin
-00012880: 6561 6765 203d 206d 6f63 6b2e 4d61 6769  eage = mock.Magi
-00012890: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-000128a0: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
-000128b0: 2e66 756c 6c63 6861 696e 203d 2022 736f  .fullchain = "so
-000128c0: 6d65 7061 7468 2f66 756c 6c63 6861 696e  mepath/fullchain
-000128d0: 2e70 656d 220a 2020 2020 2020 2020 2020  .pem".          
-000128e0: 2020 6966 2072 656e 6577 616c 7061 7261    if renewalpara
-000128f0: 6d73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ms is not None:.
-00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012910: 6d6f 636b 5f6c 696e 6561 6765 2e63 6f6e  mock_lineage.con
-00012920: 6669 6775 7261 7469 6f6e 203d 207b 2772  figuration = {'r
-00012930: 656e 6577 616c 7061 7261 6d73 273a 2072  enewalparams': r
-00012940: 656e 6577 616c 7061 7261 6d73 7d0a 2020  enewalparams}.  
-00012950: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00012960: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012980: 6d6f 636b 5f6c 696e 6561 6765 2e6e 616d  mock_lineage.nam
-00012990: 6573 2e72 6574 7572 6e5f 7661 6c75 6520  es.return_value 
-000129a0: 3d20 6e61 6d65 730a 2020 2020 2020 2020  = names.        
-000129b0: 2020 2020 6d6f 636b 5f72 632e 7265 7475      mock_rc.retu
-000129c0: 726e 5f76 616c 7565 203d 206d 6f63 6b5f  rn_value = mock_
-000129d0: 6c69 6e65 6167 650a 2020 2020 2020 2020  lineage.        
-000129e0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-000129f0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00012a00: 7465 726e 616c 2e6d 6169 6e2e 7265 6e65  ternal.main.rene
-00012a10: 775f 6365 7274 2729 2061 7320 6d6f 636b  w_cert') as mock
-00012a20: 5f72 656e 6577 5f63 6572 743a 0a20 2020  _renew_cert:.   
-00012a30: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-00012a40: 7267 732e 7365 7464 6566 6175 6c74 2827  rgs.setdefault('
-00012a50: 6172 6773 272c 205b 2772 656e 6577 275d  args', ['renew']
-00012a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012a70: 2020 7365 6c66 2e5f 7465 7374 5f72 656e    self._test_ren
-00012a80: 6577 616c 5f63 6f6d 6d6f 6e28 5472 7565  ewal_common(True
-00012a90: 2c20 4e6f 6e65 2c20 7368 6f75 6c64 5f72  , None, should_r
-00012aa0: 656e 6577 3d46 616c 7365 2c20 2a2a 6b77  enew=False, **kw
-00012ab0: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
-00012ac0: 2020 2069 6620 6173 7365 7274 5f6f 635f     if assert_oc_
-00012ad0: 6361 6c6c 6564 2069 7320 6e6f 7420 4e6f  called is not No
-00012ae0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00012af0: 2020 2020 6966 2061 7373 6572 745f 6f63      if assert_oc
-00012b00: 5f63 616c 6c65 643a 0a20 2020 2020 2020  _called:.       
-00012b10: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-00012b20: 6572 7420 6d6f 636b 5f72 656e 6577 5f63  ert mock_renew_c
-00012b30: 6572 742e 6361 6c6c 6564 0a20 2020 2020  ert.called.     
-00012b40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00012b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012b60: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
-00012b70: 5f72 656e 6577 5f63 6572 742e 6361 6c6c  _renew_cert.call
-00012b80: 6564 2069 7320 4661 6c73 650a 0a20 2020  ed is False..   
-00012b90: 2064 6566 2074 6573 745f 7265 6e65 775f   def test_renew_
-00012ba0: 6e6f 5f72 656e 6577 616c 7061 7261 6d73  no_renewalparams
-00012bb0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00012bc0: 7365 6c66 2e5f 7465 7374 5f72 656e 6577  self._test_renew
-00012bd0: 5f63 6f6d 6d6f 6e28 6173 7365 7274 5f6f  _common(assert_o
-00012be0: 635f 6361 6c6c 6564 3d46 616c 7365 2c20  c_called=False, 
-00012bf0: 6572 726f 725f 6578 7065 6374 6564 3d54  error_expected=T
-00012c00: 7275 6529 0a0a 2020 2020 6465 6620 7465  rue)..    def te
-00012c10: 7374 5f72 656e 6577 5f6e 6f5f 6175 7468  st_renew_no_auth
-00012c20: 656e 7469 6361 746f 7228 7365 6c66 293a  enticator(self):
-00012c30: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-00012c40: 6573 745f 7265 6e65 775f 636f 6d6d 6f6e  est_renew_common
-00012c50: 2872 656e 6577 616c 7061 7261 6d73 3d7b  (renewalparams={
-00012c60: 7d2c 2061 7373 6572 745f 6f63 5f63 616c  }, assert_oc_cal
-00012c70: 6c65 643d 4661 6c73 652c 0a20 2020 2020  led=False,.     
-00012c80: 2020 2020 2020 2065 7272 6f72 5f65 7870         error_exp
-00012c90: 6563 7465 643d 5472 7565 290a 0a20 2020  ected=True)..   
-00012ca0: 2064 6566 2074 6573 745f 7265 6e65 775f   def test_renew_
-00012cb0: 7769 7468 5f62 6164 5f69 6e74 2873 656c  with_bad_int(sel
-00012cc0: 6629 3a0a 2020 2020 2020 2020 7265 6e65  f):.        rene
-00012cd0: 7761 6c70 6172 616d 7320 3d20 7b27 6175  walparams = {'au
-00012ce0: 7468 656e 7469 6361 746f 7227 3a20 2777  thenticator': 'w
-00012cf0: 6562 726f 6f74 272c 0a20 2020 2020 2020  ebroot',.       
-00012d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d10: 2020 2772 7361 5f6b 6579 5f73 697a 6527    'rsa_key_size'
-00012d20: 3a20 276f 7665 7220 3930 3030 277d 0a20  : 'over 9000'}. 
-00012d30: 2020 2020 2020 2073 656c 662e 5f74 6573         self._tes
-00012d40: 745f 7265 6e65 775f 636f 6d6d 6f6e 2872  t_renew_common(r
-00012d50: 656e 6577 616c 7061 7261 6d73 3d72 656e  enewalparams=ren
-00012d60: 6577 616c 7061 7261 6d73 2c20 6572 726f  ewalparams, erro
-00012d70: 725f 6578 7065 6374 6564 3d54 7275 652c  r_expected=True,
-00012d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012da0: 2061 7373 6572 745f 6f63 5f63 616c 6c65   assert_oc_calle
-00012db0: 643d 4661 6c73 6529 0a0a 2020 2020 6465  d=False)..    de
-00012dc0: 6620 7465 7374 5f72 656e 6577 5f77 6974  f test_renew_wit
-00012dd0: 685f 6e6f 6e65 7479 7065 5f68 7474 7030  h_nonetype_http0
-00012de0: 3128 7365 6c66 293a 0a20 2020 2020 2020  1(self):.       
-00012df0: 2072 656e 6577 616c 7061 7261 6d73 203d   renewalparams =
-00012e00: 207b 2761 7574 6865 6e74 6963 6174 6f72   {'authenticator
-00012e10: 273a 2027 7765 6272 6f6f 7427 2c0a 2020  ': 'webroot',.  
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e30: 2020 2020 2020 2027 6874 7470 3031 5f70         'http01_p
-00012e40: 6f72 7427 3a20 274e 6f6e 6527 7d0a 2020  ort': 'None'}.  
-00012e50: 2020 2020 2020 7365 6c66 2e5f 7465 7374        self._test
-00012e60: 5f72 656e 6577 5f63 6f6d 6d6f 6e28 7265  _renew_common(re
-00012e70: 6e65 7761 6c70 6172 616d 733d 7265 6e65  newalparams=rene
-00012e80: 7761 6c70 6172 616d 732c 0a20 2020 2020  walparams,.     
-00012e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ea0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00012eb0: 745f 6f63 5f63 616c 6c65 643d 5472 7565  t_oc_called=True
-00012ec0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00012ed0: 7265 6e65 775f 7769 7468 5f62 6164 5f64  renew_with_bad_d
-00012ee0: 6f6d 6169 6e28 7365 6c66 293a 0a20 2020  omain(self):.   
-00012ef0: 2020 2020 2072 656e 6577 616c 7061 7261       renewalpara
-00012f00: 6d73 203d 207b 2761 7574 6865 6e74 6963  ms = {'authentic
-00012f10: 6174 6f72 273a 2027 7765 6272 6f6f 7427  ator': 'webroot'
-00012f20: 7d0a 2020 2020 2020 2020 6e61 6d65 7320  }.        names 
-00012f30: 3d20 5b27 756e 69c3 a76f 64c3 a92e 636f  = ['uni..od...co
-00012f40: 6d27 5d0a 2020 2020 2020 2020 7365 6c66  m'].        self
-00012f50: 2e5f 7465 7374 5f72 656e 6577 5f63 6f6d  ._test_renew_com
-00012f60: 6d6f 6e28 7265 6e65 7761 6c70 6172 616d  mon(renewalparam
-00012f70: 733d 7265 6e65 7761 6c70 6172 616d 732c  s=renewalparams,
-00012f80: 2065 7272 6f72 5f65 7870 6563 7465 643d   error_expected=
-00012f90: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fb0: 2020 2020 2020 6e61 6d65 733d 6e61 6d65        names=name
-00012fc0: 732c 2061 7373 6572 745f 6f63 5f63 616c  s, assert_oc_cal
-00012fd0: 6c65 643d 4661 6c73 6529 0a0a 2020 2020  led=False)..    
-00012fe0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-00012ff0: 7462 6f74 2e5f 696e 7465 726e 616c 2e70  tbot._internal.p
-00013000: 6c75 6769 6e73 2e73 656c 6563 7469 6f6e  lugins.selection
-00013010: 2e63 686f 6f73 655f 636f 6e66 6967 7572  .choose_configur
-00013020: 6174 6f72 5f70 6c75 6769 6e73 2729 0a20  ator_plugins'). 
-00013030: 2020 2064 6566 2074 6573 745f 7265 6e65     def test_rene
-00013040: 775f 7769 7468 5f63 6f6e 6669 6775 7261  w_with_configura
-00013050: 746f 7228 7365 6c66 2c20 6d6f 636b 5f73  tor(self, mock_s
-00013060: 656c 293a 0a20 2020 2020 2020 206d 6f63  el):.        moc
-00013070: 6b5f 7365 6c2e 7265 7475 726e 5f76 616c  k_sel.return_val
-00013080: 7565 203d 2028 6d6f 636b 2e4d 6167 6963  ue = (mock.Magic
-00013090: 4d6f 636b 2829 2c20 6d6f 636b 2e4d 6167  Mock(), mock.Mag
-000130a0: 6963 4d6f 636b 2829 290a 2020 2020 2020  icMock()).      
-000130b0: 2020 7265 6e65 7761 6c70 6172 616d 7320    renewalparams 
-000130c0: 3d20 7b27 6175 7468 656e 7469 6361 746f  = {'authenticato
-000130d0: 7227 3a20 2777 6562 726f 6f74 277d 0a20  r': 'webroot'}. 
-000130e0: 2020 2020 2020 2073 656c 662e 5f74 6573         self._tes
-000130f0: 745f 7265 6e65 775f 636f 6d6d 6f6e 280a  t_renew_common(.
-00013100: 2020 2020 2020 2020 2020 2020 7265 6e65              rene
-00013110: 7761 6c70 6172 616d 733d 7265 6e65 7761  walparams=renewa
-00013120: 6c70 6172 616d 732c 2061 7373 6572 745f  lparams, assert_
-00013130: 6f63 5f63 616c 6c65 643d 5472 7565 2c0a  oc_called=True,.
-00013140: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00013150: 3d27 7265 6e65 7720 2d2d 636f 6e66 6967  ='renew --config
-00013160: 7572 6174 6f72 2061 7061 6368 6527 2e73  urator apache'.s
-00013170: 706c 6974 2829 290a 0a20 2020 2064 6566  plit())..    def
-00013180: 2074 6573 745f 7265 6e65 775f 706c 7567   test_renew_plug
-00013190: 696e 5f63 6f6e 6669 675f 7265 7374 6f72  in_config_restor
-000131a0: 6174 696f 6e28 7365 6c66 293a 0a20 2020  ation(self):.   
-000131b0: 2020 2020 2072 656e 6577 616c 7061 7261       renewalpara
-000131c0: 6d73 203d 207b 2761 7574 6865 6e74 6963  ms = {'authentic
-000131d0: 6174 6f72 273a 2027 7765 6272 6f6f 7427  ator': 'webroot'
-000131e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000131f0: 2020 2020 2020 2020 2020 2027 7765 6272             'webr
-00013200: 6f6f 745f 7061 7468 273a 2027 4e6f 6e65  oot_path': 'None
-00013210: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00013220: 2020 2020 2020 2020 2020 2020 2777 6562              'web
-00013230: 726f 6f74 5f69 6d61 6769 6e61 7279 5f66  root_imaginary_f
-00013240: 6c61 6727 3a20 2734 3227 7d0a 2020 2020  lag': '42'}.    
-00013250: 2020 2020 7365 6c66 2e5f 7465 7374 5f72      self._test_r
-00013260: 656e 6577 5f63 6f6d 6d6f 6e28 7265 6e65  enew_common(rene
-00013270: 7761 6c70 6172 616d 733d 7265 6e65 7761  walparams=renewa
-00013280: 6c70 6172 616d 732c 0a20 2020 2020 2020  lparams,.       
-00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132a0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-000132b0: 6f63 5f63 616c 6c65 643d 5472 7565 290a  oc_called=True).
-000132c0: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-000132d0: 6e65 775f 7769 7468 5f77 6562 726f 6f74  new_with_webroot
-000132e0: 5f6d 6170 2873 656c 6629 3a0a 2020 2020  _map(self):.    
-000132f0: 2020 2020 7265 6e65 7761 6c70 6172 616d      renewalparam
-00013300: 7320 3d20 7b27 6175 7468 656e 7469 6361  s = {'authentica
-00013310: 746f 7227 3a20 2777 6562 726f 6f74 277d  tor': 'webroot'}
-00013320: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-00013330: 6573 745f 7265 6e65 775f 636f 6d6d 6f6e  est_renew_common
-00013340: 280a 2020 2020 2020 2020 2020 2020 7265  (.            re
-00013350: 6e65 7761 6c70 6172 616d 733d 7265 6e65  newalparams=rene
-00013360: 7761 6c70 6172 616d 732c 2061 7373 6572  walparams, asser
-00013370: 745f 6f63 5f63 616c 6c65 643d 5472 7565  t_oc_called=True
-00013380: 2c0a 2020 2020 2020 2020 2020 2020 6172  ,.            ar
-00013390: 6773 3d5b 2772 656e 6577 272c 2027 2d2d  gs=['renew', '--
-000133a0: 7765 6272 6f6f 742d 6d61 7027 2c20 6a73  webroot-map', js
-000133b0: 6f6e 2e64 756d 7073 287b 2765 7861 6d70  on.dumps({'examp
-000133c0: 6c65 2e63 6f6d 273a 2074 656d 7066 696c  le.com': tempfil
-000133d0: 652e 6765 7474 656d 7064 6972 2829 7d29  e.gettempdir()})
-000133e0: 5d29 0a0a 2020 2020 6465 6620 7465 7374  ])..    def test
-000133f0: 5f72 656e 6577 5f72 6563 6f6e 7374 6974  _renew_reconstit
-00013400: 7574 655f 6572 726f 7228 7365 6c66 293a  ute_error(self):
-00013410: 0a20 2020 2020 2020 2023 2070 796c 696e  .        # pylin
-00013420: 743a 2064 6973 6162 6c65 3d70 726f 7465  t: disable=prote
-00013430: 6374 6564 2d61 6363 6573 730a 2020 2020  cted-access.    
-00013440: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-00013450: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00013460: 7465 726e 616c 2e6d 6169 6e2e 7265 6e65  ternal.main.rene
-00013470: 7761 6c2e 7265 636f 6e73 7469 7475 7465  wal.reconstitute
-00013480: 2729 2061 7320 6d6f 636b 5f72 6563 6f6e  ') as mock_recon
-00013490: 7374 6974 7574 653a 0a20 2020 2020 2020  stitute:.       
-000134a0: 2020 2020 206d 6f63 6b5f 7265 636f 6e73       mock_recons
-000134b0: 7469 7475 7465 2e73 6964 655f 6566 6665  titute.side_effe
-000134c0: 6374 203d 2045 7863 6570 7469 6f6e 0a20  ct = Exception. 
-000134d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000134e0: 5f74 6573 745f 7265 6e65 775f 636f 6d6d  _test_renew_comm
-000134f0: 6f6e 2861 7373 6572 745f 6f63 5f63 616c  on(assert_oc_cal
-00013500: 6c65 643d 4661 6c73 652c 2065 7272 6f72  led=False, error
-00013510: 5f65 7870 6563 7465 643d 5472 7565 290a  _expected=True).
-00013520: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-00013530: 6e65 775f 6f62 7461 696e 5f63 6572 745f  new_obtain_cert_
-00013540: 6572 726f 7228 7365 6c66 293a 0a20 2020  error(self):.   
-00013550: 2020 2020 2073 656c 662e 5f6d 616b 655f       self._make_
-00013560: 6475 6d6d 795f 7265 6e65 7761 6c5f 636f  dummy_renewal_co
-00013570: 6e66 6967 2829 0a20 2020 2020 2020 2077  nfig().        w
-00013580: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
-00013590: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-000135a0: 6c2e 7374 6f72 6167 652e 5265 6e65 7761  l.storage.Renewa
-000135b0: 626c 6543 6572 7427 2920 6173 206d 6f63  bleCert') as moc
-000135c0: 6b5f 7263 3a0a 2020 2020 2020 2020 2020  k_rc:.          
-000135d0: 2020 6d6f 636b 5f6c 696e 6561 6765 203d    mock_lineage =
-000135e0: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-000135f0: 290a 2020 2020 2020 2020 2020 2020 6d6f  ).            mo
-00013600: 636b 5f6c 696e 6561 6765 2e66 756c 6c63  ck_lineage.fullc
-00013610: 6861 696e 203d 2022 736f 6d65 7768 6572  hain = "somewher
-00013620: 652f 6675 6c6c 6368 6169 6e2e 7065 6d22  e/fullchain.pem"
-00013630: 0a20 2020 2020 2020 2020 2020 206d 6f63  .            moc
-00013640: 6b5f 7263 2e72 6574 7572 6e5f 7661 6c75  k_rc.return_valu
-00013650: 6520 3d20 6d6f 636b 5f6c 696e 6561 6765  e = mock_lineage
-00013660: 0a20 2020 2020 2020 2020 2020 206d 6f63  .            moc
-00013670: 6b5f 6c69 6e65 6167 652e 636f 6e66 6967  k_lineage.config
-00013680: 7572 6174 696f 6e20 3d20 7b0a 2020 2020  uration = {.    
-00013690: 2020 2020 2020 2020 2020 2020 2772 656e              'ren
-000136a0: 6577 616c 7061 7261 6d73 273a 207b 2761  ewalparams': {'a
-000136b0: 7574 6865 6e74 6963 6174 6f72 273a 2027  uthenticator': '
-000136c0: 7765 6272 6f6f 7427 7d7d 0a20 2020 2020  webroot'}}.     
-000136d0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-000136e0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-000136f0: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e72  _internal.main.r
-00013700: 656e 6577 5f63 6572 7427 2920 6173 206d  enew_cert') as m
-00013710: 6f63 6b5f 7265 6e65 775f 6365 7274 3a0a  ock_renew_cert:.
-00013720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013730: 6d6f 636b 5f72 656e 6577 5f63 6572 742e  mock_renew_cert.
-00013740: 7369 6465 5f65 6666 6563 7420 3d20 4578  side_effect = Ex
-00013750: 6365 7074 696f 6e0a 2020 2020 2020 2020  ception.        
-00013760: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
-00013770: 7374 5f72 656e 6577 616c 5f63 6f6d 6d6f  st_renewal_commo
-00013780: 6e28 5472 7565 2c20 4e6f 6e65 2c20 6572  n(True, None, er
-00013790: 726f 725f 6578 7065 6374 6564 3d54 7275  ror_expected=Tru
-000137a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000137b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137c0: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-000137d0: 733d 5b27 7265 6e65 7727 5d2c 2073 686f  s=['renew'], sho
-000137e0: 756c 645f 7265 6e65 773d 4661 6c73 6529  uld_renew=False)
-000137f0: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
-00013800: 656e 6577 5f77 6974 685f 6261 645f 636c  enew_with_bad_cl
-00013810: 695f 6172 6773 2873 656c 6629 3a0a 2020  i_args(self):.  
-00013820: 2020 2020 2020 7365 6c66 2e5f 7465 7374        self._test
-00013830: 5f72 656e 6577 616c 5f63 6f6d 6d6f 6e28  _renewal_common(
-00013840: 5472 7565 2c20 4e6f 6e65 2c20 6172 6773  True, None, args
-00013850: 3d27 7265 6e65 7720 2d64 2065 7861 6d70  ='renew -d examp
-00013860: 6c65 2e63 6f6d 272e 7370 6c69 7428 292c  le.com'.split(),
-00013870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013890: 2020 2073 686f 756c 645f 7265 6e65 773d     should_renew=
-000138a0: 4661 6c73 652c 2065 7272 6f72 5f65 7870  False, error_exp
-000138b0: 6563 7465 643d 5472 7565 290a 2020 2020  ected=True).    
-000138c0: 2020 2020 7365 6c66 2e5f 7465 7374 5f72      self._test_r
-000138d0: 656e 6577 616c 5f63 6f6d 6d6f 6e28 5472  enewal_common(Tr
-000138e0: 7565 2c20 4e6f 6e65 2c20 6172 6773 3d27  ue, None, args='
-000138f0: 7265 6e65 7720 2d2d 6373 7220 7b30 7d27  renew --csr {0}'
-00013900: 2e66 6f72 6d61 7428 4353 5229 2e73 706c  .format(CSR).spl
-00013910: 6974 2829 2c0a 2020 2020 2020 2020 2020  it(),.          
-00013920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013930: 2020 2020 2020 2020 7368 6f75 6c64 5f72          should_r
-00013940: 656e 6577 3d46 616c 7365 2c20 6572 726f  enew=False, erro
-00013950: 725f 6578 7065 6374 6564 3d54 7275 6529  r_expected=True)
-00013960: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-00013970: 6f5f 7265 6e65 7761 6c5f 7769 7468 5f68  o_renewal_with_h
-00013980: 6f6f 6b73 2873 656c 6629 3a0a 2020 2020  ooks(self):.    
-00013990: 2020 2020 5f2c 205f 2c20 7374 646f 7574      _, _, stdout
-000139a0: 203d 2073 656c 662e 5f74 6573 745f 7265   = self._test_re
-000139b0: 6e65 7761 6c5f 636f 6d6d 6f6e 280a 2020  newal_common(.  
-000139c0: 2020 2020 2020 2020 2020 6475 655f 666f            due_fo
-000139d0: 725f 7265 6e65 7761 6c3d 4661 6c73 652c  r_renewal=False,
-000139e0: 2065 7874 7261 5f61 7267 733d 4e6f 6e65   extra_args=None
-000139f0: 2c20 7368 6f75 6c64 5f72 656e 6577 3d46  , should_renew=F
-00013a00: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00013a10: 2020 6172 6773 3d5b 2772 656e 6577 272c    args=['renew',
-00013a20: 2027 2d2d 706f 7374 2d68 6f6f 6b27 2c0a   '--post-hook',.
-00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a40: 2020 277b 307d 202d 6320 2270 7269 6e74    '{0} -c "print
-00013a50: 285c 2768 656c 6c6f 2077 6f72 6c64 5c27  (\'hello world\'
-00013a60: 293b 2227 0a20 2020 2020 2020 2020 2020  );"'.           
-00013a70: 2020 2020 2020 202e 666f 726d 6174 2873         .format(s
-00013a80: 7973 2e65 7865 6375 7461 626c 6529 5d29  ys.executable)])
-00013a90: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00013aa0: 274e 6f20 686f 6f6b 7320 7765 7265 2072  'No hooks were r
-00013ab0: 756e 2e27 2069 6e20 7374 646f 7574 2e67  un.' in stdout.g
-00013ac0: 6574 7661 6c75 6528 290a 0a20 2020 2040  etvalue()..    @
-00013ad0: 7465 7374 5f75 7469 6c2e 7061 7463 685f  test_util.patch_
-00013ae0: 6469 7370 6c61 795f 7574 696c 2829 0a20  display_util(). 
-00013af0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-00013b00: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00013b10: 6c2e 6d61 696e 2e5f 6669 6e64 5f6c 696e  l.main._find_lin
-00013b20: 6561 6765 5f66 6f72 5f64 6f6d 6169 6e73  eage_for_domains
-00013b30: 5f61 6e64 5f63 6572 746e 616d 6527 290a  _and_certname').
-00013b40: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
-00013b50: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-00013b60: 616c 2e6d 6169 6e2e 5f69 6e69 745f 6c65  al.main._init_le
-00013b70: 5f63 6c69 656e 7427 290a 2020 2020 406d  _client').    @m
-00013b80: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00013b90: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00013ba0: 6e2e 5f72 6570 6f72 745f 6e65 775f 6365  n._report_new_ce
-00013bb0: 7274 2729 0a20 2020 2064 6566 2074 6573  rt').    def tes
-00013bc0: 745f 6365 7274 6f6e 6c79 5f72 6569 6e73  t_certonly_reins
-00013bd0: 7461 6c6c 2873 656c 662c 206d 6f63 6b5f  tall(self, mock_
-00013be0: 7265 706f 7274 5f6e 6577 5f63 6572 742c  report_new_cert,
-00013bf0: 206d 6f63 6b5f 696e 6974 2c0a 2020 2020   mock_init,.    
-00013c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c10: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
-00013c20: 5f72 656e 6577 616c 2c20 6d6f 636b 5f67  _renewal, mock_g
-00013c30: 6574 5f75 7469 6c69 7479 293a 0a20 2020  et_utility):.   
-00013c40: 2020 2020 206d 6f63 6b5f 7265 6e65 7761       mock_renewa
-00013c50: 6c2e 7265 7475 726e 5f76 616c 7565 203d  l.return_value =
-00013c60: 2028 2772 6569 6e73 7461 6c6c 272c 206d   ('reinstall', m
-00013c70: 6f63 6b2e 4d61 6769 634d 6f63 6b28 2929  ock.MagicMock())
-00013c80: 0a20 2020 2020 2020 206d 6f63 6b5f 696e  .        mock_in
-00013c90: 6974 2e72 6574 7572 6e5f 7661 6c75 6520  it.return_value 
-00013ca0: 3d20 6d6f 636b 5f63 6c69 656e 7420 3d20  = mock_client = 
-00013cb0: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2829  mock.MagicMock()
-00013cc0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00013cd0: 616c 6c28 5b27 2d64 272c 2027 666f 6f2e  all(['-d', 'foo.
-00013ce0: 6261 7227 2c20 272d 6127 2c20 2773 7461  bar', '-a', 'sta
-00013cf0: 6e64 616c 6f6e 6527 2c20 2763 6572 746f  ndalone', 'certo
-00013d00: 6e6c 7927 5d29 0a20 2020 2020 2020 2061  nly']).        a
-00013d10: 7373 6572 7420 6d6f 636b 5f63 6c69 656e  ssert mock_clien
-00013d20: 742e 6f62 7461 696e 5f63 6572 7469 6669  t.obtain_certifi
-00013d30: 6361 7465 2e63 616c 6c65 6420 6973 2046  cate.called is F
-00013d40: 616c 7365 0a20 2020 2020 2020 2061 7373  alse.        ass
-00013d50: 6572 7420 6d6f 636b 5f63 6c69 656e 742e  ert mock_client.
-00013d60: 6f62 7461 696e 5f61 6e64 5f65 6e72 6f6c  obtain_and_enrol
-00013d70: 6c5f 6365 7274 6966 6963 6174 652e 6361  l_certificate.ca
-00013d80: 6c6c 6564 2069 7320 4661 6c73 650a 2020  lled is False.  
-00013d90: 2020 2020 2020 6173 7365 7274 206d 6f63        assert moc
-00013da0: 6b5f 6765 745f 7574 696c 6974 7928 292e  k_get_utility().
-00013db0: 6164 645f 6d65 7373 6167 652e 6361 6c6c  add_message.call
-00013dc0: 5f63 6f75 6e74 203d 3d20 300a 2020 2020  _count == 0.    
-00013dd0: 2020 2020 6d6f 636b 5f72 6570 6f72 745f      mock_report_
-00013de0: 6e65 775f 6365 7274 2e61 7373 6572 745f  new_cert.assert_
-00013df0: 6e6f 745f 6361 6c6c 6564 2829 0a20 2020  not_called().   
-00013e00: 2020 2020 2023 7365 6c66 2e61 7373 6572       #self.asser
-00013e10: 7454 7275 6528 2764 6f6e 6174 6527 206e  tTrue('donate' n
-00013e20: 6f74 2069 6e20 6d6f 636b 5f67 6574 5f75  ot in mock_get_u
-00013e30: 7469 6c69 7479 2829 2e61 6464 5f6d 6573  tility().add_mes
-00013e40: 7361 6765 2e63 616c 6c5f 6172 6773 5b30  sage.call_args[0
-00013e50: 5d5b 305d 290a 0a20 2020 2064 6566 205f  ][0])..    def _
-00013e60: 7465 7374 5f63 6572 746f 6e6c 795f 6373  test_certonly_cs
-00013e70: 725f 636f 6d6d 6f6e 2873 656c 662c 2065  r_common(self, e
-00013e80: 7874 7261 5f61 7267 733d 4e6f 6e65 293a  xtra_args=None):
-00013e90: 0a20 2020 2020 2020 2063 6572 7472 203d  .        certr =
-00013ea0: 2027 6365 7274 7227 0a20 2020 2020 2020   'certr'.       
-00013eb0: 2063 6861 696e 203d 2027 6368 6169 6e27   chain = 'chain'
-00013ec0: 0a20 2020 2020 2020 206d 6f63 6b5f 636c  .        mock_cl
-00013ed0: 6965 6e74 203d 206d 6f63 6b2e 4d61 6769  ient = mock.Magi
-00013ee0: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-00013ef0: 6d6f 636b 5f63 6c69 656e 742e 6f62 7461  mock_client.obta
-00013f00: 696e 5f63 6572 7469 6669 6361 7465 5f66  in_certificate_f
-00013f10: 726f 6d5f 6373 722e 7265 7475 726e 5f76  rom_csr.return_v
-00013f20: 616c 7565 203d 2028 6365 7274 722c 2063  alue = (certr, c
-00013f30: 6861 696e 290a 2020 2020 2020 2020 6365  hain).        ce
-00013f40: 7274 5f70 6174 6820 3d20 6f73 2e70 6174  rt_path = os.pat
-00013f50: 682e 6e6f 726d 7061 7468 286f 732e 7061  h.normpath(os.pa
-00013f60: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
-00013f70: 2020 2020 2073 656c 662e 636f 6e66 6967       self.config
-00013f80: 2e63 6f6e 6669 675f 6469 722c 0a20 2020  .config_dir,.   
-00013f90: 2020 2020 2020 2020 2027 6c69 7665 2f65           'live/e
-00013fa0: 7861 6d70 6c65 2e63 6f6d 2f63 6572 745f  xample.com/cert_
-00013fb0: 3531 322e 7065 6d27 2929 0a20 2020 2020  512.pem')).     
-00013fc0: 2020 2066 756c 6c5f 7061 7468 203d 206f     full_path = o
-00013fd0: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
-00013fe0: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-00013ff0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00014000: 6f6e 6669 672e 636f 6e66 6967 5f64 6972  onfig.config_dir
-00014010: 2c0a 2020 2020 2020 2020 2020 2020 276c  ,.            'l
-00014020: 6976 652f 6578 616d 706c 652e 636f 6d2f  ive/example.com/
-00014030: 6675 6c6c 6368 6169 6e2e 7065 6d27 2929  fullchain.pem'))
-00014040: 0a20 2020 2020 2020 206d 6f63 6b5f 636c  .        mock_cl
-00014050: 6965 6e74 2e73 6176 655f 6365 7274 6966  ient.save_certif
-00014060: 6963 6174 652e 7265 7475 726e 5f76 616c  icate.return_val
-00014070: 7565 203d 2063 6572 745f 7061 7468 2c20  ue = cert_path, 
-00014080: 4e6f 6e65 2c20 6675 6c6c 5f70 6174 680a  None, full_path.
-00014090: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
-000140a0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-000140b0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-000140c0: 5f69 6e69 745f 6c65 5f63 6c69 656e 7427  _init_le_client'
-000140d0: 2920 6173 206d 6f63 6b5f 696e 6974 3a0a  ) as mock_init:.
-000140e0: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
-000140f0: 5f69 6e69 742e 7265 7475 726e 5f76 616c  _init.return_val
-00014100: 7565 203d 206d 6f63 6b5f 636c 6965 6e74  ue = mock_client
-00014110: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-00014120: 696e 5f70 6174 6820 3d20 6f73 2e70 6174  in_path = os.pat
-00014130: 682e 6e6f 726d 7061 7468 286f 732e 7061  h.normpath(os.pa
-00014140: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
-00014150: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00014160: 6e66 6967 2e63 6f6e 6669 675f 6469 722c  nfig.config_dir,
-00014170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014180: 2027 6c69 7665 2f65 7861 6d70 6c65 2e63   'live/example.c
-00014190: 6f6d 2f63 6861 696e 2e70 656d 2729 290a  om/chain.pem')).
-000141a0: 2020 2020 2020 2020 2020 2020 6172 6773              args
-000141b0: 203d 2028 272d 6120 7374 616e 6461 6c6f   = ('-a standalo
-000141c0: 6e65 2063 6572 746f 6e6c 7920 2d2d 6373  ne certonly --cs
-000141d0: 7220 7b30 7d20 2d2d 6365 7274 2d70 6174  r {0} --cert-pat
-000141e0: 6820 7b31 7d20 270a 2020 2020 2020 2020  h {1} '.        
-000141f0: 2020 2020 2020 2020 2020 2020 272d 2d63              '--c
-00014200: 6861 696e 2d70 6174 6820 7b32 7d20 2d2d  hain-path {2} --
-00014210: 6675 6c6c 6368 6169 6e2d 7061 7468 207b  fullchain-path {
-00014220: 337d 2729 2e66 6f72 6d61 7428 0a20 2020  3}').format(.   
-00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014240: 2020 2020 2043 5352 2c20 6365 7274 5f70       CSR, cert_p
-00014250: 6174 682c 2063 6861 696e 5f70 6174 682c  ath, chain_path,
-00014260: 2066 756c 6c5f 7061 7468 292e 7370 6c69   full_path).spli
-00014270: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00014280: 6966 2065 7874 7261 5f61 7267 733a 0a20  if extra_args:. 
-00014290: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000142a0: 7267 7320 2b3d 2065 7874 7261 5f61 7267  rgs += extra_arg
-000142b0: 730a 2020 2020 2020 2020 2020 2020 7769  s.            wi
-000142c0: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
-000142d0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-000142e0: 2e6d 6169 6e2e 6372 7970 746f 5f75 7469  .main.crypto_uti
-000142f0: 6c27 293a 0a20 2020 2020 2020 2020 2020  l'):.           
-00014300: 2020 2020 2073 656c 662e 5f63 616c 6c28       self._call(
-00014310: 6172 6773 290a 0a20 2020 2020 2020 2069  args)..        i
-00014320: 6620 272d 2d64 7279 2d72 756e 2720 696e  f '--dry-run' in
-00014330: 2061 7267 733a 0a20 2020 2020 2020 2020   args:.         
-00014340: 2020 2061 7373 6572 7420 6d6f 636b 5f63     assert mock_c
-00014350: 6c69 656e 742e 7361 7665 5f63 6572 7469  lient.save_certi
-00014360: 6669 6361 7465 2e63 616c 6c65 6420 6973  ficate.called is
-00014370: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
-00014380: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014390: 206d 6f63 6b5f 636c 6965 6e74 2e73 6176   mock_client.sav
-000143a0: 655f 6365 7274 6966 6963 6174 652e 6173  e_certificate.as
-000143b0: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
-000143c0: 5f77 6974 6828 0a20 2020 2020 2020 2020  _with(.         
-000143d0: 2020 2020 2020 2063 6572 7472 2c20 6368         certr, ch
-000143e0: 6169 6e2c 2063 6572 745f 7061 7468 2c20  ain, cert_path, 
-000143f0: 6368 6169 6e5f 7061 7468 2c20 6675 6c6c  chain_path, full
-00014400: 5f70 6174 6829 0a0a 2020 2020 406d 6f63  _path)..    @moc
-00014410: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00014420: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00014430: 5f63 7372 5f72 6570 6f72 745f 6e65 775f  _csr_report_new_
-00014440: 6365 7274 2729 0a20 2020 2040 6d6f 636b  cert').    @mock
-00014450: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-00014460: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e75  _internal.main.u
-00014470: 7469 6c2e 6174 6578 6974 5f72 6567 6973  til.atexit_regis
-00014480: 7465 7227 290a 2020 2020 406d 6f63 6b2e  ter').    @mock.
-00014490: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-000144a0: 696e 7465 726e 616c 2e65 6666 2e68 616e  internal.eff.han
-000144b0: 646c 655f 7375 6273 6372 6970 7469 6f6e  dle_subscription
-000144c0: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
-000144d0: 6365 7274 6f6e 6c79 5f63 7372 2873 656c  certonly_csr(sel
-000144e0: 662c 206d 6f63 6b5f 7375 6273 6372 6970  f, mock_subscrip
-000144f0: 7469 6f6e 2c20 6d6f 636b 5f72 6567 6973  tion, mock_regis
-00014500: 7465 722c 206d 6f63 6b5f 6373 725f 7265  ter, mock_csr_re
-00014510: 706f 7274 293a 0a20 2020 2020 2020 2073  port):.        s
-00014520: 656c 662e 5f74 6573 745f 6365 7274 6f6e  elf._test_certon
-00014530: 6c79 5f63 7372 5f63 6f6d 6d6f 6e28 290a  ly_csr_common().
-00014540: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-00014550: 6f63 6b5f 6373 725f 7265 706f 7274 2e63  ock_csr_report.c
-00014560: 616c 6c5f 636f 756e 7420 3d3d 2031 0a20  all_count == 1. 
-00014570: 2020 2020 2020 2061 7373 6572 7420 2763         assert 'c
-00014580: 6572 745f 3531 322e 7065 6d27 2069 6e20  ert_512.pem' in 
-00014590: 6d6f 636b 5f63 7372 5f72 6570 6f72 742e  mock_csr_report.
-000145a0: 6361 6c6c 5f61 7267 735b 305d 5b31 5d0a  call_args[0][1].
-000145b0: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-000145c0: 6f63 6b5f 6373 725f 7265 706f 7274 2e63  ock_csr_report.c
-000145d0: 616c 6c5f 6172 6773 5b30 5d5b 325d 2069  all_args[0][2] i
-000145e0: 7320 4e6f 6e65 0a20 2020 2020 2020 2061  s None.        a
-000145f0: 7373 6572 7420 2766 756c 6c63 6861 696e  ssert 'fullchain
-00014600: 2e70 656d 2720 696e 206d 6f63 6b5f 6373  .pem' in mock_cs
-00014610: 725f 7265 706f 7274 2e63 616c 6c5f 6172  r_report.call_ar
-00014620: 6773 5b30 5d5b 335d 0a20 2020 2020 2020  gs[0][3].       
-00014630: 2061 7373 6572 7420 2764 6f6e 6174 6527   assert 'donate'
-00014640: 2069 6e20 6d6f 636b 5f72 6567 6973 7465   in mock_registe
-00014650: 722e 6361 6c6c 5f61 7267 735b 305d 5b31  r.call_args[0][1
-00014660: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
-00014670: 206d 6f63 6b5f 7375 6273 6372 6970 7469   mock_subscripti
-00014680: 6f6e 2e63 616c 6c65 6420 6973 2054 7275  on.called is Tru
-00014690: 650a 0a20 2020 2040 6d6f 636b 2e70 6174  e..    @mock.pat
-000146a0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-000146b0: 6572 6e61 6c2e 6d61 696e 2e5f 6373 725f  ernal.main._csr_
-000146c0: 7265 706f 7274 5f6e 6577 5f63 6572 7427  report_new_cert'
-000146d0: 290a 2020 2020 6465 6620 7465 7374 5f63  ).    def test_c
-000146e0: 6572 746f 6e6c 795f 6373 725f 6472 795f  ertonly_csr_dry_
-000146f0: 7275 6e28 7365 6c66 2c20 6d6f 636b 5f63  run(self, mock_c
-00014700: 7372 5f72 6570 6f72 7429 3a0a 2020 2020  sr_report):.    
-00014710: 2020 2020 7365 6c66 2e5f 7465 7374 5f63      self._test_c
-00014720: 6572 746f 6e6c 795f 6373 725f 636f 6d6d  ertonly_csr_comm
-00014730: 6f6e 285b 272d 2d64 7279 2d72 756e 275d  on(['--dry-run']
-00014740: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00014750: 206d 6f63 6b5f 6373 725f 7265 706f 7274   mock_csr_report
-00014760: 2e63 616c 6c5f 636f 756e 7420 3d3d 2031  .call_count == 1
-00014770: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00014780: 6d6f 636b 5f63 7372 5f72 6570 6f72 742e  mock_csr_report.
-00014790: 6361 6c6c 5f61 7267 735b 305d 5b30 5d2e  call_args[0][0].
-000147a0: 6472 795f 7275 6e20 6973 2054 7275 650a  dry_run is True.
-000147b0: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
-000147c0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-000147d0: 6e61 6c2e 6d61 696e 2e5f 6465 6c65 7465  nal.main._delete
-000147e0: 5f69 665f 6170 7072 6f70 7269 6174 6527  _if_appropriate'
-000147f0: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
-00014800: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-00014810: 726e 616c 2e6d 6169 6e2e 636c 6965 6e74  rnal.main.client
-00014820: 2e61 636d 655f 636c 6965 6e74 2729 0a20  .acme_client'). 
-00014830: 2020 2064 6566 2074 6573 745f 7265 766f     def test_revo
-00014840: 6b65 5f77 6974 685f 6b65 7928 7365 6c66  ke_with_key(self
-00014850: 2c20 6d6f 636b 5f61 636d 655f 636c 6965  , mock_acme_clie
-00014860: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00014870: 6d6f 636b 5f64 656c 6574 655f 6966 5f61  mock_delete_if_a
-00014880: 7070 726f 7072 6961 7465 293a 0a20 2020  ppropriate):.   
-00014890: 2020 2020 206d 6f63 6b5f 6465 6c65 7465       mock_delete
-000148a0: 5f69 665f 6170 7072 6f70 7269 6174 652e  _if_appropriate.
-000148b0: 7265 7475 726e 5f76 616c 7565 203d 2046  return_value = F
-000148c0: 616c 7365 0a20 2020 2020 2020 2073 6572  alse.        ser
-000148d0: 7665 7220 3d20 2766 6f6f 2e62 6172 270a  ver = 'foo.bar'.
-000148e0: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
-000148f0: 6c6c 5f6e 6f5f 636c 6965 6e74 6d6f 636b  ll_no_clientmock
-00014900: 285b 272d 2d63 6572 742d 7061 7468 272c  (['--cert-path',
-00014910: 2053 535f 4345 5254 5f50 4154 482c 2027   SS_CERT_PATH, '
-00014920: 2d2d 6b65 792d 7061 7468 272c 2052 5341  --key-path', RSA
-00014930: 3230 3438 5f4b 4559 5f50 4154 482c 0a20  2048_KEY_PATH,. 
-00014940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014960: 272d 2d73 6572 7665 7227 2c20 7365 7276  '--server', serv
-00014970: 6572 2c20 2772 6576 6f6b 6527 5d29 0a20  er, 'revoke']). 
-00014980: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-00014990: 2852 5341 3230 3438 5f4b 4559 5f50 4154  (RSA2048_KEY_PAT
-000149a0: 482c 2027 7262 2729 2061 7320 663a 0a20  H, 'rb') as f:. 
-000149b0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000149c0: 7420 6d6f 636b 5f61 636d 655f 636c 6965  t mock_acme_clie
-000149d0: 6e74 2e43 6c69 656e 7456 322e 6361 6c6c  nt.ClientV2.call
-000149e0: 5f63 6f75 6e74 203d 3d20 310a 2020 2020  _count == 1.    
-000149f0: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-00014a00: 6f63 6b5f 6163 6d65 5f63 6c69 656e 742e  ock_acme_client.
-00014a10: 436c 6965 6e74 4e65 7477 6f72 6b2e 6361  ClientNetwork.ca
-00014a20: 6c6c 5f61 7267 735b 305d 5b30 5d20 3d3d  ll_args[0][0] ==
-00014a30: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00014a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a50: 6a6f 7365 2e4a 574b 2e6c 6f61 6428 662e  jose.JWK.load(f.
-00014a60: 7265 6164 2829 290a 2020 2020 2020 2020  read()).        
-00014a70: 7769 7468 206f 7065 6e28 5353 5f43 4552  with open(SS_CER
-00014a80: 545f 5041 5448 2c20 2772 6227 2920 6173  T_PATH, 'rb') as
-00014a90: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00014aa0: 6365 7274 203d 2063 7279 7074 6f5f 7574  cert = crypto_ut
-00014ab0: 696c 2e70 796f 7065 6e73 736c 5f6c 6f61  il.pyopenssl_loa
-00014ac0: 645f 6365 7274 6966 6963 6174 6528 662e  d_certificate(f.
-00014ad0: 7265 6164 2829 295b 305d 0a20 2020 2020  read())[0].     
-00014ae0: 2020 2020 2020 206d 6f63 6b5f 7265 766f         mock_revo
-00014af0: 6b65 203d 206d 6f63 6b5f 6163 6d65 5f63  ke = mock_acme_c
-00014b00: 6c69 656e 742e 436c 6965 6e74 5632 2829  lient.ClientV2()
-00014b10: 2e72 6576 6f6b 650a 2020 2020 2020 2020  .revoke.        
-00014b20: 2020 2020 6d6f 636b 5f72 6576 6f6b 652e      mock_revoke.
-00014b30: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-00014b40: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
-00014b50: 2020 2020 2020 2020 2020 2020 206a 6f73               jos
-00014b60: 652e 436f 6d70 6172 6162 6c65 5835 3039  e.ComparableX509
-00014b70: 2863 6572 7429 2c0a 2020 2020 2020 2020  (cert),.        
-00014b80: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
-00014b90: 2e41 4e59 290a 0a20 2020 2064 6566 2074  .ANY)..    def t
-00014ba0: 6573 745f 7265 766f 6b65 5f77 6974 685f  est_revoke_with_
-00014bb0: 6b65 795f 6d69 736d 6174 6368 2873 656c  key_mismatch(sel
-00014bc0: 6629 3a0a 2020 2020 2020 2020 7365 7276  f):.        serv
-00014bd0: 6572 203d 2027 666f 6f2e 6261 7227 0a20  er = 'foo.bar'. 
-00014be0: 2020 2020 2020 2077 6974 6820 7079 7465         with pyte
-00014bf0: 7374 2e72 6169 7365 7328 6572 726f 7273  st.raises(errors
-00014c00: 2e45 7272 6f72 293a 0a20 2020 2020 2020  .Error):.       
-00014c10: 2020 2020 2073 656c 662e 5f63 616c 6c5f       self._call_
-00014c20: 6e6f 5f63 6c69 656e 746d 6f63 6b28 5b27  no_clientmock(['
-00014c30: 2d2d 6365 7274 2d70 6174 6827 2c20 4345  --cert-path', CE
-00014c40: 5254 2c20 272d 2d6b 6579 2d70 6174 6827  RT, '--key-path'
-00014c50: 2c20 4b45 592c 0a20 2020 2020 2020 2020  , KEY,.         
-00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c70: 2020 2020 2020 2020 272d 2d73 6572 7665          '--serve
-00014c80: 7227 2c20 7365 7276 6572 2c20 2772 6576  r', server, 'rev
-00014c90: 6f6b 6527 5d29 0a0a 2020 2020 406d 6f63  oke'])..    @moc
-00014ca0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00014cb0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00014cc0: 5f64 656c 6574 655f 6966 5f61 7070 726f  _delete_if_appro
-00014cd0: 7072 6961 7465 2729 0a20 2020 2040 6d6f  priate').    @mo
-00014ce0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00014cf0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-00014d00: 2e5f 6465 7465 726d 696e 655f 6163 636f  ._determine_acco
-00014d10: 756e 7427 290a 2020 2020 6465 6620 7465  unt').    def te
-00014d20: 7374 5f72 6576 6f6b 655f 7769 7468 6f75  st_revoke_withou
-00014d30: 745f 6b65 7928 7365 6c66 2c20 6d6f 636b  t_key(self, mock
-00014d40: 5f64 6574 6572 6d69 6e65 5f61 6363 6f75  _determine_accou
-00014d50: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00014d60: 6d6f 636b 5f64 656c 6574 655f 6966 5f61  mock_delete_if_a
-00014d70: 7070 726f 7072 6961 7465 293a 0a20 2020  ppropriate):.   
-00014d80: 2020 2020 206d 6f63 6b5f 6465 6c65 7465       mock_delete
-00014d90: 5f69 665f 6170 7072 6f70 7269 6174 652e  _if_appropriate.
-00014da0: 7265 7475 726e 5f76 616c 7565 203d 2046  return_value = F
-00014db0: 616c 7365 0a20 2020 2020 2020 206d 6f63  alse.        moc
-00014dc0: 6b5f 6465 7465 726d 696e 655f 6163 636f  k_determine_acco
-00014dd0: 756e 742e 7265 7475 726e 5f76 616c 7565  unt.return_value
-00014de0: 203d 2028 6d6f 636b 2e4d 6167 6963 4d6f   = (mock.MagicMo
-00014df0: 636b 2829 2c20 4e6f 6e65 290a 2020 2020  ck(), None).    
-00014e00: 2020 2020 5f2c 205f 2c20 5f2c 2063 6c69      _, _, _, cli
-00014e10: 656e 7420 3d20 7365 6c66 2e5f 6361 6c6c  ent = self._call
-00014e20: 285b 272d 2d63 6572 742d 7061 7468 272c  (['--cert-path',
-00014e30: 2043 4552 542c 2027 7265 766f 6b65 275d   CERT, 'revoke']
-00014e40: 290a 2020 2020 2020 2020 7769 7468 206f  ).        with o
-00014e50: 7065 6e28 4345 5254 2920 6173 2066 3a0a  pen(CERT) as f:.
-00014e60: 2020 2020 2020 2020 2020 2020 6365 7274              cert
-00014e70: 203d 2063 7279 7074 6f5f 7574 696c 2e70   = crypto_util.p
-00014e80: 796f 7065 6e73 736c 5f6c 6f61 645f 6365  yopenssl_load_ce
-00014e90: 7274 6966 6963 6174 6528 662e 7265 6164  rtificate(f.read
-00014ea0: 2829 295b 305d 0a20 2020 2020 2020 2020  ())[0].         
-00014eb0: 2020 206d 6f63 6b5f 7265 766f 6b65 203d     mock_revoke =
-00014ec0: 2063 6c69 656e 742e 6163 6d65 5f66 726f   client.acme_fro
-00014ed0: 6d5f 636f 6e66 6967 5f6b 6579 2829 2e72  m_config_key().r
-00014ee0: 6576 6f6b 650a 2020 2020 2020 2020 2020  evoke.          
-00014ef0: 2020 6d6f 636b 5f72 6576 6f6b 652e 6173    mock_revoke.as
-00014f00: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
-00014f10: 5f77 6974 6828 0a20 2020 2020 2020 2020  _with(.         
-00014f20: 2020 2020 2020 2020 2020 206a 6f73 652e             jose.
-00014f30: 436f 6d70 6172 6162 6c65 5835 3039 2863  ComparableX509(c
-00014f40: 6572 7429 2c0a 2020 2020 2020 2020 2020  ert),.          
-00014f50: 2020 2020 2020 2020 2020 6d6f 636b 2e41            mock.A
-00014f60: 4e59 290a 0a20 2020 2040 6d6f 636b 2e70  NY)..    @mock.p
-00014f70: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00014f80: 6e74 6572 6e61 6c2e 6c6f 672e 706f 7374  nternal.log.post
-00014f90: 5f61 7267 5f70 6172 7365 5f73 6574 7570  _arg_parse_setup
-00014fa0: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
-00014fb0: 7265 6769 7374 6572 2873 656c 662c 205f  register(self, _
-00014fc0: 293a 0a20 2020 2020 2020 2077 6974 6820  ):.        with 
-00014fd0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-00014fe0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-00014ff0: 696e 2e63 6c69 656e 7427 2920 6173 206d  in.client') as m
-00015000: 6f63 6b65 645f 636c 6965 6e74 3a0a 2020  ocked_client:.  
-00015010: 2020 2020 2020 2020 2020 6163 6320 3d20            acc = 
-00015020: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2829  mock.MagicMock()
-00015030: 0a20 2020 2020 2020 2020 2020 2061 6363  .            acc
-00015040: 2e69 6420 3d20 2269 6d61 6769 6e61 7279  .id = "imaginary
-00015050: 5f61 6363 6f75 6e74 220a 2020 2020 2020  _account".      
-00015060: 2020 2020 2020 6d6f 636b 6564 5f63 6c69        mocked_cli
-00015070: 656e 742e 7265 6769 7374 6572 2e72 6574  ent.register.ret
-00015080: 7572 6e5f 7661 6c75 6520 3d20 2861 6363  urn_value = (acc
-00015090: 2c20 2277 6f72 6b65 6422 290a 2020 2020  , "worked").    
-000150a0: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
-000150b0: 6c6c 5f6e 6f5f 636c 6965 6e74 6d6f 636b  ll_no_clientmock
-000150c0: 285b 2272 6567 6973 7465 7222 2c20 222d  (["register", "-
-000150d0: 2d65 6d61 696c 222c 2022 7573 6572 4065  -email", "user@e
-000150e0: 7861 6d70 6c65 2e6f 7267 225d 290a 2020  xample.org"]).  
-000150f0: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
-00015100: 3a20 4974 2077 6f75 6c64 2062 6520 6d6f  : It would be mo
-00015110: 7265 2063 6f72 7265 6374 2074 6f20 6578  re correct to ex
-00015120: 706c 6963 6974 6c79 2063 6865 636b 2074  plicitly check t
-00015130: 6861 740a 2020 2020 2020 2020 2020 2020  hat.            
-00015140: 2320 2020 2020 2020 5f64 6574 6572 6d69  #       _determi
-00015150: 6e65 5f61 6363 6f75 6e74 2829 2067 6574  ne_account() get
-00015160: 7320 6361 6c6c 6564 2069 6e20 7468 6520  s called in the 
-00015170: 6162 6f76 6520 6361 7365 2c0a 2020 2020  above case,.    
-00015180: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00015190: 6275 7420 636f 7665 7261 6765 2073 7461  but coverage sta
-000151a0: 7469 7374 6963 7320 7368 6f75 6c64 2061  tistics should a
-000151b0: 6c73 6f20 7368 6f77 2074 6861 7420 6974  lso show that it
-000151c0: 2064 6964 2e0a 2020 2020 2020 2020 2020   did..          
-000151d0: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
-000151e0: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-000151f0: 726e 616c 2e6d 6169 6e2e 6163 636f 756e  rnal.main.accoun
-00015200: 7427 2920 6173 206d 6f63 6b65 645f 6163  t') as mocked_ac
-00015210: 636f 756e 743a 0a20 2020 2020 2020 2020  count:.         
-00015220: 2020 2020 2020 206d 6f63 6b65 645f 7374         mocked_st
-00015230: 6f72 6167 6520 3d20 6d6f 636b 2e4d 6167  orage = mock.Mag
-00015240: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
-00015250: 2020 2020 2020 2020 206d 6f63 6b65 645f           mocked_
-00015260: 6163 636f 756e 742e 4163 636f 756e 7446  account.AccountF
-00015270: 696c 6553 746f 7261 6765 2e72 6574 7572  ileStorage.retur
-00015280: 6e5f 7661 6c75 6520 3d20 6d6f 636b 6564  n_value = mocked
-00015290: 5f73 746f 7261 6765 0a20 2020 2020 2020  _storage.       
-000152a0: 2020 2020 2020 2020 206d 6f63 6b65 645f           mocked_
-000152b0: 7374 6f72 6167 652e 6669 6e64 5f61 6c6c  storage.find_all
-000152c0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-000152d0: 5b22 616e 2061 6363 6f75 6e74 225d 0a20  ["an account"]. 
-000152e0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-000152f0: 203d 2073 656c 662e 5f63 616c 6c5f 6e6f   = self._call_no
-00015300: 5f63 6c69 656e 746d 6f63 6b28 5b22 7265  _clientmock(["re
-00015310: 6769 7374 6572 222c 2022 2d2d 656d 6169  gister", "--emai
-00015320: 6c22 2c20 2275 7365 7240 6578 616d 706c  l", "user@exampl
-00015330: 652e 6f72 6722 5d29 0a20 2020 2020 2020  e.org"]).       
-00015340: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00015350: 2254 6865 7265 2069 7320 616e 2065 7869  "There is an exi
-00015360: 7374 696e 6720 6163 636f 756e 7422 2069  sting account" i
-00015370: 6e20 785b 305d 0a0a 2020 2020 406d 6f63  n x[0]..    @moc
-00015380: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00015390: 2e5f 696e 7465 726e 616c 2e70 6c75 6769  ._internal.plugi
-000153a0: 6e73 2e73 656c 6563 7469 6f6e 2e63 686f  ns.selection.cho
-000153b0: 6f73 655f 636f 6e66 6967 7572 6174 6f72  ose_configurator
-000153c0: 5f70 6c75 6769 6e73 2729 0a20 2020 2040  _plugins').    @
-000153d0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-000153e0: 626f 742e 5f69 6e74 6572 6e61 6c2e 7570  bot._internal.up
-000153f0: 6461 7465 722e 5f72 756e 5f75 7064 6174  dater._run_updat
-00015400: 6572 7327 290a 2020 2020 6465 6620 7465  ers').    def te
-00015410: 7374 5f70 6c75 6769 6e5f 7365 6c65 6374  st_plugin_select
-00015420: 696f 6e5f 6572 726f 7228 7365 6c66 2c20  ion_error(self, 
-00015430: 6d6f 636b 5f72 756e 2c20 6d6f 636b 5f63  mock_run, mock_c
-00015440: 686f 6f73 6529 3a0a 2020 2020 2020 2020  hoose):.        
-00015450: 6d6f 636b 5f63 686f 6f73 652e 7369 6465  mock_choose.side
-00015460: 5f65 6666 6563 7420 3d20 6572 726f 7273  _effect = errors
-00015470: 2e50 6c75 6769 6e53 656c 6563 7469 6f6e  .PluginSelection
-00015480: 4572 726f 720a 2020 2020 2020 2020 7769  Error.        wi
-00015490: 7468 2070 7974 6573 742e 7261 6973 6573  th pytest.raises
-000154a0: 2865 7272 6f72 732e 506c 7567 696e 5365  (errors.PluginSe
-000154b0: 6c65 6374 696f 6e45 7272 6f72 293a 0a20  lectionError):. 
-000154c0: 2020 2020 2020 2020 2020 206d 6169 6e2e             main.
-000154d0: 7265 6e65 775f 6365 7274 284e 6f6e 652c  renew_cert(None,
-000154e0: 204e 6f6e 652c 204e 6f6e 6529 0a0a 2020   None, None)..  
-000154f0: 2020 2020 2020 7365 6c66 2e63 6f6e 6669        self.confi
-00015500: 672e 6472 795f 7275 6e20 3d20 4661 6c73  g.dry_run = Fals
-00015510: 650a 2020 2020 2020 2020 7570 6461 7465  e.        update
-00015520: 722e 7275 6e5f 6765 6e65 7269 635f 7570  r.run_generic_up
-00015530: 6461 7465 7273 2873 656c 662e 636f 6e66  daters(self.conf
-00015540: 6967 2c20 4e6f 6e65 2c20 4e6f 6e65 290a  ig, None, None).
-00015550: 2020 2020 2020 2020 2320 4d61 6b65 2073          # Make s
-00015560: 7572 6520 7765 2772 6520 7265 7475 726e  ure we're return
-00015570: 696e 6720 4e6f 6e65 2c20 616e 6420 6865  ing None, and he
-00015580: 6e63 6520 6e6f 7420 7472 7969 6e67 2074  nce not trying t
-00015590: 6f20 7275 6e20 7468 650a 2020 2020 2020  o run the.      
-000155a0: 2020 2320 7769 7468 6f75 7420 696e 7374    # without inst
-000155b0: 616c 6c65 720a 2020 2020 2020 2020 6173  aller.        as
-000155c0: 7365 7274 206d 6f63 6b5f 7275 6e2e 6361  sert mock_run.ca
-000155d0: 6c6c 6564 2069 7320 4661 6c73 650a 0a20  lled is False.. 
-000155e0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-000155f0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00015600: 6c2e 6d61 696e 2e75 7064 6174 6572 2e72  l.main.updater.r
-00015610: 756e 5f72 656e 6577 616c 5f64 6570 6c6f  un_renewal_deplo
-00015620: 7965 7227 290a 2020 2020 406d 6f63 6b2e  yer').    @mock.
-00015630: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00015640: 696e 7465 726e 616c 2e70 6c75 6769 6e73  internal.plugins
-00015650: 2e73 656c 6563 7469 6f6e 2e63 686f 6f73  .selection.choos
-00015660: 655f 636f 6e66 6967 7572 6174 6f72 5f70  e_configurator_p
-00015670: 6c75 6769 6e73 2729 0a20 2020 2040 6d6f  lugins').    @mo
-00015680: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00015690: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-000156a0: 2e5f 696e 6974 5f6c 655f 636c 6965 6e74  ._init_le_client
-000156b0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-000156c0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-000156d0: 6572 6e61 6c2e 6d61 696e 2e5f 6765 745f  ernal.main._get_
-000156e0: 616e 645f 7361 7665 5f63 6572 7427 290a  and_save_cert').
-000156f0: 2020 2020 6465 6620 7465 7374 5f72 656e      def test_ren
-00015700: 6577 5f64 6f65 736e 745f 7265 7374 6172  ew_doesnt_restar
-00015710: 745f 6f6e 5f64 7279 7275 6e28 7365 6c66  t_on_dryrun(self
-00015720: 2c20 6d6f 636b 5f67 6574 5f63 6572 742c  , mock_get_cert,
-00015730: 206d 6f63 6b5f 696e 6974 2c20 6d6f 636b   mock_init, mock
-00015740: 5f63 686f 6f73 652c 0a20 2020 2020 2020  _choose,.       
-00015750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015770: 2020 2020 206d 6f63 6b5f 7275 6e5f 7265       mock_run_re
-00015780: 6e65 7761 6c5f 6465 706c 6f79 6572 293a  newal_deployer):
-00015790: 0a20 2020 2020 2020 2022 2222 4120 6472  .        """A dr
-000157a0: 792d 7275 6e20 7265 6e65 7761 6c20 7368  y-run renewal sh
-000157b0: 6f75 6c64 6e27 7420 7472 7920 746f 2072  ouldn't try to r
-000157c0: 6573 7461 7274 2074 6865 2069 6e73 7461  estart the insta
-000157d0: 6c6c 6572 2222 220a 2020 2020 2020 2020  ller""".        
-000157e0: 7365 6c66 2e63 6f6e 6669 672e 6472 795f  self.config.dry_
-000157f0: 7275 6e20 3d20 5472 7565 0a20 2020 2020  run = True.     
-00015800: 2020 2069 6e73 7461 6c6c 6572 203d 206d     installer = m
-00015810: 6f63 6b2e 4d61 6769 634d 6f63 6b28 290a  ock.MagicMock().
-00015820: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
-00015830: 6f73 652e 7265 7475 726e 5f76 616c 7565  ose.return_value
-00015840: 203d 2028 696e 7374 616c 6c65 722c 206d   = (installer, m
-00015850: 6f63 6b2e 4d61 6769 634d 6f63 6b28 2929  ock.MagicMock())
-00015860: 0a0a 2020 2020 2020 2020 6d61 696e 2e72  ..        main.r
-00015870: 656e 6577 5f63 6572 7428 7365 6c66 2e63  enew_cert(self.c
-00015880: 6f6e 6669 672c 204e 6f6e 652c 204e 6f6e  onfig, None, Non
-00015890: 6529 0a0a 2020 2020 2020 2020 6173 7365  e)..        asse
-000158a0: 7274 206d 6f63 6b5f 696e 6974 2e63 616c  rt mock_init.cal
-000158b0: 6c5f 636f 756e 7420 3d3d 2031 0a20 2020  l_count == 1.   
-000158c0: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
-000158d0: 5f67 6574 5f63 6572 742e 6361 6c6c 5f63  _get_cert.call_c
-000158e0: 6f75 6e74 203d 3d20 310a 2020 2020 2020  ount == 1.      
-000158f0: 2020 696e 7374 616c 6c65 722e 7265 7374    installer.rest
-00015900: 6172 742e 6173 7365 7274 5f6e 6f74 5f63  art.assert_not_c
-00015910: 616c 6c65 6428 290a 2020 2020 2020 2020  alled().        
-00015920: 6d6f 636b 5f72 756e 5f72 656e 6577 616c  mock_run_renewal
-00015930: 5f64 6570 6c6f 7965 722e 6173 7365 7274  _deployer.assert
-00015940: 5f6e 6f74 5f63 616c 6c65 6428 290a 0a0a  _not_called()...
-00015950: 636c 6173 7320 556e 7265 6769 7374 6572  class Unregister
-00015960: 5465 7374 2875 6e69 7474 6573 742e 5465  Test(unittest.Te
-00015970: 7374 4361 7365 293a 0a20 2020 2064 6566  stCase):.    def
-00015980: 2073 6574 5570 2873 656c 6629 3a0a 2020   setUp(self):.  
-00015990: 2020 2020 2020 7365 6c66 2e70 6174 6368        self.patch
-000159a0: 6572 7320 3d20 7b0a 2020 2020 2020 2020  ers = {.        
-000159b0: 2020 2020 275f 6465 7465 726d 696e 655f      '_determine_
-000159c0: 6163 636f 756e 7427 3a20 6d6f 636b 2e70  account': mock.p
-000159d0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000159e0: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 6465  nternal.main._de
-000159f0: 7465 726d 696e 655f 6163 636f 756e 7427  termine_account'
-00015a00: 292c 0a20 2020 2020 2020 2020 2020 2027  ),.            '
-00015a10: 6163 636f 756e 7427 3a20 6d6f 636b 2e70  account': mock.p
-00015a20: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00015a30: 6e74 6572 6e61 6c2e 6d61 696e 2e61 6363  nternal.main.acc
-00015a40: 6f75 6e74 2729 2c0a 2020 2020 2020 2020  ount'),.        
-00015a50: 2020 2020 2763 6c69 656e 7427 3a20 6d6f      'client': mo
-00015a60: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00015a70: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-00015a80: 2e63 6c69 656e 7427 292c 0a20 2020 2020  .client'),.     
-00015a90: 2020 2020 2020 2027 6765 745f 7574 696c         'get_util
-00015aa0: 6974 7927 3a20 7465 7374 5f75 7469 6c2e  ity': test_util.
-00015ab0: 7061 7463 685f 6469 7370 6c61 795f 7574  patch_display_ut
-00015ac0: 696c 2829 7d0a 2020 2020 2020 2020 7365  il()}.        se
-00015ad0: 6c66 2e6d 6f63 6b73 203d 207b 6b3a 2076  lf.mocks = {k: v
-00015ae0: 2e73 7461 7274 2829 2066 6f72 206b 2c20  .start() for k, 
-00015af0: 7620 696e 2073 656c 662e 7061 7463 6865  v in self.patche
-00015b00: 7273 2e69 7465 6d73 2829 7d0a 0a20 2020  rs.items()}..   
-00015b10: 2064 6566 2074 6561 7244 6f77 6e28 7365   def tearDown(se
-00015b20: 6c66 293a 0a20 2020 2020 2020 2066 6f72  lf):.        for
-00015b30: 2070 6174 6368 2069 6e20 7365 6c66 2e70   patch in self.p
-00015b40: 6174 6368 6572 732e 7661 6c75 6573 2829  atchers.values()
-00015b50: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00015b60: 7463 682e 7374 6f70 2829 0a0a 2020 2020  tch.stop()..    
-00015b70: 6465 6620 7465 7374 5f61 626f 7274 5f75  def test_abort_u
-00015b80: 6e72 6567 6973 7465 7228 7365 6c66 293a  nregister(self):
-00015b90: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-00015ba0: 636b 735b 2761 6363 6f75 6e74 275d 2e41  cks['account'].A
-00015bb0: 6363 6f75 6e74 4669 6c65 5374 6f72 6167  ccountFileStorag
-00015bc0: 652e 7265 7475 726e 5f76 616c 7565 203d  e.return_value =
-00015bd0: 206d 6f63 6b2e 4d6f 636b 2829 0a0a 2020   mock.Mock()..  
-00015be0: 2020 2020 2020 7574 696c 5f6d 6f63 6b20        util_mock 
-00015bf0: 3d20 7365 6c66 2e6d 6f63 6b73 5b27 6765  = self.mocks['ge
-00015c00: 745f 7574 696c 6974 7927 5d28 290a 2020  t_utility']().  
-00015c10: 2020 2020 2020 7574 696c 5f6d 6f63 6b2e        util_mock.
-00015c20: 7965 736e 6f2e 7265 7475 726e 5f76 616c  yesno.return_val
-00015c30: 7565 203d 2046 616c 7365 0a0a 2020 2020  ue = False..    
-00015c40: 2020 2020 636f 6e66 6967 203d 206d 6f63      config = moc
-00015c50: 6b2e 4d6f 636b 2829 0a20 2020 2020 2020  k.Mock().       
-00015c60: 2075 6e75 7365 645f 706c 7567 696e 7320   unused_plugins 
-00015c70: 3d20 6d6f 636b 2e4d 6f63 6b28 290a 0a20  = mock.Mock().. 
-00015c80: 2020 2020 2020 2072 6573 203d 206d 6169         res = mai
-00015c90: 6e2e 756e 7265 6769 7374 6572 2863 6f6e  n.unregister(con
-00015ca0: 6669 672c 2075 6e75 7365 645f 706c 7567  fig, unused_plug
-00015cb0: 696e 7329 0a20 2020 2020 2020 2061 7373  ins).        ass
-00015cc0: 6572 7420 7265 7320 3d3d 2022 4465 6163  ert res == "Deac
-00015cd0: 7469 7661 7469 6f6e 2061 626f 7274 6564  tivation aborted
-00015ce0: 2e22 0a0a 2020 2020 406d 6f63 6b2e 7061  ."..    @mock.pa
-00015cf0: 7463 6828 2263 6572 7462 6f74 2e5f 696e  tch("certbot._in
-00015d00: 7465 726e 616c 2e6d 6169 6e2e 6469 7370  ternal.main.disp
-00015d10: 6c61 795f 7574 696c 2e6e 6f74 6966 7922  lay_util.notify"
-00015d20: 290a 2020 2020 6465 6620 7465 7374 5f75  ).    def test_u
-00015d30: 6e72 6567 6973 7465 7228 7365 6c66 2c20  nregister(self, 
-00015d40: 6d6f 636b 5f6e 6f74 6966 7929 3a0a 2020  mock_notify):.  
-00015d50: 2020 2020 2020 6d6f 636b 6564 5f73 746f        mocked_sto
-00015d60: 7261 6765 203d 206d 6f63 6b2e 4d61 6769  rage = mock.Magi
-00015d70: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-00015d80: 6d6f 636b 6564 5f73 746f 7261 6765 2e66  mocked_storage.f
-00015d90: 696e 645f 616c 6c2e 7265 7475 726e 5f76  ind_all.return_v
-00015da0: 616c 7565 203d 205b 2261 6e20 6163 636f  alue = ["an acco
-00015db0: 756e 7422 5d0a 0a20 2020 2020 2020 2073  unt"]..        s
-00015dc0: 656c 662e 6d6f 636b 735b 2761 6363 6f75  elf.mocks['accou
-00015dd0: 6e74 275d 2e41 6363 6f75 6e74 4669 6c65  nt'].AccountFile
-00015de0: 5374 6f72 6167 652e 7265 7475 726e 5f76  Storage.return_v
-00015df0: 616c 7565 203d 206d 6f63 6b65 645f 7374  alue = mocked_st
-00015e00: 6f72 6167 650a 2020 2020 2020 2020 7365  orage.        se
-00015e10: 6c66 2e6d 6f63 6b73 5b27 5f64 6574 6572  lf.mocks['_deter
-00015e20: 6d69 6e65 5f61 6363 6f75 6e74 275d 2e72  mine_account'].r
-00015e30: 6574 7572 6e5f 7661 6c75 6520 3d20 286d  eturn_value = (m
-00015e40: 6f63 6b2e 4d61 6769 634d 6f63 6b28 292c  ock.MagicMock(),
-00015e50: 2022 666f 6f22 290a 0a20 2020 2020 2020   "foo")..       
-00015e60: 2063 625f 636c 6965 6e74 203d 206d 6f63   cb_client = moc
-00015e70: 6b2e 4d61 6769 634d 6f63 6b28 290a 2020  k.MagicMock().  
-00015e80: 2020 2020 2020 7365 6c66 2e6d 6f63 6b73        self.mocks
-00015e90: 5b27 636c 6965 6e74 275d 2e43 6c69 656e  ['client'].Clien
-00015ea0: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
-00015eb0: 2063 625f 636c 6965 6e74 0a0a 2020 2020   cb_client..    
-00015ec0: 2020 2020 636f 6e66 6967 203d 206d 6f63      config = moc
-00015ed0: 6b2e 4d61 6769 634d 6f63 6b28 290a 2020  k.MagicMock().  
-00015ee0: 2020 2020 2020 756e 7573 6564 5f70 6c75        unused_plu
-00015ef0: 6769 6e73 203d 206d 6f63 6b2e 4d61 6769  gins = mock.Magi
-00015f00: 634d 6f63 6b28 290a 0a20 2020 2020 2020  cMock()..       
-00015f10: 2072 6573 203d 206d 6169 6e2e 756e 7265   res = main.unre
-00015f20: 6769 7374 6572 2863 6f6e 6669 672c 2075  gister(config, u
-00015f30: 6e75 7365 645f 706c 7567 696e 7329 0a0a  nused_plugins)..
-00015f40: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-00015f50: 6573 2069 7320 4e6f 6e65 0a20 2020 2020  es is None.     
-00015f60: 2020 206d 6f63 6b5f 6e6f 7469 6679 2e61     mock_notify.a
-00015f70: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
-00015f80: 655f 7769 7468 2822 4163 636f 756e 7420  e_with("Account 
-00015f90: 6465 6163 7469 7661 7465 642e 2229 0a0a  deactivated.")..
-00015fa0: 2020 2020 6465 6620 7465 7374 5f75 6e72      def test_unr
-00015fb0: 6567 6973 7465 725f 6e6f 5f61 6363 6f75  egister_no_accou
-00015fc0: 6e74 2873 656c 6629 3a0a 2020 2020 2020  nt(self):.      
-00015fd0: 2020 6d6f 636b 6564 5f73 746f 7261 6765    mocked_storage
-00015fe0: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
-00015ff0: 6b28 290a 2020 2020 2020 2020 6d6f 636b  k().        mock
-00016000: 6564 5f73 746f 7261 6765 2e66 696e 645f  ed_storage.find_
-00016010: 616c 6c2e 7265 7475 726e 5f76 616c 7565  all.return_value
-00016020: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
-00016030: 6c66 2e6d 6f63 6b73 5b27 6163 636f 756e  lf.mocks['accoun
-00016040: 7427 5d2e 4163 636f 756e 7446 696c 6553  t'].AccountFileS
-00016050: 746f 7261 6765 2e72 6574 7572 6e5f 7661  torage.return_va
-00016060: 6c75 6520 3d20 6d6f 636b 6564 5f73 746f  lue = mocked_sto
-00016070: 7261 6765 0a0a 2020 2020 2020 2020 6362  rage..        cb
-00016080: 5f63 6c69 656e 7420 3d20 6d6f 636b 2e4d  _client = mock.M
-00016090: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-000160a0: 2020 2073 656c 662e 6d6f 636b 735b 2763     self.mocks['c
-000160b0: 6c69 656e 7427 5d2e 436c 6965 6e74 2e72  lient'].Client.r
-000160c0: 6574 7572 6e5f 7661 6c75 6520 3d20 6362  eturn_value = cb
-000160d0: 5f63 6c69 656e 740a 0a20 2020 2020 2020  _client..       
-000160e0: 2063 6f6e 6669 6720 3d20 6d6f 636b 2e4d   config = mock.M
-000160f0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-00016100: 2020 2063 6f6e 6669 672e 7365 7276 6572     config.server
-00016110: 203d 2022 6874 7470 733a 2f2f 6163 6d65   = "https://acme
-00016120: 2e65 7861 6d70 6c65 2e63 6f6d 2f64 6972  .example.com/dir
-00016130: 6563 746f 7279 220a 2020 2020 2020 2020  ectory".        
-00016140: 756e 7573 6564 5f70 6c75 6769 6e73 203d  unused_plugins =
-00016150: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-00016160: 290a 0a20 2020 2020 2020 2072 6573 203d  )..        res =
-00016170: 206d 6169 6e2e 756e 7265 6769 7374 6572   main.unregister
-00016180: 2863 6f6e 6669 672c 2075 6e75 7365 645f  (config, unused_
-00016190: 706c 7567 696e 7329 0a20 2020 2020 2020  plugins).       
-000161a0: 206d 203d 2022 436f 756c 6420 6e6f 7420   m = "Could not 
-000161b0: 6669 6e64 2065 7869 7374 696e 6720 6163  find existing ac
-000161c0: 636f 756e 7420 666f 7220 7365 7276 6572  count for server
-000161d0: 2068 7474 7073 3a2f 2f61 636d 652e 6578   https://acme.ex
-000161e0: 616d 706c 652e 636f 6d2f 6469 7265 6374  ample.com/direct
-000161f0: 6f72 792e 220a 2020 2020 2020 2020 6173  ory.".        as
-00016200: 7365 7274 2072 6573 203d 3d20 6d0a 2020  sert res == m.  
-00016210: 2020 2020 2020 6173 7365 7274 2063 625f        assert cb_
-00016220: 636c 6965 6e74 2e61 636d 652e 6465 6163  client.acme.deac
-00016230: 7469 7661 7465 5f72 6567 6973 7472 6174  tivate_registrat
-00016240: 696f 6e2e 6361 6c6c 6564 2069 7320 4661  ion.called is Fa
-00016250: 6c73 650a 0a0a 636c 6173 7320 4d61 6b65  lse...class Make
-00016260: 4f72 5665 7269 6679 4e65 6564 6564 4469  OrVerifyNeededDi
-00016270: 7273 2874 6573 745f 7574 696c 2e43 6f6e  rs(test_util.Con
-00016280: 6669 6754 6573 7443 6173 6529 3a0a 2020  figTestCase):.  
-00016290: 2020 2222 2254 6573 7473 2066 6f72 2063    """Tests for c
-000162a0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-000162b0: 2e6d 6169 6e2e 6d61 6b65 5f6f 725f 7665  .main.make_or_ve
-000162c0: 7269 6679 5f6e 6565 6465 645f 6469 7273  rify_needed_dirs
-000162d0: 2e22 2222 0a0a 2020 2020 406d 6f63 6b2e  ."""..    @mock.
-000162e0: 7061 7463 6828 2263 6572 7462 6f74 2e5f  patch("certbot._
-000162f0: 696e 7465 726e 616c 2e6d 6169 6e2e 7574  internal.main.ut
-00016300: 696c 2229 0a20 2020 2064 6566 2074 6573  il").    def tes
-00016310: 745f 6974 2873 656c 662c 206d 6f63 6b5f  t_it(self, mock_
-00016320: 7574 696c 293a 0a20 2020 2020 2020 206d  util):.        m
-00016330: 6169 6e2e 6d61 6b65 5f6f 725f 7665 7269  ain.make_or_veri
-00016340: 6679 5f6e 6565 6465 645f 6469 7273 2873  fy_needed_dirs(s
-00016350: 656c 662e 636f 6e66 6967 290a 2020 2020  elf.config).    
-00016360: 2020 2020 666f 7220 636f 7265 5f64 6972      for core_dir
-00016370: 2069 6e20 2873 656c 662e 636f 6e66 6967   in (self.config
-00016380: 2e63 6f6e 6669 675f 6469 722c 2073 656c  .config_dir, sel
-00016390: 662e 636f 6e66 6967 2e77 6f72 6b5f 6469  f.config.work_di
-000163a0: 722c 293a 0a20 2020 2020 2020 2020 2020  r,):.           
-000163b0: 206d 6f63 6b5f 7574 696c 2e73 6574 5f75   mock_util.set_u
-000163c0: 705f 636f 7265 5f64 6972 2e61 7373 6572  p_core_dir.asser
-000163d0: 745f 616e 795f 6361 6c6c 280a 2020 2020  t_any_call(.    
-000163e0: 2020 2020 2020 2020 2020 2020 636f 7265              core
-000163f0: 5f64 6972 2c20 636f 6e73 7461 6e74 732e  _dir, constants.
-00016400: 434f 4e46 4947 5f44 4952 535f 4d4f 4445  CONFIG_DIRS_MODE
-00016410: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016420: 2020 7365 6c66 2e63 6f6e 6669 672e 7374    self.config.st
-00016430: 7269 6374 5f70 6572 6d69 7373 696f 6e73  rict_permissions
-00016440: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00016450: 2020 2020 2020 2020 686f 6f6b 5f64 6972          hook_dir
-00016460: 7320 3d20 2873 656c 662e 636f 6e66 6967  s = (self.config
-00016470: 2e72 656e 6577 616c 5f70 7265 5f68 6f6f  .renewal_pre_hoo
-00016480: 6b73 5f64 6972 2c0a 2020 2020 2020 2020  ks_dir,.        
-00016490: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000164a0: 662e 636f 6e66 6967 2e72 656e 6577 616c  f.config.renewal
-000164b0: 5f64 6570 6c6f 795f 686f 6f6b 735f 6469  _deploy_hooks_di
-000164c0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-000164d0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-000164e0: 6669 672e 7265 6e65 7761 6c5f 706f 7374  fig.renewal_post
-000164f0: 5f68 6f6f 6b73 5f64 6972 2c29 0a20 2020  _hooks_dir,).   
-00016500: 2020 2020 2066 6f72 2068 6f6f 6b5f 6469       for hook_di
-00016510: 7220 696e 2068 6f6f 6b5f 6469 7273 3a0a  r in hook_dirs:.
-00016520: 2020 2020 2020 2020 2020 2020 2320 6465              # de
-00016530: 6661 756c 7420 6d6f 6465 206f 6620 3735  fault mode of 75
-00016540: 3520 6973 2075 7365 640a 2020 2020 2020  5 is used.      
-00016550: 2020 2020 2020 6d6f 636b 5f75 7469 6c2e        mock_util.
-00016560: 6d61 6b65 5f6f 725f 7665 7269 6679 5f64  make_or_verify_d
-00016570: 6972 2e61 7373 6572 745f 616e 795f 6361  ir.assert_any_ca
-00016580: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-00016590: 2020 2020 686f 6f6b 5f64 6972 2c20 7374      hook_dir, st
-000165a0: 7269 6374 3d73 656c 662e 636f 6e66 6967  rict=self.config
-000165b0: 2e73 7472 6963 745f 7065 726d 6973 7369  .strict_permissi
-000165c0: 6f6e 7329 0a0a 0a63 6c61 7373 2045 6e68  ons)...class Enh
-000165d0: 616e 6365 5465 7374 2874 6573 745f 7574  anceTest(test_ut
-000165e0: 696c 2e43 6f6e 6669 6754 6573 7443 6173  il.ConfigTestCas
-000165f0: 6529 3a0a 2020 2020 2222 2254 6573 7473  e):.    """Tests
-00016600: 2066 6f72 2063 6572 7462 6f74 2e5f 696e   for certbot._in
-00016610: 7465 726e 616c 2e6d 6169 6e2e 656e 6861  ternal.main.enha
-00016620: 6e63 652e 2222 220a 0a20 2020 2064 6566  nce."""..    def
-00016630: 2073 6574 5570 2873 656c 6629 3a0a 2020   setUp(self):.  
-00016640: 2020 2020 2020 7375 7065 7228 292e 7365        super().se
-00016650: 7455 7028 290a 2020 2020 2020 2020 7365  tUp().        se
-00016660: 6c66 2e67 6574 5f75 7469 6c69 7479 5f70  lf.get_utility_p
-00016670: 6174 6368 203d 2074 6573 745f 7574 696c  atch = test_util
-00016680: 2e70 6174 6368 5f64 6973 706c 6179 5f75  .patch_display_u
-00016690: 7469 6c28 290a 2020 2020 2020 2020 7365  til().        se
-000166a0: 6c66 2e6d 6f63 6b5f 6765 745f 7574 696c  lf.mock_get_util
-000166b0: 6974 7920 3d20 7365 6c66 2e67 6574 5f75  ity = self.get_u
-000166c0: 7469 6c69 7479 5f70 6174 6368 2e73 7461  tility_patch.sta
-000166d0: 7274 2829 0a20 2020 2020 2020 2073 656c  rt().        sel
-000166e0: 662e 6d6f 636b 696e 7374 616c 6c65 7220  f.mockinstaller 
-000166f0: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-00016700: 2873 7065 633d 656e 6861 6e63 656d 656e  (spec=enhancemen
-00016710: 7473 2e41 7574 6f48 5354 5345 6e68 616e  ts.AutoHSTSEnhan
-00016720: 6365 6d65 6e74 290a 0a20 2020 2064 6566  cement)..    def
-00016730: 2074 6561 7244 6f77 6e28 7365 6c66 293a   tearDown(self):
-00016740: 0a20 2020 2020 2020 2073 656c 662e 6765  .        self.ge
-00016750: 745f 7574 696c 6974 795f 7061 7463 682e  t_utility_patch.
-00016760: 7374 6f70 2829 0a0a 2020 2020 6465 6620  stop()..    def 
-00016770: 5f63 616c 6c28 7365 6c66 2c20 6172 6773  _call(self, args
-00016780: 293a 0a20 2020 2020 2020 2070 6c75 6769  ):.        plugi
-00016790: 6e73 203d 2064 6973 636f 2e50 6c75 6769  ns = disco.Plugi
-000167a0: 6e73 5265 6769 7374 7279 2e66 696e 645f  nsRegistry.find_
-000167b0: 616c 6c28 290a 2020 2020 2020 2020 636f  all().        co
-000167c0: 6e66 6967 203d 2063 6f6e 6669 6775 7261  nfig = configura
-000167d0: 7469 6f6e 2e4e 616d 6573 7061 6365 436f  tion.NamespaceCo
-000167e0: 6e66 6967 280a 2020 2020 2020 2020 2020  nfig(.          
-000167f0: 2020 636c 692e 7072 6570 6172 655f 616e    cli.prepare_an
-00016800: 645f 7061 7273 655f 6172 6773 2870 6c75  d_parse_args(plu
-00016810: 6769 6e73 2c20 6172 6773 2929 0a0a 2020  gins, args))..  
-00016820: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
-00016830: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00016840: 696e 7465 726e 616c 2e63 6572 745f 6d61  internal.cert_ma
-00016850: 6e61 6765 722e 6765 745f 6365 7274 6e61  nager.get_certna
-00016860: 6d65 7327 2920 6173 206d 6f63 6b5f 6365  mes') as mock_ce
-00016870: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
-00016880: 206d 6f63 6b5f 6365 7274 732e 7265 7475   mock_certs.retu
-00016890: 726e 5f76 616c 7565 203d 205b 2765 7861  rn_value = ['exa
-000168a0: 6d70 6c65 2e63 6f6d 275d 0a20 2020 2020  mple.com'].     
-000168b0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-000168c0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-000168d0: 5f69 6e74 6572 6e61 6c2e 6365 7274 5f6d  _internal.cert_m
-000168e0: 616e 6167 6572 2e64 6f6d 6169 6e73 5f66  anager.domains_f
-000168f0: 6f72 5f63 6572 746e 616d 6527 2920 6173  or_certname') as
-00016900: 206d 6f63 6b5f 646f 6d3a 0a20 2020 2020   mock_dom:.     
-00016910: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
-00016920: 646f 6d2e 7265 7475 726e 5f76 616c 7565  dom.return_value
-00016930: 203d 205b 2765 7861 6d70 6c65 2e63 6f6d   = ['example.com
-00016940: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00016950: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
-00016960: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-00016970: 6572 6e61 6c2e 6d61 696e 2e5f 696e 6974  ernal.main._init
-00016980: 5f6c 655f 636c 6965 6e74 2729 2061 7320  _le_client') as 
-00016990: 6d6f 636b 5f69 6e69 743a 0a20 2020 2020  mock_init:.     
-000169a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000169b0: 6f63 6b5f 636c 6965 6e74 203d 206d 6f63  ock_client = moc
-000169c0: 6b2e 4d61 6769 634d 6f63 6b28 290a 2020  k.MagicMock().  
-000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169e0: 2020 6d6f 636b 5f63 6c69 656e 742e 636f    mock_client.co
-000169f0: 6e66 6967 203d 2063 6f6e 6669 670a 2020  nfig = config.  
-00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a10: 2020 6d6f 636b 5f69 6e69 742e 7265 7475    mock_init.retu
-00016a20: 726e 5f76 616c 7565 203d 206d 6f63 6b5f  rn_value = mock_
-00016a30: 636c 6965 6e74 0a20 2020 2020 2020 2020  client.         
-00016a40: 2020 2020 2020 2020 2020 206d 6169 6e2e             main.
-00016a50: 656e 6861 6e63 6528 636f 6e66 6967 2c20  enhance(config, 
-00016a60: 706c 7567 696e 7329 0a20 2020 2020 2020  plugins).       
-00016a70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00016a80: 7572 6e20 6d6f 636b 5f63 6c69 656e 7420  urn mock_client 
-00016a90: 2320 7265 7475 726e 7320 7468 6520 636c  # returns the cl
-00016aa0: 6965 6e74 0a0a 2020 2020 406d 6f63 6b2e  ient..    @mock.
-00016ab0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00016ac0: 696e 7465 726e 616c 2e6d 6169 6e2e 706c  internal.main.pl
-00016ad0: 7567 5f73 656c 2e72 6563 6f72 645f 6368  ug_sel.record_ch
-00016ae0: 6f73 656e 5f70 6c75 6769 6e73 2729 0a20  osen_plugins'). 
-00016af0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-00016b00: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00016b10: 6c2e 6365 7274 5f6d 616e 6167 6572 2e6c  l.cert_manager.l
-00016b20: 696e 6561 6765 5f66 6f72 5f63 6572 746e  ineage_for_certn
-00016b30: 616d 6527 290a 2020 2020 406d 6f63 6b2e  ame').    @mock.
-00016b40: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
-00016b50: 696e 7465 726e 616c 2e6d 6169 6e2e 6469  internal.main.di
-00016b60: 7370 6c61 795f 6f70 732e 6368 6f6f 7365  splay_ops.choose
-00016b70: 5f76 616c 7565 7327 290a 2020 2020 406d  _values').    @m
-00016b80: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00016b90: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00016ba0: 6e2e 5f66 696e 645f 646f 6d61 696e 735f  n._find_domains_
-00016bb0: 6f72 5f63 6572 746e 616d 6527 290a 2020  or_certname').  
-00016bc0: 2020 6465 6620 7465 7374 5f73 656c 6563    def test_selec
-00016bd0: 7469 6f6e 5f71 7565 7374 696f 6e28 7365  tion_question(se
-00016be0: 6c66 2c20 6d6f 636b 5f66 696e 642c 206d  lf, mock_find, m
-00016bf0: 6f63 6b5f 6368 6f6f 7365 2c20 6d6f 636b  ock_choose, mock
-00016c00: 5f6c 696e 6561 6765 2c20 5f72 6563 293a  _lineage, _rec):
-00016c10: 0a20 2020 2020 2020 206d 6f63 6b5f 6c69  .        mock_li
-00016c20: 6e65 6167 652e 7265 7475 726e 5f76 616c  neage.return_val
-00016c30: 7565 203d 206d 6f63 6b2e 4d61 6769 634d  ue = mock.MagicM
-00016c40: 6f63 6b28 6368 6169 6e5f 7061 7468 3d22  ock(chain_path="
-00016c50: 2f74 6d70 2f6e 6f6e 6578 6973 7465 6e74  /tmp/nonexistent
-00016c60: 2229 0a20 2020 2020 2020 206d 6f63 6b5f  ").        mock_
-00016c70: 6368 6f6f 7365 2e72 6574 7572 6e5f 7661  choose.return_va
-00016c80: 6c75 6520 3d20 5b27 6578 616d 706c 652e  lue = ['example.
-00016c90: 636f 6d27 5d0a 2020 2020 2020 2020 6d6f  com'].        mo
-00016ca0: 636b 5f66 696e 642e 7265 7475 726e 5f76  ck_find.return_v
-00016cb0: 616c 7565 203d 2028 4e6f 6e65 2c20 4e6f  alue = (None, No
-00016cc0: 6e65 290a 2020 2020 2020 2020 7769 7468  ne).        with
-00016cd0: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
-00016ce0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-00016cf0: 6169 6e2e 706c 7567 5f73 656c 2e70 6963  ain.plug_sel.pic
-00016d00: 6b5f 696e 7374 616c 6c65 7227 2920 6173  k_installer') as
-00016d10: 206d 6f63 6b5f 7069 636b 3a0a 2020 2020   mock_pick:.    
-00016d20: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
-00016d30: 6c6c 285b 2765 6e68 616e 6365 272c 2027  ll(['enhance', '
-00016d40: 2d2d 7265 6469 7265 6374 275d 290a 2020  --redirect']).  
-00016d50: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00016d60: 206d 6f63 6b5f 7069 636b 2e63 616c 6c65   mock_pick.calle
-00016d70: 640a 2020 2020 2020 2020 2020 2020 2320  d.            # 
-00016d80: 4368 6563 6b20 7468 6174 2074 6865 206d  Check that the m
-00016d90: 6573 7361 6765 2069 6e63 6c75 6465 7320  essage includes 
-00016da0: 2265 6e68 616e 6365 6d65 6e74 7322 0a20  "enhancements". 
-00016db0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00016dc0: 7420 2265 6e68 616e 6365 6d65 6e74 7322  t "enhancements"
-00016dd0: 2069 6e20 6d6f 636b 5f70 6963 6b2e 6361   in mock_pick.ca
-00016de0: 6c6c 5f61 7267 735b 305d 5b33 5d0a 0a20  ll_args[0][3].. 
-00016df0: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-00016e00: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00016e10: 6c2e 6d61 696e 2e70 6c75 675f 7365 6c2e  l.main.plug_sel.
-00016e20: 7265 636f 7264 5f63 686f 7365 6e5f 706c  record_chosen_pl
-00016e30: 7567 696e 7327 290a 2020 2020 406d 6f63  ugins').    @moc
-00016e40: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00016e50: 2e5f 696e 7465 726e 616c 2e63 6572 745f  ._internal.cert_
-00016e60: 6d61 6e61 6765 722e 6c69 6e65 6167 655f  manager.lineage_
-00016e70: 666f 725f 6365 7274 6e61 6d65 2729 0a20  for_certname'). 
-00016e80: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
-00016e90: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-00016ea0: 6c2e 6d61 696e 2e64 6973 706c 6179 5f6f  l.main.display_o
-00016eb0: 7073 2e63 686f 6f73 655f 7661 6c75 6573  ps.choose_values
-00016ec0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-00016ed0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-00016ee0: 6572 6e61 6c2e 6d61 696e 2e5f 6669 6e64  ernal.main._find
-00016ef0: 5f64 6f6d 6169 6e73 5f6f 725f 6365 7274  _domains_or_cert
-00016f00: 6e61 6d65 2729 0a20 2020 2064 6566 2074  name').    def t
-00016f10: 6573 745f 7365 6c65 6374 696f 6e5f 6175  est_selection_au
-00016f20: 7468 5f77 6172 6e69 6e67 2873 656c 662c  th_warning(self,
-00016f30: 206d 6f63 6b5f 6669 6e64 2c20 6d6f 636b   mock_find, mock
-00016f40: 5f63 686f 6f73 652c 206d 6f63 6b5f 6c69  _choose, mock_li
-00016f50: 6e65 6167 652c 205f 7265 6329 3a0a 2020  neage, _rec):.  
-00016f60: 2020 2020 2020 6d6f 636b 5f6c 696e 6561        mock_linea
-00016f70: 6765 2e72 6574 7572 6e5f 7661 6c75 6520  ge.return_value 
-00016f80: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-00016f90: 2863 6861 696e 5f70 6174 683d 222f 746d  (chain_path="/tm
-00016fa0: 702f 6e6f 6e65 7869 7374 656e 7422 290a  p/nonexistent").
-00016fb0: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
-00016fc0: 6f73 652e 7265 7475 726e 5f76 616c 7565  ose.return_value
-00016fd0: 203d 205b 2265 7861 6d70 6c65 2e63 6f6d   = ["example.com
-00016fe0: 225d 0a20 2020 2020 2020 206d 6f63 6b5f  "].        mock_
-00016ff0: 6669 6e64 2e72 6574 7572 6e5f 7661 6c75  find.return_valu
-00017000: 6520 3d20 284e 6f6e 652c 204e 6f6e 6529  e = (None, None)
-00017010: 0a20 2020 2020 2020 2077 6974 6820 6d6f  .        with mo
-00017020: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00017030: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-00017040: 2e70 6c75 675f 7365 6c2e 7069 636b 5f69  .plug_sel.pick_i
-00017050: 6e73 7461 6c6c 6572 2729 3a0a 2020 2020  nstaller'):.    
-00017060: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
-00017070: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00017080: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00017090: 706c 7567 5f73 656c 2e6c 6f67 6765 722e  plug_sel.logger.
-000170a0: 7761 726e 696e 6727 2920 6173 206d 6f63  warning') as moc
-000170b0: 6b5f 6c6f 673a 0a20 2020 2020 2020 2020  k_log:.         
-000170c0: 2020 2020 2020 206d 6f63 6b5f 636c 6965         mock_clie
-000170d0: 6e74 203d 2073 656c 662e 5f63 616c 6c28  nt = self._call(
-000170e0: 5b27 656e 6861 6e63 6527 2c20 272d 6127  ['enhance', '-a'
-000170f0: 2c20 2777 6562 726f 6f74 272c 2027 2d2d  , 'webroot', '--
-00017100: 7265 6469 7265 6374 275d 290a 2020 2020  redirect']).    
-00017110: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00017120: 7274 206d 6f63 6b5f 6c6f 672e 6361 6c6c  rt mock_log.call
-00017130: 6564 0a20 2020 2020 2020 2020 2020 2020  ed.             
-00017140: 2020 2061 7373 6572 7420 226d 616b 6520     assert "make 
-00017150: 7365 6e73 6522 2069 6e20 6d6f 636b 5f6c  sense" in mock_l
-00017160: 6f67 2e63 616c 6c5f 6172 6773 5b30 5d5b  og.call_args[0][
-00017170: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-00017180: 2020 2061 7373 6572 7420 6d6f 636b 5f63     assert mock_c
-00017190: 6c69 656e 742e 656e 6861 6e63 655f 636f  lient.enhance_co
-000171a0: 6e66 6967 2e63 616c 6c65 640a 0a20 2020  nfig.called..   
-000171b0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
-000171c0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-000171d0: 6365 7274 5f6d 616e 6167 6572 2e6c 696e  cert_manager.lin
-000171e0: 6561 6765 5f66 6f72 5f63 6572 746e 616d  eage_for_certnam
-000171f0: 6527 290a 2020 2020 406d 6f63 6b2e 7061  e').    @mock.pa
-00017200: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00017210: 7465 726e 616c 2e6d 6169 6e2e 6469 7370  ternal.main.disp
-00017220: 6c61 795f 6f70 732e 6368 6f6f 7365 5f76  lay_ops.choose_v
-00017230: 616c 7565 7327 290a 2020 2020 406d 6f63  alues').    @moc
-00017240: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00017250: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00017260: 706c 7567 5f73 656c 2e72 6563 6f72 645f  plug_sel.record_
-00017270: 6368 6f73 656e 5f70 6c75 6769 6e73 2729  chosen_plugins')
-00017280: 0a20 2020 2064 6566 2074 6573 745f 656e  .    def test_en
-00017290: 6861 6e63 655f 636f 6e66 6967 5f63 616c  hance_config_cal
-000172a0: 6c28 7365 6c66 2c20 5f72 6563 2c20 6d6f  l(self, _rec, mo
-000172b0: 636b 5f63 686f 6f73 652c 206d 6f63 6b5f  ck_choose, mock_
-000172c0: 6c69 6e65 6167 6529 3a0a 2020 2020 2020  lineage):.      
-000172d0: 2020 6d6f 636b 5f6c 696e 6561 6765 2e72    mock_lineage.r
-000172e0: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
-000172f0: 636b 2e4d 6167 6963 4d6f 636b 2863 6861  ck.MagicMock(cha
-00017300: 696e 5f70 6174 683d 222f 746d 702f 6e6f  in_path="/tmp/no
-00017310: 6e65 7869 7374 656e 7422 290a 2020 2020  nexistent").    
-00017320: 2020 2020 6d6f 636b 5f63 686f 6f73 652e      mock_choose.
-00017330: 7265 7475 726e 5f76 616c 7565 203d 205b  return_value = [
-00017340: 2265 7861 6d70 6c65 2e63 6f6d 225d 0a20  "example.com"]. 
-00017350: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-00017360: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-00017370: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e70  _internal.main.p
-00017380: 6c75 675f 7365 6c2e 7069 636b 5f69 6e73  lug_sel.pick_ins
-00017390: 7461 6c6c 6572 2729 3a0a 2020 2020 2020  taller'):.      
-000173a0: 2020 2020 2020 6d6f 636b 5f63 6c69 656e        mock_clien
-000173b0: 7420 3d20 7365 6c66 2e5f 6361 6c6c 285b  t = self._call([
-000173c0: 2765 6e68 616e 6365 272c 2027 2d2d 7265  'enhance', '--re
-000173d0: 6469 7265 6374 272c 2027 2d2d 6873 7473  direct', '--hsts
-000173e0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-000173f0: 7265 715f 656e 6820 3d20 5b22 7265 6469  req_enh = ["redi
-00017400: 7265 6374 222c 2022 6873 7473 225d 0a20  rect", "hsts"]. 
-00017410: 2020 2020 2020 2020 2020 206e 6f74 5f72             not_r
-00017420: 6571 5f65 6e68 203d 205b 2275 6972 225d  eq_enh = ["uir"]
-00017430: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00017440: 6572 7420 6d6f 636b 5f63 6c69 656e 742e  ert mock_client.
-00017450: 656e 6861 6e63 655f 636f 6e66 6967 2e63  enhance_config.c
-00017460: 616c 6c65 640a 2020 2020 2020 2020 2020  alled.          
-00017470: 2020 6173 7365 7274 2061 6c6c 2867 6574    assert all(get
-00017480: 6174 7472 286d 6f63 6b5f 636c 6965 6e74  attr(mock_client
-00017490: 2e63 6f6e 6669 672c 2065 2920 666f 7220  .config, e) for 
-000174a0: 6520 696e 2072 6571 5f65 6e68 290a 2020  e in req_enh).  
-000174b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-000174c0: 206e 6f74 2061 6e79 2867 6574 6174 7472   not any(getattr
-000174d0: 286d 6f63 6b5f 636c 6965 6e74 2e63 6f6e  (mock_client.con
-000174e0: 6669 672c 2065 2920 666f 7220 6520 696e  fig, e) for e in
-000174f0: 206e 6f74 5f72 6571 5f65 6e68 290a 2020   not_req_enh).  
-00017500: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00017510: 2022 6578 616d 706c 652e 636f 6d22 2069   "example.com" i
-00017520: 6e20 6d6f 636b 5f63 6c69 656e 742e 656e  n mock_client.en
-00017530: 6861 6e63 655f 636f 6e66 6967 2e63 616c  hance_config.cal
-00017540: 6c5f 6172 6773 5b30 5d5b 305d 0a0a 2020  l_args[0][0]..  
-00017550: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
-00017560: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-00017570: 2e63 6572 745f 6d61 6e61 6765 722e 6c69  .cert_manager.li
-00017580: 6e65 6167 655f 666f 725f 6365 7274 6e61  neage_for_certna
-00017590: 6d65 2729 0a20 2020 2040 6d6f 636b 2e70  me').    @mock.p
-000175a0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000175b0: 6e74 6572 6e61 6c2e 6d61 696e 2e64 6973  nternal.main.dis
-000175c0: 706c 6179 5f6f 7073 2e63 686f 6f73 655f  play_ops.choose_
-000175d0: 7661 6c75 6573 2729 0a20 2020 2040 6d6f  values').    @mo
-000175e0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-000175f0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-00017600: 2e70 6c75 675f 7365 6c2e 7265 636f 7264  .plug_sel.record
-00017610: 5f63 686f 7365 6e5f 706c 7567 696e 7327  _chosen_plugins'
-00017620: 290a 2020 2020 6465 6620 7465 7374 5f65  ).    def test_e
-00017630: 6e68 616e 6365 5f6e 6f6e 696e 7465 7261  nhance_nonintera
-00017640: 6374 6976 6528 7365 6c66 2c20 5f72 6563  ctive(self, _rec
-00017650: 2c20 6d6f 636b 5f63 686f 6f73 652c 206d  , mock_choose, m
-00017660: 6f63 6b5f 6c69 6e65 6167 6529 3a0a 2020  ock_lineage):.  
-00017670: 2020 2020 2020 6d6f 636b 5f6c 696e 6561        mock_linea
-00017680: 6765 2e72 6574 7572 6e5f 7661 6c75 6520  ge.return_value 
-00017690: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-000176a0: 280a 2020 2020 2020 2020 2020 2020 6368  (.            ch
-000176b0: 6169 6e5f 7061 7468 3d22 2f74 6d70 2f6e  ain_path="/tmp/n
-000176c0: 6f6e 6578 6973 7465 6e74 2229 0a20 2020  onexistent").   
-000176d0: 2020 2020 206d 6f63 6b5f 6368 6f6f 7365       mock_choose
-000176e0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-000176f0: 5b22 6578 616d 706c 652e 636f 6d22 5d0a  ["example.com"].
-00017700: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
-00017710: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00017720: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00017730: 706c 7567 5f73 656c 2e70 6963 6b5f 696e  plug_sel.pick_in
-00017740: 7374 616c 6c65 7227 293a 0a20 2020 2020  staller'):.     
-00017750: 2020 2020 2020 206d 6f63 6b5f 636c 6965         mock_clie
-00017760: 6e74 203d 2073 656c 662e 5f63 616c 6c28  nt = self._call(
-00017770: 5b27 656e 6861 6e63 6527 2c20 272d 2d72  ['enhance', '--r
-00017780: 6564 6972 6563 7427 2c0a 2020 2020 2020  edirect',.      
-00017790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177b0: 272d 2d68 7374 7327 2c20 272d 2d6e 6f6e  '--hsts', '--non
-000177c0: 2d69 6e74 6572 6163 7469 7665 275d 290a  -interactive']).
-000177d0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000177e0: 7274 206d 6f63 6b5f 636c 6965 6e74 2e65  rt mock_client.e
-000177f0: 6e68 616e 6365 5f63 6f6e 6669 672e 6361  nhance_config.ca
-00017800: 6c6c 6564 0a20 2020 2020 2020 2020 2020  lled.           
-00017810: 2061 7373 6572 7420 6d6f 636b 5f63 686f   assert mock_cho
-00017820: 6f73 652e 6361 6c6c 6564 2069 7320 4661  ose.called is Fa
-00017830: 6c73 650a 0a20 2020 2040 6d6f 636b 2e70  lse..    @mock.p
-00017840: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00017850: 6e74 6572 6e61 6c2e 6d61 696e 2e64 6973  nternal.main.dis
-00017860: 706c 6179 5f6f 7073 2e63 686f 6f73 655f  play_ops.choose_
-00017870: 7661 6c75 6573 2729 0a20 2020 2040 6d6f  values').    @mo
-00017880: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00017890: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-000178a0: 2e70 6c75 675f 7365 6c2e 7265 636f 7264  .plug_sel.record
-000178b0: 5f63 686f 7365 6e5f 706c 7567 696e 7327  _chosen_plugins'
-000178c0: 290a 2020 2020 6465 6620 7465 7374 5f75  ).    def test_u
-000178d0: 7365 725f 6162 6f72 745f 646f 6d61 696e  ser_abort_domain
-000178e0: 7328 7365 6c66 2c20 5f72 6563 2c20 6d6f  s(self, _rec, mo
-000178f0: 636b 5f63 686f 6f73 6529 3a0a 2020 2020  ck_choose):.    
-00017900: 2020 2020 6d6f 636b 5f63 686f 6f73 652e      mock_choose.
-00017910: 7265 7475 726e 5f76 616c 7565 203d 205b  return_value = [
-00017920: 5d0a 2020 2020 2020 2020 7769 7468 206d  ].        with m
-00017930: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00017940: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00017950: 6e2e 706c 7567 5f73 656c 2e70 6963 6b5f  n.plug_sel.pick_
-00017960: 696e 7374 616c 6c65 7227 293a 0a20 2020  installer'):.   
-00017970: 2020 2020 2020 2020 2077 6974 6820 7079           with py
-00017980: 7465 7374 2e72 6169 7365 7328 6572 726f  test.raises(erro
-00017990: 7273 2e45 7272 6f72 293a 0a20 2020 2020  rs.Error):.     
-000179a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000179b0: 5f63 616c 6c28 5b27 656e 6861 6e63 6527  _call(['enhance'
-000179c0: 2c20 272d 2d72 6564 6972 6563 7427 2c20  , '--redirect', 
-000179d0: 272d 2d68 7374 7327 5d29 0a0a 2020 2020  '--hsts'])..    
-000179e0: 6465 6620 7465 7374 5f6e 6f5f 656e 6861  def test_no_enha
-000179f0: 6e63 656d 656e 7473 5f64 6566 696e 6564  ncements_defined
-00017a00: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00017a10: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
-00017a20: 6573 2865 7272 6f72 732e 4d69 7363 6f6e  es(errors.Miscon
-00017a30: 6669 6775 7261 7469 6f6e 4572 726f 7229  figurationError)
-00017a40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00017a50: 6c66 2e5f 6361 6c6c 285b 2765 6e68 616e  lf._call(['enhan
-00017a60: 6365 272c 2027 2d61 272c 2027 6e75 6c6c  ce', '-a', 'null
-00017a70: 275d 290a 0a20 2020 2040 6d6f 636b 2e70  '])..    @mock.p
-00017a80: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-00017a90: 6e74 6572 6e61 6c2e 6d61 696e 2e70 6c75  nternal.main.plu
-00017aa0: 675f 7365 6c2e 6368 6f6f 7365 5f63 6f6e  g_sel.choose_con
-00017ab0: 6669 6775 7261 746f 725f 706c 7567 696e  figurator_plugin
-00017ac0: 7327 290a 2020 2020 406d 6f63 6b2e 7061  s').    @mock.pa
-00017ad0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00017ae0: 7465 726e 616c 2e6d 6169 6e2e 6469 7370  ternal.main.disp
-00017af0: 6c61 795f 6f70 732e 6368 6f6f 7365 5f76  lay_ops.choose_v
-00017b00: 616c 7565 7327 290a 2020 2020 406d 6f63  alues').    @moc
-00017b10: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00017b20: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00017b30: 706c 7567 5f73 656c 2e72 6563 6f72 645f  plug_sel.record_
-00017b40: 6368 6f73 656e 5f70 6c75 6769 6e73 2729  chosen_plugins')
-00017b50: 0a20 2020 2064 6566 2074 6573 745f 706c  .    def test_pl
-00017b60: 7567 696e 5f73 656c 6563 7469 6f6e 5f65  ugin_selection_e
-00017b70: 7272 6f72 2873 656c 662c 205f 7265 632c  rror(self, _rec,
-00017b80: 206d 6f63 6b5f 6368 6f6f 7365 2c20 6d6f   mock_choose, mo
-00017b90: 636b 5f70 6963 6b29 3a0a 2020 2020 2020  ck_pick):.      
-00017ba0: 2020 6d6f 636b 5f63 686f 6f73 652e 7265    mock_choose.re
-00017bb0: 7475 726e 5f76 616c 7565 203d 205b 2265  turn_value = ["e
-00017bc0: 7861 6d70 6c65 2e63 6f6d 225d 0a20 2020  xample.com"].   
-00017bd0: 2020 2020 206d 6f63 6b5f 7069 636b 2e72       mock_pick.r
-00017be0: 6574 7572 6e5f 7661 6c75 6520 3d20 284e  eturn_value = (N
-00017bf0: 6f6e 652c 204e 6f6e 6529 0a20 2020 2020  one, None).     
-00017c00: 2020 206d 6f63 6b5f 7069 636b 2e73 6964     mock_pick.sid
-00017c10: 655f 6566 6665 6374 203d 2065 7272 6f72  e_effect = error
-00017c20: 732e 506c 7567 696e 5365 6c65 6374 696f  s.PluginSelectio
-00017c30: 6e45 7272 6f72 2829 0a20 2020 2020 2020  nError().       
-00017c40: 206d 6f63 6b5f 636c 6965 6e74 203d 2073   mock_client = s
-00017c50: 656c 662e 5f63 616c 6c28 5b27 656e 6861  elf._call(['enha
-00017c60: 6e63 6527 2c20 272d 2d68 7374 7327 5d29  nce', '--hsts'])
-00017c70: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00017c80: 6d6f 636b 5f63 6c69 656e 742e 656e 6861  mock_client.enha
-00017c90: 6e63 655f 636f 6e66 6967 2e63 616c 6c65  nce_config.calle
-00017ca0: 6420 6973 2046 616c 7365 0a0a 2020 2020  d is False..    
-00017cb0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-00017cc0: 7462 6f74 2e5f 696e 7465 726e 616c 2e63  tbot._internal.c
-00017cd0: 6572 745f 6d61 6e61 6765 722e 6c69 6e65  ert_manager.line
-00017ce0: 6167 655f 666f 725f 6365 7274 6e61 6d65  age_for_certname
-00017cf0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-00017d00: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-00017d10: 6572 6e61 6c2e 6d61 696e 2e64 6973 706c  ernal.main.displ
-00017d20: 6179 5f6f 7073 2e63 686f 6f73 655f 7661  ay_ops.choose_va
-00017d30: 6c75 6573 2729 0a20 2020 2040 6d6f 636b  lues').    @mock
-00017d40: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-00017d50: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e70  _internal.main.p
-00017d60: 6c75 675f 7365 6c2e 7069 636b 5f69 6e73  lug_sel.pick_ins
-00017d70: 7461 6c6c 6572 2729 0a20 2020 2040 6d6f  taller').    @mo
-00017d80: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-00017d90: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
-00017da0: 2e70 6c75 675f 7365 6c2e 7265 636f 7264  .plug_sel.record
-00017db0: 5f63 686f 7365 6e5f 706c 7567 696e 7327  _chosen_plugins'
-00017dc0: 290a 2020 2020 4074 6573 745f 7574 696c  ).    @test_util
-00017dd0: 2e70 6174 6368 5f64 6973 706c 6179 5f75  .patch_display_u
-00017de0: 7469 6c28 290a 2020 2020 6465 6620 7465  til().    def te
-00017df0: 7374 5f65 6e68 616e 6365 6d65 6e74 5f65  st_enhancement_e
-00017e00: 6e61 626c 6528 7365 6c66 2c20 5f2c 205f  nable(self, _, _
-00017e10: 7265 632c 206d 6f63 6b5f 696e 7374 2c20  rec, mock_inst, 
-00017e20: 6d6f 636b 5f63 686f 6f73 652c 206d 6f63  mock_choose, moc
-00017e30: 6b5f 6c69 6e65 6167 6529 3a0a 2020 2020  k_lineage):.    
-00017e40: 2020 2020 6d6f 636b 5f69 6e73 742e 7265      mock_inst.re
-00017e50: 7475 726e 5f76 616c 7565 203d 2073 656c  turn_value = sel
-00017e60: 662e 6d6f 636b 696e 7374 616c 6c65 720a  f.mockinstaller.
-00017e70: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
-00017e80: 6f73 652e 7265 7475 726e 5f76 616c 7565  ose.return_value
-00017e90: 203d 205b 2265 7861 6d70 6c65 2e63 6f6d   = ["example.com
-00017ea0: 222c 2022 616e 6f74 6865 722e 746c 6422  ", "another.tld"
-00017eb0: 5d0a 2020 2020 2020 2020 6d6f 636b 5f6c  ].        mock_l
-00017ec0: 696e 6561 6765 2e72 6574 7572 6e5f 7661  ineage.return_va
-00017ed0: 6c75 6520 3d20 6d6f 636b 2e4d 6167 6963  lue = mock.Magic
-00017ee0: 4d6f 636b 2863 6861 696e 5f70 6174 683d  Mock(chain_path=
-00017ef0: 222f 746d 702f 6e6f 6e65 7869 7374 656e  "/tmp/nonexisten
-00017f00: 7422 290a 2020 2020 2020 2020 7365 6c66  t").        self
-00017f10: 2e5f 6361 6c6c 285b 2765 6e68 616e 6365  ._call(['enhance
-00017f20: 272c 2027 2d2d 6175 746f 2d68 7374 7327  ', '--auto-hsts'
-00017f30: 5d29 0a20 2020 2020 2020 2061 7373 6572  ]).        asser
-00017f40: 7420 7365 6c66 2e6d 6f63 6b69 6e73 7461  t self.mockinsta
-00017f50: 6c6c 6572 2e65 6e61 626c 655f 6175 746f  ller.enable_auto
-00017f60: 6873 7473 2e63 616c 6c65 640a 2020 2020  hsts.called.    
-00017f70: 2020 2020 6173 7365 7274 2073 656c 662e      assert self.
-00017f80: 6d6f 636b 696e 7374 616c 6c65 722e 656e  mockinstaller.en
-00017f90: 6162 6c65 5f61 7574 6f68 7374 732e 6361  able_autohsts.ca
-00017fa0: 6c6c 5f61 7267 735b 305d 5b31 5d20 3d3d  ll_args[0][1] ==
-00017fb0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00017fc0: 2020 2020 2020 2020 2020 2020 205b 2265               ["e
-00017fd0: 7861 6d70 6c65 2e63 6f6d 222c 2022 616e  xample.com", "an
-00017fe0: 6f74 6865 722e 746c 6422 5d0a 0a20 2020  other.tld"]..   
-00017ff0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
-00018000: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-00018010: 6365 7274 5f6d 616e 6167 6572 2e6c 696e  cert_manager.lin
-00018020: 6561 6765 5f66 6f72 5f63 6572 746e 616d  eage_for_certnam
-00018030: 6527 290a 2020 2020 406d 6f63 6b2e 7061  e').    @mock.pa
-00018040: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
-00018050: 7465 726e 616c 2e6d 6169 6e2e 6469 7370  ternal.main.disp
-00018060: 6c61 795f 6f70 732e 6368 6f6f 7365 5f76  lay_ops.choose_v
-00018070: 616c 7565 7327 290a 2020 2020 406d 6f63  alues').    @moc
-00018080: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-00018090: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-000180a0: 706c 7567 5f73 656c 2e70 6963 6b5f 696e  plug_sel.pick_in
-000180b0: 7374 616c 6c65 7227 290a 2020 2020 406d  staller').    @m
-000180c0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-000180d0: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-000180e0: 6e2e 706c 7567 5f73 656c 2e72 6563 6f72  n.plug_sel.recor
-000180f0: 645f 6368 6f73 656e 5f70 6c75 6769 6e73  d_chosen_plugins
-00018100: 2729 0a20 2020 2040 7465 7374 5f75 7469  ').    @test_uti
-00018110: 6c2e 7061 7463 685f 6469 7370 6c61 795f  l.patch_display_
-00018120: 7574 696c 2829 0a20 2020 2064 6566 2074  util().    def t
-00018130: 6573 745f 656e 6861 6e63 656d 656e 745f  est_enhancement_
-00018140: 656e 6162 6c65 5f6e 6f74 5f73 7570 706f  enable_not_suppo
-00018150: 7274 6564 2873 656c 662c 205f 2c20 5f72  rted(self, _, _r
-00018160: 6563 2c20 6d6f 636b 5f69 6e73 742c 206d  ec, mock_inst, m
-00018170: 6f63 6b5f 6368 6f6f 7365 2c20 6d6f 636b  ock_choose, mock
-00018180: 5f6c 696e 6561 6765 293a 0a20 2020 2020  _lineage):.     
-00018190: 2020 206d 6f63 6b5f 696e 7374 2e72 6574     mock_inst.ret
-000181a0: 7572 6e5f 7661 6c75 6520 3d20 6e75 6c6c  urn_value = null
-000181b0: 2e49 6e73 7461 6c6c 6572 2873 656c 662e  .Installer(self.
-000181c0: 636f 6e66 6967 2c20 226e 756c 6c22 290a  config, "null").
-000181d0: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
-000181e0: 6f73 652e 7265 7475 726e 5f76 616c 7565  ose.return_value
-000181f0: 203d 205b 2265 7861 6d70 6c65 2e63 6f6d   = ["example.com
-00018200: 222c 2022 616e 6f74 6865 722e 746c 6422  ", "another.tld"
-00018210: 5d0a 2020 2020 2020 2020 6d6f 636b 5f6c  ].        mock_l
-00018220: 696e 6561 6765 2e72 6574 7572 6e5f 7661  ineage.return_va
-00018230: 6c75 6520 3d20 6d6f 636b 2e4d 6167 6963  lue = mock.Magic
-00018240: 4d6f 636b 2863 6861 696e 5f70 6174 683d  Mock(chain_path=
-00018250: 222f 746d 702f 6e6f 6e65 7869 7374 656e  "/tmp/nonexisten
-00018260: 7422 290a 2020 2020 2020 2020 7769 7468  t").        with
-00018270: 2070 7974 6573 742e 7261 6973 6573 2865   pytest.raises(e
-00018280: 7272 6f72 732e 4e6f 7453 7570 706f 7274  rrors.NotSupport
-00018290: 6564 4572 726f 7229 3a0a 2020 2020 2020  edError):.      
-000182a0: 2020 2020 2020 7365 6c66 2e5f 6361 6c6c        self._call
-000182b0: 285b 2765 6e68 616e 6365 272c 2027 2d2d  (['enhance', '--
-000182c0: 6175 746f 2d68 7374 7327 5d29 0a0a 2020  auto-hsts'])..  
-000182d0: 2020 6465 6620 7465 7374 5f65 6e68 616e    def test_enhan
-000182e0: 6365 6d65 6e74 5f65 6e61 626c 655f 636f  cement_enable_co
-000182f0: 6e66 6c69 6374 2873 656c 6629 3a0a 2020  nflict(self):.  
-00018300: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
-00018310: 742e 7261 6973 6573 2865 7272 6f72 732e  t.raises(errors.
-00018320: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00018330: 2020 2020 7365 6c66 2e5f 6361 6c6c 285b      self._call([
-00018340: 2765 6e68 616e 6365 272c 2027 2d2d 6175  'enhance', '--au
-00018350: 746f 2d68 7374 7327 2c20 272d 2d68 7374  to-hsts', '--hst
-00018360: 7327 5d29 0a0a 0a63 6c61 7373 2049 6e73  s'])...class Ins
-00018370: 7461 6c6c 5465 7374 2874 6573 745f 7574  tallTest(test_ut
-00018380: 696c 2e43 6f6e 6669 6754 6573 7443 6173  il.ConfigTestCas
-00018390: 6529 3a0a 2020 2020 2222 2254 6573 7473  e):.    """Tests
-000183a0: 2066 6f72 2063 6572 7462 6f74 2e5f 696e   for certbot._in
-000183b0: 7465 726e 616c 2e6d 6169 6e2e 696e 7374  ternal.main.inst
-000183c0: 616c 6c2e 2222 220a 0a20 2020 2064 6566  all."""..    def
-000183d0: 2073 6574 5570 2873 656c 6629 3a0a 2020   setUp(self):.  
-000183e0: 2020 2020 2020 7375 7065 7228 292e 7365        super().se
-000183f0: 7455 7028 290a 2020 2020 2020 2020 7365  tUp().        se
-00018400: 6c66 2e6d 6f63 6b69 6e73 7461 6c6c 6572  lf.mockinstaller
-00018410: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
-00018420: 6b28 7370 6563 3d65 6e68 616e 6365 6d65  k(spec=enhanceme
-00018430: 6e74 732e 4175 746f 4853 5453 456e 6861  nts.AutoHSTSEnha
-00018440: 6e63 656d 656e 7429 0a0a 2020 2020 406d  ncement)..    @m
-00018450: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-00018460: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-00018470: 6e2e 706c 7567 5f73 656c 2e72 6563 6f72  n.plug_sel.recor
-00018480: 645f 6368 6f73 656e 5f70 6c75 6769 6e73  d_chosen_plugins
-00018490: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
-000184a0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
-000184b0: 6572 6e61 6c2e 6d61 696e 2e70 6c75 675f  ernal.main.plug_
-000184c0: 7365 6c2e 7069 636b 5f69 6e73 7461 6c6c  sel.pick_install
-000184d0: 6572 2729 0a20 2020 2064 6566 2074 6573  er').    def tes
-000184e0: 745f 696e 7374 616c 6c5f 656e 6861 6e63  t_install_enhanc
-000184f0: 656d 656e 745f 6e6f 745f 7375 7070 6f72  ement_not_suppor
-00018500: 7465 6428 7365 6c66 2c20 6d6f 636b 5f69  ted(self, mock_i
-00018510: 6e73 742c 205f 7265 6329 3a0a 2020 2020  nst, _rec):.    
-00018520: 2020 2020 6d6f 636b 5f69 6e73 742e 7265      mock_inst.re
-00018530: 7475 726e 5f76 616c 7565 203d 206e 756c  turn_value = nul
-00018540: 6c2e 496e 7374 616c 6c65 7228 7365 6c66  l.Installer(self
-00018550: 2e63 6f6e 6669 672c 2022 6e75 6c6c 2229  .config, "null")
-00018560: 0a20 2020 2020 2020 2070 6c75 6769 6e73  .        plugins
-00018570: 203d 2064 6973 636f 2e50 6c75 6769 6e73   = disco.Plugins
-00018580: 5265 6769 7374 7279 2e66 696e 645f 616c  Registry.find_al
-00018590: 6c28 290a 2020 2020 2020 2020 7365 6c66  l().        self
-000185a0: 2e63 6f6e 6669 672e 6175 746f 5f68 7374  .config.auto_hst
-000185b0: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
-000185c0: 2073 656c 662e 636f 6e66 6967 2e63 6572   self.config.cer
-000185d0: 746e 616d 6520 3d20 226e 6f6e 6578 6973  tname = "nonexis
-000185e0: 7465 6e74 220a 2020 2020 2020 2020 7769  tent".        wi
-000185f0: 7468 2070 7974 6573 742e 7261 6973 6573  th pytest.raises
-00018600: 2865 7272 6f72 732e 4e6f 7453 7570 706f  (errors.NotSuppo
-00018610: 7274 6564 4572 726f 7229 3a0a 2020 2020  rtedError):.    
-00018620: 2020 2020 2020 2020 6d61 696e 2e69 6e73          main.ins
-00018630: 7461 6c6c 2873 656c 662e 636f 6e66 6967  tall(self.config
-00018640: 2c20 706c 7567 696e 7329 0a0a 2020 2020  , plugins)..    
-00018650: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-00018660: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-00018670: 6169 6e2e 706c 7567 5f73 656c 2e72 6563  ain.plug_sel.rec
-00018680: 6f72 645f 6368 6f73 656e 5f70 6c75 6769  ord_chosen_plugi
-00018690: 6e73 2729 0a20 2020 2040 6d6f 636b 2e70  ns').    @mock.p
-000186a0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-000186b0: 6e74 6572 6e61 6c2e 6d61 696e 2e70 6c75  nternal.main.plu
-000186c0: 675f 7365 6c2e 7069 636b 5f69 6e73 7461  g_sel.pick_insta
-000186d0: 6c6c 6572 2729 0a20 2020 2064 6566 2074  ller').    def t
-000186e0: 6573 745f 696e 7374 616c 6c5f 656e 6861  est_install_enha
-000186f0: 6e63 656d 656e 745f 6e6f 5f63 6572 746e  ncement_no_certn
-00018700: 616d 6528 7365 6c66 2c20 6d6f 636b 5f69  ame(self, mock_i
-00018710: 6e73 742c 205f 7265 6329 3a0a 2020 2020  nst, _rec):.    
-00018720: 2020 2020 6d6f 636b 5f69 6e73 742e 7265      mock_inst.re
-00018730: 7475 726e 5f76 616c 7565 203d 2073 656c  turn_value = sel
-00018740: 662e 6d6f 636b 696e 7374 616c 6c65 720a  f.mockinstaller.
-00018750: 2020 2020 2020 2020 706c 7567 696e 7320          plugins 
-00018760: 3d20 6469 7363 6f2e 506c 7567 696e 7352  = disco.PluginsR
-00018770: 6567 6973 7472 792e 6669 6e64 5f61 6c6c  egistry.find_all
-00018780: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00018790: 636f 6e66 6967 2e61 7574 6f5f 6873 7473  config.auto_hsts
-000187a0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000187b0: 7365 6c66 2e63 6f6e 6669 672e 6365 7274  self.config.cert
-000187c0: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
-000187d0: 2020 2020 7365 6c66 2e63 6f6e 6669 672e      self.config.
-000187e0: 6b65 795f 7061 7468 203d 2022 2f74 6d70  key_path = "/tmp
-000187f0: 2f6e 6f6e 6578 6973 7465 6e74 220a 2020  /nonexistent".  
-00018800: 2020 2020 2020 7365 6c66 2e63 6f6e 6669        self.confi
-00018810: 672e 6365 7274 5f70 6174 6820 3d20 222f  g.cert_path = "/
-00018820: 746d 702f 6e6f 6e65 7869 7374 656e 7422  tmp/nonexistent"
-00018830: 0a20 2020 2020 2020 2077 6974 6820 7079  .        with py
-00018840: 7465 7374 2e72 6169 7365 7328 6572 726f  test.raises(erro
-00018850: 7273 2e43 6f6e 6669 6775 7261 7469 6f6e  rs.Configuration
-00018860: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00018870: 2020 2020 6d61 696e 2e69 6e73 7461 6c6c      main.install
-00018880: 2873 656c 662e 636f 6e66 6967 2c20 706c  (self.config, pl
-00018890: 7567 696e 7329 0a0a 0a63 6c61 7373 2052  ugins)...class R
-000188a0: 6570 6f72 744e 6577 4365 7274 5465 7374  eportNewCertTest
-000188b0: 2875 6e69 7474 6573 742e 5465 7374 4361  (unittest.TestCa
-000188c0: 7365 293a 0a20 2020 2022 2222 5465 7374  se):.    """Test
-000188d0: 7320 666f 7220 6365 7274 626f 742e 5f69  s for certbot._i
-000188e0: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 7265  nternal.main._re
-000188f0: 706f 7274 5f6e 6577 5f63 6572 7420 616e  port_new_cert an
-00018900: 640a 2020 2020 2020 2063 6572 7462 6f74  d.       certbot
-00018910: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-00018920: 5f63 7372 5f72 6570 6f72 745f 6e65 775f  _csr_report_new_
-00018930: 6365 7274 2e0a 2020 2020 2222 220a 0a20  cert..    """.. 
-00018940: 2020 2064 6566 2073 6574 5570 2873 656c     def setUp(sel
-00018950: 6629 3a0a 2020 2020 2020 2020 6672 6f6d  f):.        from
-00018960: 2064 6174 6574 696d 6520 696d 706f 7274   datetime import
-00018970: 2064 6174 6574 696d 650a 2020 2020 2020   datetime.      
-00018980: 2020 7365 6c66 2e6e 6f74 6966 795f 7061    self.notify_pa
-00018990: 7463 6820 3d20 6d6f 636b 2e70 6174 6368  tch = mock.patch
-000189a0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-000189b0: 6e61 6c2e 6d61 696e 2e64 6973 706c 6179  nal.main.display
-000189c0: 5f75 7469 6c2e 6e6f 7469 6679 2729 0a20  _util.notify'). 
-000189d0: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
-000189e0: 5f6e 6f74 6966 7920 3d20 7365 6c66 2e6e  _notify = self.n
-000189f0: 6f74 6966 795f 7061 7463 682e 7374 6172  otify_patch.star
-00018a00: 7428 290a 0a20 2020 2020 2020 2073 656c  t()..        sel
-00018a10: 662e 6e6f 7461 6674 6572 5f70 6174 6368  f.notafter_patch
-00018a20: 203d 206d 6f63 6b2e 7061 7463 6828 2763   = mock.patch('c
-00018a30: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-00018a40: 2e6d 6169 6e2e 6372 7970 746f 5f75 7469  .main.crypto_uti
-00018a50: 6c2e 6e6f 7441 6674 6572 2729 0a20 2020  l.notAfter').   
-00018a60: 2020 2020 2073 656c 662e 6d6f 636b 5f6e       self.mock_n
-00018a70: 6f74 6166 7465 7220 3d20 7365 6c66 2e6e  otafter = self.n
-00018a80: 6f74 6166 7465 725f 7061 7463 682e 7374  otafter_patch.st
-00018a90: 6172 7428 290a 2020 2020 2020 2020 7365  art().        se
-00018aa0: 6c66 2e6d 6f63 6b5f 6e6f 7461 6674 6572  lf.mock_notafter
-00018ab0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00018ac0: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
-00018ad0: 7469 6d65 7374 616d 7028 3029 0a0a 2020  timestamp(0)..  
-00018ae0: 2020 6465 6620 7465 6172 446f 776e 2873    def tearDown(s
-00018af0: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-00018b00: 6c66 2e6e 6f74 6966 795f 7061 7463 682e  lf.notify_patch.
-00018b10: 7374 6f70 2829 0a20 2020 2020 2020 2073  stop().        s
-00018b20: 656c 662e 6e6f 7461 6674 6572 5f70 6174  elf.notafter_pat
-00018b30: 6368 2e73 746f 7028 290a 0a20 2020 2040  ch.stop()..    @
-00018b40: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00018b50: 6465 6620 5f63 616c 6c28 636c 732c 202a  def _call(cls, *
-00018b60: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-00018b70: 0a20 2020 2020 2020 2066 726f 6d20 6365  .        from ce
-00018b80: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-00018b90: 6d61 696e 2069 6d70 6f72 7420 5f72 6570  main import _rep
-00018ba0: 6f72 745f 6e65 775f 6365 7274 0a20 2020  ort_new_cert.   
-00018bb0: 2020 2020 2072 6574 7572 6e20 5f72 6570       return _rep
-00018bc0: 6f72 745f 6e65 775f 6365 7274 282a 6172  ort_new_cert(*ar
-00018bd0: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
-00018be0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00018bf0: 2020 2020 6465 6620 5f63 616c 6c5f 6373      def _call_cs
-00018c00: 7228 636c 732c 202a 6172 6773 2c20 2a2a  r(cls, *args, **
-00018c10: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-00018c20: 2066 726f 6d20 6365 7274 626f 742e 5f69   from certbot._i
-00018c30: 6e74 6572 6e61 6c2e 6d61 696e 2069 6d70  nternal.main imp
-00018c40: 6f72 7420 5f63 7372 5f72 6570 6f72 745f  ort _csr_report_
-00018c50: 6e65 775f 6365 7274 0a20 2020 2020 2020  new_cert.       
-00018c60: 2072 6574 7572 6e20 5f63 7372 5f72 6570   return _csr_rep
-00018c70: 6f72 745f 6e65 775f 6365 7274 282a 6172  ort_new_cert(*ar
-00018c80: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
-00018c90: 2020 2064 6566 2074 6573 745f 7265 706f     def test_repo
-00018ca0: 7274 5f64 7279 5f72 756e 2873 656c 6629  rt_dry_run(self)
-00018cb0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00018cc0: 6361 6c6c 286d 6f63 6b2e 4d6f 636b 2864  call(mock.Mock(d
-00018cd0: 7279 5f72 756e 3d54 7275 6529 2c20 4e6f  ry_run=True), No
-00018ce0: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 290a  ne, None, None).
-00018cf0: 2020 2020 2020 2020 7365 6c66 2e6d 6f63          self.moc
-00018d00: 6b5f 6e6f 7469 6679 2e61 7373 6572 745f  k_notify.assert_
-00018d10: 6361 6c6c 6564 5f77 6974 6828 2254 6865  called_with("The
-00018d20: 2064 7279 2072 756e 2077 6173 2073 7563   dry run was suc
-00018d30: 6365 7373 6675 6c2e 2229 0a0a 2020 2020  cessful.")..    
-00018d40: 6465 6620 7465 7374 5f63 7372 5f72 6570  def test_csr_rep
-00018d50: 6f72 745f 6472 795f 7275 6e28 7365 6c66  ort_dry_run(self
-00018d60: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00018d70: 5f63 616c 6c5f 6373 7228 6d6f 636b 2e4d  _call_csr(mock.M
-00018d80: 6f63 6b28 6472 795f 7275 6e3d 5472 7565  ock(dry_run=True
-00018d90: 292c 204e 6f6e 652c 204e 6f6e 652c 204e  ), None, None, N
-00018da0: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
-00018db0: 662e 6d6f 636b 5f6e 6f74 6966 792e 6173  f.mock_notify.as
-00018dc0: 7365 7274 5f63 616c 6c65 645f 7769 7468  sert_called_with
-00018dd0: 2822 5468 6520 6472 7920 7275 6e20 7761  ("The dry run wa
-00018de0: 7320 7375 6363 6573 7366 756c 2e22 290a  s successful.").
-00018df0: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-00018e00: 706f 7274 5f6e 6f5f 7061 7468 7328 7365  port_no_paths(se
-00018e10: 6c66 293a 0a20 2020 2020 2020 2077 6974  lf):.        wit
-00018e20: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
-00018e30: 4173 7365 7274 696f 6e45 7272 6f72 293a  AssertionError):
-00018e40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00018e50: 662e 5f63 616c 6c28 6d6f 636b 2e4d 6f63  f._call(mock.Moc
-00018e60: 6b28 6472 795f 7275 6e3d 4661 6c73 6529  k(dry_run=False)
-00018e70: 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  , None, None, No
-00018e80: 6e65 290a 0a20 2020 2020 2020 2077 6974  ne)..        wit
-00018e90: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
-00018ea0: 4173 7365 7274 696f 6e45 7272 6f72 293a  AssertionError):
-00018eb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00018ec0: 662e 5f63 616c 6c5f 6373 7228 6d6f 636b  f._call_csr(mock
-00018ed0: 2e4d 6f63 6b28 6472 795f 7275 6e3d 4661  .Mock(dry_run=Fa
-00018ee0: 6c73 6529 2c20 4e6f 6e65 2c20 4e6f 6e65  lse), None, None
-00018ef0: 2c20 4e6f 6e65 290a 0a20 2020 2064 6566  , None)..    def
-00018f00: 2074 6573 745f 7265 706f 7274 2873 656c   test_report(sel
-00018f10: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-00018f20: 2e5f 6361 6c6c 286d 6f63 6b2e 4d6f 636b  ._call(mock.Mock
-00018f30: 2864 7279 5f72 756e 3d46 616c 7365 292c  (dry_run=False),
-00018f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018f50: 2020 2027 2f70 6174 682f 746f 2f63 6572     '/path/to/cer
-00018f60: 742e 7065 6d27 2c20 272f 7061 7468 2f74  t.pem', '/path/t
-00018f70: 6f2f 6675 6c6c 6368 6169 6e2e 7065 6d27  o/fullchain.pem'
-00018f80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018f90: 2020 2020 272f 7061 7468 2f74 6f2f 7072      '/path/to/pr
-00018fa0: 6976 6b65 792e 7065 6d27 290a 0a20 2020  ivkey.pem')..   
-00018fb0: 2020 2020 2073 656c 662e 6d6f 636b 5f6e       self.mock_n
-00018fc0: 6f74 6966 792e 6173 7365 7274 5f63 616c  otify.assert_cal
-00018fd0: 6c65 645f 7769 7468 280a 2020 2020 2020  led_with(.      
-00018fe0: 2020 2020 2020 275c 6e53 7563 6365 7373        '\nSuccess
-00018ff0: 6675 6c6c 7920 7265 6365 6976 6564 2063  fully received c
-00019000: 6572 7469 6669 6361 7465 2e5c 6e27 0a20  ertificate.\n'. 
-00019010: 2020 2020 2020 2020 2020 2027 4365 7274             'Cert
-00019020: 6966 6963 6174 6520 6973 2073 6176 6564  ificate is saved
-00019030: 2061 743a 202f 7061 7468 2f74 6f2f 6675   at: /path/to/fu
-00019040: 6c6c 6368 6169 6e2e 7065 6d5c 6e27 0a20  llchain.pem\n'. 
-00019050: 2020 2020 2020 2020 2020 2027 4b65 7920             'Key 
-00019060: 6973 2073 6176 6564 2061 743a 2020 2020  is saved at:    
-00019070: 2020 2020 202f 7061 7468 2f74 6f2f 7072       /path/to/pr
-00019080: 6976 6b65 792e 7065 6d5c 6e27 0a20 2020  ivkey.pem\n'.   
-00019090: 2020 2020 2020 2020 2027 5468 6973 2063           'This c
-000190a0: 6572 7469 6669 6361 7465 2065 7870 6972  ertificate expir
-000190b0: 6573 206f 6e20 3139 3730 2d30 312d 3031  es on 1970-01-01
-000190c0: 2e5c 6e27 0a20 2020 2020 2020 2020 2020  .\n'.           
-000190d0: 2027 5468 6573 6520 6669 6c65 7320 7769   'These files wi
-000190e0: 6c6c 2062 6520 7570 6461 7465 6420 7768  ll be updated wh
-000190f0: 656e 2074 6865 2063 6572 7469 6669 6361  en the certifica
-00019100: 7465 2072 656e 6577 732e 5c6e 270a 2020  te renews.\n'.  
-00019110: 2020 2020 2020 2020 2020 2743 6572 7462            'Certb
-00019120: 6f74 2068 6173 2073 6574 2075 7020 6120  ot has set up a 
-00019130: 7363 6865 6475 6c65 6420 7461 736b 2074  scheduled task t
-00019140: 6f20 6175 746f 6d61 7469 6361 6c6c 7920  o automatically 
-00019150: 7265 6e65 7720 7468 6973 2027 0a20 2020  renew this '.   
-00019160: 2020 2020 2020 2020 2027 6365 7274 6966           'certif
-00019170: 6963 6174 6520 696e 2074 6865 2062 6163  icate in the bac
-00019180: 6b67 726f 756e 642e 270a 2020 2020 2020  kground.'.      
-00019190: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-000191a0: 745f 7265 706f 7274 5f6e 6f5f 6b65 7928  t_report_no_key(
-000191b0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-000191c0: 656c 662e 5f63 616c 6c28 6d6f 636b 2e4d  elf._call(mock.M
-000191d0: 6f63 6b28 6472 795f 7275 6e3d 4661 6c73  ock(dry_run=Fals
-000191e0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-000191f0: 2020 2020 2020 272f 7061 7468 2f74 6f2f        '/path/to/
-00019200: 6365 7274 2e70 656d 272c 2027 2f70 6174  cert.pem', '/pat
-00019210: 682f 746f 2f66 756c 6c63 6861 696e 2e70  h/to/fullchain.p
-00019220: 656d 272c 0a20 2020 2020 2020 2020 2020  em',.           
-00019230: 2020 2020 2020 204e 6f6e 6529 0a0a 2020         None)..  
-00019240: 2020 2020 2020 7365 6c66 2e6d 6f63 6b5f        self.mock_
-00019250: 6e6f 7469 6679 2e61 7373 6572 745f 6361  notify.assert_ca
-00019260: 6c6c 6564 5f77 6974 6828 0a20 2020 2020  lled_with(.     
-00019270: 2020 2020 2020 2027 5c6e 5375 6363 6573         '\nSucces
-00019280: 7366 756c 6c79 2072 6563 6569 7665 6420  sfully received 
-00019290: 6365 7274 6966 6963 6174 652e 5c6e 270a  certificate.\n'.
-000192a0: 2020 2020 2020 2020 2020 2020 2743 6572              'Cer
-000192b0: 7469 6669 6361 7465 2069 7320 7361 7665  tificate is save
-000192c0: 6420 6174 3a20 2f70 6174 682f 746f 2f66  d at: /path/to/f
-000192d0: 756c 6c63 6861 696e 2e70 656d 5c6e 270a  ullchain.pem\n'.
-000192e0: 2020 2020 2020 2020 2020 2020 2754 6869              'Thi
-000192f0: 7320 6365 7274 6966 6963 6174 6520 6578  s certificate ex
-00019300: 7069 7265 7320 6f6e 2031 3937 302d 3031  pires on 1970-01
-00019310: 2d30 312e 5c6e 270a 2020 2020 2020 2020  -01.\n'.        
-00019320: 2020 2020 2754 6865 7365 2066 696c 6573      'These files
-00019330: 2077 696c 6c20 6265 2075 7064 6174 6564   will be updated
-00019340: 2077 6865 6e20 7468 6520 6365 7274 6966   when the certif
-00019350: 6963 6174 6520 7265 6e65 7773 2e5c 6e27  icate renews.\n'
-00019360: 0a20 2020 2020 2020 2020 2020 2027 4365  .            'Ce
-00019370: 7274 626f 7420 6861 7320 7365 7420 7570  rtbot has set up
-00019380: 2061 2073 6368 6564 756c 6564 2074 6173   a scheduled tas
-00019390: 6b20 746f 2061 7574 6f6d 6174 6963 616c  k to automatical
-000193a0: 6c79 2072 656e 6577 2074 6869 7320 270a  ly renew this '.
-000193b0: 2020 2020 2020 2020 2020 2020 2763 6572              'cer
-000193c0: 7469 6669 6361 7465 2069 6e20 7468 6520  tificate in the 
-000193d0: 6261 636b 6772 6f75 6e64 2e27 0a20 2020  background.'.   
-000193e0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-000193f0: 7465 7374 5f72 6570 6f72 745f 6e6f 5f70  test_report_no_p
-00019400: 7265 636f 6e66 6967 7572 6564 5f72 656e  reconfigured_ren
-00019410: 6577 616c 2873 656c 6629 3a0a 2020 2020  ewal(self):.    
-00019420: 2020 2020 7365 6c66 2e5f 6361 6c6c 286d      self._call(m
-00019430: 6f63 6b2e 4d6f 636b 2864 7279 5f72 756e  ock.Mock(dry_run
-00019440: 3d46 616c 7365 2c20 7072 6563 6f6e 6669  =False, preconfi
-00019450: 6775 7265 645f 7265 6e65 7761 6c3d 4661  gured_renewal=Fa
-00019460: 6c73 6529 2c0a 2020 2020 2020 2020 2020  lse),.          
-00019470: 2020 2020 2020 2020 272f 7061 7468 2f74          '/path/t
-00019480: 6f2f 6365 7274 2e70 656d 272c 2027 2f70  o/cert.pem', '/p
-00019490: 6174 682f 746f 2f66 756c 6c63 6861 696e  ath/to/fullchain
-000194a0: 2e70 656d 272c 0a20 2020 2020 2020 2020  .pem',.         
-000194b0: 2020 2020 2020 2020 2027 2f70 6174 682f           '/path/
-000194c0: 746f 2f70 7269 766b 6579 2e70 656d 2729  to/privkey.pem')
-000194d0: 0a0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-000194e0: 6f63 6b5f 6e6f 7469 6679 2e61 7373 6572  ock_notify.asser
-000194f0: 745f 6361 6c6c 6564 5f77 6974 6828 0a20  t_called_with(. 
-00019500: 2020 2020 2020 2020 2020 2027 5c6e 5375             '\nSu
-00019510: 6363 6573 7366 756c 6c79 2072 6563 6569  ccessfully recei
-00019520: 7665 6420 6365 7274 6966 6963 6174 652e  ved certificate.
-00019530: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-00019540: 2743 6572 7469 6669 6361 7465 2069 7320  'Certificate is 
-00019550: 7361 7665 6420 6174 3a20 2f70 6174 682f  saved at: /path/
-00019560: 746f 2f66 756c 6c63 6861 696e 2e70 656d  to/fullchain.pem
-00019570: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-00019580: 274b 6579 2069 7320 7361 7665 6420 6174  'Key is saved at
-00019590: 3a20 2020 2020 2020 2020 2f70 6174 682f  :         /path/
-000195a0: 746f 2f70 7269 766b 6579 2e70 656d 5c6e  to/privkey.pem\n
-000195b0: 270a 2020 2020 2020 2020 2020 2020 2754  '.            'T
-000195c0: 6869 7320 6365 7274 6966 6963 6174 6520  his certificate 
-000195d0: 6578 7069 7265 7320 6f6e 2031 3937 302d  expires on 1970-
-000195e0: 3031 2d30 312e 5c6e 270a 2020 2020 2020  01-01.\n'.      
-000195f0: 2020 2020 2020 2754 6865 7365 2066 696c        'These fil
-00019600: 6573 2077 696c 6c20 6265 2075 7064 6174  es will be updat
-00019610: 6564 2077 6865 6e20 7468 6520 6365 7274  ed when the cert
-00019620: 6966 6963 6174 6520 7265 6e65 7773 2e27  ificate renews.'
-00019630: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00019640: 6465 6620 7465 7374 5f63 7372 5f72 6570  def test_csr_rep
-00019650: 6f72 7428 7365 6c66 293a 0a20 2020 2020  ort(self):.     
-00019660: 2020 2073 656c 662e 5f63 616c 6c5f 6373     self._call_cs
-00019670: 7228 6d6f 636b 2e4d 6f63 6b28 6472 795f  r(mock.Mock(dry_
-00019680: 7275 6e3d 4661 6c73 6529 2c20 272f 7061  run=False), '/pa
-00019690: 7468 2f74 6f2f 6365 7274 2e70 656d 272c  th/to/cert.pem',
-000196a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000196b0: 2020 2020 2020 2027 2f70 6174 682f 746f         '/path/to
-000196c0: 2f63 6861 696e 2e70 656d 272c 2027 2f70  /chain.pem', '/p
-000196d0: 6174 682f 746f 2f66 756c 6c63 6861 696e  ath/to/fullchain
-000196e0: 2e70 656d 2729 0a0a 2020 2020 2020 2020  .pem')..        
-000196f0: 7365 6c66 2e6d 6f63 6b5f 6e6f 7469 6679  self.mock_notify
-00019700: 2e61 7373 6572 745f 6361 6c6c 6564 5f77  .assert_called_w
-00019710: 6974 6828 0a20 2020 2020 2020 2020 2020  ith(.           
-00019720: 2027 5c6e 5375 6363 6573 7366 756c 6c79   '\nSuccessfully
-00019730: 2072 6563 6569 7665 6420 6365 7274 6966   received certif
-00019740: 6963 6174 652e 5c6e 270a 2020 2020 2020  icate.\n'.      
-00019750: 2020 2020 2020 2743 6572 7469 6669 6361        'Certifica
-00019760: 7465 2069 7320 7361 7665 6420 6174 3a20  te is saved at: 
-00019770: 2020 2020 2020 2020 2020 202f 7061 7468             /path
-00019780: 2f74 6f2f 6365 7274 2e70 656d 5c6e 270a  /to/cert.pem\n'.
-00019790: 2020 2020 2020 2020 2020 2020 2749 6e74              'Int
-000197a0: 6572 6d65 6469 6174 6520 4341 2063 6861  ermediate CA cha
-000197b0: 696e 2069 7320 7361 7665 6420 6174 3a20  in is saved at: 
-000197c0: 202f 7061 7468 2f74 6f2f 6368 6169 6e2e   /path/to/chain.
-000197d0: 7065 6d5c 6e27 0a20 2020 2020 2020 2020  pem\n'.         
-000197e0: 2020 2027 4675 6c6c 2063 6572 7469 6669     'Full certifi
-000197f0: 6361 7465 2063 6861 696e 2069 7320 7361  cate chain is sa
-00019800: 7665 6420 6174 3a20 2f70 6174 682f 746f  ved at: /path/to
-00019810: 2f66 756c 6c63 6861 696e 2e70 656d 5c6e  /fullchain.pem\n
-00019820: 270a 2020 2020 2020 2020 2020 2020 2754  '.            'T
-00019830: 6869 7320 6365 7274 6966 6963 6174 6520  his certificate 
-00019840: 6578 7069 7265 7320 6f6e 2031 3937 302d  expires on 1970-
-00019850: 3031 2d30 312e 270a 2020 2020 2020 2020  01-01.'.        
-00019860: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00019870: 6d61 6e75 616c 5f6e 6f5f 686f 6f6b 735f  manual_no_hooks_
-00019880: 7265 706f 7274 2873 656c 6629 3a0a 2020  report(self):.  
-00019890: 2020 2020 2020 2222 2253 686f 756c 646e        """Shouldn
-000198a0: 2774 2067 6574 2061 206d 6573 7361 6765  't get a message
-000198b0: 2061 626f 7574 2061 7574 6f72 656e 6577   about autorenew
-000198c0: 616c 2069 6620 6e6f 202d 2d6d 616e 7561  al if no --manua
-000198d0: 6c2d 6175 7468 2d68 6f6f 6b22 2222 0a20  l-auth-hook""". 
-000198e0: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
-000198f0: 6c28 6d6f 636b 2e4d 6f63 6b28 6472 795f  l(mock.Mock(dry_
-00019900: 7275 6e3d 4661 6c73 652c 2061 7574 6865  run=False, authe
-00019910: 6e74 6963 6174 6f72 3d27 6d61 6e75 616c  nticator='manual
-00019920: 272c 206d 616e 7561 6c5f 6175 7468 5f68  ', manual_auth_h
-00019930: 6f6f 6b3d 4e6f 6e65 292c 0a20 2020 2020  ook=None),.     
-00019940: 2020 2020 2020 2020 2020 2020 2027 2f70               '/p
-00019950: 6174 682f 746f 2f63 6572 742e 7065 6d27  ath/to/cert.pem'
-00019960: 2c20 272f 7061 7468 2f74 6f2f 6675 6c6c  , '/path/to/full
-00019970: 6368 6169 6e2e 7065 6d27 2c0a 2020 2020  chain.pem',.    
-00019980: 2020 2020 2020 2020 2020 2020 2020 272f                '/
-00019990: 7061 7468 2f74 6f2f 7072 6976 6b65 792e  path/to/privkey.
-000199a0: 7065 6d27 290a 0a20 2020 2020 2020 2073  pem')..        s
-000199b0: 656c 662e 6d6f 636b 5f6e 6f74 6966 792e  elf.mock_notify.
-000199c0: 6173 7365 7274 5f63 616c 6c65 645f 7769  assert_called_wi
-000199d0: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
-000199e0: 275c 6e53 7563 6365 7373 6675 6c6c 7920  '\nSuccessfully 
-000199f0: 7265 6365 6976 6564 2063 6572 7469 6669  received certifi
-00019a00: 6361 7465 2e5c 6e27 0a20 2020 2020 2020  cate.\n'.       
-00019a10: 2020 2020 2027 4365 7274 6966 6963 6174       'Certificat
-00019a20: 6520 6973 2073 6176 6564 2061 743a 202f  e is saved at: /
-00019a30: 7061 7468 2f74 6f2f 6675 6c6c 6368 6169  path/to/fullchai
-00019a40: 6e2e 7065 6d5c 6e27 0a20 2020 2020 2020  n.pem\n'.       
-00019a50: 2020 2020 2027 4b65 7920 6973 2073 6176       'Key is sav
-00019a60: 6564 2061 743a 2020 2020 2020 2020 202f  ed at:         /
-00019a70: 7061 7468 2f74 6f2f 7072 6976 6b65 792e  path/to/privkey.
-00019a80: 7065 6d5c 6e27 0a20 2020 2020 2020 2020  pem\n'.         
-00019a90: 2020 2027 5468 6973 2063 6572 7469 6669     'This certifi
-00019aa0: 6361 7465 2065 7870 6972 6573 206f 6e20  cate expires on 
-00019ab0: 3139 3730 2d30 312d 3031 2e5c 6e27 0a20  1970-01-01.\n'. 
-00019ac0: 2020 2020 2020 2020 2020 2027 5468 6573             'Thes
-00019ad0: 6520 6669 6c65 7320 7769 6c6c 2062 6520  e files will be 
-00019ae0: 7570 6461 7465 6420 7768 656e 2074 6865  updated when the
-00019af0: 2063 6572 7469 6669 6361 7465 2072 656e   certificate ren
-00019b00: 6577 732e 270a 2020 2020 2020 2020 290a  ews.'.        ).
-00019b10: 0a0a 636c 6173 7320 5265 706f 7274 4e65  ..class ReportNe
-00019b20: 7874 5374 6570 7354 6573 7428 756e 6974  xtStepsTest(unit
-00019b30: 7465 7374 2e54 6573 7443 6173 6529 3a0a  test.TestCase):.
-00019b40: 2020 2020 2222 2254 6573 7473 2066 6f72      """Tests for
-00019b50: 2063 6572 7462 6f74 2e5f 696e 7465 726e   certbot._intern
-00019b60: 616c 2e6d 6169 6e2e 5f72 6570 6f72 745f  al.main._report_
-00019b70: 6e65 7874 5f73 7465 7073 2222 220a 0a20  next_steps""".. 
-00019b80: 2020 2064 6566 2073 6574 5570 2873 656c     def setUp(sel
-00019b90: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-00019ba0: 2e63 6f6e 6669 6720 3d20 6d6f 636b 2e4d  .config = mock.M
-00019bb0: 6167 6963 4d6f 636b 280a 2020 2020 2020  agicMock(.      
-00019bc0: 2020 2020 2020 6365 7274 5f6e 616d 653d        cert_name=
-00019bd0: 2265 7861 6d70 6c65 2e63 6f6d 222c 2070  "example.com", p
-00019be0: 7265 636f 6e66 6967 7572 6564 5f72 656e  reconfigured_ren
-00019bf0: 6577 616c 3d54 7275 652c 0a20 2020 2020  ewal=True,.     
-00019c00: 2020 2020 2020 2063 7372 3d4e 6f6e 652c         csr=None,
-00019c10: 2061 7574 6865 6e74 6963 6174 6f72 3d22   authenticator="
-00019c20: 6e67 696e 7822 2c20 6d61 6e75 616c 5f61  nginx", manual_a
-00019c30: 7574 685f 686f 6f6b 3d4e 6f6e 6529 0a20  uth_hook=None). 
-00019c40: 2020 2020 2020 206e 6f74 6966 795f 7061         notify_pa
-00019c50: 7463 6820 3d20 6d6f 636b 2e70 6174 6368  tch = mock.patch
-00019c60: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
-00019c70: 6e61 6c2e 6d61 696e 2e64 6973 706c 6179  nal.main.display
-00019c80: 5f75 7469 6c2e 6e6f 7469 6679 2729 0a20  _util.notify'). 
-00019c90: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
-00019ca0: 5f6e 6f74 6966 7920 3d20 6e6f 7469 6679  _notify = notify
-00019cb0: 5f70 6174 6368 2e73 7461 7274 2829 0a20  _patch.start(). 
-00019cc0: 2020 2020 2020 2073 656c 662e 6164 6443         self.addC
-00019cd0: 6c65 616e 7570 286e 6f74 6966 795f 7061  leanup(notify_pa
-00019ce0: 7463 682e 7374 6f70 290a 2020 2020 2020  tch.stop).      
-00019cf0: 2020 7365 6c66 2e6f 6c64 5f73 7464 6f75    self.old_stdou
-00019d00: 7420 3d20 7379 732e 7374 646f 7574 0a20  t = sys.stdout. 
-00019d10: 2020 2020 2020 2073 7973 2e73 7464 6f75         sys.stdou
-00019d20: 7420 3d20 696f 2e53 7472 696e 6749 4f28  t = io.StringIO(
-00019d30: 290a 0a20 2020 2064 6566 2074 6561 7244  )..    def tearD
-00019d40: 6f77 6e28 7365 6c66 293a 0a20 2020 2020  own(self):.     
-00019d50: 2020 2073 7973 2e73 7464 6f75 7420 3d20     sys.stdout = 
-00019d60: 7365 6c66 2e6f 6c64 5f73 7464 6f75 740a  self.old_stdout.
-00019d70: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00019d80: 640a 2020 2020 6465 6620 5f63 616c 6c28  d.    def _call(
-00019d90: 636c 732c 202a 6172 6773 2c20 2a2a 6b77  cls, *args, **kw
-00019da0: 6172 6773 293a 0a20 2020 2020 2020 2066  args):.        f
-00019db0: 726f 6d20 6365 7274 626f 742e 5f69 6e74  rom certbot._int
-00019dc0: 6572 6e61 6c2e 6d61 696e 2069 6d70 6f72  ernal.main impor
-00019dd0: 7420 5f72 6570 6f72 745f 6e65 7874 5f73  t _report_next_s
-00019de0: 7465 7073 0a20 2020 2020 2020 205f 7265  teps.        _re
-00019df0: 706f 7274 5f6e 6578 745f 7374 6570 7328  port_next_steps(
-00019e00: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00019e10: 0a0a 2020 2020 6465 6620 5f6f 7574 7075  ..    def _outpu
-00019e20: 7428 7365 6c66 2920 2d3e 2073 7472 3a0a  t(self) -> str:.
-00019e30: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
-00019e40: 656c 662e 6d6f 636b 5f6e 6f74 6966 792e  elf.mock_notify.
-00019e50: 6361 6c6c 5f63 6f75 6e74 203d 3d20 320a  call_count == 2.
-00019e60: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
-00019e70: 656c 662e 6d6f 636b 5f6e 6f74 6966 792e  elf.mock_notify.
-00019e80: 6361 6c6c 5f61 7267 735f 6c69 7374 5b30  call_args_list[0
-00019e90: 5d5b 305d 5b30 5d20 3d3d 2027 4e45 5854  ][0][0] == 'NEXT
-00019ea0: 2053 5445 5053 3a27 0a20 2020 2020 2020   STEPS:'.       
-00019eb0: 2072 6574 7572 6e20 7365 6c66 2e6d 6f63   return self.moc
-00019ec0: 6b5f 6e6f 7469 6679 2e63 616c 6c5f 6172  k_notify.call_ar
-00019ed0: 6773 5f6c 6973 745b 315d 5b30 5d5b 305d  gs_list[1][0][0]
-00019ee0: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
-00019ef0: 6570 6f72 7428 7365 6c66 293a 0a20 2020  eport(self):.   
-00019f00: 2020 2020 2022 2222 4e6f 2073 7465 7073       """No steps
-00019f10: 2066 6f72 2061 206e 6f72 6d61 6c20 7265   for a normal re
-00019f20: 6e65 7761 6c22 2222 0a20 2020 2020 2020  newal""".       
-00019f30: 2073 656c 662e 636f 6e66 6967 2e61 7574   self.config.aut
-00019f40: 6865 6e74 6963 6174 6f72 203d 2022 6d61  henticator = "ma
-00019f50: 6e75 616c 220a 2020 2020 2020 2020 7365  nual".        se
-00019f60: 6c66 2e63 6f6e 6669 672e 6d61 6e75 616c  lf.config.manual
-00019f70: 5f61 7574 685f 686f 6f6b 203d 2022 2f62  _auth_hook = "/b
-00019f80: 696e 2f74 7275 6522 0a20 2020 2020 2020  in/true".       
-00019f90: 2073 656c 662e 5f63 616c 6c28 7365 6c66   self._call(self
-00019fa0: 2e63 6f6e 6669 672c 204e 6f6e 652c 204e  .config, None, N
-00019fb0: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
-00019fc0: 662e 6d6f 636b 5f6e 6f74 6966 792e 6173  f.mock_notify.as
-00019fd0: 7365 7274 5f6e 6f74 5f63 616c 6c65 6428  sert_not_called(
-00019fe0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00019ff0: 6373 725f 7265 706f 7274 2873 656c 6629  csr_report(self)
-0001a000: 3a0a 2020 2020 2020 2020 2222 222d 2d63  :.        """--c
-0001a010: 7372 2072 6571 7569 7265 7320 6d61 6e75  sr requires manu
-0001a020: 616c 2072 656e 6577 616c 2222 220a 2020  al renewal""".  
-0001a030: 2020 2020 2020 7365 6c66 2e63 6f6e 6669        self.confi
-0001a040: 672e 6373 7220 3d20 2266 6f6f 2e63 7372  g.csr = "foo.csr
-0001a050: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
-0001a060: 6361 6c6c 2873 656c 662e 636f 6e66 6967  call(self.config
-0001a070: 2c20 4e6f 6e65 2c20 4e6f 6e65 290a 2020  , None, None).  
-0001a080: 2020 2020 2020 6173 7365 7274 2022 2d2d        assert "--
-0001a090: 6373 7220 7769 6c6c 206e 6f74 2062 6520  csr will not be 
-0001a0a0: 7265 6e65 7765 6422 2069 6e20 7365 6c66  renewed" in self
-0001a0b0: 2e5f 6f75 7470 7574 2829 0a0a 2020 2020  ._output()..    
-0001a0c0: 6465 6620 7465 7374 5f6d 616e 7561 6c5f  def test_manual_
-0001a0d0: 6e6f 5f68 6f6f 6b5f 7265 6e65 7761 6c28  no_hook_renewal(
-0001a0e0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0001a0f0: 2222 2d2d 6d61 6e75 616c 2077 6974 686f  ""--manual witho
-0001a100: 7574 2061 2068 6f6f 6b20 7265 7175 6972  ut a hook requir
-0001a110: 6573 206d 616e 7561 6c20 7265 6e65 7761  es manual renewa
-0001a120: 6c22 2222 0a20 2020 2020 2020 2073 656c  l""".        sel
-0001a130: 662e 636f 6e66 6967 2e61 7574 6865 6e74  f.config.authent
-0001a140: 6963 6174 6f72 203d 2022 6d61 6e75 616c  icator = "manual
-0001a150: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
-0001a160: 6361 6c6c 2873 656c 662e 636f 6e66 6967  call(self.config
-0001a170: 2c20 4e6f 6e65 2c20 4e6f 6e65 290a 2020  , None, None).  
-0001a180: 2020 2020 2020 6173 7365 7274 2022 2d2d        assert "--
-0001a190: 6d61 6e75 616c 2063 6572 7469 6669 6361  manual certifica
-0001a1a0: 7465 7320 7265 7175 6972 6573 2220 696e  tes requires" in
-0001a1b0: 2073 656c 662e 5f6f 7574 7075 7428 290a   self._output().
-0001a1c0: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
-0001a1d0: 5f70 7265 636f 6e66 6967 7572 6564 5f72  _preconfigured_r
-0001a1e0: 656e 6577 616c 2873 656c 6629 3a0a 2020  enewal(self):.  
-0001a1f0: 2020 2020 2020 2222 224e 6f20 2d2d 7072        """No --pr
-0001a200: 6563 6f6e 6669 6775 7265 642d 7265 6e65  econfigured-rene
-0001a210: 7761 6c20 6e65 6564 7320 6d61 6e75 616c  wal needs manual
-0001a220: 2063 726f 6e20 7365 7475 7022 2222 0a20   cron setup""". 
-0001a230: 2020 2020 2020 2073 656c 662e 636f 6e66         self.conf
-0001a240: 6967 2e70 7265 636f 6e66 6967 7572 6564  ig.preconfigured
-0001a250: 5f72 656e 6577 616c 203d 2046 616c 7365  _renewal = False
-0001a260: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-0001a270: 616c 6c28 7365 6c66 2e63 6f6e 6669 672c  all(self.config,
-0001a280: 204e 6f6e 652c 204e 6f6e 6529 0a20 2020   None, None).   
-0001a290: 2020 2020 2061 7373 6572 7420 2268 7474       assert "htt
-0001a2a0: 7073 3a2f 2f63 6572 7462 6f74 2e6f 7267  ps://certbot.org
-0001a2b0: 2f72 656e 6577 616c 2d73 6574 7570 2220  /renewal-setup" 
-0001a2c0: 696e 2073 656c 662e 5f6f 7574 7075 7428  in self._output(
-0001a2d0: 290a 0a0a 636c 6173 7320 5570 6461 7465  )...class Update
-0001a2e0: 4163 636f 756e 7454 6573 7428 7465 7374  AccountTest(test
-0001a2f0: 5f75 7469 6c2e 436f 6e66 6967 5465 7374  _util.ConfigTest
-0001a300: 4361 7365 293a 0a20 2020 2022 2222 5465  Case):.    """Te
-0001a310: 7374 7320 666f 7220 6365 7274 626f 742e  sts for certbot.
-0001a320: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e75  _internal.main.u
-0001a330: 7064 6174 655f 6163 636f 756e 7422 2222  pdate_account"""
-0001a340: 0a0a 2020 2020 6465 6620 7365 7455 7028  ..    def setUp(
-0001a350: 7365 6c66 293a 0a20 2020 2020 2020 2070  self):.        p
-0001a360: 6174 6368 6573 203d 207b 0a20 2020 2020  atches = {.     
-0001a370: 2020 2020 2020 2027 6163 636f 756e 7427         'account'
-0001a380: 3a20 6d6f 636b 2e70 6174 6368 2827 6365  : mock.patch('ce
-0001a390: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
-0001a3a0: 6d61 696e 2e61 6363 6f75 6e74 2729 2c0a  main.account'),.
-0001a3b0: 2020 2020 2020 2020 2020 2020 2761 7465              'ate
-0001a3c0: 7869 7427 3a20 6d6f 636b 2e70 6174 6368  xit': mock.patch
-0001a3d0: 2827 6365 7274 626f 742e 7574 696c 2e61  ('certbot.util.a
-0001a3e0: 7465 7869 7427 292c 0a20 2020 2020 2020  texit'),.       
-0001a3f0: 2020 2020 2027 636c 6965 6e74 273a 206d       'client': m
-0001a400: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
-0001a410: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
-0001a420: 6e2e 636c 6965 6e74 2729 2c0a 2020 2020  n.client'),.    
-0001a430: 2020 2020 2020 2020 2764 6574 6572 6d69          'determi
-0001a440: 6e65 5f61 6363 6f75 6e74 273a 206d 6f63  ne_account': moc
-0001a450: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
-0001a460: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
-0001a470: 5f64 6574 6572 6d69 6e65 5f61 6363 6f75  _determine_accou
-0001a480: 6e74 2729 2c0a 2020 2020 2020 2020 2020  nt'),.          
-0001a490: 2020 276e 6f74 6966 7927 3a20 6d6f 636b    'notify': mock
-0001a4a0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
-0001a4b0: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e64  _internal.main.d
-0001a4c0: 6973 706c 6179 5f75 7469 6c2e 6e6f 7469  isplay_util.noti
-0001a4d0: 6679 2729 2c0a 2020 2020 2020 2020 2020  fy'),.          
-0001a4e0: 2020 2770 7265 7061 7265 5f73 7562 273a    'prepare_sub':
-0001a4f0: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
-0001a500: 7462 6f74 2e5f 696e 7465 726e 616c 2e65  tbot._internal.e
-0001a510: 6666 2e70 7265 7061 7265 5f73 7562 7363  ff.prepare_subsc
-0001a520: 7269 7074 696f 6e27 292c 0a20 2020 2020  ription'),.     
-0001a530: 2020 2020 2020 2027 7574 696c 273a 2074         'util': t
-0001a540: 6573 745f 7574 696c 2e70 6174 6368 5f64  est_util.patch_d
-0001a550: 6973 706c 6179 5f75 7469 6c28 290a 2020  isplay_util().  
-0001a560: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0001a570: 7365 6c66 2e6d 6f63 6b73 203d 207b 206b  self.mocks = { k
-0001a580: 3a20 7061 7463 6865 735b 6b5d 2e73 7461  : patches[k].sta
-0001a590: 7274 2829 2066 6f72 206b 2069 6e20 7061  rt() for k in pa
-0001a5a0: 7463 6865 7320 7d0a 2020 2020 2020 2020  tches }.        
-0001a5b0: 666f 7220 7061 7463 6820 696e 2070 6174  for patch in pat
-0001a5c0: 6368 6573 2e76 616c 7565 7328 293a 0a20  ches.values():. 
-0001a5d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001a5e0: 6164 6443 6c65 616e 7570 2870 6174 6368  addCleanup(patch
-0001a5f0: 2e73 746f 7029 0a0a 2020 2020 2020 2020  .stop)..        
-0001a600: 7265 7475 726e 2073 7570 6572 2829 2e73  return super().s
-0001a610: 6574 5570 2829 0a0a 2020 2020 6465 6620  etUp()..    def 
-0001a620: 5f63 616c 6c28 7365 6c66 2c20 6172 6773  _call(self, args
-0001a630: 293a 0a20 2020 2020 2020 2077 6974 6820  ):.        with 
-0001a640: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0001a650: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-0001a660: 696e 2e73 7973 2e73 7464 6f75 7427 292c  in.sys.stdout'),
-0001a670: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0001a680: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
-0001a690: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
-0001a6a0: 696e 2e73 7973 2e73 7464 6572 7227 293a  in.sys.stderr'):
-0001a6b0: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-0001a6c0: 7320 3d20 5b27 2d2d 636f 6e66 6967 2d64  s = ['--config-d
-0001a6d0: 6972 272c 2073 656c 662e 636f 6e66 6967  ir', self.config
-0001a6e0: 2e63 6f6e 6669 675f 6469 722c 0a20 2020  .config_dir,.   
-0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a700: 2027 2d2d 776f 726b 2d64 6972 272c 2073   '--work-dir', s
-0001a710: 656c 662e 636f 6e66 6967 2e77 6f72 6b5f  elf.config.work_
-0001a720: 6469 722c 0a20 2020 2020 2020 2020 2020  dir,.           
-0001a730: 2020 2020 2020 2020 2027 2d2d 6c6f 6773           '--logs
-0001a740: 2d64 6972 272c 2073 656c 662e 636f 6e66  -dir', self.conf
-0001a750: 6967 2e6c 6f67 735f 6469 722c 2027 2d2d  ig.logs_dir, '--
-0001a760: 7465 7874 275d 202b 2061 7267 730a 2020  text'] + args.  
-0001a770: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001a780: 206d 6169 6e2e 6d61 696e 2861 7267 735b   main.main(args[
-0001a790: 3a5d 2920 2320 4e4f 5445 3a20 7061 7273  :]) # NOTE: pars
-0001a7a0: 6572 2063 616e 2061 6c74 6572 2069 7473  er can alter its
-0001a7b0: 2061 7267 7321 0a0a 2020 2020 6465 6620   args!..    def 
-0001a7c0: 5f70 7265 7061 7265 5f6d 6f63 6b5f 6163  _prepare_mock_ac
-0001a7d0: 636f 756e 7428 7365 6c66 293a 0a20 2020  count(self):.   
-0001a7e0: 2020 2020 206d 6f63 6b5f 7374 6f72 6167       mock_storag
-0001a7f0: 6520 3d20 6d6f 636b 2e4d 6167 6963 4d6f  e = mock.MagicMo
-0001a800: 636b 2829 0a20 2020 2020 2020 206d 6f63  ck().        moc
-0001a810: 6b5f 6163 636f 756e 7420 3d20 6d6f 636b  k_account = mock
-0001a820: 2e4d 6167 6963 4d6f 636b 2829 0a20 2020  .MagicMock().   
-0001a830: 2020 2020 206d 6f63 6b5f 7265 6772 203d       mock_regr =
-0001a840: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-0001a850: 290a 2020 2020 2020 2020 6d6f 636b 5f73  ).        mock_s
-0001a860: 746f 7261 6765 2e66 696e 645f 616c 6c2e  torage.find_all.
-0001a870: 7265 7475 726e 5f76 616c 7565 203d 205b  return_value = [
-0001a880: 6d6f 636b 5f61 6363 6f75 6e74 5d0a 2020  mock_account].  
-0001a890: 2020 2020 2020 7365 6c66 2e6d 6f63 6b73        self.mocks
-0001a8a0: 5b27 6163 636f 756e 7427 5d2e 4163 636f  ['account'].Acco
-0001a8b0: 756e 7446 696c 6553 746f 7261 6765 2e72  untFileStorage.r
-0001a8c0: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
-0001a8d0: 636b 5f73 746f 7261 6765 0a20 2020 2020  ck_storage.     
-0001a8e0: 2020 206d 6f63 6b5f 6163 636f 756e 742e     mock_account.
-0001a8f0: 7265 6772 2e62 6f64 7920 3d20 6d6f 636b  regr.body = mock
-0001a900: 5f72 6567 722e 626f 6479 0a20 2020 2020  _regr.body.     
-0001a910: 2020 2073 656c 662e 6d6f 636b 735b 2764     self.mocks['d
-0001a920: 6574 6572 6d69 6e65 5f61 6363 6f75 6e74  etermine_account
-0001a930: 275d 2e72 6574 7572 6e5f 7661 6c75 6520  '].return_value 
-0001a940: 3d20 286d 6f63 6b5f 6163 636f 756e 742c  = (mock_account,
-0001a950: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-0001a960: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-0001a970: 6e20 286d 6f63 6b5f 6163 636f 756e 742c  n (mock_account,
-0001a980: 206d 6f63 6b5f 7374 6f72 6167 652c 206d   mock_storage, m
-0001a990: 6f63 6b5f 7265 6772 290a 0a20 2020 2064  ock_regr)..    d
-0001a9a0: 6566 205f 7465 7374 5f75 7064 6174 655f  ef _test_update_
-0001a9b0: 6e6f 5f63 6f6e 7461 6374 2873 656c 662c  no_contact(self,
-0001a9c0: 2061 7267 7329 3a0a 2020 2020 2020 2020   args):.        
-0001a9d0: 2222 2255 7469 6c69 7479 2074 6f20 6173  """Utility to as
-0001a9e0: 7365 7274 2074 6861 7420 656d 6169 6c20  sert that email 
-0001a9f0: 7265 6d6f 7661 6c20 6973 2068 616e 646c  removal is handl
-0001aa00: 6564 2063 6f72 7265 6374 6c79 2222 220a  ed correctly""".
-0001aa10: 2020 2020 2020 2020 285f 2c20 6d6f 636b          (_, mock
-0001aa20: 5f73 746f 7261 6765 2c20 6d6f 636b 5f72  _storage, mock_r
-0001aa30: 6567 7229 203d 2073 656c 662e 5f70 7265  egr) = self._pre
-0001aa40: 7061 7265 5f6d 6f63 6b5f 6163 636f 756e  pare_mock_accoun
-0001aa50: 7428 290a 2020 2020 2020 2020 7265 7375  t().        resu
-0001aa60: 6c74 203d 2073 656c 662e 5f63 616c 6c28  lt = self._call(
-0001aa70: 6172 6773 290a 2020 2020 2020 2020 2320  args).        # 
-0001aa80: 5768 656e 2075 7064 6174 6520 7375 6363  When update succ
-0001aa90: 6565 6473 2c20 7468 6520 7265 7475 726e  eeds, the return
-0001aaa0: 2076 616c 7565 206f 6620 7570 6461 7465   value of update
-0001aab0: 5f61 6363 6f75 6e74 2829 2069 7320 4e6f  _account() is No
-0001aac0: 6e65 0a20 2020 2020 2020 2061 7373 6572  ne.        asser
-0001aad0: 7420 7265 7375 6c74 2069 7320 4e6f 6e65  t result is None
-0001aae0: 0a20 2020 2020 2020 2023 2057 6520 7375  .        # We su
-0001aaf0: 626d 6974 7465 6420 6120 7265 6769 7374  bmitted a regist
-0001ab00: 7261 7469 6f6e 2074 6f20 7468 6520 7365  ration to the se
-0001ab10: 7276 6572 0a20 2020 2020 2020 2061 7373  rver.        ass
-0001ab20: 6572 7420 7365 6c66 2e6d 6f63 6b73 5b27  ert self.mocks['
-0001ab30: 636c 6965 6e74 275d 2e43 6c69 656e 7428  client'].Client(
-0001ab40: 292e 6163 6d65 2e75 7064 6174 655f 7265  ).acme.update_re
-0001ab50: 6769 7374 7261 7469 6f6e 2e63 616c 6c5f  gistration.call_
-0001ab60: 636f 756e 7420 3d3d 2031 0a20 2020 2020  count == 1.     
-0001ab70: 2020 206d 6f63 6b5f 7265 6772 2e62 6f64     mock_regr.bod
-0001ab80: 792e 7570 6461 7465 2e61 7373 6572 745f  y.update.assert_
-0001ab90: 6361 6c6c 6564 5f77 6974 6828 636f 6e74  called_with(cont
-0001aba0: 6163 743d 2829 290a 2020 2020 2020 2020  act=()).        
-0001abb0: 2320 5765 2067 6f74 2061 6e20 7570 6461  # We got an upda
-0001abc0: 7465 2066 726f 6d20 7468 6520 7365 7276  te from the serv
-0001abd0: 6572 2061 6e64 2070 6572 7369 7374 6564  er and persisted
-0001abe0: 2069 740a 2020 2020 2020 2020 6173 7365   it.        asse
-0001abf0: 7274 206d 6f63 6b5f 7374 6f72 6167 652e  rt mock_storage.
-0001ac00: 7570 6461 7465 5f72 6567 722e 6361 6c6c  update_regr.call
-0001ac10: 5f63 6f75 6e74 203d 3d20 310a 2020 2020  _count == 1.    
-0001ac20: 2020 2020 2320 5765 2073 686f 756c 6420      # We should 
-0001ac30: 6861 7665 206e 6f74 6966 6965 6420 7468  have notified th
-0001ac40: 6520 7573 6572 0a20 2020 2020 2020 2073  e user.        s
-0001ac50: 656c 662e 6d6f 636b 735b 276e 6f74 6966  elf.mocks['notif
-0001ac60: 7927 5d2e 6173 7365 7274 5f63 616c 6c65  y'].assert_calle
-0001ac70: 645f 7769 7468 280a 2020 2020 2020 2020  d_with(.        
-0001ac80: 2020 2020 2741 6e79 2063 6f6e 7461 6374      'Any contact
-0001ac90: 2069 6e66 6f72 6d61 7469 6f6e 2061 7373   information ass
-0001aca0: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-0001acb0: 7320 6163 636f 756e 7420 6861 7320 6265  s account has be
-0001acc0: 656e 2072 656d 6f76 6564 2e27 0a20 2020  en removed.'.   
-0001acd0: 2020 2020 2029 0a20 2020 2020 2020 2023       ).        #
-0001ace0: 2057 6520 7368 6f75 6c64 206e 6f74 2068   We should not h
-0001acf0: 6176 6520 6361 6c6c 6564 2073 7562 7363  ave called subsc
-0001ad00: 7269 7074 696f 6e20 6265 6361 7573 6520  ription because 
-0001ad10: 7468 6572 6527 7320 6e6f 2065 6d61 696c  there's no email
-0001ad20: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-0001ad30: 636b 735b 2770 7265 7061 7265 5f73 7562  cks['prepare_sub
-0001ad40: 275d 2e61 7373 6572 745f 6e6f 745f 6361  '].assert_not_ca
-0001ad50: 6c6c 6564 2829 0a0a 2020 2020 6465 6620  lled()..    def 
-0001ad60: 7465 7374 5f6e 6f5f 6578 6973 7469 6e67  test_no_existing
-0001ad70: 5f61 6363 6f75 6e74 7328 7365 6c66 293a  _accounts(self):
-0001ad80: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
-0001ad90: 2074 6861 7420 6e6f 2065 7869 7374 696e   that no existin
-0001ada0: 6720 6163 636f 756e 7420 6973 2068 616e  g account is han
-0001adb0: 646c 6564 2063 6f72 7265 6374 6c79 2222  dled correctly""
-0001adc0: 220a 2020 2020 2020 2020 6d6f 636b 5f73  ".        mock_s
-0001add0: 746f 7261 6765 203d 206d 6f63 6b2e 4d61  torage = mock.Ma
-0001ade0: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
-0001adf0: 2020 6d6f 636b 5f73 746f 7261 6765 2e66    mock_storage.f
-0001ae00: 696e 645f 616c 6c2e 7265 7475 726e 5f76  ind_all.return_v
-0001ae10: 616c 7565 203d 205b 5d0a 2020 2020 2020  alue = [].      
-0001ae20: 2020 7365 6c66 2e6d 6f63 6b73 5b27 6163    self.mocks['ac
-0001ae30: 636f 756e 7427 5d2e 4163 636f 756e 7446  count'].AccountF
-0001ae40: 696c 6553 746f 7261 6765 2e72 6574 7572  ileStorage.retur
-0001ae50: 6e5f 7661 6c75 6520 3d20 6d6f 636b 5f73  n_value = mock_s
-0001ae60: 746f 7261 6765 0a20 2020 2020 2020 2061  torage.        a
-0001ae70: 7373 6572 7420 7365 6c66 2e5f 6361 6c6c  ssert self._call
-0001ae80: 285b 2775 7064 6174 655f 6163 636f 756e  (['update_accoun
-0001ae90: 7427 2c20 272d 2d65 6d61 696c 272c 2027  t', '--email', '
-0001aea0: 7573 6572 4065 7861 6d70 6c65 2e6f 7267  user@example.org
-0001aeb0: 275d 2920 3d3d 205c 0a20 2020 2020 2020  ']) == \.       
-0001aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aed0: 2020 2743 6f75 6c64 206e 6f74 2066 696e    'Could not fin
-0001aee0: 6420 616e 2065 7869 7374 696e 6720 6163  d an existing ac
-0001aef0: 636f 756e 7420 666f 7220 7365 7276 6572  count for server
-0001af00: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
-0001af10: 2020 2020 2020 2020 2020 2020 2027 2068               ' h
-0001af20: 7474 7073 3a2f 2f61 636d 652d 7630 322e  ttps://acme-v02.
-0001af30: 6170 692e 6c65 7473 656e 6372 7970 742e  api.letsencrypt.
-0001af40: 6f72 672f 6469 7265 6374 6f72 792e 270a  org/directory.'.
-0001af50: 0a20 2020 2064 6566 2074 6573 745f 7570  .    def test_up
-0001af60: 6461 7465 5f61 6363 6f75 6e74 5f72 656d  date_account_rem
-0001af70: 6f76 655f 656d 6169 6c28 7365 6c66 293a  ove_email(self):
-0001af80: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
-0001af90: 2074 6861 7420 2d2d 7265 6769 7374 6572   that --register
-0001afa0: 2d75 6e73 6166 656c 792d 7769 7468 6f75  -unsafely-withou
-0001afb0: 742d 656d 6169 6c20 6973 2068 616e 646c  t-email is handl
-0001afc0: 6564 2061 7320 6e6f 2065 6d61 696c 2222  ed as no email""
-0001afd0: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
-0001afe0: 7465 7374 5f75 7064 6174 655f 6e6f 5f63  test_update_no_c
-0001aff0: 6f6e 7461 6374 285b 2775 7064 6174 655f  ontact(['update_
-0001b000: 6163 636f 756e 7427 2c20 272d 2d72 6567  account', '--reg
-0001b010: 6973 7465 722d 756e 7361 6665 6c79 2d77  ister-unsafely-w
-0001b020: 6974 686f 7574 2d65 6d61 696c 275d 290a  ithout-email']).
-0001b030: 0a20 2020 2064 6566 2074 6573 745f 7570  .    def test_up
-0001b040: 6461 7465 5f61 6363 6f75 6e74 5f65 6d70  date_account_emp
-0001b050: 7479 5f65 6d61 696c 2873 656c 6629 3a0a  ty_email(self):.
-0001b060: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
-0001b070: 7468 6174 2070 726f 7669 6469 6e67 2061  that providing a
-0001b080: 6e20 656d 7074 7920 656d 6169 6c20 6973  n empty email is
-0001b090: 2068 616e 646c 6564 2061 7320 6e6f 2065   handled as no e
-0001b0a0: 6d61 696c 2222 220a 2020 2020 2020 2020  mail""".        
-0001b0b0: 7365 6c66 2e5f 7465 7374 5f75 7064 6174  self._test_updat
-0001b0c0: 655f 6e6f 5f63 6f6e 7461 6374 285b 2775  e_no_contact(['u
-0001b0d0: 7064 6174 655f 6163 636f 756e 7427 2c20  pdate_account', 
-0001b0e0: 272d 6d27 2c20 2727 5d29 0a0a 2020 2020  '-m', ''])..    
-0001b0f0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
-0001b100: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
-0001b110: 6169 6e2e 6469 7370 6c61 795f 6f70 732e  ain.display_ops.
-0001b120: 6765 745f 656d 6169 6c27 290a 2020 2020  get_email').    
-0001b130: 6465 6620 7465 7374 5f75 7064 6174 655f  def test_update_
-0001b140: 6163 636f 756e 745f 7769 7468 5f65 6d61  account_with_ema
-0001b150: 696c 2873 656c 662c 206d 6f63 6b5f 656d  il(self, mock_em
-0001b160: 6169 6c29 3a0a 2020 2020 2020 2020 2222  ail):.        ""
-0001b170: 2254 6573 7420 7468 6174 2075 7064 6174  "Test that updat
-0001b180: 696e 6720 7769 7468 2061 2073 696e 6775  ing with a singu
-0001b190: 6c61 7220 656d 6169 6c20 6973 2068 616e  lar email is han
-0001b1a0: 646c 6564 2063 6f72 7265 6374 6c79 2222  dled correctly""
-0001b1b0: 220a 2020 2020 2020 2020 6d6f 636b 5f65  ".        mock_e
-0001b1c0: 6d61 696c 2e72 6574 7572 6e5f 7661 6c75  mail.return_valu
-0001b1d0: 6520 3d20 2775 7365 7240 6578 616d 706c  e = 'user@exampl
-0001b1e0: 652e 636f 6d27 0a20 2020 2020 2020 2028  e.com'.        (
-0001b1f0: 5f2c 206d 6f63 6b5f 7374 6f72 6167 652c  _, mock_storage,
-0001b200: 205f 2920 3d20 7365 6c66 2e5f 7072 6570   _) = self._prep
-0001b210: 6172 655f 6d6f 636b 5f61 6363 6f75 6e74  are_mock_account
-0001b220: 2829 0a20 2020 2020 2020 206d 6f63 6b5f  ().        mock_
-0001b230: 636c 6965 6e74 203d 206d 6f63 6b2e 4d61  client = mock.Ma
-0001b240: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
-0001b250: 2020 7365 6c66 2e6d 6f63 6b73 5b27 636c    self.mocks['cl
-0001b260: 6965 6e74 275d 2e43 6c69 656e 742e 7265  ient'].Client.re
-0001b270: 7475 726e 5f76 616c 7565 203d 206d 6f63  turn_value = moc
-0001b280: 6b5f 636c 6965 6e74 0a0a 2020 2020 2020  k_client..      
-0001b290: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
-0001b2a0: 5f63 616c 6c28 5b27 7570 6461 7465 5f61  _call(['update_a
-0001b2b0: 6363 6f75 6e74 275d 290a 2020 2020 2020  ccount']).      
-0001b2c0: 2020 2320 4e6f 6e65 2069 6620 7265 6769    # None if regi
-0001b2d0: 7374 7261 7469 6f6e 2073 7563 6365 6564  stration succeed
-0001b2e0: 730a 2020 2020 2020 2020 6173 7365 7274  s.        assert
-0001b2f0: 2072 6573 756c 7420 6973 204e 6f6e 650a   result is None.
-0001b300: 2020 2020 2020 2020 2320 5765 2073 686f          # We sho
-0001b310: 756c 6420 6861 7665 2075 7064 6174 6564  uld have updated
-0001b320: 2074 6865 2073 6572 7665 720a 2020 2020   the server.    
-0001b330: 2020 2020 6173 7365 7274 206d 6f63 6b5f      assert mock_
-0001b340: 636c 6965 6e74 2e61 636d 652e 7570 6461  client.acme.upda
-0001b350: 7465 5f72 6567 6973 7472 6174 696f 6e2e  te_registration.
-0001b360: 6361 6c6c 5f63 6f75 6e74 203d 3d20 310a  call_count == 1.
-0001b370: 2020 2020 2020 2020 2320 5765 2073 686f          # We sho
-0001b380: 756c 6420 6861 7665 2075 7064 6174 6564  uld have updated
-0001b390: 2074 6865 2061 6363 6f75 6e74 206f 6e20   the account on 
-0001b3a0: 6469 736b 0a20 2020 2020 2020 2061 7373  disk.        ass
-0001b3b0: 6572 7420 6d6f 636b 5f73 746f 7261 6765  ert mock_storage
-0001b3c0: 2e75 7064 6174 655f 7265 6772 2e63 616c  .update_regr.cal
-0001b3d0: 6c5f 636f 756e 7420 3d3d 2031 0a20 2020  l_count == 1.   
-0001b3e0: 2020 2020 2023 2053 7562 7363 7269 7074       # Subscript
-0001b3f0: 696f 6e20 7368 6f75 6c64 2068 6176 6520  ion should have 
-0001b400: 6265 656e 2070 726f 6d70 7465 640a 2020  been prompted.  
-0001b410: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
-0001b420: 662e 6d6f 636b 735b 2770 7265 7061 7265  f.mocks['prepare
-0001b430: 5f73 7562 275d 2e63 616c 6c5f 636f 756e  _sub'].call_coun
-0001b440: 7420 3d3d 2031 0a20 2020 2020 2020 2023  t == 1.        #
-0001b450: 2053 686f 756c 6420 6861 7665 2070 7269   Should have pri
-0001b460: 6e74 6564 2074 6865 2065 6d61 696c 0a20  nted the email. 
-0001b470: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
-0001b480: 735b 276e 6f74 6966 7927 5d2e 6173 7365  s['notify'].asse
-0001b490: 7274 5f63 616c 6c65 645f 7769 7468 280a  rt_called_with(.
-0001b4a0: 2020 2020 2020 2020 2020 2020 2759 6f75              'You
-0001b4b0: 7220 652d 6d61 696c 2061 6464 7265 7373  r e-mail address
-0001b4c0: 2077 6173 2075 7064 6174 6564 2074 6f20   was updated to 
-0001b4d0: 7573 6572 4065 7861 6d70 6c65 2e63 6f6d  user@example.com
-0001b4e0: 2e27 290a 0a20 2020 2064 6566 2074 6573  .')..    def tes
-0001b4f0: 745f 7570 6461 7465 5f61 6363 6f75 6e74  t_update_account
-0001b500: 5f77 6974 685f 6d75 6c74 6970 6c65 5f65  _with_multiple_e
-0001b510: 6d61 696c 7328 7365 6c66 293a 0a20 2020  mails(self):.   
-0001b520: 2020 2020 2022 2222 5465 7374 2074 6861       """Test tha
-0001b530: 7420 6d75 6c74 6970 6c65 2065 6d61 696c  t multiple email
-0001b540: 2061 6464 7265 7373 6573 2061 7265 2068   addresses are h
-0001b550: 616e 646c 6564 2063 6f72 7265 6374 6c79  andled correctly
-0001b560: 2222 220a 2020 2020 2020 2020 285f 2c20  """.        (_, 
-0001b570: 6d6f 636b 5f73 746f 7261 6765 2c20 6d6f  mock_storage, mo
-0001b580: 636b 5f72 6567 7229 203d 2073 656c 662e  ck_regr) = self.
-0001b590: 5f70 7265 7061 7265 5f6d 6f63 6b5f 6163  _prepare_mock_ac
-0001b5a0: 636f 756e 7428 290a 2020 2020 2020 2020  count().        
-0001b5b0: 6173 7365 7274 2073 656c 662e 5f63 616c  assert self._cal
-0001b5c0: 6c28 5b27 7570 6461 7465 5f61 6363 6f75  l(['update_accou
-0001b5d0: 6e74 272c 2027 2d6d 272c 2027 7573 6572  nt', '-m', 'user
-0001b5e0: 4065 7861 6d70 6c65 2e63 6f6d 2c75 7365  @example.com,use
-0001b5f0: 7240 6578 616d 706c 652e 6f72 6727 5d29  r@example.org'])
-0001b600: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
-0001b610: 206d 6f63 6b5f 7265 6772 2e62 6f64 792e   mock_regr.body.
-0001b620: 7570 6461 7465 2e61 7373 6572 745f 6361  update.assert_ca
-0001b630: 6c6c 6564 5f77 6974 6828 0a20 2020 2020  lled_with(.     
-0001b640: 2020 2020 2020 2063 6f6e 7461 6374 3d5b         contact=[
-0001b650: 276d 6169 6c74 6f3a 7573 6572 4065 7861  'mailto:user@exa
-0001b660: 6d70 6c65 2e63 6f6d 272c 2027 6d61 696c  mple.com', 'mail
-0001b670: 746f 3a75 7365 7240 6578 616d 706c 652e  to:user@example.
-0001b680: 6f72 6727 5d0a 2020 2020 2020 2020 290a  org'].        ).
-0001b690: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
-0001b6a0: 6f63 6b5f 7374 6f72 6167 652e 7570 6461  ock_storage.upda
-0001b6b0: 7465 5f72 6567 722e 6361 6c6c 5f63 6f75  te_regr.call_cou
-0001b6c0: 6e74 203d 3d20 310a 2020 2020 2020 2020  nt == 1.        
-0001b6d0: 7365 6c66 2e6d 6f63 6b73 5b27 6e6f 7469  self.mocks['noti
-0001b6e0: 6679 275d 2e61 7373 6572 745f 6361 6c6c  fy'].assert_call
-0001b6f0: 6564 5f77 6974 6828 0a20 2020 2020 2020  ed_with(.       
-0001b700: 2020 2020 2027 596f 7572 2065 2d6d 6169       'Your e-mai
-0001b710: 6c20 6164 6472 6573 7320 7761 7320 7570  l address was up
-0001b720: 6461 7465 6420 746f 2075 7365 7240 6578  dated to user@ex
-0001b730: 616d 706c 652e 636f 6d2c 7573 6572 4065  ample.com,user@e
-0001b740: 7861 6d70 6c65 2e6f 7267 2e27 290a 0a0a  xample.org.')...
-0001b750: 636c 6173 7320 5368 6f77 4163 636f 756e  class ShowAccoun
-0001b760: 7454 6573 7428 7465 7374 5f75 7469 6c2e  tTest(test_util.
-0001b770: 436f 6e66 6967 5465 7374 4361 7365 293a  ConfigTestCase):
-0001b780: 0a20 2020 2022 2222 5465 7374 7320 666f  .    """Tests fo
-0001b790: 7220 6365 7274 626f 742e 5f69 6e74 6572  r certbot._inter
-0001b7a0: 6e61 6c2e 6d61 696e 2e73 686f 775f 6163  nal.main.show_ac
-0001b7b0: 636f 756e 7422 2222 0a0a 2020 2020 6465  count"""..    de
-0001b7c0: 6620 7365 7455 7028 7365 6c66 293a 0a20  f setUp(self):. 
-0001b7d0: 2020 2020 2020 2070 6174 6368 6573 203d         patches =
-0001b7e0: 207b 0a20 2020 2020 2020 2020 2020 2027   {.            '
-0001b7f0: 6163 636f 756e 7427 3a20 6d6f 636b 2e70  account': mock.p
-0001b800: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
-0001b810: 6e74 6572 6e61 6c2e 6d61 696e 2e61 6363  nternal.main.acc
-0001b820: 6f75 6e74 2729 2c0a 2020 2020 2020 2020  ount'),.        
-0001b830: 2020 2020 2761 7465 7869 7427 3a20 6d6f      'atexit': mo
-0001b840: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
-0001b850: 742e 7574 696c 2e61 7465 7869 7427 292c  t.util.atexit'),
-0001b860: 0a20 2020 2020 2020 2020 2020 2027 636c  .            'cl
-0001b870: 6965 6e74 273a 206d 6f63 6b2e 7061 7463  ient': mock.patc
-0001b880: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-0001b890: 726e 616c 2e6d 6169 6e2e 636c 6965 6e74  rnal.main.client
-0001b8a0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-0001b8b0: 2764 6574 6572 6d69 6e65 5f61 6363 6f75  'determine_accou
-0001b8c0: 6e74 273a 206d 6f63 6b2e 7061 7463 6828  nt': mock.patch(
-0001b8d0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
-0001b8e0: 616c 2e6d 6169 6e2e 5f64 6574 6572 6d69  al.main._determi
-0001b8f0: 6e65 5f61 6363 6f75 6e74 2729 2c0a 2020  ne_account'),.  
-0001b900: 2020 2020 2020 2020 2020 276e 6f74 6966            'notif
-0001b910: 7927 3a20 6d6f 636b 2e70 6174 6368 2827  y': mock.patch('
-0001b920: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
-0001b930: 6c2e 6d61 696e 2e64 6973 706c 6179 5f75  l.main.display_u
-0001b940: 7469 6c2e 6e6f 7469 6679 2729 2c0a 2020  til.notify'),.  
-0001b950: 2020 2020 2020 2020 2020 2775 7469 6c27            'util'
-0001b960: 3a20 7465 7374 5f75 7469 6c2e 7061 7463  : test_util.patc
-0001b970: 685f 6469 7370 6c61 795f 7574 696c 2829  h_display_util()
-0001b980: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-0001b990: 2020 2073 656c 662e 6d6f 636b 7320 3d20     self.mocks = 
-0001b9a0: 7b20 6b3a 2070 6174 6368 6573 5b6b 5d2e  { k: patches[k].
-0001b9b0: 7374 6172 7428 2920 666f 7220 6b20 696e  start() for k in
-0001b9c0: 2070 6174 6368 6573 207d 0a20 2020 2020   patches }.     
-0001b9d0: 2020 2066 6f72 2070 6174 6368 2069 6e20     for patch in 
-0001b9e0: 7061 7463 6865 732e 7661 6c75 6573 2829  patches.values()
-0001b9f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0001ba00: 6c66 2e61 6464 436c 6561 6e75 7028 7061  lf.addCleanup(pa
-0001ba10: 7463 682e 7374 6f70 290a 0a20 2020 2020  tch.stop)..     
-0001ba20: 2020 2072 6574 7572 6e20 7375 7065 7228     return super(
-0001ba30: 292e 7365 7455 7028 290a 0a20 2020 2064  ).setUp()..    d
-0001ba40: 6566 205f 6361 6c6c 2873 656c 662c 2061  ef _call(self, a
-0001ba50: 7267 7329 3a0a 2020 2020 2020 2020 7769  rgs):.        wi
-0001ba60: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
-0001ba70: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-0001ba80: 2e6d 6169 6e2e 7379 732e 7374 646f 7574  .main.sys.stdout
-0001ba90: 2729 2c20 5c0a 2020 2020 2020 2020 2020  '), \.          
-0001baa0: 2020 206d 6f63 6b2e 7061 7463 6828 2763     mock.patch('c
-0001bab0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
-0001bac0: 2e6d 6169 6e2e 7379 732e 7374 6465 7272  .main.sys.stderr
-0001bad0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0001bae0: 6172 6773 203d 205b 272d 2d63 6f6e 6669  args = ['--confi
-0001baf0: 672d 6469 7227 2c20 7365 6c66 2e63 6f6e  g-dir', self.con
-0001bb00: 6669 672e 636f 6e66 6967 5f64 6972 2c0a  fig.config_dir,.
-0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb20: 2020 2020 272d 2d77 6f72 6b2d 6469 7227      '--work-dir'
-0001bb30: 2c20 7365 6c66 2e63 6f6e 6669 672e 776f  , self.config.wo
-0001bb40: 726b 5f64 6972 2c0a 2020 2020 2020 2020  rk_dir,.        
-0001bb50: 2020 2020 2020 2020 2020 2020 272d 2d6c              '--l
-0001bb60: 6f67 732d 6469 7227 2c20 7365 6c66 2e63  ogs-dir', self.c
-0001bb70: 6f6e 6669 672e 6c6f 6773 5f64 6972 2c20  onfig.logs_dir, 
-0001bb80: 272d 2d74 6578 7427 5d20 2b20 6172 6773  '--text'] + args
-0001bb90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001bba0: 7572 6e20 6d61 696e 2e6d 6169 6e28 6172  urn main.main(ar
-0001bbb0: 6773 5b3a 5d29 2023 204e 4f54 453a 2070  gs[:]) # NOTE: p
-0001bbc0: 6172 7365 7220 6361 6e20 616c 7465 7220  arser can alter 
-0001bbd0: 6974 7320 6172 6773 210a 0a20 2020 2064  its args!..    d
-0001bbe0: 6566 205f 7072 6570 6172 655f 6d6f 636b  ef _prepare_mock
-0001bbf0: 5f61 6363 6f75 6e74 2873 656c 6629 3a0a  _account(self):.
-0001bc00: 2020 2020 2020 2020 6d6f 636b 5f73 746f          mock_sto
-0001bc10: 7261 6765 203d 206d 6f63 6b2e 4d61 6769  rage = mock.Magi
-0001bc20: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-0001bc30: 6d6f 636b 5f61 6363 6f75 6e74 203d 206d  mock_account = m
-0001bc40: 6f63 6b2e 4d61 6769 634d 6f63 6b28 290a  ock.MagicMock().
-0001bc50: 2020 2020 2020 2020 6d6f 636b 5f72 6567          mock_reg
-0001bc60: 7220 3d20 6d6f 636b 2e4d 6167 6963 4d6f  r = mock.MagicMo
-0001bc70: 636b 2829 0a20 2020 2020 2020 206d 6f63  ck().        moc
-0001bc80: 6b5f 7374 6f72 6167 652e 6669 6e64 5f61  k_storage.find_a
-0001bc90: 6c6c 2e72 6574 7572 6e5f 7661 6c75 6520  ll.return_value 
-0001bca0: 3d20 5b6d 6f63 6b5f 6163 636f 756e 745d  = [mock_account]
-0001bcb0: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-0001bcc0: 636b 735b 2761 6363 6f75 6e74 275d 2e41  cks['account'].A
-0001bcd0: 6363 6f75 6e74 4669 6c65 5374 6f72 6167  ccountFileStorag
-0001bce0: 652e 7265 7475 726e 5f76 616c 7565 203d  e.return_value =
-0001bcf0: 206d 6f63 6b5f 7374 6f72 6167 650a 2020   mock_storage.  
-0001bd00: 2020 2020 2020 6d6f 636b 5f61 6363 6f75        mock_accou
-0001bd10: 6e74 2e72 6567 722e 626f 6479 203d 206d  nt.regr.body = m
-0001bd20: 6f63 6b5f 7265 6772 2e62 6f64 790a 2020  ock_regr.body.  
-0001bd30: 2020 2020 2020 6d6f 636b 5f61 6363 6f75        mock_accou
-0001bd40: 6e74 2e6b 6579 2e74 6875 6d62 7072 696e  nt.key.thumbprin
-0001bd50: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
-0001bd60: 2062 2766 6f6f 6261 7262 617a 270a 2020   b'foobarbaz'.  
-0001bd70: 2020 2020 2020 7365 6c66 2e6d 6f63 6b73        self.mocks
-0001bd80: 5b27 6465 7465 726d 696e 655f 6163 636f  ['determine_acco
-0001bd90: 756e 7427 5d2e 7265 7475 726e 5f76 616c  unt'].return_val
-0001bda0: 7565 203d 2028 6d6f 636b 5f61 6363 6f75  ue = (mock_accou
-0001bdb0: 6e74 2c20 6d6f 636b 2e4d 6167 6963 4d6f  nt, mock.MagicMo
-0001bdc0: 636b 2829 290a 0a20 2020 2064 6566 205f  ck())..    def _
-0001bdd0: 7465 7374 5f73 686f 775f 6163 636f 756e  test_show_accoun
-0001bde0: 7428 7365 6c66 2c20 636f 6e74 6163 7429  t(self, contact)
-0001bdf0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0001be00: 7072 6570 6172 655f 6d6f 636b 5f61 6363  prepare_mock_acc
-0001be10: 6f75 6e74 2829 0a20 2020 2020 2020 206d  ount().        m
-0001be20: 6f63 6b5f 636c 6965 6e74 203d 206d 6f63  ock_client = moc
-0001be30: 6b2e 4d61 6769 634d 6f63 6b28 290a 2020  k.MagicMock().  
-0001be40: 2020 2020 2020 6d6f 636b 5f72 6567 7220        mock_regr 
-0001be50: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
-0001be60: 2829 0a20 2020 2020 2020 206d 6f63 6b5f  ().        mock_
-0001be70: 7265 6772 2e62 6f64 792e 636f 6e74 6163  regr.body.contac
-0001be80: 7420 3d20 636f 6e74 6163 740a 2020 2020  t = contact.    
-0001be90: 2020 2020 6d6f 636b 5f72 6567 722e 7572      mock_regr.ur
-0001bea0: 6920 3d20 2768 7474 7073 3a2f 2f77 7777  i = 'https://www
-0001beb0: 2e6c 6574 7365 6e63 7279 7074 2d64 656d  .letsencrypt-dem
-0001bec0: 6f2e 6f72 672f 6163 6d65 2f72 6567 2f31  o.org/acme/reg/1
-0001bed0: 270a 2020 2020 2020 2020 6d6f 636b 5f63  '.        mock_c
-0001bee0: 6c69 656e 742e 6163 6d65 2e71 7565 7279  lient.acme.query
-0001bef0: 5f72 6567 6973 7472 6174 696f 6e2e 7265  _registration.re
-0001bf00: 7475 726e 5f76 616c 7565 203d 206d 6f63  turn_value = moc
-0001bf10: 6b5f 7265 6772 0a20 2020 2020 2020 2073  k_regr.        s
-0001bf20: 656c 662e 6d6f 636b 735b 2763 6c69 656e  elf.mocks['clien
-0001bf30: 7427 5d2e 436c 6965 6e74 2e72 6574 7572  t'].Client.retur
-0001bf40: 6e5f 7661 6c75 6520 3d20 6d6f 636b 5f63  n_value = mock_c
-0001bf50: 6c69 656e 740a 0a20 2020 2020 2020 2061  lient..        a
-0001bf60: 7267 7320 3d20 5b27 7368 6f77 5f61 6363  rgs = ['show_acc
-0001bf70: 6f75 6e74 275d 0a0a 2020 2020 2020 2020  ount']..        
-0001bf80: 7365 6c66 2e5f 6361 6c6c 2861 7267 7329  self._call(args)
-0001bf90: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
-0001bfa0: 206d 6f63 6b5f 636c 6965 6e74 2e61 636d   mock_client.acm
-0001bfb0: 652e 7175 6572 795f 7265 6769 7374 7261  e.query_registra
-0001bfc0: 7469 6f6e 2e63 616c 6c5f 636f 756e 7420  tion.call_count 
-0001bfd0: 3d3d 2031 0a0a 2020 2020 6465 6620 7465  == 1..    def te
-0001bfe0: 7374 5f6e 6f5f 6578 6973 7469 6e67 5f61  st_no_existing_a
-0001bff0: 6363 6f75 6e74 7328 7365 6c66 293a 0a20  ccounts(self):. 
-0001c000: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
-0001c010: 6861 7420 6e6f 2065 7869 7374 696e 6720  hat no existing 
-0001c020: 6163 636f 756e 7420 6973 2068 616e 646c  account is handl
-0001c030: 6564 2063 6f72 7265 6374 6c79 2222 220a  ed correctly""".
-0001c040: 2020 2020 2020 2020 6d6f 636b 5f73 746f          mock_sto
-0001c050: 7261 6765 203d 206d 6f63 6b2e 4d61 6769  rage = mock.Magi
-0001c060: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-0001c070: 6d6f 636b 5f73 746f 7261 6765 2e66 696e  mock_storage.fin
-0001c080: 645f 616c 6c2e 7265 7475 726e 5f76 616c  d_all.return_val
-0001c090: 7565 203d 205b 5d0a 2020 2020 2020 2020  ue = [].        
-0001c0a0: 7365 6c66 2e6d 6f63 6b73 5b27 6163 636f  self.mocks['acco
-0001c0b0: 756e 7427 5d2e 4163 636f 756e 7446 696c  unt'].AccountFil
-0001c0c0: 6553 746f 7261 6765 2e72 6574 7572 6e5f  eStorage.return_
-0001c0d0: 7661 6c75 6520 3d20 6d6f 636b 5f73 746f  value = mock_sto
-0001c0e0: 7261 6765 0a20 2020 2020 2020 2061 7373  rage.        ass
-0001c0f0: 6572 7420 7365 6c66 2e5f 6361 6c6c 285b  ert self._call([
-0001c100: 2773 686f 775f 6163 636f 756e 7427 5d29  'show_account'])
-0001c110: 203d 3d20 5c0a 2020 2020 2020 2020 2020   == \.          
-0001c120: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001c130: 436f 756c 6420 6e6f 7420 6669 6e64 2061  Could not find a
-0001c140: 6e20 6578 6973 7469 6e67 2061 6363 6f75  n existing accou
-0001c150: 6e74 2066 6f72 2073 6572 7665 7227 205c  nt for server' \
-0001c160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c170: 2020 2020 2020 2020 2020 2720 6874 7470            ' http
-0001c180: 733a 2f2f 6163 6d65 2d76 3032 2e61 7069  s://acme-v02.api
-0001c190: 2e6c 6574 7365 6e63 7279 7074 2e6f 7267  .letsencrypt.org
-0001c1a0: 2f64 6972 6563 746f 7279 2e27 0a0a 2020  /directory.'..  
-0001c1b0: 2020 6465 6620 7465 7374 5f6e 6f5f 6578    def test_no_ex
-0001c1c0: 6973 7469 6e67 5f63 6c69 656e 7428 7365  isting_client(se
-0001c1d0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001c1e0: 5465 7374 2074 6861 7420 6973 7375 6573  Test that issues
-0001c1f0: 2077 6974 6820 7468 6520 4143 4d45 2063   with the ACME c
-0001c200: 6c69 656e 7420 6172 6520 6861 6e64 6c65  lient are handle
-0001c210: 6420 636f 7272 6563 746c 7922 2222 0a20  d correctly""". 
-0001c220: 2020 2020 2020 2073 656c 662e 5f70 7265         self._pre
-0001c230: 7061 7265 5f6d 6f63 6b5f 6163 636f 756e  pare_mock_accoun
-0001c240: 7428 290a 2020 2020 2020 2020 6d6f 636b  t().        mock
-0001c250: 5f63 6c69 656e 7420 3d20 6d6f 636b 2e4d  _client = mock.M
-0001c260: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-0001c270: 2020 206d 6f63 6b5f 636c 6965 6e74 2e61     mock_client.a
-0001c280: 636d 6520 3d20 4e6f 6e65 0a20 2020 2020  cme = None.     
-0001c290: 2020 2073 656c 662e 6d6f 636b 735b 2763     self.mocks['c
-0001c2a0: 6c69 656e 7427 5d2e 436c 6965 6e74 2e72  lient'].Client.r
-0001c2b0: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
-0001c2c0: 636b 5f63 6c69 656e 740a 2020 2020 2020  ck_client.      
-0001c2d0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001c2e0: 2020 2073 656c 662e 5f63 616c 6c28 5b27     self._call(['
-0001c2f0: 7368 6f77 5f61 6363 6f75 6e74 275d 290a  show_account']).
-0001c300: 2020 2020 2020 2020 6578 6365 7074 2065          except e
-0001c310: 7272 6f72 732e 4572 726f 7220 6173 2065  rrors.Error as e
-0001c320: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-0001c330: 7365 7274 2027 4143 4d45 2063 6c69 656e  sert 'ACME clien
-0001c340: 7420 6973 206e 6f74 2073 6574 2e27 203d  t is not set.' =
-0001c350: 3d20 7374 7228 6529 0a0a 2020 2020 6465  = str(e)..    de
-0001c360: 6620 7465 7374 5f6e 6f5f 636f 6e74 6163  f test_no_contac
-0001c370: 7473 2873 656c 6629 3a0a 2020 2020 2020  ts(self):.      
-0001c380: 2020 7365 6c66 2e5f 7465 7374 5f73 686f    self._test_sho
-0001c390: 775f 6163 636f 756e 7428 2829 290a 0a20  w_account(()).. 
-0001c3a0: 2020 2020 2020 2061 7373 6572 7420 7365         assert se
-0001c3b0: 6c66 2e6d 6f63 6b73 5b27 6e6f 7469 6679  lf.mocks['notify
-0001c3c0: 275d 2e63 616c 6c5f 636f 756e 7420 3d3d  '].call_count ==
-0001c3d0: 2031 0a20 2020 2020 2020 2073 656c 662e   1.        self.
-0001c3e0: 6d6f 636b 735b 276e 6f74 6966 7927 5d2e  mocks['notify'].
-0001c3f0: 6173 7365 7274 5f68 6173 5f63 616c 6c73  assert_has_calls
-0001c400: 285b 0a20 2020 2020 2020 2020 2020 206d  ([.            m
-0001c410: 6f63 6b2e 6361 6c6c 2827 4163 636f 756e  ock.call('Accoun
-0001c420: 7420 6465 7461 696c 7320 666f 7220 7365  t details for se
-0001c430: 7276 6572 2068 7474 7073 3a2f 2f61 636d  rver https://acm
-0001c440: 652d 7630 322e 6170 692e 6c65 7473 656e  e-v02.api.letsen
-0001c450: 6372 270a 2020 2020 2020 2020 2020 2020  cr'.            
-0001c460: 2020 2020 2020 2020 2020 2779 7074 2e6f            'ypt.o
-0001c470: 7267 2f64 6972 6563 746f 7279 3a5c 6e20  rg/directory:\n 
-0001c480: 2041 6363 6f75 6e74 2055 524c 3a20 6874   Account URL: ht
-0001c490: 7470 733a 2f2f 7777 772e 6c65 7473 656e  tps://www.letsen
-0001c4a0: 6372 7927 0a20 2020 2020 2020 2020 2020  cry'.           
-0001c4b0: 2020 2020 2020 2020 2020 2027 7074 2d64             'pt-d
-0001c4c0: 656d 6f2e 6f72 672f 6163 6d65 2f72 6567  emo.org/acme/reg
-0001c4d0: 2f31 5c6e 2020 4163 636f 756e 7420 5468  /1\n  Account Th
-0001c4e0: 756d 6270 7269 6e74 3a20 5a6d 3976 596d  umbprint: Zm9vYm
-0001c4f0: 4679 596d 4636 5c6e 270a 2020 2020 2020  FyYmF6\n'.      
-0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c510: 2720 2045 6d61 696c 2063 6f6e 7461 6374  '  Email contact
-0001c520: 3a20 6e6f 6e65 2729 5d29 0a0a 2020 2020  : none')])..    
-0001c530: 6465 6620 7465 7374 5f73 696e 676c 655f  def test_single_
-0001c540: 656d 6169 6c28 7365 6c66 293a 0a20 2020  email(self):.   
-0001c550: 2020 2020 2063 6f6e 7461 6374 203d 2028       contact = (
-0001c560: 276d 6169 6c74 6f3a 666f 6f40 6578 616d  'mailto:foo@exam
-0001c570: 706c 652e 636f 6d27 2c29 0a20 2020 2020  ple.com',).     
-0001c580: 2020 2073 656c 662e 5f74 6573 745f 7368     self._test_sh
-0001c590: 6f77 5f61 6363 6f75 6e74 2863 6f6e 7461  ow_account(conta
-0001c5a0: 6374 290a 0a20 2020 2020 2020 2061 7373  ct)..        ass
-0001c5b0: 6572 7420 7365 6c66 2e6d 6f63 6b73 5b27  ert self.mocks['
-0001c5c0: 6e6f 7469 6679 275d 2e63 616c 6c5f 636f  notify'].call_co
-0001c5d0: 756e 7420 3d3d 2031 0a20 2020 2020 2020  unt == 1.       
-0001c5e0: 2073 656c 662e 6d6f 636b 735b 276e 6f74   self.mocks['not
-0001c5f0: 6966 7927 5d2e 6173 7365 7274 5f68 6173  ify'].assert_has
-0001c600: 5f63 616c 6c73 285b 0a20 2020 2020 2020  _calls([.       
-0001c610: 2020 2020 206d 6f63 6b2e 6361 6c6c 2827       mock.call('
-0001c620: 4163 636f 756e 7420 6465 7461 696c 7320  Account details 
-0001c630: 666f 7220 7365 7276 6572 2068 7474 7073  for server https
-0001c640: 3a2f 2f61 636d 652d 7630 322e 6170 692e  ://acme-v02.api.
-0001c650: 6c65 7473 656e 6372 270a 2020 2020 2020  letsencr'.      
-0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c670: 2779 7074 2e6f 7267 2f64 6972 6563 746f  'ypt.org/directo
-0001c680: 7279 3a5c 6e20 2041 6363 6f75 6e74 2055  ry:\n  Account U
-0001c690: 524c 3a20 6874 7470 733a 2f2f 7777 772e  RL: https://www.
-0001c6a0: 6c65 7473 656e 6372 7927 0a20 2020 2020  letsencry'.     
-0001c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6c0: 2027 7074 2d64 656d 6f2e 6f72 672f 6163   'pt-demo.org/ac
-0001c6d0: 6d65 2f72 6567 2f31 5c6e 2020 4163 636f  me/reg/1\n  Acco
-0001c6e0: 756e 7420 5468 756d 6270 7269 6e74 3a20  unt Thumbprint: 
-0001c6f0: 5a6d 3976 596d 4679 596d 4636 270a 2020  Zm9vYmFyYmF6'.  
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c710: 2020 2020 275c 6e20 2045 6d61 696c 2063      '\n  Email c
-0001c720: 6f6e 7461 6374 3a20 666f 6f40 6578 616d  ontact: foo@exam
-0001c730: 706c 652e 636f 6d27 295d 290a 0a20 2020  ple.com')])..   
-0001c740: 2064 6566 2074 6573 745f 646f 7562 6c65   def test_double
-0001c750: 5f65 6d61 696c 2873 656c 6629 3a0a 2020  _email(self):.  
-0001c760: 2020 2020 2020 636f 6e74 6163 7420 3d20        contact = 
-0001c770: 2827 6d61 696c 746f 3a66 6f6f 4065 7861  ('mailto:foo@exa
-0001c780: 6d70 6c65 2e63 6f6d 272c 2027 6d61 696c  mple.com', 'mail
-0001c790: 746f 3a62 6172 4065 7861 6d70 6c65 2e63  to:bar@example.c
-0001c7a0: 6f6d 2729 0a20 2020 2020 2020 2073 656c  om').        sel
-0001c7b0: 662e 5f74 6573 745f 7368 6f77 5f61 6363  f._test_show_acc
-0001c7c0: 6f75 6e74 2863 6f6e 7461 6374 290a 0a20  ount(contact).. 
-0001c7d0: 2020 2020 2020 2061 7373 6572 7420 7365         assert se
-0001c7e0: 6c66 2e6d 6f63 6b73 5b27 6e6f 7469 6679  lf.mocks['notify
-0001c7f0: 275d 2e63 616c 6c5f 636f 756e 7420 3d3d  '].call_count ==
-0001c800: 2031 0a20 2020 2020 2020 2073 656c 662e   1.        self.
-0001c810: 6d6f 636b 735b 276e 6f74 6966 7927 5d2e  mocks['notify'].
-0001c820: 6173 7365 7274 5f68 6173 5f63 616c 6c73  assert_has_calls
-0001c830: 285b 0a20 2020 2020 2020 2020 2020 206d  ([.            m
-0001c840: 6f63 6b2e 6361 6c6c 2827 4163 636f 756e  ock.call('Accoun
-0001c850: 7420 6465 7461 696c 7320 666f 7220 7365  t details for se
-0001c860: 7276 6572 2068 7474 7073 3a2f 2f61 636d  rver https://acm
-0001c870: 652d 7630 322e 6170 692e 6c65 7473 656e  e-v02.api.letsen
-0001c880: 6372 270a 2020 2020 2020 2020 2020 2020  cr'.            
-0001c890: 2020 2020 2020 2020 2020 2779 7074 2e6f            'ypt.o
-0001c8a0: 7267 2f64 6972 6563 746f 7279 3a5c 6e20  rg/directory:\n 
-0001c8b0: 2041 6363 6f75 6e74 2055 524c 3a20 6874   Account URL: ht
-0001c8c0: 7470 733a 2f2f 7777 772e 6c65 7473 656e  tps://www.letsen
-0001c8d0: 6372 7927 0a20 2020 2020 2020 2020 2020  cry'.           
-0001c8e0: 2020 2020 2020 2020 2020 2027 7074 2d64             'pt-d
-0001c8f0: 656d 6f2e 6f72 672f 6163 6d65 2f72 6567  emo.org/acme/reg
-0001c900: 2f31 5c6e 2020 4163 636f 756e 7420 5468  /1\n  Account Th
-0001c910: 756d 6270 7269 6e74 3a20 5a6d 3976 596d  umbprint: Zm9vYm
-0001c920: 4679 596d 4636 5c6e 270a 2020 2020 2020  FyYmF6\n'.      
-0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c940: 2720 2045 6d61 696c 2063 6f6e 7461 6374  '  Email contact
-0001c950: 733a 2066 6f6f 4065 7861 6d70 6c65 2e63  s: foo@example.c
-0001c960: 6f6d 2c20 6261 7240 6578 616d 706c 652e  om, bar@example.
-0001c970: 636f 6d27 295d 290a 0a0a 636c 6173 7320  com')])...class 
-0001c980: 5465 7374 4c6f 636b 4f72 6465 723a 0a20  TestLockOrder:. 
-0001c990: 2020 2022 2222 5465 7374 7320 7468 6174     """Tests that
-0001c9a0: 2043 6572 7462 6f74 2773 2064 6972 6563   Certbot's direc
-0001c9b0: 746f 7279 206c 6f63 6b73 2077 6572 6520  tory locks were 
-0001c9c0: 6163 7175 6972 6564 2069 6e20 7468 6520  acquired in the 
-0001c9d0: 7269 6768 7420 6f72 6465 722e 2222 220a  right order.""".
-0001c9e0: 2020 2020 4558 5045 4354 4544 5f45 5252      EXPECTED_ERR
-0001c9f0: 4f52 5f54 5950 4520 3d20 6572 726f 7273  OR_TYPE = errors
-0001ca00: 2e45 7272 6f72 0a20 2020 2045 5850 4543  .Error.    EXPEC
-0001ca10: 5445 445f 4552 524f 525f 5354 5220 3d20  TED_ERROR_STR = 
-0001ca20: 2745 7870 6563 7465 6420 5465 7374 4c6f  'Expected TestLo
-0001ca30: 636b 4f72 6465 7220 6572 726f 7227 0a20  ckOrder error'. 
-0001ca40: 2020 2023 2054 6869 7320 7265 6765 7820     # This regex 
-0001ca50: 6973 206e 6565 6465 6420 6265 6361 7573  is needed becaus
-0001ca60: 6520 6365 7274 626f 7420 7265 6e65 7720  e certbot renew 
-0001ca70: 6361 7074 7572 6573 2072 6169 7365 6420  captures raised 
-0001ca80: 6572 726f 7273 2061 6e64 0a20 2020 2023  errors and.    #
-0001ca90: 2072 6169 7365 7320 6974 7320 6f77 6e2e   raises its own.
-0001caa0: 0a20 2020 2045 5850 4543 5445 445f 4552  .    EXPECTED_ER
-0001cab0: 524f 525f 5354 525f 5245 4745 5820 3d20  ROR_STR_REGEX = 
-0001cac0: 6627 7b45 5850 4543 5445 445f 4552 524f  f'{EXPECTED_ERRO
-0001cad0: 525f 5354 527d 7c31 2072 656e 6577 2066  R_STR}|1 renew f
-0001cae0: 6169 6c75 7265 270a 0a20 2020 2040 7079  ailure'..    @py
-0001caf0: 7465 7374 2e66 6978 7475 7265 0a20 2020  test.fixture.   
-0001cb00: 2064 6566 206d 6f63 6b5f 6c6f 636b 5f64   def mock_lock_d
-0001cb10: 6972 2873 656c 6629 3a0a 2020 2020 2020  ir(self):.      
-0001cb20: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
-0001cb30: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
-0001cb40: 726e 616c 2e6c 6f63 6b2e 6c6f 636b 5f64  rnal.lock.lock_d
-0001cb50: 6972 2729 2061 7320 6d6f 636b 5f6c 6f63  ir') as mock_loc
-0001cb60: 6b5f 6469 723a 0a20 2020 2020 2020 2020  k_dir:.         
-0001cb70: 2020 2079 6965 6c64 206d 6f63 6b5f 6c6f     yield mock_lo
-0001cb80: 636b 5f64 6972 0a0a 2020 2020 4063 6f6e  ck_dir..    @con
-0001cb90: 7465 7874 6c69 622e 636f 6e74 6578 746d  textlib.contextm
-0001cba0: 616e 6167 6572 0a20 2020 2064 6566 206d  anager.    def m
-0001cbb0: 6f63 6b5f 706c 7567 696e 5f70 7265 7061  ock_plugin_prepa
-0001cbc0: 7265 2873 656c 662c 2061 7574 6865 6e74  re(self, authent
-0001cbd0: 6963 6174 6f72 5f64 6972 2c20 696e 7374  icator_dir, inst
-0001cbe0: 616c 6c65 725f 6469 722c 206d 6f63 6b5f  aller_dir, mock_
-0001cbf0: 6c6f 636b 5f64 6972 2c20 7375 6263 6f6d  lock_dir, subcom
-0001cc00: 6d61 6e64 293a 0a20 2020 2020 2020 2022  mand):.        "
-0001cc10: 2222 5061 7463 6865 7320 706c 7567 696e  ""Patches plugin
-0001cc20: 2070 7265 7061 7265 2074 6f20 6361 6c6c   prepare to call
-0001cc30: 206d 6f63 6b5f 6c6f 636b 5f64 6972 2061   mock_lock_dir a
-0001cc40: 6e64 2072 6169 7365 2074 6865 2065 7870  nd raise the exp
-0001cc50: 6563 7465 6420 6572 726f 722e 2222 220a  ected error.""".
-0001cc60: 2020 2020 2020 2020 6465 6620 6175 7468          def auth
-0001cc70: 656e 7469 6361 746f 725f 6c6f 636b 2875  enticator_lock(u
-0001cc80: 6e75 7365 645f 7365 6c66 293a 0a20 2020  nused_self):.   
-0001cc90: 2020 2020 2020 2020 206d 6f63 6b5f 6c6f           mock_lo
-0001cca0: 636b 5f64 6972 2861 7574 6865 6e74 6963  ck_dir(authentic
-0001ccb0: 6174 6f72 5f64 6972 290a 2020 2020 2020  ator_dir).      
-0001ccc0: 2020 2020 2020 7261 6973 6520 7365 6c66        raise self
-0001ccd0: 2e45 5850 4543 5445 445f 4552 524f 525f  .EXPECTED_ERROR_
-0001cce0: 5459 5045 2873 656c 662e 4558 5045 4354  TYPE(self.EXPECT
-0001ccf0: 4544 5f45 5252 4f52 5f53 5452 290a 0a20  ED_ERROR_STR).. 
-0001cd00: 2020 2020 2020 2064 6566 2069 6e73 7461         def insta
-0001cd10: 6c6c 6572 5f6c 6f63 6b28 756e 7573 6564  ller_lock(unused
-0001cd20: 5f73 656c 6629 3a0a 2020 2020 2020 2020  _self):.        
-0001cd30: 2020 2020 6d6f 636b 5f6c 6f63 6b5f 6469      mock_lock_di
-0001cd40: 7228 696e 7374 616c 6c65 725f 6469 7229  r(installer_dir)
-0001cd50: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-0001cd60: 6e6c 6573 7320 616e 2069 6e73 7461 6c6c  nless an install
-0001cd70: 6572 2069 736e 2774 206e 6565 6465 6420  er isn't needed 
-0001cd80: 2865 2e67 2e20 6365 7274 626f 7420 696e  (e.g. certbot in
-0001cd90: 7374 616c 6c29 2c20 7765 0a20 2020 2020  stall), we.     
-0001cda0: 2020 2020 2020 2023 2065 7870 6563 7420         # expect 
-0001cdb0: 7468 6520 6175 7468 656e 7469 6361 746f  the authenticato
-0001cdc0: 7220 746f 2072 6169 7365 2074 6865 2065  r to raise the e
-0001cdd0: 7870 6563 7465 6420 6572 726f 7220 6265  xpected error be
-0001cde0: 6361 7573 6520 6974 0a20 2020 2020 2020  cause it.       
-0001cdf0: 2020 2020 2023 2069 7320 7072 6570 6172       # is prepar
-0001ce00: 6564 206c 6173 742e 2053 6565 0a20 2020  ed last. See.   
-0001ce10: 2020 2020 2020 2020 2023 2068 7474 7073           # https
-0001ce20: 3a2f 2f67 6974 6875 622e 636f 6d2f 6365  ://github.com/ce
-0001ce30: 7274 626f 742f 6365 7274 626f 742f 626c  rtbot/certbot/bl
-0001ce40: 6f62 2f37 6136 3735 3261 3638 6564 3737  ob/7a6752a68ed77
-0001ce50: 6537 3363 3262 3239 6162 3230 6433 6361  e73c2b29ab20d3ca
-0001ce60: 3839 3237 6634 6661 3762 302f 6365 7274  8927f4fa7b0/cert
-0001ce70: 626f 742f 6365 7274 626f 742f 5f69 6e74  bot/certbot/_int
-0001ce80: 6572 6e61 6c2f 706c 7567 696e 732f 7365  ernal/plugins/se
-0001ce90: 6c65 6374 696f 6e2e 7079 234c 3234 362d  lection.py#L246-
-0001cea0: 4c32 3439 0a20 2020 2020 2020 2020 2020  L249.           
-0001ceb0: 2069 6620 7375 6263 6f6d 6d61 6e64 203d   if subcommand =
-0001cec0: 3d20 2769 6e73 7461 6c6c 273a 0a20 2020  = 'install':.   
-0001ced0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001cee0: 7365 2073 656c 662e 4558 5045 4354 4544  se self.EXPECTED
-0001cef0: 5f45 5252 4f52 5f54 5950 4528 7365 6c66  _ERROR_TYPE(self
-0001cf00: 2e45 5850 4543 5445 445f 4552 524f 525f  .EXPECTED_ERROR_
-0001cf10: 5354 5229 0a0a 2020 2020 2020 2020 7769  STR)..        wi
-0001cf20: 7468 206d 6f63 6b2e 7061 7463 682e 6f62  th mock.patch.ob
-0001cf30: 6a65 6374 2873 7461 6e64 616c 6f6e 652e  ject(standalone.
-0001cf40: 4175 7468 656e 7469 6361 746f 722c 2027  Authenticator, '
-0001cf50: 7072 6570 6172 6527 2c20 6175 7468 656e  prepare', authen
-0001cf60: 7469 6361 746f 725f 6c6f 636b 293a 0a20  ticator_lock):. 
-0001cf70: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0001cf80: 6d6f 636b 2e70 6174 6368 2e6f 626a 6563  mock.patch.objec
-0001cf90: 7428 6e75 6c6c 2e49 6e73 7461 6c6c 6572  t(null.Installer
-0001cfa0: 2c20 2770 7265 7061 7265 272c 2069 6e73  , 'prepare', ins
-0001cfb0: 7461 6c6c 6572 5f6c 6f63 6b29 3a0a 2020  taller_lock):.  
-0001cfc0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-0001cfd0: 656c 640a 0a20 2020 2040 7079 7465 7374  eld..    @pytest
-0001cfe0: 2e66 6978 7475 7265 2870 6172 616d 733d  .fixture(params=
-0001cff0: 2763 6572 746f 6e6c 7920 696e 7374 616c  'certonly instal
-0001d000: 6c20 7265 6e65 7720 7275 6e27 2e73 706c  l renew run'.spl
-0001d010: 6974 2829 290a 2020 2020 6465 6620 6172  it()).    def ar
-0001d020: 6773 5f61 6e64 5f6c 6f63 6b5f 6f72 6465  gs_and_lock_orde
-0001d030: 7228 7365 6c66 2c20 6d6f 636b 5f6c 6f63  r(self, mock_loc
-0001d040: 6b5f 6469 722c 2072 6571 7565 7374 2c20  k_dir, request, 
-0001d050: 746d 705f 7061 7468 293a 0a20 2020 2020  tmp_path):.     
-0001d060: 2020 2022 2222 5365 7473 2075 7020 4365     """Sets up Ce
-0001d070: 7274 626f 7420 7769 7468 2061 7267 7320  rtbot with args 
-0001d080: 616e 6420 6d6f 636b 7320 746f 2065 7272  and mocks to err
-0001d090: 6f72 2061 6674 6572 2061 6371 7569 7269  or after acquiri
-0001d0a0: 6e67 2074 6865 206c 6173 7420 6c6f 636b  ng the last lock
-0001d0b0: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-0001d0c0: 6669 7874 7572 6520 7969 656c 6473 2074  fixture yields t
-0001d0d0: 6865 2043 4c49 2061 7267 756d 656e 7473  he CLI arguments
-0001d0e0: 2074 6861 7420 7368 6f75 6c64 2062 6520   that should be 
-0001d0f0: 6769 7665 6e20 746f 2043 6572 7462 6f74  given to Certbot
-0001d100: 0a20 2020 2020 2020 2061 6e64 2074 6865  .        and the
-0001d110: 2065 7870 6563 7465 6420 6f72 6465 7220   expected order 
-0001d120: 6f66 2064 6972 6563 746f 7269 6573 2074  of directories t
-0001d130: 6f20 6265 206c 6f63 6b65 642e 2041 6e20  o be locked. An 
-0001d140: 6572 726f 7220 6973 2072 6169 7365 640a  error is raised.
-0001d150: 2020 2020 2020 2020 6166 7465 7220 6163          after ac
-0001d160: 7175 6972 696e 6720 7468 6520 6c61 7374  quiring the last
-0001d170: 206c 6f63 6b20 6a75 7374 2061 7320 6120   lock just as a 
-0001d180: 6d65 616e 7320 6f66 2073 746f 7070 696e  means of stoppin
-0001d190: 6720 4365 7274 626f 7427 730a 2020 2020  g Certbot's.    
-0001d1a0: 2020 2020 6578 6563 7574 696f 6e2e 0a0a      execution...
-0001d1b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001d1c0: 2020 2020 2320 7365 6c65 6374 2064 6972      # select dir
-0001d1d0: 6563 746f 7269 6573 0a20 2020 2020 2020  ectories.       
-0001d1e0: 2061 7574 6865 6e74 6963 6174 6f72 5f64   authenticator_d
-0001d1f0: 6972 203d 2073 7472 2874 6d70 5f70 6174  ir = str(tmp_pat
-0001d200: 6820 2f20 2761 7574 6865 6e74 6963 6174  h / 'authenticat
-0001d210: 6f72 2729 0a20 2020 2020 2020 2063 6f6e  or').        con
-0001d220: 6669 675f 6469 7220 3d20 7374 7228 746d  fig_dir = str(tm
-0001d230: 705f 7061 7468 202f 2027 636f 6e66 6967  p_path / 'config
-0001d240: 2729 0a20 2020 2020 2020 2069 6e73 7461  ').        insta
-0001d250: 6c6c 6572 5f64 6972 203d 2073 7472 2874  ller_dir = str(t
-0001d260: 6d70 5f70 6174 6820 2f20 2769 6e73 7461  mp_path / 'insta
-0001d270: 6c6c 6572 2729 0a20 2020 2020 2020 206c  ller').        l
-0001d280: 6f67 735f 6469 7220 3d20 7374 7228 746d  ogs_dir = str(tm
-0001d290: 705f 7061 7468 202f 2027 6c6f 6773 2729  p_path / 'logs')
-0001d2a0: 0a20 2020 2020 2020 2077 6f72 6b5f 6469  .        work_di
-0001d2b0: 7220 3d20 7374 7228 746d 705f 7061 7468  r = str(tmp_path
-0001d2c0: 202f 2027 776f 726b 2729 0a0a 2020 2020   / 'work')..    
-0001d2d0: 2020 2020 2320 7072 6570 6172 6520 6172      # prepare ar
-0001d2e0: 6773 2061 6e64 206c 696e 6561 6765 0a20  gs and lineage. 
-0001d2f0: 2020 2020 2020 2073 7562 636f 6d6d 616e         subcomman
-0001d300: 6420 3d20 7265 7175 6573 742e 7061 7261  d = request.para
-0001d310: 6d0a 2020 2020 2020 2020 6172 6773 203d  m.        args =
-0001d320: 205b 7375 6263 6f6d 6d61 6e64 2c20 272d   [subcommand, '-
-0001d330: 6127 2c20 2773 7461 6e64 616c 6f6e 6527  a', 'standalone'
-0001d340: 2c20 272d 6927 2c20 276e 756c 6c27 2c20  , '-i', 'null', 
-0001d350: 272d 2d6e 6f2d 7261 6e64 6f6d 2d73 6c65  '--no-random-sle
-0001d360: 6570 2d6f 6e2d 7265 6e65 7727 2c0a 2020  ep-on-renew',.  
-0001d370: 2020 2020 2020 2020 2020 2020 2020 272d                '-
-0001d380: 2d63 6f6e 6669 672d 6469 7227 2c20 636f  -config-dir', co
-0001d390: 6e66 6967 5f64 6972 2c20 272d 2d6c 6f67  nfig_dir, '--log
-0001d3a0: 732d 6469 7227 2c20 6c6f 6773 5f64 6972  s-dir', logs_dir
-0001d3b0: 2c20 272d 2d77 6f72 6b2d 6469 7227 2c0a  , '--work-dir',.
-0001d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3d0: 776f 726b 5f64 6972 5d0a 2020 2020 2020  work_dir].      
-0001d3e0: 2020 7465 7374 5f75 7469 6c2e 6d61 6b65    test_util.make
-0001d3f0: 5f6c 696e 6561 6765 2863 6f6e 6669 675f  _lineage(config_
-0001d400: 6469 722c 2027 7361 6d70 6c65 2d72 656e  dir, 'sample-ren
-0001d410: 6577 616c 2e63 6f6e 6627 290a 0a20 2020  ewal.conf')..   
-0001d420: 2020 2020 2077 6974 6820 7365 6c66 2e6d       with self.m
-0001d430: 6f63 6b5f 706c 7567 696e 5f70 7265 7061  ock_plugin_prepa
-0001d440: 7265 2861 7574 6865 6e74 6963 6174 6f72  re(authenticator
-0001d450: 5f64 6972 2c20 696e 7374 616c 6c65 725f  _dir, installer_
-0001d460: 6469 722c 206d 6f63 6b5f 6c6f 636b 5f64  dir, mock_lock_d
-0001d470: 6972 2c20 7375 6263 6f6d 6d61 6e64 293a  ir, subcommand):
-0001d480: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-0001d490: 6b5f 6f72 6465 7220 3d20 5b6c 6f67 735f  k_order = [logs_
-0001d4a0: 6469 722c 2063 6f6e 6669 675f 6469 722c  dir, config_dir,
-0001d4b0: 2077 6f72 6b5f 6469 722c 2069 6e73 7461   work_dir, insta
-0001d4c0: 6c6c 6572 5f64 6972 5d0a 2020 2020 2020  ller_dir].      
-0001d4d0: 2020 2020 2020 6966 2073 7562 636f 6d6d        if subcomm
-0001d4e0: 616e 6420 3d3d 2027 696e 7374 616c 6c27  and == 'install'
-0001d4f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d500: 2020 7969 656c 6420 6172 6773 2c20 6c6f    yield args, lo
-0001d510: 636b 5f6f 7264 6572 0a20 2020 2020 2020  ck_order.       
-0001d520: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001d530: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
-0001d540: 6578 7065 6374 2074 6865 2069 6e73 7461  expect the insta
-0001d550: 6c6c 6572 2074 6f20 6265 2070 7265 7061  ller to be prepa
-0001d560: 7265 6420 6576 656e 2066 6f72 2063 6572  red even for cer
-0001d570: 746f 6e6c 790a 2020 2020 2020 2020 2020  tonly.          
-0001d580: 2020 2020 2020 2320 6265 6361 7573 6520        # because 
-0001d590: 616e 2069 6e73 7461 6c6c 6572 2077 6173  an installer was
-0001d5a0: 2072 6571 7565 7374 6564 206f 6e20 7468   requested on th
-0001d5b0: 6520 636f 6d6d 616e 6420 6c69 6e65 2e0a  e command line..
-0001d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5d0: 7969 656c 6420 6172 6773 2c20 6c6f 636b  yield args, lock
-0001d5e0: 5f6f 7264 6572 202b 205b 6175 7468 656e  _order + [authen
-0001d5f0: 7469 6361 746f 725f 6469 725d 0a0a 2020  ticator_dir]..  
-0001d600: 2020 6465 6620 7465 7374 5f6c 6f63 6b5f    def test_lock_
-0001d610: 6f72 6465 7228 7365 6c66 2c20 6172 6773  order(self, args
-0001d620: 5f61 6e64 5f6c 6f63 6b5f 6f72 6465 722c  _and_lock_order,
-0001d630: 206d 6f63 6b5f 6c6f 636b 5f64 6972 293a   mock_lock_dir):
-0001d640: 0a20 2020 2020 2020 2061 7267 732c 206c  .        args, l
-0001d650: 6f63 6b5f 6f72 6465 7220 3d20 6172 6773  ock_order = args
-0001d660: 5f61 6e64 5f6c 6f63 6b5f 6f72 6465 720a  _and_lock_order.
-0001d670: 2020 2020 2020 2020 7769 7468 2070 7974          with pyt
-0001d680: 6573 742e 7261 6973 6573 2873 656c 662e  est.raises(self.
-0001d690: 4558 5045 4354 4544 5f45 5252 4f52 5f54  EXPECTED_ERROR_T
-0001d6a0: 5950 452c 206d 6174 6368 3d73 656c 662e  YPE, match=self.
-0001d6b0: 4558 5045 4354 4544 5f45 5252 4f52 5f53  EXPECTED_ERROR_S
-0001d6c0: 5452 5f52 4547 4558 293a 0a20 2020 2020  TR_REGEX):.     
-0001d6d0: 2020 2020 2020 206d 6169 6e2e 6d61 696e         main.main
-0001d6e0: 2861 7267 7329 0a20 2020 2020 2020 2061  (args).        a
-0001d6f0: 7373 6572 7420 6d6f 636b 5f6c 6f63 6b5f  ssert mock_lock_
-0001d700: 6469 722e 6361 6c6c 5f63 6f75 6e74 203d  dir.call_count =
-0001d710: 3d20 6c65 6e28 6c6f 636b 5f6f 7264 6572  = len(lock_order
-0001d720: 290a 2020 2020 2020 2020 666f 7220 6361  ).        for ca
-0001d730: 6c6c 2c20 6c6f 636b 6564 5f64 6972 2069  ll, locked_dir i
-0001d740: 6e20 7a69 7028 6d6f 636b 5f6c 6f63 6b5f  n zip(mock_lock_
-0001d750: 6469 722e 6361 6c6c 5f61 7267 735f 6c69  dir.call_args_li
-0001d760: 7374 2c20 6c6f 636b 5f6f 7264 6572 293a  st, lock_order):
-0001d770: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0001d780: 6572 7420 6361 6c6c 5b30 5d5b 305d 203d  ert call[0][0] =
-0001d790: 3d20 6c6f 636b 6564 5f64 6972 0a0a 0a69  = locked_dir...i
-0001d7a0: 6620 5f5f 6e61 6d65 5f5f 203d 3d20 275f  f __name__ == '_
-0001d7b0: 5f6d 6169 6e5f 5f27 3a0a 2020 2020 7379  _main__':.    sy
-0001d7c0: 732e 6578 6974 2870 7974 6573 742e 6d61  s.exit(pytest.ma
-0001d7d0: 696e 2873 7973 2e61 7267 765b 313a 5d20  in(sys.argv[1:] 
-0001d7e0: 2b20 5b5f 5f66 696c 655f 5f5d 2929 2020  + [__file__]))  
-0001d7f0: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
-0001d800: 6572 0a                                  er.
+000108d0: 2020 2020 6173 7365 7274 206e 6f74 2065      assert not e
+000108e0: 7272 6f72 5f65 7870 6563 7465 642c 2022  rror_expected, "
+000108f0: 7265 6e65 7761 6c20 7368 6f75 6c64 2068  renewal should h
+00010900: 6176 6520 6572 726f 7265 6422 0a20 2020  ave errored".   
+00010910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010920: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00010930: 6570 743a 2023 2070 796c 696e 743a 2064  ept: # pylint: d
+00010940: 6973 6162 6c65 3d62 6172 652d 6578 6365  isable=bare-exce
+00010950: 7074 0a20 2020 2020 2020 2020 2020 2020  pt.             
+00010960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010970: 2020 2020 2020 2069 6620 6e6f 7420 6572         if not er
+00010980: 726f 725f 6578 7065 6374 6564 3a0a 2020  ror_expected:.  
+00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109b0: 2020 2020 2020 7261 6973 6520 4173 7365        raise Asse
+000109c0: 7274 696f 6e45 7272 6f72 280a 2020 2020  rtionError(.    
+000109d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109f0: 2020 2020 2020 2020 2255 6e65 7870 6563          "Unexpec
+00010a00: 7465 6420 7265 6e65 7761 6c20 6572 726f  ted renewal erro
+00010a10: 723a 5c6e 2220 2b0a 2020 2020 2020 2020  r:\n" +.        
+00010a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a40: 2020 2020 7472 6163 6562 6163 6b2e 666f      traceback.fo
+00010a50: 726d 6174 5f65 7863 2829 290a 0a20 2020  rmat_exc())..   
+00010a60: 2020 2020 2020 2020 2069 6620 7368 6f75           if shou
+00010a70: 6c64 5f72 656e 6577 3a0a 2020 2020 2020  ld_renew:.      
+00010a80: 2020 2020 2020 2020 2020 6966 2072 6575            if reu
+00010a90: 7365 5f6b 6579 2061 6e64 206e 6f74 206e  se_key and not n
+00010aa0: 6577 5f6b 6579 3a0a 2020 2020 2020 2020  ew_key:.        
+00010ab0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+00010ac0: 6520 6c6f 6361 7469 6f6e 206f 6620 7468  e location of th
+00010ad0: 6520 7072 6576 696f 7573 206c 6976 6520  e previous live 
+00010ae0: 7072 6976 6b65 792e 7065 6d20 6973 2070  privkey.pem is p
+00010af0: 6173 7365 640a 2020 2020 2020 2020 2020  assed.          
+00010b00: 2020 2020 2020 2020 2020 2320 746f 206f            # to o
+00010b10: 6274 6169 6e5f 6365 7274 6966 6963 6174  btain_certificat
+00010b20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00010b30: 2020 2020 2020 6d6f 636b 5f63 6c69 656e        mock_clien
+00010b40: 742e 6f62 7461 696e 5f63 6572 7469 6669  t.obtain_certifi
+00010b50: 6361 7465 2e61 7373 6572 745f 6361 6c6c  cate.assert_call
+00010b60: 6564 5f6f 6e63 655f 7769 7468 285b 6d6f  ed_once_with([mo
+00010b70: 636b 2e41 4e59 5d2c 0a20 2020 2020 2020  ck.ANY],.       
+00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b90: 206f 732e 7061 7468 2e6e 6f72 6d70 6174   os.path.normpat
+00010ba0: 6828 6f73 2e70 6174 682e 6a6f 696e 280a  h(os.path.join(.
+00010bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010bd0: 2e63 6f6e 6669 672e 636f 6e66 6967 5f64  .config.config_d
+00010be0: 6972 2c20 226c 6976 652f 7361 6d70 6c65  ir, "live/sample
+00010bf0: 2d72 656e 6577 616c 2f70 7269 766b 6579  -renewal/privkey
+00010c00: 2e70 656d 2229 2929 0a20 2020 2020 2020  .pem"))).       
+00010c10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00010c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c30: 2020 206d 6f63 6b5f 636c 6965 6e74 2e6f     mock_client.o
+00010c40: 6274 6169 6e5f 6365 7274 6966 6963 6174  btain_certificat
+00010c50: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
+00010c60: 6f6e 6365 5f77 6974 6828 5b6d 6f63 6b2e  once_with([mock.
+00010c70: 414e 595d 2c20 4e6f 6e65 290a 2020 2020  ANY], None).    
+00010c80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00010c90: 2020 2020 2020 2020 2020 2020 2020 6173                as
+00010ca0: 7365 7274 206d 6f63 6b5f 636c 6965 6e74  sert mock_client
+00010cb0: 2e6f 6274 6169 6e5f 6365 7274 6966 6963  .obtain_certific
+00010cc0: 6174 652e 6361 6c6c 5f63 6f75 6e74 203d  ate.call_count =
+00010cd0: 3d20 300a 2020 2020 2020 2020 6578 6365  = 0.        exce
+00010ce0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00010cf0: 7365 6c66 2e5f 6475 6d70 5f6c 6f67 2829  self._dump_log()
+00010d00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010d10: 7365 0a20 2020 2020 2020 2066 696e 616c  se.        final
+00010d20: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+00010d30: 6966 206c 6f67 5f6f 7574 3a0a 2020 2020  if log_out:.    
+00010d40: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00010d50: 206f 7065 6e28 6f73 2e70 6174 682e 6a6f   open(os.path.jo
+00010d60: 696e 2873 656c 662e 636f 6e66 6967 2e6c  in(self.config.l
+00010d70: 6f67 735f 6469 722c 2022 6c65 7473 656e  ogs_dir, "letsen
+00010d80: 6372 7970 742e 6c6f 6722 2929 2061 7320  crypt.log")) as 
+00010d90: 6c66 3a0a 2020 2020 2020 2020 2020 2020  lf:.            
+00010da0: 2020 2020 2020 2020 6173 7365 7274 206c          assert l
+00010db0: 6f67 5f6f 7574 2069 6e20 6c66 2e72 6561  og_out in lf.rea
+00010dc0: 6428 290a 0a20 2020 2020 2020 2072 6574  d()..        ret
+00010dd0: 7572 6e20 6d6f 636b 5f6c 696e 6561 6765  urn mock_lineage
+00010de0: 2c20 6d6f 636b 5f64 6973 706c 6179 2c20  , mock_display, 
+00010df0: 7374 646f 7574 0a0a 2020 2020 406d 6f63  stdout..    @moc
+00010e00: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+00010e10: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00010e20: 5f72 6570 6f72 745f 6e65 775f 6365 7274  _report_new_cert
+00010e30: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+00010e40: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00010e50: 6572 6e61 6c2e 6d61 696e 2e75 7469 6c2e  ernal.main.util.
+00010e60: 6174 6578 6974 5f72 6567 6973 7465 7227  atexit_register'
+00010e70: 290a 2020 2020 406d 6f63 6b2e 7061 7463  ).    @mock.patc
+00010e80: 6828 2763 6572 7462 6f74 2e63 7279 7074  h('certbot.crypt
+00010e90: 6f5f 7574 696c 2e6e 6f74 4166 7465 7227  o_util.notAfter'
+00010ea0: 290a 2020 2020 6465 6620 7465 7374 5f63  ).    def test_c
+00010eb0: 6572 746f 6e6c 795f 7265 6e65 7761 6c28  ertonly_renewal(
+00010ec0: 7365 6c66 2c20 5f2c 206d 6f63 6b5f 7265  self, _, mock_re
+00010ed0: 6769 7374 6572 2c20 6d6f 636b 5f72 6570  gister, mock_rep
+00010ee0: 6f72 7429 3a0a 2020 2020 2020 2020 6c69  ort):.        li
+00010ef0: 6e65 6167 652c 205f 2c20 5f20 3d20 7365  neage, _, _ = se
+00010f00: 6c66 2e5f 7465 7374 5f72 656e 6577 616c  lf._test_renewal
+00010f10: 5f63 6f6d 6d6f 6e28 5472 7565 2c20 5b5d  _common(True, []
+00010f20: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00010f30: 206c 696e 6561 6765 2e73 6176 655f 7375   lineage.save_su
+00010f40: 6363 6573 736f 722e 6361 6c6c 5f63 6f75  ccessor.call_cou
+00010f50: 6e74 203d 3d20 310a 2020 2020 2020 2020  nt == 1.        
+00010f60: 6c69 6e65 6167 652e 7570 6461 7465 5f61  lineage.update_a
+00010f70: 6c6c 5f6c 696e 6b73 5f74 6f2e 6173 7365  ll_links_to.asse
+00010f80: 7274 5f63 616c 6c65 645f 6f6e 6365 5f77  rt_called_once_w
+00010f90: 6974 6828 0a20 2020 2020 2020 2020 2020  ith(.           
+00010fa0: 206c 696e 6561 6765 2e6c 6174 6573 745f   lineage.latest_
+00010fb0: 636f 6d6d 6f6e 5f76 6572 7369 6f6e 2829  common_version()
+00010fc0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00010fd0: 206d 6f63 6b5f 7265 706f 7274 2e63 616c   mock_report.cal
+00010fe0: 6c5f 636f 756e 7420 3d3d 2031 0a20 2020  l_count == 1.   
+00010ff0: 2020 2020 2061 7373 6572 7420 2766 756c       assert 'ful
+00011000: 6c63 6861 696e 2e70 656d 2720 696e 206d  lchain.pem' in m
+00011010: 6f63 6b5f 7265 706f 7274 2e63 616c 6c5f  ock_report.call_
+00011020: 6172 6773 5b30 5d5b 325d 0a20 2020 2020  args[0][2].     
+00011030: 2020 2061 7373 6572 7420 2764 6f6e 6174     assert 'donat
+00011040: 6527 2069 6e20 6d6f 636b 5f72 6567 6973  e' in mock_regis
+00011050: 7465 722e 6361 6c6c 5f61 7267 735b 305d  ter.call_args[0]
+00011060: 5b31 5d0a 0a20 2020 2040 6d6f 636b 2e70  [1]..    @mock.p
+00011070: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+00011080: 6e74 6572 6e61 6c2e 6d61 696e 2e64 6973  nternal.main.dis
+00011090: 706c 6179 5f75 7469 6c2e 6e6f 7469 6679  play_util.notify
+000110a0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+000110b0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+000110c0: 6572 6e61 6c2e 6c6f 672e 6c6f 6767 696e  ernal.log.loggin
+000110d0: 672e 6861 6e64 6c65 7273 2e52 6f74 6174  g.handlers.Rotat
+000110e0: 696e 6746 696c 6548 616e 646c 6572 2e64  ingFileHandler.d
+000110f0: 6f52 6f6c 6c6f 7665 7227 290a 2020 2020  oRollover').    
+00011100: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00011110: 7462 6f74 2e63 7279 7074 6f5f 7574 696c  tbot.crypto_util
+00011120: 2e6e 6f74 4166 7465 7227 290a 2020 2020  .notAfter').    
+00011130: 6465 6620 7465 7374 5f63 6572 746f 6e6c  def test_certonl
+00011140: 795f 7265 6e65 7761 6c5f 7472 6967 6765  y_renewal_trigge
+00011150: 7273 2873 656c 662c 205f 2c20 5f5f 2c20  rs(self, _, __, 
+00011160: 6d6f 636b 5f6e 6f74 6966 7929 3a0a 2020  mock_notify):.  
+00011170: 2020 2020 2020 2320 2d2d 6472 792d 7275        # --dry-ru
+00011180: 6e20 7368 6f75 6c64 2066 6f72 6365 2072  n should force r
+00011190: 656e 6577 616c 0a20 2020 2020 2020 205f  enewal.        _
+000111a0: 2c20 5f2c 205f 203d 2073 656c 662e 5f74  , _, _ = self._t
+000111b0: 6573 745f 7265 6e65 7761 6c5f 636f 6d6d  est_renewal_comm
+000111c0: 6f6e 2846 616c 7365 2c20 5b27 2d2d 6472  on(False, ['--dr
+000111d0: 792d 7275 6e27 2c20 272d 2d6b 6565 7027  y-run', '--keep'
+000111e0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+000111f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011210: 2020 2020 2020 2020 206c 6f67 5f6f 7574           log_out
+00011220: 3d22 7369 6d75 6c61 7469 6e67 2072 656e  ="simulating ren
+00011230: 6577 616c 2229 0a20 2020 2020 2020 206d  ewal").        m
+00011240: 6f63 6b5f 6e6f 7469 6679 2e61 7373 6572  ock_notify.asser
+00011250: 745f 616e 795f 6361 6c6c 2827 5468 6520  t_any_call('The 
+00011260: 6472 7920 7275 6e20 7761 7320 7375 6363  dry run was succ
+00011270: 6573 7366 756c 2e27 290a 0a20 2020 2020  essful.')..     
+00011280: 2020 2073 656c 662e 5f74 6573 745f 7265     self._test_re
+00011290: 6e65 7761 6c5f 636f 6d6d 6f6e 2846 616c  newal_common(Fal
+000112a0: 7365 2c20 5b27 2d2d 7265 6e65 772d 6279  se, ['--renew-by
+000112b0: 2d64 6566 6175 6c74 272c 2027 2d74 7676  -default', '-tvv
+000112c0: 272c 2027 2d2d 6465 6275 6727 5d2c 0a20  ', '--debug'],. 
+000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112f0: 206c 6f67 5f6f 7574 3d22 4175 746f 2d72   log_out="Auto-r
+00011300: 656e 6577 616c 2066 6f72 6365 6422 290a  enewal forced").
+00011310: 0a20 2020 2020 2020 205f 2c20 6d6f 636b  .        _, mock
+00011320: 5f64 6973 706c 6179 6572 2c20 5f20 3d20  _displayer, _ = 
+00011330: 7365 6c66 2e5f 7465 7374 5f72 656e 6577  self._test_renew
+00011340: 616c 5f63 6f6d 6d6f 6e28 4661 6c73 652c  al_common(False,
+00011350: 205b 272d 7476 7627 2c20 272d 2d64 6562   ['-tvv', '--deb
+00011360: 7567 272c 2027 2d2d 6b65 6570 275d 2c0a  ug', '--keep'],.
+00011370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011390: 2020 7368 6f75 6c64 5f72 656e 6577 3d46    should_renew=F
+000113a0: 616c 7365 290a 2020 2020 2020 2020 6173  alse).        as
+000113b0: 7365 7274 2027 6e6f 7420 7965 7420 6475  sert 'not yet du
+000113c0: 6527 2069 6e20 6d6f 636b 5f64 6973 706c  e' in mock_displ
+000113d0: 6179 6572 2829 2e6e 6f74 6966 6963 6174  ayer().notificat
+000113e0: 696f 6e2e 6361 6c6c 5f61 7267 735b 305d  ion.call_args[0]
+000113f0: 5b30 5d0a 0a20 2020 2064 6566 205f 6475  [0]..    def _du
+00011400: 6d70 5f6c 6f67 2873 656c 6629 3a0a 2020  mp_log(self):.  
+00011410: 2020 2020 2020 7072 696e 7428 224c 6f67        print("Log
+00011420: 733a 2229 0a20 2020 2020 2020 206c 6f67  s:").        log
+00011430: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+00011440: 6a6f 696e 2873 656c 662e 636f 6e66 6967  join(self.config
+00011450: 2e6c 6f67 735f 6469 722c 2022 6c65 7473  .logs_dir, "lets
+00011460: 656e 6372 7970 742e 6c6f 6722 290a 2020  encrypt.log").  
+00011470: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00011480: 2e65 7869 7374 7328 6c6f 675f 7061 7468  .exists(log_path
+00011490: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+000114a0: 6974 6820 6f70 656e 286c 6f67 5f70 6174  ith open(log_pat
+000114b0: 6829 2061 7320 6c66 3a0a 2020 2020 2020  h) as lf:.      
+000114c0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000114d0: 6c66 2e72 6561 6428 2929 0a0a 2020 2020  lf.read())..    
+000114e0: 6465 6620 7465 7374 5f72 656e 6577 5f76  def test_renew_v
+000114f0: 6572 6228 7365 6c66 293a 0a20 2020 2020  erb(self):.     
+00011500: 2020 2074 6573 745f 7574 696c 2e6d 616b     test_util.mak
+00011510: 655f 6c69 6e65 6167 6528 7365 6c66 2e63  e_lineage(self.c
+00011520: 6f6e 6669 672e 636f 6e66 6967 5f64 6972  onfig.config_dir
+00011530: 2c20 2773 616d 706c 652d 7265 6e65 7761  , 'sample-renewa
+00011540: 6c2e 636f 6e66 2729 0a20 2020 2020 2020  l.conf').       
+00011550: 2061 7267 7320 3d20 5b22 7265 6e65 7722   args = ["renew"
+00011560: 2c20 222d 2d64 7279 2d72 756e 222c 2022  , "--dry-run", "
+00011570: 2d74 7676 225d 0a20 2020 2020 2020 2073  -tvv"].        s
+00011580: 656c 662e 5f74 6573 745f 7265 6e65 7761  elf._test_renewa
+00011590: 6c5f 636f 6d6d 6f6e 2854 7275 652c 205b  l_common(True, [
+000115a0: 5d2c 2061 7267 733d 6172 6773 2c20 7368  ], args=args, sh
+000115b0: 6f75 6c64 5f72 656e 6577 3d54 7275 6529  ould_renew=True)
+000115c0: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
+000115d0: 6575 7365 5f6b 6579 2873 656c 6629 3a0a  euse_key(self):.
+000115e0: 2020 2020 2020 2020 7465 7374 5f75 7469          test_uti
+000115f0: 6c2e 6d61 6b65 5f6c 696e 6561 6765 2873  l.make_lineage(s
+00011600: 656c 662e 636f 6e66 6967 2e63 6f6e 6669  elf.config.confi
+00011610: 675f 6469 722c 2027 7361 6d70 6c65 2d72  g_dir, 'sample-r
+00011620: 656e 6577 616c 2e63 6f6e 6627 2c20 6563  enewal.conf', ec
+00011630: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00011640: 6172 6773 203d 205b 2272 656e 6577 222c  args = ["renew",
+00011650: 2022 2d2d 6472 792d 7275 6e22 2c20 222d   "--dry-run", "-
+00011660: 2d72 6575 7365 2d6b 6579 225d 0a20 2020  -reuse-key"].   
+00011670: 2020 2020 2073 656c 662e 5f74 6573 745f       self._test_
+00011680: 7265 6e65 7761 6c5f 636f 6d6d 6f6e 2854  renewal_common(T
+00011690: 7275 652c 205b 5d2c 2061 7267 733d 6172  rue, [], args=ar
+000116a0: 6773 2c20 7368 6f75 6c64 5f72 656e 6577  gs, should_renew
+000116b0: 3d54 7275 652c 2072 6575 7365 5f6b 6579  =True, reuse_key
+000116c0: 3d54 7275 6529 0a0a 2020 2020 406d 6f63  =True)..    @moc
+000116d0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+000116e0: 2e5f 696e 7465 726e 616c 2e73 746f 7261  ._internal.stora
+000116f0: 6765 2e52 656e 6577 6162 6c65 4365 7274  ge.RenewableCert
+00011700: 2e73 6176 655f 7375 6363 6573 736f 7227  .save_successor'
+00011710: 290a 2020 2020 6465 6620 7465 7374 5f72  ).    def test_r
+00011720: 6575 7365 5f6b 6579 5f6e 6f5f 6472 795f  euse_key_no_dry_
+00011730: 7275 6e28 7365 6c66 2c20 756e 7573 6564  run(self, unused
+00011740: 5f73 6176 655f 7375 6363 6573 736f 7229  _save_successor)
+00011750: 3a0a 2020 2020 2020 2020 7465 7374 5f75  :.        test_u
+00011760: 7469 6c2e 6d61 6b65 5f6c 696e 6561 6765  til.make_lineage
+00011770: 2873 656c 662e 636f 6e66 6967 2e63 6f6e  (self.config.con
+00011780: 6669 675f 6469 722c 2027 7361 6d70 6c65  fig_dir, 'sample
+00011790: 2d72 656e 6577 616c 2e63 6f6e 6627 2c20  -renewal.conf', 
+000117a0: 6563 3d46 616c 7365 290a 2020 2020 2020  ec=False).      
+000117b0: 2020 6172 6773 203d 205b 2272 656e 6577    args = ["renew
+000117c0: 222c 2022 2d2d 7265 7573 652d 6b65 7922  ", "--reuse-key"
+000117d0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+000117e0: 7465 7374 5f72 656e 6577 616c 5f63 6f6d  test_renewal_com
+000117f0: 6d6f 6e28 5472 7565 2c20 5b5d 2c20 6172  mon(True, [], ar
+00011800: 6773 3d61 7267 732c 2073 686f 756c 645f  gs=args, should_
+00011810: 7265 6e65 773d 5472 7565 2c20 7265 7573  renew=True, reus
+00011820: 655f 6b65 793d 5472 7565 290a 0a20 2020  e_key=True)..   
+00011830: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00011840: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00011850: 7374 6f72 6167 652e 5265 6e65 7761 626c  storage.Renewabl
+00011860: 6543 6572 742e 7361 7665 5f73 7563 6365  eCert.save_succe
+00011870: 7373 6f72 2729 0a20 2020 2064 6566 2074  ssor').    def t
+00011880: 6573 745f 6e65 775f 6b65 7928 7365 6c66  est_new_key(self
+00011890: 2c20 756e 7573 6564 5f73 6176 655f 7375  , unused_save_su
+000118a0: 6363 6573 736f 7229 3a0a 2020 2020 2020  ccessor):.      
+000118b0: 2020 7465 7374 5f75 7469 6c2e 6d61 6b65    test_util.make
+000118c0: 5f6c 696e 6561 6765 2873 656c 662e 636f  _lineage(self.co
+000118d0: 6e66 6967 2e63 6f6e 6669 675f 6469 722c  nfig.config_dir,
+000118e0: 2027 7361 6d70 6c65 2d72 656e 6577 616c   'sample-renewal
+000118f0: 2e63 6f6e 6627 290a 2020 2020 2020 2020  .conf').        
+00011900: 6172 6773 203d 205b 2272 656e 6577 222c  args = ["renew",
+00011910: 2022 2d2d 7265 7573 652d 6b65 7922 2c20   "--reuse-key", 
+00011920: 222d 2d6e 6577 2d6b 6579 225d 0a20 2020  "--new-key"].   
+00011930: 2020 2020 2073 656c 662e 5f74 6573 745f       self._test_
+00011940: 7265 6e65 7761 6c5f 636f 6d6d 6f6e 2854  renewal_common(T
+00011950: 7275 652c 205b 5d2c 2061 7267 733d 6172  rue, [], args=ar
+00011960: 6773 2c20 7368 6f75 6c64 5f72 656e 6577  gs, should_renew
+00011970: 3d54 7275 652c 2072 6575 7365 5f6b 6579  =True, reuse_key
+00011980: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+00011990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119a0: 2020 2020 2020 2020 206e 6577 5f6b 6579           new_key
+000119b0: 3d54 7275 6529 0a0a 2020 2020 406d 6f63  =True)..    @moc
+000119c0: 6b2e 7061 7463 6828 2773 7973 2e73 7464  k.patch('sys.std
+000119d0: 696e 2729 0a20 2020 2064 6566 2074 6573  in').    def tes
+000119e0: 745f 6e6f 6e69 6e74 6572 6163 7469 7665  t_noninteractive
+000119f0: 5f72 656e 6577 616c 5f64 656c 6179 2873  _renewal_delay(s
+00011a00: 656c 662c 2073 7464 696e 293a 0a20 2020  elf, stdin):.   
+00011a10: 2020 2020 2073 7464 696e 2e69 7361 7474       stdin.isatt
+00011a20: 792e 7265 7475 726e 5f76 616c 7565 203d  y.return_value =
+00011a30: 2046 616c 7365 0a20 2020 2020 2020 2074   False.        t
+00011a40: 6573 745f 7574 696c 2e6d 616b 655f 6c69  est_util.make_li
+00011a50: 6e65 6167 6528 7365 6c66 2e63 6f6e 6669  neage(self.confi
+00011a60: 672e 636f 6e66 6967 5f64 6972 2c20 2773  g.config_dir, 's
+00011a70: 616d 706c 652d 7265 6e65 7761 6c2e 636f  ample-renewal.co
+00011a80: 6e66 2729 0a20 2020 2020 2020 2061 7267  nf').        arg
+00011a90: 7320 3d20 5b22 7265 6e65 7722 2c20 222d  s = ["renew", "-
+00011aa0: 2d64 7279 2d72 756e 222c 2022 2d74 7676  -dry-run", "-tvv
+00011ab0: 225d 0a20 2020 2020 2020 2073 656c 662e  "].        self.
+00011ac0: 5f74 6573 745f 7265 6e65 7761 6c5f 636f  _test_renewal_co
+00011ad0: 6d6d 6f6e 2854 7275 652c 205b 5d2c 2061  mmon(True, [], a
+00011ae0: 7267 733d 6172 6773 2c20 7368 6f75 6c64  rgs=args, should
+00011af0: 5f72 656e 6577 3d54 7275 6529 0a20 2020  _renew=True).   
+00011b00: 2020 2020 2061 7373 6572 7420 7365 6c66       assert self
+00011b10: 2e6d 6f63 6b5f 736c 6565 702e 6361 6c6c  .mock_sleep.call
+00011b20: 5f63 6f75 6e74 203d 3d20 310a 2020 2020  _count == 1.    
+00011b30: 2020 2020 2320 696e 206d 6169 6e2e 7079      # in main.py
+00011b40: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
+00011b50: 736c 6565 705f 7469 6d65 203d 2072 616e  sleep_time = ran
+00011b60: 646f 6d2e 7261 6e64 696e 7428 312c 2036  dom.randint(1, 6
+00011b70: 302a 3829 0a20 2020 2020 2020 2073 6c65  0*8).        sle
+00011b80: 6570 5f63 616c 6c5f 6172 6720 3d20 7365  ep_call_arg = se
+00011b90: 6c66 2e6d 6f63 6b5f 736c 6565 702e 6361  lf.mock_sleep.ca
+00011ba0: 6c6c 5f61 7267 735b 305d 5b30 5d0a 2020  ll_args[0][0].  
+00011bb0: 2020 2020 2020 6173 7365 7274 2031 203c        assert 1 <
+00011bc0: 3d20 736c 6565 705f 6361 6c6c 5f61 7267  = sleep_call_arg
+00011bd0: 203c 3d20 3630 2a38 0a0a 2020 2020 406d   <= 60*8..    @m
+00011be0: 6f63 6b2e 7061 7463 6828 2773 7973 2e73  ock.patch('sys.s
+00011bf0: 7464 696e 2729 0a20 2020 2064 6566 2074  tdin').    def t
+00011c00: 6573 745f 696e 7465 7261 6374 6976 655f  est_interactive_
+00011c10: 6e6f 5f72 656e 6577 616c 5f64 656c 6179  no_renewal_delay
+00011c20: 2873 656c 662c 2073 7464 696e 293a 0a20  (self, stdin):. 
+00011c30: 2020 2020 2020 2073 7464 696e 2e69 7361         stdin.isa
+00011c40: 7474 792e 7265 7475 726e 5f76 616c 7565  tty.return_value
+00011c50: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00011c60: 7465 7374 5f75 7469 6c2e 6d61 6b65 5f6c  test_util.make_l
+00011c70: 696e 6561 6765 2873 656c 662e 636f 6e66  ineage(self.conf
+00011c80: 6967 2e63 6f6e 6669 675f 6469 722c 2027  ig.config_dir, '
+00011c90: 7361 6d70 6c65 2d72 656e 6577 616c 2e63  sample-renewal.c
+00011ca0: 6f6e 6627 290a 2020 2020 2020 2020 6172  onf').        ar
+00011cb0: 6773 203d 205b 2272 656e 6577 222c 2022  gs = ["renew", "
+00011cc0: 2d2d 6472 792d 7275 6e22 2c20 222d 7476  --dry-run", "-tv
+00011cd0: 7622 5d0a 2020 2020 2020 2020 7365 6c66  v"].        self
+00011ce0: 2e5f 7465 7374 5f72 656e 6577 616c 5f63  ._test_renewal_c
+00011cf0: 6f6d 6d6f 6e28 5472 7565 2c20 5b5d 2c20  ommon(True, [], 
+00011d00: 6172 6773 3d61 7267 732c 2073 686f 756c  args=args, shoul
+00011d10: 645f 7265 6e65 773d 5472 7565 290a 2020  d_renew=True).  
+00011d20: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
+00011d30: 662e 6d6f 636b 5f73 6c65 6570 2e63 616c  f.mock_sleep.cal
+00011d40: 6c5f 636f 756e 7420 3d3d 2030 0a0a 2020  l_count == 0..  
+00011d50: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+00011d60: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00011d70: 2e72 656e 6577 616c 2e73 686f 756c 645f  .renewal.should_
+00011d80: 7265 6e65 7727 290a 2020 2020 6465 6620  renew').    def 
+00011d90: 7465 7374 5f72 656e 6577 5f73 6b69 7073  test_renew_skips
+00011da0: 5f72 6563 656e 745f 6365 7274 7328 7365  _recent_certs(se
+00011db0: 6c66 2c20 7368 6f75 6c64 5f72 656e 6577  lf, should_renew
+00011dc0: 293a 0a20 2020 2020 2020 2073 686f 756c  ):.        shoul
+00011dd0: 645f 7265 6e65 772e 7265 7475 726e 5f76  d_renew.return_v
+00011de0: 616c 7565 203d 2046 616c 7365 0a20 2020  alue = False.   
+00011df0: 2020 2020 2074 6573 745f 7574 696c 2e6d       test_util.m
+00011e00: 616b 655f 6c69 6e65 6167 6528 7365 6c66  ake_lineage(self
+00011e10: 2e63 6f6e 6669 672e 636f 6e66 6967 5f64  .config.config_d
+00011e20: 6972 2c20 2773 616d 706c 652d 7265 6e65  ir, 'sample-rene
+00011e30: 7761 6c2e 636f 6e66 2729 0a20 2020 2020  wal.conf').     
+00011e40: 2020 2065 7870 6972 7920 3d20 6461 7465     expiry = date
+00011e50: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
+00011e60: 7728 2920 2b20 6461 7465 7469 6d65 2e74  w() + datetime.t
+00011e70: 696d 6564 656c 7461 2864 6179 733d 3930  imedelta(days=90
+00011e80: 290a 2020 2020 2020 2020 5f2c 205f 2c20  ).        _, _, 
+00011e90: 7374 646f 7574 203d 2073 656c 662e 5f74  stdout = self._t
+00011ea0: 6573 745f 7265 6e65 7761 6c5f 636f 6d6d  est_renewal_comm
+00011eb0: 6f6e 2846 616c 7365 2c20 6578 7472 615f  on(False, extra_
+00011ec0: 6172 6773 3d4e 6f6e 652c 2073 686f 756c  args=None, shoul
+00011ed0: 645f 7265 6e65 773d 4661 6c73 652c 0a20  d_renew=False,. 
+00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f10: 6172 6773 3d5b 2772 656e 6577 275d 2c20  args=['renew'], 
+00011f20: 6578 7069 7279 5f64 6174 653d 6578 7069  expiry_date=expi
+00011f30: 7279 290a 2020 2020 2020 2020 6173 7365  ry).        asse
+00011f40: 7274 2027 4e6f 2072 656e 6577 616c 7320  rt 'No renewals 
+00011f50: 7765 7265 2061 7474 656d 7074 6564 2e27  were attempted.'
+00011f60: 2069 6e20 7374 646f 7574 2e67 6574 7661   in stdout.getva
+00011f70: 6c75 6528 290a 2020 2020 2020 2020 6173  lue().        as
+00011f80: 7365 7274 2027 5468 6520 666f 6c6c 6f77  sert 'The follow
+00011f90: 696e 6720 6365 7274 6966 6963 6174 6573  ing certificates
+00011fa0: 2061 7265 206e 6f74 2064 7565 2066 6f72   are not due for
+00011fb0: 2072 656e 6577 616c 2079 6574 3a27 2069   renewal yet:' i
+00011fc0: 6e20 7374 646f 7574 2e67 6574 7661 6c75  n stdout.getvalu
+00011fd0: 6528 290a 0a20 2020 2040 6d6f 636b 2e70  e()..    @mock.p
+00011fe0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+00011ff0: 6e74 6572 6e61 6c2e 6c6f 672e 706f 7374  nternal.log.post
+00012000: 5f61 7267 5f70 6172 7365 5f73 6574 7570  _arg_parse_setup
+00012010: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
+00012020: 7175 6965 745f 7265 6e65 7728 7365 6c66  quiet_renew(self
+00012030: 2c20 5f29 3a0a 2020 2020 2020 2020 7465  , _):.        te
+00012040: 7374 5f75 7469 6c2e 6d61 6b65 5f6c 696e  st_util.make_lin
+00012050: 6561 6765 2873 656c 662e 636f 6e66 6967  eage(self.config
+00012060: 2e63 6f6e 6669 675f 6469 722c 2027 7361  .config_dir, 'sa
+00012070: 6d70 6c65 2d72 656e 6577 616c 2e63 6f6e  mple-renewal.con
+00012080: 6627 290a 2020 2020 2020 2020 6172 6773  f').        args
+00012090: 203d 205b 2272 656e 6577 222c 2022 2d2d   = ["renew", "--
+000120a0: 6472 792d 7275 6e22 5d0a 2020 2020 2020  dry-run"].      
+000120b0: 2020 5f2c 205f 2c20 7374 646f 7574 203d    _, _, stdout =
+000120c0: 2073 656c 662e 5f74 6573 745f 7265 6e65   self._test_rene
+000120d0: 7761 6c5f 636f 6d6d 6f6e 2854 7275 652c  wal_common(True,
+000120e0: 205b 5d2c 2061 7267 733d 6172 6773 2c20   [], args=args, 
+000120f0: 7368 6f75 6c64 5f72 656e 6577 3d54 7275  should_renew=Tru
+00012100: 6529 0a20 2020 2020 2020 206f 7574 203d  e).        out =
+00012110: 2073 7464 6f75 742e 6765 7476 616c 7565   stdout.getvalue
+00012120: 2829 0a20 2020 2020 2020 2061 7373 6572  ().        asser
+00012130: 7420 2272 656e 6577 2220 696e 206f 7574  t "renew" in out
+00012140: 0a0a 2020 2020 2020 2020 6172 6773 203d  ..        args =
+00012150: 205b 2272 656e 6577 222c 2022 2d2d 6472   ["renew", "--dr
+00012160: 792d 7275 6e22 2c20 222d 7122 5d0a 2020  y-run", "-q"].  
+00012170: 2020 2020 2020 5f2c 205f 2c20 7374 646f        _, _, stdo
+00012180: 7574 203d 2073 656c 662e 5f74 6573 745f  ut = self._test_
+00012190: 7265 6e65 7761 6c5f 636f 6d6d 6f6e 2854  renewal_common(T
+000121a0: 7275 652c 205b 5d2c 2061 7267 733d 6172  rue, [], args=ar
+000121b0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+000121c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121e0: 2020 2020 2073 686f 756c 645f 7265 6e65       should_rene
+000121f0: 773d 5472 7565 2c20 7175 6965 745f 6d6f  w=True, quiet_mo
+00012200: 6465 3d54 7275 6529 0a20 2020 2020 2020  de=True).       
+00012210: 206f 7574 203d 2073 7464 6f75 742e 6765   out = stdout.ge
+00012220: 7476 616c 7565 2829 0a20 2020 2020 2020  tvalue().       
+00012230: 2061 7373 6572 7420 2222 203d 3d20 6f75   assert "" == ou
+00012240: 740a 0a20 2020 2064 6566 2074 6573 745f  t..    def test_
+00012250: 7265 6e65 775f 686f 6f6b 5f76 616c 6964  renew_hook_valid
+00012260: 6174 696f 6e28 7365 6c66 293a 0a20 2020  ation(self):.   
+00012270: 2020 2020 2074 6573 745f 7574 696c 2e6d       test_util.m
+00012280: 616b 655f 6c69 6e65 6167 6528 7365 6c66  ake_lineage(self
+00012290: 2e63 6f6e 6669 672e 636f 6e66 6967 5f64  .config.config_d
+000122a0: 6972 2c20 2773 616d 706c 652d 7265 6e65  ir, 'sample-rene
+000122b0: 7761 6c2e 636f 6e66 2729 0a20 2020 2020  wal.conf').     
+000122c0: 2020 2061 7267 7320 3d20 5b22 7265 6e65     args = ["rene
+000122d0: 7722 2c20 222d 2d64 7279 2d72 756e 222c  w", "--dry-run",
+000122e0: 2022 2d2d 706f 7374 2d68 6f6f 6b3d 6e6f   "--post-hook=no
+000122f0: 2d73 7563 682d 636f 6d6d 616e 6422 5d0a  -such-command"].
+00012300: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
+00012310: 7374 5f72 656e 6577 616c 5f63 6f6d 6d6f  st_renewal_commo
+00012320: 6e28 5472 7565 2c20 5b5d 2c20 6172 6773  n(True, [], args
+00012330: 3d61 7267 732c 2073 686f 756c 645f 7265  =args, should_re
+00012340: 6e65 773d 4661 6c73 652c 0a20 2020 2020  new=False,.     
+00012350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012360: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00012370: 6f72 5f65 7870 6563 7465 643d 5472 7565  or_expected=True
+00012380: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00012390: 7265 6e65 775f 6e6f 5f68 6f6f 6b5f 7661  renew_no_hook_va
+000123a0: 6c69 6461 7469 6f6e 2873 656c 6629 3a0a  lidation(self):.
+000123b0: 2020 2020 2020 2020 7465 7374 5f75 7469          test_uti
+000123c0: 6c2e 6d61 6b65 5f6c 696e 6561 6765 2873  l.make_lineage(s
+000123d0: 656c 662e 636f 6e66 6967 2e63 6f6e 6669  elf.config.confi
+000123e0: 675f 6469 722c 2027 7361 6d70 6c65 2d72  g_dir, 'sample-r
+000123f0: 656e 6577 616c 2e63 6f6e 6627 290a 2020  enewal.conf').  
+00012400: 2020 2020 2020 6172 6773 203d 205b 2272        args = ["r
+00012410: 656e 6577 222c 2022 2d2d 6472 792d 7275  enew", "--dry-ru
+00012420: 6e22 2c20 222d 2d70 6f73 742d 686f 6f6b  n", "--post-hook
+00012430: 3d6e 6f2d 7375 6368 2d63 6f6d 6d61 6e64  =no-such-command
+00012440: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00012450: 2020 2022 2d2d 6469 7361 626c 652d 686f     "--disable-ho
+00012460: 6f6b 2d76 616c 6964 6174 696f 6e22 5d0a  ok-validation"].
+00012470: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+00012480: 6b2e 7061 7463 6828 2263 6572 7462 6f74  k.patch("certbot
+00012490: 2e5f 696e 7465 726e 616c 2e68 6f6f 6b73  ._internal.hooks
+000124a0: 2e70 6f73 745f 686f 6f6b 2229 3a0a 2020  .post_hook"):.  
+000124b0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000124c0: 7465 7374 5f72 656e 6577 616c 5f63 6f6d  test_renewal_com
+000124d0: 6d6f 6e28 5472 7565 2c20 5b5d 2c20 6172  mon(True, [], ar
+000124e0: 6773 3d61 7267 732c 2073 686f 756c 645f  gs=args, should_
+000124f0: 7265 6e65 773d 5472 7565 2c0a 2020 2020  renew=True,.    
+00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012520: 2020 6572 726f 725f 6578 7065 6374 6564    error_expected
+00012530: 3d46 616c 7365 290a 0a20 2020 2064 6566  =False)..    def
+00012540: 2074 6573 745f 7265 6e65 775f 7665 7262   test_renew_verb
+00012550: 5f65 6d70 7479 5f63 6f6e 6669 6728 7365  _empty_config(se
+00012560: 6c66 293a 0a20 2020 2020 2020 2072 6420  lf):.        rd 
+00012570: 3d20 6f73 2e70 6174 682e 6a6f 696e 2873  = os.path.join(s
+00012580: 656c 662e 636f 6e66 6967 2e63 6f6e 6669  elf.config.confi
+00012590: 675f 6469 722c 2027 7265 6e65 7761 6c27  g_dir, 'renewal'
+000125a0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+000125b0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000125c0: 7264 293a 0a20 2020 2020 2020 2020 2020  rd):.           
+000125d0: 2066 696c 6573 7973 7465 6d2e 6d61 6b65   filesystem.make
+000125e0: 6469 7273 2872 6429 0a20 2020 2020 2020  dirs(rd).       
+000125f0: 2077 6974 6820 6f70 656e 286f 732e 7061   with open(os.pa
+00012600: 7468 2e6a 6f69 6e28 7264 2c20 2765 6d70  th.join(rd, 'emp
+00012610: 7479 2e63 6f6e 6627 292c 2027 7727 293a  ty.conf'), 'w'):
+00012620: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00012630: 7320 2023 206c 6561 7665 2074 6865 2066  s  # leave the f
+00012640: 696c 6520 656d 7074 790a 2020 2020 2020  ile empty.      
+00012650: 2020 6172 6773 203d 205b 2272 656e 6577    args = ["renew
+00012660: 222c 2022 2d2d 6472 792d 7275 6e22 2c20  ", "--dry-run", 
+00012670: 222d 7476 7622 5d0a 2020 2020 2020 2020  "-tvv"].        
+00012680: 7365 6c66 2e5f 7465 7374 5f72 656e 6577  self._test_renew
+00012690: 616c 5f63 6f6d 6d6f 6e28 4661 6c73 652c  al_common(False,
+000126a0: 205b 5d2c 2061 7267 733d 6172 6773 2c20   [], args=args, 
+000126b0: 7368 6f75 6c64 5f72 656e 6577 3d46 616c  should_renew=Fal
+000126c0: 7365 2c20 6572 726f 725f 6578 7065 6374  se, error_expect
+000126d0: 6564 3d54 7275 6529 0a0a 2020 2020 6465  ed=True)..    de
+000126e0: 6620 7465 7374 5f72 656e 6577 5f77 6974  f test_renew_wit
+000126f0: 685f 6365 7274 6e61 6d65 2873 656c 6629  h_certname(self)
+00012700: 3a0a 2020 2020 2020 2020 7465 7374 5f75  :.        test_u
+00012710: 7469 6c2e 6d61 6b65 5f6c 696e 6561 6765  til.make_lineage
+00012720: 2873 656c 662e 636f 6e66 6967 2e63 6f6e  (self.config.con
+00012730: 6669 675f 6469 722c 2027 7361 6d70 6c65  fig_dir, 'sample
+00012740: 2d72 656e 6577 616c 2e63 6f6e 6627 290a  -renewal.conf').
+00012750: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
+00012760: 7374 5f72 656e 6577 616c 5f63 6f6d 6d6f  st_renewal_commo
+00012770: 6e28 5472 7565 2c20 5b5d 2c20 7368 6f75  n(True, [], shou
+00012780: 6c64 5f72 656e 6577 3d54 7275 652c 0a20  ld_renew=True,. 
+00012790: 2020 2020 2020 2020 2020 2061 7267 733d             args=
+000127a0: 5b27 7265 6e65 7727 2c20 272d 2d64 7279  ['renew', '--dry
+000127b0: 2d72 756e 272c 2027 2d2d 6365 7274 2d6e  -run', '--cert-n
+000127c0: 616d 6527 2c20 2773 616d 706c 652d 7265  ame', 'sample-re
+000127d0: 6e65 7761 6c27 5d29 0a0a 2020 2020 6465  newal'])..    de
+000127e0: 6620 7465 7374 5f72 656e 6577 5f77 6974  f test_renew_wit
+000127f0: 685f 6261 645f 6365 7274 6e61 6d65 2873  h_bad_certname(s
+00012800: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+00012810: 6c66 2e5f 7465 7374 5f72 656e 6577 616c  lf._test_renewal
+00012820: 5f63 6f6d 6d6f 6e28 5472 7565 2c20 5b5d  _common(True, []
+00012830: 2c20 7368 6f75 6c64 5f72 656e 6577 3d46  , should_renew=F
+00012840: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00012850: 2020 6172 6773 3d5b 2772 656e 6577 272c    args=['renew',
+00012860: 2027 2d2d 6472 792d 7275 6e27 2c20 272d   '--dry-run', '-
+00012870: 2d63 6572 742d 6e61 6d65 272c 2027 7361  -cert-name', 'sa
+00012880: 6d70 6c65 2d72 656e 6577 616c 275d 2c0a  mple-renewal'],.
+00012890: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000128a0: 725f 6578 7065 6374 6564 3d54 7275 6529  r_expected=True)
+000128b0: 0a0a 2020 2020 6465 6620 5f6d 616b 655f  ..    def _make_
+000128c0: 6475 6d6d 795f 7265 6e65 7761 6c5f 636f  dummy_renewal_co
+000128d0: 6e66 6967 2873 656c 6629 3a0a 2020 2020  nfig(self):.    
+000128e0: 2020 2020 7265 6e65 7765 725f 636f 6e66      renewer_conf
+000128f0: 6967 735f 6469 7220 3d20 6f73 2e70 6174  igs_dir = os.pat
+00012900: 682e 6a6f 696e 2873 656c 662e 636f 6e66  h.join(self.conf
+00012910: 6967 2e63 6f6e 6669 675f 6469 722c 2027  ig.config_dir, '
+00012920: 7265 6e65 7761 6c27 290a 2020 2020 2020  renewal').      
+00012930: 2020 6669 6c65 7379 7374 656d 2e6d 616b    filesystem.mak
+00012940: 6564 6972 7328 7265 6e65 7765 725f 636f  edirs(renewer_co
+00012950: 6e66 6967 735f 6469 7229 0a20 2020 2020  nfigs_dir).     
+00012960: 2020 2077 6974 6820 6f70 656e 286f 732e     with open(os.
+00012970: 7061 7468 2e6a 6f69 6e28 7265 6e65 7765  path.join(renewe
+00012980: 725f 636f 6e66 6967 735f 6469 722c 2027  r_configs_dir, '
+00012990: 7465 7374 2e63 6f6e 6627 292c 2027 7727  test.conf'), 'w'
+000129a0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+000129b0: 2020 2020 662e 7772 6974 6528 224d 7920      f.write("My 
+000129c0: 636f 6e74 656e 7473 2064 6f6e 2774 206d  contents don't m
+000129d0: 6174 7465 7222 290a 0a20 2020 2064 6566  atter")..    def
+000129e0: 205f 7465 7374 5f72 656e 6577 5f63 6f6d   _test_renew_com
+000129f0: 6d6f 6e28 7365 6c66 2c20 7265 6e65 7761  mon(self, renewa
+00012a00: 6c70 6172 616d 733d 4e6f 6e65 2c20 6e61  lparams=None, na
+00012a10: 6d65 733d 4e6f 6e65 2c0a 2020 2020 2020  mes=None,.      
+00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a30: 2020 2020 2061 7373 6572 745f 6f63 5f63       assert_oc_c
+00012a40: 616c 6c65 643d 4e6f 6e65 2c20 2a2a 6b77  alled=None, **kw
+00012a50: 6172 6773 293a 0a20 2020 2020 2020 2073  args):.        s
+00012a60: 656c 662e 5f6d 616b 655f 6475 6d6d 795f  elf._make_dummy_
+00012a70: 7265 6e65 7761 6c5f 636f 6e66 6967 2829  renewal_config()
+00012a80: 0a20 2020 2020 2020 2077 6974 6820 6d6f  .        with mo
+00012a90: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00012aa0: 742e 5f69 6e74 6572 6e61 6c2e 7374 6f72  t._internal.stor
+00012ab0: 6167 652e 5265 6e65 7761 626c 6543 6572  age.RenewableCer
+00012ac0: 7427 2920 6173 206d 6f63 6b5f 7263 3a0a  t') as mock_rc:.
+00012ad0: 2020 2020 2020 2020 2020 2020 6d6f 636b              mock
+00012ae0: 5f6c 696e 6561 6765 203d 206d 6f63 6b2e  _lineage = mock.
+00012af0: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+00012b00: 2020 2020 2020 2020 6d6f 636b 5f6c 696e          mock_lin
+00012b10: 6561 6765 2e66 756c 6c63 6861 696e 203d  eage.fullchain =
+00012b20: 2022 736f 6d65 7061 7468 2f66 756c 6c63   "somepath/fullc
+00012b30: 6861 696e 2e70 656d 220a 2020 2020 2020  hain.pem".      
+00012b40: 2020 2020 2020 6966 2072 656e 6577 616c        if renewal
+00012b50: 7061 7261 6d73 2069 7320 6e6f 7420 4e6f  params is not No
+00012b60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00012b70: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
+00012b80: 2e63 6f6e 6669 6775 7261 7469 6f6e 203d  .configuration =
+00012b90: 207b 2772 656e 6577 616c 7061 7261 6d73   {'renewalparams
+00012ba0: 273a 2072 656e 6577 616c 7061 7261 6d73  ': renewalparams
+00012bb0: 7d0a 2020 2020 2020 2020 2020 2020 6966  }.            if
+00012bc0: 206e 616d 6573 2069 7320 6e6f 7420 4e6f   names is not No
+00012bd0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00012be0: 2020 2020 6d6f 636b 5f6c 696e 6561 6765      mock_lineage
+00012bf0: 2e6e 616d 6573 2e72 6574 7572 6e5f 7661  .names.return_va
+00012c00: 6c75 6520 3d20 6e61 6d65 730a 2020 2020  lue = names.    
+00012c10: 2020 2020 2020 2020 6d6f 636b 5f72 632e          mock_rc.
+00012c20: 7265 7475 726e 5f76 616c 7565 203d 206d  return_value = m
+00012c30: 6f63 6b5f 6c69 6e65 6167 650a 2020 2020  ock_lineage.    
+00012c40: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+00012c50: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+00012c60: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00012c70: 7265 6e65 775f 6365 7274 2729 2061 7320  renew_cert') as 
+00012c80: 6d6f 636b 5f72 656e 6577 5f63 6572 743a  mock_renew_cert:
+00012c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012ca0: 206b 7761 7267 732e 7365 7464 6566 6175   kwargs.setdefau
+00012cb0: 6c74 2827 6172 6773 272c 205b 2772 656e  lt('args', ['ren
+00012cc0: 6577 275d 290a 2020 2020 2020 2020 2020  ew']).          
+00012cd0: 2020 2020 2020 7365 6c66 2e5f 7465 7374        self._test
+00012ce0: 5f72 656e 6577 616c 5f63 6f6d 6d6f 6e28  _renewal_common(
+00012cf0: 5472 7565 2c20 4e6f 6e65 2c20 7368 6f75  True, None, shou
+00012d00: 6c64 5f72 656e 6577 3d46 616c 7365 2c20  ld_renew=False, 
+00012d10: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+00012d20: 2020 2020 2020 2069 6620 6173 7365 7274         if assert
+00012d30: 5f6f 635f 6361 6c6c 6564 2069 7320 6e6f  _oc_called is no
+00012d40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00012d50: 2020 2020 2020 2020 6966 2061 7373 6572          if asser
+00012d60: 745f 6f63 5f63 616c 6c65 643a 0a20 2020  t_oc_called:.   
+00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d80: 2061 7373 6572 7420 6d6f 636b 5f72 656e   assert mock_ren
+00012d90: 6577 5f63 6572 742e 6361 6c6c 6564 0a20  ew_cert.called. 
+00012da0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00012db0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012dc0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00012dd0: 6d6f 636b 5f72 656e 6577 5f63 6572 742e  mock_renew_cert.
+00012de0: 6361 6c6c 6564 2069 7320 4661 6c73 650a  called is False.
+00012df0: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+00012e00: 6e65 775f 6e6f 5f72 656e 6577 616c 7061  new_no_renewalpa
+00012e10: 7261 6d73 2873 656c 6629 3a0a 2020 2020  rams(self):.    
+00012e20: 2020 2020 7365 6c66 2e5f 7465 7374 5f72      self._test_r
+00012e30: 656e 6577 5f63 6f6d 6d6f 6e28 6173 7365  enew_common(asse
+00012e40: 7274 5f6f 635f 6361 6c6c 6564 3d46 616c  rt_oc_called=Fal
+00012e50: 7365 2c20 6572 726f 725f 6578 7065 6374  se, error_expect
+00012e60: 6564 3d54 7275 6529 0a0a 2020 2020 6465  ed=True)..    de
+00012e70: 6620 7465 7374 5f72 656e 6577 5f6e 6f5f  f test_renew_no_
+00012e80: 6175 7468 656e 7469 6361 746f 7228 7365  authenticator(se
+00012e90: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+00012ea0: 662e 5f74 6573 745f 7265 6e65 775f 636f  f._test_renew_co
+00012eb0: 6d6d 6f6e 2872 656e 6577 616c 7061 7261  mmon(renewalpara
+00012ec0: 6d73 3d7b 7d2c 2061 7373 6572 745f 6f63  ms={}, assert_oc
+00012ed0: 5f63 616c 6c65 643d 4661 6c73 652c 0a20  _called=False,. 
+00012ee0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00012ef0: 5f65 7870 6563 7465 643d 5472 7565 290a  _expected=True).
+00012f00: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+00012f10: 6e65 775f 7769 7468 5f62 6164 5f69 6e74  new_with_bad_int
+00012f20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00012f30: 7265 6e65 7761 6c70 6172 616d 7320 3d20  renewalparams = 
+00012f40: 7b27 6175 7468 656e 7469 6361 746f 7227  {'authenticator'
+00012f50: 3a20 2777 6562 726f 6f74 272c 0a20 2020  : 'webroot',.   
+00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f70: 2020 2020 2020 2772 7361 5f6b 6579 5f73        'rsa_key_s
+00012f80: 697a 6527 3a20 276f 7665 7220 3930 3030  ize': 'over 9000
+00012f90: 277d 0a20 2020 2020 2020 2073 656c 662e  '}.        self.
+00012fa0: 5f74 6573 745f 7265 6e65 775f 636f 6d6d  _test_renew_comm
+00012fb0: 6f6e 2872 656e 6577 616c 7061 7261 6d73  on(renewalparams
+00012fc0: 3d72 656e 6577 616c 7061 7261 6d73 2c20  =renewalparams, 
+00012fd0: 6572 726f 725f 6578 7065 6374 6564 3d54  error_expected=T
+00012fe0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013000: 2020 2020 2061 7373 6572 745f 6f63 5f63       assert_oc_c
+00013010: 616c 6c65 643d 4661 6c73 6529 0a0a 2020  alled=False)..  
+00013020: 2020 6465 6620 7465 7374 5f72 656e 6577    def test_renew
+00013030: 5f77 6974 685f 6e6f 6e65 7479 7065 5f68  _with_nonetype_h
+00013040: 7474 7030 3128 7365 6c66 293a 0a20 2020  ttp01(self):.   
+00013050: 2020 2020 2072 656e 6577 616c 7061 7261       renewalpara
+00013060: 6d73 203d 207b 2761 7574 6865 6e74 6963  ms = {'authentic
+00013070: 6174 6f72 273a 2027 7765 6272 6f6f 7427  ator': 'webroot'
+00013080: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013090: 2020 2020 2020 2020 2020 2027 6874 7470             'http
+000130a0: 3031 5f70 6f72 7427 3a20 274e 6f6e 6527  01_port': 'None'
+000130b0: 7d0a 2020 2020 2020 2020 7365 6c66 2e5f  }.        self._
+000130c0: 7465 7374 5f72 656e 6577 5f63 6f6d 6d6f  test_renew_commo
+000130d0: 6e28 7265 6e65 7761 6c70 6172 616d 733d  n(renewalparams=
+000130e0: 7265 6e65 7761 6c70 6172 616d 732c 0a20  renewalparams,. 
+000130f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013100: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00013110: 7373 6572 745f 6f63 5f63 616c 6c65 643d  ssert_oc_called=
+00013120: 5472 7565 290a 0a20 2020 2064 6566 2074  True)..    def t
+00013130: 6573 745f 7265 6e65 775f 7769 7468 5f62  est_renew_with_b
+00013140: 6164 5f64 6f6d 6169 6e28 7365 6c66 293a  ad_domain(self):
+00013150: 0a20 2020 2020 2020 2072 656e 6577 616c  .        renewal
+00013160: 7061 7261 6d73 203d 207b 2761 7574 6865  params = {'authe
+00013170: 6e74 6963 6174 6f72 273a 2027 7765 6272  nticator': 'webr
+00013180: 6f6f 7427 7d0a 2020 2020 2020 2020 6e61  oot'}.        na
+00013190: 6d65 7320 3d20 5b27 756e 69c3 a76f 64c3  mes = ['uni..od.
+000131a0: a92e 636f 6d27 5d0a 2020 2020 2020 2020  ..com'].        
+000131b0: 7365 6c66 2e5f 7465 7374 5f72 656e 6577  self._test_renew
+000131c0: 5f63 6f6d 6d6f 6e28 7265 6e65 7761 6c70  _common(renewalp
+000131d0: 6172 616d 733d 7265 6e65 7761 6c70 6172  arams=renewalpar
+000131e0: 616d 732c 2065 7272 6f72 5f65 7870 6563  ams, error_expec
+000131f0: 7465 643d 5472 7565 2c0a 2020 2020 2020  ted=True,.      
+00013200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013210: 2020 2020 2020 2020 2020 6e61 6d65 733d            names=
+00013220: 6e61 6d65 732c 2061 7373 6572 745f 6f63  names, assert_oc
+00013230: 5f63 616c 6c65 643d 4661 6c73 6529 0a0a  _called=False)..
+00013240: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+00013250: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+00013260: 616c 2e70 6c75 6769 6e73 2e73 656c 6563  al.plugins.selec
+00013270: 7469 6f6e 2e63 686f 6f73 655f 636f 6e66  tion.choose_conf
+00013280: 6967 7572 6174 6f72 5f70 6c75 6769 6e73  igurator_plugins
+00013290: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
+000132a0: 7265 6e65 775f 7769 7468 5f63 6f6e 6669  renew_with_confi
+000132b0: 6775 7261 746f 7228 7365 6c66 2c20 6d6f  gurator(self, mo
+000132c0: 636b 5f73 656c 293a 0a20 2020 2020 2020  ck_sel):.       
+000132d0: 206d 6f63 6b5f 7365 6c2e 7265 7475 726e   mock_sel.return
+000132e0: 5f76 616c 7565 203d 2028 6d6f 636b 2e4d  _value = (mock.M
+000132f0: 6167 6963 4d6f 636b 2829 2c20 6d6f 636b  agicMock(), mock
+00013300: 2e4d 6167 6963 4d6f 636b 2829 290a 2020  .MagicMock()).  
+00013310: 2020 2020 2020 7265 6e65 7761 6c70 6172        renewalpar
+00013320: 616d 7320 3d20 7b27 6175 7468 656e 7469  ams = {'authenti
+00013330: 6361 746f 7227 3a20 2777 6562 726f 6f74  cator': 'webroot
+00013340: 277d 0a20 2020 2020 2020 2073 656c 662e  '}.        self.
+00013350: 5f74 6573 745f 7265 6e65 775f 636f 6d6d  _test_renew_comm
+00013360: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00013370: 7265 6e65 7761 6c70 6172 616d 733d 7265  renewalparams=re
+00013380: 6e65 7761 6c70 6172 616d 732c 2061 7373  newalparams, ass
+00013390: 6572 745f 6f63 5f63 616c 6c65 643d 5472  ert_oc_called=Tr
+000133a0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000133b0: 6172 6773 3d27 7265 6e65 7720 2d2d 636f  args='renew --co
+000133c0: 6e66 6967 7572 6174 6f72 2061 7061 6368  nfigurator apach
+000133d0: 6527 2e73 706c 6974 2829 290a 0a20 2020  e'.split())..   
+000133e0: 2064 6566 2074 6573 745f 7265 6e65 775f   def test_renew_
+000133f0: 706c 7567 696e 5f63 6f6e 6669 675f 7265  plugin_config_re
+00013400: 7374 6f72 6174 696f 6e28 7365 6c66 293a  storation(self):
+00013410: 0a20 2020 2020 2020 2072 656e 6577 616c  .        renewal
+00013420: 7061 7261 6d73 203d 207b 2761 7574 6865  params = {'authe
+00013430: 6e74 6963 6174 6f72 273a 2027 7765 6272  nticator': 'webr
+00013440: 6f6f 7427 2c0a 2020 2020 2020 2020 2020  oot',.          
+00013450: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00013460: 7765 6272 6f6f 745f 7061 7468 273a 2027  webroot_path': '
+00013470: 4e6f 6e65 272c 0a20 2020 2020 2020 2020  None',.         
+00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013490: 2777 6562 726f 6f74 5f69 6d61 6769 6e61  'webroot_imagina
+000134a0: 7279 5f66 6c61 6727 3a20 2734 3227 7d0a  ry_flag': '42'}.
+000134b0: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
+000134c0: 7374 5f72 656e 6577 5f63 6f6d 6d6f 6e28  st_renew_common(
+000134d0: 7265 6e65 7761 6c70 6172 616d 733d 7265  renewalparams=re
+000134e0: 6e65 7761 6c70 6172 616d 732c 0a20 2020  newalparams,.   
+000134f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013500: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+00013510: 6572 745f 6f63 5f63 616c 6c65 643d 5472  ert_oc_called=Tr
+00013520: 7565 290a 0a20 2020 2064 6566 2074 6573  ue)..    def tes
+00013530: 745f 7265 6e65 775f 7769 7468 5f77 6562  t_renew_with_web
+00013540: 726f 6f74 5f6d 6170 2873 656c 6629 3a0a  root_map(self):.
+00013550: 2020 2020 2020 2020 7265 6e65 7761 6c70          renewalp
+00013560: 6172 616d 7320 3d20 7b27 6175 7468 656e  arams = {'authen
+00013570: 7469 6361 746f 7227 3a20 2777 6562 726f  ticator': 'webro
+00013580: 6f74 277d 0a20 2020 2020 2020 2073 656c  ot'}.        sel
+00013590: 662e 5f74 6573 745f 7265 6e65 775f 636f  f._test_renew_co
+000135a0: 6d6d 6f6e 280a 2020 2020 2020 2020 2020  mmon(.          
+000135b0: 2020 7265 6e65 7761 6c70 6172 616d 733d    renewalparams=
+000135c0: 7265 6e65 7761 6c70 6172 616d 732c 2061  renewalparams, a
+000135d0: 7373 6572 745f 6f63 5f63 616c 6c65 643d  ssert_oc_called=
+000135e0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+000135f0: 2020 6172 6773 3d5b 2772 656e 6577 272c    args=['renew',
+00013600: 2027 2d2d 7765 6272 6f6f 742d 6d61 7027   '--webroot-map'
+00013610: 2c20 6a73 6f6e 2e64 756d 7073 287b 2765  , json.dumps({'e
+00013620: 7861 6d70 6c65 2e63 6f6d 273a 2074 656d  xample.com': tem
+00013630: 7066 696c 652e 6765 7474 656d 7064 6972  pfile.gettempdir
+00013640: 2829 7d29 5d29 0a0a 2020 2020 6465 6620  ()})])..    def 
+00013650: 7465 7374 5f72 656e 6577 5f72 6563 6f6e  test_renew_recon
+00013660: 7374 6974 7574 655f 6572 726f 7228 7365  stitute_error(se
+00013670: 6c66 293a 0a20 2020 2020 2020 2023 2070  lf):.        # p
+00013680: 796c 696e 743a 2064 6973 6162 6c65 3d70  ylint: disable=p
+00013690: 726f 7465 6374 6564 2d61 6363 6573 730a  rotected-access.
+000136a0: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+000136b0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+000136c0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+000136d0: 7265 6e65 7761 6c2e 7265 636f 6e73 7469  renewal.reconsti
+000136e0: 7475 7465 2729 2061 7320 6d6f 636b 5f72  tute') as mock_r
+000136f0: 6563 6f6e 7374 6974 7574 653a 0a20 2020  econstitute:.   
+00013700: 2020 2020 2020 2020 206d 6f63 6b5f 7265           mock_re
+00013710: 636f 6e73 7469 7475 7465 2e73 6964 655f  constitute.side_
+00013720: 6566 6665 6374 203d 2045 7863 6570 7469  effect = Excepti
+00013730: 6f6e 0a20 2020 2020 2020 2020 2020 2073  on.            s
+00013740: 656c 662e 5f74 6573 745f 7265 6e65 775f  elf._test_renew_
+00013750: 636f 6d6d 6f6e 2861 7373 6572 745f 6f63  common(assert_oc
+00013760: 5f63 616c 6c65 643d 4661 6c73 652c 2065  _called=False, e
+00013770: 7272 6f72 5f65 7870 6563 7465 643d 5472  rror_expected=Tr
+00013780: 7565 290a 0a20 2020 2064 6566 2074 6573  ue)..    def tes
+00013790: 745f 7265 6e65 775f 6f62 7461 696e 5f63  t_renew_obtain_c
+000137a0: 6572 745f 6572 726f 7228 7365 6c66 293a  ert_error(self):
+000137b0: 0a20 2020 2020 2020 2073 656c 662e 5f6d  .        self._m
+000137c0: 616b 655f 6475 6d6d 795f 7265 6e65 7761  ake_dummy_renewa
+000137d0: 6c5f 636f 6e66 6967 2829 0a20 2020 2020  l_config().     
+000137e0: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
+000137f0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00013800: 6572 6e61 6c2e 7374 6f72 6167 652e 5265  ernal.storage.Re
+00013810: 6e65 7761 626c 6543 6572 7427 2920 6173  newableCert') as
+00013820: 206d 6f63 6b5f 7263 3a0a 2020 2020 2020   mock_rc:.      
+00013830: 2020 2020 2020 6d6f 636b 5f6c 696e 6561        mock_linea
+00013840: 6765 203d 206d 6f63 6b2e 4d61 6769 634d  ge = mock.MagicM
+00013850: 6f63 6b28 290a 2020 2020 2020 2020 2020  ock().          
+00013860: 2020 6d6f 636b 5f6c 696e 6561 6765 2e66    mock_lineage.f
+00013870: 756c 6c63 6861 696e 203d 2022 736f 6d65  ullchain = "some
+00013880: 7768 6572 652f 6675 6c6c 6368 6169 6e2e  where/fullchain.
+00013890: 7065 6d22 0a20 2020 2020 2020 2020 2020  pem".           
+000138a0: 206d 6f63 6b5f 7263 2e72 6574 7572 6e5f   mock_rc.return_
+000138b0: 7661 6c75 6520 3d20 6d6f 636b 5f6c 696e  value = mock_lin
+000138c0: 6561 6765 0a20 2020 2020 2020 2020 2020  eage.           
+000138d0: 206d 6f63 6b5f 6c69 6e65 6167 652e 636f   mock_lineage.co
+000138e0: 6e66 6967 7572 6174 696f 6e20 3d20 7b0a  nfiguration = {.
+000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013900: 2772 656e 6577 616c 7061 7261 6d73 273a  'renewalparams':
+00013910: 207b 2761 7574 6865 6e74 6963 6174 6f72   {'authenticator
+00013920: 273a 2027 7765 6272 6f6f 7427 7d7d 0a20  ': 'webroot'}}. 
+00013930: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00013940: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00013950: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+00013960: 696e 2e72 656e 6577 5f63 6572 7427 2920  in.renew_cert') 
+00013970: 6173 206d 6f63 6b5f 7265 6e65 775f 6365  as mock_renew_ce
+00013980: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
+00013990: 2020 2020 6d6f 636b 5f72 656e 6577 5f63      mock_renew_c
+000139a0: 6572 742e 7369 6465 5f65 6666 6563 7420  ert.side_effect 
+000139b0: 3d20 4578 6365 7074 696f 6e0a 2020 2020  = Exception.    
+000139c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000139d0: 2e5f 7465 7374 5f72 656e 6577 616c 5f63  ._test_renewal_c
+000139e0: 6f6d 6d6f 6e28 5472 7565 2c20 4e6f 6e65  ommon(True, None
+000139f0: 2c20 6572 726f 725f 6578 7065 6374 6564  , error_expected
+00013a00: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+00013a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a30: 2061 7267 733d 5b27 7265 6e65 7727 5d2c   args=['renew'],
+00013a40: 2073 686f 756c 645f 7265 6e65 773d 4661   should_renew=Fa
+00013a50: 6c73 6529 0a0a 2020 2020 6465 6620 7465  lse)..    def te
+00013a60: 7374 5f72 656e 6577 5f77 6974 685f 6261  st_renew_with_ba
+00013a70: 645f 636c 695f 6172 6773 2873 656c 6629  d_cli_args(self)
+00013a80: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+00013a90: 7465 7374 5f72 656e 6577 616c 5f63 6f6d  test_renewal_com
+00013aa0: 6d6f 6e28 5472 7565 2c20 4e6f 6e65 2c20  mon(True, None, 
+00013ab0: 6172 6773 3d27 7265 6e65 7720 2d64 2065  args='renew -d e
+00013ac0: 7861 6d70 6c65 2e63 6f6d 272e 7370 6c69  xample.com'.spli
+00013ad0: 7428 292c 0a20 2020 2020 2020 2020 2020  t(),.           
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013af0: 2020 2020 2020 2073 686f 756c 645f 7265         should_re
+00013b00: 6e65 773d 4661 6c73 652c 2065 7272 6f72  new=False, error
+00013b10: 5f65 7870 6563 7465 643d 5472 7565 290a  _expected=True).
+00013b20: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
+00013b30: 7374 5f72 656e 6577 616c 5f63 6f6d 6d6f  st_renewal_commo
+00013b40: 6e28 5472 7565 2c20 4e6f 6e65 2c20 6172  n(True, None, ar
+00013b50: 6773 3d27 7265 6e65 7720 2d2d 6373 7220  gs='renew --csr 
+00013b60: 7b30 7d27 2e66 6f72 6d61 7428 4353 5229  {0}'.format(CSR)
+00013b70: 2e73 706c 6974 2829 2c0a 2020 2020 2020  .split(),.      
+00013b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b90: 2020 2020 2020 2020 2020 2020 7368 6f75              shou
+00013ba0: 6c64 5f72 656e 6577 3d46 616c 7365 2c20  ld_renew=False, 
+00013bb0: 6572 726f 725f 6578 7065 6374 6564 3d54  error_expected=T
+00013bc0: 7275 6529 0a0a 2020 2020 6465 6620 7465  rue)..    def te
+00013bd0: 7374 5f6e 6f5f 7265 6e65 7761 6c5f 7769  st_no_renewal_wi
+00013be0: 7468 5f68 6f6f 6b73 2873 656c 6629 3a0a  th_hooks(self):.
+00013bf0: 2020 2020 2020 2020 5f2c 205f 2c20 7374          _, _, st
+00013c00: 646f 7574 203d 2073 656c 662e 5f74 6573  dout = self._tes
+00013c10: 745f 7265 6e65 7761 6c5f 636f 6d6d 6f6e  t_renewal_common
+00013c20: 280a 2020 2020 2020 2020 2020 2020 6475  (.            du
+00013c30: 655f 666f 725f 7265 6e65 7761 6c3d 4661  e_for_renewal=Fa
+00013c40: 6c73 652c 2065 7874 7261 5f61 7267 733d  lse, extra_args=
+00013c50: 4e6f 6e65 2c20 7368 6f75 6c64 5f72 656e  None, should_ren
+00013c60: 6577 3d46 616c 7365 2c0a 2020 2020 2020  ew=False,.      
+00013c70: 2020 2020 2020 6172 6773 3d5b 2772 656e        args=['ren
+00013c80: 6577 272c 2027 2d2d 706f 7374 2d68 6f6f  ew', '--post-hoo
+00013c90: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
+00013ca0: 2020 2020 2020 277b 307d 202d 6320 2270        '{0} -c "p
+00013cb0: 7269 6e74 285c 2768 656c 6c6f 2077 6f72  rint(\'hello wor
+00013cc0: 6c64 5c27 293b 2227 0a20 2020 2020 2020  ld\');"'.       
+00013cd0: 2020 2020 2020 2020 2020 202e 666f 726d             .form
+00013ce0: 6174 2873 7973 2e65 7865 6375 7461 626c  at(sys.executabl
+00013cf0: 6529 5d29 0a20 2020 2020 2020 2061 7373  e)]).        ass
+00013d00: 6572 7420 274e 6f20 686f 6f6b 7320 7765  ert 'No hooks we
+00013d10: 7265 2072 756e 2e27 2069 6e20 7374 646f  re run.' in stdo
+00013d20: 7574 2e67 6574 7661 6c75 6528 290a 0a20  ut.getvalue().. 
+00013d30: 2020 2040 7465 7374 5f75 7469 6c2e 7061     @test_util.pa
+00013d40: 7463 685f 6469 7370 6c61 795f 7574 696c  tch_display_util
+00013d50: 2829 0a20 2020 2040 6d6f 636b 2e70 6174  ().    @mock.pat
+00013d60: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00013d70: 6572 6e61 6c2e 6d61 696e 2e5f 6669 6e64  ernal.main._find
+00013d80: 5f6c 696e 6561 6765 5f66 6f72 5f64 6f6d  _lineage_for_dom
+00013d90: 6169 6e73 5f61 6e64 5f63 6572 746e 616d  ains_and_certnam
+00013da0: 6527 290a 2020 2020 406d 6f63 6b2e 7061  e').    @mock.pa
+00013db0: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+00013dc0: 7465 726e 616c 2e6d 6169 6e2e 5f69 6e69  ternal.main._ini
+00013dd0: 745f 6c65 5f63 6c69 656e 7427 290a 2020  t_le_client').  
+00013de0: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+00013df0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00013e00: 2e6d 6169 6e2e 5f72 6570 6f72 745f 6e65  .main._report_ne
+00013e10: 775f 6365 7274 2729 0a20 2020 2064 6566  w_cert').    def
+00013e20: 2074 6573 745f 6365 7274 6f6e 6c79 5f72   test_certonly_r
+00013e30: 6569 6e73 7461 6c6c 2873 656c 662c 206d  einstall(self, m
+00013e40: 6f63 6b5f 7265 706f 7274 5f6e 6577 5f63  ock_report_new_c
+00013e50: 6572 742c 206d 6f63 6b5f 696e 6974 2c0a  ert, mock_init,.
+00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e80: 6d6f 636b 5f72 656e 6577 616c 2c20 6d6f  mock_renewal, mo
+00013e90: 636b 5f67 6574 5f75 7469 6c69 7479 293a  ck_get_utility):
+00013ea0: 0a20 2020 2020 2020 206d 6f63 6b5f 7265  .        mock_re
+00013eb0: 6e65 7761 6c2e 7265 7475 726e 5f76 616c  newal.return_val
+00013ec0: 7565 203d 2028 2772 6569 6e73 7461 6c6c  ue = ('reinstall
+00013ed0: 272c 206d 6f63 6b2e 4d61 6769 634d 6f63  ', mock.MagicMoc
+00013ee0: 6b28 2929 0a20 2020 2020 2020 206d 6f63  k()).        moc
+00013ef0: 6b5f 696e 6974 2e72 6574 7572 6e5f 7661  k_init.return_va
+00013f00: 6c75 6520 3d20 6d6f 636b 5f63 6c69 656e  lue = mock_clien
+00013f10: 7420 3d20 6d6f 636b 2e4d 6167 6963 4d6f  t = mock.MagicMo
+00013f20: 636b 2829 0a20 2020 2020 2020 2073 656c  ck().        sel
+00013f30: 662e 5f63 616c 6c28 5b27 2d64 272c 2027  f._call(['-d', '
+00013f40: 666f 6f2e 6261 7227 2c20 272d 6127 2c20  foo.bar', '-a', 
+00013f50: 2773 7461 6e64 616c 6f6e 6527 2c20 2763  'standalone', 'c
+00013f60: 6572 746f 6e6c 7927 5d29 0a20 2020 2020  ertonly']).     
+00013f70: 2020 2061 7373 6572 7420 6d6f 636b 5f63     assert mock_c
+00013f80: 6c69 656e 742e 6f62 7461 696e 5f63 6572  lient.obtain_cer
+00013f90: 7469 6669 6361 7465 2e63 616c 6c65 6420  tificate.called 
+00013fa0: 6973 2046 616c 7365 0a20 2020 2020 2020  is False.       
+00013fb0: 2061 7373 6572 7420 6d6f 636b 5f63 6c69   assert mock_cli
+00013fc0: 656e 742e 6f62 7461 696e 5f61 6e64 5f65  ent.obtain_and_e
+00013fd0: 6e72 6f6c 6c5f 6365 7274 6966 6963 6174  nroll_certificat
+00013fe0: 652e 6361 6c6c 6564 2069 7320 4661 6c73  e.called is Fals
+00013ff0: 650a 2020 2020 2020 2020 6173 7365 7274  e.        assert
+00014000: 206d 6f63 6b5f 6765 745f 7574 696c 6974   mock_get_utilit
+00014010: 7928 292e 6164 645f 6d65 7373 6167 652e  y().add_message.
+00014020: 6361 6c6c 5f63 6f75 6e74 203d 3d20 300a  call_count == 0.
+00014030: 2020 2020 2020 2020 6d6f 636b 5f72 6570          mock_rep
+00014040: 6f72 745f 6e65 775f 6365 7274 2e61 7373  ort_new_cert.ass
+00014050: 6572 745f 6e6f 745f 6361 6c6c 6564 2829  ert_not_called()
+00014060: 0a20 2020 2020 2020 2023 7365 6c66 2e61  .        #self.a
+00014070: 7373 6572 7454 7275 6528 2764 6f6e 6174  ssertTrue('donat
+00014080: 6527 206e 6f74 2069 6e20 6d6f 636b 5f67  e' not in mock_g
+00014090: 6574 5f75 7469 6c69 7479 2829 2e61 6464  et_utility().add
+000140a0: 5f6d 6573 7361 6765 2e63 616c 6c5f 6172  _message.call_ar
+000140b0: 6773 5b30 5d5b 305d 290a 0a20 2020 2064  gs[0][0])..    d
+000140c0: 6566 205f 7465 7374 5f63 6572 746f 6e6c  ef _test_certonl
+000140d0: 795f 6373 725f 636f 6d6d 6f6e 2873 656c  y_csr_common(sel
+000140e0: 662c 2065 7874 7261 5f61 7267 733d 4e6f  f, extra_args=No
+000140f0: 6e65 293a 0a20 2020 2020 2020 2063 6572  ne):.        cer
+00014100: 7472 203d 2027 6365 7274 7227 0a20 2020  tr = 'certr'.   
+00014110: 2020 2020 2063 6861 696e 203d 2027 6368       chain = 'ch
+00014120: 6169 6e27 0a20 2020 2020 2020 206d 6f63  ain'.        moc
+00014130: 6b5f 636c 6965 6e74 203d 206d 6f63 6b2e  k_client = mock.
+00014140: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+00014150: 2020 2020 6d6f 636b 5f63 6c69 656e 742e      mock_client.
+00014160: 6f62 7461 696e 5f63 6572 7469 6669 6361  obtain_certifica
+00014170: 7465 5f66 726f 6d5f 6373 722e 7265 7475  te_from_csr.retu
+00014180: 726e 5f76 616c 7565 203d 2028 6365 7274  rn_value = (cert
+00014190: 722c 2063 6861 696e 290a 2020 2020 2020  r, chain).      
+000141a0: 2020 6365 7274 5f70 6174 6820 3d20 6f73    cert_path = os
+000141b0: 2e70 6174 682e 6e6f 726d 7061 7468 286f  .path.normpath(o
+000141c0: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+000141d0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+000141e0: 6e66 6967 2e63 6f6e 6669 675f 6469 722c  nfig.config_dir,
+000141f0: 0a20 2020 2020 2020 2020 2020 2027 6c69  .            'li
+00014200: 7665 2f65 7861 6d70 6c65 2e63 6f6d 2f63  ve/example.com/c
+00014210: 6572 745f 3531 322e 7065 6d27 2929 0a20  ert_512.pem')). 
+00014220: 2020 2020 2020 2066 756c 6c5f 7061 7468         full_path
+00014230: 203d 206f 732e 7061 7468 2e6e 6f72 6d70   = os.path.normp
+00014240: 6174 6828 6f73 2e70 6174 682e 6a6f 696e  ath(os.path.join
+00014250: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00014260: 6c66 2e63 6f6e 6669 672e 636f 6e66 6967  lf.config.config
+00014270: 5f64 6972 2c0a 2020 2020 2020 2020 2020  _dir,.          
+00014280: 2020 276c 6976 652f 6578 616d 706c 652e    'live/example.
+00014290: 636f 6d2f 6675 6c6c 6368 6169 6e2e 7065  com/fullchain.pe
+000142a0: 6d27 2929 0a20 2020 2020 2020 206d 6f63  m')).        moc
+000142b0: 6b5f 636c 6965 6e74 2e73 6176 655f 6365  k_client.save_ce
+000142c0: 7274 6966 6963 6174 652e 7265 7475 726e  rtificate.return
+000142d0: 5f76 616c 7565 203d 2063 6572 745f 7061  _value = cert_pa
+000142e0: 7468 2c20 4e6f 6e65 2c20 6675 6c6c 5f70  th, None, full_p
+000142f0: 6174 680a 2020 2020 2020 2020 7769 7468  ath.        with
+00014300: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
+00014310: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00014320: 6169 6e2e 5f69 6e69 745f 6c65 5f63 6c69  ain._init_le_cli
+00014330: 656e 7427 2920 6173 206d 6f63 6b5f 696e  ent') as mock_in
+00014340: 6974 3a0a 2020 2020 2020 2020 2020 2020  it:.            
+00014350: 6d6f 636b 5f69 6e69 742e 7265 7475 726e  mock_init.return
+00014360: 5f76 616c 7565 203d 206d 6f63 6b5f 636c  _value = mock_cl
+00014370: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
+00014380: 2063 6861 696e 5f70 6174 6820 3d20 6f73   chain_path = os
+00014390: 2e70 6174 682e 6e6f 726d 7061 7468 286f  .path.normpath(o
+000143a0: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+000143b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000143c0: 662e 636f 6e66 6967 2e63 6f6e 6669 675f  f.config.config_
+000143d0: 6469 722c 0a20 2020 2020 2020 2020 2020  dir,.           
+000143e0: 2020 2020 2027 6c69 7665 2f65 7861 6d70       'live/examp
+000143f0: 6c65 2e63 6f6d 2f63 6861 696e 2e70 656d  le.com/chain.pem
+00014400: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+00014410: 6172 6773 203d 2028 272d 6120 7374 616e  args = ('-a stan
+00014420: 6461 6c6f 6e65 2063 6572 746f 6e6c 7920  dalone certonly 
+00014430: 2d2d 6373 7220 7b30 7d20 2d2d 6365 7274  --csr {0} --cert
+00014440: 2d70 6174 6820 7b31 7d20 270a 2020 2020  -path {1} '.    
+00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014460: 272d 2d63 6861 696e 2d70 6174 6820 7b32  '--chain-path {2
+00014470: 7d20 2d2d 6675 6c6c 6368 6169 6e2d 7061  } --fullchain-pa
+00014480: 7468 207b 337d 2729 2e66 6f72 6d61 7428  th {3}').format(
+00014490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000144a0: 2020 2020 2020 2020 2043 5352 2c20 6365           CSR, ce
+000144b0: 7274 5f70 6174 682c 2063 6861 696e 5f70  rt_path, chain_p
+000144c0: 6174 682c 2066 756c 6c5f 7061 7468 292e  ath, full_path).
+000144d0: 7370 6c69 7428 290a 2020 2020 2020 2020  split().        
+000144e0: 2020 2020 6966 2065 7874 7261 5f61 7267      if extra_arg
+000144f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00014500: 2020 2061 7267 7320 2b3d 2065 7874 7261     args += extra
+00014510: 5f61 7267 730a 2020 2020 2020 2020 2020  _args.          
+00014520: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+00014530: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+00014540: 726e 616c 2e6d 6169 6e2e 6372 7970 746f  rnal.main.crypto
+00014550: 5f75 7469 6c27 293a 0a20 2020 2020 2020  _util'):.       
+00014560: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00014570: 616c 6c28 6172 6773 290a 0a20 2020 2020  all(args)..     
+00014580: 2020 2069 6620 272d 2d64 7279 2d72 756e     if '--dry-run
+00014590: 2720 696e 2061 7267 733a 0a20 2020 2020  ' in args:.     
+000145a0: 2020 2020 2020 2061 7373 6572 7420 6d6f         assert mo
+000145b0: 636b 5f63 6c69 656e 742e 7361 7665 5f63  ck_client.save_c
+000145c0: 6572 7469 6669 6361 7465 2e63 616c 6c65  ertificate.calle
+000145d0: 6420 6973 2046 616c 7365 0a20 2020 2020  d is False.     
+000145e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000145f0: 2020 2020 206d 6f63 6b5f 636c 6965 6e74       mock_client
+00014600: 2e73 6176 655f 6365 7274 6966 6963 6174  .save_certificat
+00014610: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
+00014620: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
+00014630: 2020 2020 2020 2020 2020 2063 6572 7472             certr
+00014640: 2c20 6368 6169 6e2c 2063 6572 745f 7061  , chain, cert_pa
+00014650: 7468 2c20 6368 6169 6e5f 7061 7468 2c20  th, chain_path, 
+00014660: 6675 6c6c 5f70 6174 6829 0a0a 2020 2020  full_path)..    
+00014670: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00014680: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00014690: 6169 6e2e 5f63 7372 5f72 6570 6f72 745f  ain._csr_report_
+000146a0: 6e65 775f 6365 7274 2729 0a20 2020 2040  new_cert').    @
+000146b0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+000146c0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+000146d0: 696e 2e75 7469 6c2e 6174 6578 6974 5f72  in.util.atexit_r
+000146e0: 6567 6973 7465 7227 290a 2020 2020 406d  egister').    @m
+000146f0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00014700: 6f74 2e5f 696e 7465 726e 616c 2e65 6666  ot._internal.eff
+00014710: 2e68 616e 646c 655f 7375 6273 6372 6970  .handle_subscrip
+00014720: 7469 6f6e 2729 0a20 2020 2064 6566 2074  tion').    def t
+00014730: 6573 745f 6365 7274 6f6e 6c79 5f63 7372  est_certonly_csr
+00014740: 2873 656c 662c 206d 6f63 6b5f 7375 6273  (self, mock_subs
+00014750: 6372 6970 7469 6f6e 2c20 6d6f 636b 5f72  cription, mock_r
+00014760: 6567 6973 7465 722c 206d 6f63 6b5f 6373  egister, mock_cs
+00014770: 725f 7265 706f 7274 293a 0a20 2020 2020  r_report):.     
+00014780: 2020 2073 656c 662e 5f74 6573 745f 6365     self._test_ce
+00014790: 7274 6f6e 6c79 5f63 7372 5f63 6f6d 6d6f  rtonly_csr_commo
+000147a0: 6e28 290a 2020 2020 2020 2020 6173 7365  n().        asse
+000147b0: 7274 206d 6f63 6b5f 6373 725f 7265 706f  rt mock_csr_repo
+000147c0: 7274 2e63 616c 6c5f 636f 756e 7420 3d3d  rt.call_count ==
+000147d0: 2031 0a20 2020 2020 2020 2061 7373 6572   1.        asser
+000147e0: 7420 2763 6572 745f 3531 322e 7065 6d27  t 'cert_512.pem'
+000147f0: 2069 6e20 6d6f 636b 5f63 7372 5f72 6570   in mock_csr_rep
+00014800: 6f72 742e 6361 6c6c 5f61 7267 735b 305d  ort.call_args[0]
+00014810: 5b31 5d0a 2020 2020 2020 2020 6173 7365  [1].        asse
+00014820: 7274 206d 6f63 6b5f 6373 725f 7265 706f  rt mock_csr_repo
+00014830: 7274 2e63 616c 6c5f 6172 6773 5b30 5d5b  rt.call_args[0][
+00014840: 325d 2069 7320 4e6f 6e65 0a20 2020 2020  2] is None.     
+00014850: 2020 2061 7373 6572 7420 2766 756c 6c63     assert 'fullc
+00014860: 6861 696e 2e70 656d 2720 696e 206d 6f63  hain.pem' in moc
+00014870: 6b5f 6373 725f 7265 706f 7274 2e63 616c  k_csr_report.cal
+00014880: 6c5f 6172 6773 5b30 5d5b 335d 0a20 2020  l_args[0][3].   
+00014890: 2020 2020 2061 7373 6572 7420 2764 6f6e       assert 'don
+000148a0: 6174 6527 2069 6e20 6d6f 636b 5f72 6567  ate' in mock_reg
+000148b0: 6973 7465 722e 6361 6c6c 5f61 7267 735b  ister.call_args[
+000148c0: 305d 5b31 5d0a 2020 2020 2020 2020 6173  0][1].        as
+000148d0: 7365 7274 206d 6f63 6b5f 7375 6273 6372  sert mock_subscr
+000148e0: 6970 7469 6f6e 2e63 616c 6c65 6420 6973  iption.called is
+000148f0: 2054 7275 650a 0a20 2020 2040 6d6f 636b   True..    @mock
+00014900: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00014910: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e5f  _internal.main._
+00014920: 6373 725f 7265 706f 7274 5f6e 6577 5f63  csr_report_new_c
+00014930: 6572 7427 290a 2020 2020 6465 6620 7465  ert').    def te
+00014940: 7374 5f63 6572 746f 6e6c 795f 6373 725f  st_certonly_csr_
+00014950: 6472 795f 7275 6e28 7365 6c66 2c20 6d6f  dry_run(self, mo
+00014960: 636b 5f63 7372 5f72 6570 6f72 7429 3a0a  ck_csr_report):.
+00014970: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
+00014980: 7374 5f63 6572 746f 6e6c 795f 6373 725f  st_certonly_csr_
+00014990: 636f 6d6d 6f6e 285b 272d 2d64 7279 2d72  common(['--dry-r
+000149a0: 756e 275d 290a 2020 2020 2020 2020 6173  un']).        as
+000149b0: 7365 7274 206d 6f63 6b5f 6373 725f 7265  sert mock_csr_re
+000149c0: 706f 7274 2e63 616c 6c5f 636f 756e 7420  port.call_count 
+000149d0: 3d3d 2031 0a20 2020 2020 2020 2061 7373  == 1.        ass
+000149e0: 6572 7420 6d6f 636b 5f63 7372 5f72 6570  ert mock_csr_rep
+000149f0: 6f72 742e 6361 6c6c 5f61 7267 735b 305d  ort.call_args[0]
+00014a00: 5b30 5d2e 6472 795f 7275 6e20 6973 2054  [0].dry_run is T
+00014a10: 7275 650a 0a20 2020 2040 6d6f 636b 2e70  rue..    @mock.p
+00014a20: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+00014a30: 6e74 6572 6e61 6c2e 6d61 696e 2e5f 6465  nternal.main._de
+00014a40: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
+00014a50: 6174 6527 290a 2020 2020 406d 6f63 6b2e  ate').    @mock.
+00014a60: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00014a70: 696e 7465 726e 616c 2e6d 6169 6e2e 636c  internal.main.cl
+00014a80: 6965 6e74 2e61 636d 655f 636c 6965 6e74  ient.acme_client
+00014a90: 2729 0a20 2020 2064 6566 2074 6573 745f  ').    def test_
+00014aa0: 7265 766f 6b65 5f77 6974 685f 6b65 7928  revoke_with_key(
+00014ab0: 7365 6c66 2c20 6d6f 636b 5f61 636d 655f  self, mock_acme_
+00014ac0: 636c 6965 6e74 2c0a 2020 2020 2020 2020  client,.        
+00014ad0: 2020 2020 6d6f 636b 5f64 656c 6574 655f      mock_delete_
+00014ae0: 6966 5f61 7070 726f 7072 6961 7465 293a  if_appropriate):
+00014af0: 0a20 2020 2020 2020 206d 6f63 6b5f 6465  .        mock_de
+00014b00: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
+00014b10: 6174 652e 7265 7475 726e 5f76 616c 7565  ate.return_value
+00014b20: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00014b30: 2073 6572 7665 7220 3d20 2766 6f6f 2e62   server = 'foo.b
+00014b40: 6172 270a 2020 2020 2020 2020 7365 6c66  ar'.        self
+00014b50: 2e5f 6361 6c6c 5f6e 6f5f 636c 6965 6e74  ._call_no_client
+00014b60: 6d6f 636b 285b 272d 2d63 6572 742d 7061  mock(['--cert-pa
+00014b70: 7468 272c 2053 535f 4345 5254 5f50 4154  th', SS_CERT_PAT
+00014b80: 482c 2027 2d2d 6b65 792d 7061 7468 272c  H, '--key-path',
+00014b90: 2052 5341 3230 3438 5f4b 4559 5f50 4154   RSA2048_KEY_PAT
+00014ba0: 482c 0a20 2020 2020 2020 2020 2020 2020  H,.             
+00014bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bc0: 2020 2020 272d 2d73 6572 7665 7227 2c20      '--server', 
+00014bd0: 7365 7276 6572 2c20 2772 6576 6f6b 6527  server, 'revoke'
+00014be0: 5d29 0a20 2020 2020 2020 2077 6974 6820  ]).        with 
+00014bf0: 6f70 656e 2852 5341 3230 3438 5f4b 4559  open(RSA2048_KEY
+00014c00: 5f50 4154 482c 2027 7262 2729 2061 7320  _PATH, 'rb') as 
+00014c10: 663a 0a20 2020 2020 2020 2020 2020 2061  f:.            a
+00014c20: 7373 6572 7420 6d6f 636b 5f61 636d 655f  ssert mock_acme_
+00014c30: 636c 6965 6e74 2e43 6c69 656e 7456 322e  client.ClientV2.
+00014c40: 6361 6c6c 5f63 6f75 6e74 203d 3d20 310a  call_count == 1.
+00014c50: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00014c60: 7274 206d 6f63 6b5f 6163 6d65 5f63 6c69  rt mock_acme_cli
+00014c70: 656e 742e 436c 6965 6e74 4e65 7477 6f72  ent.ClientNetwor
+00014c80: 6b2e 6361 6c6c 5f61 7267 735b 305d 5b30  k.call_args[0][0
+00014c90: 5d20 3d3d 205c 0a20 2020 2020 2020 2020  ] == \.         
+00014ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cb0: 2020 2020 6a6f 7365 2e4a 574b 2e6c 6f61      jose.JWK.loa
+00014cc0: 6428 662e 7265 6164 2829 290a 2020 2020  d(f.read()).    
+00014cd0: 2020 2020 7769 7468 206f 7065 6e28 5353      with open(SS
+00014ce0: 5f43 4552 545f 5041 5448 2c20 2772 6227  _CERT_PATH, 'rb'
+00014cf0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+00014d00: 2020 2020 6365 7274 203d 2063 7279 7074      cert = crypt
+00014d10: 6f5f 7574 696c 2e70 796f 7065 6e73 736c  o_util.pyopenssl
+00014d20: 5f6c 6f61 645f 6365 7274 6966 6963 6174  _load_certificat
+00014d30: 6528 662e 7265 6164 2829 295b 305d 0a20  e(f.read())[0]. 
+00014d40: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
+00014d50: 7265 766f 6b65 203d 206d 6f63 6b5f 6163  revoke = mock_ac
+00014d60: 6d65 5f63 6c69 656e 742e 436c 6965 6e74  me_client.Client
+00014d70: 5632 2829 2e72 6576 6f6b 650a 2020 2020  V2().revoke.    
+00014d80: 2020 2020 2020 2020 6d6f 636b 5f72 6576          mock_rev
+00014d90: 6f6b 652e 6173 7365 7274 5f63 616c 6c65  oke.assert_calle
+00014da0: 645f 6f6e 6365 5f77 6974 6828 0a20 2020  d_once_with(.   
+00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dc0: 206a 6f73 652e 436f 6d70 6172 6162 6c65   jose.Comparable
+00014dd0: 5835 3039 2863 6572 7429 2c0a 2020 2020  X509(cert),.    
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 6d6f 636b 2e41 4e59 290a 0a20 2020 2064  mock.ANY)..    d
+00014e00: 6566 2074 6573 745f 7265 766f 6b65 5f77  ef test_revoke_w
+00014e10: 6974 685f 6b65 795f 6d69 736d 6174 6368  ith_key_mismatch
+00014e20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00014e30: 7365 7276 6572 203d 2027 666f 6f2e 6261  server = 'foo.ba
+00014e40: 7227 0a20 2020 2020 2020 2077 6974 6820  r'.        with 
+00014e50: 7079 7465 7374 2e72 6169 7365 7328 6572  pytest.raises(er
+00014e60: 726f 7273 2e45 7272 6f72 293a 0a20 2020  rors.Error):.   
+00014e70: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00014e80: 616c 6c5f 6e6f 5f63 6c69 656e 746d 6f63  all_no_clientmoc
+00014e90: 6b28 5b27 2d2d 6365 7274 2d70 6174 6827  k(['--cert-path'
+00014ea0: 2c20 4345 5254 2c20 272d 2d6b 6579 2d70  , CERT, '--key-p
+00014eb0: 6174 6827 2c20 4b45 592c 0a20 2020 2020  ath', KEY,.     
+00014ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ed0: 2020 2020 2020 2020 2020 2020 272d 2d73              '--s
+00014ee0: 6572 7665 7227 2c20 7365 7276 6572 2c20  erver', server, 
+00014ef0: 2772 6576 6f6b 6527 5d29 0a0a 2020 2020  'revoke'])..    
+00014f00: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00014f10: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00014f20: 6169 6e2e 5f64 656c 6574 655f 6966 5f61  ain._delete_if_a
+00014f30: 7070 726f 7072 6961 7465 2729 0a20 2020  ppropriate').   
+00014f40: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00014f50: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00014f60: 6d61 696e 2e5f 6465 7465 726d 696e 655f  main._determine_
+00014f70: 6163 636f 756e 7427 290a 2020 2020 6465  account').    de
+00014f80: 6620 7465 7374 5f72 6576 6f6b 655f 7769  f test_revoke_wi
+00014f90: 7468 6f75 745f 6b65 7928 7365 6c66 2c20  thout_key(self, 
+00014fa0: 6d6f 636b 5f64 6574 6572 6d69 6e65 5f61  mock_determine_a
+00014fb0: 6363 6f75 6e74 2c0a 2020 2020 2020 2020  ccount,.        
+00014fc0: 2020 2020 6d6f 636b 5f64 656c 6574 655f      mock_delete_
+00014fd0: 6966 5f61 7070 726f 7072 6961 7465 293a  if_appropriate):
+00014fe0: 0a20 2020 2020 2020 206d 6f63 6b5f 6465  .        mock_de
+00014ff0: 6c65 7465 5f69 665f 6170 7072 6f70 7269  lete_if_appropri
+00015000: 6174 652e 7265 7475 726e 5f76 616c 7565  ate.return_value
+00015010: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00015020: 206d 6f63 6b5f 6465 7465 726d 696e 655f   mock_determine_
+00015030: 6163 636f 756e 742e 7265 7475 726e 5f76  account.return_v
+00015040: 616c 7565 203d 2028 6d6f 636b 2e4d 6167  alue = (mock.Mag
+00015050: 6963 4d6f 636b 2829 2c20 4e6f 6e65 290a  icMock(), None).
+00015060: 2020 2020 2020 2020 5f2c 205f 2c20 5f2c          _, _, _,
+00015070: 2063 6c69 656e 7420 3d20 7365 6c66 2e5f   client = self._
+00015080: 6361 6c6c 285b 272d 2d63 6572 742d 7061  call(['--cert-pa
+00015090: 7468 272c 2043 4552 542c 2027 7265 766f  th', CERT, 'revo
+000150a0: 6b65 275d 290a 2020 2020 2020 2020 7769  ke']).        wi
+000150b0: 7468 206f 7065 6e28 4345 5254 2920 6173  th open(CERT) as
+000150c0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+000150d0: 6365 7274 203d 2063 7279 7074 6f5f 7574  cert = crypto_ut
+000150e0: 696c 2e70 796f 7065 6e73 736c 5f6c 6f61  il.pyopenssl_loa
+000150f0: 645f 6365 7274 6966 6963 6174 6528 662e  d_certificate(f.
+00015100: 7265 6164 2829 295b 305d 0a20 2020 2020  read())[0].     
+00015110: 2020 2020 2020 206d 6f63 6b5f 7265 766f         mock_revo
+00015120: 6b65 203d 2063 6c69 656e 742e 6163 6d65  ke = client.acme
+00015130: 5f66 726f 6d5f 636f 6e66 6967 5f6b 6579  _from_config_key
+00015140: 2829 2e72 6576 6f6b 650a 2020 2020 2020  ().revoke.      
+00015150: 2020 2020 2020 6d6f 636b 5f72 6576 6f6b        mock_revok
+00015160: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
+00015170: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
+00015180: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+00015190: 6f73 652e 436f 6d70 6172 6162 6c65 5835  ose.ComparableX5
+000151a0: 3039 2863 6572 7429 2c0a 2020 2020 2020  09(cert),.      
+000151b0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+000151c0: 636b 2e41 4e59 290a 0a20 2020 2040 6d6f  ck.ANY)..    @mo
+000151d0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+000151e0: 742e 5f69 6e74 6572 6e61 6c2e 6c6f 672e  t._internal.log.
+000151f0: 706f 7374 5f61 7267 5f70 6172 7365 5f73  post_arg_parse_s
+00015200: 6574 7570 2729 0a20 2020 2064 6566 2074  etup').    def t
+00015210: 6573 745f 7265 6769 7374 6572 2873 656c  est_register(sel
+00015220: 662c 205f 293a 0a20 2020 2020 2020 2077  f, _):.        w
+00015230: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+00015240: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+00015250: 6c2e 6d61 696e 2e63 6c69 656e 7427 2920  l.main.client') 
+00015260: 6173 206d 6f63 6b65 645f 636c 6965 6e74  as mocked_client
+00015270: 3a0a 2020 2020 2020 2020 2020 2020 6163  :.            ac
+00015280: 6320 3d20 6d6f 636b 2e4d 6167 6963 4d6f  c = mock.MagicMo
+00015290: 636b 2829 0a20 2020 2020 2020 2020 2020  ck().           
+000152a0: 2061 6363 2e69 6420 3d20 2269 6d61 6769   acc.id = "imagi
+000152b0: 6e61 7279 5f61 6363 6f75 6e74 220a 2020  nary_account".  
+000152c0: 2020 2020 2020 2020 2020 6d6f 636b 6564            mocked
+000152d0: 5f63 6c69 656e 742e 7265 6769 7374 6572  _client.register
+000152e0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+000152f0: 2861 6363 2c20 2277 6f72 6b65 6422 290a  (acc, "worked").
+00015300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015310: 2e5f 6361 6c6c 5f6e 6f5f 636c 6965 6e74  ._call_no_client
+00015320: 6d6f 636b 285b 2272 6567 6973 7465 7222  mock(["register"
+00015330: 2c20 222d 2d65 6d61 696c 222c 2022 7573  , "--email", "us
+00015340: 6572 4065 7861 6d70 6c65 2e6f 7267 225d  er@example.org"]
+00015350: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00015360: 544f 444f 3a20 4974 2077 6f75 6c64 2062  TODO: It would b
+00015370: 6520 6d6f 7265 2063 6f72 7265 6374 2074  e more correct t
+00015380: 6f20 6578 706c 6963 6974 6c79 2063 6865  o explicitly che
+00015390: 636b 2074 6861 740a 2020 2020 2020 2020  ck that.        
+000153a0: 2020 2020 2320 2020 2020 2020 5f64 6574      #       _det
+000153b0: 6572 6d69 6e65 5f61 6363 6f75 6e74 2829  ermine_account()
+000153c0: 2067 6574 7320 6361 6c6c 6564 2069 6e20   gets called in 
+000153d0: 7468 6520 6162 6f76 6520 6361 7365 2c0a  the above case,.
+000153e0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+000153f0: 2020 2020 6275 7420 636f 7665 7261 6765      but coverage
+00015400: 2073 7461 7469 7374 6963 7320 7368 6f75   statistics shou
+00015410: 6c64 2061 6c73 6f20 7368 6f77 2074 6861  ld also show tha
+00015420: 7420 6974 2064 6964 2e0a 2020 2020 2020  t it did..      
+00015430: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+00015440: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+00015450: 696e 7465 726e 616c 2e6d 6169 6e2e 6163  internal.main.ac
+00015460: 636f 756e 7427 2920 6173 206d 6f63 6b65  count') as mocke
+00015470: 645f 6163 636f 756e 743a 0a20 2020 2020  d_account:.     
+00015480: 2020 2020 2020 2020 2020 206d 6f63 6b65             mocke
+00015490: 645f 7374 6f72 6167 6520 3d20 6d6f 636b  d_storage = mock
+000154a0: 2e4d 6167 6963 4d6f 636b 2829 0a20 2020  .MagicMock().   
+000154b0: 2020 2020 2020 2020 2020 2020 206d 6f63               moc
+000154c0: 6b65 645f 6163 636f 756e 742e 4163 636f  ked_account.Acco
+000154d0: 756e 7446 696c 6553 746f 7261 6765 2e72  untFileStorage.r
+000154e0: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
+000154f0: 636b 6564 5f73 746f 7261 6765 0a20 2020  cked_storage.   
+00015500: 2020 2020 2020 2020 2020 2020 206d 6f63               moc
+00015510: 6b65 645f 7374 6f72 6167 652e 6669 6e64  ked_storage.find
+00015520: 5f61 6c6c 2e72 6574 7572 6e5f 7661 6c75  _all.return_valu
+00015530: 6520 3d20 5b22 616e 2061 6363 6f75 6e74  e = ["an account
+00015540: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+00015550: 2020 2078 203d 2073 656c 662e 5f63 616c     x = self._cal
+00015560: 6c5f 6e6f 5f63 6c69 656e 746d 6f63 6b28  l_no_clientmock(
+00015570: 5b22 7265 6769 7374 6572 222c 2022 2d2d  ["register", "--
+00015580: 656d 6169 6c22 2c20 2275 7365 7240 6578  email", "user@ex
+00015590: 616d 706c 652e 6f72 6722 5d29 0a20 2020  ample.org"]).   
+000155a0: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+000155b0: 6572 7420 2254 6865 7265 2069 7320 616e  ert "There is an
+000155c0: 2065 7869 7374 696e 6720 6163 636f 756e   existing accoun
+000155d0: 7422 2069 6e20 785b 305d 0a0a 2020 2020  t" in x[0]..    
+000155e0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+000155f0: 7462 6f74 2e5f 696e 7465 726e 616c 2e70  tbot._internal.p
+00015600: 6c75 6769 6e73 2e73 656c 6563 7469 6f6e  lugins.selection
+00015610: 2e63 686f 6f73 655f 636f 6e66 6967 7572  .choose_configur
+00015620: 6174 6f72 5f70 6c75 6769 6e73 2729 0a20  ator_plugins'). 
+00015630: 2020 2040 6d6f 636b 2e70 6174 6368 2827     @mock.patch('
+00015640: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+00015650: 6c2e 7570 6461 7465 722e 5f72 756e 5f75  l.updater._run_u
+00015660: 7064 6174 6572 7327 290a 2020 2020 6465  pdaters').    de
+00015670: 6620 7465 7374 5f70 6c75 6769 6e5f 7365  f test_plugin_se
+00015680: 6c65 6374 696f 6e5f 6572 726f 7228 7365  lection_error(se
+00015690: 6c66 2c20 6d6f 636b 5f72 756e 2c20 6d6f  lf, mock_run, mo
+000156a0: 636b 5f63 686f 6f73 6529 3a0a 2020 2020  ck_choose):.    
+000156b0: 2020 2020 6d6f 636b 5f63 686f 6f73 652e      mock_choose.
+000156c0: 7369 6465 5f65 6666 6563 7420 3d20 6572  side_effect = er
+000156d0: 726f 7273 2e50 6c75 6769 6e53 656c 6563  rors.PluginSelec
+000156e0: 7469 6f6e 4572 726f 720a 2020 2020 2020  tionError.      
+000156f0: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
+00015700: 6973 6573 2865 7272 6f72 732e 506c 7567  ises(errors.Plug
+00015710: 696e 5365 6c65 6374 696f 6e45 7272 6f72  inSelectionError
+00015720: 293a 0a20 2020 2020 2020 2020 2020 206d  ):.            m
+00015730: 6169 6e2e 7265 6e65 775f 6365 7274 284e  ain.renew_cert(N
+00015740: 6f6e 652c 204e 6f6e 652c 204e 6f6e 6529  one, None, None)
+00015750: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00015760: 6f6e 6669 672e 6472 795f 7275 6e20 3d20  onfig.dry_run = 
+00015770: 4661 6c73 650a 2020 2020 2020 2020 7570  False.        up
+00015780: 6461 7465 722e 7275 6e5f 6765 6e65 7269  dater.run_generi
+00015790: 635f 7570 6461 7465 7273 2873 656c 662e  c_updaters(self.
+000157a0: 636f 6e66 6967 2c20 4e6f 6e65 2c20 4e6f  config, None, No
+000157b0: 6e65 290a 2020 2020 2020 2020 2320 4d61  ne).        # Ma
+000157c0: 6b65 2073 7572 6520 7765 2772 6520 7265  ke sure we're re
+000157d0: 7475 726e 696e 6720 4e6f 6e65 2c20 616e  turning None, an
+000157e0: 6420 6865 6e63 6520 6e6f 7420 7472 7969  d hence not tryi
+000157f0: 6e67 2074 6f20 7275 6e20 7468 650a 2020  ng to run the.  
+00015800: 2020 2020 2020 2320 7769 7468 6f75 7420        # without 
+00015810: 696e 7374 616c 6c65 720a 2020 2020 2020  installer.      
+00015820: 2020 6173 7365 7274 206d 6f63 6b5f 7275    assert mock_ru
+00015830: 6e2e 6361 6c6c 6564 2069 7320 4661 6c73  n.called is Fals
+00015840: 650a 0a20 2020 2040 6d6f 636b 2e70 6174  e..    @mock.pat
+00015850: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00015860: 6572 6e61 6c2e 6d61 696e 2e75 7064 6174  ernal.main.updat
+00015870: 6572 2e72 756e 5f72 656e 6577 616c 5f64  er.run_renewal_d
+00015880: 6570 6c6f 7965 7227 290a 2020 2020 406d  eployer').    @m
+00015890: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+000158a0: 6f74 2e5f 696e 7465 726e 616c 2e70 6c75  ot._internal.plu
+000158b0: 6769 6e73 2e73 656c 6563 7469 6f6e 2e63  gins.selection.c
+000158c0: 686f 6f73 655f 636f 6e66 6967 7572 6174  hoose_configurat
+000158d0: 6f72 5f70 6c75 6769 6e73 2729 0a20 2020  or_plugins').   
+000158e0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+000158f0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00015900: 6d61 696e 2e5f 696e 6974 5f6c 655f 636c  main._init_le_cl
+00015910: 6965 6e74 2729 0a20 2020 2040 6d6f 636b  ient').    @mock
+00015920: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00015930: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e5f  _internal.main._
+00015940: 6765 745f 616e 645f 7361 7665 5f63 6572  get_and_save_cer
+00015950: 7427 290a 2020 2020 6465 6620 7465 7374  t').    def test
+00015960: 5f72 656e 6577 5f64 6f65 736e 745f 7265  _renew_doesnt_re
+00015970: 7374 6172 745f 6f6e 5f64 7279 7275 6e28  start_on_dryrun(
+00015980: 7365 6c66 2c20 6d6f 636b 5f67 6574 5f63  self, mock_get_c
+00015990: 6572 742c 206d 6f63 6b5f 696e 6974 2c20  ert, mock_init, 
+000159a0: 6d6f 636b 5f63 686f 6f73 652c 0a20 2020  mock_choose,.   
+000159b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159d0: 2020 2020 2020 2020 206d 6f63 6b5f 7275           mock_ru
+000159e0: 6e5f 7265 6e65 7761 6c5f 6465 706c 6f79  n_renewal_deploy
+000159f0: 6572 293a 0a20 2020 2020 2020 2022 2222  er):.        """
+00015a00: 4120 6472 792d 7275 6e20 7265 6e65 7761  A dry-run renewa
+00015a10: 6c20 7368 6f75 6c64 6e27 7420 7472 7920  l shouldn't try 
+00015a20: 746f 2072 6573 7461 7274 2074 6865 2069  to restart the i
+00015a30: 6e73 7461 6c6c 6572 2222 220a 2020 2020  nstaller""".    
+00015a40: 2020 2020 7365 6c66 2e63 6f6e 6669 672e      self.config.
+00015a50: 6472 795f 7275 6e20 3d20 5472 7565 0a20  dry_run = True. 
+00015a60: 2020 2020 2020 2069 6e73 7461 6c6c 6572         installer
+00015a70: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
+00015a80: 6b28 290a 2020 2020 2020 2020 6d6f 636b  k().        mock
+00015a90: 5f63 686f 6f73 652e 7265 7475 726e 5f76  _choose.return_v
+00015aa0: 616c 7565 203d 2028 696e 7374 616c 6c65  alue = (installe
+00015ab0: 722c 206d 6f63 6b2e 4d61 6769 634d 6f63  r, mock.MagicMoc
+00015ac0: 6b28 2929 0a0a 2020 2020 2020 2020 6d61  k())..        ma
+00015ad0: 696e 2e72 656e 6577 5f63 6572 7428 7365  in.renew_cert(se
+00015ae0: 6c66 2e63 6f6e 6669 672c 204e 6f6e 652c  lf.config, None,
+00015af0: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
+00015b00: 6173 7365 7274 206d 6f63 6b5f 696e 6974  assert mock_init
+00015b10: 2e63 616c 6c5f 636f 756e 7420 3d3d 2031  .call_count == 1
+00015b20: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00015b30: 6d6f 636b 5f67 6574 5f63 6572 742e 6361  mock_get_cert.ca
+00015b40: 6c6c 5f63 6f75 6e74 203d 3d20 310a 2020  ll_count == 1.  
+00015b50: 2020 2020 2020 696e 7374 616c 6c65 722e        installer.
+00015b60: 7265 7374 6172 742e 6173 7365 7274 5f6e  restart.assert_n
+00015b70: 6f74 5f63 616c 6c65 6428 290a 2020 2020  ot_called().    
+00015b80: 2020 2020 6d6f 636b 5f72 756e 5f72 656e      mock_run_ren
+00015b90: 6577 616c 5f64 6570 6c6f 7965 722e 6173  ewal_deployer.as
+00015ba0: 7365 7274 5f6e 6f74 5f63 616c 6c65 6428  sert_not_called(
+00015bb0: 290a 0a0a 636c 6173 7320 556e 7265 6769  )...class Unregi
+00015bc0: 7374 6572 5465 7374 2875 6e69 7474 6573  sterTest(unittes
+00015bd0: 742e 5465 7374 4361 7365 293a 0a20 2020  t.TestCase):.   
+00015be0: 2064 6566 2073 6574 5570 2873 656c 6629   def setUp(self)
+00015bf0: 3a0a 2020 2020 2020 2020 7365 6c66 2e70  :.        self.p
+00015c00: 6174 6368 6572 7320 3d20 7b0a 2020 2020  atchers = {.    
+00015c10: 2020 2020 2020 2020 275f 6465 7465 726d          '_determ
+00015c20: 696e 655f 6163 636f 756e 7427 3a20 6d6f  ine_account': mo
+00015c30: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00015c40: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00015c50: 2e5f 6465 7465 726d 696e 655f 6163 636f  ._determine_acco
+00015c60: 756e 7427 292c 0a20 2020 2020 2020 2020  unt'),.         
+00015c70: 2020 2027 6163 636f 756e 7427 3a20 6d6f     'account': mo
+00015c80: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00015c90: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00015ca0: 2e61 6363 6f75 6e74 2729 2c0a 2020 2020  .account'),.    
+00015cb0: 2020 2020 2020 2020 2763 6c69 656e 7427          'client'
+00015cc0: 3a20 6d6f 636b 2e70 6174 6368 2827 6365  : mock.patch('ce
+00015cd0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00015ce0: 6d61 696e 2e63 6c69 656e 7427 292c 0a20  main.client'),. 
+00015cf0: 2020 2020 2020 2020 2020 2027 6765 745f             'get_
+00015d00: 7574 696c 6974 7927 3a20 7465 7374 5f75  utility': test_u
+00015d10: 7469 6c2e 7061 7463 685f 6469 7370 6c61  til.patch_displa
+00015d20: 795f 7574 696c 2829 7d0a 2020 2020 2020  y_util()}.      
+00015d30: 2020 7365 6c66 2e6d 6f63 6b73 203d 207b    self.mocks = {
+00015d40: 6b3a 2076 2e73 7461 7274 2829 2066 6f72  k: v.start() for
+00015d50: 206b 2c20 7620 696e 2073 656c 662e 7061   k, v in self.pa
+00015d60: 7463 6865 7273 2e69 7465 6d73 2829 7d0a  tchers.items()}.
+00015d70: 0a20 2020 2064 6566 2074 6561 7244 6f77  .    def tearDow
+00015d80: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
+00015d90: 2066 6f72 2070 6174 6368 2069 6e20 7365   for patch in se
+00015da0: 6c66 2e70 6174 6368 6572 732e 7661 6c75  lf.patchers.valu
+00015db0: 6573 2829 3a0a 2020 2020 2020 2020 2020  es():.          
+00015dc0: 2020 7061 7463 682e 7374 6f70 2829 0a0a    patch.stop()..
+00015dd0: 2020 2020 6465 6620 7465 7374 5f61 626f      def test_abo
+00015de0: 7274 5f75 6e72 6567 6973 7465 7228 7365  rt_unregister(se
+00015df0: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+00015e00: 662e 6d6f 636b 735b 2761 6363 6f75 6e74  f.mocks['account
+00015e10: 275d 2e41 6363 6f75 6e74 4669 6c65 5374  '].AccountFileSt
+00015e20: 6f72 6167 652e 7265 7475 726e 5f76 616c  orage.return_val
+00015e30: 7565 203d 206d 6f63 6b2e 4d6f 636b 2829  ue = mock.Mock()
+00015e40: 0a0a 2020 2020 2020 2020 7574 696c 5f6d  ..        util_m
+00015e50: 6f63 6b20 3d20 7365 6c66 2e6d 6f63 6b73  ock = self.mocks
+00015e60: 5b27 6765 745f 7574 696c 6974 7927 5d28  ['get_utility'](
+00015e70: 290a 2020 2020 2020 2020 7574 696c 5f6d  ).        util_m
+00015e80: 6f63 6b2e 7965 736e 6f2e 7265 7475 726e  ock.yesno.return
+00015e90: 5f76 616c 7565 203d 2046 616c 7365 0a0a  _value = False..
+00015ea0: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
+00015eb0: 206d 6f63 6b2e 4d6f 636b 2829 0a20 2020   mock.Mock().   
+00015ec0: 2020 2020 2075 6e75 7365 645f 706c 7567       unused_plug
+00015ed0: 696e 7320 3d20 6d6f 636b 2e4d 6f63 6b28  ins = mock.Mock(
+00015ee0: 290a 0a20 2020 2020 2020 2072 6573 203d  )..        res =
+00015ef0: 206d 6169 6e2e 756e 7265 6769 7374 6572   main.unregister
+00015f00: 2863 6f6e 6669 672c 2075 6e75 7365 645f  (config, unused_
+00015f10: 706c 7567 696e 7329 0a20 2020 2020 2020  plugins).       
+00015f20: 2061 7373 6572 7420 7265 7320 3d3d 2022   assert res == "
+00015f30: 4465 6163 7469 7661 7469 6f6e 2061 626f  Deactivation abo
+00015f40: 7274 6564 2e22 0a0a 2020 2020 406d 6f63  rted."..    @moc
+00015f50: 6b2e 7061 7463 6828 2263 6572 7462 6f74  k.patch("certbot
+00015f60: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00015f70: 6469 7370 6c61 795f 7574 696c 2e6e 6f74  display_util.not
+00015f80: 6966 7922 290a 2020 2020 6465 6620 7465  ify").    def te
+00015f90: 7374 5f75 6e72 6567 6973 7465 7228 7365  st_unregister(se
+00015fa0: 6c66 2c20 6d6f 636b 5f6e 6f74 6966 7929  lf, mock_notify)
+00015fb0: 3a0a 2020 2020 2020 2020 6d6f 636b 6564  :.        mocked
+00015fc0: 5f73 746f 7261 6765 203d 206d 6f63 6b2e  _storage = mock.
+00015fd0: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+00015fe0: 2020 2020 6d6f 636b 6564 5f73 746f 7261      mocked_stora
+00015ff0: 6765 2e66 696e 645f 616c 6c2e 7265 7475  ge.find_all.retu
+00016000: 726e 5f76 616c 7565 203d 205b 2261 6e20  rn_value = ["an 
+00016010: 6163 636f 756e 7422 5d0a 0a20 2020 2020  account"]..     
+00016020: 2020 2073 656c 662e 6d6f 636b 735b 2761     self.mocks['a
+00016030: 6363 6f75 6e74 275d 2e41 6363 6f75 6e74  ccount'].Account
+00016040: 4669 6c65 5374 6f72 6167 652e 7265 7475  FileStorage.retu
+00016050: 726e 5f76 616c 7565 203d 206d 6f63 6b65  rn_value = mocke
+00016060: 645f 7374 6f72 6167 650a 2020 2020 2020  d_storage.      
+00016070: 2020 7365 6c66 2e6d 6f63 6b73 5b27 5f64    self.mocks['_d
+00016080: 6574 6572 6d69 6e65 5f61 6363 6f75 6e74  etermine_account
+00016090: 275d 2e72 6574 7572 6e5f 7661 6c75 6520  '].return_value 
+000160a0: 3d20 286d 6f63 6b2e 4d61 6769 634d 6f63  = (mock.MagicMoc
+000160b0: 6b28 292c 2022 666f 6f22 290a 0a20 2020  k(), "foo")..   
+000160c0: 2020 2020 2063 625f 636c 6965 6e74 203d       cb_client =
+000160d0: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
+000160e0: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
+000160f0: 6f63 6b73 5b27 636c 6965 6e74 275d 2e43  ocks['client'].C
+00016100: 6c69 656e 742e 7265 7475 726e 5f76 616c  lient.return_val
+00016110: 7565 203d 2063 625f 636c 6965 6e74 0a0a  ue = cb_client..
+00016120: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
+00016130: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
+00016140: 290a 2020 2020 2020 2020 756e 7573 6564  ).        unused
+00016150: 5f70 6c75 6769 6e73 203d 206d 6f63 6b2e  _plugins = mock.
+00016160: 4d61 6769 634d 6f63 6b28 290a 0a20 2020  MagicMock()..   
+00016170: 2020 2020 2072 6573 203d 206d 6169 6e2e       res = main.
+00016180: 756e 7265 6769 7374 6572 2863 6f6e 6669  unregister(confi
+00016190: 672c 2075 6e75 7365 645f 706c 7567 696e  g, unused_plugin
+000161a0: 7329 0a0a 2020 2020 2020 2020 6173 7365  s)..        asse
+000161b0: 7274 2072 6573 2069 7320 4e6f 6e65 0a20  rt res is None. 
+000161c0: 2020 2020 2020 206d 6f63 6b5f 6e6f 7469         mock_noti
+000161d0: 6679 2e61 7373 6572 745f 6361 6c6c 6564  fy.assert_called
+000161e0: 5f6f 6e63 655f 7769 7468 2822 4163 636f  _once_with("Acco
+000161f0: 756e 7420 6465 6163 7469 7661 7465 642e  unt deactivated.
+00016200: 2229 0a0a 2020 2020 6465 6620 7465 7374  ")..    def test
+00016210: 5f75 6e72 6567 6973 7465 725f 6e6f 5f61  _unregister_no_a
+00016220: 6363 6f75 6e74 2873 656c 6629 3a0a 2020  ccount(self):.  
+00016230: 2020 2020 2020 6d6f 636b 6564 5f73 746f        mocked_sto
+00016240: 7261 6765 203d 206d 6f63 6b2e 4d61 6769  rage = mock.Magi
+00016250: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
+00016260: 6d6f 636b 6564 5f73 746f 7261 6765 2e66  mocked_storage.f
+00016270: 696e 645f 616c 6c2e 7265 7475 726e 5f76  ind_all.return_v
+00016280: 616c 7565 203d 205b 5d0a 2020 2020 2020  alue = [].      
+00016290: 2020 7365 6c66 2e6d 6f63 6b73 5b27 6163    self.mocks['ac
+000162a0: 636f 756e 7427 5d2e 4163 636f 756e 7446  count'].AccountF
+000162b0: 696c 6553 746f 7261 6765 2e72 6574 7572  ileStorage.retur
+000162c0: 6e5f 7661 6c75 6520 3d20 6d6f 636b 6564  n_value = mocked
+000162d0: 5f73 746f 7261 6765 0a0a 2020 2020 2020  _storage..      
+000162e0: 2020 6362 5f63 6c69 656e 7420 3d20 6d6f    cb_client = mo
+000162f0: 636b 2e4d 6167 6963 4d6f 636b 2829 0a20  ck.MagicMock(). 
+00016300: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
+00016310: 735b 2763 6c69 656e 7427 5d2e 436c 6965  s['client'].Clie
+00016320: 6e74 2e72 6574 7572 6e5f 7661 6c75 6520  nt.return_value 
+00016330: 3d20 6362 5f63 6c69 656e 740a 0a20 2020  = cb_client..   
+00016340: 2020 2020 2063 6f6e 6669 6720 3d20 6d6f       config = mo
+00016350: 636b 2e4d 6167 6963 4d6f 636b 2829 0a20  ck.MagicMock(). 
+00016360: 2020 2020 2020 2063 6f6e 6669 672e 7365         config.se
+00016370: 7276 6572 203d 2022 6874 7470 733a 2f2f  rver = "https://
+00016380: 6163 6d65 2e65 7861 6d70 6c65 2e63 6f6d  acme.example.com
+00016390: 2f64 6972 6563 746f 7279 220a 2020 2020  /directory".    
+000163a0: 2020 2020 756e 7573 6564 5f70 6c75 6769      unused_plugi
+000163b0: 6e73 203d 206d 6f63 6b2e 4d61 6769 634d  ns = mock.MagicM
+000163c0: 6f63 6b28 290a 0a20 2020 2020 2020 2072  ock()..        r
+000163d0: 6573 203d 206d 6169 6e2e 756e 7265 6769  es = main.unregi
+000163e0: 7374 6572 2863 6f6e 6669 672c 2075 6e75  ster(config, unu
+000163f0: 7365 645f 706c 7567 696e 7329 0a20 2020  sed_plugins).   
+00016400: 2020 2020 206d 203d 2022 436f 756c 6420       m = "Could 
+00016410: 6e6f 7420 6669 6e64 2065 7869 7374 696e  not find existin
+00016420: 6720 6163 636f 756e 7420 666f 7220 7365  g account for se
+00016430: 7276 6572 2068 7474 7073 3a2f 2f61 636d  rver https://acm
+00016440: 652e 6578 616d 706c 652e 636f 6d2f 6469  e.example.com/di
+00016450: 7265 6374 6f72 792e 220a 2020 2020 2020  rectory.".      
+00016460: 2020 6173 7365 7274 2072 6573 203d 3d20    assert res == 
+00016470: 6d0a 2020 2020 2020 2020 6173 7365 7274  m.        assert
+00016480: 2063 625f 636c 6965 6e74 2e61 636d 652e   cb_client.acme.
+00016490: 6465 6163 7469 7661 7465 5f72 6567 6973  deactivate_regis
+000164a0: 7472 6174 696f 6e2e 6361 6c6c 6564 2069  tration.called i
+000164b0: 7320 4661 6c73 650a 0a0a 636c 6173 7320  s False...class 
+000164c0: 4d61 6b65 4f72 5665 7269 6679 4e65 6564  MakeOrVerifyNeed
+000164d0: 6564 4469 7273 2874 6573 745f 7574 696c  edDirs(test_util
+000164e0: 2e43 6f6e 6669 6754 6573 7443 6173 6529  .ConfigTestCase)
+000164f0: 3a0a 2020 2020 2222 2254 6573 7473 2066  :.    """Tests f
+00016500: 6f72 2063 6572 7462 6f74 2e5f 696e 7465  or certbot._inte
+00016510: 726e 616c 2e6d 6169 6e2e 6d61 6b65 5f6f  rnal.main.make_o
+00016520: 725f 7665 7269 6679 5f6e 6565 6465 645f  r_verify_needed_
+00016530: 6469 7273 2e22 2222 0a0a 2020 2020 406d  dirs."""..    @m
+00016540: 6f63 6b2e 7061 7463 6828 2263 6572 7462  ock.patch("certb
+00016550: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+00016560: 6e2e 7574 696c 2229 0a20 2020 2064 6566  n.util").    def
+00016570: 2074 6573 745f 6974 2873 656c 662c 206d   test_it(self, m
+00016580: 6f63 6b5f 7574 696c 293a 0a20 2020 2020  ock_util):.     
+00016590: 2020 206d 6169 6e2e 6d61 6b65 5f6f 725f     main.make_or_
+000165a0: 7665 7269 6679 5f6e 6565 6465 645f 6469  verify_needed_di
+000165b0: 7273 2873 656c 662e 636f 6e66 6967 290a  rs(self.config).
+000165c0: 2020 2020 2020 2020 666f 7220 636f 7265          for core
+000165d0: 5f64 6972 2069 6e20 2873 656c 662e 636f  _dir in (self.co
+000165e0: 6e66 6967 2e63 6f6e 6669 675f 6469 722c  nfig.config_dir,
+000165f0: 2073 656c 662e 636f 6e66 6967 2e77 6f72   self.config.wor
+00016600: 6b5f 6469 722c 293a 0a20 2020 2020 2020  k_dir,):.       
+00016610: 2020 2020 206d 6f63 6b5f 7574 696c 2e73       mock_util.s
+00016620: 6574 5f75 705f 636f 7265 5f64 6972 2e61  et_up_core_dir.a
+00016630: 7373 6572 745f 616e 795f 6361 6c6c 280a  ssert_any_call(.
+00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016650: 636f 7265 5f64 6972 2c20 636f 6e73 7461  core_dir, consta
+00016660: 6e74 732e 434f 4e46 4947 5f44 4952 535f  nts.CONFIG_DIRS_
+00016670: 4d4f 4445 2c0a 2020 2020 2020 2020 2020  MODE,.          
+00016680: 2020 2020 2020 7365 6c66 2e63 6f6e 6669        self.confi
+00016690: 672e 7374 7269 6374 5f70 6572 6d69 7373  g.strict_permiss
+000166a0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+000166b0: 2029 0a0a 2020 2020 2020 2020 686f 6f6b   )..        hook
+000166c0: 5f64 6972 7320 3d20 2873 656c 662e 636f  _dirs = (self.co
+000166d0: 6e66 6967 2e72 656e 6577 616c 5f70 7265  nfig.renewal_pre
+000166e0: 5f68 6f6f 6b73 5f64 6972 2c0a 2020 2020  _hooks_dir,.    
+000166f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016700: 2073 656c 662e 636f 6e66 6967 2e72 656e   self.config.ren
+00016710: 6577 616c 5f64 6570 6c6f 795f 686f 6f6b  ewal_deploy_hook
+00016720: 735f 6469 722c 0a20 2020 2020 2020 2020  s_dir,.         
+00016730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016740: 2e63 6f6e 6669 672e 7265 6e65 7761 6c5f  .config.renewal_
+00016750: 706f 7374 5f68 6f6f 6b73 5f64 6972 2c29  post_hooks_dir,)
+00016760: 0a20 2020 2020 2020 2066 6f72 2068 6f6f  .        for hoo
+00016770: 6b5f 6469 7220 696e 2068 6f6f 6b5f 6469  k_dir in hook_di
+00016780: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00016790: 2320 6465 6661 756c 7420 6d6f 6465 206f  # default mode o
+000167a0: 6620 3735 3520 6973 2075 7365 640a 2020  f 755 is used.  
+000167b0: 2020 2020 2020 2020 2020 6d6f 636b 5f75            mock_u
+000167c0: 7469 6c2e 6d61 6b65 5f6f 725f 7665 7269  til.make_or_veri
+000167d0: 6679 5f64 6972 2e61 7373 6572 745f 616e  fy_dir.assert_an
+000167e0: 795f 6361 6c6c 280a 2020 2020 2020 2020  y_call(.        
+000167f0: 2020 2020 2020 2020 686f 6f6b 5f64 6972          hook_dir
+00016800: 2c20 7374 7269 6374 3d73 656c 662e 636f  , strict=self.co
+00016810: 6e66 6967 2e73 7472 6963 745f 7065 726d  nfig.strict_perm
+00016820: 6973 7369 6f6e 7329 0a0a 0a63 6c61 7373  issions)...class
+00016830: 2045 6e68 616e 6365 5465 7374 2874 6573   EnhanceTest(tes
+00016840: 745f 7574 696c 2e43 6f6e 6669 6754 6573  t_util.ConfigTes
+00016850: 7443 6173 6529 3a0a 2020 2020 2222 2254  tCase):.    """T
+00016860: 6573 7473 2066 6f72 2063 6572 7462 6f74  ests for certbot
+00016870: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00016880: 656e 6861 6e63 652e 2222 220a 0a20 2020  enhance."""..   
+00016890: 2064 6566 2073 6574 5570 2873 656c 6629   def setUp(self)
+000168a0: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
+000168b0: 292e 7365 7455 7028 290a 2020 2020 2020  ).setUp().      
+000168c0: 2020 7365 6c66 2e67 6574 5f75 7469 6c69    self.get_utili
+000168d0: 7479 5f70 6174 6368 203d 2074 6573 745f  ty_patch = test_
+000168e0: 7574 696c 2e70 6174 6368 5f64 6973 706c  util.patch_displ
+000168f0: 6179 5f75 7469 6c28 290a 2020 2020 2020  ay_util().      
+00016900: 2020 7365 6c66 2e6d 6f63 6b5f 6765 745f    self.mock_get_
+00016910: 7574 696c 6974 7920 3d20 7365 6c66 2e67  utility = self.g
+00016920: 6574 5f75 7469 6c69 7479 5f70 6174 6368  et_utility_patch
+00016930: 2e73 7461 7274 2829 0a20 2020 2020 2020  .start().       
+00016940: 2073 656c 662e 6d6f 636b 696e 7374 616c   self.mockinstal
+00016950: 6c65 7220 3d20 6d6f 636b 2e4d 6167 6963  ler = mock.Magic
+00016960: 4d6f 636b 2873 7065 633d 656e 6861 6e63  Mock(spec=enhanc
+00016970: 656d 656e 7473 2e41 7574 6f48 5354 5345  ements.AutoHSTSE
+00016980: 6e68 616e 6365 6d65 6e74 290a 0a20 2020  nhancement)..   
+00016990: 2064 6566 2074 6561 7244 6f77 6e28 7365   def tearDown(se
+000169a0: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+000169b0: 662e 6765 745f 7574 696c 6974 795f 7061  f.get_utility_pa
+000169c0: 7463 682e 7374 6f70 2829 0a0a 2020 2020  tch.stop()..    
+000169d0: 6465 6620 5f63 616c 6c28 7365 6c66 2c20  def _call(self, 
+000169e0: 6172 6773 293a 0a20 2020 2020 2020 2070  args):.        p
+000169f0: 6c75 6769 6e73 203d 2064 6973 636f 2e50  lugins = disco.P
+00016a00: 6c75 6769 6e73 5265 6769 7374 7279 2e66  luginsRegistry.f
+00016a10: 696e 645f 616c 6c28 290a 2020 2020 2020  ind_all().      
+00016a20: 2020 636f 6e66 6967 203d 2063 6f6e 6669    config = confi
+00016a30: 6775 7261 7469 6f6e 2e4e 616d 6573 7061  guration.Namespa
+00016a40: 6365 436f 6e66 6967 280a 2020 2020 2020  ceConfig(.      
+00016a50: 2020 2020 2020 636c 692e 7072 6570 6172        cli.prepar
+00016a60: 655f 616e 645f 7061 7273 655f 6172 6773  e_and_parse_args
+00016a70: 2870 6c75 6769 6e73 2c20 6172 6773 2929  (plugins, args))
+00016a80: 0a0a 2020 2020 2020 2020 7769 7468 206d  ..        with m
+00016a90: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00016aa0: 6f74 2e5f 696e 7465 726e 616c 2e63 6572  ot._internal.cer
+00016ab0: 745f 6d61 6e61 6765 722e 6765 745f 6365  t_manager.get_ce
+00016ac0: 7274 6e61 6d65 7327 2920 6173 206d 6f63  rtnames') as moc
+00016ad0: 6b5f 6365 7274 733a 0a20 2020 2020 2020  k_certs:.       
+00016ae0: 2020 2020 206d 6f63 6b5f 6365 7274 732e       mock_certs.
+00016af0: 7265 7475 726e 5f76 616c 7565 203d 205b  return_value = [
+00016b00: 2765 7861 6d70 6c65 2e63 6f6d 275d 0a20  'example.com']. 
+00016b10: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00016b20: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00016b30: 626f 742e 5f69 6e74 6572 6e61 6c2e 6365  bot._internal.ce
+00016b40: 7274 5f6d 616e 6167 6572 2e64 6f6d 6169  rt_manager.domai
+00016b50: 6e73 5f66 6f72 5f63 6572 746e 616d 6527  ns_for_certname'
+00016b60: 2920 6173 206d 6f63 6b5f 646f 6d3a 0a20  ) as mock_dom:. 
+00016b70: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00016b80: 6f63 6b5f 646f 6d2e 7265 7475 726e 5f76  ock_dom.return_v
+00016b90: 616c 7565 203d 205b 2765 7861 6d70 6c65  alue = ['example
+00016ba0: 2e63 6f6d 275d 0a20 2020 2020 2020 2020  .com'].         
+00016bb0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
+00016bc0: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00016bd0: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e5f  _internal.main._
+00016be0: 696e 6974 5f6c 655f 636c 6965 6e74 2729  init_le_client')
+00016bf0: 2061 7320 6d6f 636b 5f69 6e69 743a 0a20   as mock_init:. 
+00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c10: 2020 206d 6f63 6b5f 636c 6965 6e74 203d     mock_client =
+00016c20: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
+00016c30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016c40: 2020 2020 2020 6d6f 636b 5f63 6c69 656e        mock_clien
+00016c50: 742e 636f 6e66 6967 203d 2063 6f6e 6669  t.config = confi
+00016c60: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00016c70: 2020 2020 2020 6d6f 636b 5f69 6e69 742e        mock_init.
+00016c80: 7265 7475 726e 5f76 616c 7565 203d 206d  return_value = m
+00016c90: 6f63 6b5f 636c 6965 6e74 0a20 2020 2020  ock_client.     
+00016ca0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00016cb0: 6169 6e2e 656e 6861 6e63 6528 636f 6e66  ain.enhance(conf
+00016cc0: 6967 2c20 706c 7567 696e 7329 0a20 2020  ig, plugins).   
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ce0: 2072 6574 7572 6e20 6d6f 636b 5f63 6c69   return mock_cli
+00016cf0: 656e 7420 2320 7265 7475 726e 7320 7468  ent # returns th
+00016d00: 6520 636c 6965 6e74 0a0a 2020 2020 406d  e client..    @m
+00016d10: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00016d20: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+00016d30: 6e2e 706c 7567 5f73 656c 2e72 6563 6f72  n.plug_sel.recor
+00016d40: 645f 6368 6f73 656e 5f70 6c75 6769 6e73  d_chosen_plugins
+00016d50: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+00016d60: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00016d70: 6572 6e61 6c2e 6365 7274 5f6d 616e 6167  ernal.cert_manag
+00016d80: 6572 2e6c 696e 6561 6765 5f66 6f72 5f63  er.lineage_for_c
+00016d90: 6572 746e 616d 6527 290a 2020 2020 406d  ertname').    @m
+00016da0: 6f63 6b2e 7061 7463 6828 2763 6572 7462  ock.patch('certb
+00016db0: 6f74 2e5f 696e 7465 726e 616c 2e6d 6169  ot._internal.mai
+00016dc0: 6e2e 6469 7370 6c61 795f 6f70 732e 6368  n.display_ops.ch
+00016dd0: 6f6f 7365 5f76 616c 7565 7327 290a 2020  oose_values').  
+00016de0: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+00016df0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00016e00: 2e6d 6169 6e2e 5f66 696e 645f 646f 6d61  .main._find_doma
+00016e10: 696e 735f 6f72 5f63 6572 746e 616d 6527  ins_or_certname'
+00016e20: 290a 2020 2020 6465 6620 7465 7374 5f73  ).    def test_s
+00016e30: 656c 6563 7469 6f6e 5f71 7565 7374 696f  election_questio
+00016e40: 6e28 7365 6c66 2c20 6d6f 636b 5f66 696e  n(self, mock_fin
+00016e50: 642c 206d 6f63 6b5f 6368 6f6f 7365 2c20  d, mock_choose, 
+00016e60: 6d6f 636b 5f6c 696e 6561 6765 2c20 5f72  mock_lineage, _r
+00016e70: 6563 293a 0a20 2020 2020 2020 206d 6f63  ec):.        moc
+00016e80: 6b5f 6c69 6e65 6167 652e 7265 7475 726e  k_lineage.return
+00016e90: 5f76 616c 7565 203d 206d 6f63 6b2e 4d61  _value = mock.Ma
+00016ea0: 6769 634d 6f63 6b28 6368 6169 6e5f 7061  gicMock(chain_pa
+00016eb0: 7468 3d22 2f74 6d70 2f6e 6f6e 6578 6973  th="/tmp/nonexis
+00016ec0: 7465 6e74 2229 0a20 2020 2020 2020 206d  tent").        m
+00016ed0: 6f63 6b5f 6368 6f6f 7365 2e72 6574 7572  ock_choose.retur
+00016ee0: 6e5f 7661 6c75 6520 3d20 5b27 6578 616d  n_value = ['exam
+00016ef0: 706c 652e 636f 6d27 5d0a 2020 2020 2020  ple.com'].      
+00016f00: 2020 6d6f 636b 5f66 696e 642e 7265 7475    mock_find.retu
+00016f10: 726e 5f76 616c 7565 203d 2028 4e6f 6e65  rn_value = (None
+00016f20: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+00016f30: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+00016f40: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+00016f50: 616c 2e6d 6169 6e2e 706c 7567 5f73 656c  al.main.plug_sel
+00016f60: 2e70 6963 6b5f 696e 7374 616c 6c65 7227  .pick_installer'
+00016f70: 2920 6173 206d 6f63 6b5f 7069 636b 3a0a  ) as mock_pick:.
+00016f80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016f90: 2e5f 6361 6c6c 285b 2765 6e68 616e 6365  ._call(['enhance
+00016fa0: 272c 2027 2d2d 7265 6469 7265 6374 275d  ', '--redirect']
+00016fb0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00016fc0: 7365 7274 206d 6f63 6b5f 7069 636b 2e63  sert mock_pick.c
+00016fd0: 616c 6c65 640a 2020 2020 2020 2020 2020  alled.          
+00016fe0: 2020 2320 4368 6563 6b20 7468 6174 2074    # Check that t
+00016ff0: 6865 206d 6573 7361 6765 2069 6e63 6c75  he message inclu
+00017000: 6465 7320 2265 6e68 616e 6365 6d65 6e74  des "enhancement
+00017010: 7322 0a20 2020 2020 2020 2020 2020 2061  s".            a
+00017020: 7373 6572 7420 2265 6e68 616e 6365 6d65  ssert "enhanceme
+00017030: 6e74 7322 2069 6e20 6d6f 636b 5f70 6963  nts" in mock_pic
+00017040: 6b2e 6361 6c6c 5f61 7267 735b 305d 5b33  k.call_args[0][3
+00017050: 5d0a 0a20 2020 2040 6d6f 636b 2e70 6174  ]..    @mock.pat
+00017060: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00017070: 6572 6e61 6c2e 6d61 696e 2e70 6c75 675f  ernal.main.plug_
+00017080: 7365 6c2e 7265 636f 7264 5f63 686f 7365  sel.record_chose
+00017090: 6e5f 706c 7567 696e 7327 290a 2020 2020  n_plugins').    
+000170a0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+000170b0: 7462 6f74 2e5f 696e 7465 726e 616c 2e63  tbot._internal.c
+000170c0: 6572 745f 6d61 6e61 6765 722e 6c69 6e65  ert_manager.line
+000170d0: 6167 655f 666f 725f 6365 7274 6e61 6d65  age_for_certname
+000170e0: 2729 0a20 2020 2040 6d6f 636b 2e70 6174  ').    @mock.pat
+000170f0: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+00017100: 6572 6e61 6c2e 6d61 696e 2e64 6973 706c  ernal.main.displ
+00017110: 6179 5f6f 7073 2e63 686f 6f73 655f 7661  ay_ops.choose_va
+00017120: 6c75 6573 2729 0a20 2020 2040 6d6f 636b  lues').    @mock
+00017130: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00017140: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e5f  _internal.main._
+00017150: 6669 6e64 5f64 6f6d 6169 6e73 5f6f 725f  find_domains_or_
+00017160: 6365 7274 6e61 6d65 2729 0a20 2020 2064  certname').    d
+00017170: 6566 2074 6573 745f 7365 6c65 6374 696f  ef test_selectio
+00017180: 6e5f 6175 7468 5f77 6172 6e69 6e67 2873  n_auth_warning(s
+00017190: 656c 662c 206d 6f63 6b5f 6669 6e64 2c20  elf, mock_find, 
+000171a0: 6d6f 636b 5f63 686f 6f73 652c 206d 6f63  mock_choose, moc
+000171b0: 6b5f 6c69 6e65 6167 652c 205f 7265 6329  k_lineage, _rec)
+000171c0: 3a0a 2020 2020 2020 2020 6d6f 636b 5f6c  :.        mock_l
+000171d0: 696e 6561 6765 2e72 6574 7572 6e5f 7661  ineage.return_va
+000171e0: 6c75 6520 3d20 6d6f 636b 2e4d 6167 6963  lue = mock.Magic
+000171f0: 4d6f 636b 2863 6861 696e 5f70 6174 683d  Mock(chain_path=
+00017200: 222f 746d 702f 6e6f 6e65 7869 7374 656e  "/tmp/nonexisten
+00017210: 7422 290a 2020 2020 2020 2020 6d6f 636b  t").        mock
+00017220: 5f63 686f 6f73 652e 7265 7475 726e 5f76  _choose.return_v
+00017230: 616c 7565 203d 205b 2265 7861 6d70 6c65  alue = ["example
+00017240: 2e63 6f6d 225d 0a20 2020 2020 2020 206d  .com"].        m
+00017250: 6f63 6b5f 6669 6e64 2e72 6574 7572 6e5f  ock_find.return_
+00017260: 7661 6c75 6520 3d20 284e 6f6e 652c 204e  value = (None, N
+00017270: 6f6e 6529 0a20 2020 2020 2020 2077 6974  one).        wit
+00017280: 6820 6d6f 636b 2e70 6174 6368 2827 6365  h mock.patch('ce
+00017290: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+000172a0: 6d61 696e 2e70 6c75 675f 7365 6c2e 7069  main.plug_sel.pi
+000172b0: 636b 5f69 6e73 7461 6c6c 6572 2729 3a0a  ck_installer'):.
+000172c0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+000172d0: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
+000172e0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+000172f0: 6169 6e2e 706c 7567 5f73 656c 2e6c 6f67  ain.plug_sel.log
+00017300: 6765 722e 7761 726e 696e 6727 2920 6173  ger.warning') as
+00017310: 206d 6f63 6b5f 6c6f 673a 0a20 2020 2020   mock_log:.     
+00017320: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
+00017330: 636c 6965 6e74 203d 2073 656c 662e 5f63  client = self._c
+00017340: 616c 6c28 5b27 656e 6861 6e63 6527 2c20  all(['enhance', 
+00017350: 272d 6127 2c20 2777 6562 726f 6f74 272c  '-a', 'webroot',
+00017360: 2027 2d2d 7265 6469 7265 6374 275d 290a   '--redirect']).
+00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 6173 7365 7274 206d 6f63 6b5f 6c6f 672e  assert mock_log.
+00017390: 6361 6c6c 6564 0a20 2020 2020 2020 2020  called.         
+000173a0: 2020 2020 2020 2061 7373 6572 7420 226d         assert "m
+000173b0: 616b 6520 7365 6e73 6522 2069 6e20 6d6f  ake sense" in mo
+000173c0: 636b 5f6c 6f67 2e63 616c 6c5f 6172 6773  ck_log.call_args
+000173d0: 5b30 5d5b 305d 0a20 2020 2020 2020 2020  [0][0].         
+000173e0: 2020 2020 2020 2061 7373 6572 7420 6d6f         assert mo
+000173f0: 636b 5f63 6c69 656e 742e 656e 6861 6e63  ck_client.enhanc
+00017400: 655f 636f 6e66 6967 2e63 616c 6c65 640a  e_config.called.
+00017410: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
+00017420: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+00017430: 6e61 6c2e 6365 7274 5f6d 616e 6167 6572  nal.cert_manager
+00017440: 2e6c 696e 6561 6765 5f66 6f72 5f63 6572  .lineage_for_cer
+00017450: 746e 616d 6527 290a 2020 2020 406d 6f63  tname').    @moc
+00017460: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+00017470: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00017480: 6469 7370 6c61 795f 6f70 732e 6368 6f6f  display_ops.choo
+00017490: 7365 5f76 616c 7565 7327 290a 2020 2020  se_values').    
+000174a0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+000174b0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+000174c0: 6169 6e2e 706c 7567 5f73 656c 2e72 6563  ain.plug_sel.rec
+000174d0: 6f72 645f 6368 6f73 656e 5f70 6c75 6769  ord_chosen_plugi
+000174e0: 6e73 2729 0a20 2020 2064 6566 2074 6573  ns').    def tes
+000174f0: 745f 656e 6861 6e63 655f 636f 6e66 6967  t_enhance_config
+00017500: 5f63 616c 6c28 7365 6c66 2c20 5f72 6563  _call(self, _rec
+00017510: 2c20 6d6f 636b 5f63 686f 6f73 652c 206d  , mock_choose, m
+00017520: 6f63 6b5f 6c69 6e65 6167 6529 3a0a 2020  ock_lineage):.  
+00017530: 2020 2020 2020 6d6f 636b 5f6c 696e 6561        mock_linea
+00017540: 6765 2e72 6574 7572 6e5f 7661 6c75 6520  ge.return_value 
+00017550: 3d20 6d6f 636b 2e4d 6167 6963 4d6f 636b  = mock.MagicMock
+00017560: 2863 6861 696e 5f70 6174 683d 222f 746d  (chain_path="/tm
+00017570: 702f 6e6f 6e65 7869 7374 656e 7422 290a  p/nonexistent").
+00017580: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
+00017590: 6f73 652e 7265 7475 726e 5f76 616c 7565  ose.return_value
+000175a0: 203d 205b 2265 7861 6d70 6c65 2e63 6f6d   = ["example.com
+000175b0: 225d 0a20 2020 2020 2020 2077 6974 6820  "].        with 
+000175c0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+000175d0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+000175e0: 696e 2e70 6c75 675f 7365 6c2e 7069 636b  in.plug_sel.pick
+000175f0: 5f69 6e73 7461 6c6c 6572 2729 3a0a 2020  _installer'):.  
+00017600: 2020 2020 2020 2020 2020 6d6f 636b 5f63            mock_c
+00017610: 6c69 656e 7420 3d20 7365 6c66 2e5f 6361  lient = self._ca
+00017620: 6c6c 285b 2765 6e68 616e 6365 272c 2027  ll(['enhance', '
+00017630: 2d2d 7265 6469 7265 6374 272c 2027 2d2d  --redirect', '--
+00017640: 6873 7473 275d 290a 2020 2020 2020 2020  hsts']).        
+00017650: 2020 2020 7265 715f 656e 6820 3d20 5b22      req_enh = ["
+00017660: 7265 6469 7265 6374 222c 2022 6873 7473  redirect", "hsts
+00017670: 225d 0a20 2020 2020 2020 2020 2020 206e  "].            n
+00017680: 6f74 5f72 6571 5f65 6e68 203d 205b 2275  ot_req_enh = ["u
+00017690: 6972 225d 0a20 2020 2020 2020 2020 2020  ir"].           
+000176a0: 2061 7373 6572 7420 6d6f 636b 5f63 6c69   assert mock_cli
+000176b0: 656e 742e 656e 6861 6e63 655f 636f 6e66  ent.enhance_conf
+000176c0: 6967 2e63 616c 6c65 640a 2020 2020 2020  ig.called.      
+000176d0: 2020 2020 2020 6173 7365 7274 2061 6c6c        assert all
+000176e0: 2867 6574 6174 7472 286d 6f63 6b5f 636c  (getattr(mock_cl
+000176f0: 6965 6e74 2e63 6f6e 6669 672c 2065 2920  ient.config, e) 
+00017700: 666f 7220 6520 696e 2072 6571 5f65 6e68  for e in req_enh
+00017710: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00017720: 7365 7274 206e 6f74 2061 6e79 2867 6574  sert not any(get
+00017730: 6174 7472 286d 6f63 6b5f 636c 6965 6e74  attr(mock_client
+00017740: 2e63 6f6e 6669 672c 2065 2920 666f 7220  .config, e) for 
+00017750: 6520 696e 206e 6f74 5f72 6571 5f65 6e68  e in not_req_enh
+00017760: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00017770: 7365 7274 2022 6578 616d 706c 652e 636f  sert "example.co
+00017780: 6d22 2069 6e20 6d6f 636b 5f63 6c69 656e  m" in mock_clien
+00017790: 742e 656e 6861 6e63 655f 636f 6e66 6967  t.enhance_config
+000177a0: 2e63 616c 6c5f 6172 6773 5b30 5d5b 305d  .call_args[0][0]
+000177b0: 0a0a 2020 2020 406d 6f63 6b2e 7061 7463  ..    @mock.patc
+000177c0: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+000177d0: 726e 616c 2e63 6572 745f 6d61 6e61 6765  rnal.cert_manage
+000177e0: 722e 6c69 6e65 6167 655f 666f 725f 6365  r.lineage_for_ce
+000177f0: 7274 6e61 6d65 2729 0a20 2020 2040 6d6f  rtname').    @mo
+00017800: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00017810: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00017820: 2e64 6973 706c 6179 5f6f 7073 2e63 686f  .display_ops.cho
+00017830: 6f73 655f 7661 6c75 6573 2729 0a20 2020  ose_values').   
+00017840: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00017850: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00017860: 6d61 696e 2e70 6c75 675f 7365 6c2e 7265  main.plug_sel.re
+00017870: 636f 7264 5f63 686f 7365 6e5f 706c 7567  cord_chosen_plug
+00017880: 696e 7327 290a 2020 2020 6465 6620 7465  ins').    def te
+00017890: 7374 5f65 6e68 616e 6365 5f6e 6f6e 696e  st_enhance_nonin
+000178a0: 7465 7261 6374 6976 6528 7365 6c66 2c20  teractive(self, 
+000178b0: 5f72 6563 2c20 6d6f 636b 5f63 686f 6f73  _rec, mock_choos
+000178c0: 652c 206d 6f63 6b5f 6c69 6e65 6167 6529  e, mock_lineage)
+000178d0: 3a0a 2020 2020 2020 2020 6d6f 636b 5f6c  :.        mock_l
+000178e0: 696e 6561 6765 2e72 6574 7572 6e5f 7661  ineage.return_va
+000178f0: 6c75 6520 3d20 6d6f 636b 2e4d 6167 6963  lue = mock.Magic
+00017900: 4d6f 636b 280a 2020 2020 2020 2020 2020  Mock(.          
+00017910: 2020 6368 6169 6e5f 7061 7468 3d22 2f74    chain_path="/t
+00017920: 6d70 2f6e 6f6e 6578 6973 7465 6e74 2229  mp/nonexistent")
+00017930: 0a20 2020 2020 2020 206d 6f63 6b5f 6368  .        mock_ch
+00017940: 6f6f 7365 2e72 6574 7572 6e5f 7661 6c75  oose.return_valu
+00017950: 6520 3d20 5b22 6578 616d 706c 652e 636f  e = ["example.co
+00017960: 6d22 5d0a 2020 2020 2020 2020 7769 7468  m"].        with
+00017970: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
+00017980: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00017990: 6169 6e2e 706c 7567 5f73 656c 2e70 6963  ain.plug_sel.pic
+000179a0: 6b5f 696e 7374 616c 6c65 7227 293a 0a20  k_installer'):. 
+000179b0: 2020 2020 2020 2020 2020 206d 6f63 6b5f             mock_
+000179c0: 636c 6965 6e74 203d 2073 656c 662e 5f63  client = self._c
+000179d0: 616c 6c28 5b27 656e 6861 6e63 6527 2c20  all(['enhance', 
+000179e0: 272d 2d72 6564 6972 6563 7427 2c0a 2020  '--redirect',.  
+000179f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a10: 2020 2020 272d 2d68 7374 7327 2c20 272d      '--hsts', '-
+00017a20: 2d6e 6f6e 2d69 6e74 6572 6163 7469 7665  -non-interactive
+00017a30: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00017a40: 6173 7365 7274 206d 6f63 6b5f 636c 6965  assert mock_clie
+00017a50: 6e74 2e65 6e68 616e 6365 5f63 6f6e 6669  nt.enhance_confi
+00017a60: 672e 6361 6c6c 6564 0a20 2020 2020 2020  g.called.       
+00017a70: 2020 2020 2061 7373 6572 7420 6d6f 636b       assert mock
+00017a80: 5f63 686f 6f73 652e 6361 6c6c 6564 2069  _choose.called i
+00017a90: 7320 4661 6c73 650a 0a20 2020 2040 6d6f  s False..    @mo
+00017aa0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00017ab0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00017ac0: 2e64 6973 706c 6179 5f6f 7073 2e63 686f  .display_ops.cho
+00017ad0: 6f73 655f 7661 6c75 6573 2729 0a20 2020  ose_values').   
+00017ae0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00017af0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00017b00: 6d61 696e 2e70 6c75 675f 7365 6c2e 7265  main.plug_sel.re
+00017b10: 636f 7264 5f63 686f 7365 6e5f 706c 7567  cord_chosen_plug
+00017b20: 696e 7327 290a 2020 2020 6465 6620 7465  ins').    def te
+00017b30: 7374 5f75 7365 725f 6162 6f72 745f 646f  st_user_abort_do
+00017b40: 6d61 696e 7328 7365 6c66 2c20 5f72 6563  mains(self, _rec
+00017b50: 2c20 6d6f 636b 5f63 686f 6f73 6529 3a0a  , mock_choose):.
+00017b60: 2020 2020 2020 2020 6d6f 636b 5f63 686f          mock_cho
+00017b70: 6f73 652e 7265 7475 726e 5f76 616c 7565  ose.return_value
+00017b80: 203d 205b 5d0a 2020 2020 2020 2020 7769   = [].        wi
+00017b90: 7468 206d 6f63 6b2e 7061 7463 6828 2763  th mock.patch('c
+00017ba0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00017bb0: 2e6d 6169 6e2e 706c 7567 5f73 656c 2e70  .main.plug_sel.p
+00017bc0: 6963 6b5f 696e 7374 616c 6c65 7227 293a  ick_installer'):
+00017bd0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00017be0: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
+00017bf0: 6572 726f 7273 2e45 7272 6f72 293a 0a20  errors.Error):. 
+00017c00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017c10: 656c 662e 5f63 616c 6c28 5b27 656e 6861  elf._call(['enha
+00017c20: 6e63 6527 2c20 272d 2d72 6564 6972 6563  nce', '--redirec
+00017c30: 7427 2c20 272d 2d68 7374 7327 5d29 0a0a  t', '--hsts'])..
+00017c40: 2020 2020 6465 6620 7465 7374 5f6e 6f5f      def test_no_
+00017c50: 656e 6861 6e63 656d 656e 7473 5f64 6566  enhancements_def
+00017c60: 696e 6564 2873 656c 6629 3a0a 2020 2020  ined(self):.    
+00017c70: 2020 2020 7769 7468 2070 7974 6573 742e      with pytest.
+00017c80: 7261 6973 6573 2865 7272 6f72 732e 4d69  raises(errors.Mi
+00017c90: 7363 6f6e 6669 6775 7261 7469 6f6e 4572  sconfigurationEr
+00017ca0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+00017cb0: 2020 7365 6c66 2e5f 6361 6c6c 285b 2765    self._call(['e
+00017cc0: 6e68 616e 6365 272c 2027 2d61 272c 2027  nhance', '-a', '
+00017cd0: 6e75 6c6c 275d 290a 0a20 2020 2040 6d6f  null'])..    @mo
+00017ce0: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00017cf0: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00017d00: 2e70 6c75 675f 7365 6c2e 6368 6f6f 7365  .plug_sel.choose
+00017d10: 5f63 6f6e 6669 6775 7261 746f 725f 706c  _configurator_pl
+00017d20: 7567 696e 7327 290a 2020 2020 406d 6f63  ugins').    @moc
+00017d30: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+00017d40: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00017d50: 6469 7370 6c61 795f 6f70 732e 6368 6f6f  display_ops.choo
+00017d60: 7365 5f76 616c 7565 7327 290a 2020 2020  se_values').    
+00017d70: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+00017d80: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00017d90: 6169 6e2e 706c 7567 5f73 656c 2e72 6563  ain.plug_sel.rec
+00017da0: 6f72 645f 6368 6f73 656e 5f70 6c75 6769  ord_chosen_plugi
+00017db0: 6e73 2729 0a20 2020 2064 6566 2074 6573  ns').    def tes
+00017dc0: 745f 706c 7567 696e 5f73 656c 6563 7469  t_plugin_selecti
+00017dd0: 6f6e 5f65 7272 6f72 2873 656c 662c 205f  on_error(self, _
+00017de0: 7265 632c 206d 6f63 6b5f 6368 6f6f 7365  rec, mock_choose
+00017df0: 2c20 6d6f 636b 5f70 6963 6b29 3a0a 2020  , mock_pick):.  
+00017e00: 2020 2020 2020 6d6f 636b 5f63 686f 6f73        mock_choos
+00017e10: 652e 7265 7475 726e 5f76 616c 7565 203d  e.return_value =
+00017e20: 205b 2265 7861 6d70 6c65 2e63 6f6d 225d   ["example.com"]
+00017e30: 0a20 2020 2020 2020 206d 6f63 6b5f 7069  .        mock_pi
+00017e40: 636b 2e72 6574 7572 6e5f 7661 6c75 6520  ck.return_value 
+00017e50: 3d20 284e 6f6e 652c 204e 6f6e 6529 0a20  = (None, None). 
+00017e60: 2020 2020 2020 206d 6f63 6b5f 7069 636b         mock_pick
+00017e70: 2e73 6964 655f 6566 6665 6374 203d 2065  .side_effect = e
+00017e80: 7272 6f72 732e 506c 7567 696e 5365 6c65  rrors.PluginSele
+00017e90: 6374 696f 6e45 7272 6f72 2829 0a20 2020  ctionError().   
+00017ea0: 2020 2020 206d 6f63 6b5f 636c 6965 6e74       mock_client
+00017eb0: 203d 2073 656c 662e 5f63 616c 6c28 5b27   = self._call(['
+00017ec0: 656e 6861 6e63 6527 2c20 272d 2d68 7374  enhance', '--hst
+00017ed0: 7327 5d29 0a20 2020 2020 2020 2061 7373  s']).        ass
+00017ee0: 6572 7420 6d6f 636b 5f63 6c69 656e 742e  ert mock_client.
+00017ef0: 656e 6861 6e63 655f 636f 6e66 6967 2e63  enhance_config.c
+00017f00: 616c 6c65 6420 6973 2046 616c 7365 0a0a  alled is False..
+00017f10: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+00017f20: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+00017f30: 616c 2e63 6572 745f 6d61 6e61 6765 722e  al.cert_manager.
+00017f40: 6c69 6e65 6167 655f 666f 725f 6365 7274  lineage_for_cert
+00017f50: 6e61 6d65 2729 0a20 2020 2040 6d6f 636b  name').    @mock
+00017f60: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00017f70: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e64  _internal.main.d
+00017f80: 6973 706c 6179 5f6f 7073 2e63 686f 6f73  isplay_ops.choos
+00017f90: 655f 7661 6c75 6573 2729 0a20 2020 2040  e_values').    @
+00017fa0: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+00017fb0: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+00017fc0: 696e 2e70 6c75 675f 7365 6c2e 7069 636b  in.plug_sel.pick
+00017fd0: 5f69 6e73 7461 6c6c 6572 2729 0a20 2020  _installer').   
+00017fe0: 2040 6d6f 636b 2e70 6174 6368 2827 6365   @mock.patch('ce
+00017ff0: 7274 626f 742e 5f69 6e74 6572 6e61 6c2e  rtbot._internal.
+00018000: 6d61 696e 2e70 6c75 675f 7365 6c2e 7265  main.plug_sel.re
+00018010: 636f 7264 5f63 686f 7365 6e5f 706c 7567  cord_chosen_plug
+00018020: 696e 7327 290a 2020 2020 4074 6573 745f  ins').    @test_
+00018030: 7574 696c 2e70 6174 6368 5f64 6973 706c  util.patch_displ
+00018040: 6179 5f75 7469 6c28 290a 2020 2020 6465  ay_util().    de
+00018050: 6620 7465 7374 5f65 6e68 616e 6365 6d65  f test_enhanceme
+00018060: 6e74 5f65 6e61 626c 6528 7365 6c66 2c20  nt_enable(self, 
+00018070: 5f2c 205f 7265 632c 206d 6f63 6b5f 696e  _, _rec, mock_in
+00018080: 7374 2c20 6d6f 636b 5f63 686f 6f73 652c  st, mock_choose,
+00018090: 206d 6f63 6b5f 6c69 6e65 6167 6529 3a0a   mock_lineage):.
+000180a0: 2020 2020 2020 2020 6d6f 636b 5f69 6e73          mock_ins
+000180b0: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
+000180c0: 2073 656c 662e 6d6f 636b 696e 7374 616c   self.mockinstal
+000180d0: 6c65 720a 2020 2020 2020 2020 6d6f 636b  ler.        mock
+000180e0: 5f63 686f 6f73 652e 7265 7475 726e 5f76  _choose.return_v
+000180f0: 616c 7565 203d 205b 2265 7861 6d70 6c65  alue = ["example
+00018100: 2e63 6f6d 222c 2022 616e 6f74 6865 722e  .com", "another.
+00018110: 746c 6422 5d0a 2020 2020 2020 2020 6d6f  tld"].        mo
+00018120: 636b 5f6c 696e 6561 6765 2e72 6574 7572  ck_lineage.retur
+00018130: 6e5f 7661 6c75 6520 3d20 6d6f 636b 2e4d  n_value = mock.M
+00018140: 6167 6963 4d6f 636b 2863 6861 696e 5f70  agicMock(chain_p
+00018150: 6174 683d 222f 746d 702f 6e6f 6e65 7869  ath="/tmp/nonexi
+00018160: 7374 656e 7422 290a 2020 2020 2020 2020  stent").        
+00018170: 7365 6c66 2e5f 6361 6c6c 285b 2765 6e68  self._call(['enh
+00018180: 616e 6365 272c 2027 2d2d 6175 746f 2d68  ance', '--auto-h
+00018190: 7374 7327 5d29 0a20 2020 2020 2020 2061  sts']).        a
+000181a0: 7373 6572 7420 7365 6c66 2e6d 6f63 6b69  ssert self.mocki
+000181b0: 6e73 7461 6c6c 6572 2e65 6e61 626c 655f  nstaller.enable_
+000181c0: 6175 746f 6873 7473 2e63 616c 6c65 640a  autohsts.called.
+000181d0: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
+000181e0: 656c 662e 6d6f 636b 696e 7374 616c 6c65  elf.mockinstalle
+000181f0: 722e 656e 6162 6c65 5f61 7574 6f68 7374  r.enable_autohst
+00018200: 732e 6361 6c6c 5f61 7267 735b 305d 5b31  s.call_args[0][1
+00018210: 5d20 3d3d 205c 0a20 2020 2020 2020 2020  ] == \.         
+00018220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018230: 205b 2265 7861 6d70 6c65 2e63 6f6d 222c   ["example.com",
+00018240: 2022 616e 6f74 6865 722e 746c 6422 5d0a   "another.tld"].
+00018250: 0a20 2020 2040 6d6f 636b 2e70 6174 6368  .    @mock.patch
+00018260: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+00018270: 6e61 6c2e 6365 7274 5f6d 616e 6167 6572  nal.cert_manager
+00018280: 2e6c 696e 6561 6765 5f66 6f72 5f63 6572  .lineage_for_cer
+00018290: 746e 616d 6527 290a 2020 2020 406d 6f63  tname').    @moc
+000182a0: 6b2e 7061 7463 6828 2763 6572 7462 6f74  k.patch('certbot
+000182b0: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+000182c0: 6469 7370 6c61 795f 6f70 732e 6368 6f6f  display_ops.choo
+000182d0: 7365 5f76 616c 7565 7327 290a 2020 2020  se_values').    
+000182e0: 406d 6f63 6b2e 7061 7463 6828 2763 6572  @mock.patch('cer
+000182f0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00018300: 6169 6e2e 706c 7567 5f73 656c 2e70 6963  ain.plug_sel.pic
+00018310: 6b5f 696e 7374 616c 6c65 7227 290a 2020  k_installer').  
+00018320: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+00018330: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+00018340: 2e6d 6169 6e2e 706c 7567 5f73 656c 2e72  .main.plug_sel.r
+00018350: 6563 6f72 645f 6368 6f73 656e 5f70 6c75  ecord_chosen_plu
+00018360: 6769 6e73 2729 0a20 2020 2040 7465 7374  gins').    @test
+00018370: 5f75 7469 6c2e 7061 7463 685f 6469 7370  _util.patch_disp
+00018380: 6c61 795f 7574 696c 2829 0a20 2020 2064  lay_util().    d
+00018390: 6566 2074 6573 745f 656e 6861 6e63 656d  ef test_enhancem
+000183a0: 656e 745f 656e 6162 6c65 5f6e 6f74 5f73  ent_enable_not_s
+000183b0: 7570 706f 7274 6564 2873 656c 662c 205f  upported(self, _
+000183c0: 2c20 5f72 6563 2c20 6d6f 636b 5f69 6e73  , _rec, mock_ins
+000183d0: 742c 206d 6f63 6b5f 6368 6f6f 7365 2c20  t, mock_choose, 
+000183e0: 6d6f 636b 5f6c 696e 6561 6765 293a 0a20  mock_lineage):. 
+000183f0: 2020 2020 2020 206d 6f63 6b5f 696e 7374         mock_inst
+00018400: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+00018410: 6e75 6c6c 2e49 6e73 7461 6c6c 6572 2873  null.Installer(s
+00018420: 656c 662e 636f 6e66 6967 2c20 226e 756c  elf.config, "nul
+00018430: 6c22 290a 2020 2020 2020 2020 6d6f 636b  l").        mock
+00018440: 5f63 686f 6f73 652e 7265 7475 726e 5f76  _choose.return_v
+00018450: 616c 7565 203d 205b 2265 7861 6d70 6c65  alue = ["example
+00018460: 2e63 6f6d 222c 2022 616e 6f74 6865 722e  .com", "another.
+00018470: 746c 6422 5d0a 2020 2020 2020 2020 6d6f  tld"].        mo
+00018480: 636b 5f6c 696e 6561 6765 2e72 6574 7572  ck_lineage.retur
+00018490: 6e5f 7661 6c75 6520 3d20 6d6f 636b 2e4d  n_value = mock.M
+000184a0: 6167 6963 4d6f 636b 2863 6861 696e 5f70  agicMock(chain_p
+000184b0: 6174 683d 222f 746d 702f 6e6f 6e65 7869  ath="/tmp/nonexi
+000184c0: 7374 656e 7422 290a 2020 2020 2020 2020  stent").        
+000184d0: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
+000184e0: 6573 2865 7272 6f72 732e 4e6f 7453 7570  es(errors.NotSup
+000184f0: 706f 7274 6564 4572 726f 7229 3a0a 2020  portedError):.  
+00018500: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00018510: 6361 6c6c 285b 2765 6e68 616e 6365 272c  call(['enhance',
+00018520: 2027 2d2d 6175 746f 2d68 7374 7327 5d29   '--auto-hsts'])
+00018530: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+00018540: 6e68 616e 6365 6d65 6e74 5f65 6e61 626c  nhancement_enabl
+00018550: 655f 636f 6e66 6c69 6374 2873 656c 6629  e_conflict(self)
+00018560: 3a0a 2020 2020 2020 2020 7769 7468 2070  :.        with p
+00018570: 7974 6573 742e 7261 6973 6573 2865 7272  ytest.raises(err
+00018580: 6f72 732e 4572 726f 7229 3a0a 2020 2020  ors.Error):.    
+00018590: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+000185a0: 6c6c 285b 2765 6e68 616e 6365 272c 2027  ll(['enhance', '
+000185b0: 2d2d 6175 746f 2d68 7374 7327 2c20 272d  --auto-hsts', '-
+000185c0: 2d68 7374 7327 5d29 0a0a 0a63 6c61 7373  -hsts'])...class
+000185d0: 2049 6e73 7461 6c6c 5465 7374 2874 6573   InstallTest(tes
+000185e0: 745f 7574 696c 2e43 6f6e 6669 6754 6573  t_util.ConfigTes
+000185f0: 7443 6173 6529 3a0a 2020 2020 2222 2254  tCase):.    """T
+00018600: 6573 7473 2066 6f72 2063 6572 7462 6f74  ests for certbot
+00018610: 2e5f 696e 7465 726e 616c 2e6d 6169 6e2e  ._internal.main.
+00018620: 696e 7374 616c 6c2e 2222 220a 0a20 2020  install."""..   
+00018630: 2064 6566 2073 6574 5570 2873 656c 6629   def setUp(self)
+00018640: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
+00018650: 292e 7365 7455 7028 290a 2020 2020 2020  ).setUp().      
+00018660: 2020 7365 6c66 2e6d 6f63 6b69 6e73 7461    self.mockinsta
+00018670: 6c6c 6572 203d 206d 6f63 6b2e 4d61 6769  ller = mock.Magi
+00018680: 634d 6f63 6b28 7370 6563 3d65 6e68 616e  cMock(spec=enhan
+00018690: 6365 6d65 6e74 732e 4175 746f 4853 5453  cements.AutoHSTS
+000186a0: 456e 6861 6e63 656d 656e 7429 0a0a 2020  Enhancement)..  
+000186b0: 2020 406d 6f63 6b2e 7061 7463 6828 2763    @mock.patch('c
+000186c0: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+000186d0: 2e6d 6169 6e2e 706c 7567 5f73 656c 2e72  .main.plug_sel.r
+000186e0: 6563 6f72 645f 6368 6f73 656e 5f70 6c75  ecord_chosen_plu
+000186f0: 6769 6e73 2729 0a20 2020 2040 6d6f 636b  gins').    @mock
+00018700: 2e70 6174 6368 2827 6365 7274 626f 742e  .patch('certbot.
+00018710: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2e70  _internal.main.p
+00018720: 6c75 675f 7365 6c2e 7069 636b 5f69 6e73  lug_sel.pick_ins
+00018730: 7461 6c6c 6572 2729 0a20 2020 2064 6566  taller').    def
+00018740: 2074 6573 745f 696e 7374 616c 6c5f 656e   test_install_en
+00018750: 6861 6e63 656d 656e 745f 6e6f 745f 7375  hancement_not_su
+00018760: 7070 6f72 7465 6428 7365 6c66 2c20 6d6f  pported(self, mo
+00018770: 636b 5f69 6e73 742c 205f 7265 6329 3a0a  ck_inst, _rec):.
+00018780: 2020 2020 2020 2020 6d6f 636b 5f69 6e73          mock_ins
+00018790: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
+000187a0: 206e 756c 6c2e 496e 7374 616c 6c65 7228   null.Installer(
+000187b0: 7365 6c66 2e63 6f6e 6669 672c 2022 6e75  self.config, "nu
+000187c0: 6c6c 2229 0a20 2020 2020 2020 2070 6c75  ll").        plu
+000187d0: 6769 6e73 203d 2064 6973 636f 2e50 6c75  gins = disco.Plu
+000187e0: 6769 6e73 5265 6769 7374 7279 2e66 696e  ginsRegistry.fin
+000187f0: 645f 616c 6c28 290a 2020 2020 2020 2020  d_all().        
+00018800: 7365 6c66 2e63 6f6e 6669 672e 6175 746f  self.config.auto
+00018810: 5f68 7374 7320 3d20 5472 7565 0a20 2020  _hsts = True.   
+00018820: 2020 2020 2073 656c 662e 636f 6e66 6967       self.config
+00018830: 2e63 6572 746e 616d 6520 3d20 226e 6f6e  .certname = "non
+00018840: 6578 6973 7465 6e74 220a 2020 2020 2020  existent".      
+00018850: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
+00018860: 6973 6573 2865 7272 6f72 732e 4e6f 7453  ises(errors.NotS
+00018870: 7570 706f 7274 6564 4572 726f 7229 3a0a  upportedError):.
+00018880: 2020 2020 2020 2020 2020 2020 6d61 696e              main
+00018890: 2e69 6e73 7461 6c6c 2873 656c 662e 636f  .install(self.co
+000188a0: 6e66 6967 2c20 706c 7567 696e 7329 0a0a  nfig, plugins)..
+000188b0: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+000188c0: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+000188d0: 616c 2e6d 6169 6e2e 706c 7567 5f73 656c  al.main.plug_sel
+000188e0: 2e72 6563 6f72 645f 6368 6f73 656e 5f70  .record_chosen_p
+000188f0: 6c75 6769 6e73 2729 0a20 2020 2040 6d6f  lugins').    @mo
+00018900: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+00018910: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00018920: 2e70 6c75 675f 7365 6c2e 7069 636b 5f69  .plug_sel.pick_i
+00018930: 6e73 7461 6c6c 6572 2729 0a20 2020 2064  nstaller').    d
+00018940: 6566 2074 6573 745f 696e 7374 616c 6c5f  ef test_install_
+00018950: 656e 6861 6e63 656d 656e 745f 6e6f 5f63  enhancement_no_c
+00018960: 6572 746e 616d 6528 7365 6c66 2c20 6d6f  ertname(self, mo
+00018970: 636b 5f69 6e73 742c 205f 7265 6329 3a0a  ck_inst, _rec):.
+00018980: 2020 2020 2020 2020 6d6f 636b 5f69 6e73          mock_ins
+00018990: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
+000189a0: 2073 656c 662e 6d6f 636b 696e 7374 616c   self.mockinstal
+000189b0: 6c65 720a 2020 2020 2020 2020 706c 7567  ler.        plug
+000189c0: 696e 7320 3d20 6469 7363 6f2e 506c 7567  ins = disco.Plug
+000189d0: 696e 7352 6567 6973 7472 792e 6669 6e64  insRegistry.find
+000189e0: 5f61 6c6c 2829 0a20 2020 2020 2020 2073  _all().        s
+000189f0: 656c 662e 636f 6e66 6967 2e61 7574 6f5f  elf.config.auto_
+00018a00: 6873 7473 203d 2054 7275 650a 2020 2020  hsts = True.    
+00018a10: 2020 2020 7365 6c66 2e63 6f6e 6669 672e      self.config.
+00018a20: 6365 7274 6e61 6d65 203d 204e 6f6e 650a  certname = None.
+00018a30: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00018a40: 6669 672e 6b65 795f 7061 7468 203d 2022  fig.key_path = "
+00018a50: 2f74 6d70 2f6e 6f6e 6578 6973 7465 6e74  /tmp/nonexistent
+00018a60: 220a 2020 2020 2020 2020 7365 6c66 2e63  ".        self.c
+00018a70: 6f6e 6669 672e 6365 7274 5f70 6174 6820  onfig.cert_path 
+00018a80: 3d20 222f 746d 702f 6e6f 6e65 7869 7374  = "/tmp/nonexist
+00018a90: 656e 7422 0a20 2020 2020 2020 2077 6974  ent".        wit
+00018aa0: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
+00018ab0: 6572 726f 7273 2e43 6f6e 6669 6775 7261  errors.Configura
+00018ac0: 7469 6f6e 4572 726f 7229 3a0a 2020 2020  tionError):.    
+00018ad0: 2020 2020 2020 2020 6d61 696e 2e69 6e73          main.ins
+00018ae0: 7461 6c6c 2873 656c 662e 636f 6e66 6967  tall(self.config
+00018af0: 2c20 706c 7567 696e 7329 0a0a 0a63 6c61  , plugins)...cla
+00018b00: 7373 2052 6570 6f72 744e 6577 4365 7274  ss ReportNewCert
+00018b10: 5465 7374 2875 6e69 7474 6573 742e 5465  Test(unittest.Te
+00018b20: 7374 4361 7365 293a 0a20 2020 2022 2222  stCase):.    """
+00018b30: 5465 7374 7320 666f 7220 6365 7274 626f  Tests for certbo
+00018b40: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00018b50: 2e5f 7265 706f 7274 5f6e 6577 5f63 6572  ._report_new_cer
+00018b60: 7420 616e 640a 2020 2020 2020 2063 6572  t and.       cer
+00018b70: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+00018b80: 6169 6e2e 5f63 7372 5f72 6570 6f72 745f  ain._csr_report_
+00018b90: 6e65 775f 6365 7274 2e0a 2020 2020 2222  new_cert..    ""
+00018ba0: 220a 0a20 2020 2064 6566 2073 6574 5570  "..    def setUp
+00018bb0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00018bc0: 6672 6f6d 2064 6174 6574 696d 6520 696d  from datetime im
+00018bd0: 706f 7274 2064 6174 6574 696d 650a 2020  port datetime.  
+00018be0: 2020 2020 2020 7365 6c66 2e6e 6f74 6966        self.notif
+00018bf0: 795f 7061 7463 6820 3d20 6d6f 636b 2e70  y_patch = mock.p
+00018c00: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+00018c10: 6e74 6572 6e61 6c2e 6d61 696e 2e64 6973  nternal.main.dis
+00018c20: 706c 6179 5f75 7469 6c2e 6e6f 7469 6679  play_util.notify
+00018c30: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
+00018c40: 6d6f 636b 5f6e 6f74 6966 7920 3d20 7365  mock_notify = se
+00018c50: 6c66 2e6e 6f74 6966 795f 7061 7463 682e  lf.notify_patch.
+00018c60: 7374 6172 7428 290a 0a20 2020 2020 2020  start()..       
+00018c70: 2073 656c 662e 6e6f 7461 6674 6572 5f70   self.notafter_p
+00018c80: 6174 6368 203d 206d 6f63 6b2e 7061 7463  atch = mock.patc
+00018c90: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+00018ca0: 726e 616c 2e6d 6169 6e2e 6372 7970 746f  rnal.main.crypto
+00018cb0: 5f75 7469 6c2e 6e6f 7441 6674 6572 2729  _util.notAfter')
+00018cc0: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00018cd0: 636b 5f6e 6f74 6166 7465 7220 3d20 7365  ck_notafter = se
+00018ce0: 6c66 2e6e 6f74 6166 7465 725f 7061 7463  lf.notafter_patc
+00018cf0: 682e 7374 6172 7428 290a 2020 2020 2020  h.start().      
+00018d00: 2020 7365 6c66 2e6d 6f63 6b5f 6e6f 7461    self.mock_nota
+00018d10: 6674 6572 2e72 6574 7572 6e5f 7661 6c75  fter.return_valu
+00018d20: 6520 3d20 6461 7465 7469 6d65 2e75 7463  e = datetime.utc
+00018d30: 6672 6f6d 7469 6d65 7374 616d 7028 3029  fromtimestamp(0)
+00018d40: 0a0a 2020 2020 6465 6620 7465 6172 446f  ..    def tearDo
+00018d50: 776e 2873 656c 6629 3a0a 2020 2020 2020  wn(self):.      
+00018d60: 2020 7365 6c66 2e6e 6f74 6966 795f 7061    self.notify_pa
+00018d70: 7463 682e 7374 6f70 2829 0a20 2020 2020  tch.stop().     
+00018d80: 2020 2073 656c 662e 6e6f 7461 6674 6572     self.notafter
+00018d90: 5f70 6174 6368 2e73 746f 7028 290a 0a20  _patch.stop().. 
+00018da0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00018db0: 2020 2020 6465 6620 5f63 616c 6c28 636c      def _call(cl
+00018dc0: 732c 202a 6172 6773 2c20 2a2a 6b77 6172  s, *args, **kwar
+00018dd0: 6773 293a 0a20 2020 2020 2020 2066 726f  gs):.        fro
+00018de0: 6d20 6365 7274 626f 742e 5f69 6e74 6572  m certbot._inter
+00018df0: 6e61 6c2e 6d61 696e 2069 6d70 6f72 7420  nal.main import 
+00018e00: 5f72 6570 6f72 745f 6e65 775f 6365 7274  _report_new_cert
+00018e10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018e20: 5f72 6570 6f72 745f 6e65 775f 6365 7274  _report_new_cert
+00018e30: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+00018e40: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00018e50: 686f 640a 2020 2020 6465 6620 5f63 616c  hod.    def _cal
+00018e60: 6c5f 6373 7228 636c 732c 202a 6172 6773  l_csr(cls, *args
+00018e70: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00018e80: 2020 2020 2066 726f 6d20 6365 7274 626f       from certbo
+00018e90: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+00018ea0: 2069 6d70 6f72 7420 5f63 7372 5f72 6570   import _csr_rep
+00018eb0: 6f72 745f 6e65 775f 6365 7274 0a20 2020  ort_new_cert.   
+00018ec0: 2020 2020 2072 6574 7572 6e20 5f63 7372       return _csr
+00018ed0: 5f72 6570 6f72 745f 6e65 775f 6365 7274  _report_new_cert
+00018ee0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+00018ef0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00018f00: 7265 706f 7274 5f64 7279 5f72 756e 2873  report_dry_run(s
+00018f10: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+00018f20: 6c66 2e5f 6361 6c6c 286d 6f63 6b2e 4d6f  lf._call(mock.Mo
+00018f30: 636b 2864 7279 5f72 756e 3d54 7275 6529  ck(dry_run=True)
+00018f40: 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  , None, None, No
+00018f50: 6e65 290a 2020 2020 2020 2020 7365 6c66  ne).        self
+00018f60: 2e6d 6f63 6b5f 6e6f 7469 6679 2e61 7373  .mock_notify.ass
+00018f70: 6572 745f 6361 6c6c 6564 5f77 6974 6828  ert_called_with(
+00018f80: 2254 6865 2064 7279 2072 756e 2077 6173  "The dry run was
+00018f90: 2073 7563 6365 7373 6675 6c2e 2229 0a0a   successful.")..
+00018fa0: 2020 2020 6465 6620 7465 7374 5f63 7372      def test_csr
+00018fb0: 5f72 6570 6f72 745f 6472 795f 7275 6e28  _report_dry_run(
+00018fc0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+00018fd0: 656c 662e 5f63 616c 6c5f 6373 7228 6d6f  elf._call_csr(mo
+00018fe0: 636b 2e4d 6f63 6b28 6472 795f 7275 6e3d  ck.Mock(dry_run=
+00018ff0: 5472 7565 292c 204e 6f6e 652c 204e 6f6e  True), None, Non
+00019000: 652c 204e 6f6e 6529 0a20 2020 2020 2020  e, None).       
+00019010: 2073 656c 662e 6d6f 636b 5f6e 6f74 6966   self.mock_notif
+00019020: 792e 6173 7365 7274 5f63 616c 6c65 645f  y.assert_called_
+00019030: 7769 7468 2822 5468 6520 6472 7920 7275  with("The dry ru
+00019040: 6e20 7761 7320 7375 6363 6573 7366 756c  n was successful
+00019050: 2e22 290a 0a20 2020 2064 6566 2074 6573  .")..    def tes
+00019060: 745f 7265 706f 7274 5f6e 6f5f 7061 7468  t_report_no_path
+00019070: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00019080: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+00019090: 7365 7328 4173 7365 7274 696f 6e45 7272  ses(AssertionErr
+000190a0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+000190b0: 2073 656c 662e 5f63 616c 6c28 6d6f 636b   self._call(mock
+000190c0: 2e4d 6f63 6b28 6472 795f 7275 6e3d 4661  .Mock(dry_run=Fa
+000190d0: 6c73 6529 2c20 4e6f 6e65 2c20 4e6f 6e65  lse), None, None
+000190e0: 2c20 4e6f 6e65 290a 0a20 2020 2020 2020  , None)..       
+000190f0: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+00019100: 7365 7328 4173 7365 7274 696f 6e45 7272  ses(AssertionErr
+00019110: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00019120: 2073 656c 662e 5f63 616c 6c5f 6373 7228   self._call_csr(
+00019130: 6d6f 636b 2e4d 6f63 6b28 6472 795f 7275  mock.Mock(dry_ru
+00019140: 6e3d 4661 6c73 6529 2c20 4e6f 6e65 2c20  n=False), None, 
+00019150: 4e6f 6e65 2c20 4e6f 6e65 290a 0a20 2020  None, None)..   
+00019160: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
+00019170: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00019180: 7365 6c66 2e5f 6361 6c6c 286d 6f63 6b2e  self._call(mock.
+00019190: 4d6f 636b 2864 7279 5f72 756e 3d46 616c  Mock(dry_run=Fal
+000191a0: 7365 292c 0a20 2020 2020 2020 2020 2020  se),.           
+000191b0: 2020 2020 2020 2027 2f70 6174 682f 746f         '/path/to
+000191c0: 2f63 6572 742e 7065 6d27 2c20 272f 7061  /cert.pem', '/pa
+000191d0: 7468 2f74 6f2f 6675 6c6c 6368 6169 6e2e  th/to/fullchain.
+000191e0: 7065 6d27 2c0a 2020 2020 2020 2020 2020  pem',.          
+000191f0: 2020 2020 2020 2020 272f 7061 7468 2f74          '/path/t
+00019200: 6f2f 7072 6976 6b65 792e 7065 6d27 290a  o/privkey.pem').
+00019210: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00019220: 636b 5f6e 6f74 6966 792e 6173 7365 7274  ck_notify.assert
+00019230: 5f63 616c 6c65 645f 7769 7468 280a 2020  _called_with(.  
+00019240: 2020 2020 2020 2020 2020 275c 6e53 7563            '\nSuc
+00019250: 6365 7373 6675 6c6c 7920 7265 6365 6976  cessfully receiv
+00019260: 6564 2063 6572 7469 6669 6361 7465 2e5c  ed certificate.\
+00019270: 6e27 0a20 2020 2020 2020 2020 2020 2027  n'.            '
+00019280: 4365 7274 6966 6963 6174 6520 6973 2073  Certificate is s
+00019290: 6176 6564 2061 743a 202f 7061 7468 2f74  aved at: /path/t
+000192a0: 6f2f 6675 6c6c 6368 6169 6e2e 7065 6d5c  o/fullchain.pem\
+000192b0: 6e27 0a20 2020 2020 2020 2020 2020 2027  n'.            '
+000192c0: 4b65 7920 6973 2073 6176 6564 2061 743a  Key is saved at:
+000192d0: 2020 2020 2020 2020 202f 7061 7468 2f74           /path/t
+000192e0: 6f2f 7072 6976 6b65 792e 7065 6d5c 6e27  o/privkey.pem\n'
+000192f0: 0a20 2020 2020 2020 2020 2020 2027 5468  .            'Th
+00019300: 6973 2063 6572 7469 6669 6361 7465 2065  is certificate e
+00019310: 7870 6972 6573 206f 6e20 3139 3730 2d30  xpires on 1970-0
+00019320: 312d 3031 2e5c 6e27 0a20 2020 2020 2020  1-01.\n'.       
+00019330: 2020 2020 2027 5468 6573 6520 6669 6c65       'These file
+00019340: 7320 7769 6c6c 2062 6520 7570 6461 7465  s will be update
+00019350: 6420 7768 656e 2074 6865 2063 6572 7469  d when the certi
+00019360: 6669 6361 7465 2072 656e 6577 732e 5c6e  ficate renews.\n
+00019370: 270a 2020 2020 2020 2020 2020 2020 2743  '.            'C
+00019380: 6572 7462 6f74 2068 6173 2073 6574 2075  ertbot has set u
+00019390: 7020 6120 7363 6865 6475 6c65 6420 7461  p a scheduled ta
+000193a0: 736b 2074 6f20 6175 746f 6d61 7469 6361  sk to automatica
+000193b0: 6c6c 7920 7265 6e65 7720 7468 6973 2027  lly renew this '
+000193c0: 0a20 2020 2020 2020 2020 2020 2027 6365  .            'ce
+000193d0: 7274 6966 6963 6174 6520 696e 2074 6865  rtificate in the
+000193e0: 2062 6163 6b67 726f 756e 642e 270a 2020   background.'.  
+000193f0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00019400: 2074 6573 745f 7265 706f 7274 5f6e 6f5f   test_report_no_
+00019410: 6b65 7928 7365 6c66 293a 0a20 2020 2020  key(self):.     
+00019420: 2020 2073 656c 662e 5f63 616c 6c28 6d6f     self._call(mo
+00019430: 636b 2e4d 6f63 6b28 6472 795f 7275 6e3d  ck.Mock(dry_run=
+00019440: 4661 6c73 6529 2c0a 2020 2020 2020 2020  False),.        
+00019450: 2020 2020 2020 2020 2020 272f 7061 7468            '/path
+00019460: 2f74 6f2f 6365 7274 2e70 656d 272c 2027  /to/cert.pem', '
+00019470: 2f70 6174 682f 746f 2f66 756c 6c63 6861  /path/to/fullcha
+00019480: 696e 2e70 656d 272c 0a20 2020 2020 2020  in.pem',.       
+00019490: 2020 2020 2020 2020 2020 204e 6f6e 6529             None)
+000194a0: 0a0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+000194b0: 6f63 6b5f 6e6f 7469 6679 2e61 7373 6572  ock_notify.asser
+000194c0: 745f 6361 6c6c 6564 5f77 6974 6828 0a20  t_called_with(. 
+000194d0: 2020 2020 2020 2020 2020 2027 5c6e 5375             '\nSu
+000194e0: 6363 6573 7366 756c 6c79 2072 6563 6569  ccessfully recei
+000194f0: 7665 6420 6365 7274 6966 6963 6174 652e  ved certificate.
+00019500: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+00019510: 2743 6572 7469 6669 6361 7465 2069 7320  'Certificate is 
+00019520: 7361 7665 6420 6174 3a20 2f70 6174 682f  saved at: /path/
+00019530: 746f 2f66 756c 6c63 6861 696e 2e70 656d  to/fullchain.pem
+00019540: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+00019550: 2754 6869 7320 6365 7274 6966 6963 6174  'This certificat
+00019560: 6520 6578 7069 7265 7320 6f6e 2031 3937  e expires on 197
+00019570: 302d 3031 2d30 312e 5c6e 270a 2020 2020  0-01-01.\n'.    
+00019580: 2020 2020 2020 2020 2754 6865 7365 2066          'These f
+00019590: 696c 6573 2077 696c 6c20 6265 2075 7064  iles will be upd
+000195a0: 6174 6564 2077 6865 6e20 7468 6520 6365  ated when the ce
+000195b0: 7274 6966 6963 6174 6520 7265 6e65 7773  rtificate renews
+000195c0: 2e5c 6e27 0a20 2020 2020 2020 2020 2020  .\n'.           
+000195d0: 2027 4365 7274 626f 7420 6861 7320 7365   'Certbot has se
+000195e0: 7420 7570 2061 2073 6368 6564 756c 6564  t up a scheduled
+000195f0: 2074 6173 6b20 746f 2061 7574 6f6d 6174   task to automat
+00019600: 6963 616c 6c79 2072 656e 6577 2074 6869  ically renew thi
+00019610: 7320 270a 2020 2020 2020 2020 2020 2020  s '.            
+00019620: 2763 6572 7469 6669 6361 7465 2069 6e20  'certificate in 
+00019630: 7468 6520 6261 636b 6772 6f75 6e64 2e27  the background.'
+00019640: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00019650: 6465 6620 7465 7374 5f72 6570 6f72 745f  def test_report_
+00019660: 6e6f 5f70 7265 636f 6e66 6967 7572 6564  no_preconfigured
+00019670: 5f72 656e 6577 616c 2873 656c 6629 3a0a  _renewal(self):.
+00019680: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+00019690: 6c6c 286d 6f63 6b2e 4d6f 636b 2864 7279  ll(mock.Mock(dry
+000196a0: 5f72 756e 3d46 616c 7365 2c20 7072 6563  _run=False, prec
+000196b0: 6f6e 6669 6775 7265 645f 7265 6e65 7761  onfigured_renewa
+000196c0: 6c3d 4661 6c73 6529 2c0a 2020 2020 2020  l=False),.      
+000196d0: 2020 2020 2020 2020 2020 2020 272f 7061              '/pa
+000196e0: 7468 2f74 6f2f 6365 7274 2e70 656d 272c  th/to/cert.pem',
+000196f0: 2027 2f70 6174 682f 746f 2f66 756c 6c63   '/path/to/fullc
+00019700: 6861 696e 2e70 656d 272c 0a20 2020 2020  hain.pem',.     
+00019710: 2020 2020 2020 2020 2020 2020 2027 2f70               '/p
+00019720: 6174 682f 746f 2f70 7269 766b 6579 2e70  ath/to/privkey.p
+00019730: 656d 2729 0a0a 2020 2020 2020 2020 7365  em')..        se
+00019740: 6c66 2e6d 6f63 6b5f 6e6f 7469 6679 2e61  lf.mock_notify.a
+00019750: 7373 6572 745f 6361 6c6c 6564 5f77 6974  ssert_called_wit
+00019760: 6828 0a20 2020 2020 2020 2020 2020 2027  h(.            '
+00019770: 5c6e 5375 6363 6573 7366 756c 6c79 2072  \nSuccessfully r
+00019780: 6563 6569 7665 6420 6365 7274 6966 6963  eceived certific
+00019790: 6174 652e 5c6e 270a 2020 2020 2020 2020  ate.\n'.        
+000197a0: 2020 2020 2743 6572 7469 6669 6361 7465      'Certificate
+000197b0: 2069 7320 7361 7665 6420 6174 3a20 2f70   is saved at: /p
+000197c0: 6174 682f 746f 2f66 756c 6c63 6861 696e  ath/to/fullchain
+000197d0: 2e70 656d 5c6e 270a 2020 2020 2020 2020  .pem\n'.        
+000197e0: 2020 2020 274b 6579 2069 7320 7361 7665      'Key is save
+000197f0: 6420 6174 3a20 2020 2020 2020 2020 2f70  d at:         /p
+00019800: 6174 682f 746f 2f70 7269 766b 6579 2e70  ath/to/privkey.p
+00019810: 656d 5c6e 270a 2020 2020 2020 2020 2020  em\n'.          
+00019820: 2020 2754 6869 7320 6365 7274 6966 6963    'This certific
+00019830: 6174 6520 6578 7069 7265 7320 6f6e 2031  ate expires on 1
+00019840: 3937 302d 3031 2d30 312e 5c6e 270a 2020  970-01-01.\n'.  
+00019850: 2020 2020 2020 2020 2020 2754 6865 7365            'These
+00019860: 2066 696c 6573 2077 696c 6c20 6265 2075   files will be u
+00019870: 7064 6174 6564 2077 6865 6e20 7468 6520  pdated when the 
+00019880: 6365 7274 6966 6963 6174 6520 7265 6e65  certificate rene
+00019890: 7773 2e27 0a20 2020 2020 2020 2029 0a0a  ws.'.        )..
+000198a0: 2020 2020 6465 6620 7465 7374 5f63 7372      def test_csr
+000198b0: 5f72 6570 6f72 7428 7365 6c66 293a 0a20  _report(self):. 
+000198c0: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
+000198d0: 6c5f 6373 7228 6d6f 636b 2e4d 6f63 6b28  l_csr(mock.Mock(
+000198e0: 6472 795f 7275 6e3d 4661 6c73 6529 2c20  dry_run=False), 
+000198f0: 272f 7061 7468 2f74 6f2f 6365 7274 2e70  '/path/to/cert.p
+00019900: 656d 272c 0a20 2020 2020 2020 2020 2020  em',.           
+00019910: 2020 2020 2020 2020 2020 2027 2f70 6174             '/pat
+00019920: 682f 746f 2f63 6861 696e 2e70 656d 272c  h/to/chain.pem',
+00019930: 2027 2f70 6174 682f 746f 2f66 756c 6c63   '/path/to/fullc
+00019940: 6861 696e 2e70 656d 2729 0a0a 2020 2020  hain.pem')..    
+00019950: 2020 2020 7365 6c66 2e6d 6f63 6b5f 6e6f      self.mock_no
+00019960: 7469 6679 2e61 7373 6572 745f 6361 6c6c  tify.assert_call
+00019970: 6564 5f77 6974 6828 0a20 2020 2020 2020  ed_with(.       
+00019980: 2020 2020 2027 5c6e 5375 6363 6573 7366       '\nSuccessf
+00019990: 756c 6c79 2072 6563 6569 7665 6420 6365  ully received ce
+000199a0: 7274 6966 6963 6174 652e 5c6e 270a 2020  rtificate.\n'.  
+000199b0: 2020 2020 2020 2020 2020 2743 6572 7469            'Certi
+000199c0: 6669 6361 7465 2069 7320 7361 7665 6420  ficate is saved 
+000199d0: 6174 3a20 2020 2020 2020 2020 2020 202f  at:            /
+000199e0: 7061 7468 2f74 6f2f 6365 7274 2e70 656d  path/to/cert.pem
+000199f0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+00019a00: 2749 6e74 6572 6d65 6469 6174 6520 4341  'Intermediate CA
+00019a10: 2063 6861 696e 2069 7320 7361 7665 6420   chain is saved 
+00019a20: 6174 3a20 202f 7061 7468 2f74 6f2f 6368  at:  /path/to/ch
+00019a30: 6169 6e2e 7065 6d5c 6e27 0a20 2020 2020  ain.pem\n'.     
+00019a40: 2020 2020 2020 2027 4675 6c6c 2063 6572         'Full cer
+00019a50: 7469 6669 6361 7465 2063 6861 696e 2069  tificate chain i
+00019a60: 7320 7361 7665 6420 6174 3a20 2f70 6174  s saved at: /pat
+00019a70: 682f 746f 2f66 756c 6c63 6861 696e 2e70  h/to/fullchain.p
+00019a80: 656d 5c6e 270a 2020 2020 2020 2020 2020  em\n'.          
+00019a90: 2020 2754 6869 7320 6365 7274 6966 6963    'This certific
+00019aa0: 6174 6520 6578 7069 7265 7320 6f6e 2031  ate expires on 1
+00019ab0: 3937 302d 3031 2d30 312e 270a 2020 2020  970-01-01.'.    
+00019ac0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+00019ad0: 6573 745f 6d61 6e75 616c 5f6e 6f5f 686f  est_manual_no_ho
+00019ae0: 6f6b 735f 7265 706f 7274 2873 656c 6629  oks_report(self)
+00019af0: 3a0a 2020 2020 2020 2020 2222 2253 686f  :.        """Sho
+00019b00: 756c 646e 2774 2067 6574 2061 206d 6573  uldn't get a mes
+00019b10: 7361 6765 2061 626f 7574 2061 7574 6f72  sage about autor
+00019b20: 656e 6577 616c 2069 6620 6e6f 202d 2d6d  enewal if no --m
+00019b30: 616e 7561 6c2d 6175 7468 2d68 6f6f 6b22  anual-auth-hook"
+00019b40: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+00019b50: 5f63 616c 6c28 6d6f 636b 2e4d 6f63 6b28  _call(mock.Mock(
+00019b60: 6472 795f 7275 6e3d 4661 6c73 652c 2061  dry_run=False, a
+00019b70: 7574 6865 6e74 6963 6174 6f72 3d27 6d61  uthenticator='ma
+00019b80: 6e75 616c 272c 206d 616e 7561 6c5f 6175  nual', manual_au
+00019b90: 7468 5f68 6f6f 6b3d 4e6f 6e65 292c 0a20  th_hook=None),. 
+00019ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bb0: 2027 2f70 6174 682f 746f 2f63 6572 742e   '/path/to/cert.
+00019bc0: 7065 6d27 2c20 272f 7061 7468 2f74 6f2f  pem', '/path/to/
+00019bd0: 6675 6c6c 6368 6169 6e2e 7065 6d27 2c0a  fullchain.pem',.
+00019be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bf0: 2020 272f 7061 7468 2f74 6f2f 7072 6976    '/path/to/priv
+00019c00: 6b65 792e 7065 6d27 290a 0a20 2020 2020  key.pem')..     
+00019c10: 2020 2073 656c 662e 6d6f 636b 5f6e 6f74     self.mock_not
+00019c20: 6966 792e 6173 7365 7274 5f63 616c 6c65  ify.assert_calle
+00019c30: 645f 7769 7468 280a 2020 2020 2020 2020  d_with(.        
+00019c40: 2020 2020 275c 6e53 7563 6365 7373 6675      '\nSuccessfu
+00019c50: 6c6c 7920 7265 6365 6976 6564 2063 6572  lly received cer
+00019c60: 7469 6669 6361 7465 2e5c 6e27 0a20 2020  tificate.\n'.   
+00019c70: 2020 2020 2020 2020 2027 4365 7274 6966           'Certif
+00019c80: 6963 6174 6520 6973 2073 6176 6564 2061  icate is saved a
+00019c90: 743a 202f 7061 7468 2f74 6f2f 6675 6c6c  t: /path/to/full
+00019ca0: 6368 6169 6e2e 7065 6d5c 6e27 0a20 2020  chain.pem\n'.   
+00019cb0: 2020 2020 2020 2020 2027 4b65 7920 6973           'Key is
+00019cc0: 2073 6176 6564 2061 743a 2020 2020 2020   saved at:      
+00019cd0: 2020 202f 7061 7468 2f74 6f2f 7072 6976     /path/to/priv
+00019ce0: 6b65 792e 7065 6d5c 6e27 0a20 2020 2020  key.pem\n'.     
+00019cf0: 2020 2020 2020 2027 5468 6973 2063 6572         'This cer
+00019d00: 7469 6669 6361 7465 2065 7870 6972 6573  tificate expires
+00019d10: 206f 6e20 3139 3730 2d30 312d 3031 2e5c   on 1970-01-01.\
+00019d20: 6e27 0a20 2020 2020 2020 2020 2020 2027  n'.            '
+00019d30: 5468 6573 6520 6669 6c65 7320 7769 6c6c  These files will
+00019d40: 2062 6520 7570 6461 7465 6420 7768 656e   be updated when
+00019d50: 2074 6865 2063 6572 7469 6669 6361 7465   the certificate
+00019d60: 2072 656e 6577 732e 270a 2020 2020 2020   renews.'.      
+00019d70: 2020 290a 0a0a 636c 6173 7320 5265 706f    )...class Repo
+00019d80: 7274 4e65 7874 5374 6570 7354 6573 7428  rtNextStepsTest(
+00019d90: 756e 6974 7465 7374 2e54 6573 7443 6173  unittest.TestCas
+00019da0: 6529 3a0a 2020 2020 2222 2254 6573 7473  e):.    """Tests
+00019db0: 2066 6f72 2063 6572 7462 6f74 2e5f 696e   for certbot._in
+00019dc0: 7465 726e 616c 2e6d 6169 6e2e 5f72 6570  ternal.main._rep
+00019dd0: 6f72 745f 6e65 7874 5f73 7465 7073 2222  ort_next_steps""
+00019de0: 220a 0a20 2020 2064 6566 2073 6574 5570  "..    def setUp
+00019df0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00019e00: 7365 6c66 2e63 6f6e 6669 6720 3d20 6d6f  self.config = mo
+00019e10: 636b 2e4d 6167 6963 4d6f 636b 280a 2020  ck.MagicMock(.  
+00019e20: 2020 2020 2020 2020 2020 6365 7274 5f6e            cert_n
+00019e30: 616d 653d 2265 7861 6d70 6c65 2e63 6f6d  ame="example.com
+00019e40: 222c 2070 7265 636f 6e66 6967 7572 6564  ", preconfigured
+00019e50: 5f72 656e 6577 616c 3d54 7275 652c 0a20  _renewal=True,. 
+00019e60: 2020 2020 2020 2020 2020 2063 7372 3d4e             csr=N
+00019e70: 6f6e 652c 2061 7574 6865 6e74 6963 6174  one, authenticat
+00019e80: 6f72 3d22 6e67 696e 7822 2c20 6d61 6e75  or="nginx", manu
+00019e90: 616c 5f61 7574 685f 686f 6f6b 3d4e 6f6e  al_auth_hook=Non
+00019ea0: 6529 0a20 2020 2020 2020 206e 6f74 6966  e).        notif
+00019eb0: 795f 7061 7463 6820 3d20 6d6f 636b 2e70  y_patch = mock.p
+00019ec0: 6174 6368 2827 6365 7274 626f 742e 5f69  atch('certbot._i
+00019ed0: 6e74 6572 6e61 6c2e 6d61 696e 2e64 6973  nternal.main.dis
+00019ee0: 706c 6179 5f75 7469 6c2e 6e6f 7469 6679  play_util.notify
+00019ef0: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
+00019f00: 6d6f 636b 5f6e 6f74 6966 7920 3d20 6e6f  mock_notify = no
+00019f10: 7469 6679 5f70 6174 6368 2e73 7461 7274  tify_patch.start
+00019f20: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00019f30: 6164 6443 6c65 616e 7570 286e 6f74 6966  addCleanup(notif
+00019f40: 795f 7061 7463 682e 7374 6f70 290a 2020  y_patch.stop).  
+00019f50: 2020 2020 2020 7365 6c66 2e6f 6c64 5f73        self.old_s
+00019f60: 7464 6f75 7420 3d20 7379 732e 7374 646f  tdout = sys.stdo
+00019f70: 7574 0a20 2020 2020 2020 2073 7973 2e73  ut.        sys.s
+00019f80: 7464 6f75 7420 3d20 696f 2e53 7472 696e  tdout = io.Strin
+00019f90: 6749 4f28 290a 0a20 2020 2064 6566 2074  gIO()..    def t
+00019fa0: 6561 7244 6f77 6e28 7365 6c66 293a 0a20  earDown(self):. 
+00019fb0: 2020 2020 2020 2073 7973 2e73 7464 6f75         sys.stdou
+00019fc0: 7420 3d20 7365 6c66 2e6f 6c64 5f73 7464  t = self.old_std
+00019fd0: 6f75 740a 0a20 2020 2040 636c 6173 736d  out..    @classm
+00019fe0: 6574 686f 640a 2020 2020 6465 6620 5f63  ethod.    def _c
+00019ff0: 616c 6c28 636c 732c 202a 6172 6773 2c20  all(cls, *args, 
+0001a000: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0001a010: 2020 2066 726f 6d20 6365 7274 626f 742e     from certbot.
+0001a020: 5f69 6e74 6572 6e61 6c2e 6d61 696e 2069  _internal.main i
+0001a030: 6d70 6f72 7420 5f72 6570 6f72 745f 6e65  mport _report_ne
+0001a040: 7874 5f73 7465 7073 0a20 2020 2020 2020  xt_steps.       
+0001a050: 205f 7265 706f 7274 5f6e 6578 745f 7374   _report_next_st
+0001a060: 6570 7328 2a61 7267 732c 202a 2a6b 7761  eps(*args, **kwa
+0001a070: 7267 7329 0a0a 2020 2020 6465 6620 5f6f  rgs)..    def _o
+0001a080: 7574 7075 7428 7365 6c66 2920 2d3e 2073  utput(self) -> s
+0001a090: 7472 3a0a 2020 2020 2020 2020 6173 7365  tr:.        asse
+0001a0a0: 7274 2073 656c 662e 6d6f 636b 5f6e 6f74  rt self.mock_not
+0001a0b0: 6966 792e 6361 6c6c 5f63 6f75 6e74 203d  ify.call_count =
+0001a0c0: 3d20 320a 2020 2020 2020 2020 6173 7365  = 2.        asse
+0001a0d0: 7274 2073 656c 662e 6d6f 636b 5f6e 6f74  rt self.mock_not
+0001a0e0: 6966 792e 6361 6c6c 5f61 7267 735f 6c69  ify.call_args_li
+0001a0f0: 7374 5b30 5d5b 305d 5b30 5d20 3d3d 2027  st[0][0][0] == '
+0001a100: 4e45 5854 2053 5445 5053 3a27 0a20 2020  NEXT STEPS:'.   
+0001a110: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001a120: 2e6d 6f63 6b5f 6e6f 7469 6679 2e63 616c  .mock_notify.cal
+0001a130: 6c5f 6172 6773 5f6c 6973 745b 315d 5b30  l_args_list[1][0
+0001a140: 5d5b 305d 0a0a 2020 2020 6465 6620 7465  ][0]..    def te
+0001a150: 7374 5f72 6570 6f72 7428 7365 6c66 293a  st_report(self):
+0001a160: 0a20 2020 2020 2020 2022 2222 4e6f 2073  .        """No s
+0001a170: 7465 7073 2066 6f72 2061 206e 6f72 6d61  teps for a norma
+0001a180: 6c20 7265 6e65 7761 6c22 2222 0a20 2020  l renewal""".   
+0001a190: 2020 2020 2073 656c 662e 636f 6e66 6967       self.config
+0001a1a0: 2e61 7574 6865 6e74 6963 6174 6f72 203d  .authenticator =
+0001a1b0: 2022 6d61 6e75 616c 220a 2020 2020 2020   "manual".      
+0001a1c0: 2020 7365 6c66 2e63 6f6e 6669 672e 6d61    self.config.ma
+0001a1d0: 6e75 616c 5f61 7574 685f 686f 6f6b 203d  nual_auth_hook =
+0001a1e0: 2022 2f62 696e 2f74 7275 6522 0a20 2020   "/bin/true".   
+0001a1f0: 2020 2020 2073 656c 662e 5f63 616c 6c28       self._call(
+0001a200: 7365 6c66 2e63 6f6e 6669 672c 204e 6f6e  self.config, Non
+0001a210: 652c 204e 6f6e 6529 0a20 2020 2020 2020  e, None).       
+0001a220: 2073 656c 662e 6d6f 636b 5f6e 6f74 6966   self.mock_notif
+0001a230: 792e 6173 7365 7274 5f6e 6f74 5f63 616c  y.assert_not_cal
+0001a240: 6c65 6428 290a 0a20 2020 2064 6566 2074  led()..    def t
+0001a250: 6573 745f 6373 725f 7265 706f 7274 2873  est_csr_report(s
+0001a260: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001a270: 222d 2d63 7372 2072 6571 7569 7265 7320  "--csr requires 
+0001a280: 6d61 6e75 616c 2072 656e 6577 616c 2222  manual renewal""
+0001a290: 220a 2020 2020 2020 2020 7365 6c66 2e63  ".        self.c
+0001a2a0: 6f6e 6669 672e 6373 7220 3d20 2266 6f6f  onfig.csr = "foo
+0001a2b0: 2e63 7372 220a 2020 2020 2020 2020 7365  .csr".        se
+0001a2c0: 6c66 2e5f 6361 6c6c 2873 656c 662e 636f  lf._call(self.co
+0001a2d0: 6e66 6967 2c20 4e6f 6e65 2c20 4e6f 6e65  nfig, None, None
+0001a2e0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+0001a2f0: 2022 2d2d 6373 7220 7769 6c6c 206e 6f74   "--csr will not
+0001a300: 2062 6520 7265 6e65 7765 6422 2069 6e20   be renewed" in 
+0001a310: 7365 6c66 2e5f 6f75 7470 7574 2829 0a0a  self._output()..
+0001a320: 2020 2020 6465 6620 7465 7374 5f6d 616e      def test_man
+0001a330: 7561 6c5f 6e6f 5f68 6f6f 6b5f 7265 6e65  ual_no_hook_rene
+0001a340: 7761 6c28 7365 6c66 293a 0a20 2020 2020  wal(self):.     
+0001a350: 2020 2022 2222 2d2d 6d61 6e75 616c 2077     """--manual w
+0001a360: 6974 686f 7574 2061 2068 6f6f 6b20 7265  ithout a hook re
+0001a370: 7175 6972 6573 206d 616e 7561 6c20 7265  quires manual re
+0001a380: 6e65 7761 6c22 2222 0a20 2020 2020 2020  newal""".       
+0001a390: 2073 656c 662e 636f 6e66 6967 2e61 7574   self.config.aut
+0001a3a0: 6865 6e74 6963 6174 6f72 203d 2022 6d61  henticator = "ma
+0001a3b0: 6e75 616c 220a 2020 2020 2020 2020 7365  nual".        se
+0001a3c0: 6c66 2e5f 6361 6c6c 2873 656c 662e 636f  lf._call(self.co
+0001a3d0: 6e66 6967 2c20 4e6f 6e65 2c20 4e6f 6e65  nfig, None, None
+0001a3e0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+0001a3f0: 2022 2d2d 6d61 6e75 616c 2063 6572 7469   "--manual certi
+0001a400: 6669 6361 7465 7320 7265 7175 6972 6573  ficates requires
+0001a410: 2220 696e 2073 656c 662e 5f6f 7574 7075  " in self._outpu
+0001a420: 7428 290a 0a20 2020 2064 6566 2074 6573  t()..    def tes
+0001a430: 745f 6e6f 5f70 7265 636f 6e66 6967 7572  t_no_preconfigur
+0001a440: 6564 5f72 656e 6577 616c 2873 656c 6629  ed_renewal(self)
+0001a450: 3a0a 2020 2020 2020 2020 2222 224e 6f20  :.        """No 
+0001a460: 2d2d 7072 6563 6f6e 6669 6775 7265 642d  --preconfigured-
+0001a470: 7265 6e65 7761 6c20 6e65 6564 7320 6d61  renewal needs ma
+0001a480: 6e75 616c 2063 726f 6e20 7365 7475 7022  nual cron setup"
+0001a490: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0001a4a0: 636f 6e66 6967 2e70 7265 636f 6e66 6967  config.preconfig
+0001a4b0: 7572 6564 5f72 656e 6577 616c 203d 2046  ured_renewal = F
+0001a4c0: 616c 7365 0a20 2020 2020 2020 2073 656c  alse.        sel
+0001a4d0: 662e 5f63 616c 6c28 7365 6c66 2e63 6f6e  f._call(self.con
+0001a4e0: 6669 672c 204e 6f6e 652c 204e 6f6e 6529  fig, None, None)
+0001a4f0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0001a500: 2268 7474 7073 3a2f 2f63 6572 7462 6f74  "https://certbot
+0001a510: 2e6f 7267 2f72 656e 6577 616c 2d73 6574  .org/renewal-set
+0001a520: 7570 2220 696e 2073 656c 662e 5f6f 7574  up" in self._out
+0001a530: 7075 7428 290a 0a0a 636c 6173 7320 5570  put()...class Up
+0001a540: 6461 7465 4163 636f 756e 7454 6573 7428  dateAccountTest(
+0001a550: 7465 7374 5f75 7469 6c2e 436f 6e66 6967  test_util.Config
+0001a560: 5465 7374 4361 7365 293a 0a20 2020 2022  TestCase):.    "
+0001a570: 2222 5465 7374 7320 666f 7220 6365 7274  ""Tests for cert
+0001a580: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+0001a590: 696e 2e75 7064 6174 655f 6163 636f 756e  in.update_accoun
+0001a5a0: 7422 2222 0a0a 2020 2020 6465 6620 7365  t"""..    def se
+0001a5b0: 7455 7028 7365 6c66 293a 0a20 2020 2020  tUp(self):.     
+0001a5c0: 2020 2070 6174 6368 6573 203d 207b 0a20     patches = {. 
+0001a5d0: 2020 2020 2020 2020 2020 2027 6163 636f             'acco
+0001a5e0: 756e 7427 3a20 6d6f 636b 2e70 6174 6368  unt': mock.patch
+0001a5f0: 2827 6365 7274 626f 742e 5f69 6e74 6572  ('certbot._inter
+0001a600: 6e61 6c2e 6d61 696e 2e61 6363 6f75 6e74  nal.main.account
+0001a610: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+0001a620: 2761 7465 7869 7427 3a20 6d6f 636b 2e70  'atexit': mock.p
+0001a630: 6174 6368 2827 6365 7274 626f 742e 7574  atch('certbot.ut
+0001a640: 696c 2e61 7465 7869 7427 292c 0a20 2020  il.atexit'),.   
+0001a650: 2020 2020 2020 2020 2027 636c 6965 6e74           'client
+0001a660: 273a 206d 6f63 6b2e 7061 7463 6828 2763  ': mock.patch('c
+0001a670: 6572 7462 6f74 2e5f 696e 7465 726e 616c  ertbot._internal
+0001a680: 2e6d 6169 6e2e 636c 6965 6e74 2729 2c0a  .main.client'),.
+0001a690: 2020 2020 2020 2020 2020 2020 2764 6574              'det
+0001a6a0: 6572 6d69 6e65 5f61 6363 6f75 6e74 273a  ermine_account':
+0001a6b0: 206d 6f63 6b2e 7061 7463 6828 2763 6572   mock.patch('cer
+0001a6c0: 7462 6f74 2e5f 696e 7465 726e 616c 2e6d  tbot._internal.m
+0001a6d0: 6169 6e2e 5f64 6574 6572 6d69 6e65 5f61  ain._determine_a
+0001a6e0: 6363 6f75 6e74 2729 2c0a 2020 2020 2020  ccount'),.      
+0001a6f0: 2020 2020 2020 276e 6f74 6966 7927 3a20        'notify': 
+0001a700: 6d6f 636b 2e70 6174 6368 2827 6365 7274  mock.patch('cert
+0001a710: 626f 742e 5f69 6e74 6572 6e61 6c2e 6d61  bot._internal.ma
+0001a720: 696e 2e64 6973 706c 6179 5f75 7469 6c2e  in.display_util.
+0001a730: 6e6f 7469 6679 2729 2c0a 2020 2020 2020  notify'),.      
+0001a740: 2020 2020 2020 2770 7265 7061 7265 5f73        'prepare_s
+0001a750: 7562 273a 206d 6f63 6b2e 7061 7463 6828  ub': mock.patch(
+0001a760: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+0001a770: 616c 2e65 6666 2e70 7265 7061 7265 5f73  al.eff.prepare_s
+0001a780: 7562 7363 7269 7074 696f 6e27 292c 0a20  ubscription'),. 
+0001a790: 2020 2020 2020 2020 2020 2027 7574 696c             'util
+0001a7a0: 273a 2074 6573 745f 7574 696c 2e70 6174  ': test_util.pat
+0001a7b0: 6368 5f64 6973 706c 6179 5f75 7469 6c28  ch_display_util(
+0001a7c0: 290a 2020 2020 2020 2020 7d0a 2020 2020  ).        }.    
+0001a7d0: 2020 2020 7365 6c66 2e6d 6f63 6b73 203d      self.mocks =
+0001a7e0: 207b 206b 3a20 7061 7463 6865 735b 6b5d   { k: patches[k]
+0001a7f0: 2e73 7461 7274 2829 2066 6f72 206b 2069  .start() for k i
+0001a800: 6e20 7061 7463 6865 7320 7d0a 2020 2020  n patches }.    
+0001a810: 2020 2020 666f 7220 7061 7463 6820 696e      for patch in
+0001a820: 2070 6174 6368 6573 2e76 616c 7565 7328   patches.values(
+0001a830: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0001a840: 656c 662e 6164 6443 6c65 616e 7570 2870  elf.addCleanup(p
+0001a850: 6174 6368 2e73 746f 7029 0a0a 2020 2020  atch.stop)..    
+0001a860: 2020 2020 7265 7475 726e 2073 7570 6572      return super
+0001a870: 2829 2e73 6574 5570 2829 0a0a 2020 2020  ().setUp()..    
+0001a880: 6465 6620 5f63 616c 6c28 7365 6c66 2c20  def _call(self, 
+0001a890: 6172 6773 293a 0a20 2020 2020 2020 2077  args):.        w
+0001a8a0: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+0001a8b0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0001a8c0: 6c2e 6d61 696e 2e73 7973 2e73 7464 6f75  l.main.sys.stdou
+0001a8d0: 7427 292c 205c 0a20 2020 2020 2020 2020  t'), \.         
+0001a8e0: 2020 2020 6d6f 636b 2e70 6174 6368 2827      mock.patch('
+0001a8f0: 6365 7274 626f 742e 5f69 6e74 6572 6e61  certbot._interna
+0001a900: 6c2e 6d61 696e 2e73 7973 2e73 7464 6572  l.main.sys.stder
+0001a910: 7227 293a 0a20 2020 2020 2020 2020 2020  r'):.           
+0001a920: 2061 7267 7320 3d20 5b27 2d2d 636f 6e66   args = ['--conf
+0001a930: 6967 2d64 6972 272c 2073 656c 662e 636f  ig-dir', self.co
+0001a940: 6e66 6967 2e63 6f6e 6669 675f 6469 722c  nfig.config_dir,
+0001a950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a960: 2020 2020 2027 2d2d 776f 726b 2d64 6972       '--work-dir
+0001a970: 272c 2073 656c 662e 636f 6e66 6967 2e77  ', self.config.w
+0001a980: 6f72 6b5f 6469 722c 0a20 2020 2020 2020  ork_dir,.       
+0001a990: 2020 2020 2020 2020 2020 2020 2027 2d2d               '--
+0001a9a0: 6c6f 6773 2d64 6972 272c 2073 656c 662e  logs-dir', self.
+0001a9b0: 636f 6e66 6967 2e6c 6f67 735f 6469 722c  config.logs_dir,
+0001a9c0: 2027 2d2d 7465 7874 275d 202b 2061 7267   '--text'] + arg
+0001a9d0: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
+0001a9e0: 7475 726e 206d 6169 6e2e 6d61 696e 2861  turn main.main(a
+0001a9f0: 7267 735b 3a5d 2920 2320 4e4f 5445 3a20  rgs[:]) # NOTE: 
+0001aa00: 7061 7273 6572 2063 616e 2061 6c74 6572  parser can alter
+0001aa10: 2069 7473 2061 7267 7321 0a0a 2020 2020   its args!..    
+0001aa20: 6465 6620 5f70 7265 7061 7265 5f6d 6f63  def _prepare_moc
+0001aa30: 6b5f 6163 636f 756e 7428 7365 6c66 293a  k_account(self):
+0001aa40: 0a20 2020 2020 2020 206d 6f63 6b5f 7374  .        mock_st
+0001aa50: 6f72 6167 6520 3d20 6d6f 636b 2e4d 6167  orage = mock.Mag
+0001aa60: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
+0001aa70: 206d 6f63 6b5f 6163 636f 756e 7420 3d20   mock_account = 
+0001aa80: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2829  mock.MagicMock()
+0001aa90: 0a20 2020 2020 2020 206d 6f63 6b5f 7265  .        mock_re
+0001aaa0: 6772 203d 206d 6f63 6b2e 4d61 6769 634d  gr = mock.MagicM
+0001aab0: 6f63 6b28 290a 2020 2020 2020 2020 6d6f  ock().        mo
+0001aac0: 636b 5f73 746f 7261 6765 2e66 696e 645f  ck_storage.find_
+0001aad0: 616c 6c2e 7265 7475 726e 5f76 616c 7565  all.return_value
+0001aae0: 203d 205b 6d6f 636b 5f61 6363 6f75 6e74   = [mock_account
+0001aaf0: 5d0a 2020 2020 2020 2020 7365 6c66 2e6d  ].        self.m
+0001ab00: 6f63 6b73 5b27 6163 636f 756e 7427 5d2e  ocks['account'].
+0001ab10: 4163 636f 756e 7446 696c 6553 746f 7261  AccountFileStora
+0001ab20: 6765 2e72 6574 7572 6e5f 7661 6c75 6520  ge.return_value 
+0001ab30: 3d20 6d6f 636b 5f73 746f 7261 6765 0a20  = mock_storage. 
+0001ab40: 2020 2020 2020 206d 6f63 6b5f 6163 636f         mock_acco
+0001ab50: 756e 742e 7265 6772 2e62 6f64 7920 3d20  unt.regr.body = 
+0001ab60: 6d6f 636b 5f72 6567 722e 626f 6479 0a20  mock_regr.body. 
+0001ab70: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
+0001ab80: 735b 2764 6574 6572 6d69 6e65 5f61 6363  s['determine_acc
+0001ab90: 6f75 6e74 275d 2e72 6574 7572 6e5f 7661  ount'].return_va
+0001aba0: 6c75 6520 3d20 286d 6f63 6b5f 6163 636f  lue = (mock_acco
+0001abb0: 756e 742c 206d 6f63 6b2e 4d61 6769 634d  unt, mock.MagicM
+0001abc0: 6f63 6b28 2929 0a20 2020 2020 2020 2072  ock()).        r
+0001abd0: 6574 7572 6e20 286d 6f63 6b5f 6163 636f  eturn (mock_acco
+0001abe0: 756e 742c 206d 6f63 6b5f 7374 6f72 6167  unt, mock_storag
+0001abf0: 652c 206d 6f63 6b5f 7265 6772 290a 0a20  e, mock_regr).. 
+0001ac00: 2020 2064 6566 205f 7465 7374 5f75 7064     def _test_upd
+0001ac10: 6174 655f 6e6f 5f63 6f6e 7461 6374 2873  ate_no_contact(s
+0001ac20: 656c 662c 2061 7267 7329 3a0a 2020 2020  elf, args):.    
+0001ac30: 2020 2020 2222 2255 7469 6c69 7479 2074      """Utility t
+0001ac40: 6f20 6173 7365 7274 2074 6861 7420 656d  o assert that em
+0001ac50: 6169 6c20 7265 6d6f 7661 6c20 6973 2068  ail removal is h
+0001ac60: 616e 646c 6564 2063 6f72 7265 6374 6c79  andled correctly
+0001ac70: 2222 220a 2020 2020 2020 2020 285f 2c20  """.        (_, 
+0001ac80: 6d6f 636b 5f73 746f 7261 6765 2c20 6d6f  mock_storage, mo
+0001ac90: 636b 5f72 6567 7229 203d 2073 656c 662e  ck_regr) = self.
+0001aca0: 5f70 7265 7061 7265 5f6d 6f63 6b5f 6163  _prepare_mock_ac
+0001acb0: 636f 756e 7428 290a 2020 2020 2020 2020  count().        
+0001acc0: 7265 7375 6c74 203d 2073 656c 662e 5f63  result = self._c
+0001acd0: 616c 6c28 6172 6773 290a 2020 2020 2020  all(args).      
+0001ace0: 2020 2320 5768 656e 2075 7064 6174 6520    # When update 
+0001acf0: 7375 6363 6565 6473 2c20 7468 6520 7265  succeeds, the re
+0001ad00: 7475 726e 2076 616c 7565 206f 6620 7570  turn value of up
+0001ad10: 6461 7465 5f61 6363 6f75 6e74 2829 2069  date_account() i
+0001ad20: 7320 4e6f 6e65 0a20 2020 2020 2020 2061  s None.        a
+0001ad30: 7373 6572 7420 7265 7375 6c74 2069 7320  ssert result is 
+0001ad40: 4e6f 6e65 0a20 2020 2020 2020 2023 2057  None.        # W
+0001ad50: 6520 7375 626d 6974 7465 6420 6120 7265  e submitted a re
+0001ad60: 6769 7374 7261 7469 6f6e 2074 6f20 7468  gistration to th
+0001ad70: 6520 7365 7276 6572 0a20 2020 2020 2020  e server.       
+0001ad80: 2061 7373 6572 7420 7365 6c66 2e6d 6f63   assert self.moc
+0001ad90: 6b73 5b27 636c 6965 6e74 275d 2e43 6c69  ks['client'].Cli
+0001ada0: 656e 7428 292e 6163 6d65 2e75 7064 6174  ent().acme.updat
+0001adb0: 655f 7265 6769 7374 7261 7469 6f6e 2e63  e_registration.c
+0001adc0: 616c 6c5f 636f 756e 7420 3d3d 2031 0a20  all_count == 1. 
+0001add0: 2020 2020 2020 206d 6f63 6b5f 7265 6772         mock_regr
+0001ade0: 2e62 6f64 792e 7570 6461 7465 2e61 7373  .body.update.ass
+0001adf0: 6572 745f 6361 6c6c 6564 5f77 6974 6828  ert_called_with(
+0001ae00: 636f 6e74 6163 743d 2829 290a 2020 2020  contact=()).    
+0001ae10: 2020 2020 2320 5765 2067 6f74 2061 6e20      # We got an 
+0001ae20: 7570 6461 7465 2066 726f 6d20 7468 6520  update from the 
+0001ae30: 7365 7276 6572 2061 6e64 2070 6572 7369  server and persi
+0001ae40: 7374 6564 2069 740a 2020 2020 2020 2020  sted it.        
+0001ae50: 6173 7365 7274 206d 6f63 6b5f 7374 6f72  assert mock_stor
+0001ae60: 6167 652e 7570 6461 7465 5f72 6567 722e  age.update_regr.
+0001ae70: 6361 6c6c 5f63 6f75 6e74 203d 3d20 310a  call_count == 1.
+0001ae80: 2020 2020 2020 2020 2320 5765 2073 686f          # We sho
+0001ae90: 756c 6420 6861 7665 206e 6f74 6966 6965  uld have notifie
+0001aea0: 6420 7468 6520 7573 6572 0a20 2020 2020  d the user.     
+0001aeb0: 2020 2073 656c 662e 6d6f 636b 735b 276e     self.mocks['n
+0001aec0: 6f74 6966 7927 5d2e 6173 7365 7274 5f63  otify'].assert_c
+0001aed0: 616c 6c65 645f 7769 7468 280a 2020 2020  alled_with(.    
+0001aee0: 2020 2020 2020 2020 2741 6e79 2063 6f6e          'Any con
+0001aef0: 7461 6374 2069 6e66 6f72 6d61 7469 6f6e  tact information
+0001af00: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+0001af10: 2074 6869 7320 6163 636f 756e 7420 6861   this account ha
+0001af20: 7320 6265 656e 2072 656d 6f76 6564 2e27  s been removed.'
+0001af30: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001af40: 2020 2023 2057 6520 7368 6f75 6c64 206e     # We should n
+0001af50: 6f74 2068 6176 6520 6361 6c6c 6564 2073  ot have called s
+0001af60: 7562 7363 7269 7074 696f 6e20 6265 6361  ubscription beca
+0001af70: 7573 6520 7468 6572 6527 7320 6e6f 2065  use there's no e
+0001af80: 6d61 696c 0a20 2020 2020 2020 2073 656c  mail.        sel
+0001af90: 662e 6d6f 636b 735b 2770 7265 7061 7265  f.mocks['prepare
+0001afa0: 5f73 7562 275d 2e61 7373 6572 745f 6e6f  _sub'].assert_no
+0001afb0: 745f 6361 6c6c 6564 2829 0a0a 2020 2020  t_called()..    
+0001afc0: 6465 6620 7465 7374 5f6e 6f5f 6578 6973  def test_no_exis
+0001afd0: 7469 6e67 5f61 6363 6f75 6e74 7328 7365  ting_accounts(se
+0001afe0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0001aff0: 5465 7374 2074 6861 7420 6e6f 2065 7869  Test that no exi
+0001b000: 7374 696e 6720 6163 636f 756e 7420 6973  sting account is
+0001b010: 2068 616e 646c 6564 2063 6f72 7265 6374   handled correct
+0001b020: 6c79 2222 220a 2020 2020 2020 2020 6d6f  ly""".        mo
+0001b030: 636b 5f73 746f 7261 6765 203d 206d 6f63  ck_storage = moc
+0001b040: 6b2e 4d61 6769 634d 6f63 6b28 290a 2020  k.MagicMock().  
+0001b050: 2020 2020 2020 6d6f 636b 5f73 746f 7261        mock_stora
+0001b060: 6765 2e66 696e 645f 616c 6c2e 7265 7475  ge.find_all.retu
+0001b070: 726e 5f76 616c 7565 203d 205b 5d0a 2020  rn_value = [].  
+0001b080: 2020 2020 2020 7365 6c66 2e6d 6f63 6b73        self.mocks
+0001b090: 5b27 6163 636f 756e 7427 5d2e 4163 636f  ['account'].Acco
+0001b0a0: 756e 7446 696c 6553 746f 7261 6765 2e72  untFileStorage.r
+0001b0b0: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
+0001b0c0: 636b 5f73 746f 7261 6765 0a20 2020 2020  ck_storage.     
+0001b0d0: 2020 2061 7373 6572 7420 7365 6c66 2e5f     assert self._
+0001b0e0: 6361 6c6c 285b 2775 7064 6174 655f 6163  call(['update_ac
+0001b0f0: 636f 756e 7427 2c20 272d 2d65 6d61 696c  count', '--email
+0001b100: 272c 2027 7573 6572 4065 7861 6d70 6c65  ', 'user@example
+0001b110: 2e6f 7267 275d 2920 3d3d 205c 0a20 2020  .org']) == \.   
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 2020 2020 2020 2743 6f75 6c64 206e 6f74        'Could not
+0001b140: 2066 696e 6420 616e 2065 7869 7374 696e   find an existin
+0001b150: 6720 6163 636f 756e 7420 666f 7220 7365  g account for se
+0001b160: 7276 6572 2720 5c0a 2020 2020 2020 2020  rver' \.        
+0001b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b180: 2027 2068 7474 7073 3a2f 2f61 636d 652d   ' https://acme-
+0001b190: 7630 322e 6170 692e 6c65 7473 656e 6372  v02.api.letsencr
+0001b1a0: 7970 742e 6f72 672f 6469 7265 6374 6f72  ypt.org/director
+0001b1b0: 792e 270a 0a20 2020 2064 6566 2074 6573  y.'..    def tes
+0001b1c0: 745f 7570 6461 7465 5f61 6363 6f75 6e74  t_update_account
+0001b1d0: 5f72 656d 6f76 655f 656d 6169 6c28 7365  _remove_email(se
+0001b1e0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0001b1f0: 5465 7374 2074 6861 7420 2d2d 7265 6769  Test that --regi
+0001b200: 7374 6572 2d75 6e73 6166 656c 792d 7769  ster-unsafely-wi
+0001b210: 7468 6f75 742d 656d 6169 6c20 6973 2068  thout-email is h
+0001b220: 616e 646c 6564 2061 7320 6e6f 2065 6d61  andled as no ema
+0001b230: 696c 2222 220a 2020 2020 2020 2020 7365  il""".        se
+0001b240: 6c66 2e5f 7465 7374 5f75 7064 6174 655f  lf._test_update_
+0001b250: 6e6f 5f63 6f6e 7461 6374 285b 2775 7064  no_contact(['upd
+0001b260: 6174 655f 6163 636f 756e 7427 2c20 272d  ate_account', '-
+0001b270: 2d72 6567 6973 7465 722d 756e 7361 6665  -register-unsafe
+0001b280: 6c79 2d77 6974 686f 7574 2d65 6d61 696c  ly-without-email
+0001b290: 275d 290a 0a20 2020 2064 6566 2074 6573  '])..    def tes
+0001b2a0: 745f 7570 6461 7465 5f61 6363 6f75 6e74  t_update_account
+0001b2b0: 5f65 6d70 7479 5f65 6d61 696c 2873 656c  _empty_email(sel
+0001b2c0: 6629 3a0a 2020 2020 2020 2020 2222 2254  f):.        """T
+0001b2d0: 6573 7420 7468 6174 2070 726f 7669 6469  est that providi
+0001b2e0: 6e67 2061 6e20 656d 7074 7920 656d 6169  ng an empty emai
+0001b2f0: 6c20 6973 2068 616e 646c 6564 2061 7320  l is handled as 
+0001b300: 6e6f 2065 6d61 696c 2222 220a 2020 2020  no email""".    
+0001b310: 2020 2020 7365 6c66 2e5f 7465 7374 5f75      self._test_u
+0001b320: 7064 6174 655f 6e6f 5f63 6f6e 7461 6374  pdate_no_contact
+0001b330: 285b 2775 7064 6174 655f 6163 636f 756e  (['update_accoun
+0001b340: 7427 2c20 272d 6d27 2c20 2727 5d29 0a0a  t', '-m', ''])..
+0001b350: 2020 2020 406d 6f63 6b2e 7061 7463 6828      @mock.patch(
+0001b360: 2763 6572 7462 6f74 2e5f 696e 7465 726e  'certbot._intern
+0001b370: 616c 2e6d 6169 6e2e 6469 7370 6c61 795f  al.main.display_
+0001b380: 6f70 732e 6765 745f 656d 6169 6c27 290a  ops.get_email').
+0001b390: 2020 2020 6465 6620 7465 7374 5f75 7064      def test_upd
+0001b3a0: 6174 655f 6163 636f 756e 745f 7769 7468  ate_account_with
+0001b3b0: 5f65 6d61 696c 2873 656c 662c 206d 6f63  _email(self, moc
+0001b3c0: 6b5f 656d 6169 6c29 3a0a 2020 2020 2020  k_email):.      
+0001b3d0: 2020 2222 2254 6573 7420 7468 6174 2075    """Test that u
+0001b3e0: 7064 6174 696e 6720 7769 7468 2061 2073  pdating with a s
+0001b3f0: 696e 6775 6c61 7220 656d 6169 6c20 6973  ingular email is
+0001b400: 2068 616e 646c 6564 2063 6f72 7265 6374   handled correct
+0001b410: 6c79 2222 220a 2020 2020 2020 2020 6d6f  ly""".        mo
+0001b420: 636b 5f65 6d61 696c 2e72 6574 7572 6e5f  ck_email.return_
+0001b430: 7661 6c75 6520 3d20 2775 7365 7240 6578  value = 'user@ex
+0001b440: 616d 706c 652e 636f 6d27 0a20 2020 2020  ample.com'.     
+0001b450: 2020 2028 5f2c 206d 6f63 6b5f 7374 6f72     (_, mock_stor
+0001b460: 6167 652c 205f 2920 3d20 7365 6c66 2e5f  age, _) = self._
+0001b470: 7072 6570 6172 655f 6d6f 636b 5f61 6363  prepare_mock_acc
+0001b480: 6f75 6e74 2829 0a20 2020 2020 2020 206d  ount().        m
+0001b490: 6f63 6b5f 636c 6965 6e74 203d 206d 6f63  ock_client = moc
+0001b4a0: 6b2e 4d61 6769 634d 6f63 6b28 290a 2020  k.MagicMock().  
+0001b4b0: 2020 2020 2020 7365 6c66 2e6d 6f63 6b73        self.mocks
+0001b4c0: 5b27 636c 6965 6e74 275d 2e43 6c69 656e  ['client'].Clien
+0001b4d0: 742e 7265 7475 726e 5f76 616c 7565 203d  t.return_value =
+0001b4e0: 206d 6f63 6b5f 636c 6965 6e74 0a0a 2020   mock_client..  
+0001b4f0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+0001b500: 656c 662e 5f63 616c 6c28 5b27 7570 6461  elf._call(['upda
+0001b510: 7465 5f61 6363 6f75 6e74 275d 290a 2020  te_account']).  
+0001b520: 2020 2020 2020 2320 4e6f 6e65 2069 6620        # None if 
+0001b530: 7265 6769 7374 7261 7469 6f6e 2073 7563  registration suc
+0001b540: 6365 6564 730a 2020 2020 2020 2020 6173  ceeds.        as
+0001b550: 7365 7274 2072 6573 756c 7420 6973 204e  sert result is N
+0001b560: 6f6e 650a 2020 2020 2020 2020 2320 5765  one.        # We
+0001b570: 2073 686f 756c 6420 6861 7665 2075 7064   should have upd
+0001b580: 6174 6564 2074 6865 2073 6572 7665 720a  ated the server.
+0001b590: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
+0001b5a0: 6f63 6b5f 636c 6965 6e74 2e61 636d 652e  ock_client.acme.
+0001b5b0: 7570 6461 7465 5f72 6567 6973 7472 6174  update_registrat
+0001b5c0: 696f 6e2e 6361 6c6c 5f63 6f75 6e74 203d  ion.call_count =
+0001b5d0: 3d20 310a 2020 2020 2020 2020 2320 5765  = 1.        # We
+0001b5e0: 2073 686f 756c 6420 6861 7665 2075 7064   should have upd
+0001b5f0: 6174 6564 2074 6865 2061 6363 6f75 6e74  ated the account
+0001b600: 206f 6e20 6469 736b 0a20 2020 2020 2020   on disk.       
+0001b610: 2061 7373 6572 7420 6d6f 636b 5f73 746f   assert mock_sto
+0001b620: 7261 6765 2e75 7064 6174 655f 7265 6772  rage.update_regr
+0001b630: 2e63 616c 6c5f 636f 756e 7420 3d3d 2031  .call_count == 1
+0001b640: 0a20 2020 2020 2020 2023 2053 7562 7363  .        # Subsc
+0001b650: 7269 7074 696f 6e20 7368 6f75 6c64 2068  ription should h
+0001b660: 6176 6520 6265 656e 2070 726f 6d70 7465  ave been prompte
+0001b670: 640a 2020 2020 2020 2020 6173 7365 7274  d.        assert
+0001b680: 2073 656c 662e 6d6f 636b 735b 2770 7265   self.mocks['pre
+0001b690: 7061 7265 5f73 7562 275d 2e63 616c 6c5f  pare_sub'].call_
+0001b6a0: 636f 756e 7420 3d3d 2031 0a20 2020 2020  count == 1.     
+0001b6b0: 2020 2023 2053 686f 756c 6420 6861 7665     # Should have
+0001b6c0: 2070 7269 6e74 6564 2074 6865 2065 6d61   printed the ema
+0001b6d0: 696c 0a20 2020 2020 2020 2073 656c 662e  il.        self.
+0001b6e0: 6d6f 636b 735b 276e 6f74 6966 7927 5d2e  mocks['notify'].
+0001b6f0: 6173 7365 7274 5f63 616c 6c65 645f 7769  assert_called_wi
+0001b700: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
+0001b710: 2759 6f75 7220 652d 6d61 696c 2061 6464  'Your e-mail add
+0001b720: 7265 7373 2077 6173 2075 7064 6174 6564  ress was updated
+0001b730: 2074 6f20 7573 6572 4065 7861 6d70 6c65   to user@example
+0001b740: 2e63 6f6d 2e27 290a 0a20 2020 2064 6566  .com.')..    def
+0001b750: 2074 6573 745f 7570 6461 7465 5f61 6363   test_update_acc
+0001b760: 6f75 6e74 5f77 6974 685f 6d75 6c74 6970  ount_with_multip
+0001b770: 6c65 5f65 6d61 696c 7328 7365 6c66 293a  le_emails(self):
+0001b780: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
+0001b790: 2074 6861 7420 6d75 6c74 6970 6c65 2065   that multiple e
+0001b7a0: 6d61 696c 2061 6464 7265 7373 6573 2061  mail addresses a
+0001b7b0: 7265 2068 616e 646c 6564 2063 6f72 7265  re handled corre
+0001b7c0: 6374 6c79 2222 220a 2020 2020 2020 2020  ctly""".        
+0001b7d0: 285f 2c20 6d6f 636b 5f73 746f 7261 6765  (_, mock_storage
+0001b7e0: 2c20 6d6f 636b 5f72 6567 7229 203d 2073  , mock_regr) = s
+0001b7f0: 656c 662e 5f70 7265 7061 7265 5f6d 6f63  elf._prepare_moc
+0001b800: 6b5f 6163 636f 756e 7428 290a 2020 2020  k_account().    
+0001b810: 2020 2020 6173 7365 7274 2073 656c 662e      assert self.
+0001b820: 5f63 616c 6c28 5b27 7570 6461 7465 5f61  _call(['update_a
+0001b830: 6363 6f75 6e74 272c 2027 2d6d 272c 2027  ccount', '-m', '
+0001b840: 7573 6572 4065 7861 6d70 6c65 2e63 6f6d  user@example.com
+0001b850: 2c75 7365 7240 6578 616d 706c 652e 6f72  ,user@example.or
+0001b860: 6727 5d29 2069 7320 4e6f 6e65 0a20 2020  g']) is None.   
+0001b870: 2020 2020 206d 6f63 6b5f 7265 6772 2e62       mock_regr.b
+0001b880: 6f64 792e 7570 6461 7465 2e61 7373 6572  ody.update.asser
+0001b890: 745f 6361 6c6c 6564 5f77 6974 6828 0a20  t_called_with(. 
+0001b8a0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+0001b8b0: 6374 3d5b 276d 6169 6c74 6f3a 7573 6572  ct=['mailto:user
+0001b8c0: 4065 7861 6d70 6c65 2e63 6f6d 272c 2027  @example.com', '
+0001b8d0: 6d61 696c 746f 3a75 7365 7240 6578 616d  mailto:user@exam
+0001b8e0: 706c 652e 6f72 6727 5d0a 2020 2020 2020  ple.org'].      
+0001b8f0: 2020 290a 2020 2020 2020 2020 6173 7365    ).        asse
+0001b900: 7274 206d 6f63 6b5f 7374 6f72 6167 652e  rt mock_storage.
+0001b910: 7570 6461 7465 5f72 6567 722e 6361 6c6c  update_regr.call
+0001b920: 5f63 6f75 6e74 203d 3d20 310a 2020 2020  _count == 1.    
+0001b930: 2020 2020 7365 6c66 2e6d 6f63 6b73 5b27      self.mocks['
+0001b940: 6e6f 7469 6679 275d 2e61 7373 6572 745f  notify'].assert_
+0001b950: 6361 6c6c 6564 5f77 6974 6828 0a20 2020  called_with(.   
+0001b960: 2020 2020 2020 2020 2027 596f 7572 2065           'Your e
+0001b970: 2d6d 6169 6c20 6164 6472 6573 7320 7761  -mail address wa
+0001b980: 7320 7570 6461 7465 6420 746f 2075 7365  s updated to use
+0001b990: 7240 6578 616d 706c 652e 636f 6d2c 7573  r@example.com,us
+0001b9a0: 6572 4065 7861 6d70 6c65 2e6f 7267 2e27  er@example.org.'
+0001b9b0: 290a 0a0a 636c 6173 7320 5368 6f77 4163  )...class ShowAc
+0001b9c0: 636f 756e 7454 6573 7428 7465 7374 5f75  countTest(test_u
+0001b9d0: 7469 6c2e 436f 6e66 6967 5465 7374 4361  til.ConfigTestCa
+0001b9e0: 7365 293a 0a20 2020 2022 2222 5465 7374  se):.    """Test
+0001b9f0: 7320 666f 7220 6365 7274 626f 742e 5f69  s for certbot._i
+0001ba00: 6e74 6572 6e61 6c2e 6d61 696e 2e73 686f  nternal.main.sho
+0001ba10: 775f 6163 636f 756e 7422 2222 0a0a 2020  w_account"""..  
+0001ba20: 2020 6465 6620 7365 7455 7028 7365 6c66    def setUp(self
+0001ba30: 293a 0a20 2020 2020 2020 2070 6174 6368  ):.        patch
+0001ba40: 6573 203d 207b 0a20 2020 2020 2020 2020  es = {.         
+0001ba50: 2020 2027 6163 636f 756e 7427 3a20 6d6f     'account': mo
+0001ba60: 636b 2e70 6174 6368 2827 6365 7274 626f  ck.patch('certbo
+0001ba70: 742e 5f69 6e74 6572 6e61 6c2e 6d61 696e  t._internal.main
+0001ba80: 2e61 6363 6f75 6e74 2729 2c0a 2020 2020  .account'),.    
+0001ba90: 2020 2020 2020 2020 2761 7465 7869 7427          'atexit'
+0001baa0: 3a20 6d6f 636b 2e70 6174 6368 2827 6365  : mock.patch('ce
+0001bab0: 7274 626f 742e 7574 696c 2e61 7465 7869  rtbot.util.atexi
+0001bac0: 7427 292c 0a20 2020 2020 2020 2020 2020  t'),.           
+0001bad0: 2027 636c 6965 6e74 273a 206d 6f63 6b2e   'client': mock.
+0001bae0: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+0001baf0: 696e 7465 726e 616c 2e6d 6169 6e2e 636c  internal.main.cl
+0001bb00: 6965 6e74 2729 2c0a 2020 2020 2020 2020  ient'),.        
+0001bb10: 2020 2020 2764 6574 6572 6d69 6e65 5f61      'determine_a
+0001bb20: 6363 6f75 6e74 273a 206d 6f63 6b2e 7061  ccount': mock.pa
+0001bb30: 7463 6828 2763 6572 7462 6f74 2e5f 696e  tch('certbot._in
+0001bb40: 7465 726e 616c 2e6d 6169 6e2e 5f64 6574  ternal.main._det
+0001bb50: 6572 6d69 6e65 5f61 6363 6f75 6e74 2729  ermine_account')
+0001bb60: 2c0a 2020 2020 2020 2020 2020 2020 276e  ,.            'n
+0001bb70: 6f74 6966 7927 3a20 6d6f 636b 2e70 6174  otify': mock.pat
+0001bb80: 6368 2827 6365 7274 626f 742e 5f69 6e74  ch('certbot._int
+0001bb90: 6572 6e61 6c2e 6d61 696e 2e64 6973 706c  ernal.main.displ
+0001bba0: 6179 5f75 7469 6c2e 6e6f 7469 6679 2729  ay_util.notify')
+0001bbb0: 2c0a 2020 2020 2020 2020 2020 2020 2775  ,.            'u
+0001bbc0: 7469 6c27 3a20 7465 7374 5f75 7469 6c2e  til': test_util.
+0001bbd0: 7061 7463 685f 6469 7370 6c61 795f 7574  patch_display_ut
+0001bbe0: 696c 2829 0a20 2020 2020 2020 207d 0a20  il().        }. 
+0001bbf0: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
+0001bc00: 7320 3d20 7b20 6b3a 2070 6174 6368 6573  s = { k: patches
+0001bc10: 5b6b 5d2e 7374 6172 7428 2920 666f 7220  [k].start() for 
+0001bc20: 6b20 696e 2070 6174 6368 6573 207d 0a20  k in patches }. 
+0001bc30: 2020 2020 2020 2066 6f72 2070 6174 6368         for patch
+0001bc40: 2069 6e20 7061 7463 6865 732e 7661 6c75   in patches.valu
+0001bc50: 6573 2829 3a0a 2020 2020 2020 2020 2020  es():.          
+0001bc60: 2020 7365 6c66 2e61 6464 436c 6561 6e75    self.addCleanu
+0001bc70: 7028 7061 7463 682e 7374 6f70 290a 0a20  p(patch.stop).. 
+0001bc80: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+0001bc90: 7065 7228 292e 7365 7455 7028 290a 0a20  per().setUp().. 
+0001bca0: 2020 2064 6566 205f 6361 6c6c 2873 656c     def _call(sel
+0001bcb0: 662c 2061 7267 7329 3a0a 2020 2020 2020  f, args):.      
+0001bcc0: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+0001bcd0: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+0001bce0: 726e 616c 2e6d 6169 6e2e 7379 732e 7374  rnal.main.sys.st
+0001bcf0: 646f 7574 2729 2c20 5c0a 2020 2020 2020  dout'), \.      
+0001bd00: 2020 2020 2020 206d 6f63 6b2e 7061 7463         mock.patc
+0001bd10: 6828 2763 6572 7462 6f74 2e5f 696e 7465  h('certbot._inte
+0001bd20: 726e 616c 2e6d 6169 6e2e 7379 732e 7374  rnal.main.sys.st
+0001bd30: 6465 7272 2729 3a0a 2020 2020 2020 2020  derr'):.        
+0001bd40: 2020 2020 6172 6773 203d 205b 272d 2d63      args = ['--c
+0001bd50: 6f6e 6669 672d 6469 7227 2c20 7365 6c66  onfig-dir', self
+0001bd60: 2e63 6f6e 6669 672e 636f 6e66 6967 5f64  .config.config_d
+0001bd70: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+0001bd80: 2020 2020 2020 2020 272d 2d77 6f72 6b2d          '--work-
+0001bd90: 6469 7227 2c20 7365 6c66 2e63 6f6e 6669  dir', self.confi
+0001bda0: 672e 776f 726b 5f64 6972 2c0a 2020 2020  g.work_dir,.    
+0001bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bdc0: 272d 2d6c 6f67 732d 6469 7227 2c20 7365  '--logs-dir', se
+0001bdd0: 6c66 2e63 6f6e 6669 672e 6c6f 6773 5f64  lf.config.logs_d
+0001bde0: 6972 2c20 272d 2d74 6578 7427 5d20 2b20  ir, '--text'] + 
+0001bdf0: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
+0001be00: 2072 6574 7572 6e20 6d61 696e 2e6d 6169   return main.mai
+0001be10: 6e28 6172 6773 5b3a 5d29 2023 204e 4f54  n(args[:]) # NOT
+0001be20: 453a 2070 6172 7365 7220 6361 6e20 616c  E: parser can al
+0001be30: 7465 7220 6974 7320 6172 6773 210a 0a20  ter its args!.. 
+0001be40: 2020 2064 6566 205f 7072 6570 6172 655f     def _prepare_
+0001be50: 6d6f 636b 5f61 6363 6f75 6e74 2873 656c  mock_account(sel
+0001be60: 6629 3a0a 2020 2020 2020 2020 6d6f 636b  f):.        mock
+0001be70: 5f73 746f 7261 6765 203d 206d 6f63 6b2e  _storage = mock.
+0001be80: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+0001be90: 2020 2020 6d6f 636b 5f61 6363 6f75 6e74      mock_account
+0001bea0: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
+0001beb0: 6b28 290a 2020 2020 2020 2020 6d6f 636b  k().        mock
+0001bec0: 5f72 6567 7220 3d20 6d6f 636b 2e4d 6167  _regr = mock.Mag
+0001bed0: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
+0001bee0: 206d 6f63 6b5f 7374 6f72 6167 652e 6669   mock_storage.fi
+0001bef0: 6e64 5f61 6c6c 2e72 6574 7572 6e5f 7661  nd_all.return_va
+0001bf00: 6c75 6520 3d20 5b6d 6f63 6b5f 6163 636f  lue = [mock_acco
+0001bf10: 756e 745d 0a20 2020 2020 2020 2073 656c  unt].        sel
+0001bf20: 662e 6d6f 636b 735b 2761 6363 6f75 6e74  f.mocks['account
+0001bf30: 275d 2e41 6363 6f75 6e74 4669 6c65 5374  '].AccountFileSt
+0001bf40: 6f72 6167 652e 7265 7475 726e 5f76 616c  orage.return_val
+0001bf50: 7565 203d 206d 6f63 6b5f 7374 6f72 6167  ue = mock_storag
+0001bf60: 650a 2020 2020 2020 2020 6d6f 636b 5f61  e.        mock_a
+0001bf70: 6363 6f75 6e74 2e72 6567 722e 626f 6479  ccount.regr.body
+0001bf80: 203d 206d 6f63 6b5f 7265 6772 2e62 6f64   = mock_regr.bod
+0001bf90: 790a 2020 2020 2020 2020 6d6f 636b 5f61  y.        mock_a
+0001bfa0: 6363 6f75 6e74 2e6b 6579 2e74 6875 6d62  ccount.key.thumb
+0001bfb0: 7072 696e 742e 7265 7475 726e 5f76 616c  print.return_val
+0001bfc0: 7565 203d 2062 2766 6f6f 6261 7262 617a  ue = b'foobarbaz
+0001bfd0: 270a 2020 2020 2020 2020 7365 6c66 2e6d  '.        self.m
+0001bfe0: 6f63 6b73 5b27 6465 7465 726d 696e 655f  ocks['determine_
+0001bff0: 6163 636f 756e 7427 5d2e 7265 7475 726e  account'].return
+0001c000: 5f76 616c 7565 203d 2028 6d6f 636b 5f61  _value = (mock_a
+0001c010: 6363 6f75 6e74 2c20 6d6f 636b 2e4d 6167  ccount, mock.Mag
+0001c020: 6963 4d6f 636b 2829 290a 0a20 2020 2064  icMock())..    d
+0001c030: 6566 205f 7465 7374 5f73 686f 775f 6163  ef _test_show_ac
+0001c040: 636f 756e 7428 7365 6c66 2c20 636f 6e74  count(self, cont
+0001c050: 6163 7429 3a0a 2020 2020 2020 2020 7365  act):.        se
+0001c060: 6c66 2e5f 7072 6570 6172 655f 6d6f 636b  lf._prepare_mock
+0001c070: 5f61 6363 6f75 6e74 2829 0a20 2020 2020  _account().     
+0001c080: 2020 206d 6f63 6b5f 636c 6965 6e74 203d     mock_client =
+0001c090: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
+0001c0a0: 290a 2020 2020 2020 2020 6d6f 636b 5f72  ).        mock_r
+0001c0b0: 6567 7220 3d20 6d6f 636b 2e4d 6167 6963  egr = mock.Magic
+0001c0c0: 4d6f 636b 2829 0a20 2020 2020 2020 206d  Mock().        m
+0001c0d0: 6f63 6b5f 7265 6772 2e62 6f64 792e 636f  ock_regr.body.co
+0001c0e0: 6e74 6163 7420 3d20 636f 6e74 6163 740a  ntact = contact.
+0001c0f0: 2020 2020 2020 2020 6d6f 636b 5f72 6567          mock_reg
+0001c100: 722e 7572 6920 3d20 2768 7474 7073 3a2f  r.uri = 'https:/
+0001c110: 2f77 7777 2e6c 6574 7365 6e63 7279 7074  /www.letsencrypt
+0001c120: 2d64 656d 6f2e 6f72 672f 6163 6d65 2f72  -demo.org/acme/r
+0001c130: 6567 2f31 270a 2020 2020 2020 2020 6d6f  eg/1'.        mo
+0001c140: 636b 5f63 6c69 656e 742e 6163 6d65 2e71  ck_client.acme.q
+0001c150: 7565 7279 5f72 6567 6973 7472 6174 696f  uery_registratio
+0001c160: 6e2e 7265 7475 726e 5f76 616c 7565 203d  n.return_value =
+0001c170: 206d 6f63 6b5f 7265 6772 0a20 2020 2020   mock_regr.     
+0001c180: 2020 2073 656c 662e 6d6f 636b 735b 2763     self.mocks['c
+0001c190: 6c69 656e 7427 5d2e 436c 6965 6e74 2e72  lient'].Client.r
+0001c1a0: 6574 7572 6e5f 7661 6c75 6520 3d20 6d6f  eturn_value = mo
+0001c1b0: 636b 5f63 6c69 656e 740a 0a20 2020 2020  ck_client..     
+0001c1c0: 2020 2061 7267 7320 3d20 5b27 7368 6f77     args = ['show
+0001c1d0: 5f61 6363 6f75 6e74 275d 0a0a 2020 2020  _account']..    
+0001c1e0: 2020 2020 7365 6c66 2e5f 6361 6c6c 2861      self._call(a
+0001c1f0: 7267 7329 0a0a 2020 2020 2020 2020 6173  rgs)..        as
+0001c200: 7365 7274 206d 6f63 6b5f 636c 6965 6e74  sert mock_client
+0001c210: 2e61 636d 652e 7175 6572 795f 7265 6769  .acme.query_regi
+0001c220: 7374 7261 7469 6f6e 2e63 616c 6c5f 636f  stration.call_co
+0001c230: 756e 7420 3d3d 2031 0a0a 2020 2020 6465  unt == 1..    de
+0001c240: 6620 7465 7374 5f6e 6f5f 6578 6973 7469  f test_no_existi
+0001c250: 6e67 5f61 6363 6f75 6e74 7328 7365 6c66  ng_accounts(self
+0001c260: 293a 0a20 2020 2020 2020 2022 2222 5465  ):.        """Te
+0001c270: 7374 2074 6861 7420 6e6f 2065 7869 7374  st that no exist
+0001c280: 696e 6720 6163 636f 756e 7420 6973 2068  ing account is h
+0001c290: 616e 646c 6564 2063 6f72 7265 6374 6c79  andled correctly
+0001c2a0: 2222 220a 2020 2020 2020 2020 6d6f 636b  """.        mock
+0001c2b0: 5f73 746f 7261 6765 203d 206d 6f63 6b2e  _storage = mock.
+0001c2c0: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+0001c2d0: 2020 2020 6d6f 636b 5f73 746f 7261 6765      mock_storage
+0001c2e0: 2e66 696e 645f 616c 6c2e 7265 7475 726e  .find_all.return
+0001c2f0: 5f76 616c 7565 203d 205b 5d0a 2020 2020  _value = [].    
+0001c300: 2020 2020 7365 6c66 2e6d 6f63 6b73 5b27      self.mocks['
+0001c310: 6163 636f 756e 7427 5d2e 4163 636f 756e  account'].Accoun
+0001c320: 7446 696c 6553 746f 7261 6765 2e72 6574  tFileStorage.ret
+0001c330: 7572 6e5f 7661 6c75 6520 3d20 6d6f 636b  urn_value = mock
+0001c340: 5f73 746f 7261 6765 0a20 2020 2020 2020  _storage.       
+0001c350: 2061 7373 6572 7420 7365 6c66 2e5f 6361   assert self._ca
+0001c360: 6c6c 285b 2773 686f 775f 6163 636f 756e  ll(['show_accoun
+0001c370: 7427 5d29 203d 3d20 5c0a 2020 2020 2020  t']) == \.      
+0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c390: 2020 2027 436f 756c 6420 6e6f 7420 6669     'Could not fi
+0001c3a0: 6e64 2061 6e20 6578 6973 7469 6e67 2061  nd an existing a
+0001c3b0: 6363 6f75 6e74 2066 6f72 2073 6572 7665  ccount for serve
+0001c3c0: 7227 205c 0a20 2020 2020 2020 2020 2020  r' \.           
+0001c3d0: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+0001c3e0: 6874 7470 733a 2f2f 6163 6d65 2d76 3032  https://acme-v02
+0001c3f0: 2e61 7069 2e6c 6574 7365 6e63 7279 7074  .api.letsencrypt
+0001c400: 2e6f 7267 2f64 6972 6563 746f 7279 2e27  .org/directory.'
+0001c410: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
+0001c420: 6f5f 6578 6973 7469 6e67 5f63 6c69 656e  o_existing_clien
+0001c430: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+0001c440: 2022 2222 5465 7374 2074 6861 7420 6973   """Test that is
+0001c450: 7375 6573 2077 6974 6820 7468 6520 4143  sues with the AC
+0001c460: 4d45 2063 6c69 656e 7420 6172 6520 6861  ME client are ha
+0001c470: 6e64 6c65 6420 636f 7272 6563 746c 7922  ndled correctly"
+0001c480: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0001c490: 5f70 7265 7061 7265 5f6d 6f63 6b5f 6163  _prepare_mock_ac
+0001c4a0: 636f 756e 7428 290a 2020 2020 2020 2020  count().        
+0001c4b0: 6d6f 636b 5f63 6c69 656e 7420 3d20 6d6f  mock_client = mo
+0001c4c0: 636b 2e4d 6167 6963 4d6f 636b 2829 0a20  ck.MagicMock(). 
+0001c4d0: 2020 2020 2020 206d 6f63 6b5f 636c 6965         mock_clie
+0001c4e0: 6e74 2e61 636d 6520 3d20 4e6f 6e65 0a20  nt.acme = None. 
+0001c4f0: 2020 2020 2020 2073 656c 662e 6d6f 636b         self.mock
+0001c500: 735b 2763 6c69 656e 7427 5d2e 436c 6965  s['client'].Clie
+0001c510: 6e74 2e72 6574 7572 6e5f 7661 6c75 6520  nt.return_value 
+0001c520: 3d20 6d6f 636b 5f63 6c69 656e 740a 2020  = mock_client.  
+0001c530: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001c540: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
+0001c550: 6c28 5b27 7368 6f77 5f61 6363 6f75 6e74  l(['show_account
+0001c560: 275d 290a 2020 2020 2020 2020 6578 6365  ']).        exce
+0001c570: 7074 2065 7272 6f72 732e 4572 726f 7220  pt errors.Error 
+0001c580: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001c590: 2020 6173 7365 7274 2027 4143 4d45 2063    assert 'ACME c
+0001c5a0: 6c69 656e 7420 6973 206e 6f74 2073 6574  lient is not set
+0001c5b0: 2e27 203d 3d20 7374 7228 6529 0a0a 2020  .' == str(e)..  
+0001c5c0: 2020 6465 6620 7465 7374 5f6e 6f5f 636f    def test_no_co
+0001c5d0: 6e74 6163 7473 2873 656c 6629 3a0a 2020  ntacts(self):.  
+0001c5e0: 2020 2020 2020 7365 6c66 2e5f 7465 7374        self._test
+0001c5f0: 5f73 686f 775f 6163 636f 756e 7428 2829  _show_account(()
+0001c600: 290a 0a20 2020 2020 2020 2061 7373 6572  )..        asser
+0001c610: 7420 7365 6c66 2e6d 6f63 6b73 5b27 6e6f  t self.mocks['no
+0001c620: 7469 6679 275d 2e63 616c 6c5f 636f 756e  tify'].call_coun
+0001c630: 7420 3d3d 2031 0a20 2020 2020 2020 2073  t == 1.        s
+0001c640: 656c 662e 6d6f 636b 735b 276e 6f74 6966  elf.mocks['notif
+0001c650: 7927 5d2e 6173 7365 7274 5f68 6173 5f63  y'].assert_has_c
+0001c660: 616c 6c73 285b 0a20 2020 2020 2020 2020  alls([.         
+0001c670: 2020 206d 6f63 6b2e 6361 6c6c 2827 4163     mock.call('Ac
+0001c680: 636f 756e 7420 6465 7461 696c 7320 666f  count details fo
+0001c690: 7220 7365 7276 6572 2068 7474 7073 3a2f  r server https:/
+0001c6a0: 2f61 636d 652d 7630 322e 6170 692e 6c65  /acme-v02.api.le
+0001c6b0: 7473 656e 6372 270a 2020 2020 2020 2020  tsencr'.        
+0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2779                'y
+0001c6d0: 7074 2e6f 7267 2f64 6972 6563 746f 7279  pt.org/directory
+0001c6e0: 3a5c 6e20 2041 6363 6f75 6e74 2055 524c  :\n  Account URL
+0001c6f0: 3a20 6874 7470 733a 2f2f 7777 772e 6c65  : https://www.le
+0001c700: 7473 656e 6372 7927 0a20 2020 2020 2020  tsencry'.       
+0001c710: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001c720: 7074 2d64 656d 6f2e 6f72 672f 6163 6d65  pt-demo.org/acme
+0001c730: 2f72 6567 2f31 5c6e 2020 4163 636f 756e  /reg/1\n  Accoun
+0001c740: 7420 5468 756d 6270 7269 6e74 3a20 5a6d  t Thumbprint: Zm
+0001c750: 3976 596d 4679 596d 4636 5c6e 270a 2020  9vYmFyYmF6\n'.  
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c770: 2020 2020 2720 2045 6d61 696c 2063 6f6e      '  Email con
+0001c780: 7461 6374 3a20 6e6f 6e65 2729 5d29 0a0a  tact: none')])..
+0001c790: 2020 2020 6465 6620 7465 7374 5f73 696e      def test_sin
+0001c7a0: 676c 655f 656d 6169 6c28 7365 6c66 293a  gle_email(self):
+0001c7b0: 0a20 2020 2020 2020 2063 6f6e 7461 6374  .        contact
+0001c7c0: 203d 2028 276d 6169 6c74 6f3a 666f 6f40   = ('mailto:foo@
+0001c7d0: 6578 616d 706c 652e 636f 6d27 2c29 0a20  example.com',). 
+0001c7e0: 2020 2020 2020 2073 656c 662e 5f74 6573         self._tes
+0001c7f0: 745f 7368 6f77 5f61 6363 6f75 6e74 2863  t_show_account(c
+0001c800: 6f6e 7461 6374 290a 0a20 2020 2020 2020  ontact)..       
+0001c810: 2061 7373 6572 7420 7365 6c66 2e6d 6f63   assert self.moc
+0001c820: 6b73 5b27 6e6f 7469 6679 275d 2e63 616c  ks['notify'].cal
+0001c830: 6c5f 636f 756e 7420 3d3d 2031 0a20 2020  l_count == 1.   
+0001c840: 2020 2020 2073 656c 662e 6d6f 636b 735b       self.mocks[
+0001c850: 276e 6f74 6966 7927 5d2e 6173 7365 7274  'notify'].assert
+0001c860: 5f68 6173 5f63 616c 6c73 285b 0a20 2020  _has_calls([.   
+0001c870: 2020 2020 2020 2020 206d 6f63 6b2e 6361           mock.ca
+0001c880: 6c6c 2827 4163 636f 756e 7420 6465 7461  ll('Account deta
+0001c890: 696c 7320 666f 7220 7365 7276 6572 2068  ils for server h
+0001c8a0: 7474 7073 3a2f 2f61 636d 652d 7630 322e  ttps://acme-v02.
+0001c8b0: 6170 692e 6c65 7473 656e 6372 270a 2020  api.letsencr'.  
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8d0: 2020 2020 2779 7074 2e6f 7267 2f64 6972      'ypt.org/dir
+0001c8e0: 6563 746f 7279 3a5c 6e20 2041 6363 6f75  ectory:\n  Accou
+0001c8f0: 6e74 2055 524c 3a20 6874 7470 733a 2f2f  nt URL: https://
+0001c900: 7777 772e 6c65 7473 656e 6372 7927 0a20  www.letsencry'. 
+0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c920: 2020 2020 2027 7074 2d64 656d 6f2e 6f72       'pt-demo.or
+0001c930: 672f 6163 6d65 2f72 6567 2f31 5c6e 2020  g/acme/reg/1\n  
+0001c940: 4163 636f 756e 7420 5468 756d 6270 7269  Account Thumbpri
+0001c950: 6e74 3a20 5a6d 3976 596d 4679 596d 4636  nt: Zm9vYmFyYmF6
+0001c960: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001c970: 2020 2020 2020 2020 275c 6e20 2045 6d61          '\n  Ema
+0001c980: 696c 2063 6f6e 7461 6374 3a20 666f 6f40  il contact: foo@
+0001c990: 6578 616d 706c 652e 636f 6d27 295d 290a  example.com')]).
+0001c9a0: 0a20 2020 2064 6566 2074 6573 745f 646f  .    def test_do
+0001c9b0: 7562 6c65 5f65 6d61 696c 2873 656c 6629  uble_email(self)
+0001c9c0: 3a0a 2020 2020 2020 2020 636f 6e74 6163  :.        contac
+0001c9d0: 7420 3d20 2827 6d61 696c 746f 3a66 6f6f  t = ('mailto:foo
+0001c9e0: 4065 7861 6d70 6c65 2e63 6f6d 272c 2027  @example.com', '
+0001c9f0: 6d61 696c 746f 3a62 6172 4065 7861 6d70  mailto:bar@examp
+0001ca00: 6c65 2e63 6f6d 2729 0a20 2020 2020 2020  le.com').       
+0001ca10: 2073 656c 662e 5f74 6573 745f 7368 6f77   self._test_show
+0001ca20: 5f61 6363 6f75 6e74 2863 6f6e 7461 6374  _account(contact
+0001ca30: 290a 0a20 2020 2020 2020 2061 7373 6572  )..        asser
+0001ca40: 7420 7365 6c66 2e6d 6f63 6b73 5b27 6e6f  t self.mocks['no
+0001ca50: 7469 6679 275d 2e63 616c 6c5f 636f 756e  tify'].call_coun
+0001ca60: 7420 3d3d 2031 0a20 2020 2020 2020 2073  t == 1.        s
+0001ca70: 656c 662e 6d6f 636b 735b 276e 6f74 6966  elf.mocks['notif
+0001ca80: 7927 5d2e 6173 7365 7274 5f68 6173 5f63  y'].assert_has_c
+0001ca90: 616c 6c73 285b 0a20 2020 2020 2020 2020  alls([.         
+0001caa0: 2020 206d 6f63 6b2e 6361 6c6c 2827 4163     mock.call('Ac
+0001cab0: 636f 756e 7420 6465 7461 696c 7320 666f  count details fo
+0001cac0: 7220 7365 7276 6572 2068 7474 7073 3a2f  r server https:/
+0001cad0: 2f61 636d 652d 7630 322e 6170 692e 6c65  /acme-v02.api.le
+0001cae0: 7473 656e 6372 270a 2020 2020 2020 2020  tsencr'.        
+0001caf0: 2020 2020 2020 2020 2020 2020 2020 2779                'y
+0001cb00: 7074 2e6f 7267 2f64 6972 6563 746f 7279  pt.org/directory
+0001cb10: 3a5c 6e20 2041 6363 6f75 6e74 2055 524c  :\n  Account URL
+0001cb20: 3a20 6874 7470 733a 2f2f 7777 772e 6c65  : https://www.le
+0001cb30: 7473 656e 6372 7927 0a20 2020 2020 2020  tsencry'.       
+0001cb40: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001cb50: 7074 2d64 656d 6f2e 6f72 672f 6163 6d65  pt-demo.org/acme
+0001cb60: 2f72 6567 2f31 5c6e 2020 4163 636f 756e  /reg/1\n  Accoun
+0001cb70: 7420 5468 756d 6270 7269 6e74 3a20 5a6d  t Thumbprint: Zm
+0001cb80: 3976 596d 4679 596d 4636 5c6e 270a 2020  9vYmFyYmF6\n'.  
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cba0: 2020 2020 2720 2045 6d61 696c 2063 6f6e      '  Email con
+0001cbb0: 7461 6374 733a 2066 6f6f 4065 7861 6d70  tacts: foo@examp
+0001cbc0: 6c65 2e63 6f6d 2c20 6261 7240 6578 616d  le.com, bar@exam
+0001cbd0: 706c 652e 636f 6d27 295d 290a 0a0a 636c  ple.com')])...cl
+0001cbe0: 6173 7320 5465 7374 4c6f 636b 4f72 6465  ass TestLockOrde
+0001cbf0: 723a 0a20 2020 2022 2222 5465 7374 7320  r:.    """Tests 
+0001cc00: 7468 6174 2043 6572 7462 6f74 2773 2064  that Certbot's d
+0001cc10: 6972 6563 746f 7279 206c 6f63 6b73 2077  irectory locks w
+0001cc20: 6572 6520 6163 7175 6972 6564 2069 6e20  ere acquired in 
+0001cc30: 7468 6520 7269 6768 7420 6f72 6465 722e  the right order.
+0001cc40: 2222 220a 2020 2020 4558 5045 4354 4544  """.    EXPECTED
+0001cc50: 5f45 5252 4f52 5f54 5950 4520 3d20 6572  _ERROR_TYPE = er
+0001cc60: 726f 7273 2e45 7272 6f72 0a20 2020 2045  rors.Error.    E
+0001cc70: 5850 4543 5445 445f 4552 524f 525f 5354  XPECTED_ERROR_ST
+0001cc80: 5220 3d20 2745 7870 6563 7465 6420 5465  R = 'Expected Te
+0001cc90: 7374 4c6f 636b 4f72 6465 7220 6572 726f  stLockOrder erro
+0001cca0: 7227 0a20 2020 2023 2054 6869 7320 7265  r'.    # This re
+0001ccb0: 6765 7820 6973 206e 6565 6465 6420 6265  gex is needed be
+0001ccc0: 6361 7573 6520 6365 7274 626f 7420 7265  cause certbot re
+0001ccd0: 6e65 7720 6361 7074 7572 6573 2072 6169  new captures rai
+0001cce0: 7365 6420 6572 726f 7273 2061 6e64 0a20  sed errors and. 
+0001ccf0: 2020 2023 2072 6169 7365 7320 6974 7320     # raises its 
+0001cd00: 6f77 6e2e 0a20 2020 2045 5850 4543 5445  own..    EXPECTE
+0001cd10: 445f 4552 524f 525f 5354 525f 5245 4745  D_ERROR_STR_REGE
+0001cd20: 5820 3d20 6627 7b45 5850 4543 5445 445f  X = f'{EXPECTED_
+0001cd30: 4552 524f 525f 5354 527d 7c31 2072 656e  ERROR_STR}|1 ren
+0001cd40: 6577 2066 6169 6c75 7265 270a 0a20 2020  ew failure'..   
+0001cd50: 2040 7079 7465 7374 2e66 6978 7475 7265   @pytest.fixture
+0001cd60: 0a20 2020 2064 6566 206d 6f63 6b5f 6c6f  .    def mock_lo
+0001cd70: 636b 5f64 6972 2873 656c 6629 3a0a 2020  ck_dir(self):.  
+0001cd80: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+0001cd90: 7061 7463 6828 2763 6572 7462 6f74 2e5f  patch('certbot._
+0001cda0: 696e 7465 726e 616c 2e6c 6f63 6b2e 6c6f  internal.lock.lo
+0001cdb0: 636b 5f64 6972 2729 2061 7320 6d6f 636b  ck_dir') as mock
+0001cdc0: 5f6c 6f63 6b5f 6469 723a 0a20 2020 2020  _lock_dir:.     
+0001cdd0: 2020 2020 2020 2079 6965 6c64 206d 6f63         yield moc
+0001cde0: 6b5f 6c6f 636b 5f64 6972 0a0a 2020 2020  k_lock_dir..    
+0001cdf0: 4063 6f6e 7465 7874 6c69 622e 636f 6e74  @contextlib.cont
+0001ce00: 6578 746d 616e 6167 6572 0a20 2020 2064  extmanager.    d
+0001ce10: 6566 206d 6f63 6b5f 706c 7567 696e 5f70  ef mock_plugin_p
+0001ce20: 7265 7061 7265 2873 656c 662c 2061 7574  repare(self, aut
+0001ce30: 6865 6e74 6963 6174 6f72 5f64 6972 2c20  henticator_dir, 
+0001ce40: 696e 7374 616c 6c65 725f 6469 722c 206d  installer_dir, m
+0001ce50: 6f63 6b5f 6c6f 636b 5f64 6972 2c20 7375  ock_lock_dir, su
+0001ce60: 6263 6f6d 6d61 6e64 293a 0a20 2020 2020  bcommand):.     
+0001ce70: 2020 2022 2222 5061 7463 6865 7320 706c     """Patches pl
+0001ce80: 7567 696e 2070 7265 7061 7265 2074 6f20  ugin prepare to 
+0001ce90: 6361 6c6c 206d 6f63 6b5f 6c6f 636b 5f64  call mock_lock_d
+0001cea0: 6972 2061 6e64 2072 6169 7365 2074 6865  ir and raise the
+0001ceb0: 2065 7870 6563 7465 6420 6572 726f 722e   expected error.
+0001cec0: 2222 220a 2020 2020 2020 2020 6465 6620  """.        def 
+0001ced0: 6175 7468 656e 7469 6361 746f 725f 6c6f  authenticator_lo
+0001cee0: 636b 2875 6e75 7365 645f 7365 6c66 293a  ck(unused_self):
+0001cef0: 0a20 2020 2020 2020 2020 2020 206d 6f63  .            moc
+0001cf00: 6b5f 6c6f 636b 5f64 6972 2861 7574 6865  k_lock_dir(authe
+0001cf10: 6e74 6963 6174 6f72 5f64 6972 290a 2020  nticator_dir).  
+0001cf20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001cf30: 7365 6c66 2e45 5850 4543 5445 445f 4552  self.EXPECTED_ER
+0001cf40: 524f 525f 5459 5045 2873 656c 662e 4558  ROR_TYPE(self.EX
+0001cf50: 5045 4354 4544 5f45 5252 4f52 5f53 5452  PECTED_ERROR_STR
+0001cf60: 290a 0a20 2020 2020 2020 2064 6566 2069  )..        def i
+0001cf70: 6e73 7461 6c6c 6572 5f6c 6f63 6b28 756e  nstaller_lock(un
+0001cf80: 7573 6564 5f73 656c 6629 3a0a 2020 2020  used_self):.    
+0001cf90: 2020 2020 2020 2020 6d6f 636b 5f6c 6f63          mock_loc
+0001cfa0: 6b5f 6469 7228 696e 7374 616c 6c65 725f  k_dir(installer_
+0001cfb0: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
+0001cfc0: 2023 2055 6e6c 6573 7320 616e 2069 6e73   # Unless an ins
+0001cfd0: 7461 6c6c 6572 2069 736e 2774 206e 6565  taller isn't nee
+0001cfe0: 6465 6420 2865 2e67 2e20 6365 7274 626f  ded (e.g. certbo
+0001cff0: 7420 696e 7374 616c 6c29 2c20 7765 0a20  t install), we. 
+0001d000: 2020 2020 2020 2020 2020 2023 2065 7870             # exp
+0001d010: 6563 7420 7468 6520 6175 7468 656e 7469  ect the authenti
+0001d020: 6361 746f 7220 746f 2072 6169 7365 2074  cator to raise t
+0001d030: 6865 2065 7870 6563 7465 6420 6572 726f  he expected erro
+0001d040: 7220 6265 6361 7573 6520 6974 0a20 2020  r because it.   
+0001d050: 2020 2020 2020 2020 2023 2069 7320 7072           # is pr
+0001d060: 6570 6172 6564 206c 6173 742e 2053 6565  epared last. See
+0001d070: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
+0001d080: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0001d090: 6d2f 6365 7274 626f 742f 6365 7274 626f  m/certbot/certbo
+0001d0a0: 742f 626c 6f62 2f37 6136 3735 3261 3638  t/blob/7a6752a68
+0001d0b0: 6564 3737 6537 3363 3262 3239 6162 3230  ed77e73c2b29ab20
+0001d0c0: 6433 6361 3839 3237 6634 6661 3762 302f  d3ca8927f4fa7b0/
+0001d0d0: 6365 7274 626f 742f 6365 7274 626f 742f  certbot/certbot/
+0001d0e0: 5f69 6e74 6572 6e61 6c2f 706c 7567 696e  _internal/plugin
+0001d0f0: 732f 7365 6c65 6374 696f 6e2e 7079 234c  s/selection.py#L
+0001d100: 3234 362d 4c32 3439 0a20 2020 2020 2020  246-L249.       
+0001d110: 2020 2020 2069 6620 7375 6263 6f6d 6d61       if subcomma
+0001d120: 6e64 203d 3d20 2769 6e73 7461 6c6c 273a  nd == 'install':
+0001d130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d140: 2072 6169 7365 2073 656c 662e 4558 5045   raise self.EXPE
+0001d150: 4354 4544 5f45 5252 4f52 5f54 5950 4528  CTED_ERROR_TYPE(
+0001d160: 7365 6c66 2e45 5850 4543 5445 445f 4552  self.EXPECTED_ER
+0001d170: 524f 525f 5354 5229 0a0a 2020 2020 2020  ROR_STR)..      
+0001d180: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+0001d190: 682e 6f62 6a65 6374 2873 7461 6e64 616c  h.object(standal
+0001d1a0: 6f6e 652e 4175 7468 656e 7469 6361 746f  one.Authenticato
+0001d1b0: 722c 2027 7072 6570 6172 6527 2c20 6175  r, 'prepare', au
+0001d1c0: 7468 656e 7469 6361 746f 725f 6c6f 636b  thenticator_lock
+0001d1d0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+0001d1e0: 6974 6820 6d6f 636b 2e70 6174 6368 2e6f  ith mock.patch.o
+0001d1f0: 626a 6563 7428 6e75 6c6c 2e49 6e73 7461  bject(null.Insta
+0001d200: 6c6c 6572 2c20 2770 7265 7061 7265 272c  ller, 'prepare',
+0001d210: 2069 6e73 7461 6c6c 6572 5f6c 6f63 6b29   installer_lock)
+0001d220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d230: 2020 7969 656c 640a 0a20 2020 2040 7079    yield..    @py
+0001d240: 7465 7374 2e66 6978 7475 7265 2870 6172  test.fixture(par
+0001d250: 616d 733d 2763 6572 746f 6e6c 7920 696e  ams='certonly in
+0001d260: 7374 616c 6c20 7265 6e65 7720 7275 6e27  stall renew run'
+0001d270: 2e73 706c 6974 2829 290a 2020 2020 6465  .split()).    de
+0001d280: 6620 6172 6773 5f61 6e64 5f6c 6f63 6b5f  f args_and_lock_
+0001d290: 6f72 6465 7228 7365 6c66 2c20 6d6f 636b  order(self, mock
+0001d2a0: 5f6c 6f63 6b5f 6469 722c 2072 6571 7565  _lock_dir, reque
+0001d2b0: 7374 2c20 746d 705f 7061 7468 293a 0a20  st, tmp_path):. 
+0001d2c0: 2020 2020 2020 2022 2222 5365 7473 2075         """Sets u
+0001d2d0: 7020 4365 7274 626f 7420 7769 7468 2061  p Certbot with a
+0001d2e0: 7267 7320 616e 6420 6d6f 636b 7320 746f  rgs and mocks to
+0001d2f0: 2065 7272 6f72 2061 6674 6572 2061 6371   error after acq
+0001d300: 7569 7269 6e67 2074 6865 206c 6173 7420  uiring the last 
+0001d310: 6c6f 636b 2e0a 0a20 2020 2020 2020 2054  lock...        T
+0001d320: 6869 7320 6669 7874 7572 6520 7969 656c  his fixture yiel
+0001d330: 6473 2074 6865 2043 4c49 2061 7267 756d  ds the CLI argum
+0001d340: 656e 7473 2074 6861 7420 7368 6f75 6c64  ents that should
+0001d350: 2062 6520 6769 7665 6e20 746f 2043 6572   be given to Cer
+0001d360: 7462 6f74 0a20 2020 2020 2020 2061 6e64  tbot.        and
+0001d370: 2074 6865 2065 7870 6563 7465 6420 6f72   the expected or
+0001d380: 6465 7220 6f66 2064 6972 6563 746f 7269  der of directori
+0001d390: 6573 2074 6f20 6265 206c 6f63 6b65 642e  es to be locked.
+0001d3a0: 2041 6e20 6572 726f 7220 6973 2072 6169   An error is rai
+0001d3b0: 7365 640a 2020 2020 2020 2020 6166 7465  sed.        afte
+0001d3c0: 7220 6163 7175 6972 696e 6720 7468 6520  r acquiring the 
+0001d3d0: 6c61 7374 206c 6f63 6b20 6a75 7374 2061  last lock just a
+0001d3e0: 7320 6120 6d65 616e 7320 6f66 2073 746f  s a means of sto
+0001d3f0: 7070 696e 6720 4365 7274 626f 7427 730a  pping Certbot's.
+0001d400: 2020 2020 2020 2020 6578 6563 7574 696f          executio
+0001d410: 6e2e 0a0a 2020 2020 2020 2020 2222 220a  n...        """.
+0001d420: 2020 2020 2020 2020 2320 7365 6c65 6374          # select
+0001d430: 2064 6972 6563 746f 7269 6573 0a20 2020   directories.   
+0001d440: 2020 2020 2061 7574 6865 6e74 6963 6174       authenticat
+0001d450: 6f72 5f64 6972 203d 2073 7472 2874 6d70  or_dir = str(tmp
+0001d460: 5f70 6174 6820 2f20 2761 7574 6865 6e74  _path / 'authent
+0001d470: 6963 6174 6f72 2729 0a20 2020 2020 2020  icator').       
+0001d480: 2063 6f6e 6669 675f 6469 7220 3d20 7374   config_dir = st
+0001d490: 7228 746d 705f 7061 7468 202f 2027 636f  r(tmp_path / 'co
+0001d4a0: 6e66 6967 2729 0a20 2020 2020 2020 2069  nfig').        i
+0001d4b0: 6e73 7461 6c6c 6572 5f64 6972 203d 2073  nstaller_dir = s
+0001d4c0: 7472 2874 6d70 5f70 6174 6820 2f20 2769  tr(tmp_path / 'i
+0001d4d0: 6e73 7461 6c6c 6572 2729 0a20 2020 2020  nstaller').     
+0001d4e0: 2020 206c 6f67 735f 6469 7220 3d20 7374     logs_dir = st
+0001d4f0: 7228 746d 705f 7061 7468 202f 2027 6c6f  r(tmp_path / 'lo
+0001d500: 6773 2729 0a20 2020 2020 2020 2077 6f72  gs').        wor
+0001d510: 6b5f 6469 7220 3d20 7374 7228 746d 705f  k_dir = str(tmp_
+0001d520: 7061 7468 202f 2027 776f 726b 2729 0a0a  path / 'work')..
+0001d530: 2020 2020 2020 2020 2320 7072 6570 6172          # prepar
+0001d540: 6520 6172 6773 2061 6e64 206c 696e 6561  e args and linea
+0001d550: 6765 0a20 2020 2020 2020 2073 7562 636f  ge.        subco
+0001d560: 6d6d 616e 6420 3d20 7265 7175 6573 742e  mmand = request.
+0001d570: 7061 7261 6d0a 2020 2020 2020 2020 6172  param.        ar
+0001d580: 6773 203d 205b 7375 6263 6f6d 6d61 6e64  gs = [subcommand
+0001d590: 2c20 272d 6127 2c20 2773 7461 6e64 616c  , '-a', 'standal
+0001d5a0: 6f6e 6527 2c20 272d 6927 2c20 276e 756c  one', '-i', 'nul
+0001d5b0: 6c27 2c20 272d 2d6e 6f2d 7261 6e64 6f6d  l', '--no-random
+0001d5c0: 2d73 6c65 6570 2d6f 6e2d 7265 6e65 7727  -sleep-on-renew'
+0001d5d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d5e0: 2020 272d 2d63 6f6e 6669 672d 6469 7227    '--config-dir'
+0001d5f0: 2c20 636f 6e66 6967 5f64 6972 2c20 272d  , config_dir, '-
+0001d600: 2d6c 6f67 732d 6469 7227 2c20 6c6f 6773  -logs-dir', logs
+0001d610: 5f64 6972 2c20 272d 2d77 6f72 6b2d 6469  _dir, '--work-di
+0001d620: 7227 2c0a 2020 2020 2020 2020 2020 2020  r',.            
+0001d630: 2020 2020 776f 726b 5f64 6972 5d0a 2020      work_dir].  
+0001d640: 2020 2020 2020 7465 7374 5f75 7469 6c2e        test_util.
+0001d650: 6d61 6b65 5f6c 696e 6561 6765 2863 6f6e  make_lineage(con
+0001d660: 6669 675f 6469 722c 2027 7361 6d70 6c65  fig_dir, 'sample
+0001d670: 2d72 656e 6577 616c 2e63 6f6e 6627 290a  -renewal.conf').
+0001d680: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0001d690: 6c66 2e6d 6f63 6b5f 706c 7567 696e 5f70  lf.mock_plugin_p
+0001d6a0: 7265 7061 7265 2861 7574 6865 6e74 6963  repare(authentic
+0001d6b0: 6174 6f72 5f64 6972 2c20 696e 7374 616c  ator_dir, instal
+0001d6c0: 6c65 725f 6469 722c 206d 6f63 6b5f 6c6f  ler_dir, mock_lo
+0001d6d0: 636b 5f64 6972 2c20 7375 6263 6f6d 6d61  ck_dir, subcomma
+0001d6e0: 6e64 293a 0a20 2020 2020 2020 2020 2020  nd):.           
+0001d6f0: 206c 6f63 6b5f 6f72 6465 7220 3d20 5b6c   lock_order = [l
+0001d700: 6f67 735f 6469 722c 2063 6f6e 6669 675f  ogs_dir, config_
+0001d710: 6469 722c 2077 6f72 6b5f 6469 722c 2069  dir, work_dir, i
+0001d720: 6e73 7461 6c6c 6572 5f64 6972 5d0a 2020  nstaller_dir].  
+0001d730: 2020 2020 2020 2020 2020 6966 2073 7562            if sub
+0001d740: 636f 6d6d 616e 6420 3d3d 2027 696e 7374  command == 'inst
+0001d750: 616c 6c27 3a0a 2020 2020 2020 2020 2020  all':.          
+0001d760: 2020 2020 2020 7969 656c 6420 6172 6773        yield args
+0001d770: 2c20 6c6f 636b 5f6f 7264 6572 0a20 2020  , lock_order.   
+0001d780: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001d790: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001d7a0: 2057 6520 6578 7065 6374 2074 6865 2069   We expect the i
+0001d7b0: 6e73 7461 6c6c 6572 2074 6f20 6265 2070  nstaller to be p
+0001d7c0: 7265 7061 7265 6420 6576 656e 2066 6f72  repared even for
+0001d7d0: 2063 6572 746f 6e6c 790a 2020 2020 2020   certonly.      
+0001d7e0: 2020 2020 2020 2020 2020 2320 6265 6361            # beca
+0001d7f0: 7573 6520 616e 2069 6e73 7461 6c6c 6572  use an installer
+0001d800: 2077 6173 2072 6571 7565 7374 6564 206f   was requested o
+0001d810: 6e20 7468 6520 636f 6d6d 616e 6420 6c69  n the command li
+0001d820: 6e65 2e0a 2020 2020 2020 2020 2020 2020  ne..            
+0001d830: 2020 2020 7969 656c 6420 6172 6773 2c20      yield args, 
+0001d840: 6c6f 636b 5f6f 7264 6572 202b 205b 6175  lock_order + [au
+0001d850: 7468 656e 7469 6361 746f 725f 6469 725d  thenticator_dir]
+0001d860: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
+0001d870: 6f63 6b5f 6f72 6465 7228 7365 6c66 2c20  ock_order(self, 
+0001d880: 6172 6773 5f61 6e64 5f6c 6f63 6b5f 6f72  args_and_lock_or
+0001d890: 6465 722c 206d 6f63 6b5f 6c6f 636b 5f64  der, mock_lock_d
+0001d8a0: 6972 293a 0a20 2020 2020 2020 2061 7267  ir):.        arg
+0001d8b0: 732c 206c 6f63 6b5f 6f72 6465 7220 3d20  s, lock_order = 
+0001d8c0: 6172 6773 5f61 6e64 5f6c 6f63 6b5f 6f72  args_and_lock_or
+0001d8d0: 6465 720a 2020 2020 2020 2020 7769 7468  der.        with
+0001d8e0: 2070 7974 6573 742e 7261 6973 6573 2873   pytest.raises(s
+0001d8f0: 656c 662e 4558 5045 4354 4544 5f45 5252  elf.EXPECTED_ERR
+0001d900: 4f52 5f54 5950 452c 206d 6174 6368 3d73  OR_TYPE, match=s
+0001d910: 656c 662e 4558 5045 4354 4544 5f45 5252  elf.EXPECTED_ERR
+0001d920: 4f52 5f53 5452 5f52 4547 4558 293a 0a20  OR_STR_REGEX):. 
+0001d930: 2020 2020 2020 2020 2020 206d 6169 6e2e             main.
+0001d940: 6d61 696e 2861 7267 7329 0a20 2020 2020  main(args).     
+0001d950: 2020 2061 7373 6572 7420 6d6f 636b 5f6c     assert mock_l
+0001d960: 6f63 6b5f 6469 722e 6361 6c6c 5f63 6f75  ock_dir.call_cou
+0001d970: 6e74 203d 3d20 6c65 6e28 6c6f 636b 5f6f  nt == len(lock_o
+0001d980: 7264 6572 290a 2020 2020 2020 2020 666f  rder).        fo
+0001d990: 7220 6361 6c6c 2c20 6c6f 636b 6564 5f64  r call, locked_d
+0001d9a0: 6972 2069 6e20 7a69 7028 6d6f 636b 5f6c  ir in zip(mock_l
+0001d9b0: 6f63 6b5f 6469 722e 6361 6c6c 5f61 7267  ock_dir.call_arg
+0001d9c0: 735f 6c69 7374 2c20 6c6f 636b 5f6f 7264  s_list, lock_ord
+0001d9d0: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
+0001d9e0: 2061 7373 6572 7420 6361 6c6c 5b30 5d5b   assert call[0][
+0001d9f0: 305d 203d 3d20 6c6f 636b 6564 5f64 6972  0] == locked_dir
+0001da00: 0a0a 0a69 6620 5f5f 6e61 6d65 5f5f 203d  ...if __name__ =
+0001da10: 3d20 275f 5f6d 6169 6e5f 5f27 3a0a 2020  = '__main__':.  
+0001da20: 2020 7379 732e 6578 6974 2870 7974 6573    sys.exit(pytes
+0001da30: 742e 6d61 696e 2873 7973 2e61 7267 765b  t.main(sys.argv[
+0001da40: 313a 5d20 2b20 5b5f 5f66 696c 655f 5f5d  1:] + [__file__]
+0001da50: 2929 2020 2320 7072 6167 6d61 3a20 6e6f  ))  # pragma: no
+0001da60: 2063 6f76 6572 0a                         cover.
```

### Comparing `certbot-2.5.0/certbot/_internal/tests/ocsp_test.py` & `certbot-2.6.0/certbot/_internal/tests/ocsp_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/common_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/common_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/disco_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/disco_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/dns_common_lexicon_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/dns_common_lexicon_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/dns_common_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/dns_common_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/enhancements_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/enhancements_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/manual_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/manual_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/null_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/null_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/selection_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/selection_test.py`

 * *Files 2% similar despite different names*

```diff
@@ -106,14 +106,22 @@
             "baz": None,
         }
 
         with mock.patch("certbot._internal.plugins.selection.choose_plugin") as mock_choose:
             mock_choose.return_value = None
             assert self._call() is None
 
+    def test_default_must_be_filtered(self):
+        # https://github.com/certbot/certbot/issues/9664
+        self.default = "foo"
+        filtered = mock.MagicMock()
+        self.reg.filter.return_value = filtered
+        self._call()
+        assert filtered.ifaces.call_count == 1
+
 
 class ChoosePluginTest(unittest.TestCase):
     """Tests for certbot._internal.plugins.selection.choose_plugin."""
 
     def setUp(self):
         display_obj.set_display(display_obj.FileDisplay(sys.stdout, False))
```

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/standalone_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/standalone_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/storage_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/storage_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/util_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/util_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/plugins/webroot_test.py` & `certbot-2.6.0/certbot/_internal/tests/plugins/webroot_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/renewal_test.py` & `certbot-2.6.0/certbot/_internal/tests/renewal_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/renewupdater_test.py` & `certbot-2.6.0/certbot/_internal/tests/renewupdater_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/reverter_test.py` & `certbot-2.6.0/certbot/_internal/tests/reverter_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/storage_test.py` & `certbot-2.6.0/certbot/_internal/tests/storage_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/tests/util_test.py` & `certbot-2.6.0/certbot/_internal/tests/util_test.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/_internal/updater.py` & `certbot-2.6.0/certbot/_internal/updater.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/achallenges.py` & `certbot-2.6.0/certbot/achallenges.py`

 * *Files 4% similar despite different names*

```diff
@@ -55,7 +55,13 @@
             self.account_key, *args, **kwargs)
 
 
 class DNS(AnnotatedChallenge):
     """Client annotated "dns" ACME challenge."""
     __slots__ = ('challb', 'domain') # pylint: disable=redefined-slots-in-subclass
     acme_type = challenges.DNS
+
+
+class Other(AnnotatedChallenge):
+    """Client annotated ACME challenge of an unknown type."""
+    __slots__ = ('challb', 'domain') # pylint: disable=redefined-slots-in-subclass
+    acme_type = challenges.Challenge
```

### Comparing `certbot-2.5.0/certbot/compat/_path.py` & `certbot-2.6.0/certbot/compat/_path.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/compat/filesystem.py` & `certbot-2.6.0/certbot/compat/filesystem.py`

 * *Files 0% similar despite different names*

```diff
@@ -270,17 +270,17 @@
 
         # At this point, the file that did not exist has been created with proper permissions,
         # so os.O_CREAT and os.O_EXCL are not needed anymore. We remove them from the flags to
         # avoid a FileExists exception before calling os.open.
         return os.open(file_path, flags ^ os.O_CREAT ^ os.O_EXCL)
 
     # Windows: general case, we call os.open, let exceptions be thrown, then chmod if all is fine.
-    handle = os.open(file_path, flags)
+    fd = os.open(file_path, flags)
     chmod(file_path, mode)
-    return handle
+    return fd
 
 
 def makedirs(file_path: str, mode: int = 0o777) -> None:
     """
     Rewrite of original os.makedirs function, that will ensure on Windows that given mode
     is correctly applied.
```

### Comparing `certbot-2.5.0/certbot/compat/misc.py` & `certbot-2.6.0/certbot/compat/misc.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/compat/os.py` & `certbot-2.6.0/certbot/compat/os.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/configuration.py` & `certbot-2.6.0/certbot/configuration.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/crypto_util.py` & `certbot-2.6.0/certbot/crypto_util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/display/ops.py` & `certbot-2.6.0/certbot/display/ops.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/display/util.py` & `certbot-2.6.0/certbot/display/util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/errors.py` & `certbot-2.6.0/certbot/errors.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/interfaces.py` & `certbot-2.6.0/certbot/interfaces.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/main.py` & `certbot-2.6.0/certbot/main.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/ocsp.py` & `certbot-2.6.0/certbot/ocsp.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/common.py` & `certbot-2.6.0/certbot/plugins/common.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/dns_common.py` & `certbot-2.6.0/certbot/plugins/dns_common.py`

 * *Files 1% similar despite different names*

```diff
@@ -308,28 +308,28 @@
                 'Missing {0} in credentials configuration file {1}:\n * {2}'.format(
                         'property' if len(messages) == 1 else 'properties',
                         self.confobj.filename,
                         '\n * '.join(messages)
                     )
             )
 
-    def conf(self, var: str) -> str:
+    def conf(self, var: str) -> Optional[str]:
         """Find a configuration value for variable `var`, as transformed by `mapper`.
 
         :param str var: The variable to get.
-        :returns: The value of the variable.
-        :rtype: str
+        :returns: The value of the variable, if it exists.
+        :rtype: str or None
         """
 
         return self._get(var)
 
     def _has(self, var: str) -> bool:
         return self.mapper(var) in self.confobj
 
-    def _get(self, var: str) -> str:
+    def _get(self, var: str) -> Optional[str]:
         return self.confobj.get(self.mapper(var))
 
 
 def validate_file(filename: str) -> None:
     """Ensure that the specified file exists."""
 
     if not os.path.exists(filename):
```

### Comparing `certbot-2.5.0/certbot/plugins/dns_common_lexicon.py` & `certbot-2.6.0/certbot/plugins/dns_common_lexicon.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/dns_test_common.py` & `certbot-2.6.0/certbot/plugins/dns_test_common.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/dns_test_common_lexicon.py` & `certbot-2.6.0/certbot/plugins/dns_test_common_lexicon.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/enhancements.py` & `certbot-2.6.0/certbot/plugins/enhancements.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/storage.py` & `certbot-2.6.0/certbot/plugins/storage.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/plugins/util.py` & `certbot-2.6.0/certbot/plugins/util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/reverter.py` & `certbot-2.6.0/certbot/reverter.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/acme_util.py` & `certbot-2.6.0/certbot/tests/acme_util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/README` & `certbot-2.6.0/certbot/tests/testdata/README`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert-5sans_512.pem` & `certbot-2.6.0/certbot/tests/testdata/cert-5sans_512.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert-nosans_nistp256.pem` & `certbot-2.6.0/certbot/tests/testdata/cert-nosans_nistp256.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert-san_512.pem` & `certbot-2.6.0/certbot/tests/testdata/cert-san_512.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_2048.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_2048.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_512.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_512.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_512_bad.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_512_bad.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_fullchain_2048.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_fullchain_2048.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_intermediate_1.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_intermediate_1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_intermediate_2.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_intermediate_2.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/cert_leaf.pem` & `certbot-2.6.0/certbot/tests/testdata/cert_leaf.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/csr-6sans_512.pem` & `certbot-2.6.0/certbot/tests/testdata/csr-6sans_512.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/csr-san_512.pem` & `certbot-2.6.0/certbot/tests/testdata/csr-san_512.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/ocsp_certificate.pem` & `certbot-2.6.0/certbot/tests/testdata/ocsp_certificate.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/ocsp_issuer_certificate.pem` & `certbot-2.6.0/certbot/tests/testdata/ocsp_issuer_certificate.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/ocsp_responder_certificate.pem` & `certbot-2.6.0/certbot/tests/testdata/ocsp_responder_certificate.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/rsa2048_key.pem` & `certbot-2.6.0/certbot/tests/testdata/rsa2048_key.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive/cert1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive/cert1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive/chain1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive/chain1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive/fullchain1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive/fullchain1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive/privkey1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive/privkey1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/cert1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/cert1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/chain1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/chain1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-archive-ec/fullchain1.pem` & `certbot-2.6.0/certbot/tests/testdata/sample-archive-ec/fullchain1.pem`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-renewal-ancient.conf` & `certbot-2.6.0/certbot/tests/testdata/sample-renewal-ancient.conf`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-renewal-deprecated-option.conf` & `certbot-2.6.0/certbot/tests/testdata/sample-renewal-deprecated-option.conf`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-renewal-ec.conf` & `certbot-2.6.0/certbot/tests/testdata/sample-renewal-ec.conf`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/testdata/sample-renewal.conf` & `certbot-2.6.0/certbot/tests/testdata/sample-renewal.conf`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/tests/util.py` & `certbot-2.6.0/certbot/tests/util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot/util.py` & `certbot-2.6.0/certbot/util.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot.egg-info/PKG-INFO` & `certbot-2.6.0/certbot.egg-info/PKG-INFO`

 * *Files identical despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: certbot
-Version: 2.5.0
+Version: 2.6.0
 Summary: ACME client
 Home-page: https://github.com/letsencrypt/letsencrypt
 Author: Certbot Project
 Author-email: certbot-dev@eff.org
 License: Apache License 2.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `certbot-2.5.0/certbot.egg-info/SOURCES.txt` & `certbot-2.6.0/certbot.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/certbot.egg-info/requires.txt` & `certbot-2.6.0/certbot.egg-info/requires.txt`

 * *Files 9% similar despite different names*

```diff
@@ -1,11 +1,11 @@
-acme>=2.5.0
+acme>=2.6.0
 ConfigArgParse>=0.9.3
 configobj>=5.0.6
-cryptography>=2.5.0
+cryptography>=3.2.1
 distro>=1.0.1
 josepy>=1.13.0
 parsedatetime>=2.4
 pyrfc3339
 pytz>=2019.3
 setuptools>=41.6.0
 
@@ -24,17 +24,19 @@
 mypy
 pip
 pytest
 pytest-cov
 pytest-xdist
 setuptools
 tox
+types-httplib2
 types-pyOpenSSL
 types-pyRFC3339
 types-pytz
+types-pywin32
 types-requests
 types-setuptools
 types-six
 typing-extensions
 wheel
 
 [all:python_full_version >= "3.7.2"]
@@ -56,17 +58,19 @@
 mypy
 pip
 pytest
 pytest-cov
 pytest-xdist
 setuptools
 tox
+types-httplib2
 types-pyOpenSSL
 types-pyRFC3339
 types-pytz
+types-pywin32
 types-requests
 types-setuptools
 types-six
 typing-extensions
 wheel
 
 [test:python_full_version >= "3.7.2"]
```

### Comparing `certbot-2.5.0/docs/Makefile` & `certbot-2.6.0/docs/Makefile`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/_templates/footer.html` & `certbot-2.6.0/docs/_templates/footer.html`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/challenges.rst` & `certbot-2.6.0/docs/challenges.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/ciphers.rst` & `certbot-2.6.0/docs/ciphers.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/cli-help.txt` & `certbot-2.6.0/docs/cli-help.txt`

 * *Files 2% similar despite different names*

```diff
@@ -32,15 +32,15 @@
     register        Create an ACME account
     unregister      Deactivate an ACME account
     update_account  Update an ACME account
     show_account    Display account details
   --agree-tos       Agree to the ACME server's Subscriber Agreement
    -m EMAIL         Email address for important account notifications
 
-options:
+optional arguments:
   -h, --help            show this help message and exit
   -c CONFIG_FILE, --config CONFIG_FILE
                         path to config file (default: /etc/letsencrypt/cli.ini
                         and ~/.config/letsencrypt/cli.ini)
   -v, --verbose         This flag can be used multiple times to incrementally
                         increase the verbosity of output, e.g. -vvv. (default:
                         0)
@@ -120,15 +120,15 @@
   --user-agent USER_AGENT
                         Set a custom user agent string for the client. User
                         agent strings allow the CA to collect high level
                         statistics about success rates by OS, plugin and use
                         case, and to know when to deprecate support for past
                         Python versions and flags. If you wish to hide this
                         information from the Let's Encrypt server, set this to
-                        "". (default: CertbotACMEClient/2.4.0 (certbot;
+                        "". (default: CertbotACMEClient/2.5.0 (certbot;
                         OS_NAME OS_VERSION) Authenticator/XXX Installer/YYY
                         (SUBCOMMAND; flags: FLAGS) Py/major.minor.patchlevel).
                         The flags encoded in the user agent are: --duplicate,
                         --force-renew, --allow-subset-of-names, -n, and
                         whether any hooks are set.
   --user-agent-comment USER_AGENT_COMMENT
                         Add a comment to the default user agent string. May be
@@ -315,33 +315,42 @@
   most recently renew each certificate. You can test whether future renewals
   will succeed with `--dry-run`. Individual certificates can be renewed with
   the `--cert-name` option. Hooks are available to run commands before and
   after renewal; see https://certbot.eff.org/docs/using.html#renewal for
   more information on these.
 
   --pre-hook PRE_HOOK   Command to be run in a shell before obtaining any
-                        certificates. Intended primarily for renewal, where it
-                        can be used to temporarily shut down a webserver that
-                        might conflict with the standalone plugin. This will
-                        only be called if a certificate is actually to be
-                        obtained/renewed. When renewing several certificates
-                        that have identical pre-hooks, only the first will be
-                        executed. (default: None)
+                        certificates. Unless --disable-hook-validation is
+                        used, the commands first word must be the absolute
+                        pathname of an executable or one found via the PATH
+                        environment variable. Intended primarily for renewal,
+                        where it can be used to temporarily shut down a
+                        webserver that might conflict with the standalone
+                        plugin. This will only be called if a certificate is
+                        actually to be obtained/renewed. When renewing several
+                        certificates that have identical pre-hooks, only the
+                        first will be executed. (default: None)
   --post-hook POST_HOOK
                         Command to be run in a shell after attempting to
-                        obtain/renew certificates. Can be used to deploy
-                        renewed certificates, or to restart any servers that
-                        were stopped by --pre-hook. This is only run if an
-                        attempt was made to obtain/renew a certificate. If
+                        obtain/renew certificates. Unless --disable-hook-
+                        validation is used, the commands first word must be
+                        the absolute pathname of an executable or one found
+                        via the PATH environment variable. Can be used to
+                        deploy renewed certificates, or to restart any servers
+                        that were stopped by --pre-hook. This is only run if
+                        an attempt was made to obtain/renew a certificate. If
                         multiple renewed certificates have identical post-
                         hooks, only one will be run. (default: None)
   --deploy-hook DEPLOY_HOOK
                         Command to be run in a shell once for each
-                        successfully issued certificate. For this command, the
-                        shell variable $RENEWED_LINEAGE will point to the
+                        successfully issued certificate. Unless --disable-
+                        hook-validation is used, the commands first word must
+                        be the absolute pathname of an executable or one found
+                        via the PATH environment variable. For this command,
+                        the shell variable $RENEWED_LINEAGE will point to the
                         config live subdirectory (for example,
                         "/etc/letsencrypt/live/example.com") containing the
                         new certificates and keys; the shell variable
                         $RENEWED_DOMAINS will contain a space-delimited list
                         of renewed certificate domains (for example,
                         "example.com www.example.com") (default: None)
   --disable-hook-validation
@@ -655,19 +664,14 @@
   --dns-rfc2136-credentials DNS_RFC2136_CREDENTIALS
                         RFC 2136 credentials INI file. (default: None)
 
 dns-route53:
   Obtain certificates using a DNS TXT record (if you are using AWS Route53
   for DNS).
 
-  --dns-route53-propagation-seconds DNS_ROUTE53_PROPAGATION_SECONDS
-                        The number of seconds to wait for DNS to propagate
-                        before asking the ACME server to verify the DNS
-                        record. (default: 10)
-
 dns-sakuracloud:
   Obtain certificates using a DNS TXT record (if you are using Sakura Cloud
   for DNS).
 
   --dns-sakuracloud-propagation-seconds DNS_SAKURACLOUD_PROPAGATION_SECONDS
                         The number of seconds to wait for DNS to propagate
                         before asking the ACME server to verify the DNS
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `certbot-2.5.0/docs/compatibility.rst` & `certbot-2.6.0/docs/compatibility.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/conf.py` & `certbot-2.6.0/docs/conf.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/contributing.rst` & `certbot-2.6.0/docs/contributing.rst`

 * *Files 4% similar despite different names*

```diff
@@ -37,30 +37,34 @@
 
 Install and configure the OS system dependencies required to run Certbot.
 
 .. code-block:: shell
 
    # For APT-based distributions (e.g. Debian, Ubuntu ...)
    sudo apt update
-   sudo apt install python3-dev python3-venv gcc libaugeas0 libssl-dev \
-                    libffi-dev ca-certificates openssl
+   sudo apt install python3-venv libaugeas0
    # For RPM-based distributions (e.g. Fedora, CentOS ...)
    # NB1: old distributions will use yum instead of dnf
-   # NB2: RHEL-based distributions use python3X-devel instead of python3-devel (e.g. python36-devel)
-   sudo dnf install python3-devel gcc augeas-libs openssl-devel libffi-devel \
-                    redhat-rpm-config ca-certificates openssl
+   # NB2: RHEL-based distributions use python3X instead of python3 (e.g. python38)
+   sudo dnf install python3 augeas-libs
    # For macOS installations with Homebrew already installed and configured
    # NB: If you also run `brew install python` you don't need the ~/lib
    #     directory created below, however, Certbot's Apache plugin won't work
    #     if you use Python installed from other sources such as pyenv or the
    #     version provided by Apple.
    brew install augeas
    mkdir ~/lib
    ln -s $(brew --prefix)/lib/libaugeas* ~/lib
 
+.. note:: If you have trouble creating the virtual environment below, you may
+   need to install additional dependencies. See the `cryptography project's
+   site`_ for more information.
+
+.. _`cryptography project's site`: https://cryptography.io/en/latest/installation.html#building-cryptography-on-linux
+
 Set up the Python virtual environment that will host your Certbot local instance.
 
 .. code-block:: shell
 
    cd certbot
    python tools/venv.py
 
@@ -507,16 +511,16 @@
    <type annotations>` for any functions you add or modify. You can check that
    you've done this correctly by running ``tox -e mypy`` on a machine that has
    Python 3 installed.
 2. Make sure your environment is set up properly and that you're in your
    virtualenv. You can do this by following the instructions in the
    :ref:`Getting Started <getting_started>` section.
 3. Run ``tox -e lint`` to check for pylint errors. Fix any errors.
-4. Run ``tox --skip-missing-interpreters`` to run the entire test suite
-   including coverage. The ``--skip-missing-interpreters`` argument ignores
+4. Run ``tox --skip-missing-interpreters`` to run all the tests we recommend
+   developers run locally. The ``--skip-missing-interpreters`` argument ignores
    missing versions of Python needed for running the tests. Fix any errors.
 5. If any documentation should be added or updated as part of the changes you
    have made, please include the documentation changes in your PR.
 6. Submit the PR. Once your PR is open, please do not force push to the branch
    containing your pull request to squash or amend commits. We use `squash
    merges <https://github.com/blog/2141-squash-your-commits>`_ on PRs and
    rewriting commits makes changes harder to track between reviews.
@@ -613,38 +617,7 @@
 ``pyproject.toml`` file. The syntax used by this file is described at
 https://python-poetry.org/docs/pyproject/ and how dependencies are specified in
 this file is further described at
 https://python-poetry.org/docs/dependency-specification/.
 
 If you want to learn more about the design used here, see
 ``tools/pinning/DESIGN.md`` in the Certbot repo.
-
-.. _docker-dev:
-
-Running the client with Docker
-==============================
-
-You can use Docker Compose to quickly set up an environment for running and
-testing Certbot. To install Docker Compose, follow the instructions at
-https://docs.docker.com/compose/install/.
-
-.. note:: Linux users can simply run ``pip install docker-compose`` to get
-  Docker Compose after installing Docker Engine and activating your shell as
-  described in the :ref:`Getting Started <getting_started>` section.
-
-Now you can develop on your host machine, but run Certbot and test your changes
-in Docker. When using ``docker-compose`` make sure you are inside your clone of
-the Certbot repository. As an example, you can run the following command to
-check for linting errors::
-
-  docker-compose run --rm --service-ports development bash -c 'tox -e lint'
-
-You can also leave a terminal open running a shell in the Docker container and
-modify Certbot code in another window. The Certbot repo on your host machine is
-mounted inside of the container so any changes you make immediately take
-effect. To do this, run::
-
-  docker-compose run --rm --service-ports development bash
-
-Now running the check for linting errors described above is as easy as::
-
-  tox -e lint
```

### Comparing `certbot-2.5.0/docs/install.rst` & `certbot-2.6.0/docs/install.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/make.bat` & `certbot-2.6.0/docs/make.bat`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/man/certbot.rst` & `certbot-2.6.0/docs/man/certbot.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/packaging.rst` & `certbot-2.6.0/docs/packaging.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/docs/using.rst` & `certbot-2.6.0/docs/using.rst`

 * *Files 1% similar despite different names*

```diff
@@ -370,15 +370,17 @@
       Expiry Date: 2017-02-19 19:53:00+00:00 (VALID: 30 days)
       Certificate Path: /etc/letsencrypt/live/example.com/fullchain.pem
       Key Type: RSA
       Private Key Path: /etc/letsencrypt/live/example.com/privkey.pem
 
 ``Certificate Name`` shows the name of the certificate. Pass this name
 using the ``--cert-name`` flag to specify a particular certificate for the ``run``,
-``certonly``, ``certificates``, ``renew``, and ``delete`` commands. Example::
+``certonly``, ``certificates``, ``renew``, and ``delete`` commands. The certificate
+name cannot contain filepath separators (i.e. '/' or '\\', depending on the platform).
+Example::
 
   certbot certonly --cert-name example.com
 
 .. _updating_certs:
 
 Re-creating and Updating Existing Certificates
 ----------------------------------------------
@@ -1085,27 +1087,27 @@
 https://acme-v02.api.letsencrypt.org/directory. You can tell Certbot to use a
 different CA by providing ``--server`` on the command line or in a
 :ref:`configuration file <config-file>` with the URL of the server's
 ACME directory. For example, if you would like to use Let's Encrypt's
 staging server, you would add ``--server
 https://acme-staging-v02.api.letsencrypt.org/directory`` to the command line.
 
+.. note:: ``--dry-run`` uses the Let's Encrypt staging server, unless ``--server``
+   is specified on the CLI or in the :ref:`cli.ini configuration file <config-file>`.
+   Take caution when using ``--dry-run`` with a custom server, as it may cause real
+   certificates to be issued and discarded.
+
 If Certbot does not trust the SSL certificate used by the ACME server, you
 can use the `REQUESTS_CA_BUNDLE
 <https://requests.readthedocs.io/en/latest/user/advanced/#ssl-cert-verification>`_
 environment variable to override the root certificates trusted by Certbot. Certbot
 uses the ``requests`` library, which does not use the operating system trusted root store.
+Make sure that ``REQUESTS_CA_BUNDLE`` is set globally in the environment and not only on
+the CLI, or scheduled renewal will not succeed.
 
-If you use ``--server`` to specify an ACME CA that implements the standardized
-version of the spec, you may be able to obtain a certificate for a
-wildcard domain. Some CAs (such as Let's Encrypt) require that domain
-validation for wildcard domains must be done through modifications to
-DNS records which means that the dns-01_ challenge type must be used. To
-see a list of Certbot plugins that support this challenge type and how
-to use them, see plugins_.
 
 Lock Files
 ==========
 
 When processing a validation Certbot writes a number of lock files on your system
 to prevent multiple instances from overwriting each other's changes. This means
 that by default two instances of Certbot will not be able to run in parallel.
```

### Comparing `certbot-2.5.0/docs/what.rst` & `certbot-2.6.0/docs/what.rst`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/examples/cli.ini` & `certbot-2.6.0/examples/cli.ini`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/examples/generate-csr.sh` & `certbot-2.6.0/examples/generate-csr.sh`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/examples/plugins/certbot_example_plugins.py` & `certbot-2.6.0/examples/plugins/certbot_example_plugins.py`

 * *Files identical despite different names*

### Comparing `certbot-2.5.0/setup.py` & `certbot-2.6.0/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -46,15 +46,15 @@
     # info.
     f'acme>={version}',
     # We technically need ConfigArgParse 0.10.0 for Python 2.6 support, but
     # saying so here causes a runtime error against our temporary fork of 0.9.3
     # in which we added 2.6 support (see #2243), so we relax the requirement.
     'ConfigArgParse>=0.9.3',
     'configobj>=5.0.6',
-    'cryptography>=2.5.0',
+    'cryptography>=3.2.1',
     'distro>=1.0.1',
     'josepy>=1.13.0',
     'parsedatetime>=2.4',
     'pyrfc3339',
     'pytz>=2019.3',
     # This dependency needs to be added using environment markers to avoid its
     # installation on Linux.
@@ -91,17 +91,19 @@
     # Our pinned version of pylint requires Python >= 3.7.2.
     'pylint ; python_full_version >= "3.7.2"',
     'pytest',
     'pytest-cov',
     'pytest-xdist',
     'setuptools',
     'tox',
+    'types-httplib2',
     'types-pyOpenSSL',
     'types-pyRFC3339',
     'types-pytz',
+    'types-pywin32',
     'types-requests',
     'types-setuptools',
     'types-six',
     # typing-extensions is required to import typing.Protocol and make the mypy checks
     # pass (along with pylint about non-existent objects) on Python 3.7
     'typing-extensions',
     'wheel',
```

