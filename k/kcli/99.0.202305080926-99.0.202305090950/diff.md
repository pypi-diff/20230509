# Comparing `tmp/kcli-99.0.202305080926-py3-none-any.whl.zip` & `tmp/kcli-99.0.202305090950-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,601 +1,597 @@
-Zip file size: 1476791 bytes, number of entries: 599
--rw-r--r--  2.0 unx       15 b- defN 23-May-08 09:19 kvirt/__init__.py
--rw-r--r--  2.0 unx   100853 b- defN 23-May-08 09:19 kvirt/baseconfig.py
--rw-r--r--  2.0 unx   171487 b- defN 23-May-08 09:19 kvirt/bottle.py
--rw-r--r--  2.0 unx   251073 b- defN 23-May-08 09:19 kvirt/cli.py
--rw-r--r--  2.0 unx   188288 b- defN 23-May-08 09:19 kvirt/config.py
--rw-r--r--  2.0 unx     2851 b- defN 23-May-08 09:19 kvirt/containerconfig.py
--rw-r--r--  2.0 unx    11687 b- defN 23-May-08 09:19 kvirt/defaults.py
--rw-r--r--  2.0 unx    18876 b- defN 23-May-08 09:19 kvirt/examples.py
--rw-r--r--  2.0 unx     4333 b- defN 23-May-08 09:19 kvirt/ignitionmerger.py
--rw-r--r--  2.0 unx    10280 b- defN 23-May-08 09:19 kvirt/keywords.yaml
--rw-r--r--  2.0 unx     3487 b- defN 23-May-08 09:19 kvirt/klist.py
--rw-r--r--  2.0 unx     6009 b- defN 23-May-08 09:19 kvirt/ansibleutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-08 09:19 kvirt/cluster/__init__.py
--rw-r--r--  2.0 unx      931 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/99-apps.yaml
--rw-r--r--  2.0 unx      694 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/99-forcedns
--rw-r--r--  2.0 unx     1480 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/99-notifications.yaml
--rw-r--r--  2.0 unx      653 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/Corefile
--rw-r--r--  2.0 unx    42064 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/__init__.py
--rw-r--r--  2.0 unx     1121 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/assisted_infra.yml
--rw-r--r--  2.0 unx     1269 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/assisted_ingress.yml
--rw-r--r--  2.0 unx     1417 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/autoapprovercron.yml
--rw-r--r--  2.0 unx     1106 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/bmc.yml.j2
--rw-r--r--  2.0 unx      511 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/calico.sh.j2
--rw-r--r--  2.0 unx      200 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx      184 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/extras.service
--rw-r--r--  2.0 unx      839 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/extras.sh
--rw-r--r--  2.0 unx     2770 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/hostedcluster.yaml
--rw-r--r--  2.0 unx     1174 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/httpd.yaml
--rw-r--r--  2.0 unx      889 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/ignition.sh
--rw-r--r--  2.0 unx     2307 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/kcli_plan.yml
--rw-r--r--  2.0 unx     2070 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      502 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/keepalived.conf
--rw-r--r--  2.0 unx     1587 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/nmstateconfig.yml.j2
--rw-r--r--  2.0 unx      766 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/nodepool.yaml
--rw-r--r--  2.0 unx       60 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/nonlocalbind.conf
--rw-r--r--  2.0 unx     1992 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/staticpods/coredns.yml
--rw-r--r--  2.0 unx     2244 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1721 b- defN 23-May-08 09:19 kvirt/cluster/hypershift/staticpods/mdns.yml
--rw-r--r--  2.0 unx    11178 b- defN 23-May-08 09:19 kvirt/cluster/k3s/__init__.py
--rw-r--r--  2.0 unx     1081 b- defN 23-May-08 09:19 kvirt/cluster/k3s/bootstrap.sh
--rw-r--r--  2.0 unx     1031 b- defN 23-May-08 09:19 kvirt/cluster/k3s/bootstrap.yml
--rw-r--r--  2.0 unx      305 b- defN 23-May-08 09:19 kvirt/cluster/k3s/cloud_lb_api.yml
--rw-r--r--  2.0 unx      568 b- defN 23-May-08 09:19 kvirt/cluster/k3s/ctlplanes.sh
--rw-r--r--  2.0 unx     1310 b- defN 23-May-08 09:19 kvirt/cluster/k3s/ctlplanes.yml
--rw-r--r--  2.0 unx      214 b- defN 23-May-08 09:19 kvirt/cluster/k3s/gcp-hack.service
--rw-r--r--  2.0 unx      390 b- defN 23-May-08 09:19 kvirt/cluster/k3s/gcp-hack.sh
--rw-r--r--  2.0 unx      338 b- defN 23-May-08 09:19 kvirt/cluster/k3s/join.sh
--rw-r--r--  2.0 unx     1207 b- defN 23-May-08 09:19 kvirt/cluster/k3s/kcli_default.yml
--rw-r--r--  2.0 unx      511 b- defN 23-May-08 09:19 kvirt/cluster/k3s/keepalived.conf
--rw-r--r--  2.0 unx      352 b- defN 23-May-08 09:19 kvirt/cluster/k3s/keepalived.sh
--rw-r--r--  2.0 unx      240 b- defN 23-May-08 09:19 kvirt/cluster/k3s/workers.sh
--rw-r--r--  2.0 unx      914 b- defN 23-May-08 09:19 kvirt/cluster/k3s/workers.yml
--rw-r--r--  2.0 unx     2826 b- defN 23-May-08 09:19 kvirt/cluster/kind/__init__.py
--rw-r--r--  2.0 unx     1115 b- defN 23-May-08 09:19 kvirt/cluster/kind/config.yaml
--rw-r--r--  2.0 unx     1505 b- defN 23-May-08 09:19 kvirt/cluster/kind/kcli_plan.yml
--rw-r--r--  2.0 unx      554 b- defN 23-May-08 09:19 kvirt/cluster/kind/kcli_plan_default.yml
--rw-r--r--  2.0 unx    13530 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/__init__.py
--rwxr-xr-x  2.0 unx     2707 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/bootstrap.sh
--rw-r--r--  2.0 unx     1621 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/bootstrap.yml
--rw-r--r--  2.0 unx      325 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/cloud_lb_api.yml
--rw-r--r--  2.0 unx     1367 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/ctlplanes.yml
--rwxr-xr-x  2.0 unx      417 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/deploy.sh
--rw-r--r--  2.0 unx      214 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/gcp-hack.service
--rw-r--r--  2.0 unx      398 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/gcp-hack.sh
--rwxr-xr-x  2.0 unx      412 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/join.sh
--rw-r--r--  2.0 unx     1822 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/kcli_default.yml
--rw-r--r--  2.0 unx      563 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/keepalived.conf
--rw-r--r--  2.0 unx      424 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/keepalived.sh
--rw-r--r--  2.0 unx      140 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/kubernetes.repo
--rw-r--r--  2.0 unx      179 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/multus.sh
--rw-r--r--  2.0 unx      572 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/nfs.sh
--rw-r--r--  2.0 unx      226 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/nfs.yml
--rw-r--r--  2.0 unx     4021 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/pre_el.sh
--rw-r--r--  2.0 unx     3906 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/pre_ubuntu.sh
--rw-r--r--  2.0 unx     2127 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/registry.yml
--rw-r--r--  2.0 unx     1154 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/workers.yml
--rw-r--r--  2.0 unx      487 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
--rw-r--r--  2.0 unx     2134 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/argocd/install.sh
--rw-r--r--  2.0 unx       71 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx      314 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
--rw-r--r--  2.0 unx       90 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx       91 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      380 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/certmanager/install.sh
--rw-r--r--  2.0 unx      317 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
--rw-r--r--  2.0 unx      452 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/dashboard/install.sh
--rw-r--r--  2.0 unx       23 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
--rw-r--r--  2.0 unx      373 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/dashboard/user.yml
--rw-r--r--  2.0 unx      157 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
--rw-r--r--  2.0 unx      185 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
--rw-r--r--  2.0 unx      839 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/falco/install.sh
--rw-r--r--  2.0 unx       57 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
--rw-r--r--  2.0 unx      133 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
--rw-r--r--  2.0 unx      175 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/ingress/install.sh
--rw-r--r--  2.0 unx      176 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
--rw-r--r--  2.0 unx      112 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/istio/install.sh
--rw-r--r--  2.0 unx      910 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
--rw-r--r--  2.0 unx      766 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
--rw-r--r--  2.0 unx      913 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
--rw-r--r--  2.0 unx      198 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
--rw-r--r--  2.0 unx      194 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
--rw-r--r--  2.0 unx      253 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/knative/install.sh
--rw-r--r--  2.0 unx      670 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
--rw-r--r--  2.0 unx       30 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
--rw-r--r--  2.0 unx      534 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/metallb/install.sh
--rw-r--r--  2.0 unx       47 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
--rw-r--r--  2.0 unx      157 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
--rw-r--r--  2.0 unx      150 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
--rw-r--r--  2.0 unx      283 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
--rw-r--r--  2.0 unx      348 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/olm/install.sh
--rw-r--r--  2.0 unx      350 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
--rw-r--r--  2.0 unx      320 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
--rw-r--r--  2.0 unx       34 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
--rw-r--r--  2.0 unx      322 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
--rw-r--r--  2.0 unx     1662 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/rancher/install.sh
--rw-r--r--  2.0 unx      103 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
--rw-r--r--  2.0 unx      161 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
--rw-r--r--  2.0 unx      191 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
--rw-r--r--  2.0 unx      151 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
--rw-r--r--  2.0 unx      572 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/rook/install.sh
--rw-r--r--  2.0 unx      190 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/submariner/install.sh
--rw-r--r--  2.0 unx       22 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
--rw-r--r--  2.0 unx      277 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/tekton/install.sh
--rw-r--r--  2.0 unx      278 b- defN 23-May-08 09:19 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
--rw-r--r--  2.0 unx     2970 b- defN 23-May-08 09:19 kvirt/cluster/kubecommon/__init__.py
--rw-r--r--  2.0 unx     9395 b- defN 23-May-08 09:19 kvirt/cluster/kubernetes/__init__.py
--rw-r--r--  2.0 unx     4805 b- defN 23-May-08 09:19 kvirt/cluster/microshift/__init__.py
--rw-r--r--  2.0 unx      603 b- defN 23-May-08 09:19 kvirt/cluster/microshift/kcli_plan.yml
--rw-r--r--  2.0 unx      625 b- defN 23-May-08 09:19 kvirt/cluster/microshift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      262 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/00_sslip.sh
--rw-r--r--  2.0 unx      799 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/01_clients.sh
--rw-r--r--  2.0 unx      183 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/02_crio.sh
--rw-r--r--  2.0 unx      538 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/03_microshift.sh
--rw-r--r--  2.0 unx      341 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
--rw-r--r--  2.0 unx     2252 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/05_acm.sh
--rw-r--r--  2.0 unx      696 b- defN 23-May-08 09:19 kvirt/cluster/microshift/scripts/deploy.sh
--rw-r--r--  2.0 unx      219 b- defN 23-May-08 09:19 kvirt/cluster/openshift/01-workload-partitioning
--rw-r--r--  2.0 unx      573 b- defN 23-May-08 09:19 kvirt/cluster/openshift/10-node-ip-hint.yaml
--rw-r--r--  2.0 unx     1005 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-apps.yaml
--rw-r--r--  2.0 unx      618 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
--rw-r--r--  2.0 unx     1239 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
--rw-r--r--  2.0 unx      529 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-chrony.yaml
--rw-r--r--  2.0 unx      646 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-forcedns
--rw-r--r--  2.0 unx      476 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-forcedns-ibm
--rw-r--r--  2.0 unx     1127 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-localhost-fix.yaml
--rw-r--r--  2.0 unx      250 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
--rw-r--r--  2.0 unx      162 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     1659 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-notifications.yaml
--rw-r--r--  2.0 unx      118 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-operatorhub.yaml
--rw-r--r--  2.0 unx      302 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-ovn.yaml
--rw-r--r--  2.0 unx      488 b- defN 23-May-08 09:19 kvirt/cluster/openshift/99-sno.yaml
--rw-r--r--  2.0 unx      762 b- defN 23-May-08 09:19 kvirt/cluster/openshift/Corefile
--rw-r--r--  2.0 unx    78973 b- defN 23-May-08 09:19 kvirt/cluster/openshift/__init__.py
--rw-r--r--  2.0 unx     1326 b- defN 23-May-08 09:19 kvirt/cluster/openshift/autoapprovercron.yml
--rw-r--r--  2.0 unx      987 b- defN 23-May-08 09:19 kvirt/cluster/openshift/autorules.yml
--rw-r--r--  2.0 unx     1630 b- defN 23-May-08 09:19 kvirt/cluster/openshift/bootstrap.yml
--rw-r--r--  2.0 unx      250 b- defN 23-May-08 09:19 kvirt/cluster/openshift/calico.sh.j2
--rw-r--r--  2.0 unx      107 b- defN 23-May-08 09:19 kvirt/cluster/openshift/chrony.conf
--rw-r--r--  2.0 unx      629 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cloud_bootstrap.yml
--rw-r--r--  2.0 unx     1086 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cloud_ctlplanes.yml
--rw-r--r--  2.0 unx      217 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cloud_dns.yml
--rw-r--r--  2.0 unx      616 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cloud_lb_api.yml
--rw-r--r--  2.0 unx      204 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx      703 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cloud_workers.yml
--rw-r--r--  2.0 unx      123 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cluster-ingress-02-config.yml
--rw-r--r--  2.0 unx      159 b- defN 23-May-08 09:19 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
--rw-r--r--  2.0 unx      224 b- defN 23-May-08 09:19 kvirt/cluster/openshift/config.hcl.templ
--rw-r--r--  2.0 unx       98 b- defN 23-May-08 09:19 kvirt/cluster/openshift/contrail-ca-patch.service
--rw-r--r--  2.0 unx      486 b- defN 23-May-08 09:19 kvirt/cluster/openshift/contrail-ca-patch.sh
--rw-r--r--  2.0 unx      998 b- defN 23-May-08 09:19 kvirt/cluster/openshift/contrail.sh.j2
--rw-r--r--  2.0 unx     2170 b- defN 23-May-08 09:19 kvirt/cluster/openshift/ctlplanes.yml
--rw-r--r--  2.0 unx      326 b- defN 23-May-08 09:19 kvirt/cluster/openshift/dhcp.conf
--rw-r--r--  2.0 unx      106 b- defN 23-May-08 09:19 kvirt/cluster/openshift/dhcp.sh
--rw-r--r--  2.0 unx      536 b- defN 23-May-08 09:19 kvirt/cluster/openshift/dhcp.yml
--rw-r--r--  2.0 unx      759 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected.yml
--rw-r--r--  2.0 unx     8945 b- defN 23-May-08 09:19 kvirt/cluster/openshift/fake_kubeconfig.json
--rw-r--r--  2.0 unx       35 b- defN 23-May-08 09:19 kvirt/cluster/openshift/fake_pull.json
--rw-r--r--  2.0 unx       24 b- defN 23-May-08 09:19 kvirt/cluster/openshift/gcp-hack.preset
--rw-r--r--  2.0 unx      320 b- defN 23-May-08 09:19 kvirt/cluster/openshift/gcp-hack.service
--rw-r--r--  2.0 unx      398 b- defN 23-May-08 09:19 kvirt/cluster/openshift/gcp-hack.sh
--rw-r--r--  2.0 unx     1792 b- defN 23-May-08 09:19 kvirt/cluster/openshift/haproxy.cfg
--rw-r--r--  2.0 unx     2483 b- defN 23-May-08 09:19 kvirt/cluster/openshift/haproxy.cfg.kubevirt
--rw-r--r--  2.0 unx      902 b- defN 23-May-08 09:19 kvirt/cluster/openshift/httpd.yaml
--rw-r--r--  2.0 unx      524 b- defN 23-May-08 09:19 kvirt/cluster/openshift/ignition.j2
--rw-r--r--  2.0 unx     3414 b- defN 23-May-08 09:19 kvirt/cluster/openshift/install-config.yaml
--rw-r--r--  2.0 unx      260 b- defN 23-May-08 09:19 kvirt/cluster/openshift/ipv6.conf
--rw-r--r--  2.0 unx     2691 b- defN 23-May-08 09:19 kvirt/cluster/openshift/iso.sh
--rw-r--r--  2.0 unx     4182 b- defN 23-May-08 09:19 kvirt/cluster/openshift/kcli_default.yml
--rw-r--r--  2.0 unx      982 b- defN 23-May-08 09:19 kvirt/cluster/openshift/keepalived.conf
--rw-r--r--  2.0 unx       60 b- defN 23-May-08 09:19 kvirt/cluster/openshift/nonlocalbind.conf
--rw-r--r--  2.0 unx       59 b- defN 23-May-08 09:19 kvirt/cluster/openshift/openshift-workload-pinning
--rw-r--r--  2.0 unx      212 b- defN 23-May-08 09:19 kvirt/cluster/openshift/sno-finish.service
--rw-r--r--  2.0 unx     2022 b- defN 23-May-08 09:19 kvirt/cluster/openshift/sno-finish.sh
--rw-r--r--  2.0 unx      660 b- defN 23-May-08 09:19 kvirt/cluster/openshift/sno.yml
--rw-r--r--  2.0 unx     1507 b- defN 23-May-08 09:19 kvirt/cluster/openshift/workers.yml
--rw-r--r--  2.0 unx       40 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/cr.sh
--rw-r--r--  2.0 unx      768 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/install.yml.j2
--rw-r--r--  2.0 unx      162 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2754 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2838 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
--rw-r--r--  2.0 unx      418 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
--rw-r--r--  2.0 unx      259 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
--rw-r--r--  2.0 unx     1219 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
--rw-r--r--  2.0 unx      645 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/argocd/configmap.yml
--rw-r--r--  2.0 unx     2423 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/argocd/install.sh
--rw-r--r--  2.0 unx       49 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx     1093 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/autolabeller/cr.yml
--rw-r--r--  2.0 unx      142 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx     1093 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/autolabeller/install.yml
--rw-r--r--  2.0 unx      165 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
--rw-r--r--  2.0 unx       25 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      873 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
--rw-r--r--  2.0 unx       63 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
--rw-r--r--  2.0 unx      265 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/istio/install.sh
--rw-r--r--  2.0 unx      377 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
--rw-r--r--  2.0 unx     1039 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
--rw-r--r--  2.0 unx      154 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
--rw-r--r--  2.0 unx      775 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
--rw-r--r--  2.0 unx      227 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
--rw-r--r--  2.0 unx      642 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
--rw-r--r--  2.0 unx      349 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
--rw-r--r--  2.0 unx      137 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
--rw-r--r--  2.0 unx      595 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/lvms-operator/post.sh
--rw-r--r--  2.0 unx      510 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
--rw-r--r--  2.0 unx       94 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
--rw-r--r--  2.0 unx      162 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2754 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2845 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
--rw-r--r--  2.0 unx      245 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
--rw-r--r--  2.0 unx      118 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
--rwxr-xr-x  2.0 unx       55 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
--rwxr-xr-x  2.0 unx     2298 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/nfs/install.sh
--rw-r--r--  2.0 unx      117 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
--rw-r--r--  2.0 unx      185 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/nfs/uninstall.sh
--rw-r--r--  2.0 unx      849 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/odf-operator/cr.yml
--rw-r--r--  2.0 unx      298 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
--rw-r--r--  2.0 unx      364 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
--rw-r--r--  2.0 unx      362 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
--rw-r--r--  2.0 unx      745 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/odf-operator/post.sh
--rw-r--r--  2.0 unx      530 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/odf-operator/pre.sh
--rw-r--r--  2.0 unx      363 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
--rw-r--r--  2.0 unx      157 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
--rw-r--r--  2.0 unx      278 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/serverless-operator/post.sh
--rw-r--r--  2.0 unx     1227 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/users/install.sh
--rw-r--r--  2.0 unx       84 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/users/kcli_default.yml
--rw-r--r--  2.0 unx      258 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/users/oauth.yml
--rw-r--r--  2.0 unx      249 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
--rw-r--r--  2.0 unx      422 b- defN 23-May-08 09:19 kvirt/cluster/openshift/apps/users/uninstall.sh
--rw-r--r--  2.0 unx       60 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
--rw-r--r--  2.0 unx       91 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
--rw-r--r--  2.0 unx      264 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
--rw-r--r--  2.0 unx      389 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
--rw-r--r--  2.0 unx      184 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/99-monitoring.yaml
--rw-r--r--  2.0 unx      289 b- defN 23-May-08 09:19 kvirt/cluster/openshift/customisation/99-registry.yaml
--rw-r--r--  2.0 unx     1685 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/haproxy.cfg
--rw-r--r--  2.0 unx      211 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/registry.service
--rwxr-xr-x  2.0 unx      328 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
--rwxr-xr-x  2.0 unx      201 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
--rwxr-xr-x  2.0 unx     2380 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
--rwxr-xr-x  2.0 unx     2046 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
--rwxr-xr-x  2.0 unx      337 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
--rwxr-xr-x  2.0 unx     2390 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
--rwxr-xr-x  2.0 unx      241 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
--rwxr-xr-x  2.0 unx      733 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
--rw-r--r--  2.0 unx     1768 b- defN 23-May-08 09:19 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
--rw-r--r--  2.0 unx     2557 b- defN 23-May-08 09:19 kvirt/cluster/openshift/staticpods/coredns.yml
--rw-r--r--  2.0 unx      987 b- defN 23-May-08 09:19 kvirt/cluster/openshift/staticpods/haproxy.yml
--rw-r--r--  2.0 unx     2539 b- defN 23-May-08 09:19 kvirt/cluster/openshift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1721 b- defN 23-May-08 09:19 kvirt/cluster/openshift/staticpods/mdns.yml
--rw-r--r--  2.0 unx      193 b- defN 23-May-08 09:19 kvirt/cluster/profiles/sample-kubeadm-default.yml
--rw-r--r--  2.0 unx      135 b- defN 23-May-08 09:19 kvirt/cluster/profiles/sample-openshift-compact.yml
--rw-r--r--  2.0 unx      213 b- defN 23-May-08 09:19 kvirt/cluster/profiles/sample-openshift-contrail.yml
--rw-r--r--  2.0 unx       55 b- defN 23-May-08 09:19 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
--rw-r--r--  2.0 unx      126 b- defN 23-May-08 09:19 kvirt/cluster/profiles/sample-openshift-sno.yml
--rw-r--r--  2.0 unx     3377 b- defN 23-May-08 09:19 kvirt/common/Jenkinsfile.j2
--rw-r--r--  2.0 unx    96404 b- defN 23-May-08 09:19 kvirt/common/__init__.py
--rw-r--r--  2.0 unx     1406 b- defN 23-May-08 09:19 kvirt/common/autoscale.yaml.j2
--rw-r--r--  2.0 unx     8945 b- defN 23-May-08 09:19 kvirt/common/fake_kubeconfig.json
--rw-r--r--  2.0 unx      669 b- defN 23-May-08 09:19 kvirt/common/ignition.j2
--rw-r--r--  2.0 unx      125 b- defN 23-May-08 09:19 kvirt/common/kubevirt_kcli_conf.j2
--rw-r--r--  2.0 unx       99 b- defN 23-May-08 09:19 kvirt/common/local_kcli_conf.j2
--rw-r--r--  2.0 unx     3068 b- defN 23-May-08 09:19 kvirt/common/pipeline.yml.j2
--rw-r--r--  2.0 unx     2377 b- defN 23-May-08 09:19 kvirt/common/pipeline_kube.yml.j2
--rw-r--r--  2.0 unx     1381 b- defN 23-May-08 09:19 kvirt/common/playbook.j2
--rw-r--r--  2.0 unx     1557 b- defN 23-May-08 09:19 kvirt/common/storage.sh.j2
--rw-r--r--  2.0 unx     4562 b- defN 23-May-08 09:19 kvirt/common/vm.ovf.j2
--rw-r--r--  2.0 unx     2241 b- defN 23-May-08 09:19 kvirt/common/workflow.yml.j2
--rw-r--r--  2.0 unx     2208 b- defN 23-May-08 09:19 kvirt/common/workflow_script.yml.j2
--rw-r--r--  2.0 unx    15041 b- defN 23-May-08 09:19 kvirt/container/__init__.py
--rw-r--r--  2.0 unx    11716 b- defN 23-May-08 09:19 kvirt/expose/__init__.py
--rw-r--r--  2.0 unx     4319 b- defN 23-May-08 09:19 kvirt/expose/swagger.yml
--rw-r--r--  2.0 unx      408 b- defN 23-May-08 09:19 kvirt/expose/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx   121125 b- defN 23-May-08 09:19 kvirt/expose/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-May-08 09:19 kvirt/expose/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-May-08 09:19 kvirt/expose/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      868 b- defN 23-May-08 09:19 kvirt/expose/static/css/kcli.css
--rw-r--r--  2.0 unx      269 b- defN 23-May-08 09:19 kvirt/expose/static/css/wheel.css
--rw-r--r--  2.0 unx     1406 b- defN 23-May-08 09:19 kvirt/expose/static/images/favicon.ico
--rw-r--r--  2.0 unx      160 b- defN 23-May-08 09:19 kvirt/expose/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-May-08 09:19 kvirt/expose/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-May-08 09:19 kvirt/expose/static/images/sort_desc.png
--rw-r--r--  2.0 unx    24772 b- defN 23-May-08 09:19 kvirt/expose/static/images/wheel.gif
--rw-r--r--  2.0 unx    12398 b- defN 23-May-08 09:19 kvirt/expose/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx      367 b- defN 23-May-08 09:19 kvirt/expose/static/js/exposeactions.js
--rw-r--r--  2.0 unx    83059 b- defN 23-May-08 09:19 kvirt/expose/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    89795 b- defN 23-May-08 09:19 kvirt/expose/static/js/jquery.min.js
--rw-r--r--  2.0 unx      263 b- defN 23-May-08 09:19 kvirt/expose/static/js/list.js
--rw-r--r--  2.0 unx     1605 b- defN 23-May-08 09:19 kvirt/expose/templates/form.html
--rw-r--r--  2.0 unx     1035 b- defN 23-May-08 09:19 kvirt/expose/templates/head.html
--rw-r--r--  2.0 unx      406 b- defN 23-May-08 09:19 kvirt/expose/templates/index.html
--rw-r--r--  2.0 unx     1220 b- defN 23-May-08 09:19 kvirt/expose/templates/infoplan.html
--rw-r--r--  2.0 unx      574 b- defN 23-May-08 09:19 kvirt/expose/templates/planstable.html
--rw-r--r--  2.0 unx      550 b- defN 23-May-08 09:19 kvirt/expose/templates/result.html
--rw-r--r--  2.0 unx     1754 b- defN 23-May-08 09:19 kvirt/internalplans/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-08 09:19 kvirt/jinjafilters/__init__.py
--rw-r--r--  2.0 unx     5249 b- defN 23-May-08 09:19 kvirt/jinjafilters/jinjafilters.py
--rw-r--r--  2.0 unx     8477 b- defN 23-May-08 09:19 kvirt/kfish/__init__.py
--rw-r--r--  2.0 unx     9124 b- defN 23-May-08 09:19 kvirt/ksushy/__init__.py
--rw-r--r--  2.0 unx      121 b- defN 23-May-08 09:19 kvirt/ksushy/main.py
--rw-r--r--  2.0 unx     1028 b- defN 23-May-08 09:19 kvirt/ksushy/templates/bios.json
--rw-r--r--  2.0 unx      443 b- defN 23-May-08 09:19 kvirt/ksushy/templates/interface.json
--rw-r--r--  2.0 unx      418 b- defN 23-May-08 09:19 kvirt/ksushy/templates/interfaces.json
--rw-r--r--  2.0 unx     1050 b- defN 23-May-08 09:19 kvirt/ksushy/templates/manager.json
--rw-r--r--  2.0 unx      571 b- defN 23-May-08 09:19 kvirt/ksushy/templates/managers.json
--rw-r--r--  2.0 unx      535 b- defN 23-May-08 09:19 kvirt/ksushy/templates/root.json
--rw-r--r--  2.0 unx     2732 b- defN 23-May-08 09:19 kvirt/ksushy/templates/system.json
--rw-r--r--  2.0 unx      511 b- defN 23-May-08 09:19 kvirt/ksushy/templates/systems.json
--rw-r--r--  2.0 unx     1219 b- defN 23-May-08 09:19 kvirt/ksushy/templates/virtualmedia_cd.json
--rw-r--r--  2.0 unx      705 b- defN 23-May-08 09:19 kvirt/ksushy/templates/virtualmedias.json
--rw-r--r--  2.0 unx     2780 b- defN 23-May-08 09:19 kvirt/miniconsole/__init__.py
--rw-r--r--  2.0 unx     3488 b- defN 23-May-08 09:19 kvirt/nameutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-08 09:19 kvirt/providers/__init__.py
--rw-r--r--  2.0 unx     8935 b- defN 23-May-08 09:19 kvirt/providers/sampleprovider.py
--rw-r--r--  2.0 unx    65790 b- defN 23-May-08 09:19 kvirt/providers/aws/__init__.py
--rw-r--r--  2.0 unx      479 b- defN 23-May-08 09:19 kvirt/providers/fake/__init__.py
--rw-r--r--  2.0 unx    62237 b- defN 23-May-08 09:19 kvirt/providers/gcp/__init__.py
--rw-r--r--  2.0 unx    65026 b- defN 23-May-08 09:19 kvirt/providers/ibm/__init__.py
--rw-r--r--  2.0 unx    88792 b- defN 23-May-08 09:19 kvirt/providers/kubevirt/__init__.py
--rw-r--r--  2.0 unx   183457 b- defN 23-May-08 09:19 kvirt/providers/kvm/__init__.py
--rw-r--r--  2.0 unx     1965 b- defN 23-May-08 09:19 kvirt/providers/kvm/helpers.py
--rw-r--r--  2.0 unx    57063 b- defN 23-May-08 09:19 kvirt/providers/openstack/__init__.py
--rw-r--r--  2.0 unx    62531 b- defN 23-May-08 09:19 kvirt/providers/ovirt/__init__.py
--rw-r--r--  2.0 unx    31099 b- defN 23-May-08 09:19 kvirt/providers/packet/__init__.py
--rw-r--r--  2.0 unx    73086 b- defN 23-May-08 09:19 kvirt/providers/vsphere/__init__.py
--rw-r--r--  2.0 unx    13655 b- defN 23-May-08 09:19 kvirt/providers/vsphere/helpers.py
--rw-r--r--  2.0 unx     4893 b- defN 23-May-08 09:19 kvirt/providers/vsphere/tagging.py
--rw-r--r--  2.0 unx    21273 b- defN 23-May-08 09:19 kvirt/providers/web/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-08 09:19 kvirt/version/__init__.py
--rw-r--r--  2.0 unx       19 b- defN 23-May-08 09:26 kvirt/version/git
--rw-r--r--  2.0 unx    46950 b- defN 23-May-08 09:19 kvirt/web/__init__.py
--rw-r--r--  2.0 unx      261 b- defN 23-May-08 09:19 kvirt/web/main.py
--rw-r--r--  2.0 unx      408 b- defN 23-May-08 09:19 kvirt/web/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx    23409 b- defN 23-May-08 09:19 kvirt/web/static/css/bootstrap-theme.min.css
--rw-r--r--  2.0 unx   121125 b- defN 23-May-08 09:19 kvirt/web/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-May-08 09:19 kvirt/web/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-May-08 09:19 kvirt/web/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      816 b- defN 23-May-08 09:19 kvirt/web/static/css/kcli.css
--rw-r--r--  2.0 unx     3033 b- defN 23-May-08 09:19 kvirt/web/static/css/navbar.css
--rw-r--r--  2.0 unx     2908 b- defN 23-May-08 09:19 kvirt/web/static/css/spice.css
--rw-r--r--  2.0 unx      271 b- defN 23-May-08 09:19 kvirt/web/static/css/wheel.css
--rw-r--r--  2.0 unx    18028 b- defN 23-May-08 09:19 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
--rw-r--r--  2.0 unx      715 b- defN 23-May-08 09:19 kvirt/web/static/images/Centos.png
--rw-r--r--  2.0 unx      294 b- defN 23-May-08 09:19 kvirt/web/static/images/Debian.png
--rw-r--r--  2.0 unx      987 b- defN 23-May-08 09:19 kvirt/web/static/images/Fedora.png
--rw-r--r--  2.0 unx      672 b- defN 23-May-08 09:19 kvirt/web/static/images/Redhat.png
--rw-r--r--  2.0 unx     1278 b- defN 23-May-08 09:19 kvirt/web/static/images/Suse.png
--rw-r--r--  2.0 unx     1782 b- defN 23-May-08 09:19 kvirt/web/static/images/Tux.png
--rw-r--r--  2.0 unx      544 b- defN 23-May-08 09:19 kvirt/web/static/images/Ubuntu.png
--rw-r--r--  2.0 unx     4213 b- defN 23-May-08 09:19 kvirt/web/static/images/delete.png
--rw-r--r--  2.0 unx     1406 b- defN 23-May-08 09:19 kvirt/web/static/images/favicon.ico
--rw-r--r--  2.0 unx    23320 b- defN 23-May-08 09:19 kvirt/web/static/images/kcli-small.png
--rw-r--r--  2.0 unx    27185 b- defN 23-May-08 09:19 kvirt/web/static/images/kcli.jpg
--rw-r--r--  2.0 unx   113928 b- defN 23-May-08 09:19 kvirt/web/static/images/kcli.png
--rw-r--r--  2.0 unx    48809 b- defN 23-May-08 09:19 kvirt/web/static/images/logo-header.svg
--rw-r--r--  2.0 unx    48809 b- defN 23-May-08 09:19 kvirt/web/static/images/logo-main.svg
--rw-r--r--  2.0 unx      160 b- defN 23-May-08 09:19 kvirt/web/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-May-08 09:19 kvirt/web/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-May-08 09:19 kvirt/web/static/images/sort_desc.png
--rw-r--r--  2.0 unx     3927 b- defN 23-May-08 09:19 kvirt/web/static/images/start.png
--rw-r--r--  2.0 unx     3631 b- defN 23-May-08 09:19 kvirt/web/static/images/stop.png
--rw-r--r--  2.0 unx    24772 b- defN 23-May-08 09:19 kvirt/web/static/images/wheel.gif
--rw-r--r--  2.0 unx     2933 b- defN 23-May-08 09:19 kvirt/web/static/js/bootstrap-notify.js
--rw-r--r--  2.0 unx    37045 b- defN 23-May-08 09:19 kvirt/web/static/js/bootstrap.min.js
--rw-r--r--  2.0 unx     2523 b- defN 23-May-08 09:19 kvirt/web/static/js/containeraction.js
--rw-r--r--  2.0 unx    12398 b- defN 23-May-08 09:19 kvirt/web/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx     1642 b- defN 23-May-08 09:19 kvirt/web/static/js/hostaction.js
--rw-r--r--  2.0 unx     1187 b- defN 23-May-08 09:19 kvirt/web/static/js/imageaction.js
--rw-r--r--  2.0 unx    83059 b- defN 23-May-08 09:19 kvirt/web/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    89795 b- defN 23-May-08 09:19 kvirt/web/static/js/jquery.min.js
--rw-r--r--  2.0 unx     2704 b- defN 23-May-08 09:19 kvirt/web/static/js/kcli.js
--rw-r--r--  2.0 unx     1594 b- defN 23-May-08 09:19 kvirt/web/static/js/kubeaction.js
--rw-r--r--  2.0 unx     3907 b- defN 23-May-08 09:19 kvirt/web/static/js/list.js
--rw-r--r--  2.0 unx     1376 b- defN 23-May-08 09:19 kvirt/web/static/js/networkaction.js
--rw-r--r--  2.0 unx     2457 b- defN 23-May-08 09:19 kvirt/web/static/js/planaction.js
--rw-r--r--  2.0 unx     1237 b- defN 23-May-08 09:19 kvirt/web/static/js/poolaction.js
--rw-r--r--  2.0 unx      846 b- defN 23-May-08 09:19 kvirt/web/static/js/productaction.js
--rw-r--r--  2.0 unx      270 b- defN 23-May-08 09:19 kvirt/web/static/js/refresh.js
--rw-r--r--  2.0 unx     1835 b- defN 23-May-08 09:19 kvirt/web/static/js/repoaction.js
--rw-r--r--  2.0 unx     3463 b- defN 23-May-08 09:19 kvirt/web/static/js/snapshotaction.js
--rw-r--r--  2.0 unx     2745 b- defN 23-May-08 09:19 kvirt/web/static/js/vmaction.js
--rw-r--r--  2.0 unx      123 b- defN 23-May-08 09:19 kvirt/web/static/js/wheel.js
--rw-r--r--  2.0 unx     9944 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/atKeynames.js
--rw-r--r--  2.0 unx     2335 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/bitmap.js
--rw-r--r--  2.0 unx     4795 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/cursor.js
--rw-r--r--  2.0 unx    49214 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/display.js
--rw-r--r--  2.0 unx    13253 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/enums.js
--rw-r--r--  2.0 unx     2847 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/filexfer.js
--rw-r--r--  2.0 unx     9535 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/inputs.js
--rw-r--r--  2.0 unx     6176 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/lz.js
--rw-r--r--  2.0 unx    18370 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/main.js
--rw-r--r--  2.0 unx    12677 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/playback.js
--rw-r--r--  2.0 unx     7036 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/png.js
--rw-r--r--  2.0 unx     3110 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/port.js
--rw-r--r--  2.0 unx    44531 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/quic.js
--rw-r--r--  2.0 unx     3030 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/resize.js
--rw-r--r--  2.0 unx     7282 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/simulatecursor.js
--rw-r--r--  2.0 unx     1895 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/spicearraybuffer.js
--rw-r--r--  2.0 unx    18202 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/spiceconn.js
--rw-r--r--  2.0 unx     3616 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/spicedataview.js
--rw-r--r--  2.0 unx    33015 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/spicemsg.js
--rw-r--r--  2.0 unx    12767 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/spicetype.js
--rw-r--r--  2.0 unx     6808 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/ticket.js
--rw-r--r--  2.0 unx    13628 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/utils.js
--rw-r--r--  2.0 unx    21577 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/webm.js
--rw-r--r--  2.0 unx     4131 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/wire.js
--rw-r--r--  2.0 unx    16580 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/jsbn.js
--rw-r--r--  2.0 unx     2529 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/prng4.js
--rw-r--r--  2.0 unx     3442 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/rng.js
--rw-r--r--  2.0 unx     4257 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/rsa.js
--rw-r--r--  2.0 unx    10671 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/sha1.js
--rw-r--r--  2.0 unx        0 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
--rw-r--r--  2.0 unx      419 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      359 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8601 b- defN 23-May-08 09:19 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     2176 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/error-handler.js
--rw-r--r--  2.0 unx     5682 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/localization.js
--rw-r--r--  2.0 unx    56845 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/ui.js
--rw-r--r--  2.0 unx     6696 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/webutil.js
--rw-r--r--  2.0 unx     3553 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/alt.svg
--rw-r--r--  2.0 unx     3980 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/clipboard.svg
--rw-r--r--  2.0 unx     3430 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/connect.svg
--rw-r--r--  2.0 unx     4381 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/ctrl.svg
--rw-r--r--  2.0 unx     3237 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
--rw-r--r--  2.0 unx     5062 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/disconnect.svg
--rw-r--r--  2.0 unx     4684 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/drag.svg
--rw-r--r--  2.0 unx     3106 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/error.svg
--rw-r--r--  2.0 unx     4522 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/esc.svg
--rw-r--r--  2.0 unx     3066 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/expander.svg
--rw-r--r--  2.0 unx     3139 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/fullscreen.svg
--rw-r--r--  2.0 unx     2559 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/handle.svg
--rw-r--r--  2.0 unx     6386 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/handle_bg.svg
--rw-r--r--  2.0 unx     3204 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/info.svg
--rw-r--r--  2.0 unx     6404 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/keyboard.svg
--rw-r--r--  2.0 unx     7000 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/mouse_left.svg
--rw-r--r--  2.0 unx     7002 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/mouse_middle.svg
--rw-r--r--  2.0 unx     6993 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/mouse_none.svg
--rw-r--r--  2.0 unx     7001 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/mouse_right.svg
--rw-r--r--  2.0 unx     3985 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/power.svg
--rw-r--r--  2.0 unx     3082 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/settings.svg
--rw-r--r--  2.0 unx     2953 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/tab.svg
--rw-r--r--  2.0 unx     4441 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
--rw-r--r--  2.0 unx     3869 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/warning.svg
--rw-r--r--  2.0 unx     3178 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/windows.svg
--rw-r--r--  2.0 unx      871 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/Makefile
--rw-r--r--  2.0 unx     4028 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
--rw-r--r--  2.0 unx     4582 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
--rw-r--r--  2.0 unx     5216 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
--rw-r--r--  2.0 unx      675 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
--rw-r--r--  2.0 unx     5787 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
--rw-r--r--  2.0 unx     1000 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
--rw-r--r--  2.0 unx     1064 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
--rw-r--r--  2.0 unx     1397 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
--rw-r--r--  2.0 unx     1932 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
--rw-r--r--  2.0 unx     1946 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
--rw-r--r--  2.0 unx     2699 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
--rw-r--r--  2.0 unx     2874 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
--rw-r--r--  2.0 unx     2351 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
--rw-r--r--  2.0 unx    11685 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
--rw-r--r--  2.0 unx    11549 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
--rw-r--r--  2.0 unx     2885 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/cs.json
--rw-r--r--  2.0 unx     2854 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/de.json
--rw-r--r--  2.0 unx     3906 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/el.json
--rw-r--r--  2.0 unx     2671 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/es.json
--rw-r--r--  2.0 unx     3354 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/ja.json
--rw-r--r--  2.0 unx     2961 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/ko.json
--rw-r--r--  2.0 unx     3035 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/nl.json
--rw-r--r--  2.0 unx     2830 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/pl.json
--rw-r--r--  2.0 unx     3825 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/ru.json
--rw-r--r--  2.0 unx     2845 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/sv.json
--rw-r--r--  2.0 unx     2811 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/tr.json
--rw-r--r--  2.0 unx     2597 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/zh_CN.json
--rw-r--r--  2.0 unx     2606 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/locale/zh_TW.json
--rw-r--r--  2.0 unx      157 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/sounds/CREDITS
--rw-r--r--  2.0 unx     4531 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/sounds/bell.mp3
--rw-r--r--  2.0 unx     8495 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/sounds/bell.oga
--rw-r--r--  2.0 unx    38580 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
--rw-r--r--  2.0 unx    17472 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/styles/Orbitron700.woff
--rw-r--r--  2.0 unx    18450 b- defN 23-May-08 09:19 kvirt/web/static/vnc/app/styles/base.css
--rw-r--r--  2.0 unx     4189 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/base64.js
--rw-r--r--  2.0 unx    11241 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/des.js
--rw-r--r--  2.0 unx    20381 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/display.js
--rw-r--r--  2.0 unx     1374 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/encodings.js
--rw-r--r--  2.0 unx     1170 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/inflator.js
--rw-r--r--  2.0 unx    74196 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/rfb.js
--rw-r--r--  2.0 unx     9130 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/websock.js
--rw-r--r--  2.0 unx      628 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/decoders/copyrect.js
--rw-r--r--  2.0 unx     4814 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/decoders/hextile.js
--rw-r--r--  2.0 unx     1739 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/decoders/raw.js
--rw-r--r--  2.0 unx     1210 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/decoders/rre.js
--rw-r--r--  2.0 unx     9662 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/decoders/tight.js
--rw-r--r--  2.0 unx      768 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/decoders/tightpng.js
--rw-r--r--  2.0 unx    11438 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/domkeytable.js
--rw-r--r--  2.0 unx     3804 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/fixedkeys.js
--rw-r--r--  2.0 unx    13090 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/keyboard.js
--rw-r--r--  2.0 unx    34609 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/keysym.js
--rw-r--r--  2.0 unx    25374 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/keysymdef.js
--rw-r--r--  2.0 unx     9995 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/mouse.js
--rw-r--r--  2.0 unx     5283 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/util.js
--rw-r--r--  2.0 unx     2580 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/vkeys.js
--rw-r--r--  2.0 unx    14256 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/input/xtscancodes.js
--rw-r--r--  2.0 unx     3155 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/browser.js
--rw-r--r--  2.0 unx     7556 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/cursor.js
--rw-r--r--  2.0 unx     4221 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/events.js
--rw-r--r--  2.0 unx      896 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/eventtarget.js
--rw-r--r--  2.0 unx     1358 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/logging.js
--rw-r--r--  2.0 unx     1866 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/polyfill.js
--rw-r--r--  2.0 unx      301 b- defN 23-May-08 09:19 kvirt/web/static/vnc/core/util/strings.js
--rw-r--r--  2.0 unx     7388 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/promise.js
--rw-r--r--  2.0 unx      419 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      295 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8498 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     1084 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/LICENSE
--rw-r--r--  2.0 unx      301 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/README.md
--rw-r--r--  2.0 unx     1062 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
--rw-r--r--  2.0 unx      666 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
--rw-r--r--  2.0 unx     1334 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
--rw-r--r--  2.0 unx      764 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
--rw-r--r--  2.0 unx    60016 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
--rw-r--r--  2.0 unx     1251 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
--rw-r--r--  2.0 unx    11690 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
--rw-r--r--  2.0 unx    47128 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
--rw-r--r--  2.0 unx    11527 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
--rw-r--r--  2.0 unx      560 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
--rw-r--r--  2.0 unx    38767 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
--rw-r--r--  2.0 unx      823 b- defN 23-May-08 09:19 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
--rw-r--r--  2.0 unx     2509 b- defN 23-May-08 09:19 kvirt/web/templates/bootstrap.html
--rw-r--r--  2.0 unx    14595 b- defN 23-May-08 09:19 kvirt/web/templates/console.html
--rw-r--r--  2.0 unx      717 b- defN 23-May-08 09:19 kvirt/web/templates/containercreate.html
--rw-r--r--  2.0 unx      493 b- defN 23-May-08 09:19 kvirt/web/templates/containerprofiles.html
--rw-r--r--  2.0 unx     1050 b- defN 23-May-08 09:19 kvirt/web/templates/containerprofilestable.html
--rw-r--r--  2.0 unx      490 b- defN 23-May-08 09:19 kvirt/web/templates/containers.html
--rw-r--r--  2.0 unx     1746 b- defN 23-May-08 09:19 kvirt/web/templates/containerstable.html
--rw-r--r--  2.0 unx     2123 b- defN 23-May-08 09:19 kvirt/web/templates/head.html
--rw-r--r--  2.0 unx      473 b- defN 23-May-08 09:19 kvirt/web/templates/hosts.html
--rw-r--r--  2.0 unx     1705 b- defN 23-May-08 09:19 kvirt/web/templates/hoststable.html
--rw-r--r--  2.0 unx     1119 b- defN 23-May-08 09:19 kvirt/web/templates/imagecreate.html
--rw-r--r--  2.0 unx      478 b- defN 23-May-08 09:19 kvirt/web/templates/images.html
--rw-r--r--  2.0 unx      646 b- defN 23-May-08 09:19 kvirt/web/templates/imagestable.html
--rw-r--r--  2.0 unx      472 b- defN 23-May-08 09:19 kvirt/web/templates/isos.html
--rw-r--r--  2.0 unx      261 b- defN 23-May-08 09:19 kvirt/web/templates/isostable.html
--rw-r--r--  2.0 unx      609 b- defN 23-May-08 09:19 kvirt/web/templates/kubecreate.html
--rw-r--r--  2.0 unx      622 b- defN 23-May-08 09:19 kvirt/web/templates/kubeinfo.html
--rw-r--r--  2.0 unx      488 b- defN 23-May-08 09:19 kvirt/web/templates/kubeprofiles.html
--rw-r--r--  2.0 unx      845 b- defN 23-May-08 09:19 kvirt/web/templates/kubeprofilestable.html
--rw-r--r--  2.0 unx      475 b- defN 23-May-08 09:19 kvirt/web/templates/kubes.html
--rw-r--r--  2.0 unx     1850 b- defN 23-May-08 09:19 kvirt/web/templates/kubestable.html
--rw-r--r--  2.0 unx      151 b- defN 23-May-08 09:19 kvirt/web/templates/layout.html
--rw-r--r--  2.0 unx     5517 b- defN 23-May-08 09:19 kvirt/web/templates/navbar.html
--rw-r--r--  2.0 unx      882 b- defN 23-May-08 09:19 kvirt/web/templates/networkcreate.html
--rw-r--r--  2.0 unx      537 b- defN 23-May-08 09:19 kvirt/web/templates/networks.html
--rw-r--r--  2.0 unx      845 b- defN 23-May-08 09:19 kvirt/web/templates/networkstable.html
--rw-r--r--  2.0 unx      750 b- defN 23-May-08 09:19 kvirt/web/templates/plancreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-May-08 09:19 kvirt/web/templates/plans.html
--rw-r--r--  2.0 unx     1525 b- defN 23-May-08 09:19 kvirt/web/templates/planstable.html
--rw-r--r--  2.0 unx      859 b- defN 23-May-08 09:19 kvirt/web/templates/poolcreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-May-08 09:19 kvirt/web/templates/pools.html
--rw-r--r--  2.0 unx      554 b- defN 23-May-08 09:19 kvirt/web/templates/poolstable.html
--rw-r--r--  2.0 unx     1282 b- defN 23-May-08 09:19 kvirt/web/templates/productcreate.html
--rw-r--r--  2.0 unx      484 b- defN 23-May-08 09:19 kvirt/web/templates/products.html
--rw-r--r--  2.0 unx      895 b- defN 23-May-08 09:19 kvirt/web/templates/productstable.html
--rw-r--r--  2.0 unx      699 b- defN 23-May-08 09:19 kvirt/web/templates/repocreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-May-08 09:19 kvirt/web/templates/repos.html
--rw-r--r--  2.0 unx     1203 b- defN 23-May-08 09:19 kvirt/web/templates/repostable.html
--rw-r--r--  2.0 unx      958 b- defN 23-May-08 09:19 kvirt/web/templates/vmcreate.html
--rw-r--r--  2.0 unx      486 b- defN 23-May-08 09:19 kvirt/web/templates/vmprofiles.html
--rw-r--r--  2.0 unx     1420 b- defN 23-May-08 09:19 kvirt/web/templates/vmprofilestable.html
--rw-r--r--  2.0 unx      470 b- defN 23-May-08 09:19 kvirt/web/templates/vms.html
--rw-r--r--  2.0 unx     4894 b- defN 23-May-08 09:19 kvirt/web/templates/vmstable.html
--rw-r--r--  2.0 unx    11358 b- defN 23-May-08 09:26 kcli-99.0.202305080926.dist-info/LICENSE
--rw-r--r--  2.0 unx     2914 b- defN 23-May-08 09:26 kcli-99.0.202305080926.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-May-08 09:26 kcli-99.0.202305080926.dist-info/WHEEL
--rw-r--r--  2.0 unx      209 b- defN 23-May-08 09:26 kcli-99.0.202305080926.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-May-08 09:26 kcli-99.0.202305080926.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    58737 b- defN 23-May-08 09:26 kcli-99.0.202305080926.dist-info/RECORD
-599 files, 4556429 bytes uncompressed, 1381473 bytes compressed:  69.7%
+Zip file size: 1473233 bytes, number of entries: 595
+-rw-r--r--  2.0 unx       15 b- defN 23-May-09 09:46 kvirt/__init__.py
+-rw-r--r--  2.0 unx   100595 b- defN 23-May-09 09:46 kvirt/baseconfig.py
+-rw-r--r--  2.0 unx   171487 b- defN 23-May-09 09:46 kvirt/bottle.py
+-rw-r--r--  2.0 unx   249548 b- defN 23-May-09 09:46 kvirt/cli.py
+-rw-r--r--  2.0 unx   187988 b- defN 23-May-09 09:46 kvirt/config.py
+-rw-r--r--  2.0 unx     2851 b- defN 23-May-09 09:46 kvirt/containerconfig.py
+-rw-r--r--  2.0 unx    11687 b- defN 23-May-09 09:46 kvirt/defaults.py
+-rw-r--r--  2.0 unx    18601 b- defN 23-May-09 09:46 kvirt/examples.py
+-rw-r--r--  2.0 unx     4333 b- defN 23-May-09 09:46 kvirt/ignitionmerger.py
+-rw-r--r--  2.0 unx    10280 b- defN 23-May-09 09:46 kvirt/keywords.yaml
+-rw-r--r--  2.0 unx     3487 b- defN 23-May-09 09:46 kvirt/klist.py
+-rw-r--r--  2.0 unx     6009 b- defN 23-May-09 09:46 kvirt/ansibleutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-09 09:46 kvirt/cluster/__init__.py
+-rw-r--r--  2.0 unx      931 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/99-apps.yaml
+-rw-r--r--  2.0 unx      694 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/99-forcedns
+-rw-r--r--  2.0 unx     1480 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/99-notifications.yaml
+-rw-r--r--  2.0 unx      653 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/Corefile
+-rw-r--r--  2.0 unx    42064 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/__init__.py
+-rw-r--r--  2.0 unx     1121 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/assisted_infra.yml
+-rw-r--r--  2.0 unx     1269 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/assisted_ingress.yml
+-rw-r--r--  2.0 unx     1417 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/autoapprovercron.yml
+-rw-r--r--  2.0 unx     1106 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/bmc.yml.j2
+-rw-r--r--  2.0 unx      511 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/calico.sh.j2
+-rw-r--r--  2.0 unx      200 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx      184 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/extras.service
+-rw-r--r--  2.0 unx      839 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/extras.sh
+-rw-r--r--  2.0 unx     2770 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/hostedcluster.yaml
+-rw-r--r--  2.0 unx     1174 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/httpd.yaml
+-rw-r--r--  2.0 unx      889 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/ignition.sh
+-rw-r--r--  2.0 unx     2307 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/kcli_plan.yml
+-rw-r--r--  2.0 unx     2070 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      502 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/keepalived.conf
+-rw-r--r--  2.0 unx     1587 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/nmstateconfig.yml.j2
+-rw-r--r--  2.0 unx      766 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/nodepool.yaml
+-rw-r--r--  2.0 unx       60 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/nonlocalbind.conf
+-rw-r--r--  2.0 unx     1992 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx     2244 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1721 b- defN 23-May-09 09:46 kvirt/cluster/hypershift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx    11178 b- defN 23-May-09 09:46 kvirt/cluster/k3s/__init__.py
+-rw-r--r--  2.0 unx     1081 b- defN 23-May-09 09:46 kvirt/cluster/k3s/bootstrap.sh
+-rw-r--r--  2.0 unx     1050 b- defN 23-May-09 09:46 kvirt/cluster/k3s/bootstrap.yml
+-rw-r--r--  2.0 unx      305 b- defN 23-May-09 09:46 kvirt/cluster/k3s/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      568 b- defN 23-May-09 09:46 kvirt/cluster/k3s/ctlplanes.sh
+-rw-r--r--  2.0 unx     1329 b- defN 23-May-09 09:46 kvirt/cluster/k3s/ctlplanes.yml
+-rw-r--r--  2.0 unx      214 b- defN 23-May-09 09:46 kvirt/cluster/k3s/gcp-hack.service
+-rw-r--r--  2.0 unx      390 b- defN 23-May-09 09:46 kvirt/cluster/k3s/gcp-hack.sh
+-rw-r--r--  2.0 unx      338 b- defN 23-May-09 09:46 kvirt/cluster/k3s/join.sh
+-rw-r--r--  2.0 unx     1207 b- defN 23-May-09 09:46 kvirt/cluster/k3s/kcli_default.yml
+-rw-r--r--  2.0 unx      511 b- defN 23-May-09 09:46 kvirt/cluster/k3s/keepalived.conf
+-rw-r--r--  2.0 unx      352 b- defN 23-May-09 09:46 kvirt/cluster/k3s/keepalived.sh
+-rw-r--r--  2.0 unx      240 b- defN 23-May-09 09:46 kvirt/cluster/k3s/workers.sh
+-rw-r--r--  2.0 unx      914 b- defN 23-May-09 09:46 kvirt/cluster/k3s/workers.yml
+-rw-r--r--  2.0 unx    13530 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/__init__.py
+-rwxr-xr-x  2.0 unx     2707 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/bootstrap.sh
+-rw-r--r--  2.0 unx     1621 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/bootstrap.yml
+-rw-r--r--  2.0 unx      325 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/cloud_lb_api.yml
+-rw-r--r--  2.0 unx     1367 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/ctlplanes.yml
+-rwxr-xr-x  2.0 unx      417 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/deploy.sh
+-rw-r--r--  2.0 unx      214 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/gcp-hack.service
+-rw-r--r--  2.0 unx      398 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/gcp-hack.sh
+-rwxr-xr-x  2.0 unx      412 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/join.sh
+-rw-r--r--  2.0 unx     1822 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/kcli_default.yml
+-rw-r--r--  2.0 unx      563 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/keepalived.conf
+-rw-r--r--  2.0 unx      424 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/keepalived.sh
+-rw-r--r--  2.0 unx      140 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/kubernetes.repo
+-rw-r--r--  2.0 unx      179 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/multus.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/nfs.sh
+-rw-r--r--  2.0 unx      226 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/nfs.yml
+-rw-r--r--  2.0 unx     4021 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/pre_el.sh
+-rw-r--r--  2.0 unx     3906 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/pre_ubuntu.sh
+-rw-r--r--  2.0 unx     2127 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/registry.yml
+-rw-r--r--  2.0 unx     1154 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/workers.yml
+-rw-r--r--  2.0 unx      487 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
+-rw-r--r--  2.0 unx     2134 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       71 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx      314 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
+-rw-r--r--  2.0 unx       90 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx       91 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      380 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/certmanager/install.sh
+-rw-r--r--  2.0 unx      317 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
+-rw-r--r--  2.0 unx      452 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/dashboard/install.sh
+-rw-r--r--  2.0 unx       23 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
+-rw-r--r--  2.0 unx      373 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/dashboard/user.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
+-rw-r--r--  2.0 unx      839 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/falco/install.sh
+-rw-r--r--  2.0 unx       57 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
+-rw-r--r--  2.0 unx      133 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
+-rw-r--r--  2.0 unx      175 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/ingress/install.sh
+-rw-r--r--  2.0 unx      176 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
+-rw-r--r--  2.0 unx      112 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/istio/install.sh
+-rw-r--r--  2.0 unx      910 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
+-rw-r--r--  2.0 unx      766 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
+-rw-r--r--  2.0 unx      913 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
+-rw-r--r--  2.0 unx      198 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
+-rw-r--r--  2.0 unx      194 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
+-rw-r--r--  2.0 unx      253 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/knative/install.sh
+-rw-r--r--  2.0 unx      670 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
+-rw-r--r--  2.0 unx       30 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
+-rw-r--r--  2.0 unx      534 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/metallb/install.sh
+-rw-r--r--  2.0 unx       47 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
+-rw-r--r--  2.0 unx      150 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
+-rw-r--r--  2.0 unx      283 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
+-rw-r--r--  2.0 unx      348 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/olm/install.sh
+-rw-r--r--  2.0 unx      350 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
+-rw-r--r--  2.0 unx      320 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
+-rw-r--r--  2.0 unx       34 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
+-rw-r--r--  2.0 unx      322 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
+-rw-r--r--  2.0 unx     1662 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/rancher/install.sh
+-rw-r--r--  2.0 unx      103 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
+-rw-r--r--  2.0 unx      161 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
+-rw-r--r--  2.0 unx      191 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
+-rw-r--r--  2.0 unx      151 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/rook/install.sh
+-rw-r--r--  2.0 unx      190 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/submariner/install.sh
+-rw-r--r--  2.0 unx       22 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
+-rw-r--r--  2.0 unx      277 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/tekton/install.sh
+-rw-r--r--  2.0 unx      278 b- defN 23-May-09 09:46 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
+-rw-r--r--  2.0 unx     2970 b- defN 23-May-09 09:46 kvirt/cluster/kubecommon/__init__.py
+-rw-r--r--  2.0 unx     9395 b- defN 23-May-09 09:46 kvirt/cluster/kubernetes/__init__.py
+-rw-r--r--  2.0 unx     4805 b- defN 23-May-09 09:46 kvirt/cluster/microshift/__init__.py
+-rw-r--r--  2.0 unx      603 b- defN 23-May-09 09:46 kvirt/cluster/microshift/kcli_plan.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-May-09 09:46 kvirt/cluster/microshift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      262 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/00_sslip.sh
+-rw-r--r--  2.0 unx      799 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/01_clients.sh
+-rw-r--r--  2.0 unx      183 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/02_crio.sh
+-rw-r--r--  2.0 unx      538 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/03_microshift.sh
+-rw-r--r--  2.0 unx      341 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
+-rw-r--r--  2.0 unx     2252 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/05_acm.sh
+-rw-r--r--  2.0 unx      696 b- defN 23-May-09 09:46 kvirt/cluster/microshift/scripts/deploy.sh
+-rw-r--r--  2.0 unx      219 b- defN 23-May-09 09:46 kvirt/cluster/openshift/01-workload-partitioning
+-rw-r--r--  2.0 unx      573 b- defN 23-May-09 09:46 kvirt/cluster/openshift/10-node-ip-hint.yaml
+-rw-r--r--  2.0 unx     1005 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-apps.yaml
+-rw-r--r--  2.0 unx      618 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
+-rw-r--r--  2.0 unx     1239 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
+-rw-r--r--  2.0 unx      529 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-chrony.yaml
+-rw-r--r--  2.0 unx      646 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-forcedns
+-rw-r--r--  2.0 unx      476 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-forcedns-ibm
+-rw-r--r--  2.0 unx     1127 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-localhost-fix.yaml
+-rw-r--r--  2.0 unx      250 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
+-rw-r--r--  2.0 unx      162 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     1659 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-notifications.yaml
+-rw-r--r--  2.0 unx      118 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-operatorhub.yaml
+-rw-r--r--  2.0 unx      302 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-ovn.yaml
+-rw-r--r--  2.0 unx      488 b- defN 23-May-09 09:46 kvirt/cluster/openshift/99-sno.yaml
+-rw-r--r--  2.0 unx      762 b- defN 23-May-09 09:46 kvirt/cluster/openshift/Corefile
+-rw-r--r--  2.0 unx    78973 b- defN 23-May-09 09:46 kvirt/cluster/openshift/__init__.py
+-rw-r--r--  2.0 unx     1326 b- defN 23-May-09 09:46 kvirt/cluster/openshift/autoapprovercron.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-May-09 09:46 kvirt/cluster/openshift/autorules.yml
+-rw-r--r--  2.0 unx     1630 b- defN 23-May-09 09:46 kvirt/cluster/openshift/bootstrap.yml
+-rw-r--r--  2.0 unx      250 b- defN 23-May-09 09:46 kvirt/cluster/openshift/calico.sh.j2
+-rw-r--r--  2.0 unx      107 b- defN 23-May-09 09:46 kvirt/cluster/openshift/chrony.conf
+-rw-r--r--  2.0 unx      629 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cloud_bootstrap.yml
+-rw-r--r--  2.0 unx     1086 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cloud_ctlplanes.yml
+-rw-r--r--  2.0 unx      217 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cloud_dns.yml
+-rw-r--r--  2.0 unx      616 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      204 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx      703 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cloud_workers.yml
+-rw-r--r--  2.0 unx      123 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cluster-ingress-02-config.yml
+-rw-r--r--  2.0 unx      159 b- defN 23-May-09 09:46 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-May-09 09:46 kvirt/cluster/openshift/config.hcl.templ
+-rw-r--r--  2.0 unx       98 b- defN 23-May-09 09:46 kvirt/cluster/openshift/contrail-ca-patch.service
+-rw-r--r--  2.0 unx      486 b- defN 23-May-09 09:46 kvirt/cluster/openshift/contrail-ca-patch.sh
+-rw-r--r--  2.0 unx      998 b- defN 23-May-09 09:46 kvirt/cluster/openshift/contrail.sh.j2
+-rw-r--r--  2.0 unx     2170 b- defN 23-May-09 09:46 kvirt/cluster/openshift/ctlplanes.yml
+-rw-r--r--  2.0 unx      326 b- defN 23-May-09 09:46 kvirt/cluster/openshift/dhcp.conf
+-rw-r--r--  2.0 unx      106 b- defN 23-May-09 09:46 kvirt/cluster/openshift/dhcp.sh
+-rw-r--r--  2.0 unx      536 b- defN 23-May-09 09:46 kvirt/cluster/openshift/dhcp.yml
+-rw-r--r--  2.0 unx      759 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected.yml
+-rw-r--r--  2.0 unx     8945 b- defN 23-May-09 09:46 kvirt/cluster/openshift/fake_kubeconfig.json
+-rw-r--r--  2.0 unx       35 b- defN 23-May-09 09:46 kvirt/cluster/openshift/fake_pull.json
+-rw-r--r--  2.0 unx       24 b- defN 23-May-09 09:46 kvirt/cluster/openshift/gcp-hack.preset
+-rw-r--r--  2.0 unx      320 b- defN 23-May-09 09:46 kvirt/cluster/openshift/gcp-hack.service
+-rw-r--r--  2.0 unx      398 b- defN 23-May-09 09:46 kvirt/cluster/openshift/gcp-hack.sh
+-rw-r--r--  2.0 unx     1792 b- defN 23-May-09 09:46 kvirt/cluster/openshift/haproxy.cfg
+-rw-r--r--  2.0 unx     2483 b- defN 23-May-09 09:46 kvirt/cluster/openshift/haproxy.cfg.kubevirt
+-rw-r--r--  2.0 unx      902 b- defN 23-May-09 09:46 kvirt/cluster/openshift/httpd.yaml
+-rw-r--r--  2.0 unx      524 b- defN 23-May-09 09:46 kvirt/cluster/openshift/ignition.j2
+-rw-r--r--  2.0 unx     3414 b- defN 23-May-09 09:46 kvirt/cluster/openshift/install-config.yaml
+-rw-r--r--  2.0 unx      260 b- defN 23-May-09 09:46 kvirt/cluster/openshift/ipv6.conf
+-rw-r--r--  2.0 unx     2691 b- defN 23-May-09 09:46 kvirt/cluster/openshift/iso.sh
+-rw-r--r--  2.0 unx     4182 b- defN 23-May-09 09:46 kvirt/cluster/openshift/kcli_default.yml
+-rw-r--r--  2.0 unx      982 b- defN 23-May-09 09:46 kvirt/cluster/openshift/keepalived.conf
+-rw-r--r--  2.0 unx       60 b- defN 23-May-09 09:46 kvirt/cluster/openshift/nonlocalbind.conf
+-rw-r--r--  2.0 unx       59 b- defN 23-May-09 09:46 kvirt/cluster/openshift/openshift-workload-pinning
+-rw-r--r--  2.0 unx      212 b- defN 23-May-09 09:46 kvirt/cluster/openshift/sno-finish.service
+-rw-r--r--  2.0 unx     2022 b- defN 23-May-09 09:46 kvirt/cluster/openshift/sno-finish.sh
+-rw-r--r--  2.0 unx      660 b- defN 23-May-09 09:46 kvirt/cluster/openshift/sno.yml
+-rw-r--r--  2.0 unx     1507 b- defN 23-May-09 09:46 kvirt/cluster/openshift/workers.yml
+-rw-r--r--  2.0 unx       40 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/cr.sh
+-rw-r--r--  2.0 unx      768 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/install.yml.j2
+-rw-r--r--  2.0 unx      162 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2754 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2838 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
+-rw-r--r--  2.0 unx      418 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
+-rw-r--r--  2.0 unx      259 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
+-rw-r--r--  2.0 unx     1219 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
+-rw-r--r--  2.0 unx      645 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/argocd/configmap.yml
+-rw-r--r--  2.0 unx     2423 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       49 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx     1093 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/autolabeller/cr.yml
+-rw-r--r--  2.0 unx      142 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx     1093 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/autolabeller/install.yml
+-rw-r--r--  2.0 unx      165 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
+-rw-r--r--  2.0 unx       25 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      873 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
+-rw-r--r--  2.0 unx       63 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
+-rw-r--r--  2.0 unx      265 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/istio/install.sh
+-rw-r--r--  2.0 unx      377 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
+-rw-r--r--  2.0 unx     1039 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
+-rw-r--r--  2.0 unx      154 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
+-rw-r--r--  2.0 unx      775 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
+-rw-r--r--  2.0 unx      227 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      642 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
+-rw-r--r--  2.0 unx      349 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
+-rw-r--r--  2.0 unx      137 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      595 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/lvms-operator/post.sh
+-rw-r--r--  2.0 unx      510 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
+-rw-r--r--  2.0 unx       94 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      162 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2754 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2845 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
+-rw-r--r--  2.0 unx      245 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
+-rw-r--r--  2.0 unx      118 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
+-rwxr-xr-x  2.0 unx       55 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
+-rwxr-xr-x  2.0 unx     2298 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/nfs/install.sh
+-rw-r--r--  2.0 unx      117 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/nfs/uninstall.sh
+-rw-r--r--  2.0 unx      849 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/odf-operator/cr.yml
+-rw-r--r--  2.0 unx      298 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      364 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
+-rw-r--r--  2.0 unx      362 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
+-rw-r--r--  2.0 unx      745 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/odf-operator/post.sh
+-rw-r--r--  2.0 unx      530 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/odf-operator/pre.sh
+-rw-r--r--  2.0 unx      363 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      278 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/serverless-operator/post.sh
+-rw-r--r--  2.0 unx     1227 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/users/install.sh
+-rw-r--r--  2.0 unx       84 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/users/kcli_default.yml
+-rw-r--r--  2.0 unx      258 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/users/oauth.yml
+-rw-r--r--  2.0 unx      249 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
+-rw-r--r--  2.0 unx      422 b- defN 23-May-09 09:46 kvirt/cluster/openshift/apps/users/uninstall.sh
+-rw-r--r--  2.0 unx       60 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
+-rw-r--r--  2.0 unx       91 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
+-rw-r--r--  2.0 unx      264 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
+-rw-r--r--  2.0 unx      389 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
+-rw-r--r--  2.0 unx      184 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/99-monitoring.yaml
+-rw-r--r--  2.0 unx      289 b- defN 23-May-09 09:46 kvirt/cluster/openshift/customisation/99-registry.yaml
+-rw-r--r--  2.0 unx     1685 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/haproxy.cfg
+-rw-r--r--  2.0 unx      211 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/registry.service
+-rwxr-xr-x  2.0 unx      328 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
+-rwxr-xr-x  2.0 unx      201 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
+-rwxr-xr-x  2.0 unx     2380 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
+-rwxr-xr-x  2.0 unx     2046 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
+-rwxr-xr-x  2.0 unx      337 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
+-rwxr-xr-x  2.0 unx     2390 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
+-rwxr-xr-x  2.0 unx      241 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
+-rwxr-xr-x  2.0 unx      733 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
+-rw-r--r--  2.0 unx     1768 b- defN 23-May-09 09:46 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
+-rw-r--r--  2.0 unx     2557 b- defN 23-May-09 09:46 kvirt/cluster/openshift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-May-09 09:46 kvirt/cluster/openshift/staticpods/haproxy.yml
+-rw-r--r--  2.0 unx     2539 b- defN 23-May-09 09:46 kvirt/cluster/openshift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1721 b- defN 23-May-09 09:46 kvirt/cluster/openshift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx      193 b- defN 23-May-09 09:46 kvirt/cluster/profiles/sample-kubeadm-default.yml
+-rw-r--r--  2.0 unx      135 b- defN 23-May-09 09:46 kvirt/cluster/profiles/sample-openshift-compact.yml
+-rw-r--r--  2.0 unx      213 b- defN 23-May-09 09:46 kvirt/cluster/profiles/sample-openshift-contrail.yml
+-rw-r--r--  2.0 unx       55 b- defN 23-May-09 09:46 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
+-rw-r--r--  2.0 unx      126 b- defN 23-May-09 09:46 kvirt/cluster/profiles/sample-openshift-sno.yml
+-rw-r--r--  2.0 unx     3377 b- defN 23-May-09 09:46 kvirt/common/Jenkinsfile.j2
+-rw-r--r--  2.0 unx    96404 b- defN 23-May-09 09:46 kvirt/common/__init__.py
+-rw-r--r--  2.0 unx     1406 b- defN 23-May-09 09:46 kvirt/common/autoscale.yaml.j2
+-rw-r--r--  2.0 unx     8945 b- defN 23-May-09 09:46 kvirt/common/fake_kubeconfig.json
+-rw-r--r--  2.0 unx      669 b- defN 23-May-09 09:46 kvirt/common/ignition.j2
+-rw-r--r--  2.0 unx      125 b- defN 23-May-09 09:46 kvirt/common/kubevirt_kcli_conf.j2
+-rw-r--r--  2.0 unx       99 b- defN 23-May-09 09:46 kvirt/common/local_kcli_conf.j2
+-rw-r--r--  2.0 unx     3068 b- defN 23-May-09 09:46 kvirt/common/pipeline.yml.j2
+-rw-r--r--  2.0 unx     2377 b- defN 23-May-09 09:46 kvirt/common/pipeline_kube.yml.j2
+-rw-r--r--  2.0 unx     1381 b- defN 23-May-09 09:46 kvirt/common/playbook.j2
+-rw-r--r--  2.0 unx     1557 b- defN 23-May-09 09:46 kvirt/common/storage.sh.j2
+-rw-r--r--  2.0 unx     4562 b- defN 23-May-09 09:46 kvirt/common/vm.ovf.j2
+-rw-r--r--  2.0 unx     2241 b- defN 23-May-09 09:46 kvirt/common/workflow.yml.j2
+-rw-r--r--  2.0 unx     2208 b- defN 23-May-09 09:46 kvirt/common/workflow_script.yml.j2
+-rw-r--r--  2.0 unx    15041 b- defN 23-May-09 09:46 kvirt/container/__init__.py
+-rw-r--r--  2.0 unx    11716 b- defN 23-May-09 09:46 kvirt/expose/__init__.py
+-rw-r--r--  2.0 unx     4319 b- defN 23-May-09 09:46 kvirt/expose/swagger.yml
+-rw-r--r--  2.0 unx      408 b- defN 23-May-09 09:46 kvirt/expose/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-May-09 09:46 kvirt/expose/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-May-09 09:46 kvirt/expose/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-May-09 09:46 kvirt/expose/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      868 b- defN 23-May-09 09:46 kvirt/expose/static/css/kcli.css
+-rw-r--r--  2.0 unx      269 b- defN 23-May-09 09:46 kvirt/expose/static/css/wheel.css
+-rw-r--r--  2.0 unx     1406 b- defN 23-May-09 09:46 kvirt/expose/static/images/favicon.ico
+-rw-r--r--  2.0 unx      160 b- defN 23-May-09 09:46 kvirt/expose/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-May-09 09:46 kvirt/expose/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-May-09 09:46 kvirt/expose/static/images/sort_desc.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-May-09 09:46 kvirt/expose/static/images/wheel.gif
+-rw-r--r--  2.0 unx    12398 b- defN 23-May-09 09:46 kvirt/expose/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx      367 b- defN 23-May-09 09:46 kvirt/expose/static/js/exposeactions.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-May-09 09:46 kvirt/expose/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    89795 b- defN 23-May-09 09:46 kvirt/expose/static/js/jquery.min.js
+-rw-r--r--  2.0 unx      263 b- defN 23-May-09 09:46 kvirt/expose/static/js/list.js
+-rw-r--r--  2.0 unx     1605 b- defN 23-May-09 09:46 kvirt/expose/templates/form.html
+-rw-r--r--  2.0 unx     1035 b- defN 23-May-09 09:46 kvirt/expose/templates/head.html
+-rw-r--r--  2.0 unx      406 b- defN 23-May-09 09:46 kvirt/expose/templates/index.html
+-rw-r--r--  2.0 unx     1220 b- defN 23-May-09 09:46 kvirt/expose/templates/infoplan.html
+-rw-r--r--  2.0 unx      574 b- defN 23-May-09 09:46 kvirt/expose/templates/planstable.html
+-rw-r--r--  2.0 unx      550 b- defN 23-May-09 09:46 kvirt/expose/templates/result.html
+-rw-r--r--  2.0 unx     1754 b- defN 23-May-09 09:46 kvirt/internalplans/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-09 09:46 kvirt/jinjafilters/__init__.py
+-rw-r--r--  2.0 unx     5249 b- defN 23-May-09 09:46 kvirt/jinjafilters/jinjafilters.py
+-rw-r--r--  2.0 unx     8477 b- defN 23-May-09 09:46 kvirt/kfish/__init__.py
+-rw-r--r--  2.0 unx     9124 b- defN 23-May-09 09:46 kvirt/ksushy/__init__.py
+-rw-r--r--  2.0 unx      121 b- defN 23-May-09 09:46 kvirt/ksushy/main.py
+-rw-r--r--  2.0 unx     1028 b- defN 23-May-09 09:46 kvirt/ksushy/templates/bios.json
+-rw-r--r--  2.0 unx      443 b- defN 23-May-09 09:46 kvirt/ksushy/templates/interface.json
+-rw-r--r--  2.0 unx      418 b- defN 23-May-09 09:46 kvirt/ksushy/templates/interfaces.json
+-rw-r--r--  2.0 unx     1050 b- defN 23-May-09 09:46 kvirt/ksushy/templates/manager.json
+-rw-r--r--  2.0 unx      571 b- defN 23-May-09 09:46 kvirt/ksushy/templates/managers.json
+-rw-r--r--  2.0 unx      535 b- defN 23-May-09 09:46 kvirt/ksushy/templates/root.json
+-rw-r--r--  2.0 unx     2732 b- defN 23-May-09 09:46 kvirt/ksushy/templates/system.json
+-rw-r--r--  2.0 unx      511 b- defN 23-May-09 09:46 kvirt/ksushy/templates/systems.json
+-rw-r--r--  2.0 unx     1219 b- defN 23-May-09 09:46 kvirt/ksushy/templates/virtualmedia_cd.json
+-rw-r--r--  2.0 unx      705 b- defN 23-May-09 09:46 kvirt/ksushy/templates/virtualmedias.json
+-rw-r--r--  2.0 unx     2780 b- defN 23-May-09 09:46 kvirt/miniconsole/__init__.py
+-rw-r--r--  2.0 unx     3488 b- defN 23-May-09 09:46 kvirt/nameutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-09 09:46 kvirt/providers/__init__.py
+-rw-r--r--  2.0 unx     8935 b- defN 23-May-09 09:46 kvirt/providers/sampleprovider.py
+-rw-r--r--  2.0 unx    65790 b- defN 23-May-09 09:46 kvirt/providers/aws/__init__.py
+-rw-r--r--  2.0 unx      479 b- defN 23-May-09 09:46 kvirt/providers/fake/__init__.py
+-rw-r--r--  2.0 unx    62237 b- defN 23-May-09 09:46 kvirt/providers/gcp/__init__.py
+-rw-r--r--  2.0 unx    65026 b- defN 23-May-09 09:46 kvirt/providers/ibm/__init__.py
+-rw-r--r--  2.0 unx    88792 b- defN 23-May-09 09:46 kvirt/providers/kubevirt/__init__.py
+-rw-r--r--  2.0 unx   183457 b- defN 23-May-09 09:46 kvirt/providers/kvm/__init__.py
+-rw-r--r--  2.0 unx     1965 b- defN 23-May-09 09:46 kvirt/providers/kvm/helpers.py
+-rw-r--r--  2.0 unx    57063 b- defN 23-May-09 09:46 kvirt/providers/openstack/__init__.py
+-rw-r--r--  2.0 unx    62531 b- defN 23-May-09 09:46 kvirt/providers/ovirt/__init__.py
+-rw-r--r--  2.0 unx    31099 b- defN 23-May-09 09:46 kvirt/providers/packet/__init__.py
+-rw-r--r--  2.0 unx    73086 b- defN 23-May-09 09:46 kvirt/providers/vsphere/__init__.py
+-rw-r--r--  2.0 unx    13655 b- defN 23-May-09 09:46 kvirt/providers/vsphere/helpers.py
+-rw-r--r--  2.0 unx     4893 b- defN 23-May-09 09:46 kvirt/providers/vsphere/tagging.py
+-rw-r--r--  2.0 unx    21273 b- defN 23-May-09 09:46 kvirt/providers/web/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-09 09:46 kvirt/version/__init__.py
+-rw-r--r--  2.0 unx       19 b- defN 23-May-09 09:50 kvirt/version/git
+-rw-r--r--  2.0 unx    46950 b- defN 23-May-09 09:46 kvirt/web/__init__.py
+-rw-r--r--  2.0 unx      261 b- defN 23-May-09 09:46 kvirt/web/main.py
+-rw-r--r--  2.0 unx      408 b- defN 23-May-09 09:46 kvirt/web/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx    23409 b- defN 23-May-09 09:46 kvirt/web/static/css/bootstrap-theme.min.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-May-09 09:46 kvirt/web/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-May-09 09:46 kvirt/web/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-May-09 09:46 kvirt/web/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      816 b- defN 23-May-09 09:46 kvirt/web/static/css/kcli.css
+-rw-r--r--  2.0 unx     3033 b- defN 23-May-09 09:46 kvirt/web/static/css/navbar.css
+-rw-r--r--  2.0 unx     2908 b- defN 23-May-09 09:46 kvirt/web/static/css/spice.css
+-rw-r--r--  2.0 unx      271 b- defN 23-May-09 09:46 kvirt/web/static/css/wheel.css
+-rw-r--r--  2.0 unx    18028 b- defN 23-May-09 09:46 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
+-rw-r--r--  2.0 unx      715 b- defN 23-May-09 09:46 kvirt/web/static/images/Centos.png
+-rw-r--r--  2.0 unx      294 b- defN 23-May-09 09:46 kvirt/web/static/images/Debian.png
+-rw-r--r--  2.0 unx      987 b- defN 23-May-09 09:46 kvirt/web/static/images/Fedora.png
+-rw-r--r--  2.0 unx      672 b- defN 23-May-09 09:46 kvirt/web/static/images/Redhat.png
+-rw-r--r--  2.0 unx     1278 b- defN 23-May-09 09:46 kvirt/web/static/images/Suse.png
+-rw-r--r--  2.0 unx     1782 b- defN 23-May-09 09:46 kvirt/web/static/images/Tux.png
+-rw-r--r--  2.0 unx      544 b- defN 23-May-09 09:46 kvirt/web/static/images/Ubuntu.png
+-rw-r--r--  2.0 unx     4213 b- defN 23-May-09 09:46 kvirt/web/static/images/delete.png
+-rw-r--r--  2.0 unx     1406 b- defN 23-May-09 09:46 kvirt/web/static/images/favicon.ico
+-rw-r--r--  2.0 unx    23320 b- defN 23-May-09 09:46 kvirt/web/static/images/kcli-small.png
+-rw-r--r--  2.0 unx    27185 b- defN 23-May-09 09:46 kvirt/web/static/images/kcli.jpg
+-rw-r--r--  2.0 unx   113928 b- defN 23-May-09 09:46 kvirt/web/static/images/kcli.png
+-rw-r--r--  2.0 unx    48809 b- defN 23-May-09 09:46 kvirt/web/static/images/logo-header.svg
+-rw-r--r--  2.0 unx    48809 b- defN 23-May-09 09:46 kvirt/web/static/images/logo-main.svg
+-rw-r--r--  2.0 unx      160 b- defN 23-May-09 09:46 kvirt/web/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-May-09 09:46 kvirt/web/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-May-09 09:46 kvirt/web/static/images/sort_desc.png
+-rw-r--r--  2.0 unx     3927 b- defN 23-May-09 09:46 kvirt/web/static/images/start.png
+-rw-r--r--  2.0 unx     3631 b- defN 23-May-09 09:46 kvirt/web/static/images/stop.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-May-09 09:46 kvirt/web/static/images/wheel.gif
+-rw-r--r--  2.0 unx     2933 b- defN 23-May-09 09:46 kvirt/web/static/js/bootstrap-notify.js
+-rw-r--r--  2.0 unx    37045 b- defN 23-May-09 09:46 kvirt/web/static/js/bootstrap.min.js
+-rw-r--r--  2.0 unx     2523 b- defN 23-May-09 09:46 kvirt/web/static/js/containeraction.js
+-rw-r--r--  2.0 unx    12398 b- defN 23-May-09 09:46 kvirt/web/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx     1642 b- defN 23-May-09 09:46 kvirt/web/static/js/hostaction.js
+-rw-r--r--  2.0 unx     1187 b- defN 23-May-09 09:46 kvirt/web/static/js/imageaction.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-May-09 09:46 kvirt/web/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    89795 b- defN 23-May-09 09:46 kvirt/web/static/js/jquery.min.js
+-rw-r--r--  2.0 unx     2704 b- defN 23-May-09 09:46 kvirt/web/static/js/kcli.js
+-rw-r--r--  2.0 unx     1594 b- defN 23-May-09 09:46 kvirt/web/static/js/kubeaction.js
+-rw-r--r--  2.0 unx     3907 b- defN 23-May-09 09:46 kvirt/web/static/js/list.js
+-rw-r--r--  2.0 unx     1376 b- defN 23-May-09 09:46 kvirt/web/static/js/networkaction.js
+-rw-r--r--  2.0 unx     2457 b- defN 23-May-09 09:46 kvirt/web/static/js/planaction.js
+-rw-r--r--  2.0 unx     1237 b- defN 23-May-09 09:46 kvirt/web/static/js/poolaction.js
+-rw-r--r--  2.0 unx      846 b- defN 23-May-09 09:46 kvirt/web/static/js/productaction.js
+-rw-r--r--  2.0 unx      270 b- defN 23-May-09 09:46 kvirt/web/static/js/refresh.js
+-rw-r--r--  2.0 unx     1835 b- defN 23-May-09 09:46 kvirt/web/static/js/repoaction.js
+-rw-r--r--  2.0 unx     3463 b- defN 23-May-09 09:46 kvirt/web/static/js/snapshotaction.js
+-rw-r--r--  2.0 unx     2745 b- defN 23-May-09 09:46 kvirt/web/static/js/vmaction.js
+-rw-r--r--  2.0 unx      123 b- defN 23-May-09 09:46 kvirt/web/static/js/wheel.js
+-rw-r--r--  2.0 unx     9944 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/atKeynames.js
+-rw-r--r--  2.0 unx     2335 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/bitmap.js
+-rw-r--r--  2.0 unx     4795 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/cursor.js
+-rw-r--r--  2.0 unx    49214 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/display.js
+-rw-r--r--  2.0 unx    13253 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/enums.js
+-rw-r--r--  2.0 unx     2847 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/filexfer.js
+-rw-r--r--  2.0 unx     9535 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/inputs.js
+-rw-r--r--  2.0 unx     6176 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/lz.js
+-rw-r--r--  2.0 unx    18370 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/main.js
+-rw-r--r--  2.0 unx    12677 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/playback.js
+-rw-r--r--  2.0 unx     7036 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/png.js
+-rw-r--r--  2.0 unx     3110 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/port.js
+-rw-r--r--  2.0 unx    44531 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/quic.js
+-rw-r--r--  2.0 unx     3030 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/resize.js
+-rw-r--r--  2.0 unx     7282 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/simulatecursor.js
+-rw-r--r--  2.0 unx     1895 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/spicearraybuffer.js
+-rw-r--r--  2.0 unx    18202 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/spiceconn.js
+-rw-r--r--  2.0 unx     3616 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/spicedataview.js
+-rw-r--r--  2.0 unx    33015 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/spicemsg.js
+-rw-r--r--  2.0 unx    12767 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/spicetype.js
+-rw-r--r--  2.0 unx     6808 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/ticket.js
+-rw-r--r--  2.0 unx    13628 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/utils.js
+-rw-r--r--  2.0 unx    21577 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/webm.js
+-rw-r--r--  2.0 unx     4131 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/wire.js
+-rw-r--r--  2.0 unx    16580 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/jsbn.js
+-rw-r--r--  2.0 unx     2529 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/prng4.js
+-rw-r--r--  2.0 unx     3442 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/rng.js
+-rw-r--r--  2.0 unx     4257 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/rsa.js
+-rw-r--r--  2.0 unx    10671 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/sha1.js
+-rw-r--r--  2.0 unx        0 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
+-rw-r--r--  2.0 unx      419 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      359 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8601 b- defN 23-May-09 09:46 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     2176 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/error-handler.js
+-rw-r--r--  2.0 unx     5682 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/localization.js
+-rw-r--r--  2.0 unx    56845 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/ui.js
+-rw-r--r--  2.0 unx     6696 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/webutil.js
+-rw-r--r--  2.0 unx     3553 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/alt.svg
+-rw-r--r--  2.0 unx     3980 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/clipboard.svg
+-rw-r--r--  2.0 unx     3430 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/connect.svg
+-rw-r--r--  2.0 unx     4381 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/ctrl.svg
+-rw-r--r--  2.0 unx     3237 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
+-rw-r--r--  2.0 unx     5062 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/disconnect.svg
+-rw-r--r--  2.0 unx     4684 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/drag.svg
+-rw-r--r--  2.0 unx     3106 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/error.svg
+-rw-r--r--  2.0 unx     4522 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/esc.svg
+-rw-r--r--  2.0 unx     3066 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/expander.svg
+-rw-r--r--  2.0 unx     3139 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/fullscreen.svg
+-rw-r--r--  2.0 unx     2559 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/handle.svg
+-rw-r--r--  2.0 unx     6386 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/handle_bg.svg
+-rw-r--r--  2.0 unx     3204 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/info.svg
+-rw-r--r--  2.0 unx     6404 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/keyboard.svg
+-rw-r--r--  2.0 unx     7000 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/mouse_left.svg
+-rw-r--r--  2.0 unx     7002 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/mouse_middle.svg
+-rw-r--r--  2.0 unx     6993 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/mouse_none.svg
+-rw-r--r--  2.0 unx     7001 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/mouse_right.svg
+-rw-r--r--  2.0 unx     3985 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/power.svg
+-rw-r--r--  2.0 unx     3082 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/settings.svg
+-rw-r--r--  2.0 unx     2953 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/tab.svg
+-rw-r--r--  2.0 unx     4441 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
+-rw-r--r--  2.0 unx     3869 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/warning.svg
+-rw-r--r--  2.0 unx     3178 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/windows.svg
+-rw-r--r--  2.0 unx      871 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/Makefile
+-rw-r--r--  2.0 unx     4028 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
+-rw-r--r--  2.0 unx     4582 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
+-rw-r--r--  2.0 unx     5216 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
+-rw-r--r--  2.0 unx      675 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
+-rw-r--r--  2.0 unx     5787 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
+-rw-r--r--  2.0 unx     1000 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
+-rw-r--r--  2.0 unx     1064 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
+-rw-r--r--  2.0 unx     1397 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
+-rw-r--r--  2.0 unx     1932 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
+-rw-r--r--  2.0 unx     1946 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
+-rw-r--r--  2.0 unx     2699 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
+-rw-r--r--  2.0 unx     2874 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
+-rw-r--r--  2.0 unx     2351 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
+-rw-r--r--  2.0 unx    11685 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
+-rw-r--r--  2.0 unx    11549 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
+-rw-r--r--  2.0 unx     2885 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/cs.json
+-rw-r--r--  2.0 unx     2854 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/de.json
+-rw-r--r--  2.0 unx     3906 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/el.json
+-rw-r--r--  2.0 unx     2671 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/es.json
+-rw-r--r--  2.0 unx     3354 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/ja.json
+-rw-r--r--  2.0 unx     2961 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/ko.json
+-rw-r--r--  2.0 unx     3035 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/nl.json
+-rw-r--r--  2.0 unx     2830 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/pl.json
+-rw-r--r--  2.0 unx     3825 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/ru.json
+-rw-r--r--  2.0 unx     2845 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/sv.json
+-rw-r--r--  2.0 unx     2811 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/tr.json
+-rw-r--r--  2.0 unx     2597 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/zh_CN.json
+-rw-r--r--  2.0 unx     2606 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/locale/zh_TW.json
+-rw-r--r--  2.0 unx      157 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/sounds/CREDITS
+-rw-r--r--  2.0 unx     4531 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/sounds/bell.mp3
+-rw-r--r--  2.0 unx     8495 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/sounds/bell.oga
+-rw-r--r--  2.0 unx    38580 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
+-rw-r--r--  2.0 unx    17472 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/styles/Orbitron700.woff
+-rw-r--r--  2.0 unx    18450 b- defN 23-May-09 09:46 kvirt/web/static/vnc/app/styles/base.css
+-rw-r--r--  2.0 unx     4189 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/base64.js
+-rw-r--r--  2.0 unx    11241 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/des.js
+-rw-r--r--  2.0 unx    20381 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/display.js
+-rw-r--r--  2.0 unx     1374 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/encodings.js
+-rw-r--r--  2.0 unx     1170 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/inflator.js
+-rw-r--r--  2.0 unx    74196 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/rfb.js
+-rw-r--r--  2.0 unx     9130 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/websock.js
+-rw-r--r--  2.0 unx      628 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/decoders/copyrect.js
+-rw-r--r--  2.0 unx     4814 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/decoders/hextile.js
+-rw-r--r--  2.0 unx     1739 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/decoders/raw.js
+-rw-r--r--  2.0 unx     1210 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/decoders/rre.js
+-rw-r--r--  2.0 unx     9662 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/decoders/tight.js
+-rw-r--r--  2.0 unx      768 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/decoders/tightpng.js
+-rw-r--r--  2.0 unx    11438 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/domkeytable.js
+-rw-r--r--  2.0 unx     3804 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/fixedkeys.js
+-rw-r--r--  2.0 unx    13090 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/keyboard.js
+-rw-r--r--  2.0 unx    34609 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/keysym.js
+-rw-r--r--  2.0 unx    25374 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/keysymdef.js
+-rw-r--r--  2.0 unx     9995 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/mouse.js
+-rw-r--r--  2.0 unx     5283 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/util.js
+-rw-r--r--  2.0 unx     2580 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/vkeys.js
+-rw-r--r--  2.0 unx    14256 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/input/xtscancodes.js
+-rw-r--r--  2.0 unx     3155 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/browser.js
+-rw-r--r--  2.0 unx     7556 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/cursor.js
+-rw-r--r--  2.0 unx     4221 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/events.js
+-rw-r--r--  2.0 unx      896 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/eventtarget.js
+-rw-r--r--  2.0 unx     1358 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/logging.js
+-rw-r--r--  2.0 unx     1866 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/polyfill.js
+-rw-r--r--  2.0 unx      301 b- defN 23-May-09 09:46 kvirt/web/static/vnc/core/util/strings.js
+-rw-r--r--  2.0 unx     7388 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/promise.js
+-rw-r--r--  2.0 unx      419 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      295 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8498 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     1084 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/LICENSE
+-rw-r--r--  2.0 unx      301 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/README.md
+-rw-r--r--  2.0 unx     1062 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
+-rw-r--r--  2.0 unx      666 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
+-rw-r--r--  2.0 unx     1334 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
+-rw-r--r--  2.0 unx      764 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
+-rw-r--r--  2.0 unx    60016 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
+-rw-r--r--  2.0 unx     1251 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
+-rw-r--r--  2.0 unx    11690 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
+-rw-r--r--  2.0 unx    47128 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
+-rw-r--r--  2.0 unx    11527 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
+-rw-r--r--  2.0 unx      560 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
+-rw-r--r--  2.0 unx    38767 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
+-rw-r--r--  2.0 unx      823 b- defN 23-May-09 09:46 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
+-rw-r--r--  2.0 unx     2509 b- defN 23-May-09 09:46 kvirt/web/templates/bootstrap.html
+-rw-r--r--  2.0 unx    14595 b- defN 23-May-09 09:46 kvirt/web/templates/console.html
+-rw-r--r--  2.0 unx      717 b- defN 23-May-09 09:46 kvirt/web/templates/containercreate.html
+-rw-r--r--  2.0 unx      493 b- defN 23-May-09 09:46 kvirt/web/templates/containerprofiles.html
+-rw-r--r--  2.0 unx     1050 b- defN 23-May-09 09:46 kvirt/web/templates/containerprofilestable.html
+-rw-r--r--  2.0 unx      490 b- defN 23-May-09 09:46 kvirt/web/templates/containers.html
+-rw-r--r--  2.0 unx     1746 b- defN 23-May-09 09:46 kvirt/web/templates/containerstable.html
+-rw-r--r--  2.0 unx     2123 b- defN 23-May-09 09:46 kvirt/web/templates/head.html
+-rw-r--r--  2.0 unx      473 b- defN 23-May-09 09:46 kvirt/web/templates/hosts.html
+-rw-r--r--  2.0 unx     1705 b- defN 23-May-09 09:46 kvirt/web/templates/hoststable.html
+-rw-r--r--  2.0 unx     1119 b- defN 23-May-09 09:46 kvirt/web/templates/imagecreate.html
+-rw-r--r--  2.0 unx      478 b- defN 23-May-09 09:46 kvirt/web/templates/images.html
+-rw-r--r--  2.0 unx      646 b- defN 23-May-09 09:46 kvirt/web/templates/imagestable.html
+-rw-r--r--  2.0 unx      472 b- defN 23-May-09 09:46 kvirt/web/templates/isos.html
+-rw-r--r--  2.0 unx      261 b- defN 23-May-09 09:46 kvirt/web/templates/isostable.html
+-rw-r--r--  2.0 unx      609 b- defN 23-May-09 09:46 kvirt/web/templates/kubecreate.html
+-rw-r--r--  2.0 unx      622 b- defN 23-May-09 09:46 kvirt/web/templates/kubeinfo.html
+-rw-r--r--  2.0 unx      488 b- defN 23-May-09 09:46 kvirt/web/templates/kubeprofiles.html
+-rw-r--r--  2.0 unx      845 b- defN 23-May-09 09:46 kvirt/web/templates/kubeprofilestable.html
+-rw-r--r--  2.0 unx      475 b- defN 23-May-09 09:46 kvirt/web/templates/kubes.html
+-rw-r--r--  2.0 unx     1850 b- defN 23-May-09 09:46 kvirt/web/templates/kubestable.html
+-rw-r--r--  2.0 unx      151 b- defN 23-May-09 09:46 kvirt/web/templates/layout.html
+-rw-r--r--  2.0 unx     5517 b- defN 23-May-09 09:46 kvirt/web/templates/navbar.html
+-rw-r--r--  2.0 unx      882 b- defN 23-May-09 09:46 kvirt/web/templates/networkcreate.html
+-rw-r--r--  2.0 unx      537 b- defN 23-May-09 09:46 kvirt/web/templates/networks.html
+-rw-r--r--  2.0 unx      845 b- defN 23-May-09 09:46 kvirt/web/templates/networkstable.html
+-rw-r--r--  2.0 unx      750 b- defN 23-May-09 09:46 kvirt/web/templates/plancreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-May-09 09:46 kvirt/web/templates/plans.html
+-rw-r--r--  2.0 unx     1525 b- defN 23-May-09 09:46 kvirt/web/templates/planstable.html
+-rw-r--r--  2.0 unx      859 b- defN 23-May-09 09:46 kvirt/web/templates/poolcreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-May-09 09:46 kvirt/web/templates/pools.html
+-rw-r--r--  2.0 unx      554 b- defN 23-May-09 09:46 kvirt/web/templates/poolstable.html
+-rw-r--r--  2.0 unx     1282 b- defN 23-May-09 09:46 kvirt/web/templates/productcreate.html
+-rw-r--r--  2.0 unx      484 b- defN 23-May-09 09:46 kvirt/web/templates/products.html
+-rw-r--r--  2.0 unx      895 b- defN 23-May-09 09:46 kvirt/web/templates/productstable.html
+-rw-r--r--  2.0 unx      699 b- defN 23-May-09 09:46 kvirt/web/templates/repocreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-May-09 09:46 kvirt/web/templates/repos.html
+-rw-r--r--  2.0 unx     1203 b- defN 23-May-09 09:46 kvirt/web/templates/repostable.html
+-rw-r--r--  2.0 unx      958 b- defN 23-May-09 09:46 kvirt/web/templates/vmcreate.html
+-rw-r--r--  2.0 unx      486 b- defN 23-May-09 09:46 kvirt/web/templates/vmprofiles.html
+-rw-r--r--  2.0 unx     1420 b- defN 23-May-09 09:46 kvirt/web/templates/vmprofilestable.html
+-rw-r--r--  2.0 unx      470 b- defN 23-May-09 09:46 kvirt/web/templates/vms.html
+-rw-r--r--  2.0 unx     4894 b- defN 23-May-09 09:46 kvirt/web/templates/vmstable.html
+-rw-r--r--  2.0 unx    11358 b- defN 23-May-09 09:50 kcli-99.0.202305090950.dist-info/LICENSE
+-rw-r--r--  2.0 unx     2914 b- defN 23-May-09 09:50 kcli-99.0.202305090950.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-09 09:50 kcli-99.0.202305090950.dist-info/WHEEL
+-rw-r--r--  2.0 unx      209 b- defN 23-May-09 09:50 kcli-99.0.202305090950.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-May-09 09:50 kcli-99.0.202305090950.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    58378 b- defN 23-May-09 09:50 kcli-99.0.202305090950.dist-info/RECORD
+595 files, 4547750 bytes uncompressed, 1378483 bytes compressed:  69.7%
```

## zipnote {}

```diff
@@ -150,26 +150,14 @@
 
 Filename: kvirt/cluster/k3s/workers.sh
 Comment: 
 
 Filename: kvirt/cluster/k3s/workers.yml
 Comment: 
 
-Filename: kvirt/cluster/kind/__init__.py
-Comment: 
-
-Filename: kvirt/cluster/kind/config.yaml
-Comment: 
-
-Filename: kvirt/cluster/kind/kcli_plan.yml
-Comment: 
-
-Filename: kvirt/cluster/kind/kcli_plan_default.yml
-Comment: 
-
 Filename: kvirt/cluster/kubeadm/__init__.py
 Comment: 
 
 Filename: kvirt/cluster/kubeadm/bootstrap.sh
 Comment: 
 
 Filename: kvirt/cluster/kubeadm/bootstrap.yml
@@ -1773,26 +1761,26 @@
 
 Filename: kvirt/web/templates/vms.html
 Comment: 
 
 Filename: kvirt/web/templates/vmstable.html
 Comment: 
 
-Filename: kcli-99.0.202305080926.dist-info/LICENSE
+Filename: kcli-99.0.202305090950.dist-info/LICENSE
 Comment: 
 
-Filename: kcli-99.0.202305080926.dist-info/METADATA
+Filename: kcli-99.0.202305090950.dist-info/METADATA
 Comment: 
 
-Filename: kcli-99.0.202305080926.dist-info/WHEEL
+Filename: kcli-99.0.202305090950.dist-info/WHEEL
 Comment: 
 
-Filename: kcli-99.0.202305080926.dist-info/entry_points.txt
+Filename: kcli-99.0.202305090950.dist-info/entry_points.txt
 Comment: 
 
-Filename: kcli-99.0.202305080926.dist-info/top_level.txt
+Filename: kcli-99.0.202305090950.dist-info/top_level.txt
 Comment: 
 
-Filename: kcli-99.0.202305080926.dist-info/RECORD
+Filename: kcli-99.0.202305090950.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kvirt/baseconfig.py

```diff
@@ -21,15 +21,14 @@
                             WAIT, WAITCOMMAND, WAITTIMEOUT, TEMPKEY, BMC_USER, BMC_PASSWORD, BMC_MODEL, KSUSHYSERVICE,
                             WEBSERVICE)
 from ipaddress import ip_address, ip_network
 from random import choice
 from kvirt import common
 from kvirt.common import error, pprint, warning, container_mode, ssh, scp, NoAliasDumper
 from kvirt.jinjafilters import jinjafilters
-from kvirt.cluster import kind
 from kvirt.cluster import microshift
 from kvirt.cluster import k3s
 from kvirt.cluster import kubeadm
 from kvirt.cluster import hypershift
 from kvirt.cluster import openshift
 import os
 from shutil import copytree, rmtree, which, copy2
@@ -1314,19 +1313,14 @@
         return workflowfile
 
     def info_kube_generic(self, quiet, web=False):
         plandir = os.path.dirname(kubeadm.create.__code__.co_filename)
         inputfile = f'{plandir}/ctlplanes.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
 
-    def info_kube_kind(self, quiet, web=False):
-        plandir = os.path.dirname(kind.create.__code__.co_filename)
-        inputfile = f'{plandir}/kcli_plan.yml'
-        return self.info_plan(inputfile, quiet=quiet, web=web)
-
     def info_kube_microshift(self, quiet, web=False):
         plandir = os.path.dirname(microshift.create.__code__.co_filename)
         inputfile = f'{plandir}/kcli_plan.yml'
         return self.info_plan(inputfile, quiet=quiet, web=web)
 
     def info_kube_k3s(self, quiet, web=False):
         plandir = os.path.dirname(k3s.create.__code__.co_filename)
```

## kvirt/cli.py

```diff
@@ -4,15 +4,15 @@
 
 from copy import deepcopy
 from filecmp import cmp
 from getpass import getuser
 from kvirt.config import Kconfig
 from kvirt.examples import plandatacreate, vmdatacreate, hostcreate, _list, plancreate, planinfo, productinfo, start
 from kvirt.examples import repocreate, isocreate, networkupdate
-from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubekindcreate, kubemicroshiftcreate
+from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubemicroshiftcreate
 from kvirt.examples import dnscreate, diskcreate, diskdelete, vmcreate, vmconsole, vmexport, niccreate, nicdelete
 from kvirt.examples import disconnectedcreate, appopenshiftcreate, plantemplatecreate, kubehypershiftcreate
 from kvirt.examples import workflowcreate, kubegenericscale, kubek3sscale, kubeopenshiftscale
 from kvirt.examples import changelog, starthosts, stophosts, infohosts, ocdownload, openshiftdownload
 from kvirt.examples import networkcreate, securitygroupcreate, profilecreate, vmupdate, vmlist
 from kvirt.baseconfig import Kbaseconfig
 from kvirt.containerconfig import Kcontainerconfig
@@ -1857,14 +1857,15 @@
         error(f"parameters that contain master word need to be replaced with ctlplane. Found {master_parameters}")
         sys.exit(1)
     client = overrides.get('client', args.client)
     offline = kubetype == 'openshift' and 'sno' in overrides and (client == 'fake' or common.need_fake())
     config = Kconfig(client=client, debug=args.debug, region=args.region, zone=args.zone, namespace=args.namespace,
                      offline=offline)
     if overrides.get('force', args.force):
+        overrides['kubetype'] = kubetype
         config.delete_kube(cluster, overrides=overrides)
     confpool = overrides.get('namepool') or overrides.get('confpool')
     if cluster is None and confpool is not None:
         cluster = config.get_name_from_confpool(confpool)
     clusterprofile = overrides.get('clusterprofile')
     if clusterprofile is not None:
         if clusterprofile not in config.clusterprofiles:
@@ -1885,20 +1886,14 @@
 
 def create_generic_kube(args):
     """Create Generic kube"""
     args.type = 'generic'
     create_kube(args)
 
 
-def create_kind_kube(args):
-    """Create Kind kube"""
-    args.type = 'kind'
-    create_kube(args)
-
-
 def create_microshift_kube(args):
     """Create Microshift kube"""
     args.type = 'microshift'
     create_kube(args)
 
 
 def create_k3s_kube(args):
@@ -1987,19 +1982,14 @@
 
 
 def update_openshift_kube(args):
     args.type = 'openshift'
     update_kube(args)
 
 
-def update_kind_kube(args):
-    args.type = 'kind'
-    update_kube(args)
-
-
 def update_microshift_kube(args):
     args.type = 'microshift'
     update_kube(args)
 
 
 def update_k3s_kube(args):
     args.type = 'k3s'
@@ -2340,16 +2330,14 @@
             baseconfig.info_kube_openshift(quiet=True)
         elif kubetype == 'hypershift':
             baseconfig.info_kube_hypershift(quiet=True)
         elif kubetype == 'microshift':
             baseconfig.info_kube_microshift(quiet=True)
         elif kubetype == 'k3s':
             baseconfig.info_kube_k3s(quiet=True)
-        elif kubetype == 'kind':
-            baseconfig.info_kube_kind(quiet=True)
         else:
             baseconfig.info_kube_generic(quiet=True)
 
 
 def info_web_kube(args):
     output = args.global_output or args.output
     config = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone, namespace=args.namespace)
@@ -2369,19 +2357,14 @@
 
 
 def info_generic_kube(args):
     args.kubetype = 'generic'
     info_kube(args)
 
 
-def info_kind_kube(args):
-    args.kubetype = 'kind'
-    info_kube(args)
-
-
 def info_microshift_kube(args):
     args.kubetype = 'microshift'
     info_kube(args)
 
 
 def info_k3s_kube(args):
     args.kubetype = 'k3s'
@@ -3706,26 +3689,14 @@
     kubegenericcreate_parser.set_defaults(func=create_generic_kube)
     kubecreate_subparsers.add_parser('generic', parents=[kubegenericcreate_parser],
                                      description=kubegenericcreate_desc,
                                      help=kubegenericcreate_desc,
                                      epilog=kubegenericcreate_epilog,
                                      formatter_class=rawhelp, aliases=['kubeadm'])
 
-    kubekindcreate_desc = 'Create Kind Kube'
-    kubekindcreate_epilog = f"examples:\n{kubekindcreate}"
-    kubekindcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
-    kubekindcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
-    kubekindcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
-    kubekindcreate_parser.set_defaults(func=create_kind_kube)
-    kubecreate_subparsers.add_parser('kind', parents=[kubekindcreate_parser],
-                                     description=kubekindcreate_desc,
-                                     help=kubekindcreate_desc,
-                                     epilog=kubekindcreate_epilog,
-                                     formatter_class=rawhelp)
-
     kubemicroshiftcreate_desc = 'Create Microshift Kube'
     kubemicroshiftcreate_epilog = f"examples:\n{kubemicroshiftcreate}"
     kubemicroshiftcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubemicroshiftcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
     kubemicroshiftcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubemicroshiftcreate_parser.set_defaults(func=create_microshift_kube)
     kubecreate_subparsers.add_parser('microshift', parents=[kubemicroshiftcreate_parser],
@@ -4505,20 +4476,14 @@
     kubegenericinfo_desc = 'Info Generic Kube'
     kubegenericinfo_parser = kubeinfo_subparsers.add_parser('generic', description=kubegenericinfo_desc,
                                                             help=kubegenericinfo_desc, aliases=['kubeadm'],
                                                             parents=[output_parser])
     kubegenericinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubegenericinfo_parser.set_defaults(func=info_generic_kube)
 
-    kubekindinfo_desc = 'Info Kind Kube'
-    kubekindinfo_parser = kubeinfo_subparsers.add_parser('kind', description=kubekindinfo_desc, help=kubekindinfo_desc,
-                                                         parents=[output_parser])
-    kubekindinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
-    kubekindinfo_parser.set_defaults(func=info_kind_kube)
-
     kubemicroshiftinfo_desc = 'Info Microshift Kube'
     kubemicroshiftinfo_parser = kubeinfo_subparsers.add_parser('microshift', description=kubemicroshiftinfo_desc,
                                                                help=kubemicroshiftinfo_desc,
                                                                parents=[output_parser])
     kubemicroshiftinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubemicroshiftinfo_parser.set_defaults(func=info_microshift_kube)
```

## kvirt/config.py

```diff
@@ -43,11726 +43,11708 @@
 000002a0: 2069 6d70 6f72 7420 7373 682c 2073 6370   import ssh, scp
 000002b0: 2c20 5f73 7368 5f63 7265 6465 6e74 6961  , _ssh_credentia
 000002c0: 6c73 2c20 7661 6c69 645f 6970 2c20 7072  ls, valid_ip, pr
 000002d0: 6f63 6573 735f 6669 6c65 732c 2067 6574  ocess_files, get
 000002e0: 5f72 6863 6f73 5f75 726c 5f66 726f 6d5f  _rhcos_url_from_
 000002f0: 6669 6c65 2c20 6765 745f 6672 6565 5f70  file, get_free_p
 00000300: 6f72 740a 6672 6f6d 206b 7669 7274 2e63  ort.from kvirt.c
-00000310: 6c75 7374 6572 2069 6d70 6f72 7420 6b69  luster import ki
-00000320: 6e64 0a66 726f 6d20 6b76 6972 742e 636c  nd.from kvirt.cl
-00000330: 7573 7465 7220 696d 706f 7274 206d 6963  uster import mic
-00000340: 726f 7368 6966 740a 6672 6f6d 206b 7669  roshift.from kvi
-00000350: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
-00000360: 7420 6b33 730a 6672 6f6d 206b 7669 7274  t k3s.from kvirt
-00000370: 2e63 6c75 7374 6572 2069 6d70 6f72 7420  .cluster import 
-00000380: 6b75 6265 6164 6d0a 6672 6f6d 206b 7669  kubeadm.from kvi
-00000390: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
-000003a0: 7420 6879 7065 7273 6869 6674 0a66 726f  t hypershift.fro
-000003b0: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
-000003c0: 696d 706f 7274 206f 7065 6e73 6869 6674  import openshift
-000003d0: 0a66 726f 6d20 6b76 6972 742e 6578 706f  .from kvirt.expo
-000003e0: 7365 2069 6d70 6f72 7420 4b65 7870 6f73  se import Kexpos
-000003f0: 6572 0a66 726f 6d20 6b76 6972 742e 696e  er.from kvirt.in
-00000400: 7465 726e 616c 706c 616e 7320 696d 706f  ternalplans impo
-00000410: 7274 2068 6170 726f 7879 2061 7320 6861  rt haproxy as ha
-00000420: 7072 6f78 7970 6c61 6e0a 6672 6f6d 206b  proxyplan.from k
-00000430: 7669 7274 2e62 6173 6563 6f6e 6669 6720  virt.baseconfig 
-00000440: 696d 706f 7274 204b 6261 7365 636f 6e66  import Kbaseconf
-00000450: 6967 0a66 726f 6d20 6b76 6972 742e 636f  ig.from kvirt.co
-00000460: 6e74 6169 6e65 7263 6f6e 6669 6720 696d  ntainerconfig im
-00000470: 706f 7274 204b 636f 6e74 6169 6e65 7263  port Kcontainerc
-00000480: 6f6e 6669 670a 6672 6f6d 206b 7669 7274  onfig.from kvirt
-00000490: 2e6d 696e 6963 6f6e 736f 6c65 2069 6d70  .miniconsole imp
-000004a0: 6f72 7420 4b6d 696e 6963 6f6e 736f 6c65  ort Kminiconsole
-000004b0: 0a66 726f 6d20 6765 7470 6173 7320 696d  .from getpass im
-000004c0: 706f 7274 2067 6574 7573 6572 0a69 6d70  port getuser.imp
-000004d0: 6f72 7420 676c 6f62 0a69 6d70 6f72 7420  ort glob.import 
-000004e0: 6f73 0a69 6d70 6f72 7420 7265 0a69 6d70  os.import re.imp
-000004f0: 6f72 7420 736f 636b 6574 0a66 726f 6d20  ort socket.from 
-00000500: 7368 7574 696c 2069 6d70 6f72 7420 726d  shutil import rm
-00000510: 7472 6565 2c20 7768 6963 680a 696d 706f  tree, which.impo
-00000520: 7274 2073 7973 0a66 726f 6d20 7375 6270  rt sys.from subp
-00000530: 726f 6365 7373 2069 6d70 6f72 7420 6361  rocess import ca
-00000540: 6c6c 2c20 7275 6e2c 2050 4950 452c 2053  ll, run, PIPE, S
-00000550: 5444 4f55 540a 6672 6f6d 2074 656d 7066  TDOUT.from tempf
-00000560: 696c 6520 696d 706f 7274 2054 656d 706f  ile import Tempo
-00000570: 7261 7279 4469 7265 6374 6f72 790a 696d  raryDirectory.im
-00000580: 706f 7274 2074 6872 6561 6469 6e67 0a66  port threading.f
-00000590: 726f 6d20 7469 6d65 2069 6d70 6f72 7420  rom time import 
-000005a0: 736c 6565 700a 696d 706f 7274 2077 6562  sleep.import web
-000005b0: 6272 6f77 7365 720a 696d 706f 7274 2079  browser.import y
-000005c0: 616d 6c0a 0a7a 6572 6f74 6965 725f 7365  aml..zerotier_se
-000005d0: 7276 6963 6520 3d20 2222 225b 556e 6974  rvice = """[Unit
-000005e0: 5d0a 4465 7363 7269 7074 696f 6e3d 5a65  ].Description=Ze
-000005f0: 726f 2054 6965 7220 7365 7276 6963 650a  ro Tier service.
-00000600: 4166 7465 723d 6e65 7477 6f72 6b2d 6f6e  After=network-on
-00000610: 6c69 6e65 2e74 6172 6765 740a 5761 6e74  line.target.Want
-00000620: 733d 6e65 7477 6f72 6b2d 6f6e 6c69 6e65  s=network-online
-00000630: 2e74 6172 6765 740a 4265 666f 7265 3d6b  .target.Before=k
-00000640: 7562 656c 6574 2e73 6572 7669 6365 0a5b  ubelet.service.[
-00000650: 5365 7276 6963 655d 0a54 7970 653d 666f  Service].Type=fo
-00000660: 726b 696e 670a 4b69 6c6c 4d6f 6465 3d6e  rking.KillMode=n
-00000670: 6f6e 650a 5265 7374 6172 743d 6f6e 2d66  one.Restart=on-f
-00000680: 6169 6c75 7265 0a52 656d 6169 6e41 6674  ailure.RemainAft
-00000690: 6572 4578 6974 3d79 6573 0a45 7865 6353  erExit=yes.ExecS
-000006a0: 7461 7274 5072 653d 6d6f 6470 726f 6265  tartPre=modprobe
-000006b0: 2074 756e 0a45 7865 6353 7461 7274 5072   tun.ExecStartPr
-000006c0: 653d 706f 646d 616e 2070 756c 6c20 7175  e=podman pull qu
-000006d0: 6179 2e69 6f2f 6b61 726d 6162 2f7a 6572  ay.io/karmab/zer
-000006e0: 6f74 6965 722d 636c 690a 4578 6563 5374  otier-cli.ExecSt
-000006f0: 6172 7450 7265 3d70 6f64 6d61 6e20 6372  artPre=podman cr
-00000700: 6561 7465 202d 2d6e 616d 653d 7a65 726f  eate --name=zero
-00000710: 7469 6572 202d 6974 202d 2d63 6170 2d61  tier -it --cap-a
-00000720: 6464 3d4e 4554 5f41 444d 494e 202d 2d64  dd=NET_ADMIN --d
-00000730: 6576 6963 653d 2f64 6576 2f6e 6574 2f74  evice=/dev/net/t
-00000740: 756e 202d 2d63 6170 2d61 6464 3d53 5953  un --cap-add=SYS
-00000750: 5f41 444d 494e 205c 0a2d 2d6e 6574 3d68  _ADMIN \.--net=h
-00000760: 6f73 7420 2d2d 656e 7472 7970 6f69 6e74  ost --entrypoint
-00000770: 3d2f 6269 6e2f 7368 206b 6172 6d61 622f  =/bin/sh karmab/
-00000780: 7a65 726f 7469 6572 2d63 6c69 202d 6320  zerotier-cli -c 
-00000790: 227a 6572 6f74 6965 722d 6f6e 6520 2d64  "zerotier-one -d
-000007a0: 203b 2073 6c65 6570 2031 3020 3b20 5c0a   ; sleep 10 ; \.
-000007b0: 7b7a 6572 6f74 6965 725f 6a6f 696e 7d20  {zerotier_join} 
-000007c0: 3b20 5c0a 736c 6565 7020 696e 6669 6e69  ; \.sleep infini
-000007d0: 7479 220a 4578 6563 5374 6172 743d 706f  ty".ExecStart=po
-000007e0: 646d 616e 2073 7461 7274 207a 6572 6f74  dman start zerot
-000007f0: 6965 720a 4578 6563 5374 6f70 3d70 6f64  ier.ExecStop=pod
-00000800: 6d61 6e20 7374 6f70 202d 7420 3130 207a  man stop -t 10 z
-00000810: 6572 6f74 6965 720a 4578 6563 5374 6f70  erotier.ExecStop
-00000820: 506f 7374 3d70 6f64 6d61 6e20 726d 207a  Post=podman rm z
-00000830: 6572 6f74 6965 720a 7b7a 6572 6f74 6965  erotier.{zerotie
-00000840: 725f 6b75 6265 6c65 745f 7363 7269 7074  r_kubelet_script
-00000850: 7d0a 5b49 6e73 7461 6c6c 5d0a 5761 6e74  }.[Install].Want
-00000860: 6564 4279 3d6d 756c 7469 2d75 7365 722e  edBy=multi-user.
-00000870: 7461 7267 6574 2222 220a 0a0a 7a65 726f  target"""...zero
-00000880: 7469 6572 5f6b 7562 656c 6574 5f64 6174  tier_kubelet_dat
-00000890: 6120 3d20 2222 2245 7865 6353 7461 7274  a = """ExecStart
-000008a0: 506f 7374 3d2f 6269 6e2f 6261 7368 202d  Post=/bin/bash -
-000008b0: 6320 2773 6c65 6570 2032 3020 3b5c 0a49  c 'sleep 20 ;\.I
-000008c0: 503d 2428 6970 202d 3420 2d6f 2061 6464  P=$(ip -4 -o add
-000008d0: 7220 7368 6f77 207a 7470 7069 7169 7861  r show ztppiqixa
-000008e0: 7220 7c20 6375 7420 2d66 3720 2d64 2220  r | cut -f7 -d" 
-000008f0: 2220 7c20 6375 7420 2d64 2022 2f22 202d  " | cut -d "/" -
-00000900: 6620 3120 7c20 6865 6164 202d 3129 203b  f 1 | head -1) ;
-00000910: 5c0a 6966 205b 2022 2428 6772 6570 2024  \.if [ "$(grep $
-00000920: 4950 202f 6574 632f 7379 7374 656d 642f  IP /etc/systemd/
-00000930: 7379 7374 656d 2f6b 7562 656c 6574 2e73  system/kubelet.s
-00000940: 6572 7669 6365 2922 203d 3d20 2222 205d  ervice)" == "" ]
-00000950: 203b 2074 6865 6e20 5c0a 7365 6420 2d69   ; then \.sed -i
-00000960: 2022 2f6e 6f64 652d 6970 2f64 2220 2f65   "/node-ip/d" /e
-00000970: 7463 2f73 7973 7465 6d64 2f73 7973 7465  tc/systemd/syste
-00000980: 6d2f 6b75 6265 6c65 742e 7365 7276 6963  m/kubelet.servic
-00000990: 6520 3b5c 0a73 6564 202d 6920 222f 2e2a  e ;\.sed -i "/.*
-000009a0: 6e6f 6465 2d6c 6162 656c 732a 2f61 202d  node-labels*/a -
-000009b0: 2d6e 6f64 652d 6970 3d24 4950 202d 2d61  -node-ip=$IP --a
-000009c0: 6464 7265 7373 3d24 4950 205c 5c22 202f  ddress=$IP \\" /
-000009d0: 6574 632f 7379 7374 656d 642f 7379 7374  etc/systemd/syst
-000009e0: 656d 2f6b 7562 656c 6574 2e73 6572 7669  em/kubelet.servi
-000009f0: 6365 203b 5c0a 7379 7374 656d 6374 6c20  ce ;\.systemctl 
-00000a00: 6461 656d 6f6e 2d72 656c 6f61 6420 3b5c  daemon-reload ;\
-00000a10: 0a66 6927 2222 220a 0a63 6c6f 7564 706c  .fi'"""..cloudpl
-00000a20: 6174 666f 726d 7320 3d20 5b27 6177 7327  atforms = ['aws'
-00000a30: 2c20 2767 6370 272c 2027 7061 636b 6574  , 'gcp', 'packet
-00000a40: 272c 2027 6962 6d63 6c6f 7564 275d 0a0a  ', 'ibmcloud']..
-00000a50: 0a63 6c61 7373 204b 636f 6e66 6967 284b  .class Kconfig(K
-00000a60: 6261 7365 636f 6e66 6967 293a 0a20 2020  baseconfig):.   
-00000a70: 2022 2222 0a0a 2020 2020 2222 220a 2020   """..    """.  
-00000a80: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00000a90: 656c 662c 2063 6c69 656e 743d 4e6f 6e65  elf, client=None
-00000aa0: 2c20 6465 6275 673d 4661 6c73 652c 2071  , debug=False, q
-00000ab0: 7569 6574 3d46 616c 7365 2c20 7265 6769  uiet=False, regi
-00000ac0: 6f6e 3d4e 6f6e 652c 207a 6f6e 653d 4e6f  on=None, zone=No
-00000ad0: 6e65 2c20 6e61 6d65 7370 6163 653d 4e6f  ne, namespace=No
-00000ae0: 6e65 2c20 6f66 666c 696e 653d 4661 6c73  ne, offline=Fals
-00000af0: 6529 3a0a 2020 2020 2020 2020 4b62 6173  e):.        Kbas
-00000b00: 6563 6f6e 6669 672e 5f5f 696e 6974 5f5f  econfig.__init__
-00000b10: 2873 656c 662c 2063 6c69 656e 743d 636c  (self, client=cl
-00000b20: 6965 6e74 2c20 6465 6275 673d 6465 6275  ient, debug=debu
-00000b30: 672c 2071 7569 6574 3d71 7569 6574 2c20  g, quiet=quiet, 
-00000b40: 6f66 666c 696e 653d 6f66 666c 696e 6529  offline=offline)
-00000b50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00000b60: 7365 6c66 2e65 6e61 626c 6564 3a0a 2020  self.enabled:.  
-00000b70: 2020 2020 2020 2020 2020 6b20 3d20 4e6f            k = No
-00000b80: 6e65 0a20 2020 2020 2020 2065 6c73 653a  ne.        else:
-00000b90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00000ba0: 7365 6c66 2e74 7970 6520 3d3d 2027 6b75  self.type == 'ku
-00000bb0: 6265 7669 7274 273a 0a20 2020 2020 2020  bevirt':.       
-00000bc0: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
-00000bd0: 7370 6163 6520 6973 204e 6f6e 653a 0a20  space is None:. 
-00000be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000bf0: 2020 206e 616d 6573 7061 6365 203d 2073     namespace = s
-00000c00: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00000c10: 276e 616d 6573 7061 6365 2729 0a20 2020  'namespace').   
-00000c20: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00000c30: 7465 7874 203d 2073 656c 662e 6f70 7469  text = self.opti
-00000c40: 6f6e 732e 6765 7428 2763 6f6e 7465 7874  ons.get('context
-00000c50: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00000c60: 2020 2063 6469 203d 2073 656c 662e 6f70     cdi = self.op
-00000c70: 7469 6f6e 732e 6765 7428 2763 6469 272c  tions.get('cdi',
-00000c80: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
-00000c90: 2020 2020 2020 2064 6174 6176 6f6c 756d         datavolum
-00000ca0: 6573 203d 2073 656c 662e 6f70 7469 6f6e  es = self.option
-00000cb0: 732e 6765 7428 2764 6174 6176 6f6c 756d  s.get('datavolum
-00000cc0: 6573 272c 2054 7275 6529 0a20 2020 2020  es', True).     
-00000cd0: 2020 2020 2020 2020 2020 2072 6561 6477             readw
-00000ce0: 7269 7465 6d61 6e79 203d 2073 656c 662e  ritemany = self.
-00000cf0: 6f70 7469 6f6e 732e 6765 7428 2772 6561  options.get('rea
-00000d00: 6477 7269 7465 6d61 6e79 272c 2046 616c  dwritemany', Fal
-00000d10: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00000d20: 2020 2020 6361 5f66 696c 6520 3d20 7365      ca_file = se
-00000d30: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00000d40: 6361 5f66 696c 6527 290a 2020 2020 2020  ca_file').      
-00000d50: 2020 2020 2020 2020 2020 6966 2063 615f            if ca_
-00000d60: 6669 6c65 2069 7320 6e6f 7420 4e6f 6e65  file is not None
-00000d70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00000d80: 2020 2020 2020 6361 5f66 696c 6520 3d20        ca_file = 
-00000d90: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-00000da0: 6572 2863 615f 6669 6c65 290a 2020 2020  er(ca_file).    
-00000db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000dc0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
-00000dd0: 7869 7374 7328 6361 5f66 696c 6529 3a0a  xists(ca_file):.
-00000de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000df0: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-00000e00: 4361 2066 696c 6520 7b63 615f 6669 6c65  Ca file {ca_file
-00000e10: 7d20 646f 6573 6e27 7420 6578 6973 742e  } doesn't exist.
-00000e20: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+00000310: 6c75 7374 6572 2069 6d70 6f72 7420 6d69  luster import mi
+00000320: 6372 6f73 6869 6674 0a66 726f 6d20 6b76  croshift.from kv
+00000330: 6972 742e 636c 7573 7465 7220 696d 706f  irt.cluster impo
+00000340: 7274 206b 3373 0a66 726f 6d20 6b76 6972  rt k3s.from kvir
+00000350: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+00000360: 206b 7562 6561 646d 0a66 726f 6d20 6b76   kubeadm.from kv
+00000370: 6972 742e 636c 7573 7465 7220 696d 706f  irt.cluster impo
+00000380: 7274 2068 7970 6572 7368 6966 740a 6672  rt hypershift.fr
+00000390: 6f6d 206b 7669 7274 2e63 6c75 7374 6572  om kvirt.cluster
+000003a0: 2069 6d70 6f72 7420 6f70 656e 7368 6966   import openshif
+000003b0: 740a 6672 6f6d 206b 7669 7274 2e65 7870  t.from kvirt.exp
+000003c0: 6f73 6520 696d 706f 7274 204b 6578 706f  ose import Kexpo
+000003d0: 7365 720a 6672 6f6d 206b 7669 7274 2e69  ser.from kvirt.i
+000003e0: 6e74 6572 6e61 6c70 6c61 6e73 2069 6d70  nternalplans imp
+000003f0: 6f72 7420 6861 7072 6f78 7920 6173 2068  ort haproxy as h
+00000400: 6170 726f 7879 706c 616e 0a66 726f 6d20  aproxyplan.from 
+00000410: 6b76 6972 742e 6261 7365 636f 6e66 6967  kvirt.baseconfig
+00000420: 2069 6d70 6f72 7420 4b62 6173 6563 6f6e   import Kbasecon
+00000430: 6669 670a 6672 6f6d 206b 7669 7274 2e63  fig.from kvirt.c
+00000440: 6f6e 7461 696e 6572 636f 6e66 6967 2069  ontainerconfig i
+00000450: 6d70 6f72 7420 4b63 6f6e 7461 696e 6572  mport Kcontainer
+00000460: 636f 6e66 6967 0a66 726f 6d20 6b76 6972  config.from kvir
+00000470: 742e 6d69 6e69 636f 6e73 6f6c 6520 696d  t.miniconsole im
+00000480: 706f 7274 204b 6d69 6e69 636f 6e73 6f6c  port Kminiconsol
+00000490: 650a 6672 6f6d 2067 6574 7061 7373 2069  e.from getpass i
+000004a0: 6d70 6f72 7420 6765 7475 7365 720a 696d  mport getuser.im
+000004b0: 706f 7274 2067 6c6f 620a 696d 706f 7274  port glob.import
+000004c0: 206f 730a 696d 706f 7274 2072 650a 696d   os.import re.im
+000004d0: 706f 7274 2073 6f63 6b65 740a 6672 6f6d  port socket.from
+000004e0: 2073 6875 7469 6c20 696d 706f 7274 2072   shutil import r
+000004f0: 6d74 7265 652c 2077 6869 6368 0a69 6d70  mtree, which.imp
+00000500: 6f72 7420 7379 730a 6672 6f6d 2073 7562  ort sys.from sub
+00000510: 7072 6f63 6573 7320 696d 706f 7274 2063  process import c
+00000520: 616c 6c2c 2072 756e 2c20 5049 5045 2c20  all, run, PIPE, 
+00000530: 5354 444f 5554 0a66 726f 6d20 7465 6d70  STDOUT.from temp
+00000540: 6669 6c65 2069 6d70 6f72 7420 5465 6d70  file import Temp
+00000550: 6f72 6172 7944 6972 6563 746f 7279 0a69  oraryDirectory.i
+00000560: 6d70 6f72 7420 7468 7265 6164 696e 670a  mport threading.
+00000570: 6672 6f6d 2074 696d 6520 696d 706f 7274  from time import
+00000580: 2073 6c65 6570 0a69 6d70 6f72 7420 7765   sleep.import we
+00000590: 6262 726f 7773 6572 0a69 6d70 6f72 7420  bbrowser.import 
+000005a0: 7961 6d6c 0a0a 7a65 726f 7469 6572 5f73  yaml..zerotier_s
+000005b0: 6572 7669 6365 203d 2022 2222 5b55 6e69  ervice = """[Uni
+000005c0: 745d 0a44 6573 6372 6970 7469 6f6e 3d5a  t].Description=Z
+000005d0: 6572 6f20 5469 6572 2073 6572 7669 6365  ero Tier service
+000005e0: 0a41 6674 6572 3d6e 6574 776f 726b 2d6f  .After=network-o
+000005f0: 6e6c 696e 652e 7461 7267 6574 0a57 616e  nline.target.Wan
+00000600: 7473 3d6e 6574 776f 726b 2d6f 6e6c 696e  ts=network-onlin
+00000610: 652e 7461 7267 6574 0a42 6566 6f72 653d  e.target.Before=
+00000620: 6b75 6265 6c65 742e 7365 7276 6963 650a  kubelet.service.
+00000630: 5b53 6572 7669 6365 5d0a 5479 7065 3d66  [Service].Type=f
+00000640: 6f72 6b69 6e67 0a4b 696c 6c4d 6f64 653d  orking.KillMode=
+00000650: 6e6f 6e65 0a52 6573 7461 7274 3d6f 6e2d  none.Restart=on-
+00000660: 6661 696c 7572 650a 5265 6d61 696e 4166  failure.RemainAf
+00000670: 7465 7245 7869 743d 7965 730a 4578 6563  terExit=yes.Exec
+00000680: 5374 6172 7450 7265 3d6d 6f64 7072 6f62  StartPre=modprob
+00000690: 6520 7475 6e0a 4578 6563 5374 6172 7450  e tun.ExecStartP
+000006a0: 7265 3d70 6f64 6d61 6e20 7075 6c6c 2071  re=podman pull q
+000006b0: 7561 792e 696f 2f6b 6172 6d61 622f 7a65  uay.io/karmab/ze
+000006c0: 726f 7469 6572 2d63 6c69 0a45 7865 6353  rotier-cli.ExecS
+000006d0: 7461 7274 5072 653d 706f 646d 616e 2063  tartPre=podman c
+000006e0: 7265 6174 6520 2d2d 6e61 6d65 3d7a 6572  reate --name=zer
+000006f0: 6f74 6965 7220 2d69 7420 2d2d 6361 702d  otier -it --cap-
+00000700: 6164 643d 4e45 545f 4144 4d49 4e20 2d2d  add=NET_ADMIN --
+00000710: 6465 7669 6365 3d2f 6465 762f 6e65 742f  device=/dev/net/
+00000720: 7475 6e20 2d2d 6361 702d 6164 643d 5359  tun --cap-add=SY
+00000730: 535f 4144 4d49 4e20 5c0a 2d2d 6e65 743d  S_ADMIN \.--net=
+00000740: 686f 7374 202d 2d65 6e74 7279 706f 696e  host --entrypoin
+00000750: 743d 2f62 696e 2f73 6820 6b61 726d 6162  t=/bin/sh karmab
+00000760: 2f7a 6572 6f74 6965 722d 636c 6920 2d63  /zerotier-cli -c
+00000770: 2022 7a65 726f 7469 6572 2d6f 6e65 202d   "zerotier-one -
+00000780: 6420 3b20 736c 6565 7020 3130 203b 205c  d ; sleep 10 ; \
+00000790: 0a7b 7a65 726f 7469 6572 5f6a 6f69 6e7d  .{zerotier_join}
+000007a0: 203b 205c 0a73 6c65 6570 2069 6e66 696e   ; \.sleep infin
+000007b0: 6974 7922 0a45 7865 6353 7461 7274 3d70  ity".ExecStart=p
+000007c0: 6f64 6d61 6e20 7374 6172 7420 7a65 726f  odman start zero
+000007d0: 7469 6572 0a45 7865 6353 746f 703d 706f  tier.ExecStop=po
+000007e0: 646d 616e 2073 746f 7020 2d74 2031 3020  dman stop -t 10 
+000007f0: 7a65 726f 7469 6572 0a45 7865 6353 746f  zerotier.ExecSto
+00000800: 7050 6f73 743d 706f 646d 616e 2072 6d20  pPost=podman rm 
+00000810: 7a65 726f 7469 6572 0a7b 7a65 726f 7469  zerotier.{zeroti
+00000820: 6572 5f6b 7562 656c 6574 5f73 6372 6970  er_kubelet_scrip
+00000830: 747d 0a5b 496e 7374 616c 6c5d 0a57 616e  t}.[Install].Wan
+00000840: 7465 6442 793d 6d75 6c74 692d 7573 6572  tedBy=multi-user
+00000850: 2e74 6172 6765 7422 2222 0a0a 0a7a 6572  .target"""...zer
+00000860: 6f74 6965 725f 6b75 6265 6c65 745f 6461  otier_kubelet_da
+00000870: 7461 203d 2022 2222 4578 6563 5374 6172  ta = """ExecStar
+00000880: 7450 6f73 743d 2f62 696e 2f62 6173 6820  tPost=/bin/bash 
+00000890: 2d63 2027 736c 6565 7020 3230 203b 5c0a  -c 'sleep 20 ;\.
+000008a0: 4950 3d24 2869 7020 2d34 202d 6f20 6164  IP=$(ip -4 -o ad
+000008b0: 6472 2073 686f 7720 7a74 7070 6971 6978  dr show ztppiqix
+000008c0: 6172 207c 2063 7574 202d 6637 202d 6422  ar | cut -f7 -d"
+000008d0: 2022 207c 2063 7574 202d 6420 222f 2220   " | cut -d "/" 
+000008e0: 2d66 2031 207c 2068 6561 6420 2d31 2920  -f 1 | head -1) 
+000008f0: 3b5c 0a69 6620 5b20 2224 2867 7265 7020  ;\.if [ "$(grep 
+00000900: 2449 5020 2f65 7463 2f73 7973 7465 6d64  $IP /etc/systemd
+00000910: 2f73 7973 7465 6d2f 6b75 6265 6c65 742e  /system/kubelet.
+00000920: 7365 7276 6963 6529 2220 3d3d 2022 2220  service)" == "" 
+00000930: 5d20 3b20 7468 656e 205c 0a73 6564 202d  ] ; then \.sed -
+00000940: 6920 222f 6e6f 6465 2d69 702f 6422 202f  i "/node-ip/d" /
+00000950: 6574 632f 7379 7374 656d 642f 7379 7374  etc/systemd/syst
+00000960: 656d 2f6b 7562 656c 6574 2e73 6572 7669  em/kubelet.servi
+00000970: 6365 203b 5c0a 7365 6420 2d69 2022 2f2e  ce ;\.sed -i "/.
+00000980: 2a6e 6f64 652d 6c61 6265 6c73 2a2f 6120  *node-labels*/a 
+00000990: 2d2d 6e6f 6465 2d69 703d 2449 5020 2d2d  --node-ip=$IP --
+000009a0: 6164 6472 6573 733d 2449 5020 5c5c 2220  address=$IP \\" 
+000009b0: 2f65 7463 2f73 7973 7465 6d64 2f73 7973  /etc/systemd/sys
+000009c0: 7465 6d2f 6b75 6265 6c65 742e 7365 7276  tem/kubelet.serv
+000009d0: 6963 6520 3b5c 0a73 7973 7465 6d63 746c  ice ;\.systemctl
+000009e0: 2064 6165 6d6f 6e2d 7265 6c6f 6164 203b   daemon-reload ;
+000009f0: 5c0a 6669 2722 2222 0a0a 636c 6f75 6470  \.fi'"""..cloudp
+00000a00: 6c61 7466 6f72 6d73 203d 205b 2761 7773  latforms = ['aws
+00000a10: 272c 2027 6763 7027 2c20 2770 6163 6b65  ', 'gcp', 'packe
+00000a20: 7427 2c20 2769 626d 636c 6f75 6427 5d0a  t', 'ibmcloud'].
+00000a30: 0a0a 636c 6173 7320 4b63 6f6e 6669 6728  ..class Kconfig(
+00000a40: 4b62 6173 6563 6f6e 6669 6729 3a0a 2020  Kbaseconfig):.  
+00000a50: 2020 2222 220a 0a20 2020 2022 2222 0a20    """..    """. 
+00000a60: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00000a70: 7365 6c66 2c20 636c 6965 6e74 3d4e 6f6e  self, client=Non
+00000a80: 652c 2064 6562 7567 3d46 616c 7365 2c20  e, debug=False, 
+00000a90: 7175 6965 743d 4661 6c73 652c 2072 6567  quiet=False, reg
+00000aa0: 696f 6e3d 4e6f 6e65 2c20 7a6f 6e65 3d4e  ion=None, zone=N
+00000ab0: 6f6e 652c 206e 616d 6573 7061 6365 3d4e  one, namespace=N
+00000ac0: 6f6e 652c 206f 6666 6c69 6e65 3d46 616c  one, offline=Fal
+00000ad0: 7365 293a 0a20 2020 2020 2020 204b 6261  se):.        Kba
+00000ae0: 7365 636f 6e66 6967 2e5f 5f69 6e69 745f  seconfig.__init_
+00000af0: 5f28 7365 6c66 2c20 636c 6965 6e74 3d63  _(self, client=c
+00000b00: 6c69 656e 742c 2064 6562 7567 3d64 6562  lient, debug=deb
+00000b10: 7567 2c20 7175 6965 743d 7175 6965 742c  ug, quiet=quiet,
+00000b20: 206f 6666 6c69 6e65 3d6f 6666 6c69 6e65   offline=offline
+00000b30: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00000b40: 2073 656c 662e 656e 6162 6c65 643a 0a20   self.enabled:. 
+00000b50: 2020 2020 2020 2020 2020 206b 203d 204e             k = N
+00000b60: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
+00000b70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00000b80: 2073 656c 662e 7479 7065 203d 3d20 276b   self.type == 'k
+00000b90: 7562 6576 6972 7427 3a0a 2020 2020 2020  ubevirt':.      
+00000ba0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00000bb0: 6573 7061 6365 2069 7320 4e6f 6e65 3a0a  espace is None:.
+00000bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000bd0: 2020 2020 6e61 6d65 7370 6163 6520 3d20      namespace = 
+00000be0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00000bf0: 2827 6e61 6d65 7370 6163 6527 290a 2020  ('namespace').  
+00000c00: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00000c10: 6e74 6578 7420 3d20 7365 6c66 2e6f 7074  ntext = self.opt
+00000c20: 696f 6e73 2e67 6574 2827 636f 6e74 6578  ions.get('contex
+00000c30: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00000c40: 2020 2020 6364 6920 3d20 7365 6c66 2e6f      cdi = self.o
+00000c50: 7074 696f 6e73 2e67 6574 2827 6364 6927  ptions.get('cdi'
+00000c60: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+00000c70: 2020 2020 2020 2020 6461 7461 766f 6c75          datavolu
+00000c80: 6d65 7320 3d20 7365 6c66 2e6f 7074 696f  mes = self.optio
+00000c90: 6e73 2e67 6574 2827 6461 7461 766f 6c75  ns.get('datavolu
+00000ca0: 6d65 7327 2c20 5472 7565 290a 2020 2020  mes', True).    
+00000cb0: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00000cc0: 7772 6974 656d 616e 7920 3d20 7365 6c66  writemany = self
+00000cd0: 2e6f 7074 696f 6e73 2e67 6574 2827 7265  .options.get('re
+00000ce0: 6164 7772 6974 656d 616e 7927 2c20 4661  adwritemany', Fa
+00000cf0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+00000d00: 2020 2020 2063 615f 6669 6c65 203d 2073       ca_file = s
+00000d10: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00000d20: 2763 615f 6669 6c65 2729 0a20 2020 2020  'ca_file').     
+00000d30: 2020 2020 2020 2020 2020 2069 6620 6361             if ca
+00000d40: 5f66 696c 6520 6973 206e 6f74 204e 6f6e  _file is not Non
+00000d50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00000d60: 2020 2020 2020 2063 615f 6669 6c65 203d         ca_file =
+00000d70: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+00000d80: 7365 7228 6361 5f66 696c 6529 0a20 2020  ser(ca_file).   
+00000d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000da0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00000db0: 6578 6973 7473 2863 615f 6669 6c65 293a  exists(ca_file):
+00000dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000dd0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+00000de0: 2243 6120 6669 6c65 207b 6361 5f66 696c  "Ca file {ca_fil
+00000df0: 657d 2064 6f65 736e 2774 2065 7869 7374  e} doesn't exist
+00000e00: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+00000e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e20: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
 00000e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e40: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00000e50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00000e60: 6973 6b5f 686f 7470 6c75 6720 3d20 7365  isk_hotplug = se
-00000e70: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00000e80: 6469 736b 5f68 6f74 706c 7567 272c 2046  disk_hotplug', F
-00000e90: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00000ea0: 2020 2020 2020 6b75 6265 636f 6e66 6967        kubeconfig
-00000eb0: 5f66 696c 6520 3d20 7365 6c66 2e6f 7074  _file = self.opt
-00000ec0: 696f 6e73 2e67 6574 2827 6b75 6265 636f  ions.get('kubeco
-00000ed0: 6e66 6967 2729 0a20 2020 2020 2020 2020  nfig').         
-00000ee0: 2020 2020 2020 2074 6f6b 656e 203d 2073         token = s
-00000ef0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00000f00: 2774 6f6b 656e 2729 0a20 2020 2020 2020  'token').       
-00000f10: 2020 2020 2020 2020 2074 6f6b 656e 5f66           token_f
-00000f20: 696c 6520 3d20 7365 6c66 2e6f 7074 696f  ile = self.optio
-00000f30: 6e73 2e67 6574 2827 746f 6b65 6e5f 6669  ns.get('token_fi
-00000f40: 6c65 2729 0a20 2020 2020 2020 2020 2020  le').           
-00000f50: 2020 2020 2069 6620 746f 6b65 6e5f 6669       if token_fi
-00000f60: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  le is not None:.
-00000f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000f80: 2020 2020 746f 6b65 6e5f 6669 6c65 203d      token_file =
-00000f90: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-00000fa0: 7365 7228 746f 6b65 6e5f 6669 6c65 290a  ser(token_file).
-00000fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000fc0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00000fd0: 7468 2e65 7869 7374 7328 746f 6b65 6e5f  th.exists(token_
-00000fe0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-00000ff0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00001000: 7272 6f72 2822 546f 6b65 6e20 6669 6c65  rror("Token file
-00001010: 2070 6174 6820 646f 6573 6e27 7420 6578   path doesn't ex
-00001020: 6973 742e 204c 6561 7669 6e67 2229 0a20  ist. Leaving"). 
-00001030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001040: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-00001050: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00001060: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00001070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001080: 2020 2020 2074 6f6b 656e 203d 206f 7065       token = ope
-00001090: 6e28 746f 6b65 6e5f 6669 6c65 292e 7265  n(token_file).re
-000010a0: 6164 2829 0a20 2020 2020 2020 2020 2020  ad().           
-000010b0: 2020 2020 2072 6567 6973 7472 7920 3d20       registry = 
-000010c0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-000010d0: 2827 7265 6769 7374 7279 2729 0a20 2020  ('registry').   
-000010e0: 2020 2020 2020 2020 2020 2020 2061 6363               acc
-000010f0: 6573 735f 6d6f 6465 203d 2073 656c 662e  ess_mode = self.
-00001100: 6f70 7469 6f6e 732e 6765 7428 2761 6363  options.get('acc
-00001110: 6573 735f 6d6f 6465 272c 2027 4e6f 6465  ess_mode', 'Node
-00001120: 506f 7274 2729 0a20 2020 2020 2020 2020  Port').         
-00001130: 2020 2020 2020 2069 6620 6163 6365 7373         if access
-00001140: 5f6d 6f64 6520 6e6f 7420 696e 205b 2745  _mode not in ['E
-00001150: 7874 6572 6e61 6c27 2c20 274c 6f61 6442  xternal', 'LoadB
-00001160: 616c 616e 6365 7227 2c20 274e 6f64 6550  alancer', 'NodeP
-00001170: 6f72 7427 5d3a 0a20 2020 2020 2020 2020  ort']:.         
-00001180: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00001190: 2066 2249 6e63 6f72 7265 6374 2061 6363   f"Incorrect acc
-000011a0: 6573 735f 6d6f 6465 207b 6163 6365 7373  ess_mode {access
-000011b0: 5f6d 6f64 657d 2e20 5368 6f75 6c64 2062  _mode}. Should b
-000011c0: 6520 4578 7465 726e 616c 2c20 4e6f 6465  e External, Node
-000011d0: 506f 7274 206f 7220 4c6f 6164 4261 6c61  Port or LoadBala
-000011e0: 6e63 6572 220a 2020 2020 2020 2020 2020  ncer".          
-000011f0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00001200: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
-00001210: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00001220: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00001230: 2020 2020 2076 6f6c 756d 655f 6d6f 6465       volume_mode
-00001240: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00001250: 6765 7428 2776 6f6c 756d 655f 6d6f 6465  get('volume_mode
-00001260: 272c 2027 4669 6c65 7379 7374 656d 2729  ', 'Filesystem')
-00001270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001280: 2069 6620 766f 6c75 6d65 5f6d 6f64 6520   if volume_mode 
-00001290: 6e6f 7420 696e 205b 2746 696c 6573 7973  not in ['Filesys
-000012a0: 7465 6d27 2c20 2742 6c6f 636b 275d 3a0a  tem', 'Block']:.
-000012b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012c0: 2020 2020 6d73 6720 3d20 6622 496e 636f      msg = f"Inco
-000012d0: 7272 6563 7420 766f 6c75 6d65 5f6d 6f64  rrect volume_mod
-000012e0: 6520 7b76 6f6c 756d 655f 6d6f 6465 7d2e  e {volume_mode}.
-000012f0: 2053 686f 756c 6420 6265 2046 696c 6573   Should be Files
-00001300: 7973 7465 6d20 6f72 2042 6c6f 636b 220a  ystem or Block".
+00000e40: 6469 736b 5f68 6f74 706c 7567 203d 2073  disk_hotplug = s
+00000e50: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00000e60: 2764 6973 6b5f 686f 7470 6c75 6727 2c20  'disk_hotplug', 
+00000e70: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00000e80: 2020 2020 2020 206b 7562 6563 6f6e 6669         kubeconfi
+00000e90: 675f 6669 6c65 203d 2073 656c 662e 6f70  g_file = self.op
+00000ea0: 7469 6f6e 732e 6765 7428 276b 7562 6563  tions.get('kubec
+00000eb0: 6f6e 6669 6727 290a 2020 2020 2020 2020  onfig').        
+00000ec0: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+00000ed0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00000ee0: 2827 746f 6b65 6e27 290a 2020 2020 2020  ('token').      
+00000ef0: 2020 2020 2020 2020 2020 746f 6b65 6e5f            token_
+00000f00: 6669 6c65 203d 2073 656c 662e 6f70 7469  file = self.opti
+00000f10: 6f6e 732e 6765 7428 2774 6f6b 656e 5f66  ons.get('token_f
+00000f20: 696c 6527 290a 2020 2020 2020 2020 2020  ile').          
+00000f30: 2020 2020 2020 6966 2074 6f6b 656e 5f66        if token_f
+00000f40: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
+00000f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000f60: 2020 2020 2074 6f6b 656e 5f66 696c 6520       token_file 
+00000f70: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+00000f80: 7573 6572 2874 6f6b 656e 5f66 696c 6529  user(token_file)
+00000f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000fa0: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00000fb0: 6174 682e 6578 6973 7473 2874 6f6b 656e  ath.exists(token
+00000fc0: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
+00000fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000fe0: 6572 726f 7228 2254 6f6b 656e 2066 696c  error("Token fil
+00000ff0: 6520 7061 7468 2064 6f65 736e 2774 2065  e path doesn't e
+00001000: 7869 7374 2e20 4c65 6176 696e 6722 290a  xist. Leaving").
+00001010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001020: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+00001030: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+00001040: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00001050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001060: 2020 2020 2020 746f 6b65 6e20 3d20 6f70        token = op
+00001070: 656e 2874 6f6b 656e 5f66 696c 6529 2e72  en(token_file).r
+00001080: 6561 6428 290a 2020 2020 2020 2020 2020  ead().          
+00001090: 2020 2020 2020 7265 6769 7374 7279 203d        registry =
+000010a0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+000010b0: 7428 2772 6567 6973 7472 7927 290a 2020  t('registry').  
+000010c0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
+000010d0: 6365 7373 5f6d 6f64 6520 3d20 7365 6c66  cess_mode = self
+000010e0: 2e6f 7074 696f 6e73 2e67 6574 2827 6163  .options.get('ac
+000010f0: 6365 7373 5f6d 6f64 6527 2c20 274e 6f64  cess_mode', 'Nod
+00001100: 6550 6f72 7427 290a 2020 2020 2020 2020  ePort').        
+00001110: 2020 2020 2020 2020 6966 2061 6363 6573          if acces
+00001120: 735f 6d6f 6465 206e 6f74 2069 6e20 5b27  s_mode not in ['
+00001130: 4578 7465 726e 616c 272c 2027 4c6f 6164  External', 'Load
+00001140: 4261 6c61 6e63 6572 272c 2027 4e6f 6465  Balancer', 'Node
+00001150: 506f 7274 275d 3a0a 2020 2020 2020 2020  Port']:.        
+00001160: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+00001170: 3d20 6622 496e 636f 7272 6563 7420 6163  = f"Incorrect ac
+00001180: 6365 7373 5f6d 6f64 6520 7b61 6363 6573  cess_mode {acces
+00001190: 735f 6d6f 6465 7d2e 2053 686f 756c 6420  s_mode}. Should 
+000011a0: 6265 2045 7874 6572 6e61 6c2c 204e 6f64  be External, Nod
+000011b0: 6550 6f72 7420 6f72 204c 6f61 6442 616c  ePort or LoadBal
+000011c0: 616e 6365 7222 0a20 2020 2020 2020 2020  ancer".         
+000011d0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+000011e0: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+000011f0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00001200: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00001210: 2020 2020 2020 766f 6c75 6d65 5f6d 6f64        volume_mod
+00001220: 6520 3d20 7365 6c66 2e6f 7074 696f 6e73  e = self.options
+00001230: 2e67 6574 2827 766f 6c75 6d65 5f6d 6f64  .get('volume_mod
+00001240: 6527 2c20 2746 696c 6573 7973 7465 6d27  e', 'Filesystem'
+00001250: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001260: 2020 6966 2076 6f6c 756d 655f 6d6f 6465    if volume_mode
+00001270: 206e 6f74 2069 6e20 5b27 4669 6c65 7379   not in ['Filesy
+00001280: 7374 656d 272c 2027 426c 6f63 6b27 5d3a  stem', 'Block']:
+00001290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000012a0: 2020 2020 206d 7367 203d 2066 2249 6e63       msg = f"Inc
+000012b0: 6f72 7265 6374 2076 6f6c 756d 655f 6d6f  orrect volume_mo
+000012c0: 6465 207b 766f 6c75 6d65 5f6d 6f64 657d  de {volume_mode}
+000012d0: 2e20 5368 6f75 6c64 2062 6520 4669 6c65  . Should be File
+000012e0: 7379 7374 656d 206f 7220 426c 6f63 6b22  system or Block"
+000012f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001300: 2020 2020 2065 7272 6f72 286d 7367 290a       error(msg).
 00001310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001320: 2020 2020 6572 726f 7228 6d73 6729 0a20      error(msg). 
+00001320: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
 00001330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001340: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00001350: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00001360: 6f6c 756d 655f 6163 6365 7373 203d 2073  olume_access = s
-00001370: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00001380: 2776 6f6c 756d 655f 6163 6365 7373 272c  'volume_access',
-00001390: 2027 5265 6164 5772 6974 654f 6e63 6527   'ReadWriteOnce'
-000013a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000013b0: 2020 6966 2076 6f6c 756d 655f 6163 6365    if volume_acce
-000013c0: 7373 206e 6f74 2069 6e20 5b27 5265 6164  ss not in ['Read
-000013d0: 5772 6974 654d 616e 7927 2c20 2752 6561  WriteMany', 'Rea
-000013e0: 6457 7269 7465 4f6e 6365 275d 3a0a 2020  dWriteOnce']:.  
-000013f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001400: 2020 6d73 6720 3d20 6622 496e 636f 7272    msg = f"Incorr
-00001410: 6563 7420 766f 6c75 6d65 5f61 6363 6573  ect volume_acces
-00001420: 7320 7b76 6f6c 756d 655f 6163 6365 7373  s {volume_access
-00001430: 7d2e 2053 686f 756c 6420 6265 2052 6561  }. Should be Rea
-00001440: 6457 7269 7465 4f6e 6365 206f 7220 5265  dWriteOnce or Re
-00001450: 6164 5772 6974 654f 6e63 6522 0a20 2020  adWriteOnce".   
+00001340: 766f 6c75 6d65 5f61 6363 6573 7320 3d20  volume_access = 
+00001350: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00001360: 2827 766f 6c75 6d65 5f61 6363 6573 7327  ('volume_access'
+00001370: 2c20 2752 6561 6457 7269 7465 4f6e 6365  , 'ReadWriteOnce
+00001380: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00001390: 2020 2069 6620 766f 6c75 6d65 5f61 6363     if volume_acc
+000013a0: 6573 7320 6e6f 7420 696e 205b 2752 6561  ess not in ['Rea
+000013b0: 6457 7269 7465 4d61 6e79 272c 2027 5265  dWriteMany', 'Re
+000013c0: 6164 5772 6974 654f 6e63 6527 5d3a 0a20  adWriteOnce']:. 
+000013d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013e0: 2020 206d 7367 203d 2066 2249 6e63 6f72     msg = f"Incor
+000013f0: 7265 6374 2076 6f6c 756d 655f 6163 6365  rect volume_acce
+00001400: 7373 207b 766f 6c75 6d65 5f61 6363 6573  ss {volume_acces
+00001410: 737d 2e20 5368 6f75 6c64 2062 6520 5265  s}. Should be Re
+00001420: 6164 5772 6974 654f 6e63 6520 6f72 2052  adWriteOnce or R
+00001430: 6561 6457 7269 7465 4f6e 6365 220a 2020  eadWriteOnce".  
+00001440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001450: 2020 6572 726f 7228 6d73 6729 0a20 2020    error(msg).   
 00001460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001470: 2065 7272 6f72 286d 7367 290a 2020 2020   error(msg).    
-00001480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001490: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-000014a0: 2020 2020 2020 2020 2020 2020 6861 7276              harv
-000014b0: 6573 7465 7220 3d20 7365 6c66 2e6f 7074  ester = self.opt
-000014c0: 696f 6e73 2e67 6574 2827 6861 7276 6573  ions.get('harves
-000014d0: 7465 7227 2c20 4661 6c73 6529 0a20 2020  ter', False).   
-000014e0: 2020 2020 2020 2020 2020 2020 2065 6d62               emb
-000014f0: 6564 5f75 7365 7264 6174 6120 3d20 7365  ed_userdata = se
-00001500: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00001510: 656d 6265 645f 7573 6572 6461 7461 272c  embed_userdata',
-00001520: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-00001530: 2020 2020 2020 2020 6669 7273 745f 636f          first_co
-00001540: 6e73 756d 6572 203d 2073 656c 662e 6f70  nsumer = self.op
-00001550: 7469 6f6e 732e 6765 7428 2766 6972 7374  tions.get('first
-00001560: 5f63 6f6e 7375 6d65 7227 2c20 4661 6c73  _consumer', Fals
-00001570: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00001580: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
-00001590: 6f76 6964 6572 732e 6b75 6265 7669 7274  oviders.kubevirt
-000015a0: 2069 6d70 6f72 7420 4b75 6265 7669 7274   import Kubevirt
-000015b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000015c0: 206b 203d 204b 7562 6576 6972 7428 636f   k = Kubevirt(co
-000015d0: 6e74 6578 743d 636f 6e74 6578 742c 2074  ntext=context, t
-000015e0: 6f6b 656e 3d74 6f6b 656e 2c20 6361 5f66  oken=token, ca_f
-000015f0: 696c 653d 6361 5f66 696c 652c 2068 6f73  ile=ca_file, hos
-00001600: 743d 7365 6c66 2e68 6f73 742c 0a20 2020  t=self.host,.   
-00001610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001620: 2020 2020 2020 2020 2020 706f 7274 3d36            port=6
-00001630: 3434 332c 2075 7365 723d 7365 6c66 2e75  443, user=self.u
-00001640: 7365 722c 2064 6562 7567 3d64 6562 7567  ser, debug=debug
-00001650: 2c20 6e61 6d65 7370 6163 653d 6e61 6d65  , namespace=name
-00001660: 7370 6163 652c 2063 6469 3d63 6469 2c0a  space, cdi=cdi,.
-00001670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001680: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00001690: 6176 6f6c 756d 6573 3d64 6174 6176 6f6c  avolumes=datavol
-000016a0: 756d 6573 2c20 6469 736b 5f68 6f74 706c  umes, disk_hotpl
-000016b0: 7567 3d64 6973 6b5f 686f 7470 6c75 672c  ug=disk_hotplug,
-000016c0: 2072 6561 6477 7269 7465 6d61 6e79 3d72   readwritemany=r
-000016d0: 6561 6477 7269 7465 6d61 6e79 2c0a 2020  eadwritemany,.  
-000016e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016f0: 2020 2020 2020 2020 2020 2072 6567 6973             regis
-00001700: 7472 793d 7265 6769 7374 7279 2c20 6163  try=registry, ac
-00001710: 6365 7373 5f6d 6f64 653d 6163 6365 7373  cess_mode=access
-00001720: 5f6d 6f64 652c 2076 6f6c 756d 655f 6d6f  _mode, volume_mo
-00001730: 6465 3d76 6f6c 756d 655f 6d6f 6465 2c0a  de=volume_mode,.
-00001740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001750: 2020 2020 2020 2020 2020 2020 2076 6f6c               vol
-00001760: 756d 655f 6163 6365 7373 3d76 6f6c 756d  ume_access=volum
-00001770: 655f 6163 6365 7373 2c20 6861 7276 6573  e_access, harves
-00001780: 7465 723d 6861 7276 6573 7465 722c 2065  ter=harvester, e
-00001790: 6d62 6564 5f75 7365 7264 6174 613d 656d  mbed_userdata=em
-000017a0: 6265 645f 7573 6572 6461 7461 2c0a 2020  bed_userdata,.  
-000017b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017c0: 2020 2020 2020 2020 2020 2066 6972 7374             first
-000017d0: 5f63 6f6e 7375 6d65 723d 6669 7273 745f  _consumer=first_
-000017e0: 636f 6e73 756d 6572 2c20 6b75 6265 636f  consumer, kubeco
-000017f0: 6e66 6967 5f66 696c 653d 6b75 6265 636f  nfig_file=kubeco
-00001800: 6e66 6967 5f66 696c 6529 0a20 2020 2020  nfig_file).     
-00001810: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001820: 686f 7374 203d 206b 2e68 6f73 740a 2020  host = k.host.  
-00001830: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-00001840: 656c 662e 7479 7065 203d 3d20 2767 6370  elf.type == 'gcp
-00001850: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00001860: 2020 2063 7265 6465 6e74 6961 6c73 203d     credentials =
-00001870: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00001880: 7428 2763 7265 6465 6e74 6961 6c73 2729  t('credentials')
-00001890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000018a0: 2069 6620 6372 6564 656e 7469 616c 7320   if credentials 
-000018b0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000018c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018d0: 206f 732e 656e 7669 726f 6e5b 2747 4f4f   os.environ['GOO
-000018e0: 474c 455f 4150 504c 4943 4154 494f 4e5f  GLE_APPLICATION_
-000018f0: 4352 4544 454e 5449 414c 5327 5d20 3d20  CREDENTIALS'] = 
-00001900: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-00001910: 6572 2863 7265 6465 6e74 6961 6c73 290a  er(credentials).
-00001920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001930: 656c 6966 2027 474f 4f47 4c45 5f41 5050  elif 'GOOGLE_APP
-00001940: 4c49 4341 5449 4f4e 5f43 5245 4445 4e54  LICATION_CREDENT
-00001950: 4941 4c53 2720 6e6f 7420 696e 206f 732e  IALS' not in os.
-00001960: 656e 7669 726f 6e3a 0a20 2020 2020 2020  environ:.       
-00001970: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00001980: 6f72 2822 7365 7420 474f 4f47 4c45 5f41  or("set GOOGLE_A
-00001990: 5050 4c49 4341 5449 4f4e 5f43 5245 4445  PPLICATION_CREDE
-000019a0: 4e54 4941 4c53 2076 6172 6961 626c 652e  NTIALS variable.
-000019b0: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
-000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000019d0: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-000019e0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-000019f0: 6a65 6374 203d 2073 656c 662e 6f70 7469  ject = self.opti
-00001a00: 6f6e 732e 6765 7428 2770 726f 6a65 6374  ons.get('project
-00001a10: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00001a20: 2020 2069 6620 7072 6f6a 6563 7420 6973     if project is
-00001a30: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00001a40: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00001a50: 2822 4d69 7373 696e 6720 7072 6f6a 6563  ("Missing projec
-00001a60: 7420 696e 2074 6865 2063 6f6e 6669 6775  t in the configu
-00001a70: 7261 7469 6f6e 2e20 4c65 6176 696e 6722  ration. Leaving"
-00001a80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00001a90: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00001aa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00001ab0: 2020 7a6f 6e65 203d 2073 656c 662e 6f70    zone = self.op
-00001ac0: 7469 6f6e 732e 6765 7428 277a 6f6e 6527  tions.get('zone'
-00001ad0: 2c20 2765 7572 6f70 652d 7765 7374 312d  , 'europe-west1-
-00001ae0: 6227 2920 6966 207a 6f6e 6520 6973 204e  b') if zone is N
-00001af0: 6f6e 6520 656c 7365 207a 6f6e 650a 2020  one else zone.  
-00001b00: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00001b10: 6769 6f6e 203d 2073 656c 662e 6f70 7469  gion = self.opti
-00001b20: 6f6e 732e 6765 7428 2772 6567 696f 6e27  ons.get('region'
-00001b30: 2920 6966 2072 6567 696f 6e20 6973 204e  ) if region is N
-00001b40: 6f6e 6520 656c 7365 2072 6567 696f 6e0a  one else region.
-00001b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b60: 7265 6769 6f6e 203d 207a 6f6e 655b 3a2d  region = zone[:-
-00001b70: 325d 2069 6620 7265 6769 6f6e 2069 7320  2] if region is 
-00001b80: 4e6f 6e65 2065 6c73 6520 7265 6769 6f6e  None else region
-00001b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001ba0: 2066 726f 6d20 6b76 6972 742e 7072 6f76   from kvirt.prov
-00001bb0: 6964 6572 732e 6763 7020 696d 706f 7274  iders.gcp import
-00001bc0: 204b 6763 700a 2020 2020 2020 2020 2020   Kgcp.          
-00001bd0: 2020 2020 2020 6b20 3d20 4b67 6370 2870        k = Kgcp(p
-00001be0: 726f 6a65 6374 2c20 7a6f 6e65 3d7a 6f6e  roject, zone=zon
-00001bf0: 652c 2072 6567 696f 6e3d 7265 6769 6f6e  e, region=region
-00001c00: 2c20 6465 6275 673d 6465 6275 6729 0a20  , debug=debug). 
-00001c10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00001c20: 656c 662e 6f76 6572 7269 6465 732e 7570  elf.overrides.up
-00001c30: 6461 7465 287b 2770 726f 6a65 6374 273a  date({'project':
-00001c40: 2070 726f 6a65 6374 7d29 0a20 2020 2020   project}).     
-00001c50: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00001c60: 2e74 7970 6520 3d3d 2027 6177 7327 3a0a  .type == 'aws':.
-00001c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c80: 6966 206c 656e 2873 656c 662e 6f70 7469  if len(self.opti
-00001c90: 6f6e 7329 203d 3d20 313a 0a20 2020 2020  ons) == 1:.     
-00001ca0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00001cb0: 6f6d 6520 3d20 6f73 2e65 6e76 6972 6f6e  ome = os.environ
-00001cc0: 5b27 484f 4d45 275d 0a20 2020 2020 2020  ['HOME'].       
-00001cd0: 2020 2020 2020 2020 2020 2020 2061 6363               acc
-00001ce0: 6573 735f 6b65 795f 6964 2c20 6163 6365  ess_key_id, acce
-00001cf0: 7373 5f6b 6579 5f73 6563 7265 742c 206b  ss_key_secret, k
-00001d00: 6579 7061 6972 2c20 7265 6769 6f6e 2c20  eypair, region, 
-00001d10: 7365 7373 696f 6e5f 746f 6b65 6e20 3d20  session_token = 
-00001d20: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-00001d30: 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  , None, None.   
-00001d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d50: 2069 6d70 6f72 7420 636f 6e66 6967 7061   import configpa
-00001d60: 7273 6572 0a20 2020 2020 2020 2020 2020  rser.           
-00001d70: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-00001d80: 6174 682e 6578 6973 7473 2866 227b 686f  ath.exists(f"{ho
-00001d90: 6d65 7d2f 2e61 7773 2f63 7265 6465 6e74  me}/.aws/credent
-00001da0: 6961 6c73 2229 3a0a 2020 2020 2020 2020  ials"):.        
+00001470: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00001480: 2020 2020 2020 2020 2020 2020 2068 6172               har
+00001490: 7665 7374 6572 203d 2073 656c 662e 6f70  vester = self.op
+000014a0: 7469 6f6e 732e 6765 7428 2768 6172 7665  tions.get('harve
+000014b0: 7374 6572 272c 2046 616c 7365 290a 2020  ster', False).  
+000014c0: 2020 2020 2020 2020 2020 2020 2020 656d                em
+000014d0: 6265 645f 7573 6572 6461 7461 203d 2073  bed_userdata = s
+000014e0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+000014f0: 2765 6d62 6564 5f75 7365 7264 6174 6127  'embed_userdata'
+00001500: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
+00001510: 2020 2020 2020 2020 2066 6972 7374 5f63           first_c
+00001520: 6f6e 7375 6d65 7220 3d20 7365 6c66 2e6f  onsumer = self.o
+00001530: 7074 696f 6e73 2e67 6574 2827 6669 7273  ptions.get('firs
+00001540: 745f 636f 6e73 756d 6572 272c 2046 616c  t_consumer', Fal
+00001550: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00001560: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
+00001570: 726f 7669 6465 7273 2e6b 7562 6576 6972  roviders.kubevir
+00001580: 7420 696d 706f 7274 204b 7562 6576 6972  t import Kubevir
+00001590: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000015a0: 2020 6b20 3d20 4b75 6265 7669 7274 2863    k = Kubevirt(c
+000015b0: 6f6e 7465 7874 3d63 6f6e 7465 7874 2c20  ontext=context, 
+000015c0: 746f 6b65 6e3d 746f 6b65 6e2c 2063 615f  token=token, ca_
+000015d0: 6669 6c65 3d63 615f 6669 6c65 2c20 686f  file=ca_file, ho
+000015e0: 7374 3d73 656c 662e 686f 7374 2c0a 2020  st=self.host,.  
+000015f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001600: 2020 2020 2020 2020 2020 2070 6f72 743d             port=
+00001610: 3634 3433 2c20 7573 6572 3d73 656c 662e  6443, user=self.
+00001620: 7573 6572 2c20 6465 6275 673d 6465 6275  user, debug=debu
+00001630: 672c 206e 616d 6573 7061 6365 3d6e 616d  g, namespace=nam
+00001640: 6573 7061 6365 2c20 6364 693d 6364 692c  espace, cdi=cdi,
+00001650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001660: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00001670: 7461 766f 6c75 6d65 733d 6461 7461 766f  tavolumes=datavo
+00001680: 6c75 6d65 732c 2064 6973 6b5f 686f 7470  lumes, disk_hotp
+00001690: 6c75 673d 6469 736b 5f68 6f74 706c 7567  lug=disk_hotplug
+000016a0: 2c20 7265 6164 7772 6974 656d 616e 793d  , readwritemany=
+000016b0: 7265 6164 7772 6974 656d 616e 792c 0a20  readwritemany,. 
+000016c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016d0: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+000016e0: 7374 7279 3d72 6567 6973 7472 792c 2061  stry=registry, a
+000016f0: 6363 6573 735f 6d6f 6465 3d61 6363 6573  ccess_mode=acces
+00001700: 735f 6d6f 6465 2c20 766f 6c75 6d65 5f6d  s_mode, volume_m
+00001710: 6f64 653d 766f 6c75 6d65 5f6d 6f64 652c  ode=volume_mode,
+00001720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001730: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00001740: 6c75 6d65 5f61 6363 6573 733d 766f 6c75  lume_access=volu
+00001750: 6d65 5f61 6363 6573 732c 2068 6172 7665  me_access, harve
+00001760: 7374 6572 3d68 6172 7665 7374 6572 2c20  ster=harvester, 
+00001770: 656d 6265 645f 7573 6572 6461 7461 3d65  embed_userdata=e
+00001780: 6d62 6564 5f75 7365 7264 6174 612c 0a20  mbed_userdata,. 
+00001790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017a0: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+000017b0: 745f 636f 6e73 756d 6572 3d66 6972 7374  t_consumer=first
+000017c0: 5f63 6f6e 7375 6d65 722c 206b 7562 6563  _consumer, kubec
+000017d0: 6f6e 6669 675f 6669 6c65 3d6b 7562 6563  onfig_file=kubec
+000017e0: 6f6e 6669 675f 6669 6c65 290a 2020 2020  onfig_file).    
+000017f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001800: 2e68 6f73 7420 3d20 6b2e 686f 7374 0a20  .host = k.host. 
+00001810: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00001820: 7365 6c66 2e74 7970 6520 3d3d 2027 6763  self.type == 'gc
+00001830: 7027 3a0a 2020 2020 2020 2020 2020 2020  p':.            
+00001840: 2020 2020 6372 6564 656e 7469 616c 7320      credentials 
+00001850: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00001860: 6574 2827 6372 6564 656e 7469 616c 7327  et('credentials'
+00001870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001880: 2020 6966 2063 7265 6465 6e74 6961 6c73    if credentials
+00001890: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000018a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000018b0: 2020 6f73 2e65 6e76 6972 6f6e 5b27 474f    os.environ['GO
+000018c0: 4f47 4c45 5f41 5050 4c49 4341 5449 4f4e  OGLE_APPLICATION
+000018d0: 5f43 5245 4445 4e54 4941 4c53 275d 203d  _CREDENTIALS'] =
+000018e0: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+000018f0: 7365 7228 6372 6564 656e 7469 616c 7329  ser(credentials)
+00001900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001910: 2065 6c69 6620 2747 4f4f 474c 455f 4150   elif 'GOOGLE_AP
+00001920: 504c 4943 4154 494f 4e5f 4352 4544 454e  PLICATION_CREDEN
+00001930: 5449 414c 5327 206e 6f74 2069 6e20 6f73  TIALS' not in os
+00001940: 2e65 6e76 6972 6f6e 3a0a 2020 2020 2020  .environ:.      
+00001950: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00001960: 726f 7228 2273 6574 2047 4f4f 474c 455f  ror("set GOOGLE_
+00001970: 4150 504c 4943 4154 494f 4e5f 4352 4544  APPLICATION_CRED
+00001980: 454e 5449 414c 5320 7661 7269 6162 6c65  ENTIALS variable
+00001990: 2e4c 6561 7669 6e67 2e2e 2e22 290a 2020  .Leaving...").  
+000019a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019b0: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+000019c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000019d0: 6f6a 6563 7420 3d20 7365 6c66 2e6f 7074  oject = self.opt
+000019e0: 696f 6e73 2e67 6574 2827 7072 6f6a 6563  ions.get('projec
+000019f0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00001a00: 2020 2020 6966 2070 726f 6a65 6374 2069      if project i
+00001a10: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00001a20: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00001a30: 7228 224d 6973 7369 6e67 2070 726f 6a65  r("Missing proje
+00001a40: 6374 2069 6e20 7468 6520 636f 6e66 6967  ct in the config
+00001a50: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
+00001a60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00001a70: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00001a80: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00001a90: 2020 207a 6f6e 6520 3d20 7365 6c66 2e6f     zone = self.o
+00001aa0: 7074 696f 6e73 2e67 6574 2827 7a6f 6e65  ptions.get('zone
+00001ab0: 272c 2027 6575 726f 7065 2d77 6573 7431  ', 'europe-west1
+00001ac0: 2d62 2729 2069 6620 7a6f 6e65 2069 7320  -b') if zone is 
+00001ad0: 4e6f 6e65 2065 6c73 6520 7a6f 6e65 0a20  None else zone. 
+00001ae0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00001af0: 6567 696f 6e20 3d20 7365 6c66 2e6f 7074  egion = self.opt
+00001b00: 696f 6e73 2e67 6574 2827 7265 6769 6f6e  ions.get('region
+00001b10: 2729 2069 6620 7265 6769 6f6e 2069 7320  ') if region is 
+00001b20: 4e6f 6e65 2065 6c73 6520 7265 6769 6f6e  None else region
+00001b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001b40: 2072 6567 696f 6e20 3d20 7a6f 6e65 5b3a   region = zone[:
+00001b50: 2d32 5d20 6966 2072 6567 696f 6e20 6973  -2] if region is
+00001b60: 204e 6f6e 6520 656c 7365 2072 6567 696f   None else regio
+00001b70: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00001b80: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
+00001b90: 7669 6465 7273 2e67 6370 2069 6d70 6f72  viders.gcp impor
+00001ba0: 7420 4b67 6370 0a20 2020 2020 2020 2020  t Kgcp.         
+00001bb0: 2020 2020 2020 206b 203d 204b 6763 7028         k = Kgcp(
+00001bc0: 7072 6f6a 6563 742c 207a 6f6e 653d 7a6f  project, zone=zo
+00001bd0: 6e65 2c20 7265 6769 6f6e 3d72 6567 696f  ne, region=regio
+00001be0: 6e2c 2064 6562 7567 3d64 6562 7567 290a  n, debug=debug).
+00001bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c00: 7365 6c66 2e6f 7665 7272 6964 6573 2e75  self.overrides.u
+00001c10: 7064 6174 6528 7b27 7072 6f6a 6563 7427  pdate({'project'
+00001c20: 3a20 7072 6f6a 6563 747d 290a 2020 2020  : project}).    
+00001c30: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00001c40: 662e 7479 7065 203d 3d20 2761 7773 273a  f.type == 'aws':
+00001c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001c60: 2069 6620 6c65 6e28 7365 6c66 2e6f 7074   if len(self.opt
+00001c70: 696f 6e73 2920 3d3d 2031 3a0a 2020 2020  ions) == 1:.    
+00001c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c90: 686f 6d65 203d 206f 732e 656e 7669 726f  home = os.enviro
+00001ca0: 6e5b 2748 4f4d 4527 5d0a 2020 2020 2020  n['HOME'].      
+00001cb0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
+00001cc0: 6365 7373 5f6b 6579 5f69 642c 2061 6363  cess_key_id, acc
+00001cd0: 6573 735f 6b65 795f 7365 6372 6574 2c20  ess_key_secret, 
+00001ce0: 6b65 7970 6169 722c 2072 6567 696f 6e2c  keypair, region,
+00001cf0: 2073 6573 7369 6f6e 5f74 6f6b 656e 203d   session_token =
+00001d00: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
+00001d10: 652c 204e 6f6e 652c 204e 6f6e 650a 2020  e, None, None.  
+00001d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001d30: 2020 696d 706f 7274 2063 6f6e 6669 6770    import configp
+00001d40: 6172 7365 720a 2020 2020 2020 2020 2020  arser.          
+00001d50: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00001d60: 7061 7468 2e65 7869 7374 7328 6622 7b68  path.exists(f"{h
+00001d70: 6f6d 657d 2f2e 6177 732f 6372 6564 656e  ome}/.aws/creden
+00001d80: 7469 616c 7322 293a 0a20 2020 2020 2020  tials"):.       
+00001d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001da0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
 00001db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001dc0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00001dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001de0: 2063 7265 6463 6f6e 6669 6720 3d20 636f   credconfig = co
-00001df0: 6e66 6967 7061 7273 6572 2e43 6f6e 6669  nfigparser.Confi
-00001e00: 6750 6172 7365 7228 290a 2020 2020 2020  gParser().      
-00001e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001e20: 2020 2020 2020 6372 6564 636f 6e66 6967        credconfig
-00001e30: 2e72 6561 6428 6622 7b68 6f6d 657d 2f2e  .read(f"{home}/.
-00001e40: 6177 732f 6372 6564 656e 7469 616c 7322  aws/credentials"
-00001e50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00001e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00001e70: 2027 6465 6661 756c 7427 206e 6f74 2069   'default' not i
-00001e80: 6e20 6372 6564 636f 6e66 6967 3a0a 2020  n credconfig:.  
-00001e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ea0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00001eb0: 726f 7228 224d 6973 7369 6e67 2064 6566  ror("Missing def
-00001ec0: 6175 6c74 2073 6563 7469 6f6e 2069 6e20  ault section in 
-00001ed0: 7e2f 2e61 7773 2f63 7265 6465 6e74 6961  ~/.aws/credentia
-00001ee0: 6c73 2066 696c 652e 204c 6561 7669 6e67  ls file. Leaving
-00001ef0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00001dc0: 2020 6372 6564 636f 6e66 6967 203d 2063    credconfig = c
+00001dd0: 6f6e 6669 6770 6172 7365 722e 436f 6e66  onfigparser.Conf
+00001de0: 6967 5061 7273 6572 2829 0a20 2020 2020  igParser().     
+00001df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001e00: 2020 2020 2020 2063 7265 6463 6f6e 6669         credconfi
+00001e10: 672e 7265 6164 2866 227b 686f 6d65 7d2f  g.read(f"{home}/
+00001e20: 2e61 7773 2f63 7265 6465 6e74 6961 6c73  .aws/credentials
+00001e30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00001e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001e50: 6620 2764 6566 6175 6c74 2720 6e6f 7420  f 'default' not 
+00001e60: 696e 2063 7265 6463 6f6e 6669 673a 0a20  in credconfig:. 
+00001e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001e80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00001e90: 7272 6f72 2822 4d69 7373 696e 6720 6465  rror("Missing de
+00001ea0: 6661 756c 7420 7365 6374 696f 6e20 696e  fault section in
+00001eb0: 207e 2f2e 6177 732f 6372 6564 656e 7469   ~/.aws/credenti
+00001ec0: 616c 7320 6669 6c65 2e20 4c65 6176 696e  als file. Leavin
+00001ed0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+00001ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ef0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
 00001f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f10: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00001f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f30: 2020 2020 2020 2020 2020 2069 6620 2761             if 'a
-00001f40: 7773 5f61 6363 6573 735f 6b65 795f 6964  ws_access_key_id
-00001f50: 2720 696e 2063 7265 6463 6f6e 6669 675b  ' in credconfig[
-00001f60: 2764 6566 6175 6c74 275d 3a0a 2020 2020  'default']:.    
-00001f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f80: 2020 2020 2020 2020 2020 2020 6163 6365              acce
-00001f90: 7373 5f6b 6579 5f69 6420 3d20 6372 6564  ss_key_id = cred
-00001fa0: 636f 6e66 6967 5b27 6465 6661 756c 7427  config['default'
-00001fb0: 5d5b 2761 7773 5f61 6363 6573 735f 6b65  ]['aws_access_ke
-00001fc0: 795f 6964 275d 0a20 2020 2020 2020 2020  y_id'].         
-00001fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fe0: 2020 2069 6620 2761 7773 5f73 6563 7265     if 'aws_secre
-00001ff0: 745f 6163 6365 7373 5f6b 6579 2720 696e  t_access_key' in
-00002000: 2063 7265 6463 6f6e 6669 675b 2764 6566   credconfig['def
-00002010: 6175 6c74 275d 3a0a 2020 2020 2020 2020  ault']:.        
-00002020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002030: 2020 2020 2020 2020 6163 6365 7373 5f6b          access_k
-00002040: 6579 5f73 6563 7265 7420 3d20 6372 6564  ey_secret = cred
-00002050: 636f 6e66 6967 5b27 6465 6661 756c 7427  config['default'
-00002060: 5d5b 2761 7773 5f73 6563 7265 745f 6163  ]['aws_secret_ac
-00002070: 6365 7373 5f6b 6579 275d 0a20 2020 2020  cess_key'].     
+00001f10: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00001f20: 6177 735f 6163 6365 7373 5f6b 6579 5f69  aws_access_key_i
+00001f30: 6427 2069 6e20 6372 6564 636f 6e66 6967  d' in credconfig
+00001f40: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
+00001f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f60: 2020 2020 2020 2020 2020 2020 2061 6363               acc
+00001f70: 6573 735f 6b65 795f 6964 203d 2063 7265  ess_key_id = cre
+00001f80: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
+00001f90: 275d 5b27 6177 735f 6163 6365 7373 5f6b  ']['aws_access_k
+00001fa0: 6579 5f69 6427 5d0a 2020 2020 2020 2020  ey_id'].        
+00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001fc0: 2020 2020 6966 2027 6177 735f 7365 6372      if 'aws_secr
+00001fd0: 6574 5f61 6363 6573 735f 6b65 7927 2069  et_access_key' i
+00001fe0: 6e20 6372 6564 636f 6e66 6967 5b27 6465  n credconfig['de
+00001ff0: 6661 756c 7427 5d3a 0a20 2020 2020 2020  fault']:.       
+00002000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002010: 2020 2020 2020 2020 2061 6363 6573 735f           access_
+00002020: 6b65 795f 7365 6372 6574 203d 2063 7265  key_secret = cre
+00002030: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
+00002040: 275d 5b27 6177 735f 7365 6372 6574 5f61  ']['aws_secret_a
+00002050: 6363 6573 735f 6b65 7927 5d0a 2020 2020  ccess_key'].    
+00002060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002070: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
 00002080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002090: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-000020a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020b0: 2020 2020 2020 2065 7272 6f72 2822 436f         error("Co
-000020c0: 7564 6c6e 2774 2070 6172 7365 207e 2f2e  udln't parse ~/.
-000020d0: 6177 732f 6372 6564 656e 7469 616c 7320  aws/credentials 
-000020e0: 6669 6c65 2e20 4c65 6176 696e 6722 290a  file. Leaving").
-000020f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002100: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00002110: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00002120: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00002130: 732e 7061 7468 2e65 7869 7374 7328 6622  s.path.exists(f"
-00002140: 7b68 6f6d 657d 2f2e 6177 732f 636f 6e66  {home}/.aws/conf
-00002150: 6967 2229 3a0a 2020 2020 2020 2020 2020  ig"):.          
-00002160: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00002170: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00002180: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00002190: 6f6e 6663 6f6e 6669 6720 3d20 636f 6e66  onfconfig = conf
-000021a0: 6967 7061 7273 6572 2e43 6f6e 6669 6750  igparser.ConfigP
-000021b0: 6172 7365 7228 290a 2020 2020 2020 2020  arser().        
-000021c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021d0: 2020 2020 636f 6e66 636f 6e66 6967 2e72      confconfig.r
-000021e0: 6561 6428 6622 7b68 6f6d 657d 2f2e 6177  ead(f"{home}/.aw
-000021f0: 732f 636f 6e66 6967 2229 0a20 2020 2020  s/config").     
-00002200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002210: 2020 2020 2020 2069 6620 2764 6566 6175         if 'defau
-00002220: 6c74 2720 6e6f 7420 696e 2063 6f6e 6663  lt' not in confc
-00002230: 6f6e 6669 673a 0a20 2020 2020 2020 2020  onfig:.         
-00002240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002250: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-00002260: 7373 696e 6720 6465 6661 756c 7420 7365  ssing default se
-00002270: 6374 696f 6e20 696e 207e 2f2e 6177 732f  ction in ~/.aws/
-00002280: 636f 6e66 6967 2066 696c 652e 204c 6561  config file. Lea
-00002290: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
-000022a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022b0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000022c0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-000022d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000022e0: 6620 2761 7773 5f61 6363 6573 735f 6b65  f 'aws_access_ke
-000022f0: 795f 6964 2720 696e 2063 6f6e 6663 6f6e  y_id' in confcon
-00002300: 6669 675b 2764 6566 6175 6c74 275d 3a0a  fig['default']:.
-00002310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002330: 6163 6365 7373 5f6b 6579 5f69 6420 3d20  access_key_id = 
-00002340: 636f 6e66 636f 6e66 6967 5b27 6465 6661  confconfig['defa
-00002350: 756c 7427 5d5b 2761 7773 5f61 6363 6573  ult']['aws_acces
-00002360: 735f 6b65 795f 6964 275d 0a20 2020 2020  s_key_id'].     
-00002370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002380: 2020 2020 2020 2069 6620 2761 7773 5f73         if 'aws_s
-00002390: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
-000023a0: 2720 696e 2063 6f6e 6663 6f6e 6669 675b  ' in confconfig[
-000023b0: 2764 6566 6175 6c74 275d 3a0a 2020 2020  'default']:.    
-000023c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000023d0: 2020 2020 2020 2020 2020 2020 6163 6365              acce
-000023e0: 7373 5f6b 6579 5f73 6563 7265 7420 3d20  ss_key_secret = 
-000023f0: 636f 6e66 636f 6e66 6967 5b27 6465 6661  confconfig['defa
-00002400: 756c 7427 5d5b 2761 7773 5f73 6563 7265  ult']['aws_secre
-00002410: 745f 6163 6365 7373 5f6b 6579 275d 0a20  t_access_key']. 
-00002420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002430: 2020 2020 2020 2020 2020 2069 6620 2772             if 'r
-00002440: 6567 696f 6e27 2069 6e20 636f 6e66 636f  egion' in confco
-00002450: 6e66 6967 5b27 6465 6661 756c 7427 5d3a  nfig['default']:
-00002460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002480: 2072 6567 696f 6e20 3d20 636f 6e66 636f   region = confco
-00002490: 6e66 6967 5b27 6465 6661 756c 7427 5d5b  nfig['default'][
-000024a0: 2772 6567 696f 6e27 5d0a 2020 2020 2020  'region'].      
+00002090: 2020 2020 2020 2020 6572 726f 7228 2243          error("C
+000020a0: 6f75 646c 6e27 7420 7061 7273 6520 7e2f  oudln't parse ~/
+000020b0: 2e61 7773 2f63 7265 6465 6e74 6961 6c73  .aws/credentials
+000020c0: 2066 696c 652e 204c 6561 7669 6e67 2229   file. Leaving")
+000020d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000020e0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+000020f0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00002100: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00002110: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+00002120: 227b 686f 6d65 7d2f 2e61 7773 2f63 6f6e  "{home}/.aws/con
+00002130: 6669 6722 293a 0a20 2020 2020 2020 2020  fig"):.         
+00002140: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00002150: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00002160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002170: 636f 6e66 636f 6e66 6967 203d 2063 6f6e  confconfig = con
+00002180: 6669 6770 6172 7365 722e 436f 6e66 6967  figparser.Config
+00002190: 5061 7273 6572 2829 0a20 2020 2020 2020  Parser().       
+000021a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021b0: 2020 2020 2063 6f6e 6663 6f6e 6669 672e       confconfig.
+000021c0: 7265 6164 2866 227b 686f 6d65 7d2f 2e61  read(f"{home}/.a
+000021d0: 7773 2f63 6f6e 6669 6722 290a 2020 2020  ws/config").    
+000021e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021f0: 2020 2020 2020 2020 6966 2027 6465 6661          if 'defa
+00002200: 756c 7427 206e 6f74 2069 6e20 636f 6e66  ult' not in conf
+00002210: 636f 6e66 6967 3a0a 2020 2020 2020 2020  config:.        
+00002220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002230: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
+00002240: 6973 7369 6e67 2064 6566 6175 6c74 2073  issing default s
+00002250: 6563 7469 6f6e 2069 6e20 7e2f 2e61 7773  ection in ~/.aws
+00002260: 2f63 6f6e 6669 6720 6669 6c65 2e20 4c65  /config file. Le
+00002270: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
+00002280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002290: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+000022a0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+000022b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022c0: 6966 2027 6177 735f 6163 6365 7373 5f6b  if 'aws_access_k
+000022d0: 6579 5f69 6427 2069 6e20 636f 6e66 636f  ey_id' in confco
+000022e0: 6e66 6967 5b27 6465 6661 756c 7427 5d3a  nfig['default']:
+000022f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002310: 2061 6363 6573 735f 6b65 795f 6964 203d   access_key_id =
+00002320: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
+00002330: 6175 6c74 275d 5b27 6177 735f 6163 6365  ault']['aws_acce
+00002340: 7373 5f6b 6579 5f69 6427 5d0a 2020 2020  ss_key_id'].    
+00002350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002360: 2020 2020 2020 2020 6966 2027 6177 735f          if 'aws_
+00002370: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
+00002380: 7927 2069 6e20 636f 6e66 636f 6e66 6967  y' in confconfig
+00002390: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
+000023a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000023b0: 2020 2020 2020 2020 2020 2020 2061 6363               acc
+000023c0: 6573 735f 6b65 795f 7365 6372 6574 203d  ess_key_secret =
+000023d0: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
+000023e0: 6175 6c74 275d 5b27 6177 735f 7365 6372  ault']['aws_secr
+000023f0: 6574 5f61 6363 6573 735f 6b65 7927 5d0a  et_access_key'].
+00002400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002410: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00002420: 7265 6769 6f6e 2720 696e 2063 6f6e 6663  region' in confc
+00002430: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
+00002440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002460: 2020 7265 6769 6f6e 203d 2063 6f6e 6663    region = confc
+00002470: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
+00002480: 5b27 7265 6769 6f6e 275d 0a20 2020 2020  ['region'].     
+00002490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024a0: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
 000024b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024c0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-000024d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024e0: 2020 2020 2020 6572 726f 7228 2243 6f75        error("Cou
-000024f0: 646c 6e27 7420 7061 7273 6520 7e2f 2e61  dln't parse ~/.a
-00002500: 7773 2f63 6f6e 6669 6720 6669 6c65 2e20  ws/config file. 
-00002510: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
-00002520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002530: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00002540: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00002550: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00002560: 2020 2020 2020 2020 2020 2020 6163 6365              acce
-00002570: 7373 5f6b 6579 5f69 6420 3d20 7365 6c66  ss_key_id = self
-00002580: 2e6f 7074 696f 6e73 2e67 6574 2827 6163  .options.get('ac
-00002590: 6365 7373 5f6b 6579 5f69 6427 290a 2020  cess_key_id').  
-000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025b0: 2020 6163 6365 7373 5f6b 6579 5f73 6563    access_key_sec
-000025c0: 7265 7420 3d20 7365 6c66 2e6f 7074 696f  ret = self.optio
-000025d0: 6e73 2e67 6574 2827 6163 6365 7373 5f6b  ns.get('access_k
-000025e0: 6579 5f73 6563 7265 7427 290a 2020 2020  ey_secret').    
-000025f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002600: 6b65 7970 6169 7220 3d20 7365 6c66 2e6f  keypair = self.o
-00002610: 7074 696f 6e73 2e67 6574 2827 6b65 7970  ptions.get('keyp
-00002620: 6169 7227 290a 2020 2020 2020 2020 2020  air').          
-00002630: 2020 2020 2020 2020 2020 7365 7373 696f            sessio
-00002640: 6e5f 746f 6b65 6e20 3d20 7365 6c66 2e6f  n_token = self.o
-00002650: 7074 696f 6e73 2e67 6574 2827 7365 7373  ptions.get('sess
-00002660: 696f 6e5f 746f 6b65 6e27 290a 2020 2020  ion_token').    
-00002670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002680: 7265 6769 6f6e 203d 2073 656c 662e 6f70  region = self.op
-00002690: 7469 6f6e 732e 6765 7428 2772 6567 696f  tions.get('regio
-000026a0: 6e27 2920 6966 2072 6567 696f 6e20 6973  n') if region is
-000026b0: 204e 6f6e 6520 656c 7365 2072 6567 696f   None else regio
-000026c0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-000026d0: 2020 6966 2072 6567 696f 6e20 6973 204e    if region is N
-000026e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000026f0: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-00002700: 4d69 7373 696e 6720 7265 6769 6f6e 2069  Missing region i
-00002710: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
-00002720: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+000024c0: 2020 2020 2020 2065 7272 6f72 2822 436f         error("Co
+000024d0: 7564 6c6e 2774 2070 6172 7365 207e 2f2e  udln't parse ~/.
+000024e0: 6177 732f 636f 6e66 6967 2066 696c 652e  aws/config file.
+000024f0: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002510: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00002520: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00002530: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00002540: 2020 2020 2020 2020 2020 2020 2061 6363               acc
+00002550: 6573 735f 6b65 795f 6964 203d 2073 656c  ess_key_id = sel
+00002560: 662e 6f70 7469 6f6e 732e 6765 7428 2761  f.options.get('a
+00002570: 6363 6573 735f 6b65 795f 6964 2729 0a20  ccess_key_id'). 
+00002580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002590: 2020 2061 6363 6573 735f 6b65 795f 7365     access_key_se
+000025a0: 6372 6574 203d 2073 656c 662e 6f70 7469  cret = self.opti
+000025b0: 6f6e 732e 6765 7428 2761 6363 6573 735f  ons.get('access_
+000025c0: 6b65 795f 7365 6372 6574 2729 0a20 2020  key_secret').   
+000025d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025e0: 206b 6579 7061 6972 203d 2073 656c 662e   keypair = self.
+000025f0: 6f70 7469 6f6e 732e 6765 7428 276b 6579  options.get('key
+00002600: 7061 6972 2729 0a20 2020 2020 2020 2020  pair').         
+00002610: 2020 2020 2020 2020 2020 2073 6573 7369             sessi
+00002620: 6f6e 5f74 6f6b 656e 203d 2073 656c 662e  on_token = self.
+00002630: 6f70 7469 6f6e 732e 6765 7428 2773 6573  options.get('ses
+00002640: 7369 6f6e 5f74 6f6b 656e 2729 0a20 2020  sion_token').   
+00002650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002660: 2072 6567 696f 6e20 3d20 7365 6c66 2e6f   region = self.o
+00002670: 7074 696f 6e73 2e67 6574 2827 7265 6769  ptions.get('regi
+00002680: 6f6e 2729 2069 6620 7265 6769 6f6e 2069  on') if region i
+00002690: 7320 4e6f 6e65 2065 6c73 6520 7265 6769  s None else regi
+000026a0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+000026b0: 2020 2069 6620 7265 6769 6f6e 2069 7320     if region is 
+000026c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000026d0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+000026e0: 224d 6973 7369 6e67 2072 6567 696f 6e20  "Missing region 
+000026f0: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
+00002700: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
+00002710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002720: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
 00002730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002740: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00002750: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002760: 6620 6163 6365 7373 5f6b 6579 5f69 6420  f access_key_id 
-00002770: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00002780: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00002790: 6f72 2822 4d69 7373 696e 6720 6163 6365  or("Missing acce
-000027a0: 7373 5f6b 6579 5f69 6420 696e 2074 6865  ss_key_id in the
-000027b0: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
-000027c0: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
-000027d0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-000027e0: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-000027f0: 2020 2020 2020 2020 2020 6966 2061 6363            if acc
-00002800: 6573 735f 6b65 795f 7365 6372 6574 2069  ess_key_secret i
-00002810: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00002820: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00002830: 7228 224d 6973 7369 6e67 2061 6363 6573  r("Missing acces
-00002840: 735f 6b65 795f 7365 6372 6574 2069 6e20  s_key_secret in 
-00002850: 7468 6520 636f 6e66 6967 7572 6174 696f  the configuratio
-00002860: 6e2e 204c 6561 7669 6e67 2229 0a20 2020  n. Leaving").   
-00002870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002880: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-00002890: 2020 2020 2020 2020 2020 2020 2066 726f               fro
-000028a0: 6d20 6b76 6972 742e 7072 6f76 6964 6572  m kvirt.provider
-000028b0: 732e 6177 7320 696d 706f 7274 204b 6177  s.aws import Kaw
-000028c0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000028d0: 2020 6b20 3d20 4b61 7773 2861 6363 6573    k = Kaws(acces
-000028e0: 735f 6b65 795f 6964 3d61 6363 6573 735f  s_key_id=access_
-000028f0: 6b65 795f 6964 2c20 6163 6365 7373 5f6b  key_id, access_k
-00002900: 6579 5f73 6563 7265 743d 6163 6365 7373  ey_secret=access
-00002910: 5f6b 6579 5f73 6563 7265 742c 2072 6567  _key_secret, reg
-00002920: 696f 6e3d 7265 6769 6f6e 2c0a 2020 2020  ion=region,.    
-00002930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002940: 2020 2020 2064 6562 7567 3d64 6562 7567       debug=debug
-00002950: 2c20 6b65 7970 6169 723d 6b65 7970 6169  , keypair=keypai
-00002960: 722c 2073 6573 7369 6f6e 5f74 6f6b 656e  r, session_token
-00002970: 3d73 6573 7369 6f6e 5f74 6f6b 656e 290a  =session_token).
-00002980: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00002990: 2073 656c 662e 7479 7065 203d 3d20 2769   self.type == 'i
-000029a0: 626d 273a 0a20 2020 2020 2020 2020 2020  bm':.           
-000029b0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-000029c0: 2e6f 7074 696f 6e73 2920 3d3d 2031 3a0a  .options) == 1:.
-000029d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000029e0: 2020 2020 686f 6d65 203d 206f 732e 656e      home = os.en
-000029f0: 7669 726f 6e5b 2748 4f4d 4527 5d0a 2020  viron['HOME'].  
-00002a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a10: 2020 6961 6d5f 6170 695f 6b65 792c 2072    iam_api_key, r
-00002a20: 6567 696f 6e2c 207a 6f6e 652c 2076 7063  egion, zone, vpc
-00002a30: 203d 204e 6f6e 652c 204e 6f6e 652c 204e   = None, None, N
-00002a40: 6f6e 652c 204e 6f6e 650a 2020 2020 2020  one, None.      
-00002a50: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00002a60: 735f 6170 695f 6b65 792c 2063 6f73 5f72  s_api_key, cos_r
-00002a70: 6573 6f75 7263 655f 696e 7374 616e 6365  esource_instance
-00002a80: 5f69 642c 2063 6973 5f72 6573 6f75 7263  _id, cis_resourc
-00002a90: 655f 696e 7374 616e 6365 5f69 6420 3d20  e_instance_id = 
-00002aa0: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-00002ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ac0: 2020 2020 2069 6d70 6f72 7420 636f 6e66       import conf
-00002ad0: 6967 7061 7273 6572 0a20 2020 2020 2020  igparser.       
-00002ae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00002af0: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
-00002b00: 227b 686f 6d65 7d2f 2e69 626d 2f63 7265  "{home}/.ibm/cre
-00002b10: 6465 6e74 6961 6c73 2229 3a0a 2020 2020  dentials"):.    
+00002740: 6966 2061 6363 6573 735f 6b65 795f 6964  if access_key_id
+00002750: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00002760: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00002770: 726f 7228 224d 6973 7369 6e67 2061 6363  ror("Missing acc
+00002780: 6573 735f 6b65 795f 6964 2069 6e20 7468  ess_key_id in th
+00002790: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
+000027a0: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+000027b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000027c0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+000027d0: 2020 2020 2020 2020 2020 2069 6620 6163             if ac
+000027e0: 6365 7373 5f6b 6579 5f73 6563 7265 7420  cess_key_secret 
+000027f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00002800: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00002810: 6f72 2822 4d69 7373 696e 6720 6163 6365  or("Missing acce
+00002820: 7373 5f6b 6579 5f73 6563 7265 7420 696e  ss_key_secret in
+00002830: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
+00002840: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
+00002850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002860: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+00002870: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00002880: 6f6d 206b 7669 7274 2e70 726f 7669 6465  om kvirt.provide
+00002890: 7273 2e61 7773 2069 6d70 6f72 7420 4b61  rs.aws import Ka
+000028a0: 7773 0a20 2020 2020 2020 2020 2020 2020  ws.             
+000028b0: 2020 206b 203d 204b 6177 7328 6163 6365     k = Kaws(acce
+000028c0: 7373 5f6b 6579 5f69 643d 6163 6365 7373  ss_key_id=access
+000028d0: 5f6b 6579 5f69 642c 2061 6363 6573 735f  _key_id, access_
+000028e0: 6b65 795f 7365 6372 6574 3d61 6363 6573  key_secret=acces
+000028f0: 735f 6b65 795f 7365 6372 6574 2c20 7265  s_key_secret, re
+00002900: 6769 6f6e 3d72 6567 696f 6e2c 0a20 2020  gion=region,.   
+00002910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002920: 2020 2020 2020 6465 6275 673d 6465 6275        debug=debu
+00002930: 672c 206b 6579 7061 6972 3d6b 6579 7061  g, keypair=keypa
+00002940: 6972 2c20 7365 7373 696f 6e5f 746f 6b65  ir, session_toke
+00002950: 6e3d 7365 7373 696f 6e5f 746f 6b65 6e29  n=session_token)
+00002960: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00002970: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00002980: 6962 6d27 3a0a 2020 2020 2020 2020 2020  ibm':.          
+00002990: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+000029a0: 662e 6f70 7469 6f6e 7329 203d 3d20 313a  f.options) == 1:
+000029b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000029c0: 2020 2020 2068 6f6d 6520 3d20 6f73 2e65       home = os.e
+000029d0: 6e76 6972 6f6e 5b27 484f 4d45 275d 0a20  nviron['HOME']. 
+000029e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029f0: 2020 2069 616d 5f61 7069 5f6b 6579 2c20     iam_api_key, 
+00002a00: 7265 6769 6f6e 2c20 7a6f 6e65 2c20 7670  region, zone, vp
+00002a10: 6320 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  c = None, None, 
+00002a20: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+00002a30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002a40: 6f73 5f61 7069 5f6b 6579 2c20 636f 735f  os_api_key, cos_
+00002a50: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
+00002a60: 655f 6964 2c20 6369 735f 7265 736f 7572  e_id, cis_resour
+00002a70: 6365 5f69 6e73 7461 6e63 655f 6964 203d  ce_instance_id =
+00002a80: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
+00002a90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00002aa0: 2020 2020 2020 696d 706f 7274 2063 6f6e        import con
+00002ab0: 6669 6770 6172 7365 720a 2020 2020 2020  figparser.      
+00002ac0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00002ad0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00002ae0: 6622 7b68 6f6d 657d 2f2e 6962 6d2f 6372  f"{home}/.ibm/cr
+00002af0: 6564 656e 7469 616c 7322 293a 0a20 2020  edentials"):.   
+00002b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b10: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
 00002b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b30: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00002b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b50: 2020 2020 2063 7265 6463 6f6e 6669 6720       credconfig 
-00002b60: 3d20 636f 6e66 6967 7061 7273 6572 2e43  = configparser.C
-00002b70: 6f6e 6669 6750 6172 7365 7228 290a 2020  onfigParser().  
-00002b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b90: 2020 2020 2020 2020 2020 6372 6564 636f            credco
-00002ba0: 6e66 6967 2e72 6561 6428 6622 7b68 6f6d  nfig.read(f"{hom
-00002bb0: 657d 2f2e 6962 6d2f 6372 6564 656e 7469  e}/.ibm/credenti
-00002bc0: 616c 7322 290a 2020 2020 2020 2020 2020  als").          
-00002bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002be0: 2020 6966 2027 6465 6661 756c 7427 206e    if 'default' n
-00002bf0: 6f74 2069 6e20 6372 6564 636f 6e66 6967  ot in credconfig
-00002c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002b30: 2020 2020 2020 6372 6564 636f 6e66 6967        credconfig
+00002b40: 203d 2063 6f6e 6669 6770 6172 7365 722e   = configparser.
+00002b50: 436f 6e66 6967 5061 7273 6572 2829 0a20  ConfigParser(). 
+00002b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b70: 2020 2020 2020 2020 2020 2063 7265 6463             credc
+00002b80: 6f6e 6669 672e 7265 6164 2866 227b 686f  onfig.read(f"{ho
+00002b90: 6d65 7d2f 2e69 626d 2f63 7265 6465 6e74  me}/.ibm/credent
+00002ba0: 6961 6c73 2229 0a20 2020 2020 2020 2020  ials").         
+00002bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bc0: 2020 2069 6620 2764 6566 6175 6c74 2720     if 'default' 
+00002bd0: 6e6f 7420 696e 2063 7265 6463 6f6e 6669  not in credconfi
+00002be0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+00002bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c00: 2020 2065 7272 6f72 280a 2020 2020 2020     error(.      
 00002c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c20: 2020 6572 726f 7228 0a20 2020 2020 2020    error(.       
-00002c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c40: 2020 2020 2020 2020 2020 2020 2022 4d69               "Mi
-00002c50: 7373 696e 6720 6465 6661 756c 7420 7365  ssing default se
-00002c60: 6374 696f 6e20 696e 207e 2f2e 6962 6d2f  ction in ~/.ibm/
-00002c70: 6372 6564 656e 7469 616c 7320 6669 6c65  credentials file
-00002c80: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
-00002c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ca0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00002cb0: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cd0: 2020 2020 6966 2027 6961 6d5f 6170 695f      if 'iam_api_
-00002ce0: 6b65 7927 2069 6e20 6372 6564 636f 6e66  key' in credconf
-00002cf0: 6967 5b27 6465 6661 756c 7427 5d3a 0a20  ig['default']:. 
-00002d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002d20: 616d 5f61 7069 5f6b 6579 203d 2063 7265  am_api_key = cre
-00002d30: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
-00002d40: 275d 5b27 6961 6d5f 6170 695f 6b65 7927  ']['iam_api_key'
-00002d50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00002d60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00002d70: 2027 6163 6365 7373 5f6b 6579 5f69 6427   'access_key_id'
-00002d80: 2069 6e20 6372 6564 636f 6e66 6967 5b27   in credconfig['
-00002d90: 6465 6661 756c 7427 5d3a 0a20 2020 2020  default']:.     
-00002da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002db0: 2020 2020 2020 2020 2020 2063 6f73 5f61             cos_a
-00002dc0: 7069 5f6b 6579 203d 2063 7265 6463 6f6e  pi_key = credcon
-00002dd0: 6669 675b 2764 6566 6175 6c74 275d 5b27  fig['default']['
-00002de0: 6163 6365 7373 5f6b 6579 5f69 6427 5d0a  access_key_id'].
-00002df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e00: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00002e10: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
-00002e20: 7927 2069 6e20 6372 6564 636f 6e66 6967  y' in credconfig
-00002e30: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
-00002e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e50: 2020 2020 2020 2020 2020 2020 2063 6f73               cos
-00002e60: 5f72 6573 6f75 7263 655f 696e 7374 616e  _resource_instan
-00002e70: 6365 5f69 6420 3d20 6372 6564 636f 6e66  ce_id = credconf
-00002e80: 6967 5b27 6465 6661 756c 7427 5d5b 2773  ig['default']['s
-00002e90: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
-00002ea0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00002eb0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00002ec0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00002ed0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002ee0: 7272 6f72 2822 436f 7564 6c6e 2774 2070  rror("Coudln't p
-00002ef0: 6172 7365 207e 2f2e 6962 6d2f 6372 6564  arse ~/.ibm/cred
-00002f00: 656e 7469 616c 7320 6669 6c65 2e20 4c65  entials file. Le
-00002f10: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
-00002f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f30: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-00002f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f50: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00002f60: 7869 7374 7328 6622 7b68 6f6d 657d 2f2e  xists(f"{home}/.
-00002f70: 6962 6d2f 636f 6e66 6967 2229 3a0a 2020  ibm/config"):.  
+00002c20: 2020 2020 2020 2020 2020 2020 2020 224d                "M
+00002c30: 6973 7369 6e67 2064 6566 6175 6c74 2073  issing default s
+00002c40: 6563 7469 6f6e 2069 6e20 7e2f 2e69 626d  ection in ~/.ibm
+00002c50: 2f63 7265 6465 6e74 6961 6c73 2066 696c  /credentials fil
+00002c60: 652e 204c 6561 7669 6e67 2229 0a20 2020  e. Leaving").   
+00002c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c80: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00002c90: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00002ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002cb0: 2020 2020 2069 6620 2769 616d 5f61 7069       if 'iam_api
+00002cc0: 5f6b 6579 2720 696e 2063 7265 6463 6f6e  _key' in credcon
+00002cd0: 6669 675b 2764 6566 6175 6c74 275d 3a0a  fig['default']:.
+00002ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d00: 6961 6d5f 6170 695f 6b65 7920 3d20 6372  iam_api_key = cr
+00002d10: 6564 636f 6e66 6967 5b27 6465 6661 756c  edconfig['defaul
+00002d20: 7427 5d5b 2769 616d 5f61 7069 5f6b 6579  t']['iam_api_key
+00002d30: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00002d40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00002d50: 6620 2761 6363 6573 735f 6b65 795f 6964  f 'access_key_id
+00002d60: 2720 696e 2063 7265 6463 6f6e 6669 675b  ' in credconfig[
+00002d70: 2764 6566 6175 6c74 275d 3a0a 2020 2020  'default']:.    
+00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d90: 2020 2020 2020 2020 2020 2020 636f 735f              cos_
+00002da0: 6170 695f 6b65 7920 3d20 6372 6564 636f  api_key = credco
+00002db0: 6e66 6967 5b27 6465 6661 756c 7427 5d5b  nfig['default'][
+00002dc0: 2761 6363 6573 735f 6b65 795f 6964 275d  'access_key_id']
+00002dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002de0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00002df0: 2773 6563 7265 745f 6163 6365 7373 5f6b  'secret_access_k
+00002e00: 6579 2720 696e 2063 7265 6463 6f6e 6669  ey' in credconfi
+00002e10: 675b 2764 6566 6175 6c74 275d 3a0a 2020  g['default']:.  
+00002e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e30: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00002e40: 735f 7265 736f 7572 6365 5f69 6e73 7461  s_resource_insta
+00002e50: 6e63 655f 6964 203d 2063 7265 6463 6f6e  nce_id = credcon
+00002e60: 6669 675b 2764 6566 6175 6c74 275d 5b27  fig['default']['
+00002e70: 7365 6372 6574 5f61 6363 6573 735f 6b65  secret_access_ke
+00002e80: 7927 5d0a 2020 2020 2020 2020 2020 2020  y'].            
+00002e90: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00002ea0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00002eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ec0: 6572 726f 7228 2243 6f75 646c 6e27 7420  error("Coudln't 
+00002ed0: 7061 7273 6520 7e2f 2e69 626d 2f63 7265  parse ~/.ibm/cre
+00002ee0: 6465 6e74 6961 6c73 2066 696c 652e 204c  dentials file. L
+00002ef0: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+00002f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f10: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+00002f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002f30: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00002f40: 6578 6973 7473 2866 227b 686f 6d65 7d2f  exists(f"{home}/
+00002f50: 2e69 626d 2f63 6f6e 6669 6722 293a 0a20  .ibm/config"):. 
+00002f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
 00002f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f90: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00002fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fb0: 2020 2020 2020 2063 6f6e 6663 6f6e 6669         confconfi
-00002fc0: 6720 3d20 636f 6e66 6967 7061 7273 6572  g = configparser
-00002fd0: 2e43 6f6e 6669 6750 6172 7365 7228 290a  .ConfigParser().
-00002fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ff0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00003000: 636f 6e66 6967 2e72 6561 6428 6622 7b68  config.read(f"{h
-00003010: 6f6d 657d 2f2e 6962 6d2f 636f 6e66 6967  ome}/.ibm/config
-00003020: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00003030: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00003040: 6620 2764 6566 6175 6c74 2720 6e6f 7420  f 'default' not 
-00003050: 696e 2063 6f6e 6663 6f6e 6669 673a 0a20  in confconfig:. 
-00003060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003070: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00003080: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00003090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030a0: 2020 2020 2020 2020 2020 224d 6973 7369            "Missi
-000030b0: 6e67 2064 6566 6175 6c74 2073 6563 7469  ng default secti
-000030c0: 6f6e 2069 6e20 7e2f 2e69 626d 2f63 6f6e  on in ~/.ibm/con
-000030d0: 6669 6720 6669 6c65 2e20 4c65 6176 696e  fig file. Leavin
-000030e0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-000030f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003100: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-00003110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003120: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00003130: 6961 6d5f 6170 695f 6b65 7927 2069 6e20  iam_api_key' in 
-00003140: 636f 6e66 636f 6e66 6967 5b27 6465 6661  confconfig['defa
-00003150: 756c 7427 5d3a 0a20 2020 2020 2020 2020  ult']:.         
-00003160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003170: 2020 2020 2020 2069 616d 5f61 7069 5f6b         iam_api_k
-00003180: 6579 203d 2063 6f6e 6663 6f6e 6669 675b  ey = confconfig[
-00003190: 2764 6566 6175 6c74 275d 5b27 6961 6d5f  'default']['iam_
-000031a0: 6170 695f 6b65 7927 5d0a 2020 2020 2020  api_key'].      
-000031b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000031c0: 2020 2020 2020 6966 2027 6163 6365 7373        if 'access
-000031d0: 5f6b 6579 5f69 6427 2069 6e20 636f 6e66  _key_id' in conf
-000031e0: 636f 6e66 6967 5b27 6465 6661 756c 7427  config['default'
-000031f0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00003200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003210: 2020 2063 6f73 5f61 7069 5f6b 6579 203d     cos_api_key =
-00003220: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
-00003230: 6175 6c74 275d 5b27 6163 6365 7373 5f6b  ault']['access_k
-00003240: 6579 5f69 6427 5d0a 2020 2020 2020 2020  ey_id'].        
-00003250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003260: 2020 2020 6966 2027 7365 6372 6574 5f61      if 'secret_a
-00003270: 6363 6573 735f 6b65 7927 2069 6e20 636f  ccess_key' in co
-00003280: 6e66 636f 6e66 6967 5b27 6465 6661 756c  nfconfig['defaul
-00003290: 7427 5d3a 0a20 2020 2020 2020 2020 2020  t']:.           
-000032a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000032b0: 2020 2020 2063 6f73 5f72 6573 6f75 7263       cos_resourc
-000032c0: 655f 696e 7374 616e 6365 5f69 6420 3d20  e_instance_id = 
-000032d0: 636f 6e66 636f 6e66 6967 5b27 6465 6661  confconfig['defa
-000032e0: 756c 7427 5d5b 2773 6563 7265 745f 6163  ult']['secret_ac
-000032f0: 6365 7373 5f6b 6579 275d 0a20 2020 2020  cess_key'].     
-00003300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003310: 2020 2020 2020 2069 6620 2772 6567 696f         if 'regio
-00003320: 6e27 2069 6e20 636f 6e66 636f 6e66 6967  n' in confconfig
-00003330: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
-00003340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003350: 2020 2020 2020 2020 2020 2020 2072 6567               reg
-00003360: 696f 6e20 3d20 636f 6e66 636f 6e66 6967  ion = confconfig
-00003370: 5b27 6465 6661 756c 7427 5d5b 2772 6567  ['default']['reg
-00003380: 696f 6e27 5d0a 2020 2020 2020 2020 2020  ion'].          
-00003390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033a0: 2020 6966 2027 7a6f 6e65 2720 696e 2063    if 'zone' in c
-000033b0: 6f6e 6663 6f6e 6669 675b 2764 6566 6175  onfconfig['defau
-000033c0: 6c74 275d 3a0a 2020 2020 2020 2020 2020  lt']:.          
-000033d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033e0: 2020 2020 2020 7a6f 6e65 203d 2063 6f6e        zone = con
-000033f0: 6663 6f6e 6669 675b 2764 6566 6175 6c74  fconfig['default
-00003400: 275d 5b27 7a6f 6e65 275d 0a20 2020 2020  ']['zone'].     
-00003410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003420: 2020 2020 2020 2069 6620 2776 7063 2720         if 'vpc' 
-00003430: 696e 2063 6f6e 6663 6f6e 6669 675b 2764  in confconfig['d
-00003440: 6566 6175 6c74 275d 3a0a 2020 2020 2020  efault']:.      
-00003450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003460: 2020 2020 2020 2020 2020 7a6f 6e65 203d            zone =
-00003470: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
-00003480: 6175 6c74 275d 5b27 7670 6327 5d0a 2020  ault']['vpc'].  
+00002f90: 2020 2020 2020 2020 636f 6e66 636f 6e66          confconf
+00002fa0: 6967 203d 2063 6f6e 6669 6770 6172 7365  ig = configparse
+00002fb0: 722e 436f 6e66 6967 5061 7273 6572 2829  r.ConfigParser()
+00002fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002fd0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00002fe0: 6663 6f6e 6669 672e 7265 6164 2866 227b  fconfig.read(f"{
+00002ff0: 686f 6d65 7d2f 2e69 626d 2f63 6f6e 6669  home}/.ibm/confi
+00003000: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+00003010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003020: 6966 2027 6465 6661 756c 7427 206e 6f74  if 'default' not
+00003030: 2069 6e20 636f 6e66 636f 6e66 6967 3a0a   in confconfig:.
+00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003060: 6572 726f 7228 0a20 2020 2020 2020 2020  error(.         
+00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003080: 2020 2020 2020 2020 2020 2022 4d69 7373             "Miss
+00003090: 696e 6720 6465 6661 756c 7420 7365 6374  ing default sect
+000030a0: 696f 6e20 696e 207e 2f2e 6962 6d2f 636f  ion in ~/.ibm/co
+000030b0: 6e66 6967 2066 696c 652e 204c 6561 7669  nfig file. Leavi
+000030c0: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+000030d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000030e0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+000030f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003100: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00003110: 2769 616d 5f61 7069 5f6b 6579 2720 696e  'iam_api_key' in
+00003120: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
+00003130: 6175 6c74 275d 3a0a 2020 2020 2020 2020  ault']:.        
+00003140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003150: 2020 2020 2020 2020 6961 6d5f 6170 695f          iam_api_
+00003160: 6b65 7920 3d20 636f 6e66 636f 6e66 6967  key = confconfig
+00003170: 5b27 6465 6661 756c 7427 5d5b 2769 616d  ['default']['iam
+00003180: 5f61 7069 5f6b 6579 275d 0a20 2020 2020  _api_key'].     
+00003190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031a0: 2020 2020 2020 2069 6620 2761 6363 6573         if 'acces
+000031b0: 735f 6b65 795f 6964 2720 696e 2063 6f6e  s_key_id' in con
+000031c0: 6663 6f6e 6669 675b 2764 6566 6175 6c74  fconfig['default
+000031d0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+000031e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031f0: 2020 2020 636f 735f 6170 695f 6b65 7920      cos_api_key 
+00003200: 3d20 636f 6e66 636f 6e66 6967 5b27 6465  = confconfig['de
+00003210: 6661 756c 7427 5d5b 2761 6363 6573 735f  fault']['access_
+00003220: 6b65 795f 6964 275d 0a20 2020 2020 2020  key_id'].       
+00003230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003240: 2020 2020 2069 6620 2773 6563 7265 745f       if 'secret_
+00003250: 6163 6365 7373 5f6b 6579 2720 696e 2063  access_key' in c
+00003260: 6f6e 6663 6f6e 6669 675b 2764 6566 6175  onfconfig['defau
+00003270: 6c74 275d 3a0a 2020 2020 2020 2020 2020  lt']:.          
+00003280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003290: 2020 2020 2020 636f 735f 7265 736f 7572        cos_resour
+000032a0: 6365 5f69 6e73 7461 6e63 655f 6964 203d  ce_instance_id =
+000032b0: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
+000032c0: 6175 6c74 275d 5b27 7365 6372 6574 5f61  ault']['secret_a
+000032d0: 6363 6573 735f 6b65 7927 5d0a 2020 2020  ccess_key'].    
+000032e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032f0: 2020 2020 2020 2020 6966 2027 7265 6769          if 'regi
+00003300: 6f6e 2720 696e 2063 6f6e 6663 6f6e 6669  on' in confconfi
+00003310: 675b 2764 6566 6175 6c74 275d 3a0a 2020  g['default']:.  
+00003320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003330: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00003340: 6769 6f6e 203d 2063 6f6e 6663 6f6e 6669  gion = confconfi
+00003350: 675b 2764 6566 6175 6c74 275d 5b27 7265  g['default']['re
+00003360: 6769 6f6e 275d 0a20 2020 2020 2020 2020  gion'].         
+00003370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003380: 2020 2069 6620 277a 6f6e 6527 2069 6e20     if 'zone' in 
+00003390: 636f 6e66 636f 6e66 6967 5b27 6465 6661  confconfig['defa
+000033a0: 756c 7427 5d3a 0a20 2020 2020 2020 2020  ult']:.         
+000033b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000033c0: 2020 2020 2020 207a 6f6e 6520 3d20 636f         zone = co
+000033d0: 6e66 636f 6e66 6967 5b27 6465 6661 756c  nfconfig['defaul
+000033e0: 7427 5d5b 277a 6f6e 6527 5d0a 2020 2020  t']['zone'].    
+000033f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003400: 2020 2020 2020 2020 6966 2027 7670 6327          if 'vpc'
+00003410: 2069 6e20 636f 6e66 636f 6e66 6967 5b27   in confconfig['
+00003420: 6465 6661 756c 7427 5d3a 0a20 2020 2020  default']:.     
+00003430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003440: 2020 2020 2020 2020 2020 207a 6f6e 6520             zone 
+00003450: 3d20 636f 6e66 636f 6e66 6967 5b27 6465  = confconfig['de
+00003460: 6661 756c 7427 5d5b 2776 7063 275d 0a20  fault']['vpc']. 
+00003470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003480: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
 00003490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000034a0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-000034b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000034c0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-000034d0: 2243 6f75 646c 6e27 7420 7061 7273 6520  "Coudln't parse 
-000034e0: 7e2f 2e69 626d 2f63 6f6e 6669 6720 6669  ~/.ibm/config fi
-000034f0: 6c65 2e20 4c65 6176 696e 6722 290a 2020  le. Leaving").  
-00003500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003510: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00003520: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-00003530: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00003540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003550: 6961 6d5f 6170 695f 6b65 7920 3d20 7365  iam_api_key = se
-00003560: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00003570: 6961 6d5f 6170 695f 6b65 7927 290a 2020  iam_api_key').  
-00003580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003590: 2020 636f 735f 6170 695f 6b65 7920 3d20    cos_api_key = 
-000035a0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-000035b0: 2827 636f 735f 6170 695f 6b65 7927 290a  ('cos_api_key').
-000035c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035d0: 2020 2020 636f 735f 7265 736f 7572 6365      cos_resource
-000035e0: 5f69 6e73 7461 6e63 655f 6964 203d 2073  _instance_id = s
-000035f0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00003600: 2763 6f73 5f72 6573 6f75 7263 655f 696e  'cos_resource_in
-00003610: 7374 616e 6365 5f69 6427 290a 2020 2020  stance_id').    
-00003620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003630: 6369 735f 7265 736f 7572 6365 5f69 6e73  cis_resource_ins
-00003640: 7461 6e63 655f 6964 203d 2073 656c 662e  tance_id = self.
-00003650: 6f70 7469 6f6e 732e 6765 7428 2763 6973  options.get('cis
-00003660: 5f72 6573 6f75 7263 655f 696e 7374 616e  _resource_instan
-00003670: 6365 5f69 6427 290a 2020 2020 2020 2020  ce_id').        
-00003680: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-00003690: 6f6e 203d 2073 656c 662e 6f70 7469 6f6e  on = self.option
-000036a0: 732e 6765 7428 2772 6567 696f 6e27 2920  s.get('region') 
-000036b0: 6966 2072 6567 696f 6e20 6973 204e 6f6e  if region is Non
-000036c0: 6520 656c 7365 2072 6567 696f 6e0a 2020  e else region.  
-000036d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036e0: 2020 7a6f 6e65 203d 2073 656c 662e 6f70    zone = self.op
-000036f0: 7469 6f6e 732e 6765 7428 277a 6f6e 6527  tions.get('zone'
-00003700: 2920 6966 207a 6f6e 6520 6973 204e 6f6e  ) if zone is Non
-00003710: 6520 656c 7365 207a 6f6e 650a 2020 2020  e else zone.    
-00003720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003730: 7670 6320 3d20 7365 6c66 2e6f 7074 696f  vpc = self.optio
-00003740: 6e73 2e67 6574 2827 7670 6327 290a 2020  ns.get('vpc').  
-00003750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003760: 2069 616d 5f61 7069 5f6b 6579 2069 7320   iam_api_key is 
-00003770: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00003780: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00003790: 224d 6973 7369 6e67 2069 616d 5f61 7069  "Missing iam_api
-000037a0: 5f6b 6579 2069 6e20 7468 6520 636f 6e66  _key in the conf
-000037b0: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
-000037c0: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-000037d0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-000037e0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-000037f0: 2020 2020 2069 6620 7265 6769 6f6e 2069       if region i
-00003800: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00003810: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00003820: 7228 224d 6973 7369 6e67 2072 6567 696f  r("Missing regio
-00003830: 6e20 696e 2074 6865 2063 6f6e 6669 6775  n in the configu
-00003840: 7261 7469 6f6e 2e20 4c65 6176 696e 6722  ration. Leaving"
-00003850: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003860: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00003870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003880: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
-00003890: 7669 6465 7273 2e69 626d 2069 6d70 6f72  viders.ibm impor
-000038a0: 7420 4b69 626d 0a20 2020 2020 2020 2020  t Kibm.         
-000038b0: 2020 2020 2020 206b 203d 204b 6962 6d28         k = Kibm(
-000038c0: 6961 6d5f 6170 695f 6b65 793d 6961 6d5f  iam_api_key=iam_
-000038d0: 6170 695f 6b65 792c 2072 6567 696f 6e3d  api_key, region=
-000038e0: 7265 6769 6f6e 2c20 7a6f 6e65 3d7a 6f6e  region, zone=zon
-000038f0: 652c 2076 7063 3d76 7063 2c20 6465 6275  e, vpc=vpc, debu
-00003900: 673d 6465 6275 672c 0a20 2020 2020 2020  g=debug,.       
-00003910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003920: 2020 636f 735f 6170 695f 6b65 793d 636f    cos_api_key=co
-00003930: 735f 6170 695f 6b65 792c 2063 6f73 5f72  s_api_key, cos_r
-00003940: 6573 6f75 7263 655f 696e 7374 616e 6365  esource_instance
-00003950: 5f69 643d 636f 735f 7265 736f 7572 6365  _id=cos_resource
-00003960: 5f69 6e73 7461 6e63 655f 6964 2c0a 2020  _instance_id,.  
-00003970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003980: 2020 2020 2020 2063 6973 5f72 6573 6f75         cis_resou
-00003990: 7263 655f 696e 7374 616e 6365 5f69 643d  rce_instance_id=
-000039a0: 6369 735f 7265 736f 7572 6365 5f69 6e73  cis_resource_ins
-000039b0: 7461 6e63 655f 6964 290a 2020 2020 2020  tance_id).      
-000039c0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-000039d0: 7479 7065 203d 3d20 276f 7669 7274 273a  type == 'ovirt':
-000039e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000039f0: 2064 6174 6163 656e 7465 7220 3d20 7365   datacenter = se
-00003a00: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00003a10: 6461 7461 6365 6e74 6572 272c 2027 4465  datacenter', 'De
-00003a20: 6661 756c 7427 290a 2020 2020 2020 2020  fault').        
-00003a30: 2020 2020 2020 2020 636c 7573 7465 7220          cluster 
-00003a40: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00003a50: 6574 2827 636c 7573 7465 7227 2c20 2744  et('cluster', 'D
-00003a60: 6566 6175 6c74 2729 0a20 2020 2020 2020  efault').       
-00003a70: 2020 2020 2020 2020 2075 7365 7220 3d20           user = 
-00003a80: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00003a90: 2827 7573 6572 272c 2027 6164 6d69 6e40  ('user', 'admin@
-00003aa0: 696e 7465 726e 616c 2729 0a20 2020 2020  internal').     
-00003ab0: 2020 2020 2020 2020 2020 2070 6173 7377             passw
-00003ac0: 6f72 6420 3d20 7365 6c66 2e6f 7074 696f  ord = self.optio
-00003ad0: 6e73 2e67 6574 2827 7061 7373 776f 7264  ns.get('password
-00003ae0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00003af0: 2020 2069 6620 7061 7373 776f 7264 2069     if password i
-00003b00: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00003b10: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00003b20: 7228 224d 6973 7369 6e67 2070 6173 7377  r("Missing passw
-00003b30: 6f72 6420 696e 2074 6865 2063 6f6e 6669  ord in the confi
-00003b40: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
-00003b50: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-00003b60: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00003b70: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00003b80: 2020 2020 6f72 6720 3d20 7365 6c66 2e6f      org = self.o
-00003b90: 7074 696f 6e73 2e67 6574 2827 6f72 6727  ptions.get('org'
-00003ba0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003bb0: 2020 6966 206f 7267 2069 7320 4e6f 6e65    if org is None
-00003bc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003bd0: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-00003be0: 7369 6e67 206f 7267 2069 6e20 7468 6520  sing org in the 
-00003bf0: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
-00003c00: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
-00003c10: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00003c20: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00003c30: 2020 2020 2020 2020 2063 615f 6669 6c65           ca_file
-00003c40: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00003c50: 6765 7428 2763 615f 6669 6c65 2729 0a20  get('ca_file'). 
-00003c60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00003c70: 6620 6361 5f66 696c 6520 6973 204e 6f6e  f ca_file is Non
-00003c80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003c90: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-00003ca0: 7373 696e 6720 6361 5f66 696c 6520 696e  ssing ca_file in
-00003cb0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00003cc0: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
-00003cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ce0: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00003cf0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00003d00: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
-00003d10: 6578 7061 6e64 7573 6572 2863 615f 6669  expanduser(ca_fi
-00003d20: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00003d30: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00003d40: 7468 2e65 7869 7374 7328 6361 5f66 696c  th.exists(ca_fil
-00003d50: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00003d60: 2020 2020 2020 2020 6572 726f 7228 2243          error("C
-00003d70: 6120 6669 6c65 2070 6174 6820 646f 6573  a file path does
-00003d80: 6e27 7420 6578 6973 742e 204c 6561 7669  n't exist. Leavi
-00003d90: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00003da0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00003db0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00003dc0: 2020 2020 2066 696c 7465 7276 6d73 203d       filtervms =
-00003dd0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00003de0: 7428 2766 696c 7465 7276 6d73 272c 2046  t('filtervms', F
-00003df0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00003e00: 2020 2020 2020 6669 6c74 6572 7573 6572        filteruser
-00003e10: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00003e20: 6765 7428 2766 696c 7465 7275 7365 7227  get('filteruser'
-00003e30: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-00003e40: 2020 2020 2020 2020 2066 696c 7465 7274           filtert
-00003e50: 6167 203d 2073 656c 662e 6f70 7469 6f6e  ag = self.option
-00003e60: 732e 6765 7428 2766 696c 7465 7274 6167  s.get('filtertag
-00003e70: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00003e80: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
-00003e90: 6f76 6964 6572 732e 6f76 6972 7420 696d  oviders.ovirt im
-00003ea0: 706f 7274 204b 4f76 6972 740a 2020 2020  port KOvirt.    
-00003eb0: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
-00003ec0: 4b4f 7669 7274 2868 6f73 743d 7365 6c66  KOvirt(host=self
-00003ed0: 2e68 6f73 742c 2070 6f72 743d 7365 6c66  .host, port=self
-00003ee0: 2e70 6f72 742c 2075 7365 723d 7573 6572  .port, user=user
-00003ef0: 2c20 7061 7373 776f 7264 3d70 6173 7377  , password=passw
-00003f00: 6f72 642c 0a20 2020 2020 2020 2020 2020  ord,.           
-00003f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f20: 6465 6275 673d 6465 6275 672c 2064 6174  debug=debug, dat
-00003f30: 6163 656e 7465 723d 6461 7461 6365 6e74  acenter=datacent
-00003f40: 6572 2c20 636c 7573 7465 723d 636c 7573  er, cluster=clus
-00003f50: 7465 722c 2063 615f 6669 6c65 3d63 615f  ter, ca_file=ca_
-00003f60: 6669 6c65 2c20 6f72 673d 6f72 672c 0a20  file, org=org,. 
-00003f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f80: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00003f90: 766d 733d 6669 6c74 6572 766d 732c 2066  vms=filtervms, f
-00003fa0: 696c 7465 7275 7365 723d 6669 6c74 6572  ilteruser=filter
-00003fb0: 7573 6572 2c20 6669 6c74 6572 7461 673d  user, filtertag=
-00003fc0: 6669 6c74 6572 7461 6729 0a20 2020 2020  filtertag).     
-00003fd0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00003fe0: 2e74 7970 6520 3d3d 2027 6f70 656e 7374  .type == 'openst
-00003ff0: 6163 6b27 3a0a 2020 2020 2020 2020 2020  ack':.          
-00004000: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
-00004010: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00004020: 2827 7665 7273 696f 6e27 2c20 2732 2729  ('version', '2')
-00004030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004040: 2064 6f6d 6169 6e20 3d20 6e65 7874 2828   domain = next((
-00004050: 6520 666f 7220 6520 696e 205b 7365 6c66  e for e in [self
-00004060: 2e6f 7074 696f 6e73 2e67 6574 2827 646f  .options.get('do
-00004070: 6d61 696e 2729 2c0a 2020 2020 2020 2020  main'),.        
-00004080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000040a0: 2020 206f 732e 656e 7669 726f 6e2e 6765     os.environ.ge
-000040b0: 7428 224f 535f 5553 4552 5f44 4f4d 4149  t("OS_USER_DOMAI
-000040c0: 4e5f 4e41 4d45 2229 5d20 6966 2065 2069  N_NAME")] if e i
-000040d0: 7320 6e6f 7420 4e6f 6e65 292c 2027 4465  s not None), 'De
-000040e0: 6661 756c 7427 290a 2020 2020 2020 2020  fault').        
-000040f0: 2020 2020 2020 2020 6175 7468 5f75 726c          auth_url
-00004100: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
-00004110: 2069 6e20 5b73 656c 662e 6f70 7469 6f6e   in [self.option
-00004120: 732e 6765 7428 2761 7574 685f 7572 6c27  s.get('auth_url'
-00004130: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00004140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004160: 6f73 2e65 6e76 6972 6f6e 2e67 6574 2822  os.environ.get("
-00004170: 4f53 5f41 5554 485f 5552 4c22 295d 2069  OS_AUTH_URL")] i
-00004180: 6620 6520 6973 206e 6f74 204e 6f6e 6529  f e is not None)
-00004190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000041a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041b0: 2020 4e6f 6e65 290a 2020 2020 2020 2020    None).        
-000041c0: 2020 2020 2020 2020 6966 2061 7574 685f          if auth_
-000041d0: 7572 6c20 6973 204e 6f6e 653a 0a20 2020  url is None:.   
-000041e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041f0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
-00004200: 6175 7468 5f75 726c 2069 6e20 7468 6520  auth_url in the 
-00004210: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
-00004220: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
-00004230: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00004240: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00004250: 2020 2020 2020 2020 2075 7365 7220 3d20           user = 
-00004260: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
-00004270: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
-00004280: 6574 2827 7573 6572 2729 2c0a 2020 2020  et('user'),.    
-00004290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042b0: 2020 2020 206f 732e 656e 7669 726f 6e2e       os.environ.
-000042c0: 6765 7428 224f 535f 5553 4552 4e41 4d45  get("OS_USERNAME
-000042d0: 2229 5d20 6966 2065 2069 7320 6e6f 7420  ")] if e is not 
-000042e0: 4e6f 6e65 292c 2027 6164 6d69 6e27 290a  None), 'admin').
-000042f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004300: 7072 6f6a 6563 7420 3d20 6e65 7874 2828  project = next((
-00004310: 6520 666f 7220 6520 696e 205b 7365 6c66  e for e in [self
-00004320: 2e6f 7074 696f 6e73 2e67 6574 2827 7072  .options.get('pr
-00004330: 6f6a 6563 7427 292c 0a20 2020 2020 2020  oject'),.       
-00004340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004360: 2020 2020 206f 732e 656e 7669 726f 6e2e       os.environ.
-00004370: 6765 7428 224f 535f 5052 4f4a 4543 545f  get("OS_PROJECT_
-00004380: 4e41 4d45 2229 5d20 6966 2065 2069 7320  NAME")] if e is 
-00004390: 6e6f 7420 4e6f 6e65 292c 2027 6164 6d69  not None), 'admi
-000043a0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-000043b0: 2020 2020 7061 7373 776f 7264 203d 206e      password = n
-000043c0: 6578 7428 2865 2066 6f72 2065 2069 6e20  ext((e for e in 
-000043d0: 5b73 656c 662e 6f70 7469 6f6e 732e 6765  [self.options.ge
-000043e0: 7428 2770 6173 7377 6f72 6427 292c 0a20  t('password'),. 
-000043f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004410: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
-00004420: 6e76 6972 6f6e 2e67 6574 2822 4f53 5f50  nviron.get("OS_P
-00004430: 4153 5357 4f52 4422 295d 2069 6620 6520  ASSWORD")] if e 
-00004440: 6973 206e 6f74 204e 6f6e 6529 2c20 4e6f  is not None), No
-00004450: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-00004460: 2020 2020 6361 5f66 696c 6520 3d20 6e65      ca_file = ne
-00004470: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
-00004480: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00004490: 2827 6361 5f66 696c 6527 292c 0a20 2020  ('ca_file'),.   
-000044a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044c0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-000044d0: 726f 6e2e 6765 7428 224f 535f 4341 4345  ron.get("OS_CACE
-000044e0: 5254 2229 5d20 6966 2065 2069 7320 6e6f  RT")] if e is no
-000044f0: 7420 4e6f 6e65 292c 204e 6f6e 6529 0a20  t None), None). 
-00004500: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004510: 6567 696f 6e5f 6e61 6d65 203d 206e 6578  egion_name = nex
-00004520: 7428 2865 2066 6f72 2065 2069 6e20 5b73  t((e for e in [s
-00004530: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00004540: 2772 6567 696f 6e5f 6e61 6d65 2729 2c0a  'region_name'),.
-00004550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004570: 2020 2020 6f73 2e65 6e76 6972 6f6e 2e67      os.environ.g
-00004580: 6574 2822 4f53 5f52 4547 494f 4e5f 4e41  et("OS_REGION_NA
-00004590: 4d45 2229 5d20 6966 2065 2069 7320 6e6f  ME")] if e is no
-000045a0: 7420 4e6f 6e65 292c 204e 6f6e 6529 0a20  t None), None). 
-000045b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000045c0: 7874 6572 6e61 6c5f 6e65 7477 6f72 6b20  xternal_network 
-000045d0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-000045e0: 6574 2827 6578 7465 726e 616c 5f6e 6574  et('external_net
-000045f0: 776f 726b 2729 0a20 2020 2020 2020 2020  work').         
-00004600: 2020 2020 2020 2069 6620 6175 7468 5f75         if auth_u
-00004610: 726c 2e65 6e64 7377 6974 6828 2776 322e  rl.endswith('v2.
-00004620: 3027 293a 0a20 2020 2020 2020 2020 2020  0'):.           
-00004630: 2020 2020 2020 2020 2064 6f6d 6169 6e20           domain 
-00004640: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00004650: 2020 2020 2020 2069 6620 6361 5f66 696c         if ca_fil
-00004660: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
-00004670: 6420 6e6f 7420 6f73 2e70 6174 682e 6578  d not os.path.ex
-00004680: 6973 7473 286f 732e 7061 7468 2e65 7870  ists(os.path.exp
-00004690: 616e 6475 7365 7228 6361 5f66 696c 6529  anduser(ca_file)
-000046a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000046b0: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
-000046c0: 6e64 6963 6174 6564 2063 615f 6669 6c65  ndicated ca_file
-000046d0: 207b 6361 5f66 696c 657d 206e 6f74 2066   {ca_file} not f
-000046e0: 6f75 6e64 2e20 4c65 6176 696e 6722 290a  ound. Leaving").
-000046f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004700: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004720: 676c 616e 6365 5f64 6973 6b20 3d20 7365  glance_disk = se
-00004730: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00004740: 676c 616e 6365 5f64 6973 6b27 2c20 4661  glance_disk', Fa
-00004750: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-00004760: 2020 2020 2061 7574 685f 746f 6b65 6e20       auth_token 
-00004770: 3d20 6e65 7874 2828 6520 666f 7220 6520  = next((e for e 
-00004780: 696e 205b 7365 6c66 2e6f 7074 696f 6e73  in [self.options
-00004790: 2e67 6574 2827 746f 6b65 6e27 292c 0a20  .get('token'),. 
-000047a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047c0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-000047d0: 2e65 6e76 6972 6f6e 2e67 6574 2822 4f53  .environ.get("OS
-000047e0: 5f54 4f4b 454e 2229 5d20 6966 2065 2069  _TOKEN")] if e i
-000047f0: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
-00004800: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00004810: 2020 2061 7574 685f 7479 7065 203d 2027     auth_type = '
-00004820: 746f 6b65 6e27 2069 6620 6175 7468 5f74  token' if auth_t
-00004830: 6f6b 656e 2069 7320 6e6f 7420 4e6f 6e65  oken is not None
-00004840: 2065 6c73 6520 2770 6173 7377 6f72 6427   else 'password'
-00004850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004860: 2069 6620 6175 7468 5f74 7970 6520 3d3d   if auth_type ==
-00004870: 2027 7061 7373 776f 7264 2720 616e 6420   'password' and 
-00004880: 7061 7373 776f 7264 2069 7320 4e6f 6e65  password is None
-00004890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000048a0: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-000048b0: 7369 6e67 2070 6173 7377 6f72 6420 696e  sing password in
-000048c0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-000048d0: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
-000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048f0: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00004900: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004910: 2061 7574 685f 7479 7065 203d 3d20 2774   auth_type == 't
-00004920: 6f6b 656e 273a 0a20 2020 2020 2020 2020  oken':.         
-00004930: 2020 2020 2020 2020 2020 2075 7365 722c             user,
-00004940: 2070 6173 7377 6f72 642c 2064 6f6d 6169   password, domai
-00004950: 6e20 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  n = None, None, 
-00004960: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00004970: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
-00004980: 7072 6f76 6964 6572 732e 6f70 656e 7374  providers.openst
-00004990: 6163 6b20 696d 706f 7274 204b 6f70 656e  ack import Kopen
-000049a0: 7374 6163 6b0a 2020 2020 2020 2020 2020  stack.          
-000049b0: 2020 2020 2020 6b20 3d20 4b6f 7065 6e73        k = Kopens
-000049c0: 7461 636b 2868 6f73 743d 7365 6c66 2e68  tack(host=self.h
-000049d0: 6f73 742c 2070 6f72 743d 7365 6c66 2e70  ost, port=self.p
-000049e0: 6f72 742c 2075 7365 723d 7573 6572 2c20  ort, user=user, 
-000049f0: 7061 7373 776f 7264 3d70 6173 7377 6f72  password=passwor
-00004a00: 642c 2076 6572 7369 6f6e 3d76 6572 7369  d, version=versi
-00004a10: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00004a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a30: 2020 2064 6562 7567 3d64 6562 7567 2c20     debug=debug, 
-00004a40: 7072 6f6a 6563 743d 7072 6f6a 6563 742c  project=project,
-00004a50: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
-00004a60: 6175 7468 5f75 726c 3d61 7574 685f 7572  auth_url=auth_ur
-00004a70: 6c2c 2063 615f 6669 6c65 3d63 615f 6669  l, ca_file=ca_fi
-00004a80: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00004a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004aa0: 2020 2065 7874 6572 6e61 6c5f 6e65 7477     external_netw
-00004ab0: 6f72 6b3d 6578 7465 726e 616c 5f6e 6574  ork=external_net
-00004ac0: 776f 726b 2c20 7265 6769 6f6e 5f6e 616d  work, region_nam
-00004ad0: 653d 7265 6769 6f6e 5f6e 616d 652c 2067  e=region_name, g
-00004ae0: 6c61 6e63 655f 6469 736b 3d67 6c61 6e63  lance_disk=glanc
-00004af0: 655f 6469 736b 2c0a 2020 2020 2020 2020  e_disk,.        
-00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b10: 2020 2020 2020 2061 7574 685f 7479 7065         auth_type
-00004b20: 3d61 7574 685f 7479 7065 2c20 6175 7468  =auth_type, auth
-00004b30: 5f74 6f6b 656e 3d61 7574 685f 746f 6b65  _token=auth_toke
-00004b40: 6e29 0a20 2020 2020 2020 2020 2020 2065  n).            e
-00004b50: 6c69 6620 7365 6c66 2e74 7970 6520 3d3d  lif self.type ==
-00004b60: 2027 7673 7068 6572 6527 3a0a 2020 2020   'vsphere':.    
-00004b70: 2020 2020 2020 2020 2020 2020 7573 6572              user
-00004b80: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00004b90: 6765 7428 2775 7365 7227 290a 2020 2020  get('user').    
-00004ba0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-00004bb0: 7365 7220 6973 204e 6f6e 653a 0a20 2020  ser is None:.   
-00004bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bd0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
-00004be0: 7573 6572 2069 6e20 7468 6520 636f 6e66  user in the conf
-00004bf0: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
-00004c00: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00004c10: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00004c20: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00004c30: 2020 2020 2070 6173 7377 6f72 6420 3d20       password = 
-00004c40: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00004c50: 2827 7061 7373 776f 7264 2729 0a20 2020  ('password').   
-00004c60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004c70: 7061 7373 776f 7264 2069 7320 4e6f 6e65  password is None
-00004c80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004c90: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-00004ca0: 7369 6e67 2070 6173 7377 6f72 6420 696e  sing password in
-00004cb0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00004cc0: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
-00004cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ce0: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00004cf0: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00004d00: 7573 7465 7220 3d20 7365 6c66 2e6f 7074  uster = self.opt
-00004d10: 696f 6e73 2e67 6574 2827 636c 7573 7465  ions.get('cluste
-00004d20: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-00004d30: 2020 2020 6966 2063 6c75 7374 6572 2069      if cluster i
-00004d40: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00004d50: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00004d60: 7228 224d 6973 7369 6e67 2063 6c75 7374  r("Missing clust
-00004d70: 6572 2069 6e20 7468 6520 636f 6e66 6967  er in the config
-00004d80: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
-00004d90: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00004da0: 2020 2064 6174 6163 656e 7465 7220 3d20     datacenter = 
-00004db0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00004dc0: 2827 6461 7461 6365 6e74 6572 2729 0a20  ('datacenter'). 
-00004dd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004de0: 6620 6461 7461 6365 6e74 6572 2069 7320  f datacenter is 
-00004df0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00004e00: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00004e10: 224d 6973 7369 6e67 2064 6174 6163 656e  "Missing datacen
-00004e20: 7465 7220 696e 2074 6865 2063 6f6e 6669  ter in the confi
-00004e30: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
-00004e40: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-00004e50: 2020 2020 6973 6f66 6f6c 6465 7220 3d20      isofolder = 
-00004e60: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00004e70: 2827 6973 6f66 6f6c 6465 7227 290a 2020  ('isofolder').  
-00004e80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004e90: 2069 736f 666f 6c64 6572 2069 7320 6e6f   isofolder is no
-00004ea0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00004eb0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00004ec0: 2f27 206e 6f74 2069 6e20 6973 6f66 6f6c  /' not in isofol
-00004ed0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00004ee0: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-00004ef0: 706f 6f6c 203d 2073 656c 662e 706f 6f6c  pool = self.pool
-00004f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004f10: 2020 2020 2065 6c69 6620 275b 2720 6e6f       elif '[' no
-00004f20: 7420 696e 2069 736f 666f 6c64 6572 3a0a  t in isofolder:.
-00004f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f40: 2020 2020 2020 2020 6973 6f66 6f6c 6465          isofolde
-00004f50: 7220 3d20 6973 6f66 6f6c 6465 722e 7370  r = isofolder.sp
-00004f60: 6c69 7428 272f 2729 0a20 2020 2020 2020  lit('/').       
-00004f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f80: 2069 736f 706f 6f6c 203d 2069 736f 666f   isopool = isofo
-00004f90: 6c64 6572 5b30 5d0a 2020 2020 2020 2020  lder[0].        
-00004fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fb0: 6973 6f66 6f6c 6465 7220 3d20 6973 6f66  isofolder = isof
-00004fc0: 6f6c 6465 725b 313a 5d0a 2020 2020 2020  older[1:].      
-00004fd0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00004fe0: 6f66 6f6c 6465 7220 3d20 6627 5b7b 6973  ofolder = f'[{is
-00004ff0: 6f70 6f6f 6c7d 5d2f 7b69 736f 666f 6c64  opool}]/{isofold
-00005000: 6572 7d27 0a20 2020 2020 2020 2020 2020  er}'.           
-00005010: 2020 2020 2066 696c 7465 7276 6d73 203d       filtervms =
-00005020: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00005030: 7428 2766 696c 7465 7276 6d73 272c 2046  t('filtervms', F
-00005040: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00005050: 2020 2020 2020 6669 6c74 6572 7573 6572        filteruser
-00005060: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00005070: 6765 7428 2766 696c 7465 7275 7365 7227  get('filteruser'
-00005080: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-00005090: 2020 2020 2020 2020 2066 696c 7465 7274           filtert
-000050a0: 6167 203d 2073 656c 662e 6f70 7469 6f6e  ag = self.option
-000050b0: 732e 6765 7428 2766 696c 7465 7274 6167  s.get('filtertag
-000050c0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000050d0: 2020 2063 6174 6567 6f72 7920 3d20 7365     category = se
-000050e0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-000050f0: 6361 7465 676f 7279 272c 2027 6b63 6c69  category', 'kcli
-00005100: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00005110: 2020 2062 6173 6566 6f6c 6465 7220 3d20     basefolder = 
-00005120: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00005130: 2827 6261 7365 666f 6c64 6572 2729 0a20  ('basefolder'). 
-00005140: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00005150: 7673 203d 2073 656c 662e 6f70 7469 6f6e  vs = self.option
-00005160: 732e 6765 7428 2764 7673 272c 2054 7275  s.get('dvs', Tru
-00005170: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00005180: 2020 2069 6d70 6f72 745f 6e65 7477 6f72     import_networ
-00005190: 6b20 3d20 7365 6c66 2e6f 7074 696f 6e73  k = self.options
-000051a0: 2e67 6574 2827 696d 706f 7274 5f6e 6574  .get('import_net
-000051b0: 776f 726b 272c 2027 564d 204e 6574 776f  work', 'VM Netwo
-000051c0: 726b 2729 0a20 2020 2020 2020 2020 2020  rk').           
-000051d0: 2020 2020 2074 696d 656f 7574 203d 2073       timeout = s
-000051e0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-000051f0: 2774 696d 656f 7574 272c 2032 3730 3029  'timeout', 2700)
-00005200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005210: 2066 6f72 6365 5f70 6f6f 6c20 3d20 7365   force_pool = se
-00005220: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00005230: 666f 7263 655f 706f 6f6c 272c 2046 616c  force_pool', Fal
-00005240: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00005250: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
-00005260: 726f 7669 6465 7273 2e76 7370 6865 7265  roviders.vsphere
-00005270: 2069 6d70 6f72 7420 4b73 7068 6572 650a   import Ksphere.
-00005280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005290: 6b20 3d20 4b73 7068 6572 6528 7365 6c66  k = Ksphere(self
-000052a0: 2e68 6f73 742c 2075 7365 722c 2070 6173  .host, user, pas
-000052b0: 7377 6f72 642c 2064 6174 6163 656e 7465  sword, datacente
-000052c0: 722c 2063 6c75 7374 6572 2c20 6973 6f66  r, cluster, isof
-000052d0: 6f6c 6465 723d 6973 6f66 6f6c 6465 722c  older=isofolder,
-000052e0: 2064 6562 7567 3d64 6562 7567 2c0a 2020   debug=debug,.  
-000052f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005300: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00005310: 766d 733d 6669 6c74 6572 766d 732c 2066  vms=filtervms, f
-00005320: 696c 7465 7275 7365 723d 6669 6c74 6572  ilteruser=filter
-00005330: 7573 6572 2c20 6669 6c74 6572 7461 673d  user, filtertag=
-00005340: 6669 6c74 6572 7461 672c 2063 6174 6567  filtertag, categ
-00005350: 6f72 793d 6361 7465 676f 7279 2c0a 2020  ory=category,.  
-00005360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005370: 2020 2020 2020 2020 2020 6261 7365 666f            basefo
-00005380: 6c64 6572 3d62 6173 6566 6f6c 6465 722c  lder=basefolder,
-00005390: 2064 7673 3d64 7673 2c20 696d 706f 7274   dvs=dvs, import
-000053a0: 5f6e 6574 776f 726b 3d69 6d70 6f72 745f  _network=import_
-000053b0: 6e65 7477 6f72 6b2c 2074 696d 656f 7574  network, timeout
-000053c0: 3d74 696d 656f 7574 2c0a 2020 2020 2020  =timeout,.      
-000053d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053e0: 2020 2020 2020 666f 7263 655f 706f 6f6c        force_pool
-000053f0: 3d66 6f72 6365 5f70 6f6f 6c29 0a20 2020  =force_pool).   
-00005400: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-00005410: 6c66 2e74 7970 6520 3d3d 2027 7061 636b  lf.type == 'pack
-00005420: 6574 273a 0a20 2020 2020 2020 2020 2020  et':.           
-00005430: 2020 2020 2061 7574 685f 746f 6b65 6e20       auth_token 
-00005440: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00005450: 6574 2827 6175 7468 5f74 6f6b 656e 2729  et('auth_token')
-00005460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005470: 2069 6620 6175 7468 5f74 6f6b 656e 2069   if auth_token i
-00005480: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00005490: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-000054a0: 7228 224d 6973 7369 6e67 2061 7574 685f  r("Missing auth_
-000054b0: 746f 6b65 6e20 696e 2074 6865 2063 6f6e  token in the con
-000054c0: 6669 6775 7261 7469 6f6e 2e20 4c65 6176  figuration. Leav
-000054d0: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
-000054e0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-000054f0: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-00005500: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
-00005510: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00005520: 2827 7072 6f6a 6563 7427 290a 2020 2020  ('project').    
-00005530: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00005540: 726f 6a65 6374 2069 7320 4e6f 6e65 3a0a  roject is None:.
-00005550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005560: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
-00005570: 6e67 2070 726f 6a65 6374 2069 6e20 7468  ng project in th
-00005580: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
-00005590: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
-000055a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000055b0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-000055c0: 2020 2020 2020 2020 2020 2066 6163 696c             facil
-000055d0: 6974 7920 3d20 7365 6c66 2e6f 7074 696f  ity = self.optio
-000055e0: 6e73 2e67 6574 2827 6661 6369 6c69 7479  ns.get('facility
-000055f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00005600: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
-00005610: 6f76 6964 6572 732e 7061 636b 6574 2069  oviders.packet i
-00005620: 6d70 6f72 7420 4b70 6163 6b65 740a 2020  mport Kpacket.  
-00005630: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
-00005640: 3d20 4b70 6163 6b65 7428 6175 7468 5f74  = Kpacket(auth_t
-00005650: 6f6b 656e 2c20 7072 6f6a 6563 742c 2066  oken, project, f
-00005660: 6163 696c 6974 793d 6661 6369 6c69 7479  acility=facility
-00005670: 2c20 6465 6275 673d 6465 6275 672c 0a20  , debug=debug,. 
-00005680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005690: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-000056a0: 6c68 6f73 743d 7365 6c66 2e74 756e 6e65  lhost=self.tunne
-000056b0: 6c68 6f73 742c 2074 756e 6e65 6c75 7365  lhost, tunneluse
-000056c0: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
-000056d0: 722c 2074 756e 6e65 6c70 6f72 743d 7365  r, tunnelport=se
-000056e0: 6c66 2e74 756e 6e65 6c70 6f72 742c 0a20  lf.tunnelport,. 
-000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005700: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-00005710: 6c64 6972 3d73 656c 662e 7475 6e6e 656c  ldir=self.tunnel
-00005720: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
-00005730: 2065 6c69 6620 7365 6c66 2e74 7970 6520   elif self.type 
-00005740: 3d3d 2027 7765 6227 3a0a 2020 2020 2020  == 'web':.      
-00005750: 2020 2020 2020 2020 2020 706f 7274 203d            port =
-00005760: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00005770: 7428 2770 6f72 7427 2c20 3830 3030 290a  t('port', 8000).
-00005780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005790: 6c6f 6361 6c6b 7562 6520 3d20 7365 6c66  localkube = self
-000057a0: 2e6f 7074 696f 6e73 2e67 6574 2827 6c6f  .options.get('lo
-000057b0: 6361 6c6b 7562 6527 2c20 5472 7565 290a  calkube', True).
-000057c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057d0: 6672 6f6d 206b 7669 7274 2e70 726f 7669  from kvirt.provi
-000057e0: 6465 7273 2e77 6562 2069 6d70 6f72 7420  ders.web import 
-000057f0: 4b77 6562 636c 6965 6e74 0a20 2020 2020  Kwebclient.     
-00005800: 2020 2020 2020 2020 2020 206b 203d 204b             k = K
-00005810: 7765 6263 6c69 656e 7428 7365 6c66 2e68  webclient(self.h
-00005820: 6f73 742c 2070 6f72 742c 206c 6f63 616c  ost, port, local
-00005830: 6b75 6265 3d6c 6f63 616c 6b75 6265 2c20  kube=localkube, 
-00005840: 6465 6275 673d 6465 6275 6729 0a20 2020  debug=debug).   
-00005850: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00005860: 662e 7479 7065 203d 2027 7765 6227 0a20  f.type = 'web'. 
-00005870: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00005880: 6f66 666c 696e 653a 0a20 2020 2020 2020  offline:.       
-00005890: 2020 2020 2020 2020 2066 726f 6d20 6b76           from kv
-000058a0: 6972 742e 7072 6f76 6964 6572 732e 6661  irt.providers.fa
-000058b0: 6b65 2069 6d70 6f72 7420 4b66 616b 650a  ke import Kfake.
-000058c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058d0: 6b20 3d20 4b66 616b 6528 290a 2020 2020  k = Kfake().    
-000058e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000058f0: 2e74 7970 6520 3d20 2766 616b 6527 0a20  .type = 'fake'. 
-00005900: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00005910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005920: 2069 6620 7365 6c66 2e68 6f73 7420 6973   if self.host is
-00005930: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00005940: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00005950: 2822 5072 6f62 6c65 6d20 7061 7273 696e  ("Problem parsin
-00005960: 6720 796f 7572 2063 6f6e 6669 6775 7261  g your configura
-00005970: 7469 6f6e 2066 696c 6522 290a 2020 2020  tion file").    
-00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005990: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-000059a0: 2020 2020 2020 2020 2020 2020 7365 7373              sess
-000059b0: 696f 6e20 3d20 7365 6c66 2e6f 7074 696f  ion = self.optio
-000059c0: 6e73 2e67 6574 2827 7365 7373 696f 6e27  ns.get('session'
-000059d0: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-000059e0: 2020 2020 2020 2020 2072 656d 6f74 6564           remoted
-000059f0: 6e73 6d61 7371 203d 2073 656c 662e 6f70  nsmasq = self.op
-00005a00: 7469 6f6e 732e 6765 7428 2772 656d 6f74  tions.get('remot
-00005a10: 6564 6e73 6d61 7371 272c 2046 616c 7365  ednsmasq', False
-00005a20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005a30: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
-00005a40: 7669 6465 7273 2e6b 766d 2069 6d70 6f72  viders.kvm impor
-00005a50: 7420 4b76 6972 740a 2020 2020 2020 2020  t Kvirt.        
-00005a60: 2020 2020 2020 2020 6b20 3d20 4b76 6972          k = Kvir
-00005a70: 7428 686f 7374 3d73 656c 662e 686f 7374  t(host=self.host
-00005a80: 2c20 706f 7274 3d73 656c 662e 706f 7274  , port=self.port
-00005a90: 2c20 7573 6572 3d73 656c 662e 7573 6572  , user=self.user
-00005aa0: 2c20 7072 6f74 6f63 6f6c 3d73 656c 662e  , protocol=self.
-00005ab0: 7072 6f74 6f63 6f6c 2c20 7572 6c3d 7365  protocol, url=se
-00005ac0: 6c66 2e75 726c 2c0a 2020 2020 2020 2020  lf.url,.        
-00005ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ae0: 2020 6465 6275 673d 6465 6275 672c 2069    debug=debug, i
-00005af0: 6e73 6563 7572 653d 7365 6c66 2e69 6e73  nsecure=self.ins
-00005b00: 6563 7572 652c 2073 6573 7369 6f6e 3d73  ecure, session=s
-00005b10: 6573 7369 6f6e 2c20 7265 6d6f 7465 646e  ession, remotedn
-00005b20: 736d 6173 713d 7265 6d6f 7465 646e 736d  smasq=remotednsm
-00005b30: 6173 7129 0a20 2020 2020 2020 2020 2020  asq).           
-00005b40: 2069 6620 6b2e 636f 6e6e 2069 7320 4e6f   if k.conn is No
-00005b50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00005b60: 2020 2020 6572 726f 7228 6622 436f 756c      error(f"Coul
-00005b70: 646e 2774 2063 6f6e 6e65 6374 2074 6f20  dn't connect to 
-00005b80: 636c 6965 6e74 207b 7365 6c66 2e63 6c69  client {self.cli
-00005b90: 656e 747d 2e20 4c65 6176 696e 672e 2e2e  ent}. Leaving...
-00005ba0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00005bb0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00005bc0: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-00005bd0: 7874 7261 636c 6965 6e74 2069 6e20 7365  xtraclient in se
-00005be0: 6c66 2e5f 6578 7472 6163 6c69 656e 7473  lf._extraclients
-00005bf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005c00: 2020 6966 2065 7874 7261 636c 6965 6e74    if extraclient
-00005c10: 206e 6f74 2069 6e20 7365 6c66 2e69 6e69   not in self.ini
-00005c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005c30: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-00005c40: 4d69 7373 696e 6720 7365 6374 696f 6e20  Missing section 
-00005c50: 666f 7220 636c 6965 6e74 207b 6578 7472  for client {extr
-00005c60: 6163 6c69 656e 747d 2069 6e20 636f 6e66  aclient} in conf
-00005c70: 6967 2066 696c 652e 2054 7279 696e 6720  ig file. Trying 
-00005c80: 746f 2063 6f6e 6e65 6374 2e2e 2e22 290a  to connect...").
-00005c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ca0: 2020 2020 7365 6c66 2e69 6e69 5b65 7874      self.ini[ext
-00005cb0: 7261 636c 6965 6e74 5d20 3d20 7b27 686f  raclient] = {'ho
-00005cc0: 7374 273a 2065 7874 7261 636c 6965 6e74  st': extraclient
-00005cd0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00005ce0: 2020 6320 3d20 4b63 6f6e 6669 6728 636c    c = Kconfig(cl
-00005cf0: 6965 6e74 3d65 7874 7261 636c 6965 6e74  ient=extraclient
-00005d00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005d10: 2020 6520 3d20 632e 6b0a 2020 2020 2020    e = c.k.      
-00005d20: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
-00005d30: 7874 7261 636c 6965 6e74 735b 6578 7472  xtraclients[extr
-00005d40: 6163 6c69 656e 745d 203d 2065 0a20 2020  aclient] = e.   
-00005d50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005d60: 652e 636f 6e6e 2069 7320 4e6f 6e65 3a0a  e.conn is None:.
-00005d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d80: 2020 2020 6572 726f 7228 6622 436f 756c      error(f"Coul
-00005d90: 646e 2774 2063 6f6e 6e65 6374 2074 6f20  dn't connect to 
-00005da0: 7370 6563 6966 7920 6879 7065 7276 6973  specify hypervis
-00005db0: 6f72 207b 6578 7472 6163 6c69 656e 747d  or {extraclient}
-00005dc0: 2e20 4c65 6176 696e 672e 2e2e 2229 0a20  . Leaving..."). 
-00005dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005de0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00005df0: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-00005e00: 7361 7474 7228 7365 6c66 2c20 2761 6c67  sattr(self, 'alg
-00005e10: 6f72 6974 686d 2729 3a0a 2020 2020 2020  orithm'):.      
-00005e20: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00005e30: 662e 616c 676f 7269 7468 6d20 3d3d 2027  f.algorithm == '
-00005e40: 6672 6565 273a 0a20 2020 2020 2020 2020  free':.         
-00005e50: 2020 2020 2020 2020 2020 2075 7073 7461             upsta
-00005e60: 7475 7320 3d20 5b27 6163 7469 7665 272c  tus = ['active',
-00005e70: 2027 7570 272c 2027 7275 6e6e 696e 6727   'up', 'running'
-00005e80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00005e90: 2020 2020 2020 616c 6c63 6c69 7320 3d20        allclis = 
-00005ea0: 7b73 656c 662e 636c 6965 6e74 3a20 6b7d  {self.client: k}
-00005eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005ec0: 2020 2020 2061 6c6c 636c 6973 2e75 7064       allclis.upd
-00005ed0: 6174 6528 7365 6c66 2e65 7874 7261 636c  ate(self.extracl
-00005ee0: 6965 6e74 7329 0a20 2020 2020 2020 2020  ients).         
-00005ef0: 2020 2020 2020 2020 2020 206d 696e 636c             mincl
-00005f00: 692c 206d 696e 766d 7320 3d20 4e6f 6e65  i, minvms = None
-00005f10: 2c20 4e6f 6e65 0a20 2020 2020 2020 2020  , None.         
-00005f20: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-00005f30: 6c69 2069 6e20 616c 6c63 6c69 733a 0a20  li in allclis:. 
-00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f50: 2020 2020 2020 2063 6c69 766d 7320 3d20         clivms = 
-00005f60: 6c65 6e28 5b76 6d20 666f 7220 766d 2069  len([vm for vm i
-00005f70: 6e20 616c 6c63 6c69 735b 636c 695d 2e6c  n allclis[cli].l
-00005f80: 6973 7428 2920 6966 2076 6d5b 2773 7461  ist() if vm['sta
-00005f90: 7475 7327 5d2e 6c6f 7765 7228 2920 696e  tus'].lower() in
-00005fa0: 2075 7073 7461 7475 735d 290a 2020 2020   upstatus]).    
-00005fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fc0: 2020 2020 6966 206d 696e 766d 7320 6973      if minvms is
-00005fd0: 204e 6f6e 6520 6f72 2063 6c69 766d 7320   None or clivms 
-00005fe0: 3c20 6d69 6e76 6d73 3a0a 2020 2020 2020  < minvms:.      
-00005ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006000: 2020 2020 2020 6d69 6e63 6c69 203d 2063        mincli = c
-00006010: 6c69 0a20 2020 2020 2020 2020 2020 2020  li.             
-00006020: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00006030: 696e 766d 7320 3d20 636c 6976 6d73 0a20  invms = clivms. 
-00006040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006050: 2020 2069 6620 6d69 6e63 6c69 2021 3d20     if mincli != 
-00006060: 7365 6c66 2e63 6c69 656e 743a 0a20 2020  self.client:.   
-00006070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006080: 2020 2020 2073 656c 662e 6578 7472 6163       self.extrac
-00006090: 6c69 656e 7473 5b73 656c 662e 636c 6965  lients[self.clie
-000060a0: 6e74 5d20 3d20 6b0a 2020 2020 2020 2020  nt] = k.        
-000060b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060c0: 6b20 3d20 7365 6c66 2e65 7874 7261 636c  k = self.extracl
-000060d0: 6965 6e74 735b 6d69 6e63 6c69 5d0a 2020  ients[mincli].  
-000060e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060f0: 2020 2020 2020 6465 6c20 7365 6c66 2e65        del self.e
-00006100: 7874 7261 636c 6965 6e74 735b 6d69 6e63  xtraclients[minc
-00006110: 6c69 5d0a 2020 2020 2020 2020 2020 2020  li].            
-00006120: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006130: 2e63 6c69 656e 7420 3d20 6d69 6e63 6c69  .client = mincli
-00006140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006150: 2069 6620 7365 6c66 2e61 6c67 6f72 6974   if self.algorit
-00006160: 686d 203d 3d20 2762 616c 616e 6365 273a  hm == 'balance':
-00006170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006180: 2020 2020 206d 656d 6265 7273 203d 205b       members = [
-00006190: 7365 6c66 2e63 6c69 656e 745d 202b 206c  self.client] + l
-000061a0: 6973 7428 7365 6c66 2e65 7874 7261 636c  ist(self.extracl
-000061b0: 6965 6e74 732e 6b65 7973 2829 290a 2020  ients.keys()).  
-000061c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061d0: 2020 6c61 7374 766d 203d 2022 2573 2f2e    lastvm = "%s/.
-000061e0: 6b63 6c69 2f76 6d22 2025 206f 732e 656e  kcli/vm" % os.en
-000061f0: 7669 726f 6e2e 6765 7428 2748 4f4d 4527  viron.get('HOME'
-00006200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006210: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00006220: 2e65 7869 7374 7328 6c61 7374 766d 2920  .exists(lastvm) 
-00006230: 616e 6420 6f73 2e73 7461 7428 6c61 7374  and os.stat(last
-00006240: 766d 292e 7374 5f73 697a 6520 3e20 303a  vm).st_size > 0:
-00006250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006260: 2020 2020 2020 2020 2066 6f72 206c 696e           for lin
-00006270: 6520 696e 206f 7065 6e28 6c61 7374 766d  e in open(lastvm
-00006280: 292e 7265 6164 6c69 6e65 7328 293a 0a20  ).readlines():. 
-00006290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062a0: 2020 2020 2020 2020 2020 206c 696e 6520             line 
-000062b0: 3d20 6c69 6e65 2e73 706c 6974 2827 2027  = line.split(' '
-000062c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000062d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000062e0: 206c 656e 286c 696e 6529 2021 3d20 323a   len(line) != 2:
-000062f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000034a0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+000034b0: 2822 436f 7564 6c6e 2774 2070 6172 7365  ("Coudln't parse
+000034c0: 207e 2f2e 6962 6d2f 636f 6e66 6967 2066   ~/.ibm/config f
+000034d0: 696c 652e 204c 6561 7669 6e67 2229 0a20  ile. Leaving"). 
+000034e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034f0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00003500: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00003510: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00003520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003530: 2069 616d 5f61 7069 5f6b 6579 203d 2073   iam_api_key = s
+00003540: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00003550: 2769 616d 5f61 7069 5f6b 6579 2729 0a20  'iam_api_key'). 
+00003560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003570: 2020 2063 6f73 5f61 7069 5f6b 6579 203d     cos_api_key =
+00003580: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00003590: 7428 2763 6f73 5f61 7069 5f6b 6579 2729  t('cos_api_key')
+000035a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000035b0: 2020 2020 2063 6f73 5f72 6573 6f75 7263       cos_resourc
+000035c0: 655f 696e 7374 616e 6365 5f69 6420 3d20  e_instance_id = 
+000035d0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+000035e0: 2827 636f 735f 7265 736f 7572 6365 5f69  ('cos_resource_i
+000035f0: 6e73 7461 6e63 655f 6964 2729 0a20 2020  nstance_id').   
+00003600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003610: 2063 6973 5f72 6573 6f75 7263 655f 696e   cis_resource_in
+00003620: 7374 616e 6365 5f69 6420 3d20 7365 6c66  stance_id = self
+00003630: 2e6f 7074 696f 6e73 2e67 6574 2827 6369  .options.get('ci
+00003640: 735f 7265 736f 7572 6365 5f69 6e73 7461  s_resource_insta
+00003650: 6e63 655f 6964 2729 0a20 2020 2020 2020  nce_id').       
+00003660: 2020 2020 2020 2020 2020 2020 2072 6567               reg
+00003670: 696f 6e20 3d20 7365 6c66 2e6f 7074 696f  ion = self.optio
+00003680: 6e73 2e67 6574 2827 7265 6769 6f6e 2729  ns.get('region')
+00003690: 2069 6620 7265 6769 6f6e 2069 7320 4e6f   if region is No
+000036a0: 6e65 2065 6c73 6520 7265 6769 6f6e 0a20  ne else region. 
+000036b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000036c0: 2020 207a 6f6e 6520 3d20 7365 6c66 2e6f     zone = self.o
+000036d0: 7074 696f 6e73 2e67 6574 2827 7a6f 6e65  ptions.get('zone
+000036e0: 2729 2069 6620 7a6f 6e65 2069 7320 4e6f  ') if zone is No
+000036f0: 6e65 2065 6c73 6520 7a6f 6e65 0a20 2020  ne else zone.   
+00003700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003710: 2076 7063 203d 2073 656c 662e 6f70 7469   vpc = self.opti
+00003720: 6f6e 732e 6765 7428 2776 7063 2729 0a20  ons.get('vpc'). 
+00003730: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00003740: 6620 6961 6d5f 6170 695f 6b65 7920 6973  f iam_api_key is
+00003750: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00003760: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00003770: 2822 4d69 7373 696e 6720 6961 6d5f 6170  ("Missing iam_ap
+00003780: 695f 6b65 7920 696e 2074 6865 2063 6f6e  i_key in the con
+00003790: 6669 6775 7261 7469 6f6e 2e20 4c65 6176  figuration. Leav
+000037a0: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+000037b0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+000037c0: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+000037d0: 2020 2020 2020 6966 2072 6567 696f 6e20        if region 
+000037e0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000037f0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00003800: 6f72 2822 4d69 7373 696e 6720 7265 6769  or("Missing regi
+00003810: 6f6e 2069 6e20 7468 6520 636f 6e66 6967  on in the config
+00003820: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
+00003830: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00003840: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00003850: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00003860: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
+00003870: 6f76 6964 6572 732e 6962 6d20 696d 706f  oviders.ibm impo
+00003880: 7274 204b 6962 6d0a 2020 2020 2020 2020  rt Kibm.        
+00003890: 2020 2020 2020 2020 6b20 3d20 4b69 626d          k = Kibm
+000038a0: 2869 616d 5f61 7069 5f6b 6579 3d69 616d  (iam_api_key=iam
+000038b0: 5f61 7069 5f6b 6579 2c20 7265 6769 6f6e  _api_key, region
+000038c0: 3d72 6567 696f 6e2c 207a 6f6e 653d 7a6f  =region, zone=zo
+000038d0: 6e65 2c20 7670 633d 7670 632c 2064 6562  ne, vpc=vpc, deb
+000038e0: 7567 3d64 6562 7567 2c0a 2020 2020 2020  ug=debug,.      
+000038f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003900: 2020 2063 6f73 5f61 7069 5f6b 6579 3d63     cos_api_key=c
+00003910: 6f73 5f61 7069 5f6b 6579 2c20 636f 735f  os_api_key, cos_
+00003920: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
+00003930: 655f 6964 3d63 6f73 5f72 6573 6f75 7263  e_id=cos_resourc
+00003940: 655f 696e 7374 616e 6365 5f69 642c 0a20  e_instance_id,. 
+00003950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003960: 2020 2020 2020 2020 6369 735f 7265 736f          cis_reso
+00003970: 7572 6365 5f69 6e73 7461 6e63 655f 6964  urce_instance_id
+00003980: 3d63 6973 5f72 6573 6f75 7263 655f 696e  =cis_resource_in
+00003990: 7374 616e 6365 5f69 6429 0a20 2020 2020  stance_id).     
+000039a0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+000039b0: 2e74 7970 6520 3d3d 2027 6f76 6972 7427  .type == 'ovirt'
+000039c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000039d0: 2020 6461 7461 6365 6e74 6572 203d 2073    datacenter = s
+000039e0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+000039f0: 2764 6174 6163 656e 7465 7227 2c20 2744  'datacenter', 'D
+00003a00: 6566 6175 6c74 2729 0a20 2020 2020 2020  efault').       
+00003a10: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
+00003a20: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00003a30: 6765 7428 2763 6c75 7374 6572 272c 2027  get('cluster', '
+00003a40: 4465 6661 756c 7427 290a 2020 2020 2020  Default').      
+00003a50: 2020 2020 2020 2020 2020 7573 6572 203d            user =
+00003a60: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00003a70: 7428 2775 7365 7227 2c20 2761 646d 696e  t('user', 'admin
+00003a80: 4069 6e74 6572 6e61 6c27 290a 2020 2020  @internal').    
+00003a90: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00003aa0: 776f 7264 203d 2073 656c 662e 6f70 7469  word = self.opti
+00003ab0: 6f6e 732e 6765 7428 2770 6173 7377 6f72  ons.get('passwor
+00003ac0: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+00003ad0: 2020 2020 6966 2070 6173 7377 6f72 6420      if password 
+00003ae0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00003af0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00003b00: 6f72 2822 4d69 7373 696e 6720 7061 7373  or("Missing pass
+00003b10: 776f 7264 2069 6e20 7468 6520 636f 6e66  word in the conf
+00003b20: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
+00003b30: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+00003b40: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00003b50: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00003b60: 2020 2020 206f 7267 203d 2073 656c 662e       org = self.
+00003b70: 6f70 7469 6f6e 732e 6765 7428 276f 7267  options.get('org
+00003b80: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00003b90: 2020 2069 6620 6f72 6720 6973 204e 6f6e     if org is Non
+00003ba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00003bb0: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
+00003bc0: 7373 696e 6720 6f72 6720 696e 2074 6865  ssing org in the
+00003bd0: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
+00003be0: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
+00003bf0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00003c00: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00003c10: 2020 2020 2020 2020 2020 6361 5f66 696c            ca_fil
+00003c20: 6520 3d20 7365 6c66 2e6f 7074 696f 6e73  e = self.options
+00003c30: 2e67 6574 2827 6361 5f66 696c 6527 290a  .get('ca_file').
+00003c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c50: 6966 2063 615f 6669 6c65 2069 7320 4e6f  if ca_file is No
+00003c60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00003c70: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
+00003c80: 6973 7369 6e67 2063 615f 6669 6c65 2069  issing ca_file i
+00003c90: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+00003ca0: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+00003cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cc0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00003cd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00003ce0: 615f 6669 6c65 203d 206f 732e 7061 7468  a_file = os.path
+00003cf0: 2e65 7870 616e 6475 7365 7228 6361 5f66  .expanduser(ca_f
+00003d00: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00003d10: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00003d20: 6174 682e 6578 6973 7473 2863 615f 6669  ath.exists(ca_fi
+00003d30: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00003d40: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00003d50: 4361 2066 696c 6520 7061 7468 2064 6f65  Ca file path doe
+00003d60: 736e 2774 2065 7869 7374 2e20 4c65 6176  sn't exist. Leav
+00003d70: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+00003d80: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00003d90: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00003da0: 2020 2020 2020 6669 6c74 6572 766d 7320        filtervms 
+00003db0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00003dc0: 6574 2827 6669 6c74 6572 766d 7327 2c20  et('filtervms', 
+00003dd0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00003de0: 2020 2020 2020 2066 696c 7465 7275 7365         filteruse
+00003df0: 7220 3d20 7365 6c66 2e6f 7074 696f 6e73  r = self.options
+00003e00: 2e67 6574 2827 6669 6c74 6572 7573 6572  .get('filteruser
+00003e10: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
+00003e20: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00003e30: 7461 6720 3d20 7365 6c66 2e6f 7074 696f  tag = self.optio
+00003e40: 6e73 2e67 6574 2827 6669 6c74 6572 7461  ns.get('filterta
+00003e50: 6727 290a 2020 2020 2020 2020 2020 2020  g').            
+00003e60: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
+00003e70: 726f 7669 6465 7273 2e6f 7669 7274 2069  roviders.ovirt i
+00003e80: 6d70 6f72 7420 4b4f 7669 7274 0a20 2020  mport KOvirt.   
+00003e90: 2020 2020 2020 2020 2020 2020 206b 203d               k =
+00003ea0: 204b 4f76 6972 7428 686f 7374 3d73 656c   KOvirt(host=sel
+00003eb0: 662e 686f 7374 2c20 706f 7274 3d73 656c  f.host, port=sel
+00003ec0: 662e 706f 7274 2c20 7573 6572 3d75 7365  f.port, user=use
+00003ed0: 722c 2070 6173 7377 6f72 643d 7061 7373  r, password=pass
+00003ee0: 776f 7264 2c0a 2020 2020 2020 2020 2020  word,.          
+00003ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f00: 2064 6562 7567 3d64 6562 7567 2c20 6461   debug=debug, da
+00003f10: 7461 6365 6e74 6572 3d64 6174 6163 656e  tacenter=datacen
+00003f20: 7465 722c 2063 6c75 7374 6572 3d63 6c75  ter, cluster=clu
+00003f30: 7374 6572 2c20 6361 5f66 696c 653d 6361  ster, ca_file=ca
+00003f40: 5f66 696c 652c 206f 7267 3d6f 7267 2c0a  _file, org=org,.
+00003f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f60: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00003f70: 7276 6d73 3d66 696c 7465 7276 6d73 2c20  rvms=filtervms, 
+00003f80: 6669 6c74 6572 7573 6572 3d66 696c 7465  filteruser=filte
+00003f90: 7275 7365 722c 2066 696c 7465 7274 6167  ruser, filtertag
+00003fa0: 3d66 696c 7465 7274 6167 290a 2020 2020  =filtertag).    
+00003fb0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00003fc0: 662e 7479 7065 203d 3d20 276f 7065 6e73  f.type == 'opens
+00003fd0: 7461 636b 273a 0a20 2020 2020 2020 2020  tack':.         
+00003fe0: 2020 2020 2020 2076 6572 7369 6f6e 203d         version =
+00003ff0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00004000: 7428 2776 6572 7369 6f6e 272c 2027 3227  t('version', '2'
+00004010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004020: 2020 646f 6d61 696e 203d 206e 6578 7428    domain = next(
+00004030: 2865 2066 6f72 2065 2069 6e20 5b73 656c  (e for e in [sel
+00004040: 662e 6f70 7469 6f6e 732e 6765 7428 2764  f.options.get('d
+00004050: 6f6d 6169 6e27 292c 0a20 2020 2020 2020  omain'),.       
+00004060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004080: 2020 2020 6f73 2e65 6e76 6972 6f6e 2e67      os.environ.g
+00004090: 6574 2822 4f53 5f55 5345 525f 444f 4d41  et("OS_USER_DOMA
+000040a0: 494e 5f4e 414d 4522 295d 2069 6620 6520  IN_NAME")] if e 
+000040b0: 6973 206e 6f74 204e 6f6e 6529 2c20 2744  is not None), 'D
+000040c0: 6566 6175 6c74 2729 0a20 2020 2020 2020  efault').       
+000040d0: 2020 2020 2020 2020 2061 7574 685f 7572           auth_ur
+000040e0: 6c20 3d20 6e65 7874 2828 6520 666f 7220  l = next((e for 
+000040f0: 6520 696e 205b 7365 6c66 2e6f 7074 696f  e in [self.optio
+00004100: 6e73 2e67 6574 2827 6175 7468 5f75 726c  ns.get('auth_url
+00004110: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004140: 206f 732e 656e 7669 726f 6e2e 6765 7428   os.environ.get(
+00004150: 224f 535f 4155 5448 5f55 524c 2229 5d20  "OS_AUTH_URL")] 
+00004160: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+00004170: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00004180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004190: 2020 204e 6f6e 6529 0a20 2020 2020 2020     None).       
+000041a0: 2020 2020 2020 2020 2069 6620 6175 7468           if auth
+000041b0: 5f75 726c 2069 7320 4e6f 6e65 3a0a 2020  _url is None:.  
+000041c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041d0: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
+000041e0: 2061 7574 685f 7572 6c20 696e 2074 6865   auth_url in the
+000041f0: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
+00004200: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
+00004210: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00004220: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00004230: 2020 2020 2020 2020 2020 7573 6572 203d            user =
+00004240: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
+00004250: 6e20 5b73 656c 662e 6f70 7469 6f6e 732e  n [self.options.
+00004260: 6765 7428 2775 7365 7227 292c 0a20 2020  get('user'),.   
+00004270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004290: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+000042a0: 2e67 6574 2822 4f53 5f55 5345 524e 414d  .get("OS_USERNAM
+000042b0: 4522 295d 2069 6620 6520 6973 206e 6f74  E")] if e is not
+000042c0: 204e 6f6e 6529 2c20 2761 646d 696e 2729   None), 'admin')
+000042d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000042e0: 2070 726f 6a65 6374 203d 206e 6578 7428   project = next(
+000042f0: 2865 2066 6f72 2065 2069 6e20 5b73 656c  (e for e in [sel
+00004300: 662e 6f70 7469 6f6e 732e 6765 7428 2770  f.options.get('p
+00004310: 726f 6a65 6374 2729 2c0a 2020 2020 2020  roject'),.      
+00004320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004340: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00004350: 2e67 6574 2822 4f53 5f50 524f 4a45 4354  .get("OS_PROJECT
+00004360: 5f4e 414d 4522 295d 2069 6620 6520 6973  _NAME")] if e is
+00004370: 206e 6f74 204e 6f6e 6529 2c20 2761 646d   not None), 'adm
+00004380: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
+00004390: 2020 2020 2070 6173 7377 6f72 6420 3d20       password = 
+000043a0: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
+000043b0: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
+000043c0: 6574 2827 7061 7373 776f 7264 2729 2c0a  et('password'),.
+000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043f0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+00004400: 656e 7669 726f 6e2e 6765 7428 224f 535f  environ.get("OS_
+00004410: 5041 5353 574f 5244 2229 5d20 6966 2065  PASSWORD")] if e
+00004420: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+00004430: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+00004440: 2020 2020 2063 615f 6669 6c65 203d 206e       ca_file = n
+00004450: 6578 7428 2865 2066 6f72 2065 2069 6e20  ext((e for e in 
+00004460: 5b73 656c 662e 6f70 7469 6f6e 732e 6765  [self.options.ge
+00004470: 7428 2763 615f 6669 6c65 2729 2c0a 2020  t('ca_file'),.  
+00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044a0: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+000044b0: 6972 6f6e 2e67 6574 2822 4f53 5f43 4143  iron.get("OS_CAC
+000044c0: 4552 5422 295d 2069 6620 6520 6973 206e  ERT")] if e is n
+000044d0: 6f74 204e 6f6e 6529 2c20 4e6f 6e65 290a  ot None), None).
+000044e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044f0: 7265 6769 6f6e 5f6e 616d 6520 3d20 6e65  region_name = ne
+00004500: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
+00004510: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00004520: 2827 7265 6769 6f6e 5f6e 616d 6527 292c  ('region_name'),
+00004530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004550: 2020 2020 206f 732e 656e 7669 726f 6e2e       os.environ.
+00004560: 6765 7428 224f 535f 5245 4749 4f4e 5f4e  get("OS_REGION_N
+00004570: 414d 4522 295d 2069 6620 6520 6973 206e  AME")] if e is n
+00004580: 6f74 204e 6f6e 6529 2c20 4e6f 6e65 290a  ot None), None).
+00004590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045a0: 6578 7465 726e 616c 5f6e 6574 776f 726b  external_network
+000045b0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+000045c0: 6765 7428 2765 7874 6572 6e61 6c5f 6e65  get('external_ne
+000045d0: 7477 6f72 6b27 290a 2020 2020 2020 2020  twork').        
+000045e0: 2020 2020 2020 2020 6966 2061 7574 685f          if auth_
+000045f0: 7572 6c2e 656e 6473 7769 7468 2827 7632  url.endswith('v2
+00004600: 2e30 2729 3a0a 2020 2020 2020 2020 2020  .0'):.          
+00004610: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
+00004620: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00004630: 2020 2020 2020 2020 6966 2063 615f 6669          if ca_fi
+00004640: 6c65 2069 7320 6e6f 7420 4e6f 6e65 2061  le is not None a
+00004650: 6e64 206e 6f74 206f 732e 7061 7468 2e65  nd not os.path.e
+00004660: 7869 7374 7328 6f73 2e70 6174 682e 6578  xists(os.path.ex
+00004670: 7061 6e64 7573 6572 2863 615f 6669 6c65  panduser(ca_file
+00004680: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00004690: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+000046a0: 496e 6469 6361 7465 6420 6361 5f66 696c  Indicated ca_fil
+000046b0: 6520 7b63 615f 6669 6c65 7d20 6e6f 7420  e {ca_file} not 
+000046c0: 666f 756e 642e 204c 6561 7669 6e67 2229  found. Leaving")
+000046d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000046e0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+000046f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004700: 2067 6c61 6e63 655f 6469 736b 203d 2073   glance_disk = s
+00004710: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00004720: 2767 6c61 6e63 655f 6469 736b 272c 2046  'glance_disk', F
+00004730: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00004740: 2020 2020 2020 6175 7468 5f74 6f6b 656e        auth_token
+00004750: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
+00004760: 2069 6e20 5b73 656c 662e 6f70 7469 6f6e   in [self.option
+00004770: 732e 6765 7428 2774 6f6b 656e 2729 2c0a  s.get('token'),.
+00004780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047a0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000047b0: 732e 656e 7669 726f 6e2e 6765 7428 224f  s.environ.get("O
+000047c0: 535f 544f 4b45 4e22 295d 2069 6620 6520  S_TOKEN")] if e 
+000047d0: 6973 206e 6f74 204e 6f6e 6529 2c20 4e6f  is not None), No
+000047e0: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+000047f0: 2020 2020 6175 7468 5f74 7970 6520 3d20      auth_type = 
+00004800: 2774 6f6b 656e 2720 6966 2061 7574 685f  'token' if auth_
+00004810: 746f 6b65 6e20 6973 206e 6f74 204e 6f6e  token is not Non
+00004820: 6520 656c 7365 2027 7061 7373 776f 7264  e else 'password
+00004830: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00004840: 2020 6966 2061 7574 685f 7479 7065 203d    if auth_type =
+00004850: 3d20 2770 6173 7377 6f72 6427 2061 6e64  = 'password' and
+00004860: 2070 6173 7377 6f72 6420 6973 204e 6f6e   password is Non
+00004870: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004880: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
+00004890: 7373 696e 6720 7061 7373 776f 7264 2069  ssing password i
+000048a0: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+000048b0: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+000048c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048d0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+000048e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000048f0: 6620 6175 7468 5f74 7970 6520 3d3d 2027  f auth_type == '
+00004900: 746f 6b65 6e27 3a0a 2020 2020 2020 2020  token':.        
+00004910: 2020 2020 2020 2020 2020 2020 7573 6572              user
+00004920: 2c20 7061 7373 776f 7264 2c20 646f 6d61  , password, doma
+00004930: 696e 203d 204e 6f6e 652c 204e 6f6e 652c  in = None, None,
+00004940: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00004950: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
+00004960: 2e70 726f 7669 6465 7273 2e6f 7065 6e73  .providers.opens
+00004970: 7461 636b 2069 6d70 6f72 7420 4b6f 7065  tack import Kope
+00004980: 6e73 7461 636b 0a20 2020 2020 2020 2020  nstack.         
+00004990: 2020 2020 2020 206b 203d 204b 6f70 656e         k = Kopen
+000049a0: 7374 6163 6b28 686f 7374 3d73 656c 662e  stack(host=self.
+000049b0: 686f 7374 2c20 706f 7274 3d73 656c 662e  host, port=self.
+000049c0: 706f 7274 2c20 7573 6572 3d75 7365 722c  port, user=user,
+000049d0: 2070 6173 7377 6f72 643d 7061 7373 776f   password=passwo
+000049e0: 7264 2c20 7665 7273 696f 6e3d 7665 7273  rd, version=vers
+000049f0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00004a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a10: 2020 2020 6465 6275 673d 6465 6275 672c      debug=debug,
+00004a20: 2070 726f 6a65 6374 3d70 726f 6a65 6374   project=project
+00004a30: 2c20 646f 6d61 696e 3d64 6f6d 6169 6e2c  , domain=domain,
+00004a40: 2061 7574 685f 7572 6c3d 6175 7468 5f75   auth_url=auth_u
+00004a50: 726c 2c20 6361 5f66 696c 653d 6361 5f66  rl, ca_file=ca_f
+00004a60: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
+00004a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a80: 2020 2020 6578 7465 726e 616c 5f6e 6574      external_net
+00004a90: 776f 726b 3d65 7874 6572 6e61 6c5f 6e65  work=external_ne
+00004aa0: 7477 6f72 6b2c 2072 6567 696f 6e5f 6e61  twork, region_na
+00004ab0: 6d65 3d72 6567 696f 6e5f 6e61 6d65 2c20  me=region_name, 
+00004ac0: 676c 616e 6365 5f64 6973 6b3d 676c 616e  glance_disk=glan
+00004ad0: 6365 5f64 6973 6b2c 0a20 2020 2020 2020  ce_disk,.       
+00004ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004af0: 2020 2020 2020 2020 6175 7468 5f74 7970          auth_typ
+00004b00: 653d 6175 7468 5f74 7970 652c 2061 7574  e=auth_type, aut
+00004b10: 685f 746f 6b65 6e3d 6175 7468 5f74 6f6b  h_token=auth_tok
+00004b20: 656e 290a 2020 2020 2020 2020 2020 2020  en).            
+00004b30: 656c 6966 2073 656c 662e 7479 7065 203d  elif self.type =
+00004b40: 3d20 2776 7370 6865 7265 273a 0a20 2020  = 'vsphere':.   
+00004b50: 2020 2020 2020 2020 2020 2020 2075 7365               use
+00004b60: 7220 3d20 7365 6c66 2e6f 7074 696f 6e73  r = self.options
+00004b70: 2e67 6574 2827 7573 6572 2729 0a20 2020  .get('user').   
+00004b80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004b90: 7573 6572 2069 7320 4e6f 6e65 3a0a 2020  user is None:.  
+00004ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bb0: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
+00004bc0: 2075 7365 7220 696e 2074 6865 2063 6f6e   user in the con
+00004bd0: 6669 6775 7261 7469 6f6e 2e20 4c65 6176  figuration. Leav
+00004be0: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+00004bf0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00004c00: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00004c10: 2020 2020 2020 7061 7373 776f 7264 203d        password =
+00004c20: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00004c30: 7428 2770 6173 7377 6f72 6427 290a 2020  t('password').  
+00004c40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00004c50: 2070 6173 7377 6f72 6420 6973 204e 6f6e   password is Non
+00004c60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004c70: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
+00004c80: 7373 696e 6720 7061 7373 776f 7264 2069  ssing password i
+00004c90: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+00004ca0: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+00004cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cc0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00004cd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004ce0: 6c75 7374 6572 203d 2073 656c 662e 6f70  luster = self.op
+00004cf0: 7469 6f6e 732e 6765 7428 2763 6c75 7374  tions.get('clust
+00004d00: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
+00004d10: 2020 2020 2069 6620 636c 7573 7465 7220       if cluster 
+00004d20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00004d30: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00004d40: 6f72 2822 4d69 7373 696e 6720 636c 7573  or("Missing clus
+00004d50: 7465 7220 696e 2074 6865 2063 6f6e 6669  ter in the confi
+00004d60: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
+00004d70: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+00004d80: 2020 2020 6461 7461 6365 6e74 6572 203d      datacenter =
+00004d90: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00004da0: 7428 2764 6174 6163 656e 7465 7227 290a  t('datacenter').
+00004db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dc0: 6966 2064 6174 6163 656e 7465 7220 6973  if datacenter is
+00004dd0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00004de0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00004df0: 2822 4d69 7373 696e 6720 6461 7461 6365  ("Missing datace
+00004e00: 6e74 6572 2069 6e20 7468 6520 636f 6e66  nter in the conf
+00004e10: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
+00004e20: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+00004e30: 2020 2020 2069 736f 666f 6c64 6572 203d       isofolder =
+00004e40: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00004e50: 7428 2769 736f 666f 6c64 6572 2729 0a20  t('isofolder'). 
+00004e60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004e70: 6620 6973 6f66 6f6c 6465 7220 6973 206e  f isofolder is n
+00004e80: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00004e90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004ea0: 272f 2720 6e6f 7420 696e 2069 736f 666f  '/' not in isofo
+00004eb0: 6c64 6572 3a0a 2020 2020 2020 2020 2020  lder:.          
+00004ec0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00004ed0: 6f70 6f6f 6c20 3d20 7365 6c66 2e70 6f6f  opool = self.poo
+00004ee0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00004ef0: 2020 2020 2020 656c 6966 2027 5b27 206e        elif '[' n
+00004f00: 6f74 2069 6e20 6973 6f66 6f6c 6465 723a  ot in isofolder:
+00004f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f20: 2020 2020 2020 2020 2069 736f 666f 6c64           isofold
+00004f30: 6572 203d 2069 736f 666f 6c64 6572 2e73  er = isofolder.s
+00004f40: 706c 6974 2827 2f27 290a 2020 2020 2020  plit('/').      
+00004f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f60: 2020 6973 6f70 6f6f 6c20 3d20 6973 6f66    isopool = isof
+00004f70: 6f6c 6465 725b 305d 0a20 2020 2020 2020  older[0].       
+00004f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f90: 2069 736f 666f 6c64 6572 203d 2069 736f   isofolder = iso
+00004fa0: 666f 6c64 6572 5b31 3a5d 0a20 2020 2020  folder[1:].     
+00004fb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004fc0: 736f 666f 6c64 6572 203d 2066 275b 7b69  sofolder = f'[{i
+00004fd0: 736f 706f 6f6c 7d5d 2f7b 6973 6f66 6f6c  sopool}]/{isofol
+00004fe0: 6465 727d 270a 2020 2020 2020 2020 2020  der}'.          
+00004ff0: 2020 2020 2020 6669 6c74 6572 766d 7320        filtervms 
+00005000: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00005010: 6574 2827 6669 6c74 6572 766d 7327 2c20  et('filtervms', 
+00005020: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00005030: 2020 2020 2020 2066 696c 7465 7275 7365         filteruse
+00005040: 7220 3d20 7365 6c66 2e6f 7074 696f 6e73  r = self.options
+00005050: 2e67 6574 2827 6669 6c74 6572 7573 6572  .get('filteruser
+00005060: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
+00005070: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00005080: 7461 6720 3d20 7365 6c66 2e6f 7074 696f  tag = self.optio
+00005090: 6e73 2e67 6574 2827 6669 6c74 6572 7461  ns.get('filterta
+000050a0: 6727 290a 2020 2020 2020 2020 2020 2020  g').            
+000050b0: 2020 2020 6361 7465 676f 7279 203d 2073      category = s
+000050c0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+000050d0: 2763 6174 6567 6f72 7927 2c20 276b 636c  'category', 'kcl
+000050e0: 6927 290a 2020 2020 2020 2020 2020 2020  i').            
+000050f0: 2020 2020 6261 7365 666f 6c64 6572 203d      basefolder =
+00005100: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00005110: 7428 2762 6173 6566 6f6c 6465 7227 290a  t('basefolder').
+00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005130: 6476 7320 3d20 7365 6c66 2e6f 7074 696f  dvs = self.optio
+00005140: 6e73 2e67 6574 2827 6476 7327 2c20 5472  ns.get('dvs', Tr
+00005150: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00005160: 2020 2020 696d 706f 7274 5f6e 6574 776f      import_netwo
+00005170: 726b 203d 2073 656c 662e 6f70 7469 6f6e  rk = self.option
+00005180: 732e 6765 7428 2769 6d70 6f72 745f 6e65  s.get('import_ne
+00005190: 7477 6f72 6b27 2c20 2756 4d20 4e65 7477  twork', 'VM Netw
+000051a0: 6f72 6b27 290a 2020 2020 2020 2020 2020  ork').          
+000051b0: 2020 2020 2020 7469 6d65 6f75 7420 3d20        timeout = 
+000051c0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+000051d0: 2827 7469 6d65 6f75 7427 2c20 3237 3030  ('timeout', 2700
+000051e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000051f0: 2020 666f 7263 655f 706f 6f6c 203d 2073    force_pool = s
+00005200: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00005210: 2766 6f72 6365 5f70 6f6f 6c27 2c20 4661  'force_pool', Fa
+00005220: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+00005230: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
+00005240: 7072 6f76 6964 6572 732e 7673 7068 6572  providers.vspher
+00005250: 6520 696d 706f 7274 204b 7370 6865 7265  e import Ksphere
+00005260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005270: 206b 203d 204b 7370 6865 7265 2873 656c   k = Ksphere(sel
+00005280: 662e 686f 7374 2c20 7573 6572 2c20 7061  f.host, user, pa
+00005290: 7373 776f 7264 2c20 6461 7461 6365 6e74  ssword, datacent
+000052a0: 6572 2c20 636c 7573 7465 722c 2069 736f  er, cluster, iso
+000052b0: 666f 6c64 6572 3d69 736f 666f 6c64 6572  folder=isofolder
+000052c0: 2c20 6465 6275 673d 6465 6275 672c 0a20  , debug=debug,. 
+000052d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052e0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+000052f0: 7276 6d73 3d66 696c 7465 7276 6d73 2c20  rvms=filtervms, 
+00005300: 6669 6c74 6572 7573 6572 3d66 696c 7465  filteruser=filte
+00005310: 7275 7365 722c 2066 696c 7465 7274 6167  ruser, filtertag
+00005320: 3d66 696c 7465 7274 6167 2c20 6361 7465  =filtertag, cate
+00005330: 676f 7279 3d63 6174 6567 6f72 792c 0a20  gory=category,. 
+00005340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005350: 2020 2020 2020 2020 2020 2062 6173 6566             basef
+00005360: 6f6c 6465 723d 6261 7365 666f 6c64 6572  older=basefolder
+00005370: 2c20 6476 733d 6476 732c 2069 6d70 6f72  , dvs=dvs, impor
+00005380: 745f 6e65 7477 6f72 6b3d 696d 706f 7274  t_network=import
+00005390: 5f6e 6574 776f 726b 2c20 7469 6d65 6f75  _network, timeou
+000053a0: 743d 7469 6d65 6f75 742c 0a20 2020 2020  t=timeout,.     
+000053b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000053c0: 2020 2020 2020 2066 6f72 6365 5f70 6f6f         force_poo
+000053d0: 6c3d 666f 7263 655f 706f 6f6c 290a 2020  l=force_pool).  
+000053e0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+000053f0: 656c 662e 7479 7065 203d 3d20 2770 6163  elf.type == 'pac
+00005400: 6b65 7427 3a0a 2020 2020 2020 2020 2020  ket':.          
+00005410: 2020 2020 2020 6175 7468 5f74 6f6b 656e        auth_token
+00005420: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00005430: 6765 7428 2761 7574 685f 746f 6b65 6e27  get('auth_token'
+00005440: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005450: 2020 6966 2061 7574 685f 746f 6b65 6e20    if auth_token 
+00005460: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00005470: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00005480: 6f72 2822 4d69 7373 696e 6720 6175 7468  or("Missing auth
+00005490: 5f74 6f6b 656e 2069 6e20 7468 6520 636f  _token in the co
+000054a0: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
+000054b0: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
+000054c0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+000054d0: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+000054e0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+000054f0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00005500: 7428 2770 726f 6a65 6374 2729 0a20 2020  t('project').   
+00005510: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00005520: 7072 6f6a 6563 7420 6973 204e 6f6e 653a  project is None:
+00005530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005540: 2020 2020 2065 7272 6f72 2822 4d69 7373       error("Miss
+00005550: 696e 6720 7072 6f6a 6563 7420 696e 2074  ing project in t
+00005560: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00005570: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+00005580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005590: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+000055a0: 2020 2020 2020 2020 2020 2020 6661 6369              faci
+000055b0: 6c69 7479 203d 2073 656c 662e 6f70 7469  lity = self.opti
+000055c0: 6f6e 732e 6765 7428 2766 6163 696c 6974  ons.get('facilit
+000055d0: 7927 290a 2020 2020 2020 2020 2020 2020  y').            
+000055e0: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
+000055f0: 726f 7669 6465 7273 2e70 6163 6b65 7420  roviders.packet 
+00005600: 696d 706f 7274 204b 7061 636b 6574 0a20  import Kpacket. 
+00005610: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00005620: 203d 204b 7061 636b 6574 2861 7574 685f   = Kpacket(auth_
+00005630: 746f 6b65 6e2c 2070 726f 6a65 6374 2c20  token, project, 
+00005640: 6661 6369 6c69 7479 3d66 6163 696c 6974  facility=facilit
+00005650: 792c 2064 6562 7567 3d64 6562 7567 2c0a  y, debug=debug,.
+00005660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005670: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+00005680: 656c 686f 7374 3d73 656c 662e 7475 6e6e  elhost=self.tunn
+00005690: 656c 686f 7374 2c20 7475 6e6e 656c 7573  elhost, tunnelus
+000056a0: 6572 3d73 656c 662e 7475 6e6e 656c 7573  er=self.tunnelus
+000056b0: 6572 2c20 7475 6e6e 656c 706f 7274 3d73  er, tunnelport=s
+000056c0: 656c 662e 7475 6e6e 656c 706f 7274 2c0a  elf.tunnelport,.
+000056d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056e0: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+000056f0: 656c 6469 723d 7365 6c66 2e74 756e 6e65  eldir=self.tunne
+00005700: 6c64 6972 290a 2020 2020 2020 2020 2020  ldir).          
+00005710: 2020 656c 6966 2073 656c 662e 7479 7065    elif self.type
+00005720: 203d 3d20 2777 6562 273a 0a20 2020 2020   == 'web':.     
+00005730: 2020 2020 2020 2020 2020 2070 6f72 7420             port 
+00005740: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00005750: 6574 2827 706f 7274 272c 2038 3030 3029  et('port', 8000)
+00005760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005770: 206c 6f63 616c 6b75 6265 203d 2073 656c   localkube = sel
+00005780: 662e 6f70 7469 6f6e 732e 6765 7428 276c  f.options.get('l
+00005790: 6f63 616c 6b75 6265 272c 2054 7275 6529  ocalkube', True)
+000057a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000057b0: 2066 726f 6d20 6b76 6972 742e 7072 6f76   from kvirt.prov
+000057c0: 6964 6572 732e 7765 6220 696d 706f 7274  iders.web import
+000057d0: 204b 7765 6263 6c69 656e 740a 2020 2020   Kwebclient.    
+000057e0: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+000057f0: 4b77 6562 636c 6965 6e74 2873 656c 662e  Kwebclient(self.
+00005800: 686f 7374 2c20 706f 7274 2c20 6c6f 6361  host, port, loca
+00005810: 6c6b 7562 653d 6c6f 6361 6c6b 7562 652c  lkube=localkube,
+00005820: 2064 6562 7567 3d64 6562 7567 290a 2020   debug=debug).  
+00005830: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00005840: 6c66 2e74 7970 6520 3d20 2777 6562 270a  lf.type = 'web'.
+00005850: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00005860: 206f 6666 6c69 6e65 3a0a 2020 2020 2020   offline:.      
+00005870: 2020 2020 2020 2020 2020 6672 6f6d 206b            from k
+00005880: 7669 7274 2e70 726f 7669 6465 7273 2e66  virt.providers.f
+00005890: 616b 6520 696d 706f 7274 204b 6661 6b65  ake import Kfake
+000058a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000058b0: 206b 203d 204b 6661 6b65 2829 0a20 2020   k = Kfake().   
+000058c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000058d0: 662e 7479 7065 203d 2027 6661 6b65 270a  f.type = 'fake'.
+000058e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000058f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005900: 2020 6966 2073 656c 662e 686f 7374 2069    if self.host i
+00005910: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00005920: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00005930: 7228 2250 726f 626c 656d 2070 6172 7369  r("Problem parsi
+00005940: 6e67 2079 6f75 7220 636f 6e66 6967 7572  ng your configur
+00005950: 6174 696f 6e20 6669 6c65 2229 0a20 2020  ation file").   
+00005960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005970: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00005980: 2020 2020 2020 2020 2020 2020 2073 6573               ses
+00005990: 7369 6f6e 203d 2073 656c 662e 6f70 7469  sion = self.opti
+000059a0: 6f6e 732e 6765 7428 2773 6573 7369 6f6e  ons.get('session
+000059b0: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
+000059c0: 2020 2020 2020 2020 2020 7265 6d6f 7465            remote
+000059d0: 646e 736d 6173 7120 3d20 7365 6c66 2e6f  dnsmasq = self.o
+000059e0: 7074 696f 6e73 2e67 6574 2827 7265 6d6f  ptions.get('remo
+000059f0: 7465 646e 736d 6173 7127 2c20 4661 6c73  tednsmasq', Fals
+00005a00: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00005a10: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
+00005a20: 6f76 6964 6572 732e 6b76 6d20 696d 706f  oviders.kvm impo
+00005a30: 7274 204b 7669 7274 0a20 2020 2020 2020  rt Kvirt.       
+00005a40: 2020 2020 2020 2020 206b 203d 204b 7669           k = Kvi
+00005a50: 7274 2868 6f73 743d 7365 6c66 2e68 6f73  rt(host=self.hos
+00005a60: 742c 2070 6f72 743d 7365 6c66 2e70 6f72  t, port=self.por
+00005a70: 742c 2075 7365 723d 7365 6c66 2e75 7365  t, user=self.use
+00005a80: 722c 2070 726f 746f 636f 6c3d 7365 6c66  r, protocol=self
+00005a90: 2e70 726f 746f 636f 6c2c 2075 726c 3d73  .protocol, url=s
+00005aa0: 656c 662e 7572 6c2c 0a20 2020 2020 2020  elf.url,.       
+00005ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ac0: 2020 2064 6562 7567 3d64 6562 7567 2c20     debug=debug, 
+00005ad0: 696e 7365 6375 7265 3d73 656c 662e 696e  insecure=self.in
+00005ae0: 7365 6375 7265 2c20 7365 7373 696f 6e3d  secure, session=
+00005af0: 7365 7373 696f 6e2c 2072 656d 6f74 6564  session, remoted
+00005b00: 6e73 6d61 7371 3d72 656d 6f74 6564 6e73  nsmasq=remotedns
+00005b10: 6d61 7371 290a 2020 2020 2020 2020 2020  masq).          
+00005b20: 2020 6966 206b 2e63 6f6e 6e20 6973 204e    if k.conn is N
+00005b30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00005b40: 2020 2020 2065 7272 6f72 2866 2243 6f75       error(f"Cou
+00005b50: 6c64 6e27 7420 636f 6e6e 6563 7420 746f  ldn't connect to
+00005b60: 2063 6c69 656e 7420 7b73 656c 662e 636c   client {self.cl
+00005b70: 6965 6e74 7d2e 204c 6561 7669 6e67 2e2e  ient}. Leaving..
+00005b80: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00005b90: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00005ba0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00005bb0: 6578 7472 6163 6c69 656e 7420 696e 2073  extraclient in s
+00005bc0: 656c 662e 5f65 7874 7261 636c 6965 6e74  elf._extraclient
+00005bd0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00005be0: 2020 2069 6620 6578 7472 6163 6c69 656e     if extraclien
+00005bf0: 7420 6e6f 7420 696e 2073 656c 662e 696e  t not in self.in
+00005c00: 693a 0a20 2020 2020 2020 2020 2020 2020  i:.             
+00005c10: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+00005c20: 224d 6973 7369 6e67 2073 6563 7469 6f6e  "Missing section
+00005c30: 2066 6f72 2063 6c69 656e 7420 7b65 7874   for client {ext
+00005c40: 7261 636c 6965 6e74 7d20 696e 2063 6f6e  raclient} in con
+00005c50: 6669 6720 6669 6c65 2e20 5472 7969 6e67  fig file. Trying
+00005c60: 2074 6f20 636f 6e6e 6563 742e 2e2e 2229   to connect...")
+00005c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005c80: 2020 2020 2073 656c 662e 696e 695b 6578       self.ini[ex
+00005c90: 7472 6163 6c69 656e 745d 203d 207b 2768  traclient] = {'h
+00005ca0: 6f73 7427 3a20 6578 7472 6163 6c69 656e  ost': extraclien
+00005cb0: 747d 0a20 2020 2020 2020 2020 2020 2020  t}.             
+00005cc0: 2020 2063 203d 204b 636f 6e66 6967 2863     c = Kconfig(c
+00005cd0: 6c69 656e 743d 6578 7472 6163 6c69 656e  lient=extraclien
+00005ce0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00005cf0: 2020 2065 203d 2063 2e6b 0a20 2020 2020     e = c.k.     
+00005d00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005d10: 6578 7472 6163 6c69 656e 7473 5b65 7874  extraclients[ext
+00005d20: 7261 636c 6965 6e74 5d20 3d20 650a 2020  raclient] = e.  
+00005d30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00005d40: 2065 2e63 6f6e 6e20 6973 204e 6f6e 653a   e.conn is None:
+00005d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005d60: 2020 2020 2065 7272 6f72 2866 2243 6f75       error(f"Cou
+00005d70: 6c64 6e27 7420 636f 6e6e 6563 7420 746f  ldn't connect to
+00005d80: 2073 7065 6369 6679 2068 7970 6572 7669   specify hypervi
+00005d90: 736f 7220 7b65 7874 7261 636c 6965 6e74  sor {extraclient
+00005da0: 7d2e 204c 6561 7669 6e67 2e2e 2e22 290a  }. Leaving...").
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00005dd0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00005de0: 6173 6174 7472 2873 656c 662c 2027 616c  asattr(self, 'al
+00005df0: 676f 7269 7468 6d27 293a 0a20 2020 2020  gorithm'):.     
+00005e00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00005e10: 6c66 2e61 6c67 6f72 6974 686d 203d 3d20  lf.algorithm == 
+00005e20: 2766 7265 6527 3a0a 2020 2020 2020 2020  'free':.        
+00005e30: 2020 2020 2020 2020 2020 2020 7570 7374              upst
+00005e40: 6174 7573 203d 205b 2761 6374 6976 6527  atus = ['active'
+00005e50: 2c20 2775 7027 2c20 2772 756e 6e69 6e67  , 'up', 'running
+00005e60: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00005e70: 2020 2020 2020 2061 6c6c 636c 6973 203d         allclis =
+00005e80: 207b 7365 6c66 2e63 6c69 656e 743a 206b   {self.client: k
+00005e90: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00005ea0: 2020 2020 2020 616c 6c63 6c69 732e 7570        allclis.up
+00005eb0: 6461 7465 2873 656c 662e 6578 7472 6163  date(self.extrac
+00005ec0: 6c69 656e 7473 290a 2020 2020 2020 2020  lients).        
+00005ed0: 2020 2020 2020 2020 2020 2020 6d69 6e63              minc
+00005ee0: 6c69 2c20 6d69 6e76 6d73 203d 204e 6f6e  li, minvms = Non
+00005ef0: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
+00005f00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00005f10: 636c 6920 696e 2061 6c6c 636c 6973 3a0a  cli in allclis:.
+00005f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f30: 2020 2020 2020 2020 636c 6976 6d73 203d          clivms =
+00005f40: 206c 656e 285b 766d 2066 6f72 2076 6d20   len([vm for vm 
+00005f50: 696e 2061 6c6c 636c 6973 5b63 6c69 5d2e  in allclis[cli].
+00005f60: 6c69 7374 2829 2069 6620 766d 5b27 7374  list() if vm['st
+00005f70: 6174 7573 275d 2e6c 6f77 6572 2829 2069  atus'].lower() i
+00005f80: 6e20 7570 7374 6174 7573 5d29 0a20 2020  n upstatus]).   
+00005f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fa0: 2020 2020 2069 6620 6d69 6e76 6d73 2069       if minvms i
+00005fb0: 7320 4e6f 6e65 206f 7220 636c 6976 6d73  s None or clivms
+00005fc0: 203c 206d 696e 766d 733a 0a20 2020 2020   < minvms:.     
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fe0: 2020 2020 2020 206d 696e 636c 6920 3d20         mincli = 
+00005ff0: 636c 690a 2020 2020 2020 2020 2020 2020  cli.            
+00006000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006010: 6d69 6e76 6d73 203d 2063 6c69 766d 730a  minvms = clivms.
+00006020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006030: 2020 2020 6966 206d 696e 636c 6920 213d      if mincli !=
+00006040: 2073 656c 662e 636c 6965 6e74 3a0a 2020   self.client:.  
+00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006060: 2020 2020 2020 7365 6c66 2e65 7874 7261        self.extra
+00006070: 636c 6965 6e74 735b 7365 6c66 2e63 6c69  clients[self.cli
+00006080: 656e 745d 203d 206b 0a20 2020 2020 2020  ent] = k.       
+00006090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060a0: 206b 203d 2073 656c 662e 6578 7472 6163   k = self.extrac
+000060b0: 6c69 656e 7473 5b6d 696e 636c 695d 0a20  lients[mincli]. 
+000060c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060d0: 2020 2020 2020 2064 656c 2073 656c 662e         del self.
+000060e0: 6578 7472 6163 6c69 656e 7473 5b6d 696e  extraclients[min
+000060f0: 636c 695d 0a20 2020 2020 2020 2020 2020  cli].           
+00006100: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00006110: 662e 636c 6965 6e74 203d 206d 696e 636c  f.client = mincl
+00006120: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
+00006130: 2020 6966 2073 656c 662e 616c 676f 7269    if self.algori
+00006140: 7468 6d20 3d3d 2027 6261 6c61 6e63 6527  thm == 'balance'
+00006150: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006160: 2020 2020 2020 6d65 6d62 6572 7320 3d20        members = 
+00006170: 5b73 656c 662e 636c 6965 6e74 5d20 2b20  [self.client] + 
+00006180: 6c69 7374 2873 656c 662e 6578 7472 6163  list(self.extrac
+00006190: 6c69 656e 7473 2e6b 6579 7328 2929 0a20  lients.keys()). 
+000061a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061b0: 2020 206c 6173 7476 6d20 3d20 2225 732f     lastvm = "%s/
+000061c0: 2e6b 636c 692f 766d 2220 2520 6f73 2e65  .kcli/vm" % os.e
+000061d0: 6e76 6972 6f6e 2e67 6574 2827 484f 4d45  nviron.get('HOME
+000061e0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000061f0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00006200: 682e 6578 6973 7473 286c 6173 7476 6d29  h.exists(lastvm)
+00006210: 2061 6e64 206f 732e 7374 6174 286c 6173   and os.stat(las
+00006220: 7476 6d29 2e73 745f 7369 7a65 203e 2030  tvm).st_size > 0
+00006230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006240: 2020 2020 2020 2020 2020 666f 7220 6c69            for li
+00006250: 6e65 2069 6e20 6f70 656e 286c 6173 7476  ne in open(lastv
+00006260: 6d29 2e72 6561 646c 696e 6573 2829 3a0a  m).readlines():.
+00006270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006280: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00006290: 203d 206c 696e 652e 7370 6c69 7428 2720   = line.split(' 
+000062a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000062b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000062c0: 6620 6c65 6e28 6c69 6e65 2920 213d 2032  f len(line) != 2
+000062d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000062e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062f0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
 00006300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006310: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00006320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006330: 2020 2020 2020 636c 6920 3d20 6c69 6e65        cli = line
-00006340: 5b30 5d2e 7374 7269 7028 290a 2020 2020  [0].strip().    
-00006350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006360: 2020 2020 2020 2020 6966 2063 6c69 2069          if cli i
-00006370: 6e20 6d65 6d62 6572 7320 616e 6420 6d65  n members and me
-00006380: 6d62 6572 732e 696e 6465 7828 636c 6929  mbers.index(cli)
-00006390: 203c 206c 656e 286d 656d 6265 7273 293a   < len(members):
-000063a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000063b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063c0: 2063 6c69 696e 6465 7820 3d20 6d65 6d62   cliindex = memb
-000063d0: 6572 732e 696e 6465 7828 636c 6929 0a20  ers.index(cli). 
-000063e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00006400: 6577 636c 6920 3d20 6d65 6d62 6572 735b  ewcli = members[
-00006410: 2863 6c69 696e 6465 7820 2b20 3129 2025  (cliindex + 1) %
-00006420: 206c 656e 286d 656d 6265 7273 295d 0a20   len(members)]. 
-00006430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006440: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006450: 6620 6e65 7763 6c69 2021 3d20 7365 6c66  f newcli != self
-00006460: 2e63 6c69 656e 743a 0a20 2020 2020 2020  .client:.       
-00006470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006480: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00006490: 662e 6578 7472 6163 6c69 656e 7473 5b73  f.extraclients[s
-000064a0: 656c 662e 636c 6965 6e74 5d20 3d20 6b0a  elf.client] = k.
-000064b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064d0: 2020 2020 6b20 3d20 7365 6c66 2e65 7874      k = self.ext
-000064e0: 7261 636c 6965 6e74 735b 6e65 7763 6c69  raclients[newcli
-000064f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006510: 2020 2020 2020 6465 6c20 7365 6c66 2e65        del self.e
-00006520: 7874 7261 636c 6965 6e74 735b 6e65 7763  xtraclients[newc
-00006530: 6c69 5d0a 2020 2020 2020 2020 2020 2020  li].            
-00006540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006550: 2020 2020 2020 2020 7365 6c66 2e63 6c69          self.cli
-00006560: 656e 7420 3d20 6e65 7763 6c69 0a20 2020  ent = newcli.   
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00006590: 616b 0a0a 2020 2020 2020 2020 2020 2020  ak..            
-000065a0: 2020 2020 7070 7269 6e74 2866 2253 656c      pprint(f"Sel
-000065b0: 6563 7469 6e67 2063 6c69 656e 7420 7b73  ecting client {s
-000065c0: 656c 662e 636c 6965 6e74 7d20 6672 6f6d  elf.client} from
-000065d0: 2067 726f 7570 207b 7365 6c66 2e67 726f   group {self.gro
-000065e0: 7570 7d22 290a 2020 2020 2020 2020 7365  up}").        se
-000065f0: 6c66 2e6b 203d 206b 0a20 2020 2020 2020  lf.k = k.       
-00006600: 2064 6566 6175 6c74 5f64 6174 6120 3d20   default_data = 
-00006610: 7b27 636f 6e66 6967 5f25 7327 2025 206b  {'config_%s' % k
-00006620: 3a20 7365 6c66 2e64 6566 6175 6c74 5b6b  : self.default[k
-00006630: 5d20 666f 7220 6b20 696e 2073 656c 662e  ] for k in self.
-00006640: 6465 6661 756c 747d 0a20 2020 2020 2020  default}.       
-00006650: 2063 6f6e 6669 675f 6461 7461 203d 207b   config_data = {
-00006660: 2763 6f6e 6669 675f 2573 2720 2520 6b3a  'config_%s' % k:
-00006670: 2073 656c 662e 696e 695b 7365 6c66 2e63   self.ini[self.c
-00006680: 6c69 656e 745d 5b6b 5d20 666f 7220 6b20  lient][k] for k 
-00006690: 696e 2073 656c 662e 696e 695b 7365 6c66  in self.ini[self
-000066a0: 2e63 6c69 656e 745d 7d0a 2020 2020 2020  .client]}.      
-000066b0: 2020 636f 6e66 6967 5f64 6174 615b 2763    config_data['c
-000066c0: 6f6e 6669 675f 7479 7065 275d 203d 2063  onfig_type'] = c
-000066d0: 6f6e 6669 675f 6461 7461 2e67 6574 2827  onfig_data.get('
-000066e0: 636f 6e66 6967 5f74 7970 6527 2c20 276b  config_type', 'k
-000066f0: 766d 2729 0a20 2020 2020 2020 2063 6f6e  vm').        con
-00006700: 6669 675f 6461 7461 5b27 636f 6e66 6967  fig_data['config
-00006710: 5f68 6f73 7427 5d20 3d20 636f 6e66 6967  _host'] = config
-00006720: 5f64 6174 612e 6765 7428 2763 6f6e 6669  _data.get('confi
-00006730: 675f 686f 7374 272c 2027 3132 372e 302e  g_host', '127.0.
-00006740: 302e 3127 290a 2020 2020 2020 2020 6465  0.1').        de
-00006750: 6661 756c 745f 7573 6572 203d 2067 6574  fault_user = get
-00006760: 7573 6572 2829 2069 6620 636f 6e66 6967  user() if config
-00006770: 5f64 6174 615b 2763 6f6e 6669 675f 7479  _data['config_ty
-00006780: 7065 275d 203d 3d20 276b 766d 275c 0a20  pe'] == 'kvm'\. 
-00006790: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
-000067a0: 656c 662e 686f 7374 2069 6e20 5b27 6c6f  elf.host in ['lo
-000067b0: 6361 6c68 6f73 7427 2c20 2731 3237 2e30  calhost', '127.0
-000067c0: 2e30 2e31 275d 2065 6c73 6520 2772 6f6f  .0.1'] else 'roo
-000067d0: 7427 0a20 2020 2020 2020 2063 6f6e 6669  t'.        confi
-000067e0: 675f 6461 7461 5b27 636f 6e66 6967 5f75  g_data['config_u
-000067f0: 7365 7227 5d20 3d20 636f 6e66 6967 5f64  ser'] = config_d
-00006800: 6174 612e 6765 7428 2763 6f6e 6669 675f  ata.get('config_
-00006810: 7573 6572 272c 2064 6566 6175 6c74 5f75  user', default_u
-00006820: 7365 7229 0a20 2020 2020 2020 2073 656c  ser).        sel
-00006830: 662e 6f76 6572 7269 6465 732e 7570 6461  f.overrides.upda
-00006840: 7465 2864 6566 6175 6c74 5f64 6174 6129  te(default_data)
-00006850: 0a20 2020 2020 2020 2073 656c 662e 6f76  .        self.ov
-00006860: 6572 7269 6465 732e 7570 6461 7465 2863  errides.update(c
-00006870: 6f6e 6669 675f 6461 7461 290a 0a20 2020  onfig_data)..   
-00006880: 2064 6566 2063 7265 6174 655f 766d 2873   def create_vm(s
-00006890: 656c 662c 206e 616d 652c 2070 726f 6669  elf, name, profi
-000068a0: 6c65 3d4e 6f6e 652c 206f 7665 7272 6964  le=None, overrid
-000068b0: 6573 3d7b 7d2c 2063 7573 746f 6d70 726f  es={}, custompro
-000068c0: 6669 6c65 3d7b 7d2c 206b 3d4e 6f6e 652c  file={}, k=None,
-000068d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000068e0: 2020 2070 6c61 6e3d 276b 7669 7274 272c     plan='kvirt',
-000068f0: 2062 6173 6564 6972 3d27 2e27 2c20 636c   basedir='.', cl
-00006900: 6965 6e74 3d4e 6f6e 652c 206f 6e66 6c79  ient=None, onfly
-00006910: 3d4e 6f6e 652c 206f 6e6c 7961 7373 6574  =None, onlyasset
-00006920: 733d 4661 6c73 6529 3a0a 2020 2020 2020  s=False):.      
-00006930: 2020 6f76 6572 7269 6465 732e 7570 6461    overrides.upda
-00006940: 7465 2873 656c 662e 6f76 6572 7269 6465  te(self.override
-00006950: 7329 0a20 2020 2020 2020 2077 726f 6e67  s).        wrong
-00006960: 5f6f 7665 7272 6964 6573 203d 205b 7920  _overrides = [y 
-00006970: 666f 7220 7920 696e 206f 7665 7272 6964  for y in overrid
-00006980: 6573 2069 6620 272d 2720 696e 2079 5d0a  es if '-' in y].
-00006990: 2020 2020 2020 2020 6966 2077 726f 6e67          if wrong
-000069a0: 5f6f 7665 7272 6964 6573 3a0a 2020 2020  _overrides:.    
-000069b0: 2020 2020 2020 2020 666f 7220 7772 6f6e          for wron
-000069c0: 675f 6f76 6572 7269 6465 2069 6e20 7772  g_override in wr
-000069d0: 6f6e 675f 6f76 6572 7269 6465 733a 0a20  ong_overrides:. 
-000069e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000069f0: 7272 6f72 2866 2249 6e63 6f72 7265 6374  rror(f"Incorrect
-00006a00: 2070 6172 616d 6574 6572 207b 7772 6f6e   parameter {wron
-00006a10: 675f 6f76 6572 7269 6465 737d 2e20 4879  g_overrides}. Hy
-00006a20: 7068 656e 7320 6172 6520 6e6f 7420 616c  phens are not al
-00006a30: 6c6f 7765 6422 290a 2020 2020 2020 2020  lowed").        
-00006a40: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00006a50: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
-00006a60: 2027 7265 6173 6f6e 273a 2027 496e 636f   'reason': 'Inco
-00006a70: 7272 6563 7420 7061 7261 6d65 7465 7273  rrect parameters
-00006a80: 2066 6f75 6e64 277d 0a20 2020 2020 2020   found'}.       
-00006a90: 206f 7665 7272 6964 6573 5b27 6e61 6d65   overrides['name
-00006aa0: 275d 203d 206e 616d 650a 2020 2020 2020  '] = name.      
-00006ab0: 2020 6b75 6265 203d 206f 7665 7272 6964    kube = overrid
-00006ac0: 6573 2e67 6574 2827 6b75 6265 2729 0a20  es.get('kube'). 
-00006ad0: 2020 2020 2020 206b 7562 6574 7970 6520         kubetype 
-00006ae0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-00006af0: 276b 7562 6574 7970 6527 290a 2020 2020  'kubetype').    
-00006b00: 2020 2020 6b20 3d20 7365 6c66 2e6b 2069      k = self.k i
-00006b10: 6620 6b20 6973 204e 6f6e 6520 656c 7365  f k is None else
-00006b20: 206b 0a20 2020 2020 2020 2063 7573 746f   k.        custo
-00006b30: 6d5f 7265 6769 6f6e 203d 206e 6578 7428  m_region = next(
-00006b40: 2865 2066 6f72 2065 2069 6e20 5b63 7573  (e for e in [cus
-00006b50: 746f 6d70 726f 6669 6c65 2e67 6574 2827  tomprofile.get('
-00006b60: 7265 6769 6f6e 2729 2c20 6f76 6572 7269  region'), overri
-00006b70: 6465 732e 6765 7428 2772 6567 696f 6e27  des.get('region'
-00006b80: 295d 2069 6620 6520 6973 206e 6f74 204e  )] if e is not N
-00006b90: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
-00006ba0: 2020 2020 6966 2063 7573 746f 6d5f 7265      if custom_re
-00006bb0: 6769 6f6e 2069 7320 6e6f 7420 4e6f 6e65  gion is not None
-00006bc0: 2061 6e64 2068 6173 6174 7472 286b 2c20   and hasattr(k, 
-00006bd0: 2772 6567 696f 6e27 293a 0a20 2020 2020  'region'):.     
-00006be0: 2020 2020 2020 206b 2e72 6567 696f 6e20         k.region 
-00006bf0: 3d20 6375 7374 6f6d 5f72 6567 696f 6e0a  = custom_region.
-00006c00: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00006c10: 6173 6174 7472 286b 2c20 277a 6f6e 6527  asattr(k, 'zone'
-00006c20: 2920 616e 6420 6375 7374 6f6d 5f72 6567  ) and custom_reg
-00006c30: 696f 6e20 6e6f 7420 696e 206b 2e7a 6f6e  ion not in k.zon
-00006c40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00006c50: 2020 206b 2e7a 6f6e 6520 3d20 6622 7b63     k.zone = f"{c
-00006c60: 7573 746f 6d5f 7265 6769 6f6e 7d2d 3222  ustom_region}-2"
-00006c70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00006c80: 7365 6c66 2e74 7970 6520 3d3d 2027 6962  self.type == 'ib
-00006c90: 6d27 3a0a 2020 2020 2020 2020 2020 2020  m':.            
-00006ca0: 2020 2020 6b2e 636f 6e6e 2e73 6574 5f73      k.conn.set_s
-00006cb0: 6572 7669 6365 5f75 726c 2866 2268 7474  ervice_url(f"htt
-00006cc0: 7073 3a2f 2f7b 6375 7374 6f6d 5f72 6567  ps://{custom_reg
-00006cd0: 696f 6e7d 2e69 6161 732e 636c 6f75 642e  ion}.iaas.cloud.
-00006ce0: 6962 6d2e 636f 6d2f 7631 2229 0a20 2020  ibm.com/v1").   
-00006cf0: 2020 2020 2063 7573 746f 6d5f 7a6f 6e65       custom_zone
-00006d00: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
-00006d10: 2069 6e20 5b63 7573 746f 6d70 726f 6669   in [customprofi
-00006d20: 6c65 2e67 6574 2827 7a6f 6e65 2729 2c20  le.get('zone'), 
-00006d30: 6f76 6572 7269 6465 732e 6765 7428 277a  overrides.get('z
-00006d40: 6f6e 6527 295d 2069 6620 6520 6973 206e  one')] if e is n
-00006d50: 6f74 204e 6f6e 6529 2c20 4e6f 6e65 290a  ot None), None).
-00006d60: 2020 2020 2020 2020 6966 2063 7573 746f          if custo
-00006d70: 6d5f 7a6f 6e65 2069 7320 6e6f 7420 4e6f  m_zone is not No
-00006d80: 6e65 2061 6e64 2068 6173 6174 7472 286b  ne and hasattr(k
-00006d90: 2c20 277a 6f6e 6527 293a 0a20 2020 2020  , 'zone'):.     
-00006da0: 2020 2020 2020 206b 2e7a 6f6e 6520 3d20         k.zone = 
-00006db0: 6375 7374 6f6d 5f7a 6f6e 650a 2020 2020  custom_zone.    
-00006dc0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
-00006dd0: 7472 286b 2c20 2772 6567 696f 6e27 2920  tr(k, 'region') 
-00006de0: 616e 6420 6b2e 7265 6769 6f6e 206e 6f74  and k.region not
-00006df0: 2069 6e20 6b2e 7a6f 6e65 3a0a 2020 2020   in k.zone:.    
-00006e00: 2020 2020 2020 2020 2020 2020 6b2e 7265              k.re
-00006e10: 6769 6f6e 203d 2063 7573 746f 6d5f 7a6f  gion = custom_zo
-00006e20: 6e65 5b3a 2d32 5d0a 2020 2020 2020 2020  ne[:-2].        
-00006e30: 7475 6e6e 656c 203d 2073 656c 662e 7475  tunnel = self.tu
-00006e40: 6e6e 656c 0a20 2020 2020 2020 2070 726f  nnel.        pro
-00006e50: 6669 6c65 203d 2070 726f 6669 6c65 206f  file = profile o
-00006e60: 7220 6f76 6572 7269 6465 732e 6765 7428  r overrides.get(
-00006e70: 2769 6d61 6765 272c 2027 6b76 6972 7427  'image', 'kvirt'
-00006e80: 290a 2020 2020 2020 2020 6675 6c6c 5f76  ).        full_v
-00006e90: 6f6c 756d 6573 203d 2073 656c 662e 6b2e  olumes = self.k.
-00006ea0: 766f 6c75 6d65 7328 290a 2020 2020 2020  volumes().      
-00006eb0: 2020 766f 6c75 6d65 7320 3d20 5b6f 732e    volumes = [os.
-00006ec0: 7061 7468 2e62 6173 656e 616d 6528 7629  path.basename(v)
-00006ed0: 2066 6f72 2076 2069 6e20 6675 6c6c 5f76   for v in full_v
-00006ee0: 6f6c 756d 6573 5d0a 2020 2020 2020 2020  olumes].        
-00006ef0: 766d 7072 6f66 696c 6573 203d 207b 6b3a  vmprofiles = {k:
-00006f00: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
-00006f10: 656c 662e 7072 6f66 696c 6573 2e69 7465  elf.profiles.ite
-00006f20: 6d73 2829 2069 6620 2774 7970 6527 206e  ms() if 'type' n
-00006f30: 6f74 2069 6e20 7620 6f72 2076 5b27 7479  ot in v or v['ty
-00006f40: 7065 275d 203d 3d20 2776 6d27 7d0a 2020  pe'] == 'vm'}.  
-00006f50: 2020 2020 2020 6966 2063 7573 746f 6d70        if customp
-00006f60: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
-00006f70: 2020 2020 766d 7072 6f66 696c 6573 5b70      vmprofiles[p
-00006f80: 726f 6669 6c65 5d20 3d20 6375 7374 6f6d  rofile] = custom
-00006f90: 7072 6f66 696c 650a 2020 2020 2020 2020  profile.        
-00006fa0: 656c 6966 2070 726f 6669 6c65 2069 6e20  elif profile in 
-00006fb0: 766d 7072 6f66 696c 6573 2061 6e64 206e  vmprofiles and n
-00006fc0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-00006fd0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00006fe0: 7428 6622 4465 706c 6f79 696e 6720 766d  t(f"Deploying vm
-00006ff0: 207b 6e61 6d65 7d20 6672 6f6d 2070 726f   {name} from pro
-00007000: 6669 6c65 207b 7072 6f66 696c 657d 2e2e  file {profile}..
-00007010: 2e22 290a 2020 2020 2020 2020 656c 6966  .").        elif
-00007020: 2028 6f73 2e70 6174 682e 6261 7365 6e61   (os.path.basena
-00007030: 6d65 2870 726f 6669 6c65 2920 3d3d 2070  me(profile) == p
-00007040: 726f 6669 6c65 2061 6e64 2070 726f 6669  rofile and profi
-00007050: 6c65 2069 6e20 766f 6c75 6d65 7329 206f  le in volumes) o
-00007060: 7220 7072 6f66 696c 6520 696e 2066 756c  r profile in ful
-00007070: 6c5f 766f 6c75 6d65 733a 0a20 2020 2020  l_volumes:.     
-00007080: 2020 2020 2020 2069 6620 6e6f 7420 6f6e         if not on
-00007090: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-000070a0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-000070b0: 2866 2244 6570 6c6f 7969 6e67 2076 6d20  (f"Deploying vm 
-000070c0: 7b6e 616d 657d 2066 726f 6d20 696d 6167  {name} from imag
-000070d0: 6520 7b70 726f 6669 6c65 7d2e 2e2e 2229  e {profile}...")
-000070e0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000070f0: 5f70 726f 6669 6c65 203d 206f 732e 7061  _profile = os.pa
-00007100: 7468 2e62 6173 656e 616d 6528 7072 6f66  th.basename(prof
-00007110: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-00007120: 2076 6d70 726f 6669 6c65 735b 6e65 775f   vmprofiles[new_
-00007130: 7072 6f66 696c 655d 203d 207b 2769 6d61  profile] = {'ima
-00007140: 6765 273a 2070 726f 6669 6c65 7d0a 2020  ge': profile}.  
-00007150: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-00007160: 6520 3d20 6e65 775f 7072 6f66 696c 650a  e = new_profile.
-00007170: 2020 2020 2020 2020 656c 6966 2070 726f          elif pro
-00007180: 6669 6c65 2069 6e20 494d 4147 4553 3a0a  file in IMAGES:.
-00007190: 2020 2020 2020 2020 2020 2020 766d 7072              vmpr
-000071a0: 6f66 696c 6573 5b70 726f 6669 6c65 5d20  ofiles[profile] 
-000071b0: 3d20 7b27 696d 6167 6527 3a20 7072 6f66  = {'image': prof
-000071c0: 696c 657d 0a20 2020 2020 2020 2065 6c69  ile}.        eli
-000071d0: 6620 7072 6f66 696c 652e 7374 6172 7473  f profile.starts
-000071e0: 7769 7468 2827 7268 636f 732d 3427 2920  with('rhcos-4') 
-000071f0: 616e 6420 7072 6f66 696c 652e 656e 6473  and profile.ends
-00007200: 7769 7468 2827 7163 6f77 3227 2920 616e  with('qcow2') an
-00007210: 6420 7365 6c66 2e74 7970 6520 6e6f 7420  d self.type not 
-00007220: 696e 2063 6c6f 7564 706c 6174 666f 726d  in cloudplatform
-00007230: 733a 0a20 2020 2020 2020 2020 2020 2076  s:.            v
-00007240: 6d70 726f 6669 6c65 735b 7072 6f66 696c  mprofiles[profil
-00007250: 655d 203d 207b 2769 6d61 6765 273a 2070  e] = {'image': p
-00007260: 726f 6669 6c65 7d0a 2020 2020 2020 2020  rofile}.        
-00007270: 656c 6966 2070 726f 6669 6c65 203d 3d20  elif profile == 
-00007280: 276b 7669 7274 273a 0a20 2020 2020 2020  'kvirt':.       
-00007290: 2020 2020 2076 6d70 726f 6669 6c65 735b       vmprofiles[
-000072a0: 7072 6f66 696c 655d 203d 207b 7d0a 2020  profile] = {}.  
-000072b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000072c0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-000072d0: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
-000072e0: 7265 272c 2027 7265 6173 6f6e 273a 2066  re', 'reason': f
-000072f0: 2749 6d61 6765 207b 7072 6f66 696c 657d  'Image {profile}
-00007300: 206e 6f74 2066 6f75 6e64 277d 0a20 2020   not found'}.   
-00007310: 2020 2020 2070 726f 6669 6c65 6e61 6d65       profilename
-00007320: 203d 2070 726f 6669 6c65 0a20 2020 2020   = profile.     
-00007330: 2020 2070 726f 6669 6c65 203d 2076 6d70     profile = vmp
-00007340: 726f 6669 6c65 735b 7072 6f66 696c 655d  rofiles[profile]
-00007350: 0a20 2020 2020 2020 2070 696d 6167 6520  .        pimage 
-00007360: 3d20 7072 6f66 696c 652e 6765 7428 2769  = profile.get('i
-00007370: 6d61 6765 272c 2027 5858 5827 290a 2020  mage', 'XXX').  
-00007380: 2020 2020 2020 6966 206e 6f74 206f 6e6c        if not onl
-00007390: 7961 7373 6574 7320 616e 6420 7365 6c66  yassets and self
-000073a0: 2e74 7970 6520 6e6f 7420 696e 2063 6c6f  .type not in clo
-000073b0: 7564 706c 6174 666f 726d 7320 616e 6420  udplatforms and 
-000073c0: 7069 6d61 6765 2069 6e20 494d 4147 4553  pimage in IMAGES
-000073d0: 2061 6e64 2070 696d 6167 6520 6e6f 7420   and pimage not 
-000073e0: 696e 2076 6f6c 756d 6573 3a0a 2020 2020  in volumes:.    
-000073f0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00007400: 2249 6d61 6765 207b 7069 6d61 6765 7d20  "Image {pimage} 
-00007410: 6e6f 7420 666f 756e 642e 2044 6f77 6e6c  not found. Downl
-00007420: 6f61 6469 6e67 2229 0a20 2020 2020 2020  oading").       
-00007430: 2020 2020 2070 696d 6167 655f 6461 7461       pimage_data
-00007440: 203d 207b 2770 6f6f 6c27 3a20 7365 6c66   = {'pool': self
-00007450: 2e70 6f6f 6c2c 2027 696d 6167 6527 3a20  .pool, 'image': 
-00007460: 7069 6d61 6765 2c20 2764 6f77 6e6c 6f61  pimage, 'downloa
-00007470: 6427 3a20 5472 7565 7d0a 2020 2020 2020  d': True}.      
-00007480: 2020 2020 2020 6966 2070 726f 6669 6c65        if profile
-00007490: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
-000074a0: 2772 6863 6f73 2d34 2729 2061 6e64 2070  'rhcos-4') and p
-000074b0: 726f 6669 6c65 6e61 6d65 2e65 6e64 7377  rofilename.endsw
-000074c0: 6974 6828 2771 636f 7732 2729 3a0a 2020  ith('qcow2'):.  
-000074d0: 2020 2020 2020 2020 2020 2020 2020 7069                pi
-000074e0: 6d61 6765 5f64 6174 615b 2769 6d61 6765  mage_data['image
-000074f0: 275d 203d 2070 726f 6669 6c65 6e61 6d65  '] = profilename
-00007500: 2e73 706c 6974 2827 2e27 295b 305d 2e72  .split('.')[0].r
-00007510: 6570 6c61 6365 2827 7268 636f 732d 3427  eplace('rhcos-4'
-00007520: 2c20 2772 6863 6f73 3427 290a 2020 2020  , 'rhcos4').    
-00007530: 2020 2020 2020 2020 2020 2020 7069 6d61              pima
-00007540: 6765 5f64 6174 615b 2775 726c 275d 203d  ge_data['url'] =
-00007550: 2067 6574 5f72 6863 6f73 5f75 726c 5f66   get_rhcos_url_f
-00007560: 726f 6d5f 6669 6c65 2870 726f 6669 6c65  rom_file(profile
-00007570: 6e61 6d65 2c20 5f74 7970 653d 7365 6c66  name, _type=self
-00007580: 2e74 7970 6529 0a20 2020 2020 2020 2020  .type).         
-00007590: 2020 2073 656c 662e 6861 6e64 6c65 5f68     self.handle_h
-000075a0: 6f73 7428 2a2a 7069 6d61 6765 5f64 6174  ost(**pimage_dat
-000075b0: 6129 0a20 2020 2020 2020 2069 6620 6e6f  a).        if no
-000075c0: 7420 6375 7374 6f6d 7072 6f66 696c 653a  t customprofile:
-000075d0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-000075e0: 6669 6c65 2e75 7064 6174 6528 6f76 6572  file.update(over
-000075f0: 7269 6465 7329 0a20 2020 2020 2020 2069  rides).        i
-00007600: 6620 2762 6173 6527 2069 6e20 7072 6f66  f 'base' in prof
-00007610: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00007620: 2066 6174 6865 7220 3d20 766d 7072 6f66   father = vmprof
-00007630: 696c 6573 5b70 726f 6669 6c65 5b27 6261  iles[profile['ba
-00007640: 7365 275d 5d0a 2020 2020 2020 2020 2020  se']].          
-00007650: 2020 6465 6661 756c 745f 6e75 6d63 7075    default_numcpu
-00007660: 7320 3d20 6661 7468 6572 2e67 6574 2827  s = father.get('
-00007670: 6e75 6d63 7075 7327 2c20 7365 6c66 2e6e  numcpus', self.n
-00007680: 756d 6370 7573 290a 2020 2020 2020 2020  umcpus).        
-00007690: 2020 2020 6465 6661 756c 745f 6d65 6d6f      default_memo
-000076a0: 7279 203d 2066 6174 6865 722e 6765 7428  ry = father.get(
-000076b0: 276d 656d 6f72 7927 2c20 7365 6c66 2e6d  'memory', self.m
-000076c0: 656d 6f72 7929 0a20 2020 2020 2020 2020  emory).         
-000076d0: 2020 2064 6566 6175 6c74 5f70 6f6f 6c20     default_pool 
-000076e0: 3d20 6661 7468 6572 2e67 6574 2827 706f  = father.get('po
-000076f0: 6f6c 272c 2073 656c 662e 706f 6f6c 290a  ol', self.pool).
-00007700: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007710: 756c 745f 6469 736b 7320 3d20 6661 7468  ult_disks = fath
-00007720: 6572 2e67 6574 2827 6469 736b 7327 2c20  er.get('disks', 
-00007730: 7365 6c66 2e64 6973 6b73 290a 2020 2020  self.disks).    
-00007740: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00007750: 6e65 7473 203d 2066 6174 6865 722e 6765  nets = father.ge
-00007760: 7428 276e 6574 7327 2c20 7365 6c66 2e6e  t('nets', self.n
-00007770: 6574 7329 0a20 2020 2020 2020 2020 2020  ets).           
-00007780: 2064 6566 6175 6c74 5f69 6d61 6765 203d   default_image =
-00007790: 2066 6174 6865 722e 6765 7428 2769 6d61   father.get('ima
-000077a0: 6765 272c 2073 656c 662e 696d 6167 6529  ge', self.image)
-000077b0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000077c0: 6175 6c74 5f63 6c6f 7564 696e 6974 203d  ault_cloudinit =
-000077d0: 2066 6174 6865 722e 6765 7428 2763 6c6f   father.get('clo
-000077e0: 7564 696e 6974 272c 2073 656c 662e 636c  udinit', self.cl
-000077f0: 6f75 6469 6e69 7429 0a20 2020 2020 2020  oudinit).       
-00007800: 2020 2020 2064 6566 6175 6c74 5f6e 6573       default_nes
-00007810: 7465 6420 3d20 6661 7468 6572 2e67 6574  ted = father.get
-00007820: 2827 6e65 7374 6564 272c 2073 656c 662e  ('nested', self.
-00007830: 6e65 7374 6564 290a 2020 2020 2020 2020  nested).        
-00007840: 2020 2020 6465 6661 756c 745f 7265 7365      default_rese
-00007850: 7276 6564 6e73 203d 2066 6174 6865 722e  rvedns = father.
-00007860: 6765 7428 2772 6573 6572 7665 646e 7327  get('reservedns'
-00007870: 2c20 7365 6c66 2e72 6573 6572 7665 646e  , self.reservedn
-00007880: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
-00007890: 6566 6175 6c74 5f72 6573 6572 7665 686f  efault_reserveho
-000078a0: 7374 203d 2066 6174 6865 722e 6765 7428  st = father.get(
-000078b0: 2772 6573 6572 7665 686f 7374 272c 2073  'reservehost', s
-000078c0: 656c 662e 7265 7365 7276 6568 6f73 7429  elf.reservehost)
-000078d0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000078e0: 6175 6c74 5f63 7075 6d6f 6465 6c20 3d20  ault_cpumodel = 
-000078f0: 6661 7468 6572 2e67 6574 2827 6370 756d  father.get('cpum
-00007900: 6f64 656c 272c 2073 656c 662e 6370 756d  odel', self.cpum
-00007910: 6f64 656c 290a 2020 2020 2020 2020 2020  odel).          
-00007920: 2020 6465 6661 756c 745f 6370 7566 6c61    default_cpufla
-00007930: 6773 203d 2066 6174 6865 722e 6765 7428  gs = father.get(
-00007940: 2763 7075 666c 6167 7327 2c20 7365 6c66  'cpuflags', self
-00007950: 2e63 7075 666c 6167 7329 0a20 2020 2020  .cpuflags).     
-00007960: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
-00007970: 7075 7069 6e6e 696e 6720 3d20 6661 7468  pupinning = fath
-00007980: 6572 2e67 6574 2827 6370 7570 696e 6e69  er.get('cpupinni
-00007990: 6e67 272c 2073 656c 662e 6370 7570 696e  ng', self.cpupin
-000079a0: 6e69 6e67 290a 2020 2020 2020 2020 2020  ning).          
-000079b0: 2020 6465 6661 756c 745f 6469 736b 7369    default_disksi
-000079c0: 7a65 203d 2066 6174 6865 722e 6765 7428  ze = father.get(
-000079d0: 2764 6973 6b73 697a 6527 2c20 7365 6c66  'disksize', self
-000079e0: 2e64 6973 6b73 697a 6529 0a20 2020 2020  .disksize).     
-000079f0: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
-00007a00: 6973 6b69 6e74 6572 6661 6365 203d 2066  iskinterface = f
-00007a10: 6174 6865 722e 6765 7428 2764 6973 6b69  ather.get('diski
-00007a20: 6e74 6572 6661 6365 272c 2073 656c 662e  nterface', self.
-00007a30: 6469 736b 696e 7465 7266 6163 6529 0a20  diskinterface). 
-00007a40: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007a50: 6c74 5f64 6973 6b74 6869 6e20 3d20 6661  lt_diskthin = fa
-00007a60: 7468 6572 2e67 6574 2827 6469 736b 7468  ther.get('diskth
-00007a70: 696e 272c 2073 656c 662e 6469 736b 7468  in', self.diskth
-00007a80: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
-00007a90: 6465 6661 756c 745f 6775 6573 7469 6420  default_guestid 
-00007aa0: 3d20 6661 7468 6572 2e67 6574 2827 6775  = father.get('gu
-00007ab0: 6573 7469 6427 2c20 7365 6c66 2e67 7565  estid', self.gue
-00007ac0: 7374 6964 290a 2020 2020 2020 2020 2020  stid).          
-00007ad0: 2020 6465 6661 756c 745f 6973 6f20 3d20    default_iso = 
-00007ae0: 6661 7468 6572 2e67 6574 2827 6973 6f27  father.get('iso'
-00007af0: 2c20 7365 6c66 2e69 736f 290a 2020 2020  , self.iso).    
-00007b00: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00007b10: 766e 6320 3d20 6661 7468 6572 2e67 6574  vnc = father.get
-00007b20: 2827 766e 6327 2c20 7365 6c66 2e76 6e63  ('vnc', self.vnc
-00007b30: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00007b40: 6661 756c 745f 7265 7365 7276 6569 7020  fault_reserveip 
-00007b50: 3d20 6661 7468 6572 2e67 6574 2827 7265  = father.get('re
-00007b60: 7365 7276 6569 7027 2c20 7365 6c66 2e72  serveip', self.r
-00007b70: 6573 6572 7665 6970 290a 2020 2020 2020  eserveip).      
-00007b80: 2020 2020 2020 6465 6661 756c 745f 7374        default_st
-00007b90: 6172 7420 3d20 6661 7468 6572 2e67 6574  art = father.get
-00007ba0: 2827 7374 6172 7427 2c20 7365 6c66 2e73  ('start', self.s
-00007bb0: 7461 7274 290a 2020 2020 2020 2020 2020  tart).          
-00007bc0: 2020 6465 6661 756c 745f 6175 746f 7374    default_autost
-00007bd0: 6172 7420 3d20 6661 7468 6572 2e67 6574  art = father.get
-00007be0: 2827 6175 746f 7374 6172 7427 2c20 7365  ('autostart', se
-00007bf0: 6c66 2e61 7574 6f73 7461 7274 290a 2020  lf.autostart).  
-00007c00: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007c10: 745f 6b65 7973 203d 2066 6174 6865 722e  t_keys = father.
-00007c20: 6765 7428 276b 6579 7327 2c20 7365 6c66  get('keys', self
-00007c30: 2e6b 6579 7329 0a20 2020 2020 2020 2020  .keys).         
-00007c40: 2020 2064 6566 6175 6c74 5f6e 6574 6d61     default_netma
-00007c50: 736b 7320 3d20 6661 7468 6572 2e67 6574  sks = father.get
-00007c60: 2827 6e65 746d 6173 6b73 272c 2073 656c  ('netmasks', sel
-00007c70: 662e 6e65 746d 6173 6b73 290a 2020 2020  f.netmasks).    
-00007c80: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00007c90: 6761 7465 7761 7920 3d20 6661 7468 6572  gateway = father
-00007ca0: 2e67 6574 2827 6761 7465 7761 7927 2c20  .get('gateway', 
-00007cb0: 7365 6c66 2e67 6174 6577 6179 290a 2020  self.gateway).  
-00007cc0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007cd0: 745f 646e 7320 3d20 6661 7468 6572 2e67  t_dns = father.g
-00007ce0: 6574 2827 646e 7327 2c20 7365 6c66 2e64  et('dns', self.d
-00007cf0: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
-00007d00: 6465 6661 756c 745f 646f 6d61 696e 203d  default_domain =
-00007d10: 2066 6174 6865 722e 6765 7428 2764 6f6d   father.get('dom
-00007d20: 6169 6e27 2c20 7365 6c66 2e64 6f6d 6169  ain', self.domai
-00007d30: 6e29 0a20 2020 2020 2020 2020 2020 2064  n).            d
-00007d40: 6566 6175 6c74 5f66 696c 6573 203d 2066  efault_files = f
-00007d50: 6174 6865 722e 6765 7428 2766 696c 6573  ather.get('files
-00007d60: 272c 2073 656c 662e 6669 6c65 7329 0a20  ', self.files). 
-00007d70: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007d80: 6c74 5f65 6e61 626c 6572 6f6f 7420 3d20  lt_enableroot = 
-00007d90: 6661 7468 6572 2e67 6574 2827 656e 6162  father.get('enab
-00007da0: 6c65 726f 6f74 272c 2073 656c 662e 656e  leroot', self.en
-00007db0: 6162 6c65 726f 6f74 290a 2020 2020 2020  ableroot).      
-00007dc0: 2020 2020 2020 6465 6661 756c 745f 7072        default_pr
-00007dd0: 6976 6174 656b 6579 203d 2066 6174 6865  ivatekey = fathe
-00007de0: 722e 6765 7428 2770 7269 7661 7465 6b65  r.get('privateke
-00007df0: 7927 2c20 7365 6c66 2e70 7269 7661 7465  y', self.private
-00007e00: 6b65 7929 0a20 2020 2020 2020 2020 2020  key).           
-00007e10: 2064 6566 6175 6c74 5f6e 6574 776f 726b   default_network
-00007e20: 7761 6974 203d 2066 6174 6865 722e 6765  wait = father.ge
-00007e30: 7428 276e 6574 776f 726b 7761 6974 272c  t('networkwait',
-00007e40: 2073 656c 662e 6e65 7477 6f72 6b77 6169   self.networkwai
-00007e50: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-00007e60: 6566 6175 6c74 5f72 686e 7265 6769 7374  efault_rhnregist
-00007e70: 6572 203d 2066 6174 6865 722e 6765 7428  er = father.get(
-00007e80: 2772 686e 7265 6769 7374 6572 272c 2073  'rhnregister', s
-00007e90: 656c 662e 7268 6e72 6567 6973 7465 7229  elf.rhnregister)
-00007ea0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00007eb0: 6175 6c74 5f72 686e 7365 7276 6572 203d  ault_rhnserver =
-00007ec0: 2066 6174 6865 722e 6765 7428 2772 686e   father.get('rhn
-00007ed0: 7365 7276 6572 272c 2073 656c 662e 7268  server', self.rh
-00007ee0: 6e73 6572 7665 7229 0a20 2020 2020 2020  nserver).       
-00007ef0: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-00007f00: 7573 6572 203d 2066 6174 6865 722e 6765  user = father.ge
-00007f10: 7428 2772 686e 7573 6572 272c 2073 656c  t('rhnuser', sel
-00007f20: 662e 7268 6e75 7365 7229 0a20 2020 2020  f.rhnuser).     
-00007f30: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
-00007f40: 686e 7061 7373 776f 7264 203d 2066 6174  hnpassword = fat
-00007f50: 6865 722e 6765 7428 2772 686e 7061 7373  her.get('rhnpass
-00007f60: 776f 7264 272c 2073 656c 662e 7268 6e70  word', self.rhnp
-00007f70: 6173 7377 6f72 6429 0a20 2020 2020 2020  assword).       
-00007f80: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-00007f90: 616b 203d 2066 6174 6865 722e 6765 7428  ak = father.get(
-00007fa0: 2772 686e 6163 7469 7661 7469 6f6e 6b65  'rhnactivationke
-00007fb0: 7927 2c20 7365 6c66 2e72 686e 616b 290a  y', self.rhnak).
-00007fc0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007fd0: 756c 745f 7268 6e6f 7267 203d 2066 6174  ult_rhnorg = fat
-00007fe0: 6865 722e 6765 7428 2772 686e 6f72 6727  her.get('rhnorg'
-00007ff0: 2c20 7365 6c66 2e72 686e 6f72 6729 0a20  , self.rhnorg). 
-00008000: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008010: 6c74 5f72 686e 706f 6f6c 203d 2066 6174  lt_rhnpool = fat
-00008020: 6865 722e 6765 7428 2772 686e 706f 6f6c  her.get('rhnpool
-00008030: 272c 2073 656c 662e 7268 6e70 6f6f 6c29  ', self.rhnpool)
-00008040: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008050: 6175 6c74 5f74 6167 7320 3d20 6661 7468  ault_tags = fath
-00008060: 6572 2e67 6574 2827 7461 6773 272c 2073  er.get('tags', s
-00008070: 656c 662e 7461 6773 290a 2020 2020 2020  elf.tags).      
-00008080: 2020 2020 2020 6465 6661 756c 745f 666c        default_fl
-00008090: 6176 6f72 203d 2066 6174 6865 722e 6765  avor = father.ge
-000080a0: 7428 2766 6c61 766f 7227 2c20 7365 6c66  t('flavor', self
-000080b0: 2e66 6c61 766f 7229 0a20 2020 2020 2020  .flavor).       
-000080c0: 2020 2020 2064 6566 6175 6c74 5f63 6d64       default_cmd
-000080d0: 7320 3d20 636f 6d6d 6f6e 2e72 656d 6f76  s = common.remov
-000080e0: 655f 6475 706c 6963 6174 6573 2873 656c  e_duplicates(sel
-000080f0: 662e 636d 6473 202b 2066 6174 6865 722e  f.cmds + father.
-00008100: 6765 7428 2763 6d64 7327 2c20 5b5d 2929  get('cmds', []))
-00008110: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008120: 6175 6c74 5f73 6372 6970 7473 203d 2063  ault_scripts = c
-00008130: 6f6d 6d6f 6e2e 7265 6d6f 7665 5f64 7570  ommon.remove_dup
-00008140: 6c69 6361 7465 7328 7365 6c66 2e73 6372  licates(self.scr
-00008150: 6970 7473 202b 2066 6174 6865 722e 6765  ipts + father.ge
-00008160: 7428 2773 6372 6970 7473 272c 205b 5d29  t('scripts', [])
-00008170: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00008180: 6661 756c 745f 646e 7363 6c69 656e 7420  fault_dnsclient 
-00008190: 3d20 6661 7468 6572 2e67 6574 2827 646e  = father.get('dn
-000081a0: 7363 6c69 656e 7427 2c20 7365 6c66 2e64  sclient', self.d
-000081b0: 6e73 636c 6965 6e74 290a 2020 2020 2020  nsclient).      
-000081c0: 2020 2020 2020 6465 6661 756c 745f 7374        default_st
-000081d0: 6f72 656d 6574 6164 6174 6120 3d20 6661  oremetadata = fa
-000081e0: 7468 6572 2e67 6574 2827 7374 6f72 656d  ther.get('storem
-000081f0: 6574 6164 6174 6127 2c20 7365 6c66 2e73  etadata', self.s
-00008200: 746f 7265 6d65 7461 6461 7461 290a 2020  toremetadata).  
-00008210: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00008220: 745f 6e6f 7469 6679 203d 2066 6174 6865  t_notify = fathe
-00008230: 722e 6765 7428 276e 6f74 6966 7927 2c20  r.get('notify', 
-00008240: 7365 6c66 2e6e 6f74 6966 7929 0a20 2020  self.notify).   
-00008250: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008260: 5f70 7573 6862 756c 6c65 7474 6f6b 656e  _pushbullettoken
-00008270: 203d 2066 6174 6865 722e 6765 7428 2770   = father.get('p
-00008280: 7573 6862 756c 6c65 7474 6f6b 656e 272c  ushbullettoken',
-00008290: 2073 656c 662e 7075 7368 6275 6c6c 6574   self.pushbullet
-000082a0: 746f 6b65 6e29 0a20 2020 2020 2020 2020  token).         
-000082b0: 2020 2064 6566 6175 6c74 5f6d 6169 6c73     default_mails
-000082c0: 6572 7665 7220 3d20 6661 7468 6572 2e67  erver = father.g
-000082d0: 6574 2827 6d61 696c 7365 7276 6572 272c  et('mailserver',
-000082e0: 2073 656c 662e 6d61 696c 7365 7276 6572   self.mailserver
-000082f0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00008300: 6661 756c 745f 6d61 696c 6672 6f6d 203d  fault_mailfrom =
-00008310: 2066 6174 6865 722e 6765 7428 276d 6169   father.get('mai
-00008320: 6c66 726f 6d27 2c20 7365 6c66 2e6d 6169  lfrom', self.mai
-00008330: 6c66 726f 6d29 0a20 2020 2020 2020 2020  lfrom).         
-00008340: 2020 2064 6566 6175 6c74 5f6d 6169 6c74     default_mailt
-00008350: 6f20 3d20 6661 7468 6572 2e67 6574 2827  o = father.get('
-00008360: 6d61 696c 746f 272c 2073 656c 662e 6d61  mailto', self.ma
-00008370: 696c 746f 290a 2020 2020 2020 2020 2020  ilto).          
-00008380: 2020 6465 6661 756c 745f 6e6f 7469 6679    default_notify
-00008390: 636d 6420 3d20 6661 7468 6572 2e67 6574  cmd = father.get
-000083a0: 2827 6e6f 7469 6679 636d 6427 2c20 7365  ('notifycmd', se
-000083b0: 6c66 2e6e 6f74 6966 7963 6d64 290a 2020  lf.notifycmd).  
-000083c0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000083d0: 745f 6e6f 7469 6679 7363 7269 7074 203d  t_notifyscript =
-000083e0: 2066 6174 6865 722e 6765 7428 276e 6f74   father.get('not
-000083f0: 6966 7973 6372 6970 7427 2c20 7365 6c66  ifyscript', self
-00008400: 2e6e 6f74 6966 7973 6372 6970 7429 0a20  .notifyscript). 
-00008410: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008420: 6c74 5f6e 6f74 6966 796d 6574 686f 6473  lt_notifymethods
-00008430: 203d 2066 6174 6865 722e 6765 7428 276e   = father.get('n
-00008440: 6f74 6966 796d 6574 686f 6473 272c 2073  otifymethods', s
-00008450: 656c 662e 6e6f 7469 6679 6d65 7468 6f64  elf.notifymethod
-00008460: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
-00008470: 6566 6175 6c74 5f73 6c61 636b 6368 616e  efault_slackchan
-00008480: 6e65 6c20 3d20 6661 7468 6572 2e67 6574  nel = father.get
-00008490: 2827 736c 6163 6b63 6861 6e6e 656c 272c  ('slackchannel',
-000084a0: 2073 656c 662e 736c 6163 6b63 6861 6e6e   self.slackchann
-000084b0: 656c 290a 2020 2020 2020 2020 2020 2020  el).            
-000084c0: 6465 6661 756c 745f 7075 7368 6275 6c6c  default_pushbull
-000084d0: 6574 746f 6b65 6e20 3d20 6661 7468 6572  ettoken = father
-000084e0: 2e67 6574 2827 7075 7368 6275 6c6c 6574  .get('pushbullet
-000084f0: 746f 6b65 6e27 2c20 7365 6c66 2e70 7573  token', self.pus
-00008500: 6862 756c 6c65 7474 6f6b 656e 290a 2020  hbullettoken).  
-00008510: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00008520: 745f 736c 6163 6b74 6f6b 656e 203d 2066  t_slacktoken = f
-00008530: 6174 6865 722e 6765 7428 2773 6c61 636b  ather.get('slack
-00008540: 746f 6b65 6e27 2c20 7365 6c66 2e73 6c61  token', self.sla
-00008550: 636b 746f 6b65 6e29 0a20 2020 2020 2020  cktoken).       
-00008560: 2020 2020 2064 6566 6175 6c74 5f73 6861       default_sha
-00008570: 7265 6466 6f6c 6465 7273 203d 2066 6174  redfolders = fat
-00008580: 6865 722e 6765 7428 2773 6861 7265 6466  her.get('sharedf
-00008590: 6f6c 6465 7273 272c 2073 656c 662e 7368  olders', self.sh
-000085a0: 6172 6564 666f 6c64 6572 7329 0a20 2020  aredfolders).   
-000085b0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000085c0: 5f6b 6572 6e65 6c20 3d20 6661 7468 6572  _kernel = father
-000085d0: 2e67 6574 2827 6b65 726e 656c 272c 2073  .get('kernel', s
-000085e0: 656c 662e 6b65 726e 656c 290a 2020 2020  elf.kernel).    
-000085f0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008600: 696e 6974 7264 203d 2066 6174 6865 722e  initrd = father.
-00008610: 6765 7428 2769 6e69 7472 6427 2c20 7365  get('initrd', se
-00008620: 6c66 2e69 6e69 7472 6429 0a20 2020 2020  lf.initrd).     
-00008630: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
-00008640: 6d64 6c69 6e65 203d 2066 6174 6865 722e  mdline = father.
-00008650: 6765 7428 2763 6d64 6c69 6e65 272c 2073  get('cmdline', s
-00008660: 656c 662e 636d 646c 696e 6529 0a20 2020  elf.cmdline).   
-00008670: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008680: 5f70 6c61 6365 6d65 6e74 203d 2066 6174  _placement = fat
-00008690: 6865 722e 6765 7428 2770 6c61 6365 6d65  her.get('placeme
-000086a0: 6e74 272c 2073 656c 662e 706c 6163 656d  nt', self.placem
-000086b0: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
-000086c0: 2064 6566 6175 6c74 5f79 616d 6c69 6e76   default_yamlinv
-000086d0: 656e 746f 7279 203d 2066 6174 6865 722e  entory = father.
-000086e0: 6765 7428 2779 616d 6c69 6e76 656e 746f  get('yamlinvento
-000086f0: 7279 272c 2073 656c 662e 7961 6d6c 696e  ry', self.yamlin
-00008700: 7665 6e74 6f72 7929 0a20 2020 2020 2020  ventory).       
-00008710: 2020 2020 2064 6566 6175 6c74 5f63 7075       default_cpu
-00008720: 686f 7470 6c75 6720 3d20 6661 7468 6572  hotplug = father
-00008730: 2e67 6574 2827 6370 7568 6f74 706c 7567  .get('cpuhotplug
-00008740: 272c 2073 656c 662e 6370 7568 6f74 706c  ', self.cpuhotpl
-00008750: 7567 290a 2020 2020 2020 2020 2020 2020  ug).            
-00008760: 6465 6661 756c 745f 6d65 6d6f 7279 686f  default_memoryho
-00008770: 7470 6c75 6720 3d20 6661 7468 6572 2e67  tplug = father.g
-00008780: 6574 2827 6d65 6d6f 7279 686f 7470 6c75  et('memoryhotplu
-00008790: 6727 2c20 7365 6c66 2e6d 656d 6f72 7968  g', self.memoryh
-000087a0: 6f74 706c 7567 290a 2020 2020 2020 2020  otplug).        
-000087b0: 2020 2020 6465 6661 756c 745f 6e75 6d61      default_numa
-000087c0: 203d 2066 6174 6865 722e 6765 7428 276e   = father.get('n
-000087d0: 756d 6127 2c20 7365 6c66 2e6e 756d 6129  uma', self.numa)
-000087e0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000087f0: 6175 6c74 5f6e 756d 616d 6f64 6520 3d20  ault_numamode = 
-00008800: 6661 7468 6572 2e67 6574 2827 6e75 6d61  father.get('numa
-00008810: 6d6f 6465 272c 2073 656c 662e 6e75 6d61  mode', self.numa
-00008820: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-00008830: 2020 6465 6661 756c 745f 7063 6964 6576    default_pcidev
-00008840: 6963 6573 203d 2066 6174 6865 722e 6765  ices = father.ge
-00008850: 7428 2770 6369 6465 7669 6365 7327 2c20  t('pcidevices', 
-00008860: 7365 6c66 2e70 6369 6465 7669 6365 7329  self.pcidevices)
-00008870: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008880: 6175 6c74 5f74 706d 203d 2066 6174 6865  ault_tpm = fathe
-00008890: 722e 6765 7428 2774 706d 272c 2073 656c  r.get('tpm', sel
-000088a0: 662e 7470 6d29 0a20 2020 2020 2020 2020  f.tpm).         
-000088b0: 2020 2064 6566 6175 6c74 5f72 6e67 203d     default_rng =
-000088c0: 2066 6174 6865 722e 6765 7428 2772 6e67   father.get('rng
-000088d0: 272c 2073 656c 662e 726e 6729 0a20 2020  ', self.rng).   
-000088e0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000088f0: 5f7a 6572 6f74 6965 725f 6e65 7473 203d  _zerotier_nets =
-00008900: 2066 6174 6865 722e 6765 7428 277a 6572   father.get('zer
-00008910: 6f74 6965 725f 6e65 7473 272c 2073 656c  otier_nets', sel
-00008920: 662e 7a65 726f 7469 6572 5f6e 6574 7329  f.zerotier_nets)
-00008930: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008940: 6175 6c74 5f7a 6572 6f74 6965 725f 6b75  ault_zerotier_ku
-00008950: 6265 6c65 7420 3d20 6661 7468 6572 2e67  belet = father.g
-00008960: 6574 2827 7a65 726f 7469 6572 5f6b 7562  et('zerotier_kub
-00008970: 656c 6574 272c 2073 656c 662e 7a65 726f  elet', self.zero
-00008980: 7469 6572 5f6b 7562 656c 6574 290a 2020  tier_kubelet).  
-00008990: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000089a0: 745f 7669 7274 7479 7065 203d 2066 6174  t_virttype = fat
-000089b0: 6865 722e 6765 7428 2776 6972 7474 7970  her.get('virttyp
-000089c0: 6527 2c20 7365 6c66 2e76 6972 7474 7970  e', self.virttyp
-000089d0: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-000089e0: 6566 6175 6c74 5f73 6563 7572 6974 7967  efault_securityg
-000089f0: 726f 7570 7320 3d20 6661 7468 6572 2e67  roups = father.g
-00008a00: 6574 2827 7365 6375 7269 7479 6772 6f75  et('securitygrou
-00008a10: 7073 272c 2073 656c 662e 7365 6375 7269  ps', self.securi
-00008a20: 7479 6772 6f75 7073 290a 2020 2020 2020  tygroups).      
-00008a30: 2020 2020 2020 6465 6661 756c 745f 726f        default_ro
-00008a40: 6f74 7061 7373 776f 7264 203d 2066 6174  otpassword = fat
-00008a50: 6865 722e 6765 7428 2772 6f6f 7470 6173  her.get('rootpas
-00008a60: 7377 6f72 6427 2c20 7365 6c66 2e72 6f6f  sword', self.roo
-00008a70: 7470 6173 7377 6f72 6429 0a20 2020 2020  tpassword).     
-00008a80: 2020 2020 2020 2064 6566 6175 6c74 5f74         default_t
-00008a90: 656d 706b 6579 203d 2066 6174 6865 722e  empkey = father.
-00008aa0: 6765 7428 2774 656d 706b 6579 272c 2073  get('tempkey', s
-00008ab0: 656c 662e 7465 6d70 6b65 7929 0a20 2020  elf.tempkey).   
-00008ac0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008ad0: 5f76 6d75 7365 7220 3d20 6661 7468 6572  _vmuser = father
-00008ae0: 2e67 6574 2827 766d 7573 6572 272c 2073  .get('vmuser', s
-00008af0: 656c 662e 766d 7573 6572 290a 2020 2020  elf.vmuser).    
-00008b00: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008b10: 7761 6974 203d 2066 6174 6865 722e 6765  wait = father.ge
-00008b20: 7428 2777 6169 7427 2c20 7365 6c66 2e77  t('wait', self.w
-00008b30: 6169 7429 0a20 2020 2020 2020 2020 2020  ait).           
-00008b40: 2064 6566 6175 6c74 5f77 6169 7463 6f6d   default_waitcom
-00008b50: 6d61 6e64 203d 2066 6174 6865 722e 6765  mand = father.ge
-00008b60: 7428 2777 6169 7463 6f6d 6d61 6e64 272c  t('waitcommand',
-00008b70: 2073 656c 662e 7761 6974 636f 6d6d 616e   self.waitcomman
-00008b80: 6429 0a20 2020 2020 2020 2020 2020 2064  d).            d
-00008b90: 6566 6175 6c74 5f77 6169 7474 696d 656f  efault_waittimeo
-00008ba0: 7574 203d 2066 6174 6865 722e 6765 7428  ut = father.get(
-00008bb0: 2777 6169 7474 696d 656f 7574 272c 2073  'waittimeout', s
-00008bc0: 656c 662e 7761 6974 7469 6d65 6f75 7429  elf.waittimeout)
-00008bd0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00008be0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008bf0: 6c74 5f6e 756d 6370 7573 203d 2073 656c  lt_numcpus = sel
-00008c00: 662e 6e75 6d63 7075 730a 2020 2020 2020  f.numcpus.      
-00008c10: 2020 2020 2020 6465 6661 756c 745f 6d65        default_me
-00008c20: 6d6f 7279 203d 2073 656c 662e 6d65 6d6f  mory = self.memo
-00008c30: 7279 0a20 2020 2020 2020 2020 2020 2064  ry.            d
-00008c40: 6566 6175 6c74 5f70 6f6f 6c20 3d20 7365  efault_pool = se
-00008c50: 6c66 2e70 6f6f 6c0a 2020 2020 2020 2020  lf.pool.        
-00008c60: 2020 2020 6465 6661 756c 745f 6469 736b      default_disk
-00008c70: 7320 3d20 7365 6c66 2e64 6973 6b73 0a20  s = self.disks. 
-00008c80: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008c90: 6c74 5f6e 6574 7320 3d20 7365 6c66 2e6e  lt_nets = self.n
-00008ca0: 6574 730a 2020 2020 2020 2020 2020 2020  ets.            
-00008cb0: 6465 6661 756c 745f 696d 6167 6520 3d20  default_image = 
-00008cc0: 7365 6c66 2e69 6d61 6765 0a20 2020 2020  self.image.     
-00008cd0: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
-00008ce0: 6c6f 7564 696e 6974 203d 2073 656c 662e  loudinit = self.
-00008cf0: 636c 6f75 6469 6e69 740a 2020 2020 2020  cloudinit.      
-00008d00: 2020 2020 2020 6465 6661 756c 745f 6e65        default_ne
-00008d10: 7374 6564 203d 2073 656c 662e 6e65 7374  sted = self.nest
-00008d20: 6564 0a20 2020 2020 2020 2020 2020 2064  ed.            d
-00008d30: 6566 6175 6c74 5f72 6573 6572 7665 646e  efault_reservedn
-00008d40: 7320 3d20 7365 6c66 2e72 6573 6572 7665  s = self.reserve
-00008d50: 646e 730a 2020 2020 2020 2020 2020 2020  dns.            
-00008d60: 6465 6661 756c 745f 7265 7365 7276 6568  default_reserveh
-00008d70: 6f73 7420 3d20 7365 6c66 2e72 6573 6572  ost = self.reser
-00008d80: 7665 686f 7374 0a20 2020 2020 2020 2020  vehost.         
-00008d90: 2020 2064 6566 6175 6c74 5f63 7075 6d6f     default_cpumo
-00008da0: 6465 6c20 3d20 7365 6c66 2e63 7075 6d6f  del = self.cpumo
-00008db0: 6465 6c0a 2020 2020 2020 2020 2020 2020  del.            
-00008dc0: 6465 6661 756c 745f 6370 7566 6c61 6773  default_cpuflags
-00008dd0: 203d 2073 656c 662e 6370 7566 6c61 6773   = self.cpuflags
-00008de0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008df0: 6175 6c74 5f63 7075 7069 6e6e 696e 6720  ault_cpupinning 
-00008e00: 3d20 7365 6c66 2e63 7075 7069 6e6e 696e  = self.cpupinnin
-00008e10: 670a 2020 2020 2020 2020 2020 2020 6465  g.            de
-00008e20: 6661 756c 745f 6e75 6d61 6d6f 6465 203d  fault_numamode =
-00008e30: 2073 656c 662e 6e75 6d61 6d6f 6465 0a20   self.numamode. 
-00008e40: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008e50: 6c74 5f6e 756d 6120 3d20 7365 6c66 2e6e  lt_numa = self.n
-00008e60: 756d 610a 2020 2020 2020 2020 2020 2020  uma.            
-00008e70: 6465 6661 756c 745f 7063 6964 6576 6963  default_pcidevic
-00008e80: 6573 203d 2073 656c 662e 7063 6964 6576  es = self.pcidev
-00008e90: 6963 6573 0a20 2020 2020 2020 2020 2020  ices.           
-00008ea0: 2064 6566 6175 6c74 5f74 706d 203d 2073   default_tpm = s
-00008eb0: 656c 662e 7470 6d0a 2020 2020 2020 2020  elf.tpm.        
-00008ec0: 2020 2020 6465 6661 756c 745f 726e 6720      default_rng 
-00008ed0: 3d20 7365 6c66 2e72 6e67 0a20 2020 2020  = self.rng.     
-00008ee0: 2020 2020 2020 2064 6566 6175 6c74 5f7a         default_z
-00008ef0: 6572 6f74 6965 725f 6e65 7473 203d 2073  erotier_nets = s
-00008f00: 656c 662e 7a65 726f 7469 6572 5f6e 6574  elf.zerotier_net
-00008f10: 730a 2020 2020 2020 2020 2020 2020 6465  s.            de
-00008f20: 6661 756c 745f 7a65 726f 7469 6572 5f6b  fault_zerotier_k
-00008f30: 7562 656c 6574 203d 2073 656c 662e 7a65  ubelet = self.ze
-00008f40: 726f 7469 6572 5f6b 7562 656c 6574 0a20  rotier_kubelet. 
-00008f50: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008f60: 6c74 5f64 6973 6b73 697a 6520 3d20 7365  lt_disksize = se
-00008f70: 6c66 2e64 6973 6b73 697a 650a 2020 2020  lf.disksize.    
-00008f80: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008f90: 6469 736b 696e 7465 7266 6163 6520 3d20  diskinterface = 
-00008fa0: 7365 6c66 2e64 6973 6b69 6e74 6572 6661  self.diskinterfa
-00008fb0: 6365 0a20 2020 2020 2020 2020 2020 2064  ce.            d
-00008fc0: 6566 6175 6c74 5f64 6973 6b74 6869 6e20  efault_diskthin 
-00008fd0: 3d20 7365 6c66 2e64 6973 6b74 6869 6e0a  = self.diskthin.
-00008fe0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00008ff0: 756c 745f 6775 6573 7469 6420 3d20 7365  ult_guestid = se
-00009000: 6c66 2e67 7565 7374 6964 0a20 2020 2020  lf.guestid.     
-00009010: 2020 2020 2020 2064 6566 6175 6c74 5f69         default_i
-00009020: 736f 203d 2073 656c 662e 6973 6f0a 2020  so = self.iso.  
-00009030: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00009040: 745f 766e 6320 3d20 7365 6c66 2e76 6e63  t_vnc = self.vnc
-00009050: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00009060: 6175 6c74 5f72 6573 6572 7665 6970 203d  ault_reserveip =
-00009070: 2073 656c 662e 7265 7365 7276 6569 700a   self.reserveip.
-00009080: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00009090: 756c 745f 7374 6172 7420 3d20 7365 6c66  ult_start = self
-000090a0: 2e73 7461 7274 0a20 2020 2020 2020 2020  .start.         
-000090b0: 2020 2064 6566 6175 6c74 5f61 7574 6f73     default_autos
-000090c0: 7461 7274 203d 2073 656c 662e 6175 746f  tart = self.auto
-000090d0: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
-000090e0: 2020 6465 6661 756c 745f 6b65 7973 203d    default_keys =
-000090f0: 2073 656c 662e 6b65 7973 0a20 2020 2020   self.keys.     
-00009100: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
-00009110: 6574 6d61 736b 7320 3d20 7365 6c66 2e6e  etmasks = self.n
-00009120: 6574 6d61 736b 730a 2020 2020 2020 2020  etmasks.        
-00009130: 2020 2020 6465 6661 756c 745f 6761 7465      default_gate
-00009140: 7761 7920 3d20 7365 6c66 2e67 6174 6577  way = self.gatew
-00009150: 6179 0a20 2020 2020 2020 2020 2020 2064  ay.            d
-00009160: 6566 6175 6c74 5f64 6e73 203d 2073 656c  efault_dns = sel
-00009170: 662e 646e 730a 2020 2020 2020 2020 2020  f.dns.          
-00009180: 2020 6465 6661 756c 745f 646f 6d61 696e    default_domain
-00009190: 203d 2073 656c 662e 646f 6d61 696e 0a20   = self.domain. 
-000091a0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-000091b0: 6c74 5f66 696c 6573 203d 2073 656c 662e  lt_files = self.
-000091c0: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
-000091d0: 2020 6465 6661 756c 745f 656e 6162 6c65    default_enable
-000091e0: 726f 6f74 203d 2073 656c 662e 656e 6162  root = self.enab
-000091f0: 6c65 726f 6f74 0a20 2020 2020 2020 2020  leroot.         
-00009200: 2020 2064 6566 6175 6c74 5f74 6167 7320     default_tags 
-00009210: 3d20 7365 6c66 2e74 6167 730a 2020 2020  = self.tags.    
-00009220: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00009230: 666c 6176 6f72 203d 2073 656c 662e 666c  flavor = self.fl
-00009240: 6176 6f72 0a20 2020 2020 2020 2020 2020  avor.           
-00009250: 2064 6566 6175 6c74 5f70 7269 7661 7465   default_private
-00009260: 6b65 7920 3d20 7365 6c66 2e70 7269 7661  key = self.priva
-00009270: 7465 6b65 790a 2020 2020 2020 2020 2020  tekey.          
-00009280: 2020 6465 6661 756c 745f 6e65 7477 6f72    default_networ
-00009290: 6b77 6169 7420 3d20 7365 6c66 2e6e 6574  kwait = self.net
-000092a0: 776f 726b 7761 6974 0a20 2020 2020 2020  workwait.       
-000092b0: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-000092c0: 7265 6769 7374 6572 203d 2073 656c 662e  register = self.
-000092d0: 7268 6e72 6567 6973 7465 720a 2020 2020  rhnregister.    
-000092e0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-000092f0: 7268 6e73 6572 7665 7220 3d20 7365 6c66  rhnserver = self
-00009300: 2e72 686e 7365 7276 6572 0a20 2020 2020  .rhnserver.     
-00009310: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
-00009320: 686e 7573 6572 203d 2073 656c 662e 7268  hnuser = self.rh
-00009330: 6e75 7365 720a 2020 2020 2020 2020 2020  nuser.          
-00009340: 2020 6465 6661 756c 745f 7268 6e70 6173    default_rhnpas
-00009350: 7377 6f72 6420 3d20 7365 6c66 2e72 686e  sword = self.rhn
-00009360: 7061 7373 776f 7264 0a20 2020 2020 2020  password.       
-00009370: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-00009380: 616b 203d 2073 656c 662e 7268 6e61 6b0a  ak = self.rhnak.
-00009390: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000093a0: 756c 745f 7268 6e6f 7267 203d 2073 656c  ult_rhnorg = sel
-000093b0: 662e 7268 6e6f 7267 0a20 2020 2020 2020  f.rhnorg.       
-000093c0: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
-000093d0: 706f 6f6c 203d 2073 656c 662e 7268 6e70  pool = self.rhnp
-000093e0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-000093f0: 6465 6661 756c 745f 636d 6473 203d 2073  default_cmds = s
-00009400: 656c 662e 636d 6473 0a20 2020 2020 2020  elf.cmds.       
-00009410: 2020 2020 2064 6566 6175 6c74 5f73 6372       default_scr
-00009420: 6970 7473 203d 2073 656c 662e 7363 7269  ipts = self.scri
-00009430: 7074 730a 2020 2020 2020 2020 2020 2020  pts.            
-00009440: 6465 6661 756c 745f 646e 7363 6c69 656e  default_dnsclien
-00009450: 7420 3d20 7365 6c66 2e64 6e73 636c 6965  t = self.dnsclie
-00009460: 6e74 0a20 2020 2020 2020 2020 2020 2064  nt.            d
-00009470: 6566 6175 6c74 5f73 746f 7265 6d65 7461  efault_storemeta
-00009480: 6461 7461 203d 2073 656c 662e 7374 6f72  data = self.stor
-00009490: 656d 6574 6164 6174 610a 2020 2020 2020  emetadata.      
-000094a0: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
-000094b0: 7469 6679 203d 2073 656c 662e 6e6f 7469  tify = self.noti
-000094c0: 6679 0a20 2020 2020 2020 2020 2020 2064  fy.            d
-000094d0: 6566 6175 6c74 5f70 7573 6862 756c 6c65  efault_pushbulle
-000094e0: 7474 6f6b 656e 203d 2073 656c 662e 7075  ttoken = self.pu
-000094f0: 7368 6275 6c6c 6574 746f 6b65 6e0a 2020  shbullettoken.  
-00009500: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00009510: 745f 736c 6163 6b74 6f6b 656e 203d 2073  t_slacktoken = s
-00009520: 656c 662e 736c 6163 6b74 6f6b 656e 0a20  elf.slacktoken. 
-00009530: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009540: 6c74 5f6d 6169 6c73 6572 7665 7220 3d20  lt_mailserver = 
-00009550: 7365 6c66 2e6d 6169 6c73 6572 7665 720a  self.mailserver.
-00009560: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00009570: 756c 745f 6d61 696c 6672 6f6d 203d 2073  ult_mailfrom = s
-00009580: 656c 662e 6d61 696c 6672 6f6d 0a20 2020  elf.mailfrom.   
-00009590: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000095a0: 5f6d 6169 6c74 6f20 3d20 7365 6c66 2e6d  _mailto = self.m
-000095b0: 6169 6c74 6f0a 2020 2020 2020 2020 2020  ailto.          
-000095c0: 2020 6465 6661 756c 745f 6e6f 7469 6679    default_notify
-000095d0: 636d 6420 3d20 7365 6c66 2e6e 6f74 6966  cmd = self.notif
-000095e0: 7963 6d64 0a20 2020 2020 2020 2020 2020  ycmd.           
-000095f0: 2064 6566 6175 6c74 5f6e 6f74 6966 7973   default_notifys
-00009600: 6372 6970 7420 3d20 7365 6c66 2e6e 6f74  cript = self.not
-00009610: 6966 7973 6372 6970 740a 2020 2020 2020  ifyscript.      
-00009620: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
-00009630: 7469 6679 6d65 7468 6f64 7320 3d20 7365  tifymethods = se
-00009640: 6c66 2e6e 6f74 6966 796d 6574 686f 6473  lf.notifymethods
-00009650: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00009660: 6175 6c74 5f73 6c61 636b 6368 616e 6e65  ault_slackchanne
-00009670: 6c20 3d20 7365 6c66 2e73 6c61 636b 6368  l = self.slackch
-00009680: 616e 6e65 6c0a 2020 2020 2020 2020 2020  annel.          
-00009690: 2020 6465 6661 756c 745f 7368 6172 6564    default_shared
-000096a0: 666f 6c64 6572 7320 3d20 7365 6c66 2e73  folders = self.s
-000096b0: 6861 7265 6466 6f6c 6465 7273 0a20 2020  haredfolders.   
-000096c0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000096d0: 5f6b 6572 6e65 6c20 3d20 7365 6c66 2e6b  _kernel = self.k
-000096e0: 6572 6e65 6c0a 2020 2020 2020 2020 2020  ernel.          
-000096f0: 2020 6465 6661 756c 745f 696e 6974 7264    default_initrd
-00009700: 203d 2073 656c 662e 696e 6974 7264 0a20   = self.initrd. 
-00009710: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009720: 6c74 5f63 6d64 6c69 6e65 203d 2073 656c  lt_cmdline = sel
-00009730: 662e 636d 646c 696e 650a 2020 2020 2020  f.cmdline.      
-00009740: 2020 2020 2020 6465 6661 756c 745f 706c        default_pl
-00009750: 6163 656d 656e 7420 3d20 7365 6c66 2e70  acement = self.p
-00009760: 6c61 6365 6d65 6e74 0a20 2020 2020 2020  lacement.       
-00009770: 2020 2020 2064 6566 6175 6c74 5f79 616d       default_yam
-00009780: 6c69 6e76 656e 746f 7279 203d 2073 656c  linventory = sel
-00009790: 662e 7961 6d6c 696e 7665 6e74 6f72 790a  f.yamlinventory.
-000097a0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000097b0: 756c 745f 6370 7568 6f74 706c 7567 203d  ult_cpuhotplug =
-000097c0: 2073 656c 662e 6370 7568 6f74 706c 7567   self.cpuhotplug
-000097d0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000097e0: 6175 6c74 5f6d 656d 6f72 7968 6f74 706c  ault_memoryhotpl
-000097f0: 7567 203d 2073 656c 662e 6d65 6d6f 7279  ug = self.memory
-00009800: 686f 7470 6c75 670a 2020 2020 2020 2020  hotplug.        
-00009810: 2020 2020 6465 6661 756c 745f 7669 7274      default_virt
-00009820: 7479 7065 203d 2073 656c 662e 7669 7274  type = self.virt
-00009830: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-00009840: 2064 6566 6175 6c74 5f73 6563 7572 6974   default_securit
-00009850: 7967 726f 7570 7320 3d20 7365 6c66 2e73  ygroups = self.s
-00009860: 6563 7572 6974 7967 726f 7570 730a 2020  ecuritygroups.  
-00009870: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00009880: 745f 726f 6f74 7061 7373 776f 7264 203d  t_rootpassword =
-00009890: 2073 656c 662e 726f 6f74 7061 7373 776f   self.rootpasswo
-000098a0: 7264 0a20 2020 2020 2020 2020 2020 2064  rd.            d
-000098b0: 6566 6175 6c74 5f74 656d 706b 6579 203d  efault_tempkey =
-000098c0: 2073 656c 662e 7465 6d70 6b65 790a 2020   self.tempkey.  
-000098d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000098e0: 745f 766d 7573 6572 203d 2073 656c 662e  t_vmuser = self.
-000098f0: 766d 7573 6572 0a20 2020 2020 2020 2020  vmuser.         
-00009900: 2020 2064 6566 6175 6c74 5f77 6169 7420     default_wait 
-00009910: 3d20 7365 6c66 2e77 6169 740a 2020 2020  = self.wait.    
-00009920: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00009930: 7761 6974 636f 6d6d 616e 6420 3d20 7365  waitcommand = se
-00009940: 6c66 2e77 6169 7463 6f6d 6d61 6e64 0a20  lf.waitcommand. 
-00009950: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009960: 6c74 5f77 6169 7474 696d 656f 7574 203d  lt_waittimeout =
-00009970: 2073 656c 662e 7761 6974 7469 6d65 6f75   self.waittimeou
-00009980: 740a 2020 2020 2020 2020 706c 616e 203d  t.        plan =
-00009990: 2070 726f 6669 6c65 2e67 6574 2827 706c   profile.get('pl
-000099a0: 616e 272c 2070 6c61 6e29 0a20 2020 2020  an', plan).     
-000099b0: 2020 2074 656d 706c 6174 6520 3d20 7072     template = pr
-000099c0: 6f66 696c 652e 6765 7428 2774 656d 706c  ofile.get('templ
-000099d0: 6174 6527 2c20 6465 6661 756c 745f 696d  ate', default_im
-000099e0: 6167 6529 0a20 2020 2020 2020 2069 6d61  age).        ima
-000099f0: 6765 203d 2070 726f 6669 6c65 2e67 6574  ge = profile.get
-00009a00: 2827 696d 6167 6527 2c20 7465 6d70 6c61  ('image', templa
-00009a10: 7465 290a 2020 2020 2020 2020 6e65 7473  te).        nets
-00009a20: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-00009a30: 6e65 7473 272c 2064 6566 6175 6c74 5f6e  nets', default_n
-00009a40: 6574 7329 0a20 2020 2020 2020 2063 7075  ets).        cpu
-00009a50: 6d6f 6465 6c20 3d20 7072 6f66 696c 652e  model = profile.
-00009a60: 6765 7428 2763 7075 6d6f 6465 6c27 2c20  get('cpumodel', 
-00009a70: 6465 6661 756c 745f 6370 756d 6f64 656c  default_cpumodel
-00009a80: 290a 2020 2020 2020 2020 6370 7566 6c61  ).        cpufla
-00009a90: 6773 203d 2070 726f 6669 6c65 2e67 6574  gs = profile.get
-00009aa0: 2827 6370 7566 6c61 6773 272c 2064 6566  ('cpuflags', def
-00009ab0: 6175 6c74 5f63 7075 666c 6167 7329 0a20  ault_cpuflags). 
-00009ac0: 2020 2020 2020 2063 7075 7069 6e6e 696e         cpupinnin
-00009ad0: 6720 3d20 7072 6f66 696c 652e 6765 7428  g = profile.get(
-00009ae0: 2763 7075 7069 6e6e 696e 6727 2c20 6465  'cpupinning', de
-00009af0: 6661 756c 745f 6370 7570 696e 6e69 6e67  fault_cpupinning
-00009b00: 290a 2020 2020 2020 2020 6e75 6d61 6d6f  ).        numamo
-00009b10: 6465 203d 2070 726f 6669 6c65 2e67 6574  de = profile.get
-00009b20: 2827 6e75 6d61 6d6f 6465 272c 2064 6566  ('numamode', def
-00009b30: 6175 6c74 5f6e 756d 616d 6f64 6529 0a20  ault_numamode). 
-00009b40: 2020 2020 2020 206e 756d 6120 3d20 7072         numa = pr
-00009b50: 6f66 696c 652e 6765 7428 276e 756d 6127  ofile.get('numa'
-00009b60: 2c20 6465 6661 756c 745f 6e75 6d61 290a  , default_numa).
-00009b70: 2020 2020 2020 2020 7063 6964 6576 6963          pcidevic
-00009b80: 6573 203d 2070 726f 6669 6c65 2e67 6574  es = profile.get
-00009b90: 2827 7063 6964 6576 6963 6573 272c 2064  ('pcidevices', d
-00009ba0: 6566 6175 6c74 5f70 6369 6465 7669 6365  efault_pcidevice
-00009bb0: 7329 0a20 2020 2020 2020 2074 706d 203d  s).        tpm =
-00009bc0: 2070 726f 6669 6c65 2e67 6574 2827 7470   profile.get('tp
-00009bd0: 6d27 2c20 6465 6661 756c 745f 7470 6d29  m', default_tpm)
-00009be0: 0a20 2020 2020 2020 2072 6e67 203d 2070  .        rng = p
-00009bf0: 726f 6669 6c65 2e67 6574 2827 726e 6727  rofile.get('rng'
-00009c00: 2c20 6465 6661 756c 745f 726e 6729 0a20  , default_rng). 
-00009c10: 2020 2020 2020 207a 6572 6f74 6965 725f         zerotier_
-00009c20: 6e65 7473 203d 2070 726f 6669 6c65 2e67  nets = profile.g
-00009c30: 6574 2827 7a65 726f 7469 6572 5f6e 6574  et('zerotier_net
-00009c40: 7327 2c20 6465 6661 756c 745f 7a65 726f  s', default_zero
-00009c50: 7469 6572 5f6e 6574 7329 0a20 2020 2020  tier_nets).     
-00009c60: 2020 207a 6572 6f74 6965 725f 6b75 6265     zerotier_kube
-00009c70: 6c65 7420 3d20 7072 6f66 696c 652e 6765  let = profile.ge
-00009c80: 7428 277a 6572 6f74 6965 725f 6b75 6265  t('zerotier_kube
-00009c90: 6c65 7427 2c20 6465 6661 756c 745f 7a65  let', default_ze
-00009ca0: 726f 7469 6572 5f6b 7562 656c 6574 290a  rotier_kubelet).
-00009cb0: 2020 2020 2020 2020 7365 6375 7269 7479          security
-00009cc0: 6772 6f75 7073 203d 2070 726f 6669 6c65  groups = profile
-00009cd0: 2e67 6574 2827 7365 6375 7269 7479 6772  .get('securitygr
-00009ce0: 6f75 7073 272c 2064 6566 6175 6c74 5f73  oups', default_s
-00009cf0: 6563 7572 6974 7967 726f 7570 7329 0a20  ecuritygroups). 
-00009d00: 2020 2020 2020 206e 756d 6370 7573 203d         numcpus =
-00009d10: 2070 726f 6669 6c65 2e67 6574 2827 6e75   profile.get('nu
-00009d20: 6d63 7075 7327 2c20 6465 6661 756c 745f  mcpus', default_
-00009d30: 6e75 6d63 7075 7329 0a20 2020 2020 2020  numcpus).       
-00009d40: 206d 656d 6f72 7920 3d20 7072 6f66 696c   memory = profil
-00009d50: 652e 6765 7428 276d 656d 6f72 7927 2c20  e.get('memory', 
-00009d60: 6465 6661 756c 745f 6d65 6d6f 7279 290a  default_memory).
-00009d70: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00009d80: 7461 6e63 6528 6d65 6d6f 7279 2c20 7374  tance(memory, st
-00009d90: 7229 2061 6e64 2028 6d65 6d6f 7279 2e6c  r) and (memory.l
-00009da0: 6f77 6572 2829 2e65 6e64 7377 6974 6828  ower().endswith(
-00009db0: 2767 6227 2920 6f72 206d 656d 6f72 792e  'gb') or memory.
-00009dc0: 6c6f 7765 7228 292e 656e 6473 7769 7468  lower().endswith
-00009dd0: 2827 6727 2929 3a0a 2020 2020 2020 2020  ('g')):.        
-00009de0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00009df0: 2020 2020 2020 2020 206d 656d 6f72 7920           memory 
-00009e00: 3d20 696e 7428 6d65 6d6f 7279 2e6c 6f77  = int(memory.low
-00009e10: 6572 2827 6762 272c 2027 2729 2e72 6570  er('gb', '').rep
-00009e20: 6c61 6365 2827 6727 2c20 2727 2929 202a  lace('g', '')) *
-00009e30: 2031 3032 340a 2020 2020 2020 2020 2020   1024.          
-00009e40: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00009e50: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-00009e60: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
-00009e70: 2243 6f75 6c64 6e74 2063 6f6e 7665 7274  "Couldnt convert
-00009e80: 206d 656d 6f72 792e 2048 6974 207b 657d   memory. Hit {e}
-00009e90: 2229 0a20 2020 2020 2020 2070 6f6f 6c20  ").        pool 
-00009ea0: 3d20 7072 6f66 696c 652e 6765 7428 2770  = profile.get('p
-00009eb0: 6f6f 6c27 2c20 6465 6661 756c 745f 706f  ool', default_po
-00009ec0: 6f6c 290a 2020 2020 2020 2020 6469 736b  ol).        disk
-00009ed0: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
-00009ee0: 2764 6973 6b73 272c 2064 6566 6175 6c74  'disks', default
-00009ef0: 5f64 6973 6b73 290a 2020 2020 2020 2020  _disks).        
-00009f00: 6469 736b 7369 7a65 203d 2070 726f 6669  disksize = profi
-00009f10: 6c65 2e67 6574 2827 6469 736b 7369 7a65  le.get('disksize
-00009f20: 272c 2064 6566 6175 6c74 5f64 6973 6b73  ', default_disks
-00009f30: 697a 6529 0a20 2020 2020 2020 2064 6973  ize).        dis
-00009f40: 6b69 6e74 6572 6661 6365 203d 2070 726f  kinterface = pro
-00009f50: 6669 6c65 2e67 6574 2827 6469 736b 696e  file.get('diskin
-00009f60: 7465 7266 6163 6527 2c20 6465 6661 756c  terface', defaul
-00009f70: 745f 6469 736b 696e 7465 7266 6163 6529  t_diskinterface)
-00009f80: 0a20 2020 2020 2020 2064 6973 6b74 6869  .        diskthi
-00009f90: 6e20 3d20 7072 6f66 696c 652e 6765 7428  n = profile.get(
-00009fa0: 2764 6973 6b74 6869 6e27 2c20 6465 6661  'diskthin', defa
-00009fb0: 756c 745f 6469 736b 7468 696e 290a 2020  ult_diskthin).  
-00009fc0: 2020 2020 2020 6966 2064 6973 6b73 2061        if disks a
-00009fd0: 6e64 2069 7369 6e73 7461 6e63 6528 6469  nd isinstance(di
-00009fe0: 736b 732c 2064 6963 7429 2061 6e64 2027  sks, dict) and '
-00009ff0: 6465 6661 756c 7427 2069 6e20 6469 736b  default' in disk
-0000a000: 735b 305d 3a0a 2020 2020 2020 2020 2020  s[0]:.          
-0000a010: 2020 6469 736b 7320 3d20 5b7b 2773 697a    disks = [{'siz
-0000a020: 6527 3a20 6469 736b 7369 7a65 2c20 2769  e': disksize, 'i
-0000a030: 6e74 6572 6661 6365 273a 2064 6973 6b69  nterface': diski
-0000a040: 6e74 6572 6661 6365 2c20 2774 6869 6e27  nterface, 'thin'
-0000a050: 3a20 6469 736b 7468 696e 7d5d 0a20 2020  : diskthin}].   
-0000a060: 2020 2020 2067 7565 7374 6964 203d 2070       guestid = p
-0000a070: 726f 6669 6c65 2e67 6574 2827 6775 6573  rofile.get('gues
-0000a080: 7469 6427 2c20 6465 6661 756c 745f 6775  tid', default_gu
-0000a090: 6573 7469 6429 0a20 2020 2020 2020 2069  estid).        i
-0000a0a0: 736f 203d 2070 726f 6669 6c65 2e67 6574  so = profile.get
-0000a0b0: 2827 6973 6f27 2c20 6465 6661 756c 745f  ('iso', default_
-0000a0c0: 6973 6f29 0a20 2020 2020 2020 2076 6e63  iso).        vnc
-0000a0d0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a0e0: 766e 6327 2c20 6465 6661 756c 745f 766e  vnc', default_vn
-0000a0f0: 6329 0a20 2020 2020 2020 2063 6c6f 7564  c).        cloud
-0000a100: 696e 6974 203d 2070 726f 6669 6c65 2e67  init = profile.g
-0000a110: 6574 2827 636c 6f75 6469 6e69 7427 2c20  et('cloudinit', 
-0000a120: 6465 6661 756c 745f 636c 6f75 6469 6e69  default_cloudini
-0000a130: 7429 0a20 2020 2020 2020 2069 6620 636c  t).        if cl
-0000a140: 6f75 6469 6e69 7420 616e 6420 7365 6c66  oudinit and self
-0000a150: 2e74 7970 6520 3d3d 2027 6b76 6d27 2061  .type == 'kvm' a
-0000a160: 6e64 5c0a 2020 2020 2020 2020 2020 2020  nd\.            
-0000a170: 2020 2020 7768 6963 6828 276d 6b69 736f      which('mkiso
-0000a180: 6673 2729 2069 7320 4e6f 6e65 2061 6e64  fs') is None and
-0000a190: 2077 6869 6368 2827 6765 6e69 736f 696d   which('genisoim
-0000a1a0: 6167 6527 2920 6973 204e 6f6e 653a 0a20  age') is None:. 
-0000a1b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a1c0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-0000a1d0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-0000a1e0: 3a20 224d 6973 7369 6e67 206d 6b69 736f  : "Missing mkiso
-0000a1f0: 6673 2f67 656e 6973 6f69 6d61 6765 206e  fs/genisoimage n
-0000a200: 6565 6465 6420 666f 7220 636c 6f75 6469  eeded for cloudi
-0000a210: 6e69 7422 7d0a 2020 2020 2020 2020 7265  nit"}.        re
-0000a220: 7365 7276 6569 7020 3d20 7072 6f66 696c  serveip = profil
-0000a230: 652e 6765 7428 2772 6573 6572 7665 6970  e.get('reserveip
-0000a240: 272c 2064 6566 6175 6c74 5f72 6573 6572  ', default_reser
-0000a250: 7665 6970 290a 2020 2020 2020 2020 7265  veip).        re
-0000a260: 7365 7276 6564 6e73 203d 2070 726f 6669  servedns = profi
-0000a270: 6c65 2e67 6574 2827 7265 7365 7276 6564  le.get('reserved
-0000a280: 6e73 272c 2064 6566 6175 6c74 5f72 6573  ns', default_res
-0000a290: 6572 7665 646e 7329 0a20 2020 2020 2020  ervedns).       
-0000a2a0: 2072 6573 6572 7665 686f 7374 203d 2070   reservehost = p
-0000a2b0: 726f 6669 6c65 2e67 6574 2827 7265 7365  rofile.get('rese
-0000a2c0: 7276 6568 6f73 7427 2c20 6465 6661 756c  rvehost', defaul
-0000a2d0: 745f 7265 7365 7276 6568 6f73 7429 0a20  t_reservehost). 
-0000a2e0: 2020 2020 2020 206e 6573 7465 6420 3d20         nested = 
-0000a2f0: 7072 6f66 696c 652e 6765 7428 276e 6573  profile.get('nes
-0000a300: 7465 6427 2c20 6465 6661 756c 745f 6e65  ted', default_ne
-0000a310: 7374 6564 290a 2020 2020 2020 2020 7374  sted).        st
-0000a320: 6172 7420 3d20 7072 6f66 696c 652e 6765  art = profile.ge
-0000a330: 7428 2773 7461 7274 272c 2064 6566 6175  t('start', defau
-0000a340: 6c74 5f73 7461 7274 290a 2020 2020 2020  lt_start).      
-0000a350: 2020 6175 746f 7374 6172 7420 3d20 7072    autostart = pr
-0000a360: 6f66 696c 652e 6765 7428 2761 7574 6f73  ofile.get('autos
-0000a370: 7461 7274 272c 2064 6566 6175 6c74 5f61  tart', default_a
-0000a380: 7574 6f73 7461 7274 290a 2020 2020 2020  utostart).      
-0000a390: 2020 6b65 7973 203d 2070 726f 6669 6c65    keys = profile
-0000a3a0: 2e67 6574 2827 6b65 7973 272c 2064 6566  .get('keys', def
-0000a3b0: 6175 6c74 5f6b 6579 7329 0a20 2020 2020  ault_keys).     
-0000a3c0: 2020 2063 6d64 7320 3d20 636f 6d6d 6f6e     cmds = common
-0000a3d0: 2e72 656d 6f76 655f 6475 706c 6963 6174  .remove_duplicat
-0000a3e0: 6573 2864 6566 6175 6c74 5f63 6d64 7320  es(default_cmds 
-0000a3f0: 2b20 7072 6f66 696c 652e 6765 7428 2763  + profile.get('c
-0000a400: 6d64 7327 2c20 5b5d 2929 0a20 2020 2020  mds', [])).     
-0000a410: 2020 206e 6574 6d61 736b 7320 3d20 7072     netmasks = pr
-0000a420: 6f66 696c 652e 6765 7428 276e 6574 6d61  ofile.get('netma
-0000a430: 736b 7327 2c20 6465 6661 756c 745f 6e65  sks', default_ne
-0000a440: 746d 6173 6b73 290a 2020 2020 2020 2020  tmasks).        
-0000a450: 6761 7465 7761 7920 3d20 7072 6f66 696c  gateway = profil
-0000a460: 652e 6765 7428 2767 6174 6577 6179 272c  e.get('gateway',
-0000a470: 2064 6566 6175 6c74 5f67 6174 6577 6179   default_gateway
-0000a480: 290a 2020 2020 2020 2020 646e 7320 3d20  ).        dns = 
-0000a490: 7072 6f66 696c 652e 6765 7428 2764 6e73  profile.get('dns
-0000a4a0: 272c 2064 6566 6175 6c74 5f64 6e73 290a  ', default_dns).
-0000a4b0: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
-0000a4c0: 2070 726f 6669 6c65 2e67 6574 2827 646f   profile.get('do
-0000a4d0: 6d61 696e 272c 206f 7665 7272 6964 6573  main', overrides
-0000a4e0: 2e67 6574 2827 646f 6d61 696e 272c 2064  .get('domain', d
-0000a4f0: 6566 6175 6c74 5f64 6f6d 6169 6e29 290a  efault_domain)).
-0000a500: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-0000a510: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-0000a520: 2764 6e73 636c 6965 6e74 272c 206f 7665  'dnsclient', ove
-0000a530: 7272 6964 6573 2e67 6574 2827 646e 7363  rrides.get('dnsc
-0000a540: 6c69 656e 7427 2c20 6465 6661 756c 745f  lient', default_
-0000a550: 646e 7363 6c69 656e 7429 290a 2020 2020  dnsclient)).    
-0000a560: 2020 2020 7363 7269 7074 7320 3d20 636f      scripts = co
-0000a570: 6d6d 6f6e 2e72 656d 6f76 655f 6475 706c  mmon.remove_dupl
-0000a580: 6963 6174 6573 2864 6566 6175 6c74 5f73  icates(default_s
-0000a590: 6372 6970 7473 202b 2070 726f 6669 6c65  cripts + profile
-0000a5a0: 2e67 6574 2827 7363 7269 7074 7327 2c20  .get('scripts', 
-0000a5b0: 5b5d 2929 0a20 2020 2020 2020 2066 696c  [])).        fil
-0000a5c0: 6573 203d 2070 726f 6669 6c65 2e67 6574  es = profile.get
-0000a5d0: 2827 6669 6c65 7327 2c20 6465 6661 756c  ('files', defaul
-0000a5e0: 745f 6669 6c65 7329 0a20 2020 2020 2020  t_files).       
-0000a5f0: 2065 7874 7261 5f66 696c 6573 203d 2070   extra_files = p
-0000a600: 726f 6669 6c65 2e67 6574 2827 6578 7472  rofile.get('extr
-0000a610: 615f 6669 6c65 7327 2920 6f72 206f 7665  a_files') or ove
-0000a620: 7272 6964 6573 2e67 6574 2827 6578 7472  rrides.get('extr
-0000a630: 615f 6669 6c65 7327 2920 6f72 205b 5d0a  a_files') or [].
-0000a640: 2020 2020 2020 2020 6669 6c65 732e 6578          files.ex
-0000a650: 7465 6e64 2865 7874 7261 5f66 696c 6573  tend(extra_files
-0000a660: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0000a670: 203d 2073 656c 662e 7061 7273 655f 6669   = self.parse_fi
-0000a680: 6c65 7328 6e61 6d65 2c20 6669 6c65 732c  les(name, files,
-0000a690: 2062 6173 6564 6972 2c20 6f6e 666c 7929   basedir, onfly)
-0000a6a0: 0a20 2020 2020 2020 2069 6620 7265 7375  .        if resu
-0000a6b0: 6c74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  lt is not None:.
-0000a6c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a6d0: 726e 2072 6573 756c 740a 2020 2020 2020  rn result.      
-0000a6e0: 2020 7072 6f66 696c 655f 656e 765f 7061    profile_env_pa
-0000a6f0: 7261 6d65 7465 7273 203d 205b 6b65 7920  rameters = [key 
-0000a700: 666f 7220 6b65 7920 696e 2070 726f 6669  for key in profi
-0000a710: 6c65 2069 6620 6b65 792e 6973 7570 7065  le if key.isuppe
-0000a720: 7228 295d 0a20 2020 2020 2020 206f 7665  r()].        ove
-0000a730: 7272 6964 6573 5f65 6e76 5f70 6172 616d  rrides_env_param
-0000a740: 6574 6572 7320 3d20 5b6b 6579 2066 6f72  eters = [key for
-0000a750: 206b 6579 2069 6e20 6f76 6572 7269 6465   key in override
-0000a760: 7320 6966 206b 6579 2e69 7375 7070 6572  s if key.isupper
-0000a770: 2829 5d0a 2020 2020 2020 2020 656e 765f  ()].        env_
-0000a780: 7061 7261 6d65 7465 7273 203d 2073 6f72  parameters = sor
-0000a790: 7465 6428 6c69 7374 2873 6574 2870 726f  ted(list(set(pro
-0000a7a0: 6669 6c65 5f65 6e76 5f70 6172 616d 6574  file_env_paramet
-0000a7b0: 6572 7320 2b20 6f76 6572 7269 6465 735f  ers + overrides_
-0000a7c0: 656e 765f 7061 7261 6d65 7465 7273 2929  env_parameters))
-0000a7d0: 290a 2020 2020 2020 2020 6966 2065 6e76  ).        if env
-0000a7e0: 5f70 6172 616d 6574 6572 733a 0a20 2020  _parameters:.   
-0000a7f0: 2020 2020 2020 2020 2065 6e76 5f64 6174           env_dat
-0000a800: 6120 3d20 2727 0a20 2020 2020 2020 2020  a = ''.         
-0000a810: 2020 2066 6f72 206b 6579 2069 6e20 656e     for key in en
-0000a820: 765f 7061 7261 6d65 7465 7273 3a0a 2020  v_parameters:.  
-0000a830: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0000a840: 6c75 6520 3d20 7072 6f66 696c 652e 6765  lue = profile.ge
-0000a850: 7428 6b65 7929 206f 7220 6f76 6572 7269  t(key) or overri
-0000a860: 6465 732e 6765 7428 6b65 7929 0a20 2020  des.get(key).   
-0000a870: 2020 2020 2020 2020 2020 2020 2065 6e76               env
-0000a880: 5f64 6174 6120 2b3d 2066 2265 7870 6f72  _data += f"expor
-0000a890: 7420 7b6b 6579 7d3d 7b76 616c 7565 7d5c  t {key}={value}\
-0000a8a0: 6e65 7870 6f72 7420 7b6b 6579 2e6c 6f77  nexport {key.low
-0000a8b0: 6572 2829 7d3d 7b76 616c 7565 7d5c 6e22  er()}={value}\n"
-0000a8c0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0000a8d0: 6573 2e61 7070 656e 6428 7b27 7061 7468  es.append({'path
-0000a8e0: 273a 2027 2f65 7463 2f70 726f 6669 6c65  ': '/etc/profile
-0000a8f0: 2e64 2f6b 636c 692e 7368 272c 2027 636f  .d/kcli.sh', 'co
-0000a900: 6e74 656e 7427 3a20 656e 765f 6461 7461  ntent': env_data
-0000a910: 2c20 276d 6f64 6527 3a20 3634 347d 290a  , 'mode': 644}).
-0000a920: 2020 2020 2020 2020 656e 6162 6c65 726f          enablero
-0000a930: 6f74 203d 2070 726f 6669 6c65 2e67 6574  ot = profile.get
-0000a940: 2827 656e 6162 6c65 726f 6f74 272c 2064  ('enableroot', d
-0000a950: 6566 6175 6c74 5f65 6e61 626c 6572 6f6f  efault_enableroo
-0000a960: 7429 0a20 2020 2020 2020 2074 6167 7320  t).        tags 
-0000a970: 3d20 7072 6f66 696c 652e 6765 7428 2774  = profile.get('t
-0000a980: 6167 7327 2c20 5b5d 290a 2020 2020 2020  ags', []).      
-0000a990: 2020 6966 2064 6566 6175 6c74 5f74 6167    if default_tag
-0000a9a0: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-0000a9b0: 6167 7320 3d20 6465 6661 756c 745f 7461  ags = default_ta
-0000a9c0: 6773 202b 2074 6167 7320 6966 2074 6167  gs + tags if tag
-0000a9d0: 7320 656c 7365 2064 6566 6175 6c74 5f74  s else default_t
-0000a9e0: 6167 730a 2020 2020 2020 2020 7072 6976  ags.        priv
-0000a9f0: 6174 656b 6579 203d 2070 726f 6669 6c65  atekey = profile
-0000aa00: 2e67 6574 2827 7072 6976 6174 656b 6579  .get('privatekey
-0000aa10: 272c 2064 6566 6175 6c74 5f70 7269 7661  ', default_priva
-0000aa20: 7465 6b65 7929 0a20 2020 2020 2020 206e  tekey).        n
-0000aa30: 6574 776f 726b 7761 6974 203d 2070 726f  etworkwait = pro
-0000aa40: 6669 6c65 2e67 6574 2827 6e65 7477 6f72  file.get('networ
-0000aa50: 6b77 6169 7427 2c20 6465 6661 756c 745f  kwait', default_
-0000aa60: 6e65 7477 6f72 6b77 6169 7429 0a20 2020  networkwait).   
-0000aa70: 2020 2020 2072 686e 7265 6769 7374 6572       rhnregister
-0000aa80: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000aa90: 7268 6e72 6567 6973 7465 7227 2c20 6465  rhnregister', de
-0000aaa0: 6661 756c 745f 7268 6e72 6567 6973 7465  fault_rhnregiste
-0000aab0: 7229 0a20 2020 2020 2020 2072 686e 7365  r).        rhnse
-0000aac0: 7276 6572 203d 2070 726f 6669 6c65 2e67  rver = profile.g
-0000aad0: 6574 2827 7268 6e73 6572 7665 7227 2c20  et('rhnserver', 
-0000aae0: 6465 6661 756c 745f 7268 6e73 6572 7665  default_rhnserve
-0000aaf0: 7229 0a20 2020 2020 2020 2072 686e 7573  r).        rhnus
-0000ab00: 6572 203d 2070 726f 6669 6c65 2e67 6574  er = profile.get
-0000ab10: 2827 7268 6e75 7365 7227 2c20 6465 6661  ('rhnuser', defa
-0000ab20: 756c 745f 7268 6e75 7365 7229 0a20 2020  ult_rhnuser).   
-0000ab30: 2020 2020 2072 686e 7061 7373 776f 7264       rhnpassword
-0000ab40: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000ab50: 7268 6e70 6173 7377 6f72 6427 2c20 6465  rhnpassword', de
-0000ab60: 6661 756c 745f 7268 6e70 6173 7377 6f72  fault_rhnpasswor
-0000ab70: 6429 0a20 2020 2020 2020 2072 686e 616b  d).        rhnak
-0000ab80: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000ab90: 7268 6e61 6374 6976 6174 696f 6e6b 6579  rhnactivationkey
-0000aba0: 272c 2064 6566 6175 6c74 5f72 686e 616b  ', default_rhnak
-0000abb0: 290a 2020 2020 2020 2020 7268 6e6f 7267  ).        rhnorg
-0000abc0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000abd0: 7268 6e6f 7267 272c 2064 6566 6175 6c74  rhnorg', default
-0000abe0: 5f72 686e 6f72 6729 0a20 2020 2020 2020  _rhnorg).       
-0000abf0: 2072 686e 706f 6f6c 203d 2070 726f 6669   rhnpool = profi
-0000ac00: 6c65 2e67 6574 2827 7268 6e70 6f6f 6c27  le.get('rhnpool'
-0000ac10: 2c20 6465 6661 756c 745f 7268 6e70 6f6f  , default_rhnpoo
-0000ac20: 6c29 0a20 2020 2020 2020 2066 6c61 766f  l).        flavo
-0000ac30: 7220 3d20 7072 6f66 696c 652e 6765 7428  r = profile.get(
-0000ac40: 2766 6c61 766f 7227 2c20 6465 6661 756c  'flavor', defaul
-0000ac50: 745f 666c 6176 6f72 290a 2020 2020 2020  t_flavor).      
-0000ac60: 2020 7374 6f72 656d 6574 6164 6174 6120    storemetadata 
-0000ac70: 3d20 7072 6f66 696c 652e 6765 7428 2773  = profile.get('s
-0000ac80: 746f 7265 6d65 7461 6461 7461 272c 2064  toremetadata', d
-0000ac90: 6566 6175 6c74 5f73 746f 7265 6d65 7461  efault_storemeta
-0000aca0: 6461 7461 290a 2020 2020 2020 2020 6e6f  data).        no
-0000acb0: 7469 6679 203d 2070 726f 6669 6c65 2e67  tify = profile.g
-0000acc0: 6574 2827 6e6f 7469 6679 272c 2064 6566  et('notify', def
-0000acd0: 6175 6c74 5f6e 6f74 6966 7929 0a20 2020  ault_notify).   
-0000ace0: 2020 2020 2070 7573 6862 756c 6c65 7474       pushbullett
-0000acf0: 6f6b 656e 203d 2070 726f 6669 6c65 2e67  oken = profile.g
-0000ad00: 6574 2827 7075 7368 6275 6c6c 6574 746f  et('pushbulletto
-0000ad10: 6b65 6e27 2c20 6465 6661 756c 745f 7075  ken', default_pu
-0000ad20: 7368 6275 6c6c 6574 746f 6b65 6e29 0a20  shbullettoken). 
-0000ad30: 2020 2020 2020 2073 6c61 636b 746f 6b65         slacktoke
-0000ad40: 6e20 3d20 7072 6f66 696c 652e 6765 7428  n = profile.get(
-0000ad50: 2773 6c61 636b 746f 6b65 6e27 2c20 6465  'slacktoken', de
-0000ad60: 6661 756c 745f 736c 6163 6b74 6f6b 656e  fault_slacktoken
-0000ad70: 290a 2020 2020 2020 2020 6e6f 7469 6679  ).        notify
-0000ad80: 636d 6420 3d20 7072 6f66 696c 652e 6765  cmd = profile.ge
-0000ad90: 7428 276e 6f74 6966 7963 6d64 272c 2064  t('notifycmd', d
-0000ada0: 6566 6175 6c74 5f6e 6f74 6966 7963 6d64  efault_notifycmd
-0000adb0: 290a 2020 2020 2020 2020 6e6f 7469 6679  ).        notify
-0000adc0: 7363 7269 7074 203d 2070 726f 6669 6c65  script = profile
-0000add0: 2e67 6574 2827 6e6f 7469 6679 7363 7269  .get('notifyscri
-0000ade0: 7074 272c 2064 6566 6175 6c74 5f6e 6f74  pt', default_not
-0000adf0: 6966 7973 6372 6970 7429 0a20 2020 2020  ifyscript).     
-0000ae00: 2020 206e 6f74 6966 796d 6574 686f 6473     notifymethods
-0000ae10: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000ae20: 6e6f 7469 6679 6d65 7468 6f64 7327 2c20  notifymethods', 
-0000ae30: 6465 6661 756c 745f 6e6f 7469 6679 6d65  default_notifyme
-0000ae40: 7468 6f64 7329 0a20 2020 2020 2020 2073  thods).        s
-0000ae50: 6c61 636b 6368 616e 6e65 6c20 3d20 7072  lackchannel = pr
-0000ae60: 6f66 696c 652e 6765 7428 2773 6c61 636b  ofile.get('slack
-0000ae70: 6368 616e 6e65 6c27 2c20 6465 6661 756c  channel', defaul
-0000ae80: 745f 736c 6163 6b63 6861 6e6e 656c 290a  t_slackchannel).
-0000ae90: 2020 2020 2020 2020 6d61 696c 7365 7276          mailserv
-0000aea0: 6572 203d 2070 726f 6669 6c65 2e67 6574  er = profile.get
-0000aeb0: 2827 6d61 696c 7365 7276 6572 272c 2064  ('mailserver', d
-0000aec0: 6566 6175 6c74 5f6d 6169 6c73 6572 7665  efault_mailserve
-0000aed0: 7229 0a20 2020 2020 2020 206d 6169 6c66  r).        mailf
-0000aee0: 726f 6d20 3d20 7072 6f66 696c 652e 6765  rom = profile.ge
-0000aef0: 7428 276d 6169 6c66 726f 6d27 2c20 6465  t('mailfrom', de
-0000af00: 6661 756c 745f 6d61 696c 6672 6f6d 290a  fault_mailfrom).
-0000af10: 2020 2020 2020 2020 6d61 696c 746f 203d          mailto =
-0000af20: 2070 726f 6669 6c65 2e67 6574 2827 6d61   profile.get('ma
-0000af30: 696c 746f 272c 2064 6566 6175 6c74 5f6d  ilto', default_m
-0000af40: 6169 6c74 6f29 0a20 2020 2020 2020 2073  ailto).        s
-0000af50: 6861 7265 6466 6f6c 6465 7273 203d 2070  haredfolders = p
-0000af60: 726f 6669 6c65 2e67 6574 2827 7368 6172  rofile.get('shar
-0000af70: 6564 666f 6c64 6572 7327 2c20 6465 6661  edfolders', defa
-0000af80: 756c 745f 7368 6172 6564 666f 6c64 6572  ult_sharedfolder
-0000af90: 7329 0a20 2020 2020 2020 206b 6572 6e65  s).        kerne
-0000afa0: 6c20 3d20 7072 6f66 696c 652e 6765 7428  l = profile.get(
-0000afb0: 276b 6572 6e65 6c27 2c20 6465 6661 756c  'kernel', defaul
-0000afc0: 745f 6b65 726e 656c 290a 2020 2020 2020  t_kernel).      
-0000afd0: 2020 696e 6974 7264 203d 2070 726f 6669    initrd = profi
-0000afe0: 6c65 2e67 6574 2827 696e 6974 7264 272c  le.get('initrd',
-0000aff0: 2064 6566 6175 6c74 5f69 6e69 7472 6429   default_initrd)
-0000b000: 0a20 2020 2020 2020 2063 6d64 6c69 6e65  .        cmdline
-0000b010: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000b020: 636d 646c 696e 6527 2c20 6465 6661 756c  cmdline', defaul
-0000b030: 745f 636d 646c 696e 6529 0a20 2020 2020  t_cmdline).     
-0000b040: 2020 2070 6c61 6365 6d65 6e74 203d 2070     placement = p
-0000b050: 726f 6669 6c65 2e67 6574 2827 706c 6163  rofile.get('plac
-0000b060: 656d 656e 7427 2c20 6465 6661 756c 745f  ement', default_
-0000b070: 706c 6163 656d 656e 7429 0a20 2020 2020  placement).     
-0000b080: 2020 2079 616d 6c69 6e76 656e 746f 7279     yamlinventory
-0000b090: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000b0a0: 7961 6d6c 696e 7665 6e74 6f72 7927 2c20  yamlinventory', 
-0000b0b0: 6465 6661 756c 745f 7961 6d6c 696e 7665  default_yamlinve
-0000b0c0: 6e74 6f72 7929 0a20 2020 2020 2020 2063  ntory).        c
-0000b0d0: 7075 686f 7470 6c75 6720 3d20 7072 6f66  puhotplug = prof
-0000b0e0: 696c 652e 6765 7428 2763 7075 686f 7470  ile.get('cpuhotp
-0000b0f0: 6c75 6727 2c20 6465 6661 756c 745f 6370  lug', default_cp
-0000b100: 7568 6f74 706c 7567 290a 2020 2020 2020  uhotplug).      
-0000b110: 2020 6d65 6d6f 7279 686f 7470 6c75 6720    memoryhotplug 
-0000b120: 3d20 7072 6f66 696c 652e 6765 7428 276d  = profile.get('m
-0000b130: 656d 6f72 7968 6f74 706c 7567 272c 2064  emoryhotplug', d
-0000b140: 6566 6175 6c74 5f6d 656d 6f72 7968 6f74  efault_memoryhot
-0000b150: 706c 7567 290a 2020 2020 2020 2020 726f  plug).        ro
-0000b160: 6f74 7061 7373 776f 7264 203d 2070 726f  otpassword = pro
-0000b170: 6669 6c65 2e67 6574 2827 726f 6f74 7061  file.get('rootpa
-0000b180: 7373 776f 7264 272c 2064 6566 6175 6c74  ssword', default
-0000b190: 5f72 6f6f 7470 6173 7377 6f72 6429 0a20  _rootpassword). 
-0000b1a0: 2020 2020 2020 2076 6d75 7365 7220 3d20         vmuser = 
-0000b1b0: 7072 6f66 696c 652e 6765 7428 2776 6d75  profile.get('vmu
-0000b1c0: 7365 7227 2c20 6465 6661 756c 745f 766d  ser', default_vm
-0000b1d0: 7573 6572 290a 2020 2020 2020 2020 7465  user).        te
-0000b1e0: 6d70 6b65 7920 3d20 7072 6f66 696c 652e  mpkey = profile.
-0000b1f0: 6765 7428 2774 656d 706b 6579 272c 2064  get('tempkey', d
-0000b200: 6566 6175 6c74 5f74 656d 706b 6579 290a  efault_tempkey).
-0000b210: 2020 2020 2020 2020 7761 6974 203d 2070          wait = p
-0000b220: 726f 6669 6c65 2e67 6574 2827 7761 6974  rofile.get('wait
-0000b230: 272c 2064 6566 6175 6c74 5f77 6169 7429  ', default_wait)
-0000b240: 0a20 2020 2020 2020 2077 6169 7463 6f6d  .        waitcom
-0000b250: 6d61 6e64 203d 2070 726f 6669 6c65 2e67  mand = profile.g
-0000b260: 6574 2827 7761 6974 636f 6d6d 616e 6427  et('waitcommand'
-0000b270: 2c20 6465 6661 756c 745f 7761 6974 636f  , default_waitco
-0000b280: 6d6d 616e 6429 0a20 2020 2020 2020 2069  mmand).        i
-0000b290: 6620 7761 6974 636f 6d6d 616e 6420 6973  f waitcommand is
-0000b2a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000b2b0: 2020 2020 2020 2077 6169 7420 3d20 5472         wait = Tr
-0000b2c0: 7565 0a20 2020 2020 2020 2077 6169 7474  ue.        waitt
-0000b2d0: 696d 656f 7574 203d 2070 726f 6669 6c65  imeout = profile
-0000b2e0: 2e67 6574 2827 7761 6974 7469 6d65 6f75  .get('waittimeou
-0000b2f0: 7427 2c20 6465 6661 756c 745f 7761 6974  t', default_wait
-0000b300: 7469 6d65 6f75 7429 0a20 2020 2020 2020  timeout).       
-0000b310: 2076 6972 7474 7970 6520 3d20 7072 6f66   virttype = prof
-0000b320: 696c 652e 6765 7428 2776 6972 7474 7970  ile.get('virttyp
-0000b330: 6527 2c20 6465 6661 756c 745f 7669 7274  e', default_virt
-0000b340: 7479 7065 290a 2020 2020 2020 2020 6f76  type).        ov
-0000b350: 6572 7269 6465 732e 7570 6461 7465 2870  errides.update(p
-0000b360: 726f 6669 6c65 290a 2020 2020 2020 2020  rofile).        
-0000b370: 7363 7269 7074 636d 6473 203d 205b 5d0a  scriptcmds = [].
-0000b380: 2020 2020 2020 2020 6966 2069 6d61 6765          if image
-0000b390: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000b3a0: 2027 7268 656c 2720 696e 2069 6d61 6765   'rhel' in image
-0000b3b0: 2e6c 6f77 6572 2829 3a0a 2020 2020 2020  .lower():.      
-0000b3c0: 2020 2020 2020 6966 2072 686e 7265 6769        if rhnregi
-0000b3d0: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
-0000b3e0: 2020 2020 2020 6966 2072 686e 7573 6572        if rhnuser
-0000b3f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000b400: 2072 686e 7061 7373 776f 7264 2069 7320   rhnpassword is 
-0000b410: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000b420: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-0000b430: 6572 7269 6465 735b 2772 686e 7573 6572  errides['rhnuser
-0000b440: 275d 203d 2072 686e 7573 6572 0a20 2020  '] = rhnuser.   
-0000b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b460: 206f 7665 7272 6964 6573 5b27 7268 6e70   overrides['rhnp
-0000b470: 6173 7377 6f72 6427 5d20 3d20 7268 6e70  assword'] = rhnp
-0000b480: 6173 7377 6f72 640a 2020 2020 2020 2020  assword.        
-0000b490: 2020 2020 2020 2020 656c 6966 2072 686e          elif rhn
-0000b4a0: 616b 2069 7320 6e6f 7420 4e6f 6e65 2061  ak is not None a
-0000b4b0: 6e64 2072 686e 6f72 6720 6973 206e 6f74  nd rhnorg is not
-0000b4c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b4d0: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-0000b4e0: 6964 6573 5b27 7268 6e61 6374 6976 6174  ides['rhnactivat
-0000b4f0: 696f 6e6b 6579 275d 203d 2072 686e 616b  ionkey'] = rhnak
-0000b500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b510: 2020 2020 206f 7665 7272 6964 6573 5b27       overrides['
-0000b520: 7268 6e6f 7267 275d 203d 2072 686e 6f72  rhnorg'] = rhnor
-0000b530: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-0000b540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b550: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0000b560: 3d20 2252 686e 2072 6567 6973 7472 6174  = "Rhn registrat
-0000b570: 696f 6e20 7265 7175 6972 6564 2062 7574  ion required but
-0000b580: 206d 6973 7369 6e67 2063 7265 6465 6e74   missing credent
-0000b590: 6961 6c73 2e20 220a 2020 2020 2020 2020  ials. ".        
-0000b5a0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0000b5b0: 2b3d 2022 4465 6669 6e65 2072 686e 7573  += "Define rhnus
-0000b5c0: 6572 2f72 686e 7061 7373 776f 7264 206f  er/rhnpassword o
-0000b5d0: 7220 7268 6e61 6374 6976 6174 696f 6e6b  r rhnactivationk
-0000b5e0: 6579 2f72 686e 6f72 6722 0a20 2020 2020  ey/rhnorg".     
-0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000b600: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-0000b610: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-0000b620: 736f 6e27 3a20 6d73 677d 0a20 2020 2020  son': msg}.     
-0000b630: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000b640: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0000b650: 6e69 6e67 2866 227b 6e61 6d65 7d20 7769  ning(f"{name} wi
-0000b660: 6c6c 2072 6571 7569 7265 206d 616e 7561  ll require manua
-0000b670: 6c20 7375 6273 6372 6970 7469 6f6e 2074  l subscription t
-0000b680: 6f20 5265 6420 4861 7420 4e65 7477 6f72  o Red Hat Networ
-0000b690: 6b22 290a 2020 2020 2020 2020 6966 2069  k").        if i
-0000b6a0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-0000b6b0: 2061 6e64 2063 6c6f 7564 696e 6974 2061   and cloudinit a
-0000b6c0: 6e64 2069 736f 2069 7320 6e6f 7420 4e6f  nd iso is not No
-0000b6d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000b6e0: 7761 726e 696e 6728 6622 4967 6e6f 7269  warning(f"Ignori
-0000b6f0: 6e67 2069 736f 207b 6973 6f7d 2061 7320  ng iso {iso} as 
-0000b700: 696d 6167 6520 7b69 6d61 6765 7d20 6973  image {image} is
-0000b710: 2073 6574 2229 0a20 2020 2020 2020 2069   set").        i
-0000b720: 6620 7363 7269 7074 733a 0a20 2020 2020  f scripts:.     
-0000b730: 2020 2020 2020 2066 6f72 2073 6372 6970         for scrip
-0000b740: 7420 696e 2073 6372 6970 7473 3a0a 2020  t in scripts:.  
-0000b750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000b760: 206f 6e66 6c79 2069 7320 6e6f 7420 4e6f   onfly is not No
-0000b770: 6e65 2061 6e64 2027 7e27 206e 6f74 2069  ne and '~' not i
-0000b780: 6e20 7363 7269 7074 3a0a 2020 2020 2020  n script:.      
-0000b790: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000b7a0: 7374 6469 7220 3d20 6261 7365 6469 720a  stdir = basedir.
-0000b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7c0: 2020 2020 6966 2027 2f27 2069 6e20 7363      if '/' in sc
-0000b7d0: 7269 7074 3a0a 2020 2020 2020 2020 2020  ript:.          
-0000b7e0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000b7f0: 7374 6469 7220 3d20 6f73 2e70 6174 682e  stdir = os.path.
-0000b800: 6469 726e 616d 6528 7363 7269 7074 290a  dirname(script).
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-0000b830: 6972 7328 6465 7374 6469 722c 2065 7869  irs(destdir, exi
-0000b840: 7374 5f6f 6b3d 5472 7565 290a 2020 2020  st_ok=True).    
-0000b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b860: 636f 6d6d 6f6e 2e66 6574 6368 2866 227b  common.fetch(f"{
-0000b870: 6f6e 666c 797d 2f7b 7363 7269 7074 7d22  onfly}/{script}"
-0000b880: 2c20 6465 7374 6469 7229 0a20 2020 2020  , destdir).     
-0000b890: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
-0000b8a0: 7420 3d20 6f73 2e70 6174 682e 6578 7061  t = os.path.expa
-0000b8b0: 6e64 7573 6572 2873 6372 6970 7429 0a20  nduser(script). 
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000b8d0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-0000b8e0: 2873 6372 6970 7429 3a0a 2020 2020 2020  (script):.      
-0000b8f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000b900: 206e 6f74 206f 732e 7061 7468 2e69 7361   not os.path.isa
-0000b910: 6273 2873 6372 6970 7429 3a0a 2020 2020  bs(script):.    
-0000b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b930: 2020 2020 7363 7269 7074 203d 206f 732e      script = os.
-0000b940: 7061 7468 2e61 6273 7061 7468 2873 6372  path.abspath(scr
-0000b950: 6970 7429 0a20 2020 2020 2020 2020 2020  ipt).           
-0000b960: 2020 2020 2065 6c69 6620 6261 7365 6469       elif basedi
-0000b970: 7220 213d 2027 2e27 3a0a 2020 2020 2020  r != '.':.      
-0000b980: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0000b990: 7269 7074 203d 2066 277b 6261 7365 6469  ript = f'{basedi
-0000b9a0: 727d 2f7b 7363 7269 7074 7d27 0a20 2020  r}/{script}'.   
-0000b9b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b9c0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-0000b9d0: 7473 2873 6372 6970 7429 3a0a 2020 2020  ts(script):.    
-0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9f0: 6572 726f 7228 6622 5363 7269 7074 2066  error(f"Script f
-0000ba00: 696c 6520 7b73 6372 6970 747d 206e 6f74  ile {script} not
-0000ba10: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
-0000ba20: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0000ba30: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-0000ba40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba60: 2020 2073 6372 6970 7462 6173 6564 6972     scriptbasedir
-0000ba70: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0000ba80: 6d65 2873 6372 6970 7429 2069 6620 6f73  me(script) if os
-0000ba90: 2e70 6174 682e 6469 726e 616d 6528 7363  .path.dirname(sc
-0000baa0: 7269 7074 2920 213d 2027 2720 656c 7365  ript) != '' else
-0000bab0: 2027 2e27 0a20 2020 2020 2020 2020 2020   '.'.           
-0000bac0: 2020 2020 2020 2020 2065 6e76 203d 2045           env = E
-0000bad0: 6e76 6972 6f6e 6d65 6e74 286c 6f61 6465  nvironment(loade
-0000bae0: 723d 4669 6c65 5379 7374 656d 4c6f 6164  r=FileSystemLoad
-0000baf0: 6572 2873 6372 6970 7462 6173 6564 6972  er(scriptbasedir
-0000bb00: 292c 2075 6e64 6566 696e 6564 3d75 6e64  ), undefined=und
-0000bb10: 6566 696e 6564 2c0a 2020 2020 2020 2020  efined,.        
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb30: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0000bb40: 7465 6e73 696f 6e73 3d5b 276a 696e 6a61  tensions=['jinja
-0000bb50: 322e 6578 742e 646f 275d 2c20 7472 696d  2.ext.do'], trim
-0000bb60: 5f62 6c6f 636b 733d 5472 7565 2c20 6c73  _blocks=True, ls
-0000bb70: 7472 6970 5f62 6c6f 636b 733d 5472 7565  trip_blocks=True
-0000bb80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bb90: 2020 2020 2020 666f 7220 6a69 6e6a 6166        for jinjaf
-0000bba0: 696c 7465 7220 696e 206a 696e 6a61 6669  ilter in jinjafi
-0000bbb0: 6c74 6572 732e 6a69 6e6a 6166 696c 7465  lters.jinjafilte
-0000bbc0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000bbd0: 2020 2020 2020 2020 2020 2020 656e 762e              env.
-0000bbe0: 6669 6c74 6572 735b 6a69 6e6a 6166 696c  filters[jinjafil
-0000bbf0: 7465 725d 203d 206a 696e 6a61 6669 6c74  ter] = jinjafilt
-0000bc00: 6572 732e 6a69 6e6a 6166 696c 7465 7273  ers.jinjafilters
-0000bc10: 5b6a 696e 6a61 6669 6c74 6572 5d0a 2020  [jinjafilter].  
+00006310: 2020 2020 2020 2063 6c69 203d 206c 696e         cli = lin
+00006320: 655b 305d 2e73 7472 6970 2829 0a20 2020  e[0].strip().   
+00006330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006340: 2020 2020 2020 2020 2069 6620 636c 6920           if cli 
+00006350: 696e 206d 656d 6265 7273 2061 6e64 206d  in members and m
+00006360: 656d 6265 7273 2e69 6e64 6578 2863 6c69  embers.index(cli
+00006370: 2920 3c20 6c65 6e28 6d65 6d62 6572 7329  ) < len(members)
+00006380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063a0: 2020 636c 6969 6e64 6578 203d 206d 656d    cliindex = mem
+000063b0: 6265 7273 2e69 6e64 6578 2863 6c69 290a  bers.index(cli).
+000063c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 6e65 7763 6c69 203d 206d 656d 6265 7273  newcli = members
+000063f0: 5b28 636c 6969 6e64 6578 202b 2031 2920  [(cliindex + 1) 
+00006400: 2520 6c65 6e28 6d65 6d62 6572 7329 5d0a  % len(members)].
+00006410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006430: 6966 206e 6577 636c 6920 213d 2073 656c  if newcli != sel
+00006440: 662e 636c 6965 6e74 3a0a 2020 2020 2020  f.client:.      
+00006450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006460: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00006470: 6c66 2e65 7874 7261 636c 6965 6e74 735b  lf.extraclients[
+00006480: 7365 6c66 2e63 6c69 656e 745d 203d 206b  self.client] = k
+00006490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000064a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064b0: 2020 2020 206b 203d 2073 656c 662e 6578       k = self.ex
+000064c0: 7472 6163 6c69 656e 7473 5b6e 6577 636c  traclients[newcl
+000064d0: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
+000064e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064f0: 2020 2020 2020 2064 656c 2073 656c 662e         del self.
+00006500: 6578 7472 6163 6c69 656e 7473 5b6e 6577  extraclients[new
+00006510: 636c 695d 0a20 2020 2020 2020 2020 2020  cli].           
+00006520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006530: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
+00006540: 6965 6e74 203d 206e 6577 636c 690a 2020  ient = newcli.  
+00006550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006560: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00006570: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
+00006580: 2020 2020 2070 7072 696e 7428 6622 5365       pprint(f"Se
+00006590: 6c65 6374 696e 6720 636c 6965 6e74 207b  lecting client {
+000065a0: 7365 6c66 2e63 6c69 656e 747d 2066 726f  self.client} fro
+000065b0: 6d20 6772 6f75 7020 7b73 656c 662e 6772  m group {self.gr
+000065c0: 6f75 707d 2229 0a20 2020 2020 2020 2073  oup}").        s
+000065d0: 656c 662e 6b20 3d20 6b0a 2020 2020 2020  elf.k = k.      
+000065e0: 2020 6465 6661 756c 745f 6461 7461 203d    default_data =
+000065f0: 207b 2763 6f6e 6669 675f 2573 2720 2520   {'config_%s' % 
+00006600: 6b3a 2073 656c 662e 6465 6661 756c 745b  k: self.default[
+00006610: 6b5d 2066 6f72 206b 2069 6e20 7365 6c66  k] for k in self
+00006620: 2e64 6566 6175 6c74 7d0a 2020 2020 2020  .default}.      
+00006630: 2020 636f 6e66 6967 5f64 6174 6120 3d20    config_data = 
+00006640: 7b27 636f 6e66 6967 5f25 7327 2025 206b  {'config_%s' % k
+00006650: 3a20 7365 6c66 2e69 6e69 5b73 656c 662e  : self.ini[self.
+00006660: 636c 6965 6e74 5d5b 6b5d 2066 6f72 206b  client][k] for k
+00006670: 2069 6e20 7365 6c66 2e69 6e69 5b73 656c   in self.ini[sel
+00006680: 662e 636c 6965 6e74 5d7d 0a20 2020 2020  f.client]}.     
+00006690: 2020 2063 6f6e 6669 675f 6461 7461 5b27     config_data['
+000066a0: 636f 6e66 6967 5f74 7970 6527 5d20 3d20  config_type'] = 
+000066b0: 636f 6e66 6967 5f64 6174 612e 6765 7428  config_data.get(
+000066c0: 2763 6f6e 6669 675f 7479 7065 272c 2027  'config_type', '
+000066d0: 6b76 6d27 290a 2020 2020 2020 2020 636f  kvm').        co
+000066e0: 6e66 6967 5f64 6174 615b 2763 6f6e 6669  nfig_data['confi
+000066f0: 675f 686f 7374 275d 203d 2063 6f6e 6669  g_host'] = confi
+00006700: 675f 6461 7461 2e67 6574 2827 636f 6e66  g_data.get('conf
+00006710: 6967 5f68 6f73 7427 2c20 2731 3237 2e30  ig_host', '127.0
+00006720: 2e30 2e31 2729 0a20 2020 2020 2020 2064  .0.1').        d
+00006730: 6566 6175 6c74 5f75 7365 7220 3d20 6765  efault_user = ge
+00006740: 7475 7365 7228 2920 6966 2063 6f6e 6669  tuser() if confi
+00006750: 675f 6461 7461 5b27 636f 6e66 6967 5f74  g_data['config_t
+00006760: 7970 6527 5d20 3d3d 2027 6b76 6d27 5c0a  ype'] == 'kvm'\.
+00006770: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00006780: 7365 6c66 2e68 6f73 7420 696e 205b 276c  self.host in ['l
+00006790: 6f63 616c 686f 7374 272c 2027 3132 372e  ocalhost', '127.
+000067a0: 302e 302e 3127 5d20 656c 7365 2027 726f  0.0.1'] else 'ro
+000067b0: 6f74 270a 2020 2020 2020 2020 636f 6e66  ot'.        conf
+000067c0: 6967 5f64 6174 615b 2763 6f6e 6669 675f  ig_data['config_
+000067d0: 7573 6572 275d 203d 2063 6f6e 6669 675f  user'] = config_
+000067e0: 6461 7461 2e67 6574 2827 636f 6e66 6967  data.get('config
+000067f0: 5f75 7365 7227 2c20 6465 6661 756c 745f  _user', default_
+00006800: 7573 6572 290a 2020 2020 2020 2020 7365  user).        se
+00006810: 6c66 2e6f 7665 7272 6964 6573 2e75 7064  lf.overrides.upd
+00006820: 6174 6528 6465 6661 756c 745f 6461 7461  ate(default_data
+00006830: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
+00006840: 7665 7272 6964 6573 2e75 7064 6174 6528  verrides.update(
+00006850: 636f 6e66 6967 5f64 6174 6129 0a0a 2020  config_data)..  
+00006860: 2020 6465 6620 6372 6561 7465 5f76 6d28    def create_vm(
+00006870: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
+00006880: 696c 653d 4e6f 6e65 2c20 6f76 6572 7269  ile=None, overri
+00006890: 6465 733d 7b7d 2c20 6375 7374 6f6d 7072  des={}, custompr
+000068a0: 6f66 696c 653d 7b7d 2c20 6b3d 4e6f 6e65  ofile={}, k=None
+000068b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000068c0: 2020 2020 706c 616e 3d27 6b76 6972 7427      plan='kvirt'
+000068d0: 2c20 6261 7365 6469 723d 272e 272c 2063  , basedir='.', c
+000068e0: 6c69 656e 743d 4e6f 6e65 2c20 6f6e 666c  lient=None, onfl
+000068f0: 793d 4e6f 6e65 2c20 6f6e 6c79 6173 7365  y=None, onlyasse
+00006900: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
+00006910: 2020 206f 7665 7272 6964 6573 2e75 7064     overrides.upd
+00006920: 6174 6528 7365 6c66 2e6f 7665 7272 6964  ate(self.overrid
+00006930: 6573 290a 2020 2020 2020 2020 7772 6f6e  es).        wron
+00006940: 675f 6f76 6572 7269 6465 7320 3d20 5b79  g_overrides = [y
+00006950: 2066 6f72 2079 2069 6e20 6f76 6572 7269   for y in overri
+00006960: 6465 7320 6966 2027 2d27 2069 6e20 795d  des if '-' in y]
+00006970: 0a20 2020 2020 2020 2069 6620 7772 6f6e  .        if wron
+00006980: 675f 6f76 6572 7269 6465 733a 0a20 2020  g_overrides:.   
+00006990: 2020 2020 2020 2020 2066 6f72 2077 726f           for wro
+000069a0: 6e67 5f6f 7665 7272 6964 6520 696e 2077  ng_override in w
+000069b0: 726f 6e67 5f6f 7665 7272 6964 6573 3a0a  rong_overrides:.
+000069c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069d0: 6572 726f 7228 6622 496e 636f 7272 6563  error(f"Incorrec
+000069e0: 7420 7061 7261 6d65 7465 7220 7b77 726f  t parameter {wro
+000069f0: 6e67 5f6f 7665 7272 6964 6573 7d2e 2048  ng_overrides}. H
+00006a00: 7970 6865 6e73 2061 7265 206e 6f74 2061  yphens are not a
+00006a10: 6c6c 6f77 6564 2229 0a20 2020 2020 2020  llowed").       
+00006a20: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00006a30: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00006a40: 2c20 2772 6561 736f 6e27 3a20 2749 6e63  , 'reason': 'Inc
+00006a50: 6f72 7265 6374 2070 6172 616d 6574 6572  orrect parameter
+00006a60: 7320 666f 756e 6427 7d0a 2020 2020 2020  s found'}.      
+00006a70: 2020 6f76 6572 7269 6465 735b 276e 616d    overrides['nam
+00006a80: 6527 5d20 3d20 6e61 6d65 0a20 2020 2020  e'] = name.     
+00006a90: 2020 206b 7562 6520 3d20 6f76 6572 7269     kube = overri
+00006aa0: 6465 732e 6765 7428 276b 7562 6527 290a  des.get('kube').
+00006ab0: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
+00006ac0: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+00006ad0: 2827 6b75 6265 7479 7065 2729 0a20 2020  ('kubetype').   
+00006ae0: 2020 2020 206b 203d 2073 656c 662e 6b20       k = self.k 
+00006af0: 6966 206b 2069 7320 4e6f 6e65 2065 6c73  if k is None els
+00006b00: 6520 6b0a 2020 2020 2020 2020 6375 7374  e k.        cust
+00006b10: 6f6d 5f72 6567 696f 6e20 3d20 6e65 7874  om_region = next
+00006b20: 2828 6520 666f 7220 6520 696e 205b 6375  ((e for e in [cu
+00006b30: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+00006b40: 2772 6567 696f 6e27 292c 206f 7665 7272  'region'), overr
+00006b50: 6964 6573 2e67 6574 2827 7265 6769 6f6e  ides.get('region
+00006b60: 2729 5d20 6966 2065 2069 7320 6e6f 7420  ')] if e is not 
+00006b70: 4e6f 6e65 292c 204e 6f6e 6529 0a20 2020  None), None).   
+00006b80: 2020 2020 2069 6620 6375 7374 6f6d 5f72       if custom_r
+00006b90: 6567 696f 6e20 6973 206e 6f74 204e 6f6e  egion is not Non
+00006ba0: 6520 616e 6420 6861 7361 7474 7228 6b2c  e and hasattr(k,
+00006bb0: 2027 7265 6769 6f6e 2729 3a0a 2020 2020   'region'):.    
+00006bc0: 2020 2020 2020 2020 6b2e 7265 6769 6f6e          k.region
+00006bd0: 203d 2063 7573 746f 6d5f 7265 6769 6f6e   = custom_region
+00006be0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00006bf0: 6861 7361 7474 7228 6b2c 2027 7a6f 6e65  hasattr(k, 'zone
+00006c00: 2729 2061 6e64 2063 7573 746f 6d5f 7265  ') and custom_re
+00006c10: 6769 6f6e 206e 6f74 2069 6e20 6b2e 7a6f  gion not in k.zo
+00006c20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006c30: 2020 2020 6b2e 7a6f 6e65 203d 2066 227b      k.zone = f"{
+00006c40: 6375 7374 6f6d 5f72 6567 696f 6e7d 2d32  custom_region}-2
+00006c50: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+00006c60: 2073 656c 662e 7479 7065 203d 3d20 2769   self.type == 'i
+00006c70: 626d 273a 0a20 2020 2020 2020 2020 2020  bm':.           
+00006c80: 2020 2020 206b 2e63 6f6e 6e2e 7365 745f       k.conn.set_
+00006c90: 7365 7276 6963 655f 7572 6c28 6622 6874  service_url(f"ht
+00006ca0: 7470 733a 2f2f 7b63 7573 746f 6d5f 7265  tps://{custom_re
+00006cb0: 6769 6f6e 7d2e 6961 6173 2e63 6c6f 7564  gion}.iaas.cloud
+00006cc0: 2e69 626d 2e63 6f6d 2f76 3122 290a 2020  .ibm.com/v1").  
+00006cd0: 2020 2020 2020 6375 7374 6f6d 5f7a 6f6e        custom_zon
+00006ce0: 6520 3d20 6e65 7874 2828 6520 666f 7220  e = next((e for 
+00006cf0: 6520 696e 205b 6375 7374 6f6d 7072 6f66  e in [customprof
+00006d00: 696c 652e 6765 7428 277a 6f6e 6527 292c  ile.get('zone'),
+00006d10: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+00006d20: 7a6f 6e65 2729 5d20 6966 2065 2069 7320  zone')] if e is 
+00006d30: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
+00006d40: 0a20 2020 2020 2020 2069 6620 6375 7374  .        if cust
+00006d50: 6f6d 5f7a 6f6e 6520 6973 206e 6f74 204e  om_zone is not N
+00006d60: 6f6e 6520 616e 6420 6861 7361 7474 7228  one and hasattr(
+00006d70: 6b2c 2027 7a6f 6e65 2729 3a0a 2020 2020  k, 'zone'):.    
+00006d80: 2020 2020 2020 2020 6b2e 7a6f 6e65 203d          k.zone =
+00006d90: 2063 7573 746f 6d5f 7a6f 6e65 0a20 2020   custom_zone.   
+00006da0: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+00006db0: 7474 7228 6b2c 2027 7265 6769 6f6e 2729  ttr(k, 'region')
+00006dc0: 2061 6e64 206b 2e72 6567 696f 6e20 6e6f   and k.region no
+00006dd0: 7420 696e 206b 2e7a 6f6e 653a 0a20 2020  t in k.zone:.   
+00006de0: 2020 2020 2020 2020 2020 2020 206b 2e72               k.r
+00006df0: 6567 696f 6e20 3d20 6375 7374 6f6d 5f7a  egion = custom_z
+00006e00: 6f6e 655b 3a2d 325d 0a20 2020 2020 2020  one[:-2].       
+00006e10: 2074 756e 6e65 6c20 3d20 7365 6c66 2e74   tunnel = self.t
+00006e20: 756e 6e65 6c0a 2020 2020 2020 2020 7072  unnel.        pr
+00006e30: 6f66 696c 6520 3d20 7072 6f66 696c 6520  ofile = profile 
+00006e40: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
+00006e50: 2827 696d 6167 6527 2c20 276b 7669 7274  ('image', 'kvirt
+00006e60: 2729 0a20 2020 2020 2020 2066 756c 6c5f  ').        full_
+00006e70: 766f 6c75 6d65 7320 3d20 7365 6c66 2e6b  volumes = self.k
+00006e80: 2e76 6f6c 756d 6573 2829 0a20 2020 2020  .volumes().     
+00006e90: 2020 2076 6f6c 756d 6573 203d 205b 6f73     volumes = [os
+00006ea0: 2e70 6174 682e 6261 7365 6e61 6d65 2876  .path.basename(v
+00006eb0: 2920 666f 7220 7620 696e 2066 756c 6c5f  ) for v in full_
+00006ec0: 766f 6c75 6d65 735d 0a20 2020 2020 2020  volumes].       
+00006ed0: 2076 6d70 726f 6669 6c65 7320 3d20 7b6b   vmprofiles = {k
+00006ee0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+00006ef0: 7365 6c66 2e70 726f 6669 6c65 732e 6974  self.profiles.it
+00006f00: 656d 7328 2920 6966 2027 7479 7065 2720  ems() if 'type' 
+00006f10: 6e6f 7420 696e 2076 206f 7220 765b 2774  not in v or v['t
+00006f20: 7970 6527 5d20 3d3d 2027 766d 277d 0a20  ype'] == 'vm'}. 
+00006f30: 2020 2020 2020 2069 6620 6375 7374 6f6d         if custom
+00006f40: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
+00006f50: 2020 2020 2076 6d70 726f 6669 6c65 735b       vmprofiles[
+00006f60: 7072 6f66 696c 655d 203d 2063 7573 746f  profile] = custo
+00006f70: 6d70 726f 6669 6c65 0a20 2020 2020 2020  mprofile.       
+00006f80: 2065 6c69 6620 7072 6f66 696c 6520 696e   elif profile in
+00006f90: 2076 6d70 726f 6669 6c65 7320 616e 6420   vmprofiles and 
+00006fa0: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
+00006fb0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00006fc0: 6e74 2866 2244 6570 6c6f 7969 6e67 2076  nt(f"Deploying v
+00006fd0: 6d20 7b6e 616d 657d 2066 726f 6d20 7072  m {name} from pr
+00006fe0: 6f66 696c 6520 7b70 726f 6669 6c65 7d2e  ofile {profile}.
+00006ff0: 2e2e 2229 0a20 2020 2020 2020 2065 6c69  ..").        eli
+00007000: 6620 286f 732e 7061 7468 2e62 6173 656e  f (os.path.basen
+00007010: 616d 6528 7072 6f66 696c 6529 203d 3d20  ame(profile) == 
+00007020: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
+00007030: 696c 6520 696e 2076 6f6c 756d 6573 2920  ile in volumes) 
+00007040: 6f72 2070 726f 6669 6c65 2069 6e20 6675  or profile in fu
+00007050: 6c6c 5f76 6f6c 756d 6573 3a0a 2020 2020  ll_volumes:.    
+00007060: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00007070: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
+00007080: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00007090: 7428 6622 4465 706c 6f79 696e 6720 766d  t(f"Deploying vm
+000070a0: 207b 6e61 6d65 7d20 6672 6f6d 2069 6d61   {name} from ima
+000070b0: 6765 207b 7072 6f66 696c 657d 2e2e 2e22  ge {profile}..."
+000070c0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+000070d0: 775f 7072 6f66 696c 6520 3d20 6f73 2e70  w_profile = os.p
+000070e0: 6174 682e 6261 7365 6e61 6d65 2870 726f  ath.basename(pro
+000070f0: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+00007100: 2020 766d 7072 6f66 696c 6573 5b6e 6577    vmprofiles[new
+00007110: 5f70 726f 6669 6c65 5d20 3d20 7b27 696d  _profile] = {'im
+00007120: 6167 6527 3a20 7072 6f66 696c 657d 0a20  age': profile}. 
+00007130: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+00007140: 6c65 203d 206e 6577 5f70 726f 6669 6c65  le = new_profile
+00007150: 0a20 2020 2020 2020 2065 6c69 6620 7072  .        elif pr
+00007160: 6f66 696c 6520 696e 2049 4d41 4745 533a  ofile in IMAGES:
+00007170: 0a20 2020 2020 2020 2020 2020 2076 6d70  .            vmp
+00007180: 726f 6669 6c65 735b 7072 6f66 696c 655d  rofiles[profile]
+00007190: 203d 207b 2769 6d61 6765 273a 2070 726f   = {'image': pro
+000071a0: 6669 6c65 7d0a 2020 2020 2020 2020 656c  file}.        el
+000071b0: 6966 2070 726f 6669 6c65 2e73 7461 7274  if profile.start
+000071c0: 7377 6974 6828 2772 6863 6f73 2d34 2729  swith('rhcos-4')
+000071d0: 2061 6e64 2070 726f 6669 6c65 2e65 6e64   and profile.end
+000071e0: 7377 6974 6828 2771 636f 7732 2729 2061  swith('qcow2') a
+000071f0: 6e64 2073 656c 662e 7479 7065 206e 6f74  nd self.type not
+00007200: 2069 6e20 636c 6f75 6470 6c61 7466 6f72   in cloudplatfor
+00007210: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00007220: 766d 7072 6f66 696c 6573 5b70 726f 6669  vmprofiles[profi
+00007230: 6c65 5d20 3d20 7b27 696d 6167 6527 3a20  le] = {'image': 
+00007240: 7072 6f66 696c 657d 0a20 2020 2020 2020  profile}.       
+00007250: 2065 6c69 6620 7072 6f66 696c 6520 3d3d   elif profile ==
+00007260: 2027 6b76 6972 7427 3a0a 2020 2020 2020   'kvirt':.      
+00007270: 2020 2020 2020 766d 7072 6f66 696c 6573        vmprofiles
+00007280: 5b70 726f 6669 6c65 5d20 3d20 7b7d 0a20  [profile] = {}. 
+00007290: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000072a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000072b0: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+000072c0: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+000072d0: 6627 496d 6167 6520 7b70 726f 6669 6c65  f'Image {profile
+000072e0: 7d20 6e6f 7420 666f 756e 6427 7d0a 2020  } not found'}.  
+000072f0: 2020 2020 2020 7072 6f66 696c 656e 616d        profilenam
+00007300: 6520 3d20 7072 6f66 696c 650a 2020 2020  e = profile.    
+00007310: 2020 2020 7072 6f66 696c 6520 3d20 766d      profile = vm
+00007320: 7072 6f66 696c 6573 5b70 726f 6669 6c65  profiles[profile
+00007330: 5d0a 2020 2020 2020 2020 7069 6d61 6765  ].        pimage
+00007340: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+00007350: 696d 6167 6527 2c20 2758 5858 2729 0a20  image', 'XXX'). 
+00007360: 2020 2020 2020 2069 6620 6e6f 7420 6f6e         if not on
+00007370: 6c79 6173 7365 7473 2061 6e64 2073 656c  lyassets and sel
+00007380: 662e 7479 7065 206e 6f74 2069 6e20 636c  f.type not in cl
+00007390: 6f75 6470 6c61 7466 6f72 6d73 2061 6e64  oudplatforms and
+000073a0: 2070 696d 6167 6520 696e 2049 4d41 4745   pimage in IMAGE
+000073b0: 5320 616e 6420 7069 6d61 6765 206e 6f74  S and pimage not
+000073c0: 2069 6e20 766f 6c75 6d65 733a 0a20 2020   in volumes:.   
+000073d0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+000073e0: 6622 496d 6167 6520 7b70 696d 6167 657d  f"Image {pimage}
+000073f0: 206e 6f74 2066 6f75 6e64 2e20 446f 776e   not found. Down
+00007400: 6c6f 6164 696e 6722 290a 2020 2020 2020  loading").      
+00007410: 2020 2020 2020 7069 6d61 6765 5f64 6174        pimage_dat
+00007420: 6120 3d20 7b27 706f 6f6c 273a 2073 656c  a = {'pool': sel
+00007430: 662e 706f 6f6c 2c20 2769 6d61 6765 273a  f.pool, 'image':
+00007440: 2070 696d 6167 652c 2027 646f 776e 6c6f   pimage, 'downlo
+00007450: 6164 273a 2054 7275 657d 0a20 2020 2020  ad': True}.     
+00007460: 2020 2020 2020 2069 6620 7072 6f66 696c         if profil
+00007470: 656e 616d 652e 7374 6172 7473 7769 7468  ename.startswith
+00007480: 2827 7268 636f 732d 3427 2920 616e 6420  ('rhcos-4') and 
+00007490: 7072 6f66 696c 656e 616d 652e 656e 6473  profilename.ends
+000074a0: 7769 7468 2827 7163 6f77 3227 293a 0a20  with('qcow2'):. 
+000074b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000074c0: 696d 6167 655f 6461 7461 5b27 696d 6167  image_data['imag
+000074d0: 6527 5d20 3d20 7072 6f66 696c 656e 616d  e'] = profilenam
+000074e0: 652e 7370 6c69 7428 272e 2729 5b30 5d2e  e.split('.')[0].
+000074f0: 7265 706c 6163 6528 2772 6863 6f73 2d34  replace('rhcos-4
+00007500: 272c 2027 7268 636f 7334 2729 0a20 2020  ', 'rhcos4').   
+00007510: 2020 2020 2020 2020 2020 2020 2070 696d               pim
+00007520: 6167 655f 6461 7461 5b27 7572 6c27 5d20  age_data['url'] 
+00007530: 3d20 6765 745f 7268 636f 735f 7572 6c5f  = get_rhcos_url_
+00007540: 6672 6f6d 5f66 696c 6528 7072 6f66 696c  from_file(profil
+00007550: 656e 616d 652c 205f 7479 7065 3d73 656c  ename, _type=sel
+00007560: 662e 7479 7065 290a 2020 2020 2020 2020  f.type).        
+00007570: 2020 2020 7365 6c66 2e68 616e 646c 655f      self.handle_
+00007580: 686f 7374 282a 2a70 696d 6167 655f 6461  host(**pimage_da
+00007590: 7461 290a 2020 2020 2020 2020 6966 206e  ta).        if n
+000075a0: 6f74 2063 7573 746f 6d70 726f 6669 6c65  ot customprofile
+000075b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000075c0: 6f66 696c 652e 7570 6461 7465 286f 7665  ofile.update(ove
+000075d0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
+000075e0: 6966 2027 6261 7365 2720 696e 2070 726f  if 'base' in pro
+000075f0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+00007600: 2020 6661 7468 6572 203d 2076 6d70 726f    father = vmpro
+00007610: 6669 6c65 735b 7072 6f66 696c 655b 2762  files[profile['b
+00007620: 6173 6527 5d5d 0a20 2020 2020 2020 2020  ase']].         
+00007630: 2020 2064 6566 6175 6c74 5f6e 756d 6370     default_numcp
+00007640: 7573 203d 2066 6174 6865 722e 6765 7428  us = father.get(
+00007650: 276e 756d 6370 7573 272c 2073 656c 662e  'numcpus', self.
+00007660: 6e75 6d63 7075 7329 0a20 2020 2020 2020  numcpus).       
+00007670: 2020 2020 2064 6566 6175 6c74 5f6d 656d       default_mem
+00007680: 6f72 7920 3d20 6661 7468 6572 2e67 6574  ory = father.get
+00007690: 2827 6d65 6d6f 7279 272c 2073 656c 662e  ('memory', self.
+000076a0: 6d65 6d6f 7279 290a 2020 2020 2020 2020  memory).        
+000076b0: 2020 2020 6465 6661 756c 745f 706f 6f6c      default_pool
+000076c0: 203d 2066 6174 6865 722e 6765 7428 2770   = father.get('p
+000076d0: 6f6f 6c27 2c20 7365 6c66 2e70 6f6f 6c29  ool', self.pool)
+000076e0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000076f0: 6175 6c74 5f64 6973 6b73 203d 2066 6174  ault_disks = fat
+00007700: 6865 722e 6765 7428 2764 6973 6b73 272c  her.get('disks',
+00007710: 2073 656c 662e 6469 736b 7329 0a20 2020   self.disks).   
+00007720: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007730: 5f6e 6574 7320 3d20 6661 7468 6572 2e67  _nets = father.g
+00007740: 6574 2827 6e65 7473 272c 2073 656c 662e  et('nets', self.
+00007750: 6e65 7473 290a 2020 2020 2020 2020 2020  nets).          
+00007760: 2020 6465 6661 756c 745f 696d 6167 6520    default_image 
+00007770: 3d20 6661 7468 6572 2e67 6574 2827 696d  = father.get('im
+00007780: 6167 6527 2c20 7365 6c66 2e69 6d61 6765  age', self.image
+00007790: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+000077a0: 6661 756c 745f 636c 6f75 6469 6e69 7420  fault_cloudinit 
+000077b0: 3d20 6661 7468 6572 2e67 6574 2827 636c  = father.get('cl
+000077c0: 6f75 6469 6e69 7427 2c20 7365 6c66 2e63  oudinit', self.c
+000077d0: 6c6f 7564 696e 6974 290a 2020 2020 2020  loudinit).      
+000077e0: 2020 2020 2020 6465 6661 756c 745f 6e65        default_ne
+000077f0: 7374 6564 203d 2066 6174 6865 722e 6765  sted = father.ge
+00007800: 7428 276e 6573 7465 6427 2c20 7365 6c66  t('nested', self
+00007810: 2e6e 6573 7465 6429 0a20 2020 2020 2020  .nested).       
+00007820: 2020 2020 2064 6566 6175 6c74 5f72 6573       default_res
+00007830: 6572 7665 646e 7320 3d20 6661 7468 6572  ervedns = father
+00007840: 2e67 6574 2827 7265 7365 7276 6564 6e73  .get('reservedns
+00007850: 272c 2073 656c 662e 7265 7365 7276 6564  ', self.reserved
+00007860: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
+00007870: 6465 6661 756c 745f 7265 7365 7276 6568  default_reserveh
+00007880: 6f73 7420 3d20 6661 7468 6572 2e67 6574  ost = father.get
+00007890: 2827 7265 7365 7276 6568 6f73 7427 2c20  ('reservehost', 
+000078a0: 7365 6c66 2e72 6573 6572 7665 686f 7374  self.reservehost
+000078b0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+000078c0: 6661 756c 745f 6370 756d 6f64 656c 203d  fault_cpumodel =
+000078d0: 2066 6174 6865 722e 6765 7428 2763 7075   father.get('cpu
+000078e0: 6d6f 6465 6c27 2c20 7365 6c66 2e63 7075  model', self.cpu
+000078f0: 6d6f 6465 6c29 0a20 2020 2020 2020 2020  model).         
+00007900: 2020 2064 6566 6175 6c74 5f63 7075 666c     default_cpufl
+00007910: 6167 7320 3d20 6661 7468 6572 2e67 6574  ags = father.get
+00007920: 2827 6370 7566 6c61 6773 272c 2073 656c  ('cpuflags', sel
+00007930: 662e 6370 7566 6c61 6773 290a 2020 2020  f.cpuflags).    
+00007940: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00007950: 6370 7570 696e 6e69 6e67 203d 2066 6174  cpupinning = fat
+00007960: 6865 722e 6765 7428 2763 7075 7069 6e6e  her.get('cpupinn
+00007970: 696e 6727 2c20 7365 6c66 2e63 7075 7069  ing', self.cpupi
+00007980: 6e6e 696e 6729 0a20 2020 2020 2020 2020  nning).         
+00007990: 2020 2064 6566 6175 6c74 5f64 6973 6b73     default_disks
+000079a0: 697a 6520 3d20 6661 7468 6572 2e67 6574  ize = father.get
+000079b0: 2827 6469 736b 7369 7a65 272c 2073 656c  ('disksize', sel
+000079c0: 662e 6469 736b 7369 7a65 290a 2020 2020  f.disksize).    
+000079d0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000079e0: 6469 736b 696e 7465 7266 6163 6520 3d20  diskinterface = 
+000079f0: 6661 7468 6572 2e67 6574 2827 6469 736b  father.get('disk
+00007a00: 696e 7465 7266 6163 6527 2c20 7365 6c66  interface', self
+00007a10: 2e64 6973 6b69 6e74 6572 6661 6365 290a  .diskinterface).
+00007a20: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00007a30: 756c 745f 6469 736b 7468 696e 203d 2066  ult_diskthin = f
+00007a40: 6174 6865 722e 6765 7428 2764 6973 6b74  ather.get('diskt
+00007a50: 6869 6e27 2c20 7365 6c66 2e64 6973 6b74  hin', self.diskt
+00007a60: 6869 6e29 0a20 2020 2020 2020 2020 2020  hin).           
+00007a70: 2064 6566 6175 6c74 5f67 7565 7374 6964   default_guestid
+00007a80: 203d 2066 6174 6865 722e 6765 7428 2767   = father.get('g
+00007a90: 7565 7374 6964 272c 2073 656c 662e 6775  uestid', self.gu
+00007aa0: 6573 7469 6429 0a20 2020 2020 2020 2020  estid).         
+00007ab0: 2020 2064 6566 6175 6c74 5f69 736f 203d     default_iso =
+00007ac0: 2066 6174 6865 722e 6765 7428 2769 736f   father.get('iso
+00007ad0: 272c 2073 656c 662e 6973 6f29 0a20 2020  ', self.iso).   
+00007ae0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007af0: 5f76 6e63 203d 2066 6174 6865 722e 6765  _vnc = father.ge
+00007b00: 7428 2776 6e63 272c 2073 656c 662e 766e  t('vnc', self.vn
+00007b10: 6329 0a20 2020 2020 2020 2020 2020 2064  c).            d
+00007b20: 6566 6175 6c74 5f72 6573 6572 7665 6970  efault_reserveip
+00007b30: 203d 2066 6174 6865 722e 6765 7428 2772   = father.get('r
+00007b40: 6573 6572 7665 6970 272c 2073 656c 662e  eserveip', self.
+00007b50: 7265 7365 7276 6569 7029 0a20 2020 2020  reserveip).     
+00007b60: 2020 2020 2020 2064 6566 6175 6c74 5f73         default_s
+00007b70: 7461 7274 203d 2066 6174 6865 722e 6765  tart = father.ge
+00007b80: 7428 2773 7461 7274 272c 2073 656c 662e  t('start', self.
+00007b90: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
+00007ba0: 2020 2064 6566 6175 6c74 5f61 7574 6f73     default_autos
+00007bb0: 7461 7274 203d 2066 6174 6865 722e 6765  tart = father.ge
+00007bc0: 7428 2761 7574 6f73 7461 7274 272c 2073  t('autostart', s
+00007bd0: 656c 662e 6175 746f 7374 6172 7429 0a20  elf.autostart). 
+00007be0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00007bf0: 6c74 5f6b 6579 7320 3d20 6661 7468 6572  lt_keys = father
+00007c00: 2e67 6574 2827 6b65 7973 272c 2073 656c  .get('keys', sel
+00007c10: 662e 6b65 7973 290a 2020 2020 2020 2020  f.keys).        
+00007c20: 2020 2020 6465 6661 756c 745f 6e65 746d      default_netm
+00007c30: 6173 6b73 203d 2066 6174 6865 722e 6765  asks = father.ge
+00007c40: 7428 276e 6574 6d61 736b 7327 2c20 7365  t('netmasks', se
+00007c50: 6c66 2e6e 6574 6d61 736b 7329 0a20 2020  lf.netmasks).   
+00007c60: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007c70: 5f67 6174 6577 6179 203d 2066 6174 6865  _gateway = fathe
+00007c80: 722e 6765 7428 2767 6174 6577 6179 272c  r.get('gateway',
+00007c90: 2073 656c 662e 6761 7465 7761 7929 0a20   self.gateway). 
+00007ca0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00007cb0: 6c74 5f64 6e73 203d 2066 6174 6865 722e  lt_dns = father.
+00007cc0: 6765 7428 2764 6e73 272c 2073 656c 662e  get('dns', self.
+00007cd0: 646e 7329 0a20 2020 2020 2020 2020 2020  dns).           
+00007ce0: 2064 6566 6175 6c74 5f64 6f6d 6169 6e20   default_domain 
+00007cf0: 3d20 6661 7468 6572 2e67 6574 2827 646f  = father.get('do
+00007d00: 6d61 696e 272c 2073 656c 662e 646f 6d61  main', self.doma
+00007d10: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+00007d20: 6465 6661 756c 745f 6669 6c65 7320 3d20  default_files = 
+00007d30: 6661 7468 6572 2e67 6574 2827 6669 6c65  father.get('file
+00007d40: 7327 2c20 7365 6c66 2e66 696c 6573 290a  s', self.files).
+00007d50: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00007d60: 756c 745f 656e 6162 6c65 726f 6f74 203d  ult_enableroot =
+00007d70: 2066 6174 6865 722e 6765 7428 2765 6e61   father.get('ena
+00007d80: 626c 6572 6f6f 7427 2c20 7365 6c66 2e65  bleroot', self.e
+00007d90: 6e61 626c 6572 6f6f 7429 0a20 2020 2020  nableroot).     
+00007da0: 2020 2020 2020 2064 6566 6175 6c74 5f70         default_p
+00007db0: 7269 7661 7465 6b65 7920 3d20 6661 7468  rivatekey = fath
+00007dc0: 6572 2e67 6574 2827 7072 6976 6174 656b  er.get('privatek
+00007dd0: 6579 272c 2073 656c 662e 7072 6976 6174  ey', self.privat
+00007de0: 656b 6579 290a 2020 2020 2020 2020 2020  ekey).          
+00007df0: 2020 6465 6661 756c 745f 6e65 7477 6f72    default_networ
+00007e00: 6b77 6169 7420 3d20 6661 7468 6572 2e67  kwait = father.g
+00007e10: 6574 2827 6e65 7477 6f72 6b77 6169 7427  et('networkwait'
+00007e20: 2c20 7365 6c66 2e6e 6574 776f 726b 7761  , self.networkwa
+00007e30: 6974 290a 2020 2020 2020 2020 2020 2020  it).            
+00007e40: 6465 6661 756c 745f 7268 6e72 6567 6973  default_rhnregis
+00007e50: 7465 7220 3d20 6661 7468 6572 2e67 6574  ter = father.get
+00007e60: 2827 7268 6e72 6567 6973 7465 7227 2c20  ('rhnregister', 
+00007e70: 7365 6c66 2e72 686e 7265 6769 7374 6572  self.rhnregister
+00007e80: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00007e90: 6661 756c 745f 7268 6e73 6572 7665 7220  fault_rhnserver 
+00007ea0: 3d20 6661 7468 6572 2e67 6574 2827 7268  = father.get('rh
+00007eb0: 6e73 6572 7665 7227 2c20 7365 6c66 2e72  nserver', self.r
+00007ec0: 686e 7365 7276 6572 290a 2020 2020 2020  hnserver).      
+00007ed0: 2020 2020 2020 6465 6661 756c 745f 7268        default_rh
+00007ee0: 6e75 7365 7220 3d20 6661 7468 6572 2e67  nuser = father.g
+00007ef0: 6574 2827 7268 6e75 7365 7227 2c20 7365  et('rhnuser', se
+00007f00: 6c66 2e72 686e 7573 6572 290a 2020 2020  lf.rhnuser).    
+00007f10: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00007f20: 7268 6e70 6173 7377 6f72 6420 3d20 6661  rhnpassword = fa
+00007f30: 7468 6572 2e67 6574 2827 7268 6e70 6173  ther.get('rhnpas
+00007f40: 7377 6f72 6427 2c20 7365 6c66 2e72 686e  sword', self.rhn
+00007f50: 7061 7373 776f 7264 290a 2020 2020 2020  password).      
+00007f60: 2020 2020 2020 6465 6661 756c 745f 7268        default_rh
+00007f70: 6e61 6b20 3d20 6661 7468 6572 2e67 6574  nak = father.get
+00007f80: 2827 7268 6e61 6374 6976 6174 696f 6e6b  ('rhnactivationk
+00007f90: 6579 272c 2073 656c 662e 7268 6e61 6b29  ey', self.rhnak)
+00007fa0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00007fb0: 6175 6c74 5f72 686e 6f72 6720 3d20 6661  ault_rhnorg = fa
+00007fc0: 7468 6572 2e67 6574 2827 7268 6e6f 7267  ther.get('rhnorg
+00007fd0: 272c 2073 656c 662e 7268 6e6f 7267 290a  ', self.rhnorg).
+00007fe0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00007ff0: 756c 745f 7268 6e70 6f6f 6c20 3d20 6661  ult_rhnpool = fa
+00008000: 7468 6572 2e67 6574 2827 7268 6e70 6f6f  ther.get('rhnpoo
+00008010: 6c27 2c20 7365 6c66 2e72 686e 706f 6f6c  l', self.rhnpool
+00008020: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008030: 6661 756c 745f 7461 6773 203d 2066 6174  fault_tags = fat
+00008040: 6865 722e 6765 7428 2774 6167 7327 2c20  her.get('tags', 
+00008050: 7365 6c66 2e74 6167 7329 0a20 2020 2020  self.tags).     
+00008060: 2020 2020 2020 2064 6566 6175 6c74 5f66         default_f
+00008070: 6c61 766f 7220 3d20 6661 7468 6572 2e67  lavor = father.g
+00008080: 6574 2827 666c 6176 6f72 272c 2073 656c  et('flavor', sel
+00008090: 662e 666c 6176 6f72 290a 2020 2020 2020  f.flavor).      
+000080a0: 2020 2020 2020 6465 6661 756c 745f 636d        default_cm
+000080b0: 6473 203d 2063 6f6d 6d6f 6e2e 7265 6d6f  ds = common.remo
+000080c0: 7665 5f64 7570 6c69 6361 7465 7328 7365  ve_duplicates(se
+000080d0: 6c66 2e63 6d64 7320 2b20 6661 7468 6572  lf.cmds + father
+000080e0: 2e67 6574 2827 636d 6473 272c 205b 5d29  .get('cmds', [])
+000080f0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008100: 6661 756c 745f 7363 7269 7074 7320 3d20  fault_scripts = 
+00008110: 636f 6d6d 6f6e 2e72 656d 6f76 655f 6475  common.remove_du
+00008120: 706c 6963 6174 6573 2873 656c 662e 7363  plicates(self.sc
+00008130: 7269 7074 7320 2b20 6661 7468 6572 2e67  ripts + father.g
+00008140: 6574 2827 7363 7269 7074 7327 2c20 5b5d  et('scripts', []
+00008150: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
+00008160: 6566 6175 6c74 5f64 6e73 636c 6965 6e74  efault_dnsclient
+00008170: 203d 2066 6174 6865 722e 6765 7428 2764   = father.get('d
+00008180: 6e73 636c 6965 6e74 272c 2073 656c 662e  nsclient', self.
+00008190: 646e 7363 6c69 656e 7429 0a20 2020 2020  dnsclient).     
+000081a0: 2020 2020 2020 2064 6566 6175 6c74 5f73         default_s
+000081b0: 746f 7265 6d65 7461 6461 7461 203d 2066  toremetadata = f
+000081c0: 6174 6865 722e 6765 7428 2773 746f 7265  ather.get('store
+000081d0: 6d65 7461 6461 7461 272c 2073 656c 662e  metadata', self.
+000081e0: 7374 6f72 656d 6574 6164 6174 6129 0a20  storemetadata). 
+000081f0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008200: 6c74 5f6e 6f74 6966 7920 3d20 6661 7468  lt_notify = fath
+00008210: 6572 2e67 6574 2827 6e6f 7469 6679 272c  er.get('notify',
+00008220: 2073 656c 662e 6e6f 7469 6679 290a 2020   self.notify).  
+00008230: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008240: 745f 7075 7368 6275 6c6c 6574 746f 6b65  t_pushbullettoke
+00008250: 6e20 3d20 6661 7468 6572 2e67 6574 2827  n = father.get('
+00008260: 7075 7368 6275 6c6c 6574 746f 6b65 6e27  pushbullettoken'
+00008270: 2c20 7365 6c66 2e70 7573 6862 756c 6c65  , self.pushbulle
+00008280: 7474 6f6b 656e 290a 2020 2020 2020 2020  ttoken).        
+00008290: 2020 2020 6465 6661 756c 745f 6d61 696c      default_mail
+000082a0: 7365 7276 6572 203d 2066 6174 6865 722e  server = father.
+000082b0: 6765 7428 276d 6169 6c73 6572 7665 7227  get('mailserver'
+000082c0: 2c20 7365 6c66 2e6d 6169 6c73 6572 7665  , self.mailserve
+000082d0: 7229 0a20 2020 2020 2020 2020 2020 2064  r).            d
+000082e0: 6566 6175 6c74 5f6d 6169 6c66 726f 6d20  efault_mailfrom 
+000082f0: 3d20 6661 7468 6572 2e67 6574 2827 6d61  = father.get('ma
+00008300: 696c 6672 6f6d 272c 2073 656c 662e 6d61  ilfrom', self.ma
+00008310: 696c 6672 6f6d 290a 2020 2020 2020 2020  ilfrom).        
+00008320: 2020 2020 6465 6661 756c 745f 6d61 696c      default_mail
+00008330: 746f 203d 2066 6174 6865 722e 6765 7428  to = father.get(
+00008340: 276d 6169 6c74 6f27 2c20 7365 6c66 2e6d  'mailto', self.m
+00008350: 6169 6c74 6f29 0a20 2020 2020 2020 2020  ailto).         
+00008360: 2020 2064 6566 6175 6c74 5f6e 6f74 6966     default_notif
+00008370: 7963 6d64 203d 2066 6174 6865 722e 6765  ycmd = father.ge
+00008380: 7428 276e 6f74 6966 7963 6d64 272c 2073  t('notifycmd', s
+00008390: 656c 662e 6e6f 7469 6679 636d 6429 0a20  elf.notifycmd). 
+000083a0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000083b0: 6c74 5f6e 6f74 6966 7973 6372 6970 7420  lt_notifyscript 
+000083c0: 3d20 6661 7468 6572 2e67 6574 2827 6e6f  = father.get('no
+000083d0: 7469 6679 7363 7269 7074 272c 2073 656c  tifyscript', sel
+000083e0: 662e 6e6f 7469 6679 7363 7269 7074 290a  f.notifyscript).
+000083f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008400: 756c 745f 6e6f 7469 6679 6d65 7468 6f64  ult_notifymethod
+00008410: 7320 3d20 6661 7468 6572 2e67 6574 2827  s = father.get('
+00008420: 6e6f 7469 6679 6d65 7468 6f64 7327 2c20  notifymethods', 
+00008430: 7365 6c66 2e6e 6f74 6966 796d 6574 686f  self.notifymetho
+00008440: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
+00008450: 6465 6661 756c 745f 736c 6163 6b63 6861  default_slackcha
+00008460: 6e6e 656c 203d 2066 6174 6865 722e 6765  nnel = father.ge
+00008470: 7428 2773 6c61 636b 6368 616e 6e65 6c27  t('slackchannel'
+00008480: 2c20 7365 6c66 2e73 6c61 636b 6368 616e  , self.slackchan
+00008490: 6e65 6c29 0a20 2020 2020 2020 2020 2020  nel).           
+000084a0: 2064 6566 6175 6c74 5f70 7573 6862 756c   default_pushbul
+000084b0: 6c65 7474 6f6b 656e 203d 2066 6174 6865  lettoken = fathe
+000084c0: 722e 6765 7428 2770 7573 6862 756c 6c65  r.get('pushbulle
+000084d0: 7474 6f6b 656e 272c 2073 656c 662e 7075  ttoken', self.pu
+000084e0: 7368 6275 6c6c 6574 746f 6b65 6e29 0a20  shbullettoken). 
+000084f0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008500: 6c74 5f73 6c61 636b 746f 6b65 6e20 3d20  lt_slacktoken = 
+00008510: 6661 7468 6572 2e67 6574 2827 736c 6163  father.get('slac
+00008520: 6b74 6f6b 656e 272c 2073 656c 662e 736c  ktoken', self.sl
+00008530: 6163 6b74 6f6b 656e 290a 2020 2020 2020  acktoken).      
+00008540: 2020 2020 2020 6465 6661 756c 745f 7368        default_sh
+00008550: 6172 6564 666f 6c64 6572 7320 3d20 6661  aredfolders = fa
+00008560: 7468 6572 2e67 6574 2827 7368 6172 6564  ther.get('shared
+00008570: 666f 6c64 6572 7327 2c20 7365 6c66 2e73  folders', self.s
+00008580: 6861 7265 6466 6f6c 6465 7273 290a 2020  haredfolders).  
+00008590: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000085a0: 745f 6b65 726e 656c 203d 2066 6174 6865  t_kernel = fathe
+000085b0: 722e 6765 7428 276b 6572 6e65 6c27 2c20  r.get('kernel', 
+000085c0: 7365 6c66 2e6b 6572 6e65 6c29 0a20 2020  self.kernel).   
+000085d0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000085e0: 5f69 6e69 7472 6420 3d20 6661 7468 6572  _initrd = father
+000085f0: 2e67 6574 2827 696e 6974 7264 272c 2073  .get('initrd', s
+00008600: 656c 662e 696e 6974 7264 290a 2020 2020  elf.initrd).    
+00008610: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008620: 636d 646c 696e 6520 3d20 6661 7468 6572  cmdline = father
+00008630: 2e67 6574 2827 636d 646c 696e 6527 2c20  .get('cmdline', 
+00008640: 7365 6c66 2e63 6d64 6c69 6e65 290a 2020  self.cmdline).  
+00008650: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008660: 745f 706c 6163 656d 656e 7420 3d20 6661  t_placement = fa
+00008670: 7468 6572 2e67 6574 2827 706c 6163 656d  ther.get('placem
+00008680: 656e 7427 2c20 7365 6c66 2e70 6c61 6365  ent', self.place
+00008690: 6d65 6e74 290a 2020 2020 2020 2020 2020  ment).          
+000086a0: 2020 6465 6661 756c 745f 7961 6d6c 696e    default_yamlin
+000086b0: 7665 6e74 6f72 7920 3d20 6661 7468 6572  ventory = father
+000086c0: 2e67 6574 2827 7961 6d6c 696e 7665 6e74  .get('yamlinvent
+000086d0: 6f72 7927 2c20 7365 6c66 2e79 616d 6c69  ory', self.yamli
+000086e0: 6e76 656e 746f 7279 290a 2020 2020 2020  nventory).      
+000086f0: 2020 2020 2020 6465 6661 756c 745f 6370        default_cp
+00008700: 7568 6f74 706c 7567 203d 2066 6174 6865  uhotplug = fathe
+00008710: 722e 6765 7428 2763 7075 686f 7470 6c75  r.get('cpuhotplu
+00008720: 6727 2c20 7365 6c66 2e63 7075 686f 7470  g', self.cpuhotp
+00008730: 6c75 6729 0a20 2020 2020 2020 2020 2020  lug).           
+00008740: 2064 6566 6175 6c74 5f6d 656d 6f72 7968   default_memoryh
+00008750: 6f74 706c 7567 203d 2066 6174 6865 722e  otplug = father.
+00008760: 6765 7428 276d 656d 6f72 7968 6f74 706c  get('memoryhotpl
+00008770: 7567 272c 2073 656c 662e 6d65 6d6f 7279  ug', self.memory
+00008780: 686f 7470 6c75 6729 0a20 2020 2020 2020  hotplug).       
+00008790: 2020 2020 2064 6566 6175 6c74 5f6e 756d       default_num
+000087a0: 6120 3d20 6661 7468 6572 2e67 6574 2827  a = father.get('
+000087b0: 6e75 6d61 272c 2073 656c 662e 6e75 6d61  numa', self.numa
+000087c0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+000087d0: 6661 756c 745f 6e75 6d61 6d6f 6465 203d  fault_numamode =
+000087e0: 2066 6174 6865 722e 6765 7428 276e 756d   father.get('num
+000087f0: 616d 6f64 6527 2c20 7365 6c66 2e6e 756d  amode', self.num
+00008800: 616d 6f64 6529 0a20 2020 2020 2020 2020  amode).         
+00008810: 2020 2064 6566 6175 6c74 5f70 6369 6465     default_pcide
+00008820: 7669 6365 7320 3d20 6661 7468 6572 2e67  vices = father.g
+00008830: 6574 2827 7063 6964 6576 6963 6573 272c  et('pcidevices',
+00008840: 2073 656c 662e 7063 6964 6576 6963 6573   self.pcidevices
+00008850: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008860: 6661 756c 745f 7470 6d20 3d20 6661 7468  fault_tpm = fath
+00008870: 6572 2e67 6574 2827 7470 6d27 2c20 7365  er.get('tpm', se
+00008880: 6c66 2e74 706d 290a 2020 2020 2020 2020  lf.tpm).        
+00008890: 2020 2020 6465 6661 756c 745f 726e 6720      default_rng 
+000088a0: 3d20 6661 7468 6572 2e67 6574 2827 726e  = father.get('rn
+000088b0: 6727 2c20 7365 6c66 2e72 6e67 290a 2020  g', self.rng).  
+000088c0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000088d0: 745f 7a65 726f 7469 6572 5f6e 6574 7320  t_zerotier_nets 
+000088e0: 3d20 6661 7468 6572 2e67 6574 2827 7a65  = father.get('ze
+000088f0: 726f 7469 6572 5f6e 6574 7327 2c20 7365  rotier_nets', se
+00008900: 6c66 2e7a 6572 6f74 6965 725f 6e65 7473  lf.zerotier_nets
+00008910: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008920: 6661 756c 745f 7a65 726f 7469 6572 5f6b  fault_zerotier_k
+00008930: 7562 656c 6574 203d 2066 6174 6865 722e  ubelet = father.
+00008940: 6765 7428 277a 6572 6f74 6965 725f 6b75  get('zerotier_ku
+00008950: 6265 6c65 7427 2c20 7365 6c66 2e7a 6572  belet', self.zer
+00008960: 6f74 6965 725f 6b75 6265 6c65 7429 0a20  otier_kubelet). 
+00008970: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008980: 6c74 5f76 6972 7474 7970 6520 3d20 6661  lt_virttype = fa
+00008990: 7468 6572 2e67 6574 2827 7669 7274 7479  ther.get('virtty
+000089a0: 7065 272c 2073 656c 662e 7669 7274 7479  pe', self.virtty
+000089b0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+000089c0: 6465 6661 756c 745f 7365 6375 7269 7479  default_security
+000089d0: 6772 6f75 7073 203d 2066 6174 6865 722e  groups = father.
+000089e0: 6765 7428 2773 6563 7572 6974 7967 726f  get('securitygro
+000089f0: 7570 7327 2c20 7365 6c66 2e73 6563 7572  ups', self.secur
+00008a00: 6974 7967 726f 7570 7329 0a20 2020 2020  itygroups).     
+00008a10: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
+00008a20: 6f6f 7470 6173 7377 6f72 6420 3d20 6661  ootpassword = fa
+00008a30: 7468 6572 2e67 6574 2827 726f 6f74 7061  ther.get('rootpa
+00008a40: 7373 776f 7264 272c 2073 656c 662e 726f  ssword', self.ro
+00008a50: 6f74 7061 7373 776f 7264 290a 2020 2020  otpassword).    
+00008a60: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008a70: 7465 6d70 6b65 7920 3d20 6661 7468 6572  tempkey = father
+00008a80: 2e67 6574 2827 7465 6d70 6b65 7927 2c20  .get('tempkey', 
+00008a90: 7365 6c66 2e74 656d 706b 6579 290a 2020  self.tempkey).  
+00008aa0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008ab0: 745f 766d 7573 6572 203d 2066 6174 6865  t_vmuser = fathe
+00008ac0: 722e 6765 7428 2776 6d75 7365 7227 2c20  r.get('vmuser', 
+00008ad0: 7365 6c66 2e76 6d75 7365 7229 0a20 2020  self.vmuser).   
+00008ae0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008af0: 5f77 6169 7420 3d20 6661 7468 6572 2e67  _wait = father.g
+00008b00: 6574 2827 7761 6974 272c 2073 656c 662e  et('wait', self.
+00008b10: 7761 6974 290a 2020 2020 2020 2020 2020  wait).          
+00008b20: 2020 6465 6661 756c 745f 7761 6974 636f    default_waitco
+00008b30: 6d6d 616e 6420 3d20 6661 7468 6572 2e67  mmand = father.g
+00008b40: 6574 2827 7761 6974 636f 6d6d 616e 6427  et('waitcommand'
+00008b50: 2c20 7365 6c66 2e77 6169 7463 6f6d 6d61  , self.waitcomma
+00008b60: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
+00008b70: 6465 6661 756c 745f 7761 6974 7469 6d65  default_waittime
+00008b80: 6f75 7420 3d20 6661 7468 6572 2e67 6574  out = father.get
+00008b90: 2827 7761 6974 7469 6d65 6f75 7427 2c20  ('waittimeout', 
+00008ba0: 7365 6c66 2e77 6169 7474 696d 656f 7574  self.waittimeout
+00008bb0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00008bc0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008bd0: 756c 745f 6e75 6d63 7075 7320 3d20 7365  ult_numcpus = se
+00008be0: 6c66 2e6e 756d 6370 7573 0a20 2020 2020  lf.numcpus.     
+00008bf0: 2020 2020 2020 2064 6566 6175 6c74 5f6d         default_m
+00008c00: 656d 6f72 7920 3d20 7365 6c66 2e6d 656d  emory = self.mem
+00008c10: 6f72 790a 2020 2020 2020 2020 2020 2020  ory.            
+00008c20: 6465 6661 756c 745f 706f 6f6c 203d 2073  default_pool = s
+00008c30: 656c 662e 706f 6f6c 0a20 2020 2020 2020  elf.pool.       
+00008c40: 2020 2020 2064 6566 6175 6c74 5f64 6973       default_dis
+00008c50: 6b73 203d 2073 656c 662e 6469 736b 730a  ks = self.disks.
+00008c60: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008c70: 756c 745f 6e65 7473 203d 2073 656c 662e  ult_nets = self.
+00008c80: 6e65 7473 0a20 2020 2020 2020 2020 2020  nets.           
+00008c90: 2064 6566 6175 6c74 5f69 6d61 6765 203d   default_image =
+00008ca0: 2073 656c 662e 696d 6167 650a 2020 2020   self.image.    
+00008cb0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008cc0: 636c 6f75 6469 6e69 7420 3d20 7365 6c66  cloudinit = self
+00008cd0: 2e63 6c6f 7564 696e 6974 0a20 2020 2020  .cloudinit.     
+00008ce0: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
+00008cf0: 6573 7465 6420 3d20 7365 6c66 2e6e 6573  ested = self.nes
+00008d00: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
+00008d10: 6465 6661 756c 745f 7265 7365 7276 6564  default_reserved
+00008d20: 6e73 203d 2073 656c 662e 7265 7365 7276  ns = self.reserv
+00008d30: 6564 6e73 0a20 2020 2020 2020 2020 2020  edns.           
+00008d40: 2064 6566 6175 6c74 5f72 6573 6572 7665   default_reserve
+00008d50: 686f 7374 203d 2073 656c 662e 7265 7365  host = self.rese
+00008d60: 7276 6568 6f73 740a 2020 2020 2020 2020  rvehost.        
+00008d70: 2020 2020 6465 6661 756c 745f 6370 756d      default_cpum
+00008d80: 6f64 656c 203d 2073 656c 662e 6370 756d  odel = self.cpum
+00008d90: 6f64 656c 0a20 2020 2020 2020 2020 2020  odel.           
+00008da0: 2064 6566 6175 6c74 5f63 7075 666c 6167   default_cpuflag
+00008db0: 7320 3d20 7365 6c66 2e63 7075 666c 6167  s = self.cpuflag
+00008dc0: 730a 2020 2020 2020 2020 2020 2020 6465  s.            de
+00008dd0: 6661 756c 745f 6370 7570 696e 6e69 6e67  fault_cpupinning
+00008de0: 203d 2073 656c 662e 6370 7570 696e 6e69   = self.cpupinni
+00008df0: 6e67 0a20 2020 2020 2020 2020 2020 2064  ng.            d
+00008e00: 6566 6175 6c74 5f6e 756d 616d 6f64 6520  efault_numamode 
+00008e10: 3d20 7365 6c66 2e6e 756d 616d 6f64 650a  = self.numamode.
+00008e20: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008e30: 756c 745f 6e75 6d61 203d 2073 656c 662e  ult_numa = self.
+00008e40: 6e75 6d61 0a20 2020 2020 2020 2020 2020  numa.           
+00008e50: 2064 6566 6175 6c74 5f70 6369 6465 7669   default_pcidevi
+00008e60: 6365 7320 3d20 7365 6c66 2e70 6369 6465  ces = self.pcide
+00008e70: 7669 6365 730a 2020 2020 2020 2020 2020  vices.          
+00008e80: 2020 6465 6661 756c 745f 7470 6d20 3d20    default_tpm = 
+00008e90: 7365 6c66 2e74 706d 0a20 2020 2020 2020  self.tpm.       
+00008ea0: 2020 2020 2064 6566 6175 6c74 5f72 6e67       default_rng
+00008eb0: 203d 2073 656c 662e 726e 670a 2020 2020   = self.rng.    
+00008ec0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008ed0: 7a65 726f 7469 6572 5f6e 6574 7320 3d20  zerotier_nets = 
+00008ee0: 7365 6c66 2e7a 6572 6f74 6965 725f 6e65  self.zerotier_ne
+00008ef0: 7473 0a20 2020 2020 2020 2020 2020 2064  ts.            d
+00008f00: 6566 6175 6c74 5f7a 6572 6f74 6965 725f  efault_zerotier_
+00008f10: 6b75 6265 6c65 7420 3d20 7365 6c66 2e7a  kubelet = self.z
+00008f20: 6572 6f74 6965 725f 6b75 6265 6c65 740a  erotier_kubelet.
+00008f30: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008f40: 756c 745f 6469 736b 7369 7a65 203d 2073  ult_disksize = s
+00008f50: 656c 662e 6469 736b 7369 7a65 0a20 2020  elf.disksize.   
+00008f60: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008f70: 5f64 6973 6b69 6e74 6572 6661 6365 203d  _diskinterface =
+00008f80: 2073 656c 662e 6469 736b 696e 7465 7266   self.diskinterf
+00008f90: 6163 650a 2020 2020 2020 2020 2020 2020  ace.            
+00008fa0: 6465 6661 756c 745f 6469 736b 7468 696e  default_diskthin
+00008fb0: 203d 2073 656c 662e 6469 736b 7468 696e   = self.diskthin
+00008fc0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00008fd0: 6175 6c74 5f67 7565 7374 6964 203d 2073  ault_guestid = s
+00008fe0: 656c 662e 6775 6573 7469 640a 2020 2020  elf.guestid.    
+00008ff0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009000: 6973 6f20 3d20 7365 6c66 2e69 736f 0a20  iso = self.iso. 
+00009010: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009020: 6c74 5f76 6e63 203d 2073 656c 662e 766e  lt_vnc = self.vn
+00009030: 630a 2020 2020 2020 2020 2020 2020 6465  c.            de
+00009040: 6661 756c 745f 7265 7365 7276 6569 7020  fault_reserveip 
+00009050: 3d20 7365 6c66 2e72 6573 6572 7665 6970  = self.reserveip
+00009060: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009070: 6175 6c74 5f73 7461 7274 203d 2073 656c  ault_start = sel
+00009080: 662e 7374 6172 740a 2020 2020 2020 2020  f.start.        
+00009090: 2020 2020 6465 6661 756c 745f 6175 746f      default_auto
+000090a0: 7374 6172 7420 3d20 7365 6c66 2e61 7574  start = self.aut
+000090b0: 6f73 7461 7274 0a20 2020 2020 2020 2020  ostart.         
+000090c0: 2020 2064 6566 6175 6c74 5f6b 6579 7320     default_keys 
+000090d0: 3d20 7365 6c66 2e6b 6579 730a 2020 2020  = self.keys.    
+000090e0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000090f0: 6e65 746d 6173 6b73 203d 2073 656c 662e  netmasks = self.
+00009100: 6e65 746d 6173 6b73 0a20 2020 2020 2020  netmasks.       
+00009110: 2020 2020 2064 6566 6175 6c74 5f67 6174       default_gat
+00009120: 6577 6179 203d 2073 656c 662e 6761 7465  eway = self.gate
+00009130: 7761 790a 2020 2020 2020 2020 2020 2020  way.            
+00009140: 6465 6661 756c 745f 646e 7320 3d20 7365  default_dns = se
+00009150: 6c66 2e64 6e73 0a20 2020 2020 2020 2020  lf.dns.         
+00009160: 2020 2064 6566 6175 6c74 5f64 6f6d 6169     default_domai
+00009170: 6e20 3d20 7365 6c66 2e64 6f6d 6169 6e0a  n = self.domain.
+00009180: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009190: 756c 745f 6669 6c65 7320 3d20 7365 6c66  ult_files = self
+000091a0: 2e66 696c 6573 0a20 2020 2020 2020 2020  .files.         
+000091b0: 2020 2064 6566 6175 6c74 5f65 6e61 626c     default_enabl
+000091c0: 6572 6f6f 7420 3d20 7365 6c66 2e65 6e61  eroot = self.ena
+000091d0: 626c 6572 6f6f 740a 2020 2020 2020 2020  bleroot.        
+000091e0: 2020 2020 6465 6661 756c 745f 7461 6773      default_tags
+000091f0: 203d 2073 656c 662e 7461 6773 0a20 2020   = self.tags.   
+00009200: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009210: 5f66 6c61 766f 7220 3d20 7365 6c66 2e66  _flavor = self.f
+00009220: 6c61 766f 720a 2020 2020 2020 2020 2020  lavor.          
+00009230: 2020 6465 6661 756c 745f 7072 6976 6174    default_privat
+00009240: 656b 6579 203d 2073 656c 662e 7072 6976  ekey = self.priv
+00009250: 6174 656b 6579 0a20 2020 2020 2020 2020  atekey.         
+00009260: 2020 2064 6566 6175 6c74 5f6e 6574 776f     default_netwo
+00009270: 726b 7761 6974 203d 2073 656c 662e 6e65  rkwait = self.ne
+00009280: 7477 6f72 6b77 6169 740a 2020 2020 2020  tworkwait.      
+00009290: 2020 2020 2020 6465 6661 756c 745f 7268        default_rh
+000092a0: 6e72 6567 6973 7465 7220 3d20 7365 6c66  nregister = self
+000092b0: 2e72 686e 7265 6769 7374 6572 0a20 2020  .rhnregister.   
+000092c0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000092d0: 5f72 686e 7365 7276 6572 203d 2073 656c  _rhnserver = sel
+000092e0: 662e 7268 6e73 6572 7665 720a 2020 2020  f.rhnserver.    
+000092f0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009300: 7268 6e75 7365 7220 3d20 7365 6c66 2e72  rhnuser = self.r
+00009310: 686e 7573 6572 0a20 2020 2020 2020 2020  hnuser.         
+00009320: 2020 2064 6566 6175 6c74 5f72 686e 7061     default_rhnpa
+00009330: 7373 776f 7264 203d 2073 656c 662e 7268  ssword = self.rh
+00009340: 6e70 6173 7377 6f72 640a 2020 2020 2020  npassword.      
+00009350: 2020 2020 2020 6465 6661 756c 745f 7268        default_rh
+00009360: 6e61 6b20 3d20 7365 6c66 2e72 686e 616b  nak = self.rhnak
+00009370: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009380: 6175 6c74 5f72 686e 6f72 6720 3d20 7365  ault_rhnorg = se
+00009390: 6c66 2e72 686e 6f72 670a 2020 2020 2020  lf.rhnorg.      
+000093a0: 2020 2020 2020 6465 6661 756c 745f 7268        default_rh
+000093b0: 6e70 6f6f 6c20 3d20 7365 6c66 2e72 686e  npool = self.rhn
+000093c0: 706f 6f6c 0a20 2020 2020 2020 2020 2020  pool.           
+000093d0: 2064 6566 6175 6c74 5f63 6d64 7320 3d20   default_cmds = 
+000093e0: 7365 6c66 2e63 6d64 730a 2020 2020 2020  self.cmds.      
+000093f0: 2020 2020 2020 6465 6661 756c 745f 7363        default_sc
+00009400: 7269 7074 7320 3d20 7365 6c66 2e73 6372  ripts = self.scr
+00009410: 6970 7473 0a20 2020 2020 2020 2020 2020  ipts.           
+00009420: 2064 6566 6175 6c74 5f64 6e73 636c 6965   default_dnsclie
+00009430: 6e74 203d 2073 656c 662e 646e 7363 6c69  nt = self.dnscli
+00009440: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00009450: 6465 6661 756c 745f 7374 6f72 656d 6574  default_storemet
+00009460: 6164 6174 6120 3d20 7365 6c66 2e73 746f  adata = self.sto
+00009470: 7265 6d65 7461 6461 7461 0a20 2020 2020  remetadata.     
+00009480: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
+00009490: 6f74 6966 7920 3d20 7365 6c66 2e6e 6f74  otify = self.not
+000094a0: 6966 790a 2020 2020 2020 2020 2020 2020  ify.            
+000094b0: 6465 6661 756c 745f 7075 7368 6275 6c6c  default_pushbull
+000094c0: 6574 746f 6b65 6e20 3d20 7365 6c66 2e70  ettoken = self.p
+000094d0: 7573 6862 756c 6c65 7474 6f6b 656e 0a20  ushbullettoken. 
+000094e0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000094f0: 6c74 5f73 6c61 636b 746f 6b65 6e20 3d20  lt_slacktoken = 
+00009500: 7365 6c66 2e73 6c61 636b 746f 6b65 6e0a  self.slacktoken.
+00009510: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009520: 756c 745f 6d61 696c 7365 7276 6572 203d  ult_mailserver =
+00009530: 2073 656c 662e 6d61 696c 7365 7276 6572   self.mailserver
+00009540: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009550: 6175 6c74 5f6d 6169 6c66 726f 6d20 3d20  ault_mailfrom = 
+00009560: 7365 6c66 2e6d 6169 6c66 726f 6d0a 2020  self.mailfrom.  
+00009570: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009580: 745f 6d61 696c 746f 203d 2073 656c 662e  t_mailto = self.
+00009590: 6d61 696c 746f 0a20 2020 2020 2020 2020  mailto.         
+000095a0: 2020 2064 6566 6175 6c74 5f6e 6f74 6966     default_notif
+000095b0: 7963 6d64 203d 2073 656c 662e 6e6f 7469  ycmd = self.noti
+000095c0: 6679 636d 640a 2020 2020 2020 2020 2020  fycmd.          
+000095d0: 2020 6465 6661 756c 745f 6e6f 7469 6679    default_notify
+000095e0: 7363 7269 7074 203d 2073 656c 662e 6e6f  script = self.no
+000095f0: 7469 6679 7363 7269 7074 0a20 2020 2020  tifyscript.     
+00009600: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
+00009610: 6f74 6966 796d 6574 686f 6473 203d 2073  otifymethods = s
+00009620: 656c 662e 6e6f 7469 6679 6d65 7468 6f64  elf.notifymethod
+00009630: 730a 2020 2020 2020 2020 2020 2020 6465  s.            de
+00009640: 6661 756c 745f 736c 6163 6b63 6861 6e6e  fault_slackchann
+00009650: 656c 203d 2073 656c 662e 736c 6163 6b63  el = self.slackc
+00009660: 6861 6e6e 656c 0a20 2020 2020 2020 2020  hannel.         
+00009670: 2020 2064 6566 6175 6c74 5f73 6861 7265     default_share
+00009680: 6466 6f6c 6465 7273 203d 2073 656c 662e  dfolders = self.
+00009690: 7368 6172 6564 666f 6c64 6572 730a 2020  sharedfolders.  
+000096a0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000096b0: 745f 6b65 726e 656c 203d 2073 656c 662e  t_kernel = self.
+000096c0: 6b65 726e 656c 0a20 2020 2020 2020 2020  kernel.         
+000096d0: 2020 2064 6566 6175 6c74 5f69 6e69 7472     default_initr
+000096e0: 6420 3d20 7365 6c66 2e69 6e69 7472 640a  d = self.initrd.
+000096f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009700: 756c 745f 636d 646c 696e 6520 3d20 7365  ult_cmdline = se
+00009710: 6c66 2e63 6d64 6c69 6e65 0a20 2020 2020  lf.cmdline.     
+00009720: 2020 2020 2020 2064 6566 6175 6c74 5f70         default_p
+00009730: 6c61 6365 6d65 6e74 203d 2073 656c 662e  lacement = self.
+00009740: 706c 6163 656d 656e 740a 2020 2020 2020  placement.      
+00009750: 2020 2020 2020 6465 6661 756c 745f 7961        default_ya
+00009760: 6d6c 696e 7665 6e74 6f72 7920 3d20 7365  mlinventory = se
+00009770: 6c66 2e79 616d 6c69 6e76 656e 746f 7279  lf.yamlinventory
+00009780: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009790: 6175 6c74 5f63 7075 686f 7470 6c75 6720  ault_cpuhotplug 
+000097a0: 3d20 7365 6c66 2e63 7075 686f 7470 6c75  = self.cpuhotplu
+000097b0: 670a 2020 2020 2020 2020 2020 2020 6465  g.            de
+000097c0: 6661 756c 745f 6d65 6d6f 7279 686f 7470  fault_memoryhotp
+000097d0: 6c75 6720 3d20 7365 6c66 2e6d 656d 6f72  lug = self.memor
+000097e0: 7968 6f74 706c 7567 0a20 2020 2020 2020  yhotplug.       
+000097f0: 2020 2020 2064 6566 6175 6c74 5f76 6972       default_vir
+00009800: 7474 7970 6520 3d20 7365 6c66 2e76 6972  ttype = self.vir
+00009810: 7474 7970 650a 2020 2020 2020 2020 2020  ttype.          
+00009820: 2020 6465 6661 756c 745f 7365 6375 7269    default_securi
+00009830: 7479 6772 6f75 7073 203d 2073 656c 662e  tygroups = self.
+00009840: 7365 6375 7269 7479 6772 6f75 7073 0a20  securitygroups. 
+00009850: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009860: 6c74 5f72 6f6f 7470 6173 7377 6f72 6420  lt_rootpassword 
+00009870: 3d20 7365 6c66 2e72 6f6f 7470 6173 7377  = self.rootpassw
+00009880: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
+00009890: 6465 6661 756c 745f 7465 6d70 6b65 7920  default_tempkey 
+000098a0: 3d20 7365 6c66 2e74 656d 706b 6579 0a20  = self.tempkey. 
+000098b0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000098c0: 6c74 5f76 6d75 7365 7220 3d20 7365 6c66  lt_vmuser = self
+000098d0: 2e76 6d75 7365 720a 2020 2020 2020 2020  .vmuser.        
+000098e0: 2020 2020 6465 6661 756c 745f 7761 6974      default_wait
+000098f0: 203d 2073 656c 662e 7761 6974 0a20 2020   = self.wait.   
+00009900: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009910: 5f77 6169 7463 6f6d 6d61 6e64 203d 2073  _waitcommand = s
+00009920: 656c 662e 7761 6974 636f 6d6d 616e 640a  elf.waitcommand.
+00009930: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009940: 756c 745f 7761 6974 7469 6d65 6f75 7420  ult_waittimeout 
+00009950: 3d20 7365 6c66 2e77 6169 7474 696d 656f  = self.waittimeo
+00009960: 7574 0a20 2020 2020 2020 2070 6c61 6e20  ut.        plan 
+00009970: 3d20 7072 6f66 696c 652e 6765 7428 2770  = profile.get('p
+00009980: 6c61 6e27 2c20 706c 616e 290a 2020 2020  lan', plan).    
+00009990: 2020 2020 7465 6d70 6c61 7465 203d 2070      template = p
+000099a0: 726f 6669 6c65 2e67 6574 2827 7465 6d70  rofile.get('temp
+000099b0: 6c61 7465 272c 2064 6566 6175 6c74 5f69  late', default_i
+000099c0: 6d61 6765 290a 2020 2020 2020 2020 696d  mage).        im
+000099d0: 6167 6520 3d20 7072 6f66 696c 652e 6765  age = profile.ge
+000099e0: 7428 2769 6d61 6765 272c 2074 656d 706c  t('image', templ
+000099f0: 6174 6529 0a20 2020 2020 2020 206e 6574  ate).        net
+00009a00: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
+00009a10: 276e 6574 7327 2c20 6465 6661 756c 745f  'nets', default_
+00009a20: 6e65 7473 290a 2020 2020 2020 2020 6370  nets).        cp
+00009a30: 756d 6f64 656c 203d 2070 726f 6669 6c65  umodel = profile
+00009a40: 2e67 6574 2827 6370 756d 6f64 656c 272c  .get('cpumodel',
+00009a50: 2064 6566 6175 6c74 5f63 7075 6d6f 6465   default_cpumode
+00009a60: 6c29 0a20 2020 2020 2020 2063 7075 666c  l).        cpufl
+00009a70: 6167 7320 3d20 7072 6f66 696c 652e 6765  ags = profile.ge
+00009a80: 7428 2763 7075 666c 6167 7327 2c20 6465  t('cpuflags', de
+00009a90: 6661 756c 745f 6370 7566 6c61 6773 290a  fault_cpuflags).
+00009aa0: 2020 2020 2020 2020 6370 7570 696e 6e69          cpupinni
+00009ab0: 6e67 203d 2070 726f 6669 6c65 2e67 6574  ng = profile.get
+00009ac0: 2827 6370 7570 696e 6e69 6e67 272c 2064  ('cpupinning', d
+00009ad0: 6566 6175 6c74 5f63 7075 7069 6e6e 696e  efault_cpupinnin
+00009ae0: 6729 0a20 2020 2020 2020 206e 756d 616d  g).        numam
+00009af0: 6f64 6520 3d20 7072 6f66 696c 652e 6765  ode = profile.ge
+00009b00: 7428 276e 756d 616d 6f64 6527 2c20 6465  t('numamode', de
+00009b10: 6661 756c 745f 6e75 6d61 6d6f 6465 290a  fault_numamode).
+00009b20: 2020 2020 2020 2020 6e75 6d61 203d 2070          numa = p
+00009b30: 726f 6669 6c65 2e67 6574 2827 6e75 6d61  rofile.get('numa
+00009b40: 272c 2064 6566 6175 6c74 5f6e 756d 6129  ', default_numa)
+00009b50: 0a20 2020 2020 2020 2070 6369 6465 7669  .        pcidevi
+00009b60: 6365 7320 3d20 7072 6f66 696c 652e 6765  ces = profile.ge
+00009b70: 7428 2770 6369 6465 7669 6365 7327 2c20  t('pcidevices', 
+00009b80: 6465 6661 756c 745f 7063 6964 6576 6963  default_pcidevic
+00009b90: 6573 290a 2020 2020 2020 2020 7470 6d20  es).        tpm 
+00009ba0: 3d20 7072 6f66 696c 652e 6765 7428 2774  = profile.get('t
+00009bb0: 706d 272c 2064 6566 6175 6c74 5f74 706d  pm', default_tpm
+00009bc0: 290a 2020 2020 2020 2020 726e 6720 3d20  ).        rng = 
+00009bd0: 7072 6f66 696c 652e 6765 7428 2772 6e67  profile.get('rng
+00009be0: 272c 2064 6566 6175 6c74 5f72 6e67 290a  ', default_rng).
+00009bf0: 2020 2020 2020 2020 7a65 726f 7469 6572          zerotier
+00009c00: 5f6e 6574 7320 3d20 7072 6f66 696c 652e  _nets = profile.
+00009c10: 6765 7428 277a 6572 6f74 6965 725f 6e65  get('zerotier_ne
+00009c20: 7473 272c 2064 6566 6175 6c74 5f7a 6572  ts', default_zer
+00009c30: 6f74 6965 725f 6e65 7473 290a 2020 2020  otier_nets).    
+00009c40: 2020 2020 7a65 726f 7469 6572 5f6b 7562      zerotier_kub
+00009c50: 656c 6574 203d 2070 726f 6669 6c65 2e67  elet = profile.g
+00009c60: 6574 2827 7a65 726f 7469 6572 5f6b 7562  et('zerotier_kub
+00009c70: 656c 6574 272c 2064 6566 6175 6c74 5f7a  elet', default_z
+00009c80: 6572 6f74 6965 725f 6b75 6265 6c65 7429  erotier_kubelet)
+00009c90: 0a20 2020 2020 2020 2073 6563 7572 6974  .        securit
+00009ca0: 7967 726f 7570 7320 3d20 7072 6f66 696c  ygroups = profil
+00009cb0: 652e 6765 7428 2773 6563 7572 6974 7967  e.get('securityg
+00009cc0: 726f 7570 7327 2c20 6465 6661 756c 745f  roups', default_
+00009cd0: 7365 6375 7269 7479 6772 6f75 7073 290a  securitygroups).
+00009ce0: 2020 2020 2020 2020 6e75 6d63 7075 7320          numcpus 
+00009cf0: 3d20 7072 6f66 696c 652e 6765 7428 276e  = profile.get('n
+00009d00: 756d 6370 7573 272c 2064 6566 6175 6c74  umcpus', default
+00009d10: 5f6e 756d 6370 7573 290a 2020 2020 2020  _numcpus).      
+00009d20: 2020 6d65 6d6f 7279 203d 2070 726f 6669    memory = profi
+00009d30: 6c65 2e67 6574 2827 6d65 6d6f 7279 272c  le.get('memory',
+00009d40: 2064 6566 6175 6c74 5f6d 656d 6f72 7929   default_memory)
+00009d50: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00009d60: 7374 616e 6365 286d 656d 6f72 792c 2073  stance(memory, s
+00009d70: 7472 2920 616e 6420 286d 656d 6f72 792e  tr) and (memory.
+00009d80: 6c6f 7765 7228 292e 656e 6473 7769 7468  lower().endswith
+00009d90: 2827 6762 2729 206f 7220 6d65 6d6f 7279  ('gb') or memory
+00009da0: 2e6c 6f77 6572 2829 2e65 6e64 7377 6974  .lower().endswit
+00009db0: 6828 2767 2729 293a 0a20 2020 2020 2020  h('g')):.       
+00009dc0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00009dd0: 2020 2020 2020 2020 2020 6d65 6d6f 7279            memory
+00009de0: 203d 2069 6e74 286d 656d 6f72 792e 6c6f   = int(memory.lo
+00009df0: 7765 7228 2767 6227 2c20 2727 292e 7265  wer('gb', '').re
+00009e00: 706c 6163 6528 2767 272c 2027 2729 2920  place('g', '')) 
+00009e10: 2a20 3130 3234 0a20 2020 2020 2020 2020  * 1024.         
+00009e20: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00009e30: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00009e40: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00009e50: 6622 436f 756c 646e 7420 636f 6e76 6572  f"Couldnt conver
+00009e60: 7420 6d65 6d6f 7279 2e20 4869 7420 7b65  t memory. Hit {e
+00009e70: 7d22 290a 2020 2020 2020 2020 706f 6f6c  }").        pool
+00009e80: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+00009e90: 706f 6f6c 272c 2064 6566 6175 6c74 5f70  pool', default_p
+00009ea0: 6f6f 6c29 0a20 2020 2020 2020 2064 6973  ool).        dis
+00009eb0: 6b73 203d 2070 726f 6669 6c65 2e67 6574  ks = profile.get
+00009ec0: 2827 6469 736b 7327 2c20 6465 6661 756c  ('disks', defaul
+00009ed0: 745f 6469 736b 7329 0a20 2020 2020 2020  t_disks).       
+00009ee0: 2064 6973 6b73 697a 6520 3d20 7072 6f66   disksize = prof
+00009ef0: 696c 652e 6765 7428 2764 6973 6b73 697a  ile.get('disksiz
+00009f00: 6527 2c20 6465 6661 756c 745f 6469 736b  e', default_disk
+00009f10: 7369 7a65 290a 2020 2020 2020 2020 6469  size).        di
+00009f20: 736b 696e 7465 7266 6163 6520 3d20 7072  skinterface = pr
+00009f30: 6f66 696c 652e 6765 7428 2764 6973 6b69  ofile.get('diski
+00009f40: 6e74 6572 6661 6365 272c 2064 6566 6175  nterface', defau
+00009f50: 6c74 5f64 6973 6b69 6e74 6572 6661 6365  lt_diskinterface
+00009f60: 290a 2020 2020 2020 2020 6469 736b 7468  ).        diskth
+00009f70: 696e 203d 2070 726f 6669 6c65 2e67 6574  in = profile.get
+00009f80: 2827 6469 736b 7468 696e 272c 2064 6566  ('diskthin', def
+00009f90: 6175 6c74 5f64 6973 6b74 6869 6e29 0a20  ault_diskthin). 
+00009fa0: 2020 2020 2020 2069 6620 6469 736b 7320         if disks 
+00009fb0: 616e 6420 6973 696e 7374 616e 6365 2864  and isinstance(d
+00009fc0: 6973 6b73 2c20 6469 6374 2920 616e 6420  isks, dict) and 
+00009fd0: 2764 6566 6175 6c74 2720 696e 2064 6973  'default' in dis
+00009fe0: 6b73 5b30 5d3a 0a20 2020 2020 2020 2020  ks[0]:.         
+00009ff0: 2020 2064 6973 6b73 203d 205b 7b27 7369     disks = [{'si
+0000a000: 7a65 273a 2064 6973 6b73 697a 652c 2027  ze': disksize, '
+0000a010: 696e 7465 7266 6163 6527 3a20 6469 736b  interface': disk
+0000a020: 696e 7465 7266 6163 652c 2027 7468 696e  interface, 'thin
+0000a030: 273a 2064 6973 6b74 6869 6e7d 5d0a 2020  ': diskthin}].  
+0000a040: 2020 2020 2020 6775 6573 7469 6420 3d20        guestid = 
+0000a050: 7072 6f66 696c 652e 6765 7428 2767 7565  profile.get('gue
+0000a060: 7374 6964 272c 2064 6566 6175 6c74 5f67  stid', default_g
+0000a070: 7565 7374 6964 290a 2020 2020 2020 2020  uestid).        
+0000a080: 6973 6f20 3d20 7072 6f66 696c 652e 6765  iso = profile.ge
+0000a090: 7428 2769 736f 272c 2064 6566 6175 6c74  t('iso', default
+0000a0a0: 5f69 736f 290a 2020 2020 2020 2020 766e  _iso).        vn
+0000a0b0: 6320 3d20 7072 6f66 696c 652e 6765 7428  c = profile.get(
+0000a0c0: 2776 6e63 272c 2064 6566 6175 6c74 5f76  'vnc', default_v
+0000a0d0: 6e63 290a 2020 2020 2020 2020 636c 6f75  nc).        clou
+0000a0e0: 6469 6e69 7420 3d20 7072 6f66 696c 652e  dinit = profile.
+0000a0f0: 6765 7428 2763 6c6f 7564 696e 6974 272c  get('cloudinit',
+0000a100: 2064 6566 6175 6c74 5f63 6c6f 7564 696e   default_cloudin
+0000a110: 6974 290a 2020 2020 2020 2020 6966 2063  it).        if c
+0000a120: 6c6f 7564 696e 6974 2061 6e64 2073 656c  loudinit and sel
+0000a130: 662e 7479 7065 203d 3d20 276b 766d 2720  f.type == 'kvm' 
+0000a140: 616e 645c 0a20 2020 2020 2020 2020 2020  and\.           
+0000a150: 2020 2020 2077 6869 6368 2827 6d6b 6973       which('mkis
+0000a160: 6f66 7327 2920 6973 204e 6f6e 6520 616e  ofs') is None an
+0000a170: 6420 7768 6963 6828 2767 656e 6973 6f69  d which('genisoi
+0000a180: 6d61 6765 2729 2069 7320 4e6f 6e65 3a0a  mage') is None:.
+0000a190: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a1a0: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
+0000a1b0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
+0000a1c0: 273a 2022 4d69 7373 696e 6720 6d6b 6973  ': "Missing mkis
+0000a1d0: 6f66 732f 6765 6e69 736f 696d 6167 6520  ofs/genisoimage 
+0000a1e0: 6e65 6564 6564 2066 6f72 2063 6c6f 7564  needed for cloud
+0000a1f0: 696e 6974 227d 0a20 2020 2020 2020 2072  init"}.        r
+0000a200: 6573 6572 7665 6970 203d 2070 726f 6669  eserveip = profi
+0000a210: 6c65 2e67 6574 2827 7265 7365 7276 6569  le.get('reservei
+0000a220: 7027 2c20 6465 6661 756c 745f 7265 7365  p', default_rese
+0000a230: 7276 6569 7029 0a20 2020 2020 2020 2072  rveip).        r
+0000a240: 6573 6572 7665 646e 7320 3d20 7072 6f66  eservedns = prof
+0000a250: 696c 652e 6765 7428 2772 6573 6572 7665  ile.get('reserve
+0000a260: 646e 7327 2c20 6465 6661 756c 745f 7265  dns', default_re
+0000a270: 7365 7276 6564 6e73 290a 2020 2020 2020  servedns).      
+0000a280: 2020 7265 7365 7276 6568 6f73 7420 3d20    reservehost = 
+0000a290: 7072 6f66 696c 652e 6765 7428 2772 6573  profile.get('res
+0000a2a0: 6572 7665 686f 7374 272c 2064 6566 6175  ervehost', defau
+0000a2b0: 6c74 5f72 6573 6572 7665 686f 7374 290a  lt_reservehost).
+0000a2c0: 2020 2020 2020 2020 6e65 7374 6564 203d          nested =
+0000a2d0: 2070 726f 6669 6c65 2e67 6574 2827 6e65   profile.get('ne
+0000a2e0: 7374 6564 272c 2064 6566 6175 6c74 5f6e  sted', default_n
+0000a2f0: 6573 7465 6429 0a20 2020 2020 2020 2073  ested).        s
+0000a300: 7461 7274 203d 2070 726f 6669 6c65 2e67  tart = profile.g
+0000a310: 6574 2827 7374 6172 7427 2c20 6465 6661  et('start', defa
+0000a320: 756c 745f 7374 6172 7429 0a20 2020 2020  ult_start).     
+0000a330: 2020 2061 7574 6f73 7461 7274 203d 2070     autostart = p
+0000a340: 726f 6669 6c65 2e67 6574 2827 6175 746f  rofile.get('auto
+0000a350: 7374 6172 7427 2c20 6465 6661 756c 745f  start', default_
+0000a360: 6175 746f 7374 6172 7429 0a20 2020 2020  autostart).     
+0000a370: 2020 206b 6579 7320 3d20 7072 6f66 696c     keys = profil
+0000a380: 652e 6765 7428 276b 6579 7327 2c20 6465  e.get('keys', de
+0000a390: 6661 756c 745f 6b65 7973 290a 2020 2020  fault_keys).    
+0000a3a0: 2020 2020 636d 6473 203d 2063 6f6d 6d6f      cmds = commo
+0000a3b0: 6e2e 7265 6d6f 7665 5f64 7570 6c69 6361  n.remove_duplica
+0000a3c0: 7465 7328 6465 6661 756c 745f 636d 6473  tes(default_cmds
+0000a3d0: 202b 2070 726f 6669 6c65 2e67 6574 2827   + profile.get('
+0000a3e0: 636d 6473 272c 205b 5d29 290a 2020 2020  cmds', [])).    
+0000a3f0: 2020 2020 6e65 746d 6173 6b73 203d 2070      netmasks = p
+0000a400: 726f 6669 6c65 2e67 6574 2827 6e65 746d  rofile.get('netm
+0000a410: 6173 6b73 272c 2064 6566 6175 6c74 5f6e  asks', default_n
+0000a420: 6574 6d61 736b 7329 0a20 2020 2020 2020  etmasks).       
+0000a430: 2067 6174 6577 6179 203d 2070 726f 6669   gateway = profi
+0000a440: 6c65 2e67 6574 2827 6761 7465 7761 7927  le.get('gateway'
+0000a450: 2c20 6465 6661 756c 745f 6761 7465 7761  , default_gatewa
+0000a460: 7929 0a20 2020 2020 2020 2064 6e73 203d  y).        dns =
+0000a470: 2070 726f 6669 6c65 2e67 6574 2827 646e   profile.get('dn
+0000a480: 7327 2c20 6465 6661 756c 745f 646e 7329  s', default_dns)
+0000a490: 0a20 2020 2020 2020 2064 6f6d 6169 6e20  .        domain 
+0000a4a0: 3d20 7072 6f66 696c 652e 6765 7428 2764  = profile.get('d
+0000a4b0: 6f6d 6169 6e27 2c20 6f76 6572 7269 6465  omain', override
+0000a4c0: 732e 6765 7428 2764 6f6d 6169 6e27 2c20  s.get('domain', 
+0000a4d0: 6465 6661 756c 745f 646f 6d61 696e 2929  default_domain))
+0000a4e0: 0a20 2020 2020 2020 2064 6e73 636c 6965  .        dnsclie
+0000a4f0: 6e74 203d 2070 726f 6669 6c65 2e67 6574  nt = profile.get
+0000a500: 2827 646e 7363 6c69 656e 7427 2c20 6f76  ('dnsclient', ov
+0000a510: 6572 7269 6465 732e 6765 7428 2764 6e73  errides.get('dns
+0000a520: 636c 6965 6e74 272c 2064 6566 6175 6c74  client', default
+0000a530: 5f64 6e73 636c 6965 6e74 2929 0a20 2020  _dnsclient)).   
+0000a540: 2020 2020 2073 6372 6970 7473 203d 2063       scripts = c
+0000a550: 6f6d 6d6f 6e2e 7265 6d6f 7665 5f64 7570  ommon.remove_dup
+0000a560: 6c69 6361 7465 7328 6465 6661 756c 745f  licates(default_
+0000a570: 7363 7269 7074 7320 2b20 7072 6f66 696c  scripts + profil
+0000a580: 652e 6765 7428 2773 6372 6970 7473 272c  e.get('scripts',
+0000a590: 205b 5d29 290a 2020 2020 2020 2020 6669   [])).        fi
+0000a5a0: 6c65 7320 3d20 7072 6f66 696c 652e 6765  les = profile.ge
+0000a5b0: 7428 2766 696c 6573 272c 2064 6566 6175  t('files', defau
+0000a5c0: 6c74 5f66 696c 6573 290a 2020 2020 2020  lt_files).      
+0000a5d0: 2020 6578 7472 615f 6669 6c65 7320 3d20    extra_files = 
+0000a5e0: 7072 6f66 696c 652e 6765 7428 2765 7874  profile.get('ext
+0000a5f0: 7261 5f66 696c 6573 2729 206f 7220 6f76  ra_files') or ov
+0000a600: 6572 7269 6465 732e 6765 7428 2765 7874  errides.get('ext
+0000a610: 7261 5f66 696c 6573 2729 206f 7220 5b5d  ra_files') or []
+0000a620: 0a20 2020 2020 2020 2066 696c 6573 2e65  .        files.e
+0000a630: 7874 656e 6428 6578 7472 615f 6669 6c65  xtend(extra_file
+0000a640: 7329 0a20 2020 2020 2020 2072 6573 756c  s).        resul
+0000a650: 7420 3d20 7365 6c66 2e70 6172 7365 5f66  t = self.parse_f
+0000a660: 696c 6573 286e 616d 652c 2066 696c 6573  iles(name, files
+0000a670: 2c20 6261 7365 6469 722c 206f 6e66 6c79  , basedir, onfly
+0000a680: 290a 2020 2020 2020 2020 6966 2072 6573  ).        if res
+0000a690: 756c 7420 6973 206e 6f74 204e 6f6e 653a  ult is not None:
+0000a6a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a6b0: 7572 6e20 7265 7375 6c74 0a20 2020 2020  urn result.     
+0000a6c0: 2020 2070 726f 6669 6c65 5f65 6e76 5f70     profile_env_p
+0000a6d0: 6172 616d 6574 6572 7320 3d20 5b6b 6579  arameters = [key
+0000a6e0: 2066 6f72 206b 6579 2069 6e20 7072 6f66   for key in prof
+0000a6f0: 696c 6520 6966 206b 6579 2e69 7375 7070  ile if key.isupp
+0000a700: 6572 2829 5d0a 2020 2020 2020 2020 6f76  er()].        ov
+0000a710: 6572 7269 6465 735f 656e 765f 7061 7261  errides_env_para
+0000a720: 6d65 7465 7273 203d 205b 6b65 7920 666f  meters = [key fo
+0000a730: 7220 6b65 7920 696e 206f 7665 7272 6964  r key in overrid
+0000a740: 6573 2069 6620 6b65 792e 6973 7570 7065  es if key.isuppe
+0000a750: 7228 295d 0a20 2020 2020 2020 2065 6e76  r()].        env
+0000a760: 5f70 6172 616d 6574 6572 7320 3d20 736f  _parameters = so
+0000a770: 7274 6564 286c 6973 7428 7365 7428 7072  rted(list(set(pr
+0000a780: 6f66 696c 655f 656e 765f 7061 7261 6d65  ofile_env_parame
+0000a790: 7465 7273 202b 206f 7665 7272 6964 6573  ters + overrides
+0000a7a0: 5f65 6e76 5f70 6172 616d 6574 6572 7329  _env_parameters)
+0000a7b0: 2929 0a20 2020 2020 2020 2069 6620 656e  )).        if en
+0000a7c0: 765f 7061 7261 6d65 7465 7273 3a0a 2020  v_parameters:.  
+0000a7d0: 2020 2020 2020 2020 2020 656e 765f 6461            env_da
+0000a7e0: 7461 203d 2027 270a 2020 2020 2020 2020  ta = ''.        
+0000a7f0: 2020 2020 666f 7220 6b65 7920 696e 2065      for key in e
+0000a800: 6e76 5f70 6172 616d 6574 6572 733a 0a20  nv_parameters:. 
+0000a810: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000a820: 616c 7565 203d 2070 726f 6669 6c65 2e67  alue = profile.g
+0000a830: 6574 286b 6579 2920 6f72 206f 7665 7272  et(key) or overr
+0000a840: 6964 6573 2e67 6574 286b 6579 290a 2020  ides.get(key).  
+0000a850: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0000a860: 765f 6461 7461 202b 3d20 6622 6578 706f  v_data += f"expo
+0000a870: 7274 207b 6b65 797d 3d7b 7661 6c75 657d  rt {key}={value}
+0000a880: 5c6e 6578 706f 7274 207b 6b65 792e 6c6f  \nexport {key.lo
+0000a890: 7765 7228 297d 3d7b 7661 6c75 657d 5c6e  wer()}={value}\n
+0000a8a0: 220a 2020 2020 2020 2020 2020 2020 6669  ".            fi
+0000a8b0: 6c65 732e 6170 7065 6e64 287b 2770 6174  les.append({'pat
+0000a8c0: 6827 3a20 272f 6574 632f 7072 6f66 696c  h': '/etc/profil
+0000a8d0: 652e 642f 6b63 6c69 2e73 6827 2c20 2763  e.d/kcli.sh', 'c
+0000a8e0: 6f6e 7465 6e74 273a 2065 6e76 5f64 6174  ontent': env_dat
+0000a8f0: 612c 2027 6d6f 6465 273a 2036 3434 7d29  a, 'mode': 644})
+0000a900: 0a20 2020 2020 2020 2065 6e61 626c 6572  .        enabler
+0000a910: 6f6f 7420 3d20 7072 6f66 696c 652e 6765  oot = profile.ge
+0000a920: 7428 2765 6e61 626c 6572 6f6f 7427 2c20  t('enableroot', 
+0000a930: 6465 6661 756c 745f 656e 6162 6c65 726f  default_enablero
+0000a940: 6f74 290a 2020 2020 2020 2020 7461 6773  ot).        tags
+0000a950: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000a960: 7461 6773 272c 205b 5d29 0a20 2020 2020  tags', []).     
+0000a970: 2020 2069 6620 6465 6661 756c 745f 7461     if default_ta
+0000a980: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000a990: 7461 6773 203d 2064 6566 6175 6c74 5f74  tags = default_t
+0000a9a0: 6167 7320 2b20 7461 6773 2069 6620 7461  ags + tags if ta
+0000a9b0: 6773 2065 6c73 6520 6465 6661 756c 745f  gs else default_
+0000a9c0: 7461 6773 0a20 2020 2020 2020 2070 7269  tags.        pri
+0000a9d0: 7661 7465 6b65 7920 3d20 7072 6f66 696c  vatekey = profil
+0000a9e0: 652e 6765 7428 2770 7269 7661 7465 6b65  e.get('privateke
+0000a9f0: 7927 2c20 6465 6661 756c 745f 7072 6976  y', default_priv
+0000aa00: 6174 656b 6579 290a 2020 2020 2020 2020  atekey).        
+0000aa10: 6e65 7477 6f72 6b77 6169 7420 3d20 7072  networkwait = pr
+0000aa20: 6f66 696c 652e 6765 7428 276e 6574 776f  ofile.get('netwo
+0000aa30: 726b 7761 6974 272c 2064 6566 6175 6c74  rkwait', default
+0000aa40: 5f6e 6574 776f 726b 7761 6974 290a 2020  _networkwait).  
+0000aa50: 2020 2020 2020 7268 6e72 6567 6973 7465        rhnregiste
+0000aa60: 7220 3d20 7072 6f66 696c 652e 6765 7428  r = profile.get(
+0000aa70: 2772 686e 7265 6769 7374 6572 272c 2064  'rhnregister', d
+0000aa80: 6566 6175 6c74 5f72 686e 7265 6769 7374  efault_rhnregist
+0000aa90: 6572 290a 2020 2020 2020 2020 7268 6e73  er).        rhns
+0000aaa0: 6572 7665 7220 3d20 7072 6f66 696c 652e  erver = profile.
+0000aab0: 6765 7428 2772 686e 7365 7276 6572 272c  get('rhnserver',
+0000aac0: 2064 6566 6175 6c74 5f72 686e 7365 7276   default_rhnserv
+0000aad0: 6572 290a 2020 2020 2020 2020 7268 6e75  er).        rhnu
+0000aae0: 7365 7220 3d20 7072 6f66 696c 652e 6765  ser = profile.ge
+0000aaf0: 7428 2772 686e 7573 6572 272c 2064 6566  t('rhnuser', def
+0000ab00: 6175 6c74 5f72 686e 7573 6572 290a 2020  ault_rhnuser).  
+0000ab10: 2020 2020 2020 7268 6e70 6173 7377 6f72        rhnpasswor
+0000ab20: 6420 3d20 7072 6f66 696c 652e 6765 7428  d = profile.get(
+0000ab30: 2772 686e 7061 7373 776f 7264 272c 2064  'rhnpassword', d
+0000ab40: 6566 6175 6c74 5f72 686e 7061 7373 776f  efault_rhnpasswo
+0000ab50: 7264 290a 2020 2020 2020 2020 7268 6e61  rd).        rhna
+0000ab60: 6b20 3d20 7072 6f66 696c 652e 6765 7428  k = profile.get(
+0000ab70: 2772 686e 6163 7469 7661 7469 6f6e 6b65  'rhnactivationke
+0000ab80: 7927 2c20 6465 6661 756c 745f 7268 6e61  y', default_rhna
+0000ab90: 6b29 0a20 2020 2020 2020 2072 686e 6f72  k).        rhnor
+0000aba0: 6720 3d20 7072 6f66 696c 652e 6765 7428  g = profile.get(
+0000abb0: 2772 686e 6f72 6727 2c20 6465 6661 756c  'rhnorg', defaul
+0000abc0: 745f 7268 6e6f 7267 290a 2020 2020 2020  t_rhnorg).      
+0000abd0: 2020 7268 6e70 6f6f 6c20 3d20 7072 6f66    rhnpool = prof
+0000abe0: 696c 652e 6765 7428 2772 686e 706f 6f6c  ile.get('rhnpool
+0000abf0: 272c 2064 6566 6175 6c74 5f72 686e 706f  ', default_rhnpo
+0000ac00: 6f6c 290a 2020 2020 2020 2020 666c 6176  ol).        flav
+0000ac10: 6f72 203d 2070 726f 6669 6c65 2e67 6574  or = profile.get
+0000ac20: 2827 666c 6176 6f72 272c 2064 6566 6175  ('flavor', defau
+0000ac30: 6c74 5f66 6c61 766f 7229 0a20 2020 2020  lt_flavor).     
+0000ac40: 2020 2073 746f 7265 6d65 7461 6461 7461     storemetadata
+0000ac50: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000ac60: 7374 6f72 656d 6574 6164 6174 6127 2c20  storemetadata', 
+0000ac70: 6465 6661 756c 745f 7374 6f72 656d 6574  default_storemet
+0000ac80: 6164 6174 6129 0a20 2020 2020 2020 206e  adata).        n
+0000ac90: 6f74 6966 7920 3d20 7072 6f66 696c 652e  otify = profile.
+0000aca0: 6765 7428 276e 6f74 6966 7927 2c20 6465  get('notify', de
+0000acb0: 6661 756c 745f 6e6f 7469 6679 290a 2020  fault_notify).  
+0000acc0: 2020 2020 2020 7075 7368 6275 6c6c 6574        pushbullet
+0000acd0: 746f 6b65 6e20 3d20 7072 6f66 696c 652e  token = profile.
+0000ace0: 6765 7428 2770 7573 6862 756c 6c65 7474  get('pushbullett
+0000acf0: 6f6b 656e 272c 2064 6566 6175 6c74 5f70  oken', default_p
+0000ad00: 7573 6862 756c 6c65 7474 6f6b 656e 290a  ushbullettoken).
+0000ad10: 2020 2020 2020 2020 736c 6163 6b74 6f6b          slacktok
+0000ad20: 656e 203d 2070 726f 6669 6c65 2e67 6574  en = profile.get
+0000ad30: 2827 736c 6163 6b74 6f6b 656e 272c 2064  ('slacktoken', d
+0000ad40: 6566 6175 6c74 5f73 6c61 636b 746f 6b65  efault_slacktoke
+0000ad50: 6e29 0a20 2020 2020 2020 206e 6f74 6966  n).        notif
+0000ad60: 7963 6d64 203d 2070 726f 6669 6c65 2e67  ycmd = profile.g
+0000ad70: 6574 2827 6e6f 7469 6679 636d 6427 2c20  et('notifycmd', 
+0000ad80: 6465 6661 756c 745f 6e6f 7469 6679 636d  default_notifycm
+0000ad90: 6429 0a20 2020 2020 2020 206e 6f74 6966  d).        notif
+0000ada0: 7973 6372 6970 7420 3d20 7072 6f66 696c  yscript = profil
+0000adb0: 652e 6765 7428 276e 6f74 6966 7973 6372  e.get('notifyscr
+0000adc0: 6970 7427 2c20 6465 6661 756c 745f 6e6f  ipt', default_no
+0000add0: 7469 6679 7363 7269 7074 290a 2020 2020  tifyscript).    
+0000ade0: 2020 2020 6e6f 7469 6679 6d65 7468 6f64      notifymethod
+0000adf0: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
+0000ae00: 276e 6f74 6966 796d 6574 686f 6473 272c  'notifymethods',
+0000ae10: 2064 6566 6175 6c74 5f6e 6f74 6966 796d   default_notifym
+0000ae20: 6574 686f 6473 290a 2020 2020 2020 2020  ethods).        
+0000ae30: 736c 6163 6b63 6861 6e6e 656c 203d 2070  slackchannel = p
+0000ae40: 726f 6669 6c65 2e67 6574 2827 736c 6163  rofile.get('slac
+0000ae50: 6b63 6861 6e6e 656c 272c 2064 6566 6175  kchannel', defau
+0000ae60: 6c74 5f73 6c61 636b 6368 616e 6e65 6c29  lt_slackchannel)
+0000ae70: 0a20 2020 2020 2020 206d 6169 6c73 6572  .        mailser
+0000ae80: 7665 7220 3d20 7072 6f66 696c 652e 6765  ver = profile.ge
+0000ae90: 7428 276d 6169 6c73 6572 7665 7227 2c20  t('mailserver', 
+0000aea0: 6465 6661 756c 745f 6d61 696c 7365 7276  default_mailserv
+0000aeb0: 6572 290a 2020 2020 2020 2020 6d61 696c  er).        mail
+0000aec0: 6672 6f6d 203d 2070 726f 6669 6c65 2e67  from = profile.g
+0000aed0: 6574 2827 6d61 696c 6672 6f6d 272c 2064  et('mailfrom', d
+0000aee0: 6566 6175 6c74 5f6d 6169 6c66 726f 6d29  efault_mailfrom)
+0000aef0: 0a20 2020 2020 2020 206d 6169 6c74 6f20  .        mailto 
+0000af00: 3d20 7072 6f66 696c 652e 6765 7428 276d  = profile.get('m
+0000af10: 6169 6c74 6f27 2c20 6465 6661 756c 745f  ailto', default_
+0000af20: 6d61 696c 746f 290a 2020 2020 2020 2020  mailto).        
+0000af30: 7368 6172 6564 666f 6c64 6572 7320 3d20  sharedfolders = 
+0000af40: 7072 6f66 696c 652e 6765 7428 2773 6861  profile.get('sha
+0000af50: 7265 6466 6f6c 6465 7273 272c 2064 6566  redfolders', def
+0000af60: 6175 6c74 5f73 6861 7265 6466 6f6c 6465  ault_sharedfolde
+0000af70: 7273 290a 2020 2020 2020 2020 6b65 726e  rs).        kern
+0000af80: 656c 203d 2070 726f 6669 6c65 2e67 6574  el = profile.get
+0000af90: 2827 6b65 726e 656c 272c 2064 6566 6175  ('kernel', defau
+0000afa0: 6c74 5f6b 6572 6e65 6c29 0a20 2020 2020  lt_kernel).     
+0000afb0: 2020 2069 6e69 7472 6420 3d20 7072 6f66     initrd = prof
+0000afc0: 696c 652e 6765 7428 2769 6e69 7472 6427  ile.get('initrd'
+0000afd0: 2c20 6465 6661 756c 745f 696e 6974 7264  , default_initrd
+0000afe0: 290a 2020 2020 2020 2020 636d 646c 696e  ).        cmdlin
+0000aff0: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
+0000b000: 2763 6d64 6c69 6e65 272c 2064 6566 6175  'cmdline', defau
+0000b010: 6c74 5f63 6d64 6c69 6e65 290a 2020 2020  lt_cmdline).    
+0000b020: 2020 2020 706c 6163 656d 656e 7420 3d20      placement = 
+0000b030: 7072 6f66 696c 652e 6765 7428 2770 6c61  profile.get('pla
+0000b040: 6365 6d65 6e74 272c 2064 6566 6175 6c74  cement', default
+0000b050: 5f70 6c61 6365 6d65 6e74 290a 2020 2020  _placement).    
+0000b060: 2020 2020 7961 6d6c 696e 7665 6e74 6f72      yamlinventor
+0000b070: 7920 3d20 7072 6f66 696c 652e 6765 7428  y = profile.get(
+0000b080: 2779 616d 6c69 6e76 656e 746f 7279 272c  'yamlinventory',
+0000b090: 2064 6566 6175 6c74 5f79 616d 6c69 6e76   default_yamlinv
+0000b0a0: 656e 746f 7279 290a 2020 2020 2020 2020  entory).        
+0000b0b0: 6370 7568 6f74 706c 7567 203d 2070 726f  cpuhotplug = pro
+0000b0c0: 6669 6c65 2e67 6574 2827 6370 7568 6f74  file.get('cpuhot
+0000b0d0: 706c 7567 272c 2064 6566 6175 6c74 5f63  plug', default_c
+0000b0e0: 7075 686f 7470 6c75 6729 0a20 2020 2020  puhotplug).     
+0000b0f0: 2020 206d 656d 6f72 7968 6f74 706c 7567     memoryhotplug
+0000b100: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000b110: 6d65 6d6f 7279 686f 7470 6c75 6727 2c20  memoryhotplug', 
+0000b120: 6465 6661 756c 745f 6d65 6d6f 7279 686f  default_memoryho
+0000b130: 7470 6c75 6729 0a20 2020 2020 2020 2072  tplug).        r
+0000b140: 6f6f 7470 6173 7377 6f72 6420 3d20 7072  ootpassword = pr
+0000b150: 6f66 696c 652e 6765 7428 2772 6f6f 7470  ofile.get('rootp
+0000b160: 6173 7377 6f72 6427 2c20 6465 6661 756c  assword', defaul
+0000b170: 745f 726f 6f74 7061 7373 776f 7264 290a  t_rootpassword).
+0000b180: 2020 2020 2020 2020 766d 7573 6572 203d          vmuser =
+0000b190: 2070 726f 6669 6c65 2e67 6574 2827 766d   profile.get('vm
+0000b1a0: 7573 6572 272c 2064 6566 6175 6c74 5f76  user', default_v
+0000b1b0: 6d75 7365 7229 0a20 2020 2020 2020 2074  muser).        t
+0000b1c0: 656d 706b 6579 203d 2070 726f 6669 6c65  empkey = profile
+0000b1d0: 2e67 6574 2827 7465 6d70 6b65 7927 2c20  .get('tempkey', 
+0000b1e0: 6465 6661 756c 745f 7465 6d70 6b65 7929  default_tempkey)
+0000b1f0: 0a20 2020 2020 2020 2077 6169 7420 3d20  .        wait = 
+0000b200: 7072 6f66 696c 652e 6765 7428 2777 6169  profile.get('wai
+0000b210: 7427 2c20 6465 6661 756c 745f 7761 6974  t', default_wait
+0000b220: 290a 2020 2020 2020 2020 7761 6974 636f  ).        waitco
+0000b230: 6d6d 616e 6420 3d20 7072 6f66 696c 652e  mmand = profile.
+0000b240: 6765 7428 2777 6169 7463 6f6d 6d61 6e64  get('waitcommand
+0000b250: 272c 2064 6566 6175 6c74 5f77 6169 7463  ', default_waitc
+0000b260: 6f6d 6d61 6e64 290a 2020 2020 2020 2020  ommand).        
+0000b270: 6966 2077 6169 7463 6f6d 6d61 6e64 2069  if waitcommand i
+0000b280: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000b290: 2020 2020 2020 2020 7761 6974 203d 2054          wait = T
+0000b2a0: 7275 650a 2020 2020 2020 2020 7761 6974  rue.        wait
+0000b2b0: 7469 6d65 6f75 7420 3d20 7072 6f66 696c  timeout = profil
+0000b2c0: 652e 6765 7428 2777 6169 7474 696d 656f  e.get('waittimeo
+0000b2d0: 7574 272c 2064 6566 6175 6c74 5f77 6169  ut', default_wai
+0000b2e0: 7474 696d 656f 7574 290a 2020 2020 2020  ttimeout).      
+0000b2f0: 2020 7669 7274 7479 7065 203d 2070 726f    virttype = pro
+0000b300: 6669 6c65 2e67 6574 2827 7669 7274 7479  file.get('virtty
+0000b310: 7065 272c 2064 6566 6175 6c74 5f76 6972  pe', default_vir
+0000b320: 7474 7970 6529 0a20 2020 2020 2020 206f  ttype).        o
+0000b330: 7665 7272 6964 6573 2e75 7064 6174 6528  verrides.update(
+0000b340: 7072 6f66 696c 6529 0a20 2020 2020 2020  profile).       
+0000b350: 2073 6372 6970 7463 6d64 7320 3d20 5b5d   scriptcmds = []
+0000b360: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
+0000b370: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+0000b380: 6420 2772 6865 6c27 2069 6e20 696d 6167  d 'rhel' in imag
+0000b390: 652e 6c6f 7765 7228 293a 0a20 2020 2020  e.lower():.     
+0000b3a0: 2020 2020 2020 2069 6620 7268 6e72 6567         if rhnreg
+0000b3b0: 6973 7465 723a 0a20 2020 2020 2020 2020  ister:.         
+0000b3c0: 2020 2020 2020 2069 6620 7268 6e75 7365         if rhnuse
+0000b3d0: 7220 6973 206e 6f74 204e 6f6e 6520 616e  r is not None an
+0000b3e0: 6420 7268 6e70 6173 7377 6f72 6420 6973  d rhnpassword is
+0000b3f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000b400: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000b410: 7665 7272 6964 6573 5b27 7268 6e75 7365  verrides['rhnuse
+0000b420: 7227 5d20 3d20 7268 6e75 7365 720a 2020  r'] = rhnuser.  
+0000b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b440: 2020 6f76 6572 7269 6465 735b 2772 686e    overrides['rhn
+0000b450: 7061 7373 776f 7264 275d 203d 2072 686e  password'] = rhn
+0000b460: 7061 7373 776f 7264 0a20 2020 2020 2020  password.       
+0000b470: 2020 2020 2020 2020 2065 6c69 6620 7268           elif rh
+0000b480: 6e61 6b20 6973 206e 6f74 204e 6f6e 6520  nak is not None 
+0000b490: 616e 6420 7268 6e6f 7267 2069 7320 6e6f  and rhnorg is no
+0000b4a0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000b4b0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+0000b4c0: 7269 6465 735b 2772 686e 6163 7469 7661  rides['rhnactiva
+0000b4d0: 7469 6f6e 6b65 7927 5d20 3d20 7268 6e61  tionkey'] = rhna
+0000b4e0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0000b4f0: 2020 2020 2020 6f76 6572 7269 6465 735b        overrides[
+0000b500: 2772 686e 6f72 6727 5d20 3d20 7268 6e6f  'rhnorg'] = rhno
+0000b510: 7267 0a20 2020 2020 2020 2020 2020 2020  rg.             
+0000b520: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000b530: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+0000b540: 203d 2022 5268 6e20 7265 6769 7374 7261   = "Rhn registra
+0000b550: 7469 6f6e 2072 6571 7569 7265 6420 6275  tion required bu
+0000b560: 7420 6d69 7373 696e 6720 6372 6564 656e  t missing creden
+0000b570: 7469 616c 732e 2022 0a20 2020 2020 2020  tials. ".       
+0000b580: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+0000b590: 202b 3d20 2244 6566 696e 6520 7268 6e75   += "Define rhnu
+0000b5a0: 7365 722f 7268 6e70 6173 7377 6f72 6420  ser/rhnpassword 
+0000b5b0: 6f72 2072 686e 6163 7469 7661 7469 6f6e  or rhnactivation
+0000b5c0: 6b65 792f 7268 6e6f 7267 220a 2020 2020  key/rhnorg".    
+0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5e0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+0000b5f0: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+0000b600: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
+0000b610: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000b620: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0000b630: 726e 696e 6728 6622 7b6e 616d 657d 2077  rning(f"{name} w
+0000b640: 696c 6c20 7265 7175 6972 6520 6d61 6e75  ill require manu
+0000b650: 616c 2073 7562 7363 7269 7074 696f 6e20  al subscription 
+0000b660: 746f 2052 6564 2048 6174 204e 6574 776f  to Red Hat Netwo
+0000b670: 726b 2229 0a20 2020 2020 2020 2069 6620  rk").        if 
+0000b680: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+0000b690: 6520 616e 6420 636c 6f75 6469 6e69 7420  e and cloudinit 
+0000b6a0: 616e 6420 6973 6f20 6973 206e 6f74 204e  and iso is not N
+0000b6b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b6c0: 2077 6172 6e69 6e67 2866 2249 676e 6f72   warning(f"Ignor
+0000b6d0: 696e 6720 6973 6f20 7b69 736f 7d20 6173  ing iso {iso} as
+0000b6e0: 2069 6d61 6765 207b 696d 6167 657d 2069   image {image} i
+0000b6f0: 7320 7365 7422 290a 2020 2020 2020 2020  s set").        
+0000b700: 6966 2073 6372 6970 7473 3a0a 2020 2020  if scripts:.    
+0000b710: 2020 2020 2020 2020 666f 7220 7363 7269          for scri
+0000b720: 7074 2069 6e20 7363 7269 7074 733a 0a20  pt in scripts:. 
+0000b730: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b740: 6620 6f6e 666c 7920 6973 206e 6f74 204e  f onfly is not N
+0000b750: 6f6e 6520 616e 6420 277e 2720 6e6f 7420  one and '~' not 
+0000b760: 696e 2073 6372 6970 743a 0a20 2020 2020  in script:.     
+0000b770: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000b780: 6573 7464 6972 203d 2062 6173 6564 6972  estdir = basedir
+0000b790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b7a0: 2020 2020 2069 6620 272f 2720 696e 2073       if '/' in s
+0000b7b0: 6372 6970 743a 0a20 2020 2020 2020 2020  cript:.         
+0000b7c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000b7d0: 6573 7464 6972 203d 206f 732e 7061 7468  estdir = os.path
+0000b7e0: 2e64 6972 6e61 6d65 2873 6372 6970 7429  .dirname(script)
+0000b7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b800: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
+0000b810: 6469 7273 2864 6573 7464 6972 2c20 6578  dirs(destdir, ex
+0000b820: 6973 745f 6f6b 3d54 7275 6529 0a20 2020  ist_ok=True).   
+0000b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b840: 2063 6f6d 6d6f 6e2e 6665 7463 6828 6622   common.fetch(f"
+0000b850: 7b6f 6e66 6c79 7d2f 7b73 6372 6970 747d  {onfly}/{script}
+0000b860: 222c 2064 6573 7464 6972 290a 2020 2020  ", destdir).    
+0000b870: 2020 2020 2020 2020 2020 2020 7363 7269              scri
+0000b880: 7074 203d 206f 732e 7061 7468 2e65 7870  pt = os.path.exp
+0000b890: 616e 6475 7365 7228 7363 7269 7074 290a  anduser(script).
+0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8b0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
+0000b8c0: 7328 7363 7269 7074 293a 0a20 2020 2020  s(script):.     
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b8e0: 6620 6e6f 7420 6f73 2e70 6174 682e 6973  f not os.path.is
+0000b8f0: 6162 7328 7363 7269 7074 293a 0a20 2020  abs(script):.   
+0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b910: 2020 2020 2073 6372 6970 7420 3d20 6f73       script = os
+0000b920: 2e70 6174 682e 6162 7370 6174 6828 7363  .path.abspath(sc
+0000b930: 7269 7074 290a 2020 2020 2020 2020 2020  ript).          
+0000b940: 2020 2020 2020 656c 6966 2062 6173 6564        elif based
+0000b950: 6972 2021 3d20 272e 273a 0a20 2020 2020  ir != '.':.     
+0000b960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b970: 6372 6970 7420 3d20 6627 7b62 6173 6564  cript = f'{based
+0000b980: 6972 7d2f 7b73 6372 6970 747d 270a 2020  ir}/{script}'.  
+0000b990: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000b9a0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+0000b9b0: 7374 7328 7363 7269 7074 293a 0a20 2020  sts(script):.   
+0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9d0: 2065 7272 6f72 2866 2253 6372 6970 7420   error(f"Script 
+0000b9e0: 6669 6c65 207b 7363 7269 7074 7d20 6e6f  file {script} no
+0000b9f0: 7420 666f 756e 6422 290a 2020 2020 2020  t found").      
+0000ba00: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0000ba10: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+0000ba20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba40: 2020 2020 7363 7269 7074 6261 7365 6469      scriptbasedi
+0000ba50: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+0000ba60: 616d 6528 7363 7269 7074 2920 6966 206f  ame(script) if o
+0000ba70: 732e 7061 7468 2e64 6972 6e61 6d65 2873  s.path.dirname(s
+0000ba80: 6372 6970 7429 2021 3d20 2727 2065 6c73  cript) != '' els
+0000ba90: 6520 272e 270a 2020 2020 2020 2020 2020  e '.'.          
+0000baa0: 2020 2020 2020 2020 2020 656e 7620 3d20            env = 
+0000bab0: 456e 7669 726f 6e6d 656e 7428 6c6f 6164  Environment(load
+0000bac0: 6572 3d46 696c 6553 7973 7465 6d4c 6f61  er=FileSystemLoa
+0000bad0: 6465 7228 7363 7269 7074 6261 7365 6469  der(scriptbasedi
+0000bae0: 7229 2c20 756e 6465 6669 6e65 643d 756e  r), undefined=un
+0000baf0: 6465 6669 6e65 642c 0a20 2020 2020 2020  defined,.       
+0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000bb20: 7874 656e 7369 6f6e 733d 5b27 6a69 6e6a  xtensions=['jinj
+0000bb30: 6132 2e65 7874 2e64 6f27 5d2c 2074 7269  a2.ext.do'], tri
+0000bb40: 6d5f 626c 6f63 6b73 3d54 7275 652c 206c  m_blocks=True, l
+0000bb50: 7374 7269 705f 626c 6f63 6b73 3d54 7275  strip_blocks=Tru
+0000bb60: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0000bb70: 2020 2020 2020 2066 6f72 206a 696e 6a61         for jinja
+0000bb80: 6669 6c74 6572 2069 6e20 6a69 6e6a 6166  filter in jinjaf
+0000bb90: 696c 7465 7273 2e6a 696e 6a61 6669 6c74  ilters.jinjafilt
+0000bba0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+0000bbb0: 2020 2020 2020 2020 2020 2020 2065 6e76               env
+0000bbc0: 2e66 696c 7465 7273 5b6a 696e 6a61 6669  .filters[jinjafi
+0000bbd0: 6c74 6572 5d20 3d20 6a69 6e6a 6166 696c  lter] = jinjafil
+0000bbe0: 7465 7273 2e6a 696e 6a61 6669 6c74 6572  ters.jinjafilter
+0000bbf0: 735b 6a69 6e6a 6166 696c 7465 725d 0a20  s[jinjafilter]. 
+0000bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
 0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc30: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000bc40: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000bc50: 656d 706c 203d 2065 6e76 2e67 6574 5f74  empl = env.get_t
-0000bc60: 656d 706c 6174 6528 6f73 2e70 6174 682e  emplate(os.path.
-0000bc70: 6261 7365 6e61 6d65 2873 6372 6970 7429  basename(script)
-0000bc80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bc90: 2020 2020 2020 2020 2020 7363 7269 7074            script
-0000bca0: 656e 7472 6965 7320 3d20 7465 6d70 6c2e  entries = templ.
-0000bcb0: 7265 6e64 6572 286f 7665 7272 6964 6573  render(overrides
-0000bcc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bcd0: 2020 2020 2020 6578 6365 7074 2054 656d        except Tem
-0000bce0: 706c 6174 654e 6f74 466f 756e 643a 0a20  plateNotFound:. 
-0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd00: 2020 2020 2020 2065 7272 6f72 2866 2253         error(f"S
-0000bd10: 6372 6970 7420 6669 6c65 207b 6f73 2e70  cript file {os.p
-0000bd20: 6174 682e 6261 7365 6e61 6d65 2873 6372  ath.basename(scr
-0000bd30: 6970 7429 7d20 6e6f 7420 666f 756e 6422  ipt)} not found"
-0000bd40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bd50: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-0000bd60: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-0000bd70: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000bd80: 2054 656d 706c 6174 6553 796e 7461 7845   TemplateSyntaxE
-0000bd90: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdb0: 2020 206d 7367 203d 2066 2245 7272 6f72     msg = f"Error
-0000bdc0: 2072 656e 6465 7269 6e67 206c 696e 6520   rendering line 
-0000bdd0: 7b65 2e6c 696e 656e 6f7d 206f 6620 7363  {e.lineno} of sc
-0000bde0: 7269 7074 2066 696c 6520 7b65 2e66 696c  ript file {e.fil
-0000bdf0: 656e 616d 657d 2e20 476f 743a 207b 652e  ename}. Got: {e.
-0000be00: 6d65 7373 6167 657d 220a 2020 2020 2020  message}".      
-0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be20: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-0000be30: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
-0000be40: 7265 6173 6f6e 273a 206d 7367 7d0a 2020  reason': msg}.  
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 6578 6365 7074 2054 656d 706c 6174    except Templat
-0000be70: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0000be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be90: 2020 2020 206d 7367 203d 2066 2245 7272       msg = f"Err
-0000bea0: 6f72 2072 656e 6465 7269 6e67 2073 6372  or rendering scr
-0000beb0: 6970 7420 6669 6c65 207b 7363 7269 7074  ipt file {script
-0000bec0: 7d2e 2047 6f74 3a20 7b65 2e6d 6573 7361  }. Got: {e.messa
-0000bed0: 6765 7d22 0a20 2020 2020 2020 2020 2020  ge}".           
-0000bee0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000bef0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-0000bf00: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
-0000bf10: 6e27 3a20 6d73 677d 0a20 2020 2020 2020  n': msg}.       
-0000bf20: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-0000bf30: 6970 746c 696e 6573 203d 205b 6c69 6e65  iptlines = [line
-0000bf40: 2e73 7472 6970 2829 2066 6f72 206c 696e  .strip() for lin
-0000bf50: 6520 696e 2073 6372 6970 7465 6e74 7269  e in scriptentri
-0000bf60: 6573 2e73 706c 6974 2827 5c6e 2729 2069  es.split('\n') i
-0000bf70: 6620 6c69 6e65 2e73 7472 6970 2829 2021  f line.strip() !
-0000bf80: 3d20 2727 5d0a 2020 2020 2020 2020 2020  = ''].          
-0000bf90: 2020 2020 2020 2020 2020 6966 2073 6372            if scr
-0000bfa0: 6970 746c 696e 6573 3a0a 2020 2020 2020  iptlines:.      
-0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfc0: 2020 7363 7269 7074 6c69 6e65 732e 696e    scriptlines.in
-0000bfd0: 7365 7274 2830 2c20 6622 6563 686f 2052  sert(0, f"echo R
-0000bfe0: 756e 6e69 6e67 2073 6372 6970 7420 7b6f  unning script {o
-0000bff0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0000c000: 7363 7269 7074 297d 2229 0a20 2020 2020  script)}").     
-0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c020: 2020 2073 6372 6970 7463 6d64 732e 6578     scriptcmds.ex
-0000c030: 7465 6e64 2873 6372 6970 746c 696e 6573  tend(scriptlines
-0000c040: 290a 2020 2020 2020 2020 6966 2063 6c6f  ).        if clo
-0000c050: 7564 696e 6974 2061 6e64 2069 6d61 6765  udinit and image
-0000c060: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000c070: 2027 7268 656c 2720 696e 2069 6d61 6765   'rhel' in image
-0000c080: 2e6c 6f77 6572 2829 3a0a 2020 2020 2020  .lower():.      
-0000c090: 2020 2020 2020 7268 6e63 6f6d 6d61 6e64        rhncommand
-0000c0a0: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-0000c0b0: 2020 2069 6620 7268 6e73 6572 7665 7220     if rhnserver 
-0000c0c0: 213d 2022 6874 7470 733a 2f2f 7375 6273  != "https://subs
-0000c0d0: 6372 6970 7469 6f6e 2e72 6873 6d2e 7265  cription.rhsm.re
-0000c0e0: 6468 6174 2e63 6f6d 2220 616e 6420 6e6f  dhat.com" and no
-0000c0f0: 7420 7661 6c69 645f 6970 2872 686e 7365  t valid_ip(rhnse
-0000c100: 7276 6572 293a 0a20 2020 2020 2020 2020  rver):.         
-0000c110: 2020 2020 2020 2066 7164 6e20 3d20 6f73         fqdn = os
-0000c120: 2e70 6174 682e 6261 7365 6e61 6d65 2872  .path.basename(r
-0000c130: 686e 7365 7276 6572 290a 2020 2020 2020  hnserver).      
-0000c140: 2020 2020 2020 2020 2020 7268 6e63 6f6d            rhncom
-0000c150: 6d61 6e64 732e 6170 7065 6e64 2866 2772  mands.append(f'r
-0000c160: 706d 202d 5576 6820 6874 7470 3a2f 2f7b  pm -Uvh http://{
-0000c170: 6671 646e 7d2f 7075 622f 6b61 7465 6c6c  fqdn}/pub/katell
-0000c180: 6f2d 6361 2d63 6f6e 7375 6d65 722d 6c61  o-ca-consumer-la
-0000c190: 7465 7374 2e6e 6f61 7263 682e 7270 6d27  test.noarch.rpm'
-0000c1a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000c1b0: 2072 686e 616b 2069 7320 6e6f 7420 4e6f   rhnak is not No
-0000c1c0: 6e65 2061 6e64 2072 686e 6f72 6720 6973  ne and rhnorg is
-0000c1d0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000c1e0: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
-0000c1f0: 6d6d 616e 6473 2e61 7070 656e 6428 2773  mmands.append('s
-0000c200: 7562 7363 7269 7074 696f 6e2d 6d61 6e61  ubscription-mana
-0000c210: 6765 7220 7265 6769 7374 6572 202d 2d73  ger register --s
-0000c220: 6572 7665 7275 726c 3d25 7320 2d2d 666f  erverurl=%s --fo
-0000c230: 7263 6520 2d2d 6163 7469 7661 7469 6f6e  rce --activation
-0000c240: 6b65 793d 2573 202d 2d6f 7267 3d25 7327  key=%s --org=%s'
-0000c250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c270: 2020 2020 2520 2872 686e 7365 7276 6572      % (rhnserver
-0000c280: 2c20 7268 6e61 6b2c 2072 686e 6f72 6729  , rhnak, rhnorg)
-0000c290: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c2a0: 2020 6966 2069 6d61 6765 2e73 7461 7274    if image.start
-0000c2b0: 7377 6974 6828 2772 6865 6c2d 3827 2920  swith('rhel-8') 
-0000c2c0: 6f72 2069 6d61 6765 203d 3d20 2772 6865  or image == 'rhe
-0000c2d0: 6c38 273a 0a20 2020 2020 2020 2020 2020  l8':.           
-0000c2e0: 2020 2020 2020 2020 2072 686e 636f 6d6d           rhncomm
-0000c2f0: 616e 6473 2e61 7070 656e 6428 2773 7562  ands.append('sub
-0000c300: 7363 7269 7074 696f 6e2d 6d61 6e61 6765  scription-manage
-0000c310: 7220 7265 706f 7320 2d2d 656e 6162 6c65  r repos --enable
-0000c320: 3d72 6865 6c2d 382d 666f 722d 7838 365f  =rhel-8-for-x86_
-0000c330: 3634 2d62 6173 656f 732d 7270 6d73 2729  64-baseos-rpms')
-0000c340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c350: 2065 6c69 6620 696d 6167 652e 7374 6172   elif image.star
-0000c360: 7473 7769 7468 2827 7268 656c 2d73 6572  tswith('rhel-ser
-0000c370: 7665 722d 3727 2920 6f72 2069 6d61 6765  ver-7') or image
-0000c380: 203d 3d20 2772 6865 6c37 273a 0a20 2020   == 'rhel7':.   
-0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3a0: 2072 686e 636f 6d6d 616e 6473 2e61 7070   rhncommands.app
-0000c3b0: 656e 6428 2773 7562 7363 7269 7074 696f  end('subscriptio
-0000c3c0: 6e2d 6d61 6e61 6765 7220 7265 706f 7320  n-manager repos 
-0000c3d0: 2d2d 656e 6162 6c65 3d72 6865 6c2d 372d  --enable=rhel-7-
-0000c3e0: 7365 7276 6572 2d72 706d 7327 290a 2020  server-rpms').  
-0000c3f0: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-0000c400: 686e 7573 6572 2069 7320 6e6f 7420 4e6f  hnuser is not No
-0000c410: 6e65 2061 6e64 2072 686e 7061 7373 776f  ne and rhnpasswo
-0000c420: 7264 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rd is not None:.
-0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c440: 7268 6e63 6f6d 6d61 6e64 732e 6170 7065  rhncommands.appe
-0000c450: 6e64 2827 7375 6273 6372 6970 7469 6f6e  nd('subscription
-0000c460: 2d6d 616e 6167 6572 2072 6567 6973 7465  -manager registe
-0000c470: 7220 2d2d 7365 7276 6572 7572 6c3d 2573  r --serverurl=%s
-0000c480: 202d 2d66 6f72 6365 202d 2d75 7365 726e   --force --usern
-0000c490: 616d 653d 2573 202d 2d70 6173 7377 6f72  ame=%s --passwor
-0000c4a0: 643d 2573 270a 2020 2020 2020 2020 2020  d=%s'.          
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2020 2020 2025 2028 7268 6e73           % (rhns
-0000c4d0: 6572 7665 722c 2072 686e 7573 6572 2c20  erver, rhnuser, 
-0000c4e0: 7268 6e70 6173 7377 6f72 6429 290a 2020  rhnpassword)).  
-0000c4f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000c500: 2072 686e 706f 6f6c 2069 7320 6e6f 7420   rhnpool is not 
-0000c510: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000c520: 2020 2020 2020 2020 2020 7268 6e63 6f6d            rhncom
-0000c530: 6d61 6e64 732e 6170 7065 6e64 2866 2773  mands.append(f's
-0000c540: 7562 7363 7269 7074 696f 6e2d 6d61 6e61  ubscription-mana
-0000c550: 6765 7220 6174 7461 6368 202d 2d70 6f6f  ger attach --poo
-0000c560: 6c3d 7b72 686e 706f 6f6c 7d27 290a 2020  l={rhnpool}').  
-0000c570: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000c580: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000c590: 2020 2020 2020 2020 7268 6e63 6f6d 6d61          rhncomma
-0000c5a0: 6e64 732e 6170 7065 6e64 2827 7375 6273  nds.append('subs
-0000c5b0: 6372 6970 7469 6f6e 2d6d 616e 6167 6572  cription-manager
-0000c5c0: 2061 7474 6163 6820 2d2d 6175 746f 2729   attach --auto')
-0000c5d0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000c5e0: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
-0000c5f0: 6d6d 616e 6473 203d 205b 5d0a 2020 2020  mmands = [].    
-0000c600: 2020 2020 7368 6172 6564 666f 6c64 6572      sharedfolder
-0000c610: 636d 6473 203d 205b 5d0a 2020 2020 2020  cmds = [].      
-0000c620: 2020 6966 2073 6861 7265 6466 6f6c 6465    if sharedfolde
-0000c630: 7273 2061 6e64 2073 656c 662e 7479 7065  rs and self.type
-0000c640: 203d 3d20 276b 766d 273a 0a20 2020 2020   == 'kvm':.     
-0000c650: 2020 2020 2020 2066 6f72 2073 6861 7265         for share
-0000c660: 6466 6f6c 6465 7220 696e 2073 6861 7265  dfolder in share
-0000c670: 6466 6f6c 6465 7273 3a0a 2020 2020 2020  dfolders:.      
-0000c680: 2020 2020 2020 2020 2020 6261 7365 666f            basefo
-0000c690: 6c64 6572 203d 206f 732e 7061 7468 2e62  lder = os.path.b
-0000c6a0: 6173 656e 616d 6528 7368 6172 6564 666f  asename(sharedfo
-0000c6b0: 6c64 6572 290a 2020 2020 2020 2020 2020  lder).          
-0000c6c0: 2020 2020 2020 636d 6431 203d 2066 226d        cmd1 = f"m
-0000c6d0: 6b64 6972 202d 7020 2f6d 6e74 2f7b 7368  kdir -p /mnt/{sh
-0000c6e0: 6172 6564 666f 6c64 6572 7d22 0a20 2020  aredfolder}".   
-0000c6f0: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-0000c700: 3220 3d20 6622 6563 686f 207b 6261 7365  2 = f"echo {base
-0000c710: 666f 6c64 6572 7d20 2f6d 6e74 2f7b 7368  folder} /mnt/{sh
-0000c720: 6172 6564 666f 6c64 6572 7d20 3970 2074  aredfolder} 9p t
-0000c730: 7261 6e73 3d76 6972 7469 6f2c 7665 7273  rans=virtio,vers
-0000c740: 696f 6e3d 3970 3230 3030 2e4c 2c72 7720  ion=9p2000.L,rw 
-0000c750: 3020 3020 3e3e 202f 6574 632f 6673 7461  0 0 >> /etc/fsta
-0000c760: 6222 0a20 2020 2020 2020 2020 2020 2020  b".             
-0000c770: 2020 2073 6861 7265 6466 6f6c 6465 7263     sharedfolderc
-0000c780: 6d64 732e 6170 7065 6e64 2863 6d64 3129  mds.append(cmd1)
-0000c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c7a0: 2073 6861 7265 6466 6f6c 6465 7263 6d64   sharedfoldercmd
-0000c7b0: 732e 6170 7065 6e64 2863 6d64 3229 0a20  s.append(cmd2). 
-0000c7c0: 2020 2020 2020 2069 6620 7368 6172 6564         if shared
-0000c7d0: 666f 6c64 6572 636d 6473 3a0a 2020 2020  foldercmds:.    
-0000c7e0: 2020 2020 2020 2020 7368 6172 6564 666f          sharedfo
-0000c7f0: 6c64 6572 636d 6473 2e61 7070 656e 6428  ldercmds.append(
-0000c800: 226d 6f75 6e74 202d 6122 290a 2020 2020  "mount -a").    
-0000c810: 2020 2020 7a65 726f 7469 6572 636d 6473      zerotiercmds
-0000c820: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
-0000c830: 207a 6572 6f74 6965 725f 6e65 7473 3a0a   zerotier_nets:.
-0000c840: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000c850: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-0000c860: 2061 6e64 2063 6f6d 6d6f 6e2e 6e65 6564   and common.need
-0000c870: 735f 6967 6e69 7469 6f6e 2869 6d61 6765  s_ignition(image
-0000c880: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000c890: 2020 207a 6572 6f74 6965 725f 6a6f 696e     zerotier_join
-0000c8a0: 203d 2027 3b27 2e6a 6f69 6e28 5b27 207a   = ';'.join([' z
-0000c8b0: 6572 6f74 6965 722d 636c 6920 6a6f 696e  erotier-cli join
-0000c8c0: 2025 7320 2720 2520 656e 7472 7920 666f   %s ' % entry fo
-0000c8d0: 7220 656e 7472 7920 696e 207a 6572 6f74  r entry in zerot
-0000c8e0: 6965 725f 6e65 7473 5d29 0a20 2020 2020  ier_nets]).     
-0000c8f0: 2020 2020 2020 2020 2020 207a 6572 6f74             zerot
-0000c900: 6965 725f 6b75 6265 6c65 745f 7363 7269  ier_kubelet_scri
-0000c910: 7074 203d 207a 6572 6f74 6965 725f 6b75  pt = zerotier_ku
-0000c920: 6265 6c65 745f 6461 7461 2069 6620 7a65  belet_data if ze
-0000c930: 726f 7469 6572 5f6b 7562 656c 6574 2065  rotier_kubelet e
-0000c940: 6c73 6520 2727 0a20 2020 2020 2020 2020  lse ''.         
-0000c950: 2020 2020 2020 207a 6572 6f74 6965 7263         zerotierc
-0000c960: 6f6e 7465 6e74 203d 207a 6572 6f74 6965  ontent = zerotie
-0000c970: 725f 7365 7276 6963 652e 666f 726d 6174  r_service.format
-0000c980: 287a 6572 6f74 6965 725f 6a6f 696e 3d7a  (zerotier_join=z
-0000c990: 6572 6f74 6965 725f 6a6f 696e 2c0a 2020  erotier_join,.  
+0000bc30: 7465 6d70 6c20 3d20 656e 762e 6765 745f  templ = env.get_
+0000bc40: 7465 6d70 6c61 7465 286f 732e 7061 7468  template(os.path
+0000bc50: 2e62 6173 656e 616d 6528 7363 7269 7074  .basename(script
+0000bc60: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000bc70: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
+0000bc80: 7465 6e74 7269 6573 203d 2074 656d 706c  tentries = templ
+0000bc90: 2e72 656e 6465 7228 6f76 6572 7269 6465  .render(override
+0000bca0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000bcb0: 2020 2020 2020 2065 7863 6570 7420 5465         except Te
+0000bcc0: 6d70 6c61 7465 4e6f 7446 6f75 6e64 3a0a  mplateNotFound:.
+0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bce0: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+0000bcf0: 5363 7269 7074 2066 696c 6520 7b6f 732e  Script file {os.
+0000bd00: 7061 7468 2e62 6173 656e 616d 6528 7363  path.basename(sc
+0000bd10: 7269 7074 297d 206e 6f74 2066 6f75 6e64  ript)} not found
+0000bd20: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000bd30: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+0000bd40: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+0000bd50: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000bd60: 7420 5465 6d70 6c61 7465 5379 6e74 6178  t TemplateSyntax
+0000bd70: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd90: 2020 2020 6d73 6720 3d20 6622 4572 726f      msg = f"Erro
+0000bda0: 7220 7265 6e64 6572 696e 6720 6c69 6e65  r rendering line
+0000bdb0: 207b 652e 6c69 6e65 6e6f 7d20 6f66 2073   {e.lineno} of s
+0000bdc0: 6372 6970 7420 6669 6c65 207b 652e 6669  cript file {e.fi
+0000bdd0: 6c65 6e61 6d65 7d2e 2047 6f74 3a20 7b65  lename}. Got: {e
+0000bde0: 2e6d 6573 7361 6765 7d22 0a20 2020 2020  .message}".     
+0000bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be00: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+0000be10: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+0000be20: 2772 6561 736f 6e27 3a20 6d73 677d 0a20  'reason': msg}. 
+0000be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be40: 2020 2065 7863 6570 7420 5465 6d70 6c61     except Templa
+0000be50: 7465 4572 726f 7220 6173 2065 3a0a 2020  teError as e:.  
+0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be70: 2020 2020 2020 6d73 6720 3d20 6622 4572        msg = f"Er
+0000be80: 726f 7220 7265 6e64 6572 696e 6720 7363  ror rendering sc
+0000be90: 7269 7074 2066 696c 6520 7b73 6372 6970  ript file {scrip
+0000bea0: 747d 2e20 476f 743a 207b 652e 6d65 7373  t}. Got: {e.mess
+0000beb0: 6167 657d 220a 2020 2020 2020 2020 2020  age}".          
+0000bec0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000bed0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0000bee0: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+0000bef0: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0000bf10: 7269 7074 6c69 6e65 7320 3d20 5b6c 696e  riptlines = [lin
+0000bf20: 652e 7374 7269 7028 2920 666f 7220 6c69  e.strip() for li
+0000bf30: 6e65 2069 6e20 7363 7269 7074 656e 7472  ne in scriptentr
+0000bf40: 6965 732e 7370 6c69 7428 275c 6e27 2920  ies.split('\n') 
+0000bf50: 6966 206c 696e 652e 7374 7269 7028 2920  if line.strip() 
+0000bf60: 213d 2027 275d 0a20 2020 2020 2020 2020  != ''].         
+0000bf70: 2020 2020 2020 2020 2020 2069 6620 7363             if sc
+0000bf80: 7269 7074 6c69 6e65 733a 0a20 2020 2020  riptlines:.     
+0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfa0: 2020 2073 6372 6970 746c 696e 6573 2e69     scriptlines.i
+0000bfb0: 6e73 6572 7428 302c 2066 2265 6368 6f20  nsert(0, f"echo 
+0000bfc0: 5275 6e6e 696e 6720 7363 7269 7074 207b  Running script {
+0000bfd0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0000bfe0: 2873 6372 6970 7429 7d22 290a 2020 2020  (script)}").    
+0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c000: 2020 2020 7363 7269 7074 636d 6473 2e65      scriptcmds.e
+0000c010: 7874 656e 6428 7363 7269 7074 6c69 6e65  xtend(scriptline
+0000c020: 7329 0a20 2020 2020 2020 2069 6620 636c  s).        if cl
+0000c030: 6f75 6469 6e69 7420 616e 6420 696d 6167  oudinit and imag
+0000c040: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+0000c050: 6420 2772 6865 6c27 2069 6e20 696d 6167  d 'rhel' in imag
+0000c060: 652e 6c6f 7765 7228 293a 0a20 2020 2020  e.lower():.     
+0000c070: 2020 2020 2020 2072 686e 636f 6d6d 616e         rhncomman
+0000c080: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
+0000c090: 2020 2020 6966 2072 686e 7365 7276 6572      if rhnserver
+0000c0a0: 2021 3d20 2268 7474 7073 3a2f 2f73 7562   != "https://sub
+0000c0b0: 7363 7269 7074 696f 6e2e 7268 736d 2e72  scription.rhsm.r
+0000c0c0: 6564 6861 742e 636f 6d22 2061 6e64 206e  edhat.com" and n
+0000c0d0: 6f74 2076 616c 6964 5f69 7028 7268 6e73  ot valid_ip(rhns
+0000c0e0: 6572 7665 7229 3a0a 2020 2020 2020 2020  erver):.        
+0000c0f0: 2020 2020 2020 2020 6671 646e 203d 206f          fqdn = o
+0000c100: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0000c110: 7268 6e73 6572 7665 7229 0a20 2020 2020  rhnserver).     
+0000c120: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
+0000c130: 6d6d 616e 6473 2e61 7070 656e 6428 6627  mmands.append(f'
+0000c140: 7270 6d20 2d55 7668 2068 7474 703a 2f2f  rpm -Uvh http://
+0000c150: 7b66 7164 6e7d 2f70 7562 2f6b 6174 656c  {fqdn}/pub/katel
+0000c160: 6c6f 2d63 612d 636f 6e73 756d 6572 2d6c  lo-ca-consumer-l
+0000c170: 6174 6573 742e 6e6f 6172 6368 2e72 706d  atest.noarch.rpm
+0000c180: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
+0000c190: 6620 7268 6e61 6b20 6973 206e 6f74 204e  f rhnak is not N
+0000c1a0: 6f6e 6520 616e 6420 7268 6e6f 7267 2069  one and rhnorg i
+0000c1b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000c1c0: 2020 2020 2020 2020 2020 2020 7268 6e63              rhnc
+0000c1d0: 6f6d 6d61 6e64 732e 6170 7065 6e64 2827  ommands.append('
+0000c1e0: 7375 6273 6372 6970 7469 6f6e 2d6d 616e  subscription-man
+0000c1f0: 6167 6572 2072 6567 6973 7465 7220 2d2d  ager register --
+0000c200: 7365 7276 6572 7572 6c3d 2573 202d 2d66  serverurl=%s --f
+0000c210: 6f72 6365 202d 2d61 6374 6976 6174 696f  orce --activatio
+0000c220: 6e6b 6579 3d25 7320 2d2d 6f72 673d 2573  nkey=%s --org=%s
+0000c230: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0000c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c250: 2020 2020 2025 2028 7268 6e73 6572 7665       % (rhnserve
+0000c260: 722c 2072 686e 616b 2c20 7268 6e6f 7267  r, rhnak, rhnorg
+0000c270: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000c280: 2020 2069 6620 696d 6167 652e 7374 6172     if image.star
+0000c290: 7473 7769 7468 2827 7268 656c 2d38 2729  tswith('rhel-8')
+0000c2a0: 206f 7220 696d 6167 6520 3d3d 2027 7268   or image == 'rh
+0000c2b0: 656c 3827 3a0a 2020 2020 2020 2020 2020  el8':.          
+0000c2c0: 2020 2020 2020 2020 2020 7268 6e63 6f6d            rhncom
+0000c2d0: 6d61 6e64 732e 6170 7065 6e64 2827 7375  mands.append('su
+0000c2e0: 6273 6372 6970 7469 6f6e 2d6d 616e 6167  bscription-manag
+0000c2f0: 6572 2072 6570 6f73 202d 2d65 6e61 626c  er repos --enabl
+0000c300: 653d 7268 656c 2d38 2d66 6f72 2d78 3836  e=rhel-8-for-x86
+0000c310: 5f36 342d 6261 7365 6f73 2d72 706d 7327  _64-baseos-rpms'
+0000c320: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c330: 2020 656c 6966 2069 6d61 6765 2e73 7461    elif image.sta
+0000c340: 7274 7377 6974 6828 2772 6865 6c2d 7365  rtswith('rhel-se
+0000c350: 7276 6572 2d37 2729 206f 7220 696d 6167  rver-7') or imag
+0000c360: 6520 3d3d 2027 7268 656c 3727 3a0a 2020  e == 'rhel7':.  
+0000c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c380: 2020 7268 6e63 6f6d 6d61 6e64 732e 6170    rhncommands.ap
+0000c390: 7065 6e64 2827 7375 6273 6372 6970 7469  pend('subscripti
+0000c3a0: 6f6e 2d6d 616e 6167 6572 2072 6570 6f73  on-manager repos
+0000c3b0: 202d 2d65 6e61 626c 653d 7268 656c 2d37   --enable=rhel-7
+0000c3c0: 2d73 6572 7665 722d 7270 6d73 2729 0a20  -server-rpms'). 
+0000c3d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000c3e0: 7268 6e75 7365 7220 6973 206e 6f74 204e  rhnuser is not N
+0000c3f0: 6f6e 6520 616e 6420 7268 6e70 6173 7377  one and rhnpassw
+0000c400: 6f72 6420 6973 206e 6f74 204e 6f6e 653a  ord is not None:
+0000c410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c420: 2072 686e 636f 6d6d 616e 6473 2e61 7070   rhncommands.app
+0000c430: 656e 6428 2773 7562 7363 7269 7074 696f  end('subscriptio
+0000c440: 6e2d 6d61 6e61 6765 7220 7265 6769 7374  n-manager regist
+0000c450: 6572 202d 2d73 6572 7665 7275 726c 3d25  er --serverurl=%
+0000c460: 7320 2d2d 666f 7263 6520 2d2d 7573 6572  s --force --user
+0000c470: 6e61 6d65 3d25 7320 2d2d 7061 7373 776f  name=%s --passwo
+0000c480: 7264 3d25 7327 0a20 2020 2020 2020 2020  rd=%s'.         
+0000c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4a0: 2020 2020 2020 2020 2020 2520 2872 686e            % (rhn
+0000c4b0: 7365 7276 6572 2c20 7268 6e75 7365 722c  server, rhnuser,
+0000c4c0: 2072 686e 7061 7373 776f 7264 2929 0a20   rhnpassword)). 
+0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c4e0: 6620 7268 6e70 6f6f 6c20 6973 206e 6f74  f rhnpool is not
+0000c4f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000c500: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
+0000c510: 6d6d 616e 6473 2e61 7070 656e 6428 6627  mmands.append(f'
+0000c520: 7375 6273 6372 6970 7469 6f6e 2d6d 616e  subscription-man
+0000c530: 6167 6572 2061 7474 6163 6820 2d2d 706f  ager attach --po
+0000c540: 6f6c 3d7b 7268 6e70 6f6f 6c7d 2729 0a20  ol={rhnpool}'). 
+0000c550: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c570: 2020 2020 2020 2020 2072 686e 636f 6d6d           rhncomm
+0000c580: 616e 6473 2e61 7070 656e 6428 2773 7562  ands.append('sub
+0000c590: 7363 7269 7074 696f 6e2d 6d61 6e61 6765  scription-manage
+0000c5a0: 7220 6174 7461 6368 202d 2d61 7574 6f27  r attach --auto'
+0000c5b0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000c5c0: 2020 2020 2020 2020 2020 2020 7268 6e63              rhnc
+0000c5d0: 6f6d 6d61 6e64 7320 3d20 5b5d 0a20 2020  ommands = [].   
+0000c5e0: 2020 2020 2073 6861 7265 6466 6f6c 6465       sharedfolde
+0000c5f0: 7263 6d64 7320 3d20 5b5d 0a20 2020 2020  rcmds = [].     
+0000c600: 2020 2069 6620 7368 6172 6564 666f 6c64     if sharedfold
+0000c610: 6572 7320 616e 6420 7365 6c66 2e74 7970  ers and self.typ
+0000c620: 6520 3d3d 2027 6b76 6d27 3a0a 2020 2020  e == 'kvm':.    
+0000c630: 2020 2020 2020 2020 666f 7220 7368 6172          for shar
+0000c640: 6564 666f 6c64 6572 2069 6e20 7368 6172  edfolder in shar
+0000c650: 6564 666f 6c64 6572 733a 0a20 2020 2020  edfolders:.     
+0000c660: 2020 2020 2020 2020 2020 2062 6173 6566             basef
+0000c670: 6f6c 6465 7220 3d20 6f73 2e70 6174 682e  older = os.path.
+0000c680: 6261 7365 6e61 6d65 2873 6861 7265 6466  basename(sharedf
+0000c690: 6f6c 6465 7229 0a20 2020 2020 2020 2020  older).         
+0000c6a0: 2020 2020 2020 2063 6d64 3120 3d20 6622         cmd1 = f"
+0000c6b0: 6d6b 6469 7220 2d70 202f 6d6e 742f 7b73  mkdir -p /mnt/{s
+0000c6c0: 6861 7265 6466 6f6c 6465 727d 220a 2020  haredfolder}".  
+0000c6d0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+0000c6e0: 6432 203d 2066 2265 6368 6f20 7b62 6173  d2 = f"echo {bas
+0000c6f0: 6566 6f6c 6465 727d 202f 6d6e 742f 7b73  efolder} /mnt/{s
+0000c700: 6861 7265 6466 6f6c 6465 727d 2039 7020  haredfolder} 9p 
+0000c710: 7472 616e 733d 7669 7274 696f 2c76 6572  trans=virtio,ver
+0000c720: 7369 6f6e 3d39 7032 3030 302e 4c2c 7277  sion=9p2000.L,rw
+0000c730: 2030 2030 203e 3e20 2f65 7463 2f66 7374   0 0 >> /etc/fst
+0000c740: 6162 220a 2020 2020 2020 2020 2020 2020  ab".            
+0000c750: 2020 2020 7368 6172 6564 666f 6c64 6572      sharedfolder
+0000c760: 636d 6473 2e61 7070 656e 6428 636d 6431  cmds.append(cmd1
+0000c770: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c780: 2020 7368 6172 6564 666f 6c64 6572 636d    sharedfoldercm
+0000c790: 6473 2e61 7070 656e 6428 636d 6432 290a  ds.append(cmd2).
+0000c7a0: 2020 2020 2020 2020 6966 2073 6861 7265          if share
+0000c7b0: 6466 6f6c 6465 7263 6d64 733a 0a20 2020  dfoldercmds:.   
+0000c7c0: 2020 2020 2020 2020 2073 6861 7265 6466           sharedf
+0000c7d0: 6f6c 6465 7263 6d64 732e 6170 7065 6e64  oldercmds.append
+0000c7e0: 2822 6d6f 756e 7420 2d61 2229 0a20 2020  ("mount -a").   
+0000c7f0: 2020 2020 207a 6572 6f74 6965 7263 6d64       zerotiercmd
+0000c800: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
+0000c810: 6620 7a65 726f 7469 6572 5f6e 6574 733a  f zerotier_nets:
+0000c820: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c830: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+0000c840: 6520 616e 6420 636f 6d6d 6f6e 2e6e 6565  e and common.nee
+0000c850: 6473 5f69 676e 6974 696f 6e28 696d 6167  ds_ignition(imag
+0000c860: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0000c870: 2020 2020 7a65 726f 7469 6572 5f6a 6f69      zerotier_joi
+0000c880: 6e20 3d20 273b 272e 6a6f 696e 285b 2720  n = ';'.join([' 
+0000c890: 7a65 726f 7469 6572 2d63 6c69 206a 6f69  zerotier-cli joi
+0000c8a0: 6e20 2573 2027 2025 2065 6e74 7279 2066  n %s ' % entry f
+0000c8b0: 6f72 2065 6e74 7279 2069 6e20 7a65 726f  or entry in zero
+0000c8c0: 7469 6572 5f6e 6574 735d 290a 2020 2020  tier_nets]).    
+0000c8d0: 2020 2020 2020 2020 2020 2020 7a65 726f              zero
+0000c8e0: 7469 6572 5f6b 7562 656c 6574 5f73 6372  tier_kubelet_scr
+0000c8f0: 6970 7420 3d20 7a65 726f 7469 6572 5f6b  ipt = zerotier_k
+0000c900: 7562 656c 6574 5f64 6174 6120 6966 207a  ubelet_data if z
+0000c910: 6572 6f74 6965 725f 6b75 6265 6c65 7420  erotier_kubelet 
+0000c920: 656c 7365 2027 270a 2020 2020 2020 2020  else ''.        
+0000c930: 2020 2020 2020 2020 7a65 726f 7469 6572          zerotier
+0000c940: 636f 6e74 656e 7420 3d20 7a65 726f 7469  content = zeroti
+0000c950: 6572 5f73 6572 7669 6365 2e66 6f72 6d61  er_service.forma
+0000c960: 7428 7a65 726f 7469 6572 5f6a 6f69 6e3d  t(zerotier_join=
+0000c970: 7a65 726f 7469 6572 5f6a 6f69 6e2c 0a20  zerotier_join,. 
+0000c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9d0: 2020 2020 2020 2020 7a65 726f 7469 6572          zerotier
-0000c9e0: 5f6b 7562 656c 6574 5f73 6372 6970 743d  _kubelet_script=
-0000c9f0: 7a65 726f 7469 6572 5f6b 7562 656c 6574  zerotier_kubelet
-0000ca00: 5f73 6372 6970 7429 0a20 2020 2020 2020  _script).       
-0000ca10: 2020 2020 2020 2020 2066 696c 6573 2e61           files.a
-0000ca20: 7070 656e 6428 7b27 7061 7468 273a 2027  ppend({'path': '
-0000ca30: 2f72 6f6f 742f 7a65 726f 7469 6572 2e73  /root/zerotier.s
-0000ca40: 6572 7669 6365 272c 2027 636f 6e74 656e  ervice', 'conten
-0000ca50: 7427 3a20 7a65 726f 7469 6572 636f 6e74  t': zerotiercont
-0000ca60: 656e 747d 290a 2020 2020 2020 2020 2020  ent}).          
-0000ca70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ca80: 2020 2020 2020 2020 7a65 726f 7469 6572          zerotier
-0000ca90: 636d 6473 2e61 7070 656e 6428 2263 7572  cmds.append("cur
-0000caa0: 6c20 2d73 2068 7474 7073 3a2f 2f69 6e73  l -s https://ins
-0000cab0: 7461 6c6c 2e7a 6572 6f74 6965 722e 636f  tall.zerotier.co
-0000cac0: 6d20 7c20 6261 7368 2229 0a20 2020 2020  m | bash").     
-0000cad0: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-0000cae0: 6e74 7279 2069 6e20 7a65 726f 7469 6572  ntry in zerotier
-0000caf0: 5f6e 6574 733a 0a20 2020 2020 2020 2020  _nets:.         
-0000cb00: 2020 2020 2020 2020 2020 207a 6572 6f74             zerot
-0000cb10: 6965 7263 6d64 732e 6170 7065 6e64 2866  iercmds.append(f
-0000cb20: 227a 6572 6f74 6965 722d 636c 6920 6a6f  "zerotier-cli jo
-0000cb30: 696e 207b 656e 7472 797d 2229 0a20 2020  in {entry}").   
-0000cb40: 2020 2020 206e 6574 776f 726b 7761 6974       networkwait
-0000cb50: 636f 6d6d 616e 6420 3d20 5b66 2773 6c65  command = [f'sle
-0000cb60: 6570 207b 6e65 7477 6f72 6b77 6169 747d  ep {networkwait}
-0000cb70: 275d 2069 6620 6e65 7477 6f72 6b77 6169  '] if networkwai
-0000cb80: 7420 3e20 3020 656c 7365 205b 5d0a 2020  t > 0 else [].  
-0000cb90: 2020 2020 2020 726f 6f74 636f 6d6d 616e        rootcomman
-0000cba0: 6420 3d20 5b66 2765 6368 6f20 726f 6f74  d = [f'echo root
-0000cbb0: 3a7b 726f 6f74 7061 7373 776f 7264 7d20  :{rootpassword} 
-0000cbc0: 7c20 6368 7061 7373 7764 275d 2069 6620  | chpasswd'] if 
-0000cbd0: 726f 6f74 7061 7373 776f 7264 2069 7320  rootpassword is 
-0000cbe0: 6e6f 7420 4e6f 6e65 2065 6c73 6520 5b5d  not None else []
-0000cbf0: 0a20 2020 2020 2020 2063 6d64 7320 3d20  .        cmds = 
-0000cc00: 726f 6f74 636f 6d6d 616e 6420 2b20 6e65  rootcommand + ne
-0000cc10: 7477 6f72 6b77 6169 7463 6f6d 6d61 6e64  tworkwaitcommand
-0000cc20: 202b 2072 686e 636f 6d6d 616e 6473 202b   + rhncommands +
-0000cc30: 2073 6861 7265 6466 6f6c 6465 7263 6d64   sharedfoldercmd
-0000cc40: 7320 2b20 7a65 726f 7469 6572 636d 6473  s + zerotiercmds
-0000cc50: 202b 2063 6d64 7320 2b20 7363 7269 7074   + cmds + script
-0000cc60: 636d 6473 0a20 2020 2020 2020 2069 6620  cmds.        if 
-0000cc70: 6e6f 7469 6679 2061 6e64 2069 6d61 6765  notify and image
-0000cc80: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000cc90: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000cca0: 6966 7963 6d64 2069 7320 4e6f 6e65 2061  ifycmd is None a
-0000ccb0: 6e64 206e 6f74 6966 7973 6372 6970 7420  nd notifyscript 
-0000ccc0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000ccd0: 2020 2020 2020 2020 2069 6620 2763 6f73           if 'cos
-0000cce0: 2720 696e 2069 6d61 6765 3a0a 2020 2020  ' in image:.    
-0000ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd00: 6e6f 7469 6679 636d 6420 3d20 276a 6f75  notifycmd = 'jou
-0000cd10: 726e 616c 6374 6c20 2d2d 6964 656e 7469  rnalctl --identi
-0000cd20: 6669 6572 3d69 676e 6974 696f 6e20 2d2d  fier=ignition --
-0000cd30: 616c 6c20 2d2d 6e6f 2d70 6167 6572 270a  all --no-pager'.
-0000cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000cd60: 2020 2020 2020 2020 2020 636c 6f75 6469            cloudi
-0000cd70: 6e69 7466 696c 6520 3d20 636f 6d6d 6f6e  nitfile = common
-0000cd80: 2e67 6574 5f63 6c6f 7564 696e 6974 6669  .get_cloudinitfi
-0000cd90: 6c65 2869 6d61 6765 290a 2020 2020 2020  le(image).      
-0000cda0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0000cdb0: 7469 6679 636d 6420 3d20 2274 6169 6c20  tifycmd = "tail 
-0000cdc0: 2d31 3030 2025 7322 2025 2063 6c6f 7564  -100 %s" % cloud
-0000cdd0: 696e 6974 6669 6c65 0a20 2020 2020 2020  initfile.       
-0000cde0: 2020 2020 2069 6620 6e6f 7469 6679 7363       if notifysc
-0000cdf0: 7269 7074 2069 7320 6e6f 7420 4e6f 6e65  ript is not None
-0000ce00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ce10: 2020 6e6f 7469 6679 7363 7269 7074 203d    notifyscript =
-0000ce20: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-0000ce30: 7365 7228 6e6f 7469 6679 7363 7269 7074  ser(notifyscript
-0000ce40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ce50: 2020 6966 2062 6173 6564 6972 2021 3d20    if basedir != 
-0000ce60: 272e 273a 0a20 2020 2020 2020 2020 2020  '.':.           
-0000ce70: 2020 2020 2020 2020 206e 6f74 6966 7973           notifys
-0000ce80: 6372 6970 7420 3d20 6627 7b62 6173 6564  cript = f'{based
-0000ce90: 6972 7d2f 7b6e 6f74 6966 7973 6372 6970  ir}/{notifyscrip
-0000cea0: 747d 270a 2020 2020 2020 2020 2020 2020  t}'.            
-0000ceb0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0000cec0: 7468 2e65 7869 7374 7328 6e6f 7469 6679  th.exists(notify
-0000ced0: 7363 7269 7074 293a 0a20 2020 2020 2020  script):.       
-0000cee0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-0000cef0: 6966 7963 6d64 203d 204e 6f6e 650a 2020  ifycmd = None.  
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf10: 2020 6e6f 7469 6679 7363 7269 7074 203d    notifyscript =
-0000cf20: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000cf30: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000cf40: 6728 6622 4e6f 7469 6669 6361 7469 6f6e  g(f"Notification
-0000cf50: 2072 6571 7569 7265 6420 666f 7220 7b6e   required for {n
-0000cf60: 616d 657d 2062 7574 206d 6973 7369 6e67  ame} but missing
-0000cf70: 206e 6f74 6966 7973 6372 6970 7422 290a   notifyscript").
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000cfa0: 2020 2020 2020 2020 2020 6669 6c65 732e            files.
-0000cfb0: 6170 7065 6e64 287b 2770 6174 6827 3a20  append({'path': 
-0000cfc0: 272f 726f 6f74 2f2e 6e6f 7469 6679 2e73  '/root/.notify.s
-0000cfd0: 6827 2c20 276f 7269 6769 6e27 3a20 6e6f  h', 'origin': no
-0000cfe0: 7469 6679 7363 7269 7074 7d29 0a20 2020  tifyscript}).   
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d000: 206e 6f74 6966 7963 6d64 203d 2022 6261   notifycmd = "ba
-0000d010: 7368 202f 726f 6f74 2f2e 6e6f 7469 6679  sh /root/.notify
-0000d020: 2e73 6822 0a20 2020 2020 2020 2020 2020  .sh".           
-0000d030: 206e 6f74 6966 7963 6d64 732c 206d 6169   notifycmds, mai
-0000d040: 6c63 6f6e 7465 6e74 203d 2073 656c 662e  lcontent = self.
-0000d050: 6861 6e64 6c65 5f6e 6f74 6966 6963 6174  handle_notificat
-0000d060: 696f 6e73 286e 616d 652c 206e 6f74 6966  ions(name, notif
-0000d070: 796d 6574 686f 6473 3d6e 6f74 6966 796d  ymethods=notifym
-0000d080: 6574 686f 6473 2c0a 2020 2020 2020 2020  ethods,.        
+0000c9b0: 2020 2020 2020 2020 207a 6572 6f74 6965           zerotie
+0000c9c0: 725f 6b75 6265 6c65 745f 7363 7269 7074  r_kubelet_script
+0000c9d0: 3d7a 6572 6f74 6965 725f 6b75 6265 6c65  =zerotier_kubele
+0000c9e0: 745f 7363 7269 7074 290a 2020 2020 2020  t_script).      
+0000c9f0: 2020 2020 2020 2020 2020 6669 6c65 732e            files.
+0000ca00: 6170 7065 6e64 287b 2770 6174 6827 3a20  append({'path': 
+0000ca10: 272f 726f 6f74 2f7a 6572 6f74 6965 722e  '/root/zerotier.
+0000ca20: 7365 7276 6963 6527 2c20 2763 6f6e 7465  service', 'conte
+0000ca30: 6e74 273a 207a 6572 6f74 6965 7263 6f6e  nt': zerotiercon
+0000ca40: 7465 6e74 7d29 0a20 2020 2020 2020 2020  tent}).         
+0000ca50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ca60: 2020 2020 2020 2020 207a 6572 6f74 6965           zerotie
+0000ca70: 7263 6d64 732e 6170 7065 6e64 2822 6375  rcmds.append("cu
+0000ca80: 726c 202d 7320 6874 7470 733a 2f2f 696e  rl -s https://in
+0000ca90: 7374 616c 6c2e 7a65 726f 7469 6572 2e63  stall.zerotier.c
+0000caa0: 6f6d 207c 2062 6173 6822 290a 2020 2020  om | bash").    
+0000cab0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000cac0: 656e 7472 7920 696e 207a 6572 6f74 6965  entry in zerotie
+0000cad0: 725f 6e65 7473 3a0a 2020 2020 2020 2020  r_nets:.        
+0000cae0: 2020 2020 2020 2020 2020 2020 7a65 726f              zero
+0000caf0: 7469 6572 636d 6473 2e61 7070 656e 6428  tiercmds.append(
+0000cb00: 6622 7a65 726f 7469 6572 2d63 6c69 206a  f"zerotier-cli j
+0000cb10: 6f69 6e20 7b65 6e74 7279 7d22 290a 2020  oin {entry}").  
+0000cb20: 2020 2020 2020 6e65 7477 6f72 6b77 6169        networkwai
+0000cb30: 7463 6f6d 6d61 6e64 203d 205b 6627 736c  tcommand = [f'sl
+0000cb40: 6565 7020 7b6e 6574 776f 726b 7761 6974  eep {networkwait
+0000cb50: 7d27 5d20 6966 206e 6574 776f 726b 7761  }'] if networkwa
+0000cb60: 6974 203e 2030 2065 6c73 6520 5b5d 0a20  it > 0 else []. 
+0000cb70: 2020 2020 2020 2072 6f6f 7463 6f6d 6d61         rootcomma
+0000cb80: 6e64 203d 205b 6627 6563 686f 2072 6f6f  nd = [f'echo roo
+0000cb90: 743a 7b72 6f6f 7470 6173 7377 6f72 647d  t:{rootpassword}
+0000cba0: 207c 2063 6870 6173 7377 6427 5d20 6966   | chpasswd'] if
+0000cbb0: 2072 6f6f 7470 6173 7377 6f72 6420 6973   rootpassword is
+0000cbc0: 206e 6f74 204e 6f6e 6520 656c 7365 205b   not None else [
+0000cbd0: 5d0a 2020 2020 2020 2020 636d 6473 203d  ].        cmds =
+0000cbe0: 2072 6f6f 7463 6f6d 6d61 6e64 202b 206e   rootcommand + n
+0000cbf0: 6574 776f 726b 7761 6974 636f 6d6d 616e  etworkwaitcomman
+0000cc00: 6420 2b20 7268 6e63 6f6d 6d61 6e64 7320  d + rhncommands 
+0000cc10: 2b20 7368 6172 6564 666f 6c64 6572 636d  + sharedfoldercm
+0000cc20: 6473 202b 207a 6572 6f74 6965 7263 6d64  ds + zerotiercmd
+0000cc30: 7320 2b20 636d 6473 202b 2073 6372 6970  s + cmds + scrip
+0000cc40: 7463 6d64 730a 2020 2020 2020 2020 6966  tcmds.        if
+0000cc50: 206e 6f74 6966 7920 616e 6420 696d 6167   notify and imag
+0000cc60: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0000cc70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000cc80: 7469 6679 636d 6420 6973 204e 6f6e 6520  tifycmd is None 
+0000cc90: 616e 6420 6e6f 7469 6679 7363 7269 7074  and notifyscript
+0000cca0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000ccb0: 2020 2020 2020 2020 2020 6966 2027 636f            if 'co
+0000ccc0: 7327 2069 6e20 696d 6167 653a 0a20 2020  s' in image:.   
+0000ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cce0: 206e 6f74 6966 7963 6d64 203d 2027 6a6f   notifycmd = 'jo
+0000ccf0: 7572 6e61 6c63 746c 202d 2d69 6465 6e74  urnalctl --ident
+0000cd00: 6966 6965 723d 6967 6e69 7469 6f6e 202d  ifier=ignition -
+0000cd10: 2d61 6c6c 202d 2d6e 6f2d 7061 6765 7227  -all --no-pager'
+0000cd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cd30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000cd40: 2020 2020 2020 2020 2020 2063 6c6f 7564             cloud
+0000cd50: 696e 6974 6669 6c65 203d 2063 6f6d 6d6f  initfile = commo
+0000cd60: 6e2e 6765 745f 636c 6f75 6469 6e69 7466  n.get_cloudinitf
+0000cd70: 696c 6528 696d 6167 6529 0a20 2020 2020  ile(image).     
+0000cd80: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000cd90: 6f74 6966 7963 6d64 203d 2022 7461 696c  otifycmd = "tail
+0000cda0: 202d 3130 3020 2573 2220 2520 636c 6f75   -100 %s" % clou
+0000cdb0: 6469 6e69 7466 696c 650a 2020 2020 2020  dinitfile.      
+0000cdc0: 2020 2020 2020 6966 206e 6f74 6966 7973        if notifys
+0000cdd0: 6372 6970 7420 6973 206e 6f74 204e 6f6e  cript is not Non
+0000cde0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000cdf0: 2020 206e 6f74 6966 7973 6372 6970 7420     notifyscript 
+0000ce00: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+0000ce10: 7573 6572 286e 6f74 6966 7973 6372 6970  user(notifyscrip
+0000ce20: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0000ce30: 2020 2069 6620 6261 7365 6469 7220 213d     if basedir !=
+0000ce40: 2027 2e27 3a0a 2020 2020 2020 2020 2020   '.':.          
+0000ce50: 2020 2020 2020 2020 2020 6e6f 7469 6679            notify
+0000ce60: 7363 7269 7074 203d 2066 277b 6261 7365  script = f'{base
+0000ce70: 6469 727d 2f7b 6e6f 7469 6679 7363 7269  dir}/{notifyscri
+0000ce80: 7074 7d27 0a20 2020 2020 2020 2020 2020  pt}'.           
+0000ce90: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+0000cea0: 6174 682e 6578 6973 7473 286e 6f74 6966  ath.exists(notif
+0000ceb0: 7973 6372 6970 7429 3a0a 2020 2020 2020  yscript):.      
+0000cec0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0000ced0: 7469 6679 636d 6420 3d20 4e6f 6e65 0a20  tifycmd = None. 
+0000cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cef0: 2020 206e 6f74 6966 7973 6372 6970 7420     notifyscript 
+0000cf00: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+0000cf10: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0000cf20: 6e67 2866 224e 6f74 6966 6963 6174 696f  ng(f"Notificatio
+0000cf30: 6e20 7265 7175 6972 6564 2066 6f72 207b  n required for {
+0000cf40: 6e61 6d65 7d20 6275 7420 6d69 7373 696e  name} but missin
+0000cf50: 6720 6e6f 7469 6679 7363 7269 7074 2229  g notifyscript")
+0000cf60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cf70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000cf80: 2020 2020 2020 2020 2020 2066 696c 6573             files
+0000cf90: 2e61 7070 656e 6428 7b27 7061 7468 273a  .append({'path':
+0000cfa0: 2027 2f72 6f6f 742f 2e6e 6f74 6966 792e   '/root/.notify.
+0000cfb0: 7368 272c 2027 6f72 6967 696e 273a 206e  sh', 'origin': n
+0000cfc0: 6f74 6966 7973 6372 6970 747d 290a 2020  otifyscript}).  
+0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfe0: 2020 6e6f 7469 6679 636d 6420 3d20 2262    notifycmd = "b
+0000cff0: 6173 6820 2f72 6f6f 742f 2e6e 6f74 6966  ash /root/.notif
+0000d000: 792e 7368 220a 2020 2020 2020 2020 2020  y.sh".          
+0000d010: 2020 6e6f 7469 6679 636d 6473 2c20 6d61    notifycmds, ma
+0000d020: 696c 636f 6e74 656e 7420 3d20 7365 6c66  ilcontent = self
+0000d030: 2e68 616e 646c 655f 6e6f 7469 6669 6361  .handle_notifica
+0000d040: 7469 6f6e 7328 6e61 6d65 2c20 6e6f 7469  tions(name, noti
+0000d050: 6679 6d65 7468 6f64 733d 6e6f 7469 6679  fymethods=notify
+0000d060: 6d65 7468 6f64 732c 0a20 2020 2020 2020  methods,.       
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0c0: 2020 2020 2020 2020 7075 7368 6275 6c6c          pushbull
-0000d0d0: 6574 746f 6b65 6e3d 7075 7368 6275 6c6c  ettoken=pushbull
-0000d0e0: 6574 746f 6b65 6e2c 0a20 2020 2020 2020  ettoken,.       
+0000d0a0: 2020 2020 2020 2020 2070 7573 6862 756c           pushbul
+0000d0b0: 6c65 7474 6f6b 656e 3d70 7573 6862 756c  lettoken=pushbul
+0000d0c0: 6c65 7474 6f6b 656e 2c0a 2020 2020 2020  lettoken,.      
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d120: 2020 2020 2020 2020 206e 6f74 6966 7973           notifys
-0000d130: 6372 6970 743d 6e6f 7469 6679 7363 7269  cript=notifyscri
-0000d140: 7074 2c20 6e6f 7469 6679 636d 643d 6e6f  pt, notifycmd=no
-0000d150: 7469 6679 636d 642c 0a20 2020 2020 2020  tifycmd,.       
+0000d100: 2020 2020 2020 2020 2020 6e6f 7469 6679            notify
+0000d110: 7363 7269 7074 3d6e 6f74 6966 7973 6372  script=notifyscr
+0000d120: 6970 742c 206e 6f74 6966 7963 6d64 3d6e  ipt, notifycmd=n
+0000d130: 6f74 6966 7963 6d64 2c0a 2020 2020 2020  otifycmd,.      
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d190: 2020 2020 2020 2020 2073 6c61 636b 6368           slackch
-0000d1a0: 616e 6e65 6c3d 736c 6163 6b63 6861 6e6e  annel=slackchann
-0000d1b0: 656c 2c20 736c 6163 6b74 6f6b 656e 3d73  el, slacktoken=s
-0000d1c0: 6c61 636b 746f 6b65 6e2c 0a20 2020 2020  lacktoken,.     
+0000d170: 2020 2020 2020 2020 2020 736c 6163 6b63            slackc
+0000d180: 6861 6e6e 656c 3d73 6c61 636b 6368 616e  hannel=slackchan
+0000d190: 6e65 6c2c 2073 6c61 636b 746f 6b65 6e3d  nel, slacktoken=
+0000d1a0: 736c 6163 6b74 6f6b 656e 2c0a 2020 2020  slacktoken,.    
+0000d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d200: 2020 2020 2020 2020 2020 206d 6169 6c73             mails
-0000d210: 6572 7665 723d 6d61 696c 7365 7276 6572  erver=mailserver
-0000d220: 2c20 6d61 696c 6672 6f6d 3d6d 6169 6c66  , mailfrom=mailf
-0000d230: 726f 6d2c 206d 6169 6c74 6f3d 6d61 696c  rom, mailto=mail
-0000d240: 746f 290a 2020 2020 2020 2020 2020 2020  to).            
-0000d250: 6966 206d 6169 6c63 6f6e 7465 6e74 2069  if mailcontent i
-0000d260: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000d270: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000d280: 732e 6170 7065 6e64 287b 2770 6174 6827  s.append({'path'
-0000d290: 3a20 272f 7661 722f 746d 702f 6d61 696c  : '/var/tmp/mail
-0000d2a0: 2e74 7874 272c 2027 636f 6e74 656e 7427  .txt', 'content'
-0000d2b0: 3a20 6d61 696c 636f 6e74 656e 747d 290a  : mailcontent}).
+0000d1e0: 2020 2020 2020 2020 2020 2020 6d61 696c              mail
+0000d1f0: 7365 7276 6572 3d6d 6169 6c73 6572 7665  server=mailserve
+0000d200: 722c 206d 6169 6c66 726f 6d3d 6d61 696c  r, mailfrom=mail
+0000d210: 6672 6f6d 2c20 6d61 696c 746f 3d6d 6169  from, mailto=mai
+0000d220: 6c74 6f29 0a20 2020 2020 2020 2020 2020  lto).           
+0000d230: 2069 6620 6d61 696c 636f 6e74 656e 7420   if mailcontent 
+0000d240: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000d250: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000d260: 6573 2e61 7070 656e 6428 7b27 7061 7468  es.append({'path
+0000d270: 273a 2027 2f76 6172 2f74 6d70 2f6d 6169  ': '/var/tmp/mai
+0000d280: 6c2e 7478 7427 2c20 2763 6f6e 7465 6e74  l.txt', 'content
+0000d290: 273a 206d 6169 6c63 6f6e 7465 6e74 7d29  ': mailcontent})
+0000d2a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d2b0: 6e6f 7469 6679 636d 6473 3a0a 2020 2020  notifycmds:.    
 0000d2c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000d2d0: 6f74 6966 7963 6d64 733a 0a20 2020 2020  otifycmds:.     
-0000d2e0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000d2f0: 7420 636d 6473 3a0a 2020 2020 2020 2020  t cmds:.        
-0000d300: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
-0000d310: 203d 206e 6f74 6966 7963 6d64 730a 2020   = notifycmds.  
-0000d320: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000d330: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d340: 2020 2020 2020 2020 636d 6473 2e65 7874          cmds.ext
-0000d350: 656e 6428 6e6f 7469 6679 636d 6473 290a  end(notifycmds).
-0000d360: 2020 2020 2020 2020 6970 7320 3d20 5b6f          ips = [o
-0000d370: 7665 7272 6964 6573 5b6b 6579 5d20 666f  verrides[key] fo
-0000d380: 7220 6b65 7920 696e 206f 7665 7272 6964  r key in overrid
-0000d390: 6573 2069 6620 7265 2e6d 6174 6368 2827  es if re.match('
-0000d3a0: 6970 5b30 2d39 5d2b 272c 206b 6579 295d  ip[0-9]+', key)]
-0000d3b0: 0a20 2020 2020 2020 206e 6574 6d61 736b  .        netmask
-0000d3c0: 7320 3d20 5b6f 7665 7272 6964 6573 5b6b  s = [overrides[k
-0000d3d0: 6579 5d20 666f 7220 6b65 7920 696e 206f  ey] for key in o
-0000d3e0: 7665 7272 6964 6573 2069 6620 7265 2e6d  verrides if re.m
-0000d3f0: 6174 6368 2827 6e65 746d 6173 6b5b 302d  atch('netmask[0-
-0000d400: 395d 2b27 2c20 6b65 7929 5d0a 2020 2020  9]+', key)].    
-0000d410: 2020 2020 6966 2070 7269 7661 7465 6b65      if privateke
-0000d420: 7920 616e 6420 7365 6c66 2e74 7970 6520  y and self.type 
-0000d430: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
-0000d440: 2020 2020 2020 7072 6976 6174 656b 6579        privatekey
-0000d450: 6669 6c65 203d 204e 6f6e 650a 2020 2020  file = None.    
-0000d460: 2020 2020 2020 2020 7075 626c 6963 6b65          publicke
-0000d470: 7966 696c 6520 3d20 636f 6d6d 6f6e 2e67  yfile = common.g
-0000d480: 6574 5f73 7368 5f70 7562 5f6b 6579 2829  et_ssh_pub_key()
-0000d490: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d4a0: 7075 626c 6963 6b65 7966 696c 6520 6973  publickeyfile is
-0000d4b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000d4c0: 2020 2020 2020 2020 2020 2070 7269 7661             priva
-0000d4d0: 7465 6b65 7966 696c 6520 3d20 7075 626c  tekeyfile = publ
-0000d4e0: 6963 6b65 7966 696c 652e 7265 706c 6163  ickeyfile.replac
-0000d4f0: 6528 272e 7075 6227 2c20 2727 290a 2020  e('.pub', '').  
-0000d500: 2020 2020 2020 2020 2020 6966 2070 7269            if pri
-0000d510: 7661 7465 6b65 7966 696c 6520 6973 206e  vatekeyfile is n
-0000d520: 6f74 204e 6f6e 6520 616e 6420 7075 626c  ot None and publ
-0000d530: 6963 6b65 7966 696c 6520 6973 206e 6f74  ickeyfile is not
-0000d540: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000d550: 2020 2020 2020 2070 7269 7661 7465 6b65         privateke
-0000d560: 7920 3d20 6f70 656e 2870 7269 7661 7465  y = open(private
-0000d570: 6b65 7966 696c 6529 2e72 6561 6428 292e  keyfile).read().
-0000d580: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-0000d590: 2020 2020 2020 2020 7075 626c 6963 6b65          publicke
-0000d5a0: 7920 3d20 6f70 656e 2870 7562 6c69 636b  y = open(publick
-0000d5b0: 6579 6669 6c65 292e 7265 6164 2829 2e73  eyfile).read().s
-0000d5c0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-0000d5d0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0000d5e0: 2249 6e6a 6563 7469 6e67 2070 7269 7661  "Injecting priva
-0000d5f0: 7465 206b 6579 2066 6f72 207b 6e61 6d65  te key for {name
-0000d600: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000d610: 2020 2020 6669 6c65 732e 6170 7065 6e64      files.append
-0000d620: 287b 2770 6174 6827 3a20 272f 726f 6f74  ({'path': '/root
-0000d630: 2f2e 7373 682f 6964 5f72 7361 272c 2027  /.ssh/id_rsa', '
-0000d640: 636f 6e74 656e 7427 3a20 7072 6976 6174  content': privat
-0000d650: 656b 6579 7d29 0a20 2020 2020 2020 2020  ekey}).         
-0000d660: 2020 2020 2020 2066 696c 6573 2e61 7070         files.app
-0000d670: 656e 6428 7b27 7061 7468 273a 2027 2f72  end({'path': '/r
-0000d680: 6f6f 742f 2e73 7368 2f69 645f 7273 612e  oot/.ssh/id_rsa.
-0000d690: 7075 6227 2c20 2763 6f6e 7465 6e74 273a  pub', 'content':
-0000d6a0: 2070 7562 6c69 636b 6579 7d29 0a20 2020   publickey}).   
-0000d6b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000d6c0: 7365 6c66 2e68 6f73 7420 696e 205b 2731  self.host in ['1
-0000d6d0: 3237 2e30 2e30 2e31 272c 2027 6c6f 6361  27.0.0.1', 'loca
-0000d6e0: 6c68 6f73 7427 5d3a 0a20 2020 2020 2020  lhost']:.       
-0000d6f0: 2020 2020 2020 2020 2020 2020 2061 7574               aut
-0000d700: 686f 7269 7a65 645f 6b65 7973 5f66 696c  horized_keys_fil
-0000d710: 6520 3d20 6f73 2e70 6174 682e 6578 7061  e = os.path.expa
-0000d720: 6e64 7573 6572 2827 7e2f 2e73 7368 2f61  nduser('~/.ssh/a
-0000d730: 7574 686f 7269 7a65 645f 6b65 7973 2729  uthorized_keys')
-0000d740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d750: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
-0000d760: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-0000d770: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-0000d780: 682e 6578 6973 7473 2861 7574 686f 7269  h.exists(authori
-0000d790: 7a65 645f 6b65 7973 5f66 696c 6529 3a0a  zed_keys_file):.
-0000d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7b0: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
-0000d7c0: 2069 6e20 6f70 656e 2861 7574 686f 7269   in open(authori
-0000d7d0: 7a65 645f 6b65 7973 5f66 696c 6529 2e72  zed_keys_file).r
-0000d7e0: 6561 646c 696e 6573 2829 3a0a 2020 2020  eadlines():.    
-0000d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d800: 2020 2020 2020 2020 6966 2070 7562 6c69          if publi
-0000d810: 636b 6579 2069 6e20 6c69 6e65 3a0a 2020  ckey in line:.  
-0000d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d830: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000d840: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
-0000d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d860: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0000d870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d880: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000d890: 666f 756e 643a 0a20 2020 2020 2020 2020  found:.         
-0000d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8b0: 2020 2077 6172 6e69 6e67 2866 2241 6464     warning(f"Add
-0000d8c0: 696e 6720 7075 626c 6963 206b 6579 2074  ing public key t
-0000d8d0: 6f20 6175 7468 6f72 697a 6564 5f6b 6579  o authorized_key
-0000d8e0: 735f 6669 6c65 2066 6f72 207b 6e61 6d65  s_file for {name
-0000d8f0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d910: 7769 7468 206f 7065 6e28 6175 7468 6f72  with open(author
-0000d920: 697a 6564 5f6b 6579 735f 6669 6c65 2c20  ized_keys_file, 
-0000d930: 2761 2729 2061 7320 663a 0a20 2020 2020  'a') as f:.     
-0000d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d950: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-0000d960: 7465 2866 225c 6e7b 7075 626c 6963 6b65  te(f"\n{publicke
-0000d970: 797d 2229 0a20 2020 2020 2020 2020 2020  y}").           
-0000d980: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9a0: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-0000d9b0: 4372 6561 7469 6e67 2061 7574 686f 7269  Creating authori
-0000d9c0: 7a65 645f 6b65 7973 5f66 696c 6522 290a  zed_keys_file").
-0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9e0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-0000d9f0: 6e28 6175 7468 6f72 697a 6564 5f6b 6579  n(authorized_key
-0000da00: 735f 6669 6c65 2c20 2777 2729 2061 7320  s_file, 'w') as 
-0000da10: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000da30: 2e77 7269 7465 2870 7562 6c69 636b 6579  .write(publickey
-0000da40: 290a 2020 2020 2020 2020 6966 2063 6d64  ).        if cmd
-0000da50: 7320 616e 6420 2772 6562 6f6f 7427 2069  s and 'reboot' i
-0000da60: 6e20 636d 6473 3a0a 2020 2020 2020 2020  n cmds:.        
-0000da70: 2020 2020 7768 696c 6520 2772 6562 6f6f      while 'reboo
-0000da80: 7427 2069 6e20 636d 6473 3a0a 2020 2020  t' in cmds:.    
-0000da90: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
-0000daa0: 2e72 656d 6f76 6528 2772 6562 6f6f 7427  .remove('reboot'
-0000dab0: 290a 2020 2020 2020 2020 2020 2020 636d  ).            cm
-0000dac0: 6473 2e61 7070 656e 6428 2772 6562 6f6f  ds.append('reboo
-0000dad0: 7427 290a 2020 2020 2020 2020 6966 2069  t').        if i
-0000dae0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-0000daf0: 2061 6e64 2028 2772 6865 6c2d 3827 2069   and ('rhel-8' i
-0000db00: 6e20 696d 6167 6520 6f72 2027 7268 636f  n image or 'rhco
-0000db10: 7327 2069 6e20 696d 6167 6529 2061 6e64  s' in image) and
-0000db20: 2064 6973 6b73 2061 6e64 206e 6f74 206f   disks and not o
-0000db30: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
-0000db40: 2020 2020 2020 2066 6972 7374 6469 736b         firstdisk
-0000db50: 203d 2064 6973 6b73 5b30 5d0a 2020 2020   = disks[0].    
-0000db60: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000db70: 7461 6e63 6528 6669 7273 7464 6973 6b2c  tance(firstdisk,
-0000db80: 2073 7472 2920 616e 6420 6669 7273 7464   str) and firstd
-0000db90: 6973 6b2e 6973 6469 6769 7428 293a 0a20  isk.isdigit():. 
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000dbb0: 6972 7374 6469 736b 203d 2069 6e74 2866  irstdisk = int(f
-0000dbc0: 6972 7374 6469 736b 290a 2020 2020 2020  irstdisk).      
-0000dbd0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000dbe0: 6e63 6528 6669 7273 7464 6973 6b2c 2069  nce(firstdisk, i
-0000dbf0: 6e74 293a 0a20 2020 2020 2020 2020 2020  nt):.           
-0000dc00: 2020 2020 2066 6972 7374 6469 736b 7369       firstdisksi
-0000dc10: 7a65 203d 2066 6972 7374 6469 736b 0a20  ze = firstdisk. 
-0000dc20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000dc30: 6620 6669 7273 7464 6973 6b73 697a 6520  f firstdisksize 
-0000dc40: 3c20 3230 3a0a 2020 2020 2020 2020 2020  < 20:.          
-0000dc50: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0000dc60: 2822 526f 756e 6469 6e67 2075 7020 6669  ("Rounding up fi
-0000dc70: 7273 7420 6469 736b 2074 6f20 3230 4762  rst disk to 20Gb
-0000dc80: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000dc90: 2020 2020 2020 2064 6973 6b73 5b30 5d20         disks[0] 
-0000dca0: 3d20 3230 0a20 2020 2020 2020 2020 2020  = 20.           
-0000dcb0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0000dcc0: 2866 6972 7374 6469 736b 2c20 6469 6374  (firstdisk, dict
-0000dcd0: 2920 616e 6420 2773 697a 6527 2069 6e20  ) and 'size' in 
-0000dce0: 6669 7273 7464 6973 6b3a 0a20 2020 2020  firstdisk:.     
-0000dcf0: 2020 2020 2020 2020 2020 2066 6972 7374             first
-0000dd00: 6469 736b 7369 7a65 203d 2066 6972 7374  disksize = first
-0000dd10: 6469 736b 5b27 7369 7a65 275d 0a20 2020  disk['size'].   
-0000dd20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000dd30: 6669 7273 7464 6973 6b73 697a 6520 3c20  firstdisksize < 
-0000dd40: 3230 3a0a 2020 2020 2020 2020 2020 2020  20:.            
-0000dd50: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-0000dd60: 526f 756e 6469 6e67 2075 7020 6669 7273  Rounding up firs
-0000dd70: 7420 6469 736b 2074 6f20 3230 4762 2229  t disk to 20Gb")
-0000dd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dd90: 2020 2020 2064 6973 6b73 5b30 5d5b 2773       disks[0]['s
-0000dda0: 697a 6527 5d20 3d20 3230 0a20 2020 2020  ize'] = 20.     
-0000ddb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000ddc0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-0000ddd0: 203d 2022 496e 636f 7272 6563 7420 6669   = "Incorrect fi
-0000dde0: 7273 7420 6469 736b 2073 7065 6322 0a20  rst disk spec". 
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000de00: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-0000de10: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-0000de20: 736f 6e27 3a20 6d73 677d 0a20 2020 2020  son': msg}.     
-0000de30: 2020 2020 2020 2069 6620 2772 6863 6f73         if 'rhcos
-0000de40: 2720 696e 2069 6d61 6765 2061 6e64 206d  ' in image and m
-0000de50: 656d 6f72 7920 3c20 3130 3234 3a0a 2020  emory < 1024:.  
-0000de60: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-0000de70: 7269 6e74 2822 4164 6a75 7374 696e 6720  rint("Adjusting 
-0000de80: 6d65 6d6f 7279 2074 6f20 3130 3234 4d62  memory to 1024Mb
-0000de90: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000dea0: 2020 206d 656d 6f72 7920 3d20 3130 3234     memory = 1024
-0000deb0: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
-0000dec0: 6120 3d20 7b27 706c 616e 273a 2070 6c61  a = {'plan': pla
-0000ded0: 6e2c 2027 7072 6f66 696c 6527 3a20 7072  n, 'profile': pr
-0000dee0: 6f66 696c 656e 616d 657d 0a20 2020 2020  ofilename}.     
-0000def0: 2020 2069 6620 646f 6d61 696e 2069 7320     if domain is 
-0000df00: 6e6f 7420 4e6f 6e65 2061 6e64 2072 6573  not None and res
-0000df10: 6572 7665 646e 733a 0a20 2020 2020 2020  ervedns:.       
-0000df20: 2020 2020 206d 6574 6164 6174 615b 2764       metadata['d
-0000df30: 6f6d 6169 6e27 5d20 3d20 646f 6d61 696e  omain'] = domain
-0000df40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000df50: 646e 7363 6c69 656e 7420 6973 206e 6f74  dnsclient is not
-0000df60: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000df70: 2020 2020 2020 206d 6574 6164 6174 615b         metadata[
-0000df80: 2764 6e73 636c 6965 6e74 275d 203d 2064  'dnsclient'] = d
-0000df90: 6e73 636c 6965 6e74 0a20 2020 2020 2020  nsclient.       
-0000dfa0: 2020 2020 2020 2020 2072 6573 6572 7665           reserve
-0000dfb0: 646e 7320 3d20 4661 6c73 650a 2020 2020  dns = False.    
-0000dfc0: 2020 2020 6966 2069 6d61 6765 2069 7320      if image is 
-0000dfd0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000dfe0: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
-0000dff0: 696d 6167 6527 5d20 3d20 696d 6167 650a  image'] = image.
-0000e000: 2020 2020 2020 2020 656c 6966 205b 6e20          elif [n 
-0000e010: 666f 7220 6e20 696e 206e 6574 7320 6966  for n in nets if
-0000e020: 2069 7369 6e73 7461 6e63 6528 6e2c 2064   isinstance(n, d
-0000e030: 6963 7429 2061 6e64 2027 6e69 6327 2069  ict) and 'nic' i
-0000e040: 6e20 6e5d 3a0a 2020 2020 2020 2020 2020  n n]:.          
-0000e050: 2020 7761 726e 696e 6728 2259 6f75 7220    warning("Your 
-0000e060: 6e65 7473 2064 6566 696e 6974 696f 6e20  nets definition 
-0000e070: 636f 6e74 6169 6e73 206e 6963 206b 6579  contains nic key
-0000e080: 2077 6869 6368 2077 6f6e 2774 2062 6520   which won't be 
-0000e090: 7573 6564 2229 0a20 2020 2020 2020 2069  used").        i
-0000e0a0: 6620 276f 776e 6572 2720 696e 2070 726f  f 'owner' in pro
-0000e0b0: 6669 6c65 206f 7220 276f 776e 6572 2720  file or 'owner' 
-0000e0c0: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
-0000e0d0: 2020 2020 2020 2020 2020 6d65 7461 6461            metada
-0000e0e0: 7461 5b27 6f77 6e65 7227 5d20 3d20 7072  ta['owner'] = pr
-0000e0f0: 6f66 696c 652e 6765 7428 276f 776e 6572  ofile.get('owner
-0000e100: 2729 206f 7220 6f76 6572 7269 6465 732e  ') or overrides.
-0000e110: 6765 7428 276f 776e 6572 2729 0a20 2020  get('owner').   
-0000e120: 2020 2020 2069 6620 2775 7365 7227 2069       if 'user' i
-0000e130: 6e20 7072 6f66 696c 6520 6f72 2027 7573  n profile or 'us
-0000e140: 6572 2720 696e 206f 7665 7272 6964 6573  er' in overrides
-0000e150: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
-0000e160: 7461 6461 7461 5b27 7573 6572 275d 203d  tadata['user'] =
-0000e170: 2070 726f 6669 6c65 2e67 6574 2827 7573   profile.get('us
-0000e180: 6572 2729 206f 7220 6f76 6572 7269 6465  er') or override
-0000e190: 732e 6765 7428 2775 7365 7227 290a 2020  s.get('user').  
-0000e1a0: 2020 2020 2020 6966 206b 7562 6520 6973        if kube is
-0000e1b0: 206e 6f74 204e 6f6e 6520 616e 6420 6b75   not None and ku
-0000e1c0: 6265 7479 7065 2069 7320 6e6f 7420 4e6f  betype is not No
-0000e1d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000e1e0: 6d65 7461 6461 7461 5b27 6b75 6265 7479  metadata['kubety
-0000e1f0: 7065 275d 203d 206b 7562 6574 7970 650a  pe'] = kubetype.
-0000e200: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
-0000e210: 6461 7461 5b27 6b75 6265 275d 203d 206b  data['kube'] = k
-0000e220: 7562 650a 2020 2020 2020 2020 6966 2074  ube.        if t
-0000e230: 656d 706b 6579 3a0a 2020 2020 2020 2020  empkey:.        
-0000e240: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
-0000e250: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
-0000e260: 2729 2069 7320 4e6f 6e65 3a0a 2020 2020  ') is None:.    
-0000e270: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0000e280: 6b65 7964 6972 203d 2054 656d 706f 7261  keydir = Tempora
-0000e290: 7279 4469 7265 6374 6f72 7928 290a 2020  ryDirectory().  
-0000e2a0: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-0000e2b0: 6572 7269 6465 735b 2774 656d 706b 6579  errides['tempkey
-0000e2c0: 6469 7227 5d20 3d20 7465 6d70 6b65 7964  dir'] = tempkeyd
-0000e2d0: 6972 0a20 2020 2020 2020 2023 2063 6f6e  ir.        # con
-0000e2e0: 6670 6f6f 6c20 6861 6e64 6c69 6e67 2066  fpool handling f
-0000e2f0: 6f72 206e 6574 776f 726b 0a20 2020 2020  or network.     
-0000e300: 2020 2066 6f72 2069 6e64 6578 2c20 6e65     for index, ne
-0000e310: 7420 696e 2065 6e75 6d65 7261 7465 286e  t in enumerate(n
-0000e320: 6574 7329 3a0a 2020 2020 2020 2020 2020  ets):.          
-0000e330: 2020 636f 6e66 706f 6f6c 203d 204e 6f6e    confpool = Non
-0000e340: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0000e350: 2069 7369 6e73 7461 6e63 6528 6e65 742c   isinstance(net,
-0000e360: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-0000e370: 2020 2020 2020 2020 636f 6e66 706f 6f6c          confpool
-0000e380: 203d 206e 6574 2e67 6574 2827 6970 706f   = net.get('ippo
-0000e390: 6f6c 2729 206f 7220 6e65 742e 6765 7428  ol') or net.get(
-0000e3a0: 2763 6f6e 6670 6f6f 6c27 290a 2020 2020  'confpool').    
-0000e3b0: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
-0000e3c0: 203d 3d20 3020 616e 6420 636f 6e66 706f   == 0 and confpo
-0000e3d0: 6f6c 2069 7320 4e6f 6e65 3a0a 2020 2020  ol is None:.    
-0000e3e0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-0000e3f0: 706f 6f6c 203d 206f 7665 7272 6964 6573  pool = overrides
-0000e400: 2e67 6574 2827 6970 706f 6f6c 2729 206f  .get('ippool') o
-0000e410: 7220 6f76 6572 7269 6465 732e 6765 7428  r overrides.get(
-0000e420: 2763 6f6e 6670 6f6f 6c27 290a 2020 2020  'confpool').    
-0000e430: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000e440: 7369 6e73 7461 6e63 6528 6e65 742c 2073  sinstance(net, s
-0000e450: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-0000e460: 2020 2020 2020 2020 206e 6574 735b 696e           nets[in
-0000e470: 6465 785d 203d 207b 276e 616d 6527 3a20  dex] = {'name': 
-0000e480: 6e65 747d 0a20 2020 2020 2020 2020 2020  net}.           
-0000e490: 2069 6620 636f 6e66 706f 6f6c 2069 7320   if confpool is 
-0000e4a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e4b0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0000e4c0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0000e4d0: 6e66 706f 6f6c 206e 6f74 2069 6e20 7365  nfpool not in se
-0000e4e0: 6c66 2e63 6f6e 6670 6f6f 6c73 3a0a 2020  lf.confpools:.  
-0000e4f0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0000e500: 726f 7228 6622 7b63 6f6e 6670 6f6f 6c7d  ror(f"{confpool}
-0000e510: 2069 7320 6e6f 7420 6120 7661 6c69 6420   is not a valid 
-0000e520: 636f 6e66 706f 6f6c 2229 0a20 2020 2020  confpool").     
-0000e530: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-0000e540: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-0000e550: 2020 2063 7572 7265 6e74 636f 6e66 706f     currentconfpo
-0000e560: 6f6c 203d 2073 656c 662e 636f 6e66 706f  ol = self.confpo
-0000e570: 6f6c 735b 636f 6e66 706f 6f6c 5d0a 2020  ols[confpool].  
-0000e580: 2020 2020 2020 2020 2020 6970 5f72 6573            ip_res
-0000e590: 6572 7661 7469 6f6e 7320 3d20 6375 7272  ervations = curr
-0000e5a0: 656e 7463 6f6e 6670 6f6f 6c2e 6765 7428  entconfpool.get(
-0000e5b0: 2769 705f 7265 7365 7276 6174 696f 6e73  'ip_reservations
-0000e5c0: 272c 207b 7d29 0a20 2020 2020 2020 2020  ', {}).         
-0000e5d0: 2020 2072 6573 6572 7665 645f 6970 7320     reserved_ips 
-0000e5e0: 3d20 6c69 7374 2869 705f 7265 7365 7276  = list(ip_reserv
-0000e5f0: 6174 696f 6e73 2e76 616c 7565 7328 2929  ations.values())
-0000e600: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000e610: 2769 7073 2720 696e 2063 7572 7265 6e74  'ips' in current
-0000e620: 636f 6e66 706f 6f6c 3a0a 2020 2020 2020  confpool:.      
-0000e630: 2020 2020 2020 2020 2020 6970 7320 3d20            ips = 
-0000e640: 6375 7272 656e 7463 6f6e 6670 6f6f 6c5b  currentconfpool[
-0000e650: 2769 7073 275d 0a20 2020 2020 2020 2020  'ips'].         
-0000e660: 2020 2020 2020 2069 6620 272f 2720 696e         if '/' in
-0000e670: 2069 7073 3a0a 2020 2020 2020 2020 2020   ips:.          
-0000e680: 2020 2020 2020 2020 2020 6970 7320 3d20            ips = 
-0000e690: 5b73 7472 2869 2920 666f 7220 6920 696e  [str(i) for i in
-0000e6a0: 2069 705f 6e65 7477 6f72 6b28 6970 7329   ip_network(ips)
-0000e6b0: 5b31 3a2e 315d 5d0a 2020 2020 2020 2020  [1:.1]].        
-0000e6c0: 2020 2020 2020 2020 6672 6565 5f69 7073          free_ips
-0000e6d0: 203d 205b 6970 2066 6f72 2069 7020 696e   = [ip for ip in
-0000e6e0: 2069 7073 2069 6620 6970 206e 6f74 2069   ips if ip not i
-0000e6f0: 6e20 7265 7365 7276 6564 5f69 7073 5d0a  n reserved_ips].
+0000d2d0: 6f74 2063 6d64 733a 0a20 2020 2020 2020  ot cmds:.       
+0000d2e0: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+0000d2f0: 7320 3d20 6e6f 7469 6679 636d 6473 0a20  s = notifycmds. 
+0000d300: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000d310: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000d320: 2020 2020 2020 2020 2063 6d64 732e 6578           cmds.ex
+0000d330: 7465 6e64 286e 6f74 6966 7963 6d64 7329  tend(notifycmds)
+0000d340: 0a20 2020 2020 2020 2069 7073 203d 205b  .        ips = [
+0000d350: 6f76 6572 7269 6465 735b 6b65 795d 2066  overrides[key] f
+0000d360: 6f72 206b 6579 2069 6e20 6f76 6572 7269  or key in overri
+0000d370: 6465 7320 6966 2072 652e 6d61 7463 6828  des if re.match(
+0000d380: 2769 705b 302d 395d 2b27 2c20 6b65 7929  'ip[0-9]+', key)
+0000d390: 5d0a 2020 2020 2020 2020 6e65 746d 6173  ].        netmas
+0000d3a0: 6b73 203d 205b 6f76 6572 7269 6465 735b  ks = [overrides[
+0000d3b0: 6b65 795d 2066 6f72 206b 6579 2069 6e20  key] for key in 
+0000d3c0: 6f76 6572 7269 6465 7320 6966 2072 652e  overrides if re.
+0000d3d0: 6d61 7463 6828 276e 6574 6d61 736b 5b30  match('netmask[0
+0000d3e0: 2d39 5d2b 272c 206b 6579 295d 0a20 2020  -9]+', key)].   
+0000d3f0: 2020 2020 2069 6620 7072 6976 6174 656b       if privatek
+0000d400: 6579 2061 6e64 2073 656c 662e 7479 7065  ey and self.type
+0000d410: 203d 3d20 276b 766d 273a 0a20 2020 2020   == 'kvm':.     
+0000d420: 2020 2020 2020 2070 7269 7661 7465 6b65         privateke
+0000d430: 7966 696c 6520 3d20 4e6f 6e65 0a20 2020  yfile = None.   
+0000d440: 2020 2020 2020 2020 2070 7562 6c69 636b           publick
+0000d450: 6579 6669 6c65 203d 2063 6f6d 6d6f 6e2e  eyfile = common.
+0000d460: 6765 745f 7373 685f 7075 625f 6b65 7928  get_ssh_pub_key(
+0000d470: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000d480: 2070 7562 6c69 636b 6579 6669 6c65 2069   publickeyfile i
+0000d490: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000d4a0: 2020 2020 2020 2020 2020 2020 7072 6976              priv
+0000d4b0: 6174 656b 6579 6669 6c65 203d 2070 7562  atekeyfile = pub
+0000d4c0: 6c69 636b 6579 6669 6c65 2e72 6570 6c61  lickeyfile.repla
+0000d4d0: 6365 2827 2e70 7562 272c 2027 2729 0a20  ce('.pub', ''). 
+0000d4e0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+0000d4f0: 6976 6174 656b 6579 6669 6c65 2069 7320  ivatekeyfile is 
+0000d500: 6e6f 7420 4e6f 6e65 2061 6e64 2070 7562  not None and pub
+0000d510: 6c69 636b 6579 6669 6c65 2069 7320 6e6f  lickeyfile is no
+0000d520: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000d530: 2020 2020 2020 2020 7072 6976 6174 656b          privatek
+0000d540: 6579 203d 206f 7065 6e28 7072 6976 6174  ey = open(privat
+0000d550: 656b 6579 6669 6c65 292e 7265 6164 2829  ekeyfile).read()
+0000d560: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+0000d570: 2020 2020 2020 2020 2070 7562 6c69 636b           publick
+0000d580: 6579 203d 206f 7065 6e28 7075 626c 6963  ey = open(public
+0000d590: 6b65 7966 696c 6529 2e72 6561 6428 292e  keyfile).read().
+0000d5a0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+0000d5b0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0000d5c0: 6622 496e 6a65 6374 696e 6720 7072 6976  f"Injecting priv
+0000d5d0: 6174 6520 6b65 7920 666f 7220 7b6e 616d  ate key for {nam
+0000d5e0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0000d5f0: 2020 2020 2066 696c 6573 2e61 7070 656e       files.appen
+0000d600: 6428 7b27 7061 7468 273a 2027 2f72 6f6f  d({'path': '/roo
+0000d610: 742f 2e73 7368 2f69 645f 7273 6127 2c20  t/.ssh/id_rsa', 
+0000d620: 2763 6f6e 7465 6e74 273a 2070 7269 7661  'content': priva
+0000d630: 7465 6b65 797d 290a 2020 2020 2020 2020  tekey}).        
+0000d640: 2020 2020 2020 2020 6669 6c65 732e 6170          files.ap
+0000d650: 7065 6e64 287b 2770 6174 6827 3a20 272f  pend({'path': '/
+0000d660: 726f 6f74 2f2e 7373 682f 6964 5f72 7361  root/.ssh/id_rsa
+0000d670: 2e70 7562 272c 2027 636f 6e74 656e 7427  .pub', 'content'
+0000d680: 3a20 7075 626c 6963 6b65 797d 290a 2020  : publickey}).  
+0000d690: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000d6a0: 2073 656c 662e 686f 7374 2069 6e20 5b27   self.host in ['
+0000d6b0: 3132 372e 302e 302e 3127 2c20 276c 6f63  127.0.0.1', 'loc
+0000d6c0: 616c 686f 7374 275d 3a0a 2020 2020 2020  alhost']:.      
+0000d6d0: 2020 2020 2020 2020 2020 2020 2020 6175                au
+0000d6e0: 7468 6f72 697a 6564 5f6b 6579 735f 6669  thorized_keys_fi
+0000d6f0: 6c65 203d 206f 732e 7061 7468 2e65 7870  le = os.path.exp
+0000d700: 616e 6475 7365 7228 277e 2f2e 7373 682f  anduser('~/.ssh/
+0000d710: 6175 7468 6f72 697a 6564 5f6b 6579 7327  authorized_keys'
+0000d720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d730: 2020 2020 2020 666f 756e 6420 3d20 4661        found = Fa
+0000d740: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000d750: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+0000d760: 7468 2e65 7869 7374 7328 6175 7468 6f72  th.exists(author
+0000d770: 697a 6564 5f6b 6579 735f 6669 6c65 293a  ized_keys_file):
+0000d780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d790: 2020 2020 2020 2020 2066 6f72 206c 696e           for lin
+0000d7a0: 6520 696e 206f 7065 6e28 6175 7468 6f72  e in open(author
+0000d7b0: 697a 6564 5f6b 6579 735f 6669 6c65 292e  ized_keys_file).
+0000d7c0: 7265 6164 6c69 6e65 7328 293a 0a20 2020  readlines():.   
+0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7e0: 2020 2020 2020 2020 2069 6620 7075 626c           if publ
+0000d7f0: 6963 6b65 7920 696e 206c 696e 653a 0a20  ickey in line:. 
+0000d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d810: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000d820: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+0000d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d840: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0000d850: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0000d860: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000d870: 2066 6f75 6e64 3a0a 2020 2020 2020 2020   found:.        
+0000d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d890: 2020 2020 7761 726e 696e 6728 6622 4164      warning(f"Ad
+0000d8a0: 6469 6e67 2070 7562 6c69 6320 6b65 7920  ding public key 
+0000d8b0: 746f 2061 7574 686f 7269 7a65 645f 6b65  to authorized_ke
+0000d8c0: 7973 5f66 696c 6520 666f 7220 7b6e 616d  ys_file for {nam
+0000d8d0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0000d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8f0: 2077 6974 6820 6f70 656e 2861 7574 686f   with open(autho
+0000d900: 7269 7a65 645f 6b65 7973 5f66 696c 652c  rized_keys_file,
+0000d910: 2027 6127 2920 6173 2066 3a0a 2020 2020   'a') as f:.    
+0000d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d930: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0000d940: 6974 6528 6622 5c6e 7b70 7562 6c69 636b  ite(f"\n{publick
+0000d950: 6579 7d22 290a 2020 2020 2020 2020 2020  ey}").          
+0000d960: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d980: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0000d990: 2243 7265 6174 696e 6720 6175 7468 6f72  "Creating author
+0000d9a0: 697a 6564 5f6b 6579 735f 6669 6c65 2229  ized_keys_file")
+0000d9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d9c0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0000d9d0: 656e 2861 7574 686f 7269 7a65 645f 6b65  en(authorized_ke
+0000d9e0: 7973 5f66 696c 652c 2027 7727 2920 6173  ys_file, 'w') as
+0000d9f0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+0000da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da10: 662e 7772 6974 6528 7075 626c 6963 6b65  f.write(publicke
+0000da20: 7929 0a20 2020 2020 2020 2069 6620 636d  y).        if cm
+0000da30: 6473 2061 6e64 2027 7265 626f 6f74 2720  ds and 'reboot' 
+0000da40: 696e 2063 6d64 733a 0a20 2020 2020 2020  in cmds:.       
+0000da50: 2020 2020 2077 6869 6c65 2027 7265 626f       while 'rebo
+0000da60: 6f74 2720 696e 2063 6d64 733a 0a20 2020  ot' in cmds:.   
+0000da70: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+0000da80: 732e 7265 6d6f 7665 2827 7265 626f 6f74  s.remove('reboot
+0000da90: 2729 0a20 2020 2020 2020 2020 2020 2063  ').            c
+0000daa0: 6d64 732e 6170 7065 6e64 2827 7265 626f  mds.append('rebo
+0000dab0: 6f74 2729 0a20 2020 2020 2020 2069 6620  ot').        if 
+0000dac0: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+0000dad0: 6520 616e 6420 2827 7268 656c 2d38 2720  e and ('rhel-8' 
+0000dae0: 696e 2069 6d61 6765 206f 7220 2772 6863  in image or 'rhc
+0000daf0: 6f73 2720 696e 2069 6d61 6765 2920 616e  os' in image) an
+0000db00: 6420 6469 736b 7320 616e 6420 6e6f 7420  d disks and not 
+0000db10: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
+0000db20: 2020 2020 2020 2020 6669 7273 7464 6973          firstdis
+0000db30: 6b20 3d20 6469 736b 735b 305d 0a20 2020  k = disks[0].   
+0000db40: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000db50: 7374 616e 6365 2866 6972 7374 6469 736b  stance(firstdisk
+0000db60: 2c20 7374 7229 2061 6e64 2066 6972 7374  , str) and first
+0000db70: 6469 736b 2e69 7364 6967 6974 2829 3a0a  disk.isdigit():.
+0000db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db90: 6669 7273 7464 6973 6b20 3d20 696e 7428  firstdisk = int(
+0000dba0: 6669 7273 7464 6973 6b29 0a20 2020 2020  firstdisk).     
+0000dbb0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000dbc0: 616e 6365 2866 6972 7374 6469 736b 2c20  ance(firstdisk, 
+0000dbd0: 696e 7429 3a0a 2020 2020 2020 2020 2020  int):.          
+0000dbe0: 2020 2020 2020 6669 7273 7464 6973 6b73        firstdisks
+0000dbf0: 697a 6520 3d20 6669 7273 7464 6973 6b0a  ize = firstdisk.
+0000dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc10: 6966 2066 6972 7374 6469 736b 7369 7a65  if firstdisksize
+0000dc20: 203c 2032 303a 0a20 2020 2020 2020 2020   < 20:.         
+0000dc30: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0000dc40: 7428 2252 6f75 6e64 696e 6720 7570 2066  t("Rounding up f
+0000dc50: 6972 7374 2064 6973 6b20 746f 2032 3047  irst disk to 20G
+0000dc60: 6222 290a 2020 2020 2020 2020 2020 2020  b").            
+0000dc70: 2020 2020 2020 2020 6469 736b 735b 305d          disks[0]
+0000dc80: 203d 2032 300a 2020 2020 2020 2020 2020   = 20.          
+0000dc90: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0000dca0: 6528 6669 7273 7464 6973 6b2c 2064 6963  e(firstdisk, dic
+0000dcb0: 7429 2061 6e64 2027 7369 7a65 2720 696e  t) and 'size' in
+0000dcc0: 2066 6972 7374 6469 736b 3a0a 2020 2020   firstdisk:.    
+0000dcd0: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+0000dce0: 7464 6973 6b73 697a 6520 3d20 6669 7273  tdisksize = firs
+0000dcf0: 7464 6973 6b5b 2773 697a 6527 5d0a 2020  tdisk['size'].  
+0000dd00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000dd10: 2066 6972 7374 6469 736b 7369 7a65 203c   firstdisksize <
+0000dd20: 2032 303a 0a20 2020 2020 2020 2020 2020   20:.           
+0000dd30: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0000dd40: 2252 6f75 6e64 696e 6720 7570 2066 6972  "Rounding up fir
+0000dd50: 7374 2064 6973 6b20 746f 2032 3047 6222  st disk to 20Gb"
+0000dd60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dd70: 2020 2020 2020 6469 736b 735b 305d 5b27        disks[0]['
+0000dd80: 7369 7a65 275d 203d 2032 300a 2020 2020  size'] = 20.    
+0000dd90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+0000ddb0: 6720 3d20 2249 6e63 6f72 7265 6374 2066  g = "Incorrect f
+0000ddc0: 6972 7374 2064 6973 6b20 7370 6563 220a  irst disk spec".
+0000ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dde0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+0000ddf0: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+0000de00: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
+0000de10: 2020 2020 2020 2020 6966 2027 7268 636f          if 'rhco
+0000de20: 7327 2069 6e20 696d 6167 6520 616e 6420  s' in image and 
+0000de30: 6d65 6d6f 7279 203c 2031 3032 343a 0a20  memory < 1024:. 
+0000de40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000de50: 7072 696e 7428 2241 646a 7573 7469 6e67  print("Adjusting
+0000de60: 206d 656d 6f72 7920 746f 2031 3032 344d   memory to 1024M
+0000de70: 6222 290a 2020 2020 2020 2020 2020 2020  b").            
+0000de80: 2020 2020 6d65 6d6f 7279 203d 2031 3032      memory = 102
+0000de90: 340a 2020 2020 2020 2020 6d65 7461 6461  4.        metada
+0000dea0: 7461 203d 207b 2770 6c61 6e27 3a20 706c  ta = {'plan': pl
+0000deb0: 616e 2c20 2770 726f 6669 6c65 273a 2070  an, 'profile': p
+0000dec0: 726f 6669 6c65 6e61 6d65 7d0a 2020 2020  rofilename}.    
+0000ded0: 2020 2020 6966 2064 6f6d 6169 6e20 6973      if domain is
+0000dee0: 206e 6f74 204e 6f6e 6520 616e 6420 7265   not None and re
+0000def0: 7365 7276 6564 6e73 3a0a 2020 2020 2020  servedns:.      
+0000df00: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
+0000df10: 646f 6d61 696e 275d 203d 2064 6f6d 6169  domain'] = domai
+0000df20: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
+0000df30: 2064 6e73 636c 6965 6e74 2069 7320 6e6f   dnsclient is no
+0000df40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000df50: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+0000df60: 5b27 646e 7363 6c69 656e 7427 5d20 3d20  ['dnsclient'] = 
+0000df70: 646e 7363 6c69 656e 740a 2020 2020 2020  dnsclient.      
+0000df80: 2020 2020 2020 2020 2020 7265 7365 7276            reserv
+0000df90: 6564 6e73 203d 2046 616c 7365 0a20 2020  edns = False.   
+0000dfa0: 2020 2020 2069 6620 696d 6167 6520 6973       if image is
+0000dfb0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000dfc0: 2020 2020 2020 206d 6574 6164 6174 615b         metadata[
+0000dfd0: 2769 6d61 6765 275d 203d 2069 6d61 6765  'image'] = image
+0000dfe0: 0a20 2020 2020 2020 2065 6c69 6620 5b6e  .        elif [n
+0000dff0: 2066 6f72 206e 2069 6e20 6e65 7473 2069   for n in nets i
+0000e000: 6620 6973 696e 7374 616e 6365 286e 2c20  f isinstance(n, 
+0000e010: 6469 6374 2920 616e 6420 276e 6963 2720  dict) and 'nic' 
+0000e020: 696e 206e 5d3a 0a20 2020 2020 2020 2020  in n]:.         
+0000e030: 2020 2077 6172 6e69 6e67 2822 596f 7572     warning("Your
+0000e040: 206e 6574 7320 6465 6669 6e69 7469 6f6e   nets definition
+0000e050: 2063 6f6e 7461 696e 7320 6e69 6320 6b65   contains nic ke
+0000e060: 7920 7768 6963 6820 776f 6e27 7420 6265  y which won't be
+0000e070: 2075 7365 6422 290a 2020 2020 2020 2020   used").        
+0000e080: 6966 2027 6f77 6e65 7227 2069 6e20 7072  if 'owner' in pr
+0000e090: 6f66 696c 6520 6f72 2027 6f77 6e65 7227  ofile or 'owner'
+0000e0a0: 2069 6e20 6f76 6572 7269 6465 733a 0a20   in overrides:. 
+0000e0b0: 2020 2020 2020 2020 2020 206d 6574 6164             metad
+0000e0c0: 6174 615b 276f 776e 6572 275d 203d 2070  ata['owner'] = p
+0000e0d0: 726f 6669 6c65 2e67 6574 2827 6f77 6e65  rofile.get('owne
+0000e0e0: 7227 2920 6f72 206f 7665 7272 6964 6573  r') or overrides
+0000e0f0: 2e67 6574 2827 6f77 6e65 7227 290a 2020  .get('owner').  
+0000e100: 2020 2020 2020 6966 2027 7573 6572 2720        if 'user' 
+0000e110: 696e 2070 726f 6669 6c65 206f 7220 2775  in profile or 'u
+0000e120: 7365 7227 2069 6e20 6f76 6572 7269 6465  ser' in override
+0000e130: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
+0000e140: 6574 6164 6174 615b 2775 7365 7227 5d20  etadata['user'] 
+0000e150: 3d20 7072 6f66 696c 652e 6765 7428 2775  = profile.get('u
+0000e160: 7365 7227 2920 6f72 206f 7665 7272 6964  ser') or overrid
+0000e170: 6573 2e67 6574 2827 7573 6572 2729 0a20  es.get('user'). 
+0000e180: 2020 2020 2020 2069 6620 6b75 6265 2069         if kube i
+0000e190: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206b  s not None and k
+0000e1a0: 7562 6574 7970 6520 6973 206e 6f74 204e  ubetype is not N
+0000e1b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000e1c0: 206d 6574 6164 6174 615b 276b 7562 6574   metadata['kubet
+0000e1d0: 7970 6527 5d20 3d20 6b75 6265 7479 7065  ype'] = kubetype
+0000e1e0: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+0000e1f0: 6164 6174 615b 276b 7562 6527 5d20 3d20  adata['kube'] = 
+0000e200: 6b75 6265 0a20 2020 2020 2020 2069 6620  kube.        if 
+0000e210: 7465 6d70 6b65 793a 0a20 2020 2020 2020  tempkey:.       
+0000e220: 2020 2020 2069 6620 6f76 6572 7269 6465       if override
+0000e230: 732e 6765 7428 2774 656d 706b 6579 6469  s.get('tempkeydi
+0000e240: 7227 2920 6973 204e 6f6e 653a 0a20 2020  r') is None:.   
+0000e250: 2020 2020 2020 2020 2020 2020 2074 656d               tem
+0000e260: 706b 6579 6469 7220 3d20 5465 6d70 6f72  pkeydir = Tempor
+0000e270: 6172 7944 6972 6563 746f 7279 2829 0a20  aryDirectory(). 
+0000e280: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000e290: 7665 7272 6964 6573 5b27 7465 6d70 6b65  verrides['tempke
+0000e2a0: 7964 6972 275d 203d 2074 656d 706b 6579  ydir'] = tempkey
+0000e2b0: 6469 720a 2020 2020 2020 2020 2320 636f  dir.        # co
+0000e2c0: 6e66 706f 6f6c 2068 616e 646c 696e 6720  nfpool handling 
+0000e2d0: 666f 7220 6e65 7477 6f72 6b0a 2020 2020  for network.    
+0000e2e0: 2020 2020 666f 7220 696e 6465 782c 206e      for index, n
+0000e2f0: 6574 2069 6e20 656e 756d 6572 6174 6528  et in enumerate(
+0000e300: 6e65 7473 293a 0a20 2020 2020 2020 2020  nets):.         
+0000e310: 2020 2063 6f6e 6670 6f6f 6c20 3d20 4e6f     confpool = No
+0000e320: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+0000e330: 6620 6973 696e 7374 616e 6365 286e 6574  f isinstance(net
+0000e340: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+0000e350: 2020 2020 2020 2020 2063 6f6e 6670 6f6f           confpoo
+0000e360: 6c20 3d20 6e65 742e 6765 7428 2769 7070  l = net.get('ipp
+0000e370: 6f6f 6c27 2920 6f72 206e 6574 2e67 6574  ool') or net.get
+0000e380: 2827 636f 6e66 706f 6f6c 2729 0a20 2020  ('confpool').   
+0000e390: 2020 2020 2020 2020 2069 6620 696e 6465           if inde
+0000e3a0: 7820 3d3d 2030 2061 6e64 2063 6f6e 6670  x == 0 and confp
+0000e3b0: 6f6f 6c20 6973 204e 6f6e 653a 0a20 2020  ool is None:.   
+0000e3c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0000e3d0: 6670 6f6f 6c20 3d20 6f76 6572 7269 6465  fpool = override
+0000e3e0: 732e 6765 7428 2769 7070 6f6f 6c27 2920  s.get('ippool') 
+0000e3f0: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
+0000e400: 2827 636f 6e66 706f 6f6c 2729 0a20 2020  ('confpool').   
+0000e410: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000e420: 6973 696e 7374 616e 6365 286e 6574 2c20  isinstance(net, 
+0000e430: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+0000e440: 2020 2020 2020 2020 2020 6e65 7473 5b69            nets[i
+0000e450: 6e64 6578 5d20 3d20 7b27 6e61 6d65 273a  ndex] = {'name':
+0000e460: 206e 6574 7d0a 2020 2020 2020 2020 2020   net}.          
+0000e470: 2020 6966 2063 6f6e 6670 6f6f 6c20 6973    if confpool is
+0000e480: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000e490: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0000e4a0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0000e4b0: 6f6e 6670 6f6f 6c20 6e6f 7420 696e 2073  onfpool not in s
+0000e4c0: 656c 662e 636f 6e66 706f 6f6c 733a 0a20  elf.confpools:. 
+0000e4d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000e4e0: 7272 6f72 2866 227b 636f 6e66 706f 6f6c  rror(f"{confpool
+0000e4f0: 7d20 6973 206e 6f74 2061 2076 616c 6964  } is not a valid
+0000e500: 2063 6f6e 6670 6f6f 6c22 290a 2020 2020   confpool").    
+0000e510: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+0000e520: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+0000e530: 2020 2020 6375 7272 656e 7463 6f6e 6670      currentconfp
+0000e540: 6f6f 6c20 3d20 7365 6c66 2e63 6f6e 6670  ool = self.confp
+0000e550: 6f6f 6c73 5b63 6f6e 6670 6f6f 6c5d 0a20  ools[confpool]. 
+0000e560: 2020 2020 2020 2020 2020 2069 705f 7265             ip_re
+0000e570: 7365 7276 6174 696f 6e73 203d 2063 7572  servations = cur
+0000e580: 7265 6e74 636f 6e66 706f 6f6c 2e67 6574  rentconfpool.get
+0000e590: 2827 6970 5f72 6573 6572 7661 7469 6f6e  ('ip_reservation
+0000e5a0: 7327 2c20 7b7d 290a 2020 2020 2020 2020  s', {}).        
+0000e5b0: 2020 2020 7265 7365 7276 6564 5f69 7073      reserved_ips
+0000e5c0: 203d 206c 6973 7428 6970 5f72 6573 6572   = list(ip_reser
+0000e5d0: 7661 7469 6f6e 732e 7661 6c75 6573 2829  vations.values()
+0000e5e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000e5f0: 2027 6970 7327 2069 6e20 6375 7272 656e   'ips' in curren
+0000e600: 7463 6f6e 6670 6f6f 6c3a 0a20 2020 2020  tconfpool:.     
+0000e610: 2020 2020 2020 2020 2020 2069 7073 203d             ips =
+0000e620: 2063 7572 7265 6e74 636f 6e66 706f 6f6c   currentconfpool
+0000e630: 5b27 6970 7327 5d0a 2020 2020 2020 2020  ['ips'].        
+0000e640: 2020 2020 2020 2020 6966 2027 2f27 2069          if '/' i
+0000e650: 6e20 6970 733a 0a20 2020 2020 2020 2020  n ips:.         
+0000e660: 2020 2020 2020 2020 2020 2069 7073 203d             ips =
+0000e670: 205b 7374 7228 6929 2066 6f72 2069 2069   [str(i) for i i
+0000e680: 6e20 6970 5f6e 6574 776f 726b 2869 7073  n ip_network(ips
+0000e690: 295b 313a 2e31 5d5d 0a20 2020 2020 2020  )[1:.1]].       
+0000e6a0: 2020 2020 2020 2020 2066 7265 655f 6970           free_ip
+0000e6b0: 7320 3d20 5b69 7020 666f 7220 6970 2069  s = [ip for ip i
+0000e6c0: 6e20 6970 7320 6966 2069 7020 6e6f 7420  n ips if ip not 
+0000e6d0: 696e 2072 6573 6572 7665 645f 6970 735d  in reserved_ips]
+0000e6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e6f0: 2069 6620 6672 6565 5f69 7073 3a0a 2020   if free_ips:.  
 0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e710: 6966 2066 7265 655f 6970 733a 0a20 2020  if free_ips:.   
-0000e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e730: 2066 7265 655f 6970 203d 2066 7265 655f   free_ip = free_
-0000e740: 6970 735b 305d 0a20 2020 2020 2020 2020  ips[0].         
-0000e750: 2020 2020 2020 2020 2020 2069 705f 7265             ip_re
-0000e760: 7365 7276 6174 696f 6e73 5b6e 616d 655d  servations[name]
-0000e770: 203d 2066 7265 655f 6970 0a20 2020 2020   = free_ip.     
-0000e780: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000e790: 7072 696e 7428 6622 5573 696e 6720 6970  print(f"Using ip
-0000e7a0: 207b 6672 6565 5f69 707d 2066 726f 6d20   {free_ip} from 
-0000e7b0: 636f 6e66 706f 6f6c 207b 636f 6e66 706f  confpool {confpo
-0000e7c0: 6f6c 7d20 696e 206e 6574 207b 696e 6465  ol} in net {inde
-0000e7d0: 787d 2229 0a20 2020 2020 2020 2020 2020  x}").           
-0000e7e0: 2020 2020 2020 2020 206e 6577 5f63 6f6e           new_con
-0000e7f0: 6620 3d20 6375 7272 656e 7463 6f6e 6670  f = currentconfp
-0000e800: 6f6f 6c2e 636f 7079 2829 0a20 2020 2020  ool.copy().     
-0000e810: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000e820: 6577 5f63 6f6e 665b 2769 7027 5d20 3d20  ew_conf['ip'] = 
-0000e830: 6672 6565 5f69 700a 2020 2020 2020 2020  free_ip.        
-0000e840: 2020 2020 2020 2020 2020 2020 6e65 7473              nets
-0000e850: 5b69 6e64 6578 5d2e 7570 6461 7465 2863  [index].update(c
-0000e860: 7572 7265 6e74 636f 6e66 706f 6f6c 290a  urrentconfpool).
-0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e880: 2020 2020 6966 206e 6f74 206f 6e6c 7961      if not onlya
-0000e890: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000e8b0: 656c 662e 7570 6461 7465 5f63 6f6e 6670  elf.update_confp
-0000e8c0: 6f6f 6c28 636f 6e66 706f 6f6c 2c20 7b27  ool(confpool, {'
-0000e8d0: 6970 5f72 6573 6572 7661 7469 6f6e 7327  ip_reservations'
-0000e8e0: 3a20 6970 5f72 6573 6572 7661 7469 6f6e  : ip_reservation
-0000e8f0: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
-0000e900: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000e910: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0000e920: 726f 7228 6622 4e6f 2061 7661 696c 6162  ror(f"No availab
-0000e930: 6c65 2069 7020 696e 2063 6f6e 6670 6f6f  le ip in confpoo
-0000e940: 6c20 7b63 6f6e 6670 6f6f 6c7d 2229 0a20  l {confpool}"). 
-0000e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e960: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-0000e970: 2020 2020 2020 2069 6620 6f6e 6c79 6173         if onlyas
-0000e980: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0000e990: 2020 696d 6167 6520 3d20 696d 6167 6520    image = image 
-0000e9a0: 6f72 2070 726f 6669 6c65 6e61 6d65 0a20  or profilename. 
-0000e9b0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0000e9c0: 6d6d 6f6e 2e6e 6565 6473 5f69 676e 6974  mmon.needs_ignit
-0000e9d0: 696f 6e28 696d 6167 6529 3a0a 2020 2020  ion(image):.    
-0000e9e0: 2020 2020 2020 2020 2020 2020 7665 7273              vers
-0000e9f0: 696f 6e20 3d20 636f 6d6d 6f6e 2e69 676e  ion = common.ign
-0000ea00: 6974 696f 6e5f 7665 7273 696f 6e28 696d  ition_version(im
-0000ea10: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
-0000ea20: 2020 2020 2063 6f6d 7061 6374 203d 2054       compact = T
-0000ea30: 7275 6520 6966 206f 7665 7272 6964 6573  rue if overrides
-0000ea40: 2e67 6574 2827 636f 6d70 6163 7427 2920  .get('compact') 
-0000ea50: 656c 7365 2046 616c 7365 0a20 2020 2020  else False.     
-0000ea60: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-0000ea70: 3d20 636f 6d6d 6f6e 2e69 676e 6974 696f  = common.ignitio
-0000ea80: 6e28 6e61 6d65 3d6e 616d 652c 206b 6579  n(name=name, key
-0000ea90: 733d 6b65 7973 2c20 636d 6473 3d63 6d64  s=keys, cmds=cmd
-0000eaa0: 732c 206e 6574 733d 6e65 7473 2c20 6761  s, nets=nets, ga
-0000eab0: 7465 7761 793d 6761 7465 7761 792c 2064  teway=gateway, d
-0000eac0: 6e73 3d64 6e73 2c0a 2020 2020 2020 2020  ns=dns,.        
-0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eae0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000eaf0: 6f6d 6169 6e3d 646f 6d61 696e 2c20 6669  omain=domain, fi
-0000eb00: 6c65 733d 6669 6c65 732c 2065 6e61 626c  les=files, enabl
-0000eb10: 6572 6f6f 743d 656e 6162 6c65 726f 6f74  eroot=enableroot
-0000eb20: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-0000eb30: 7269 6465 732c 0a20 2020 2020 2020 2020  rides,.         
-0000eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb50: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-0000eb60: 7273 696f 6e3d 7665 7273 696f 6e2c 2070  rsion=version, p
-0000eb70: 6c61 6e3d 706c 616e 2c20 696d 6167 653d  lan=plan, image=
-0000eb80: 696d 6167 652c 2063 6f6d 7061 6374 3d63  image, compact=c
-0000eb90: 6f6d 7061 6374 2c0a 2020 2020 2020 2020  ompact,.        
-0000eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000ebc0: 6d75 7365 723d 766d 7573 6572 290a 2020  muser=vmuser).  
-0000ebd0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebf0: 6461 7461 203d 2063 6f6d 6d6f 6e2e 636c  data = common.cl
-0000ec00: 6f75 6469 6e69 7428 6e61 6d65 2c20 6b65  oudinit(name, ke
-0000ec10: 7973 3d6b 6579 732c 2063 6d64 733d 636d  ys=keys, cmds=cm
-0000ec20: 6473 2c20 6e65 7473 3d6e 6574 732c 2067  ds, nets=nets, g
-0000ec30: 6174 6577 6179 3d67 6174 6577 6179 2c20  ateway=gateway, 
-0000ec40: 646e 733d 646e 732c 0a20 2020 2020 2020  dns=dns,.       
-0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec70: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
-0000ec80: 6669 6c65 733d 6669 6c65 732c 2065 6e61  files=files, ena
-0000ec90: 626c 6572 6f6f 743d 656e 6162 6c65 726f  bleroot=enablero
-0000eca0: 6f74 2c20 6f76 6572 7269 6465 733d 6f76  ot, overrides=ov
-0000ecb0: 6572 7269 6465 732c 0a20 2020 2020 2020  errides,.       
-0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ece0: 2069 6d61 6765 3d69 6d61 6765 2c20 7374   image=image, st
-0000ecf0: 6f72 656d 6574 6164 6174 613d 4661 6c73  oremetadata=Fals
-0000ed00: 652c 2076 6d75 7365 723d 766d 7573 6572  e, vmuser=vmuser
-0000ed10: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
-0000ed20: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-0000ed30: 273a 2027 7375 6363 6573 7327 2c20 2764  ': 'success', 'd
-0000ed40: 6174 6127 3a20 6461 7461 7d0a 2020 2020  ata': data}.    
-0000ed50: 2020 2020 7265 7375 6c74 203d 206b 2e63      result = k.c
-0000ed60: 7265 6174 6528 6e61 6d65 3d6e 616d 652c  reate(name=name,
-0000ed70: 2076 6972 7474 7970 653d 7669 7274 7479   virttype=virtty
-0000ed80: 7065 2c20 706c 616e 3d70 6c61 6e2c 2070  pe, plan=plan, p
-0000ed90: 726f 6669 6c65 3d70 726f 6669 6c65 6e61  rofile=profilena
-0000eda0: 6d65 2c20 666c 6176 6f72 3d66 6c61 766f  me, flavor=flavo
-0000edb0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0000edc0: 2020 2020 2020 2020 2020 2020 2063 7075               cpu
-0000edd0: 6d6f 6465 6c3d 6370 756d 6f64 656c 2c20  model=cpumodel, 
-0000ede0: 6370 7566 6c61 6773 3d63 7075 666c 6167  cpuflags=cpuflag
-0000edf0: 732c 2063 7075 7069 6e6e 696e 673d 6370  s, cpupinning=cp
-0000ee00: 7570 696e 6e69 6e67 2c20 6e75 6d61 6d6f  upinning, numamo
-0000ee10: 6465 3d6e 756d 616d 6f64 652c 206e 756d  de=numamode, num
-0000ee20: 613d 6e75 6d61 2c0a 2020 2020 2020 2020  a=numa,.        
-0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee40: 2020 6e75 6d63 7075 733d 696e 7428 6e75    numcpus=int(nu
-0000ee50: 6d63 7075 7329 2c20 6d65 6d6f 7279 3d69  mcpus), memory=i
-0000ee60: 6e74 286d 656d 6f72 7929 2c20 6775 6573  nt(memory), gues
-0000ee70: 7469 643d 6775 6573 7469 642c 2070 6f6f  tid=guestid, poo
-0000ee80: 6c3d 706f 6f6c 2c0a 2020 2020 2020 2020  l=pool,.        
-0000ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eea0: 2020 696d 6167 653d 696d 6167 652c 2064    image=image, d
-0000eeb0: 6973 6b73 3d64 6973 6b73 2c20 6469 736b  isks=disks, disk
-0000eec0: 7369 7a65 3d64 6973 6b73 697a 652c 2064  size=disksize, d
-0000eed0: 6973 6b74 6869 6e3d 6469 736b 7468 696e  iskthin=diskthin
-0000eee0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000eef0: 2020 2020 2020 2020 2020 2020 6469 736b              disk
-0000ef00: 696e 7465 7266 6163 653d 6469 736b 696e  interface=diskin
-0000ef10: 7465 7266 6163 652c 206e 6574 733d 6e65  terface, nets=ne
-0000ef20: 7473 2c20 6973 6f3d 6973 6f2c 2076 6e63  ts, iso=iso, vnc
-0000ef30: 3d62 6f6f 6c28 766e 6329 2c20 636c 6f75  =bool(vnc), clou
-0000ef40: 6469 6e69 743d 626f 6f6c 2863 6c6f 7564  dinit=bool(cloud
-0000ef50: 696e 6974 292c 0a20 2020 2020 2020 2020  init),.         
-0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef70: 2072 6573 6572 7665 6970 3d62 6f6f 6c28   reserveip=bool(
-0000ef80: 7265 7365 7276 6569 7029 2c20 7265 7365  reserveip), rese
-0000ef90: 7276 6564 6e73 3d62 6f6f 6c28 7265 7365  rvedns=bool(rese
-0000efa0: 7276 6564 6e73 292c 2072 6573 6572 7665  rvedns), reserve
-0000efb0: 686f 7374 3d62 6f6f 6c28 7265 7365 7276  host=bool(reserv
-0000efc0: 6568 6f73 7429 2c0a 2020 2020 2020 2020  ehost),.        
-0000efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efe0: 2020 7374 6172 743d 626f 6f6c 2873 7461    start=bool(sta
-0000eff0: 7274 292c 206b 6579 733d 6b65 7973 2c20  rt), keys=keys, 
-0000f000: 636d 6473 3d63 6d64 732c 2069 7073 3d69  cmds=cmds, ips=i
-0000f010: 7073 2c20 6e65 746d 6173 6b73 3d6e 6574  ps, netmasks=net
-0000f020: 6d61 736b 732c 2067 6174 6577 6179 3d67  masks, gateway=g
-0000f030: 6174 6577 6179 2c20 646e 733d 646e 732c  ateway, dns=dns,
-0000f040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f050: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
-0000f060: 6e3d 646f 6d61 696e 2c20 6e65 7374 6564  n=domain, nested
-0000f070: 3d62 6f6f 6c28 6e65 7374 6564 292c 2074  =bool(nested), t
-0000f080: 756e 6e65 6c3d 7475 6e6e 656c 2c20 6669  unnel=tunnel, fi
-0000f090: 6c65 733d 6669 6c65 732c 2065 6e61 626c  les=files, enabl
-0000f0a0: 6572 6f6f 743d 656e 6162 6c65 726f 6f74  eroot=enableroot
-0000f0b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f0c0: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-0000f0d0: 7269 6465 733d 6f76 6572 7269 6465 732c  rides=overrides,
-0000f0e0: 2074 6167 733d 7461 6773 2c20 7374 6f72   tags=tags, stor
-0000f0f0: 656d 6574 6164 6174 613d 7374 6f72 656d  emetadata=storem
-0000f100: 6574 6164 6174 612c 0a20 2020 2020 2020  etadata,.       
-0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f120: 2020 2073 6861 7265 6466 6f6c 6465 7273     sharedfolders
-0000f130: 3d73 6861 7265 6466 6f6c 6465 7273 2c20  =sharedfolders, 
-0000f140: 6b65 726e 656c 3d6b 6572 6e65 6c2c 2069  kernel=kernel, i
-0000f150: 6e69 7472 643d 696e 6974 7264 2c20 636d  nitrd=initrd, cm
-0000f160: 646c 696e 653d 636d 646c 696e 652c 0a20  dline=cmdline,. 
-0000f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f180: 2020 2020 2020 2020 2070 6c61 6365 6d65           placeme
-0000f190: 6e74 3d70 6c61 6365 6d65 6e74 2c20 6175  nt=placement, au
-0000f1a0: 746f 7374 6172 743d 6175 746f 7374 6172  tostart=autostar
-0000f1b0: 742c 2063 7075 686f 7470 6c75 673d 6370  t, cpuhotplug=cp
-0000f1c0: 7568 6f74 706c 7567 2c20 6d65 6d6f 7279  uhotplug, memory
-0000f1d0: 686f 7470 6c75 673d 6d65 6d6f 7279 686f  hotplug=memoryho
-0000f1e0: 7470 6c75 672c 0a20 2020 2020 2020 2020  tplug,.         
-0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f200: 2070 6369 6465 7669 6365 733d 7063 6964   pcidevices=pcid
-0000f210: 6576 6963 6573 2c20 7470 6d3d 7470 6d2c  evices, tpm=tpm,
-0000f220: 2072 6e67 3d72 6e67 2c20 6d65 7461 6461   rng=rng, metada
-0000f230: 7461 3d6d 6574 6164 6174 612c 2073 6563  ta=metadata, sec
-0000f240: 7572 6974 7967 726f 7570 733d 7365 6375  uritygroups=secu
-0000f250: 7269 7479 6772 6f75 7073 2c0a 2020 2020  ritygroups,.    
-0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f270: 2020 2020 2020 766d 7573 6572 3d76 6d75        vmuser=vmu
-0000f280: 7365 7229 0a20 2020 2020 2020 2069 6620  ser).        if 
-0000f290: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
-0000f2a0: 2021 3d20 2773 7563 6365 7373 273a 0a20   != 'success':. 
-0000f2b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000f2c0: 6e20 7265 7375 6c74 0a20 2020 2020 2020  n result.       
-0000f2d0: 2069 6620 7265 7365 7276 6564 6e73 2061   if reservedns a
-0000f2e0: 6e64 2064 6e73 636c 6965 6e74 2069 7320  nd dnsclient is 
-0000f2f0: 6e6f 7420 4e6f 6e65 2061 6e64 2064 6f6d  not None and dom
-0000f300: 6169 6e20 6973 206e 6f74 204e 6f6e 653a  ain is not None:
-0000f310: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000f320: 646e 7363 6c69 656e 7420 696e 2073 656c  dnsclient in sel
-0000f330: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
-0000f340: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
-0000f350: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
-0000f360: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
-0000f370: 2020 2020 2020 2020 2020 2069 7020 3d20             ip = 
-0000f380: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000f390: 2020 2020 2069 6620 6970 2069 7320 4e6f       if ip is No
-0000f3a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000f3b0: 2020 2020 2020 2020 636f 756e 7465 7220          counter 
-0000f3c0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0000f3d0: 2020 2020 2020 2020 7768 696c 6520 636f          while co
-0000f3e0: 756e 7465 7220 213d 2033 3030 3a0a 2020  unter != 300:.  
-0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f400: 2020 2020 2020 6970 203d 206b 2e69 7028        ip = k.ip(
-0000f410: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0000f420: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000f430: 2069 7020 6973 204e 6f6e 653a 0a20 2020   ip is None:.   
-0000f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f450: 2020 2020 2020 2020 2073 6c65 6570 2835           sleep(5
-0000f460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000f470: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000f480: 696e 7428 2257 6169 7469 6e67 2035 2073  int("Waiting 5 s
-0000f490: 6563 6f6e 6473 2074 6f20 6772 6162 2069  econds to grab i
-0000f4a0: 7020 616e 6420 6372 6561 7465 2044 4e53  p and create DNS
-0000f4b0: 2072 6563 6f72 642e 2e2e 2229 0a20 2020   record...").   
-0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4d0: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
-0000f4e0: 202b 3d20 3130 0a20 2020 2020 2020 2020   += 10.         
-0000f4f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000f500: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f520: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-0000f530: 2020 2020 2020 2069 6620 6970 2069 7320         if ip is 
-0000f540: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000f550: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0000f560: 2243 6f75 6c64 6e27 7420 6173 7369 676e  "Couldn't assign
-0000f570: 2044 4e53 2229 0a20 2020 2020 2020 2020   DNS").         
-0000f580: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5a0: 207a 2e72 6573 6572 7665 5f64 6e73 286e   z.reserve_dns(n
-0000f5b0: 616d 653d 6e61 6d65 2c20 6e65 7473 3d5b  ame=name, nets=[
-0000f5c0: 646f 6d61 696e 5d2c 2064 6f6d 6169 6e3d  domain], domain=
-0000f5d0: 646f 6d61 696e 2c20 6970 3d69 702c 2066  domain, ip=ip, f
-0000f5e0: 6f72 6365 3d54 7275 6529 0a20 2020 2020  orce=True).     
-0000f5f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f600: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0000f610: 6e69 6e67 2866 2243 6c69 656e 7420 7b64  ning(f"Client {d
-0000f620: 6e73 636c 6965 6e74 7d20 6e6f 7420 666f  nsclient} not fo
-0000f630: 756e 642e 2053 6b69 7070 696e 6722 290a  und. Skipping").
-0000f640: 2020 2020 2020 2020 6966 206f 732e 6163          if os.ac
-0000f650: 6365 7373 286f 732e 7061 7468 2e65 7870  cess(os.path.exp
-0000f660: 616e 6475 7365 7228 277e 2f2e 6b63 6c69  anduser('~/.kcli
-0000f670: 2729 2c20 6f73 2e57 5f4f 4b29 3a0a 2020  '), os.W_OK):.  
-0000f680: 2020 2020 2020 2020 2020 636c 6965 6e74            client
-0000f690: 203d 2063 6c69 656e 7420 6966 2063 6c69   = client if cli
-0000f6a0: 656e 7420 6973 206e 6f74 204e 6f6e 6520  ent is not None 
-0000f6b0: 656c 7365 2073 656c 662e 636c 6965 6e74  else self.client
-0000f6c0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0000f6d0: 6d6f 6e2e 7365 745f 6c61 7374 766d 286e  mon.set_lastvm(n
-0000f6e0: 616d 652c 2063 6c69 656e 7429 0a20 2020  ame, client).   
-0000f6f0: 2020 2020 2061 6e73 6962 6c65 7072 6f66       ansibleprof
-0000f700: 696c 6520 3d20 7072 6f66 696c 652e 6765  ile = profile.ge
-0000f710: 7428 2761 6e73 6962 6c65 2729 0a20 2020  t('ansible').   
-0000f720: 2020 2020 2069 6620 616e 7369 626c 6570       if ansiblep
-0000f730: 726f 6669 6c65 2069 7320 6e6f 7420 4e6f  rofile is not No
-0000f740: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000f750: 6966 2077 6869 6368 2827 616e 7369 626c  if which('ansibl
-0000f760: 652d 706c 6179 626f 6f6b 2729 2069 7320  e-playbook') is 
-0000f770: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000f780: 2020 2020 2020 7761 726e 696e 6728 2261        warning("a
-0000f790: 6e73 6962 6c65 2d70 6c61 7962 6f6f 6b20  nsible-playbook 
-0000f7a0: 6578 6563 7574 6162 6c65 206e 6f74 2066  executable not f
-0000f7b0: 6f75 6e64 2e20 536b 6970 7069 6e67 2061  ound. Skipping a
-0000f7c0: 6e73 6962 6c65 2070 6c61 7922 290a 2020  nsible play").  
-0000f7d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7f0: 666f 7220 656c 656d 656e 7420 696e 2061  for element in a
-0000f800: 6e73 6962 6c65 7072 6f66 696c 653a 0a20  nsibleprofile:. 
-0000f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f820: 2020 2069 6620 2770 6c61 7962 6f6f 6b27     if 'playbook'
-0000f830: 206e 6f74 2069 6e20 656c 656d 656e 743a   not in element:
-0000f840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f850: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0000f860: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000f870: 2020 2020 2020 706c 6179 626f 6f6b 203d        playbook =
-0000f880: 2065 6c65 6d65 6e74 5b27 706c 6179 626f   element['playbo
-0000f890: 6f6b 275d 0a20 2020 2020 2020 2020 2020  ok'].           
-0000f8a0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0000f8b0: 6573 203d 2065 6c65 6d65 6e74 2e67 6574  es = element.get
-0000f8c0: 2827 7661 7269 6162 6c65 7327 2c20 7b7d  ('variables', {}
-0000f8d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000f8e0: 2020 2020 2020 7665 7262 6f73 6520 3d20        verbose = 
-0000f8f0: 656c 656d 656e 742e 6765 7428 2776 6572  element.get('ver
-0000f900: 626f 7365 272c 2046 616c 7365 290a 2020  bose', False).  
-0000f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f920: 2020 7573 6572 203d 2065 6c65 6d65 6e74    user = element
-0000f930: 2e67 6574 2827 7573 6572 2729 0a20 2020  .get('user').   
-0000f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f950: 2061 6e73 6962 6c65 7574 696c 732e 706c   ansibleutils.pl
-0000f960: 6179 286b 2c20 6e61 6d65 2c20 706c 6179  ay(k, name, play
-0000f970: 626f 6f6b 3d70 6c61 7962 6f6f 6b2c 2076  book=playbook, v
-0000f980: 6172 6961 626c 6573 3d76 6172 6961 626c  ariables=variabl
-0000f990: 6573 2c20 7665 7262 6f73 653d 7665 7262  es, verbose=verb
-0000f9a0: 6f73 652c 2075 7365 723d 7573 6572 2c0a  ose, user=user,.
-0000f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9d0: 2020 2020 2020 7475 6e6e 656c 3d73 656c        tunnel=sel
-0000f9e0: 662e 7475 6e6e 656c 2c20 7475 6e6e 656c  f.tunnel, tunnel
-0000f9f0: 686f 7374 3d73 656c 662e 686f 7374 2c20  host=self.host, 
-0000fa00: 7475 6e6e 656c 706f 7274 3d73 656c 662e  tunnelport=self.
-0000fa10: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
-0000fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa30: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
-0000fa40: 656c 7573 6572 3d73 656c 662e 7573 6572  eluser=self.user
-0000fa50: 2c20 7961 6d6c 696e 7665 6e74 6f72 793d  , yamlinventory=
-0000fa60: 7961 6d6c 696e 7665 6e74 6f72 792c 2069  yamlinventory, i
-0000fa70: 6e73 6563 7572 653d 7365 6c66 2e69 6e73  nsecure=self.ins
-0000fa80: 6563 7572 6529 0a20 2020 2020 2020 2075  ecure).        u
-0000fa90: 6e70 6c75 6763 6420 3d20 6f76 6572 7269  nplugcd = overri
-0000faa0: 6465 732e 6765 7428 2775 6e70 6c75 6763  des.get('unplugc
-0000fab0: 6427 2c20 4661 6c73 6529 0a20 2020 2020  d', False).     
-0000fac0: 2020 2069 6620 7761 6974 206f 7220 756e     if wait or un
-0000fad0: 706c 7567 6364 3a0a 2020 2020 2020 2020  plugcd:.        
-0000fae0: 2020 2020 6966 206e 6f74 2063 6c6f 7564      if not cloud
-0000faf0: 696e 6974 206f 7220 6e6f 7420 7374 6172  init or not star
-0000fb00: 7420 6f72 2069 6d61 6765 2069 7320 4e6f  t or image is No
-0000fb10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000fb20: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
-0000fb30: 7070 696e 6720 7761 6974 206f 6e20 7b6e  pping wait on {n
-0000fb40: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
-0000fb50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000fb60: 2020 2020 2020 2020 2069 6465 6e74 6974           identit
-0000fb70: 7966 696c 6520 3d20 4e6f 6e65 0a20 2020  yfile = None.   
-0000fb80: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-0000fb90: 706b 6579 5f63 6c65 616e 203d 2046 616c  pkey_clean = Fal
-0000fba0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-0000fbb0: 2020 2069 6620 6f76 6572 7269 6465 732e     if overrides.
-0000fbc0: 6765 7428 2774 656d 706b 6579 6469 7227  get('tempkeydir'
-0000fbd0: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
-0000fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbf0: 2020 2069 6465 6e74 6974 7966 696c 6520     identityfile 
-0000fc00: 3d20 6622 7b6f 7665 7272 6964 6573 5b27  = f"{overrides['
-0000fc10: 7465 6d70 6b65 7964 6972 275d 2e6e 616d  tempkeydir'].nam
-0000fc20: 657d 2f69 645f 7273 6122 0a20 2020 2020  e}/id_rsa".     
-0000fc30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000fc40: 656d 706b 6579 5f63 6c65 616e 203d 2054  empkey_clean = T
-0000fc50: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0000fc60: 2020 2020 7365 6c66 2e77 6169 745f 6669      self.wait_fi
-0000fc70: 6e69 7368 286e 616d 652c 2069 6d61 6765  nish(name, image
-0000fc80: 3d69 6d61 6765 2c20 7761 6974 636f 6d6d  =image, waitcomm
-0000fc90: 616e 643d 7761 6974 636f 6d6d 616e 642c  and=waitcommand,
-0000fca0: 2077 6169 7474 696d 656f 7574 3d77 6169   waittimeout=wai
-0000fcb0: 7474 696d 656f 7574 2c0a 2020 2020 2020  ttimeout,.      
-0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcd0: 2020 2020 2020 2020 2020 2069 6465 6e74             ident
-0000fce0: 6974 7966 696c 653d 6964 656e 7469 7479  ityfile=identity
-0000fcf0: 6669 6c65 2c20 766d 636c 6965 6e74 3d63  file, vmclient=c
-0000fd00: 6c69 656e 7429 0a20 2020 2020 2020 2020  lient).         
-0000fd10: 2020 2020 2020 2066 696e 6973 6866 696c         finishfil
-0000fd20: 6573 203d 2070 726f 6669 6c65 2e67 6574  es = profile.get
-0000fd30: 2827 6669 6e69 7368 6669 6c65 7327 2c20  ('finishfiles', 
-0000fd40: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
-0000fd50: 2020 2020 6966 2066 696e 6973 6866 696c      if finishfil
-0000fd60: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000fd70: 2020 2020 2020 2020 7365 6c66 2e68 616e          self.han
-0000fd80: 646c 655f 6669 6e69 7368 6669 6c65 7328  dle_finishfiles(
-0000fd90: 6e61 6d65 2c20 6669 6e69 7368 6669 6c65  name, finishfile
-0000fda0: 732c 2069 6465 6e74 6974 7966 696c 653d  s, identityfile=
-0000fdb0: 6964 656e 7469 7479 6669 6c65 2c20 766d  identityfile, vm
-0000fdc0: 636c 6965 6e74 3d63 6c69 656e 7429 0a20  client=client). 
-0000fdd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000fde0: 6620 7465 6d70 6b65 795f 636c 6561 6e3a  f tempkey_clean:
-0000fdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fe00: 2020 2020 2073 656c 662e 636c 6561 6e5f       self.clean_
-0000fe10: 7465 6d70 6b65 7928 6e61 6d65 2c20 6964  tempkey(name, id
-0000fe20: 656e 7469 7479 6669 6c65 3d69 6465 6e74  entityfile=ident
-0000fe30: 6974 7966 696c 6529 0a20 2020 2020 2020  ityfile).       
-0000fe40: 2020 2020 2069 6620 756e 706c 7567 6364       if unplugcd
-0000fe50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fe60: 2020 7365 6c66 2e6b 2e75 7064 6174 655f    self.k.update_
-0000fe70: 6973 6f28 6e61 6d65 2c20 4e6f 6e65 290a  iso(name, None).
-0000fe80: 2020 2020 2020 2020 6966 206f 7665 7272          if overr
-0000fe90: 6964 6573 2e67 6574 2827 7465 6d70 6b65  ides.get('tempke
-0000fea0: 7964 6972 2729 2069 7320 6e6f 7420 4e6f  ydir') is not No
-0000feb0: 6e65 2061 6e64 206e 6f74 206f 7665 7272  ne and not overr
-0000fec0: 6964 6573 2e67 6574 2827 7465 6d70 6b65  ides.get('tempke
-0000fed0: 7964 6972 6b65 6570 272c 2046 616c 7365  ydirkeep', False
-0000fee0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-0000fef0: 7665 7272 6964 6573 2e67 6574 2827 7465  verrides.get('te
-0000ff00: 6d70 6b65 7964 6972 2729 2e63 6c65 616e  mpkeydir').clean
-0000ff10: 7570 2829 0a20 2020 2020 2020 2072 6574  up().        ret
-0000ff20: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-0000ff30: 7375 6363 6573 7327 2c20 2776 6d27 3a20  success', 'vm': 
-0000ff40: 6e61 6d65 7d0a 0a20 2020 2064 6566 2075  name}..    def u
-0000ff50: 7064 6174 655f 766d 2873 656c 662c 206e  pdate_vm(self, n
-0000ff60: 616d 652c 206f 7665 7272 6964 6573 293a  ame, overrides):
-0000ff70: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-0000ff80: 662e 6b0a 2020 2020 2020 2020 6970 203d  f.k.        ip =
-0000ff90: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-0000ffa0: 6970 2729 0a20 2020 2020 2020 2066 6c61  ip').        fla
-0000ffb0: 766f 7220 3d20 6f76 6572 7269 6465 732e  vor = overrides.
-0000ffc0: 6765 7428 2766 6c61 766f 7227 290a 2020  get('flavor').  
-0000ffd0: 2020 2020 2020 6e75 6d63 7075 7320 3d20        numcpus = 
-0000ffe0: 6f76 6572 7269 6465 732e 6765 7428 276e  overrides.get('n
-0000fff0: 756d 6370 7573 2729 0a20 2020 2020 2020  umcpus').       
-00010000: 206d 656d 6f72 7920 3d20 6f76 6572 7269   memory = overri
-00010010: 6465 732e 6765 7428 276d 656d 6f72 7927  des.get('memory'
-00010020: 290a 2020 2020 2020 2020 6175 746f 7374  ).        autost
-00010030: 6172 7420 3d20 6f76 6572 7269 6465 732e  art = overrides.
-00010040: 6765 7428 2761 7574 6f73 7461 7274 2729  get('autostart')
-00010050: 0a20 2020 2020 2020 2064 6e73 203d 206f  .        dns = o
-00010060: 7665 7272 6964 6573 2e67 6574 2827 646e  verrides.get('dn
-00010070: 7327 290a 2020 2020 2020 2020 686f 7374  s').        host
-00010080: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-00010090: 2827 686f 7374 2729 0a20 2020 2020 2020  ('host').       
-000100a0: 2064 6f6d 6169 6e20 3d20 6f76 6572 7269   domain = overri
-000100b0: 6465 732e 6765 7428 2764 6f6d 6169 6e27  des.get('domain'
-000100c0: 290a 2020 2020 2020 2020 636c 6f75 6469  ).        cloudi
-000100d0: 6e69 7420 3d20 6f76 6572 7269 6465 732e  nit = overrides.
-000100e0: 6765 7428 2763 6c6f 7564 696e 6974 2729  get('cloudinit')
-000100f0: 0a20 2020 2020 2020 2069 6d61 6765 203d  .        image =
-00010100: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00010110: 696d 6167 6527 290a 2020 2020 2020 2020  image').        
-00010120: 6e65 7473 203d 206f 7665 7272 6964 6573  nets = overrides
-00010130: 2e67 6574 2827 6e65 7473 2729 0a20 2020  .get('nets').   
-00010140: 2020 2020 2064 6973 6b73 203d 206f 7665       disks = ove
-00010150: 7272 6964 6573 2e67 6574 2827 6469 736b  rrides.get('disk
-00010160: 7327 290a 2020 2020 2020 2020 696e 666f  s').        info
-00010170: 726d 6174 696f 6e20 3d20 6f76 6572 7269  rmation = overri
-00010180: 6465 732e 6765 7428 2769 6e66 6f72 6d61  des.get('informa
-00010190: 7469 6f6e 2729 0a20 2020 2020 2020 2063  tion').        c
-000101a0: 7075 666c 6167 7320 3d20 6f76 6572 7269  puflags = overri
-000101b0: 6465 732e 6765 7428 2763 7075 666c 6167  des.get('cpuflag
-000101c0: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-000101d0: 6469 7361 626c 6520 3d20 6f76 6572 7269  disable = overri
-000101e0: 6465 732e 6765 7428 2764 6973 6162 6c65  des.get('disable
-000101f0: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
-00010200: 2020 6f76 6572 7269 6465 732e 706f 7028    overrides.pop(
-00010210: 2764 6973 6162 6c65 272c 204e 6f6e 6529  'disable', None)
-00010220: 0a20 2020 2020 2020 2065 7874 7261 5f6d  .        extra_m
-00010230: 6574 6164 6174 6120 3d20 7b6b 3a20 6f76  etadata = {k: ov
-00010240: 6572 7269 6465 735b 6b5d 2066 6f72 206b  errides[k] for k
-00010250: 2069 6e20 6f76 6572 7269 6465 7320 6966   in overrides if
-00010260: 206b 206e 6f74 2069 6e20 7365 6c66 2e6c   k not in self.l
-00010270: 6973 745f 6b65 7977 6f72 6473 2829 7d0a  ist_keywords()}.
-00010280: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
-00010290: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-000102a0: 2827 7465 6d70 6c61 7465 2729 0a20 2020  ('template').   
-000102b0: 2020 2020 2069 6620 7465 6d70 6c61 7465       if template
-000102c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000102d0: 2020 2020 2020 2020 2020 6465 6c20 6578            del ex
-000102e0: 7472 615f 6d65 7461 6461 7461 5b27 7465  tra_metadata['te
-000102f0: 6d70 6c61 7465 275d 0a20 2020 2020 2020  mplate'].       
-00010300: 2069 6620 646e 733a 0a20 2020 2020 2020   if dns:.       
-00010310: 2020 2020 2070 7072 696e 7428 6622 4372       pprint(f"Cr
-00010320: 6561 7469 6e67 2044 6e73 2065 6e74 7279  eating Dns entry
-00010330: 2066 6f72 207b 6e61 6d65 7d2e 2e2e 2229   for {name}...")
-00010340: 0a20 2020 2020 2020 2020 2020 206e 6574  .            net
-00010350: 776f 726b 7320 3d20 6b2e 766d 5f70 6f72  works = k.vm_por
-00010360: 7473 286e 616d 6529 0a20 2020 2020 2020  ts(name).       
-00010370: 2020 2020 2069 6620 6e65 7477 6f72 6b73       if networks
-00010380: 2061 6e64 2064 6f6d 6169 6e20 6973 204e   and domain is N
-00010390: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000103a0: 2020 2020 2064 6f6d 6169 6e20 3d20 6e65       domain = ne
-000103b0: 7477 6f72 6b73 5b30 5d0a 2020 2020 2020  tworks[0].      
-000103c0: 2020 2020 2020 6966 206e 6f74 206e 6574        if not net
-000103d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000103e0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-000103f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010400: 2020 2020 2020 2020 2020 2020 6b2e 7265              k.re
-00010410: 7365 7276 655f 646e 7328 6e61 6d65 3d6e  serve_dns(name=n
-00010420: 616d 652c 206e 6574 733d 6e65 7477 6f72  ame, nets=networ
-00010430: 6b73 2c20 646f 6d61 696e 3d64 6f6d 6169  ks, domain=domai
-00010440: 6e2c 2069 703d 6970 290a 2020 2020 2020  n, ip=ip).      
-00010450: 2020 6966 2069 7020 6973 206e 6f74 204e    if ip is not N
-00010460: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00010470: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
-00010480: 6e67 2069 7020 6f66 2076 6d20 7b6e 616d  ng ip of vm {nam
-00010490: 657d 2074 6f20 7b69 707d 2e2e 2e22 290a  e} to {ip}...").
-000104a0: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
-000104b0: 6461 7465 5f6d 6574 6164 6174 6128 6e61  date_metadata(na
-000104c0: 6d65 2c20 2769 7027 2c20 6970 290a 2020  me, 'ip', ip).  
-000104d0: 2020 2020 2020 6966 2063 6c6f 7564 696e        if cloudin
-000104e0: 6974 3a0a 2020 2020 2020 2020 2020 2020  it:.            
-000104f0: 7070 7269 6e74 2866 2252 656d 6f76 696e  pprint(f"Removin
-00010500: 6720 636c 6f75 6469 6e69 7420 696e 666f  g cloudinit info
-00010510: 726d 6174 696f 6e20 6f66 2076 6d20 7b6e  rmation of vm {n
-00010520: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
-00010530: 2020 206b 2e72 656d 6f76 655f 636c 6f75     k.remove_clou
-00010540: 6469 6e69 7428 6e61 6d65 290a 2020 2020  dinit(name).    
-00010550: 2020 2020 6966 2069 6d61 6765 2069 7320      if image is 
-00010560: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00010570: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-00010580: 7064 6174 696e 6720 696d 6167 6520 6f66  pdating image of
-00010590: 2076 6d20 7b6e 616d 657d 2074 6f20 7b69   vm {name} to {i
-000105a0: 6d61 6765 7d2e 2e2e 2229 0a20 2020 2020  mage}...").     
-000105b0: 2020 2020 2020 206b 2e75 7064 6174 655f         k.update_
-000105c0: 6d65 7461 6461 7461 286e 616d 652c 2027  metadata(name, '
-000105d0: 696d 6167 6527 2c20 696d 6167 6529 0a20  image', image). 
-000105e0: 2020 2020 2020 2069 6620 6d65 6d6f 7279         if memory
-000105f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00010600: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00010610: 2866 2255 7064 6174 696e 6720 6d65 6d6f  (f"Updating memo
-00010620: 7279 206f 6620 766d 207b 6e61 6d65 7d20  ry of vm {name} 
-00010630: 746f 207b 6d65 6d6f 7279 7d2e 2e2e 2229  to {memory}...")
-00010640: 0a20 2020 2020 2020 2020 2020 206b 2e75  .            k.u
-00010650: 7064 6174 655f 6d65 6d6f 7279 286e 616d  pdate_memory(nam
-00010660: 652c 206d 656d 6f72 7929 0a20 2020 2020  e, memory).     
-00010670: 2020 2069 6620 6e75 6d63 7075 7320 6973     if numcpus is
-00010680: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00010690: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-000106a0: 5570 6461 7469 6e67 206e 756d 6370 7573  Updating numcpus
-000106b0: 206f 6620 766d 207b 6e61 6d65 7d20 746f   of vm {name} to
-000106c0: 207b 6e75 6d63 7075 737d 2e2e 2e22 290a   {numcpus}...").
-000106d0: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
-000106e0: 6461 7465 5f63 7075 7328 6e61 6d65 2c20  date_cpus(name, 
-000106f0: 6e75 6d63 7075 7329 0a20 2020 2020 2020  numcpus).       
-00010700: 2069 6620 6175 746f 7374 6172 7420 6973   if autostart is
-00010710: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00010720: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00010730: 5365 7474 696e 6720 6175 746f 7374 6172  Setting autostar
-00010740: 7420 746f 207b 6175 746f 7374 6172 747d  t to {autostart}
-00010750: 2066 6f72 2076 6d20 7b6e 616d 657d 2e2e   for vm {name}..
-00010760: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00010770: 6b2e 7570 6461 7465 5f73 7461 7274 286e  k.update_start(n
-00010780: 616d 652c 2073 7461 7274 3d61 7574 6f73  ame, start=autos
-00010790: 7461 7274 290a 2020 2020 2020 2020 6966  tart).        if
-000107a0: 2069 6e66 6f72 6d61 7469 6f6e 3a0a 2020   information:.  
-000107b0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-000107c0: 2866 2253 6574 7469 6e67 2069 6e66 6f72  (f"Setting infor
-000107d0: 6d61 7469 6f6e 2066 6f72 2076 6d20 7b6e  mation for vm {n
-000107e0: 616d 657d 2e2e 2e22 290a 2020 2020 2020  ame}...").      
-000107f0: 2020 2020 2020 6b2e 7570 6461 7465 5f69        k.update_i
-00010800: 6e66 6f72 6d61 7469 6f6e 286e 616d 652c  nformation(name,
-00010810: 2069 6e66 6f72 6d61 7469 6f6e 290a 2020   information).  
-00010820: 2020 2020 2020 6966 2027 6973 6f27 2069        if 'iso' i
-00010830: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
-00010840: 2020 2020 2020 2020 2069 736f 203d 206f           iso = o
-00010850: 7665 7272 6964 6573 5b27 6973 6f27 5d0a  verrides['iso'].
-00010860: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00010870: 6e74 2866 2253 7769 7463 6869 6e67 2069  nt(f"Switching i
-00010880: 736f 2066 6f72 2076 6d20 7b6e 616d 657d  so for vm {name}
-00010890: 2074 6f20 7b69 736f 7d2e 2e2e 2229 0a20   to {iso}..."). 
-000108a0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-000108b0: 6f20 3d3d 2027 4e6f 6e65 2720 6f72 2069  o == 'None' or i
-000108c0: 736f 203d 3d20 2727 3a0a 2020 2020 2020  so == '':.      
-000108d0: 2020 2020 2020 2020 2020 6973 6f20 3d20            iso = 
-000108e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000108f0: 206b 2e75 7064 6174 655f 6973 6f28 6e61   k.update_iso(na
-00010900: 6d65 2c20 6973 6f29 0a20 2020 2020 2020  me, iso).       
-00010910: 2069 6620 666c 6176 6f72 2069 7320 6e6f   if flavor is no
-00010920: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00010930: 2020 2020 7070 7269 6e74 2866 2255 7064      pprint(f"Upd
-00010940: 6174 696e 6720 666c 6176 6f72 206f 6620  ating flavor of 
-00010950: 766d 207b 6e61 6d65 7d20 746f 207b 666c  vm {name} to {fl
-00010960: 6176 6f72 7d2e 2e2e 2229 0a20 2020 2020  avor}...").     
-00010970: 2020 2020 2020 206b 2e75 7064 6174 655f         k.update_
-00010980: 666c 6176 6f72 286e 616d 652c 2066 6c61  flavor(name, fla
-00010990: 766f 7229 0a20 2020 2020 2020 2069 6620  vor).        if 
-000109a0: 686f 7374 3a0a 2020 2020 2020 2020 2020  host:.          
-000109b0: 2020 7070 7269 6e74 2866 2243 7265 6174    pprint(f"Creat
-000109c0: 696e 6720 486f 7374 2065 6e74 7279 2066  ing Host entry f
-000109d0: 6f72 2076 6d20 7b6e 616d 657d 2e2e 2e22  or vm {name}..."
-000109e0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-000109f0: 7477 6f72 6b73 203d 206b 2e76 6d5f 706f  tworks = k.vm_po
-00010a00: 7274 7328 6e61 6d65 290a 2020 2020 2020  rts(name).      
-00010a10: 2020 2020 2020 6966 206e 6574 776f 726b        if network
-00010a20: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00010a30: 2020 2069 6620 646f 6d61 696e 2069 7320     if domain is 
-00010a40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00010a50: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-00010a60: 203d 206e 6574 776f 726b 735b 305d 0a20   = networks[0]. 
-00010a70: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00010a80: 2e72 6573 6572 7665 5f68 6f73 7428 6e61  .reserve_host(na
-00010a90: 6d65 2c20 6e65 7477 6f72 6b73 2c20 646f  me, networks, do
-00010aa0: 6d61 696e 290a 2020 2020 2020 2020 6375  main).        cu
-00010ab0: 7272 656e 7476 6d20 3d20 6b2e 696e 666f  rrentvm = k.info
-00010ac0: 286e 616d 6529 0a20 2020 2020 2020 2063  (name).        c
-00010ad0: 7572 7265 6e74 6e65 7473 203d 2063 7572  urrentnets = cur
-00010ae0: 7265 6e74 766d 2e67 6574 2827 6e65 7473  rentvm.get('nets
-00010af0: 272c 205b 5d29 0a20 2020 2020 2020 2063  ', []).        c
-00010b00: 7572 7265 6e74 6469 736b 7320 3d20 6375  urrentdisks = cu
-00010b10: 7272 656e 7476 6d2e 6765 7428 2764 6973  rrentvm.get('dis
-00010b20: 6b73 272c 205b 5d29 0a20 2020 2020 2020  ks', []).       
-00010b30: 2069 6620 6469 736b 733a 0a20 2020 2020   if disks:.     
-00010b40: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00010b50: 5570 6461 7469 6e67 2064 6973 6b73 206f  Updating disks o
-00010b60: 6620 766d 207b 6e61 6d65 7d22 290a 2020  f vm {name}").  
-00010b70: 2020 2020 2020 2020 2020 666f 7220 696e            for in
-00010b80: 6465 782c 2063 7572 7265 6e74 6469 736b  dex, currentdisk
-00010b90: 2069 6e20 656e 756d 6572 6174 6528 6375   in enumerate(cu
-00010ba0: 7272 656e 7464 6973 6b73 293a 0a20 2020  rrentdisks):.   
-00010bb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010bc0: 696e 6465 7820 3c20 6c65 6e28 6469 736b  index < len(disk
-00010bd0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00010be0: 2020 2020 2020 2020 6469 736b 203d 2064          disk = d
-00010bf0: 6973 6b73 5b69 6e64 6578 5d0a 2020 2020  isks[index].    
-00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c10: 6375 7272 656e 7464 6973 6b73 697a 6520  currentdisksize 
-00010c20: 3d20 6375 7272 656e 7464 6973 6b5b 2773  = currentdisk['s
-00010c30: 697a 6527 5d0a 2020 2020 2020 2020 2020  ize'].          
-00010c40: 2020 2020 2020 2020 2020 6469 736b 7369            disksi
-00010c50: 7a65 203d 2064 6973 6b2e 6765 7428 2773  ze = disk.get('s
-00010c60: 697a 6527 2c20 3130 2920 6966 2069 7369  ize', 10) if isi
-00010c70: 6e73 7461 6e63 6528 6469 736b 2c20 6469  nstance(disk, di
-00010c80: 6374 2920 656c 7365 2069 6e74 2864 6973  ct) else int(dis
-00010c90: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
-00010ca0: 2020 2020 2020 2069 6620 6469 736b 7369         if disksi
-00010cb0: 7a65 203e 2063 7572 7265 6e74 6469 736b  ze > currentdisk
-00010cc0: 7369 7a65 3a0a 2020 2020 2020 2020 2020  size:.          
-00010cd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010ce0: 2063 7572 7265 6e74 766d 2e67 6574 2827   currentvm.get('
-00010cf0: 7374 6174 7573 2729 2021 3d20 2764 6f77  status') != 'dow
-00010d00: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-00010d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d20: 7761 726e 696e 6728 6622 4361 6e74 2072  warning(f"Cant r
-00010d30: 6573 697a 6520 4469 736b 207b 696e 6465  esize Disk {inde
-00010d40: 787d 2069 6e20 7b6e 616d 657d 2077 6869  x} in {name} whi
-00010d50: 6c65 2056 4d20 6973 2075 7022 290a 2020  le VM is up").  
-00010d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d70: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d90: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00010da0: 2252 6573 697a 696e 6720 4469 736b 207b  "Resizing Disk {
-00010db0: 696e 6465 787d 2069 6e20 7b6e 616d 657d  index} in {name}
-00010dc0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00010dd0: 2020 2020 2020 2020 2020 2064 6973 6b70             diskp
-00010de0: 6174 6820 3d20 6375 7272 656e 7464 6973  ath = currentdis
-00010df0: 6b5b 2770 6174 6827 5d0a 2020 2020 2020  k['path'].      
-00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e10: 2020 6b2e 7265 7369 7a65 5f64 6973 6b28    k.resize_disk(
-00010e20: 6469 736b 7061 7468 2c20 6469 736b 7369  diskpath, disksi
-00010e30: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-00010e40: 6966 206c 656e 2863 7572 7265 6e74 6469  if len(currentdi
-00010e50: 736b 7329 203c 206c 656e 2864 6973 6b73  sks) < len(disks
-00010e60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00010e70: 2020 2070 7072 696e 7428 6622 4164 6469     pprint(f"Addi
-00010e80: 6e67 2044 6973 6b73 2074 6f20 7b6e 616d  ng Disks to {nam
-00010e90: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00010ea0: 2020 2020 2066 6f72 2064 6973 6b20 696e       for disk in
-00010eb0: 2064 6973 6b73 5b6c 656e 2863 7572 7265   disks[len(curre
-00010ec0: 6e74 6469 736b 7329 3a5d 3a0a 2020 2020  ntdisks):]:.    
-00010ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ee0: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
-00010ef0: 736b 2c20 696e 7429 3a0a 2020 2020 2020  sk, int):.      
+0000e710: 2020 6672 6565 5f69 7020 3d20 6672 6565    free_ip = free
+0000e720: 5f69 7073 5b30 5d0a 2020 2020 2020 2020  _ips[0].        
+0000e730: 2020 2020 2020 2020 2020 2020 6970 5f72              ip_r
+0000e740: 6573 6572 7661 7469 6f6e 735b 6e61 6d65  eservations[name
+0000e750: 5d20 3d20 6672 6565 5f69 700a 2020 2020  ] = free_ip.    
+0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e770: 7070 7269 6e74 2866 2255 7369 6e67 2069  pprint(f"Using i
+0000e780: 7020 7b66 7265 655f 6970 7d20 6672 6f6d  p {free_ip} from
+0000e790: 2063 6f6e 6670 6f6f 6c20 7b63 6f6e 6670   confpool {confp
+0000e7a0: 6f6f 6c7d 2069 6e20 6e65 7420 7b69 6e64  ool} in net {ind
+0000e7b0: 6578 7d22 290a 2020 2020 2020 2020 2020  ex}").          
+0000e7c0: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
+0000e7d0: 6e66 203d 2063 7572 7265 6e74 636f 6e66  nf = currentconf
+0000e7e0: 706f 6f6c 2e63 6f70 7928 290a 2020 2020  pool.copy().    
+0000e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e800: 6e65 775f 636f 6e66 5b27 6970 275d 203d  new_conf['ip'] =
+0000e810: 2066 7265 655f 6970 0a20 2020 2020 2020   free_ip.       
+0000e820: 2020 2020 2020 2020 2020 2020 206e 6574               net
+0000e830: 735b 696e 6465 785d 2e75 7064 6174 6528  s[index].update(
+0000e840: 6375 7272 656e 7463 6f6e 6670 6f6f 6c29  currentconfpool)
+0000e850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e860: 2020 2020 2069 6620 6e6f 7420 6f6e 6c79       if not only
+0000e870: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+0000e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e890: 7365 6c66 2e75 7064 6174 655f 636f 6e66  self.update_conf
+0000e8a0: 706f 6f6c 2863 6f6e 6670 6f6f 6c2c 207b  pool(confpool, {
+0000e8b0: 2769 705f 7265 7365 7276 6174 696f 6e73  'ip_reservations
+0000e8c0: 273a 2069 705f 7265 7365 7276 6174 696f  ': ip_reservatio
+0000e8d0: 6e73 7d29 0a20 2020 2020 2020 2020 2020  ns}).           
+0000e8e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000e8f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000e900: 7272 6f72 2866 224e 6f20 6176 6169 6c61  rror(f"No availa
+0000e910: 626c 6520 6970 2069 6e20 636f 6e66 706f  ble ip in confpo
+0000e920: 6f6c 207b 636f 6e66 706f 6f6c 7d22 290a  ol {confpool}").
+0000e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e940: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+0000e950: 2020 2020 2020 2020 6966 206f 6e6c 7961          if onlya
+0000e960: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0000e970: 2020 2069 6d61 6765 203d 2069 6d61 6765     image = image
+0000e980: 206f 7220 7072 6f66 696c 656e 616d 650a   or profilename.
+0000e990: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0000e9a0: 6f6d 6d6f 6e2e 6e65 6564 735f 6967 6e69  ommon.needs_igni
+0000e9b0: 7469 6f6e 2869 6d61 6765 293a 0a20 2020  tion(image):.   
+0000e9c0: 2020 2020 2020 2020 2020 2020 2076 6572               ver
+0000e9d0: 7369 6f6e 203d 2063 6f6d 6d6f 6e2e 6967  sion = common.ig
+0000e9e0: 6e69 7469 6f6e 5f76 6572 7369 6f6e 2869  nition_version(i
+0000e9f0: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+0000ea00: 2020 2020 2020 636f 6d70 6163 7420 3d20        compact = 
+0000ea10: 5472 7565 2069 6620 6f76 6572 7269 6465  True if override
+0000ea20: 732e 6765 7428 2763 6f6d 7061 6374 2729  s.get('compact')
+0000ea30: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
+0000ea40: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0000ea50: 203d 2063 6f6d 6d6f 6e2e 6967 6e69 7469   = common.igniti
+0000ea60: 6f6e 286e 616d 653d 6e61 6d65 2c20 6b65  on(name=name, ke
+0000ea70: 7973 3d6b 6579 732c 2063 6d64 733d 636d  ys=keys, cmds=cm
+0000ea80: 6473 2c20 6e65 7473 3d6e 6574 732c 2067  ds, nets=nets, g
+0000ea90: 6174 6577 6179 3d67 6174 6577 6179 2c20  ateway=gateway, 
+0000eaa0: 646e 733d 646e 732c 0a20 2020 2020 2020  dns=dns,.       
+0000eab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ead0: 646f 6d61 696e 3d64 6f6d 6169 6e2c 2066  domain=domain, f
+0000eae0: 696c 6573 3d66 696c 6573 2c20 656e 6162  iles=files, enab
+0000eaf0: 6c65 726f 6f74 3d65 6e61 626c 6572 6f6f  leroot=enableroo
+0000eb00: 742c 206f 7665 7272 6964 6573 3d6f 7665  t, overrides=ove
+0000eb10: 7272 6964 6573 2c0a 2020 2020 2020 2020  rrides,.        
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000eb40: 6572 7369 6f6e 3d76 6572 7369 6f6e 2c20  ersion=version, 
+0000eb50: 706c 616e 3d70 6c61 6e2c 2069 6d61 6765  plan=plan, image
+0000eb60: 3d69 6d61 6765 2c20 636f 6d70 6163 743d  =image, compact=
+0000eb70: 636f 6d70 6163 742c 0a20 2020 2020 2020  compact,.       
+0000eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eba0: 766d 7573 6572 3d76 6d75 7365 7229 0a20  vmuser=vmuser). 
+0000ebb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000ebc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ebd0: 2064 6174 6120 3d20 636f 6d6d 6f6e 2e63   data = common.c
+0000ebe0: 6c6f 7564 696e 6974 286e 616d 652c 206b  loudinit(name, k
+0000ebf0: 6579 733d 6b65 7973 2c20 636d 6473 3d63  eys=keys, cmds=c
+0000ec00: 6d64 732c 206e 6574 733d 6e65 7473 2c20  mds, nets=nets, 
+0000ec10: 6761 7465 7761 793d 6761 7465 7761 792c  gateway=gateway,
+0000ec20: 2064 6e73 3d64 6e73 2c0a 2020 2020 2020   dns=dns,.      
+0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec50: 2020 646f 6d61 696e 3d64 6f6d 6169 6e2c    domain=domain,
+0000ec60: 2066 696c 6573 3d66 696c 6573 2c20 656e   files=files, en
+0000ec70: 6162 6c65 726f 6f74 3d65 6e61 626c 6572  ableroot=enabler
+0000ec80: 6f6f 742c 206f 7665 7272 6964 6573 3d6f  oot, overrides=o
+0000ec90: 7665 7272 6964 6573 2c0a 2020 2020 2020  verrides,.      
+0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecc0: 2020 696d 6167 653d 696d 6167 652c 2073    image=image, s
+0000ecd0: 746f 7265 6d65 7461 6461 7461 3d46 616c  toremetadata=Fal
+0000ece0: 7365 2c20 766d 7573 6572 3d76 6d75 7365  se, vmuser=vmuse
+0000ecf0: 7229 5b30 5d0a 2020 2020 2020 2020 2020  r)[0].          
+0000ed00: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+0000ed10: 7427 3a20 2773 7563 6365 7373 272c 2027  t': 'success', '
+0000ed20: 6461 7461 273a 2064 6174 617d 0a20 2020  data': data}.   
+0000ed30: 2020 2020 2072 6573 756c 7420 3d20 6b2e       result = k.
+0000ed40: 6372 6561 7465 286e 616d 653d 6e61 6d65  create(name=name
+0000ed50: 2c20 7669 7274 7479 7065 3d76 6972 7474  , virttype=virtt
+0000ed60: 7970 652c 2070 6c61 6e3d 706c 616e 2c20  ype, plan=plan, 
+0000ed70: 7072 6f66 696c 653d 7072 6f66 696c 656e  profile=profilen
+0000ed80: 616d 652c 2066 6c61 766f 723d 666c 6176  ame, flavor=flav
+0000ed90: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0000eda0: 2020 2020 2020 2020 2020 2020 2020 6370                cp
+0000edb0: 756d 6f64 656c 3d63 7075 6d6f 6465 6c2c  umodel=cpumodel,
+0000edc0: 2063 7075 666c 6167 733d 6370 7566 6c61   cpuflags=cpufla
+0000edd0: 6773 2c20 6370 7570 696e 6e69 6e67 3d63  gs, cpupinning=c
+0000ede0: 7075 7069 6e6e 696e 672c 206e 756d 616d  pupinning, numam
+0000edf0: 6f64 653d 6e75 6d61 6d6f 6465 2c20 6e75  ode=numamode, nu
+0000ee00: 6d61 3d6e 756d 612c 0a20 2020 2020 2020  ma=numa,.       
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee20: 2020 206e 756d 6370 7573 3d69 6e74 286e     numcpus=int(n
+0000ee30: 756d 6370 7573 292c 206d 656d 6f72 793d  umcpus), memory=
+0000ee40: 696e 7428 6d65 6d6f 7279 292c 2067 7565  int(memory), gue
+0000ee50: 7374 6964 3d67 7565 7374 6964 2c20 706f  stid=guestid, po
+0000ee60: 6f6c 3d70 6f6f 6c2c 0a20 2020 2020 2020  ol=pool,.       
+0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee80: 2020 2069 6d61 6765 3d69 6d61 6765 2c20     image=image, 
+0000ee90: 6469 736b 733d 6469 736b 732c 2064 6973  disks=disks, dis
+0000eea0: 6b73 697a 653d 6469 736b 7369 7a65 2c20  ksize=disksize, 
+0000eeb0: 6469 736b 7468 696e 3d64 6973 6b74 6869  diskthin=diskthi
+0000eec0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0000eed0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+0000eee0: 6b69 6e74 6572 6661 6365 3d64 6973 6b69  kinterface=diski
+0000eef0: 6e74 6572 6661 6365 2c20 6e65 7473 3d6e  nterface, nets=n
+0000ef00: 6574 732c 2069 736f 3d69 736f 2c20 766e  ets, iso=iso, vn
+0000ef10: 633d 626f 6f6c 2876 6e63 292c 2063 6c6f  c=bool(vnc), clo
+0000ef20: 7564 696e 6974 3d62 6f6f 6c28 636c 6f75  udinit=bool(clou
+0000ef30: 6469 6e69 7429 2c0a 2020 2020 2020 2020  dinit),.        
+0000ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef50: 2020 7265 7365 7276 6569 703d 626f 6f6c    reserveip=bool
+0000ef60: 2872 6573 6572 7665 6970 292c 2072 6573  (reserveip), res
+0000ef70: 6572 7665 646e 733d 626f 6f6c 2872 6573  ervedns=bool(res
+0000ef80: 6572 7665 646e 7329 2c20 7265 7365 7276  ervedns), reserv
+0000ef90: 6568 6f73 743d 626f 6f6c 2872 6573 6572  ehost=bool(reser
+0000efa0: 7665 686f 7374 292c 0a20 2020 2020 2020  vehost),.       
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efc0: 2020 2073 7461 7274 3d62 6f6f 6c28 7374     start=bool(st
+0000efd0: 6172 7429 2c20 6b65 7973 3d6b 6579 732c  art), keys=keys,
+0000efe0: 2063 6d64 733d 636d 6473 2c20 6970 733d   cmds=cmds, ips=
+0000eff0: 6970 732c 206e 6574 6d61 736b 733d 6e65  ips, netmasks=ne
+0000f000: 746d 6173 6b73 2c20 6761 7465 7761 793d  tmasks, gateway=
+0000f010: 6761 7465 7761 792c 2064 6e73 3d64 6e73  gateway, dns=dns
+0000f020: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f030: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+0000f040: 696e 3d64 6f6d 6169 6e2c 206e 6573 7465  in=domain, neste
+0000f050: 643d 626f 6f6c 286e 6573 7465 6429 2c20  d=bool(nested), 
+0000f060: 7475 6e6e 656c 3d74 756e 6e65 6c2c 2066  tunnel=tunnel, f
+0000f070: 696c 6573 3d66 696c 6573 2c20 656e 6162  iles=files, enab
+0000f080: 6c65 726f 6f74 3d65 6e61 626c 6572 6f6f  leroot=enableroo
+0000f090: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0000f0a0: 2020 2020 2020 2020 2020 2020 206f 7665               ove
+0000f0b0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+0000f0c0: 2c20 7461 6773 3d74 6167 732c 2073 746f  , tags=tags, sto
+0000f0d0: 7265 6d65 7461 6461 7461 3d73 746f 7265  remetadata=store
+0000f0e0: 6d65 7461 6461 7461 2c0a 2020 2020 2020  metadata,.      
+0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f100: 2020 2020 7368 6172 6564 666f 6c64 6572      sharedfolder
+0000f110: 733d 7368 6172 6564 666f 6c64 6572 732c  s=sharedfolders,
+0000f120: 206b 6572 6e65 6c3d 6b65 726e 656c 2c20   kernel=kernel, 
+0000f130: 696e 6974 7264 3d69 6e69 7472 642c 2063  initrd=initrd, c
+0000f140: 6d64 6c69 6e65 3d63 6d64 6c69 6e65 2c0a  mdline=cmdline,.
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f160: 2020 2020 2020 2020 2020 706c 6163 656d            placem
+0000f170: 656e 743d 706c 6163 656d 656e 742c 2061  ent=placement, a
+0000f180: 7574 6f73 7461 7274 3d61 7574 6f73 7461  utostart=autosta
+0000f190: 7274 2c20 6370 7568 6f74 706c 7567 3d63  rt, cpuhotplug=c
+0000f1a0: 7075 686f 7470 6c75 672c 206d 656d 6f72  puhotplug, memor
+0000f1b0: 7968 6f74 706c 7567 3d6d 656d 6f72 7968  yhotplug=memoryh
+0000f1c0: 6f74 706c 7567 2c0a 2020 2020 2020 2020  otplug,.        
+0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1e0: 2020 7063 6964 6576 6963 6573 3d70 6369    pcidevices=pci
+0000f1f0: 6465 7669 6365 732c 2074 706d 3d74 706d  devices, tpm=tpm
+0000f200: 2c20 726e 673d 726e 672c 206d 6574 6164  , rng=rng, metad
+0000f210: 6174 613d 6d65 7461 6461 7461 2c20 7365  ata=metadata, se
+0000f220: 6375 7269 7479 6772 6f75 7073 3d73 6563  curitygroups=sec
+0000f230: 7572 6974 7967 726f 7570 732c 0a20 2020  uritygroups,.   
+0000f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f250: 2020 2020 2020 2076 6d75 7365 723d 766d         vmuser=vm
+0000f260: 7573 6572 290a 2020 2020 2020 2020 6966  user).        if
+0000f270: 2072 6573 756c 745b 2772 6573 756c 7427   result['result'
+0000f280: 5d20 213d 2027 7375 6363 6573 7327 3a0a  ] != 'success':.
+0000f290: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000f2a0: 726e 2072 6573 756c 740a 2020 2020 2020  rn result.      
+0000f2b0: 2020 6966 2072 6573 6572 7665 646e 7320    if reservedns 
+0000f2c0: 616e 6420 646e 7363 6c69 656e 7420 6973  and dnsclient is
+0000f2d0: 206e 6f74 204e 6f6e 6520 616e 6420 646f   not None and do
+0000f2e0: 6d61 696e 2069 7320 6e6f 7420 4e6f 6e65  main is not None
+0000f2f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000f300: 2064 6e73 636c 6965 6e74 2069 6e20 7365   dnsclient in se
+0000f310: 6c66 2e63 6c69 656e 7473 3a0a 2020 2020  lf.clients:.    
+0000f320: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
+0000f330: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
+0000f340: 6e73 636c 6965 6e74 292e 6b0a 2020 2020  nsclient).k.    
+0000f350: 2020 2020 2020 2020 2020 2020 6970 203d              ip =
+0000f360: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000f370: 2020 2020 2020 6966 2069 7020 6973 204e        if ip is N
+0000f380: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000f390: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
+0000f3a0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0000f3b0: 2020 2020 2020 2020 2077 6869 6c65 2063           while c
+0000f3c0: 6f75 6e74 6572 2021 3d20 3330 303a 0a20  ounter != 300:. 
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 2020 2020 2069 7020 3d20 6b2e 6970         ip = k.ip
+0000f3f0: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
+0000f400: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000f410: 6620 6970 2069 7320 4e6f 6e65 3a0a 2020  f ip is None:.  
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 2020 2020 2020 2020 2020 736c 6565 7028            sleep(
+0000f440: 3529 0a20 2020 2020 2020 2020 2020 2020  5).             
+0000f450: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f460: 7269 6e74 2822 5761 6974 696e 6720 3520  rint("Waiting 5 
+0000f470: 7365 636f 6e64 7320 746f 2067 7261 6220  seconds to grab 
+0000f480: 6970 2061 6e64 2063 7265 6174 6520 444e  ip and create DN
+0000f490: 5320 7265 636f 7264 2e2e 2e22 290a 2020  S record...").  
+0000f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4b0: 2020 2020 2020 2020 2020 636f 756e 7465            counte
+0000f4c0: 7220 2b3d 2031 300a 2020 2020 2020 2020  r += 10.        
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f500: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0000f510: 2020 2020 2020 2020 6966 2069 7020 6973          if ip is
+0000f520: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f530: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0000f540: 2822 436f 756c 646e 2774 2061 7373 6967  ("Couldn't assig
+0000f550: 6e20 444e 5322 290a 2020 2020 2020 2020  n DNS").        
+0000f560: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f580: 2020 7a2e 7265 7365 7276 655f 646e 7328    z.reserve_dns(
+0000f590: 6e61 6d65 3d6e 616d 652c 206e 6574 733d  name=name, nets=
+0000f5a0: 5b64 6f6d 6169 6e5d 2c20 646f 6d61 696e  [domain], domain
+0000f5b0: 3d64 6f6d 6169 6e2c 2069 703d 6970 2c20  =domain, ip=ip, 
+0000f5c0: 666f 7263 653d 5472 7565 290a 2020 2020  force=True).    
+0000f5d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000f5e0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0000f5f0: 726e 696e 6728 6622 436c 6965 6e74 207b  rning(f"Client {
+0000f600: 646e 7363 6c69 656e 747d 206e 6f74 2066  dnsclient} not f
+0000f610: 6f75 6e64 2e20 536b 6970 7069 6e67 2229  ound. Skipping")
+0000f620: 0a20 2020 2020 2020 2069 6620 6f73 2e61  .        if os.a
+0000f630: 6363 6573 7328 6f73 2e70 6174 682e 6578  ccess(os.path.ex
+0000f640: 7061 6e64 7573 6572 2827 7e2f 2e6b 636c  panduser('~/.kcl
+0000f650: 6927 292c 206f 732e 575f 4f4b 293a 0a20  i'), os.W_OK):. 
+0000f660: 2020 2020 2020 2020 2020 2063 6c69 656e             clien
+0000f670: 7420 3d20 636c 6965 6e74 2069 6620 636c  t = client if cl
+0000f680: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+0000f690: 2065 6c73 6520 7365 6c66 2e63 6c69 656e   else self.clien
+0000f6a0: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
+0000f6b0: 6d6d 6f6e 2e73 6574 5f6c 6173 7476 6d28  mmon.set_lastvm(
+0000f6c0: 6e61 6d65 2c20 636c 6965 6e74 290a 2020  name, client).  
+0000f6d0: 2020 2020 2020 616e 7369 626c 6570 726f        ansiblepro
+0000f6e0: 6669 6c65 203d 2070 726f 6669 6c65 2e67  file = profile.g
+0000f6f0: 6574 2827 616e 7369 626c 6527 290a 2020  et('ansible').  
+0000f700: 2020 2020 2020 6966 2061 6e73 6962 6c65        if ansible
+0000f710: 7072 6f66 696c 6520 6973 206e 6f74 204e  profile is not N
+0000f720: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000f730: 2069 6620 7768 6963 6828 2761 6e73 6962   if which('ansib
+0000f740: 6c65 2d70 6c61 7962 6f6f 6b27 2920 6973  le-playbook') is
+0000f750: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f760: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
+0000f770: 616e 7369 626c 652d 706c 6179 626f 6f6b  ansible-playbook
+0000f780: 2065 7865 6375 7461 626c 6520 6e6f 7420   executable not 
+0000f790: 666f 756e 642e 2053 6b69 7070 696e 6720  found. Skipping 
+0000f7a0: 616e 7369 626c 6520 706c 6179 2229 0a20  ansible play"). 
+0000f7b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000f7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f7d0: 2066 6f72 2065 6c65 6d65 6e74 2069 6e20   for element in 
+0000f7e0: 616e 7369 626c 6570 726f 6669 6c65 3a0a  ansibleprofile:.
+0000f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f800: 2020 2020 6966 2027 706c 6179 626f 6f6b      if 'playbook
+0000f810: 2720 6e6f 7420 696e 2065 6c65 6d65 6e74  ' not in element
+0000f820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f830: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0000f840: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0000f850: 2020 2020 2020 2070 6c61 7962 6f6f 6b20         playbook 
+0000f860: 3d20 656c 656d 656e 745b 2770 6c61 7962  = element['playb
+0000f870: 6f6f 6b27 5d0a 2020 2020 2020 2020 2020  ook'].          
+0000f880: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+0000f890: 6c65 7320 3d20 656c 656d 656e 742e 6765  les = element.ge
+0000f8a0: 7428 2776 6172 6961 626c 6573 272c 207b  t('variables', {
+0000f8b0: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0000f8c0: 2020 2020 2020 2076 6572 626f 7365 203d         verbose =
+0000f8d0: 2065 6c65 6d65 6e74 2e67 6574 2827 7665   element.get('ve
+0000f8e0: 7262 6f73 6527 2c20 4661 6c73 6529 0a20  rbose', False). 
+0000f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f900: 2020 2075 7365 7220 3d20 656c 656d 656e     user = elemen
+0000f910: 742e 6765 7428 2775 7365 7227 290a 2020  t.get('user').  
+0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f930: 2020 616e 7369 626c 6575 7469 6c73 2e70    ansibleutils.p
+0000f940: 6c61 7928 6b2c 206e 616d 652c 2070 6c61  lay(k, name, pla
+0000f950: 7962 6f6f 6b3d 706c 6179 626f 6f6b 2c20  ybook=playbook, 
+0000f960: 7661 7269 6162 6c65 733d 7661 7269 6162  variables=variab
+0000f970: 6c65 732c 2076 6572 626f 7365 3d76 6572  les, verbose=ver
+0000f980: 626f 7365 2c20 7573 6572 3d75 7365 722c  bose, user=user,
+0000f990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9b0: 2020 2020 2020 2074 756e 6e65 6c3d 7365         tunnel=se
+0000f9c0: 6c66 2e74 756e 6e65 6c2c 2074 756e 6e65  lf.tunnel, tunne
+0000f9d0: 6c68 6f73 743d 7365 6c66 2e68 6f73 742c  lhost=self.host,
+0000f9e0: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
+0000f9f0: 2e70 6f72 742c 0a20 2020 2020 2020 2020  .port,.         
+0000fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa10: 2020 2020 2020 2020 2020 2020 2074 756e               tun
+0000fa20: 6e65 6c75 7365 723d 7365 6c66 2e75 7365  neluser=self.use
+0000fa30: 722c 2079 616d 6c69 6e76 656e 746f 7279  r, yamlinventory
+0000fa40: 3d79 616d 6c69 6e76 656e 746f 7279 2c20  =yamlinventory, 
+0000fa50: 696e 7365 6375 7265 3d73 656c 662e 696e  insecure=self.in
+0000fa60: 7365 6375 7265 290a 2020 2020 2020 2020  secure).        
+0000fa70: 756e 706c 7567 6364 203d 206f 7665 7272  unplugcd = overr
+0000fa80: 6964 6573 2e67 6574 2827 756e 706c 7567  ides.get('unplug
+0000fa90: 6364 272c 2046 616c 7365 290a 2020 2020  cd', False).    
+0000faa0: 2020 2020 6966 2077 6169 7420 6f72 2075      if wait or u
+0000fab0: 6e70 6c75 6763 643a 0a20 2020 2020 2020  nplugcd:.       
+0000fac0: 2020 2020 2069 6620 6e6f 7420 636c 6f75       if not clou
+0000fad0: 6469 6e69 7420 6f72 206e 6f74 2073 7461  dinit or not sta
+0000fae0: 7274 206f 7220 696d 6167 6520 6973 204e  rt or image is N
+0000faf0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000fb00: 2020 2020 2070 7072 696e 7428 6622 536b       pprint(f"Sk
+0000fb10: 6970 7069 6e67 2077 6169 7420 6f6e 207b  ipping wait on {
+0000fb20: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0000fb30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000fb40: 2020 2020 2020 2020 2020 6964 656e 7469            identi
+0000fb50: 7479 6669 6c65 203d 204e 6f6e 650a 2020  tyfile = None.  
+0000fb60: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0000fb70: 6d70 6b65 795f 636c 6561 6e20 3d20 4661  mpkey_clean = Fa
+0000fb80: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000fb90: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
+0000fba0: 2e67 6574 2827 7465 6d70 6b65 7964 6972  .get('tempkeydir
+0000fbb0: 2729 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ') is not None:.
+0000fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbd0: 2020 2020 6964 656e 7469 7479 6669 6c65      identityfile
+0000fbe0: 203d 2066 227b 6f76 6572 7269 6465 735b   = f"{overrides[
+0000fbf0: 2774 656d 706b 6579 6469 7227 5d2e 6e61  'tempkeydir'].na
+0000fc00: 6d65 7d2f 6964 5f72 7361 220a 2020 2020  me}/id_rsa".    
+0000fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc20: 7465 6d70 6b65 795f 636c 6561 6e20 3d20  tempkey_clean = 
+0000fc30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0000fc40: 2020 2020 2073 656c 662e 7761 6974 5f66       self.wait_f
+0000fc50: 696e 6973 6828 6e61 6d65 2c20 696d 6167  inish(name, imag
+0000fc60: 653d 696d 6167 652c 2077 6169 7463 6f6d  e=image, waitcom
+0000fc70: 6d61 6e64 3d77 6169 7463 6f6d 6d61 6e64  mand=waitcommand
+0000fc80: 2c20 7761 6974 7469 6d65 6f75 743d 7761  , waittimeout=wa
+0000fc90: 6974 7469 6d65 6f75 742c 0a20 2020 2020  ittimeout,.     
+0000fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcb0: 2020 2020 2020 2020 2020 2020 6964 656e              iden
+0000fcc0: 7469 7479 6669 6c65 3d69 6465 6e74 6974  tityfile=identit
+0000fcd0: 7966 696c 652c 2076 6d63 6c69 656e 743d  yfile, vmclient=
+0000fce0: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
+0000fcf0: 2020 2020 2020 2020 6669 6e69 7368 6669          finishfi
+0000fd00: 6c65 7320 3d20 7072 6f66 696c 652e 6765  les = profile.ge
+0000fd10: 7428 2766 696e 6973 6866 696c 6573 272c  t('finishfiles',
+0000fd20: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
+0000fd30: 2020 2020 2069 6620 6669 6e69 7368 6669       if finishfi
+0000fd40: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0000fd50: 2020 2020 2020 2020 2073 656c 662e 6861           self.ha
+0000fd60: 6e64 6c65 5f66 696e 6973 6866 696c 6573  ndle_finishfiles
+0000fd70: 286e 616d 652c 2066 696e 6973 6866 696c  (name, finishfil
+0000fd80: 6573 2c20 6964 656e 7469 7479 6669 6c65  es, identityfile
+0000fd90: 3d69 6465 6e74 6974 7966 696c 652c 2076  =identityfile, v
+0000fda0: 6d63 6c69 656e 743d 636c 6965 6e74 290a  mclient=client).
+0000fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdc0: 6966 2074 656d 706b 6579 5f63 6c65 616e  if tempkey_clean
+0000fdd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000fde0: 2020 2020 2020 7365 6c66 2e63 6c65 616e        self.clean
+0000fdf0: 5f74 656d 706b 6579 286e 616d 652c 2069  _tempkey(name, i
+0000fe00: 6465 6e74 6974 7966 696c 653d 6964 656e  dentityfile=iden
+0000fe10: 7469 7479 6669 6c65 290a 2020 2020 2020  tityfile).      
+0000fe20: 2020 2020 2020 6966 2075 6e70 6c75 6763        if unplugc
+0000fe30: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+0000fe40: 2020 2073 656c 662e 6b2e 7570 6461 7465     self.k.update
+0000fe50: 5f69 736f 286e 616d 652c 204e 6f6e 6529  _iso(name, None)
+0000fe60: 0a20 2020 2020 2020 2069 6620 6f76 6572  .        if over
+0000fe70: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
+0000fe80: 6579 6469 7227 2920 6973 206e 6f74 204e  eydir') is not N
+0000fe90: 6f6e 6520 616e 6420 6e6f 7420 6f76 6572  one and not over
+0000fea0: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
+0000feb0: 6579 6469 726b 6565 7027 2c20 4661 6c73  eydirkeep', Fals
+0000fec0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0000fed0: 6f76 6572 7269 6465 732e 6765 7428 2774  overrides.get('t
+0000fee0: 656d 706b 6579 6469 7227 292e 636c 6561  empkeydir').clea
+0000fef0: 6e75 7028 290a 2020 2020 2020 2020 7265  nup().        re
+0000ff00: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0000ff10: 2773 7563 6365 7373 272c 2027 766d 273a  'success', 'vm':
+0000ff20: 206e 616d 657d 0a0a 2020 2020 6465 6620   name}..    def 
+0000ff30: 7570 6461 7465 5f76 6d28 7365 6c66 2c20  update_vm(self, 
+0000ff40: 6e61 6d65 2c20 6f76 6572 7269 6465 7329  name, overrides)
+0000ff50: 3a0a 2020 2020 2020 2020 6b20 3d20 7365  :.        k = se
+0000ff60: 6c66 2e6b 0a20 2020 2020 2020 2069 7020  lf.k.        ip 
+0000ff70: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+0000ff80: 2769 7027 290a 2020 2020 2020 2020 666c  'ip').        fl
+0000ff90: 6176 6f72 203d 206f 7665 7272 6964 6573  avor = overrides
+0000ffa0: 2e67 6574 2827 666c 6176 6f72 2729 0a20  .get('flavor'). 
+0000ffb0: 2020 2020 2020 206e 756d 6370 7573 203d         numcpus =
+0000ffc0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+0000ffd0: 6e75 6d63 7075 7327 290a 2020 2020 2020  numcpus').      
+0000ffe0: 2020 6d65 6d6f 7279 203d 206f 7665 7272    memory = overr
+0000fff0: 6964 6573 2e67 6574 2827 6d65 6d6f 7279  ides.get('memory
+00010000: 2729 0a20 2020 2020 2020 2061 7574 6f73  ').        autos
+00010010: 7461 7274 203d 206f 7665 7272 6964 6573  tart = overrides
+00010020: 2e67 6574 2827 6175 746f 7374 6172 7427  .get('autostart'
+00010030: 290a 2020 2020 2020 2020 646e 7320 3d20  ).        dns = 
+00010040: 6f76 6572 7269 6465 732e 6765 7428 2764  overrides.get('d
+00010050: 6e73 2729 0a20 2020 2020 2020 2068 6f73  ns').        hos
+00010060: 7420 3d20 6f76 6572 7269 6465 732e 6765  t = overrides.ge
+00010070: 7428 2768 6f73 7427 290a 2020 2020 2020  t('host').      
+00010080: 2020 646f 6d61 696e 203d 206f 7665 7272    domain = overr
+00010090: 6964 6573 2e67 6574 2827 646f 6d61 696e  ides.get('domain
+000100a0: 2729 0a20 2020 2020 2020 2063 6c6f 7564  ').        cloud
+000100b0: 696e 6974 203d 206f 7665 7272 6964 6573  init = overrides
+000100c0: 2e67 6574 2827 636c 6f75 6469 6e69 7427  .get('cloudinit'
+000100d0: 290a 2020 2020 2020 2020 696d 6167 6520  ).        image 
+000100e0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+000100f0: 2769 6d61 6765 2729 0a20 2020 2020 2020  'image').       
+00010100: 206e 6574 7320 3d20 6f76 6572 7269 6465   nets = override
+00010110: 732e 6765 7428 276e 6574 7327 290a 2020  s.get('nets').  
+00010120: 2020 2020 2020 6469 736b 7320 3d20 6f76        disks = ov
+00010130: 6572 7269 6465 732e 6765 7428 2764 6973  errides.get('dis
+00010140: 6b73 2729 0a20 2020 2020 2020 2069 6e66  ks').        inf
+00010150: 6f72 6d61 7469 6f6e 203d 206f 7665 7272  ormation = overr
+00010160: 6964 6573 2e67 6574 2827 696e 666f 726d  ides.get('inform
+00010170: 6174 696f 6e27 290a 2020 2020 2020 2020  ation').        
+00010180: 6370 7566 6c61 6773 203d 206f 7665 7272  cpuflags = overr
+00010190: 6964 6573 2e67 6574 2827 6370 7566 6c61  ides.get('cpufla
+000101a0: 6773 272c 205b 5d29 0a20 2020 2020 2020  gs', []).       
+000101b0: 2064 6973 6162 6c65 203d 206f 7665 7272   disable = overr
+000101c0: 6964 6573 2e67 6574 2827 6469 7361 626c  ides.get('disabl
+000101d0: 6527 2c20 4661 6c73 6529 0a20 2020 2020  e', False).     
+000101e0: 2020 206f 7665 7272 6964 6573 2e70 6f70     overrides.pop
+000101f0: 2827 6469 7361 626c 6527 2c20 4e6f 6e65  ('disable', None
+00010200: 290a 2020 2020 2020 2020 6578 7472 615f  ).        extra_
+00010210: 6d65 7461 6461 7461 203d 207b 6b3a 206f  metadata = {k: o
+00010220: 7665 7272 6964 6573 5b6b 5d20 666f 7220  verrides[k] for 
+00010230: 6b20 696e 206f 7665 7272 6964 6573 2069  k in overrides i
+00010240: 6620 6b20 6e6f 7420 696e 2073 656c 662e  f k not in self.
+00010250: 6c69 7374 5f6b 6579 776f 7264 7328 297d  list_keywords()}
+00010260: 0a20 2020 2020 2020 2074 656d 706c 6174  .        templat
+00010270: 6520 3d20 6f76 6572 7269 6465 732e 6765  e = overrides.ge
+00010280: 7428 2774 656d 706c 6174 6527 290a 2020  t('template').  
+00010290: 2020 2020 2020 6966 2074 656d 706c 6174        if templat
+000102a0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+000102b0: 2020 2020 2020 2020 2020 2064 656c 2065             del e
+000102c0: 7874 7261 5f6d 6574 6164 6174 615b 2774  xtra_metadata['t
+000102d0: 656d 706c 6174 6527 5d0a 2020 2020 2020  emplate'].      
+000102e0: 2020 6966 2064 6e73 3a0a 2020 2020 2020    if dns:.      
+000102f0: 2020 2020 2020 7070 7269 6e74 2866 2243        pprint(f"C
+00010300: 7265 6174 696e 6720 446e 7320 656e 7472  reating Dns entr
+00010310: 7920 666f 7220 7b6e 616d 657d 2e2e 2e22  y for {name}..."
+00010320: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+00010330: 7477 6f72 6b73 203d 206b 2e76 6d5f 706f  tworks = k.vm_po
+00010340: 7274 7328 6e61 6d65 290a 2020 2020 2020  rts(name).      
+00010350: 2020 2020 2020 6966 206e 6574 776f 726b        if network
+00010360: 7320 616e 6420 646f 6d61 696e 2069 7320  s and domain is 
+00010370: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00010380: 2020 2020 2020 646f 6d61 696e 203d 206e        domain = n
+00010390: 6574 776f 726b 735b 305d 0a20 2020 2020  etworks[0].     
+000103a0: 2020 2020 2020 2069 6620 6e6f 7420 6e65         if not ne
+000103b0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000103c0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+000103d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000103e0: 2020 2020 2020 2020 2020 2020 206b 2e72               k.r
+000103f0: 6573 6572 7665 5f64 6e73 286e 616d 653d  eserve_dns(name=
+00010400: 6e61 6d65 2c20 6e65 7473 3d6e 6574 776f  name, nets=netwo
+00010410: 726b 732c 2064 6f6d 6169 6e3d 646f 6d61  rks, domain=doma
+00010420: 696e 2c20 6970 3d69 7029 0a20 2020 2020  in, ip=ip).     
+00010430: 2020 2069 6620 6970 2069 7320 6e6f 7420     if ip is not 
+00010440: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00010450: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
+00010460: 696e 6720 6970 206f 6620 766d 207b 6e61  ing ip of vm {na
+00010470: 6d65 7d20 746f 207b 6970 7d2e 2e2e 2229  me} to {ip}...")
+00010480: 0a20 2020 2020 2020 2020 2020 206b 2e75  .            k.u
+00010490: 7064 6174 655f 6d65 7461 6461 7461 286e  pdate_metadata(n
+000104a0: 616d 652c 2027 6970 272c 2069 7029 0a20  ame, 'ip', ip). 
+000104b0: 2020 2020 2020 2069 6620 636c 6f75 6469         if cloudi
+000104c0: 6e69 743a 0a20 2020 2020 2020 2020 2020  nit:.           
+000104d0: 2070 7072 696e 7428 6622 5265 6d6f 7669   pprint(f"Removi
+000104e0: 6e67 2063 6c6f 7564 696e 6974 2069 6e66  ng cloudinit inf
+000104f0: 6f72 6d61 7469 6f6e 206f 6620 766d 207b  ormation of vm {
+00010500: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+00010510: 2020 2020 6b2e 7265 6d6f 7665 5f63 6c6f      k.remove_clo
+00010520: 7564 696e 6974 286e 616d 6529 0a20 2020  udinit(name).   
+00010530: 2020 2020 2069 6620 696d 6167 6520 6973       if image is
+00010540: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00010550: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00010560: 5570 6461 7469 6e67 2069 6d61 6765 206f  Updating image o
+00010570: 6620 766d 207b 6e61 6d65 7d20 746f 207b  f vm {name} to {
+00010580: 696d 6167 657d 2e2e 2e22 290a 2020 2020  image}...").    
+00010590: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
+000105a0: 5f6d 6574 6164 6174 6128 6e61 6d65 2c20  _metadata(name, 
+000105b0: 2769 6d61 6765 272c 2069 6d61 6765 290a  'image', image).
+000105c0: 2020 2020 2020 2020 6966 206d 656d 6f72          if memor
+000105d0: 7920 6973 206e 6f74 204e 6f6e 653a 0a20  y is not None:. 
+000105e0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000105f0: 7428 6622 5570 6461 7469 6e67 206d 656d  t(f"Updating mem
+00010600: 6f72 7920 6f66 2076 6d20 7b6e 616d 657d  ory of vm {name}
+00010610: 2074 6f20 7b6d 656d 6f72 797d 2e2e 2e22   to {memory}..."
+00010620: 290a 2020 2020 2020 2020 2020 2020 6b2e  ).            k.
+00010630: 7570 6461 7465 5f6d 656d 6f72 7928 6e61  update_memory(na
+00010640: 6d65 2c20 6d65 6d6f 7279 290a 2020 2020  me, memory).    
+00010650: 2020 2020 6966 206e 756d 6370 7573 2069      if numcpus i
+00010660: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00010670: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00010680: 2255 7064 6174 696e 6720 6e75 6d63 7075  "Updating numcpu
+00010690: 7320 6f66 2076 6d20 7b6e 616d 657d 2074  s of vm {name} t
+000106a0: 6f20 7b6e 756d 6370 7573 7d2e 2e2e 2229  o {numcpus}...")
+000106b0: 0a20 2020 2020 2020 2020 2020 206b 2e75  .            k.u
+000106c0: 7064 6174 655f 6370 7573 286e 616d 652c  pdate_cpus(name,
+000106d0: 206e 756d 6370 7573 290a 2020 2020 2020   numcpus).      
+000106e0: 2020 6966 2061 7574 6f73 7461 7274 2069    if autostart i
+000106f0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00010700: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00010710: 2253 6574 7469 6e67 2061 7574 6f73 7461  "Setting autosta
+00010720: 7274 2074 6f20 7b61 7574 6f73 7461 7274  rt to {autostart
+00010730: 7d20 666f 7220 766d 207b 6e61 6d65 7d2e  } for vm {name}.
+00010740: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00010750: 206b 2e75 7064 6174 655f 7374 6172 7428   k.update_start(
+00010760: 6e61 6d65 2c20 7374 6172 743d 6175 746f  name, start=auto
+00010770: 7374 6172 7429 0a20 2020 2020 2020 2069  start).        i
+00010780: 6620 696e 666f 726d 6174 696f 6e3a 0a20  f information:. 
+00010790: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000107a0: 7428 6622 5365 7474 696e 6720 696e 666f  t(f"Setting info
+000107b0: 726d 6174 696f 6e20 666f 7220 766d 207b  rmation for vm {
+000107c0: 6e61 6d65 7d2e 2e2e 2229 0a20 2020 2020  name}...").     
+000107d0: 2020 2020 2020 206b 2e75 7064 6174 655f         k.update_
+000107e0: 696e 666f 726d 6174 696f 6e28 6e61 6d65  information(name
+000107f0: 2c20 696e 666f 726d 6174 696f 6e29 0a20  , information). 
+00010800: 2020 2020 2020 2069 6620 2769 736f 2720         if 'iso' 
+00010810: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
+00010820: 2020 2020 2020 2020 2020 6973 6f20 3d20            iso = 
+00010830: 6f76 6572 7269 6465 735b 2769 736f 275d  overrides['iso']
+00010840: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00010850: 696e 7428 6622 5377 6974 6368 696e 6720  int(f"Switching 
+00010860: 6973 6f20 666f 7220 766d 207b 6e61 6d65  iso for vm {name
+00010870: 7d20 746f 207b 6973 6f7d 2e2e 2e22 290a  } to {iso}...").
+00010880: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00010890: 736f 203d 3d20 274e 6f6e 6527 206f 7220  so == 'None' or 
+000108a0: 6973 6f20 3d3d 2027 273a 0a20 2020 2020  iso == '':.     
+000108b0: 2020 2020 2020 2020 2020 2069 736f 203d             iso =
+000108c0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+000108d0: 2020 6b2e 7570 6461 7465 5f69 736f 286e    k.update_iso(n
+000108e0: 616d 652c 2069 736f 290a 2020 2020 2020  ame, iso).      
+000108f0: 2020 6966 2066 6c61 766f 7220 6973 206e    if flavor is n
+00010900: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00010910: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
+00010920: 6461 7469 6e67 2066 6c61 766f 7220 6f66  dating flavor of
+00010930: 2076 6d20 7b6e 616d 657d 2074 6f20 7b66   vm {name} to {f
+00010940: 6c61 766f 727d 2e2e 2e22 290a 2020 2020  lavor}...").    
+00010950: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
+00010960: 5f66 6c61 766f 7228 6e61 6d65 2c20 666c  _flavor(name, fl
+00010970: 6176 6f72 290a 2020 2020 2020 2020 6966  avor).        if
+00010980: 2068 6f73 743a 0a20 2020 2020 2020 2020   host:.         
+00010990: 2020 2070 7072 696e 7428 6622 4372 6561     pprint(f"Crea
+000109a0: 7469 6e67 2048 6f73 7420 656e 7472 7920  ting Host entry 
+000109b0: 666f 7220 766d 207b 6e61 6d65 7d2e 2e2e  for vm {name}...
+000109c0: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
+000109d0: 6574 776f 726b 7320 3d20 6b2e 766d 5f70  etworks = k.vm_p
+000109e0: 6f72 7473 286e 616d 6529 0a20 2020 2020  orts(name).     
+000109f0: 2020 2020 2020 2069 6620 6e65 7477 6f72         if networ
+00010a00: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00010a10: 2020 2020 6966 2064 6f6d 6169 6e20 6973      if domain is
+00010a20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00010a30: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+00010a40: 6e20 3d20 6e65 7477 6f72 6b73 5b30 5d0a  n = networks[0].
+00010a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a60: 6b2e 7265 7365 7276 655f 686f 7374 286e  k.reserve_host(n
+00010a70: 616d 652c 206e 6574 776f 726b 732c 2064  ame, networks, d
+00010a80: 6f6d 6169 6e29 0a20 2020 2020 2020 2063  omain).        c
+00010a90: 7572 7265 6e74 766d 203d 206b 2e69 6e66  urrentvm = k.inf
+00010aa0: 6f28 6e61 6d65 290a 2020 2020 2020 2020  o(name).        
+00010ab0: 6375 7272 656e 746e 6574 7320 3d20 6375  currentnets = cu
+00010ac0: 7272 656e 7476 6d2e 6765 7428 276e 6574  rrentvm.get('net
+00010ad0: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
+00010ae0: 6375 7272 656e 7464 6973 6b73 203d 2063  currentdisks = c
+00010af0: 7572 7265 6e74 766d 2e67 6574 2827 6469  urrentvm.get('di
+00010b00: 736b 7327 2c20 5b5d 290a 2020 2020 2020  sks', []).      
+00010b10: 2020 6966 2064 6973 6b73 3a0a 2020 2020    if disks:.    
+00010b20: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00010b30: 2255 7064 6174 696e 6720 6469 736b 7320  "Updating disks 
+00010b40: 6f66 2076 6d20 7b6e 616d 657d 2229 0a20  of vm {name}"). 
+00010b50: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00010b60: 6e64 6578 2c20 6375 7272 656e 7464 6973  ndex, currentdis
+00010b70: 6b20 696e 2065 6e75 6d65 7261 7465 2863  k in enumerate(c
+00010b80: 7572 7265 6e74 6469 736b 7329 3a0a 2020  urrentdisks):.  
+00010b90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010ba0: 2069 6e64 6578 203c 206c 656e 2864 6973   index < len(dis
+00010bb0: 6b73 293a 0a20 2020 2020 2020 2020 2020  ks):.           
+00010bc0: 2020 2020 2020 2020 2064 6973 6b20 3d20           disk = 
+00010bd0: 6469 736b 735b 696e 6465 785d 0a20 2020  disks[index].   
+00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bf0: 2063 7572 7265 6e74 6469 736b 7369 7a65   currentdisksize
+00010c00: 203d 2063 7572 7265 6e74 6469 736b 5b27   = currentdisk['
+00010c10: 7369 7a65 275d 0a20 2020 2020 2020 2020  size'].         
+00010c20: 2020 2020 2020 2020 2020 2064 6973 6b73             disks
+00010c30: 697a 6520 3d20 6469 736b 2e67 6574 2827  ize = disk.get('
+00010c40: 7369 7a65 272c 2031 3029 2069 6620 6973  size', 10) if is
+00010c50: 696e 7374 616e 6365 2864 6973 6b2c 2064  instance(disk, d
+00010c60: 6963 7429 2065 6c73 6520 696e 7428 6469  ict) else int(di
+00010c70: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
+00010c80: 2020 2020 2020 2020 6966 2064 6973 6b73          if disks
+00010c90: 697a 6520 3e20 6375 7272 656e 7464 6973  ize > currentdis
+00010ca0: 6b73 697a 653a 0a20 2020 2020 2020 2020  ksize:.         
+00010cb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010cc0: 6620 6375 7272 656e 7476 6d2e 6765 7428  f currentvm.get(
+00010cd0: 2773 7461 7475 7327 2920 213d 2027 646f  'status') != 'do
+00010ce0: 776e 273a 0a20 2020 2020 2020 2020 2020  wn':.           
+00010cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d00: 2077 6172 6e69 6e67 2866 2243 616e 7420   warning(f"Cant 
+00010d10: 7265 7369 7a65 2044 6973 6b20 7b69 6e64  resize Disk {ind
+00010d20: 6578 7d20 696e 207b 6e61 6d65 7d20 7768  ex} in {name} wh
+00010d30: 696c 6520 564d 2069 7320 7570 2229 0a20  ile VM is up"). 
+00010d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d50: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00010d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010d70: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00010d80: 6622 5265 7369 7a69 6e67 2044 6973 6b20  f"Resizing Disk 
+00010d90: 7b69 6e64 6578 7d20 696e 207b 6e61 6d65  {index} in {name
+00010da0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00010db0: 2020 2020 2020 2020 2020 2020 6469 736b              disk
+00010dc0: 7061 7468 203d 2063 7572 7265 6e74 6469  path = currentdi
+00010dd0: 736b 5b27 7061 7468 275d 0a20 2020 2020  sk['path'].     
+00010de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010df0: 2020 206b 2e72 6573 697a 655f 6469 736b     k.resize_disk
+00010e00: 2864 6973 6b70 6174 682c 2064 6973 6b73  (diskpath, disks
+00010e10: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00010e20: 2069 6620 6c65 6e28 6375 7272 656e 7464   if len(currentd
+00010e30: 6973 6b73 2920 3c20 6c65 6e28 6469 736b  isks) < len(disk
+00010e40: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00010e50: 2020 2020 7070 7269 6e74 2866 2241 6464      pprint(f"Add
+00010e60: 696e 6720 4469 736b 7320 746f 207b 6e61  ing Disks to {na
+00010e70: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00010e80: 2020 2020 2020 666f 7220 6469 736b 2069        for disk i
+00010e90: 6e20 6469 736b 735b 6c65 6e28 6375 7272  n disks[len(curr
+00010ea0: 656e 7464 6973 6b73 293a 5d3a 0a20 2020  entdisks):]:.   
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2069 6620 6973 696e 7374 616e 6365 2864   if isinstance(d
+00010ed0: 6973 6b2c 2069 6e74 293a 0a20 2020 2020  isk, int):.     
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ef0: 2020 2073 697a 6520 3d20 6469 736b 0a20     size = disk. 
 00010f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f10: 2020 7369 7a65 203d 2064 6973 6b0a 2020    size = disk.  
-00010f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f30: 2020 2020 2020 706f 6f6c 203d 2073 656c        pool = sel
-00010f40: 662e 706f 6f6c 0a20 2020 2020 2020 2020  f.pool.         
-00010f50: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00010f60: 6973 696e 7374 616e 6365 2864 6973 6b2c  isinstance(disk,
-00010f70: 2073 7472 2920 616e 6420 6469 736b 2e69   str) and disk.i
-00010f80: 7364 6967 6974 2829 3a0a 2020 2020 2020  sdigit():.      
-00010f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fa0: 2020 7369 7a65 203d 2069 6e74 2864 6973    size = int(dis
-00010fb0: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
-00010fc0: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
-00010fd0: 3d20 7365 6c66 2e70 6f6f 6c0a 2020 2020  = self.pool.    
-00010fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ff0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00011000: 6469 736b 2c20 6469 6374 293a 0a20 2020  disk, dict):.   
-00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011020: 2020 2020 2073 697a 6520 3d20 6469 736b       size = disk
-00011030: 2e67 6574 2827 7369 7a65 272c 2073 656c  .get('size', sel
-00011040: 662e 6469 736b 7369 7a65 290a 2020 2020  f.disksize).    
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 2020 2020 706f 6f6c 203d 2064 6973 6b2e      pool = disk.
-00011070: 6765 7428 2770 6f6f 6c27 2c20 7365 6c66  get('pool', self
-00011080: 2e70 6f6f 6c29 0a20 2020 2020 2020 2020  .pool).         
-00011090: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000110a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000110b0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-000110c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000110d0: 2020 2020 2020 6b2e 6164 645f 6469 736b        k.add_disk
-000110e0: 286e 616d 653d 6e61 6d65 2c20 7369 7a65  (name=name, size
-000110f0: 3d73 697a 652c 2070 6f6f 6c3d 706f 6f6c  =size, pool=pool
-00011100: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00011110: 206c 656e 2863 7572 7265 6e74 6469 736b   len(currentdisk
-00011120: 7329 203e 206c 656e 2864 6973 6b73 293a  s) > len(disks):
-00011130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011140: 2070 7072 696e 7428 6622 5265 6d6f 7669   pprint(f"Removi
-00011150: 6e67 2044 6973 6b73 206f 6620 7b6e 616d  ng Disks of {nam
-00011160: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00011170: 2020 2020 2066 6f72 2064 6973 6b20 696e       for disk in
-00011180: 2063 7572 7265 6e74 6469 736b 735b 6c65   currentdisks[le
-00011190: 6e28 6375 7272 656e 7464 6973 6b73 2920  n(currentdisks) 
-000111a0: 2d20 6c65 6e28 6469 736b 7329 3a5d 3a0a  - len(disks):]:.
-000111b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111c0: 2020 2020 6469 736b 6e61 6d65 203d 206f      diskname = o
-000111d0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-000111e0: 6469 736b 5b27 7061 7468 275d 290a 2020  disk['path']).  
-000111f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011200: 2020 6469 736b 706f 6f6c 203d 206f 732e    diskpool = os.
-00011210: 7061 7468 2e64 6972 6e61 6d65 2864 6973  path.dirname(dis
-00011220: 6b5b 2770 6174 6827 5d29 0a20 2020 2020  k['path']).     
-00011230: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00011240: 2e64 656c 6574 655f 6469 736b 286e 616d  .delete_disk(nam
-00011250: 653d 6e61 6d65 2c20 6469 736b 6e61 6d65  e=name, diskname
-00011260: 3d64 6973 6b6e 616d 652c 2070 6f6f 6c3d  =diskname, pool=
-00011270: 6469 736b 706f 6f6c 290a 2020 2020 2020  diskpool).      
-00011280: 2020 6966 206e 6574 733a 0a20 2020 2020    if nets:.     
-00011290: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-000112a0: 5570 6461 7469 6e67 206e 6574 7320 6f66  Updating nets of
-000112b0: 2076 6d20 7b6e 616d 657d 2229 0a20 2020   vm {name}").   
-000112c0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-000112d0: 6375 7272 656e 746e 6574 7329 203c 206c  currentnets) < l
-000112e0: 656e 286e 6574 7329 3a0a 2020 2020 2020  en(nets):.      
-000112f0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00011300: 2866 2241 6464 696e 6720 4e69 6373 2074  (f"Adding Nics t
-00011310: 6f20 7b6e 616d 657d 2229 0a20 2020 2020  o {name}").     
-00011320: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-00011330: 6574 2069 6e20 6e65 7473 5b6c 656e 2863  et in nets[len(c
-00011340: 7572 7265 6e74 6e65 7473 293a 5d3a 0a20  urrentnets):]:. 
-00011350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011360: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00011370: 286e 6574 2c20 7374 7229 3a0a 2020 2020  (net, str):.    
-00011380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011390: 2020 2020 6e65 7477 6f72 6b20 3d20 6e65      network = ne
-000113a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000113b0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-000113c0: 7461 6e63 6528 6e65 742c 2064 6963 7429  tance(net, dict)
-000113d0: 2061 6e64 2027 6e61 6d65 2720 696e 206e   and 'name' in n
-000113e0: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-000113f0: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
-00011400: 6f72 6b20 3d20 6e65 745b 276e 616d 6527  ork = net['name'
-00011410: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00011420: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011440: 2020 2020 6572 726f 7228 6622 536b 6970      error(f"Skip
-00011450: 7069 6e67 2077 726f 6e67 206e 6963 2073  ping wrong nic s
-00011460: 7065 6320 666f 7220 7b6e 616d 657d 2229  pec for {name}")
-00011470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011480: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00011490: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000114a0: 2020 2020 2020 6b2e 6164 645f 6e69 6328        k.add_nic(
-000114b0: 6e61 6d65 2c20 6e65 7477 6f72 6b29 0a20  name, network). 
-000114c0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-000114d0: 6e28 6375 7272 656e 746e 6574 7329 203e  n(currentnets) >
-000114e0: 206c 656e 286e 6574 7329 3a0a 2020 2020   len(nets):.    
-000114f0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00011500: 6e74 2866 2252 656d 6f76 696e 6720 4e69  nt(f"Removing Ni
-00011510: 6373 206f 6620 7b6e 616d 657d 2229 0a20  cs of {name}"). 
-00011520: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00011530: 6f72 206e 6574 2069 6e20 7261 6e67 6528  or net in range(
-00011540: 6c65 6e28 6375 7272 656e 746e 6574 7329  len(currentnets)
-00011550: 2c20 6c65 6e28 6e65 7473 292c 202d 3129  , len(nets), -1)
-00011560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011570: 2020 2020 2020 696e 7465 7266 6163 6520        interface 
-00011580: 3d20 2265 7468 2573 2220 2520 286e 6574  = "eth%s" % (net
-00011590: 202d 2031 290a 2020 2020 2020 2020 2020   - 1).          
-000115a0: 2020 2020 2020 2020 2020 6b2e 6465 6c65            k.dele
-000115b0: 7465 5f6e 6963 286e 616d 652c 2069 6e74  te_nic(name, int
-000115c0: 6572 6661 6365 290a 2020 2020 2020 2020  erface).        
-000115d0: 2020 2020 666f 7220 696e 6465 782c 2063      for index, c
-000115e0: 7572 7265 6e74 6e65 7420 696e 2065 6e75  urrentnet in enu
-000115f0: 6d65 7261 7465 2863 7572 7265 6e74 6e65  merate(currentne
-00011600: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
-00011610: 2020 2020 2069 6620 696e 6465 7820 3e20       if index > 
-00011620: 6c65 6e28 6e65 7473 293a 0a20 2020 2020  len(nets):.     
-00011630: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00011640: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00011650: 2020 2020 206e 6574 6e61 6d65 203d 2063       netname = c
-00011660: 7572 7265 6e74 6e65 745b 276e 6574 275d  urrentnet['net']
-00011670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011680: 2074 6172 6765 746e 6574 6e61 6d65 203d   targetnetname =
-00011690: 206e 6574 735b 696e 6465 785d 5b27 6e61   nets[index]['na
-000116a0: 6d65 275d 2069 6620 6973 696e 7374 616e  me'] if isinstan
-000116b0: 6365 286e 6574 735b 696e 6465 785d 2c20  ce(nets[index], 
-000116c0: 6469 6374 2920 656c 7365 206e 6574 735b  dict) else nets[
-000116d0: 696e 6465 785d 0a20 2020 2020 2020 2020  index].         
-000116e0: 2020 2020 2020 2069 6620 7461 7267 6574         if target
-000116f0: 6e65 746e 616d 6520 213d 206e 6574 6e61  netname != netna
-00011700: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00011710: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00011720: 2255 7064 6174 696e 6720 6e69 6320 7b69  "Updating nic {i
-00011730: 6e64 6578 7d20 746f 206e 6574 776f 726b  ndex} to network
-00011740: 207b 7461 7267 6574 6e65 746e 616d 657d   {targetnetname}
-00011750: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00011760: 2020 2020 2020 206b 2e75 7064 6174 655f         k.update_
-00011770: 6e69 6328 6e61 6d65 2c20 696e 6465 782c  nic(name, index,
-00011780: 2074 6172 6765 746e 6574 6e61 6d65 290a   targetnetname).
-00011790: 2020 2020 2020 2020 6966 2065 7874 7261          if extra
-000117a0: 5f6d 6574 6164 6174 613a 0a20 2020 2020  _metadata:.     
-000117b0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-000117c0: 6e20 6578 7472 615f 6d65 7461 6461 7461  n extra_metadata
-000117d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000117e0: 2020 7661 6c75 6520 3d20 6578 7472 615f    value = extra_
-000117f0: 6d65 7461 6461 7461 5b6b 6579 5d0a 2020  metadata[key].  
-00011800: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00011810: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
-00011820: 7b6b 6579 7d20 6f66 2076 6d20 7b6e 616d  {key} of vm {nam
-00011830: 657d 2074 6f20 7b76 616c 7565 7d2e 2e2e  e} to {value}...
-00011840: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00011850: 2020 206b 2e75 7064 6174 655f 6d65 7461     k.update_meta
-00011860: 6461 7461 286e 616d 652c 206b 6579 2c20  data(name, key, 
-00011870: 7661 6c75 6529 0a20 2020 2020 2020 2069  value).        i
-00011880: 6620 6f76 6572 7269 6465 732e 6765 7428  f overrides.get(
-00011890: 2766 696c 6573 272c 205b 5d29 3a0a 2020  'files', []):.  
-000118a0: 2020 2020 2020 2020 2020 6966 206f 7665            if ove
-000118b0: 7272 6964 6573 2e67 6574 2827 736b 6970  rrides.get('skip
-000118c0: 5f66 696c 6573 5f72 656d 6564 6961 7469  _files_remediati
-000118d0: 6f6e 272c 2046 616c 7365 293a 0a20 2020  on', False):.   
-000118e0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-000118f0: 696e 7428 6622 536b 6970 7069 6e67 2052  int(f"Skipping R
-00011900: 656d 6564 6961 7469 6f6e 2066 696c 6573  emediation files
-00011910: 206f 6620 7b6e 616d 657d 2229 0a20 2020   of {name}").   
-00011920: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00011930: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00011940: 6577 6669 6c65 7320 3d20 6f76 6572 7269  ewfiles = overri
-00011950: 6465 735b 2766 696c 6573 275d 0a20 2020  des['files'].   
-00011960: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-00011970: 696e 7428 6622 5265 6d65 6469 6174 696e  int(f"Remediatin
-00011980: 6720 6669 6c65 7320 6f66 207b 6e61 6d65  g files of {name
-00011990: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000119a0: 2020 2020 7365 6c66 2e72 656d 6564 6961      self.remedia
-000119b0: 7465 5f66 696c 6573 286e 616d 652c 206e  te_files(name, n
-000119c0: 6577 6669 6c65 732c 206f 7665 7272 6964  ewfiles, overrid
-000119d0: 6573 290a 2020 2020 2020 2020 6966 2073  es).        if s
-000119e0: 656c 662e 7479 7065 203d 3d20 276b 766d  elf.type == 'kvm
-000119f0: 273a 0a20 2020 2020 2020 2020 2020 2070  ':.            p
-00011a00: 6f6f 6c20 3d20 6f76 6572 7269 6465 732e  ool = overrides.
-00011a10: 6765 7428 2770 6f6f 6c27 290a 2020 2020  get('pool').    
-00011a20: 2020 2020 2020 2020 6966 2070 6f6f 6c20          if pool 
-00011a30: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00011a40: 2020 2020 2020 2020 2020 2020 206b 2e75               k.u
-00011a50: 7064 6174 655f 706f 6f6c 286e 616d 652c  pdate_pool(name,
-00011a60: 2070 6f6f 6c29 0a20 2020 2020 2020 2020   pool).         
-00011a70: 2020 2069 6620 6370 7566 6c61 6773 3a0a     if cpuflags:.
-00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a90: 7070 7269 6e74 2866 2255 7064 6174 696e  pprint(f"Updatin
-00011aa0: 6720 6370 7566 6c61 6773 206f 6620 766d  g cpuflags of vm
-00011ab0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
-00011ac0: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
-00011ad0: 7465 5f63 7075 666c 6167 7328 6e61 6d65  te_cpuflags(name
-00011ae0: 2c20 6370 7566 6c61 6773 2c20 6469 7361  , cpuflags, disa
-00011af0: 626c 6529 0a20 2020 2020 2020 2069 6620  ble).        if 
-00011b00: 7365 6c66 2e74 7970 6520 3d3d 2027 7673  self.type == 'vs
-00011b10: 7068 6572 6527 2061 6e64 2074 656d 706c  phere' and templ
-00011b20: 6174 6520 6973 206e 6f74 204e 6f6e 6520  ate is not None 
-00011b30: 616e 6420 6973 696e 7374 616e 6365 2874  and isinstance(t
-00011b40: 656d 706c 6174 652c 2062 6f6f 6c29 3a0a  emplate, bool):.
-00011b50: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-00011b60: 6574 203d 2027 7465 6d70 6c61 7465 2720  et = 'template' 
-00011b70: 6966 2074 656d 706c 6174 6520 656c 7365  if template else
-00011b80: 2027 766d 270a 2020 2020 2020 2020 2020   'vm'.          
-00011b90: 2020 7070 7269 6e74 2866 2255 7064 6174    pprint(f"Updat
-00011ba0: 696e 6720 766d 207b 6e61 6d65 7d20 746f  ing vm {name} to
-00011bb0: 207b 7461 7267 6574 7d2e 2e2e 2229 0a20   {target}..."). 
-00011bc0: 2020 2020 2020 2020 2020 2069 6620 7465             if te
-00011bd0: 6d70 6c61 7465 3a0a 2020 2020 2020 2020  mplate:.        
-00011be0: 2020 2020 2020 2020 6b2e 636f 6e76 6572          k.conver
-00011bf0: 745f 746f 5f74 656d 706c 6174 6528 6e61  t_to_template(na
-00011c00: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00011c10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011c20: 2020 2020 2020 6b2e 636f 6e76 6572 745f        k.convert_
-00011c30: 746f 5f76 6d28 6e61 6d65 290a 2020 2020  to_vm(name).    
-00011c40: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00011c50: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
-00011c60: 0a0a 2020 2020 6465 6620 6c69 7374 5f70  ..    def list_p
-00011c70: 6c61 6e73 2873 656c 6629 3a0a 2020 2020  lans(self):.    
-00011c80: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
-00011c90: 2020 2020 2020 2072 6573 756c 7473 203d         results =
-00011ca0: 205b 5d0a 2020 2020 2020 2020 706c 616e   [].        plan
-00011cb0: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-00011cc0: 6f72 2076 6d20 696e 206b 2e6c 6973 7428  or vm in k.list(
-00011cd0: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
-00011ce0: 6d6e 616d 6520 3d20 766d 5b27 6e61 6d65  mname = vm['name
-00011cf0: 275d 0a20 2020 2020 2020 2020 2020 2070  '].            p
-00011d00: 6c61 6e20 3d20 766d 2e67 6574 2827 706c  lan = vm.get('pl
-00011d10: 616e 2729 0a20 2020 2020 2020 2020 2020  an').           
-00011d20: 2069 6620 706c 616e 2069 7320 4e6f 6e65   if plan is None
-00011d30: 206f 7220 706c 616e 203d 3d20 276b 7669   or plan == 'kvi
-00011d40: 7274 2720 6f72 2070 6c61 6e20 3d3d 2027  rt' or plan == '
-00011d50: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00011d60: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00011d70: 2020 2020 2020 2020 656c 6966 2070 6c61          elif pla
-00011d80: 6e20 6e6f 7420 696e 2070 6c61 6e73 3a0a  n not in plans:.
-00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011da0: 706c 616e 735b 706c 616e 5d20 3d20 5b76  plans[plan] = [v
-00011db0: 6d6e 616d 655d 0a20 2020 2020 2020 2020  mname].         
-00011dc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00011dd0: 2020 2020 2020 2020 2070 6c61 6e73 5b70           plans[p
-00011de0: 6c61 6e5d 2e61 7070 656e 6428 766d 6e61  lan].append(vmna
-00011df0: 6d65 290a 2020 2020 2020 2020 666f 7220  me).        for 
-00011e00: 706c 616e 2069 6e20 706c 616e 733a 0a20  plan in plans:. 
-00011e10: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00011e20: 7473 2e61 7070 656e 6428 5b70 6c61 6e2c  ts.append([plan,
-00011e30: 2027 2c27 2e6a 6f69 6e28 706c 616e 735b   ','.join(plans[
-00011e40: 706c 616e 5d29 5d29 0a20 2020 2020 2020  plan])]).       
-00011e50: 2072 6574 7572 6e20 7265 7375 6c74 730a   return results.
-00011e60: 0a20 2020 2064 6566 206c 6973 745f 6b75  .    def list_ku
-00011e70: 6265 7328 7365 6c66 293a 0a20 2020 2020  bes(self):.     
-00011e80: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
-00011e90: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
-00011ea0: 7065 203d 3d20 2777 6562 2720 616e 6420  pe == 'web' and 
-00011eb0: 7365 6c66 2e6b 2e6c 6f63 616c 6b75 6265  self.k.localkube
-00011ec0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00011ed0: 7475 726e 206b 2e6c 6973 745f 6b75 6265  turn k.list_kube
-00011ee0: 7328 290a 2020 2020 2020 2020 6b75 6265  s().        kube
-00011ef0: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-00011f00: 6f72 2076 6d20 696e 206b 2e6c 6973 7428  or vm in k.list(
-00011f10: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00011f20: 6620 276b 7562 6527 2069 6e20 766d 2061  f 'kube' in vm a
-00011f30: 6e64 2027 6b75 6265 7479 7065 2720 696e  nd 'kubetype' in
-00011f40: 2076 6d3a 0a20 2020 2020 2020 2020 2020   vm:.           
-00011f50: 2020 2020 2076 6d6e 616d 6520 3d20 766d       vmname = vm
-00011f60: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
-00011f70: 2020 2020 2020 2020 206b 7562 6520 3d20           kube = 
-00011f80: 766d 5b27 6b75 6265 275d 0a20 2020 2020  vm['kube'].     
-00011f90: 2020 2020 2020 2020 2020 205f 7479 7065             _type
-00011fa0: 203d 2076 6d5b 276b 7562 6574 7970 6527   = vm['kubetype'
-00011fb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00011fc0: 2020 706c 616e 203d 2076 6d5b 2770 6c61    plan = vm['pla
-00011fd0: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
-00011fe0: 2020 2020 6966 206b 7562 6520 6e6f 7420      if kube not 
-00011ff0: 696e 206b 7562 6573 3a0a 2020 2020 2020  in kubes:.      
-00012000: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
-00012010: 6265 735b 6b75 6265 5d20 3d20 7b27 7479  bes[kube] = {'ty
-00012020: 7065 273a 205f 7479 7065 2c20 2770 6c61  pe': _type, 'pla
-00012030: 6e27 3a20 706c 616e 2c20 2776 6d73 273a  n': plan, 'vms':
-00012040: 205b 766d 6e61 6d65 5d7d 0a20 2020 2020   [vmname]}.     
-00012050: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00012060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012070: 2020 2020 206b 7562 6573 5b6b 7562 655d       kubes[kube]
-00012080: 5b27 766d 7327 5d2e 6170 7065 6e64 2876  ['vms'].append(v
-00012090: 6d6e 616d 6529 0a20 2020 2020 2020 2066  mname).        f
-000120a0: 6f72 206b 7562 6520 696e 206b 7562 6573  or kube in kubes
-000120b0: 3a0a 2020 2020 2020 2020 2020 2020 6b75  :.            ku
-000120c0: 6265 735b 6b75 6265 5d5b 2776 6d73 275d  bes[kube]['vms']
-000120d0: 203d 2027 2c27 2e6a 6f69 6e28 6b75 6265   = ','.join(kube
-000120e0: 735b 6b75 6265 5d5b 2776 6d73 275d 290a  s[kube]['vms']).
-000120f0: 2020 2020 2020 2020 636c 7573 7465 7273          clusters
-00012100: 6469 7220 3d20 6f73 2e70 6174 682e 6578  dir = os.path.ex
-00012110: 7061 6e64 7573 6572 2827 7e2f 2e6b 636c  panduser('~/.kcl
-00012120: 692f 636c 7573 7465 7273 2729 0a20 2020  i/clusters').   
-00012130: 2020 2020 2066 6f72 206b 7562 6520 696e       for kube in
-00012140: 206e 6578 7428 6f73 2e77 616c 6b28 636c   next(os.walk(cl
-00012150: 7573 7465 7273 6469 7229 295b 315d 3a0a  ustersdir))[1]:.
-00012160: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00012170: 7562 6520 696e 206b 7562 6573 3a0a 2020  ube in kubes:.  
-00012180: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00012190: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-000121a0: 2020 2063 6c75 7374 6572 6469 7220 3d20     clusterdir = 
-000121b0: 6627 7b63 6c75 7374 6572 7364 6972 7d2f  f'{clustersdir}/
-000121c0: 7b6b 7562 657d 270a 2020 2020 2020 2020  {kube}'.        
-000121d0: 2020 2020 5f74 7970 652c 2070 6c61 6e20      _type, plan 
-000121e0: 3d20 2767 656e 6572 6963 272c 206b 7562  = 'generic', kub
-000121f0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00012200: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00012210: 6627 7b63 6c75 7374 6572 6469 727d 2f6b  f'{clusterdir}/k
-00012220: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
-00012230: 6d6c 2729 3a0a 2020 2020 2020 2020 2020  ml'):.          
-00012240: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00012250: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
-00012260: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
-00012270: 6d6c 222c 2027 7227 2920 6173 2069 6e73  ml", 'r') as ins
-00012280: 7461 6c6c 3a0a 2020 2020 2020 2020 2020  tall:.          
-00012290: 2020 2020 2020 2020 2020 696e 7374 616c            instal
-000122a0: 6c70 6172 616d 203d 2079 616d 6c2e 7361  lparam = yaml.sa
-000122b0: 6665 5f6c 6f61 6428 696e 7374 616c 6c29  fe_load(install)
-000122c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000122d0: 2020 2020 205f 7479 7065 203d 2069 6e73       _type = ins
-000122e0: 7461 6c6c 7061 7261 6d2e 6765 7428 276b  tallparam.get('k
-000122f0: 7562 6574 7970 6527 2c20 5f74 7970 6529  ubetype', _type)
-00012300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012310: 2020 2020 2070 6c61 6e20 3d20 696e 7374       plan = inst
-00012320: 616c 6c70 6172 616d 2e67 6574 2827 706c  allparam.get('pl
-00012330: 616e 272c 2070 6c61 6e29 0a20 2020 2020  an', plan).     
-00012340: 2020 2020 2020 206b 7562 6573 5b6b 7562         kubes[kub
-00012350: 655d 203d 207b 2774 7970 6527 3a20 5f74  e] = {'type': _t
-00012360: 7970 652c 2027 706c 616e 273a 2070 6c61  ype, 'plan': pla
-00012370: 6e2c 2027 766d 7327 3a20 5b5d 7d0a 2020  n, 'vms': []}.  
-00012380: 2020 2020 2020 7265 7475 726e 206b 7562        return kub
-00012390: 6573 0a0a 2020 2020 6465 6620 6372 6561  es..    def crea
-000123a0: 7465 5f70 726f 6475 6374 2873 656c 662c  te_product(self,
-000123b0: 206e 616d 652c 2072 6570 6f3d 4e6f 6e65   name, repo=None
-000123c0: 2c20 6772 6f75 703d 4e6f 6e65 2c20 706c  , group=None, pl
-000123d0: 616e 3d4e 6f6e 652c 206c 6174 6573 743d  an=None, latest=
-000123e0: 4661 6c73 652c 206f 7665 7272 6964 6573  False, overrides
-000123f0: 3d7b 7d29 3a0a 2020 2020 2020 2020 2222  ={}):.        ""
-00012400: 2243 7265 6174 6520 7072 6f64 7563 7422  "Create product"
-00012410: 2222 0a20 2020 2020 2020 2069 6620 7265  "".        if re
-00012420: 706f 2069 7320 6e6f 7420 4e6f 6e65 2061  po is not None a
-00012430: 6e64 2067 726f 7570 2069 7320 6e6f 7420  nd group is not 
-00012440: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00012450: 2020 7072 6f64 7563 7473 203d 205b 7072    products = [pr
-00012460: 6f64 7563 7420 666f 7220 7072 6f64 7563  oduct for produc
-00012470: 7420 696e 2073 656c 662e 6c69 7374 5f70  t in self.list_p
-00012480: 726f 6475 6374 7328 290a 2020 2020 2020  roducts().      
-00012490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124a0: 2020 6966 2070 726f 6475 6374 5b27 6e61    if product['na
-000124b0: 6d65 275d 203d 3d20 6e61 6d65 2061 6e64  me'] == name and
-000124c0: 2070 726f 6475 6374 5b27 7265 706f 275d   product['repo']
-000124d0: 203d 3d20 7265 706f 2061 6e64 2070 726f   == repo and pro
-000124e0: 6475 6374 5b27 6772 6f75 7027 5d20 3d3d  duct['group'] ==
-000124f0: 2067 726f 7570 5d0a 2020 2020 2020 2020   group].        
-00012500: 656c 6966 2072 6570 6f20 6973 206e 6f74  elif repo is not
-00012510: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00012520: 2020 2070 726f 6475 6374 7320 3d20 5b70     products = [p
-00012530: 726f 6475 6374 2066 6f72 2070 726f 6475  roduct for produ
-00012540: 6374 2069 6e20 7365 6c66 2e6c 6973 745f  ct in self.list_
-00012550: 7072 6f64 7563 7473 2829 0a20 2020 2020  products().     
-00012560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012570: 2020 2069 6620 7072 6f64 7563 745b 276e     if product['n
-00012580: 616d 6527 5d20 3d3d 206e 616d 6520 616e  ame'] == name an
-00012590: 6420 7072 6f64 7563 745b 2772 6570 6f27  d product['repo'
-000125a0: 5d20 3d3d 2072 6570 6f5d 0a20 2020 2020  ] == repo].     
-000125b0: 2020 2069 6620 6772 6f75 7020 6973 206e     if group is n
-000125c0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000125d0: 2020 2020 2070 726f 6475 6374 7320 3d20       products = 
-000125e0: 5b70 726f 6475 6374 2066 6f72 2070 726f  [product for pro
-000125f0: 6475 6374 2069 6e20 7365 6c66 2e6c 6973  duct in self.lis
-00012600: 745f 7072 6f64 7563 7473 2829 0a20 2020  t_products().   
-00012610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012620: 2020 2020 2069 6620 7072 6f64 7563 745b       if product[
-00012630: 276e 616d 6527 5d20 3d3d 206e 616d 6520  'name'] == name 
-00012640: 616e 6420 7072 6f64 7563 745b 2767 726f  and product['gro
-00012650: 7570 275d 203d 3d20 6772 6f75 705d 0a20  up'] == group]. 
-00012660: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00012670: 2020 2020 2020 2020 2070 726f 6475 6374           product
-00012680: 7320 3d20 5b70 726f 6475 6374 2066 6f72  s = [product for
-00012690: 2070 726f 6475 6374 2069 6e20 7365 6c66   product in self
-000126a0: 2e6c 6973 745f 7072 6f64 7563 7473 2829  .list_products()
-000126b0: 2069 6620 7072 6f64 7563 745b 276e 616d   if product['nam
-000126c0: 6527 5d20 3d3d 206e 616d 655d 0a20 2020  e'] == name].   
-000126d0: 2020 2020 2069 6620 6c65 6e28 7072 6f64       if len(prod
-000126e0: 7563 7473 2920 3d3d 2030 3a0a 2020 2020  ucts) == 0:.    
-000126f0: 2020 2020 2020 2020 6572 726f 7228 2250          error("P
-00012700: 726f 6475 6374 206e 6f74 2066 6f75 6e64  roduct not found
-00012710: 2e20 4c65 6176 696e 672e 2e2e 2229 0a20  . Leaving..."). 
-00012720: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00012730: 7869 7428 3129 0a20 2020 2020 2020 2065  xit(1).        e
-00012740: 6c69 6620 6c65 6e28 7072 6f64 7563 7473  lif len(products
-00012750: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
-00012760: 2020 2065 7272 6f72 2822 5072 6f64 7563     error("Produc
-00012770: 7420 666f 756e 6420 696e 2073 6576 6572  t found in sever
-00012780: 616c 2072 6570 6f73 206f 7220 6772 6f75  al repos or grou
-00012790: 7073 2e20 5370 6563 6966 7920 6f6e 652e  ps. Specify one.
-000127a0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000127b0: 2066 6f72 2070 726f 6475 6374 2069 6e20   for product in 
-000127c0: 7072 6f64 7563 7473 3a0a 2020 2020 2020  products:.      
-000127d0: 2020 2020 2020 2020 2020 6772 6f75 7020            group 
-000127e0: 3d20 7072 6f64 7563 745b 2767 726f 7570  = product['group
-000127f0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00012800: 2020 2072 6570 6f20 3d20 7072 6f64 7563     repo = produc
-00012810: 745b 2772 6570 6f27 5d0a 2020 2020 2020  t['repo'].      
-00012820: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00012830: 6622 7265 706f 3a7b 7265 706f 7d5c 7467  f"repo:{repo}\tg
-00012840: 726f 7570 3a7b 6772 6f75 707d 2229 0a20  roup:{group}"). 
-00012850: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00012860: 7869 7428 3129 0a20 2020 2020 2020 2065  xit(1).        e
-00012870: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00012880: 2070 726f 6475 6374 203d 2070 726f 6475   product = produ
-00012890: 6374 735b 305d 0a20 2020 2020 2020 2020  cts[0].         
-000128a0: 2020 2070 6c61 6e20 3d20 6e61 6d65 7574     plan = nameut
-000128b0: 696c 732e 6765 745f 7261 6e64 6f6d 5f6e  ils.get_random_n
-000128c0: 616d 6528 2920 6966 2070 6c61 6e20 6973  ame() if plan is
-000128d0: 204e 6f6e 6520 656c 7365 2070 6c61 6e0a   None else plan.
-000128e0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-000128f0: 203d 2070 726f 6475 6374 5b27 7265 706f   = product['repo
-00012900: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
-00012910: 6620 2772 6561 6c64 6972 2720 696e 2070  f 'realdir' in p
-00012920: 726f 6475 6374 3a0a 2020 2020 2020 2020  roduct:.        
-00012930: 2020 2020 2020 2020 7265 706f 6469 7220          repodir 
-00012940: 3d20 2225 732f 2e6b 636c 692f 706c 616e  = "%s/.kcli/plan
-00012950: 732f 2573 2f25 7322 2025 2028 6f73 2e65  s/%s/%s" % (os.e
-00012960: 6e76 6972 6f6e 2e67 6574 2827 484f 4d45  nviron.get('HOME
-00012970: 2729 2c20 7265 706f 2c20 7072 6f64 7563  '), repo, produc
-00012980: 745b 2772 6561 6c64 6972 275d 290a 2020  t['realdir']).  
-00012990: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129b0: 7265 706f 6469 7220 3d20 2225 732f 2e6b  repodir = "%s/.k
-000129c0: 636c 692f 706c 616e 732f 2573 2220 2520  cli/plans/%s" % 
-000129d0: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
-000129e0: 2748 4f4d 4527 292c 2072 6570 6f29 0a20  'HOME'), repo). 
-000129f0: 2020 2020 2020 2020 2020 2069 6620 272f             if '/
-00012a00: 2720 696e 2070 726f 6475 6374 5b27 6669  ' in product['fi
-00012a10: 6c65 275d 3a0a 2020 2020 2020 2020 2020  le']:.          
-00012a20: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
-00012a30: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00012a40: 6d65 2870 726f 6475 6374 5b27 6669 6c65  me(product['file
-00012a50: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00012a60: 2020 2020 7265 706f 6469 7220 2b3d 2022      repodir += "
-00012a70: 2f25 7322 2025 206f 732e 7061 7468 2e64  /%s" % os.path.d
-00012a80: 6972 6e61 6d65 2870 726f 6475 6374 5b27  irname(product['
-00012a90: 6669 6c65 275d 290a 2020 2020 2020 2020  file']).        
-00012aa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012ab0: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
-00012ac0: 696c 6520 3d20 7072 6f64 7563 745b 2766  ile = product['f
-00012ad0: 696c 6527 5d0a 2020 2020 2020 2020 2020  ile'].          
-00012ae0: 2020 696d 6167 6520 3d20 7072 6f64 7563    image = produc
-00012af0: 742e 6765 7428 2769 6d61 6765 2729 0a20  t.get('image'). 
-00012b00: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00012b10: 6574 6572 7320 3d20 7072 6f64 7563 742e  eters = product.
-00012b20: 6765 7428 2770 6172 616d 6574 6572 7327  get('parameters'
-00012b30: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00012b40: 2069 6d61 6765 2069 7320 6e6f 7420 4e6f   image is not No
-00012b50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00012b60: 2020 2020 7072 696e 7428 6622 4e6f 7465      print(f"Note
-00012b70: 2074 6861 7420 7468 6973 2070 726f 6475   that this produ
-00012b80: 6374 2075 7365 7320 696d 6167 653a 207b  ct uses image: {
-00012b90: 696d 6167 657d 2229 0a20 2020 2020 2020  image}").       
-00012ba0: 2020 2020 2069 6620 7061 7261 6d65 7465       if paramete
-00012bb0: 7273 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rs is not None:.
-00012bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bd0: 666f 7220 7061 7261 6d65 7465 7220 696e  for parameter in
-00012be0: 2070 6172 616d 6574 6572 733a 0a20 2020   parameters:.   
-00012bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c00: 2061 7070 6c69 6564 5f70 6172 616d 6574   applied_paramet
-00012c10: 6572 203d 206f 7665 7272 6964 6573 5b70  er = overrides[p
-00012c20: 6172 616d 6574 6572 5d20 6966 2070 6172  arameter] if par
-00012c30: 616d 6574 6572 2069 6e20 6f76 6572 7269  ameter in overri
-00012c40: 6465 7320 656c 7365 2070 6172 616d 6574  des else paramet
-00012c50: 6572 735b 7061 7261 6d65 7465 725d 0a20  ers[parameter]. 
-00012c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c70: 2020 2070 7269 6e74 2866 2255 7369 6e67     print(f"Using
-00012c80: 2070 6172 616d 6574 6572 207b 7061 7261   parameter {para
-00012c90: 6d65 7465 727d 3a20 7b61 7070 6c69 6564  meter}: {applied
-00012ca0: 5f70 6172 616d 6574 6572 7d22 290a 2020  _parameter}").  
-00012cb0: 2020 2020 2020 2020 2020 6578 7472 6170            extrap
-00012cc0: 6172 616d 6574 6572 7320 3d20 6c69 7374  arameters = list
-00012cd0: 2873 6574 286f 7665 7272 6964 6573 2920  (set(overrides) 
-00012ce0: 2d20 7365 7428 7061 7261 6d65 7465 7273  - set(parameters
-00012cf0: 2929 2069 6620 7061 7261 6d65 7465 7273  )) if parameters
-00012d00: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00012d10: 6520 6f76 6572 7269 6465 730a 2020 2020  e overrides.    
-00012d20: 2020 2020 2020 2020 666f 7220 7061 7261          for para
-00012d30: 6d65 7465 7220 696e 2065 7874 7261 7061  meter in extrapa
-00012d40: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
-00012d50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00012d60: 2255 7369 6e67 2070 6172 616d 6574 6572  "Using parameter
-00012d70: 2025 733a 2025 7322 2025 2028 7061 7261   %s: %s" % (para
-00012d80: 6d65 7465 722c 206f 7665 7272 6964 6573  meter, overrides
-00012d90: 5b70 6172 616d 6574 6572 5d29 290a 2020  [parameter])).  
-00012da0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00012db0: 206c 6174 6573 743a 0a20 2020 2020 2020   latest:.       
-00012dc0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00012dd0: 6622 5573 696e 6720 6469 7265 6374 6f72  f"Using director
-00012de0: 7920 7b72 6570 6f64 6972 7d22 290a 2020  y {repodir}").  
-00012df0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012e00: 6c66 2e70 6c61 6e28 706c 616e 2c20 7061  lf.plan(plan, pa
-00012e10: 7468 3d72 6570 6f64 6972 2c20 696e 7075  th=repodir, inpu
-00012e20: 7466 696c 653d 696e 7075 7466 696c 652c  tfile=inputfile,
-00012e30: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00012e40: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
-00012e50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012e60: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00012e70: 6174 655f 7265 706f 2872 6570 6f29 0a20  ate_repo(repo). 
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012e90: 656c 662e 706c 616e 2870 6c61 6e2c 2070  elf.plan(plan, p
-00012ea0: 6174 683d 7265 706f 6469 722c 2069 6e70  ath=repodir, inp
-00012eb0: 7574 6669 6c65 3d69 6e70 7574 6669 6c65  utfile=inputfile
-00012ec0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00012ed0: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
-00012ee0: 2020 2070 7072 696e 7428 6622 5072 6f64     pprint(f"Prod
-00012ef0: 7563 7420 6361 6e20 6265 2064 656c 6574  uct can be delet
-00012f00: 6564 2077 6974 683a 206b 636c 6920 6465  ed with: kcli de
-00012f10: 6c65 7465 2070 6c61 6e20 2d2d 7965 7320  lete plan --yes 
-00012f20: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
-00012f30: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00012f40: 273a 2027 7375 6363 6573 7327 2c20 2770  ': 'success', 'p
-00012f50: 6c61 6e27 3a20 706c 616e 7d0a 0a20 2020  lan': plan}..   
-00012f60: 2064 6566 2073 7461 7274 5f70 6c61 6e28   def start_plan(
-00012f70: 7365 6c66 2c20 706c 616e 2c20 636f 6e74  self, plan, cont
-00012f80: 6169 6e65 723d 4661 6c73 6529 3a0a 2020  ainer=False):.  
-00012f90: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
-00012fa0: 0a20 2020 2020 2020 2073 7461 7274 666f  .        startfo
-00012fb0: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
-00012fc0: 2020 2020 7070 7269 6e74 2866 2253 7461      pprint(f"Sta
-00012fd0: 7274 696e 6720 766d 7320 6672 6f6d 2070  rting vms from p
-00012fe0: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
-00012ff0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00013000: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
-00013010: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00013020: 636c 6965 6e74 7320 3d20 7b73 656c 662e  clients = {self.
-00013030: 636c 6965 6e74 3a20 6b7d 0a20 2020 2020  client: k}.     
-00013040: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00013050: 2020 2020 2073 7461 7274 636c 6965 6e74       startclient
-00013060: 7320 3d20 7365 6c66 2e65 7874 7261 636c  s = self.extracl
-00013070: 6965 6e74 730a 2020 2020 2020 2020 2020  ients.          
-00013080: 2020 7374 6172 7463 6c69 656e 7473 2e75    startclients.u
-00013090: 7064 6174 6528 7b73 656c 662e 636c 6965  pdate({self.clie
-000130a0: 6e74 3a20 6b7d 290a 2020 2020 2020 2020  nt: k}).        
-000130b0: 666f 7220 6879 7065 7276 6973 6f72 2069  for hypervisor i
-000130c0: 6e20 7374 6172 7463 6c69 656e 7473 3a0a  n startclients:.
-000130d0: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
-000130e0: 7374 6172 7463 6c69 656e 7473 5b68 7970  startclients[hyp
-000130f0: 6572 7669 736f 725d 0a20 2020 2020 2020  ervisor].       
-00013100: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
-00013110: 6f72 7465 6428 632e 6c69 7374 2829 2c20  orted(c.list(), 
-00013120: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
-00013130: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
-00013140: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-00013150: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
-00013160: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00013170: 7269 7074 696f 6e20 3d20 766d 2e67 6574  ription = vm.get
-00013180: 2827 706c 616e 2729 0a20 2020 2020 2020  ('plan').       
-00013190: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
-000131a0: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
-000131b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000131c0: 2020 2020 2073 7461 7274 666f 756e 6420       startfound 
-000131d0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-000131e0: 2020 2020 2020 2020 2020 2063 2e73 7461             c.sta
-000131f0: 7274 286e 616d 6529 0a20 2020 2020 2020  rt(name).       
-00013200: 2020 2020 2020 2020 2020 2020 2073 7563               suc
-00013210: 6365 7373 2866 227b 6e61 6d65 7d20 7374  cess(f"{name} st
-00013220: 6172 7465 6420 6f6e 207b 6879 7065 7276  arted on {hyperv
-00013230: 6973 6f72 7d21 2229 0a20 2020 2020 2020  isor}!").       
-00013240: 2069 6620 636f 6e74 6169 6e65 723a 0a20   if container:. 
-00013250: 2020 2020 2020 2020 2020 2063 6f6e 7420             cont 
-00013260: 3d20 4b63 6f6e 7461 696e 6572 636f 6e66  = Kcontainerconf
-00013270: 6967 2873 656c 662c 2063 6c69 656e 743d  ig(self, client=
-00013280: 7365 6c66 2e63 6f6e 7461 696e 6572 636c  self.containercl
-00013290: 6965 6e74 292e 636f 6e74 0a20 2020 2020  ient).cont.     
-000132a0: 2020 2020 2020 2066 6f72 2063 6f6e 7461         for conta
-000132b0: 2069 6e20 736f 7274 6564 2863 6f6e 742e   in sorted(cont.
-000132c0: 6c69 7374 5f63 6f6e 7461 696e 6572 7328  list_containers(
-000132d0: 6b29 293a 0a20 2020 2020 2020 2020 2020  k)):.           
-000132e0: 2020 2020 206e 616d 6520 3d20 636f 6e74       name = cont
-000132f0: 615b 305d 0a20 2020 2020 2020 2020 2020  a[0].           
-00013300: 2020 2020 2063 6f6e 7461 696e 6572 706c       containerpl
-00013310: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
-00013320: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00013330: 2063 6f6e 7461 696e 6572 706c 616e 203d   containerplan =
-00013340: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
-00013350: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00013360: 7466 6f75 6e64 203d 2054 7275 650a 2020  tfound = True.  
-00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013380: 2020 636f 6e74 2e73 7461 7274 5f63 6f6e    cont.start_con
-00013390: 7461 696e 6572 286e 616d 6529 0a20 2020  tainer(name).   
-000133a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133b0: 2073 7563 6365 7373 2866 2243 6f6e 7461   success(f"Conta
-000133c0: 696e 6572 207b 6e61 6d65 7d20 7374 6172  iner {name} star
-000133d0: 7465 6421 2229 0a20 2020 2020 2020 2069  ted!").        i
-000133e0: 6620 7374 6172 7466 6f75 6e64 3a0a 2020  f startfound:.  
-000133f0: 2020 2020 2020 2020 2020 7375 6363 6573            succes
-00013400: 7328 6622 506c 616e 207b 706c 616e 7d20  s(f"Plan {plan} 
-00013410: 7374 6172 7465 6421 2229 0a20 2020 2020  started!").     
-00013420: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00013430: 2020 2020 2077 6172 6e69 6e67 2822 4e6f       warning("No
-00013440: 206d 6174 6368 696e 6720 6f62 6a65 6374   matching object
-00013450: 7320 666f 756e 6422 290a 2020 2020 2020  s found").      
-00013460: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00013470: 7427 3a20 2773 7563 6365 7373 277d 0a0a  t': 'success'}..
-00013480: 2020 2020 6465 6620 7374 6f70 5f70 6c61      def stop_pla
-00013490: 6e28 7365 6c66 2c20 706c 616e 2c20 736f  n(self, plan, so
-000134a0: 6674 3d46 616c 7365 2c20 636f 6e74 6169  ft=False, contai
-000134b0: 6e65 723d 4661 6c73 6529 3a0a 2020 2020  ner=False):.    
-000134c0: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
-000134d0: 2020 2020 2020 2073 746f 7066 6f75 6e64         stopfound
-000134e0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000134f0: 7070 7269 6e74 2866 2253 746f 7070 696e  pprint(f"Stoppin
-00013500: 6720 766d 7320 6672 6f6d 2070 6c61 6e20  g vms from plan 
-00013510: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
-00013520: 2069 6620 6e6f 7420 7365 6c66 2e65 7874   if not self.ext
-00013530: 7261 636c 6965 6e74 733a 0a20 2020 2020  raclients:.     
-00013540: 2020 2020 2020 2073 746f 7063 6c69 656e         stopclien
-00013550: 7473 203d 207b 7365 6c66 2e63 6c69 656e  ts = {self.clien
-00013560: 743a 206b 7d0a 2020 2020 2020 2020 656c  t: k}.        el
-00013570: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00013580: 7374 6f70 636c 6965 6e74 7320 3d20 7365  stopclients = se
-00013590: 6c66 2e65 7874 7261 636c 6965 6e74 730a  lf.extraclients.
-000135a0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-000135b0: 636c 6965 6e74 732e 7570 6461 7465 287b  clients.update({
-000135c0: 7365 6c66 2e63 6c69 656e 743a 206b 7d29  self.client: k})
-000135d0: 0a20 2020 2020 2020 2066 6f72 2068 7970  .        for hyp
-000135e0: 6572 7669 736f 7220 696e 2073 746f 7063  ervisor in stopc
-000135f0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-00013600: 2020 2020 6320 3d20 7374 6f70 636c 6965      c = stopclie
-00013610: 6e74 735b 6879 7065 7276 6973 6f72 5d0a  nts[hypervisor].
-00013620: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00013630: 766d 2069 6e20 736f 7274 6564 2863 2e6c  vm in sorted(c.l
-00013640: 6973 7428 292c 206b 6579 3d6c 616d 6264  ist(), key=lambd
-00013650: 6120 783a 2078 5b27 6e61 6d65 275d 293a  a x: x['name']):
-00013660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013670: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
-00013680: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00013690: 2020 2064 6573 6372 6970 7469 6f6e 203d     description =
-000136a0: 2076 6d2e 6765 7428 2770 6c61 6e27 290a   vm.get('plan').
-000136b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136c0: 6966 2064 6573 6372 6970 7469 6f6e 203d  if description =
-000136d0: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
-000136e0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-000136f0: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
-00013700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013710: 2063 2e73 746f 7028 6e61 6d65 2c20 736f   c.stop(name, so
-00013720: 6674 3d73 6f66 7429 0a20 2020 2020 2020  ft=soft).       
-00013730: 2020 2020 2020 2020 2020 2020 2073 7563               suc
-00013740: 6365 7373 2866 227b 6e61 6d65 7d20 7374  cess(f"{name} st
-00013750: 6f70 7065 6420 6f6e 207b 6879 7065 7276  opped on {hyperv
-00013760: 6973 6f72 7d21 2229 0a20 2020 2020 2020  isor}!").       
-00013770: 2069 6620 636f 6e74 6169 6e65 723a 0a20   if container:. 
-00013780: 2020 2020 2020 2020 2020 2063 6f6e 7420             cont 
-00013790: 3d20 4b63 6f6e 7461 696e 6572 636f 6e66  = Kcontainerconf
-000137a0: 6967 2873 656c 662c 2063 6c69 656e 743d  ig(self, client=
-000137b0: 7365 6c66 2e63 6f6e 7461 696e 6572 636c  self.containercl
-000137c0: 6965 6e74 292e 636f 6e74 0a20 2020 2020  ient).cont.     
-000137d0: 2020 2020 2020 2066 6f72 2063 6f6e 7461         for conta
-000137e0: 2069 6e20 736f 7274 6564 2863 6f6e 742e   in sorted(cont.
-000137f0: 6c69 7374 5f63 6f6e 7461 696e 6572 7328  list_containers(
-00013800: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00013810: 2020 2020 6e61 6d65 203d 2063 6f6e 7461      name = conta
-00013820: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00013830: 2020 2020 636f 6e74 6169 6e65 7270 6c61      containerpla
-00013840: 6e20 3d20 636f 6e74 615b 335d 0a20 2020  n = conta[3].   
-00013850: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00013860: 636f 6e74 6169 6e65 7270 6c61 6e20 3d3d  containerplan ==
-00013870: 2070 6c61 6e3a 0a20 2020 2020 2020 2020   plan:.         
-00013880: 2020 2020 2020 2020 2020 2073 746f 7066             stopf
-00013890: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
-000138a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138b0: 636f 6e74 2e73 746f 705f 636f 6e74 6169  cont.stop_contai
-000138c0: 6e65 7228 6e61 6d65 290a 2020 2020 2020  ner(name).      
-000138d0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-000138e0: 6363 6573 7328 6622 436f 6e74 6169 6e65  ccess(f"Containe
-000138f0: 7220 7b6e 616d 657d 2073 746f 7070 6564  r {name} stopped
-00013900: 2122 290a 2020 2020 2020 2020 6966 2073  !").        if s
-00013910: 746f 7066 6f75 6e64 3a0a 2020 2020 2020  topfound:.      
-00013920: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00013930: 506c 616e 207b 706c 616e 7d20 7374 6f70  Plan {plan} stop
-00013940: 7065 6421 2229 0a20 2020 2020 2020 2065  ped!").        e
-00013950: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00013960: 2077 6172 6e69 6e67 2822 4e6f 206d 6174   warning("No mat
-00013970: 6368 696e 6720 6f62 6a65 6374 7320 666f  ching objects fo
-00013980: 756e 6422 290a 2020 2020 2020 2020 7265  und").        re
-00013990: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-000139a0: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
-000139b0: 6465 6620 6175 746f 7374 6172 745f 706c  def autostart_pl
-000139c0: 616e 2873 656c 662c 2070 6c61 6e29 3a0a  an(self, plan):.
-000139d0: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
-000139e0: 2e6b 0a20 2020 2020 2020 2070 7072 696e  .k.        pprin
-000139f0: 7428 6622 5365 7420 766d 7320 6672 6f6d  t(f"Set vms from
-00013a00: 2070 6c61 6e20 7b70 6c61 6e7d 2074 6f20   plan {plan} to 
-00013a10: 6175 746f 7374 6172 7422 290a 2020 2020  autostart").    
-00013a20: 2020 2020 666f 7220 766d 2069 6e20 736f      for vm in so
-00013a30: 7274 6564 286b 2e6c 6973 7428 292c 206b  rted(k.list(), k
-00013a40: 6579 3d6c 616d 6264 6120 783a 2078 5b27  ey=lambda x: x['
-00013a50: 6e61 6d65 275d 293a 0a20 2020 2020 2020  name']):.       
-00013a60: 2020 2020 206e 616d 6520 3d20 766d 5b27       name = vm['
-00013a70: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
-00013a80: 2020 2064 6573 6372 6970 7469 6f6e 203d     description =
-00013a90: 2076 6d5b 2770 6c61 6e27 5d0a 2020 2020   vm['plan'].    
-00013aa0: 2020 2020 2020 2020 6966 2064 6573 6372          if descr
-00013ab0: 6970 7469 6f6e 203d 3d20 706c 616e 3a0a  iption == plan:.
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 6b2e 7570 6461 7465 5f73 7461 7274 286e  k.update_start(n
-00013ae0: 616d 652c 2073 7461 7274 3d54 7275 6529  ame, start=True)
-00013af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013b00: 2073 7563 6365 7373 2866 227b 6e61 6d65   success(f"{name
-00013b10: 7d20 7365 7420 746f 2061 7574 6f73 7461  } set to autosta
-00013b20: 7274 2122 290a 2020 2020 2020 2020 7265  rt!").        re
-00013b30: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00013b40: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
-00013b50: 6465 6620 6e6f 6175 746f 7374 6172 745f  def noautostart_
-00013b60: 706c 616e 2873 656c 662c 2070 6c61 6e29  plan(self, plan)
-00013b70: 3a0a 2020 2020 2020 2020 6b20 3d20 7365  :.        k = se
-00013b80: 6c66 2e6b 0a20 2020 2020 2020 2070 7072  lf.k.        ppr
-00013b90: 696e 7428 6622 5072 6576 656e 7469 6e67  int(f"Preventing
-00013ba0: 2076 6d73 2066 726f 6d20 706c 616e 207b   vms from plan {
-00013bb0: 706c 616e 7d20 746f 2061 7574 6f73 7461  plan} to autosta
-00013bc0: 7274 2229 0a20 2020 2020 2020 2066 6f72  rt").        for
-00013bd0: 2076 6d20 696e 2073 6f72 7465 6428 6b2e   vm in sorted(k.
-00013be0: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
-00013bf0: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
-00013c00: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-00013c10: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
-00013c20: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00013c30: 7269 7074 696f 6e20 3d20 766d 5b27 706c  ription = vm['pl
-00013c40: 616e 275d 0a20 2020 2020 2020 2020 2020  an'].           
-00013c50: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
-00013c60: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-00013c70: 2020 2020 2020 2020 206b 2e75 7064 6174           k.updat
-00013c80: 655f 7374 6172 7428 6e61 6d65 2c20 7374  e_start(name, st
-00013c90: 6172 743d 4661 6c73 6529 0a20 2020 2020  art=False).     
-00013ca0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00013cb0: 7373 2866 227b 6e61 6d65 7d20 7072 6576  ss(f"{name} prev
-00013cc0: 656e 7465 6420 746f 2061 7574 6f73 7461  ented to autosta
-00013cd0: 7274 2122 290a 2020 2020 2020 2020 7265  rt!").        re
-00013ce0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00013cf0: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
-00013d00: 6465 6620 6465 6c65 7465 5f70 6c61 6e28  def delete_plan(
-00013d10: 7365 6c66 2c20 706c 616e 2c20 636f 6e74  self, plan, cont
-00013d20: 6169 6e65 723d 4661 6c73 652c 2075 6e72  ainer=False, unr
-00013d30: 6567 6973 7465 723d 4661 6c73 6529 3a0a  egister=False):.
-00013d40: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
-00013d50: 2e6b 0a20 2020 2020 2020 2064 656c 6574  .k.        delet
-00013d60: 6564 766d 7320 3d20 5b5d 0a20 2020 2020  edvms = [].     
-00013d70: 2020 2064 656c 6574 6564 6c62 7320 3d20     deletedlbs = 
-00013d80: 5b5d 0a20 2020 2020 2020 2064 6e73 636c  [].        dnscl
-00013d90: 6965 6e74 7320 3d20 5b5d 0a20 2020 2020  ients = [].     
-00013da0: 2020 206e 6574 776f 726b 7320 3d20 5b5d     networks = []
-00013db0: 0a20 2020 2020 2020 2069 6620 706c 616e  .        if plan
-00013dc0: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
-00013dd0: 2020 2020 6572 726f 7228 2254 6861 7420      error("That 
-00013de0: 776f 756c 6420 6465 6c65 7465 2065 7665  would delete eve
-00013df0: 7279 2076 6d2e 2e2e 4e6f 7420 646f 696e  ry vm...Not doin
-00013e00: 6720 7468 6174 2229 0a20 2020 2020 2020  g that").       
-00013e10: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-00013e20: 0a20 2020 2020 2020 2066 6f75 6e64 203d  .        found =
-00013e30: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-00013e40: 656c 6574 6563 6c69 656e 7473 203d 207b  eleteclients = {
-00013e50: 7365 6c66 2e63 6c69 656e 743a 206b 7d0a  self.client: k}.
-00013e60: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
-00013e70: 7320 3d20 5b5d 0a20 2020 2020 2020 2076  s = [].        v
-00013e80: 6d63 6c69 656e 7473 5f66 696c 6520 3d20  mclients_file = 
-00013e90: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-00013ea0: 6572 2866 277e 2f2e 6b63 6c69 2f76 6d63  er(f'~/.kcli/vmc
-00013eb0: 6c69 656e 7473 5f7b 706c 616e 7d27 290a  lients_{plan}').
-00013ec0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00013ed0: 7468 2e65 7869 7374 7328 766d 636c 6965  th.exists(vmclie
-00013ee0: 6e74 735f 6669 6c65 293a 0a20 2020 2020  nts_file):.     
-00013ef0: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
-00013f00: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
-00013f10: 6428 6f70 656e 2876 6d63 6c69 656e 7473  d(open(vmclients
-00013f20: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
-00013f30: 2020 2020 6f73 2e72 656d 6f76 6528 766d      os.remove(vm
-00013f40: 636c 6965 6e74 735f 6669 6c65 290a 2020  clients_file).  
-00013f50: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-00013f60: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
-00013f70: 2020 2020 2020 2020 6465 6c65 7465 636c          deletecl
-00013f80: 6965 6e74 732e 7570 6461 7465 2873 656c  ients.update(sel
-00013f90: 662e 6578 7472 6163 6c69 656e 7473 290a  f.extraclients).
-00013fa0: 2020 2020 2020 2020 656c 6966 2076 6d63          elif vmc
-00013fb0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-00013fc0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
-00013fd0: 732e 7570 6461 7465 287b 636c 693a 204b  s.update({cli: K
-00013fe0: 636f 6e66 6967 2863 6c69 656e 743d 636c  config(client=cl
-00013ff0: 6929 2e6b 2066 6f72 2063 6c69 2069 6e20  i).k for cli in 
-00014000: 766d 636c 6965 6e74 7320 6966 2063 6c69  vmclients if cli
-00014010: 2021 3d20 7365 6c66 2e63 6c69 656e 747d   != self.client}
-00014020: 290a 2020 2020 2020 2020 6879 7065 7273  ).        hypers
-00014030: 6869 6674 203d 2046 616c 7365 0a20 2020  hift = False.   
-00014040: 2020 2020 2061 7373 6973 7465 6420 3d20       assisted = 
-00014050: 4661 6c73 650a 2020 2020 2020 2020 666f  False.        fo
-00014060: 7220 6879 7065 7276 6973 6f72 2069 6e20  r hypervisor in 
-00014070: 6465 6c65 7465 636c 6965 6e74 733a 0a20  deleteclients:. 
-00014080: 2020 2020 2020 2020 2020 2063 203d 2064             c = d
-00014090: 656c 6574 6563 6c69 656e 7473 5b68 7970  eleteclients[hyp
-000140a0: 6572 7669 736f 725d 0a20 2020 2020 2020  ervisor].       
-000140b0: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
-000140c0: 6f72 7465 6428 632e 6c69 7374 2829 2c20  orted(c.list(), 
-000140d0: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
-000140e0: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
-000140f0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-00014100: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
-00014110: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00014120: 7269 7074 696f 6e20 3d20 766d 2e67 6574  ription = vm.get
-00014130: 2827 706c 616e 2729 0a20 2020 2020 2020  ('plan').       
-00014140: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
-00014150: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
-00014160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014170: 2020 2020 2069 6620 276c 6f61 6462 616c       if 'loadbal
-00014180: 616e 6365 7227 2069 6e20 766d 3a0a 2020  ancer' in vm:.  
-00014190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141a0: 2020 2020 2020 6c62 7320 3d20 766d 5b27        lbs = vm['
-000141b0: 6c6f 6164 6261 6c61 6e63 6572 275d 2e73  loadbalancer'].s
-000141c0: 706c 6974 2827 2c27 290a 2020 2020 2020  plit(',').      
-000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141e0: 2020 666f 7220 6c62 2069 6e20 6c62 733a    for lb in lbs:
-000141f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014200: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014210: 6c62 206e 6f74 2069 6e20 6465 6c65 7465  lb not in delete
-00014220: 646c 6273 3a0a 2020 2020 2020 2020 2020  dlbs:.          
-00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014240: 2020 2020 2020 6465 6c65 7465 646c 6273        deletedlbs
-00014250: 2e61 7070 656e 6428 6c62 290a 2020 2020  .append(lb).    
-00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014270: 766d 6e65 7477 6f72 6b73 203d 2063 2e76  vmnetworks = c.v
-00014280: 6d5f 706f 7274 7328 6e61 6d65 290a 2020  m_ports(name).  
-00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142a0: 2020 666f 7220 6e65 7477 6f72 6b20 696e    for network in
-000142b0: 2076 6d6e 6574 776f 726b 733a 0a20 2020   vmnetworks:.   
-000142c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142d0: 2020 2020 2069 6620 6e65 7477 6f72 6b20       if network 
-000142e0: 213d 2027 6465 6661 756c 7427 2061 6e64  != 'default' and
-000142f0: 206e 6574 776f 726b 206e 6f74 2069 6e20   network not in 
-00014300: 6e65 7477 6f72 6b73 3a0a 2020 2020 2020  networks:.      
-00014310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014320: 2020 2020 2020 6e65 7477 6f72 6b73 2e61        networks.a
-00014330: 7070 656e 6428 6e65 7477 6f72 6b29 0a20  ppend(network). 
-00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014350: 2020 2064 6e73 636c 6965 6e74 2c20 646f     dnsclient, do
-00014360: 6d61 696e 203d 2063 2e64 6e73 696e 666f  main = c.dnsinfo
-00014370: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
-00014380: 2020 2020 2020 2020 2020 2069 6620 756e             if un
-00014390: 7265 6769 7374 6572 3a0a 2020 2020 2020  register:.      
-000143a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143b0: 2020 696d 6167 6520 3d20 6b2e 696e 666f    image = k.info
-000143c0: 286e 616d 6529 2e67 6574 2827 696d 6167  (name).get('imag
-000143d0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
-000143e0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-000143f0: 7268 656c 2720 696e 2069 6d61 6765 3a0a  rhel' in image:.
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00014420: 6e74 2866 2252 656d 6f76 696e 6720 7268  nt(f"Removing rh
-00014430: 656c 2073 7562 7363 7269 7074 696f 6e20  el subscription 
-00014440: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 2020 2020 2020 2020 2069 702c 2076 6d70           ip, vmp
-00014470: 6f72 7420 3d20 5f73 7368 5f63 7265 6465  ort = _ssh_crede
-00014480: 6e74 6961 6c73 286b 2c20 6e61 6d65 295b  ntials(k, name)[
-00014490: 313a 5d0a 2020 2020 2020 2020 2020 2020  1:].            
-000144a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144b0: 636d 6420 3d20 2273 7562 7363 7269 7074  cmd = "subscript
-000144c0: 696f 6e2d 6d61 6e61 6765 7220 756e 7265  ion-manager unre
-000144d0: 6769 7374 6572 220a 2020 2020 2020 2020  gister".        
-000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 2020 7373 6863 6d64 203d 2073 7368      sshcmd = ssh
-00014500: 286e 616d 652c 2069 703d 6970 2c20 7573  (name, ip=ip, us
-00014510: 6572 3d27 726f 6f74 272c 2074 756e 6e65  er='root', tunne
-00014520: 6c3d 7365 6c66 2e74 756e 6e65 6c2c 0a20  l=self.tunnel,. 
-00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014550: 2020 2020 2020 2020 7475 6e6e 656c 686f          tunnelho
-00014560: 7374 3d73 656c 662e 7475 6e6e 656c 686f  st=self.tunnelho
-00014570: 7374 2c20 7475 6e6e 656c 706f 7274 3d73  st, tunnelport=s
-00014580: 656c 662e 7475 6e6e 656c 706f 7274 2c0a  elf.tunnelport,.
-00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145b0: 2020 2020 2020 2020 2074 756e 6e65 6c75           tunnelu
-000145c0: 7365 723d 7365 6c66 2e74 756e 6e65 6c75  ser=self.tunnelu
-000145d0: 7365 722c 2069 6e73 6563 7572 653d 5472  ser, insecure=Tr
-000145e0: 7565 2c20 636d 643d 636d 642c 2076 6d70  ue, cmd=cmd, vmp
-000145f0: 6f72 743d 766d 706f 7274 290a 2020 2020  ort=vmport).    
-00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014610: 2020 2020 2020 2020 6f73 2e73 7973 7465          os.syste
-00014620: 6d28 7373 6863 6d64 290a 2020 2020 2020  m(sshcmd).      
-00014630: 2020 2020 2020 2020 2020 2020 2020 632e                c.
-00014640: 6465 6c65 7465 286e 616d 652c 2073 6e61  delete(name, sna
-00014650: 7073 686f 7473 3d54 7275 6529 0a20 2020  pshots=True).   
-00014660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014670: 2069 6620 646e 7363 6c69 656e 7420 6973   if dnsclient is
-00014680: 206e 6f74 204e 6f6e 6520 616e 6420 646f   not None and do
-00014690: 6d61 696e 2069 7320 6e6f 7420 4e6f 6e65  main is not None
-000146a0: 2061 6e64 2064 6e73 636c 6965 6e74 2069   and dnsclient i
-000146b0: 6e20 7365 6c66 2e63 6c69 656e 7473 3a0a  n self.clients:.
-000146c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146d0: 2020 2020 2020 2020 6966 2064 6e73 636c          if dnscl
-000146e0: 6965 6e74 2069 6e20 646e 7363 6c69 656e  ient in dnsclien
-000146f0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00014700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014710: 7a20 3d20 646e 7363 6c69 656e 7473 5b64  z = dnsclients[d
-00014720: 6e73 636c 6965 6e74 5d0a 2020 2020 2020  nsclient].      
-00014730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014740: 2020 656c 6966 2064 6e73 636c 6965 6e74    elif dnsclient
-00014750: 2069 6e20 7365 6c66 2e63 6c69 656e 7473   in self.clients
-00014760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014770: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
-00014780: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
-00014790: 3d64 6e73 636c 6965 6e74 292e 6b0a 2020  =dnsclient).k.  
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
-000147c0: 656e 7473 5b64 6e73 636c 6965 6e74 5d20  ents[dnsclient] 
-000147d0: 3d20 7a0a 2020 2020 2020 2020 2020 2020  = z.            
-000147e0: 2020 2020 2020 2020 2020 2020 7a2e 6465              z.de
-000147f0: 6c65 7465 5f64 6e73 2864 6e73 636c 6965  lete_dns(dnsclie
-00014800: 6e74 2c20 646f 6d61 696e 290a 2020 2020  nt, domain).    
-00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014820: 636f 6d6d 6f6e 2e73 6574 5f6c 6173 7476  common.set_lastv
-00014830: 6d28 6e61 6d65 2c20 7365 6c66 2e63 6c69  m(name, self.cli
-00014840: 656e 742c 2064 656c 6574 653d 5472 7565  ent, delete=True
-00014850: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014860: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00014870: 7b6e 616d 657d 2064 656c 6574 6564 206f  {name} deleted o
-00014880: 6e20 7b68 7970 6572 7669 736f 727d 2122  n {hypervisor}!"
-00014890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000148a0: 2020 2020 2020 6465 6c65 7465 6476 6d73        deletedvms
-000148b0: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
+00010f10: 2020 2020 2020 2070 6f6f 6c20 3d20 7365         pool = se
+00010f20: 6c66 2e70 6f6f 6c0a 2020 2020 2020 2020  lf.pool.        
+00010f30: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00010f40: 2069 7369 6e73 7461 6e63 6528 6469 736b   isinstance(disk
+00010f50: 2c20 7374 7229 2061 6e64 2064 6973 6b2e  , str) and disk.
+00010f60: 6973 6469 6769 7428 293a 0a20 2020 2020  isdigit():.     
+00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f80: 2020 2073 697a 6520 3d20 696e 7428 6469     size = int(di
+00010f90: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
+00010fa0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00010fb0: 203d 2073 656c 662e 706f 6f6c 0a20 2020   = self.pool.   
+00010fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fd0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00010fe0: 2864 6973 6b2c 2064 6963 7429 3a0a 2020  (disk, dict):.  
+00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011000: 2020 2020 2020 7369 7a65 203d 2064 6973        size = dis
+00011010: 6b2e 6765 7428 2773 697a 6527 2c20 7365  k.get('size', se
+00011020: 6c66 2e64 6973 6b73 697a 6529 0a20 2020  lf.disksize).   
+00011030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011040: 2020 2020 2070 6f6f 6c20 3d20 6469 736b       pool = disk
+00011050: 2e67 6574 2827 706f 6f6c 272c 2073 656c  .get('pool', sel
+00011060: 662e 706f 6f6c 290a 2020 2020 2020 2020  f.pool).        
+00011070: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00011080: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011090: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+000110a0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+000110b0: 2020 2020 2020 206b 2e61 6464 5f64 6973         k.add_dis
+000110c0: 6b28 6e61 6d65 3d6e 616d 652c 2073 697a  k(name=name, siz
+000110d0: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
+000110e0: 6c29 0a20 2020 2020 2020 2020 2020 2069  l).            i
+000110f0: 6620 6c65 6e28 6375 7272 656e 7464 6973  f len(currentdis
+00011100: 6b73 2920 3e20 6c65 6e28 6469 736b 7329  ks) > len(disks)
+00011110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011120: 2020 7070 7269 6e74 2866 2252 656d 6f76    pprint(f"Remov
+00011130: 696e 6720 4469 736b 7320 6f66 207b 6e61  ing Disks of {na
+00011140: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00011150: 2020 2020 2020 666f 7220 6469 736b 2069        for disk i
+00011160: 6e20 6375 7272 656e 7464 6973 6b73 5b6c  n currentdisks[l
+00011170: 656e 2863 7572 7265 6e74 6469 736b 7329  en(currentdisks)
+00011180: 202d 206c 656e 2864 6973 6b73 293a 5d3a   - len(disks):]:
+00011190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000111a0: 2020 2020 2064 6973 6b6e 616d 6520 3d20       diskname = 
+000111b0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+000111c0: 2864 6973 6b5b 2770 6174 6827 5d29 0a20  (disk['path']). 
+000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111e0: 2020 2064 6973 6b70 6f6f 6c20 3d20 6f73     diskpool = os
+000111f0: 2e70 6174 682e 6469 726e 616d 6528 6469  .path.dirname(di
+00011200: 736b 5b27 7061 7468 275d 290a 2020 2020  sk['path']).    
+00011210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011220: 6b2e 6465 6c65 7465 5f64 6973 6b28 6e61  k.delete_disk(na
+00011230: 6d65 3d6e 616d 652c 2064 6973 6b6e 616d  me=name, disknam
+00011240: 653d 6469 736b 6e61 6d65 2c20 706f 6f6c  e=diskname, pool
+00011250: 3d64 6973 6b70 6f6f 6c29 0a20 2020 2020  =diskpool).     
+00011260: 2020 2069 6620 6e65 7473 3a0a 2020 2020     if nets:.    
+00011270: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00011280: 2255 7064 6174 696e 6720 6e65 7473 206f  "Updating nets o
+00011290: 6620 766d 207b 6e61 6d65 7d22 290a 2020  f vm {name}").  
+000112a0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000112b0: 2863 7572 7265 6e74 6e65 7473 2920 3c20  (currentnets) < 
+000112c0: 6c65 6e28 6e65 7473 293a 0a20 2020 2020  len(nets):.     
+000112d0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000112e0: 7428 6622 4164 6469 6e67 204e 6963 7320  t(f"Adding Nics 
+000112f0: 746f 207b 6e61 6d65 7d22 290a 2020 2020  to {name}").    
+00011300: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011310: 6e65 7420 696e 206e 6574 735b 6c65 6e28  net in nets[len(
+00011320: 6375 7272 656e 746e 6574 7329 3a5d 3a0a  currentnets):]:.
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00011350: 6528 6e65 742c 2073 7472 293a 0a20 2020  e(net, str):.   
+00011360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011370: 2020 2020 206e 6574 776f 726b 203d 206e       network = n
+00011380: 6574 0a20 2020 2020 2020 2020 2020 2020  et.             
+00011390: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+000113a0: 7374 616e 6365 286e 6574 2c20 6469 6374  stance(net, dict
+000113b0: 2920 616e 6420 276e 616d 6527 2069 6e20  ) and 'name' in 
+000113c0: 6e65 743a 0a20 2020 2020 2020 2020 2020  net:.           
+000113d0: 2020 2020 2020 2020 2020 2020 206e 6574               net
+000113e0: 776f 726b 203d 206e 6574 5b27 6e61 6d65  work = net['name
+000113f0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00011400: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00011410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011420: 2020 2020 2065 7272 6f72 2866 2253 6b69       error(f"Ski
+00011430: 7070 696e 6720 7772 6f6e 6720 6e69 6320  pping wrong nic 
+00011440: 7370 6563 2066 6f72 207b 6e61 6d65 7d22  spec for {name}"
+00011450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011460: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00011470: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00011480: 2020 2020 2020 206b 2e61 6464 5f6e 6963         k.add_nic
+00011490: 286e 616d 652c 206e 6574 776f 726b 290a  (name, network).
+000114a0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000114b0: 656e 2863 7572 7265 6e74 6e65 7473 2920  en(currentnets) 
+000114c0: 3e20 6c65 6e28 6e65 7473 293a 0a20 2020  > len(nets):.   
+000114d0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+000114e0: 696e 7428 6622 5265 6d6f 7669 6e67 204e  int(f"Removing N
+000114f0: 6963 7320 6f66 207b 6e61 6d65 7d22 290a  ics of {name}").
+00011500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011510: 666f 7220 6e65 7420 696e 2072 616e 6765  for net in range
+00011520: 286c 656e 2863 7572 7265 6e74 6e65 7473  (len(currentnets
+00011530: 292c 206c 656e 286e 6574 7329 2c20 2d31  ), len(nets), -1
+00011540: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00011550: 2020 2020 2020 2069 6e74 6572 6661 6365         interface
+00011560: 203d 2022 6574 6825 7322 2025 2028 6e65   = "eth%s" % (ne
+00011570: 7420 2d20 3129 0a20 2020 2020 2020 2020  t - 1).         
+00011580: 2020 2020 2020 2020 2020 206b 2e64 656c             k.del
+00011590: 6574 655f 6e69 6328 6e61 6d65 2c20 696e  ete_nic(name, in
+000115a0: 7465 7266 6163 6529 0a20 2020 2020 2020  terface).       
+000115b0: 2020 2020 2066 6f72 2069 6e64 6578 2c20       for index, 
+000115c0: 6375 7272 656e 746e 6574 2069 6e20 656e  currentnet in en
+000115d0: 756d 6572 6174 6528 6375 7272 656e 746e  umerate(currentn
+000115e0: 6574 7329 3a0a 2020 2020 2020 2020 2020  ets):.          
+000115f0: 2020 2020 2020 6966 2069 6e64 6578 203e        if index >
+00011600: 206c 656e 286e 6574 7329 3a0a 2020 2020   len(nets):.    
+00011610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011620: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00011630: 2020 2020 2020 6e65 746e 616d 6520 3d20        netname = 
+00011640: 6375 7272 656e 746e 6574 5b27 6e65 7427  currentnet['net'
+00011650: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00011660: 2020 7461 7267 6574 6e65 746e 616d 6520    targetnetname 
+00011670: 3d20 6e65 7473 5b69 6e64 6578 5d5b 276e  = nets[index]['n
+00011680: 616d 6527 5d20 6966 2069 7369 6e73 7461  ame'] if isinsta
+00011690: 6e63 6528 6e65 7473 5b69 6e64 6578 5d2c  nce(nets[index],
+000116a0: 2064 6963 7429 2065 6c73 6520 6e65 7473   dict) else nets
+000116b0: 5b69 6e64 6578 5d0a 2020 2020 2020 2020  [index].        
+000116c0: 2020 2020 2020 2020 6966 2074 6172 6765          if targe
+000116d0: 746e 6574 6e61 6d65 2021 3d20 6e65 746e  tnetname != netn
+000116e0: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+000116f0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00011700: 6622 5570 6461 7469 6e67 206e 6963 207b  f"Updating nic {
+00011710: 696e 6465 787d 2074 6f20 6e65 7477 6f72  index} to networ
+00011720: 6b20 7b74 6172 6765 746e 6574 6e61 6d65  k {targetnetname
+00011730: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00011740: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
+00011750: 5f6e 6963 286e 616d 652c 2069 6e64 6578  _nic(name, index
+00011760: 2c20 7461 7267 6574 6e65 746e 616d 6529  , targetnetname)
+00011770: 0a20 2020 2020 2020 2069 6620 6578 7472  .        if extr
+00011780: 615f 6d65 7461 6461 7461 3a0a 2020 2020  a_metadata:.    
+00011790: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
+000117a0: 696e 2065 7874 7261 5f6d 6574 6164 6174  in extra_metadat
+000117b0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+000117c0: 2020 2076 616c 7565 203d 2065 7874 7261     value = extra
+000117d0: 5f6d 6574 6164 6174 615b 6b65 795d 0a20  _metadata[key]. 
+000117e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000117f0: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+00011800: 207b 6b65 797d 206f 6620 766d 207b 6e61   {key} of vm {na
+00011810: 6d65 7d20 746f 207b 7661 6c75 657d 2e2e  me} to {value}..
+00011820: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00011830: 2020 2020 6b2e 7570 6461 7465 5f6d 6574      k.update_met
+00011840: 6164 6174 6128 6e61 6d65 2c20 6b65 792c  adata(name, key,
+00011850: 2076 616c 7565 290a 2020 2020 2020 2020   value).        
+00011860: 6966 206f 7665 7272 6964 6573 2e67 6574  if overrides.get
+00011870: 2827 6669 6c65 7327 2c20 5b5d 293a 0a20  ('files', []):. 
+00011880: 2020 2020 2020 2020 2020 2069 6620 6f76             if ov
+00011890: 6572 7269 6465 732e 6765 7428 2773 6b69  errides.get('ski
+000118a0: 705f 6669 6c65 735f 7265 6d65 6469 6174  p_files_remediat
+000118b0: 696f 6e27 2c20 4661 6c73 6529 3a0a 2020  ion', False):.  
+000118c0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+000118d0: 7269 6e74 2866 2253 6b69 7070 696e 6720  rint(f"Skipping 
+000118e0: 5265 6d65 6469 6174 696f 6e20 6669 6c65  Remediation file
+000118f0: 7320 6f66 207b 6e61 6d65 7d22 290a 2020  s of {name}").  
+00011900: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00011910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011920: 6e65 7766 696c 6573 203d 206f 7665 7272  newfiles = overr
+00011930: 6964 6573 5b27 6669 6c65 7327 5d0a 2020  ides['files'].  
+00011940: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00011950: 7269 6e74 2866 2252 656d 6564 6961 7469  rint(f"Remediati
+00011960: 6e67 2066 696c 6573 206f 6620 7b6e 616d  ng files of {nam
+00011970: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+00011980: 2020 2020 2073 656c 662e 7265 6d65 6469       self.remedi
+00011990: 6174 655f 6669 6c65 7328 6e61 6d65 2c20  ate_files(name, 
+000119a0: 6e65 7766 696c 6573 2c20 6f76 6572 7269  newfiles, overri
+000119b0: 6465 7329 0a20 2020 2020 2020 2069 6620  des).        if 
+000119c0: 7365 6c66 2e74 7970 6520 3d3d 2027 6b76  self.type == 'kv
+000119d0: 6d27 3a0a 2020 2020 2020 2020 2020 2020  m':.            
+000119e0: 706f 6f6c 203d 206f 7665 7272 6964 6573  pool = overrides
+000119f0: 2e67 6574 2827 706f 6f6c 2729 0a20 2020  .get('pool').   
+00011a00: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
+00011a10: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00011a20: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00011a30: 7570 6461 7465 5f70 6f6f 6c28 6e61 6d65  update_pool(name
+00011a40: 2c20 706f 6f6c 290a 2020 2020 2020 2020  , pool).        
+00011a50: 2020 2020 6966 2063 7075 666c 6167 733a      if cpuflags:
+00011a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011a70: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
+00011a80: 6e67 2063 7075 666c 6167 7320 6f66 2076  ng cpuflags of v
+00011a90: 6d20 7b6e 616d 657d 2229 0a20 2020 2020  m {name}").     
+00011aa0: 2020 2020 2020 2020 2020 206b 2e75 7064             k.upd
+00011ab0: 6174 655f 6370 7566 6c61 6773 286e 616d  ate_cpuflags(nam
+00011ac0: 652c 2063 7075 666c 6167 732c 2064 6973  e, cpuflags, dis
+00011ad0: 6162 6c65 290a 2020 2020 2020 2020 6966  able).        if
+00011ae0: 2073 656c 662e 7479 7065 203d 3d20 2776   self.type == 'v
+00011af0: 7370 6865 7265 2720 616e 6420 7465 6d70  sphere' and temp
+00011b00: 6c61 7465 2069 7320 6e6f 7420 4e6f 6e65  late is not None
+00011b10: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00011b20: 7465 6d70 6c61 7465 2c20 626f 6f6c 293a  template, bool):
+00011b30: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
+00011b40: 6765 7420 3d20 2774 656d 706c 6174 6527  get = 'template'
+00011b50: 2069 6620 7465 6d70 6c61 7465 2065 6c73   if template els
+00011b60: 6520 2776 6d27 0a20 2020 2020 2020 2020  e 'vm'.         
+00011b70: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
+00011b80: 7469 6e67 2076 6d20 7b6e 616d 657d 2074  ting vm {name} t
+00011b90: 6f20 7b74 6172 6765 747d 2e2e 2e22 290a  o {target}...").
+00011ba0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00011bb0: 656d 706c 6174 653a 0a20 2020 2020 2020  emplate:.       
+00011bc0: 2020 2020 2020 2020 206b 2e63 6f6e 7665           k.conve
+00011bd0: 7274 5f74 6f5f 7465 6d70 6c61 7465 286e  rt_to_template(n
+00011be0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00011bf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011c00: 2020 2020 2020 206b 2e63 6f6e 7665 7274         k.convert
+00011c10: 5f74 6f5f 766d 286e 616d 6529 0a20 2020  _to_vm(name).   
+00011c20: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00011c30: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+00011c40: 7d0a 0a20 2020 2064 6566 206c 6973 745f  }..    def list_
+00011c50: 706c 616e 7328 7365 6c66 293a 0a20 2020  plans(self):.   
+00011c60: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
+00011c70: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
+00011c80: 3d20 5b5d 0a20 2020 2020 2020 2070 6c61  = [].        pla
+00011c90: 6e73 203d 207b 7d0a 2020 2020 2020 2020  ns = {}.        
+00011ca0: 666f 7220 766d 2069 6e20 6b2e 6c69 7374  for vm in k.list
+00011cb0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00011cc0: 766d 6e61 6d65 203d 2076 6d5b 276e 616d  vmname = vm['nam
+00011cd0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+00011ce0: 706c 616e 203d 2076 6d2e 6765 7428 2770  plan = vm.get('p
+00011cf0: 6c61 6e27 290a 2020 2020 2020 2020 2020  lan').          
+00011d00: 2020 6966 2070 6c61 6e20 6973 204e 6f6e    if plan is Non
+00011d10: 6520 6f72 2070 6c61 6e20 3d3d 2027 6b76  e or plan == 'kv
+00011d20: 6972 7427 206f 7220 706c 616e 203d 3d20  irt' or plan == 
+00011d30: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+00011d40: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00011d50: 2020 2020 2020 2020 2065 6c69 6620 706c           elif pl
+00011d60: 616e 206e 6f74 2069 6e20 706c 616e 733a  an not in plans:
+00011d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d80: 2070 6c61 6e73 5b70 6c61 6e5d 203d 205b   plans[plan] = [
+00011d90: 766d 6e61 6d65 5d0a 2020 2020 2020 2020  vmname].        
+00011da0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011db0: 2020 2020 2020 2020 2020 706c 616e 735b            plans[
+00011dc0: 706c 616e 5d2e 6170 7065 6e64 2876 6d6e  plan].append(vmn
+00011dd0: 616d 6529 0a20 2020 2020 2020 2066 6f72  ame).        for
+00011de0: 2070 6c61 6e20 696e 2070 6c61 6e73 3a0a   plan in plans:.
+00011df0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00011e00: 6c74 732e 6170 7065 6e64 285b 706c 616e  lts.append([plan
+00011e10: 2c20 272c 272e 6a6f 696e 2870 6c61 6e73  , ','.join(plans
+00011e20: 5b70 6c61 6e5d 295d 290a 2020 2020 2020  [plan])]).      
+00011e30: 2020 7265 7475 726e 2072 6573 756c 7473    return results
+00011e40: 0a0a 2020 2020 6465 6620 6c69 7374 5f6b  ..    def list_k
+00011e50: 7562 6573 2873 656c 6629 3a0a 2020 2020  ubes(self):.    
+00011e60: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+00011e70: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00011e80: 7970 6520 3d3d 2027 7765 6227 2061 6e64  ype == 'web' and
+00011e90: 2073 656c 662e 6b2e 6c6f 6361 6c6b 7562   self.k.localkub
+00011ea0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00011eb0: 6574 7572 6e20 6b2e 6c69 7374 5f6b 7562  eturn k.list_kub
+00011ec0: 6573 2829 0a20 2020 2020 2020 206b 7562  es().        kub
+00011ed0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+00011ee0: 666f 7220 766d 2069 6e20 6b2e 6c69 7374  for vm in k.list
+00011ef0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00011f00: 6966 2027 6b75 6265 2720 696e 2076 6d20  if 'kube' in vm 
+00011f10: 616e 6420 276b 7562 6574 7970 6527 2069  and 'kubetype' i
+00011f20: 6e20 766d 3a0a 2020 2020 2020 2020 2020  n vm:.          
+00011f30: 2020 2020 2020 766d 6e61 6d65 203d 2076        vmname = v
+00011f40: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
+00011f50: 2020 2020 2020 2020 2020 6b75 6265 203d            kube =
+00011f60: 2076 6d5b 276b 7562 6527 5d0a 2020 2020   vm['kube'].    
+00011f70: 2020 2020 2020 2020 2020 2020 5f74 7970              _typ
+00011f80: 6520 3d20 766d 5b27 6b75 6265 7479 7065  e = vm['kubetype
+00011f90: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00011fa0: 2020 2070 6c61 6e20 3d20 766d 5b27 706c     plan = vm['pl
+00011fb0: 616e 275d 0a20 2020 2020 2020 2020 2020  an'].           
+00011fc0: 2020 2020 2069 6620 6b75 6265 206e 6f74       if kube not
+00011fd0: 2069 6e20 6b75 6265 733a 0a20 2020 2020   in kubes:.     
+00011fe0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00011ff0: 7562 6573 5b6b 7562 655d 203d 207b 2774  ubes[kube] = {'t
+00012000: 7970 6527 3a20 5f74 7970 652c 2027 706c  ype': _type, 'pl
+00012010: 616e 273a 2070 6c61 6e2c 2027 766d 7327  an': plan, 'vms'
+00012020: 3a20 5b76 6d6e 616d 655d 7d0a 2020 2020  : [vmname]}.    
+00012030: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00012040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012050: 2020 2020 2020 6b75 6265 735b 6b75 6265        kubes[kube
+00012060: 5d5b 2776 6d73 275d 2e61 7070 656e 6428  ]['vms'].append(
+00012070: 766d 6e61 6d65 290a 2020 2020 2020 2020  vmname).        
+00012080: 666f 7220 6b75 6265 2069 6e20 6b75 6265  for kube in kube
+00012090: 733a 0a20 2020 2020 2020 2020 2020 206b  s:.            k
+000120a0: 7562 6573 5b6b 7562 655d 5b27 766d 7327  ubes[kube]['vms'
+000120b0: 5d20 3d20 272c 272e 6a6f 696e 286b 7562  ] = ','.join(kub
+000120c0: 6573 5b6b 7562 655d 5b27 766d 7327 5d29  es[kube]['vms'])
+000120d0: 0a20 2020 2020 2020 2063 6c75 7374 6572  .        cluster
+000120e0: 7364 6972 203d 206f 732e 7061 7468 2e65  sdir = os.path.e
+000120f0: 7870 616e 6475 7365 7228 277e 2f2e 6b63  xpanduser('~/.kc
+00012100: 6c69 2f63 6c75 7374 6572 7327 290a 2020  li/clusters').  
+00012110: 2020 2020 2020 666f 7220 6b75 6265 2069        for kube i
+00012120: 6e20 6e65 7874 286f 732e 7761 6c6b 2863  n next(os.walk(c
+00012130: 6c75 7374 6572 7364 6972 2929 5b31 5d3a  lustersdir))[1]:
+00012140: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012150: 6b75 6265 2069 6e20 6b75 6265 733a 0a20  kube in kubes:. 
+00012160: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00012170: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00012180: 2020 2020 636c 7573 7465 7264 6972 203d      clusterdir =
+00012190: 2066 277b 636c 7573 7465 7273 6469 727d   f'{clustersdir}
+000121a0: 2f7b 6b75 6265 7d27 0a20 2020 2020 2020  /{kube}'.       
+000121b0: 2020 2020 205f 7479 7065 2c20 706c 616e       _type, plan
+000121c0: 203d 2027 6765 6e65 7269 6327 2c20 6b75   = 'generic', ku
+000121d0: 6265 0a20 2020 2020 2020 2020 2020 2069  be.            i
+000121e0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+000121f0: 2866 277b 636c 7573 7465 7264 6972 7d2f  (f'{clusterdir}/
+00012200: 6b63 6c69 5f70 6172 616d 6574 6572 732e  kcli_parameters.
+00012210: 796d 6c27 293a 0a20 2020 2020 2020 2020  yml'):.         
+00012220: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+00012230: 2866 227b 636c 7573 7465 7264 6972 7d2f  (f"{clusterdir}/
+00012240: 6b63 6c69 5f70 6172 616d 6574 6572 732e  kcli_parameters.
+00012250: 796d 6c22 2c20 2772 2729 2061 7320 696e  yml", 'r') as in
+00012260: 7374 616c 6c3a 0a20 2020 2020 2020 2020  stall:.         
+00012270: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
+00012280: 6c6c 7061 7261 6d20 3d20 7961 6d6c 2e73  llparam = yaml.s
+00012290: 6166 655f 6c6f 6164 2869 6e73 7461 6c6c  afe_load(install
+000122a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000122b0: 2020 2020 2020 5f74 7970 6520 3d20 696e        _type = in
+000122c0: 7374 616c 6c70 6172 616d 2e67 6574 2827  stallparam.get('
+000122d0: 6b75 6265 7479 7065 272c 205f 7479 7065  kubetype', _type
+000122e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000122f0: 2020 2020 2020 706c 616e 203d 2069 6e73        plan = ins
+00012300: 7461 6c6c 7061 7261 6d2e 6765 7428 2770  tallparam.get('p
+00012310: 6c61 6e27 2c20 706c 616e 290a 2020 2020  lan', plan).    
+00012320: 2020 2020 2020 2020 6b75 6265 735b 6b75          kubes[ku
+00012330: 6265 5d20 3d20 7b27 7479 7065 273a 205f  be] = {'type': _
+00012340: 7479 7065 2c20 2770 6c61 6e27 3a20 706c  type, 'plan': pl
+00012350: 616e 2c20 2776 6d73 273a 205b 5d7d 0a20  an, 'vms': []}. 
+00012360: 2020 2020 2020 2072 6574 7572 6e20 6b75         return ku
+00012370: 6265 730a 0a20 2020 2064 6566 2063 7265  bes..    def cre
+00012380: 6174 655f 7072 6f64 7563 7428 7365 6c66  ate_product(self
+00012390: 2c20 6e61 6d65 2c20 7265 706f 3d4e 6f6e  , name, repo=Non
+000123a0: 652c 2067 726f 7570 3d4e 6f6e 652c 2070  e, group=None, p
+000123b0: 6c61 6e3d 4e6f 6e65 2c20 6c61 7465 7374  lan=None, latest
+000123c0: 3d46 616c 7365 2c20 6f76 6572 7269 6465  =False, override
+000123d0: 733d 7b7d 293a 0a20 2020 2020 2020 2022  s={}):.        "
+000123e0: 2222 4372 6561 7465 2070 726f 6475 6374  ""Create product
+000123f0: 2222 220a 2020 2020 2020 2020 6966 2072  """.        if r
+00012400: 6570 6f20 6973 206e 6f74 204e 6f6e 6520  epo is not None 
+00012410: 616e 6420 6772 6f75 7020 6973 206e 6f74  and group is not
+00012420: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00012430: 2020 2070 726f 6475 6374 7320 3d20 5b70     products = [p
+00012440: 726f 6475 6374 2066 6f72 2070 726f 6475  roduct for produ
+00012450: 6374 2069 6e20 7365 6c66 2e6c 6973 745f  ct in self.list_
+00012460: 7072 6f64 7563 7473 2829 0a20 2020 2020  products().     
+00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012480: 2020 2069 6620 7072 6f64 7563 745b 276e     if product['n
+00012490: 616d 6527 5d20 3d3d 206e 616d 6520 616e  ame'] == name an
+000124a0: 6420 7072 6f64 7563 745b 2772 6570 6f27  d product['repo'
+000124b0: 5d20 3d3d 2072 6570 6f20 616e 6420 7072  ] == repo and pr
+000124c0: 6f64 7563 745b 2767 726f 7570 275d 203d  oduct['group'] =
+000124d0: 3d20 6772 6f75 705d 0a20 2020 2020 2020  = group].       
+000124e0: 2065 6c69 6620 7265 706f 2069 7320 6e6f   elif repo is no
+000124f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00012500: 2020 2020 7072 6f64 7563 7473 203d 205b      products = [
+00012510: 7072 6f64 7563 7420 666f 7220 7072 6f64  product for prod
+00012520: 7563 7420 696e 2073 656c 662e 6c69 7374  uct in self.list
+00012530: 5f70 726f 6475 6374 7328 290a 2020 2020  _products().    
+00012540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012550: 2020 2020 6966 2070 726f 6475 6374 5b27      if product['
+00012560: 6e61 6d65 275d 203d 3d20 6e61 6d65 2061  name'] == name a
+00012570: 6e64 2070 726f 6475 6374 5b27 7265 706f  nd product['repo
+00012580: 275d 203d 3d20 7265 706f 5d0a 2020 2020  '] == repo].    
+00012590: 2020 2020 6966 2067 726f 7570 2069 7320      if group is 
+000125a0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000125b0: 2020 2020 2020 7072 6f64 7563 7473 203d        products =
+000125c0: 205b 7072 6f64 7563 7420 666f 7220 7072   [product for pr
+000125d0: 6f64 7563 7420 696e 2073 656c 662e 6c69  oduct in self.li
+000125e0: 7374 5f70 726f 6475 6374 7328 290a 2020  st_products().  
+000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012600: 2020 2020 2020 6966 2070 726f 6475 6374        if product
+00012610: 5b27 6e61 6d65 275d 203d 3d20 6e61 6d65  ['name'] == name
+00012620: 2061 6e64 2070 726f 6475 6374 5b27 6772   and product['gr
+00012630: 6f75 7027 5d20 3d3d 2067 726f 7570 5d0a  oup'] == group].
+00012640: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00012650: 2020 2020 2020 2020 2020 7072 6f64 7563            produc
+00012660: 7473 203d 205b 7072 6f64 7563 7420 666f  ts = [product fo
+00012670: 7220 7072 6f64 7563 7420 696e 2073 656c  r product in sel
+00012680: 662e 6c69 7374 5f70 726f 6475 6374 7328  f.list_products(
+00012690: 2920 6966 2070 726f 6475 6374 5b27 6e61  ) if product['na
+000126a0: 6d65 275d 203d 3d20 6e61 6d65 5d0a 2020  me'] == name].  
+000126b0: 2020 2020 2020 6966 206c 656e 2870 726f        if len(pro
+000126c0: 6475 6374 7329 203d 3d20 303a 0a20 2020  ducts) == 0:.   
+000126d0: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+000126e0: 5072 6f64 7563 7420 6e6f 7420 666f 756e  Product not foun
+000126f0: 642e 204c 6561 7669 6e67 2e2e 2e22 290a  d. Leaving...").
+00012700: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00012710: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+00012720: 656c 6966 206c 656e 2870 726f 6475 6374  elif len(product
+00012730: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
+00012740: 2020 2020 6572 726f 7228 2250 726f 6475      error("Produ
+00012750: 6374 2066 6f75 6e64 2069 6e20 7365 7665  ct found in seve
+00012760: 7261 6c20 7265 706f 7320 6f72 2067 726f  ral repos or gro
+00012770: 7570 732e 2053 7065 6369 6679 206f 6e65  ups. Specify one
+00012780: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00012790: 2020 666f 7220 7072 6f64 7563 7420 696e    for product in
+000127a0: 2070 726f 6475 6374 733a 0a20 2020 2020   products:.     
+000127b0: 2020 2020 2020 2020 2020 2067 726f 7570             group
+000127c0: 203d 2070 726f 6475 6374 5b27 6772 6f75   = product['grou
+000127d0: 7027 5d0a 2020 2020 2020 2020 2020 2020  p'].            
+000127e0: 2020 2020 7265 706f 203d 2070 726f 6475      repo = produ
+000127f0: 6374 5b27 7265 706f 275d 0a20 2020 2020  ct['repo'].     
+00012800: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00012810: 2866 2272 6570 6f3a 7b72 6570 6f7d 5c74  (f"repo:{repo}\t
+00012820: 6772 6f75 703a 7b67 726f 7570 7d22 290a  group:{group}").
+00012830: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00012840: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+00012850: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00012860: 2020 7072 6f64 7563 7420 3d20 7072 6f64    product = prod
+00012870: 7563 7473 5b30 5d0a 2020 2020 2020 2020  ucts[0].        
+00012880: 2020 2020 706c 616e 203d 206e 616d 6575      plan = nameu
+00012890: 7469 6c73 2e67 6574 5f72 616e 646f 6d5f  tils.get_random_
+000128a0: 6e61 6d65 2829 2069 6620 706c 616e 2069  name() if plan i
+000128b0: 7320 4e6f 6e65 2065 6c73 6520 706c 616e  s None else plan
+000128c0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+000128d0: 6f20 3d20 7072 6f64 7563 745b 2772 6570  o = product['rep
+000128e0: 6f27 5d0a 2020 2020 2020 2020 2020 2020  o'].            
+000128f0: 6966 2027 7265 616c 6469 7227 2069 6e20  if 'realdir' in 
+00012900: 7072 6f64 7563 743a 0a20 2020 2020 2020  product:.       
+00012910: 2020 2020 2020 2020 2072 6570 6f64 6972           repodir
+00012920: 203d 2022 2573 2f2e 6b63 6c69 2f70 6c61   = "%s/.kcli/pla
+00012930: 6e73 2f25 732f 2573 2220 2520 286f 732e  ns/%s/%s" % (os.
+00012940: 656e 7669 726f 6e2e 6765 7428 2748 4f4d  environ.get('HOM
+00012950: 4527 292c 2072 6570 6f2c 2070 726f 6475  E'), repo, produ
+00012960: 6374 5b27 7265 616c 6469 7227 5d29 0a20  ct['realdir']). 
+00012970: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00012980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012990: 2072 6570 6f64 6972 203d 2022 2573 2f2e   repodir = "%s/.
+000129a0: 6b63 6c69 2f70 6c61 6e73 2f25 7322 2025  kcli/plans/%s" %
+000129b0: 2028 6f73 2e65 6e76 6972 6f6e 2e67 6574   (os.environ.get
+000129c0: 2827 484f 4d45 2729 2c20 7265 706f 290a  ('HOME'), repo).
+000129d0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+000129e0: 2f27 2069 6e20 7072 6f64 7563 745b 2766  /' in product['f
+000129f0: 696c 6527 5d3a 0a20 2020 2020 2020 2020  ile']:.         
+00012a00: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
+00012a10: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00012a20: 616d 6528 7072 6f64 7563 745b 2766 696c  ame(product['fil
+00012a30: 6527 5d29 0a20 2020 2020 2020 2020 2020  e']).           
+00012a40: 2020 2020 2072 6570 6f64 6972 202b 3d20       repodir += 
+00012a50: 222f 2573 2220 2520 6f73 2e70 6174 682e  "/%s" % os.path.
+00012a60: 6469 726e 616d 6528 7072 6f64 7563 745b  dirname(product[
+00012a70: 2766 696c 6527 5d29 0a20 2020 2020 2020  'file']).       
+00012a80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00012a90: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+00012aa0: 6669 6c65 203d 2070 726f 6475 6374 5b27  file = product['
+00012ab0: 6669 6c65 275d 0a20 2020 2020 2020 2020  file'].         
+00012ac0: 2020 2069 6d61 6765 203d 2070 726f 6475     image = produ
+00012ad0: 6374 2e67 6574 2827 696d 6167 6527 290a  ct.get('image').
+00012ae0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00012af0: 6d65 7465 7273 203d 2070 726f 6475 6374  meters = product
+00012b00: 2e67 6574 2827 7061 7261 6d65 7465 7273  .get('parameters
+00012b10: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
+00012b20: 6620 696d 6167 6520 6973 206e 6f74 204e  f image is not N
+00012b30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00012b40: 2020 2020 2070 7269 6e74 2866 224e 6f74       print(f"Not
+00012b50: 6520 7468 6174 2074 6869 7320 7072 6f64  e that this prod
+00012b60: 7563 7420 7573 6573 2069 6d61 6765 3a20  uct uses image: 
+00012b70: 7b69 6d61 6765 7d22 290a 2020 2020 2020  {image}").      
+00012b80: 2020 2020 2020 6966 2070 6172 616d 6574        if paramet
+00012b90: 6572 7320 6973 206e 6f74 204e 6f6e 653a  ers is not None:
+00012ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012bb0: 2066 6f72 2070 6172 616d 6574 6572 2069   for parameter i
+00012bc0: 6e20 7061 7261 6d65 7465 7273 3a0a 2020  n parameters:.  
+00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012be0: 2020 6170 706c 6965 645f 7061 7261 6d65    applied_parame
+00012bf0: 7465 7220 3d20 6f76 6572 7269 6465 735b  ter = overrides[
+00012c00: 7061 7261 6d65 7465 725d 2069 6620 7061  parameter] if pa
+00012c10: 7261 6d65 7465 7220 696e 206f 7665 7272  rameter in overr
+00012c20: 6964 6573 2065 6c73 6520 7061 7261 6d65  ides else parame
+00012c30: 7465 7273 5b70 6172 616d 6574 6572 5d0a  ters[parameter].
+00012c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c50: 2020 2020 7072 696e 7428 6622 5573 696e      print(f"Usin
+00012c60: 6720 7061 7261 6d65 7465 7220 7b70 6172  g parameter {par
+00012c70: 616d 6574 6572 7d3a 207b 6170 706c 6965  ameter}: {applie
+00012c80: 645f 7061 7261 6d65 7465 727d 2229 0a20  d_parameter}"). 
+00012c90: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+00012ca0: 7061 7261 6d65 7465 7273 203d 206c 6973  parameters = lis
+00012cb0: 7428 7365 7428 6f76 6572 7269 6465 7329  t(set(overrides)
+00012cc0: 202d 2073 6574 2870 6172 616d 6574 6572   - set(parameter
+00012cd0: 7329 2920 6966 2070 6172 616d 6574 6572  s)) if parameter
+00012ce0: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
+00012cf0: 7365 206f 7665 7272 6964 6573 0a20 2020  se overrides.   
+00012d00: 2020 2020 2020 2020 2066 6f72 2070 6172           for par
+00012d10: 616d 6574 6572 2069 6e20 6578 7472 6170  ameter in extrap
+00012d20: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
+00012d30: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00012d40: 2822 5573 696e 6720 7061 7261 6d65 7465  ("Using paramete
+00012d50: 7220 2573 3a20 2573 2220 2520 2870 6172  r %s: %s" % (par
+00012d60: 616d 6574 6572 2c20 6f76 6572 7269 6465  ameter, override
+00012d70: 735b 7061 7261 6d65 7465 725d 2929 0a20  s[parameter])). 
+00012d80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00012d90: 7420 6c61 7465 7374 3a0a 2020 2020 2020  t latest:.      
+00012da0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00012db0: 2866 2255 7369 6e67 2064 6972 6563 746f  (f"Using directo
+00012dc0: 7279 207b 7265 706f 6469 727d 2229 0a20  ry {repodir}"). 
+00012dd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00012de0: 656c 662e 706c 616e 2870 6c61 6e2c 2070  elf.plan(plan, p
+00012df0: 6174 683d 7265 706f 6469 722c 2069 6e70  ath=repodir, inp
+00012e00: 7574 6669 6c65 3d69 6e70 7574 6669 6c65  utfile=inputfile
+00012e10: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00012e20: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
+00012e30: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00012e40: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
+00012e50: 6461 7465 5f72 6570 6f28 7265 706f 290a  date_repo(repo).
+00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e70: 7365 6c66 2e70 6c61 6e28 706c 616e 2c20  self.plan(plan, 
+00012e80: 7061 7468 3d72 6570 6f64 6972 2c20 696e  path=repodir, in
+00012e90: 7075 7466 696c 653d 696e 7075 7466 696c  putfile=inputfil
+00012ea0: 652c 206f 7665 7272 6964 6573 3d6f 7665  e, overrides=ove
+00012eb0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
+00012ec0: 2020 2020 7070 7269 6e74 2866 2250 726f      pprint(f"Pro
+00012ed0: 6475 6374 2063 616e 2062 6520 6465 6c65  duct can be dele
+00012ee0: 7465 6420 7769 7468 3a20 6b63 6c69 2064  ted with: kcli d
+00012ef0: 656c 6574 6520 706c 616e 202d 2d79 6573  elete plan --yes
+00012f00: 207b 706c 616e 7d22 290a 2020 2020 2020   {plan}").      
+00012f10: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+00012f20: 7427 3a20 2773 7563 6365 7373 272c 2027  t': 'success', '
+00012f30: 706c 616e 273a 2070 6c61 6e7d 0a0a 2020  plan': plan}..  
+00012f40: 2020 6465 6620 7374 6172 745f 706c 616e    def start_plan
+00012f50: 2873 656c 662c 2070 6c61 6e2c 2063 6f6e  (self, plan, con
+00012f60: 7461 696e 6572 3d46 616c 7365 293a 0a20  tainer=False):. 
+00012f70: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+00012f80: 6b0a 2020 2020 2020 2020 7374 6172 7466  k.        startf
+00012f90: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+00012fa0: 2020 2020 2070 7072 696e 7428 6622 5374       pprint(f"St
+00012fb0: 6172 7469 6e67 2076 6d73 2066 726f 6d20  arting vms from 
+00012fc0: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
+00012fd0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00012fe0: 662e 6578 7472 6163 6c69 656e 7473 3a0a  f.extraclients:.
+00012ff0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00013000: 7463 6c69 656e 7473 203d 207b 7365 6c66  tclients = {self
+00013010: 2e63 6c69 656e 743a 206b 7d0a 2020 2020  .client: k}.    
+00013020: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00013030: 2020 2020 2020 7374 6172 7463 6c69 656e        startclien
+00013040: 7473 203d 2073 656c 662e 6578 7472 6163  ts = self.extrac
+00013050: 6c69 656e 7473 0a20 2020 2020 2020 2020  lients.         
+00013060: 2020 2073 7461 7274 636c 6965 6e74 732e     startclients.
+00013070: 7570 6461 7465 287b 7365 6c66 2e63 6c69  update({self.cli
+00013080: 656e 743a 206b 7d29 0a20 2020 2020 2020  ent: k}).       
+00013090: 2066 6f72 2068 7970 6572 7669 736f 7220   for hypervisor 
+000130a0: 696e 2073 7461 7274 636c 6965 6e74 733a  in startclients:
+000130b0: 0a20 2020 2020 2020 2020 2020 2063 203d  .            c =
+000130c0: 2073 7461 7274 636c 6965 6e74 735b 6879   startclients[hy
+000130d0: 7065 7276 6973 6f72 5d0a 2020 2020 2020  pervisor].      
+000130e0: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
+000130f0: 736f 7274 6564 2863 2e6c 6973 7428 292c  sorted(c.list(),
+00013100: 206b 6579 3d6c 616d 6264 6120 783a 2078   key=lambda x: x
+00013110: 5b27 6e61 6d65 275d 293a 0a20 2020 2020  ['name']):.     
+00013120: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+00013130: 3d20 766d 5b27 6e61 6d65 275d 0a20 2020  = vm['name'].   
+00013140: 2020 2020 2020 2020 2020 2020 2064 6573               des
+00013150: 6372 6970 7469 6f6e 203d 2076 6d2e 6765  cription = vm.ge
+00013160: 7428 2770 6c61 6e27 290a 2020 2020 2020  t('plan').      
+00013170: 2020 2020 2020 2020 2020 6966 2064 6573            if des
+00013180: 6372 6970 7469 6f6e 203d 3d20 706c 616e  cription == plan
+00013190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000131a0: 2020 2020 2020 7374 6172 7466 6f75 6e64        startfound
+000131b0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000131c0: 2020 2020 2020 2020 2020 2020 632e 7374              c.st
+000131d0: 6172 7428 6e61 6d65 290a 2020 2020 2020  art(name).      
+000131e0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+000131f0: 6363 6573 7328 6622 7b6e 616d 657d 2073  ccess(f"{name} s
+00013200: 7461 7274 6564 206f 6e20 7b68 7970 6572  tarted on {hyper
+00013210: 7669 736f 727d 2122 290a 2020 2020 2020  visor}!").      
+00013220: 2020 6966 2063 6f6e 7461 696e 6572 3a0a    if container:.
+00013230: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00013240: 203d 204b 636f 6e74 6169 6e65 7263 6f6e   = Kcontainercon
+00013250: 6669 6728 7365 6c66 2c20 636c 6965 6e74  fig(self, client
+00013260: 3d73 656c 662e 636f 6e74 6169 6e65 7263  =self.containerc
+00013270: 6c69 656e 7429 2e63 6f6e 740a 2020 2020  lient).cont.    
+00013280: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
+00013290: 6120 696e 2073 6f72 7465 6428 636f 6e74  a in sorted(cont
+000132a0: 2e6c 6973 745f 636f 6e74 6169 6e65 7273  .list_containers
+000132b0: 286b 2929 3a0a 2020 2020 2020 2020 2020  (k)):.          
+000132c0: 2020 2020 2020 6e61 6d65 203d 2063 6f6e        name = con
+000132d0: 7461 5b30 5d0a 2020 2020 2020 2020 2020  ta[0].          
+000132e0: 2020 2020 2020 636f 6e74 6169 6e65 7270        containerp
+000132f0: 6c61 6e20 3d20 636f 6e74 615b 335d 0a20  lan = conta[3]. 
+00013300: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013310: 6620 636f 6e74 6169 6e65 7270 6c61 6e20  f containerplan 
+00013320: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
+00013330: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00013340: 7274 666f 756e 6420 3d20 5472 7565 0a20  rtfound = True. 
+00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013360: 2020 2063 6f6e 742e 7374 6172 745f 636f     cont.start_co
+00013370: 6e74 6169 6e65 7228 6e61 6d65 290a 2020  ntainer(name).  
+00013380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013390: 2020 7375 6363 6573 7328 6622 436f 6e74    success(f"Cont
+000133a0: 6169 6e65 7220 7b6e 616d 657d 2073 7461  ainer {name} sta
+000133b0: 7274 6564 2122 290a 2020 2020 2020 2020  rted!").        
+000133c0: 6966 2073 7461 7274 666f 756e 643a 0a20  if startfound:. 
+000133d0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+000133e0: 7373 2866 2250 6c61 6e20 7b70 6c61 6e7d  ss(f"Plan {plan}
+000133f0: 2073 7461 7274 6564 2122 290a 2020 2020   started!").    
+00013400: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00013410: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
+00013420: 6f20 6d61 7463 6869 6e67 206f 626a 6563  o matching objec
+00013430: 7473 2066 6f75 6e64 2229 0a20 2020 2020  ts found").     
+00013440: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00013450: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+00013460: 0a20 2020 2064 6566 2073 746f 705f 706c  .    def stop_pl
+00013470: 616e 2873 656c 662c 2070 6c61 6e2c 2073  an(self, plan, s
+00013480: 6f66 743d 4661 6c73 652c 2063 6f6e 7461  oft=False, conta
+00013490: 696e 6572 3d46 616c 7365 293a 0a20 2020  iner=False):.   
+000134a0: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
+000134b0: 2020 2020 2020 2020 7374 6f70 666f 756e          stopfoun
+000134c0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+000134d0: 2070 7072 696e 7428 6622 5374 6f70 7069   pprint(f"Stoppi
+000134e0: 6e67 2076 6d73 2066 726f 6d20 706c 616e  ng vms from plan
+000134f0: 207b 706c 616e 7d22 290a 2020 2020 2020   {plan}").      
+00013500: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
+00013510: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
+00013520: 2020 2020 2020 2020 7374 6f70 636c 6965          stopclie
+00013530: 6e74 7320 3d20 7b73 656c 662e 636c 6965  nts = {self.clie
+00013540: 6e74 3a20 6b7d 0a20 2020 2020 2020 2065  nt: k}.        e
+00013550: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00013560: 2073 746f 7063 6c69 656e 7473 203d 2073   stopclients = s
+00013570: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
+00013580: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
+00013590: 7063 6c69 656e 7473 2e75 7064 6174 6528  pclients.update(
+000135a0: 7b73 656c 662e 636c 6965 6e74 3a20 6b7d  {self.client: k}
+000135b0: 290a 2020 2020 2020 2020 666f 7220 6879  ).        for hy
+000135c0: 7065 7276 6973 6f72 2069 6e20 7374 6f70  pervisor in stop
+000135d0: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+000135e0: 2020 2020 2063 203d 2073 746f 7063 6c69       c = stopcli
+000135f0: 656e 7473 5b68 7970 6572 7669 736f 725d  ents[hypervisor]
+00013600: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00013610: 2076 6d20 696e 2073 6f72 7465 6428 632e   vm in sorted(c.
+00013620: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
+00013630: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
+00013640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013650: 2020 6e61 6d65 203d 2076 6d5b 276e 616d    name = vm['nam
+00013660: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+00013670: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
+00013680: 3d20 766d 2e67 6574 2827 706c 616e 2729  = vm.get('plan')
+00013690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000136a0: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
+000136b0: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
+000136c0: 2020 2020 2020 2020 2020 2020 2073 746f               sto
+000136d0: 7066 6f75 6e64 203d 2054 7275 650a 2020  pfound = True.  
+000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136f0: 2020 632e 7374 6f70 286e 616d 652c 2073    c.stop(name, s
+00013700: 6f66 743d 736f 6674 290a 2020 2020 2020  oft=soft).      
+00013710: 2020 2020 2020 2020 2020 2020 2020 7375                su
+00013720: 6363 6573 7328 6622 7b6e 616d 657d 2073  ccess(f"{name} s
+00013730: 746f 7070 6564 206f 6e20 7b68 7970 6572  topped on {hyper
+00013740: 7669 736f 727d 2122 290a 2020 2020 2020  visor}!").      
+00013750: 2020 6966 2063 6f6e 7461 696e 6572 3a0a    if container:.
+00013760: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00013770: 203d 204b 636f 6e74 6169 6e65 7263 6f6e   = Kcontainercon
+00013780: 6669 6728 7365 6c66 2c20 636c 6965 6e74  fig(self, client
+00013790: 3d73 656c 662e 636f 6e74 6169 6e65 7263  =self.containerc
+000137a0: 6c69 656e 7429 2e63 6f6e 740a 2020 2020  lient).cont.    
+000137b0: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
+000137c0: 6120 696e 2073 6f72 7465 6428 636f 6e74  a in sorted(cont
+000137d0: 2e6c 6973 745f 636f 6e74 6169 6e65 7273  .list_containers
+000137e0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+000137f0: 2020 2020 206e 616d 6520 3d20 636f 6e74       name = cont
+00013800: 615b 305d 0a20 2020 2020 2020 2020 2020  a[0].           
+00013810: 2020 2020 2063 6f6e 7461 696e 6572 706c       containerpl
+00013820: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
+00013830: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013840: 2063 6f6e 7461 696e 6572 706c 616e 203d   containerplan =
+00013850: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
+00013860: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+00013870: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
+00013880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013890: 2063 6f6e 742e 7374 6f70 5f63 6f6e 7461   cont.stop_conta
+000138a0: 696e 6572 286e 616d 6529 0a20 2020 2020  iner(name).     
+000138b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000138c0: 7563 6365 7373 2866 2243 6f6e 7461 696e  uccess(f"Contain
+000138d0: 6572 207b 6e61 6d65 7d20 7374 6f70 7065  er {name} stoppe
+000138e0: 6421 2229 0a20 2020 2020 2020 2069 6620  d!").        if 
+000138f0: 7374 6f70 666f 756e 643a 0a20 2020 2020  stopfound:.     
+00013900: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+00013910: 2250 6c61 6e20 7b70 6c61 6e7d 2073 746f  "Plan {plan} sto
+00013920: 7070 6564 2122 290a 2020 2020 2020 2020  pped!").        
+00013930: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013940: 2020 7761 726e 696e 6728 224e 6f20 6d61    warning("No ma
+00013950: 7463 6869 6e67 206f 626a 6563 7473 2066  tching objects f
+00013960: 6f75 6e64 2229 0a20 2020 2020 2020 2072  ound").        r
+00013970: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00013980: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
+00013990: 2064 6566 2061 7574 6f73 7461 7274 5f70   def autostart_p
+000139a0: 6c61 6e28 7365 6c66 2c20 706c 616e 293a  lan(self, plan):
+000139b0: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+000139c0: 662e 6b0a 2020 2020 2020 2020 7070 7269  f.k.        ppri
+000139d0: 6e74 2866 2253 6574 2076 6d73 2066 726f  nt(f"Set vms fro
+000139e0: 6d20 706c 616e 207b 706c 616e 7d20 746f  m plan {plan} to
+000139f0: 2061 7574 6f73 7461 7274 2229 0a20 2020   autostart").   
+00013a00: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
+00013a10: 6f72 7465 6428 6b2e 6c69 7374 2829 2c20  orted(k.list(), 
+00013a20: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
+00013a30: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
+00013a40: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
+00013a50: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+00013a60: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
+00013a70: 3d20 766d 5b27 706c 616e 275d 0a20 2020  = vm['plan'].   
+00013a80: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
+00013a90: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
+00013aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013ab0: 206b 2e75 7064 6174 655f 7374 6172 7428   k.update_start(
+00013ac0: 6e61 6d65 2c20 7374 6172 743d 5472 7565  name, start=True
+00013ad0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013ae0: 2020 7375 6363 6573 7328 6622 7b6e 616d    success(f"{nam
+00013af0: 657d 2073 6574 2074 6f20 6175 746f 7374  e} set to autost
+00013b00: 6172 7421 2229 0a20 2020 2020 2020 2072  art!").        r
+00013b10: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00013b20: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
+00013b30: 2064 6566 206e 6f61 7574 6f73 7461 7274   def noautostart
+00013b40: 5f70 6c61 6e28 7365 6c66 2c20 706c 616e  _plan(self, plan
+00013b50: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
+00013b60: 656c 662e 6b0a 2020 2020 2020 2020 7070  elf.k.        pp
+00013b70: 7269 6e74 2866 2250 7265 7665 6e74 696e  rint(f"Preventin
+00013b80: 6720 766d 7320 6672 6f6d 2070 6c61 6e20  g vms from plan 
+00013b90: 7b70 6c61 6e7d 2074 6f20 6175 746f 7374  {plan} to autost
+00013ba0: 6172 7422 290a 2020 2020 2020 2020 666f  art").        fo
+00013bb0: 7220 766d 2069 6e20 736f 7274 6564 286b  r vm in sorted(k
+00013bc0: 2e6c 6973 7428 292c 206b 6579 3d6c 616d  .list(), key=lam
+00013bd0: 6264 6120 783a 2078 5b27 6e61 6d65 275d  bda x: x['name']
+00013be0: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
+00013bf0: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
+00013c00: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
+00013c10: 6372 6970 7469 6f6e 203d 2076 6d5b 2770  cription = vm['p
+00013c20: 6c61 6e27 5d0a 2020 2020 2020 2020 2020  lan'].          
+00013c30: 2020 6966 2064 6573 6372 6970 7469 6f6e    if description
+00013c40: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
+00013c50: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
+00013c60: 7465 5f73 7461 7274 286e 616d 652c 2073  te_start(name, s
+00013c70: 7461 7274 3d46 616c 7365 290a 2020 2020  tart=False).    
+00013c80: 2020 2020 2020 2020 2020 2020 7375 6363              succ
+00013c90: 6573 7328 6622 7b6e 616d 657d 2070 7265  ess(f"{name} pre
+00013ca0: 7665 6e74 6564 2074 6f20 6175 746f 7374  vented to autost
+00013cb0: 6172 7421 2229 0a20 2020 2020 2020 2072  art!").        r
+00013cc0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00013cd0: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
+00013ce0: 2064 6566 2064 656c 6574 655f 706c 616e   def delete_plan
+00013cf0: 2873 656c 662c 2070 6c61 6e2c 2063 6f6e  (self, plan, con
+00013d00: 7461 696e 6572 3d46 616c 7365 2c20 756e  tainer=False, un
+00013d10: 7265 6769 7374 6572 3d46 616c 7365 293a  register=False):
+00013d20: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+00013d30: 662e 6b0a 2020 2020 2020 2020 6465 6c65  f.k.        dele
+00013d40: 7465 6476 6d73 203d 205b 5d0a 2020 2020  tedvms = [].    
+00013d50: 2020 2020 6465 6c65 7465 646c 6273 203d      deletedlbs =
+00013d60: 205b 5d0a 2020 2020 2020 2020 646e 7363   [].        dnsc
+00013d70: 6c69 656e 7473 203d 205b 5d0a 2020 2020  lients = [].    
+00013d80: 2020 2020 6e65 7477 6f72 6b73 203d 205b      networks = [
+00013d90: 5d0a 2020 2020 2020 2020 6966 2070 6c61  ].        if pla
+00013da0: 6e20 3d3d 2027 273a 0a20 2020 2020 2020  n == '':.       
+00013db0: 2020 2020 2065 7272 6f72 2822 5468 6174       error("That
+00013dc0: 2077 6f75 6c64 2064 656c 6574 6520 6576   would delete ev
+00013dd0: 6572 7920 766d 2e2e 2e4e 6f74 2064 6f69  ery vm...Not doi
+00013de0: 6e67 2074 6861 7422 290a 2020 2020 2020  ng that").      
+00013df0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+00013e00: 290a 2020 2020 2020 2020 666f 756e 6420  ).        found 
+00013e10: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00013e20: 6465 6c65 7465 636c 6965 6e74 7320 3d20  deleteclients = 
+00013e30: 7b73 656c 662e 636c 6965 6e74 3a20 6b7d  {self.client: k}
+00013e40: 0a20 2020 2020 2020 2076 6d63 6c69 656e  .        vmclien
+00013e50: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00013e60: 766d 636c 6965 6e74 735f 6669 6c65 203d  vmclients_file =
+00013e70: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+00013e80: 7365 7228 6627 7e2f 2e6b 636c 692f 766d  ser(f'~/.kcli/vm
+00013e90: 636c 6965 6e74 735f 7b70 6c61 6e7d 2729  clients_{plan}')
+00013ea0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00013eb0: 6174 682e 6578 6973 7473 2876 6d63 6c69  ath.exists(vmcli
+00013ec0: 656e 7473 5f66 696c 6529 3a0a 2020 2020  ents_file):.    
+00013ed0: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+00013ee0: 7320 3d20 7961 6d6c 2e73 6166 655f 6c6f  s = yaml.safe_lo
+00013ef0: 6164 286f 7065 6e28 766d 636c 6965 6e74  ad(open(vmclient
+00013f00: 735f 6669 6c65 2929 0a20 2020 2020 2020  s_file)).       
+00013f10: 2020 2020 206f 732e 7265 6d6f 7665 2876       os.remove(v
+00013f20: 6d63 6c69 656e 7473 5f66 696c 6529 0a20  mclients_file). 
+00013f30: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
+00013f40: 7874 7261 636c 6965 6e74 733a 0a20 2020  xtraclients:.   
+00013f50: 2020 2020 2020 2020 2064 656c 6574 6563           deletec
+00013f60: 6c69 656e 7473 2e75 7064 6174 6528 7365  lients.update(se
+00013f70: 6c66 2e65 7874 7261 636c 6965 6e74 7329  lf.extraclients)
+00013f80: 0a20 2020 2020 2020 2065 6c69 6620 766d  .        elif vm
+00013f90: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+00013fa0: 2020 2020 2064 656c 6574 6563 6c69 656e       deleteclien
+00013fb0: 7473 2e75 7064 6174 6528 7b63 6c69 3a20  ts.update({cli: 
+00013fc0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d63  Kconfig(client=c
+00013fd0: 6c69 292e 6b20 666f 7220 636c 6920 696e  li).k for cli in
+00013fe0: 2076 6d63 6c69 656e 7473 2069 6620 636c   vmclients if cl
+00013ff0: 6920 213d 2073 656c 662e 636c 6965 6e74  i != self.client
+00014000: 7d29 0a20 2020 2020 2020 2068 7970 6572  }).        hyper
+00014010: 7368 6966 7420 3d20 4661 6c73 650a 2020  shift = False.  
+00014020: 2020 2020 2020 6173 7369 7374 6564 203d        assisted =
+00014030: 2046 616c 7365 0a20 2020 2020 2020 2066   False.        f
+00014040: 6f72 2068 7970 6572 7669 736f 7220 696e  or hypervisor in
+00014050: 2064 656c 6574 6563 6c69 656e 7473 3a0a   deleteclients:.
+00014060: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+00014070: 6465 6c65 7465 636c 6965 6e74 735b 6879  deleteclients[hy
+00014080: 7065 7276 6973 6f72 5d0a 2020 2020 2020  pervisor].      
+00014090: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
+000140a0: 736f 7274 6564 2863 2e6c 6973 7428 292c  sorted(c.list(),
+000140b0: 206b 6579 3d6c 616d 6264 6120 783a 2078   key=lambda x: x
+000140c0: 5b27 6e61 6d65 275d 293a 0a20 2020 2020  ['name']):.     
+000140d0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+000140e0: 3d20 766d 5b27 6e61 6d65 275d 0a20 2020  = vm['name'].   
+000140f0: 2020 2020 2020 2020 2020 2020 2064 6573               des
+00014100: 6372 6970 7469 6f6e 203d 2076 6d2e 6765  cription = vm.ge
+00014110: 7428 2770 6c61 6e27 290a 2020 2020 2020  t('plan').      
+00014120: 2020 2020 2020 2020 2020 6966 2064 6573            if des
+00014130: 6372 6970 7469 6f6e 203d 3d20 706c 616e  cription == plan
+00014140: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014150: 2020 2020 2020 6966 2027 6c6f 6164 6261        if 'loadba
+00014160: 6c61 6e63 6572 2720 696e 2076 6d3a 0a20  lancer' in vm:. 
+00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014180: 2020 2020 2020 206c 6273 203d 2076 6d5b         lbs = vm[
+00014190: 276c 6f61 6462 616c 616e 6365 7227 5d2e  'loadbalancer'].
+000141a0: 7370 6c69 7428 272c 2729 0a20 2020 2020  split(',').     
+000141b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141c0: 2020 2066 6f72 206c 6220 696e 206c 6273     for lb in lbs
+000141d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000141e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000141f0: 206c 6220 6e6f 7420 696e 2064 656c 6574   lb not in delet
+00014200: 6564 6c62 733a 0a20 2020 2020 2020 2020  edlbs:.         
+00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014220: 2020 2020 2020 2064 656c 6574 6564 6c62         deletedlb
+00014230: 732e 6170 7065 6e64 286c 6229 0a20 2020  s.append(lb).   
+00014240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014250: 2076 6d6e 6574 776f 726b 7320 3d20 632e   vmnetworks = c.
+00014260: 766d 5f70 6f72 7473 286e 616d 6529 0a20  vm_ports(name). 
+00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014280: 2020 2066 6f72 206e 6574 776f 726b 2069     for network i
+00014290: 6e20 766d 6e65 7477 6f72 6b73 3a0a 2020  n vmnetworks:.  
+000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142b0: 2020 2020 2020 6966 206e 6574 776f 726b        if network
+000142c0: 2021 3d20 2764 6566 6175 6c74 2720 616e   != 'default' an
+000142d0: 6420 6e65 7477 6f72 6b20 6e6f 7420 696e  d network not in
+000142e0: 206e 6574 776f 726b 733a 0a20 2020 2020   networks:.     
+000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014300: 2020 2020 2020 206e 6574 776f 726b 732e         networks.
+00014310: 6170 7065 6e64 286e 6574 776f 726b 290a  append(network).
+00014320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014330: 2020 2020 646e 7363 6c69 656e 742c 2064      dnsclient, d
+00014340: 6f6d 6169 6e20 3d20 632e 646e 7369 6e66  omain = c.dnsinf
+00014350: 6f28 6e61 6d65 290a 2020 2020 2020 2020  o(name).        
+00014360: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+00014370: 6e72 6567 6973 7465 723a 0a20 2020 2020  nregister:.     
+00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014390: 2020 2069 6d61 6765 203d 206b 2e69 6e66     image = k.inf
+000143a0: 6f28 6e61 6d65 292e 6765 7428 2769 6d61  o(name).get('ima
+000143b0: 6765 2729 0a20 2020 2020 2020 2020 2020  ge').           
+000143c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000143d0: 2772 6865 6c27 2069 6e20 696d 6167 653a  'rhel' in image:
+000143e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000143f0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00014400: 696e 7428 6622 5265 6d6f 7669 6e67 2072  int(f"Removing r
+00014410: 6865 6c20 7375 6273 6372 6970 7469 6f6e  hel subscription
+00014420: 2066 6f72 207b 6e61 6d65 7d22 290a 2020   for {name}").  
+00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014440: 2020 2020 2020 2020 2020 6970 2c20 766d            ip, vm
+00014450: 706f 7274 203d 205f 7373 685f 6372 6564  port = _ssh_cred
+00014460: 656e 7469 616c 7328 6b2c 206e 616d 6529  entials(k, name)
+00014470: 5b31 3a5d 0a20 2020 2020 2020 2020 2020  [1:].           
+00014480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014490: 2063 6d64 203d 2022 7375 6273 6372 6970   cmd = "subscrip
+000144a0: 7469 6f6e 2d6d 616e 6167 6572 2075 6e72  tion-manager unr
+000144b0: 6567 6973 7465 7222 0a20 2020 2020 2020  egister".       
+000144c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144d0: 2020 2020 2073 7368 636d 6420 3d20 7373       sshcmd = ss
+000144e0: 6828 6e61 6d65 2c20 6970 3d69 702c 2075  h(name, ip=ip, u
+000144f0: 7365 723d 2772 6f6f 7427 2c20 7475 6e6e  ser='root', tunn
+00014500: 656c 3d73 656c 662e 7475 6e6e 656c 2c0a  el=self.tunnel,.
+00014510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014530: 2020 2020 2020 2020 2074 756e 6e65 6c68           tunnelh
+00014540: 6f73 743d 7365 6c66 2e74 756e 6e65 6c68  ost=self.tunnelh
+00014550: 6f73 742c 2074 756e 6e65 6c70 6f72 743d  ost, tunnelport=
+00014560: 7365 6c66 2e74 756e 6e65 6c70 6f72 742c  self.tunnelport,
+00014570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014590: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
+000145a0: 7573 6572 3d73 656c 662e 7475 6e6e 656c  user=self.tunnel
+000145b0: 7573 6572 2c20 696e 7365 6375 7265 3d54  user, insecure=T
+000145c0: 7275 652c 2063 6d64 3d63 6d64 2c20 766d  rue, cmd=cmd, vm
+000145d0: 706f 7274 3d76 6d70 6f72 7429 0a20 2020  port=vmport).   
+000145e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145f0: 2020 2020 2020 2020 206f 732e 7379 7374           os.syst
+00014600: 656d 2873 7368 636d 6429 0a20 2020 2020  em(sshcmd).     
+00014610: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00014620: 2e64 656c 6574 6528 6e61 6d65 2c20 736e  .delete(name, sn
+00014630: 6170 7368 6f74 733d 5472 7565 290a 2020  apshots=True).  
+00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014650: 2020 6966 2064 6e73 636c 6965 6e74 2069    if dnsclient i
+00014660: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2064  s not None and d
+00014670: 6f6d 6169 6e20 6973 206e 6f74 204e 6f6e  omain is not Non
+00014680: 6520 616e 6420 646e 7363 6c69 656e 7420  e and dnsclient 
+00014690: 696e 2073 656c 662e 636c 6965 6e74 733a  in self.clients:
+000146a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000146b0: 2020 2020 2020 2020 2069 6620 646e 7363           if dnsc
+000146c0: 6c69 656e 7420 696e 2064 6e73 636c 6965  lient in dnsclie
+000146d0: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146f0: 207a 203d 2064 6e73 636c 6965 6e74 735b   z = dnsclients[
+00014700: 646e 7363 6c69 656e 745d 0a20 2020 2020  dnsclient].     
+00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014720: 2020 2065 6c69 6620 646e 7363 6c69 656e     elif dnsclien
+00014730: 7420 696e 2073 656c 662e 636c 6965 6e74  t in self.client
+00014740: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00014750: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00014760: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
+00014770: 743d 646e 7363 6c69 656e 7429 2e6b 0a20  t=dnsclient).k. 
+00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014790: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
+000147a0: 6965 6e74 735b 646e 7363 6c69 656e 745d  ients[dnsclient]
+000147b0: 203d 207a 0a20 2020 2020 2020 2020 2020   = z.           
+000147c0: 2020 2020 2020 2020 2020 2020 207a 2e64               z.d
+000147d0: 656c 6574 655f 646e 7328 646e 7363 6c69  elete_dns(dnscli
+000147e0: 656e 742c 2064 6f6d 6169 6e29 0a20 2020  ent, domain).   
+000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014800: 2063 6f6d 6d6f 6e2e 7365 745f 6c61 7374   common.set_last
+00014810: 766d 286e 616d 652c 2073 656c 662e 636c  vm(name, self.cl
+00014820: 6965 6e74 2c20 6465 6c65 7465 3d54 7275  ient, delete=Tru
+00014830: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00014840: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+00014850: 227b 6e61 6d65 7d20 6465 6c65 7465 6420  "{name} deleted 
+00014860: 6f6e 207b 6879 7065 7276 6973 6f72 7d21  on {hypervisor}!
+00014870: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00014880: 2020 2020 2020 2064 656c 6574 6564 766d         deletedvm
+00014890: 732e 6170 7065 6e64 286e 616d 6529 0a20  s.append(name). 
+000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148b0: 2020 2066 6f75 6e64 203d 2054 7275 650a     found = True.
 000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
-000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148f0: 2020 2063 6c75 7374 6572 203d 2076 6d2e     cluster = vm.
-00014900: 6765 7428 276b 7562 6527 290a 2020 2020  get('kube').    
-00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014920: 6966 2063 6c75 7374 6572 2069 7320 6e6f  if cluster is no
-00014930: 7420 4e6f 6e65 2061 6e64 2063 6c75 7374  t None and clust
-00014940: 6572 2021 3d20 2727 3a0a 2020 2020 2020  er != '':.      
-00014950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014960: 2020 636c 7573 7465 7264 6972 203d 206f    clusterdir = o
-00014970: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-00014980: 7228 6622 7e2f 2e6b 636c 692f 636c 7573  r(f"~/.kcli/clus
-00014990: 7465 7273 2f7b 636c 7573 7465 727d 2229  ters/{cluster}")
-000149a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000149b0: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-000149c0: 6174 682e 6578 6973 7473 2863 6c75 7374  ath.exists(clust
-000149d0: 6572 6469 7229 3a0a 2020 2020 2020 2020  erdir):.        
-000149e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149f0: 2020 2020 7061 7261 6d65 7465 7273 6669      parametersfi
-00014a00: 6c65 203d 2066 227b 636c 7573 7465 7264  le = f"{clusterd
-00014a10: 6972 7d2f 6b63 6c69 5f70 6172 616d 6574  ir}/kcli_paramet
-00014a20: 6572 732e 796d 6c22 0a20 2020 2020 2020  ers.yml".       
-00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a40: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00014a50: 6578 6973 7473 2870 6172 616d 6574 6572  exists(parameter
-00014a60: 7366 696c 6529 3a0a 2020 2020 2020 2020  sfile):.        
-00014a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a80: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00014a90: 6e28 7061 7261 6d65 7465 7273 6669 6c65  n(parametersfile
-00014aa0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ac0: 2020 2020 2020 2020 2020 2020 636c 7573              clus
-00014ad0: 7465 7264 6174 6120 3d20 7961 6d6c 2e73  terdata = yaml.s
-00014ae0: 6166 655f 6c6f 6164 2866 290a 2020 2020  afe_load(f).    
-00014af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b10: 6b75 6265 7479 7065 203d 2063 6c75 7374  kubetype = clust
-00014b20: 6572 6461 7461 2e67 6574 2827 6b75 6265  erdata.get('kube
-00014b30: 7479 7065 272c 2027 6765 6e65 7269 6327  type', 'generic'
-00014b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b60: 2020 2020 2020 6966 206b 7562 6574 7970        if kubetyp
-00014b70: 6520 3d3d 2027 6879 7065 7273 6869 6674  e == 'hypershift
-00014b80: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ba0: 2020 2020 2020 2020 2020 2068 7970 6572             hyper
-00014bb0: 7368 6966 7420 3d20 5472 7565 0a20 2020  shift = True.   
-00014bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014be0: 2020 2020 2061 7373 6973 7465 6420 3d20       assisted = 
-00014bf0: 636c 7573 7465 7264 6174 612e 6765 7428  clusterdata.get(
-00014c00: 6173 7369 7374 6564 2c20 4661 6c73 6529  assisted, False)
-00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c30: 2020 2020 2064 6f6d 6169 6e20 3d20 636c       domain = cl
-00014c40: 7573 7465 7264 6174 612e 6765 7428 2764  usterdata.get('d
-00014c50: 6f6d 6169 6e27 2c20 646f 6d61 696e 290a  omain', domain).
-00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c80: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
-00014c90: 636c 7573 7465 7264 6174 612e 6765 7428  clusterdata.get(
-00014ca0: 2764 6e73 636c 6965 6e74 2729 0a20 2020  'dnsclient').   
-00014cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cc0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00014cd0: 6879 7065 7273 6869 6674 3a0a 2020 2020  hypershift:.    
-00014ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cf0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00014d00: 6e74 2866 2244 656c 6574 696e 6720 6469  nt(f"Deleting di
-00014d10: 7265 6374 6f72 7920 7b63 6c75 7374 6572  rectory {cluster
-00014d20: 6469 727d 2229 0a20 2020 2020 2020 2020  dir}").         
-00014d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d40: 2020 2020 2020 2072 6d74 7265 6528 636c         rmtree(cl
-00014d50: 7573 7465 7264 6972 2c20 6967 6e6f 7265  usterdir, ignore
-00014d60: 5f65 7272 6f72 733d 5472 7565 290a 2020  _errors=True).  
-00014d70: 2020 2020 2020 6966 2068 7970 6572 7368        if hypersh
-00014d80: 6966 743a 0a20 2020 2020 2020 2020 2020  ift:.           
-00014d90: 206b 7562 6563 6f6e 6669 676d 676d 7420   kubeconfigmgmt 
-00014da0: 3d20 6622 7b63 6c75 7374 6572 6469 727d  = f"{clusterdir}
-00014db0: 2f6b 7562 6563 6f6e 6669 672e 6d67 6d74  /kubeconfig.mgmt
-00014dc0: 220a 2020 2020 2020 2020 2020 2020 6361  ".            ca
-00014dd0: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
-00014de0: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
-00014df0: 206f 6320 6465 6c65 7465 202d 6620 7b63   oc delete -f {c
-00014e00: 6c75 7374 6572 6469 727d 2f61 7574 6f61  lusterdir}/autoa
-00014e10: 7070 726f 7665 7263 726f 6e2e 796d 6c27  pprovercron.yml'
-00014e20: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-00014e30: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
-00014e40: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
-00014e50: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
-00014e60: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
-00014e70: 6572 6469 727d 2f6e 6f64 6570 6f6f 6c2e  erdir}/nodepool.
-00014e80: 7961 6d6c 272c 2073 6865 6c6c 3d54 7275  yaml', shell=Tru
-00014e90: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
-00014ea0: 616c 6c28 6627 4b55 4245 434f 4e46 4947  all(f'KUBECONFIG
-00014eb0: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
-00014ec0: 7d20 6f63 2064 656c 6574 6520 2d66 207b  } oc delete -f {
-00014ed0: 636c 7573 7465 7264 6972 7d2f 686f 7374  clusterdir}/host
-00014ee0: 6564 636c 7573 7465 722e 7961 6d6c 272c  edcluster.yaml',
-00014ef0: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00014f00: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00014f10: 6173 7369 7374 6564 2061 6e64 2028 2762  assisted and ('b
-00014f20: 6172 656d 6574 616c 5f69 736f 2720 696e  aremetal_iso' in
-00014f30: 2063 6c75 7374 6572 6461 7461 206f 7220   clusterdata or 
-00014f40: 2762 6172 656d 6574 616c 5f68 6f73 7473  'baremetal_hosts
-00014f50: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
-00014f60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014f70: 2020 2063 616c 6c28 274b 5542 4543 4f4e     call('KUBECON
-00014f80: 4649 473d 7b6b 7562 6563 6f6e 6669 676d  FIG={kubeconfigm
-00014f90: 676d 747d 206f 6320 2d6e 2064 6566 6175  gmt} oc -n defau
-00014fa0: 6c74 2064 656c 6574 6520 616c 6c20 2d6c  lt delete all -l
-00014fb0: 2061 7070 3d68 7474 7064 2d6b 636c 6927   app=httpd-kcli'
-00014fc0: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-00014fd0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00014fe0: 6c6c 2827 4b55 4245 434f 4e46 4947 3d7b  ll('KUBECONFIG={
-00014ff0: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-00015000: 6f63 202d 6e20 6465 6661 756c 7420 6465  oc -n default de
-00015010: 6c65 7465 2073 7663 2068 7474 7064 2d6b  lete svc httpd-k
-00015020: 636c 692d 7376 6327 2c20 7368 656c 6c3d  cli-svc', shell=
-00015030: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00015040: 2020 2020 2020 6361 6c6c 2827 4b55 4245        call('KUBE
-00015050: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
-00015060: 6967 6d67 6d74 7d20 6f63 202d 6e20 6465  igmgmt} oc -n de
-00015070: 6661 756c 7420 6465 6c65 7465 2070 7663  fault delete pvc
-00015080: 2068 7474 7064 2d6b 636c 692d 7076 6327   httpd-kcli-pvc'
-00015090: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-000150a0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-000150b0: 2866 2244 656c 6574 696e 6720 6469 7265  (f"Deleting dire
-000150c0: 6374 6f72 7920 7b63 6c75 7374 6572 6469  ctory {clusterdi
-000150d0: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
-000150e0: 2072 6d74 7265 6528 636c 7573 7465 7264   rmtree(clusterd
-000150f0: 6972 2c20 6967 6e6f 7265 5f65 7272 6f72  ir, ignore_error
-00015100: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
-00015110: 6966 2063 6f6e 7461 696e 6572 3a0a 2020  if container:.  
-00015120: 2020 2020 2020 2020 2020 636f 6e74 203d            cont =
-00015130: 204b 636f 6e74 6169 6e65 7263 6f6e 6669   Kcontainerconfi
-00015140: 6728 7365 6c66 2c20 636c 6965 6e74 3d73  g(self, client=s
-00015150: 656c 662e 636f 6e74 6169 6e65 7263 6c69  elf.containercli
-00015160: 656e 7429 2e63 6f6e 740a 2020 2020 2020  ent).cont.      
-00015170: 2020 2020 2020 666f 7220 636f 6e74 6120        for conta 
-00015180: 696e 2073 6f72 7465 6428 636f 6e74 2e6c  in sorted(cont.l
-00015190: 6973 745f 636f 6e74 6169 6e65 7273 286b  ist_containers(k
-000151a0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000151b0: 2020 2020 6e61 6d65 203d 2063 6f6e 7461      name = conta
-000151c0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-000151d0: 2020 2020 636f 6e74 6169 6e65 725f 706c      container_pl
-000151e0: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
-000151f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00015200: 2063 6f6e 7461 696e 6572 5f70 6c61 6e20   container_plan 
-00015210: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-00015220: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00015230: 742e 6465 6c65 7465 5f63 6f6e 7461 696e  t.delete_contain
-00015240: 6572 286e 616d 6529 0a20 2020 2020 2020  er(name).       
-00015250: 2020 2020 2020 2020 2020 2020 2073 7563               suc
-00015260: 6365 7373 2866 2243 6f6e 7461 696e 6572  cess(f"Container
-00015270: 207b 6e61 6d65 7d20 6465 6c65 7465 6421   {name} deleted!
-00015280: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00015290: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
-000152a0: 7275 650a 2020 2020 2020 2020 6966 206e  rue.        if n
-000152b0: 6f74 2073 656c 662e 6b65 6570 5f6e 6574  ot self.keep_net
-000152c0: 776f 726b 733a 0a20 2020 2020 2020 2020  works:.         
-000152d0: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-000152e0: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
-000152f0: 2020 2020 2020 2020 2020 6e65 7477 6f72            networ
-00015300: 6b73 203d 206b 2e6c 6973 745f 6e65 7477  ks = k.list_netw
-00015310: 6f72 6b73 2829 0a20 2020 2020 2020 2020  orks().         
-00015320: 2020 2020 2020 2066 6f72 206e 6574 776f         for netwo
-00015330: 726b 2069 6e20 6b2e 6c69 7374 5f6e 6574  rk in k.list_net
-00015340: 776f 726b 7328 293a 0a20 2020 2020 2020  works():.       
-00015350: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015360: 2770 6c61 6e27 2069 6e20 6e65 7477 6f72  'plan' in networ
-00015370: 6b73 5b6e 6574 776f 726b 5d20 616e 6420  ks[network] and 
-00015380: 6e65 7477 6f72 6b73 5b6e 6574 776f 726b  networks[network
-00015390: 5d5b 2770 6c61 6e27 5d20 3d3d 2070 6c61  ]['plan'] == pla
-000153a0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-000153b0: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
-000153c0: 726b 7265 7375 6c74 203d 206b 2e64 656c  rkresult = k.del
-000153d0: 6574 655f 6e65 7477 6f72 6b28 6e65 7477  ete_network(netw
-000153e0: 6f72 6b29 0a20 2020 2020 2020 2020 2020  ork).           
-000153f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015400: 6e65 7477 6f72 6b72 6573 756c 745b 2772  networkresult['r
-00015410: 6573 756c 7427 5d20 3d3d 2027 7375 6363  esult'] == 'succ
-00015420: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
-00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015440: 2020 7375 6363 6573 7328 6622 6e65 7477    success(f"netw
-00015450: 6f72 6b20 7b6e 6574 776f 726b 7d20 6465  ork {network} de
-00015460: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
-00015490: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-000154a0: 6966 206e 6574 776f 726b 733a 0a20 2020  if networks:.   
-000154b0: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-000154c0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-000154d0: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
-000154e0: 7477 6f72 6b20 696e 206e 6574 776f 726b  twork in network
-000154f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00015500: 2020 2020 2020 206e 6574 776f 726b 7265         networkre
-00015510: 7375 6c74 203d 206b 2e64 656c 6574 655f  sult = k.delete_
-00015520: 6e65 7477 6f72 6b28 6e65 7477 6f72 6b29  network(network)
-00015530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015540: 2020 2020 2069 6620 6e65 7477 6f72 6b72       if networkr
-00015550: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
-00015560: 3d3d 2027 7375 6363 6573 7327 3a0a 2020  == 'success':.  
-00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015580: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00015590: 556e 7573 6564 206e 6574 776f 726b 207b  Unused network {
-000155a0: 6e65 7477 6f72 6b7d 2064 656c 6574 6564  network} deleted
-000155b0: 2122 290a 2020 2020 2020 2020 666f 7220  !").        for 
-000155c0: 6b65 7966 696c 6520 696e 2067 6c6f 622e  keyfile in glob.
-000155d0: 676c 6f62 2822 2573 2e6b 6579 2a22 2025  glob("%s.key*" %
-000155e0: 2070 6c61 6e29 3a0a 2020 2020 2020 2020   plan):.        
-000155f0: 2020 2020 7375 6363 6573 7328 6622 6669      success(f"fi
-00015600: 6c65 207b 6b65 7966 696c 657d 2066 726f  le {keyfile} fro
-00015610: 6d20 7b70 6c61 6e7d 2064 656c 6574 6564  m {plan} deleted
-00015620: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
-00015630: 6f73 2e72 656d 6f76 6528 6b65 7966 696c  os.remove(keyfil
-00015640: 6529 0a20 2020 2020 2020 2066 6f72 2061  e).        for a
-00015650: 6e73 6962 6c65 6669 6c65 2069 6e20 676c  nsiblefile in gl
-00015660: 6f62 2e67 6c6f 6228 222f 746d 702f 2573  ob.glob("/tmp/%s
-00015670: 2a69 6e76 2a22 2025 2070 6c61 6e29 3a0a  *inv*" % plan):.
-00015680: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-00015690: 6573 7328 6622 6669 6c65 207b 616e 7369  ess(f"file {ansi
-000156a0: 626c 6566 696c 657d 2066 726f 6d20 7b70  blefile} from {p
-000156b0: 6c61 6e7d 2064 656c 6574 6564 2122 290a  lan} deleted!").
-000156c0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-000156d0: 656d 6f76 6528 616e 7369 626c 6566 696c  emove(ansiblefil
-000156e0: 6529 0a20 2020 2020 2020 2069 6620 6465  e).        if de
-000156f0: 6c65 7465 646c 6273 2061 6e64 2073 656c  letedlbs and sel
-00015700: 662e 7479 7065 2069 6e20 5b27 6177 7327  f.type in ['aws'
-00015710: 2c20 2767 6370 275d 3a0a 2020 2020 2020  , 'gcp']:.      
-00015720: 2020 2020 2020 666f 7220 6c62 2069 6e20        for lb in 
-00015730: 6465 6c65 7465 646c 6273 3a0a 2020 2020  deletedlbs:.    
-00015740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015750: 2e64 656c 6574 655f 6c6f 6164 6261 6c61  .delete_loadbala
-00015760: 6e63 6572 286c 6229 0a20 2020 2020 2020  ncer(lb).       
-00015770: 2069 6620 666f 756e 643a 0a20 2020 2020   if found:.     
-00015780: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
-00015790: 2250 6c61 6e20 7b70 6c61 6e7d 2064 656c  "Plan {plan} del
-000157a0: 6574 6564 2122 290a 2020 2020 2020 2020  eted!").        
-000157b0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-000157c0: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
-000157d0: 2027 6465 6c65 7465 6476 6d27 3a20 6465   'deletedvm': de
-000157e0: 6c65 7465 6476 6d73 7d0a 2020 2020 2020  letedvms}.      
-000157f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015800: 2020 2020 6572 726f 7228 6622 4e6f 206f      error(f"No o
-00015810: 626a 6563 7473 2066 6f75 6e64 2064 7572  bjects found dur
-00015820: 696e 6720 6465 6c65 7469 6f6e 206f 6620  ing deletion of 
-00015830: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
-00015840: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00015850: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00015860: 6c75 7265 277d 0a0a 2020 2020 6465 6620  lure'}..    def 
-00015870: 736e 6170 7368 6f74 5f70 6c61 6e28 7365  snapshot_plan(se
-00015880: 6c66 2c20 706c 616e 2c20 736e 6170 7368  lf, plan, snapsh
-00015890: 6f74 6e61 6d65 3d4e 6f6e 6529 3a0a 2020  otname=None):.  
-000158a0: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
-000158b0: 0a20 2020 2020 2020 2073 6e61 7073 686f  .        snapsho
-000158c0: 7466 6f75 6e64 203d 2046 616c 7365 0a20  tfound = False. 
-000158d0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-000158e0: 536e 6170 7368 6f74 7469 6e67 2076 6d73  Snapshotting vms
-000158f0: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
-00015900: 7d22 290a 2020 2020 2020 2020 6966 2073  }").        if s
-00015910: 6e61 7073 686f 746e 616d 6520 6973 204e  napshotname is N
-00015920: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00015930: 2077 6172 6e69 6e67 2866 2255 7369 6e67   warning(f"Using
-00015940: 207b 706c 616e 7d20 6173 2073 6e61 7073   {plan} as snaps
-00015950: 686f 7420 6e61 6d65 2061 7320 4e6f 6e65  hot name as None
-00015960: 2077 6173 2070 726f 7669 6465 6422 290a   was provided").
-00015970: 2020 2020 2020 2020 2020 2020 736e 6170              snap
-00015980: 7368 6f74 6e61 6d65 203d 2070 6c61 6e0a  shotname = plan.
-00015990: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-000159a0: 6e20 736f 7274 6564 286b 2e6c 6973 7428  n sorted(k.list(
-000159b0: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
-000159c0: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
-000159d0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-000159e0: 766d 5b27 6e61 6d65 275d 0a20 2020 2020  vm['name'].     
-000159f0: 2020 2020 2020 2064 6573 6372 6970 7469         descripti
-00015a00: 6f6e 203d 2076 6d5b 2770 6c61 6e27 5d0a  on = vm['plan'].
-00015a10: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00015a20: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
-00015a30: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-00015a40: 2020 2020 736e 6170 7368 6f74 666f 756e      snapshotfoun
-00015a50: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00015a60: 2020 2020 2020 2020 206b 2e63 7265 6174           k.creat
-00015a70: 655f 736e 6170 7368 6f74 2873 6e61 7073  e_snapshot(snaps
-00015a80: 686f 746e 616d 652c 206e 616d 6529 0a20  hotname, name). 
-00015a90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00015aa0: 7563 6365 7373 2866 227b 6e61 6d65 7d20  uccess(f"{name} 
-00015ab0: 736e 6170 7368 6f74 7465 6421 2229 0a20  snapshotted!"). 
-00015ac0: 2020 2020 2020 2069 6620 736e 6170 7368         if snapsh
-00015ad0: 6f74 666f 756e 643a 0a20 2020 2020 2020  otfound:.       
-00015ae0: 2020 2020 2073 7563 6365 7373 2866 2250       success(f"P
-00015af0: 6c61 6e20 7b70 6c61 6e7d 2073 6e61 7073  lan {plan} snaps
-00015b00: 686f 7474 6564 2122 290a 2020 2020 2020  hotted!").      
-00015b10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015b20: 2020 2020 7761 726e 696e 6728 224e 6f20      warning("No 
-00015b30: 6d61 7463 6869 6e67 2076 6d73 2066 6f75  matching vms fou
-00015b40: 6e64 2229 0a20 2020 2020 2020 2072 6574  nd").        ret
-00015b50: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00015b60: 7375 6363 6573 7327 7d0a 0a20 2020 2064  success'}..    d
-00015b70: 6566 2072 6576 6572 745f 706c 616e 2873  ef revert_plan(s
-00015b80: 656c 662c 2070 6c61 6e2c 2073 6e61 7073  elf, plan, snaps
-00015b90: 686f 746e 616d 653d 4e6f 6e65 293a 0a20  hotname=None):. 
-00015ba0: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00015bb0: 6b0a 2020 2020 2020 2020 7265 7665 7274  k.        revert
-00015bc0: 666f 756e 6420 3d20 4661 6c73 650a 2020  found = False.  
-00015bd0: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
-00015be0: 6576 6572 7469 6e67 2073 6e61 7073 686f  everting snapsho
-00015bf0: 7473 206f 6620 766d 7320 6672 6f6d 2070  ts of vms from p
-00015c00: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
-00015c10: 2020 2020 2069 6620 736e 6170 7368 6f74       if snapshot
-00015c20: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-00015c30: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00015c40: 6728 6622 5573 696e 6720 7b70 6c61 6e7d  g(f"Using {plan}
-00015c50: c2a0 6173 2073 6e61 7073 686f 7420 6e61  ..as snapshot na
-00015c60: 6d65 2061 7320 4e6f 6e65 2077 6173 2070  me as None was p
-00015c70: 726f 7669 6465 6422 290a 2020 2020 2020  rovided").      
-00015c80: 2020 2020 2020 736e 6170 7368 6f74 6e61        snapshotna
-00015c90: 6d65 203d 2070 6c61 6e0a 2020 2020 2020  me = plan.      
-00015ca0: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
-00015cb0: 6564 286b 2e6c 6973 7428 292c 206b 6579  ed(k.list(), key
-00015cc0: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
-00015cd0: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
-00015ce0: 2020 206e 616d 6520 3d20 766d 5b27 6e61     name = vm['na
-00015cf0: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-00015d00: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
-00015d10: 6d5b 2770 6c61 6e27 5d0a 2020 2020 2020  m['plan'].      
-00015d20: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
-00015d30: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
-00015d40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00015d50: 7665 7274 666f 756e 6420 3d20 5472 7565  vertfound = True
-00015d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015d70: 206b 2e72 6576 6572 745f 736e 6170 7368   k.revert_snapsh
-00015d80: 6f74 2873 6e61 7073 686f 746e 616d 652c  ot(snapshotname,
-00015d90: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
-00015da0: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
-00015db0: 2273 6e61 7073 686f 7420 6f66 207b 6e61  "snapshot of {na
-00015dc0: 6d65 7d20 7265 7665 7274 6564 2122 290a  me} reverted!").
-00015dd0: 2020 2020 2020 2020 6966 2072 6576 6572          if rever
-00015de0: 7466 6f75 6e64 3a0a 2020 2020 2020 2020  tfound:.        
-00015df0: 2020 2020 7375 6363 6573 7328 6622 506c      success(f"Pl
-00015e00: 616e 207b 706c 616e 7d20 7265 7665 7274  an {plan} revert
-00015e10: 6564 2077 6974 6820 736e 6170 7368 6f74  ed with snapshot
-00015e20: 207b 736e 6170 7368 6f74 6e61 6d65 7d21   {snapshotname}!
-00015e30: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
-00015e40: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-00015e50: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
-00015e60: 6720 766d 7320 666f 756e 6422 290a 2020  g vms found").  
-00015e70: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00015e80: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-00015e90: 277d 0a0a 2020 2020 6465 6620 706c 616e  '}..    def plan
-00015ea0: 2873 656c 662c 2070 6c61 6e2c 2061 6e73  (self, plan, ans
-00015eb0: 6962 6c65 3d46 616c 7365 2c20 7572 6c3d  ible=False, url=
-00015ec0: 4e6f 6e65 2c20 7061 7468 3d4e 6f6e 652c  None, path=None,
-00015ed0: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
-00015ee0: 2c20 696e 7075 7466 696c 653d 4e6f 6e65  , inputfile=None
-00015ef0: 2c20 696e 7075 7473 7472 696e 673d 4e6f  , inputstring=No
-00015f00: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00015f10: 206f 7665 7272 6964 6573 3d7b 7d2c 2069   overrides={}, i
-00015f20: 6e66 6f3d 4661 6c73 652c 2075 7064 6174  nfo=False, updat
-00015f30: 653d 4661 6c73 652c 2065 6d62 6564 6465  e=False, embedde
-00015f40: 643d 4661 6c73 652c 2064 6f77 6e6c 6f61  d=False, downloa
-00015f50: 643d 4661 6c73 652c 2071 7569 6574 3d46  d=False, quiet=F
-00015f60: 616c 7365 2c20 646f 633d 4661 6c73 652c  alse, doc=False,
-00015f70: 0a20 2020 2020 2020 2020 2020 2020 6f6e  .             on
-00015f80: 6c79 6173 7365 7473 3d46 616c 7365 2c20  lyassets=False, 
-00015f90: 7072 653d 5472 7565 2c20 706f 7374 3d54  pre=True, post=T
-00015fa0: 7275 652c 2065 7863 6c75 6465 766d 733d  rue, excludevms=
-00015fb0: 5b5d 2c20 6261 7365 6d6f 6465 3d46 616c  [], basemode=Fal
-00015fc0: 7365 2c20 7468 7265 6164 6564 3d46 616c  se, threaded=Fal
-00015fd0: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-00015fe0: 4d61 6e61 6765 2070 6c61 6e20 6669 6c65  Manage plan file
-00015ff0: 2222 220a 2020 2020 2020 2020 6b20 3d20  """.        k = 
-00016000: 7365 6c66 2e6b 0a20 2020 2020 2020 206e  self.k.        n
-00016010: 6f5f 6f76 6572 7269 6465 7320 3d20 6e6f  o_overrides = no
-00016020: 7420 6f76 6572 7269 6465 730a 2020 2020  t overrides.    
-00016030: 2020 2020 7468 7265 6164 7320 3d20 5b5d      threads = []
-00016040: 0a20 2020 2020 2020 206e 6577 766d 7320  .        newvms 
-00016050: 3d20 5b5d 0a20 2020 2020 2020 206e 6577  = [].        new
-00016060: 6173 7365 7473 203d 205b 5d0a 2020 2020  assets = [].    
-00016070: 2020 2020 6661 696c 6564 766d 7320 3d20      failedvms = 
-00016080: 5b5d 0a20 2020 2020 2020 2065 7869 7374  [].        exist
-00016090: 696e 6776 6d73 203d 205b 5d0a 2020 2020  ingvms = [].    
-000160a0: 2020 2020 6173 796e 6377 6169 7476 6d73      asyncwaitvms
-000160b0: 203d 205b 5d0a 2020 2020 2020 2020 6f6e   = [].        on
-000160c0: 666c 7920 3d20 4e6f 6e65 0a20 2020 2020  fly = None.     
-000160d0: 2020 2074 6f63 6c65 616e 203d 2046 616c     toclean = Fal
-000160e0: 7365 0a20 2020 2020 2020 2067 6574 6261  se.        getba
-000160f0: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
-00016100: 2020 2076 6d70 726f 6669 6c65 7320 3d20     vmprofiles = 
-00016110: 7b6b 6579 3a20 7661 6c75 6520 666f 7220  {key: value for 
-00016120: 6b65 792c 2076 616c 7565 2069 6e20 7365  key, value in se
-00016130: 6c66 2e70 726f 6669 6c65 732e 6974 656d  lf.profiles.item
-00016140: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00016150: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
-00016160: 7065 2720 6e6f 7420 696e 2076 616c 7565  pe' not in value
-00016170: 206f 7220 7661 6c75 655b 2774 7970 6527   or value['type'
-00016180: 5d20 3d3d 2027 766d 277d 0a20 2020 2020  ] == 'vm'}.     
-00016190: 2020 2063 6f6e 7461 696e 6572 7072 6f66     containerprof
-000161a0: 696c 6573 203d 207b 6b65 793a 2076 616c  iles = {key: val
-000161b0: 7565 2066 6f72 206b 6579 2c20 7661 6c75  ue for key, valu
-000161c0: 6520 696e 2073 656c 662e 7072 6f66 696c  e in self.profil
-000161d0: 6573 2e69 7465 6d73 2829 0a20 2020 2020  es.items().     
-000161e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161f0: 2020 2020 2020 2020 6966 2027 7479 7065          if 'type
-00016200: 2720 696e 2076 616c 7565 2061 6e64 2076  ' in value and v
-00016210: 616c 7565 5b27 7479 7065 275d 203d 3d20  alue['type'] == 
-00016220: 2763 6f6e 7461 696e 6572 277d 0a20 2020  'container'}.   
-00016230: 2020 2020 2069 6620 706c 616e 2069 7320       if plan is 
-00016240: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016250: 2020 706c 616e 203d 206e 616d 6575 7469    plan = nameuti
-00016260: 6c73 2e67 6574 5f72 616e 646f 6d5f 6e61  ls.get_random_na
-00016270: 6d65 2829 0a20 2020 2020 2020 2069 6620  me().        if 
-00016280: 7572 6c20 6973 206e 6f74 204e 6f6e 653a  url is not None:
-00016290: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000162a0: 7572 6c2e 7374 6172 7473 7769 7468 2827  url.startswith('
-000162b0: 2f27 293a 0a20 2020 2020 2020 2020 2020  /'):.           
-000162c0: 2020 2020 2075 726c 203d 2066 2266 696c       url = f"fil
-000162d0: 653a 2f2f 7b75 726c 7d22 0a20 2020 2020  e://{url}".     
-000162e0: 2020 2020 2020 2069 6620 6e6f 7420 7572         if not ur
-000162f0: 6c2e 656e 6473 7769 7468 2827 2e79 6d6c  l.endswith('.yml
-00016300: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00016310: 2020 2020 7572 6c20 3d20 6622 7b75 726c      url = f"{url
-00016320: 7d2f 6b63 6c69 5f70 6c61 6e2e 796d 6c22  }/kcli_plan.yml"
-00016330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016340: 2070 7072 696e 7428 6622 5472 7969 6e67   pprint(f"Trying
-00016350: 2074 6f20 7265 7472 6965 7665 207b 7572   to retrieve {ur
-00016360: 6c7d 2229 0a20 2020 2020 2020 2020 2020  l}").           
-00016370: 2069 6e70 7574 6669 6c65 203d 206f 732e   inputfile = os.
-00016380: 7061 7468 2e62 6173 656e 616d 6528 7572  path.basename(ur
-00016390: 6c29 0a20 2020 2020 2020 2020 2020 206f  l).            o
-000163a0: 6e66 6c79 203d 206f 732e 7061 7468 2e64  nfly = os.path.d
-000163b0: 6972 6e61 6d65 2875 726c 290a 2020 2020  irname(url).    
-000163c0: 2020 2020 2020 2020 7061 7468 203d 2070          path = p
-000163d0: 6c61 6e20 6966 2070 6174 6820 6973 204e  lan if path is N
-000163e0: 6f6e 6520 656c 7365 2070 6174 680a 2020  one else path.  
-000163f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00016400: 2071 7569 6574 3a0a 2020 2020 2020 2020   quiet:.        
-00016410: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00016420: 2252 6574 7269 6576 696e 6720 7370 6563  "Retrieving spec
-00016430: 6966 6965 6420 706c 616e 2066 726f 6d20  ified plan from 
-00016440: 7b75 726c 7d20 746f 207b 7061 7468 7d22  {url} to {path}"
-00016450: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00016460: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
-00016470: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00016480: 2020 2070 6174 6820 3d20 6622 2f77 6f72     path = f"/wor
-00016490: 6b64 6972 2f7b 7061 7468 7d22 0a20 2020  kdir/{path}".   
-000164a0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000164b0: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-000164c0: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-000164d0: 2020 2020 2020 746f 636c 6561 6e20 3d20        toclean = 
-000164e0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000164f0: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
-00016500: 6828 7572 6c2c 2070 6174 6829 0a20 2020  h(url, path).   
-00016510: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00016520: 2064 6566 6175 6c74 5f70 6172 616d 6574   default_paramet
-00016530: 6572 5f66 696c 6520 696e 205b 272f 6b63  er_file in ['/kc
-00016540: 6c69 5f64 6566 6175 6c74 2e79 6d6c 272c  li_default.yml',
-00016550: 2066 272f 7b70 6c61 6e7d 5f64 6566 6175   f'/{plan}_defau
-00016560: 6c74 2e79 6d6c 272c 0a20 2020 2020 2020  lt.yml',.       
-00016570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016590: 2020 2020 2020 2020 222f 2573 5f64 6566          "/%s_def
-000165a0: 6175 6c74 2573 2220 2520 6f73 2e70 6174  ault%s" % os.pat
-000165b0: 682e 7370 6c69 7465 7874 286f 732e 7061  h.splitext(os.pa
-000165c0: 7468 2e62 6173 656e 616d 6528 7572 6c29  th.basename(url)
-000165d0: 295d 3a0a 2020 2020 2020 2020 2020 2020  )]:.            
-000165e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000165f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016600: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
-00016610: 6828 6f73 2e70 6174 682e 6469 726e 616d  h(os.path.dirnam
-00016620: 6528 7572 6c29 202b 2064 6566 6175 6c74  e(url) + default
-00016630: 5f70 6172 616d 6574 6572 5f66 696c 652c  _parameter_file,
-00016640: 2070 6174 6829 0a20 2020 2020 2020 2020   path).         
-00016650: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00016660: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00016670: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00016680: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00016690: 2064 6f77 6e6c 6f61 643a 0a20 2020 2020   download:.     
-000166a0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-000166b0: 2066 2274 6172 6765 7420 6469 7265 6374   f"target direct
-000166c0: 6f72 7920 7b70 6174 687d 2061 6c72 6561  ory {path} alrea
-000166d0: 6479 2074 6865 7265 220a 2020 2020 2020  dy there".      
-000166e0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-000166f0: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
-00016700: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00016710: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-00016720: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
-00016730: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00016740: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00016750: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
-00016760: 6720 6578 6973 7469 6e67 2064 6972 6563  g existing direc
-00016770: 746f 7279 207b 7061 7468 7d22 290a 2020  tory {path}").  
-00016780: 2020 2020 2020 2020 2020 6966 2064 6f77            if dow
-00016790: 6e6c 6f61 643a 0a20 2020 2020 2020 2020  nload:.         
-000167a0: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
-000167b0: 203d 2066 227b 7061 7468 7d2f 7b69 6e70   = f"{path}/{inp
-000167c0: 7574 6669 6c65 7d22 0a20 2020 2020 2020  utfile}".       
-000167d0: 2020 2020 2020 2020 2065 6e74 7269 6573           entries
-000167e0: 2c20 6f76 6572 7269 6465 732c 2062 6173  , overrides, bas
-000167f0: 6566 696c 652c 2062 6173 6564 6972 203d  efile, basedir =
-00016800: 2073 656c 662e 7072 6f63 6573 735f 696e   self.process_in
-00016810: 7075 7466 696c 6528 706c 616e 2c20 696e  putfile(plan, in
-00016820: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
-00016830: 6573 3d6f 7665 7272 6964 6573 2c0a 2020  es=overrides,.  
+000148d0: 2020 2020 636c 7573 7465 7220 3d20 766d      cluster = vm
+000148e0: 2e67 6574 2827 6b75 6265 2729 0a20 2020  .get('kube').   
+000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014900: 2069 6620 636c 7573 7465 7220 6973 206e   if cluster is n
+00014910: 6f74 204e 6f6e 6520 616e 6420 636c 7573  ot None and clus
+00014920: 7465 7220 213d 2027 273a 0a20 2020 2020  ter != '':.     
+00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014940: 2020 2063 6c75 7374 6572 6469 7220 3d20     clusterdir = 
+00014950: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+00014960: 6572 2866 227e 2f2e 6b63 6c69 2f63 6c75  er(f"~/.kcli/clu
+00014970: 7374 6572 732f 7b63 6c75 7374 6572 7d22  sters/{cluster}"
+00014980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014990: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+000149a0: 7061 7468 2e65 7869 7374 7328 636c 7573  path.exists(clus
+000149b0: 7465 7264 6972 293a 0a20 2020 2020 2020  terdir):.       
+000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149d0: 2020 2020 2070 6172 616d 6574 6572 7366       parametersf
+000149e0: 696c 6520 3d20 6622 7b63 6c75 7374 6572  ile = f"{cluster
+000149f0: 6469 727d 2f6b 636c 695f 7061 7261 6d65  dir}/kcli_parame
+00014a00: 7465 7273 2e79 6d6c 220a 2020 2020 2020  ters.yml".      
+00014a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a20: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00014a30: 2e65 7869 7374 7328 7061 7261 6d65 7465  .exists(paramete
+00014a40: 7273 6669 6c65 293a 0a20 2020 2020 2020  rsfile):.       
+00014a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a60: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+00014a70: 656e 2870 6172 616d 6574 6572 7366 696c  en(parametersfil
+00014a80: 6529 2061 7320 663a 0a20 2020 2020 2020  e) as f:.       
+00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014aa0: 2020 2020 2020 2020 2020 2020 2063 6c75               clu
+00014ab0: 7374 6572 6461 7461 203d 2079 616d 6c2e  sterdata = yaml.
+00014ac0: 7361 6665 5f6c 6f61 6428 6629 0a20 2020  safe_load(f).   
+00014ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014af0: 206b 7562 6574 7970 6520 3d20 636c 7573   kubetype = clus
+00014b00: 7465 7264 6174 612e 6765 7428 276b 7562  terdata.get('kub
+00014b10: 6574 7970 6527 2c20 2767 656e 6572 6963  etype', 'generic
+00014b20: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00014b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b40: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
+00014b50: 7065 203d 3d20 2768 7970 6572 7368 6966  pe == 'hypershif
+00014b60: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+00014b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b80: 2020 2020 2020 2020 2020 2020 6879 7065              hype
+00014b90: 7273 6869 6674 203d 2054 7275 650a 2020  rshift = True.  
+00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bc0: 2020 2020 2020 6173 7369 7374 6564 203d        assisted =
+00014bd0: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
+00014be0: 2861 7373 6973 7465 642c 2046 616c 7365  (assisted, False
+00014bf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c10: 2020 2020 2020 646f 6d61 696e 203d 2063        domain = c
+00014c20: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+00014c30: 646f 6d61 696e 272c 2064 6f6d 6169 6e29  domain', domain)
+00014c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c60: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
+00014c70: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
+00014c80: 2827 646e 7363 6c69 656e 7427 290a 2020  ('dnsclient').  
+00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ca0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00014cb0: 2068 7970 6572 7368 6966 743a 0a20 2020   hypershift:.   
+00014cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cd0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00014ce0: 696e 7428 6622 4465 6c65 7469 6e67 2064  int(f"Deleting d
+00014cf0: 6972 6563 746f 7279 207b 636c 7573 7465  irectory {cluste
+00014d00: 7264 6972 7d22 290a 2020 2020 2020 2020  rdir}").        
+00014d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d20: 2020 2020 2020 2020 726d 7472 6565 2863          rmtree(c
+00014d30: 6c75 7374 6572 6469 722c 2069 676e 6f72  lusterdir, ignor
+00014d40: 655f 6572 726f 7273 3d54 7275 6529 0a20  e_errors=True). 
+00014d50: 2020 2020 2020 2069 6620 6879 7065 7273         if hypers
+00014d60: 6869 6674 3a0a 2020 2020 2020 2020 2020  hift:.          
+00014d70: 2020 6b75 6265 636f 6e66 6967 6d67 6d74    kubeconfigmgmt
+00014d80: 203d 2066 227b 636c 7573 7465 7264 6972   = f"{clusterdir
+00014d90: 7d2f 6b75 6265 636f 6e66 6967 2e6d 676d  }/kubeconfig.mgm
+00014da0: 7422 0a20 2020 2020 2020 2020 2020 2063  t".            c
+00014db0: 616c 6c28 6627 4b55 4245 434f 4e46 4947  all(f'KUBECONFIG
+00014dc0: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
+00014dd0: 7d20 6f63 2064 656c 6574 6520 2d66 207b  } oc delete -f {
+00014de0: 636c 7573 7465 7264 6972 7d2f 6175 746f  clusterdir}/auto
+00014df0: 6170 7072 6f76 6572 6372 6f6e 2e79 6d6c  approvercron.yml
+00014e00: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
+00014e10: 2020 2020 2020 2020 2020 2063 616c 6c28             call(
+00014e20: 6627 4b55 4245 434f 4e46 4947 3d7b 6b75  f'KUBECONFIG={ku
+00014e30: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
+00014e40: 2064 656c 6574 6520 2d66 207b 636c 7573   delete -f {clus
+00014e50: 7465 7264 6972 7d2f 6e6f 6465 706f 6f6c  terdir}/nodepool
+00014e60: 2e79 616d 6c27 2c20 7368 656c 6c3d 5472  .yaml', shell=Tr
+00014e70: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00014e80: 6361 6c6c 2866 274b 5542 4543 4f4e 4649  call(f'KUBECONFI
+00014e90: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
+00014ea0: 747d 206f 6320 6465 6c65 7465 202d 6620  t} oc delete -f 
+00014eb0: 7b63 6c75 7374 6572 6469 727d 2f68 6f73  {clusterdir}/hos
+00014ec0: 7465 6463 6c75 7374 6572 2e79 616d 6c27  tedcluster.yaml'
+00014ed0: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
+00014ee0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00014ef0: 2061 7373 6973 7465 6420 616e 6420 2827   assisted and ('
+00014f00: 6261 7265 6d65 7461 6c5f 6973 6f27 2069  baremetal_iso' i
+00014f10: 6e20 636c 7573 7465 7264 6174 6120 6f72  n clusterdata or
+00014f20: 2027 6261 7265 6d65 7461 6c5f 686f 7374   'baremetal_host
+00014f30: 7327 2069 6e20 636c 7573 7465 7264 6174  s' in clusterdat
+00014f40: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+00014f50: 2020 2020 6361 6c6c 2827 4b55 4245 434f      call('KUBECO
+00014f60: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
+00014f70: 6d67 6d74 7d20 6f63 202d 6e20 6465 6661  mgmt} oc -n defa
+00014f80: 756c 7420 6465 6c65 7465 2061 6c6c 202d  ult delete all -
+00014f90: 6c20 6170 703d 6874 7470 642d 6b63 6c69  l app=httpd-kcli
+00014fa0: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
+00014fb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00014fc0: 616c 6c28 274b 5542 4543 4f4e 4649 473d  all('KUBECONFIG=
+00014fd0: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
+00014fe0: 206f 6320 2d6e 2064 6566 6175 6c74 2064   oc -n default d
+00014ff0: 656c 6574 6520 7376 6320 6874 7470 642d  elete svc httpd-
+00015000: 6b63 6c69 2d73 7663 272c 2073 6865 6c6c  kcli-svc', shell
+00015010: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00015020: 2020 2020 2020 2063 616c 6c28 274b 5542         call('KUB
+00015030: 4543 4f4e 4649 473d 7b6b 7562 6563 6f6e  ECONFIG={kubecon
+00015040: 6669 676d 676d 747d 206f 6320 2d6e 2064  figmgmt} oc -n d
+00015050: 6566 6175 6c74 2064 656c 6574 6520 7076  efault delete pv
+00015060: 6320 6874 7470 642d 6b63 6c69 2d70 7663  c httpd-kcli-pvc
+00015070: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
+00015080: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00015090: 7428 6622 4465 6c65 7469 6e67 2064 6972  t(f"Deleting dir
+000150a0: 6563 746f 7279 207b 636c 7573 7465 7264  ectory {clusterd
+000150b0: 6972 7d22 290a 2020 2020 2020 2020 2020  ir}").          
+000150c0: 2020 726d 7472 6565 2863 6c75 7374 6572    rmtree(cluster
+000150d0: 6469 722c 2069 676e 6f72 655f 6572 726f  dir, ignore_erro
+000150e0: 7273 3d54 7275 6529 0a20 2020 2020 2020  rs=True).       
+000150f0: 2069 6620 636f 6e74 6169 6e65 723a 0a20   if container:. 
+00015100: 2020 2020 2020 2020 2020 2063 6f6e 7420             cont 
+00015110: 3d20 4b63 6f6e 7461 696e 6572 636f 6e66  = Kcontainerconf
+00015120: 6967 2873 656c 662c 2063 6c69 656e 743d  ig(self, client=
+00015130: 7365 6c66 2e63 6f6e 7461 696e 6572 636c  self.containercl
+00015140: 6965 6e74 292e 636f 6e74 0a20 2020 2020  ient).cont.     
+00015150: 2020 2020 2020 2066 6f72 2063 6f6e 7461         for conta
+00015160: 2069 6e20 736f 7274 6564 2863 6f6e 742e   in sorted(cont.
+00015170: 6c69 7374 5f63 6f6e 7461 696e 6572 7328  list_containers(
+00015180: 6b29 293a 0a20 2020 2020 2020 2020 2020  k)):.           
+00015190: 2020 2020 206e 616d 6520 3d20 636f 6e74       name = cont
+000151a0: 615b 305d 0a20 2020 2020 2020 2020 2020  a[0].           
+000151b0: 2020 2020 2063 6f6e 7461 696e 6572 5f70       container_p
+000151c0: 6c61 6e20 3d20 636f 6e74 615b 335d 0a20  lan = conta[3]. 
+000151d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000151e0: 6620 636f 6e74 6169 6e65 725f 706c 616e  f container_plan
+000151f0: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
+00015200: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00015210: 6e74 2e64 656c 6574 655f 636f 6e74 6169  nt.delete_contai
+00015220: 6e65 7228 6e61 6d65 290a 2020 2020 2020  ner(name).      
+00015230: 2020 2020 2020 2020 2020 2020 2020 7375                su
+00015240: 6363 6573 7328 6622 436f 6e74 6169 6e65  ccess(f"Containe
+00015250: 7220 7b6e 616d 657d 2064 656c 6574 6564  r {name} deleted
+00015260: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+00015270: 2020 2020 2020 2020 666f 756e 6420 3d20          found = 
+00015280: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
+00015290: 6e6f 7420 7365 6c66 2e6b 6565 705f 6e65  not self.keep_ne
+000152a0: 7477 6f72 6b73 3a0a 2020 2020 2020 2020  tworks:.        
+000152b0: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
+000152c0: 203d 3d20 276b 766d 273a 0a20 2020 2020   == 'kvm':.     
+000152d0: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
+000152e0: 726b 7320 3d20 6b2e 6c69 7374 5f6e 6574  rks = k.list_net
+000152f0: 776f 726b 7328 290a 2020 2020 2020 2020  works().        
+00015300: 2020 2020 2020 2020 666f 7220 6e65 7477          for netw
+00015310: 6f72 6b20 696e 206b 2e6c 6973 745f 6e65  ork in k.list_ne
+00015320: 7477 6f72 6b73 2829 3a0a 2020 2020 2020  tworks():.      
+00015330: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015340: 2027 706c 616e 2720 696e 206e 6574 776f   'plan' in netwo
+00015350: 726b 735b 6e65 7477 6f72 6b5d 2061 6e64  rks[network] and
+00015360: 206e 6574 776f 726b 735b 6e65 7477 6f72   networks[networ
+00015370: 6b5d 5b27 706c 616e 275d 203d 3d20 706c  k]['plan'] == pl
+00015380: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+00015390: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
+000153a0: 6f72 6b72 6573 756c 7420 3d20 6b2e 6465  orkresult = k.de
+000153b0: 6c65 7465 5f6e 6574 776f 726b 286e 6574  lete_network(net
+000153c0: 776f 726b 290a 2020 2020 2020 2020 2020  work).          
+000153d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000153e0: 206e 6574 776f 726b 7265 7375 6c74 5b27   networkresult['
+000153f0: 7265 7375 6c74 275d 203d 3d20 2773 7563  result'] == 'suc
+00015400: 6365 7373 273a 0a20 2020 2020 2020 2020  cess':.         
+00015410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015420: 2020 2073 7563 6365 7373 2866 226e 6574     success(f"net
+00015430: 776f 726b 207b 6e65 7477 6f72 6b7d 2064  work {network} d
+00015440: 656c 6574 6564 2122 290a 2020 2020 2020  eleted!").      
+00015450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015460: 2020 2020 2020 666f 756e 6420 3d20 5472        found = Tr
+00015470: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
+00015480: 6c69 6620 6e65 7477 6f72 6b73 3a0a 2020  lif networks:.  
+00015490: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000154a0: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
+000154b0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+000154c0: 6574 776f 726b 2069 6e20 6e65 7477 6f72  etwork in networ
+000154d0: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+000154e0: 2020 2020 2020 2020 6e65 7477 6f72 6b72          networkr
+000154f0: 6573 756c 7420 3d20 6b2e 6465 6c65 7465  esult = k.delete
+00015500: 5f6e 6574 776f 726b 286e 6574 776f 726b  _network(network
+00015510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015520: 2020 2020 2020 6966 206e 6574 776f 726b        if network
+00015530: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
+00015540: 203d 3d20 2773 7563 6365 7373 273a 0a20   == 'success':. 
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+00015570: 2255 6e75 7365 6420 6e65 7477 6f72 6b20  "Unused network 
+00015580: 7b6e 6574 776f 726b 7d20 6465 6c65 7465  {network} delete
+00015590: 6421 2229 0a20 2020 2020 2020 2066 6f72  d!").        for
+000155a0: 206b 6579 6669 6c65 2069 6e20 676c 6f62   keyfile in glob
+000155b0: 2e67 6c6f 6228 2225 732e 6b65 792a 2220  .glob("%s.key*" 
+000155c0: 2520 706c 616e 293a 0a20 2020 2020 2020  % plan):.       
+000155d0: 2020 2020 2073 7563 6365 7373 2866 2266       success(f"f
+000155e0: 696c 6520 7b6b 6579 6669 6c65 7d20 6672  ile {keyfile} fr
+000155f0: 6f6d 207b 706c 616e 7d20 6465 6c65 7465  om {plan} delete
+00015600: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
+00015610: 206f 732e 7265 6d6f 7665 286b 6579 6669   os.remove(keyfi
+00015620: 6c65 290a 2020 2020 2020 2020 666f 7220  le).        for 
+00015630: 616e 7369 626c 6566 696c 6520 696e 2067  ansiblefile in g
+00015640: 6c6f 622e 676c 6f62 2822 2f74 6d70 2f25  lob.glob("/tmp/%
+00015650: 732a 696e 762a 2220 2520 706c 616e 293a  s*inv*" % plan):
+00015660: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
+00015670: 6365 7373 2866 2266 696c 6520 7b61 6e73  cess(f"file {ans
+00015680: 6962 6c65 6669 6c65 7d20 6672 6f6d 207b  iblefile} from {
+00015690: 706c 616e 7d20 6465 6c65 7465 6421 2229  plan} deleted!")
+000156a0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+000156b0: 7265 6d6f 7665 2861 6e73 6962 6c65 6669  remove(ansiblefi
+000156c0: 6c65 290a 2020 2020 2020 2020 6966 2064  le).        if d
+000156d0: 656c 6574 6564 6c62 7320 616e 6420 7365  eletedlbs and se
+000156e0: 6c66 2e74 7970 6520 696e 205b 2761 7773  lf.type in ['aws
+000156f0: 272c 2027 6763 7027 5d3a 0a20 2020 2020  ', 'gcp']:.     
+00015700: 2020 2020 2020 2066 6f72 206c 6220 696e         for lb in
+00015710: 2064 656c 6574 6564 6c62 733a 0a20 2020   deletedlbs:.   
+00015720: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015730: 662e 6465 6c65 7465 5f6c 6f61 6462 616c  f.delete_loadbal
+00015740: 616e 6365 7228 6c62 290a 2020 2020 2020  ancer(lb).      
+00015750: 2020 6966 2066 6f75 6e64 3a0a 2020 2020    if found:.    
+00015760: 2020 2020 2020 2020 7375 6363 6573 7328          success(
+00015770: 6622 506c 616e 207b 706c 616e 7d20 6465  f"Plan {plan} de
+00015780: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
+00015790: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+000157a0: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+000157b0: 2c20 2764 656c 6574 6564 766d 273a 2064  , 'deletedvm': d
+000157c0: 656c 6574 6564 766d 737d 0a20 2020 2020  eletedvms}.     
+000157d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000157e0: 2020 2020 2065 7272 6f72 2866 224e 6f20       error(f"No 
+000157f0: 6f62 6a65 6374 7320 666f 756e 6420 6475  objects found du
+00015800: 7269 6e67 2064 656c 6574 696f 6e20 6f66  ring deletion of
+00015810: 2070 6c61 6e20 7b70 6c61 6e7d 2229 0a20   plan {plan}"). 
+00015820: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00015830: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00015840: 696c 7572 6527 7d0a 0a20 2020 2064 6566  ilure'}..    def
+00015850: 2073 6e61 7073 686f 745f 706c 616e 2873   snapshot_plan(s
+00015860: 656c 662c 2070 6c61 6e2c 2073 6e61 7073  elf, plan, snaps
+00015870: 686f 746e 616d 653d 4e6f 6e65 293a 0a20  hotname=None):. 
+00015880: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+00015890: 6b0a 2020 2020 2020 2020 736e 6170 7368  k.        snapsh
+000158a0: 6f74 666f 756e 6420 3d20 4661 6c73 650a  otfound = False.
+000158b0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+000158c0: 2253 6e61 7073 686f 7474 696e 6720 766d  "Snapshotting vm
+000158d0: 7320 6672 6f6d 2070 6c61 6e20 7b70 6c61  s from plan {pla
+000158e0: 6e7d 2229 0a20 2020 2020 2020 2069 6620  n}").        if 
+000158f0: 736e 6170 7368 6f74 6e61 6d65 2069 7320  snapshotname is 
+00015900: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00015910: 2020 7761 726e 696e 6728 6622 5573 696e    warning(f"Usin
+00015920: 6720 7b70 6c61 6e7d 2061 7320 736e 6170  g {plan} as snap
+00015930: 7368 6f74 206e 616d 6520 6173 204e 6f6e  shot name as Non
+00015940: 6520 7761 7320 7072 6f76 6964 6564 2229  e was provided")
+00015950: 0a20 2020 2020 2020 2020 2020 2073 6e61  .            sna
+00015960: 7073 686f 746e 616d 6520 3d20 706c 616e  pshotname = plan
+00015970: 0a20 2020 2020 2020 2066 6f72 2076 6d20  .        for vm 
+00015980: 696e 2073 6f72 7465 6428 6b2e 6c69 7374  in sorted(k.list
+00015990: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
+000159a0: 3a20 785b 276e 616d 6527 5d29 3a0a 2020  : x['name']):.  
+000159b0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+000159c0: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+000159d0: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+000159e0: 696f 6e20 3d20 766d 5b27 706c 616e 275d  ion = vm['plan']
+000159f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015a00: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
+00015a10: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
+00015a20: 2020 2020 2073 6e61 7073 686f 7466 6f75       snapshotfou
+00015a30: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+00015a40: 2020 2020 2020 2020 2020 6b2e 6372 6561            k.crea
+00015a50: 7465 5f73 6e61 7073 686f 7428 736e 6170  te_snapshot(snap
+00015a60: 7368 6f74 6e61 6d65 2c20 6e61 6d65 290a  shotname, name).
+00015a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a80: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
+00015a90: 2073 6e61 7073 686f 7474 6564 2122 290a   snapshotted!").
+00015aa0: 2020 2020 2020 2020 6966 2073 6e61 7073          if snaps
+00015ab0: 686f 7466 6f75 6e64 3a0a 2020 2020 2020  hotfound:.      
+00015ac0: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00015ad0: 506c 616e 207b 706c 616e 7d20 736e 6170  Plan {plan} snap
+00015ae0: 7368 6f74 7465 6421 2229 0a20 2020 2020  shotted!").     
+00015af0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00015b00: 2020 2020 2077 6172 6e69 6e67 2822 4e6f       warning("No
+00015b10: 206d 6174 6368 696e 6720 766d 7320 666f   matching vms fo
+00015b20: 756e 6422 290a 2020 2020 2020 2020 7265  und").        re
+00015b30: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00015b40: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
+00015b50: 6465 6620 7265 7665 7274 5f70 6c61 6e28  def revert_plan(
+00015b60: 7365 6c66 2c20 706c 616e 2c20 736e 6170  self, plan, snap
+00015b70: 7368 6f74 6e61 6d65 3d4e 6f6e 6529 3a0a  shotname=None):.
+00015b80: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+00015b90: 2e6b 0a20 2020 2020 2020 2072 6576 6572  .k.        rever
+00015ba0: 7466 6f75 6e64 203d 2046 616c 7365 0a20  tfound = False. 
+00015bb0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00015bc0: 5265 7665 7274 696e 6720 736e 6170 7368  Reverting snapsh
+00015bd0: 6f74 7320 6f66 2076 6d73 2066 726f 6d20  ots of vms from 
+00015be0: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
+00015bf0: 2020 2020 2020 6966 2073 6e61 7073 686f        if snapsho
+00015c00: 746e 616d 6520 6973 204e 6f6e 653a 0a20  tname is None:. 
+00015c10: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+00015c20: 6e67 2866 2255 7369 6e67 207b 706c 616e  ng(f"Using {plan
+00015c30: 7dc2 a061 7320 736e 6170 7368 6f74 206e  }..as snapshot n
+00015c40: 616d 6520 6173 204e 6f6e 6520 7761 7320  ame as None was 
+00015c50: 7072 6f76 6964 6564 2229 0a20 2020 2020  provided").     
+00015c60: 2020 2020 2020 2073 6e61 7073 686f 746e         snapshotn
+00015c70: 616d 6520 3d20 706c 616e 0a20 2020 2020  ame = plan.     
+00015c80: 2020 2066 6f72 2076 6d20 696e 2073 6f72     for vm in sor
+00015c90: 7465 6428 6b2e 6c69 7374 2829 2c20 6b65  ted(k.list(), ke
+00015ca0: 793d 6c61 6d62 6461 2078 3a20 785b 276e  y=lambda x: x['n
+00015cb0: 616d 6527 5d29 3a0a 2020 2020 2020 2020  ame']):.        
+00015cc0: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
+00015cd0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+00015ce0: 2020 6465 7363 7269 7074 696f 6e20 3d20    description = 
+00015cf0: 766d 5b27 706c 616e 275d 0a20 2020 2020  vm['plan'].     
+00015d00: 2020 2020 2020 2069 6620 6465 7363 7269         if descri
+00015d10: 7074 696f 6e20 3d3d 2070 6c61 6e3a 0a20  ption == plan:. 
+00015d20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00015d30: 6576 6572 7466 6f75 6e64 203d 2054 7275  evertfound = Tru
+00015d40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00015d50: 2020 6b2e 7265 7665 7274 5f73 6e61 7073    k.revert_snaps
+00015d60: 686f 7428 736e 6170 7368 6f74 6e61 6d65  hot(snapshotname
+00015d70: 2c20 6e61 6d65 290a 2020 2020 2020 2020  , name).        
+00015d80: 2020 2020 2020 2020 7375 6363 6573 7328          success(
+00015d90: 6622 736e 6170 7368 6f74 206f 6620 7b6e  f"snapshot of {n
+00015da0: 616d 657d 2072 6576 6572 7465 6421 2229  ame} reverted!")
+00015db0: 0a20 2020 2020 2020 2069 6620 7265 7665  .        if reve
+00015dc0: 7274 666f 756e 643a 0a20 2020 2020 2020  rtfound:.       
+00015dd0: 2020 2020 2073 7563 6365 7373 2866 2250       success(f"P
+00015de0: 6c61 6e20 7b70 6c61 6e7d 2072 6576 6572  lan {plan} rever
+00015df0: 7465 6420 7769 7468 2073 6e61 7073 686f  ted with snapsho
+00015e00: 7420 7b73 6e61 7073 686f 746e 616d 657d  t {snapshotname}
+00015e10: 2122 290a 2020 2020 2020 2020 656c 7365  !").        else
+00015e20: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+00015e30: 726e 696e 6728 224e 6f20 6d61 7463 6869  rning("No matchi
+00015e40: 6e67 2076 6d73 2066 6f75 6e64 2229 0a20  ng vms found"). 
+00015e50: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00015e60: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+00015e70: 7327 7d0a 0a20 2020 2064 6566 2070 6c61  s'}..    def pla
+00015e80: 6e28 7365 6c66 2c20 706c 616e 2c20 616e  n(self, plan, an
+00015e90: 7369 626c 653d 4661 6c73 652c 2075 726c  sible=False, url
+00015ea0: 3d4e 6f6e 652c 2070 6174 683d 4e6f 6e65  =None, path=None
+00015eb0: 2c20 636f 6e74 6169 6e65 723d 4661 6c73  , container=Fals
+00015ec0: 652c 2069 6e70 7574 6669 6c65 3d4e 6f6e  e, inputfile=Non
+00015ed0: 652c 2069 6e70 7574 7374 7269 6e67 3d4e  e, inputstring=N
+00015ee0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00015ef0: 2020 6f76 6572 7269 6465 733d 7b7d 2c20    overrides={}, 
+00015f00: 696e 666f 3d46 616c 7365 2c20 7570 6461  info=False, upda
+00015f10: 7465 3d46 616c 7365 2c20 656d 6265 6464  te=False, embedd
+00015f20: 6564 3d46 616c 7365 2c20 646f 776e 6c6f  ed=False, downlo
+00015f30: 6164 3d46 616c 7365 2c20 7175 6965 743d  ad=False, quiet=
+00015f40: 4661 6c73 652c 2064 6f63 3d46 616c 7365  False, doc=False
+00015f50: 2c0a 2020 2020 2020 2020 2020 2020 206f  ,.             o
+00015f60: 6e6c 7961 7373 6574 733d 4661 6c73 652c  nlyassets=False,
+00015f70: 2070 7265 3d54 7275 652c 2070 6f73 743d   pre=True, post=
+00015f80: 5472 7565 2c20 6578 636c 7564 6576 6d73  True, excludevms
+00015f90: 3d5b 5d2c 2062 6173 656d 6f64 653d 4661  =[], basemode=Fa
+00015fa0: 6c73 652c 2074 6872 6561 6465 643d 4661  lse, threaded=Fa
+00015fb0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00015fc0: 224d 616e 6167 6520 706c 616e 2066 696c  "Manage plan fil
+00015fd0: 6522 2222 0a20 2020 2020 2020 206b 203d  e""".        k =
+00015fe0: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
+00015ff0: 6e6f 5f6f 7665 7272 6964 6573 203d 206e  no_overrides = n
+00016000: 6f74 206f 7665 7272 6964 6573 0a20 2020  ot overrides.   
+00016010: 2020 2020 2074 6872 6561 6473 203d 205b       threads = [
+00016020: 5d0a 2020 2020 2020 2020 6e65 7776 6d73  ].        newvms
+00016030: 203d 205b 5d0a 2020 2020 2020 2020 6e65   = [].        ne
+00016040: 7761 7373 6574 7320 3d20 5b5d 0a20 2020  wassets = [].   
+00016050: 2020 2020 2066 6169 6c65 6476 6d73 203d       failedvms =
+00016060: 205b 5d0a 2020 2020 2020 2020 6578 6973   [].        exis
+00016070: 7469 6e67 766d 7320 3d20 5b5d 0a20 2020  tingvms = [].   
+00016080: 2020 2020 2061 7379 6e63 7761 6974 766d       asyncwaitvm
+00016090: 7320 3d20 5b5d 0a20 2020 2020 2020 206f  s = [].        o
+000160a0: 6e66 6c79 203d 204e 6f6e 650a 2020 2020  nfly = None.    
+000160b0: 2020 2020 746f 636c 6561 6e20 3d20 4661      toclean = Fa
+000160c0: 6c73 650a 2020 2020 2020 2020 6765 7462  lse.        getb
+000160d0: 6163 6b20 3d20 4661 6c73 650a 2020 2020  ack = False.    
+000160e0: 2020 2020 766d 7072 6f66 696c 6573 203d      vmprofiles =
+000160f0: 207b 6b65 793a 2076 616c 7565 2066 6f72   {key: value for
+00016100: 206b 6579 2c20 7661 6c75 6520 696e 2073   key, value in s
+00016110: 656c 662e 7072 6f66 696c 6573 2e69 7465  elf.profiles.ite
+00016120: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
+00016130: 2020 2020 2020 2020 2020 2069 6620 2774             if 't
+00016140: 7970 6527 206e 6f74 2069 6e20 7661 6c75  ype' not in valu
+00016150: 6520 6f72 2076 616c 7565 5b27 7479 7065  e or value['type
+00016160: 275d 203d 3d20 2776 6d27 7d0a 2020 2020  '] == 'vm'}.    
+00016170: 2020 2020 636f 6e74 6169 6e65 7270 726f      containerpro
+00016180: 6669 6c65 7320 3d20 7b6b 6579 3a20 7661  files = {key: va
+00016190: 6c75 6520 666f 7220 6b65 792c 2076 616c  lue for key, val
+000161a0: 7565 2069 6e20 7365 6c66 2e70 726f 6669  ue in self.profi
+000161b0: 6c65 732e 6974 656d 7328 290a 2020 2020  les.items().    
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161d0: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
+000161e0: 6527 2069 6e20 7661 6c75 6520 616e 6420  e' in value and 
+000161f0: 7661 6c75 655b 2774 7970 6527 5d20 3d3d  value['type'] ==
+00016200: 2027 636f 6e74 6169 6e65 7227 7d0a 2020   'container'}.  
+00016210: 2020 2020 2020 6966 2070 6c61 6e20 6973        if plan is
+00016220: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00016230: 2020 2070 6c61 6e20 3d20 6e61 6d65 7574     plan = nameut
+00016240: 696c 732e 6765 745f 7261 6e64 6f6d 5f6e  ils.get_random_n
+00016250: 616d 6528 290a 2020 2020 2020 2020 6966  ame().        if
+00016260: 2075 726c 2069 7320 6e6f 7420 4e6f 6e65   url is not None
+00016270: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00016280: 2075 726c 2e73 7461 7274 7377 6974 6828   url.startswith(
+00016290: 272f 2729 3a0a 2020 2020 2020 2020 2020  '/'):.          
+000162a0: 2020 2020 2020 7572 6c20 3d20 6622 6669        url = f"fi
+000162b0: 6c65 3a2f 2f7b 7572 6c7d 220a 2020 2020  le://{url}".    
+000162c0: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
+000162d0: 726c 2e65 6e64 7377 6974 6828 272e 796d  rl.endswith('.ym
+000162e0: 6c27 293a 0a20 2020 2020 2020 2020 2020  l'):.           
+000162f0: 2020 2020 2075 726c 203d 2066 227b 7572       url = f"{ur
+00016300: 6c7d 2f6b 636c 695f 706c 616e 2e79 6d6c  l}/kcli_plan.yml
+00016310: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00016320: 2020 7070 7269 6e74 2866 2254 7279 696e    pprint(f"Tryin
+00016330: 6720 746f 2072 6574 7269 6576 6520 7b75  g to retrieve {u
+00016340: 726c 7d22 290a 2020 2020 2020 2020 2020  rl}").          
+00016350: 2020 696e 7075 7466 696c 6520 3d20 6f73    inputfile = os
+00016360: 2e70 6174 682e 6261 7365 6e61 6d65 2875  .path.basename(u
+00016370: 726c 290a 2020 2020 2020 2020 2020 2020  rl).            
+00016380: 6f6e 666c 7920 3d20 6f73 2e70 6174 682e  onfly = os.path.
+00016390: 6469 726e 616d 6528 7572 6c29 0a20 2020  dirname(url).   
+000163a0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+000163b0: 706c 616e 2069 6620 7061 7468 2069 7320  plan if path is 
+000163c0: 4e6f 6e65 2065 6c73 6520 7061 7468 0a20  None else path. 
+000163d0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000163e0: 7420 7175 6965 743a 0a20 2020 2020 2020  t quiet:.       
+000163f0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00016400: 6622 5265 7472 6965 7669 6e67 2073 7065  f"Retrieving spe
+00016410: 6369 6669 6564 2070 6c61 6e20 6672 6f6d  cified plan from
+00016420: 207b 7572 6c7d 2074 6f20 7b70 6174 687d   {url} to {path}
+00016430: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+00016440: 6620 636f 6e74 6169 6e65 725f 6d6f 6465  f container_mode
+00016450: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00016460: 2020 2020 7061 7468 203d 2066 222f 776f      path = f"/wo
+00016470: 726b 6469 722f 7b70 6174 687d 220a 2020  rkdir/{path}".  
+00016480: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00016490: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000164a0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+000164b0: 2020 2020 2020 2074 6f63 6c65 616e 203d         toclean =
+000164c0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+000164d0: 2020 2020 2020 636f 6d6d 6f6e 2e66 6574        common.fet
+000164e0: 6368 2875 726c 2c20 7061 7468 290a 2020  ch(url, path).  
+000164f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00016500: 7220 6465 6661 756c 745f 7061 7261 6d65  r default_parame
+00016510: 7465 725f 6669 6c65 2069 6e20 5b27 2f6b  ter_file in ['/k
+00016520: 636c 695f 6465 6661 756c 742e 796d 6c27  cli_default.yml'
+00016530: 2c20 6627 2f7b 706c 616e 7d5f 6465 6661  , f'/{plan}_defa
+00016540: 756c 742e 796d 6c27 2c0a 2020 2020 2020  ult.yml',.      
+00016550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016570: 2020 2020 2020 2020 2022 2f25 735f 6465           "/%s_de
+00016580: 6661 756c 7425 7322 2025 206f 732e 7061  fault%s" % os.pa
+00016590: 7468 2e73 706c 6974 6578 7428 6f73 2e70  th.splitext(os.p
+000165a0: 6174 682e 6261 7365 6e61 6d65 2875 726c  ath.basename(url
+000165b0: 2929 5d3a 0a20 2020 2020 2020 2020 2020  ))]:.           
+000165c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165e0: 2020 2020 2020 636f 6d6d 6f6e 2e66 6574        common.fet
+000165f0: 6368 286f 732e 7061 7468 2e64 6972 6e61  ch(os.path.dirna
+00016600: 6d65 2875 726c 2920 2b20 6465 6661 756c  me(url) + defaul
+00016610: 745f 7061 7261 6d65 7465 725f 6669 6c65  t_parameter_file
+00016620: 2c20 7061 7468 290a 2020 2020 2020 2020  , path).        
+00016630: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00016640: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00016650: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00016660: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00016670: 6620 646f 776e 6c6f 6164 3a0a 2020 2020  f download:.    
+00016680: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+00016690: 3d20 6622 7461 7267 6574 2064 6972 6563  = f"target direc
+000166a0: 746f 7279 207b 7061 7468 7d20 616c 7265  tory {path} alre
+000166b0: 6164 7920 7468 6572 6522 0a20 2020 2020  ady there".     
+000166c0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+000166d0: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+000166e0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+000166f0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
+00016700: 272c 2027 7265 6173 6f6e 273a 206d 7367  ', 'reason': msg
+00016710: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
+00016720: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00016730: 2020 2020 7070 7269 6e74 2866 2255 7369      pprint(f"Usi
+00016740: 6e67 2065 7869 7374 696e 6720 6469 7265  ng existing dire
+00016750: 6374 6f72 7920 7b70 6174 687d 2229 0a20  ctory {path}"). 
+00016760: 2020 2020 2020 2020 2020 2069 6620 646f             if do
+00016770: 776e 6c6f 6164 3a0a 2020 2020 2020 2020  wnload:.        
+00016780: 2020 2020 2020 2020 696e 7075 7466 696c          inputfil
+00016790: 6520 3d20 6622 7b70 6174 687d 2f7b 696e  e = f"{path}/{in
+000167a0: 7075 7466 696c 657d 220a 2020 2020 2020  putfile}".      
+000167b0: 2020 2020 2020 2020 2020 656e 7472 6965            entrie
+000167c0: 732c 206f 7665 7272 6964 6573 2c20 6261  s, overrides, ba
+000167d0: 7365 6669 6c65 2c20 6261 7365 6469 7220  sefile, basedir 
+000167e0: 3d20 7365 6c66 2e70 726f 6365 7373 5f69  = self.process_i
+000167f0: 6e70 7574 6669 6c65 2870 6c61 6e2c 2069  nputfile(plan, i
+00016800: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
+00016810: 6465 733d 6f76 6572 7269 6465 732c 0a20  des=overrides,. 
+00016820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016840: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016880: 2020 2020 2020 2020 2020 2020 206f 6e66               onf
-00016890: 6c79 3d6f 6e66 6c79 2c20 6675 6c6c 3d54  ly=onfly, full=T
-000168a0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00016860: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+00016870: 666c 793d 6f6e 666c 792c 2066 756c 6c3d  fly=onfly, full=
+00016880: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00016890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000168b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000168c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168f0: 2020 2020 646f 776e 6c6f 6164 5f6d 6f64      download_mod
-00016900: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00016910: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
-00016920: 2870 6174 6829 0a20 2020 2020 2020 2020  (path).         
-00016930: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
-00016940: 2069 6e20 656e 7472 6965 733a 0a20 2020   in entries:.   
-00016950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016960: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
-00016970: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
-00016980: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
-00016990: 2774 7970 6527 5d20 213d 2027 766d 273a  'type'] != 'vm':
-000169a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000169b0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-000169c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000169d0: 2020 2020 2020 766d 656e 7472 7920 3d20        vmentry = 
-000169e0: 656e 7472 6965 735b 656e 7472 795d 0a20  entries[entry]. 
-000169f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a00: 2020 2076 6d66 696c 6573 203d 2076 6d65     vmfiles = vme
-00016a10: 6e74 7279 2e67 6574 2827 6669 6c65 7327  ntry.get('files'
-00016a20: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
-00016a30: 2020 2020 2020 2020 2020 7363 7269 7074            script
-00016a40: 6669 6c65 7320 3d20 766d 656e 7472 792e  files = vmentry.
-00016a50: 6765 7428 2773 6372 6970 7473 272c 205b  get('scripts', [
-00016a60: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00016a70: 2020 2020 2020 2066 6f72 2066 696c 2069         for fil i
-00016a80: 6e20 766d 6669 6c65 733a 0a20 2020 2020  n vmfiles:.     
-00016a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016aa0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00016ab0: 2866 696c 2c20 7374 7229 3a0a 2020 2020  (fil, str):.    
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ad0: 2020 2020 2020 2020 6f72 6967 696e 203d          origin =
-00016ae0: 2066 696c 0a20 2020 2020 2020 2020 2020   fil.           
-00016af0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00016b00: 6620 6973 696e 7374 616e 6365 2866 696c  f isinstance(fil
-00016b10: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 2020 2020 206f 7269 6769 6e20 3d20 6669       origin = fi
-00016b40: 6c2e 6765 7428 276f 7269 6769 6e27 290a  l.get('origin').
+000168d0: 2020 2020 2064 6f77 6e6c 6f61 645f 6d6f       download_mo
+000168e0: 6465 3d54 7275 6529 0a20 2020 2020 2020  de=True).       
+000168f0: 2020 2020 2020 2020 206f 732e 6368 6469           os.chdi
+00016900: 7228 7061 7468 290a 2020 2020 2020 2020  r(path).        
+00016910: 2020 2020 2020 2020 666f 7220 656e 7472          for entr
+00016920: 7920 696e 2065 6e74 7269 6573 3a0a 2020  y in entries:.  
+00016930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016940: 2020 6966 2027 7479 7065 2720 696e 2065    if 'type' in e
+00016950: 6e74 7269 6573 5b65 6e74 7279 5d20 616e  ntries[entry] an
+00016960: 6420 656e 7472 6965 735b 656e 7472 795d  d entries[entry]
+00016970: 5b27 7479 7065 275d 2021 3d20 2776 6d27  ['type'] != 'vm'
+00016980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016990: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+000169a0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+000169b0: 2020 2020 2020 2076 6d65 6e74 7279 203d         vmentry =
+000169c0: 2065 6e74 7269 6573 5b65 6e74 7279 5d0a   entries[entry].
+000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169e0: 2020 2020 766d 6669 6c65 7320 3d20 766d      vmfiles = vm
+000169f0: 656e 7472 792e 6765 7428 2766 696c 6573  entry.get('files
+00016a00: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
+00016a10: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
+00016a20: 7466 696c 6573 203d 2076 6d65 6e74 7279  tfiles = vmentry
+00016a30: 2e67 6574 2827 7363 7269 7074 7327 2c20  .get('scripts', 
+00016a40: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
+00016a50: 2020 2020 2020 2020 666f 7220 6669 6c20          for fil 
+00016a60: 696e 2076 6d66 696c 6573 3a0a 2020 2020  in vmfiles:.    
+00016a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a80: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00016a90: 6528 6669 6c2c 2073 7472 293a 0a20 2020  e(fil, str):.   
+00016aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ab0: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
+00016ac0: 3d20 6669 6c0a 2020 2020 2020 2020 2020  = fil.          
+00016ad0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00016ae0: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
+00016af0: 6c2c 2064 6963 7429 3a0a 2020 2020 2020  l, dict):.      
+00016b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b10: 2020 2020 2020 6f72 6967 696e 203d 2066        origin = f
+00016b20: 696c 2e67 6574 2827 6f72 6967 696e 2729  il.get('origin')
+00016b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00016b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00016b90: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00016ba0: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00016bb0: 2022 496e 636f 7272 6563 7420 6669 6c65   "Incorrect file
-00016bc0: 2065 6e74 7279 227d 0a20 2020 2020 2020   entry"}.       
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016be0: 2069 6620 277e 2720 6e6f 7420 696e 206f   if '~' not in o
-00016bf0: 7269 6769 6e3a 0a20 2020 2020 2020 2020  rigin:.         
-00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c10: 2020 2064 6573 7464 6972 203d 2022 2e22     destdir = "."
-00016c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016c40: 272f 2720 696e 206f 7269 6769 6e3a 0a20  '/' in origin:. 
-00016c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00016c70: 6573 7464 6972 203d 206f 732e 7061 7468  estdir = os.path
-00016c80: 2e64 6972 6e61 6d65 286f 7269 6769 6e29  .dirname(origin)
-00016c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cb0: 206f 732e 6d61 6b65 6469 7273 2864 6573   os.makedirs(des
-00016cc0: 7464 6972 2c20 6578 6973 745f 6f6b 3d54  tdir, exist_ok=T
-00016cd0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cf0: 2070 7072 696e 7428 6622 5265 7472 6965   pprint(f"Retrie
-00016d00: 7669 6e67 2066 696c 6520 7b6f 6e66 6c79  ving file {onfly
-00016d10: 7d2f 7b6f 7269 6769 6e7d 2229 0a20 2020  }/{origin}").   
+00016b60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016b70: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00016b80: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+00016b90: 3a20 2249 6e63 6f72 7265 6374 2066 696c  : "Incorrect fil
+00016ba0: 6520 656e 7472 7922 7d0a 2020 2020 2020  e entry"}.      
+00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bc0: 2020 6966 2027 7e27 206e 6f74 2069 6e20    if '~' not in 
+00016bd0: 6f72 6967 696e 3a0a 2020 2020 2020 2020  origin:.        
+00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bf0: 2020 2020 6465 7374 6469 7220 3d20 222e      destdir = ".
+00016c00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00016c10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016c20: 2027 2f27 2069 6e20 6f72 6967 696e 3a0a   '/' in origin:.
+00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c50: 6465 7374 6469 7220 3d20 6f73 2e70 6174  destdir = os.pat
+00016c60: 682e 6469 726e 616d 6528 6f72 6967 696e  h.dirname(origin
+00016c70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c90: 2020 6f73 2e6d 616b 6564 6972 7328 6465    os.makedirs(de
+00016ca0: 7374 6469 722c 2065 7869 7374 5f6f 6b3d  stdir, exist_ok=
+00016cb0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00016cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cd0: 2020 7070 7269 6e74 2866 2252 6574 7269    pprint(f"Retri
+00016ce0: 6576 696e 6720 6669 6c65 207b 6f6e 666c  eving file {onfl
+00016cf0: 797d 2f7b 6f72 6967 696e 7d22 290a 2020  y}/{origin}").  
+00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d10: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
 00016d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d30: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00016d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d50: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00016d60: 6d6d 6f6e 2e66 6574 6368 2866 227b 6f6e  mmon.fetch(f"{on
-00016d70: 666c 797d 2f7b 6f72 6967 696e 7d22 2c20  fly}/{origin}", 
-00016d80: 6465 7374 6469 7229 0a20 2020 2020 2020  destdir).       
+00016d30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00016d40: 6f6d 6d6f 6e2e 6665 7463 6828 6622 7b6f  ommon.fetch(f"{o
+00016d50: 6e66 6c79 7d2f 7b6f 7269 6769 6e7d 222c  nfly}/{origin}",
+00016d60: 2064 6573 7464 6972 290a 2020 2020 2020   destdir).      
+00016d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d80: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
 00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016da0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00016db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016dc0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016dd0: 636f 6d6d 6f6e 2e75 726c 5f65 7869 7374  common.url_exist
-00016de0: 7328 6622 7b6f 6e66 6c79 7d2f 7b6f 7269  s(f"{onfly}/{ori
-00016df0: 6769 6e7d 2f52 4541 444d 452e 6d64 2229  gin}/README.md")
-00016e00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e20: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-00016e30: 7328 6f72 6967 696e 2c20 6578 6973 745f  s(origin, exist_
-00016e40: 6f6b 3d54 7275 6529 0a20 2020 2020 2020  ok=True).       
+00016da0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016db0: 2063 6f6d 6d6f 6e2e 7572 6c5f 6578 6973   common.url_exis
+00016dc0: 7473 2866 227b 6f6e 666c 797d 2f7b 6f72  ts(f"{onfly}/{or
+00016dd0: 6967 696e 7d2f 5245 4144 4d45 2e6d 6422  igin}/README.md"
+00016de0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00016df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e00: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+00016e10: 7273 286f 7269 6769 6e2c 2065 7869 7374  rs(origin, exist
+00016e20: 5f6f 6b3d 5472 7565 290a 2020 2020 2020  _ok=True).      
+00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e90: 2020 2070 7072 696e 7428 6622 6669 6c65     pprint(f"file
-00016ea0: 207b 6f6e 666c 797d 2f7b 6f72 6967 696e   {onfly}/{origin
-00016eb0: 7d20 736b 6970 7065 6422 290a 2020 2020  } skipped").    
-00016ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ed0: 666f 7220 7363 7269 7074 2069 6e20 7363  for script in sc
-00016ee0: 7269 7074 6669 6c65 733a 0a20 2020 2020  riptfiles:.     
-00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f00: 2020 2069 6620 277e 2720 6e6f 7420 696e     if '~' not in
-00016f10: 2073 6372 6970 743a 0a20 2020 2020 2020   script:.       
-00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f30: 2020 2020 2064 6573 7464 6972 203d 2022       destdir = "
-00016f40: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00016f50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016f60: 6620 272f 2720 696e 2073 6372 6970 743a  f '/' in script:
-00016f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f90: 2064 6573 7464 6972 203d 206f 732e 7061   destdir = os.pa
-00016fa0: 7468 2e64 6972 6e61 6d65 2873 6372 6970  th.dirname(scrip
-00016fb0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fd0: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
-00016fe0: 6573 7464 6972 2c20 6578 6973 745f 6f6b  estdir, exist_ok
-00016ff0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00017000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017010: 2020 2070 7072 696e 7428 6622 5265 7472     pprint(f"Retr
-00017020: 6965 7669 6e67 2073 6372 6970 7420 7b6f  ieving script {o
-00017030: 6e66 6c79 7d2f 7b73 6372 6970 747d 2229  nfly}/{script}")
-00017040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017050: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00017060: 6d6f 6e2e 6665 7463 6828 6622 7b6f 6e66  mon.fetch(f"{onf
-00017070: 6c79 7d2f 7b73 6372 6970 747d 222c 2064  ly}/{script}", d
-00017080: 6573 7464 6972 290a 2020 2020 2020 2020  estdir).        
-00017090: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
-000170a0: 2827 2e2e 2729 0a20 2020 2020 2020 2020  ('..').         
-000170b0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-000170c0: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-000170d0: 7327 7d0a 2020 2020 2020 2020 6966 2069  s'}.        if i
-000170e0: 6e70 7574 7374 7269 6e67 2069 7320 6e6f  nputstring is no
-000170f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00017100: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
-00017110: 6622 7465 6d70 5f70 6c61 6e5f 7b70 6c61  f"temp_plan_{pla
-00017120: 6e7d 2e79 6d6c 220a 2020 2020 2020 2020  n}.yml".        
-00017130: 2020 2020 7769 7468 206f 7065 6e28 696e      with open(in
-00017140: 7075 7466 696c 652c 2022 7722 2920 6173  putfile, "w") as
-00017150: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00017160: 2020 2020 662e 7772 6974 6528 696e 7075      f.write(inpu
-00017170: 7473 7472 696e 6729 0a20 2020 2020 2020  tstring).       
-00017180: 2069 6620 696e 7075 7466 696c 6520 6973   if inputfile is
-00017190: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000171a0: 2020 2069 6e70 7574 6669 6c65 203d 2027     inputfile = '
-000171b0: 6b63 6c69 5f70 6c61 6e2e 796d 6c27 0a20  kcli_plan.yml'. 
-000171c0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-000171d0: 7428 2275 7369 6e67 2064 6566 6175 6c74  t("using default
-000171e0: 2069 6e70 7574 2066 696c 6520 6b63 6c69   input file kcli
-000171f0: 5f70 6c61 6e2e 796d 6c22 290a 2020 2020  _plan.yml").    
-00017200: 2020 2020 6966 2070 6174 6820 6973 206e      if path is n
-00017210: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00017220: 2020 2020 206f 732e 6368 6469 7228 7061       os.chdir(pa
-00017230: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-00017240: 6765 7462 6163 6b20 3d20 5472 7565 0a20  getback = True. 
-00017250: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
-00017260: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-00017270: 6475 7365 7228 696e 7075 7466 696c 6529  duser(inputfile)
-00017280: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00017290: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
-000172a0: 6e70 7574 6669 6c65 293a 0a20 2020 2020  nputfile):.     
-000172b0: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
-000172c0: 6e70 7574 2066 696c 6520 7b69 6e70 7574  nput file {input
-000172d0: 6669 6c65 7d20 6e6f 7420 666f 756e 642e  file} not found.
-000172e0: 4c65 6176 696e 672e 2e2e 2e22 290a 2020  Leaving....").  
-000172f0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00017300: 6974 2831 290a 2020 2020 2020 2020 656c  it(1).        el
-00017310: 6966 206f 732e 7061 7468 2e69 7364 6972  if os.path.isdir
-00017320: 2869 6e70 7574 6669 6c65 293a 0a20 2020  (inputfile):.   
-00017330: 2020 2020 2020 2020 2069 6e70 7574 6669           inputfi
-00017340: 6c65 203d 2066 227b 696e 7075 7466 696c  le = f"{inputfil
-00017350: 657d 2f6b 636c 695f 706c 616e 2e79 6d6c  e}/kcli_plan.yml
-00017360: 220a 2020 2020 2020 2020 6966 2069 6e66  ".        if inf
-00017370: 6f3a 0a20 2020 2020 2020 2020 2020 2073  o:.            s
-00017380: 656c 662e 696e 666f 5f70 6c61 6e28 696e  elf.info_plan(in
-00017390: 7075 7466 696c 652c 206f 6e66 6c79 3d6f  putfile, onfly=o
-000173a0: 6e66 6c79 2c20 7175 6965 743d 7175 6965  nfly, quiet=quie
-000173b0: 742c 2064 6f63 3d64 6f63 290a 2020 2020  t, doc=doc).    
-000173c0: 2020 2020 2020 2020 6966 2074 6f63 6c65          if tocle
-000173d0: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-000173e0: 2020 2020 6f73 2e63 6864 6972 2827 2e2e      os.chdir('..
-000173f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00017400: 2020 2072 6d74 7265 6528 7061 7468 290a     rmtree(path).
-00017410: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00017420: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
-00017430: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
-00017440: 2062 6173 6565 6e74 7269 6573 203d 207b   baseentries = {
-00017450: 7d0a 2020 2020 2020 2020 656e 7472 6965  }.        entrie
-00017460: 732c 206f 7665 7272 6964 6573 2c20 6261  s, overrides, ba
-00017470: 7365 6669 6c65 2c20 6261 7365 6469 7220  sefile, basedir 
-00017480: 3d20 7365 6c66 2e70 726f 6365 7373 5f69  = self.process_i
-00017490: 6e70 7574 6669 6c65 2870 6c61 6e2c 2069  nputfile(plan, i
-000174a0: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
-000174b0: 6465 733d 6f76 6572 7269 6465 732c 0a20  des=overrides,. 
+00016e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e70: 2020 2020 7070 7269 6e74 2866 2266 696c      pprint(f"fil
+00016e80: 6520 7b6f 6e66 6c79 7d2f 7b6f 7269 6769  e {onfly}/{origi
+00016e90: 6e7d 2073 6b69 7070 6564 2229 0a20 2020  n} skipped").   
+00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016eb0: 2066 6f72 2073 6372 6970 7420 696e 2073   for script in s
+00016ec0: 6372 6970 7466 696c 6573 3a0a 2020 2020  criptfiles:.    
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 2020 2020 6966 2027 7e27 206e 6f74 2069      if '~' not i
+00016ef0: 6e20 7363 7269 7074 3a0a 2020 2020 2020  n script:.      
+00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f10: 2020 2020 2020 6465 7374 6469 7220 3d20        destdir = 
+00016f20: 222e 220a 2020 2020 2020 2020 2020 2020  ".".            
+00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f40: 6966 2027 2f27 2069 6e20 7363 7269 7074  if '/' in script
+00016f50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f70: 2020 6465 7374 6469 7220 3d20 6f73 2e70    destdir = os.p
+00016f80: 6174 682e 6469 726e 616d 6528 7363 7269  ath.dirname(scri
+00016f90: 7074 290a 2020 2020 2020 2020 2020 2020  pt).            
+00016fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fb0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00016fc0: 6465 7374 6469 722c 2065 7869 7374 5f6f  destdir, exist_o
+00016fd0: 6b3d 5472 7565 290a 2020 2020 2020 2020  k=True).        
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ff0: 2020 2020 7070 7269 6e74 2866 2252 6574      pprint(f"Ret
+00017000: 7269 6576 696e 6720 7363 7269 7074 207b  rieving script {
+00017010: 6f6e 666c 797d 2f7b 7363 7269 7074 7d22  onfly}/{script}"
+00017020: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017030: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00017040: 6d6d 6f6e 2e66 6574 6368 2866 227b 6f6e  mmon.fetch(f"{on
+00017050: 666c 797d 2f7b 7363 7269 7074 7d22 2c20  fly}/{script}", 
+00017060: 6465 7374 6469 7229 0a20 2020 2020 2020  destdir).       
+00017070: 2020 2020 2020 2020 206f 732e 6368 6469           os.chdi
+00017080: 7228 272e 2e27 290a 2020 2020 2020 2020  r('..').        
+00017090: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+000170a0: 2772 6573 756c 7427 3a20 2773 7563 6365  'result': 'succe
+000170b0: 7373 277d 0a20 2020 2020 2020 2069 6620  ss'}.        if 
+000170c0: 696e 7075 7473 7472 696e 6720 6973 206e  inputstring is n
+000170d0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000170e0: 2020 2020 2069 6e70 7574 6669 6c65 203d       inputfile =
+000170f0: 2066 2274 656d 705f 706c 616e 5f7b 706c   f"temp_plan_{pl
+00017100: 616e 7d2e 796d 6c22 0a20 2020 2020 2020  an}.yml".       
+00017110: 2020 2020 2077 6974 6820 6f70 656e 2869       with open(i
+00017120: 6e70 7574 6669 6c65 2c20 2277 2229 2061  nputfile, "w") a
+00017130: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+00017140: 2020 2020 2066 2e77 7269 7465 2869 6e70       f.write(inp
+00017150: 7574 7374 7269 6e67 290a 2020 2020 2020  utstring).      
+00017160: 2020 6966 2069 6e70 7574 6669 6c65 2069    if inputfile i
+00017170: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00017180: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
+00017190: 276b 636c 695f 706c 616e 2e79 6d6c 270a  'kcli_plan.yml'.
+000171a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+000171b0: 6e74 2822 7573 696e 6720 6465 6661 756c  nt("using defaul
+000171c0: 7420 696e 7075 7420 6669 6c65 206b 636c  t input file kcl
+000171d0: 695f 706c 616e 2e79 6d6c 2229 0a20 2020  i_plan.yml").   
+000171e0: 2020 2020 2069 6620 7061 7468 2069 7320       if path is 
+000171f0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00017200: 2020 2020 2020 6f73 2e63 6864 6972 2870        os.chdir(p
+00017210: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
+00017220: 2067 6574 6261 636b 203d 2054 7275 650a   getback = True.
+00017230: 2020 2020 2020 2020 696e 7075 7466 696c          inputfil
+00017240: 6520 3d20 6f73 2e70 6174 682e 6578 7061  e = os.path.expa
+00017250: 6e64 7573 6572 2869 6e70 7574 6669 6c65  nduser(inputfile
+00017260: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00017270: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00017280: 696e 7075 7466 696c 6529 3a0a 2020 2020  inputfile):.    
+00017290: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+000172a0: 496e 7075 7420 6669 6c65 207b 696e 7075  Input file {inpu
+000172b0: 7466 696c 657d 206e 6f74 2066 6f75 6e64  tfile} not found
+000172c0: 2e4c 6561 7669 6e67 2e2e 2e2e 2229 0a20  .Leaving...."). 
+000172d0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+000172e0: 7869 7428 3129 0a20 2020 2020 2020 2065  xit(1).        e
+000172f0: 6c69 6620 6f73 2e70 6174 682e 6973 6469  lif os.path.isdi
+00017300: 7228 696e 7075 7466 696c 6529 3a0a 2020  r(inputfile):.  
+00017310: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
+00017320: 696c 6520 3d20 6622 7b69 6e70 7574 6669  ile = f"{inputfi
+00017330: 6c65 7d2f 6b63 6c69 5f70 6c61 6e2e 796d  le}/kcli_plan.ym
+00017340: 6c22 0a20 2020 2020 2020 2069 6620 696e  l".        if in
+00017350: 666f 3a0a 2020 2020 2020 2020 2020 2020  fo:.            
+00017360: 7365 6c66 2e69 6e66 6f5f 706c 616e 2869  self.info_plan(i
+00017370: 6e70 7574 6669 6c65 2c20 6f6e 666c 793d  nputfile, onfly=
+00017380: 6f6e 666c 792c 2071 7569 6574 3d71 7569  onfly, quiet=qui
+00017390: 6574 2c20 646f 633d 646f 6329 0a20 2020  et, doc=doc).   
+000173a0: 2020 2020 2020 2020 2069 6620 746f 636c           if tocl
+000173b0: 6561 6e3a 0a20 2020 2020 2020 2020 2020  ean:.           
+000173c0: 2020 2020 206f 732e 6368 6469 7228 272e       os.chdir('.
+000173d0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+000173e0: 2020 2020 726d 7472 6565 2870 6174 6829      rmtree(path)
+000173f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00017400: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00017410: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
+00017420: 2020 6261 7365 656e 7472 6965 7320 3d20    baseentries = 
+00017430: 7b7d 0a20 2020 2020 2020 2065 6e74 7269  {}.        entri
+00017440: 6573 2c20 6f76 6572 7269 6465 732c 2062  es, overrides, b
+00017450: 6173 6566 696c 652c 2062 6173 6564 6972  asefile, basedir
+00017460: 203d 2073 656c 662e 7072 6f63 6573 735f   = self.process_
+00017470: 696e 7075 7466 696c 6528 706c 616e 2c20  inputfile(plan, 
+00017480: 696e 7075 7466 696c 652c 206f 7665 7272  inputfile, overr
+00017490: 6964 6573 3d6f 7665 7272 6964 6573 2c0a  ides=overrides,.
+000174a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000174d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 2020 2020 2020 6f6e 666c 793d 6f6e 666c        onfly=onfl
-00017510: 792c 2066 756c 6c3d 5472 7565 290a 2020  y, full=True).  
-00017520: 2020 2020 2020 6966 2062 6173 6566 696c        if basefil
-00017530: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00017540: 2020 2020 2020 2020 2020 2062 6173 6569             basei
-00017550: 6e66 6f20 3d20 7365 6c66 2e70 726f 6365  nfo = self.proce
-00017560: 7373 5f69 6e70 7574 6669 6c65 2870 6c61  ss_inputfile(pla
-00017570: 6e2c 2066 227b 6261 7365 6469 727d 2f7b  n, f"{basedir}/{
-00017580: 6261 7365 6669 6c65 7d22 2c20 6f76 6572  basefile}", over
-00017590: 7269 6465 733d 6f76 6572 7269 6465 732c  rides=overrides,
-000175a0: 2066 756c 6c3d 5472 7565 290a 2020 2020   full=True).    
-000175b0: 2020 2020 2020 2020 6261 7365 656e 7472          baseentr
-000175c0: 6965 732c 2062 6173 656f 7665 7272 6964  ies, baseoverrid
-000175d0: 6573 203d 2062 6173 6569 6e66 6f5b 305d  es = baseinfo[0]
-000175e0: 2c20 6261 7365 696e 666f 5b31 5d0a 2020  , baseinfo[1].  
-000175f0: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
-00017600: 656f 7665 7272 6964 6573 3a0a 2020 2020  eoverrides:.    
-00017610: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-00017620: 7269 6465 732e 7570 6461 7465 287b 6b65  rides.update({ke
-00017630: 793a 2062 6173 656f 7665 7272 6964 6573  y: baseoverrides
-00017640: 5b6b 6579 5d20 666f 7220 6b65 7920 696e  [key] for key in
-00017650: 2062 6173 656f 7665 7272 6964 6573 2069   baseoverrides i
-00017660: 6620 6b65 7920 6e6f 7420 696e 206f 7665  f key not in ove
-00017670: 7272 6964 6573 7d29 0a20 2020 2020 2020  rrides}).       
-00017680: 2069 6620 656e 7472 6965 7320 6973 204e   if entries is N
-00017690: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000176a0: 2065 6e74 7269 6573 203d 207b 7d0a 2020   entries = {}.  
-000176b0: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-000176c0: 6275 673a 0a20 2020 2020 2020 2020 2020  bug:.           
-000176d0: 2070 7269 6e74 2879 616d 6c2e 6475 6d70   print(yaml.dump
-000176e0: 2865 6e74 7269 6573 2929 0a20 2020 2020  (entries)).     
-000176f0: 2020 2070 6172 616d 6574 6572 7320 3d20     parameters = 
-00017700: 656e 7472 6965 732e 6765 7428 2770 6172  entries.get('par
-00017710: 616d 6574 6572 7327 290a 2020 2020 2020  ameters').      
-00017720: 2020 6966 2070 6172 616d 6574 6572 7320    if parameters 
-00017730: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00017740: 2020 2020 2020 2020 2064 656c 2065 6e74           del ent
-00017750: 7269 6573 5b27 7061 7261 6d65 7465 7273  ries['parameters
-00017760: 275d 0a20 2020 2020 2020 2064 6963 745f  '].        dict_
-00017770: 7479 7065 7320 3d20 5b65 6e74 7279 2066  types = [entry f
-00017780: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-00017790: 6965 7320 6966 2069 7369 6e73 7461 6e63  ies if isinstanc
-000177a0: 6528 656e 7472 6965 735b 656e 7472 795d  e(entries[entry]
-000177b0: 2c20 6469 6374 295d 0a20 2020 2020 2020  , dict)].       
-000177c0: 2069 6620 6e6f 7420 6469 6374 5f74 7970   if not dict_typ
-000177d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000177e0: 6966 2062 6173 656d 6f64 653a 0a20 2020  if basemode:.   
-000177f0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00017800: 6e69 6e67 2866 227b 696e 7075 7466 696c  ning(f"{inputfil
-00017810: 657d 2064 6f65 736e 2774 206c 6f6f 6b20  e} doesn't look 
-00017820: 6c69 6b65 2061 2076 616c 6964 2070 6c61  like a valid pla
-00017830: 6e2e 536b 6970 7069 6e67 2e2e 2e2e 2229  n.Skipping....")
-00017840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017850: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00017860: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00017870: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-00017880: 6622 7b69 6e70 7574 6669 6c65 7d20 646f  f"{inputfile} do
-00017890: 6573 6e27 7420 6c6f 6f6b 206c 696b 6520  esn't look like 
-000178a0: 6120 7661 6c69 6420 706c 616e 2066 696c  a valid plan fil
-000178b0: 652e 204d 6179 6265 2079 6f75 2070 726f  e. Maybe you pro
-000178c0: 7669 6465 6420 6120 7061 7261 6d65 7465  vided a paramete
-000178d0: 7220 6669 6c65 203f 220a 2020 2020 2020  r file ?".      
-000178e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000178f0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00017900: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00017910: 206d 7367 7d0a 2020 2020 2020 2020 696e   msg}.        in
-00017920: 7075 7464 6972 203d 206f 732e 7061 7468  putdir = os.path
-00017930: 2e64 6972 6e61 6d65 2869 6e70 7574 6669  .dirname(inputfi
-00017940: 6c65 2920 6966 206f 732e 7061 7468 2e64  le) if os.path.d
-00017950: 6972 6e61 6d65 2869 6e70 7574 6669 6c65  irname(inputfile
-00017960: 2920 213d 2027 2720 616e 6420 6f73 2e70  ) != '' and os.p
-00017970: 6174 682e 6973 6162 7328 696e 7075 7466  ath.isabs(inputf
-00017980: 696c 6529 2065 6c73 6520 272e 270a 2020  ile) else '.'.  
-00017990: 2020 2020 2020 7072 655f 6261 7365 203d        pre_base =
-000179a0: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-000179b0: 7428 6f73 2e70 6174 682e 6261 7365 6e61  t(os.path.basena
-000179c0: 6d65 2869 6e70 7574 6669 6c65 2929 5b30  me(inputfile))[0
-000179d0: 5d0a 2020 2020 2020 2020 7072 655f 7363  ].        pre_sc
-000179e0: 7269 7074 203d 2066 277b 696e 7075 7464  ript = f'{inputd
-000179f0: 6972 7d2f 6b63 6c69 5f70 7265 2e73 6827  ir}/kcli_pre.sh'
-00017a00: 2069 6620 7072 655f 6261 7365 203d 3d20   if pre_base == 
-00017a10: 276b 636c 695f 706c 616e 2720 656c 7365  'kcli_plan' else
-00017a20: 2066 227b 696e 7075 7464 6972 7d2f 7b70   f"{inputdir}/{p
-00017a30: 7265 5f62 6173 657d 5f70 7265 2e73 6822  re_base}_pre.sh"
-00017a40: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00017a50: 6174 682e 6578 6973 7473 2870 7265 5f73  ath.exists(pre_s
-00017a60: 6372 6970 7429 3a0a 2020 2020 2020 2020  cript):.        
-00017a70: 2020 2020 7072 655f 7363 7269 7074 5f73      pre_script_s
-00017a80: 686f 7274 203d 206f 732e 7061 7468 2e62  hort = os.path.b
-00017a90: 6173 656e 616d 6528 7072 655f 7363 7269  asename(pre_scri
-00017aa0: 7074 290a 2020 2020 2020 2020 2020 2020  pt).            
-00017ab0: 6966 2070 7265 3a0a 2020 2020 2020 2020  if pre:.        
-00017ac0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00017ad0: 2252 756e 6e69 6e67 207b 7072 655f 7363  "Running {pre_sc
-00017ae0: 7269 7074 5f73 686f 7274 7d22 290a 2020  ript_short}").  
-00017af0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-00017b00: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
-00017b10: 6374 6f72 7928 2920 6173 2074 6d70 6469  ctory() as tmpdi
-00017b20: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00017b30: 2020 2020 2020 2070 7265 5f73 6372 6970         pre_scrip
-00017b40: 7420 3d20 7365 6c66 2e70 726f 6365 7373  t = self.process
-00017b50: 5f69 6e70 7574 6669 6c65 2827 7878 7827  _inputfile('xxx'
-00017b60: 2c20 7072 655f 7363 7269 7074 2c20 6f76  , pre_script, ov
-00017b70: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00017b80: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00017b90: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-00017ba0: 2866 227b 746d 7064 6972 7d2f 7072 652e  (f"{tmpdir}/pre.
-00017bb0: 7368 222c 2027 7727 2920 6173 2066 3a0a  sh", 'w') as f:.
-00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017bd0: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-00017be0: 7072 655f 7363 7269 7074 290a 2020 2020  pre_script).    
-00017bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c00: 7072 655f 7275 6e20 3d20 7275 6e28 6627  pre_run = run(f'
-00017c10: 6261 7368 207b 746d 7064 6972 7d2f 7072  bash {tmpdir}/pr
-00017c20: 652e 7368 272c 2073 6865 6c6c 3d54 7275  e.sh', shell=Tru
-00017c30: 652c 2073 7464 6f75 743d 5049 5045 2c20  e, stdout=PIPE, 
-00017c40: 7374 6465 7272 3d53 5444 4f55 542c 0a20  stderr=STDOUT,. 
-00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2075 6e69 7665 7273 616c 5f6e 6577 6c69   universal_newli
-00017c80: 6e65 733d 5472 7565 290a 2020 2020 2020  nes=True).      
-00017c90: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00017ca0: 2070 7265 5f72 756e 2e72 6574 7572 6e63   pre_run.returnc
-00017cb0: 6f64 6520 213d 2030 3a0a 2020 2020 2020  ode != 0:.      
-00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cd0: 2020 6d73 6720 3d20 6622 4973 7375 6520    msg = f"Issue 
-00017ce0: 7768 656e 2072 756e 6e69 6e67 207b 7072  when running {pr
-00017cf0: 655f 7363 7269 7074 5f73 686f 7274 7d20  e_script_short} 
-00017d00: 3a5c 6e7b 7072 655f 7275 6e2e 7374 646f  :\n{pre_run.stdo
-00017d10: 7574 7d22 0a20 2020 2020 2020 2020 2020  ut}".           
-00017d20: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00017d30: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
-00017d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d50: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00017d60: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-00017d70: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
-00017d80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00017d90: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00017da0: 726e 696e 6728 6622 536b 6970 7069 6e67  rning(f"Skipping
-00017db0: 207b 7072 655f 7363 7269 7074 5f73 686f   {pre_script_sho
-00017dc0: 7274 7d20 6173 2072 6571 7565 7374 6564  rt} as requested
-00017dd0: 2229 0a20 2020 2020 2020 206b 6579 776f  ").        keywo
-00017de0: 7264 7320 3d20 7365 6c66 2e6c 6973 745f  rds = self.list_
-00017df0: 6b65 7977 6f72 6473 2829 0a20 2020 2020  keywords().     
-00017e00: 2020 2066 6f72 206b 6579 2069 6e20 736f     for key in so
-00017e10: 7274 6564 286f 7665 7272 6964 6573 293a  rted(overrides):
-00017e20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017e30: 6b65 7920 696e 206b 6579 776f 7264 733a  key in keywords:
-00017e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017e50: 206b 6579 5f76 616c 7565 203d 2067 6574   key_value = get
-00017e60: 6174 7472 2873 656c 662c 206b 6579 290a  attr(self, key).
-00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e80: 6b65 795f 7479 7065 203d 2074 7970 6528  key_type = type(
-00017e90: 6b65 795f 7661 6c75 6529 0a20 2020 2020  key_value).     
-00017ea0: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-00017eb0: 6964 655f 6b65 795f 7479 7065 203d 2074  ide_key_type = t
-00017ec0: 7970 6528 6f76 6572 7269 6465 735b 6b65  ype(overrides[ke
-00017ed0: 795d 290a 2020 2020 2020 2020 2020 2020  y]).            
-00017ee0: 2020 2020 6966 206b 6579 5f76 616c 7565      if key_value
+000174e0: 2020 2020 2020 206f 6e66 6c79 3d6f 6e66         onfly=onf
+000174f0: 6c79 2c20 6675 6c6c 3d54 7275 6529 0a20  ly, full=True). 
+00017500: 2020 2020 2020 2069 6620 6261 7365 6669         if basefi
+00017510: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  le is not None:.
+00017520: 2020 2020 2020 2020 2020 2020 6261 7365              base
+00017530: 696e 666f 203d 2073 656c 662e 7072 6f63  info = self.proc
+00017540: 6573 735f 696e 7075 7466 696c 6528 706c  ess_inputfile(pl
+00017550: 616e 2c20 6622 7b62 6173 6564 6972 7d2f  an, f"{basedir}/
+00017560: 7b62 6173 6566 696c 657d 222c 206f 7665  {basefile}", ove
+00017570: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00017580: 2c20 6675 6c6c 3d54 7275 6529 0a20 2020  , full=True).   
+00017590: 2020 2020 2020 2020 2062 6173 6565 6e74           baseent
+000175a0: 7269 6573 2c20 6261 7365 6f76 6572 7269  ries, baseoverri
+000175b0: 6465 7320 3d20 6261 7365 696e 666f 5b30  des = baseinfo[0
+000175c0: 5d2c 2062 6173 6569 6e66 6f5b 315d 0a20  ], baseinfo[1]. 
+000175d0: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
+000175e0: 7365 6f76 6572 7269 6465 733a 0a20 2020  seoverrides:.   
+000175f0: 2020 2020 2020 2020 2020 2020 206f 7665               ove
+00017600: 7272 6964 6573 2e75 7064 6174 6528 7b6b  rrides.update({k
+00017610: 6579 3a20 6261 7365 6f76 6572 7269 6465  ey: baseoverride
+00017620: 735b 6b65 795d 2066 6f72 206b 6579 2069  s[key] for key i
+00017630: 6e20 6261 7365 6f76 6572 7269 6465 7320  n baseoverrides 
+00017640: 6966 206b 6579 206e 6f74 2069 6e20 6f76  if key not in ov
+00017650: 6572 7269 6465 737d 290a 2020 2020 2020  errides}).      
+00017660: 2020 6966 2065 6e74 7269 6573 2069 7320    if entries is 
+00017670: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00017680: 2020 656e 7472 6965 7320 3d20 7b7d 0a20    entries = {}. 
+00017690: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+000176a0: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
+000176b0: 2020 7072 696e 7428 7961 6d6c 2e64 756d    print(yaml.dum
+000176c0: 7028 656e 7472 6965 7329 290a 2020 2020  p(entries)).    
+000176d0: 2020 2020 7061 7261 6d65 7465 7273 203d      parameters =
+000176e0: 2065 6e74 7269 6573 2e67 6574 2827 7061   entries.get('pa
+000176f0: 7261 6d65 7465 7273 2729 0a20 2020 2020  rameters').     
+00017700: 2020 2069 6620 7061 7261 6d65 7465 7273     if parameters
+00017710: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00017720: 2020 2020 2020 2020 2020 6465 6c20 656e            del en
+00017730: 7472 6965 735b 2770 6172 616d 6574 6572  tries['parameter
+00017740: 7327 5d0a 2020 2020 2020 2020 6469 6374  s'].        dict
+00017750: 5f74 7970 6573 203d 205b 656e 7472 7920  _types = [entry 
+00017760: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
+00017770: 7269 6573 2069 6620 6973 696e 7374 616e  ries if isinstan
+00017780: 6365 2865 6e74 7269 6573 5b65 6e74 7279  ce(entries[entry
+00017790: 5d2c 2064 6963 7429 5d0a 2020 2020 2020  ], dict)].      
+000177a0: 2020 6966 206e 6f74 2064 6963 745f 7479    if not dict_ty
+000177b0: 7065 733a 0a20 2020 2020 2020 2020 2020  pes:.           
+000177c0: 2069 6620 6261 7365 6d6f 6465 3a0a 2020   if basemode:.  
+000177d0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+000177e0: 726e 696e 6728 6622 7b69 6e70 7574 6669  rning(f"{inputfi
+000177f0: 6c65 7d20 646f 6573 6e27 7420 6c6f 6f6b  le} doesn't look
+00017800: 206c 696b 6520 6120 7661 6c69 6420 706c   like a valid pl
+00017810: 616e 2e53 6b69 7070 696e 672e 2e2e 2e22  an.Skipping...."
+00017820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017830: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00017840: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00017850: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+00017860: 2066 227b 696e 7075 7466 696c 657d 2064   f"{inputfile} d
+00017870: 6f65 736e 2774 206c 6f6f 6b20 6c69 6b65  oesn't look like
+00017880: 2061 2076 616c 6964 2070 6c61 6e20 6669   a valid plan fi
+00017890: 6c65 2e20 4d61 7962 6520 796f 7520 7072  le. Maybe you pr
+000178a0: 6f76 6964 6564 2061 2070 6172 616d 6574  ovided a paramet
+000178b0: 6572 2066 696c 6520 3f22 0a20 2020 2020  er file ?".     
+000178c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000178d0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+000178e0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+000178f0: 3a20 6d73 677d 0a20 2020 2020 2020 2069  : msg}.        i
+00017900: 6e70 7574 6469 7220 3d20 6f73 2e70 6174  nputdir = os.pat
+00017910: 682e 6469 726e 616d 6528 696e 7075 7466  h.dirname(inputf
+00017920: 696c 6529 2069 6620 6f73 2e70 6174 682e  ile) if os.path.
+00017930: 6469 726e 616d 6528 696e 7075 7466 696c  dirname(inputfil
+00017940: 6529 2021 3d20 2727 2061 6e64 206f 732e  e) != '' and os.
+00017950: 7061 7468 2e69 7361 6273 2869 6e70 7574  path.isabs(input
+00017960: 6669 6c65 2920 656c 7365 2027 2e27 0a20  file) else '.'. 
+00017970: 2020 2020 2020 2070 7265 5f62 6173 6520         pre_base 
+00017980: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
+00017990: 7874 286f 732e 7061 7468 2e62 6173 656e  xt(os.path.basen
+000179a0: 616d 6528 696e 7075 7466 696c 6529 295b  ame(inputfile))[
+000179b0: 305d 0a20 2020 2020 2020 2070 7265 5f73  0].        pre_s
+000179c0: 6372 6970 7420 3d20 6627 7b69 6e70 7574  cript = f'{input
+000179d0: 6469 727d 2f6b 636c 695f 7072 652e 7368  dir}/kcli_pre.sh
+000179e0: 2720 6966 2070 7265 5f62 6173 6520 3d3d  ' if pre_base ==
+000179f0: 2027 6b63 6c69 5f70 6c61 6e27 2065 6c73   'kcli_plan' els
+00017a00: 6520 6622 7b69 6e70 7574 6469 727d 2f7b  e f"{inputdir}/{
+00017a10: 7072 655f 6261 7365 7d5f 7072 652e 7368  pre_base}_pre.sh
+00017a20: 220a 2020 2020 2020 2020 6966 206f 732e  ".        if os.
+00017a30: 7061 7468 2e65 7869 7374 7328 7072 655f  path.exists(pre_
+00017a40: 7363 7269 7074 293a 0a20 2020 2020 2020  script):.       
+00017a50: 2020 2020 2070 7265 5f73 6372 6970 745f       pre_script_
+00017a60: 7368 6f72 7420 3d20 6f73 2e70 6174 682e  short = os.path.
+00017a70: 6261 7365 6e61 6d65 2870 7265 5f73 6372  basename(pre_scr
+00017a80: 6970 7429 0a20 2020 2020 2020 2020 2020  ipt).           
+00017a90: 2069 6620 7072 653a 0a20 2020 2020 2020   if pre:.       
+00017aa0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00017ab0: 6622 5275 6e6e 696e 6720 7b70 7265 5f73  f"Running {pre_s
+00017ac0: 6372 6970 745f 7368 6f72 747d 2229 0a20  cript_short}"). 
+00017ad0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00017ae0: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+00017af0: 6563 746f 7279 2829 2061 7320 746d 7064  ectory() as tmpd
+00017b00: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+00017b10: 2020 2020 2020 2020 7072 655f 7363 7269          pre_scri
+00017b20: 7074 203d 2073 656c 662e 7072 6f63 6573  pt = self.proces
+00017b30: 735f 696e 7075 7466 696c 6528 2778 7878  s_inputfile('xxx
+00017b40: 272c 2070 7265 5f73 6372 6970 742c 206f  ', pre_script, o
+00017b50: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00017b60: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00017b70: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+00017b80: 6e28 6622 7b74 6d70 6469 727d 2f70 7265  n(f"{tmpdir}/pre
+00017b90: 2e73 6822 2c20 2777 2729 2061 7320 663a  .sh", 'w') as f:
+00017ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017bb0: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+00017bc0: 2870 7265 5f73 6372 6970 7429 0a20 2020  (pre_script).   
+00017bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017be0: 2070 7265 5f72 756e 203d 2072 756e 2866   pre_run = run(f
+00017bf0: 2762 6173 6820 7b74 6d70 6469 727d 2f70  'bash {tmpdir}/p
+00017c00: 7265 2e73 6827 2c20 7368 656c 6c3d 5472  re.sh', shell=Tr
+00017c10: 7565 2c20 7374 646f 7574 3d50 4950 452c  ue, stdout=PIPE,
+00017c20: 2073 7464 6572 723d 5354 444f 5554 2c0a   stderr=STDOUT,.
+00017c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c50: 2020 756e 6976 6572 7361 6c5f 6e65 776c    universal_newl
+00017c60: 696e 6573 3d54 7275 6529 0a20 2020 2020  ines=True).     
+00017c70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017c80: 6620 7072 655f 7275 6e2e 7265 7475 726e  f pre_run.return
+00017c90: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
+00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cb0: 2020 206d 7367 203d 2066 2249 7373 7565     msg = f"Issue
+00017cc0: 2077 6865 6e20 7275 6e6e 696e 6720 7b70   when running {p
+00017cd0: 7265 5f73 6372 6970 745f 7368 6f72 747d  re_script_short}
+00017ce0: 203a 5c6e 7b70 7265 5f72 756e 2e73 7464   :\n{pre_run.std
+00017cf0: 6f75 747d 220a 2020 2020 2020 2020 2020  out}".          
+00017d00: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00017d10: 726f 7228 6d73 6729 0a20 2020 2020 2020  ror(msg).       
+00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d30: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00017d40: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+00017d50: 6561 736f 6e27 3a20 6d73 677d 0a20 2020  eason': msg}.   
+00017d60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00017d70: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00017d80: 6172 6e69 6e67 2866 2253 6b69 7070 696e  arning(f"Skippin
+00017d90: 6720 7b70 7265 5f73 6372 6970 745f 7368  g {pre_script_sh
+00017da0: 6f72 747d 2061 7320 7265 7175 6573 7465  ort} as requeste
+00017db0: 6422 290a 2020 2020 2020 2020 6b65 7977  d").        keyw
+00017dc0: 6f72 6473 203d 2073 656c 662e 6c69 7374  ords = self.list
+00017dd0: 5f6b 6579 776f 7264 7328 290a 2020 2020  _keywords().    
+00017de0: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
+00017df0: 6f72 7465 6428 6f76 6572 7269 6465 7329  orted(overrides)
+00017e00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00017e10: 206b 6579 2069 6e20 6b65 7977 6f72 6473   key in keywords
+00017e20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017e30: 2020 6b65 795f 7661 6c75 6520 3d20 6765    key_value = ge
+00017e40: 7461 7474 7228 7365 6c66 2c20 6b65 7929  tattr(self, key)
+00017e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017e60: 206b 6579 5f74 7970 6520 3d20 7479 7065   key_type = type
+00017e70: 286b 6579 5f76 616c 7565 290a 2020 2020  (key_value).    
+00017e80: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00017e90: 7269 6465 5f6b 6579 5f74 7970 6520 3d20  ride_key_type = 
+00017ea0: 7479 7065 286f 7665 7272 6964 6573 5b6b  type(overrides[k
+00017eb0: 6579 5d29 0a20 2020 2020 2020 2020 2020  ey]).           
+00017ec0: 2020 2020 2069 6620 6b65 795f 7661 6c75       if key_valu
+00017ed0: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+00017ee0: 6420 6f76 6572 7269 6465 735b 6b65 795d  d overrides[key]
 00017ef0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00017f00: 206f 7665 7272 6964 6573 5b6b 6579 5d20   overrides[key] 
-00017f10: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00017f20: 6b65 795f 7479 7065 2021 3d20 6f76 6572  key_type != over
-00017f30: 7269 6465 5f6b 6579 5f74 7970 653a 0a20  ride_key_type:. 
-00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f50: 2020 2065 7272 6f72 2866 2254 6865 2070     error(f"The p
-00017f60: 726f 7669 6465 6420 7061 7261 6d65 7465  rovided paramete
-00017f70: 7220 7b6b 6579 7d20 6861 7320 6120 7772  r {key} has a wr
-00017f80: 6f6e 6720 7479 7065 207b 6f76 6572 7269  ong type {overri
-00017f90: 6465 5f6b 6579 5f74 7970 657d 2c20 6974  de_key_type}, it
-00017fa0: 2073 686f 756c 6420 6265 207b 6b65 795f   should be {key_
-00017fb0: 7479 7065 7d22 290a 2020 2020 2020 2020  type}").        
-00017fc0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00017fd0: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00017fe0: 2020 2020 2020 2020 656c 6966 206f 7665          elif ove
-00017ff0: 7272 6964 6573 5b6b 6579 5d20 6973 206e  rrides[key] is n
-00018000: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00018010: 2020 2020 2020 2020 2020 2020 2073 6574               set
-00018020: 6174 7472 2873 656c 662c 206b 6579 2c20  attr(self, key, 
-00018030: 6f76 6572 7269 6465 735b 6b65 795d 290a  overrides[key]).
-00018040: 2020 2020 2020 2020 766d 656e 7472 6965          vmentrie
-00018050: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-00018060: 6e74 7279 2069 6e20 656e 7472 6965 7320  ntry in entries 
-00018070: 6966 2027 7479 7065 2720 6e6f 7420 696e  if 'type' not in
-00018080: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-00018090: 6f72 2065 6e74 7269 6573 5b65 6e74 7279  or entries[entry
-000180a0: 5d5b 2774 7970 6527 5d20 3d3d 2027 766d  ]['type'] == 'vm
-000180b0: 275d 0a20 2020 2020 2020 2064 6973 6b65  '].        diske
-000180c0: 6e74 7269 6573 203d 205b 656e 7472 7920  ntries = [entry 
-000180d0: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
-000180e0: 7269 6573 2069 6620 2774 7970 6527 2069  ries if 'type' i
-000180f0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
-00018100: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
-00018110: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
-00018120: 6469 736b 275d 0a20 2020 2020 2020 206e  disk'].        n
-00018130: 6574 776f 726b 656e 7472 6965 7320 3d20  etworkentries = 
-00018140: 5b65 6e74 7279 2066 6f72 2065 6e74 7279  [entry for entry
-00018150: 2069 6e20 656e 7472 6965 730a 2020 2020   in entries.    
-00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018170: 2020 2020 2020 6966 2027 7479 7065 2720        if 'type' 
-00018180: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
-00018190: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
-000181a0: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
-000181b0: 276e 6574 776f 726b 275d 0a20 2020 2020  'network'].     
-000181c0: 2020 2063 6f6e 7461 696e 6572 656e 7472     containerentr
-000181d0: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
-000181e0: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
-000181f0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00018200: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018210: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
-00018220: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
-00018230: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-00018240: 7065 275d 203d 3d20 2763 6f6e 7461 696e  pe'] == 'contain
-00018250: 6572 275d 0a20 2020 2020 2020 2061 6e73  er'].        ans
-00018260: 6962 6c65 656e 7472 6965 7320 3d20 5b65  ibleentries = [e
-00018270: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
-00018280: 6e20 656e 7472 6965 730a 2020 2020 2020  n entries.      
-00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182a0: 2020 2020 6966 2027 7479 7065 2720 696e      if 'type' in
-000182b0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-000182c0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-000182d0: 795d 5b27 7479 7065 275d 203d 3d20 2761  y]['type'] == 'a
-000182e0: 6e73 6962 6c65 275d 0a20 2020 2020 2020  nsible'].       
-000182f0: 2070 726f 6669 6c65 656e 7472 6965 7320   profileentries 
-00018300: 3d20 5b65 6e74 7279 2066 6f72 2065 6e74  = [entry for ent
-00018310: 7279 2069 6e20 656e 7472 6965 730a 2020  ry in entries.  
-00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018330: 2020 2020 2020 2020 6966 2027 7479 7065          if 'type
-00018340: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
-00018350: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
-00018360: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
-00018370: 3d20 2770 726f 6669 6c65 275d 0a20 2020  = 'profile'].   
-00018380: 2020 2020 2069 6d61 6765 656e 7472 6965       imageentrie
-00018390: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-000183a0: 6e74 7279 2069 6e20 656e 7472 6965 7320  ntry in entries 
-000183b0: 6966 2027 7479 7065 2720 696e 0a20 2020  if 'type' in.   
-000183c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183d0: 2020 2020 2065 6e74 7269 6573 5b65 6e74       entries[ent
-000183e0: 7279 5d20 616e 6420 2865 6e74 7269 6573  ry] and (entries
-000183f0: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
-00018400: 3d3d 2027 696d 6167 6527 206f 7220 656e  == 'image' or en
-00018410: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-00018420: 7065 275d 203d 3d20 2774 656d 706c 6174  pe'] == 'templat
-00018430: 6527 295d 0a20 2020 2020 2020 2070 6f6f  e')].        poo
-00018440: 6c65 6e74 7269 6573 203d 205b 656e 7472  lentries = [entr
-00018450: 7920 666f 7220 656e 7472 7920 696e 2065  y for entry in e
-00018460: 6e74 7269 6573 2069 6620 2774 7970 6527  ntries if 'type'
-00018470: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
-00018480: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
-00018490: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
-000184a0: 2027 706f 6f6c 275d 0a20 2020 2020 2020   'pool'].       
-000184b0: 2070 6c61 6e65 6e74 7269 6573 203d 205b   planentries = [
-000184c0: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-000184d0: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-000184e0: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
-000184f0: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
-00018500: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-00018510: 5d20 3d3d 2027 706c 616e 275d 0a20 2020  ] == 'plan'].   
-00018520: 2020 2020 2064 6e73 656e 7472 6965 7320       dnsentries 
-00018530: 3d20 5b65 6e74 7279 2066 6f72 2065 6e74  = [entry for ent
-00018540: 7279 2069 6e20 656e 7472 6965 7320 6966  ry in entries if
-00018550: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
-00018560: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
-00018570: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-00018580: 7065 275d 203d 3d20 2764 6e73 275d 0a20  pe'] == 'dns']. 
-00018590: 2020 2020 2020 206b 7562 6573 203d 205b         kubes = [
-000185a0: 276b 7562 6527 2c20 2763 6c75 7374 6572  'kube', 'cluster
-000185b0: 275d 0a20 2020 2020 2020 206b 7562 6565  '].        kubee
-000185c0: 6e74 7269 6573 203d 205b 656e 7472 7920  ntries = [entry 
-000185d0: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
-000185e0: 7269 6573 2069 6620 2774 7970 6527 2069  ries if 'type' i
-000185f0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
-00018600: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
-00018610: 7279 5d5b 2774 7970 6527 5d20 696e 206b  ry]['type'] in k
-00018620: 7562 6573 5d0a 2020 2020 2020 2020 6c62  ubes].        lb
-00018630: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-00018640: 6e74 7279 2069 6e20 656e 7472 6965 7320  ntry in entries 
-00018650: 6966 2027 7479 7065 2720 696e 2065 6e74  if 'type' in ent
-00018660: 7269 6573 5b65 6e74 7279 5d20 616e 6420  ries[entry] and 
-00018670: 656e 7472 6965 735b 656e 7472 795d 5b27  entries[entry]['
-00018680: 7479 7065 275d 203d 3d20 276c 6f61 6462  type'] == 'loadb
-00018690: 616c 616e 6365 7227 5d0a 2020 2020 2020  alancer'].      
-000186a0: 2020 7367 7320 3d20 5b65 6e74 7279 2066    sgs = [entry f
-000186b0: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-000186c0: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
-000186d0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-000186e0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-000186f0: 795d 5b27 7479 7065 275d 203d 3d20 2773  y]['type'] == 's
-00018700: 6563 7572 6974 7967 726f 7570 275d 0a20  ecuritygroup']. 
-00018710: 2020 2020 2020 2062 7563 6b65 7465 6e74         bucketent
-00018720: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
-00018730: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
-00018740: 6573 2069 6620 2774 7970 6527 2069 6e20  es if 'type' in 
-00018750: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-00018760: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
-00018770: 5d5b 2774 7970 6527 5d20 3d3d 2027 6275  ]['type'] == 'bu
-00018780: 636b 6574 275d 0a20 2020 2020 2020 2077  cket'].        w
-00018790: 6f72 6b66 6c6f 7765 6e74 7269 6573 203d  orkflowentries =
-000187a0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-000187b0: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
-000187c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187d0: 2020 2020 2020 2020 6966 2027 7479 7065          if 'type
-000187e0: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
-000187f0: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
-00018800: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
-00018810: 3d20 2777 6f72 6b66 6c6f 7727 5d0a 2020  = 'workflow'].  
-00018820: 2020 2020 2020 666f 7220 7020 696e 2070        for p in p
-00018830: 726f 6669 6c65 656e 7472 6965 733a 0a20  rofileentries:. 
-00018840: 2020 2020 2020 2020 2020 2076 6d70 726f             vmpro
-00018850: 6669 6c65 735b 705d 203d 2065 6e74 7269  files[p] = entri
-00018860: 6573 5b70 5d0a 2020 2020 2020 2020 6966  es[p].        if
-00018870: 206e 6574 776f 726b 656e 7472 6965 7320   networkentries 
-00018880: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
-00018890: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000188a0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-000188b0: 6720 4e65 7477 6f72 6b73 2e2e 2e22 290a  g Networks...").
-000188c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000188d0: 6e65 7420 696e 206e 6574 776f 726b 656e  net in networken
-000188e0: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
-000188f0: 2020 2020 2020 206e 6574 7072 6f66 696c         netprofil
-00018900: 6520 3d20 656e 7472 6965 735b 6e65 745d  e = entries[net]
-00018910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018920: 2069 6620 6b2e 6e65 745f 6578 6973 7473   if k.net_exists
-00018930: 286e 6574 293a 0a20 2020 2020 2020 2020  (net):.         
-00018940: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00018950: 7428 6622 4e65 7477 6f72 6b20 7b6e 6574  t(f"Network {net
-00018960: 7d20 736b 6970 7065 6421 2229 0a20 2020  } skipped!").   
-00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018980: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00018990: 2020 2020 2020 2020 2020 6369 6472 203d            cidr =
-000189a0: 206e 6574 7072 6f66 696c 652e 6765 7428   netprofile.get(
-000189b0: 2763 6964 7227 290a 2020 2020 2020 2020  'cidr').        
-000189c0: 2020 2020 2020 2020 6e61 7420 3d20 626f          nat = bo
-000189d0: 6f6c 286e 6574 7072 6f66 696c 652e 6765  ol(netprofile.ge
-000189e0: 7428 276e 6174 272c 2054 7275 6529 290a  t('nat', True)).
-000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a00: 6966 2063 6964 7220 6973 204e 6f6e 653a  if cidr is None:
-00018a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018a20: 2020 2020 2077 6172 6e69 6e67 2866 224d       warning(f"M
-00018a30: 6973 7369 6e67 2043 6964 7220 666f 7220  issing Cidr for 
-00018a40: 6e65 7477 6f72 6b20 7b6e 6574 7d2e 204e  network {net}. N
-00018a50: 6f74 2063 7265 6174 696e 6720 6974 2e2e  ot creating it..
-00018a60: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00018a70: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00018a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018a90: 2064 6863 7020 3d20 6e65 7470 726f 6669   dhcp = netprofi
-00018aa0: 6c65 2e67 6574 2827 6468 6370 272c 2054  le.get('dhcp', T
-00018ab0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00018ac0: 2020 2020 2064 6f6d 6169 6e20 3d20 6e65       domain = ne
-00018ad0: 7470 726f 6669 6c65 2e67 6574 2827 646f  tprofile.get('do
-00018ae0: 6d61 696e 2729 0a20 2020 2020 2020 2020  main').         
-00018af0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00018b00: 6b2e 6372 6561 7465 5f6e 6574 776f 726b  k.create_network
-00018b10: 286e 616d 653d 6e65 742c 2063 6964 723d  (name=net, cidr=
-00018b20: 6369 6472 2c20 6468 6370 3d64 6863 702c  cidr, dhcp=dhcp,
-00018b30: 206e 6174 3d6e 6174 2c20 646f 6d61 696e   nat=nat, domain
-00018b40: 3d64 6f6d 6169 6e2c 2070 6c61 6e3d 706c  =domain, plan=pl
-00018b50: 616e 2c0a 2020 2020 2020 2020 2020 2020  an,.            
-00018b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b70: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-00018b80: 6572 7269 6465 733d 6e65 7470 726f 6669  errides=netprofi
-00018b90: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00018ba0: 2020 2020 636f 6d6d 6f6e 2e68 616e 646c      common.handl
-00018bb0: 655f 7265 7370 6f6e 7365 2872 6573 756c  e_response(resul
-00018bc0: 742c 206e 6574 2c20 656c 656d 656e 743d  t, net, element=
-00018bd0: 274e 6574 776f 726b 2027 290a 2020 2020  'Network ').    
-00018be0: 2020 2020 6966 2070 6f6f 6c65 6e74 7269      if poolentri
-00018bf0: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
-00018c00: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-00018c10: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
-00018c20: 7969 6e67 2050 6f6f 6c73 2e2e 2e22 290a  ying Pools...").
-00018c30: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-00018c40: 7320 3d20 6b2e 6c69 7374 5f70 6f6f 6c73  s = k.list_pools
-00018c50: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-00018c60: 6f72 2070 6f6f 6c20 696e 2070 6f6f 6c65  or pool in poole
-00018c70: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-00018c80: 2020 2020 2020 2020 6966 2070 6f6f 6c20          if pool 
-00018c90: 696e 2070 6f6f 6c73 3a0a 2020 2020 2020  in pools:.      
-00018ca0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00018cb0: 7269 6e74 2866 2250 6f6f 6c20 7b70 6f6f  rint(f"Pool {poo
-00018cc0: 6c7d 2073 6b69 7070 6564 2122 290a 2020  l} skipped!").  
-00018cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ce0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00018cf0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00018d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d10: 2020 2020 2070 6f6f 6c70 726f 6669 6c65       poolprofile
-00018d20: 203d 2065 6e74 7269 6573 5b70 6f6f 6c5d   = entries[pool]
-00018d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d40: 2020 2020 2070 6f6f 6c70 6174 6820 3d20       poolpath = 
-00018d50: 706f 6f6c 7072 6f66 696c 652e 6765 7428  poolprofile.get(
-00018d60: 2770 6174 6827 290a 2020 2020 2020 2020  'path').        
-00018d70: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00018d80: 6f6f 6c70 6174 6820 6973 204e 6f6e 653a  oolpath is None:
-00018d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018da0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00018db0: 2866 2250 6f6f 6c20 7b70 6f6f 6c7d 2073  (f"Pool {pool} s
-00018dc0: 6b69 7070 6564 2061 7320 7061 7468 2069  kipped as path i
-00018dd0: 7320 6d69 7373 696e 6721 2229 0a20 2020  s missing!").   
+00017f00: 206b 6579 5f74 7970 6520 213d 206f 7665   key_type != ove
+00017f10: 7272 6964 655f 6b65 795f 7479 7065 3a0a  rride_key_type:.
+00017f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f30: 2020 2020 6572 726f 7228 6622 5468 6520      error(f"The 
+00017f40: 7072 6f76 6964 6564 2070 6172 616d 6574  provided paramet
+00017f50: 6572 207b 6b65 797d 2068 6173 2061 2077  er {key} has a w
+00017f60: 726f 6e67 2074 7970 6520 7b6f 7665 7272  rong type {overr
+00017f70: 6964 655f 6b65 795f 7479 7065 7d2c 2069  ide_key_type}, i
+00017f80: 7420 7368 6f75 6c64 2062 6520 7b6b 6579  t should be {key
+00017f90: 5f74 7970 657d 2229 0a20 2020 2020 2020  _type}").       
+00017fa0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00017fb0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00017fc0: 2020 2020 2020 2020 2065 6c69 6620 6f76           elif ov
+00017fd0: 6572 7269 6465 735b 6b65 795d 2069 7320  errides[key] is 
+00017fe0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00017ff0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00018000: 7461 7474 7228 7365 6c66 2c20 6b65 792c  tattr(self, key,
+00018010: 206f 7665 7272 6964 6573 5b6b 6579 5d29   overrides[key])
+00018020: 0a20 2020 2020 2020 2076 6d65 6e74 7269  .        vmentri
+00018030: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00018040: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00018050: 2069 6620 2774 7970 6527 206e 6f74 2069   if 'type' not i
+00018060: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+00018070: 206f 7220 656e 7472 6965 735b 656e 7472   or entries[entr
+00018080: 795d 5b27 7479 7065 275d 203d 3d20 2776  y]['type'] == 'v
+00018090: 6d27 5d0a 2020 2020 2020 2020 6469 736b  m'].        disk
+000180a0: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+000180b0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+000180c0: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+000180d0: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+000180e0: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+000180f0: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
+00018100: 2764 6973 6b27 5d0a 2020 2020 2020 2020  'disk'].        
+00018110: 6e65 7477 6f72 6b65 6e74 7269 6573 203d  networkentries =
+00018120: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+00018130: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
+00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018150: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
+00018160: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+00018170: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
+00018180: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
+00018190: 2027 6e65 7477 6f72 6b27 5d0a 2020 2020   'network'].    
+000181a0: 2020 2020 636f 6e74 6169 6e65 7265 6e74      containerent
+000181b0: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
+000181c0: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+000181d0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000181f0: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
+00018200: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
+00018210: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00018220: 7970 6527 5d20 3d3d 2027 636f 6e74 6169  ype'] == 'contai
+00018230: 6e65 7227 5d0a 2020 2020 2020 2020 616e  ner'].        an
+00018240: 7369 626c 6565 6e74 7269 6573 203d 205b  sibleentries = [
+00018250: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
+00018260: 696e 2065 6e74 7269 6573 0a20 2020 2020  in entries.     
+00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018280: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
+00018290: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+000182a0: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
+000182b0: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
+000182c0: 616e 7369 626c 6527 5d0a 2020 2020 2020  ansible'].      
+000182d0: 2020 7072 6f66 696c 6565 6e74 7269 6573    profileentries
+000182e0: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+000182f0: 7472 7920 696e 2065 6e74 7269 6573 0a20  try in entries. 
+00018300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018310: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
+00018320: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
+00018330: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
+00018340: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+00018350: 3d3d 2027 7072 6f66 696c 6527 5d0a 2020  == 'profile'].  
+00018360: 2020 2020 2020 696d 6167 6565 6e74 7269        imageentri
+00018370: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00018380: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00018390: 2069 6620 2774 7970 6527 2069 6e0a 2020   if 'type' in.  
+000183a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183b0: 2020 2020 2020 656e 7472 6965 735b 656e        entries[en
+000183c0: 7472 795d 2061 6e64 2028 656e 7472 6965  try] and (entrie
+000183d0: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+000183e0: 203d 3d20 2769 6d61 6765 2720 6f72 2065   == 'image' or e
+000183f0: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00018400: 7970 6527 5d20 3d3d 2027 7465 6d70 6c61  ype'] == 'templa
+00018410: 7465 2729 5d0a 2020 2020 2020 2020 706f  te')].        po
+00018420: 6f6c 656e 7472 6965 7320 3d20 5b65 6e74  olentries = [ent
+00018430: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
+00018440: 656e 7472 6965 7320 6966 2027 7479 7065  entries if 'type
+00018450: 2720 696e 2065 6e74 7269 6573 5b65 6e74  ' in entries[ent
+00018460: 7279 5d20 616e 6420 656e 7472 6965 735b  ry] and entries[
+00018470: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
+00018480: 3d20 2770 6f6f 6c27 5d0a 2020 2020 2020  = 'pool'].      
+00018490: 2020 706c 616e 656e 7472 6965 7320 3d20    planentries = 
+000184a0: 5b65 6e74 7279 2066 6f72 2065 6e74 7279  [entry for entry
+000184b0: 2069 6e20 656e 7472 6965 7320 6966 2027   in entries if '
+000184c0: 7479 7065 2720 696e 2065 6e74 7269 6573  type' in entries
+000184d0: 5b65 6e74 7279 5d20 616e 6420 656e 7472  [entry] and entr
+000184e0: 6965 735b 656e 7472 795d 5b27 7479 7065  ies[entry]['type
+000184f0: 275d 203d 3d20 2770 6c61 6e27 5d0a 2020  '] == 'plan'].  
+00018500: 2020 2020 2020 646e 7365 6e74 7269 6573        dnsentries
+00018510: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+00018520: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
+00018530: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
+00018540: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
+00018550: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00018560: 7970 6527 5d20 3d3d 2027 646e 7327 5d0a  ype'] == 'dns'].
+00018570: 2020 2020 2020 2020 6b75 6265 7320 3d20          kubes = 
+00018580: 5b27 6b75 6265 272c 2027 636c 7573 7465  ['kube', 'cluste
+00018590: 7227 5d0a 2020 2020 2020 2020 6b75 6265  r'].        kube
+000185a0: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+000185b0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+000185c0: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+000185d0: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+000185e0: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+000185f0: 7472 795d 5b27 7479 7065 275d 2069 6e20  try]['type'] in 
+00018600: 6b75 6265 735d 0a20 2020 2020 2020 206c  kubes].        l
+00018610: 6273 203d 205b 656e 7472 7920 666f 7220  bs = [entry for 
+00018620: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00018630: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
+00018640: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
+00018650: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+00018660: 2774 7970 6527 5d20 3d3d 2027 6c6f 6164  'type'] == 'load
+00018670: 6261 6c61 6e63 6572 275d 0a20 2020 2020  balancer'].     
+00018680: 2020 2073 6773 203d 205b 656e 7472 7920     sgs = [entry 
+00018690: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
+000186a0: 7269 6573 2069 6620 2774 7970 6527 2069  ries if 'type' i
+000186b0: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+000186c0: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
+000186d0: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
+000186e0: 7365 6375 7269 7479 6772 6f75 7027 5d0a  securitygroup'].
+000186f0: 2020 2020 2020 2020 6275 636b 6574 656e          bucketen
+00018700: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
+00018710: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+00018720: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
+00018730: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
+00018740: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
+00018750: 795d 5b27 7479 7065 275d 203d 3d20 2762  y]['type'] == 'b
+00018760: 7563 6b65 7427 5d0a 2020 2020 2020 2020  ucket'].        
+00018770: 776f 726b 666c 6f77 656e 7472 6965 7320  workflowentries 
+00018780: 3d20 5b65 6e74 7279 2066 6f72 2065 6e74  = [entry for ent
+00018790: 7279 2069 6e20 656e 7472 6965 730a 2020  ry in entries.  
+000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187b0: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
+000187c0: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
+000187d0: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
+000187e0: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+000187f0: 3d3d 2027 776f 726b 666c 6f77 275d 0a20  == 'workflow']. 
+00018800: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
+00018810: 7072 6f66 696c 6565 6e74 7269 6573 3a0a  profileentries:.
+00018820: 2020 2020 2020 2020 2020 2020 766d 7072              vmpr
+00018830: 6f66 696c 6573 5b70 5d20 3d20 656e 7472  ofiles[p] = entr
+00018840: 6965 735b 705d 0a20 2020 2020 2020 2069  ies[p].        i
+00018850: 6620 6e65 7477 6f72 6b65 6e74 7269 6573  f networkentries
+00018860: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+00018870: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+00018880: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
+00018890: 6e67 204e 6574 776f 726b 732e 2e2e 2229  ng Networks...")
+000188a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000188b0: 206e 6574 2069 6e20 6e65 7477 6f72 6b65   net in networke
+000188c0: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+000188d0: 2020 2020 2020 2020 6e65 7470 726f 6669          netprofi
+000188e0: 6c65 203d 2065 6e74 7269 6573 5b6e 6574  le = entries[net
+000188f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00018900: 2020 6966 206b 2e6e 6574 5f65 7869 7374    if k.net_exist
+00018910: 7328 6e65 7429 3a0a 2020 2020 2020 2020  s(net):.        
+00018920: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00018930: 6e74 2866 224e 6574 776f 726b 207b 6e65  nt(f"Network {ne
+00018940: 747d 2073 6b69 7070 6564 2122 290a 2020  t} skipped!").  
+00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018960: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00018970: 2020 2020 2020 2020 2020 2063 6964 7220             cidr 
+00018980: 3d20 6e65 7470 726f 6669 6c65 2e67 6574  = netprofile.get
+00018990: 2827 6369 6472 2729 0a20 2020 2020 2020  ('cidr').       
+000189a0: 2020 2020 2020 2020 206e 6174 203d 2062           nat = b
+000189b0: 6f6f 6c28 6e65 7470 726f 6669 6c65 2e67  ool(netprofile.g
+000189c0: 6574 2827 6e61 7427 2c20 5472 7565 2929  et('nat', True))
+000189d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000189e0: 2069 6620 6369 6472 2069 7320 4e6f 6e65   if cidr is None
+000189f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018a00: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+00018a10: 4d69 7373 696e 6720 4369 6472 2066 6f72  Missing Cidr for
+00018a20: 206e 6574 776f 726b 207b 6e65 747d 2e20   network {net}. 
+00018a30: 4e6f 7420 6372 6561 7469 6e67 2069 742e  Not creating it.
+00018a40: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00018a50: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00018a60: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00018a70: 2020 6468 6370 203d 206e 6574 7072 6f66    dhcp = netprof
+00018a80: 696c 652e 6765 7428 2764 6863 7027 2c20  ile.get('dhcp', 
+00018a90: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00018aa0: 2020 2020 2020 646f 6d61 696e 203d 206e        domain = n
+00018ab0: 6574 7072 6f66 696c 652e 6765 7428 2764  etprofile.get('d
+00018ac0: 6f6d 6169 6e27 290a 2020 2020 2020 2020  omain').        
+00018ad0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00018ae0: 206b 2e63 7265 6174 655f 6e65 7477 6f72   k.create_networ
+00018af0: 6b28 6e61 6d65 3d6e 6574 2c20 6369 6472  k(name=net, cidr
+00018b00: 3d63 6964 722c 2064 6863 703d 6468 6370  =cidr, dhcp=dhcp
+00018b10: 2c20 6e61 743d 6e61 742c 2064 6f6d 6169  , nat=nat, domai
+00018b20: 6e3d 646f 6d61 696e 2c20 706c 616e 3d70  n=domain, plan=p
+00018b30: 6c61 6e2c 0a20 2020 2020 2020 2020 2020  lan,.           
+00018b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b50: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00018b60: 7665 7272 6964 6573 3d6e 6574 7072 6f66  verrides=netprof
+00018b70: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00018b80: 2020 2020 2063 6f6d 6d6f 6e2e 6861 6e64       common.hand
+00018b90: 6c65 5f72 6573 706f 6e73 6528 7265 7375  le_response(resu
+00018ba0: 6c74 2c20 6e65 742c 2065 6c65 6d65 6e74  lt, net, element
+00018bb0: 3d27 4e65 7477 6f72 6b20 2729 0a20 2020  ='Network ').   
+00018bc0: 2020 2020 2069 6620 706f 6f6c 656e 7472       if poolentr
+00018bd0: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
+00018be0: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+00018bf0: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
+00018c00: 6f79 696e 6720 506f 6f6c 732e 2e2e 2229  oying Pools...")
+00018c10: 0a20 2020 2020 2020 2020 2020 2070 6f6f  .            poo
+00018c20: 6c73 203d 206b 2e6c 6973 745f 706f 6f6c  ls = k.list_pool
+00018c30: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00018c40: 666f 7220 706f 6f6c 2069 6e20 706f 6f6c  for pool in pool
+00018c50: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
+00018c60: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
+00018c70: 2069 6e20 706f 6f6c 733a 0a20 2020 2020   in pools:.     
+00018c80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00018c90: 7072 696e 7428 6622 506f 6f6c 207b 706f  print(f"Pool {po
+00018ca0: 6f6c 7d20 736b 6970 7065 6421 2229 0a20  ol} skipped!"). 
+00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cc0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00018cd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00018ce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018cf0: 2020 2020 2020 706f 6f6c 7072 6f66 696c        poolprofil
+00018d00: 6520 3d20 656e 7472 6965 735b 706f 6f6c  e = entries[pool
+00018d10: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00018d20: 2020 2020 2020 706f 6f6c 7061 7468 203d        poolpath =
+00018d30: 2070 6f6f 6c70 726f 6669 6c65 2e67 6574   poolprofile.get
+00018d40: 2827 7061 7468 2729 0a20 2020 2020 2020  ('path').       
+00018d50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00018d60: 706f 6f6c 7061 7468 2069 7320 4e6f 6e65  poolpath is None
+00018d70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018d80: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00018d90: 6728 6622 506f 6f6c 207b 706f 6f6c 7d20  g(f"Pool {pool} 
+00018da0: 736b 6970 7065 6420 6173 2070 6174 6820  skipped as path 
+00018db0: 6973 206d 6973 7369 6e67 2122 290a 2020  is missing!").  
+00018dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018dd0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
 00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018df0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00018e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e10: 2020 6b2e 6372 6561 7465 5f70 6f6f 6c28    k.create_pool(
-00018e20: 706f 6f6c 2c20 706f 6f6c 7061 7468 290a  pool, poolpath).
-00018e30: 2020 2020 2020 2020 6966 2069 6d61 6765          if image
-00018e40: 656e 7472 6965 7320 616e 6420 6e6f 7420  entries and not 
-00018e50: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-00018e60: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-00018e70: 4465 706c 6f79 696e 6720 496d 6167 6573  Deploying Images
-00018e80: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00018e90: 2020 696d 6167 6573 203d 205b 6f73 2e70    images = [os.p
-00018ea0: 6174 682e 6261 7365 6e61 6d65 2874 2920  ath.basename(t) 
-00018eb0: 666f 7220 7420 696e 206b 2e76 6f6c 756d  for t in k.volum
-00018ec0: 6573 2829 5d0a 2020 2020 2020 2020 2020  es()].          
-00018ed0: 2020 666f 7220 696d 6167 6520 696e 2069    for image in i
-00018ee0: 6d61 6765 656e 7472 6965 733a 0a20 2020  mageentries:.   
-00018ef0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-00018f00: 6765 7072 6f66 696c 6520 3d20 656e 7472  geprofile = entr
-00018f10: 6965 735b 696d 6167 655d 0a20 2020 2020  ies[image].     
-00018f20: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
-00018f30: 3d20 696d 6167 6570 726f 6669 6c65 2e67  = imageprofile.g
-00018f40: 6574 2827 706f 6f6c 272c 2073 656c 662e  et('pool', self.
-00018f50: 706f 6f6c 290a 2020 2020 2020 2020 2020  pool).          
-00018f60: 2020 2020 2020 696d 6167 6573 697a 6520        imagesize 
-00018f70: 3d20 696d 6167 6570 726f 6669 6c65 2e67  = imageprofile.g
-00018f80: 6574 2827 7369 7a65 2729 0a20 2020 2020  et('size').     
-00018f90: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00018fa0: 7572 6c20 3d20 696d 6167 6570 726f 6669  url = imageprofi
-00018fb0: 6c65 2e67 6574 2827 7572 6c27 290a 2020  le.get('url').  
-00018fc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018fd0: 2069 6d61 6765 2069 6e20 696d 6167 6573   image in images
-00018fe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018ff0: 2020 2020 2020 7070 7269 6e74 2866 2249        pprint(f"I
-00019000: 6d61 6765 207b 696d 6167 657d 2073 6b69  mage {image} ski
-00019010: 7070 6564 2122 290a 2020 2020 2020 2020  pped!").        
-00019020: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00019030: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00019040: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00019050: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00019060: 6620 6973 696e 7374 616e 6365 2869 6d61  f isinstance(ima
-00019070: 6765 7572 6c2c 2073 7472 2920 616e 6420  geurl, str) and 
-00019080: 696d 6167 6575 726c 203d 3d20 224e 6f6e  imageurl == "Non
-00019090: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-000190a0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-000190b0: 6575 726c 203d 204e 6f6e 650a 2020 2020  eurl = None.    
-000190c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190d0: 636d 6420 3d20 696d 6167 6570 726f 6669  cmd = imageprofi
-000190e0: 6c65 2e67 6574 2827 636d 6427 290a 2020  le.get('cmd').  
-000190f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019100: 2020 7365 6c66 2e68 616e 646c 655f 686f    self.handle_ho
-00019110: 7374 2870 6f6f 6c3d 706f 6f6c 2c20 696d  st(pool=pool, im
-00019120: 6167 653d 696d 6167 652c 2064 6f77 6e6c  age=image, downl
-00019130: 6f61 643d 5472 7565 2c20 636d 643d 636d  oad=True, cmd=cm
-00019140: 642c 2075 726c 3d69 6d61 6765 7572 6c2c  d, url=imageurl,
-00019150: 2073 697a 653d 696d 6167 6573 697a 6529   size=imagesize)
-00019160: 0a20 2020 2020 2020 2069 6620 6275 636b  .        if buck
-00019170: 6574 656e 7472 6965 7320 616e 6420 6e6f  etentries and no
-00019180: 7420 6f6e 6c79 6173 7365 7473 2061 6e64  t onlyassets and
-00019190: 2073 656c 662e 7479 7065 2069 6e20 5b27   self.type in ['
-000191a0: 6177 7327 2c20 2767 6370 272c 2027 6f70  aws', 'gcp', 'op
-000191b0: 656e 7374 6163 6b27 5d3a 0a20 2020 2020  enstack']:.     
-000191c0: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
-000191d0: 6570 6c6f 7969 6e67 2042 7563 6b65 7420  eploying Bucket 
-000191e0: 456e 7472 6965 732e 2e2e 2229 0a20 2020  Entries...").   
-000191f0: 2020 2020 2020 2020 2066 6f72 2062 7563           for buc
-00019200: 6b65 7465 6e74 7279 2069 6e20 6275 636b  ketentry in buck
-00019210: 6574 656e 7472 6965 733a 0a20 2020 2020  etentries:.     
-00019220: 2020 2020 2020 2020 2020 2062 7563 6b65             bucke
-00019230: 7470 726f 6669 6c65 203d 2065 6e74 7269  tprofile = entri
-00019240: 6573 5b62 7563 6b65 7465 6e74 7279 5d0a  es[bucketentry].
-00019250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019260: 5f66 696c 6573 203d 2062 7563 6b65 7470  _files = bucketp
-00019270: 726f 6669 6c65 2e67 6574 2827 6669 6c65  rofile.get('file
-00019280: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-00019290: 2020 2020 2020 2020 7365 6c66 2e6b 2e63          self.k.c
-000192a0: 7265 6174 655f 6275 636b 6574 2862 7563  reate_bucket(buc
-000192b0: 6b65 7465 6e74 7279 290a 2020 2020 2020  ketentry).      
-000192c0: 2020 2020 2020 2020 2020 666f 7220 5f66            for _f
-000192d0: 696c 2069 6e20 5f66 696c 6573 3a0a 2020  il in _files:.  
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192f0: 2020 7365 6c66 2e6b 2e75 706c 6f61 645f    self.k.upload_
-00019300: 746f 5f62 7563 6b65 7428 6275 636b 6574  to_bucket(bucket
-00019310: 656e 7472 792c 205f 6669 6c29 0a20 2020  entry, _fil).   
-00019320: 2020 2020 2074 656d 706b 6579 203d 206f       tempkey = o
-00019330: 7665 7272 6964 6573 2e67 6574 2827 7465  verrides.get('te
-00019340: 6d70 6b65 7927 2c20 4661 6c73 6529 206f  mpkey', False) o
-00019350: 7220 7365 6c66 2e74 656d 706b 6579 0a20  r self.tempkey. 
-00019360: 2020 2020 2020 2069 6620 7465 6d70 6b65         if tempke
-00019370: 793a 0a20 2020 2020 2020 2020 2020 2074  y:.            t
-00019380: 656d 706b 6579 6469 7220 3d20 5465 6d70  empkeydir = Temp
-00019390: 6f72 6172 7944 6972 6563 746f 7279 2829  oraryDirectory()
-000193a0: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
-000193b0: 7272 6964 6573 5b27 7465 6d70 6b65 7964  rrides['tempkeyd
-000193c0: 6972 275d 203d 2074 656d 706b 6579 6469  ir'] = tempkeydi
-000193d0: 720a 2020 2020 2020 2020 2020 2020 6f76  r.            ov
-000193e0: 6572 7269 6465 735b 2774 656d 706b 6579  errides['tempkey
-000193f0: 6469 726b 6565 7027 5d20 3d20 5472 7565  dirkeep'] = True
-00019400: 0a20 2020 2020 2020 2069 6620 706c 616e  .        if plan
-00019410: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
-00019420: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
-00019430: 6c6f 7969 6e67 2050 6c61 6e73 2e2e 2e22  loying Plans..."
-00019440: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00019450: 7220 706c 616e 656e 7472 7920 696e 2070  r planentry in p
-00019460: 6c61 6e65 6e74 7269 6573 3a0a 2020 2020  lanentries:.    
-00019470: 2020 2020 2020 2020 2020 2020 6465 7461              deta
-00019480: 696c 7320 3d20 656e 7472 6965 735b 706c  ils = entries[pl
-00019490: 616e 656e 7472 795d 0a20 2020 2020 2020  anentry].       
-000194a0: 2020 2020 2020 2020 2070 6c61 6e75 726c           planurl
-000194b0: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
-000194c0: 7572 6c27 290a 2020 2020 2020 2020 2020  url').          
-000194d0: 2020 2020 2020 706c 616e 6669 6c65 203d        planfile =
-000194e0: 2064 6574 6169 6c73 2e67 6574 2827 6669   details.get('fi
-000194f0: 6c65 2729 0a20 2020 2020 2020 2020 2020  le').           
-00019500: 2020 2020 2069 6620 706c 616e 7572 6c20       if planurl 
-00019510: 6973 204e 6f6e 6520 616e 6420 706c 616e  is None and plan
-00019520: 6669 6c65 2069 7320 4e6f 6e65 3a0a 2020  file is None:.  
-00019530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019540: 2020 7761 726e 696e 6728 6622 4d69 7373    warning(f"Miss
-00019550: 696e 6720 5572 6c2f 4669 6c65 2066 6f72  ing Url/File for
-00019560: 2070 6c61 6e20 7b70 6c61 6e65 6e74 7279   plan {planentry
-00019570: 7d2e 204e 6f74 2063 7265 6174 696e 6720  }. Not creating 
-00019580: 6974 2e2e 2e22 290a 2020 2020 2020 2020  it...").        
-00019590: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-000195a0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-000195b0: 2020 2020 2065 6c69 6620 706c 616e 7572       elif planur
-000195c0: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
-000195d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195e0: 2020 2070 6174 6820 3d20 706c 616e 656e     path = planen
-000195f0: 7472 790a 2020 2020 2020 2020 2020 2020  try.            
-00019600: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
-00019610: 6c61 6e75 726c 2e65 6e64 7377 6974 6828  lanurl.endswith(
-00019620: 2779 6d6c 2729 3a0a 2020 2020 2020 2020  'yml'):.        
-00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019640: 706c 616e 7572 6c20 3d20 6622 7b70 6c61  planurl = f"{pla
-00019650: 6e75 726c 7d2f 6b63 6c69 5f70 6c61 6e2e  nurl}/kcli_plan.
-00019660: 796d 6c22 0a20 2020 2020 2020 2020 2020  yml".           
-00019670: 2020 2020 2065 6c69 6620 272f 2720 696e       elif '/' in
-00019680: 2070 6c61 6e66 696c 653a 0a20 2020 2020   planfile:.     
-00019690: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000196a0: 6174 6820 3d20 6f73 2e70 6174 682e 6469  ath = os.path.di
-000196b0: 726e 616d 6528 706c 616e 6669 6c65 290a  rname(planfile).
-000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196d0: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
-000196e0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-000196f0: 2870 6c61 6e66 696c 6529 0a20 2020 2020  (planfile).     
-00019700: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00018df0: 2020 206b 2e63 7265 6174 655f 706f 6f6c     k.create_pool
+00018e00: 2870 6f6f 6c2c 2070 6f6f 6c70 6174 6829  (pool, poolpath)
+00018e10: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
+00018e20: 6565 6e74 7269 6573 2061 6e64 206e 6f74  eentries and not
+00018e30: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+00018e40: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00018e50: 2244 6570 6c6f 7969 6e67 2049 6d61 6765  "Deploying Image
+00018e60: 732e 2e2e 2229 0a20 2020 2020 2020 2020  s...").         
+00018e70: 2020 2069 6d61 6765 7320 3d20 5b6f 732e     images = [os.
+00018e80: 7061 7468 2e62 6173 656e 616d 6528 7429  path.basename(t)
+00018e90: 2066 6f72 2074 2069 6e20 6b2e 766f 6c75   for t in k.volu
+00018ea0: 6d65 7328 295d 0a20 2020 2020 2020 2020  mes()].         
+00018eb0: 2020 2066 6f72 2069 6d61 6765 2069 6e20     for image in 
+00018ec0: 696d 6167 6565 6e74 7269 6573 3a0a 2020  imageentries:.  
+00018ed0: 2020 2020 2020 2020 2020 2020 2020 696d                im
+00018ee0: 6167 6570 726f 6669 6c65 203d 2065 6e74  ageprofile = ent
+00018ef0: 7269 6573 5b69 6d61 6765 5d0a 2020 2020  ries[image].    
+00018f00: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00018f10: 203d 2069 6d61 6765 7072 6f66 696c 652e   = imageprofile.
+00018f20: 6765 7428 2770 6f6f 6c27 2c20 7365 6c66  get('pool', self
+00018f30: 2e70 6f6f 6c29 0a20 2020 2020 2020 2020  .pool).         
+00018f40: 2020 2020 2020 2069 6d61 6765 7369 7a65         imagesize
+00018f50: 203d 2069 6d61 6765 7072 6f66 696c 652e   = imageprofile.
+00018f60: 6765 7428 2773 697a 6527 290a 2020 2020  get('size').    
+00018f70: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00018f80: 6575 726c 203d 2069 6d61 6765 7072 6f66  eurl = imageprof
+00018f90: 696c 652e 6765 7428 2775 726c 2729 0a20  ile.get('url'). 
+00018fa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018fb0: 6620 696d 6167 6520 696e 2069 6d61 6765  f image in image
+00018fc0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00018fd0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00018fe0: 496d 6167 6520 7b69 6d61 6765 7d20 736b  Image {image} sk
+00018ff0: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
+00019000: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00019010: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00019020: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00019030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019040: 6966 2069 7369 6e73 7461 6e63 6528 696d  if isinstance(im
+00019050: 6167 6575 726c 2c20 7374 7229 2061 6e64  ageurl, str) and
+00019060: 2069 6d61 6765 7572 6c20 3d3d 2022 4e6f   imageurl == "No
+00019070: 6e65 223a 0a20 2020 2020 2020 2020 2020  ne":.           
+00019080: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+00019090: 6765 7572 6c20 3d20 4e6f 6e65 0a20 2020  geurl = None.   
+000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190b0: 2063 6d64 203d 2069 6d61 6765 7072 6f66   cmd = imageprof
+000190c0: 696c 652e 6765 7428 2763 6d64 2729 0a20  ile.get('cmd'). 
+000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190e0: 2020 2073 656c 662e 6861 6e64 6c65 5f68     self.handle_h
+000190f0: 6f73 7428 706f 6f6c 3d70 6f6f 6c2c 2069  ost(pool=pool, i
+00019100: 6d61 6765 3d69 6d61 6765 2c20 646f 776e  mage=image, down
+00019110: 6c6f 6164 3d54 7275 652c 2063 6d64 3d63  load=True, cmd=c
+00019120: 6d64 2c20 7572 6c3d 696d 6167 6575 726c  md, url=imageurl
+00019130: 2c20 7369 7a65 3d69 6d61 6765 7369 7a65  , size=imagesize
+00019140: 290a 2020 2020 2020 2020 6966 2062 7563  ).        if buc
+00019150: 6b65 7465 6e74 7269 6573 2061 6e64 206e  ketentries and n
+00019160: 6f74 206f 6e6c 7961 7373 6574 7320 616e  ot onlyassets an
+00019170: 6420 7365 6c66 2e74 7970 6520 696e 205b  d self.type in [
+00019180: 2761 7773 272c 2027 6763 7027 2c20 276f  'aws', 'gcp', 'o
+00019190: 7065 6e73 7461 636b 275d 3a0a 2020 2020  penstack']:.    
+000191a0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+000191b0: 4465 706c 6f79 696e 6720 4275 636b 6574  Deploying Bucket
+000191c0: 2045 6e74 7269 6573 2e2e 2e22 290a 2020   Entries...").  
+000191d0: 2020 2020 2020 2020 2020 666f 7220 6275            for bu
+000191e0: 636b 6574 656e 7472 7920 696e 2062 7563  cketentry in buc
+000191f0: 6b65 7465 6e74 7269 6573 3a0a 2020 2020  ketentries:.    
+00019200: 2020 2020 2020 2020 2020 2020 6275 636b              buck
+00019210: 6574 7072 6f66 696c 6520 3d20 656e 7472  etprofile = entr
+00019220: 6965 735b 6275 636b 6574 656e 7472 795d  ies[bucketentry]
+00019230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019240: 205f 6669 6c65 7320 3d20 6275 636b 6574   _files = bucket
+00019250: 7072 6f66 696c 652e 6765 7428 2766 696c  profile.get('fil
+00019260: 6573 272c 205b 5d29 0a20 2020 2020 2020  es', []).       
+00019270: 2020 2020 2020 2020 2073 656c 662e 6b2e           self.k.
+00019280: 6372 6561 7465 5f62 7563 6b65 7428 6275  create_bucket(bu
+00019290: 636b 6574 656e 7472 7929 0a20 2020 2020  cketentry).     
+000192a0: 2020 2020 2020 2020 2020 2066 6f72 205f             for _
+000192b0: 6669 6c20 696e 205f 6669 6c65 733a 0a20  fil in _files:. 
+000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192d0: 2020 2073 656c 662e 6b2e 7570 6c6f 6164     self.k.upload
+000192e0: 5f74 6f5f 6275 636b 6574 2862 7563 6b65  _to_bucket(bucke
+000192f0: 7465 6e74 7279 2c20 5f66 696c 290a 2020  tentry, _fil).  
+00019300: 2020 2020 2020 7465 6d70 6b65 7920 3d20        tempkey = 
+00019310: 6f76 6572 7269 6465 732e 6765 7428 2774  overrides.get('t
+00019320: 656d 706b 6579 272c 2046 616c 7365 2920  empkey', False) 
+00019330: 6f72 2073 656c 662e 7465 6d70 6b65 790a  or self.tempkey.
+00019340: 2020 2020 2020 2020 6966 2074 656d 706b          if tempk
+00019350: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
+00019360: 7465 6d70 6b65 7964 6972 203d 2054 656d  tempkeydir = Tem
+00019370: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+00019380: 290a 2020 2020 2020 2020 2020 2020 6f76  ).            ov
+00019390: 6572 7269 6465 735b 2774 656d 706b 6579  errides['tempkey
+000193a0: 6469 7227 5d20 3d20 7465 6d70 6b65 7964  dir'] = tempkeyd
+000193b0: 6972 0a20 2020 2020 2020 2020 2020 206f  ir.            o
+000193c0: 7665 7272 6964 6573 5b27 7465 6d70 6b65  verrides['tempke
+000193d0: 7964 6972 6b65 6570 275d 203d 2054 7275  ydirkeep'] = Tru
+000193e0: 650a 2020 2020 2020 2020 6966 2070 6c61  e.        if pla
+000193f0: 6e65 6e74 7269 6573 3a0a 2020 2020 2020  nentries:.      
+00019400: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+00019410: 706c 6f79 696e 6720 506c 616e 732e 2e2e  ploying Plans...
+00019420: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+00019430: 6f72 2070 6c61 6e65 6e74 7279 2069 6e20  or planentry in 
+00019440: 706c 616e 656e 7472 6965 733a 0a20 2020  planentries:.   
+00019450: 2020 2020 2020 2020 2020 2020 2064 6574               det
+00019460: 6169 6c73 203d 2065 6e74 7269 6573 5b70  ails = entries[p
+00019470: 6c61 6e65 6e74 7279 5d0a 2020 2020 2020  lanentry].      
+00019480: 2020 2020 2020 2020 2020 706c 616e 7572            planur
+00019490: 6c20 3d20 6465 7461 696c 732e 6765 7428  l = details.get(
+000194a0: 2775 726c 2729 0a20 2020 2020 2020 2020  'url').         
+000194b0: 2020 2020 2020 2070 6c61 6e66 696c 6520         planfile 
+000194c0: 3d20 6465 7461 696c 732e 6765 7428 2766  = details.get('f
+000194d0: 696c 6527 290a 2020 2020 2020 2020 2020  ile').          
+000194e0: 2020 2020 2020 6966 2070 6c61 6e75 726c        if planurl
+000194f0: 2069 7320 4e6f 6e65 2061 6e64 2070 6c61   is None and pla
+00019500: 6e66 696c 6520 6973 204e 6f6e 653a 0a20  nfile is None:. 
+00019510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019520: 2020 2077 6172 6e69 6e67 2866 224d 6973     warning(f"Mis
+00019530: 7369 6e67 2055 726c 2f46 696c 6520 666f  sing Url/File fo
+00019540: 7220 706c 616e 207b 706c 616e 656e 7472  r plan {planentr
+00019550: 797d 2e20 4e6f 7420 6372 6561 7469 6e67  y}. Not creating
+00019560: 2069 742e 2e2e 2229 0a20 2020 2020 2020   it...").       
+00019570: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00019580: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00019590: 2020 2020 2020 656c 6966 2070 6c61 6e75        elif planu
+000195a0: 726c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rl is not None:.
+000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195c0: 2020 2020 7061 7468 203d 2070 6c61 6e65      path = plane
+000195d0: 6e74 7279 0a20 2020 2020 2020 2020 2020  ntry.           
+000195e0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000195f0: 706c 616e 7572 6c2e 656e 6473 7769 7468  planurl.endswith
+00019600: 2827 796d 6c27 293a 0a20 2020 2020 2020  ('yml'):.       
+00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019620: 2070 6c61 6e75 726c 203d 2066 227b 706c   planurl = f"{pl
+00019630: 616e 7572 6c7d 2f6b 636c 695f 706c 616e  anurl}/kcli_plan
+00019640: 2e79 6d6c 220a 2020 2020 2020 2020 2020  .yml".          
+00019650: 2020 2020 2020 656c 6966 2027 2f27 2069        elif '/' i
+00019660: 6e20 706c 616e 6669 6c65 3a0a 2020 2020  n planfile:.    
+00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 7061 7468 203d 206f 732e 7061 7468 2e64  path = os.path.d
+00019690: 6972 6e61 6d65 2870 6c61 6e66 696c 6529  irname(planfile)
+000196a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000196b0: 2020 2020 2069 6e70 7574 6669 6c65 203d       inputfile =
+000196c0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+000196d0: 6528 706c 616e 6669 6c65 290a 2020 2020  e(planfile).    
+000196e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000196f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019700: 2020 2020 2020 7061 7468 203d 2027 2e27        path = '.'
 00019710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019720: 2020 2020 2070 6174 6820 3d20 272e 270a       path = '.'.
-00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019740: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
-00019750: 706c 616e 656e 7472 790a 2020 2020 2020  planentry.      
-00019760: 2020 2020 2020 2020 2020 6966 206e 6f5f            if no_
-00019770: 6f76 6572 7269 6465 7320 616e 6420 7061  overrides and pa
-00019780: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
-00019790: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-000197a0: 7269 6e74 2822 5573 696e 6720 7061 7261  rint("Using para
-000197b0: 6d65 7465 7273 2066 726f 6d20 6661 7468  meters from fath
-000197c0: 6572 2070 6c61 6e20 696e 2063 6869 6c64  er plan in child
-000197d0: 206f 6e65 7322 290a 2020 2020 2020 2020   ones").        
-000197e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000197f0: 6f76 6572 7269 6465 2069 6e20 6f76 6572  override in over
-00019800: 7269 6465 733a 0a20 2020 2020 2020 2020  rides:.         
-00019810: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019820: 7269 6e74 2822 5573 696e 6720 7061 7261  rint("Using para
-00019830: 6d65 7465 7220 2573 3a20 2573 2220 2520  meter %s: %s" % 
-00019840: 286f 7665 7272 6964 652c 206f 7665 7272  (override, overr
-00019850: 6964 6573 5b6f 7665 7272 6964 655d 2929  ides[override]))
-00019860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019870: 2073 656c 662e 706c 616e 2870 6c61 6e2c   self.plan(plan,
-00019880: 2061 6e73 6962 6c65 3d46 616c 7365 2c20   ansible=False, 
-00019890: 7572 6c3d 706c 616e 7572 6c2c 2070 6174  url=planurl, pat
-000198a0: 683d 7061 7468 2c20 636f 6e74 6169 6e65  h=path, containe
-000198b0: 723d 4661 6c73 652c 2069 6e70 7574 6669  r=False, inputfi
-000198c0: 6c65 3d69 6e70 7574 6669 6c65 2c0a 2020  le=inputfile,.  
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
-000198f0: 733d 6f76 6572 7269 6465 732c 2065 6d62  s=overrides, emb
-00019900: 6564 6465 643d 656d 6265 6464 6564 2c20  edded=embedded, 
-00019910: 646f 776e 6c6f 6164 3d64 6f77 6e6c 6f61  download=downloa
-00019920: 6429 0a20 2020 2020 2020 2069 6620 6b75  d).        if ku
-00019930: 6265 656e 7472 6965 7320 616e 6420 6e6f  beentries and no
-00019940: 7420 6f6e 6c79 6173 7365 7473 3a0a 2020  t onlyassets:.  
-00019950: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00019960: 2822 4465 706c 6f79 696e 6720 4b75 6265  ("Deploying Kube
-00019970: 2045 6e74 7269 6573 2e2e 2e22 290a 2020   Entries...").  
-00019980: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
-00019990: 656e 7473 203d 207b 7d0a 2020 2020 2020  ents = {}.      
-000199a0: 2020 2020 2020 6b75 6265 7468 7265 6164        kubethread
-000199b0: 6564 203d 2054 7275 6520 6966 206c 656e  ed = True if len
-000199c0: 286b 7562 6565 6e74 7269 6573 2920 3e20  (kubeentries) > 
-000199d0: 3120 656c 7365 2046 616c 7365 0a20 2020  1 else False.   
-000199e0: 2020 2020 2020 2020 2069 6620 6b75 6265           if kube
-000199f0: 7468 7265 6164 6564 3a0a 2020 2020 2020  threaded:.      
-00019a00: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00019a10: 6728 224c 6175 6e63 6869 6e67 2065 6163  g("Launching eac
-00019a20: 6820 636c 7573 7465 7220 696e 2061 2074  h cluster in a t
-00019a30: 6872 6561 6420 6173 2074 6865 7265 2069  hread as there i
-00019a40: 7320 6d6f 7265 2074 6861 6e20 6f6e 6520  s more than one 
-00019a50: 656e 7472 792e 2e2e 2229 0a20 2020 2020  entry...").     
-00019a60: 2020 2020 2020 2066 6f72 2063 6c75 7374         for clust
-00019a70: 6572 2069 6e20 6b75 6265 656e 7472 6965  er in kubeentrie
-00019a80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00019a90: 2020 2070 7072 696e 7428 6622 4465 706c     pprint(f"Depl
-00019aa0: 6f79 696e 6720 436c 7573 7465 7220 7b63  oying Cluster {c
-00019ab0: 6c75 7374 6572 7d2e 2e2e 2229 0a20 2020  luster}...").   
-00019ac0: 2020 2020 2020 2020 2020 2020 206b 7562               kub
-00019ad0: 6570 726f 6669 6c65 203d 2065 6e74 7269  eprofile = entri
-00019ae0: 6573 5b63 6c75 7374 6572 5d0a 2020 2020  es[cluster].    
-00019af0: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-00019b00: 636c 6965 6e74 203d 206b 7562 6570 726f  client = kubepro
-00019b10: 6669 6c65 2e67 6574 2827 636c 6965 6e74  file.get('client
-00019b20: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00019b30: 2020 2069 6620 6b75 6265 636c 6965 6e74     if kubeclient
-00019b40: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00019b50: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00019b60: 7272 656e 7463 6f6e 6669 6720 3d20 7365  rrentconfig = se
-00019b70: 6c66 0a20 2020 2020 2020 2020 2020 2020  lf.             
-00019b80: 2020 2065 6c69 6620 6b75 6265 636c 6965     elif kubeclie
-00019b90: 6e74 2069 6e20 7365 6c66 2e63 6c69 656e  nt in self.clien
-00019ba0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00019bb0: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
-00019bc0: 6f6e 6669 6720 3d20 4b63 6f6e 6669 6728  onfig = Kconfig(
-00019bd0: 636c 6965 6e74 3d6b 7562 6563 6c69 656e  client=kubeclien
-00019be0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00019bf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00019c00: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00019c10: 6f72 2866 2243 6c69 656e 7420 7b6b 7562  or(f"Client {kub
-00019c20: 6563 6c69 656e 747d 206e 6f74 2066 6f75  eclient} not fou
-00019c30: 6e64 2e20 736b 6970 7065 6422 290a 2020  nd. skipped").  
-00019c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c50: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00019c60: 2020 2020 2020 2020 2020 206b 7562 6574             kubet
-00019c70: 7970 6520 3d20 6b75 6265 7072 6f66 696c  ype = kubeprofil
-00019c80: 652e 6765 7428 276b 7562 6574 7970 6527  e.get('kubetype'
-00019c90: 2920 6f72 206b 7562 6570 726f 6669 6c65  ) or kubeprofile
-00019ca0: 2e67 6574 2827 636c 7573 7465 7274 7970  .get('clustertyp
-00019cb0: 6527 2c20 2767 656e 6572 6963 2729 0a20  e', 'generic'). 
-00019cc0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00019cd0: 7562 655f 6f76 6572 7269 6465 7320 3d20  ube_overrides = 
-00019ce0: 6f76 6572 7269 6465 732e 636f 7079 2829  overrides.copy()
-00019cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019d00: 206b 7562 655f 6f76 6572 7269 6465 732e   kube_overrides.
-00019d10: 7570 6461 7465 286b 7562 6570 726f 6669  update(kubeprofi
-00019d20: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00019d30: 2020 2020 6b75 6265 5f6f 7665 7272 6964      kube_overrid
-00019d40: 6573 5b27 636c 7573 7465 7227 5d20 3d20  es['cluster'] = 
-00019d50: 636c 7573 7465 720a 2020 2020 2020 2020  cluster.        
-00019d60: 2020 2020 2020 2020 6578 6973 7469 6e67          existing
-00019d70: 5f63 746c 706c 616e 6573 203d 205b 7620  _ctlplanes = [v 
-00019d80: 666f 7220 7620 696e 2063 7572 7265 6e74  for v in current
-00019d90: 636f 6e66 6967 2e6b 2e6c 6973 7428 2920  config.k.list() 
-00019da0: 6966 2066 277b 636c 7573 7465 727d 2d63  if f'{cluster}-c
-00019db0: 746c 706c 616e 6527 2069 6e20 765b 276e  tlplane' in v['n
-00019dc0: 616d 6527 5d5d 0a20 2020 2020 2020 2020  ame']].         
-00019dd0: 2020 2020 2020 2069 6620 6578 6973 7469         if existi
-00019de0: 6e67 5f63 746c 706c 616e 6573 3a0a 2020  ng_ctlplanes:.  
-00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e00: 2020 7070 7269 6e74 2866 2243 6c75 7374    pprint(f"Clust
-00019e10: 6572 207b 636c 7573 7465 727d 2066 6f75  er {cluster} fou
-00019e20: 6e64 2e20 736b 6970 7065 6421 2229 0a20  nd. skipped!"). 
-00019e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e40: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00019e50: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00019e60: 7562 6574 7970 6520 6e6f 7420 696e 205b  ubetype not in [
-00019e70: 2767 656e 6572 6963 272c 2027 6f70 656e  'generic', 'open
-00019e80: 7368 6966 7427 2c20 2768 7970 6572 7368  shift', 'hypersh
-00019e90: 6966 7427 2c20 276b 696e 6427 2c20 276d  ift', 'kind', 'm
-00019ea0: 6963 726f 7368 6966 7427 2c20 276b 3373  icroshift', 'k3s
-00019eb0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00019ec0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00019ed0: 6622 496e 636f 7272 6563 7420 6b75 6265  f"Incorrect kube
-00019ee0: 7479 7065 207b 6b75 6265 7479 7065 7d20  type {kubetype} 
-00019ef0: 7370 6563 6966 6965 642e 2073 6b69 7070  specified. skipp
-00019f00: 6564 2122 290a 2020 2020 2020 2020 2020  ed!").          
-00019f10: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00019f20: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00019f30: 2020 2069 6620 6b75 6265 7468 7265 6164     if kubethread
-00019f40: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00019f50: 2020 2020 2020 2020 6b75 6265 5f6f 7665          kube_ove
-00019f60: 7272 6964 6573 5b27 7573 655f 6578 6973  rrides['use_exis
-00019f70: 7469 6e67 5f6f 7065 6e73 6869 6674 275d  ting_openshift']
-00019f80: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00019f90: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00019fa0: 6172 6773 203d 2028 706c 616e 2c20 6b75  args = (plan, ku
-00019fb0: 6265 7479 7065 2c20 6b75 6265 5f6f 7665  betype, kube_ove
-00019fc0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
-00019fd0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-00019fe0: 7468 7265 6164 696e 672e 5468 7265 6164  threading.Thread
-00019ff0: 2874 6172 6765 743d 7365 6c66 2e74 6872  (target=self.thr
-0001a000: 6561 6465 645f 6372 6561 7465 5f6b 7562  eaded_create_kub
-0001a010: 652c 2061 7267 733d 6e65 775f 6172 6773  e, args=new_args
-0001a020: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a030: 2020 2020 2020 7468 7265 6164 732e 6170        threads.ap
-0001a040: 7065 6e64 2874 290a 2020 2020 2020 2020  pend(t).        
-0001a050: 2020 2020 2020 2020 2020 2020 742e 7374              t.st
-0001a060: 6172 7428 290a 2020 2020 2020 2020 2020  art().          
-0001a070: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a090: 6375 7272 656e 7463 6f6e 6669 672e 6372  currentconfig.cr
-0001a0a0: 6561 7465 5f6b 7562 6528 706c 616e 2c20  eate_kube(plan, 
-0001a0b0: 6b75 6265 7479 7065 2c20 6f76 6572 7269  kubetype, overri
-0001a0c0: 6465 733d 6b75 6265 5f6f 7665 7272 6964  des=kube_overrid
-0001a0d0: 6573 290a 2020 2020 2020 2020 766d 636c  es).        vmcl
-0001a0e0: 6965 6e74 7320 3d20 5b5d 0a20 2020 2020  ients = [].     
-0001a0f0: 2020 2069 6620 766d 656e 7472 6965 733a     if vmentries:
-0001a100: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001a110: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
-0001a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a130: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-0001a140: 6720 566d 732e 2e2e 2229 0a20 2020 2020  g Vms...").     
-0001a150: 2020 2020 2020 2076 6d63 6f75 6e74 6572         vmcounter
-0001a160: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0001a170: 2068 6f73 7473 203d 207b 7d0a 2020 2020   hosts = {}.    
-0001a180: 2020 2020 2020 2020 766d 735f 746f 5f68          vms_to_h
-0001a190: 6f73 7420 3d20 7b7d 0a20 2020 2020 2020  ost = {}.       
-0001a1a0: 2020 2020 2062 6173 6570 6c61 6e73 203d       baseplans =
-0001a1b0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0001a1c0: 766d 6e61 6d65 7320 3d20 5b6e 616d 6520  vmnames = [name 
-0001a1d0: 666f 7220 6e61 6d65 2069 6e20 766d 656e  for name in vmen
-0001a1e0: 7472 6965 735d 0a20 2020 2020 2020 2020  tries].         
-0001a1f0: 2020 2069 6620 6261 7365 6669 6c65 2069     if basefile i
-0001a200: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0001a210: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001a220: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-0001a230: 726e 616d 6528 696e 7075 7466 696c 6529  rname(inputfile)
-0001a240: 2069 6620 6f73 2e70 6174 682e 6973 6162   if os.path.isab
-0001a250: 7328 696e 7075 7466 696c 6529 2065 6c73  s(inputfile) els
-0001a260: 6520 272e 270a 2020 2020 2020 2020 2020  e '.'.          
-0001a270: 2020 2020 2020 6261 7365 696e 7075 7466        baseinputf
-0001a280: 696c 6520 3d20 6622 7b62 6173 6564 6972  ile = f"{basedir
-0001a290: 7d2f 7b62 6173 6566 696c 657d 220a 2020  }/{basefile}".  
-0001a2a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001a2b0: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
-0001a2c0: 2920 616e 6420 6e6f 7420 6f73 2e70 6174  ) and not os.pat
-0001a2d0: 682e 6973 6162 7328 6261 7365 6669 6c65  h.isabs(basefile
-0001a2e0: 2920 616e 6420 272f 776f 726b 6469 7227  ) and '/workdir'
-0001a2f0: 206e 6f74 2069 6e20 6261 7365 6469 723a   not in basedir:
-0001a300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a310: 2020 2020 2062 6173 6569 6e70 7574 6669       baseinputfi
-0001a320: 6c65 203d 2066 222f 776f 726b 6469 722f  le = f"/workdir/
-0001a330: 7b62 6173 6564 6972 7d2f 7b62 6173 6566  {basedir}/{basef
-0001a340: 696c 657d 220a 2020 2020 2020 2020 2020  ile}".          
-0001a350: 2020 2020 2020 7365 6c66 2e70 6c61 6e28        self.plan(
-0001a360: 706c 616e 2c20 696e 7075 7466 696c 653d  plan, inputfile=
-0001a370: 6261 7365 696e 7075 7466 696c 652c 206f  baseinputfile, o
-0001a380: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-0001a390: 6573 2c20 6578 636c 7564 6576 6d73 3d76  es, excludevms=v
-0001a3a0: 6d6e 616d 6573 2c20 6261 7365 6d6f 6465  mnames, basemode
-0001a3b0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-0001a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3d0: 206f 6e6c 7961 7373 6574 733d 6f6e 6c79   onlyassets=only
-0001a3e0: 6173 7365 7473 290a 2020 2020 2020 2020  assets).        
-0001a3f0: 2020 2020 2020 2020 6261 7365 706c 616e          baseplan
-0001a400: 732e 6170 7065 6e64 2862 6173 6566 696c  s.append(basefil
-0001a410: 6529 0a20 2020 2020 2020 2020 2020 2076  e).            v
-0001a420: 6d72 756c 6573 5f73 7472 6963 7420 3d20  mrules_strict = 
-0001a430: 6f76 6572 7269 6465 732e 6765 7428 2776  overrides.get('v
-0001a440: 6d72 756c 6573 5f73 7472 6963 7427 2c20  mrules_strict', 
-0001a450: 7365 6c66 2e76 6d72 756c 6573 5f73 7472  self.vmrules_str
-0001a460: 6963 7429 0a20 2020 2020 2020 2020 2020  ict).           
-0001a470: 2066 6f72 206e 616d 6520 696e 2076 6d65   for name in vme
-0001a480: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-0001a490: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-0001a4a0: 696e 2065 7863 6c75 6465 766d 733a 0a20  in excludevms:. 
-0001a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4c0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001a4d0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001a4e0: 656e 7470 6c61 6e64 6972 203d 2062 6173  entplandir = bas
-0001a4f0: 6564 6972 0a20 2020 2020 2020 2020 2020  edir.           
-0001a500: 2020 2020 2069 6620 6c65 6e28 766d 656e       if len(vmen
-0001a510: 7472 6965 7329 203d 3d20 3120 616e 6420  tries) == 1 and 
-0001a520: 276e 616d 6527 2069 6e20 6f76 6572 7269  'name' in overri
-0001a530: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
-0001a540: 2020 2020 2020 2020 206e 6577 6e61 6d65           newname
-0001a550: 203d 206f 7665 7272 6964 6573 5b27 6e61   = overrides['na
-0001a560: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-0001a570: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001a580: 203d 2065 6e74 7269 6573 5b6e 616d 655d   = entries[name]
-0001a590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a5a0: 2020 2020 206e 616d 6520 3d20 6e65 776e       name = newn
-0001a5b0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0001a5c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a5d0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001a5e0: 6f66 696c 6520 3d20 656e 7472 6965 735b  ofile = entries[
-0001a5f0: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
-0001a600: 2020 2020 2020 6966 2027 6e61 6d65 2720        if 'name' 
-0001a610: 696e 2070 726f 6669 6c65 3a0a 2020 2020  in profile:.    
+00019720: 2020 2020 2069 6e70 7574 6669 6c65 203d       inputfile =
+00019730: 2070 6c61 6e65 6e74 7279 0a20 2020 2020   planentry.     
+00019740: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00019750: 5f6f 7665 7272 6964 6573 2061 6e64 2070  _overrides and p
+00019760: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
+00019770: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019780: 7072 696e 7428 2255 7369 6e67 2070 6172  print("Using par
+00019790: 616d 6574 6572 7320 6672 6f6d 2066 6174  ameters from fat
+000197a0: 6865 7220 706c 616e 2069 6e20 6368 696c  her plan in chil
+000197b0: 6420 6f6e 6573 2229 0a20 2020 2020 2020  d ones").       
+000197c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000197d0: 206f 7665 7272 6964 6520 696e 206f 7665   override in ove
+000197e0: 7272 6964 6573 3a0a 2020 2020 2020 2020  rrides:.        
+000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019800: 7072 696e 7428 2255 7369 6e67 2070 6172  print("Using par
+00019810: 616d 6574 6572 2025 733a 2025 7322 2025  ameter %s: %s" %
+00019820: 2028 6f76 6572 7269 6465 2c20 6f76 6572   (override, over
+00019830: 7269 6465 735b 6f76 6572 7269 6465 5d29  rides[override])
+00019840: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019850: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
+00019860: 2c20 616e 7369 626c 653d 4661 6c73 652c  , ansible=False,
+00019870: 2075 726c 3d70 6c61 6e75 726c 2c20 7061   url=planurl, pa
+00019880: 7468 3d70 6174 682c 2063 6f6e 7461 696e  th=path, contain
+00019890: 6572 3d46 616c 7365 2c20 696e 7075 7466  er=False, inputf
+000198a0: 696c 653d 696e 7075 7466 696c 652c 0a20  ile=inputfile,. 
+000198b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198c0: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
+000198d0: 6573 3d6f 7665 7272 6964 6573 2c20 656d  es=overrides, em
+000198e0: 6265 6464 6564 3d65 6d62 6564 6465 642c  bedded=embedded,
+000198f0: 2064 6f77 6e6c 6f61 643d 646f 776e 6c6f   download=downlo
+00019900: 6164 290a 2020 2020 2020 2020 6966 206b  ad).        if k
+00019910: 7562 6565 6e74 7269 6573 2061 6e64 206e  ubeentries and n
+00019920: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
+00019930: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00019940: 7428 2244 6570 6c6f 7969 6e67 204b 7562  t("Deploying Kub
+00019950: 6520 456e 7472 6965 732e 2e2e 2229 0a20  e Entries..."). 
+00019960: 2020 2020 2020 2020 2020 2064 6e73 636c             dnscl
+00019970: 6965 6e74 7320 3d20 7b7d 0a20 2020 2020  ients = {}.     
+00019980: 2020 2020 2020 206b 7562 6574 6872 6561         kubethrea
+00019990: 6465 6420 3d20 5472 7565 2069 6620 6c65  ded = True if le
+000199a0: 6e28 6b75 6265 656e 7472 6965 7329 203e  n(kubeentries) >
+000199b0: 2031 2065 6c73 6520 4661 6c73 650a 2020   1 else False.  
+000199c0: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
+000199d0: 6574 6872 6561 6465 643a 0a20 2020 2020  ethreaded:.     
+000199e0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+000199f0: 6e67 2822 4c61 756e 6368 696e 6720 6561  ng("Launching ea
+00019a00: 6368 2063 6c75 7374 6572 2069 6e20 6120  ch cluster in a 
+00019a10: 7468 7265 6164 2061 7320 7468 6572 6520  thread as there 
+00019a20: 6973 206d 6f72 6520 7468 616e 206f 6e65  is more than one
+00019a30: 2065 6e74 7279 2e2e 2e22 290a 2020 2020   entry...").    
+00019a40: 2020 2020 2020 2020 666f 7220 636c 7573          for clus
+00019a50: 7465 7220 696e 206b 7562 6565 6e74 7269  ter in kubeentri
+00019a60: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00019a70: 2020 2020 7070 7269 6e74 2866 2244 6570      pprint(f"Dep
+00019a80: 6c6f 7969 6e67 2043 6c75 7374 6572 207b  loying Cluster {
+00019a90: 636c 7573 7465 727d 2e2e 2e22 290a 2020  cluster}...").  
+00019aa0: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
+00019ab0: 6265 7072 6f66 696c 6520 3d20 656e 7472  beprofile = entr
+00019ac0: 6965 735b 636c 7573 7465 725d 0a20 2020  ies[cluster].   
+00019ad0: 2020 2020 2020 2020 2020 2020 206b 7562               kub
+00019ae0: 6563 6c69 656e 7420 3d20 6b75 6265 7072  eclient = kubepr
+00019af0: 6f66 696c 652e 6765 7428 2763 6c69 656e  ofile.get('clien
+00019b00: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00019b10: 2020 2020 6966 206b 7562 6563 6c69 656e      if kubeclien
+00019b20: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+00019b30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00019b40: 7572 7265 6e74 636f 6e66 6967 203d 2073  urrentconfig = s
+00019b50: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
+00019b60: 2020 2020 656c 6966 206b 7562 6563 6c69      elif kubecli
+00019b70: 656e 7420 696e 2073 656c 662e 636c 6965  ent in self.clie
+00019b80: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00019b90: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00019ba0: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
+00019bb0: 2863 6c69 656e 743d 6b75 6265 636c 6965  (client=kubeclie
+00019bc0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+00019bd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019be0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00019bf0: 726f 7228 6622 436c 6965 6e74 207b 6b75  ror(f"Client {ku
+00019c00: 6265 636c 6965 6e74 7d20 6e6f 7420 666f  beclient} not fo
+00019c10: 756e 642e 2073 6b69 7070 6564 2229 0a20  und. skipped"). 
+00019c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c30: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00019c40: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00019c50: 7479 7065 203d 206b 7562 6570 726f 6669  type = kubeprofi
+00019c60: 6c65 2e67 6574 2827 6b75 6265 7479 7065  le.get('kubetype
+00019c70: 2729 206f 7220 6b75 6265 7072 6f66 696c  ') or kubeprofil
+00019c80: 652e 6765 7428 2763 6c75 7374 6572 7479  e.get('clusterty
+00019c90: 7065 272c 2027 6765 6e65 7269 6327 290a  pe', 'generic').
+00019ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cb0: 6b75 6265 5f6f 7665 7272 6964 6573 203d  kube_overrides =
+00019cc0: 206f 7665 7272 6964 6573 2e63 6f70 7928   overrides.copy(
+00019cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019ce0: 2020 6b75 6265 5f6f 7665 7272 6964 6573    kube_overrides
+00019cf0: 2e75 7064 6174 6528 6b75 6265 7072 6f66  .update(kubeprof
+00019d00: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00019d10: 2020 2020 206b 7562 655f 6f76 6572 7269       kube_overri
+00019d20: 6465 735b 2763 6c75 7374 6572 275d 203d  des['cluster'] =
+00019d30: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
+00019d40: 2020 2020 2020 2020 2065 7869 7374 696e           existin
+00019d50: 675f 6374 6c70 6c61 6e65 7320 3d20 5b76  g_ctlplanes = [v
+00019d60: 2066 6f72 2076 2069 6e20 6375 7272 656e   for v in curren
+00019d70: 7463 6f6e 6669 672e 6b2e 6c69 7374 2829  tconfig.k.list()
+00019d80: 2069 6620 6627 7b63 6c75 7374 6572 7d2d   if f'{cluster}-
+00019d90: 6374 6c70 6c61 6e65 2720 696e 2076 5b27  ctlplane' in v['
+00019da0: 6e61 6d65 275d 5d0a 2020 2020 2020 2020  name']].        
+00019db0: 2020 2020 2020 2020 6966 2065 7869 7374          if exist
+00019dc0: 696e 675f 6374 6c70 6c61 6e65 733a 0a20  ing_ctlplanes:. 
+00019dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019de0: 2020 2070 7072 696e 7428 6622 436c 7573     pprint(f"Clus
+00019df0: 7465 7220 7b63 6c75 7374 6572 7d20 666f  ter {cluster} fo
+00019e00: 756e 642e 2073 6b69 7070 6564 2122 290a  und. skipped!").
+00019e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e20: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00019e30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019e40: 6b75 6265 7479 7065 206e 6f74 2069 6e20  kubetype not in 
+00019e50: 5b27 6765 6e65 7269 6327 2c20 276f 7065  ['generic', 'ope
+00019e60: 6e73 6869 6674 272c 2027 6879 7065 7273  nshift', 'hypers
+00019e70: 6869 6674 272c 2027 6d69 6372 6f73 6869  hift', 'microshi
+00019e80: 6674 272c 2027 6b33 7327 5d3a 0a20 2020  ft', 'k3s']:.   
+00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ea0: 2077 6172 6e69 6e67 2866 2249 6e63 6f72   warning(f"Incor
+00019eb0: 7265 6374 206b 7562 6574 7970 6520 7b6b  rect kubetype {k
+00019ec0: 7562 6574 7970 657d 2073 7065 6369 6669  ubetype} specifi
+00019ed0: 6564 2e20 736b 6970 7065 6421 2229 0a20  ed. skipped!"). 
+00019ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ef0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00019f00: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00019f10: 7562 6574 6872 6561 6465 643a 0a20 2020  ubethreaded:.   
+00019f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f30: 206b 7562 655f 6f76 6572 7269 6465 735b   kube_overrides[
+00019f40: 2775 7365 5f65 7869 7374 696e 675f 6f70  'use_existing_op
+00019f50: 656e 7368 6966 7427 5d20 3d20 5472 7565  enshift'] = True
+00019f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019f70: 2020 2020 206e 6577 5f61 7267 7320 3d20       new_args = 
+00019f80: 2870 6c61 6e2c 206b 7562 6574 7970 652c  (plan, kubetype,
+00019f90: 206b 7562 655f 6f76 6572 7269 6465 7329   kube_overrides)
+00019fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019fb0: 2020 2020 2074 203d 2074 6872 6561 6469       t = threadi
+00019fc0: 6e67 2e54 6872 6561 6428 7461 7267 6574  ng.Thread(target
+00019fd0: 3d73 656c 662e 7468 7265 6164 6564 5f63  =self.threaded_c
+00019fe0: 7265 6174 655f 6b75 6265 2c20 6172 6773  reate_kube, args
+00019ff0: 3d6e 6577 5f61 7267 7329 0a20 2020 2020  =new_args).     
+0001a000: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001a010: 6872 6561 6473 2e61 7070 656e 6428 7429  hreads.append(t)
+0001a020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a030: 2020 2020 2074 2e73 7461 7274 2829 0a20       t.start(). 
+0001a040: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a050: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a060: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001a070: 636f 6e66 6967 2e63 7265 6174 655f 6b75  config.create_ku
+0001a080: 6265 2870 6c61 6e2c 206b 7562 6574 7970  be(plan, kubetyp
+0001a090: 652c 206f 7665 7272 6964 6573 3d6b 7562  e, overrides=kub
+0001a0a0: 655f 6f76 6572 7269 6465 7329 0a20 2020  e_overrides).   
+0001a0b0: 2020 2020 2076 6d63 6c69 656e 7473 203d       vmclients =
+0001a0c0: 205b 5d0a 2020 2020 2020 2020 6966 2076   [].        if v
+0001a0d0: 6d65 6e74 7269 6573 3a0a 2020 2020 2020  mentries:.      
+0001a0e0: 2020 2020 2020 6966 206e 6f74 206f 6e6c        if not onl
+0001a0f0: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
+0001a100: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0001a110: 2244 6570 6c6f 7969 6e67 2056 6d73 2e2e  "Deploying Vms..
+0001a120: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001a130: 766d 636f 756e 7465 7220 3d20 300a 2020  vmcounter = 0.  
+0001a140: 2020 2020 2020 2020 2020 686f 7374 7320            hosts 
+0001a150: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0001a160: 2076 6d73 5f74 6f5f 686f 7374 203d 207b   vms_to_host = {
+0001a170: 7d0a 2020 2020 2020 2020 2020 2020 6261  }.            ba
+0001a180: 7365 706c 616e 7320 3d20 5b5d 0a20 2020  seplans = [].   
+0001a190: 2020 2020 2020 2020 2076 6d6e 616d 6573           vmnames
+0001a1a0: 203d 205b 6e61 6d65 2066 6f72 206e 616d   = [name for nam
+0001a1b0: 6520 696e 2076 6d65 6e74 7269 6573 5d0a  e in vmentries].
+0001a1c0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+0001a1d0: 6173 6566 696c 6520 6973 206e 6f74 204e  asefile is not N
+0001a1e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001a1f0: 2020 2020 2062 6173 6564 6972 203d 206f       basedir = o
+0001a200: 732e 7061 7468 2e64 6972 6e61 6d65 2869  s.path.dirname(i
+0001a210: 6e70 7574 6669 6c65 2920 6966 206f 732e  nputfile) if os.
+0001a220: 7061 7468 2e69 7361 6273 2869 6e70 7574  path.isabs(input
+0001a230: 6669 6c65 2920 656c 7365 2027 2e27 0a20  file) else '.'. 
+0001a240: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001a250: 6173 6569 6e70 7574 6669 6c65 203d 2066  aseinputfile = f
+0001a260: 227b 6261 7365 6469 727d 2f7b 6261 7365  "{basedir}/{base
+0001a270: 6669 6c65 7d22 0a20 2020 2020 2020 2020  file}".         
+0001a280: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
+0001a290: 6e65 725f 6d6f 6465 2829 2061 6e64 206e  ner_mode() and n
+0001a2a0: 6f74 206f 732e 7061 7468 2e69 7361 6273  ot os.path.isabs
+0001a2b0: 2862 6173 6566 696c 6529 2061 6e64 2027  (basefile) and '
+0001a2c0: 2f77 6f72 6b64 6972 2720 6e6f 7420 696e  /workdir' not in
+0001a2d0: 2062 6173 6564 6972 3a0a 2020 2020 2020   basedir:.      
+0001a2e0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001a2f0: 7365 696e 7075 7466 696c 6520 3d20 6622  seinputfile = f"
+0001a300: 2f77 6f72 6b64 6972 2f7b 6261 7365 6469  /workdir/{basedi
+0001a310: 727d 2f7b 6261 7365 6669 6c65 7d22 0a20  r}/{basefile}". 
+0001a320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a330: 656c 662e 706c 616e 2870 6c61 6e2c 2069  elf.plan(plan, i
+0001a340: 6e70 7574 6669 6c65 3d62 6173 6569 6e70  nputfile=baseinp
+0001a350: 7574 6669 6c65 2c20 6f76 6572 7269 6465  utfile, override
+0001a360: 733d 6f76 6572 7269 6465 732c 2065 7863  s=overrides, exc
+0001a370: 6c75 6465 766d 733d 766d 6e61 6d65 732c  ludevms=vmnames,
+0001a380: 2062 6173 656d 6f64 653d 5472 7565 2c0a   basemode=True,.
+0001a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3a0: 2020 2020 2020 2020 2020 6f6e 6c79 6173            onlyas
+0001a3b0: 7365 7473 3d6f 6e6c 7961 7373 6574 7329  sets=onlyassets)
+0001a3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a3d0: 2062 6173 6570 6c61 6e73 2e61 7070 656e   baseplans.appen
+0001a3e0: 6428 6261 7365 6669 6c65 290a 2020 2020  d(basefile).    
+0001a3f0: 2020 2020 2020 2020 766d 7275 6c65 735f          vmrules_
+0001a400: 7374 7269 6374 203d 206f 7665 7272 6964  strict = overrid
+0001a410: 6573 2e67 6574 2827 766d 7275 6c65 735f  es.get('vmrules_
+0001a420: 7374 7269 6374 272c 2073 656c 662e 766d  strict', self.vm
+0001a430: 7275 6c65 735f 7374 7269 6374 290a 2020  rules_strict).  
+0001a440: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
+0001a450: 6d65 2069 6e20 766d 656e 7472 6965 733a  me in vmentries:
+0001a460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a470: 2069 6620 6e61 6d65 2069 6e20 6578 636c   if name in excl
+0001a480: 7564 6576 6d73 3a0a 2020 2020 2020 2020  udevms:.        
+0001a490: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001a4a0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001a4b0: 2020 2020 2063 7572 7265 6e74 706c 616e       currentplan
+0001a4c0: 6469 7220 3d20 6261 7365 6469 720a 2020  dir = basedir.  
+0001a4d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001a4e0: 206c 656e 2876 6d65 6e74 7269 6573 2920   len(vmentries) 
+0001a4f0: 3d3d 2031 2061 6e64 2027 6e61 6d65 2720  == 1 and 'name' 
+0001a500: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
+0001a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a520: 2020 6e65 776e 616d 6520 3d20 6f76 6572    newname = over
+0001a530: 7269 6465 735b 276e 616d 6527 5d0a 2020  rides['name'].  
+0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a550: 2020 7072 6f66 696c 6520 3d20 656e 7472    profile = entr
+0001a560: 6965 735b 6e61 6d65 5d0a 2020 2020 2020  ies[name].      
+0001a570: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0001a580: 6d65 203d 206e 6577 6e61 6d65 0a20 2020  me = newname.   
+0001a590: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001a5a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001a5b0: 2020 2020 2020 2070 726f 6669 6c65 203d         profile =
+0001a5c0: 2065 6e74 7269 6573 5b6e 616d 655d 0a20   entries[name]. 
+0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a5e0: 6620 276e 616d 6527 2069 6e20 7072 6f66  f 'name' in prof
+0001a5f0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001a600: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+0001a610: 7072 6f66 696c 655b 276e 616d 6527 5d0a  profile['name'].
 0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 6e61 6d65 203d 2070 726f 6669 6c65 5b27  name = profile['
-0001a640: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
-0001a650: 2020 2020 2020 2069 6620 2762 6173 6576         if 'basev
-0001a660: 6d27 2069 6e20 7072 6f66 696c 6520 6f72  m' in profile or
-0001a670: 2027 6261 7365 706c 616e 2720 696e 2070   'baseplan' in p
-0001a680: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
-0001a690: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001a6a0: 7072 6f66 696c 6520 3d20 7b7d 0a20 2020  profile = {}.   
-0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2061 7070 656e 646b 6579 7320 3d20 5b27   appendkeys = ['
-0001a6d0: 6469 736b 7327 2c20 276e 6574 7327 2c20  disks', 'nets', 
-0001a6e0: 2766 696c 6573 272c 2027 7363 7269 7074  'files', 'script
-0001a6f0: 7327 2c20 2763 6d64 7327 5d0a 2020 2020  s', 'cmds'].    
-0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a710: 6966 2027 6261 7365 706c 616e 2720 696e  if 'baseplan' in
-0001a720: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
-0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a740: 2020 6261 7365 706c 616e 203d 2070 726f    baseplan = pro
-0001a750: 6669 6c65 5b27 6261 7365 706c 616e 275d  file['baseplan']
-0001a760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a770: 2020 2020 2020 2020 2062 6173 6564 6972           basedir
-0001a780: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0001a790: 6d65 2869 6e70 7574 6669 6c65 2920 6966  me(inputfile) if
-0001a7a0: 2027 2f27 2069 6e20 696e 7075 7466 696c   '/' in inputfil
-0001a7b0: 6520 656c 7365 2027 2e27 0a20 2020 2020  e else '.'.     
-0001a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7d0: 2020 2062 6173 6569 6e70 7574 6669 6c65     baseinputfile
-0001a7e0: 203d 2066 227b 6261 7365 6469 727d 2f7b   = f"{basedir}/{
-0001a7f0: 6261 7365 706c 616e 7d22 0a20 2020 2020  baseplan}".     
-0001a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a810: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
-0001a820: 6d6f 6465 2829 2061 6e64 206e 6f74 206f  mode() and not o
-0001a830: 732e 7061 7468 2e69 7361 6273 2862 6173  s.path.isabs(bas
-0001a840: 6570 6c61 6e29 2061 6e64 2027 2f77 6f72  eplan) and '/wor
-0001a850: 6b64 6972 2720 6e6f 7420 696e 2062 6173  kdir' not in bas
-0001a860: 6564 6972 3a0a 2020 2020 2020 2020 2020  edir:.          
-0001a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a880: 2020 6261 7365 696e 7075 7466 696c 6520    baseinputfile 
-0001a890: 3d20 6622 2f77 6f72 6b64 6972 2f7b 6261  = f"/workdir/{ba
-0001a8a0: 7365 6469 727d 2f7b 6261 7365 706c 616e  sedir}/{baseplan
-0001a8b0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0001a8c0: 2020 2020 2020 2020 2020 2062 6173 6576             basev
-0001a8d0: 6d20 3d20 7072 6f66 696c 655b 2762 6173  m = profile['bas
-0001a8e0: 6576 6d27 5d20 6966 2027 6261 7365 766d  evm'] if 'basevm
-0001a8f0: 2720 696e 2070 726f 6669 6c65 2065 6c73  ' in profile els
-0001a900: 6520 6e61 6d65 0a20 2020 2020 2020 2020  e name.         
-0001a910: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a920: 6620 6261 7365 706c 616e 206e 6f74 2069  f baseplan not i
-0001a930: 6e20 6261 7365 706c 616e 733a 0a20 2020  n baseplans:.   
-0001a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a950: 2020 2020 2020 2020 2073 656c 662e 706c           self.pl
-0001a960: 616e 2870 6c61 6e2c 2069 6e70 7574 6669  an(plan, inputfi
-0001a970: 6c65 3d62 6173 6569 6e70 7574 6669 6c65  le=baseinputfile
-0001a980: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-0001a990: 7269 6465 732c 2065 7863 6c75 6465 766d  rides, excludevm
-0001a9a0: 733d 766d 6e61 6d65 732c 0a20 2020 2020  s=vmnames,.     
-0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9d0: 2062 6173 656d 6f64 653d 5472 7565 2c20   basemode=True, 
-0001a9e0: 6f6e 6c79 6173 7365 7473 3d6f 6e6c 7961  onlyassets=onlya
-0001a9f0: 7373 6574 7329 0a20 2020 2020 2020 2020  ssets).         
-0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa10: 2020 2062 6173 6570 6c61 6e73 2e61 7070     baseplans.app
-0001aa20: 656e 6428 6261 7365 706c 616e 290a 2020  end(baseplan).  
-0001aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa40: 2020 2020 2020 6261 7365 696e 666f 203d        baseinfo =
-0001aa50: 2073 656c 662e 7072 6f63 6573 735f 696e   self.process_in
-0001aa60: 7075 7466 696c 6528 706c 616e 2c20 6261  putfile(plan, ba
-0001aa70: 7365 696e 7075 7466 696c 652c 206f 7665  seinputfile, ove
-0001aa80: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-0001aa90: 2c20 6675 6c6c 3d54 7275 6529 0a20 2020  , full=True).   
-0001aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aab0: 2020 2020 2062 6173 6570 726f 6669 6c65       baseprofile
-0001aac0: 203d 2062 6173 6569 6e66 6f5b 305d 5b62   = baseinfo[0][b
-0001aad0: 6173 6576 6d5d 2069 6620 6261 7365 766d  asevm] if basevm
-0001aae0: 2069 6e20 6261 7365 696e 666f 5b30 5d20   in baseinfo[0] 
-0001aaf0: 656c 7365 207b 7d0a 2020 2020 2020 2020  else {}.        
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab10: 6375 7272 656e 7470 6c61 6e64 6972 203d  currentplandir =
-0001ab20: 2062 6173 6569 6e66 6f5b 335d 2069 6620   baseinfo[3] if 
-0001ab30: 6f73 2e70 6174 682e 6973 6162 7328 6261  os.path.isabs(ba
-0001ab40: 7365 696e 666f 5b33 5d29 2065 6c73 6520  seinfo[3]) else 
-0001ab50: 272e 270a 2020 2020 2020 2020 2020 2020  '.'.            
-0001ab60: 2020 2020 2020 2020 656c 6966 2027 6261          elif 'ba
-0001ab70: 7365 766d 2720 696e 2070 726f 6669 6c65  sevm' in profile
-0001ab80: 2061 6e64 2070 726f 6669 6c65 5b27 6261   and profile['ba
-0001ab90: 7365 766d 275d 2069 6e20 6261 7365 656e  sevm'] in baseen
-0001aba0: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
-0001abb0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001abc0: 6173 6570 726f 6669 6c65 203d 2062 6173  aseprofile = bas
-0001abd0: 6565 6e74 7269 6573 5b70 726f 6669 6c65  eentries[profile
-0001abe0: 5b27 6261 7365 766d 275d 5d0a 2020 2020  ['basevm']].    
-0001abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001ac20: 726e 696e 6728 6622 496e 636f 7272 6563  rning(f"Incorrec
-0001ac30: 7420 6261 7365 2065 6e74 7279 2066 6f72  t base entry for
-0001ac40: 207b 6e61 6d65 7d2e 2053 6b69 7070 696e   {name}. Skippin
-0001ac50: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
-0001ac60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001ac70: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0001ac80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001ac90: 6b65 7920 696e 2062 6173 6570 726f 6669  key in baseprofi
-0001aca0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001acb0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-0001acc0: 6579 206e 6f74 2069 6e20 7072 6f66 696c  ey not in profil
-0001acd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001ace0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001acf0: 726f 6669 6c65 5b6b 6579 5d20 3d20 6261  rofile[key] = ba
-0001ad00: 7365 7072 6f66 696c 655b 6b65 795d 0a20  seprofile[key]. 
-0001ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad20: 2020 2020 2020 2065 6c69 6620 6b65 7920         elif key 
-0001ad30: 696e 2062 6173 6570 726f 6669 6c65 2061  in baseprofile a
-0001ad40: 6e64 206b 6579 2069 6e20 7072 6f66 696c  nd key in profil
-0001ad50: 6520 616e 6420 6b65 7920 696e 2061 7070  e and key in app
-0001ad60: 656e 646b 6579 733a 0a20 2020 2020 2020  endkeys:.       
-0001ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad80: 2020 2020 2070 726f 6669 6c65 5b6b 6579       profile[key
-0001ad90: 5d20 3d20 6261 7365 7072 6f66 696c 655b  ] = baseprofile[
-0001ada0: 6b65 795d 202b 2070 726f 6669 6c65 5b6b  key] + profile[k
-0001adb0: 6579 5d0a 2020 2020 2020 2020 2020 2020  ey].            
-0001adc0: 2020 2020 7275 6c65 666f 756e 6420 3d20      rulefound = 
-0001add0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0001ade0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
-0001adf0: 696e 206f 7665 7272 6964 6573 2e67 6574  in overrides.get
-0001ae00: 2827 766d 7275 6c65 7327 2c20 7365 6c66  ('vmrules', self
-0001ae10: 2e76 6d72 756c 6573 293a 0a20 2020 2020  .vmrules):.     
-0001ae20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ae30: 6620 6c65 6e28 656e 7472 7929 2021 3d20  f len(entry) != 
-0001ae40: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0001ae50: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0001ae60: 2866 2257 726f 6e67 2076 6d20 7275 6c65  (f"Wrong vm rule
-0001ae70: 207b 656e 7472 797d 2229 0a20 2020 2020   {entry}").     
-0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae90: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2020 2072 756c 6520 3d20 6c69 7374 2865     rule = list(e
-0001aec0: 6e74 7279 2e6b 6579 7328 2929 5b30 5d0a  ntry.keys())[0].
-0001aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aee0: 2020 2020 6966 2028 7265 2e6d 6174 6368      if (re.match
-0001aef0: 2872 756c 652c 206e 616d 6529 206f 7220  (rule, name) or 
-0001af00: 666e 6d61 7463 6828 6e61 6d65 2c20 7275  fnmatch(name, ru
-0001af10: 6c65 2929 2061 6e64 2069 7369 6e73 7461  le)) and isinsta
-0001af20: 6e63 6528 656e 7472 795b 7275 6c65 5d2c  nce(entry[rule],
-0001af30: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0001a630: 6966 2027 6261 7365 766d 2720 696e 2070  if 'basevm' in p
+0001a640: 726f 6669 6c65 206f 7220 2762 6173 6570  rofile or 'basep
+0001a650: 6c61 6e27 2069 6e20 7072 6f66 696c 653a  lan' in profile:
+0001a660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a670: 2020 2020 2062 6173 6570 726f 6669 6c65       baseprofile
+0001a680: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+0001a690: 2020 2020 2020 2020 2020 6170 7065 6e64            append
+0001a6a0: 6b65 7973 203d 205b 2764 6973 6b73 272c  keys = ['disks',
+0001a6b0: 2027 6e65 7473 272c 2027 6669 6c65 7327   'nets', 'files'
+0001a6c0: 2c20 2773 6372 6970 7473 272c 2027 636d  , 'scripts', 'cm
+0001a6d0: 6473 275d 0a20 2020 2020 2020 2020 2020  ds'].           
+0001a6e0: 2020 2020 2020 2020 2069 6620 2762 6173           if 'bas
+0001a6f0: 6570 6c61 6e27 2069 6e20 7072 6f66 696c  eplan' in profil
+0001a700: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001a710: 2020 2020 2020 2020 2020 2062 6173 6570             basep
+0001a720: 6c61 6e20 3d20 7072 6f66 696c 655b 2762  lan = profile['b
+0001a730: 6173 6570 6c61 6e27 5d0a 2020 2020 2020  aseplan'].      
+0001a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a750: 2020 6261 7365 6469 7220 3d20 6f73 2e70    basedir = os.p
+0001a760: 6174 682e 6469 726e 616d 6528 696e 7075  ath.dirname(inpu
+0001a770: 7466 696c 6529 2069 6620 272f 2720 696e  tfile) if '/' in
+0001a780: 2069 6e70 7574 6669 6c65 2065 6c73 6520   inputfile else 
+0001a790: 272e 270a 2020 2020 2020 2020 2020 2020  '.'.            
+0001a7a0: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0001a7b0: 696e 7075 7466 696c 6520 3d20 6622 7b62  inputfile = f"{b
+0001a7c0: 6173 6564 6972 7d2f 7b62 6173 6570 6c61  asedir}/{basepla
+0001a7d0: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
+0001a7e0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0001a7f0: 6f6e 7461 696e 6572 5f6d 6f64 6528 2920  ontainer_mode() 
+0001a800: 616e 6420 6e6f 7420 6f73 2e70 6174 682e  and not os.path.
+0001a810: 6973 6162 7328 6261 7365 706c 616e 2920  isabs(baseplan) 
+0001a820: 616e 6420 272f 776f 726b 6469 7227 206e  and '/workdir' n
+0001a830: 6f74 2069 6e20 6261 7365 6469 723a 0a20  ot in basedir:. 
+0001a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a850: 2020 2020 2020 2020 2020 2062 6173 6569             basei
+0001a860: 6e70 7574 6669 6c65 203d 2066 222f 776f  nputfile = f"/wo
+0001a870: 726b 6469 722f 7b62 6173 6564 6972 7d2f  rkdir/{basedir}/
+0001a880: 7b62 6173 6570 6c61 6e7d 220a 2020 2020  {baseplan}".    
+0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8a0: 2020 2020 6261 7365 766d 203d 2070 726f      basevm = pro
+0001a8b0: 6669 6c65 5b27 6261 7365 766d 275d 2069  file['basevm'] i
+0001a8c0: 6620 2762 6173 6576 6d27 2069 6e20 7072  f 'basevm' in pr
+0001a8d0: 6f66 696c 6520 656c 7365 206e 616d 650a  ofile else name.
+0001a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8f0: 2020 2020 2020 2020 6966 2062 6173 6570          if basep
+0001a900: 6c61 6e20 6e6f 7420 696e 2062 6173 6570  lan not in basep
+0001a910: 6c61 6e73 3a0a 2020 2020 2020 2020 2020  lans:.          
+0001a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a930: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
+0001a940: 2c20 696e 7075 7466 696c 653d 6261 7365  , inputfile=base
+0001a950: 696e 7075 7466 696c 652c 206f 7665 7272  inputfile, overr
+0001a960: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
+0001a970: 6578 636c 7564 6576 6d73 3d76 6d6e 616d  excludevms=vmnam
+0001a980: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9a0: 2020 2020 2020 2020 2020 6261 7365 6d6f            basemo
+0001a9b0: 6465 3d54 7275 652c 206f 6e6c 7961 7373  de=True, onlyass
+0001a9c0: 6574 733d 6f6e 6c79 6173 7365 7473 290a  ets=onlyassets).
+0001a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9e0: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0001a9f0: 706c 616e 732e 6170 7065 6e64 2862 6173  plans.append(bas
+0001aa00: 6570 6c61 6e29 0a20 2020 2020 2020 2020  eplan).         
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001aa20: 6173 6569 6e66 6f20 3d20 7365 6c66 2e70  aseinfo = self.p
+0001aa30: 726f 6365 7373 5f69 6e70 7574 6669 6c65  rocess_inputfile
+0001aa40: 2870 6c61 6e2c 2062 6173 6569 6e70 7574  (plan, baseinput
+0001aa50: 6669 6c65 2c20 6f76 6572 7269 6465 733d  file, overrides=
+0001aa60: 6f76 6572 7269 6465 732c 2066 756c 6c3d  overrides, full=
+0001aa70: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0001aa80: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001aa90: 7365 7072 6f66 696c 6520 3d20 6261 7365  seprofile = base
+0001aaa0: 696e 666f 5b30 5d5b 6261 7365 766d 5d20  info[0][basevm] 
+0001aab0: 6966 2062 6173 6576 6d20 696e 2062 6173  if basevm in bas
+0001aac0: 6569 6e66 6f5b 305d 2065 6c73 6520 7b7d  einfo[0] else {}
+0001aad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aae0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001aaf0: 706c 616e 6469 7220 3d20 6261 7365 696e  plandir = basein
+0001ab00: 666f 5b33 5d20 6966 206f 732e 7061 7468  fo[3] if os.path
+0001ab10: 2e69 7361 6273 2862 6173 6569 6e66 6f5b  .isabs(baseinfo[
+0001ab20: 335d 2920 656c 7365 2027 2e27 0a20 2020  3]) else '.'.   
+0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab40: 2065 6c69 6620 2762 6173 6576 6d27 2069   elif 'basevm' i
+0001ab50: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
+0001ab60: 6f66 696c 655b 2762 6173 6576 6d27 5d20  ofile['basevm'] 
+0001ab70: 696e 2062 6173 6565 6e74 7269 6573 3a0a  in baseentries:.
+0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab90: 2020 2020 2020 2020 6261 7365 7072 6f66          baseprof
+0001aba0: 696c 6520 3d20 6261 7365 656e 7472 6965  ile = baseentrie
+0001abb0: 735b 7072 6f66 696c 655b 2762 6173 6576  s[profile['basev
+0001abc0: 6d27 5d5d 0a20 2020 2020 2020 2020 2020  m']].           
+0001abd0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abf0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0001ac00: 2249 6e63 6f72 7265 6374 2062 6173 6520  "Incorrect base 
+0001ac10: 656e 7472 7920 666f 7220 7b6e 616d 657d  entry for {name}
+0001ac20: 2e20 536b 6970 7069 6e67 2e2e 2e22 290a  . Skipping...").
+0001ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac40: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0001ac50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ac60: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+0001ac70: 6261 7365 7072 6f66 696c 653a 0a20 2020  baseprofile:.   
+0001ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac90: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+0001aca0: 696e 2070 726f 6669 6c65 3a0a 2020 2020  in profile:.    
+0001acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acc0: 2020 2020 2020 2020 7072 6f66 696c 655b          profile[
+0001acd0: 6b65 795d 203d 2062 6173 6570 726f 6669  key] = baseprofi
+0001ace0: 6c65 5b6b 6579 5d0a 2020 2020 2020 2020  le[key].        
+0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad00: 656c 6966 206b 6579 2069 6e20 6261 7365  elif key in base
+0001ad10: 7072 6f66 696c 6520 616e 6420 6b65 7920  profile and key 
+0001ad20: 696e 2070 726f 6669 6c65 2061 6e64 206b  in profile and k
+0001ad30: 6579 2069 6e20 6170 7065 6e64 6b65 7973  ey in appendkeys
+0001ad40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ad50: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001ad60: 6f66 696c 655b 6b65 795d 203d 2062 6173  ofile[key] = bas
+0001ad70: 6570 726f 6669 6c65 5b6b 6579 5d20 2b20  eprofile[key] + 
+0001ad80: 7072 6f66 696c 655b 6b65 795d 0a20 2020  profile[key].   
+0001ad90: 2020 2020 2020 2020 2020 2020 2072 756c               rul
+0001ada0: 6566 6f75 6e64 203d 2046 616c 7365 0a20  efound = False. 
+0001adb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001adc0: 6f72 2065 6e74 7279 2069 6e20 6f76 6572  or entry in over
+0001add0: 7269 6465 732e 6765 7428 2776 6d72 756c  rides.get('vmrul
+0001ade0: 6573 272c 2073 656c 662e 766d 7275 6c65  es', self.vmrule
+0001adf0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0001ae00: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
+0001ae10: 6e74 7279 2920 213d 2031 3a0a 2020 2020  ntry) != 1:.    
+0001ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae30: 2020 2020 6572 726f 7228 6622 5772 6f6e      error(f"Wron
+0001ae40: 6720 766d 2072 756c 6520 7b65 6e74 7279  g vm rule {entry
+0001ae50: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001ae60: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+0001ae70: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+0001ae80: 2020 2020 2020 2020 2020 2020 7275 6c65              rule
+0001ae90: 203d 206c 6973 7428 656e 7472 792e 6b65   = list(entry.ke
+0001aea0: 7973 2829 295b 305d 0a20 2020 2020 2020  ys())[0].       
+0001aeb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001aec0: 2872 652e 6d61 7463 6828 7275 6c65 2c20  (re.match(rule, 
+0001aed0: 6e61 6d65 2920 6f72 2066 6e6d 6174 6368  name) or fnmatch
+0001aee0: 286e 616d 652c 2072 756c 6529 2920 616e  (name, rule)) an
+0001aef0: 6420 6973 696e 7374 616e 6365 2865 6e74  d isinstance(ent
+0001af00: 7279 5b72 756c 655d 2c20 6469 6374 293a  ry[rule], dict):
+0001af10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001af20: 2020 2020 2020 2020 2072 756c 6566 6f75           rulefou
+0001af30: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
 0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af50: 7275 6c65 666f 756e 6420 3d20 5472 7565  rulefound = True
-0001af60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001af70: 2020 2020 2020 2020 206c 6973 746b 6579           listkey
-0001af80: 7320 3d20 5b27 636d 6473 272c 2027 6669  s = ['cmds', 'fi
-0001af90: 6c65 7327 2c20 2773 6372 6970 7473 275d  les', 'scripts']
-0001afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001afb0: 2020 2020 2020 2020 2066 6f72 2072 756c           for rul
-0001afc0: 6520 696e 2065 6e74 7279 3a0a 2020 2020  e in entry:.    
-0001afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afe0: 2020 2020 2020 2020 6375 7272 656e 7420          current 
-0001aff0: 3d20 656e 7472 795b 7275 6c65 5d0a 2020  = entry[rule].  
-0001b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b010: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
-0001b020: 7920 696e 2063 7572 7265 6e74 3a0a 2020  y in current:.  
-0001b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b040: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b050: 206b 6579 2069 6e20 6c69 7374 6b65 7973   key in listkeys
-0001b060: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
-0001b070: 6375 7272 656e 745b 6b65 795d 2c20 6c69  current[key], li
-0001b080: 7374 2920 616e 6420 6b65 7920 696e 2070  st) and key in p
-0001b090: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
-0001b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0b0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001b0c0: 656e 745b 6b65 795d 203d 2070 726f 6669  ent[key] = profi
-0001b0d0: 6c65 5b6b 6579 5d20 2b20 6375 7272 656e  le[key] + curren
-0001b0e0: 745b 6b65 795d 0a20 2020 2020 2020 2020  t[key].         
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b100: 2020 2070 726f 6669 6c65 2e75 7064 6174     profile.updat
-0001b110: 6528 656e 7472 795b 7275 6c65 5d29 0a20  e(entry[rule]). 
-0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b130: 2020 2020 2020 2020 2020 2069 6620 276e             if 'n
-0001b140: 616d 6527 2069 6e20 656e 7472 795b 7275  ame' in entry[ru
-0001b150: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
-0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 2020 2077 6172 6e69 6e67 2866 2252       warning(f"R
-0001b180: 656e 616d 696e 6720 7b6e 616d 657d 2074  enaming {name} t
-0001b190: 6f20 7b65 6e74 7279 5b72 756c 655d 5b27  o {entry[rule]['
-0001b1a0: 6e61 6d65 275d 7d22 290a 2020 2020 2020  name']}").      
-0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1c0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-0001b1d0: 2065 6e74 7279 5b72 756c 655d 5b27 6e61   entry[rule]['na
-0001b1e0: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-0001b1f0: 2020 2020 2069 6620 766d 7275 6c65 735f       if vmrules_
-0001b200: 7374 7269 6374 2061 6e64 206e 6f74 2072  strict and not r
-0001b210: 756c 6566 6f75 6e64 3a0a 2020 2020 2020  ulefound:.      
-0001b220: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001b230: 726e 696e 6728 6622 4e6f 2076 6d72 756c  rning(f"No vmrul
-0001b240: 6573 2066 6f75 6e64 2066 6f72 207b 6e61  es found for {na
-0001b250: 6d65 7d2e 2053 6b69 7070 696e 672e 2e2e  me}. Skipping...
-0001b260: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001b270: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0001b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b290: 766d 636c 6965 6e74 203d 2070 726f 6669  vmclient = profi
-0001b2a0: 6c65 2e67 6574 2827 636c 6965 6e74 2729  le.get('client')
-0001b2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b2c0: 2069 6620 766d 636c 6965 6e74 2069 7320   if vmclient is 
-0001b2d0: 6e6f 7420 4e6f 6e65 2061 6e64 2076 6d63  not None and vmc
-0001b2e0: 6c69 656e 7420 6e6f 7420 696e 2076 6d63  lient not in vmc
-0001b2f0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-0001b300: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
-0001b310: 6965 6e74 732e 6170 7065 6e64 2876 6d63  ients.append(vmc
-0001b320: 6c69 656e 7429 0a20 2020 2020 2020 2020  lient).         
-0001b330: 2020 2020 2020 2069 6620 766d 636c 6965         if vmclie
-0001b340: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 7a20 3d20 6b0a 2020 2020 2020 2020 2020  z = k.          
-0001b370: 2020 2020 2020 2020 2020 766d 636c 6965            vmclie
-0001b380: 6e74 203d 2073 656c 662e 636c 6965 6e74  nt = self.client
-0001b390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b3a0: 2020 2020 2069 6620 766d 636c 6965 6e74       if vmclient
-0001b3b0: 206e 6f74 2069 6e20 686f 7374 733a 0a20   not in hosts:. 
-0001b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3d0: 2020 2020 2020 2068 6f73 7473 5b76 6d63         hosts[vmc
-0001b3e0: 6c69 656e 745d 203d 2073 656c 660a 2020  lient] = self.  
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001b400: 6966 2076 6d63 6c69 656e 7420 696e 2068  if vmclient in h
-0001b410: 6f73 7473 3a0a 2020 2020 2020 2020 2020  osts:.          
-0001b420: 2020 2020 2020 2020 2020 7a20 3d20 686f            z = ho
-0001b430: 7374 735b 766d 636c 6965 6e74 5d2e 6b0a  sts[vmclient].k.
-0001b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b450: 656c 6966 2076 6d63 6c69 656e 7420 696e  elif vmclient in
-0001b460: 2073 656c 662e 636c 6965 6e74 733a 0a20   self.clients:. 
-0001b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b480: 2020 206e 6577 636c 6965 6e74 203d 204b     newclient = K
-0001b490: 636f 6e66 6967 2863 6c69 656e 743d 766d  config(client=vm
-0001b4a0: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
-0001b4b0: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-0001b4c0: 6e65 7763 6c69 656e 742e 6b0a 2020 2020  newclient.k.    
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4e0: 686f 7374 735b 766d 636c 6965 6e74 5d20  hosts[vmclient] 
-0001b4f0: 3d20 6e65 7763 6c69 656e 740a 2020 2020  = newclient.    
-0001b500: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001b510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b520: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-0001b530: 436c 6965 6e74 207b 766d 636c 6965 6e74  Client {vmclient
-0001b540: 7d20 6e6f 7420 666f 756e 642e 2055 7369  } not found. Usi
-0001b550: 6e67 2064 6566 6175 6c74 206f 6e65 2229  ng default one")
-0001b560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b570: 2020 2020 207a 203d 206b 0a20 2020 2020       z = k.     
-0001b580: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001b590: 6d63 6c69 656e 7420 3d20 7365 6c66 2e63  mclient = self.c
-0001b5a0: 6c69 656e 740a 2020 2020 2020 2020 2020  lient.          
-0001b5b0: 2020 2020 2020 2020 2020 6966 2076 6d63            if vmc
-0001b5c0: 6c69 656e 7420 6e6f 7420 696e 2068 6f73  lient not in hos
-0001b5d0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0001b5e0: 2020 2020 2020 2020 2020 2020 686f 7374              host
-0001b5f0: 735b 766d 636c 6965 6e74 5d20 3d20 7365  s[vmclient] = se
-0001b600: 6c66 0a20 2020 2020 2020 2020 2020 2020  lf.             
-0001b610: 2020 2076 6d73 5f74 6f5f 686f 7374 5b6e     vms_to_host[n
-0001b620: 616d 655d 203d 2068 6f73 7473 5b76 6d63  ame] = hosts[vmc
-0001b630: 6c69 656e 745d 0a20 2020 2020 2020 2020  lient].         
-0001b640: 2020 2020 2020 2069 6620 2770 726f 6669         if 'profi
-0001b650: 6c65 2720 696e 2070 726f 6669 6c65 2061  le' in profile a
-0001b660: 6e64 2070 726f 6669 6c65 5b27 7072 6f66  nd profile['prof
-0001b670: 696c 6527 5d20 696e 2076 6d70 726f 6669  ile'] in vmprofi
-0001b680: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0001b690: 2020 2020 2020 2020 2063 7573 746f 6d70           customp
-0001b6a0: 726f 6669 6c65 203d 2076 6d70 726f 6669  rofile = vmprofi
-0001b6b0: 6c65 735b 7072 6f66 696c 655b 2770 726f  les[profile['pro
-0001b6c0: 6669 6c65 275d 5d0a 2020 2020 2020 2020  file']].        
-0001b6d0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001b6e0: 696c 656e 616d 6520 3d20 7072 6f66 696c  ilename = profil
-0001b6f0: 655b 2770 726f 6669 6c65 275d 0a20 2020  e['profile'].   
-0001b700: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001b710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001b720: 2020 2020 2020 2063 7573 746f 6d70 726f         custompro
-0001b730: 6669 6c65 203d 207b 7d0a 2020 2020 2020  file = {}.      
-0001b740: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001b750: 6f66 696c 656e 616d 6520 3d20 276b 7669  ofilename = 'kvi
-0001b760: 7274 270a 2020 2020 2020 2020 2020 2020  rt'.            
-0001b770: 2020 2020 6966 2063 7573 746f 6d70 726f      if custompro
-0001b780: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-0001b790: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
-0001b7a0: 7072 6f66 696c 652e 7570 6461 7465 2870  profile.update(p
-0001b7b0: 726f 6669 6c65 290a 2020 2020 2020 2020  rofile).        
-0001b7c0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001b7d0: 696c 6520 3d20 6375 7374 6f6d 7072 6f66  ile = customprof
-0001b7e0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-0001b7f0: 2020 2020 6966 2027 706c 6179 626f 6f6b      if 'playbook
-0001b800: 2720 696e 2070 726f 6669 6c65 2061 6e64  ' in profile and
-0001b810: 2070 726f 6669 6c65 5b27 706c 6179 626f   profile['playbo
-0001b820: 6f6b 275d 3a0a 2020 2020 2020 2020 2020  ok']:.          
-0001b830: 2020 2020 2020 2020 2020 6966 2027 7363            if 'sc
-0001b840: 7269 7074 7327 206e 6f74 2069 6e20 7072  ripts' not in pr
-0001b850: 6f66 696c 6520 616e 6420 2766 696c 6573  ofile and 'files
-0001b860: 2720 6e6f 7420 696e 2070 726f 6669 6c65  ' not in profile
-0001b870: 2061 6e64 2027 636d 6473 2720 6e6f 7420   and 'cmds' not 
-0001b880: 696e 2070 726f 6669 6c65 3a0a 2020 2020  in profile:.    
-0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8a0: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
-0001b8b0: 7070 696e 6720 656d 7074 7920 706c 6179  pping empty play
-0001b8c0: 626f 6f6b 2066 6f72 207b 6e61 6d65 7d22  book for {name}"
-0001b8d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b8e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b900: 2020 2020 6966 2027 696d 6167 6527 2069      if 'image' i
-0001b910: 6e20 7072 6f66 696c 6520 616e 6420 2772  n profile and 'r
-0001b920: 6865 6c27 2069 6e20 7072 6f66 696c 655b  hel' in profile[
-0001b930: 2769 6d61 6765 275d 5c0a 2020 2020 2020  'image']\.      
-0001b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b950: 2020 2020 2020 2020 2020 616e 6420 2772            and 'r
-0001b960: 686e 7265 6769 7374 6572 2720 696e 2070  hnregister' in p
-0001b970: 726f 6669 6c65 2061 6e64 2070 726f 6669  rofile and profi
-0001b980: 6c65 5b27 7268 6e72 6567 6973 7465 7227  le['rhnregister'
-0001b990: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0001b9a0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001b9b0: 6172 6e69 6e67 2866 224d 616b 6520 7375  arning(f"Make su
-0001b9c0: 7265 2074 6f20 7375 6273 6372 6962 6520  re to subscribe 
-0001b9d0: 7b6e 616d 657d 2074 6f20 5265 6420 4861  {name} to Red Ha
-0001b9e0: 7420 6e65 7477 6f72 6b22 290a 2020 2020  t network").    
-0001b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba00: 2020 2020 6966 2027 7072 6976 6174 656b      if 'privatek
-0001ba10: 6579 2720 696e 2070 726f 6669 6c65 2061  ey' in profile a
-0001ba20: 6e64 2070 726f 6669 6c65 5b27 7072 6976  nd profile['priv
-0001ba30: 6174 656b 6579 275d 3a0a 2020 2020 2020  atekey']:.      
-0001ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba50: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-0001ba60: 436f 7079 2079 6f75 7220 7072 6976 6174  Copy your privat
-0001ba70: 6520 6b65 7920 746f 207b 6e61 6d65 7d22  e key to {name}"
-0001ba80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ba90: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
-0001baa0: 7420 696e 2070 726f 6669 6c65 2e67 6574  t in profile.get
-0001bab0: 2827 6e65 7473 272c 205b 5d29 3a0a 2020  ('nets', []):.  
-0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bad0: 2020 2020 2020 2020 2020 6966 2027 6970            if 'ip
-0001bae0: 2720 696e 206e 6574 2061 6e64 2027 6d61  ' in net and 'ma
-0001baf0: 736b 2720 696e 206e 6574 2061 6e64 2027  sk' in net and '
-0001bb00: 6761 7465 7761 7927 2069 6e20 6e65 743a  gateway' in net:
-0001bb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb30: 2069 702c 206d 6173 6b2c 2067 6174 6577   ip, mask, gatew
-0001bb40: 6179 203d 206e 6574 5b27 6970 275d 2c20  ay = net['ip'], 
-0001bb50: 6e65 745b 276d 6173 6b27 5d2c 206e 6574  net['mask'], net
-0001bb60: 5b27 6761 7465 7761 7927 5d0a 2020 2020  ['gateway'].    
-0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb80: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0001bb90: 696e 6728 6622 4164 6420 6d61 6e75 616c  ing(f"Add manual
-0001bba0: 6c79 2074 6869 7320 6e65 7477 6f72 6b20  ly this network 
-0001bbb0: 7b69 707d 2f7b 6d61 736b 7d20 7769 7468  {ip}/{mask} with
-0001bbc0: 2067 6174 6577 6179 207b 6761 7465 7761   gateway {gatewa
-0001bbd0: 797d 2229 0a20 2020 2020 2020 2020 2020  y}").           
+0001af50: 2020 6c69 7374 6b65 7973 203d 205b 2763    listkeys = ['c
+0001af60: 6d64 7327 2c20 2766 696c 6573 272c 2027  mds', 'files', '
+0001af70: 7363 7269 7074 7327 5d0a 2020 2020 2020  scripts'].      
+0001af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af90: 2020 666f 7220 7275 6c65 2069 6e20 656e    for rule in en
+0001afa0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afc0: 2063 7572 7265 6e74 203d 2065 6e74 7279   current = entry
+0001afd0: 5b72 756c 655d 0a20 2020 2020 2020 2020  [rule].         
+0001afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aff0: 2020 2066 6f72 206b 6579 2069 6e20 6375     for key in cu
+0001b000: 7272 656e 743a 0a20 2020 2020 2020 2020  rrent:.         
+0001b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b020: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+0001b030: 206c 6973 746b 6579 7320 616e 6420 6973   listkeys and is
+0001b040: 696e 7374 616e 6365 2863 7572 7265 6e74  instance(current
+0001b050: 5b6b 6579 5d2c 206c 6973 7429 2061 6e64  [key], list) and
+0001b060: 206b 6579 2069 6e20 7072 6f66 696c 653a   key in profile:
+0001b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b090: 2020 2020 2063 7572 7265 6e74 5b6b 6579       current[key
+0001b0a0: 5d20 3d20 7072 6f66 696c 655b 6b65 795d  ] = profile[key]
+0001b0b0: 202b 2063 7572 7265 6e74 5b6b 6579 5d0a   + current[key].
+0001b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0d0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
+0001b0e0: 696c 652e 7570 6461 7465 2865 6e74 7279  ile.update(entry
+0001b0f0: 5b72 756c 655d 290a 2020 2020 2020 2020  [rule]).        
+0001b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b110: 2020 2020 6966 2027 6e61 6d65 2720 696e      if 'name' in
+0001b120: 2065 6e74 7279 5b72 756c 655d 3a0a 2020   entry[rule]:.  
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0001b150: 726e 696e 6728 6622 5265 6e61 6d69 6e67  rning(f"Renaming
+0001b160: 207b 6e61 6d65 7d20 746f 207b 656e 7472   {name} to {entr
+0001b170: 795b 7275 6c65 5d5b 276e 616d 6527 5d7d  y[rule]['name']}
+0001b180: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1a0: 2020 206e 616d 6520 3d20 656e 7472 795b     name = entry[
+0001b1b0: 7275 6c65 5d5b 276e 616d 6527 5d0a 2020  rule]['name'].  
+0001b1c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001b1d0: 2076 6d72 756c 6573 5f73 7472 6963 7420   vmrules_strict 
+0001b1e0: 616e 6420 6e6f 7420 7275 6c65 666f 756e  and not rulefoun
+0001b1f0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+0001b200: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0001b210: 224e 6f20 766d 7275 6c65 7320 666f 756e  "No vmrules foun
+0001b220: 6420 666f 7220 7b6e 616d 657d 2e20 536b  d for {name}. Sk
+0001b230: 6970 7069 6e67 2e2e 2e22 290a 2020 2020  ipping...").    
+0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b250: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001b260: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
+0001b270: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
+0001b280: 2763 6c69 656e 7427 290a 2020 2020 2020  'client').      
+0001b290: 2020 2020 2020 2020 2020 6966 2076 6d63            if vmc
+0001b2a0: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
+0001b2b0: 6520 616e 6420 766d 636c 6965 6e74 206e  e and vmclient n
+0001b2c0: 6f74 2069 6e20 766d 636c 6965 6e74 733a  ot in vmclients:
+0001b2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b2e0: 2020 2020 2076 6d63 6c69 656e 7473 2e61       vmclients.a
+0001b2f0: 7070 656e 6428 766d 636c 6965 6e74 290a  ppend(vmclient).
+0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b310: 6966 2076 6d63 6c69 656e 7420 6973 204e  if vmclient is N
+0001b320: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001b330: 2020 2020 2020 2020 207a 203d 206b 0a20           z = k. 
+0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b350: 2020 2076 6d63 6c69 656e 7420 3d20 7365     vmclient = se
+0001b360: 6c66 2e63 6c69 656e 740a 2020 2020 2020  lf.client.      
+0001b370: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001b380: 2076 6d63 6c69 656e 7420 6e6f 7420 696e   vmclient not in
+0001b390: 2068 6f73 7473 3a0a 2020 2020 2020 2020   hosts:.        
+0001b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3b0: 686f 7374 735b 766d 636c 6965 6e74 5d20  hosts[vmclient] 
+0001b3c0: 3d20 7365 6c66 0a20 2020 2020 2020 2020  = self.         
+0001b3d0: 2020 2020 2020 2065 6c69 6620 766d 636c         elif vmcl
+0001b3e0: 6965 6e74 2069 6e20 686f 7374 733a 0a20  ient in hosts:. 
+0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b400: 2020 207a 203d 2068 6f73 7473 5b76 6d63     z = hosts[vmc
+0001b410: 6c69 656e 745d 2e6b 0a20 2020 2020 2020  lient].k.       
+0001b420: 2020 2020 2020 2020 2065 6c69 6620 766d           elif vm
+0001b430: 636c 6965 6e74 2069 6e20 7365 6c66 2e63  client in self.c
+0001b440: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+0001b450: 2020 2020 2020 2020 2020 2020 6e65 7763              newc
+0001b460: 6c69 656e 7420 3d20 4b63 6f6e 6669 6728  lient = Kconfig(
+0001b470: 636c 6965 6e74 3d76 6d63 6c69 656e 7429  client=vmclient)
+0001b480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b490: 2020 2020 207a 203d 206e 6577 636c 6965       z = newclie
+0001b4a0: 6e74 2e6b 0a20 2020 2020 2020 2020 2020  nt.k.           
+0001b4b0: 2020 2020 2020 2020 2068 6f73 7473 5b76           hosts[v
+0001b4c0: 6d63 6c69 656e 745d 203d 206e 6577 636c  mclient] = newcl
+0001b4d0: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
+0001b4e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001b4f0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001b500: 6172 6e69 6e67 2866 2243 6c69 656e 7420  arning(f"Client 
+0001b510: 7b76 6d63 6c69 656e 747d 206e 6f74 2066  {vmclient} not f
+0001b520: 6f75 6e64 2e20 5573 696e 6720 6465 6661  ound. Using defa
+0001b530: 756c 7420 6f6e 6522 290a 2020 2020 2020  ult one").      
+0001b540: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+0001b550: 3d20 6b0a 2020 2020 2020 2020 2020 2020  = k.            
+0001b560: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+0001b570: 203d 2073 656c 662e 636c 6965 6e74 0a20   = self.client. 
+0001b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b590: 2020 2069 6620 766d 636c 6965 6e74 206e     if vmclient n
+0001b5a0: 6f74 2069 6e20 686f 7374 733a 0a20 2020  ot in hosts:.   
+0001b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5c0: 2020 2020 2068 6f73 7473 5b76 6d63 6c69       hosts[vmcli
+0001b5d0: 656e 745d 203d 2073 656c 660a 2020 2020  ent] = self.    
+0001b5e0: 2020 2020 2020 2020 2020 2020 766d 735f              vms_
+0001b5f0: 746f 5f68 6f73 745b 6e61 6d65 5d20 3d20  to_host[name] = 
+0001b600: 686f 7374 735b 766d 636c 6965 6e74 5d0a  hosts[vmclient].
+0001b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b620: 6966 2027 7072 6f66 696c 6527 2069 6e20  if 'profile' in 
+0001b630: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
+0001b640: 696c 655b 2770 726f 6669 6c65 275d 2069  ile['profile'] i
+0001b650: 6e20 766d 7072 6f66 696c 6573 3a0a 2020  n vmprofiles:.  
+0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b670: 2020 6375 7374 6f6d 7072 6f66 696c 6520    customprofile 
+0001b680: 3d20 766d 7072 6f66 696c 6573 5b70 726f  = vmprofiles[pro
+0001b690: 6669 6c65 5b27 7072 6f66 696c 6527 5d5d  file['profile']]
+0001b6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b6b0: 2020 2020 2070 726f 6669 6c65 6e61 6d65       profilename
+0001b6c0: 203d 2070 726f 6669 6c65 5b27 7072 6f66   = profile['prof
+0001b6d0: 696c 6527 5d0a 2020 2020 2020 2020 2020  ile'].          
+0001b6e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b700: 6375 7374 6f6d 7072 6f66 696c 6520 3d20  customprofile = 
+0001b710: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
+0001b720: 2020 2020 2020 2070 726f 6669 6c65 6e61         profilena
+0001b730: 6d65 203d 2027 6b76 6972 7427 0a20 2020  me = 'kvirt'.   
+0001b740: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b750: 6375 7374 6f6d 7072 6f66 696c 653a 0a20  customprofile:. 
+0001b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b770: 2020 2063 7573 746f 6d70 726f 6669 6c65     customprofile
+0001b780: 2e75 7064 6174 6528 7072 6f66 696c 6529  .update(profile)
+0001b790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b7a0: 2020 2020 2070 726f 6669 6c65 203d 2063       profile = c
+0001b7b0: 7573 746f 6d70 726f 6669 6c65 0a20 2020  ustomprofile.   
+0001b7c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b7d0: 2770 6c61 7962 6f6f 6b27 2069 6e20 7072  'playbook' in pr
+0001b7e0: 6f66 696c 6520 616e 6420 7072 6f66 696c  ofile and profil
+0001b7f0: 655b 2770 6c61 7962 6f6f 6b27 5d3a 0a20  e['playbook']:. 
+0001b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b810: 2020 2069 6620 2773 6372 6970 7473 2720     if 'scripts' 
+0001b820: 6e6f 7420 696e 2070 726f 6669 6c65 2061  not in profile a
+0001b830: 6e64 2027 6669 6c65 7327 206e 6f74 2069  nd 'files' not i
+0001b840: 6e20 7072 6f66 696c 6520 616e 6420 2763  n profile and 'c
+0001b850: 6d64 7327 206e 6f74 2069 6e20 7072 6f66  mds' not in prof
+0001b860: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001b870: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001b880: 696e 7428 6622 536b 6970 7069 6e67 2065  int(f"Skipping e
+0001b890: 6d70 7479 2070 6c61 7962 6f6f 6b20 666f  mpty playbook fo
+0001b8a0: 7220 7b6e 616d 657d 2229 0a20 2020 2020  r {name}").     
+0001b8b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001b8c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001b8d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b8e0: 2769 6d61 6765 2720 696e 2070 726f 6669  'image' in profi
+0001b8f0: 6c65 2061 6e64 2027 7268 656c 2720 696e  le and 'rhel' in
+0001b900: 2070 726f 6669 6c65 5b27 696d 6167 6527   profile['image'
+0001b910: 5d5c 0a20 2020 2020 2020 2020 2020 2020  ]\.             
+0001b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b930: 2020 2061 6e64 2027 7268 6e72 6567 6973     and 'rhnregis
+0001b940: 7465 7227 2069 6e20 7072 6f66 696c 6520  ter' in profile 
+0001b950: 616e 6420 7072 6f66 696c 655b 2772 686e  and profile['rhn
+0001b960: 7265 6769 7374 6572 275d 3a0a 2020 2020  register']:.    
+0001b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b980: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0001b990: 6622 4d61 6b65 2073 7572 6520 746f 2073  f"Make sure to s
+0001b9a0: 7562 7363 7269 6265 207b 6e61 6d65 7d20  ubscribe {name} 
+0001b9b0: 746f 2052 6564 2048 6174 206e 6574 776f  to Red Hat netwo
+0001b9c0: 726b 2229 0a20 2020 2020 2020 2020 2020  rk").           
+0001b9d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b9e0: 2770 7269 7661 7465 6b65 7927 2069 6e20  'privatekey' in 
+0001b9f0: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
+0001ba00: 696c 655b 2770 7269 7661 7465 6b65 7927  ile['privatekey'
+0001ba10: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0001ba20: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001ba30: 6172 6e69 6e67 2866 2243 6f70 7920 796f  arning(f"Copy yo
+0001ba40: 7572 2070 7269 7661 7465 206b 6579 2074  ur private key t
+0001ba50: 6f20 7b6e 616d 657d 2229 0a20 2020 2020  o {name}").     
+0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba70: 2020 2066 6f72 206e 6574 2069 6e20 7072     for net in pr
+0001ba80: 6f66 696c 652e 6765 7428 276e 6574 7327  ofile.get('nets'
+0001ba90: 2c20 5b5d 293a 0a20 2020 2020 2020 2020  , []):.         
+0001baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bab0: 2020 2069 6620 2769 7027 2069 6e20 6e65     if 'ip' in ne
+0001bac0: 7420 616e 6420 276d 6173 6b27 2069 6e20  t and 'mask' in 
+0001bad0: 6e65 7420 616e 6420 2767 6174 6577 6179  net and 'gateway
+0001bae0: 2720 696e 206e 6574 3a0a 2020 2020 2020  ' in net:.      
+0001baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb00: 2020 2020 2020 2020 2020 6970 2c20 6d61            ip, ma
+0001bb10: 736b 2c20 6761 7465 7761 7920 3d20 6e65  sk, gateway = ne
+0001bb20: 745b 2769 7027 5d2c 206e 6574 5b27 6d61  t['ip'], net['ma
+0001bb30: 736b 275d 2c20 6e65 745b 2767 6174 6577  sk'], net['gatew
+0001bb40: 6179 275d 0a20 2020 2020 2020 2020 2020  ay'].           
+0001bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb60: 2020 2020 2077 6172 6e69 6e67 2866 2241       warning(f"A
+0001bb70: 6464 206d 616e 7561 6c6c 7920 7468 6973  dd manually this
+0001bb80: 206e 6574 776f 726b 207b 6970 7d2f 7b6d   network {ip}/{m
+0001bb90: 6173 6b7d 2077 6974 6820 6761 7465 7761  ask} with gatewa
+0001bba0: 7920 7b67 6174 6577 6179 7d22 290a 2020  y {gateway}").  
+0001bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbc0: 2020 2020 2020 2020 2020 6966 2027 7669            if 'vi
+0001bbd0: 7073 2720 696e 206e 6574 3a0a 2020 2020  ps' in net:.    
 0001bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbf0: 2069 6620 2776 6970 7327 2069 6e20 6e65   if 'vips' in ne
-0001bc00: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0001bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc20: 2020 2076 6970 7320 3d20 272c 272e 6a6f     vips = ','.jo
-0001bc30: 696e 286e 6574 5b27 7669 7073 275d 290a  in(net['vips']).
-0001bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc60: 7761 726e 696e 6728 6622 4164 6420 6d61  warning(f"Add ma
-0001bc70: 6e75 616c 6c79 2076 6970 7320 7b76 6970  nually vips {vip
-0001bc80: 737d 2229 0a20 2020 2020 2020 2020 2020  s}").           
-0001bc90: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001bca0: 696e 7428 224d 616b 6520 7375 7265 2074  int("Make sure t
-0001bcb0: 6f20 6578 706f 7274 2041 4e53 4942 4c45  o export ANSIBLE
-0001bcc0: 5f4a 494e 4a41 325f 4558 5445 4e53 494f  _JINJA2_EXTENSIO
-0001bcd0: 4e53 3d6a 696e 6a61 322e 6578 742e 646f  NS=jinja2.ext.do
-0001bce0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001bcf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001bd00: 6372 6561 7465 5f76 6d5f 706c 6179 626f  create_vm_playbo
-0001bd10: 6f6b 286e 616d 652c 2070 726f 6669 6c65  ok(name, profile
-0001bd20: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-0001bd30: 7269 6465 732c 2073 746f 7265 3d54 7275  rides, store=Tru
-0001bd40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001bd50: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001bd60: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0001bd70: 2020 2020 6966 207a 2e65 7869 7374 7328      if z.exists(
-0001bd80: 6e61 6d65 2920 616e 6420 6e6f 7420 6f6e  name) and not on
-0001bd90: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-0001bda0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001bdb0: 206e 6f74 2075 7064 6174 653a 0a20 2020   not update:.   
-0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdd0: 2020 2020 2070 7072 696e 7428 6622 7b6e       pprint(f"{n
-0001bde0: 616d 657d c2a0 736b 6970 7065 6420 6f6e  ame}..skipped on
-0001bdf0: 207b 766d 636c 6965 6e74 7d21 2229 0a20   {vmclient}!"). 
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001bbf0: 2020 2020 2020 2020 2020 2020 7669 7073              vips
+0001bc00: 203d 2027 2c27 2e6a 6f69 6e28 6e65 745b   = ','.join(net[
+0001bc10: 2776 6970 7327 5d29 0a20 2020 2020 2020  'vips']).       
+0001bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc30: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001bc40: 2866 2241 6464 206d 616e 7561 6c6c 7920  (f"Add manually 
+0001bc50: 7669 7073 207b 7669 7073 7d22 290a 2020  vips {vips}").  
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 2020 2020 2020 7070 7269 6e74 2822 4d61        pprint("Ma
+0001bc80: 6b65 2073 7572 6520 746f 2065 7870 6f72  ke sure to expor
+0001bc90: 7420 414e 5349 424c 455f 4a49 4e4a 4132  t ANSIBLE_JINJA2
+0001bca0: 5f45 5854 454e 5349 4f4e 533d 6a69 6e6a  _EXTENSIONS=jinj
+0001bcb0: 6132 2e65 7874 2e64 6f22 290a 2020 2020  a2.ext.do").    
+0001bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcd0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0001bce0: 766d 5f70 6c61 7962 6f6f 6b28 6e61 6d65  vm_playbook(name
+0001bcf0: 2c20 7072 6f66 696c 652c 206f 7665 7272  , profile, overr
+0001bd00: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
+0001bd10: 7374 6f72 653d 5472 7565 290a 2020 2020  store=True).    
+0001bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd30: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001bd40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001bd50: 7a2e 6578 6973 7473 286e 616d 6529 2061  z.exists(name) a
+0001bd60: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
+0001bd70: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001bd80: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
+0001bd90: 6461 7465 3a0a 2020 2020 2020 2020 2020  date:.          
+0001bda0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001bdb0: 7269 6e74 2866 227b 6e61 6d65 7dc2 a073  rint(f"{name}..s
+0001bdc0: 6b69 7070 6564 206f 6e20 7b76 6d63 6c69  kipped on {vmcli
+0001bdd0: 656e 747d 2122 290a 2020 2020 2020 2020  ent}!").        
+0001bde0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001bdf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001be00: 2020 2020 2020 2020 2020 7570 6461 7465            update
+0001be10: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
 0001be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be30: 2075 7064 6174 6564 203d 2046 616c 7365   updated = False
-0001be40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be50: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001be60: 766d 203d 207a 2e69 6e66 6f28 6e61 6d65  vm = z.info(name
-0001be70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001be80: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0001be90: 7473 7461 7274 203d 2063 7572 7265 6e74  tstart = current
-0001bea0: 766d 2e67 6574 2827 6175 746f 7374 6172  vm.get('autostar
-0001beb0: 7427 2c20 4661 6c73 6529 0a20 2020 2020  t', False).     
-0001bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bed0: 2020 2063 7572 7265 6e74 6d65 6d6f 7279     currentmemory
-0001bee0: 203d 2063 7572 7265 6e74 766d 5b27 6d65   = currentvm['me
-0001bef0: 6d6f 7279 275d 0a20 2020 2020 2020 2020  mory'].         
-0001bf00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001bf10: 7572 7265 6e74 696d 6167 6520 3d20 6375  urrentimage = cu
-0001bf20: 7272 656e 7476 6d2e 6765 7428 2774 656d  rrentvm.get('tem
-0001bf30: 706c 6174 6527 290a 2020 2020 2020 2020  plate').        
-0001bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf50: 6375 7272 656e 7469 6d61 6765 203d 2063  currentimage = c
-0001bf60: 7572 7265 6e74 766d 2e67 6574 2827 696d  urrentvm.get('im
-0001bf70: 6167 6527 2c20 6375 7272 656e 7469 6d61  age', currentima
-0001bf80: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
-0001bf90: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001bfa0: 656e 7463 7075 7320 3d20 696e 7428 6375  entcpus = int(cu
-0001bfb0: 7272 656e 7476 6d5b 2763 7075 7327 5d29  rrentvm['cpus'])
-0001bfc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bfd0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0001bfe0: 6e65 7473 203d 2063 7572 7265 6e74 766d  nets = currentvm
-0001bff0: 5b27 6e65 7473 275d 0a20 2020 2020 2020  ['nets'].       
-0001c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c010: 2063 7572 7265 6e74 6469 736b 7320 3d20   currentdisks = 
-0001c020: 6375 7272 656e 7476 6d5b 2764 6973 6b73  currentvm['disks
-0001c030: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0001c040: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0001c050: 6e74 666c 6176 6f72 203d 2063 7572 7265  ntflavor = curre
-0001c060: 6e74 766d 2e67 6574 2827 666c 6176 6f72  ntvm.get('flavor
-0001c070: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0001c080: 2020 2020 2020 2020 2020 2069 6620 2761             if 'a
-0001c090: 7574 6f73 7461 7274 2720 696e 2070 726f  utostart' in pro
-0001c0a0: 6669 6c65 2061 6e64 2063 7572 7265 6e74  file and current
-0001c0b0: 7374 6172 7420 213d 2070 726f 6669 6c65  start != profile
-0001c0c0: 5b27 6175 746f 7374 6172 7427 5d3a 0a20  ['autostart']:. 
-0001c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0e0: 2020 2020 2020 2020 2020 2075 7064 6174             updat
-0001c0f0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c110: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-0001c120: 7064 6174 696e 6720 6175 746f 7374 6172  pdating autostar
-0001c130: 7420 6f66 207b 6e61 6d65 7d20 746f 207b  t of {name} to {
-0001c140: 7072 6f66 696c 655b 2761 7574 6f73 7461  profile['autosta
-0001c150: 7274 275d 7d22 290a 2020 2020 2020 2020  rt']}").        
-0001c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c170: 2020 2020 7a2e 7570 6461 7465 5f73 7461      z.update_sta
-0001c180: 7274 286e 616d 652c 2070 726f 6669 6c65  rt(name, profile
-0001c190: 5b27 6175 746f 7374 6172 7427 5d29 0a20  ['autostart']). 
-0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1b0: 2020 2020 2020 2069 6620 2766 6c61 766f         if 'flavo
-0001c1c0: 7227 2069 6e20 7072 6f66 696c 6520 616e  r' in profile an
-0001c1d0: 6420 6375 7272 656e 7466 6c61 766f 7220  d currentflavor 
-0001c1e0: 213d 2070 726f 6669 6c65 5b27 666c 6176  != profile['flav
-0001c1f0: 6f72 275d 3a0a 2020 2020 2020 2020 2020  or']:.          
+0001be30: 2020 6375 7272 656e 7476 6d20 3d20 7a2e    currentvm = z.
+0001be40: 696e 666f 286e 616d 6529 0a20 2020 2020  info(name).     
+0001be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be60: 2020 2063 7572 7265 6e74 7374 6172 7420     currentstart 
+0001be70: 3d20 6375 7272 656e 7476 6d2e 6765 7428  = currentvm.get(
+0001be80: 2761 7574 6f73 7461 7274 272c 2046 616c  'autostart', Fal
+0001be90: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+0001bea0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001beb0: 656e 746d 656d 6f72 7920 3d20 6375 7272  entmemory = curr
+0001bec0: 656e 7476 6d5b 276d 656d 6f72 7927 5d0a  entvm['memory'].
+0001bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bee0: 2020 2020 2020 2020 6375 7272 656e 7469          currenti
+0001bef0: 6d61 6765 203d 2063 7572 7265 6e74 766d  mage = currentvm
+0001bf00: 2e67 6574 2827 7465 6d70 6c61 7465 2729  .get('template')
+0001bf10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bf20: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001bf30: 696d 6167 6520 3d20 6375 7272 656e 7476  image = currentv
+0001bf40: 6d2e 6765 7428 2769 6d61 6765 272c 2063  m.get('image', c
+0001bf50: 7572 7265 6e74 696d 6167 6529 0a20 2020  urrentimage).   
+0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf70: 2020 2020 2063 7572 7265 6e74 6370 7573       currentcpus
+0001bf80: 203d 2069 6e74 2863 7572 7265 6e74 766d   = int(currentvm
+0001bf90: 5b27 6370 7573 275d 290a 2020 2020 2020  ['cpus']).      
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfb0: 2020 6375 7272 656e 746e 6574 7320 3d20    currentnets = 
+0001bfc0: 6375 7272 656e 7476 6d5b 276e 6574 7327  currentvm['nets'
+0001bfd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001bfe0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0001bff0: 7464 6973 6b73 203d 2063 7572 7265 6e74  tdisks = current
+0001c000: 766d 5b27 6469 736b 7327 5d0a 2020 2020  vm['disks'].    
+0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c020: 2020 2020 6375 7272 656e 7466 6c61 766f      currentflavo
+0001c030: 7220 3d20 6375 7272 656e 7476 6d2e 6765  r = currentvm.ge
+0001c040: 7428 2766 6c61 766f 7227 290a 2020 2020  t('flavor').    
+0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c060: 2020 2020 6966 2027 6175 746f 7374 6172      if 'autostar
+0001c070: 7427 2069 6e20 7072 6f66 696c 6520 616e  t' in profile an
+0001c080: 6420 6375 7272 656e 7473 7461 7274 2021  d currentstart !
+0001c090: 3d20 7072 6f66 696c 655b 2761 7574 6f73  = profile['autos
+0001c0a0: 7461 7274 275d 3a0a 2020 2020 2020 2020  tart']:.        
+0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0c0: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
+0001c0d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001c0f0: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+0001c100: 2061 7574 6f73 7461 7274 206f 6620 7b6e   autostart of {n
+0001c110: 616d 657d 2074 6f20 7b70 726f 6669 6c65  ame} to {profile
+0001c120: 5b27 6175 746f 7374 6172 7427 5d7d 2229  ['autostart']}")
+0001c130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c140: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
+0001c150: 7064 6174 655f 7374 6172 7428 6e61 6d65  pdate_start(name
+0001c160: 2c20 7072 6f66 696c 655b 2761 7574 6f73  , profile['autos
+0001c170: 7461 7274 275d 290a 2020 2020 2020 2020  tart']).        
+0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c190: 6966 2027 666c 6176 6f72 2720 696e 2070  if 'flavor' in p
+0001c1a0: 726f 6669 6c65 2061 6e64 2063 7572 7265  rofile and curre
+0001c1b0: 6e74 666c 6176 6f72 2021 3d20 7072 6f66  ntflavor != prof
+0001c1c0: 696c 655b 2766 6c61 766f 7227 5d3a 0a20  ile['flavor']:. 
+0001c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1e0: 2020 2020 2020 2020 2020 2075 7064 6174             updat
+0001c1f0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
 0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c210: 2020 7570 6461 7465 6420 3d20 5472 7565    updated = True
-0001c220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c230: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001c240: 696e 7428 6622 5570 6461 7469 6e67 2066  int(f"Updating f
-0001c250: 6c61 766f 7220 6f66 207b 6e61 6d65 7d20  lavor of {name} 
-0001c260: 746f 207b 7072 6f66 696c 655b 2766 6c61  to {profile['fla
-0001c270: 766f 7227 5d7d 2229 0a20 2020 2020 2020  vor']}").       
-0001c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c290: 2020 2020 207a 2e75 7064 6174 655f 666c       z.update_fl
-0001c2a0: 6176 6f72 286e 616d 652c 2070 726f 6669  avor(name, profi
-0001c2b0: 6c65 5b27 666c 6176 6f72 275d 290a 2020  le['flavor']).  
+0001c210: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
+0001c220: 7064 6174 696e 6720 666c 6176 6f72 206f  pdating flavor o
+0001c230: 6620 7b6e 616d 657d 2074 6f20 7b70 726f  f {name} to {pro
+0001c240: 6669 6c65 5b27 666c 6176 6f72 275d 7d22  file['flavor']}"
+0001c250: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c260: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
+0001c270: 7570 6461 7465 5f66 6c61 766f 7228 6e61  update_flavor(na
+0001c280: 6d65 2c20 7072 6f66 696c 655b 2766 6c61  me, profile['fla
+0001c290: 766f 7227 5d29 0a20 2020 2020 2020 2020  vor']).         
+0001c2a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001c2b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
 0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2f0: 2020 2020 2020 2020 6966 2027 6d65 6d6f          if 'memo
-0001c300: 7279 2720 696e 2070 726f 6669 6c65 2061  ry' in profile a
-0001c310: 6e64 2063 7572 7265 6e74 6d65 6d6f 7279  nd currentmemory
-0001c320: 2021 3d20 7072 6f66 696c 655b 276d 656d   != profile['mem
-0001c330: 6f72 7927 5d3a 0a20 2020 2020 2020 2020  ory']:.         
+0001c2d0: 2069 6620 276d 656d 6f72 7927 2069 6e20   if 'memory' in 
+0001c2e0: 7072 6f66 696c 6520 616e 6420 6375 7272  profile and curr
+0001c2f0: 656e 746d 656d 6f72 7920 213d 2070 726f  entmemory != pro
+0001c300: 6669 6c65 5b27 6d65 6d6f 7279 275d 3a0a  file['memory']:.
+0001c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c330: 7570 6461 7465 6420 3d20 5472 7565 0a20  updated = True. 
 0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c350: 2020 2020 2020 2075 7064 6174 6564 203d         updated =
-0001c360: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0001c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c380: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-0001c390: 7064 6174 696e 6720 6d65 6d6f 7279 206f  pdating memory o
-0001c3a0: 6620 7b6e 616d 657d 2074 6f20 7b70 726f  f {name} to {pro
-0001c3b0: 6669 6c65 5b27 6d65 6d6f 7279 275d 7d22  file['memory']}"
-0001c3c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3e0: 2020 7a2e 7570 6461 7465 5f6d 656d 6f72    z.update_memor
-0001c3f0: 7928 6e61 6d65 2c20 7072 6f66 696c 655b  y(name, profile[
-0001c400: 276d 656d 6f72 7927 5d29 0a20 2020 2020  'memory']).     
-0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c420: 2020 2020 2020 2069 6620 276e 756d 6370         if 'numcp
-0001c430: 7573 2720 696e 2070 726f 6669 6c65 2061  us' in profile a
-0001c440: 6e64 2063 7572 7265 6e74 6370 7573 2021  nd currentcpus !
-0001c450: 3d20 7072 6f66 696c 655b 276e 756d 6370  = profile['numcp
-0001c460: 7573 275d 3a0a 2020 2020 2020 2020 2020  us']:.          
+0001c350: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001c360: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+0001c370: 206d 656d 6f72 7920 6f66 207b 6e61 6d65   memory of {name
+0001c380: 7d20 746f 207b 7072 6f66 696c 655b 276d  } to {profile['m
+0001c390: 656d 6f72 7927 5d7d 2229 0a20 2020 2020  emory']}").     
+0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3b0: 2020 2020 2020 2020 2020 207a 2e75 7064             z.upd
+0001c3c0: 6174 655f 6d65 6d6f 7279 286e 616d 652c  ate_memory(name,
+0001c3d0: 2070 726f 6669 6c65 5b27 6d65 6d6f 7279   profile['memory
+0001c3e0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+0001c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c400: 6966 2027 6e75 6d63 7075 7327 2069 6e20  if 'numcpus' in 
+0001c410: 7072 6f66 696c 6520 616e 6420 6375 7272  profile and curr
+0001c420: 656e 7463 7075 7320 213d 2070 726f 6669  entcpus != profi
+0001c430: 6c65 5b27 6e75 6d63 7075 7327 5d3a 0a20  le['numcpus']:. 
+0001c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c450: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001c460: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
 0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c480: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
-0001c490: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0001c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4b0: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
-0001c4c0: 6461 7469 6e67 2063 7075 7320 6f66 207b  dating cpus of {
-0001c4d0: 6e61 6d65 7d20 746f 207b 7072 6f66 696c  name} to {profil
-0001c4e0: 655b 276e 756d 6370 7573 275d 7d22 290a  e['numcpus']}").
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c510: 7a2e 7570 6461 7465 5f63 7075 7328 6e61  z.update_cpus(na
-0001c520: 6d65 2c20 7072 6f66 696c 655b 276e 756d  me, profile['num
-0001c530: 6370 7573 275d 290a 2020 2020 2020 2020  cpus']).        
+0001c480: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001c490: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
+0001c4a0: 6370 7573 206f 6620 7b6e 616d 657d 2074  cpus of {name} t
+0001c4b0: 6f20 7b70 726f 6669 6c65 5b27 6e75 6d63  o {profile['numc
+0001c4c0: 7075 7327 5d7d 2229 0a20 2020 2020 2020  pus']}").       
+0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4e0: 2020 2020 2020 2020 207a 2e75 7064 6174           z.updat
+0001c4f0: 655f 6370 7573 286e 616d 652c 2070 726f  e_cpus(name, pro
+0001c500: 6669 6c65 5b27 6e75 6d63 7075 7327 5d29  file['numcpus'])
+0001c510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c520: 2020 2020 2020 2020 2069 6620 2764 6973           if 'dis
+0001c530: 6b73 2720 696e 2070 726f 6669 6c65 3a0a  ks' in profile:.
 0001c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c550: 6966 2027 6469 736b 7327 2069 6e20 7072  if 'disks' in pr
-0001c560: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
-0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c580: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
-0001c590: 7464 6973 6b73 2920 3c20 6c65 6e28 7072  tdisks) < len(pr
-0001c5a0: 6f66 696c 655b 2764 6973 6b73 275d 293a  ofile['disks']):
-0001c5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c550: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0001c560: 656e 2863 7572 7265 6e74 6469 736b 7329  en(currentdisks)
+0001c570: 203c 206c 656e 2870 726f 6669 6c65 5b27   < len(profile['
+0001c580: 6469 736b 7327 5d29 3a0a 2020 2020 2020  disks']):.      
+0001c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5a0: 2020 2020 2020 2020 2020 7570 6461 7465            update
+0001c5b0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
 0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5d0: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
-0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c600: 7070 7269 6e74 2866 2241 6464 696e 6720  pprint(f"Adding 
-0001c610: 4469 736b 7320 746f 207b 6e61 6d65 7d22  Disks to {name}"
-0001c620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c640: 2020 666f 7220 6469 736b 2069 6e20 7072    for disk in pr
-0001c650: 6f66 696c 655b 2764 6973 6b73 275d 5b6c  ofile['disks'][l
-0001c660: 656e 2863 7572 7265 6e74 6469 736b 7329  en(currentdisks)
-0001c670: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
-0001c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c690: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0001c6a0: 7461 6e63 6528 6469 736b 2c20 696e 7429  tance(disk, int)
-0001c6b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c5d0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0001c5e0: 6622 4164 6469 6e67 2044 6973 6b73 2074  f"Adding Disks t
+0001c5f0: 6f20 7b6e 616d 657d 2229 0a20 2020 2020  o {name}").     
+0001c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c610: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0001c620: 6973 6b20 696e 2070 726f 6669 6c65 5b27  isk in profile['
+0001c630: 6469 736b 7327 5d5b 6c65 6e28 6375 7272  disks'][len(curr
+0001c640: 656e 7464 6973 6b73 293a 5d3a 0a20 2020  entdisks):]:.   
+0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c670: 2069 6620 6973 696e 7374 616e 6365 2864   if isinstance(d
+0001c680: 6973 6b2c 2069 6e74 293a 0a20 2020 2020  isk, int):.     
+0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6b0: 2020 2073 697a 6520 3d20 6469 736b 0a20     size = disk. 
 0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6d0: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
-0001c6e0: 2064 6973 6b0a 2020 2020 2020 2020 2020   disk.          
-0001c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c700: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0001c710: 6f6c 203d 2073 656c 662e 706f 6f6c 0a20  ol = self.pool. 
-0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c740: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0001c750: 6365 2864 6973 6b2c 2073 7472 2920 616e  ce(disk, str) an
-0001c760: 6420 6469 736b 2e69 7364 6967 6974 2829  d disk.isdigit()
-0001c770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c790: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
-0001c7a0: 2069 6e74 2864 6973 6b29 0a20 2020 2020   int(disk).     
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6e0: 2020 2020 2020 2070 6f6f 6c20 3d20 7365         pool = se
+0001c6f0: 6c66 2e70 6f6f 6c0a 2020 2020 2020 2020  lf.pool.        
+0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c710: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001c720: 2069 7369 6e73 7461 6e63 6528 6469 736b   isinstance(disk
+0001c730: 2c20 7374 7229 2061 6e64 2064 6973 6b2e  , str) and disk.
+0001c740: 6973 6469 6769 7428 293a 0a20 2020 2020  isdigit():.     
+0001c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c770: 2020 2073 697a 6520 3d20 696e 7428 6469     size = int(di
+0001c780: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
+0001c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7a0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0001c7b0: 203d 2073 656c 662e 706f 6f6c 0a20 2020   = self.pool.   
 0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7d0: 2020 2070 6f6f 6c20 3d20 7365 6c66 2e70     pool = self.p
-0001c7e0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-0001c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c800: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-0001c810: 6e73 7461 6e63 6528 6469 736b 2c20 6469  nstance(disk, di
-0001c820: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-0001c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c840: 2020 2020 2020 2020 2020 2020 2073 697a               siz
-0001c850: 6520 3d20 6469 736b 2e67 6574 2827 7369  e = disk.get('si
-0001c860: 7a65 272c 2073 656c 662e 6469 736b 7369  ze', self.disksi
-0001c870: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c890: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-0001c8a0: 203d 2064 6973 6b2e 6765 7428 2770 6f6f   = disk.get('poo
-0001c8b0: 6c27 2c20 7365 6c66 2e70 6f6f 6c29 0a20  l', self.pool). 
-0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7e0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0001c7f0: 2864 6973 6b2c 2064 6963 7429 3a0a 2020  (disk, dict):.  
+0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c820: 2020 2020 2020 7369 7a65 203d 2064 6973        size = dis
+0001c830: 6b2e 6765 7428 2773 697a 6527 2c20 7365  k.get('size', se
+0001c840: 6c66 2e64 6973 6b73 697a 6529 0a20 2020  lf.disksize).   
+0001c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2020 2020 2070 6f6f 6c20 3d20 6469 736b       pool = disk
+0001c880: 2e67 6574 2827 706f 6f6c 272c 2073 656c  .get('pool', sel
+0001c890: 662e 706f 6f6c 290a 2020 2020 2020 2020  f.pool).        
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001c8c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8e0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001c8f0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
 0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c910: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c930: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
-0001c940: 6164 645f 6469 736b 286e 616d 653d 6e61  add_disk(name=na
-0001c950: 6d65 2c20 7369 7a65 3d73 697a 652c 2070  me, size=size, p
-0001c960: 6f6f 6c3d 706f 6f6c 290a 2020 2020 2020  ool=pool).      
-0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c980: 2020 2020 2020 6966 206c 656e 2863 7572        if len(cur
-0001c990: 7265 6e74 6469 736b 7329 203e 206c 656e  rentdisks) > len
-0001c9a0: 2870 726f 6669 6c65 5b27 6469 736b 7327  (profile['disks'
-0001c9b0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0001c910: 2020 2020 2020 207a 2e61 6464 5f64 6973         z.add_dis
+0001c920: 6b28 6e61 6d65 3d6e 616d 652c 2073 697a  k(name=name, siz
+0001c930: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
+0001c940: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0001c950: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c960: 6620 6c65 6e28 6375 7272 656e 7464 6973  f len(currentdis
+0001c970: 6b73 2920 3e20 6c65 6e28 7072 6f66 696c  ks) > len(profil
+0001c980: 655b 2764 6973 6b73 275d 293a 0a20 2020  e['disks']):.   
+0001c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9a0: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+0001c9b0: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
 0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9d0: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
-0001c9e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0001c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca00: 2020 2070 7072 696e 7428 6622 5265 6d6f     pprint(f"Remo
-0001ca10: 7669 6e67 2044 6973 6b73 206f 6620 7b6e  ving Disks of {n
-0001ca20: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
-0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca40: 2020 2020 2020 2066 6f72 2064 6973 6b20         for disk 
-0001ca50: 696e 2063 7572 7265 6e74 6469 736b 735b  in currentdisks[
-0001ca60: 6c65 6e28 6375 7272 656e 7464 6973 6b73  len(currentdisks
-0001ca70: 2920 2d20 6c65 6e28 7072 6f66 696c 655b  ) - len(profile[
-0001ca80: 2764 6973 6b73 275d 293a 5d3a 0a20 2020  'disks']):]:.   
-0001ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2064 6973 6b6e 616d 6520 3d20 6f73 2e70   diskname = os.p
-0001cac0: 6174 682e 6261 7365 6e61 6d65 2864 6973  ath.basename(dis
-0001cad0: 6b5b 2770 6174 6827 5d29 0a20 2020 2020  k['path']).     
-0001cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001caf0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001cb00: 6973 6b70 6f6f 6c20 3d20 6f73 2e70 6174  iskpool = os.pat
-0001cb10: 682e 6469 726e 616d 6528 6469 736b 5b27  h.dirname(disk['
-0001cb20: 7061 7468 275d 290a 2020 2020 2020 2020  path']).        
-0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb40: 2020 2020 2020 2020 2020 2020 7a2e 6465              z.de
-0001cb50: 6c65 7465 5f64 6973 6b28 6e61 6d65 3d6e  lete_disk(name=n
-0001cb60: 616d 652c 2064 6973 6b6e 616d 653d 6469  ame, diskname=di
-0001cb70: 736b 6e61 6d65 2c20 706f 6f6c 3d64 6973  skname, pool=dis
-0001cb80: 6b70 6f6f 6c29 0a20 2020 2020 2020 2020  kpool).         
-0001cb90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001cba0: 6620 276e 6574 7327 2069 6e20 7072 6f66  f 'nets' in prof
-0001cbb0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbd0: 2069 6620 6c65 6e28 6375 7272 656e 746e   if len(currentn
-0001cbe0: 6574 7329 203c 206c 656e 2870 726f 6669  ets) < len(profi
-0001cbf0: 6c65 5b27 6e65 7473 275d 293a 0a20 2020  le['nets']):.   
-0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc10: 2020 2020 2020 2020 2020 2020 2075 7064               upd
-0001cc20: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
-0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc40: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0001cc50: 6e74 2866 2241 6464 696e 6720 4e69 6373  nt(f"Adding Nics
-0001cc60: 2074 6f20 7b6e 616d 657d 2229 0a20 2020   to {name}").   
-0001cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001cc90: 206e 6574 2069 6e20 7072 6f66 696c 655b   net in profile[
-0001cca0: 276e 6574 7327 5d5b 6c65 6e28 6375 7272  'nets'][len(curr
-0001ccb0: 656e 746e 6574 7329 3a5d 3a0a 2020 2020  entnets):]:.    
-0001ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cce0: 6966 2069 7369 6e73 7461 6e63 6528 6e65  if isinstance(ne
-0001ccf0: 742c 2073 7472 293a 0a20 2020 2020 2020  t, str):.       
-0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9d0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001c9e0: 6e74 2866 2252 656d 6f76 696e 6720 4469  nt(f"Removing Di
+0001c9f0: 736b 7320 6f66 207b 6e61 6d65 7d22 290a  sks of {name}").
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 666f 7220 6469 736b 2069 6e20 6375 7272  for disk in curr
+0001ca30: 656e 7464 6973 6b73 5b6c 656e 2863 7572  entdisks[len(cur
+0001ca40: 7265 6e74 6469 736b 7329 202d 206c 656e  rentdisks) - len
+0001ca50: 2870 726f 6669 6c65 5b27 6469 736b 7327  (profile['disks'
+0001ca60: 5d29 3a5d 3a0a 2020 2020 2020 2020 2020  ]):]:.          
+0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca80: 2020 2020 2020 2020 2020 6469 736b 6e61            diskna
+0001ca90: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
+0001caa0: 656e 616d 6528 6469 736b 5b27 7061 7468  ename(disk['path
+0001cab0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+0001cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cad0: 2020 2020 2020 2020 6469 736b 706f 6f6c          diskpool
+0001cae0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+0001caf0: 6d65 2864 6973 6b5b 2770 6174 6827 5d29  me(disk['path'])
+0001cb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb20: 2020 2020 207a 2e64 656c 6574 655f 6469       z.delete_di
+0001cb30: 736b 286e 616d 653d 6e61 6d65 2c20 6469  sk(name=name, di
+0001cb40: 736b 6e61 6d65 3d64 6973 6b6e 616d 652c  skname=diskname,
+0001cb50: 2070 6f6f 6c3d 6469 736b 706f 6f6c 290a   pool=diskpool).
+0001cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb70: 2020 2020 2020 2020 6966 2027 6e65 7473          if 'nets
+0001cb80: 2720 696e 2070 726f 6669 6c65 3a0a 2020  ' in profile:.  
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cba0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0001cbb0: 2863 7572 7265 6e74 6e65 7473 2920 3c20  (currentnets) < 
+0001cbc0: 6c65 6e28 7072 6f66 696c 655b 276e 6574  len(profile['net
+0001cbd0: 7327 5d29 3a0a 2020 2020 2020 2020 2020  s']):.          
+0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbf0: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
+0001cc00: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc20: 2020 2020 2070 7072 696e 7428 6622 4164       pprint(f"Ad
+0001cc30: 6469 6e67 204e 6963 7320 746f 207b 6e61  ding Nics to {na
+0001cc40: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc60: 2020 2020 2020 666f 7220 6e65 7420 696e        for net in
+0001cc70: 2070 726f 6669 6c65 5b27 6e65 7473 275d   profile['nets']
+0001cc80: 5b6c 656e 2863 7572 7265 6e74 6e65 7473  [len(currentnets
+0001cc90: 293a 5d3a 0a20 2020 2020 2020 2020 2020  ):]:.           
+0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccb0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0001ccc0: 7374 616e 6365 286e 6574 2c20 7374 7229  stance(net, str)
+0001ccd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccf0: 2020 2020 2020 2020 2020 6e65 7477 6f72            networ
+0001cd00: 6b20 3d20 6e65 740a 2020 2020 2020 2020  k = net.        
 0001cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd20: 206e 6574 776f 726b 203d 206e 6574 0a20   network = net. 
-0001cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd50: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0001cd60: 6365 286e 6574 2c20 6469 6374 2920 616e  ce(net, dict) an
-0001cd70: 6420 276e 616d 6527 2069 6e20 6e65 743a  d 'name' in net:
-0001cd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cda0: 2020 2020 2020 2020 206e 6574 776f 726b           network
-0001cdb0: 203d 206e 6574 5b27 6e61 6d65 275d 0a20   = net['name']. 
-0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd20: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001cd30: 2069 7369 6e73 7461 6e63 6528 6e65 742c   isinstance(net,
+0001cd40: 2064 6963 7429 2061 6e64 2027 6e61 6d65   dict) and 'name
+0001cd50: 2720 696e 206e 6574 3a0a 2020 2020 2020  ' in net:.      
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd80: 2020 6e65 7477 6f72 6b20 3d20 6e65 745b    network = net[
+0001cd90: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+0001cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001cdc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce10: 2065 7272 6f72 2866 2253 6b70 7069 6e67   error(f"Skpping
-0001ce20: 2077 726f 6e67 206e 6963 2073 7065 6320   wrong nic spec 
-0001ce30: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cde0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+0001cdf0: 6622 536b 7070 696e 6720 7772 6f6e 6720  f"Skpping wrong 
+0001ce00: 6e69 6320 7370 6563 2066 6f72 207b 6e61  nic spec for {na
+0001ce10: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+0001ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce30: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001ce40: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
 0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce60: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce90: 2020 7a2e 6164 645f 6e69 6328 6e61 6d65    z.add_nic(name
-0001cea0: 2c20 6e65 7477 6f72 6b29 0a20 2020 2020  , network).     
-0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cec0: 2020 2020 2020 2069 6620 6c65 6e28 6375         if len(cu
-0001ced0: 7272 656e 746e 6574 7329 203e 206c 656e  rrentnets) > len
-0001cee0: 2870 726f 6669 6c65 5b27 6e65 7473 275d  (profile['nets']
-0001cef0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001ce60: 2020 2020 2020 2020 2020 207a 2e61 6464             z.add
+0001ce70: 5f6e 6963 286e 616d 652c 206e 6574 776f  _nic(name, netwo
+0001ce80: 726b 290a 2020 2020 2020 2020 2020 2020  rk).            
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 6966 206c 656e 2863 7572 7265 6e74 6e65  if len(currentne
+0001ceb0: 7473 2920 3e20 6c65 6e28 7072 6f66 696c  ts) > len(profil
+0001cec0: 655b 276e 6574 7327 5d29 3a0a 2020 2020  e['nets']):.    
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0001cef0: 7465 6420 3d20 5472 7565 0a20 2020 2020  ted = True.     
 0001cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf10: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
-0001cf20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf40: 2020 7070 7269 6e74 2866 2252 656d 6f76    pprint(f"Remov
-0001cf50: 696e 6720 4e69 6373 206f 6620 7b6e 616d  ing Nics of {nam
-0001cf60: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf80: 2020 2020 2066 6f72 206e 6574 2069 6e20       for net in 
-0001cf90: 7261 6e67 6528 6c65 6e28 6375 7272 656e  range(len(curren
-0001cfa0: 746e 6574 7329 2c20 6c65 6e28 7072 6f66  tnets), len(prof
-0001cfb0: 696c 655b 276e 6574 7327 5d29 2c20 2d31  ile['nets']), -1
-0001cfc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfe0: 2020 2020 2020 2069 6e74 6572 6661 6365         interface
-0001cff0: 203d 2066 2265 7468 7b6e 6574 202d 317d   = f"eth{net -1}
-0001d000: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d020: 2020 2020 2020 7a2e 6465 6c65 7465 5f6e        z.delete_n
-0001d030: 6963 286e 616d 652c 2069 6e74 6572 6661  ic(name, interfa
-0001d040: 6365 290a 2020 2020 2020 2020 2020 2020  ce).            
-0001d050: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0001d060: 7665 7272 6964 6573 2e67 6574 2827 736b  verrides.get('sk
-0001d070: 6970 5f66 696c 6573 5f72 656d 6564 6961  ip_files_remedia
-0001d080: 7469 6f6e 272c 2046 616c 7365 293a 0a20  tion', False):. 
-0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0a0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001d0b0: 7428 6622 536b 6970 7069 6e67 2052 656d  t(f"Skipping Rem
-0001d0c0: 6564 6961 7469 6f6e 2066 696c 6573 206f  ediation files o
-0001d0d0: 6620 7b6e 616d 657d 2229 0a20 2020 2020  f {name}").     
-0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0f0: 2020 2065 6c69 6620 7365 6c66 2e72 656d     elif self.rem
-0001d100: 6564 6961 7465 5f66 696c 6573 286e 616d  ediate_files(nam
-0001d110: 652c 2070 726f 6669 6c65 2e67 6574 2827  e, profile.get('
-0001d120: 6669 6c65 7327 2c20 5b5d 292c 206f 7665  files', []), ove
-0001d130: 7272 6964 6573 2c20 696e 7075 7464 6972  rrides, inputdir
-0001d140: 3d69 6e70 7574 6469 7229 3a0a 2020 2020  =inputdir):.    
+0001cf10: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0001cf20: 7428 6622 5265 6d6f 7669 6e67 204e 6963  t(f"Removing Nic
+0001cf30: 7320 6f66 207b 6e61 6d65 7d22 290a 2020  s of {name}").  
+0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001cf60: 7220 6e65 7420 696e 2072 616e 6765 286c  r net in range(l
+0001cf70: 656e 2863 7572 7265 6e74 6e65 7473 292c  en(currentnets),
+0001cf80: 206c 656e 2870 726f 6669 6c65 5b27 6e65   len(profile['ne
+0001cf90: 7473 275d 292c 202d 3129 3a0a 2020 2020  ts']), -1):.    
+0001cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfc0: 696e 7465 7266 6163 6520 3d20 6622 6574  interface = f"et
+0001cfd0: 687b 6e65 7420 2d31 7d22 0a20 2020 2020  h{net -1}".     
+0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cff0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0001d000: 2e64 656c 6574 655f 6e69 6328 6e61 6d65  .delete_nic(name
+0001d010: 2c20 696e 7465 7266 6163 6529 0a20 2020  , interface).   
+0001d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d030: 2020 2020 2069 6620 6f76 6572 7269 6465       if override
+0001d040: 732e 6765 7428 2773 6b69 705f 6669 6c65  s.get('skip_file
+0001d050: 735f 7265 6d65 6469 6174 696f 6e27 2c20  s_remediation', 
+0001d060: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d080: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
+0001d090: 7070 696e 6720 5265 6d65 6469 6174 696f  pping Remediatio
+0001d0a0: 6e20 6669 6c65 7320 6f66 207b 6e61 6d65  n files of {name
+0001d0b0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001d0c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001d0d0: 2073 656c 662e 7265 6d65 6469 6174 655f   self.remediate_
+0001d0e0: 6669 6c65 7328 6e61 6d65 2c20 7072 6f66  files(name, prof
+0001d0f0: 696c 652e 6765 7428 2766 696c 6573 272c  ile.get('files',
+0001d100: 205b 5d29 2c20 6f76 6572 7269 6465 732c   []), overrides,
+0001d110: 2069 6e70 7574 6469 723d 696e 7075 7464   inputdir=inputd
+0001d120: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d140: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
 0001d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d160: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
-0001d170: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0001d180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d190: 6620 6e6f 7420 7570 6461 7465 643a 0a20  f not updated:. 
-0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1b0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001d1c0: 7428 6622 7b6e 616d 657d 2073 6b69 7070  t(f"{name} skipp
-0001d1d0: 6564 206f 6e20 7b76 6d63 6c69 656e 747d  ed on {vmclient}
-0001d1e0: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
-0001d1f0: 2020 2020 2020 2020 6578 6973 7469 6e67          existing
-0001d200: 766d 732e 6170 7065 6e64 286e 616d 6529  vms.append(name)
-0001d210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d220: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0001d230: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-0001d240: 6172 6564 6b65 7920 3d20 7072 6f66 696c  aredkey = profil
-0001d250: 652e 6765 7428 2773 6861 7265 646b 6579  e.get('sharedkey
-0001d260: 272c 2073 656c 662e 7368 6172 6564 6b65  ', self.sharedke
-0001d270: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-0001d280: 2020 2069 6620 7368 6172 6564 6b65 793a     if sharedkey:
-0001d290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d2a0: 2020 2020 2076 6d63 6f75 6e74 6572 202b       vmcounter +
-0001d2b0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0001d2c0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-0001d2d0: 732e 7061 7468 2e65 7869 7374 7328 6622  s.path.exists(f"
-0001d2e0: 7b70 6c61 6e7d 2e6b 6579 2229 206f 7220  {plan}.key") or 
-0001d2f0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-0001d300: 7473 2866 227b 706c 616e 7d2e 6b65 792e  ts(f"{plan}.key.
-0001d310: 7075 6222 293a 0a20 2020 2020 2020 2020  pub"):.         
-0001d320: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0001d330: 732e 7379 7374 656d 2866 2273 7368 2d6b  s.system(f"ssh-k
-0001d340: 6579 6765 6e20 2d71 7420 7273 6120 2d4e  eygen -qt rsa -N
-0001d350: 2027 2720 2d66 207b 706c 616e 7d2e 6b65   '' -f {plan}.ke
-0001d360: 7922 290a 2020 2020 2020 2020 2020 2020  y").            
-0001d370: 2020 2020 2020 2020 7075 626c 6963 6b65          publicke
-0001d380: 7920 3d20 6f70 656e 2866 227b 706c 616e  y = open(f"{plan
-0001d390: 7d2e 6b65 792e 7075 6222 292e 7265 6164  }.key.pub").read
-0001d3a0: 2829 2e73 7472 6970 2829 0a20 2020 2020  ().strip().     
-0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d3c0: 7269 7661 7465 6b65 7920 3d20 6f70 656e  rivatekey = open
-0001d3d0: 2866 227b 706c 616e 7d2e 6b65 7922 292e  (f"{plan}.key").
-0001d3e0: 7265 6164 2829 2e73 7472 6970 2829 0a20  read().strip(). 
-0001d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d400: 2020 2069 6620 276b 6579 7327 206e 6f74     if 'keys' not
-0001d410: 2069 6e20 7072 6f66 696c 653a 0a20 2020   in profile:.   
-0001d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d430: 2020 2020 2070 726f 6669 6c65 5b27 6b65       profile['ke
-0001d440: 7973 275d 203d 205b 7075 626c 6963 6b65  ys'] = [publicke
-0001d450: 795d 0a20 2020 2020 2020 2020 2020 2020  y].             
-0001d460: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d480: 2020 2020 2070 726f 6669 6c65 5b27 6b65       profile['ke
-0001d490: 7973 275d 2e61 7070 656e 6428 7075 626c  ys'].append(publ
-0001d4a0: 6963 6b65 7929 0a20 2020 2020 2020 2020  ickey).         
-0001d4b0: 2020 2020 2020 2020 2020 2069 6620 2766             if 'f
-0001d4c0: 696c 6573 2720 696e 2070 726f 6669 6c65  iles' in profile
-0001d4d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d4e0: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-0001d4f0: 655b 2766 696c 6573 275d 2e61 7070 656e  e['files'].appen
-0001d500: 6428 7b27 7061 7468 273a 2027 2f72 6f6f  d({'path': '/roo
-0001d510: 742f 2e73 7368 2f69 645f 7273 6127 2c20  t/.ssh/id_rsa', 
-0001d520: 2763 6f6e 7465 6e74 273a 2070 7269 7661  'content': priva
-0001d530: 7465 6b65 797d 290a 2020 2020 2020 2020  tekey}).        
-0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d550: 7072 6f66 696c 655b 2766 696c 6573 275d  profile['files']
-0001d560: 2e61 7070 656e 6428 7b27 7061 7468 273a  .append({'path':
-0001d570: 2027 2f72 6f6f 742f 2e73 7368 2f69 645f   '/root/.ssh/id_
-0001d580: 7273 612e 7075 6227 2c20 2763 6f6e 7465  rsa.pub', 'conte
-0001d590: 6e74 273a 2070 7562 6c69 636b 6579 7d29  nt': publickey})
-0001d5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d5b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5d0: 2020 2070 726f 6669 6c65 5b27 6669 6c65     profile['file
-0001d5e0: 7327 5d20 3d20 5b7b 2770 6174 6827 3a20  s'] = [{'path': 
-0001d5f0: 272f 726f 6f74 2f2e 7373 682f 6964 5f72  '/root/.ssh/id_r
-0001d600: 7361 272c 2027 636f 6e74 656e 7427 3a20  sa', 'content': 
-0001d610: 7072 6976 6174 656b 6579 7d2c 0a20 2020  privatekey},.   
-0001d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d640: 2020 2020 2020 2020 207b 2770 6174 6827           {'path'
-0001d650: 3a20 272f 726f 6f74 2f2e 7373 682f 6964  : '/root/.ssh/id
-0001d660: 5f72 7361 2e70 7562 272c 2027 636f 6e74  _rsa.pub', 'cont
-0001d670: 656e 7427 3a20 7075 626c 6963 6b65 797d  ent': publickey}
-0001d680: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001d690: 2020 2020 2020 6966 2076 6d63 6f75 6e74        if vmcount
-0001d6a0: 6572 203e 3d20 6c65 6e28 766d 656e 7472  er >= len(vmentr
-0001d6b0: 6965 7329 3a0a 2020 2020 2020 2020 2020  ies):.          
-0001d6c0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-0001d6d0: 2e72 656d 6f76 6528 6622 7b70 6c61 6e7d  .remove(f"{plan}
-0001d6e0: 2e6b 6579 2e70 7562 2229 0a20 2020 2020  .key.pub").     
-0001d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d700: 2020 206f 732e 7265 6d6f 7665 2866 227b     os.remove(f"{
-0001d710: 706c 616e 7d2e 6b65 7922 290a 2020 2020  plan}.key").    
-0001d720: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001d730: 656e 746f 7665 7272 6964 6573 203d 206f  entoverrides = o
-0001d740: 7665 7272 6964 6573 2e63 6f70 7928 290a  verrides.copy().
+0001d160: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
+0001d170: 7064 6174 6564 3a0a 2020 2020 2020 2020  pdated:.        
+0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d190: 2020 2020 7070 7269 6e74 2866 227b 6e61      pprint(f"{na
+0001d1a0: 6d65 7d20 736b 6970 7065 6420 6f6e 207b  me} skipped on {
+0001d1b0: 766d 636c 6965 6e74 7d21 2229 0a20 2020  vmclient}!").   
+0001d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1d0: 2065 7869 7374 696e 6776 6d73 2e61 7070   existingvms.app
+0001d1e0: 656e 6428 6e61 6d65 290a 2020 2020 2020  end(name).      
+0001d1f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001d200: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0001d210: 2020 2020 2020 2073 6861 7265 646b 6579         sharedkey
+0001d220: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0001d230: 7368 6172 6564 6b65 7927 2c20 7365 6c66  sharedkey', self
+0001d240: 2e73 6861 7265 646b 6579 290a 2020 2020  .sharedkey).    
+0001d250: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001d260: 6861 7265 646b 6579 3a0a 2020 2020 2020  haredkey:.      
+0001d270: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+0001d280: 636f 756e 7465 7220 2b3d 2031 0a20 2020  counter += 1.   
+0001d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2a0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0001d2b0: 6578 6973 7473 2866 227b 706c 616e 7d2e  exists(f"{plan}.
+0001d2c0: 6b65 7922 2920 6f72 206e 6f74 206f 732e  key") or not os.
+0001d2d0: 7061 7468 2e65 7869 7374 7328 6622 7b70  path.exists(f"{p
+0001d2e0: 6c61 6e7d 2e6b 6579 2e70 7562 2229 3a0a  lan}.key.pub"):.
+0001d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d300: 2020 2020 2020 2020 6f73 2e73 7973 7465          os.syste
+0001d310: 6d28 6622 7373 682d 6b65 7967 656e 202d  m(f"ssh-keygen -
+0001d320: 7174 2072 7361 202d 4e20 2727 202d 6620  qt rsa -N '' -f 
+0001d330: 7b70 6c61 6e7d 2e6b 6579 2229 0a20 2020  {plan}.key").   
+0001d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d350: 2070 7562 6c69 636b 6579 203d 206f 7065   publickey = ope
+0001d360: 6e28 6622 7b70 6c61 6e7d 2e6b 6579 2e70  n(f"{plan}.key.p
+0001d370: 7562 2229 2e72 6561 6428 292e 7374 7269  ub").read().stri
+0001d380: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+0001d390: 2020 2020 2020 2020 7072 6976 6174 656b          privatek
+0001d3a0: 6579 203d 206f 7065 6e28 6622 7b70 6c61  ey = open(f"{pla
+0001d3b0: 6e7d 2e6b 6579 2229 2e72 6561 6428 292e  n}.key").read().
+0001d3c0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+0001d3d0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001d3e0: 6b65 7973 2720 6e6f 7420 696e 2070 726f  keys' not in pro
+0001d3f0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+0001d400: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001d410: 6f66 696c 655b 276b 6579 7327 5d20 3d20  ofile['keys'] = 
+0001d420: 5b70 7562 6c69 636b 6579 5d0a 2020 2020  [publickey].    
+0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d440: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001d450: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001d460: 6f66 696c 655b 276b 6579 7327 5d2e 6170  ofile['keys'].ap
+0001d470: 7065 6e64 2870 7562 6c69 636b 6579 290a  pend(publickey).
+0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d490: 2020 2020 6966 2027 6669 6c65 7327 2069      if 'files' i
+0001d4a0: 6e20 7072 6f66 696c 653a 0a20 2020 2020  n profile:.     
+0001d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4c0: 2020 2070 726f 6669 6c65 5b27 6669 6c65     profile['file
+0001d4d0: 7327 5d2e 6170 7065 6e64 287b 2770 6174  s'].append({'pat
+0001d4e0: 6827 3a20 272f 726f 6f74 2f2e 7373 682f  h': '/root/.ssh/
+0001d4f0: 6964 5f72 7361 272c 2027 636f 6e74 656e  id_rsa', 'conten
+0001d500: 7427 3a20 7072 6976 6174 656b 6579 7d29  t': privatekey})
+0001d510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d520: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+0001d530: 5b27 6669 6c65 7327 5d2e 6170 7065 6e64  ['files'].append
+0001d540: 287b 2770 6174 6827 3a20 272f 726f 6f74  ({'path': '/root
+0001d550: 2f2e 7373 682f 6964 5f72 7361 2e70 7562  /.ssh/id_rsa.pub
+0001d560: 272c 2027 636f 6e74 656e 7427 3a20 7075  ', 'content': pu
+0001d570: 626c 6963 6b65 797d 290a 2020 2020 2020  blickey}).      
+0001d580: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001d590: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d5a0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
+0001d5b0: 696c 655b 2766 696c 6573 275d 203d 205b  ile['files'] = [
+0001d5c0: 7b27 7061 7468 273a 2027 2f72 6f6f 742f  {'path': '/root/
+0001d5d0: 2e73 7368 2f69 645f 7273 6127 2c20 2763  .ssh/id_rsa', 'c
+0001d5e0: 6f6e 7465 6e74 273a 2070 7269 7661 7465  ontent': private
+0001d5f0: 6b65 797d 2c0a 2020 2020 2020 2020 2020  key},.          
+0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d620: 2020 7b27 7061 7468 273a 2027 2f72 6f6f    {'path': '/roo
+0001d630: 742f 2e73 7368 2f69 645f 7273 612e 7075  t/.ssh/id_rsa.pu
+0001d640: 6227 2c20 2763 6f6e 7465 6e74 273a 2070  b', 'content': p
+0001d650: 7562 6c69 636b 6579 7d5d 0a20 2020 2020  ublickey}].     
+0001d660: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001d670: 6620 766d 636f 756e 7465 7220 3e3d 206c  f vmcounter >= l
+0001d680: 656e 2876 6d65 6e74 7269 6573 293a 0a20  en(vmentries):. 
+0001d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6a0: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
+0001d6b0: 2866 227b 706c 616e 7d2e 6b65 792e 7075  (f"{plan}.key.pu
+0001d6c0: 6222 290a 2020 2020 2020 2020 2020 2020  b").            
+0001d6d0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
+0001d6e0: 656d 6f76 6528 6622 7b70 6c61 6e7d 2e6b  emove(f"{plan}.k
+0001d6f0: 6579 2229 0a20 2020 2020 2020 2020 2020  ey").           
+0001d700: 2020 2020 2063 7572 7265 6e74 6f76 6572       currentover
+0001d710: 7269 6465 7320 3d20 6f76 6572 7269 6465  rides = override
+0001d720: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
+0001d730: 2020 2020 2020 2020 2069 6620 2769 6d61           if 'ima
+0001d740: 6765 2720 696e 2070 726f 6669 6c65 3a0a  ge' in profile:.
 0001d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d760: 6966 2027 696d 6167 6527 2069 6e20 7072  if 'image' in pr
-0001d770: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
-0001d780: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-0001d790: 6e74 7279 2069 6e20 7365 6c66 2e6c 6973  ntry in self.lis
-0001d7a0: 745f 7072 6f66 696c 6573 2829 3a0a 2020  t_profiles():.  
-0001d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7c0: 2020 2020 2020 6375 7272 656e 7469 6d61        currentima
-0001d7d0: 6765 203d 2070 726f 6669 6c65 5b27 696d  ge = profile['im
-0001d7e0: 6167 6527 5d0a 2020 2020 2020 2020 2020  age'].          
-0001d7f0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0001d800: 7472 7970 726f 6669 6c65 203d 2065 6e74  tryprofile = ent
-0001d810: 7279 5b30 5d0a 2020 2020 2020 2020 2020  ry[0].          
-0001d820: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d830: 2065 6e74 7279 7072 6f66 696c 6520 3d3d   entryprofile ==
-0001d840: 2063 7572 7265 6e74 696d 6167 653a 0a20   currentimage:. 
-0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d860: 2020 2020 2020 2020 2020 2070 726f 6669             profi
-0001d870: 6c65 5b27 696d 6167 6527 5d20 3d20 656e  le['image'] = en
-0001d880: 7472 795b 345d 0a20 2020 2020 2020 2020  try[4].         
-0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8a0: 2020 2063 7572 7265 6e74 6f76 6572 7269     currentoverri
-0001d8b0: 6465 735b 2769 6d61 6765 275d 203d 2070  des['image'] = p
-0001d8c0: 726f 6669 6c65 5b27 696d 6167 6527 5d0a  rofile['image'].
-0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8e0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0001d8f0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0001d900: 2020 6966 2074 6872 6561 6465 643a 0a20    if threaded:. 
-0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d920: 2020 206e 6577 5f61 7267 7320 3d20 286e     new_args = (n
-0001d930: 616d 652c 2070 726f 6669 6c65 6e61 6d65  ame, profilename
-0001d940: 2c20 6375 7272 656e 746f 7665 7272 6964  , currentoverrid
-0001d950: 6573 2c20 7072 6f66 696c 652c 207a 2c20  es, profile, z, 
-0001d960: 706c 616e 2c20 6375 7272 656e 7470 6c61  plan, currentpla
-0001d970: 6e64 6972 2c20 766d 636c 6965 6e74 2c0a  ndir, vmclient,.
-0001d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9a0: 6f6e 666c 792c 206f 6e6c 7961 7373 6574  onfly, onlyasset
-0001d9b0: 732c 206e 6577 766d 732c 2066 6169 6c65  s, newvms, faile
-0001d9c0: 6476 6d73 2c20 6173 796e 6377 6169 7476  dvms, asyncwaitv
-0001d9d0: 6d73 2c20 6e65 7761 7373 6574 7329 0a20  ms, newassets). 
-0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9f0: 2020 2074 203d 2074 6872 6561 6469 6e67     t = threading
-0001da00: 2e54 6872 6561 6428 7461 7267 6574 3d73  .Thread(target=s
-0001da10: 656c 662e 7468 7265 6164 6564 5f63 7265  elf.threaded_cre
-0001da20: 6174 655f 766d 2c20 6172 6773 3d6e 6577  ate_vm, args=new
-0001da30: 5f61 7267 7329 0a20 2020 2020 2020 2020  _args).         
-0001da40: 2020 2020 2020 2020 2020 2074 6872 6561             threa
-0001da50: 6473 2e61 7070 656e 6428 7429 0a20 2020  ds.append(t).   
-0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da70: 2074 2e73 7461 7274 2829 0a20 2020 2020   t.start().     
-0001da80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001da90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001daa0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-0001dab0: 6c66 2e63 7265 6174 655f 766d 286e 616d  lf.create_vm(nam
-0001dac0: 652c 2070 726f 6669 6c65 6e61 6d65 2c20  e, profilename, 
-0001dad0: 6f76 6572 7269 6465 733d 6375 7272 656e  overrides=curren
-0001dae0: 746f 7665 7272 6964 6573 2c20 6375 7374  toverrides, cust
-0001daf0: 6f6d 7072 6f66 696c 653d 7072 6f66 696c  omprofile=profil
-0001db00: 652c 206b 3d7a 2c0a 2020 2020 2020 2020  e, k=z,.        
-0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db30: 2020 2020 706c 616e 3d70 6c61 6e2c 2062      plan=plan, b
-0001db40: 6173 6564 6972 3d63 7572 7265 6e74 706c  asedir=currentpl
-0001db50: 616e 6469 722c 2063 6c69 656e 743d 766d  andir, client=vm
-0001db60: 636c 6965 6e74 2c20 6f6e 666c 793d 6f6e  client, onfly=on
-0001db70: 666c 792c 0a20 2020 2020 2020 2020 2020  fly,.           
-0001db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dba0: 206f 6e6c 7961 7373 6574 733d 6f6e 6c79   onlyassets=only
-0001dbb0: 6173 7365 7473 290a 2020 2020 2020 2020  assets).        
-0001dbc0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001dbd0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbf0: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6861         common.ha
-0001dc00: 6e64 6c65 5f72 6573 706f 6e73 6528 7265  ndle_response(re
-0001dc10: 7375 6c74 2c20 6e61 6d65 2c20 636c 6965  sult, name, clie
-0001dc20: 6e74 3d76 6d63 6c69 656e 7429 0a20 2020  nt=vmclient).   
-0001dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc40: 2073 656c 662e 6861 6e64 6c65 5f76 6d5f   self.handle_vm_
-0001dc50: 7265 7375 6c74 286e 616d 652c 2070 726f  result(name, pro
-0001dc60: 6669 6c65 2c20 7265 7375 6c74 3d72 6573  file, result=res
-0001dc70: 756c 742c 206e 6577 766d 733d 6e65 7776  ult, newvms=newv
-0001dc80: 6d73 2c20 6661 696c 6564 766d 733d 6661  ms, failedvms=fa
-0001dc90: 696c 6564 766d 732c 0a20 2020 2020 2020  iledvms,.       
-0001dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcc0: 2020 2061 7379 6e63 7761 6974 766d 733d     asyncwaitvms=
-0001dcd0: 6173 796e 6377 6169 7476 6d73 2c20 6f6e  asyncwaitvms, on
-0001dce0: 6c79 6173 7365 7473 3d6f 6e6c 7961 7373  lyassets=onlyass
-0001dcf0: 6574 732c 206e 6577 6173 7365 7473 3d6e  ets, newassets=n
-0001dd00: 6577 6173 7365 7473 2c0a 2020 2020 2020  ewassets,.      
-0001dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd30: 2020 2020 766d 636c 6965 6e74 3d76 6d63      vmclient=vmc
-0001dd40: 6c69 656e 7429 0a20 2020 2020 2020 2069  lient).        i
-0001dd50: 6620 766d 656e 7472 6965 7320 616e 6420  f vmentries and 
-0001dd60: 7468 7265 6164 6564 3a0a 2020 2020 2020  threaded:.      
-0001dd70: 2020 2020 2020 7768 696c 6520 5472 7565        while True
-0001dd80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001dd90: 2020 666f 7220 696e 6465 782c 2074 2069    for index, t i
-0001dda0: 6e20 656e 756d 6572 6174 6528 7468 7265  n enumerate(thre
-0001ddb0: 6164 7329 3a0a 2020 2020 2020 2020 2020  ads):.          
-0001ddc0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001ddd0: 2074 2e69 735f 616c 6976 6528 293a 0a20   t.is_alive():. 
-0001dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddf0: 2020 2020 2020 2064 656c 2074 6872 6561         del threa
-0001de00: 6473 5b69 6e64 6578 5d0a 2020 2020 2020  ds[index].      
-0001de10: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001de20: 2074 6872 6561 6473 3a0a 2020 2020 2020   threads:.      
-0001de30: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001de40: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-0001de50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001de60: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-0001de70: 6565 7028 3129 0a20 2020 2020 2020 2069  eep(1).        i
-0001de80: 6620 766d 636c 6965 6e74 733a 0a20 2020  f vmclients:.   
-0001de90: 2020 2020 2020 2020 2079 616d 6c2e 7361           yaml.sa
-0001dea0: 6665 5f64 756d 7028 766d 636c 6965 6e74  fe_dump(vmclient
-0001deb0: 732c 206f 7065 6e28 6f73 2e70 6174 682e  s, open(os.path.
-0001dec0: 6578 7061 6e64 7573 6572 2866 277e 2f2e  expanduser(f'~/.
-0001ded0: 6b63 6c69 2f76 6d63 6c69 656e 7473 5f7b  kcli/vmclients_{
-0001dee0: 706c 616e 7d27 292c 2027 7727 2929 0a20  plan}'), 'w')). 
-0001def0: 2020 2020 2020 2069 6620 6469 736b 656e         if disken
-0001df00: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
-0001df10: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-0001df20: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
-0001df30: 706c 6f79 696e 6720 4469 736b 732e 2e2e  ploying Disks...
-0001df40: 2229 0a20 2020 2020 2020 2066 6f72 2064  ").        for d
-0001df50: 6973 6b20 696e 2064 6973 6b65 6e74 7269  isk in diskentri
-0001df60: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001df70: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
-0001df80: 735b 6469 736b 5d0a 2020 2020 2020 2020  s[disk].        
-0001df90: 2020 2020 706f 6f6c 203d 2070 726f 6669      pool = profi
-0001dfa0: 6c65 2e67 6574 2827 706f 6f6c 2729 0a20  le.get('pool'). 
-0001dfb0: 2020 2020 2020 2020 2020 2076 6d73 203d             vms =
-0001dfc0: 2070 726f 6669 6c65 2e67 6574 2827 766d   profile.get('vm
-0001dfd0: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-0001dfe0: 7465 6d70 6c61 7465 203d 2070 726f 6669  template = profi
-0001dff0: 6c65 2e67 6574 2827 7465 6d70 6c61 7465  le.get('template
-0001e000: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-0001e010: 6d61 6765 203d 2070 726f 6669 6c65 2e67  mage = profile.g
-0001e020: 6574 2827 696d 6167 6527 2c20 7465 6d70  et('image', temp
-0001e030: 6c61 7465 290a 2020 2020 2020 2020 2020  late).          
-0001e040: 2020 7369 7a65 203d 2069 6e74 2870 726f    size = int(pro
-0001e050: 6669 6c65 2e67 6574 2827 7369 7a65 272c  file.get('size',
-0001e060: 2031 3029 290a 2020 2020 2020 2020 2020   10)).          
-0001e070: 2020 6966 2070 6f6f 6c20 6973 204e 6f6e    if pool is Non
-0001e080: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001e090: 2020 2065 7272 6f72 2866 224d 6973 7369     error(f"Missi
-0001e0a0: 6e67 204b 6579 2050 6f6f 6c20 666f 7220  ng Key Pool for 
-0001e0b0: 6469 736b 2073 6563 7469 6f6e 207b 6469  disk section {di
-0001e0c0: 736b 7d2e 204e 6f74 2063 7265 6174 696e  sk}. Not creatin
-0001e0d0: 6720 6974 2e2e 2e22 290a 2020 2020 2020  g it...").      
-0001e0e0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001e0f0: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
-0001e100: 6620 766d 7320 6973 204e 6f6e 653a 0a20  f vms is None:. 
-0001e110: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e120: 7272 6f72 2866 224d 6973 7369 6e67 206f  rror(f"Missing o
-0001e130: 7220 496e 636f 7272 6563 7420 4b65 7920  r Incorrect Key 
-0001e140: 566d 7320 666f 7220 6469 736b 2073 6563  Vms for disk sec
-0001e150: 7469 6f6e 207b 6469 736b 7d2e 204e 6f74  tion {disk}. Not
-0001e160: 2063 7265 6174 696e 6720 6974 2e2e 2e22   creating it..."
-0001e170: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e180: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001e190: 2020 2020 2020 2073 6861 7265 6162 6c65         shareable
-0001e1a0: 203d 2054 7275 6520 6966 206c 656e 2876   = True if len(v
-0001e1b0: 6d73 2920 3e20 3120 656c 7365 2046 616c  ms) > 1 else Fal
-0001e1c0: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
-0001e1d0: 6620 6b2e 6469 736b 5f65 7869 7374 7328  f k.disk_exists(
-0001e1e0: 706f 6f6c 2c20 6469 736b 293a 0a20 2020  pool, disk):.   
-0001e1f0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001e200: 696e 7428 6622 4372 6561 7469 6f6e 2066  int(f"Creation f
-0001e210: 6f72 2044 6973 6b20 7b64 6973 6b7d 2073  or Disk {disk} s
-0001e220: 6b69 7070 6564 2122 290a 2020 2020 2020  kipped!").      
-0001e230: 2020 2020 2020 2020 2020 706f 6f6c 7061            poolpa
-0001e240: 7468 203d 206b 2e67 6574 5f70 6f6f 6c5f  th = k.get_pool_
-0001e250: 7061 7468 2870 6f6f 6c29 0a20 2020 2020  path(pool).     
-0001e260: 2020 2020 2020 2020 2020 206e 6577 6469             newdi
-0001e270: 736b 203d 2066 227b 706f 6f6c 7061 7468  sk = f"{poolpath
-0001e280: 7d2f 7b64 6973 6b7d 220a 2020 2020 2020  }/{disk}".      
-0001e290: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
-0001e2a0: 2069 6e20 766d 733a 0a20 2020 2020 2020   in vms:.       
-0001e2b0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001e2c0: 696e 7428 6622 4164 6469 6e67 2064 6973  int(f"Adding dis
-0001e2d0: 6b20 7b64 6973 6b7d 2074 6f20 7b76 6d7d  k {disk} to {vm}
-0001e2e0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001e2f0: 2020 2020 2020 206b 2e61 6464 5f64 6973         k.add_dis
-0001e300: 6b28 6e61 6d65 3d76 6d2c 2073 697a 653d  k(name=vm, size=
-0001e310: 7369 7a65 2c20 706f 6f6c 3d70 6f6f 6c2c  size, pool=pool,
-0001e320: 2069 6d61 6765 3d69 6d61 6765 2c20 7368   image=image, sh
-0001e330: 6172 6561 626c 653d 7368 6172 6561 626c  areable=shareabl
-0001e340: 652c 2065 7869 7374 696e 673d 6e65 7764  e, existing=newd
-0001e350: 6973 6b2c 0a20 2020 2020 2020 2020 2020  isk,.           
-0001e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e370: 2020 2020 7468 696e 3d46 616c 7365 290a      thin=False).
-0001e380: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001e390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001e3a0: 2020 6e65 7764 6973 6b20 3d20 6b2e 6372    newdisk = k.cr
-0001e3b0: 6561 7465 5f64 6973 6b28 6469 736b 2c20  eate_disk(disk, 
-0001e3c0: 7369 7a65 3d73 697a 652c 2070 6f6f 6c3d  size=size, pool=
-0001e3d0: 706f 6f6c 2c20 696d 6167 653d 696d 6167  pool, image=imag
-0001e3e0: 652c 2074 6869 6e3d 4661 6c73 6529 0a20  e, thin=False). 
-0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001e400: 6620 6e65 7764 6973 6b20 6973 204e 6f6e  f newdisk is Non
-0001e410: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001e420: 2020 2020 2020 2065 7272 6f72 2866 2244         error(f"D
-0001e430: 6973 6b20 7b64 6973 6b7d 206e 6f74 2064  isk {disk} not d
-0001e440: 6570 6c6f 7965 642e 2049 7420 776f 6e27  eployed. It won'
-0001e450: 7420 6265 2061 6464 6564 2074 6f20 616e  t be added to an
-0001e460: 7920 766d 2229 0a20 2020 2020 2020 2020  y vm").         
-0001e470: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e490: 2063 6f6d 6d6f 6e2e 7070 7269 6e74 2866   common.pprint(f
-0001e4a0: 2244 6973 6b20 7b64 6973 6b7d 2064 6570  "Disk {disk} dep
-0001e4b0: 6c6f 7965 6421 2229 0a20 2020 2020 2020  loyed!").       
-0001e4c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001e4d0: 2076 6d20 696e 2076 6d73 3a0a 2020 2020   vm in vms:.    
-0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4f0: 2020 2020 7070 7269 6e74 2866 2241 6464      pprint(f"Add
-0001e500: 696e 6720 6469 736b 207b 6469 736b 7d20  ing disk {disk} 
-0001e510: 746f 207b 766d 7d22 290a 2020 2020 2020  to {vm}").      
-0001e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e530: 2020 6b2e 6164 645f 6469 736b 286e 616d    k.add_disk(nam
-0001e540: 653d 766d 2c20 7369 7a65 3d73 697a 652c  e=vm, size=size,
-0001e550: 2070 6f6f 6c3d 706f 6f6c 2c20 696d 6167   pool=pool, imag
-0001e560: 653d 696d 6167 652c 2073 6861 7265 6162  e=image, shareab
-0001e570: 6c65 3d73 6861 7265 6162 6c65 2c0a 2020  le=shareable,.  
-0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5a0: 2065 7869 7374 696e 673d 6e65 7764 6973   existing=newdis
-0001e5b0: 6b2c 2074 6869 6e3d 4661 6c73 6529 0a20  k, thin=False). 
-0001e5c0: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-0001e5d0: 6e65 7265 6e74 7269 6573 2061 6e64 206e  nerentries and n
-0001e5e0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-0001e5f0: 2020 2020 2020 2020 2020 2063 6f6e 7420             cont 
-0001e600: 3d20 4b63 6f6e 7461 696e 6572 636f 6e66  = Kcontainerconf
-0001e610: 6967 2873 656c 662c 2063 6c69 656e 743d  ig(self, client=
-0001e620: 7365 6c66 2e63 6f6e 7461 696e 6572 636c  self.containercl
-0001e630: 6965 6e74 292e 636f 6e74 0a20 2020 2020  ient).cont.     
-0001e640: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
-0001e650: 6570 6c6f 7969 6e67 2043 6f6e 7461 696e  eploying Contain
-0001e660: 6572 732e 2e2e 2229 0a20 2020 2020 2020  ers...").       
-0001e670: 2020 2020 206c 6162 656c 203d 2066 2270       label = f"p
-0001e680: 6c61 6e3d 7b70 6c61 6e7d 220a 2020 2020  lan={plan}".    
-0001e690: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
-0001e6a0: 6169 6e65 7220 696e 2063 6f6e 7461 696e  ainer in contain
-0001e6b0: 6572 656e 7472 6965 733a 0a20 2020 2020  erentries:.     
-0001e6c0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0001e6d0: 6e74 2e65 7869 7374 735f 636f 6e74 6169  nt.exists_contai
-0001e6e0: 6e65 7228 636f 6e74 6169 6e65 7229 3a0a  ner(container):.
-0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e700: 2020 2020 7070 7269 6e74 2866 2243 6f6e      pprint(f"Con
-0001e710: 7461 696e 6572 207b 636f 6e74 6169 6e65  tainer {containe
-0001e720: 727d 2073 6b69 7070 6564 2122 290a 2020  r} skipped!").  
-0001e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e740: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001e750: 2020 2020 2020 2020 2020 2070 726f 6669             profi
-0001e760: 6c65 203d 2065 6e74 7269 6573 5b63 6f6e  le = entries[con
-0001e770: 7461 696e 6572 5d0a 2020 2020 2020 2020  tainer].        
-0001e780: 2020 2020 2020 2020 6966 2027 7072 6f66          if 'prof
-0001e790: 696c 6527 2069 6e20 7072 6f66 696c 6520  ile' in profile 
-0001e7a0: 616e 6420 7072 6f66 696c 655b 2770 726f  and profile['pro
-0001e7b0: 6669 6c65 275d 2069 6e20 636f 6e74 6169  file'] in contai
-0001e7c0: 6e65 7270 726f 6669 6c65 733a 0a20 2020  nerprofiles:.   
-0001e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7e0: 2063 7573 746f 6d70 726f 6669 6c65 203d   customprofile =
-0001e7f0: 2063 6f6e 7461 696e 6572 7072 6f66 696c   containerprofil
-0001e800: 6573 5b70 726f 6669 6c65 5b27 7072 6f66  es[profile['prof
-0001e810: 696c 6527 5d5d 0a20 2020 2020 2020 2020  ile']].         
-0001e820: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e840: 2063 7573 746f 6d70 726f 6669 6c65 203d   customprofile =
-0001e850: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-0001e860: 2020 2020 636f 6e74 6169 6e65 7269 6d61      containerima
-0001e870: 6765 203d 206e 6578 7428 2865 2066 6f72  ge = next((e for
-0001e880: 2065 2069 6e20 5b70 726f 6669 6c65 2e67   e in [profile.g
-0001e890: 6574 2827 696d 6167 6527 292c 2070 726f  et('image'), pro
-0001e8a0: 6669 6c65 2e67 6574 2827 696d 6167 6527  file.get('image'
-0001e8b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8e0: 2020 2020 2020 6375 7374 6f6d 7072 6f66        customprof
-0001e8f0: 696c 652e 6765 7428 2769 6d61 6765 2729  ile.get('image')
-0001e900: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e930: 2020 2020 2063 7573 746f 6d70 726f 6669       customprofi
-0001e940: 6c65 2e67 6574 2827 696d 6167 6527 295d  le.get('image')]
-0001e950: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
-0001e960: 6529 2c20 4e6f 6e65 290a 2020 2020 2020  e), None).      
-0001e970: 2020 2020 2020 2020 2020 6e65 7473 203d            nets =
-0001e980: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
-0001e990: 6e20 5b70 726f 6669 6c65 2e67 6574 2827  n [profile.get('
-0001e9a0: 6e65 7473 2729 2c20 6375 7374 6f6d 7072  nets'), custompr
-0001e9b0: 6f66 696c 652e 6765 7428 276e 6574 7327  ofile.get('nets'
-0001e9c0: 295d 2069 6620 6520 6973 206e 6f74 204e  )] if e is not N
-0001e9d0: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
-0001e9e0: 2020 2020 2020 2020 2020 2020 706f 7274              port
-0001e9f0: 7320 3d20 6e65 7874 2828 6520 666f 7220  s = next((e for 
-0001ea00: 6520 696e 205b 7072 6f66 696c 652e 6765  e in [profile.ge
-0001ea10: 7428 2770 6f72 7473 2729 2c20 6375 7374  t('ports'), cust
-0001ea20: 6f6d 7072 6f66 696c 652e 6765 7428 2770  omprofile.get('p
-0001ea30: 6f72 7473 2729 5d20 6966 2065 2069 7320  orts')] if e is 
-0001ea40: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
-0001ea50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ea60: 2076 6f6c 756d 6573 203d 206e 6578 7428   volumes = next(
-0001ea70: 2865 2066 6f72 2065 2069 6e20 5b70 726f  (e for e in [pro
-0001ea80: 6669 6c65 2e67 6574 2827 766f 6c75 6d65  file.get('volume
-0001ea90: 7327 292c 2070 726f 6669 6c65 2e67 6574  s'), profile.get
-0001eaa0: 2827 6469 736b 7327 292c 0a20 2020 2020  ('disks'),.     
-0001eab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ead0: 2020 2020 2020 2063 7573 746f 6d70 726f         custompro
-0001eae0: 6669 6c65 2e67 6574 2827 766f 6c75 6d65  file.get('volume
-0001eaf0: 7327 292c 2063 7573 746f 6d70 726f 6669  s'), customprofi
-0001eb00: 6c65 2e67 6574 2827 6469 736b 7327 295d  le.get('disks')]
-0001eb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb30: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
-0001eb40: 6529 2c20 4e6f 6e65 290a 2020 2020 2020  e), None).      
-0001eb50: 2020 2020 2020 2020 2020 656e 7669 726f            enviro
-0001eb60: 6e6d 656e 7420 3d20 6e65 7874 2828 6520  nment = next((e 
-0001eb70: 666f 7220 6520 696e 205b 7072 6f66 696c  for e in [profil
-0001eb80: 652e 6765 7428 2765 6e76 6972 6f6e 6d65  e.get('environme
-0001eb90: 6e74 2729 2c20 6375 7374 6f6d 7072 6f66  nt'), customprof
-0001eba0: 696c 652e 6765 7428 2765 6e76 6972 6f6e  ile.get('environ
-0001ebb0: 6d65 6e74 2729 5d0a 2020 2020 2020 2020  ment')].        
-0001ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ebd0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0001ebe0: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-0001ebf0: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-0001ec00: 2020 2020 2063 6d64 7320 3d20 6e65 7874       cmds = next
-0001ec10: 2828 6520 666f 7220 6520 696e 205b 7072  ((e for e in [pr
-0001ec20: 6f66 696c 652e 6765 7428 2763 6d64 7327  ofile.get('cmds'
-0001ec30: 292c 2063 7573 746f 6d70 726f 6669 6c65  ), customprofile
-0001ec40: 2e67 6574 2827 636d 6473 2729 5d20 6966  .get('cmds')] if
-0001ec50: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
-0001ec60: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
-0001ec70: 2020 2020 2073 7563 6365 7373 2866 2243       success(f"C
-0001ec80: 6f6e 7461 696e 6572 207b 636f 6e74 6169  ontainer {contai
-0001ec90: 6e65 727d c2a0 6465 706c 6f79 6564 2122  ner}..deployed!"
-0001eca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ecb0: 2020 636f 6e74 2e63 7265 6174 655f 636f    cont.create_co
-0001ecc0: 6e74 6169 6e65 7228 6e61 6d65 3d63 6f6e  ntainer(name=con
-0001ecd0: 7461 696e 6572 2c20 696d 6167 653d 636f  tainer, image=co
-0001ece0: 6e74 6169 6e65 7269 6d61 6765 2c20 6e65  ntainerimage, ne
-0001ecf0: 7473 3d6e 6574 732c 2063 6d64 733d 636d  ts=nets, cmds=cm
-0001ed00: 6473 2c20 706f 7274 733d 706f 7274 732c  ds, ports=ports,
-0001ed10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed30: 2020 2020 2020 2076 6f6c 756d 6573 3d76         volumes=v
-0001ed40: 6f6c 756d 6573 2c20 656e 7669 726f 6e6d  olumes, environm
-0001ed50: 656e 743d 656e 7669 726f 6e6d 656e 742c  ent=environment,
-0001ed60: 206c 6162 656c 3d6c 6162 656c 290a 2020   label=label).  
-0001ed70: 2020 2020 2020 6966 2064 6e73 656e 7472        if dnsentr
-0001ed80: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
-0001ed90: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
-0001eda0: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
-0001edb0: 6f79 696e 6720 446e 7320 456e 7472 6965  oying Dns Entrie
-0001edc0: 732e 2e2e 2229 0a20 2020 2020 2020 2020  s...").         
-0001edd0: 2020 2064 6e73 636c 6965 6e74 7320 3d20     dnsclients = 
-0001ede0: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-0001edf0: 6f72 2064 6e73 656e 7472 7920 696e 2064  or dnsentry in d
-0001ee00: 6e73 656e 7472 6965 733a 0a20 2020 2020  nsentries:.     
-0001ee10: 2020 2020 2020 2020 2020 2064 6e73 7072             dnspr
-0001ee20: 6f66 696c 6520 3d20 656e 7472 6965 735b  ofile = entries[
-0001ee30: 646e 7365 6e74 7279 5d0a 2020 2020 2020  dnsentry].      
-0001ee40: 2020 2020 2020 2020 2020 646e 7364 6f6d            dnsdom
-0001ee50: 6169 6e20 3d20 646e 7370 726f 6669 6c65  ain = dnsprofile
-0001ee60: 2e67 6574 2827 646f 6d61 696e 2729 0a20  .get('domain'). 
-0001ee70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001ee80: 6e73 6e65 7420 3d20 646e 7370 726f 6669  nsnet = dnsprofi
-0001ee90: 6c65 2e67 6574 2827 6e65 7427 2c20 2764  le.get('net', 'd
-0001eea0: 6566 6175 6c74 2729 0a20 2020 2020 2020  efault').       
-0001eeb0: 2020 2020 2020 2020 2064 6e73 6970 203d           dnsip =
-0001eec0: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
-0001eed0: 2769 7027 290a 2020 2020 2020 2020 2020  'ip').          
-0001eee0: 2020 2020 2020 646e 7361 6c69 6173 203d        dnsalias =
-0001eef0: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
-0001ef00: 2761 6c69 6173 272c 205b 5d29 0a20 2020  'alias', []).   
-0001ef10: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-0001ef20: 636c 6965 6e74 203d 2064 6e73 7072 6f66  client = dnsprof
-0001ef30: 696c 652e 6765 7428 2763 6c69 656e 7427  ile.get('client'
-0001ef40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ef50: 2020 6966 2064 6e73 636c 6965 6e74 2069    if dnsclient i
-0001ef60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0001ef70: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-0001ef80: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0001ef90: 2020 656c 6966 2064 6e73 636c 6965 6e74    elif dnsclient
-0001efa0: 2069 6e20 646e 7363 6c69 656e 7473 3a0a   in dnsclients:.
-0001efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efc0: 2020 2020 7a20 3d20 646e 7363 6c69 656e      z = dnsclien
-0001efd0: 7473 5b64 6e73 636c 6965 6e74 5d0a 2020  ts[dnsclient].  
-0001efe0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001eff0: 6966 2064 6e73 636c 6965 6e74 2069 6e20  if dnsclient in 
-0001f000: 7365 6c66 2e63 6c69 656e 7473 3a0a 2020  self.clients:.  
-0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f020: 2020 7a20 3d20 4b63 6f6e 6669 6728 636c    z = Kconfig(cl
-0001f030: 6965 6e74 3d64 6e73 636c 6965 6e74 292e  ient=dnsclient).
-0001f040: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0001f050: 2020 2020 2020 646e 7363 6c69 656e 7473        dnsclients
-0001f060: 5b64 6e73 636c 6965 6e74 5d20 3d20 7a0a  [dnsclient] = z.
-0001f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f080: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001f090: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0001f0a0: 6728 6622 436c 6965 6e74 207b 646e 7363  g(f"Client {dnsc
-0001f0b0: 6c69 656e 747d 206e 6f74 2066 6f75 6e64  lient} not found
-0001f0c0: 2e20 536b 6970 7069 6e67 2229 0a20 2020  . Skipping").   
-0001f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0e0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-0001f0f0: 2020 2020 2020 2020 6966 2064 6e73 6970          if dnsip
-0001f100: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001f110: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001f120: 726e 696e 6728 224d 6973 7369 6e67 2069  rning("Missing i
-0001f130: 702e 2053 6b69 7070 696e 6721 2229 0a20  p. Skipping!"). 
-0001f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f150: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-0001f160: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
-0001f170: 6e65 7420 6973 204e 6f6e 653a 0a20 2020  net is None:.   
-0001f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f190: 2077 6172 6e69 6e67 2822 4d69 7373 696e   warning("Missin
-0001f1a0: 6720 6e65 742e 2053 6b69 7070 696e 6721  g net. Skipping!
-0001f1b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001f1c0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001f1d0: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
-0001f1e0: 7265 7365 7276 655f 646e 7328 6e61 6d65  reserve_dns(name
-0001f1f0: 3d64 6e73 656e 7472 792c 206e 6574 733d  =dnsentry, nets=
-0001f200: 5b64 6e73 6e65 745d 2c20 646f 6d61 696e  [dnsnet], domain
-0001f210: 3d64 6e73 646f 6d61 696e 2c20 6970 3d64  =dnsdomain, ip=d
-0001f220: 6e73 6970 2c20 616c 6961 733d 646e 7361  nsip, alias=dnsa
-0001f230: 6c69 6173 2c20 666f 7263 653d 5472 7565  lias, force=True
-0001f240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f260: 7072 696d 6172 793d 5472 7565 290a 2020  primary=True).  
-0001f270: 2020 2020 2020 6966 2061 6e73 6962 6c65        if ansible
-0001f280: 656e 7472 6965 7320 616e 6420 6e6f 7420  entries and not 
-0001f290: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-0001f2a0: 2020 2020 2020 2020 6966 206e 6f74 206e          if not n
-0001f2b0: 6577 766d 733a 0a20 2020 2020 2020 2020  ewvms:.         
-0001f2c0: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-0001f2d0: 416e 7369 626c 6520 736b 6970 7065 6420  Ansible skipped 
-0001f2e0: 6173 206e 6f20 6e65 7720 766d 2077 6974  as no new vm wit
-0001f2f0: 6869 6e20 706c 6179 626f 6f6b 2070 726f  hin playbook pro
-0001f300: 7669 7369 6f6e 6564 2229 0a20 2020 2020  visioned").     
-0001f310: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001f320: 6e0a 2020 2020 2020 2020 2020 2020 666f  n.            fo
-0001f330: 7220 656e 7472 7920 696e 2073 6f72 7465  r entry in sorte
-0001f340: 6428 616e 7369 626c 6565 6e74 7269 6573  d(ansibleentries
-0001f350: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001f360: 2020 205f 616e 7369 626c 6520 3d20 656e     _ansible = en
-0001f370: 7472 6965 735b 656e 7472 795d 0a20 2020  tries[entry].   
-0001f380: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001f390: 2770 6c61 7962 6f6f 6b27 206e 6f74 2069  'playbook' not i
-0001f3a0: 6e20 5f61 6e73 6962 6c65 3a0a 2020 2020  n _ansible:.    
-0001f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3c0: 6572 726f 7228 224d 6973 7369 6e67 2050  error("Missing P
-0001f3d0: 6c61 7962 6f6f 6b20 666f 7220 616e 7369  laybook for ansi
-0001f3e0: 626c 652e 4967 6e6f 7269 6e67 2e2e 2e22  ble.Ignoring..."
-0001f3f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f400: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-0001f410: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f420: 2020 706c 6179 626f 6f6b 203d 205f 616e    playbook = _an
-0001f430: 7369 626c 655b 2770 6c61 7962 6f6f 6b27  sible['playbook'
-0001f440: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001f450: 2020 7665 7262 6f73 6520 3d20 5f61 6e73    verbose = _ans
-0001f460: 6962 6c65 5b27 7665 7262 6f73 6527 5d20  ible['verbose'] 
-0001f470: 6966 2027 7665 7262 6f73 6527 2069 6e20  if 'verbose' in 
-0001f480: 5f61 6e73 6962 6c65 2065 6c73 6520 4661  _ansible else Fa
-0001f490: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0001f4a0: 2020 2020 6772 6f75 7073 203d 205f 616e      groups = _an
-0001f4b0: 7369 626c 652e 6765 7428 2767 726f 7570  sible.get('group
-0001f4c0: 7327 2c20 7b7d 290a 2020 2020 2020 2020  s', {}).        
-0001f4d0: 2020 2020 2020 2020 7573 6572 203d 205f          user = _
-0001f4e0: 616e 7369 626c 652e 6765 7428 2775 7365  ansible.get('use
-0001f4f0: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-0001f500: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
-0001f510: 5f61 6e73 6962 6c65 2e67 6574 2827 7661  _ansible.get('va
-0001f520: 7269 6162 6c65 7327 2c20 7b7d 290a 2020  riables', {}).  
-0001f530: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-0001f540: 7267 6574 766d 7320 3d20 5b76 6d20 666f  rgetvms = [vm fo
-0001f550: 7220 766d 2069 6e20 5f61 6e73 6962 6c65  r vm in _ansible
-0001f560: 5b27 766d 7327 5d20 6966 2076 6d20 696e  ['vms'] if vm in
-0001f570: 206e 6577 766d 735d 2069 6620 2776 6d73   newvms] if 'vms
-0001f580: 2720 696e 205f 616e 7369 626c 6520 656c  ' in _ansible el
-0001f590: 7365 206e 6577 766d 730a 2020 2020 2020  se newvms.      
-0001f5a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001f5b0: 2074 6172 6765 7476 6d73 3a0a 2020 2020   targetvms:.    
-0001f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5d0: 7761 726e 696e 6728 2241 6e73 6962 6c65  warning("Ansible
-0001f5e0: 2073 6b69 7070 6564 2061 7320 6e6f 206e   skipped as no n
-0001f5f0: 6577 2076 6d20 7769 7468 696e 2070 6c61  ew vm within pla
-0001f600: 7962 6f6f 6b20 7072 6f76 6973 696f 6e65  ybook provisione
-0001f610: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
-0001f620: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0001f630: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001f640: 6e73 6962 6c65 636f 6d6d 616e 6420 3d20  nsiblecommand = 
-0001f650: 2261 6e73 6962 6c65 2d70 6c61 7962 6f6f  "ansible-playboo
-0001f660: 6b22 0a20 2020 2020 2020 2020 2020 2020  k".             
-0001f670: 2020 2069 6620 7665 7262 6f73 653a 0a20     if verbose:. 
-0001f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f690: 2020 2061 6e73 6962 6c65 636f 6d6d 616e     ansiblecomman
-0001f6a0: 6420 2b3d 2022 202d 7676 7622 0a20 2020  d += " -vvv".   
-0001f6b0: 2020 2020 2020 2020 2020 2020 2069 6e76               inv
-0001f6c0: 656e 746f 7279 6669 6c65 203d 2066 222f  entoryfile = f"/
-0001f6d0: 746d 702f 7b70 6c61 6e7d 2e69 6e76 2e79  tmp/{plan}.inv.y
-0001f6e0: 616d 6c22 2069 6620 7365 6c66 2e79 616d  aml" if self.yam
-0001f6f0: 6c69 6e76 656e 746f 7279 2065 6c73 6520  linventory else 
-0001f700: 6622 2f74 6d70 2f7b 706c 616e 7d2e 696e  f"/tmp/{plan}.in
-0001f710: 7622 0a20 2020 2020 2020 2020 2020 2020  v".             
-0001f720: 2020 2061 6e73 6962 6c65 7574 696c 732e     ansibleutils.
-0001f730: 6d61 6b65 5f70 6c61 6e5f 696e 7665 6e74  make_plan_invent
-0001f740: 6f72 7928 766d 735f 746f 5f68 6f73 742c  ory(vms_to_host,
-0001f750: 2070 6c61 6e2c 2074 6172 6765 7476 6d73   plan, targetvms
-0001f760: 2c20 6772 6f75 7073 3d67 726f 7570 732c  , groups=groups,
-0001f770: 2075 7365 723d 7573 6572 2c0a 2020 2020   user=user,.    
-0001f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7a0: 2020 2020 2020 2020 2020 2020 2079 616d               yam
-0001f7b0: 6c69 6e76 656e 746f 7279 3d73 656c 662e  linventory=self.
-0001f7c0: 7961 6d6c 696e 7665 6e74 6f72 792c 2074  yamlinventory, t
-0001f7d0: 756e 6e65 6c3d 7365 6c66 2e74 756e 6e65  unnel=self.tunne
-0001f7e0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-0001f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f810: 2020 2020 7475 6e6e 656c 686f 7374 3d73      tunnelhost=s
-0001f820: 656c 662e 7475 6e6e 656c 686f 7374 2c20  elf.tunnelhost, 
-0001f830: 7475 6e6e 656c 7573 6572 3d73 656c 662e  tunneluser=self.
-0001f840: 7475 6e6e 656c 7573 6572 2c0a 2020 2020  tunneluser,.    
-0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f870: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-0001f880: 6e65 6c70 6f72 743d 7365 6c66 2e74 756e  nelport=self.tun
-0001f890: 6e65 6c70 6f72 742c 2069 6e73 6563 7572  nelport, insecur
-0001f8a0: 653d 7365 6c66 2e69 6e73 6563 7572 6529  e=self.insecure)
-0001f8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f8c0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-0001f8d0: 6578 6973 7473 2827 7e2f 2e61 6e73 6962  exists('~/.ansib
-0001f8e0: 6c65 2e63 6667 2729 3a0a 2020 2020 2020  le.cfg'):.      
-0001f8f0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001f900: 7369 626c 6563 6f6e 6669 6720 3d20 6f73  sibleconfig = os
-0001f910: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
-0001f920: 2827 7e2f 2e61 6e73 6962 6c65 2e63 6667  ('~/.ansible.cfg
-0001f930: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0001f940: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0001f950: 2861 6e73 6962 6c65 636f 6e66 6967 2c20  (ansibleconfig, 
-0001f960: 2277 2229 2061 7320 663a 0a20 2020 2020  "w") as f:.     
-0001f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f980: 2020 2066 2e77 7269 7465 2822 5b73 7368     f.write("[ssh
-0001f990: 5f63 6f6e 6e65 6374 696f 6e5d 5c6e 7265  _connection]\nre
-0001f9a0: 7472 6965 733d 3130 5c6e 2229 0a20 2020  tries=10\n").   
-0001f9b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001f9c0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0001f9d0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001f9e0: 6172 7366 696c 6520 3d20 6622 2f74 6d70  arsfile = f"/tmp
-0001f9f0: 2f7b 706c 616e 7d2e 7661 7273 2e79 6d6c  /{plan}.vars.yml
-0001fa00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001fa10: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-0001fa20: 7661 7273 6669 6c65 2c20 2777 2729 2061  varsfile, 'w') a
-0001fa30: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
-0001fa40: 2020 2020 2020 2020 2020 2020 2079 616d               yam
-0001fa50: 6c2e 6475 6d70 2876 6172 6961 626c 6573  l.dump(variables
-0001fa60: 2c20 662c 2064 6566 6175 6c74 5f66 6c6f  , f, default_flo
-0001fa70: 775f 7374 796c 653d 4661 6c73 6529 0a20  w_style=False). 
-0001fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa90: 2020 2061 6e73 6962 6c65 636f 6d6d 616e     ansiblecomman
-0001faa0: 6420 2b3d 2066 2220 2d2d 6578 7472 612d  d += f" --extra-
-0001fab0: 7661 7273 2040 7b76 6172 7366 696c 657d  vars @{varsfile}
-0001fac0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001fad0: 2020 616e 7369 626c 6563 6f6d 6d61 6e64    ansiblecommand
-0001fae0: 202b 3d20 6622 202d 6920 7b69 6e76 656e   += f" -i {inven
-0001faf0: 746f 7279 6669 6c65 7d20 7b70 6c61 7962  toryfile} {playb
-0001fb00: 6f6f 6b7d 220a 2020 2020 2020 2020 2020  ook}".          
-0001fb10: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
-0001fb20: 756e 6e69 6e67 3a20 7b61 6e73 6962 6c65  unning: {ansible
-0001fb30: 636f 6d6d 616e 647d 2229 0a20 2020 2020  command}").     
-0001fb40: 2020 2020 2020 2020 2020 206f 732e 7379             os.sy
-0001fb50: 7374 656d 2861 6e73 6962 6c65 636f 6d6d  stem(ansiblecomm
-0001fb60: 616e 6429 0a20 2020 2020 2020 2069 6620  and).        if 
-0001fb70: 616e 7369 626c 6520 616e 6420 6e6f 7420  ansible and not 
-0001fb80: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-0001fb90: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-0001fba0: 4465 706c 6f79 696e 6720 416e 7369 626c  Deploying Ansibl
-0001fbb0: 6520 496e 7665 6e74 6f72 792e 2e2e 2229  e Inventory...")
-0001fbc0: 0a20 2020 2020 2020 2020 2020 2069 6e76  .            inv
-0001fbd0: 656e 746f 7279 6669 6c65 203d 2066 222f  entoryfile = f"/
-0001fbe0: 746d 702f 7b70 6c61 6e7d 2e69 6e76 2e79  tmp/{plan}.inv.y
-0001fbf0: 616d 6c22 2069 6620 7365 6c66 2e79 616d  aml" if self.yam
-0001fc00: 6c69 6e76 656e 746f 7279 2065 6c73 6520  linventory else 
-0001fc10: 6622 2f74 6d70 2f7b 706c 616e 7d2e 696e  f"/tmp/{plan}.in
-0001fc20: 7622 0a20 2020 2020 2020 2020 2020 2069  v".            i
-0001fc30: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-0001fc40: 2869 6e76 656e 746f 7279 6669 6c65 293a  (inventoryfile):
-0001fc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fc60: 2070 7072 696e 7428 6622 496e 7665 6e74   pprint(f"Invent
-0001fc70: 6f72 7920 696e 207b 696e 7665 6e74 6f72  ory in {inventor
-0001fc80: 7966 696c 657d 2073 6b69 7070 6564 2122  yfile} skipped!"
-0001fc90: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0001fca0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001fcb0: 2020 2020 7070 7269 6e74 2866 2243 7265      pprint(f"Cre
-0001fcc0: 6174 696e 6720 616e 7369 626c 6520 696e  ating ansible in
-0001fcd0: 7665 6e74 6f72 7920 666f 7220 706c 616e  ventory for plan
-0001fce0: 207b 706c 616e 7d20 696e 207b 696e 7665   {plan} in {inve
-0001fcf0: 6e74 6f72 7966 696c 657d 2229 0a20 2020  ntoryfile}").   
-0001fd00: 2020 2020 2020 2020 2020 2020 2076 6d73               vms
-0001fd10: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0001fd20: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
-0001fd30: 736f 7274 6564 286b 2e6c 6973 7428 292c  sorted(k.list(),
-0001fd40: 206b 6579 3d6c 616d 6264 6120 783a 2078   key=lambda x: x
-0001fd50: 5b27 6e61 6d65 275d 293a 0a20 2020 2020  ['name']):.     
-0001fd60: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001fd70: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
-0001fd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fd90: 2020 2020 2064 6573 6372 6970 7469 6f6e       description
-0001fda0: 203d 2076 6d5b 2770 6c61 6e27 5d0a 2020   = vm['plan'].  
-0001fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdc0: 2020 6966 2064 6573 6372 6970 7469 6f6e    if description
-0001fdd0: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
-0001fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdf0: 2020 766d 732e 6170 7065 6e64 286e 616d    vms.append(nam
-0001fe00: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001fe10: 2020 2061 6e73 6962 6c65 7574 696c 732e     ansibleutils.
-0001fe20: 6d61 6b65 5f70 6c61 6e5f 696e 7665 6e74  make_plan_invent
-0001fe30: 6f72 7928 766d 735f 746f 5f68 6f73 742c  ory(vms_to_host,
-0001fe40: 2070 6c61 6e2c 2076 6d73 2c20 7961 6d6c   plan, vms, yaml
-0001fe50: 696e 7665 6e74 6f72 793d 7365 6c66 2e79  inventory=self.y
-0001fe60: 616d 6c69 6e76 656e 746f 7279 2c0a 2020  amlinventory,.  
-0001fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001fea0: 6e73 6563 7572 653d 7365 6c66 2e69 6e73  nsecure=self.ins
-0001feb0: 6563 7572 6529 0a20 2020 2020 2020 2020  ecure).         
-0001fec0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0001fed0: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0001fee0: 7327 2c20 2770 6c61 6e27 3a20 706c 616e  s', 'plan': plan
-0001fef0: 7d0a 2020 2020 2020 2020 6966 206c 6273  }.        if lbs
-0001ff00: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
-0001ff10: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-0001ff20: 2064 6e73 636c 6965 6e74 7320 3d20 7b7d   dnsclients = {}
-0001ff30: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-0001ff40: 696e 7428 2244 6570 6c6f 7969 6e67 204c  int("Deploying L
-0001ff50: 6f61 6462 616c 616e 6365 7273 2e2e 2e22  oadbalancers..."
-0001ff60: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0001ff70: 7220 696e 6465 782c 206c 6265 6e74 7279  r index, lbentry
-0001ff80: 2069 6e20 656e 756d 6572 6174 6528 6c62   in enumerate(lb
-0001ff90: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0001ffa0: 2020 2020 6465 7461 696c 7320 3d20 656e      details = en
-0001ffb0: 7472 6965 735b 6c62 656e 7472 795d 0a20  tries[lbentry]. 
-0001ffc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001ffd0: 6f72 7473 203d 2064 6574 6169 6c73 2e67  orts = details.g
-0001ffe0: 6574 2827 706f 7274 7327 2c20 5b5d 290a  et('ports', []).
-0001fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020000: 6966 206e 6f74 2070 6f72 7473 3a0a 2020  if not ports:.  
-00020010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020020: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
-00020030: 2050 6f72 7473 2066 6f72 206c 6f61 6462   Ports for loadb
-00020040: 616c 616e 6365 722e 204e 6f74 2063 7265  alancer. Not cre
-00020050: 6174 696e 6720 6974 2e2e 2e22 290a 2020  ating it...").  
-00020060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020070: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00020080: 2020 2020 2020 2020 2063 6865 636b 7061           checkpa
-00020090: 7468 203d 2064 6574 6169 6c73 2e67 6574  th = details.get
-000200a0: 2827 6368 6563 6b70 6174 6827 2c20 272f  ('checkpath', '/
-000200b0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000200c0: 2020 2063 6865 636b 706f 7274 203d 2064     checkport = d
-000200d0: 6574 6169 6c73 2e67 6574 2827 6368 6563  etails.get('chec
-000200e0: 6b70 6f72 7427 2c20 3830 290a 2020 2020  kport', 80).    
-000200f0: 2020 2020 2020 2020 2020 2020 616c 6961              alia
-00020100: 7320 3d20 6465 7461 696c 732e 6765 7428  s = details.get(
-00020110: 2761 6c69 6173 272c 205b 5d29 0a20 2020  'alias', []).   
-00020120: 2020 2020 2020 2020 2020 2020 2064 6f6d               dom
-00020130: 6169 6e20 3d20 6465 7461 696c 732e 6765  ain = details.ge
-00020140: 7428 2764 6f6d 6169 6e27 290a 2020 2020  t('domain').    
-00020150: 2020 2020 2020 2020 2020 2020 646e 7363              dnsc
-00020160: 6c69 656e 7420 3d20 6465 7461 696c 732e  lient = details.
-00020170: 6765 7428 2764 6e73 636c 6965 6e74 272c  get('dnsclient',
-00020180: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00020190: 646e 7363 6c69 656e 7427 2929 0a20 2020  dnsclient')).   
-000201a0: 2020 2020 2020 2020 2020 2020 206c 6276               lbv
-000201b0: 6d73 203d 2064 6574 6169 6c73 2e67 6574  ms = details.get
-000201c0: 2827 766d 7327 2c20 5b5d 290a 2020 2020  ('vms', []).    
-000201d0: 2020 2020 2020 2020 2020 2020 6c62 6e65              lbne
-000201e0: 7473 203d 2064 6574 6169 6c73 2e67 6574  ts = details.get
-000201f0: 2827 6e65 7473 272c 205b 2764 6566 6175  ('nets', ['defau
-00020200: 6c74 275d 290a 2020 2020 2020 2020 2020  lt']).          
-00020210: 2020 2020 2020 696e 7465 726e 616c 203d        internal =
-00020220: 2064 6574 6169 6c73 2e67 6574 2827 696e   details.get('in
-00020230: 7465 726e 616c 2729 0a20 2020 2020 2020  ternal').       
-00020240: 2020 2020 2020 2020 2073 7562 6e65 7469           subneti
-00020250: 6420 3d20 6465 7461 696c 732e 6765 7428  d = details.get(
-00020260: 2773 7562 6e65 7469 6427 290a 2020 2020  'subnetid').    
-00020270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00020280: 2e63 7265 6174 655f 6c6f 6164 6261 6c61  .create_loadbala
-00020290: 6e63 6572 286c 6265 6e74 7279 2c20 6e65  ncer(lbentry, ne
-000202a0: 7473 3d6c 626e 6574 732c 2070 6f72 7473  ts=lbnets, ports
-000202b0: 3d70 6f72 7473 2c20 6368 6563 6b70 6174  =ports, checkpat
-000202c0: 683d 6368 6563 6b70 6174 682c 2076 6d73  h=checkpath, vms
-000202d0: 3d6c 6276 6d73 2c0a 2020 2020 2020 2020  =lbvms,.        
-000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020300: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
-00020310: 706c 616e 3d70 6c61 6e2c 2063 6865 636b  plan=plan, check
-00020320: 706f 7274 3d63 6865 636b 706f 7274 2c20  port=checkport, 
-00020330: 616c 6961 733d 616c 6961 732c 0a20 2020  alias=alias,.   
-00020340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020360: 2020 2020 2020 696e 7465 726e 616c 3d69        internal=i
-00020370: 6e74 6572 6e61 6c2c 2064 6e73 636c 6965  nternal, dnsclie
-00020380: 6e74 3d64 6e73 636c 6965 6e74 2c20 7375  nt=dnsclient, su
-00020390: 626e 6574 6964 3d73 7562 6e65 7469 6429  bnetid=subnetid)
-000203a0: 0a20 2020 2020 2020 2069 6620 7367 7320  .        if sgs 
-000203b0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
-000203c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000203d0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-000203e0: 6720 5365 6375 7269 7479 4772 6f75 7073  g SecurityGroups
-000203f0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00020400: 2020 666f 7220 7367 2069 6e20 7367 733a    for sg in sgs:
-00020410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020420: 2064 6574 6169 6c73 203d 2065 6e74 7269   details = entri
-00020430: 6573 5b73 675d 0a20 2020 2020 2020 2020  es[sg].         
-00020440: 2020 2020 2020 206e 616d 650a 2020 2020         name.    
-00020450: 2020 2020 2020 2020 2020 2020 706f 7274              port
-00020460: 7320 3d20 6465 7461 696c 732e 6765 7428  s = details.get(
-00020470: 2770 6f72 7473 272c 205b 5d29 0a20 2020  'ports', []).   
-00020480: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00020490: 6e6f 7420 706f 7274 733a 0a20 2020 2020  not ports:.     
-000204a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000204b0: 7272 6f72 2822 4d69 7373 696e 6720 506f  rror("Missing Po
-000204c0: 7274 7320 666f 7220 7367 732e 204e 6f74  rts for sgs. Not
-000204d0: 2063 7265 6174 696e 6720 6974 2e2e 2e22   creating it..."
-000204e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000204f0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00020500: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00020510: 662e 6372 6561 7465 5f73 6563 7572 6974  f.create_securit
-00020520: 795f 6772 6f75 7028 7367 2c20 7b27 706f  y_group(sg, {'po
-00020530: 7274 7327 3a20 706f 7274 737d 290a 2020  rts': ports}).  
-00020540: 2020 2020 2020 6966 2077 6f72 6b66 6c6f        if workflo
-00020550: 7765 6e74 7269 6573 2061 6e64 206e 6f74  wentries and not
-00020560: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
-00020570: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00020580: 2244 6570 6c6f 7969 6e67 2057 6f72 6b66  "Deploying Workf
-00020590: 6c6f 7720 456e 7472 6965 732e 2e2e 2229  low Entries...")
-000205a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000205b0: 2077 6f72 6b66 6c6f 7720 696e 2077 6f72   workflow in wor
-000205c0: 6b66 6c6f 7765 6e74 7269 6573 3a0a 2020  kflowentries:.  
-000205d0: 2020 2020 2020 2020 2020 2020 2020 776f                wo
-000205e0: 726b 666c 6f77 5f6f 7665 7272 6964 6573  rkflow_overrides
-000205f0: 203d 206f 7665 7272 6964 6573 2e63 6f70   = overrides.cop
-00020600: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-00020610: 2020 2020 776f 726b 666c 6f77 5f6f 7665      workflow_ove
-00020620: 7272 6964 6573 2e75 7064 6174 6528 656e  rrides.update(en
-00020630: 7472 6965 735b 776f 726b 666c 6f77 5d29  tries[workflow])
-00020640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020650: 2073 656c 662e 6372 6561 7465 5f77 6f72   self.create_wor
-00020660: 6b66 6c6f 7728 776f 726b 666c 6f77 2c20  kflow(workflow, 
-00020670: 6f76 6572 7269 6465 733d 776f 726b 666c  overrides=workfl
-00020680: 6f77 5f6f 7665 7272 6964 6573 290a 2020  ow_overrides).  
-00020690: 2020 2020 2020 7265 7475 726e 6461 7461        returndata
-000206a0: 203d 207b 2772 6573 756c 7427 3a20 2773   = {'result': 's
-000206b0: 7563 6365 7373 272c 2027 706c 616e 273a  uccess', 'plan':
-000206c0: 2070 6c61 6e7d 0a20 2020 2020 2020 2072   plan}.        r
-000206d0: 6574 7572 6e64 6174 615b 276e 6577 766d  eturndata['newvm
-000206e0: 7327 5d20 3d20 6e65 7776 6d73 2069 6620  s'] = newvms if 
-000206f0: 6e65 7776 6d73 2065 6c73 6520 5b5d 0a20  newvms else []. 
-00020700: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
-00020710: 615b 2765 7869 7374 696e 6776 6d73 275d  a['existingvms']
-00020720: 203d 2065 7869 7374 696e 6776 6d73 2069   = existingvms i
-00020730: 6620 6578 6973 7469 6e67 766d 7320 656c  f existingvms el
-00020740: 7365 205b 5d0a 2020 2020 2020 2020 7265  se [].        re
-00020750: 7475 726e 6461 7461 5b27 6661 696c 6564  turndata['failed
-00020760: 766d 7327 5d20 3d20 6661 696c 6564 766d  vms'] = failedvm
-00020770: 7320 6966 2066 6169 6c65 6476 6d73 2065  s if failedvms e
-00020780: 6c73 6520 5b5d 0a20 2020 2020 2020 2072  lse [].        r
-00020790: 6574 7572 6e64 6174 615b 2761 7373 6574  eturndata['asset
-000207a0: 7327 5d20 3d20 6e65 7761 7373 6574 7320  s'] = newassets 
-000207b0: 6966 206e 6577 6173 7365 7473 2065 6c73  if newassets els
-000207c0: 6520 5b5d 0a20 2020 2020 2020 2069 6620  e [].        if 
-000207d0: 6661 696c 6564 766d 733a 0a20 2020 2020  failedvms:.     
-000207e0: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
-000207f0: 615b 2772 6573 756c 7427 5d20 3d20 2766  a['result'] = 'f
-00020800: 6169 6c75 7265 270a 2020 2020 2020 2020  ailure'.        
-00020810: 2020 2020 6661 696c 6564 6e61 6d65 7320      failednames 
-00020820: 3d20 272c 272e 6a6f 696e 285b 765b 276e  = ','.join([v['n
-00020830: 616d 6527 5d20 666f 7220 7620 696e 2066  ame'] for v in f
-00020840: 6169 6c65 6476 6d73 5d29 0a20 2020 2020  ailedvms]).     
-00020850: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
-00020860: 615b 2772 6561 736f 6e27 5d20 3d20 6627  a['reason'] = f'
-00020870: 5468 6520 666f 6c6c 6f77 696e 6720 766d  The following vm
-00020880: 7320 6661 696c 6564 3a20 7b66 6169 6c65  s failed: {faile
-00020890: 646e 616d 6573 7d27 0a20 2020 2020 2020  dnames}'.       
-000208a0: 2069 6620 6765 7462 6163 6b20 6f72 2074   if getback or t
-000208b0: 6f63 6c65 616e 3a0a 2020 2020 2020 2020  oclean:.        
-000208c0: 2020 2020 6f73 2e63 6864 6972 2827 2e2e      os.chdir('..
-000208d0: 2729 0a20 2020 2020 2020 2069 6620 746f  ').        if to
-000208e0: 636c 6561 6e3a 0a20 2020 2020 2020 2020  clean:.         
-000208f0: 2020 2072 6d74 7265 6528 7061 7468 290a     rmtree(path).
-00020900: 2020 2020 2020 2020 6966 2069 6e70 7574          if input
-00020910: 7374 7269 6e67 2069 7320 6e6f 7420 4e6f  string is not No
-00020920: 6e65 2061 6e64 206f 732e 7061 7468 2e65  ne and os.path.e
-00020930: 7869 7374 7328 6622 7465 6d70 5f70 6c61  xists(f"temp_pla
-00020940: 6e5f 7b70 6c61 6e7d 2e79 6d6c 2229 3a0a  n_{plan}.yml"):.
-00020950: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00020960: 656d 6f76 6528 6622 7465 6d70 5f70 6c61  emove(f"temp_pla
-00020970: 6e5f 7b70 6c61 6e7d 2e79 6d6c 2229 0a20  n_{plan}.yml"). 
-00020980: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
-00020990: 2069 6e20 6173 796e 6377 6169 7476 6d73   in asyncwaitvms
-000209a0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-000209b0: 6d65 2c20 6669 6e69 7368 6669 6c65 7320  me, finishfiles 
-000209c0: 3d20 656e 7472 795b 276e 616d 6527 5d2c  = entry['name'],
-000209d0: 2065 6e74 7279 5b27 6669 6e69 7368 6669   entry['finishfi
-000209e0: 6c65 7327 5d0a 2020 2020 2020 2020 2020  les'].          
-000209f0: 2020 7761 6974 636f 6d6d 616e 642c 2077    waitcommand, w
-00020a00: 6169 7474 696d 656f 7574 203d 2065 6e74  aittimeout = ent
-00020a10: 7279 5b27 7761 6974 636f 6d6d 616e 6427  ry['waitcommand'
-00020a20: 5d2c 2065 6e74 7279 5b27 7761 6974 7469  ], entry['waitti
-00020a30: 6d65 6f75 7427 5d0a 2020 2020 2020 2020  meout'].        
-00020a40: 2020 2020 766d 636c 6965 6e74 203d 2065      vmclient = e
-00020a50: 6e74 7279 5b27 766d 636c 6965 6e74 275d  ntry['vmclient']
-00020a60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00020a70: 662e 7761 6974 5f66 696e 6973 6828 6e61  f.wait_finish(na
-00020a80: 6d65 2c20 7761 6974 636f 6d6d 616e 643d  me, waitcommand=
-00020a90: 7761 6974 636f 6d6d 616e 642c 2077 6169  waitcommand, wai
-00020aa0: 7474 696d 656f 7574 3d77 6169 7474 696d  ttimeout=waittim
-00020ab0: 656f 7574 2c20 766d 636c 6965 6e74 3d76  eout, vmclient=v
-00020ac0: 6d63 6c69 656e 7429 0a20 2020 2020 2020  mclient).       
-00020ad0: 2020 2020 2069 6620 6669 6e69 7368 6669       if finishfi
-00020ae0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00020af0: 2020 2020 2073 656c 662e 6861 6e64 6c65       self.handle
-00020b00: 5f66 696e 6973 6866 696c 6573 286e 616d  _finishfiles(nam
-00020b10: 652c 2066 696e 6973 6866 696c 6573 2c20  e, finishfiles, 
-00020b20: 766d 636c 6965 6e74 3d76 6d63 6c69 656e  vmclient=vmclien
-00020b30: 7429 0a20 2020 2020 2020 2070 6f73 745f  t).        post_
-00020b40: 7363 7269 7074 203d 2066 277b 696e 7075  script = f'{inpu
-00020b50: 7464 6972 7d2f 6b63 6c69 5f70 6f73 742e  tdir}/kcli_post.
-00020b60: 7368 270a 2020 2020 2020 2020 6966 206f  sh'.        if o
-00020b70: 732e 7061 7468 2e65 7869 7374 7328 706f  s.path.exists(po
-00020b80: 7374 5f73 6372 6970 7429 3a0a 2020 2020  st_script):.    
-00020b90: 2020 2020 2020 2020 6966 2070 6f73 743a          if post:
-00020ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020bb0: 2070 7072 696e 7428 2252 756e 6e69 6e67   pprint("Running
-00020bc0: 206b 636c 695f 706f 7374 2e73 6822 290a   kcli_post.sh").
-00020bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020be0: 7769 7468 2054 656d 706f 7261 7279 4469  with TemporaryDi
-00020bf0: 7265 6374 6f72 7928 2920 6173 2074 6d70  rectory() as tmp
-00020c00: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
-00020c10: 2020 2020 2020 2020 2070 6f73 745f 7363           post_sc
-00020c20: 7269 7074 203d 2073 656c 662e 7072 6f63  ript = self.proc
-00020c30: 6573 735f 696e 7075 7466 696c 6528 2778  ess_inputfile('x
-00020c40: 7878 272c 2070 6f73 745f 7363 7269 7074  xx', post_script
-00020c50: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00020c60: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
-00020c70: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00020c80: 6f70 656e 2866 227b 746d 7064 6972 7d2f  open(f"{tmpdir}/
-00020c90: 706f 7374 2e73 6822 2c20 2777 2729 2061  post.sh", 'w') a
-00020ca0: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
-00020cb0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
-00020cc0: 7269 7465 2870 6f73 745f 7363 7269 7074  rite(post_script
-00020cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00020ce0: 2020 2020 2020 706f 7374 5f72 756e 203d        post_run =
-00020cf0: 2072 756e 2866 2762 6173 6820 7b74 6d70   run(f'bash {tmp
-00020d00: 6469 727d 2f70 6f73 742e 7368 272c 2073  dir}/post.sh', s
-00020d10: 6865 6c6c 3d54 7275 652c 2073 7464 6f75  hell=True, stdou
-00020d20: 743d 5049 5045 2c20 7374 6465 7272 3d53  t=PIPE, stderr=S
-00020d30: 5444 4f55 542c 0a20 2020 2020 2020 2020  TDOUT,.         
-00020d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d50: 2020 2020 2020 2020 2020 756e 6976 6572            univer
-00020d60: 7361 6c5f 6e65 776c 696e 6573 3d54 7275  sal_newlines=Tru
-00020d70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00020d80: 2020 2020 2020 2069 6620 706f 7374 5f72         if post_r
-00020d90: 756e 2e72 6574 7572 6e63 6f64 6520 213d  un.returncode !=
-00020da0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00020db0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-00020dc0: 3d20 6622 4973 7375 6520 7768 656e 2072  = f"Issue when r
-00020dd0: 756e 6e69 6e67 206b 636c 695f 706f 7374  unning kcli_post
-00020de0: 2e73 6820 3a5c 6e7b 706f 7374 5f72 756e  .sh :\n{post_run
-00020df0: 2e73 7464 6f75 747d 220a 2020 2020 2020  .stdout}".      
-00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e10: 2020 6572 726f 7228 6d73 6729 0a20 2020    error(msg).   
-00020e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e30: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00020e40: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-00020e50: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
-00020e60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00020e70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020e80: 2020 2077 6172 6e69 6e67 2822 536b 6970     warning("Skip
-00020e90: 7069 6e67 206b 636c 695f 706f 7374 2e73  ping kcli_post.s
-00020ea0: 6820 6173 2072 6571 7565 7374 6564 2229  h as requested")
-00020eb0: 0a20 2020 2020 2020 2069 6620 6f76 6572  .        if over
-00020ec0: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
-00020ed0: 6579 6469 7227 2920 6973 206e 6f74 204e  eydir') is not N
-00020ee0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00020ef0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00020f00: 7465 6d70 6b65 7964 6972 2729 2e63 6c65  tempkeydir').cle
-00020f10: 616e 7570 2829 0a20 2020 2020 2020 2072  anup().        r
-00020f20: 6574 7572 6e20 7265 7475 726e 6461 7461  eturn returndata
-00020f30: 0a0a 2020 2020 6465 6620 6861 6e64 6c65  ..    def handle
-00020f40: 5f68 6f73 7428 7365 6c66 2c20 706f 6f6c  _host(self, pool
-00020f50: 3d4e 6f6e 652c 2069 6d61 6765 3d4e 6f6e  =None, image=Non
-00020f60: 652c 2073 7769 7463 683d 4e6f 6e65 2c20  e, switch=None, 
-00020f70: 646f 776e 6c6f 6164 3d46 616c 7365 2c0a  download=False,.
-00020f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f90: 2020 2020 7572 6c3d 4e6f 6e65 2c20 636d      url=None, cm
-00020fa0: 643d 4e6f 6e65 2c20 7379 6e63 3d46 616c  d=None, sync=Fal
-00020fb0: 7365 2c20 7369 7a65 3d4e 6f6e 652c 2061  se, size=None, a
-00020fc0: 7263 683d 2778 3836 5f36 3427 2c0a 2020  rch='x86_64',.  
-00020fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fe0: 2020 6b76 6d5f 6f70 656e 7374 6163 6b3d    kvm_openstack=
-00020ff0: 5472 7565 2c20 7268 636f 735f 636f 6d6d  True, rhcos_comm
-00021000: 6974 3d4e 6f6e 652c 2072 6863 6f73 5f69  it=None, rhcos_i
-00021010: 6e73 7461 6c6c 6572 3d46 616c 7365 293a  nstaller=False):
-00021020: 0a20 2020 2020 2020 2069 6620 646f 776e  .        if down
-00021030: 6c6f 6164 3a0a 2020 2020 2020 2020 2020  load:.          
-00021040: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
-00021050: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
-00021060: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00021070: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
-00021080: 2073 656c 662e 706f 6f6c 0a20 2020 2020   self.pool.     
-00021090: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-000210a0: 7428 6622 5573 696e 6720 706f 6f6c 207b  t(f"Using pool {
-000210b0: 706f 6f6c 7d22 290a 2020 2020 2020 2020  pool}").        
-000210c0: 2020 2020 6966 2069 6d61 6765 2069 7320      if image is 
-000210d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000210e0: 2020 2020 2020 2020 2020 6966 2075 726c            if url
-000210f0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00021100: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021110: 2061 7263 6820 213d 2027 7838 365f 3634   arch != 'x86_64
-00021120: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00021130: 2020 2020 2020 2020 2020 2049 4d41 4745             IMAGE
-00021140: 532e 7570 6461 7465 287b 693a 2049 4d41  S.update({i: IMA
-00021150: 4745 535b 695d 2e72 6570 6c61 6365 2827  GES[i].replace('
-00021160: 7838 365f 3634 272c 2061 7263 6829 2e72  x86_64', arch).r
-00021170: 6570 6c61 6365 2827 616d 6436 3427 2c20  eplace('amd64', 
-00021180: 6172 6368 290a 2020 2020 2020 2020 2020  arch).          
-00021190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000211b0: 2069 2069 6e20 494d 4147 4553 7d29 0a20   i in IMAGES}). 
-000211c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211d0: 2020 2069 6620 696d 6167 6520 6e6f 7420     if image not 
-000211e0: 696e 2049 4d41 4745 533a 0a20 2020 2020  in IMAGES:.     
-000211f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021200: 2020 2065 7272 6f72 2866 2249 6d61 6765     error(f"Image
-00021210: 207b 696d 6167 657d 2068 6173 206e 6f20   {image} has no 
-00021220: 6173 736f 6369 6174 6564 2075 726c 2229  associated url")
-00021230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021240: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00021250: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
-00021260: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
-00021270: 2249 6e63 6f72 7265 6374 2069 6d61 6765  "Incorrect image
-00021280: 227d 0a20 2020 2020 2020 2020 2020 2020  "}.             
-00021290: 2020 2020 2020 2075 726c 203d 2049 4d41         url = IMA
-000212a0: 4745 535b 696d 6167 655d 0a20 2020 2020  GES[image].     
-000212b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000212c0: 6d61 6765 5f74 7970 6520 3d20 276f 7065  mage_type = 'ope
-000212d0: 6e73 7461 636b 2720 6966 206b 766d 5f6f  nstack' if kvm_o
-000212e0: 7065 6e73 7461 636b 2061 6e64 2073 656c  penstack and sel
-000212f0: 662e 7479 7065 203d 3d20 276b 766d 2720  f.type == 'kvm' 
-00021300: 656c 7365 2073 656c 662e 7479 7065 0a20  else self.type. 
-00021310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021320: 2020 2069 6620 6e6f 7420 6b76 6d5f 6f70     if not kvm_op
-00021330: 656e 7374 6163 6b20 616e 6420 7365 6c66  enstack and self
-00021340: 2e74 7970 6520 3d3d 2027 6b76 6d27 3a0a  .type == 'kvm':.
-00021350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021360: 2020 2020 2020 2020 696d 6167 6520 2b3d          image +=
-00021370: 2022 2d71 656d 7522 0a20 2020 2020 2020   "-qemu".       
-00021380: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021390: 2772 6863 6f73 2720 696e 2069 6d61 6765  'rhcos' in image
-000213a0: 2061 6e64 206e 6f74 2069 6d61 6765 2e65   and not image.e
-000213b0: 6e64 7377 6974 6828 2771 636f 7732 2e67  ndswith('qcow2.g
-000213c0: 7a27 293a 0a20 2020 2020 2020 2020 2020  z'):.           
-000213d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000213e0: 7268 636f 735f 636f 6d6d 6974 2069 7320  rhcos_commit is 
-000213f0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00021400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021410: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
-00021420: 6f6e 2e67 6574 5f63 6f6d 6d69 745f 7268  on.get_commit_rh
-00021430: 636f 7328 7268 636f 735f 636f 6d6d 6974  cos(rhcos_commit
-00021440: 2c20 5f74 7970 653d 696d 6167 655f 7479  , _type=image_ty
-00021450: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-00021460: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00021470: 2072 6863 6f73 5f69 6e73 7461 6c6c 6572   rhcos_installer
-00021480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021490: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-000214a0: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
-000214b0: 202b 3d20 6627 3a7b 6f73 2e67 6574 6377   += f':{os.getcw
-000214c0: 6428 297d 270a 2020 2020 2020 2020 2020  d()}'.          
-000214d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000214e0: 2020 7572 6c20 3d20 636f 6d6d 6f6e 2e67    url = common.g
-000214f0: 6574 5f69 6e73 7461 6c6c 6572 5f72 6863  et_installer_rhc
-00021500: 6f73 285f 7479 7065 3d69 6d61 6765 5f74  os(_type=image_t
-00021510: 7970 652c 2061 7263 683d 6172 6368 290a  ype, arch=arch).
+0001d760: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
+0001d770: 2073 656c 662e 6c69 7374 5f70 726f 6669   self.list_profi
+0001d780: 6c65 7328 293a 0a20 2020 2020 2020 2020  les():.         
+0001d790: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001d7a0: 7572 7265 6e74 696d 6167 6520 3d20 7072  urrentimage = pr
+0001d7b0: 6f66 696c 655b 2769 6d61 6765 275d 0a20  ofile['image']. 
+0001d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7d0: 2020 2020 2020 2065 6e74 7279 7072 6f66         entryprof
+0001d7e0: 696c 6520 3d20 656e 7472 795b 305d 0a20  ile = entry[0]. 
+0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d800: 2020 2020 2020 2069 6620 656e 7472 7970         if entryp
+0001d810: 726f 6669 6c65 203d 3d20 6375 7272 656e  rofile == curren
+0001d820: 7469 6d61 6765 3a0a 2020 2020 2020 2020  timage:.        
+0001d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d840: 2020 2020 7072 6f66 696c 655b 2769 6d61      profile['ima
+0001d850: 6765 275d 203d 2065 6e74 7279 5b34 5d0a  ge'] = entry[4].
+0001d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d870: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001d880: 656e 746f 7665 7272 6964 6573 5b27 696d  entoverrides['im
+0001d890: 6167 6527 5d20 3d20 7072 6f66 696c 655b  age'] = profile[
+0001d8a0: 2769 6d61 6765 275d 0a20 2020 2020 2020  'image'].       
+0001d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8c0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+0001d8d0: 2020 2020 2020 2020 2020 2069 6620 7468             if th
+0001d8e0: 7265 6164 6564 3a0a 2020 2020 2020 2020  readed:.        
+0001d8f0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0001d900: 6172 6773 203d 2028 6e61 6d65 2c20 7072  args = (name, pr
+0001d910: 6f66 696c 656e 616d 652c 2063 7572 7265  ofilename, curre
+0001d920: 6e74 6f76 6572 7269 6465 732c 2070 726f  ntoverrides, pro
+0001d930: 6669 6c65 2c20 7a2c 2070 6c61 6e2c 2063  file, z, plan, c
+0001d940: 7572 7265 6e74 706c 616e 6469 722c 2076  urrentplandir, v
+0001d950: 6d63 6c69 656e 742c 0a20 2020 2020 2020  mclient,.       
+0001d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d970: 2020 2020 2020 2020 206f 6e66 6c79 2c20           onfly, 
+0001d980: 6f6e 6c79 6173 7365 7473 2c20 6e65 7776  onlyassets, newv
+0001d990: 6d73 2c20 6661 696c 6564 766d 732c 2061  ms, failedvms, a
+0001d9a0: 7379 6e63 7761 6974 766d 732c 206e 6577  syncwaitvms, new
+0001d9b0: 6173 7365 7473 290a 2020 2020 2020 2020  assets).        
+0001d9c0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+0001d9d0: 7468 7265 6164 696e 672e 5468 7265 6164  threading.Thread
+0001d9e0: 2874 6172 6765 743d 7365 6c66 2e74 6872  (target=self.thr
+0001d9f0: 6561 6465 645f 6372 6561 7465 5f76 6d2c  eaded_create_vm,
+0001da00: 2061 7267 733d 6e65 775f 6172 6773 290a   args=new_args).
+0001da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da20: 2020 2020 7468 7265 6164 732e 6170 7065      threads.appe
+0001da30: 6e64 2874 290a 2020 2020 2020 2020 2020  nd(t).          
+0001da40: 2020 2020 2020 2020 2020 742e 7374 6172            t.star
+0001da50: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0001da60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001da70: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001da80: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
+0001da90: 7465 5f76 6d28 6e61 6d65 2c20 7072 6f66  te_vm(name, prof
+0001daa0: 696c 656e 616d 652c 206f 7665 7272 6964  ilename, overrid
+0001dab0: 6573 3d63 7572 7265 6e74 6f76 6572 7269  es=currentoverri
+0001dac0: 6465 732c 2063 7573 746f 6d70 726f 6669  des, customprofi
+0001dad0: 6c65 3d70 726f 6669 6c65 2c20 6b3d 7a2c  le=profile, k=z,
+0001dae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db00: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+0001db10: 6e3d 706c 616e 2c20 6261 7365 6469 723d  n=plan, basedir=
+0001db20: 6375 7272 656e 7470 6c61 6e64 6972 2c20  currentplandir, 
+0001db30: 636c 6965 6e74 3d76 6d63 6c69 656e 742c  client=vmclient,
+0001db40: 206f 6e66 6c79 3d6f 6e66 6c79 2c0a 2020   onfly=onfly,.  
+0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db70: 2020 2020 2020 2020 2020 6f6e 6c79 6173            onlyas
+0001db80: 7365 7473 3d6f 6e6c 7961 7373 6574 7329  sets=onlyassets)
+0001db90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dba0: 2020 2020 2069 6620 6e6f 7420 6f6e 6c79       if not only
+0001dbb0: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbd0: 636f 6d6d 6f6e 2e68 616e 646c 655f 7265  common.handle_re
+0001dbe0: 7370 6f6e 7365 2872 6573 756c 742c 206e  sponse(result, n
+0001dbf0: 616d 652c 2063 6c69 656e 743d 766d 636c  ame, client=vmcl
+0001dc00: 6965 6e74 290a 2020 2020 2020 2020 2020  ient).          
+0001dc10: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0001dc20: 616e 646c 655f 766d 5f72 6573 756c 7428  andle_vm_result(
+0001dc30: 6e61 6d65 2c20 7072 6f66 696c 652c 2072  name, profile, r
+0001dc40: 6573 756c 743d 7265 7375 6c74 2c20 6e65  esult=result, ne
+0001dc50: 7776 6d73 3d6e 6577 766d 732c 2066 6169  wvms=newvms, fai
+0001dc60: 6c65 6476 6d73 3d66 6169 6c65 6476 6d73  ledvms=failedvms
+0001dc70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc90: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
+0001dca0: 6377 6169 7476 6d73 3d61 7379 6e63 7761  cwaitvms=asyncwa
+0001dcb0: 6974 766d 732c 206f 6e6c 7961 7373 6574  itvms, onlyasset
+0001dcc0: 733d 6f6e 6c79 6173 7365 7473 2c20 6e65  s=onlyassets, ne
+0001dcd0: 7761 7373 6574 733d 6e65 7761 7373 6574  wassets=newasset
+0001dce0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0001dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd00: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
+0001dd10: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
+0001dd20: 2020 2020 2020 2020 6966 2076 6d65 6e74          if vment
+0001dd30: 7269 6573 2061 6e64 2074 6872 6561 6465  ries and threade
+0001dd40: 643a 0a20 2020 2020 2020 2020 2020 2077  d:.            w
+0001dd50: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
+0001dd60: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001dd70: 6e64 6578 2c20 7420 696e 2065 6e75 6d65  ndex, t in enume
+0001dd80: 7261 7465 2874 6872 6561 6473 293a 0a20  rate(threads):. 
+0001dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dda0: 2020 2069 6620 6e6f 7420 742e 6973 5f61     if not t.is_a
+0001ddb0: 6c69 7665 2829 3a0a 2020 2020 2020 2020  live():.        
+0001ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ddd0: 6465 6c20 7468 7265 6164 735b 696e 6465  del threads[inde
+0001dde0: 785d 0a20 2020 2020 2020 2020 2020 2020  x].             
+0001ddf0: 2020 2069 6620 6e6f 7420 7468 7265 6164     if not thread
+0001de00: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001de10: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0001de20: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001de30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001de40: 2020 2020 2020 2073 6c65 6570 2831 290a         sleep(1).
+0001de50: 2020 2020 2020 2020 6966 2076 6d63 6c69          if vmcli
+0001de60: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+0001de70: 2020 7961 6d6c 2e73 6166 655f 6475 6d70    yaml.safe_dump
+0001de80: 2876 6d63 6c69 656e 7473 2c20 6f70 656e  (vmclients, open
+0001de90: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
+0001dea0: 7365 7228 6627 7e2f 2e6b 636c 692f 766d  ser(f'~/.kcli/vm
+0001deb0: 636c 6965 6e74 735f 7b70 6c61 6e7d 2729  clients_{plan}')
+0001dec0: 2c20 2777 2729 290a 2020 2020 2020 2020  , 'w')).        
+0001ded0: 6966 2064 6973 6b65 6e74 7269 6573 2061  if diskentries a
+0001dee0: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
+0001def0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+0001df00: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+0001df10: 2044 6973 6b73 2e2e 2e22 290a 2020 2020   Disks...").    
+0001df20: 2020 2020 666f 7220 6469 736b 2069 6e20      for disk in 
+0001df30: 6469 736b 656e 7472 6965 733a 0a20 2020  diskentries:.   
+0001df40: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+0001df50: 203d 2065 6e74 7269 6573 5b64 6973 6b5d   = entries[disk]
+0001df60: 0a20 2020 2020 2020 2020 2020 2070 6f6f  .            poo
+0001df70: 6c20 3d20 7072 6f66 696c 652e 6765 7428  l = profile.get(
+0001df80: 2770 6f6f 6c27 290a 2020 2020 2020 2020  'pool').        
+0001df90: 2020 2020 766d 7320 3d20 7072 6f66 696c      vms = profil
+0001dfa0: 652e 6765 7428 2776 6d73 2729 0a20 2020  e.get('vms').   
+0001dfb0: 2020 2020 2020 2020 2074 656d 706c 6174           templat
+0001dfc0: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
+0001dfd0: 2774 656d 706c 6174 6527 290a 2020 2020  'template').    
+0001dfe0: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
+0001dff0: 7072 6f66 696c 652e 6765 7428 2769 6d61  profile.get('ima
+0001e000: 6765 272c 2074 656d 706c 6174 6529 0a20  ge', template). 
+0001e010: 2020 2020 2020 2020 2020 2073 697a 6520             size 
+0001e020: 3d20 696e 7428 7072 6f66 696c 652e 6765  = int(profile.ge
+0001e030: 7428 2773 697a 6527 2c20 3130 2929 0a20  t('size', 10)). 
+0001e040: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+0001e050: 6f6c 2069 7320 4e6f 6e65 3a0a 2020 2020  ol is None:.    
+0001e060: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0001e070: 7228 6622 4d69 7373 696e 6720 4b65 7920  r(f"Missing Key 
+0001e080: 506f 6f6c 2066 6f72 2064 6973 6b20 7365  Pool for disk se
+0001e090: 6374 696f 6e20 7b64 6973 6b7d 2e20 4e6f  ction {disk}. No
+0001e0a0: 7420 6372 6561 7469 6e67 2069 742e 2e2e  t creating it...
+0001e0b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001e0c0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0001e0d0: 2020 2020 2020 2020 6966 2076 6d73 2069          if vms i
+0001e0e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001e0f0: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+0001e100: 4d69 7373 696e 6720 6f72 2049 6e63 6f72  Missing or Incor
+0001e110: 7265 6374 204b 6579 2056 6d73 2066 6f72  rect Key Vms for
+0001e120: 2064 6973 6b20 7365 6374 696f 6e20 7b64   disk section {d
+0001e130: 6973 6b7d 2e20 4e6f 7420 6372 6561 7469  isk}. Not creati
+0001e140: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
+0001e150: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001e160: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0001e170: 7368 6172 6561 626c 6520 3d20 5472 7565  shareable = True
+0001e180: 2069 6620 6c65 6e28 766d 7329 203e 2031   if len(vms) > 1
+0001e190: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
+0001e1a0: 2020 2020 2020 2020 6966 206b 2e64 6973          if k.dis
+0001e1b0: 6b5f 6578 6973 7473 2870 6f6f 6c2c 2064  k_exists(pool, d
+0001e1c0: 6973 6b29 3a0a 2020 2020 2020 2020 2020  isk):.          
+0001e1d0: 2020 2020 2020 7070 7269 6e74 2866 2243        pprint(f"C
+0001e1e0: 7265 6174 696f 6e20 666f 7220 4469 736b  reation for Disk
+0001e1f0: 207b 6469 736b 7d20 736b 6970 7065 6421   {disk} skipped!
+0001e200: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001e210: 2020 2070 6f6f 6c70 6174 6820 3d20 6b2e     poolpath = k.
+0001e220: 6765 745f 706f 6f6c 5f70 6174 6828 706f  get_pool_path(po
+0001e230: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
+0001e240: 2020 2020 6e65 7764 6973 6b20 3d20 6622      newdisk = f"
+0001e250: 7b70 6f6f 6c70 6174 687d 2f7b 6469 736b  {poolpath}/{disk
+0001e260: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0001e270: 2020 2066 6f72 2076 6d20 696e 2076 6d73     for vm in vms
+0001e280: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e290: 2020 2020 2020 7070 7269 6e74 2866 2241        pprint(f"A
+0001e2a0: 6464 696e 6720 6469 736b 207b 6469 736b  dding disk {disk
+0001e2b0: 7d20 746f 207b 766d 7d22 290a 2020 2020  } to {vm}").    
+0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2d0: 6b2e 6164 645f 6469 736b 286e 616d 653d  k.add_disk(name=
+0001e2e0: 766d 2c20 7369 7a65 3d73 697a 652c 2070  vm, size=size, p
+0001e2f0: 6f6f 6c3d 706f 6f6c 2c20 696d 6167 653d  ool=pool, image=
+0001e300: 696d 6167 652c 2073 6861 7265 6162 6c65  image, shareable
+0001e310: 3d73 6861 7265 6162 6c65 2c20 6578 6973  =shareable, exis
+0001e320: 7469 6e67 3d6e 6577 6469 736b 2c0a 2020  ting=newdisk,.  
+0001e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e340: 2020 2020 2020 2020 2020 2020 2074 6869               thi
+0001e350: 6e3d 4661 6c73 6529 0a20 2020 2020 2020  n=False).       
+0001e360: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001e370: 2020 2020 2020 2020 2020 206e 6577 6469             newdi
+0001e380: 736b 203d 206b 2e63 7265 6174 655f 6469  sk = k.create_di
+0001e390: 736b 2864 6973 6b2c 2073 697a 653d 7369  sk(disk, size=si
+0001e3a0: 7a65 2c20 706f 6f6c 3d70 6f6f 6c2c 2069  ze, pool=pool, i
+0001e3b0: 6d61 6765 3d69 6d61 6765 2c20 7468 696e  mage=image, thin
+0001e3c0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0001e3d0: 2020 2020 2020 2020 6966 206e 6577 6469          if newdi
+0001e3e0: 736b 2069 7320 4e6f 6e65 3a0a 2020 2020  sk is None:.    
+0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e400: 6572 726f 7228 6622 4469 736b 207b 6469  error(f"Disk {di
+0001e410: 736b 7d20 6e6f 7420 6465 706c 6f79 6564  sk} not deployed
+0001e420: 2e20 4974 2077 6f6e 2774 2062 6520 6164  . It won't be ad
+0001e430: 6465 6420 746f 2061 6e79 2076 6d22 290a  ded to any vm").
+0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e450: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001e460: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+0001e470: 2e70 7072 696e 7428 6622 4469 736b 207b  .pprint(f"Disk {
+0001e480: 6469 736b 7d20 6465 706c 6f79 6564 2122  disk} deployed!"
+0001e490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e4a0: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
+0001e4b0: 766d 733a 0a20 2020 2020 2020 2020 2020  vms:.           
+0001e4c0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001e4d0: 696e 7428 6622 4164 6469 6e67 2064 6973  int(f"Adding dis
+0001e4e0: 6b20 7b64 6973 6b7d 2074 6f20 7b76 6d7d  k {disk} to {vm}
+0001e4f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001e500: 2020 2020 2020 2020 2020 206b 2e61 6464             k.add
+0001e510: 5f64 6973 6b28 6e61 6d65 3d76 6d2c 2073  _disk(name=vm, s
+0001e520: 697a 653d 7369 7a65 2c20 706f 6f6c 3d70  ize=size, pool=p
+0001e530: 6f6f 6c2c 2069 6d61 6765 3d69 6d61 6765  ool, image=image
+0001e540: 2c20 7368 6172 6561 626c 653d 7368 6172  , shareable=shar
+0001e550: 6561 626c 652c 0a20 2020 2020 2020 2020  eable,.         
+0001e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e570: 2020 2020 2020 2020 2020 6578 6973 7469            existi
+0001e580: 6e67 3d6e 6577 6469 736b 2c20 7468 696e  ng=newdisk, thin
+0001e590: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0001e5a0: 6966 2063 6f6e 7461 696e 6572 656e 7472  if containerentr
+0001e5b0: 6965 7320 616e 6420 6e6f 7420 6f6e 6c79  ies and not only
+0001e5c0: 6173 7365 7473 3a0a 2020 2020 2020 2020  assets:.        
+0001e5d0: 2020 2020 636f 6e74 203d 204b 636f 6e74      cont = Kcont
+0001e5e0: 6169 6e65 7263 6f6e 6669 6728 7365 6c66  ainerconfig(self
+0001e5f0: 2c20 636c 6965 6e74 3d73 656c 662e 636f  , client=self.co
+0001e600: 6e74 6169 6e65 7263 6c69 656e 7429 2e63  ntainerclient).c
+0001e610: 6f6e 740a 2020 2020 2020 2020 2020 2020  ont.            
+0001e620: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
+0001e630: 6720 436f 6e74 6169 6e65 7273 2e2e 2e22  g Containers..."
+0001e640: 290a 2020 2020 2020 2020 2020 2020 6c61  ).            la
+0001e650: 6265 6c20 3d20 6622 706c 616e 3d7b 706c  bel = f"plan={pl
+0001e660: 616e 7d22 0a20 2020 2020 2020 2020 2020  an}".           
+0001e670: 2066 6f72 2063 6f6e 7461 696e 6572 2069   for container i
+0001e680: 6e20 636f 6e74 6169 6e65 7265 6e74 7269  n containerentri
+0001e690: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001e6a0: 2020 2020 6966 2063 6f6e 742e 6578 6973      if cont.exis
+0001e6b0: 7473 5f63 6f6e 7461 696e 6572 2863 6f6e  ts_container(con
+0001e6c0: 7461 696e 6572 293a 0a20 2020 2020 2020  tainer):.       
+0001e6d0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001e6e0: 696e 7428 6622 436f 6e74 6169 6e65 7220  int(f"Container 
+0001e6f0: 7b63 6f6e 7461 696e 6572 7d20 736b 6970  {container} skip
+0001e700: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
+0001e710: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001e720: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0001e730: 2020 2020 7072 6f66 696c 6520 3d20 656e      profile = en
+0001e740: 7472 6965 735b 636f 6e74 6169 6e65 725d  tries[container]
+0001e750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e760: 2069 6620 2770 726f 6669 6c65 2720 696e   if 'profile' in
+0001e770: 2070 726f 6669 6c65 2061 6e64 2070 726f   profile and pro
+0001e780: 6669 6c65 5b27 7072 6f66 696c 6527 5d20  file['profile'] 
+0001e790: 696e 2063 6f6e 7461 696e 6572 7072 6f66  in containerprof
+0001e7a0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+0001e7b0: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
+0001e7c0: 7072 6f66 696c 6520 3d20 636f 6e74 6169  profile = contai
+0001e7d0: 6e65 7270 726f 6669 6c65 735b 7072 6f66  nerprofiles[prof
+0001e7e0: 696c 655b 2770 726f 6669 6c65 275d 5d0a  ile['profile']].
+0001e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e800: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001e810: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
+0001e820: 7072 6f66 696c 6520 3d20 7b7d 0a20 2020  profile = {}.   
+0001e830: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001e840: 7461 696e 6572 696d 6167 6520 3d20 6e65  tainerimage = ne
+0001e850: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
+0001e860: 7072 6f66 696c 652e 6765 7428 2769 6d61  profile.get('ima
+0001e870: 6765 2729 2c20 7072 6f66 696c 652e 6765  ge'), profile.ge
+0001e880: 7428 2769 6d61 6765 2729 2c0a 2020 2020  t('image'),.    
+0001e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001e8c0: 7573 746f 6d70 726f 6669 6c65 2e67 6574  ustomprofile.get
+0001e8d0: 2827 696d 6167 6527 292c 0a20 2020 2020  ('image'),.     
+0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e900: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001e910: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+0001e920: 2769 6d61 6765 2729 5d20 6966 2065 2069  'image')] if e i
+0001e930: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
+0001e940: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001e950: 2020 206e 6574 7320 3d20 6e65 7874 2828     nets = next((
+0001e960: 6520 666f 7220 6520 696e 205b 7072 6f66  e for e in [prof
+0001e970: 696c 652e 6765 7428 276e 6574 7327 292c  ile.get('nets'),
+0001e980: 2063 7573 746f 6d70 726f 6669 6c65 2e67   customprofile.g
+0001e990: 6574 2827 6e65 7473 2729 5d20 6966 2065  et('nets')] if e
+0001e9a0: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+0001e9b0: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+0001e9c0: 2020 2020 2070 6f72 7473 203d 206e 6578       ports = nex
+0001e9d0: 7428 2865 2066 6f72 2065 2069 6e20 5b70  t((e for e in [p
+0001e9e0: 726f 6669 6c65 2e67 6574 2827 706f 7274  rofile.get('port
+0001e9f0: 7327 292c 2063 7573 746f 6d70 726f 6669  s'), customprofi
+0001ea00: 6c65 2e67 6574 2827 706f 7274 7327 295d  le.get('ports')]
+0001ea10: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
+0001ea20: 6529 2c20 4e6f 6e65 290a 2020 2020 2020  e), None).      
+0001ea30: 2020 2020 2020 2020 2020 766f 6c75 6d65            volume
+0001ea40: 7320 3d20 6e65 7874 2828 6520 666f 7220  s = next((e for 
+0001ea50: 6520 696e 205b 7072 6f66 696c 652e 6765  e in [profile.ge
+0001ea60: 7428 2776 6f6c 756d 6573 2729 2c20 7072  t('volumes'), pr
+0001ea70: 6f66 696c 652e 6765 7428 2764 6973 6b73  ofile.get('disks
+0001ea80: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+0001ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eab0: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
+0001eac0: 7428 2776 6f6c 756d 6573 2729 2c20 6375  t('volumes'), cu
+0001ead0: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+0001eae0: 2764 6973 6b73 2729 5d0a 2020 2020 2020  'disks')].      
+0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb00: 2020 2020 2020 2020 2020 6966 2065 2069            if e i
+0001eb10: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
+0001eb20: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001eb30: 2020 2065 6e76 6972 6f6e 6d65 6e74 203d     environment =
+0001eb40: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
+0001eb50: 6e20 5b70 726f 6669 6c65 2e67 6574 2827  n [profile.get('
+0001eb60: 656e 7669 726f 6e6d 656e 7427 292c 2063  environment'), c
+0001eb70: 7573 746f 6d70 726f 6669 6c65 2e67 6574  ustomprofile.get
+0001eb80: 2827 656e 7669 726f 6e6d 656e 7427 295d  ('environment')]
+0001eb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebb0: 2020 2020 2069 6620 6520 6973 206e 6f74       if e is not
+0001ebc0: 204e 6f6e 6529 2c20 4e6f 6e65 290a 2020   None), None).  
+0001ebd0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+0001ebe0: 6473 203d 206e 6578 7428 2865 2066 6f72  ds = next((e for
+0001ebf0: 2065 2069 6e20 5b70 726f 6669 6c65 2e67   e in [profile.g
+0001ec00: 6574 2827 636d 6473 2729 2c20 6375 7374  et('cmds'), cust
+0001ec10: 6f6d 7072 6f66 696c 652e 6765 7428 2763  omprofile.get('c
+0001ec20: 6d64 7327 295d 2069 6620 6520 6973 206e  mds')] if e is n
+0001ec30: 6f74 204e 6f6e 6529 2c20 5b5d 290a 2020  ot None), []).  
+0001ec40: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0001ec50: 6363 6573 7328 6622 436f 6e74 6169 6e65  ccess(f"Containe
+0001ec60: 7220 7b63 6f6e 7461 696e 6572 7dc2 a064  r {container}..d
+0001ec70: 6570 6c6f 7965 6421 2229 0a20 2020 2020  eployed!").     
+0001ec80: 2020 2020 2020 2020 2020 2063 6f6e 742e             cont.
+0001ec90: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
+0001eca0: 286e 616d 653d 636f 6e74 6169 6e65 722c  (name=container,
+0001ecb0: 2069 6d61 6765 3d63 6f6e 7461 696e 6572   image=container
+0001ecc0: 696d 6167 652c 206e 6574 733d 6e65 7473  image, nets=nets
+0001ecd0: 2c20 636d 6473 3d63 6d64 732c 2070 6f72  , cmds=cmds, por
+0001ece0: 7473 3d70 6f72 7473 2c0a 2020 2020 2020  ts=ports,.      
+0001ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed10: 766f 6c75 6d65 733d 766f 6c75 6d65 732c  volumes=volumes,
+0001ed20: 2065 6e76 6972 6f6e 6d65 6e74 3d65 6e76   environment=env
+0001ed30: 6972 6f6e 6d65 6e74 2c20 6c61 6265 6c3d  ironment, label=
+0001ed40: 6c61 6265 6c29 0a20 2020 2020 2020 2069  label).        i
+0001ed50: 6620 646e 7365 6e74 7269 6573 2061 6e64  f dnsentries and
+0001ed60: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
+0001ed70: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+0001ed80: 696e 7428 2244 6570 6c6f 7969 6e67 2044  int("Deploying D
+0001ed90: 6e73 2045 6e74 7269 6573 2e2e 2e22 290a  ns Entries...").
+0001eda0: 2020 2020 2020 2020 2020 2020 646e 7363              dnsc
+0001edb0: 6c69 656e 7473 203d 207b 7d0a 2020 2020  lients = {}.    
+0001edc0: 2020 2020 2020 2020 666f 7220 646e 7365          for dnse
+0001edd0: 6e74 7279 2069 6e20 646e 7365 6e74 7269  ntry in dnsentri
+0001ede0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001edf0: 2020 2020 646e 7370 726f 6669 6c65 203d      dnsprofile =
+0001ee00: 2065 6e74 7269 6573 5b64 6e73 656e 7472   entries[dnsentr
+0001ee10: 795d 0a20 2020 2020 2020 2020 2020 2020  y].             
+0001ee20: 2020 2064 6e73 646f 6d61 696e 203d 2064     dnsdomain = d
+0001ee30: 6e73 7072 6f66 696c 652e 6765 7428 2764  nsprofile.get('d
+0001ee40: 6f6d 6169 6e27 290a 2020 2020 2020 2020  omain').        
+0001ee50: 2020 2020 2020 2020 646e 736e 6574 203d          dnsnet =
+0001ee60: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
+0001ee70: 276e 6574 272c 2027 6465 6661 756c 7427  'net', 'default'
+0001ee80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ee90: 2020 646e 7369 7020 3d20 646e 7370 726f    dnsip = dnspro
+0001eea0: 6669 6c65 2e67 6574 2827 6970 2729 0a20  file.get('ip'). 
+0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001eec0: 6e73 616c 6961 7320 3d20 646e 7370 726f  nsalias = dnspro
+0001eed0: 6669 6c65 2e67 6574 2827 616c 6961 7327  file.get('alias'
+0001eee0: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
+0001eef0: 2020 2020 2020 646e 7363 6c69 656e 7420        dnsclient 
+0001ef00: 3d20 646e 7370 726f 6669 6c65 2e67 6574  = dnsprofile.get
+0001ef10: 2827 636c 6965 6e74 2729 0a20 2020 2020  ('client').     
+0001ef20: 2020 2020 2020 2020 2020 2069 6620 646e             if dn
+0001ef30: 7363 6c69 656e 7420 6973 204e 6f6e 653a  sclient is None:
+0001ef40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef50: 2020 2020 207a 203d 206b 0a20 2020 2020       z = k.     
+0001ef60: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001ef70: 646e 7363 6c69 656e 7420 696e 2064 6e73  dnsclient in dns
+0001ef80: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+0001ef90: 2020 2020 2020 2020 2020 2020 207a 203d               z =
+0001efa0: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
+0001efb0: 6c69 656e 745d 0a20 2020 2020 2020 2020  lient].         
+0001efc0: 2020 2020 2020 2065 6c69 6620 646e 7363         elif dnsc
+0001efd0: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
+0001efe0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+0001eff0: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
+0001f000: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
+0001f010: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
+0001f020: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001f030: 6e73 636c 6965 6e74 735b 646e 7363 6c69  nsclients[dnscli
+0001f040: 656e 745d 203d 207a 0a20 2020 2020 2020  ent] = z.       
+0001f050: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f070: 2020 2077 6172 6e69 6e67 2866 2243 6c69     warning(f"Cli
+0001f080: 656e 7420 7b64 6e73 636c 6965 6e74 7d20  ent {dnsclient} 
+0001f090: 6e6f 7420 666f 756e 642e 2053 6b69 7070  not found. Skipp
+0001f0a0: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+0001f0b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f0d0: 2069 6620 646e 7369 7020 6973 204e 6f6e   if dnsip is Non
+0001f0e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001f0f0: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
+0001f100: 4d69 7373 696e 6720 6970 2e20 536b 6970  Missing ip. Skip
+0001f110: 7069 6e67 2122 290a 2020 2020 2020 2020  ping!").        
+0001f120: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001f130: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
+0001f140: 2020 2069 6620 646e 736e 6574 2069 7320     if dnsnet is 
+0001f150: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001f160: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+0001f170: 6728 224d 6973 7369 6e67 206e 6574 2e20  g("Missing net. 
+0001f180: 536b 6970 7069 6e67 2122 290a 2020 2020  Skipping!").    
+0001f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1a0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
+0001f1b0: 2020 2020 2020 207a 2e72 6573 6572 7665         z.reserve
+0001f1c0: 5f64 6e73 286e 616d 653d 646e 7365 6e74  _dns(name=dnsent
+0001f1d0: 7279 2c20 6e65 7473 3d5b 646e 736e 6574  ry, nets=[dnsnet
+0001f1e0: 5d2c 2064 6f6d 6169 6e3d 646e 7364 6f6d  ], domain=dnsdom
+0001f1f0: 6169 6e2c 2069 703d 646e 7369 702c 2061  ain, ip=dnsip, a
+0001f200: 6c69 6173 3d64 6e73 616c 6961 732c 2066  lias=dnsalias, f
+0001f210: 6f72 6365 3d54 7275 652c 0a20 2020 2020  orce=True,.     
+0001f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f230: 2020 2020 2020 2020 2070 7269 6d61 7279           primary
+0001f240: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
+0001f250: 6620 616e 7369 626c 6565 6e74 7269 6573  f ansibleentries
+0001f260: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+0001f270: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0001f280: 2069 6620 6e6f 7420 6e65 7776 6d73 3a0a   if not newvms:.
+0001f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2a0: 7761 726e 696e 6728 2241 6e73 6962 6c65  warning("Ansible
+0001f2b0: 2073 6b69 7070 6564 2061 7320 6e6f 206e   skipped as no n
+0001f2c0: 6577 2076 6d20 7769 7468 696e 2070 6c61  ew vm within pla
+0001f2d0: 7962 6f6f 6b20 7072 6f76 6973 696f 6e65  ybook provisione
+0001f2e0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+0001f2f0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+0001f300: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
+0001f310: 2069 6e20 736f 7274 6564 2861 6e73 6962   in sorted(ansib
+0001f320: 6c65 656e 7472 6965 7329 3a0a 2020 2020  leentries):.    
+0001f330: 2020 2020 2020 2020 2020 2020 5f61 6e73              _ans
+0001f340: 6962 6c65 203d 2065 6e74 7269 6573 5b65  ible = entries[e
+0001f350: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
+0001f360: 2020 2020 2020 6966 2027 706c 6179 626f        if 'playbo
+0001f370: 6f6b 2720 6e6f 7420 696e 205f 616e 7369  ok' not in _ansi
+0001f380: 626c 653a 0a20 2020 2020 2020 2020 2020  ble:.           
+0001f390: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+0001f3a0: 4d69 7373 696e 6720 506c 6179 626f 6f6b  Missing Playbook
+0001f3b0: 2066 6f72 2061 6e73 6962 6c65 2e49 676e   for ansible.Ign
+0001f3c0: 6f72 696e 672e 2e2e 2229 0a20 2020 2020  oring...").     
+0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001f3e0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+0001f3f0: 2020 2020 2020 2020 2020 2070 6c61 7962             playb
+0001f400: 6f6f 6b20 3d20 5f61 6e73 6962 6c65 5b27  ook = _ansible['
+0001f410: 706c 6179 626f 6f6b 275d 0a20 2020 2020  playbook'].     
+0001f420: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
+0001f430: 7365 203d 205f 616e 7369 626c 655b 2776  se = _ansible['v
+0001f440: 6572 626f 7365 275d 2069 6620 2776 6572  erbose'] if 'ver
+0001f450: 626f 7365 2720 696e 205f 616e 7369 626c  bose' in _ansibl
+0001f460: 6520 656c 7365 2046 616c 7365 0a20 2020  e else False.   
+0001f470: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+0001f480: 7570 7320 3d20 5f61 6e73 6962 6c65 2e67  ups = _ansible.g
+0001f490: 6574 2827 6772 6f75 7073 272c 207b 7d29  et('groups', {})
+0001f4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f4b0: 2075 7365 7220 3d20 5f61 6e73 6962 6c65   user = _ansible
+0001f4c0: 2e67 6574 2827 7573 6572 2729 0a20 2020  .get('user').   
+0001f4d0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0001f4e0: 6961 626c 6573 203d 205f 616e 7369 626c  iables = _ansibl
+0001f4f0: 652e 6765 7428 2776 6172 6961 626c 6573  e.get('variables
+0001f500: 272c 207b 7d29 0a20 2020 2020 2020 2020  ', {}).         
+0001f510: 2020 2020 2020 2074 6172 6765 7476 6d73         targetvms
+0001f520: 203d 205b 766d 2066 6f72 2076 6d20 696e   = [vm for vm in
+0001f530: 205f 616e 7369 626c 655b 2776 6d73 275d   _ansible['vms']
+0001f540: 2069 6620 766d 2069 6e20 6e65 7776 6d73   if vm in newvms
+0001f550: 5d20 6966 2027 766d 7327 2069 6e20 5f61  ] if 'vms' in _a
+0001f560: 6e73 6962 6c65 2065 6c73 6520 6e65 7776  nsible else newv
+0001f570: 6d73 0a20 2020 2020 2020 2020 2020 2020  ms.             
+0001f580: 2020 2069 6620 6e6f 7420 7461 7267 6574     if not target
+0001f590: 766d 733a 0a20 2020 2020 2020 2020 2020  vms:.           
+0001f5a0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001f5b0: 2822 416e 7369 626c 6520 736b 6970 7065  ("Ansible skippe
+0001f5c0: 6420 6173 206e 6f20 6e65 7720 766d 2077  d as no new vm w
+0001f5d0: 6974 6869 6e20 706c 6179 626f 6f6b 2070  ithin playbook p
+0001f5e0: 726f 7669 7369 6f6e 6564 2229 0a20 2020  rovisioned").   
+0001f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f600: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+0001f610: 2020 2020 2020 2020 616e 7369 626c 6563          ansiblec
+0001f620: 6f6d 6d61 6e64 203d 2022 616e 7369 626c  ommand = "ansibl
+0001f630: 652d 706c 6179 626f 6f6b 220a 2020 2020  e-playbook".    
+0001f640: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0001f650: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+0001f660: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
+0001f670: 626c 6563 6f6d 6d61 6e64 202b 3d20 2220  blecommand += " 
+0001f680: 2d76 7676 220a 2020 2020 2020 2020 2020  -vvv".          
+0001f690: 2020 2020 2020 696e 7665 6e74 6f72 7966        inventoryf
+0001f6a0: 696c 6520 3d20 6622 2f74 6d70 2f7b 706c  ile = f"/tmp/{pl
+0001f6b0: 616e 7d2e 696e 762e 7961 6d6c 2220 6966  an}.inv.yaml" if
+0001f6c0: 2073 656c 662e 7961 6d6c 696e 7665 6e74   self.yamlinvent
+0001f6d0: 6f72 7920 656c 7365 2066 222f 746d 702f  ory else f"/tmp/
+0001f6e0: 7b70 6c61 6e7d 2e69 6e76 220a 2020 2020  {plan}.inv".    
+0001f6f0: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
+0001f700: 626c 6575 7469 6c73 2e6d 616b 655f 706c  bleutils.make_pl
+0001f710: 616e 5f69 6e76 656e 746f 7279 2876 6d73  an_inventory(vms
+0001f720: 5f74 6f5f 686f 7374 2c20 706c 616e 2c20  _to_host, plan, 
+0001f730: 7461 7267 6574 766d 732c 2067 726f 7570  targetvms, group
+0001f740: 733d 6772 6f75 7073 2c20 7573 6572 3d75  s=groups, user=u
+0001f750: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
+0001f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f780: 2020 2020 2020 7961 6d6c 696e 7665 6e74        yamlinvent
+0001f790: 6f72 793d 7365 6c66 2e79 616d 6c69 6e76  ory=self.yamlinv
+0001f7a0: 656e 746f 7279 2c20 7475 6e6e 656c 3d73  entory, tunnel=s
+0001f7b0: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
+0001f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7e0: 2020 2020 2020 2020 2020 2020 2074 756e               tun
+0001f7f0: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
+0001f800: 6e65 6c68 6f73 742c 2074 756e 6e65 6c75  nelhost, tunnelu
+0001f810: 7365 723d 7365 6c66 2e74 756e 6e65 6c75  ser=self.tunnelu
+0001f820: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
+0001f830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f850: 2020 2020 2020 7475 6e6e 656c 706f 7274        tunnelport
+0001f860: 3d73 656c 662e 7475 6e6e 656c 706f 7274  =self.tunnelport
+0001f870: 2c20 696e 7365 6375 7265 3d73 656c 662e  , insecure=self.
+0001f880: 696e 7365 6375 7265 290a 2020 2020 2020  insecure).      
+0001f890: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0001f8a0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0001f8b0: 277e 2f2e 616e 7369 626c 652e 6366 6727  '~/.ansible.cfg'
+0001f8c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001f8d0: 2020 2020 2020 2061 6e73 6962 6c65 636f         ansibleco
+0001f8e0: 6e66 6967 203d 206f 732e 7061 7468 2e65  nfig = os.path.e
+0001f8f0: 7870 616e 6475 7365 7228 277e 2f2e 616e  xpanduser('~/.an
+0001f900: 7369 626c 652e 6366 6727 290a 2020 2020  sible.cfg').    
+0001f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f920: 7769 7468 206f 7065 6e28 616e 7369 626c  with open(ansibl
+0001f930: 6563 6f6e 6669 672c 2022 7722 2920 6173  econfig, "w") as
+0001f940: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+0001f950: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0001f960: 6974 6528 225b 7373 685f 636f 6e6e 6563  ite("[ssh_connec
+0001f970: 7469 6f6e 5d5c 6e72 6574 7269 6573 3d31  tion]\nretries=1
+0001f980: 305c 6e22 290a 2020 2020 2020 2020 2020  0\n").          
+0001f990: 2020 2020 2020 6966 2076 6172 6961 626c        if variabl
+0001f9a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001f9b0: 2020 2020 2020 2020 7661 7273 6669 6c65          varsfile
+0001f9c0: 203d 2066 222f 746d 702f 7b70 6c61 6e7d   = f"/tmp/{plan}
+0001f9d0: 2e76 6172 732e 796d 6c22 0a20 2020 2020  .vars.yml".     
+0001f9e0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001f9f0: 6974 6820 6f70 656e 2876 6172 7366 696c  ith open(varsfil
+0001fa00: 652c 2027 7727 2920 6173 2066 3a0a 2020  e, 'w') as f:.  
+0001fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa20: 2020 2020 2020 7961 6d6c 2e64 756d 7028        yaml.dump(
+0001fa30: 7661 7269 6162 6c65 732c 2066 2c20 6465  variables, f, de
+0001fa40: 6661 756c 745f 666c 6f77 5f73 7479 6c65  fault_flow_style
+0001fa50: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0001fa60: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
+0001fa70: 626c 6563 6f6d 6d61 6e64 202b 3d20 6622  blecommand += f"
+0001fa80: 202d 2d65 7874 7261 2d76 6172 7320 407b   --extra-vars @{
+0001fa90: 7661 7273 6669 6c65 7d22 0a20 2020 2020  varsfile}".     
+0001faa0: 2020 2020 2020 2020 2020 2061 6e73 6962             ansib
+0001fab0: 6c65 636f 6d6d 616e 6420 2b3d 2066 2220  lecommand += f" 
+0001fac0: 2d69 207b 696e 7665 6e74 6f72 7966 696c  -i {inventoryfil
+0001fad0: 657d 207b 706c 6179 626f 6f6b 7d22 0a20  e} {playbook}". 
+0001fae0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001faf0: 7072 696e 7428 6622 5275 6e6e 696e 673a  print(f"Running:
+0001fb00: 207b 616e 7369 626c 6563 6f6d 6d61 6e64   {ansiblecommand
+0001fb10: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001fb20: 2020 2020 6f73 2e73 7973 7465 6d28 616e      os.system(an
+0001fb30: 7369 626c 6563 6f6d 6d61 6e64 290a 2020  siblecommand).  
+0001fb40: 2020 2020 2020 6966 2061 6e73 6962 6c65        if ansible
+0001fb50: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+0001fb60: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0001fb70: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
+0001fb80: 6e67 2041 6e73 6962 6c65 2049 6e76 656e  ng Ansible Inven
+0001fb90: 746f 7279 2e2e 2e22 290a 2020 2020 2020  tory...").      
+0001fba0: 2020 2020 2020 696e 7665 6e74 6f72 7966        inventoryf
+0001fbb0: 696c 6520 3d20 6622 2f74 6d70 2f7b 706c  ile = f"/tmp/{pl
+0001fbc0: 616e 7d2e 696e 762e 7961 6d6c 2220 6966  an}.inv.yaml" if
+0001fbd0: 2073 656c 662e 7961 6d6c 696e 7665 6e74   self.yamlinvent
+0001fbe0: 6f72 7920 656c 7365 2066 222f 746d 702f  ory else f"/tmp/
+0001fbf0: 7b70 6c61 6e7d 2e69 6e76 220a 2020 2020  {plan}.inv".    
+0001fc00: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+0001fc10: 7468 2e65 7869 7374 7328 696e 7665 6e74  th.exists(invent
+0001fc20: 6f72 7966 696c 6529 3a0a 2020 2020 2020  oryfile):.      
+0001fc30: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001fc40: 2866 2249 6e76 656e 746f 7279 2069 6e20  (f"Inventory in 
+0001fc50: 7b69 6e76 656e 746f 7279 6669 6c65 7d20  {inventoryfile} 
+0001fc60: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
+0001fc70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001fc80: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001fc90: 696e 7428 6622 4372 6561 7469 6e67 2061  int(f"Creating a
+0001fca0: 6e73 6962 6c65 2069 6e76 656e 746f 7279  nsible inventory
+0001fcb0: 2066 6f72 2070 6c61 6e20 7b70 6c61 6e7d   for plan {plan}
+0001fcc0: 2069 6e20 7b69 6e76 656e 746f 7279 6669   in {inventoryfi
+0001fcd0: 6c65 7d22 290a 2020 2020 2020 2020 2020  le}").          
+0001fce0: 2020 2020 2020 766d 7320 3d20 5b5d 0a20        vms = []. 
+0001fcf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001fd00: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
+0001fd10: 6b2e 6c69 7374 2829 2c20 6b65 793d 6c61  k.list(), key=la
+0001fd20: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
+0001fd30: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0001fd40: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
+0001fd50: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
+0001fd60: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0001fd70: 7363 7269 7074 696f 6e20 3d20 766d 5b27  scription = vm['
+0001fd80: 706c 616e 275d 0a20 2020 2020 2020 2020  plan'].         
+0001fd90: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+0001fda0: 7363 7269 7074 696f 6e20 3d3d 2070 6c61  scription == pla
+0001fdb0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+0001fdc0: 2020 2020 2020 2020 2020 2076 6d73 2e61             vms.a
+0001fdd0: 7070 656e 6428 6e61 6d65 290a 2020 2020  ppend(name).    
+0001fde0: 2020 2020 2020 2020 2020 2020 616e 7369              ansi
+0001fdf0: 626c 6575 7469 6c73 2e6d 616b 655f 706c  bleutils.make_pl
+0001fe00: 616e 5f69 6e76 656e 746f 7279 2876 6d73  an_inventory(vms
+0001fe10: 5f74 6f5f 686f 7374 2c20 706c 616e 2c20  _to_host, plan, 
+0001fe20: 766d 732c 2079 616d 6c69 6e76 656e 746f  vms, yamlinvento
+0001fe30: 7279 3d73 656c 662e 7961 6d6c 696e 7665  ry=self.yamlinve
+0001fe40: 6e74 6f72 792c 0a20 2020 2020 2020 2020  ntory,.         
+0001fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe70: 2020 2020 2020 2020 696e 7365 6375 7265          insecure
+0001fe80: 3d73 656c 662e 696e 7365 6375 7265 290a  =self.insecure).
+0001fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fea0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+0001feb0: 3a20 2773 7563 6365 7373 272c 2027 706c  : 'success', 'pl
+0001fec0: 616e 273a 2070 6c61 6e7d 0a20 2020 2020  an': plan}.     
+0001fed0: 2020 2069 6620 6c62 7320 616e 6420 6e6f     if lbs and no
+0001fee0: 7420 6f6e 6c79 6173 7365 7473 3a0a 2020  t onlyassets:.  
+0001fef0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
+0001ff00: 656e 7473 203d 207b 7d0a 2020 2020 2020  ents = {}.      
+0001ff10: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+0001ff20: 706c 6f79 696e 6720 4c6f 6164 6261 6c61  ploying Loadbala
+0001ff30: 6e63 6572 732e 2e2e 2229 0a20 2020 2020  ncers...").     
+0001ff40: 2020 2020 2020 2066 6f72 2069 6e64 6578         for index
+0001ff50: 2c20 6c62 656e 7472 7920 696e 2065 6e75  , lbentry in enu
+0001ff60: 6d65 7261 7465 286c 6273 293a 0a20 2020  merate(lbs):.   
+0001ff70: 2020 2020 2020 2020 2020 2020 2064 6574               det
+0001ff80: 6169 6c73 203d 2065 6e74 7269 6573 5b6c  ails = entries[l
+0001ff90: 6265 6e74 7279 5d0a 2020 2020 2020 2020  bentry].        
+0001ffa0: 2020 2020 2020 2020 706f 7274 7320 3d20          ports = 
+0001ffb0: 6465 7461 696c 732e 6765 7428 2770 6f72  details.get('por
+0001ffc0: 7473 272c 205b 5d29 0a20 2020 2020 2020  ts', []).       
+0001ffd0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001ffe0: 706f 7274 733a 0a20 2020 2020 2020 2020  ports:.         
+0001fff0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00020000: 2822 4d69 7373 696e 6720 506f 7274 7320  ("Missing Ports 
+00020010: 666f 7220 6c6f 6164 6261 6c61 6e63 6572  for loadbalancer
+00020020: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
+00020030: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
+00020040: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00020050: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00020060: 2020 6368 6563 6b70 6174 6820 3d20 6465    checkpath = de
+00020070: 7461 696c 732e 6765 7428 2763 6865 636b  tails.get('check
+00020080: 7061 7468 272c 2027 2f27 290a 2020 2020  path', '/').    
+00020090: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+000200a0: 6b70 6f72 7420 3d20 6465 7461 696c 732e  kport = details.
+000200b0: 6765 7428 2763 6865 636b 706f 7274 272c  get('checkport',
+000200c0: 2038 3029 0a20 2020 2020 2020 2020 2020   80).           
+000200d0: 2020 2020 2061 6c69 6173 203d 2064 6574       alias = det
+000200e0: 6169 6c73 2e67 6574 2827 616c 6961 7327  ails.get('alias'
+000200f0: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
+00020100: 2020 2020 2020 646f 6d61 696e 203d 2064        domain = d
+00020110: 6574 6169 6c73 2e67 6574 2827 646f 6d61  etails.get('doma
+00020120: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
+00020130: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
+00020140: 2064 6574 6169 6c73 2e67 6574 2827 646e   details.get('dn
+00020150: 7363 6c69 656e 7427 2c20 6f76 6572 7269  sclient', overri
+00020160: 6465 732e 6765 7428 2764 6e73 636c 6965  des.get('dnsclie
+00020170: 6e74 2729 290a 2020 2020 2020 2020 2020  nt')).          
+00020180: 2020 2020 2020 6c62 766d 7320 3d20 6465        lbvms = de
+00020190: 7461 696c 732e 6765 7428 2776 6d73 272c  tails.get('vms',
+000201a0: 205b 5d29 0a20 2020 2020 2020 2020 2020   []).           
+000201b0: 2020 2020 206c 626e 6574 7320 3d20 6465       lbnets = de
+000201c0: 7461 696c 732e 6765 7428 276e 6574 7327  tails.get('nets'
+000201d0: 2c20 5b27 6465 6661 756c 7427 5d29 0a20  , ['default']). 
+000201e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000201f0: 6e74 6572 6e61 6c20 3d20 6465 7461 696c  nternal = detail
+00020200: 732e 6765 7428 2769 6e74 6572 6e61 6c27  s.get('internal'
+00020210: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020220: 2020 7375 626e 6574 6964 203d 2064 6574    subnetid = det
+00020230: 6169 6c73 2e67 6574 2827 7375 626e 6574  ails.get('subnet
+00020240: 6964 2729 0a20 2020 2020 2020 2020 2020  id').           
+00020250: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+00020260: 5f6c 6f61 6462 616c 616e 6365 7228 6c62  _loadbalancer(lb
+00020270: 656e 7472 792c 206e 6574 733d 6c62 6e65  entry, nets=lbne
+00020280: 7473 2c20 706f 7274 733d 706f 7274 732c  ts, ports=ports,
+00020290: 2063 6865 636b 7061 7468 3d63 6865 636b   checkpath=check
+000202a0: 7061 7468 2c20 766d 733d 6c62 766d 732c  path, vms=lbvms,
+000202b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000202c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202d0: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
+000202e0: 3d64 6f6d 6169 6e2c 2070 6c61 6e3d 706c  =domain, plan=pl
+000202f0: 616e 2c20 6368 6563 6b70 6f72 743d 6368  an, checkport=ch
+00020300: 6563 6b70 6f72 742c 2061 6c69 6173 3d61  eckport, alias=a
+00020310: 6c69 6173 2c0a 2020 2020 2020 2020 2020  lias,.          
+00020320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020330: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020340: 6e74 6572 6e61 6c3d 696e 7465 726e 616c  nternal=internal
+00020350: 2c20 646e 7363 6c69 656e 743d 646e 7363  , dnsclient=dnsc
+00020360: 6c69 656e 742c 2073 7562 6e65 7469 643d  lient, subnetid=
+00020370: 7375 626e 6574 6964 290a 2020 2020 2020  subnetid).      
+00020380: 2020 6966 2073 6773 2061 6e64 206e 6f74    if sgs and not
+00020390: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+000203a0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+000203b0: 2244 6570 6c6f 7969 6e67 2053 6563 7572  "Deploying Secur
+000203c0: 6974 7947 726f 7570 732e 2e2e 2229 0a20  ityGroups..."). 
+000203d0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+000203e0: 6720 696e 2073 6773 3a0a 2020 2020 2020  g in sgs:.      
+000203f0: 2020 2020 2020 2020 2020 6465 7461 696c            detail
+00020400: 7320 3d20 656e 7472 6965 735b 7367 5d0a  s = entries[sg].
+00020410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020420: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+00020430: 2020 2020 2070 6f72 7473 203d 2064 6574       ports = det
+00020440: 6169 6c73 2e67 6574 2827 706f 7274 7327  ails.get('ports'
+00020450: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
+00020460: 2020 2020 2020 6966 206e 6f74 2070 6f72        if not por
+00020470: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00020480: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
+00020490: 6973 7369 6e67 2050 6f72 7473 2066 6f72  issing Ports for
+000204a0: 2073 6773 2e20 4e6f 7420 6372 6561 7469   sgs. Not creati
+000204b0: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
+000204c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000204d0: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
+000204e0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+000204f0: 655f 7365 6375 7269 7479 5f67 726f 7570  e_security_group
+00020500: 2873 672c 207b 2770 6f72 7473 273a 2070  (sg, {'ports': p
+00020510: 6f72 7473 7d29 0a20 2020 2020 2020 2069  orts}).        i
+00020520: 6620 776f 726b 666c 6f77 656e 7472 6965  f workflowentrie
+00020530: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
+00020540: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
+00020550: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
+00020560: 696e 6720 576f 726b 666c 6f77 2045 6e74  ing Workflow Ent
+00020570: 7269 6573 2e2e 2e22 290a 2020 2020 2020  ries...").      
+00020580: 2020 2020 2020 666f 7220 776f 726b 666c        for workfl
+00020590: 6f77 2069 6e20 776f 726b 666c 6f77 656e  ow in workflowen
+000205a0: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
+000205b0: 2020 2020 2020 2077 6f72 6b66 6c6f 775f         workflow_
+000205c0: 6f76 6572 7269 6465 7320 3d20 6f76 6572  overrides = over
+000205d0: 7269 6465 732e 636f 7079 2829 0a20 2020  rides.copy().   
+000205e0: 2020 2020 2020 2020 2020 2020 2077 6f72               wor
+000205f0: 6b66 6c6f 775f 6f76 6572 7269 6465 732e  kflow_overrides.
+00020600: 7570 6461 7465 2865 6e74 7269 6573 5b77  update(entries[w
+00020610: 6f72 6b66 6c6f 775d 290a 2020 2020 2020  orkflow]).      
+00020620: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00020630: 7265 6174 655f 776f 726b 666c 6f77 2877  reate_workflow(w
+00020640: 6f72 6b66 6c6f 772c 206f 7665 7272 6964  orkflow, overrid
+00020650: 6573 3d77 6f72 6b66 6c6f 775f 6f76 6572  es=workflow_over
+00020660: 7269 6465 7329 0a20 2020 2020 2020 2072  rides).        r
+00020670: 6574 7572 6e64 6174 6120 3d20 7b27 7265  eturndata = {'re
+00020680: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+00020690: 2c20 2770 6c61 6e27 3a20 706c 616e 7d0a  , 'plan': plan}.
+000206a0: 2020 2020 2020 2020 7265 7475 726e 6461          returnda
+000206b0: 7461 5b27 6e65 7776 6d73 275d 203d 206e  ta['newvms'] = n
+000206c0: 6577 766d 7320 6966 206e 6577 766d 7320  ewvms if newvms 
+000206d0: 656c 7365 205b 5d0a 2020 2020 2020 2020  else [].        
+000206e0: 7265 7475 726e 6461 7461 5b27 6578 6973  returndata['exis
+000206f0: 7469 6e67 766d 7327 5d20 3d20 6578 6973  tingvms'] = exis
+00020700: 7469 6e67 766d 7320 6966 2065 7869 7374  tingvms if exist
+00020710: 696e 6776 6d73 2065 6c73 6520 5b5d 0a20  ingvms else []. 
+00020720: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
+00020730: 615b 2766 6169 6c65 6476 6d73 275d 203d  a['failedvms'] =
+00020740: 2066 6169 6c65 6476 6d73 2069 6620 6661   failedvms if fa
+00020750: 696c 6564 766d 7320 656c 7365 205b 5d0a  iledvms else [].
+00020760: 2020 2020 2020 2020 7265 7475 726e 6461          returnda
+00020770: 7461 5b27 6173 7365 7473 275d 203d 206e  ta['assets'] = n
+00020780: 6577 6173 7365 7473 2069 6620 6e65 7761  ewassets if newa
+00020790: 7373 6574 7320 656c 7365 205b 5d0a 2020  ssets else [].  
+000207a0: 2020 2020 2020 6966 2066 6169 6c65 6476        if failedv
+000207b0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+000207c0: 7265 7475 726e 6461 7461 5b27 7265 7375  returndata['resu
+000207d0: 6c74 275d 203d 2027 6661 696c 7572 6527  lt'] = 'failure'
+000207e0: 0a20 2020 2020 2020 2020 2020 2066 6169  .            fai
+000207f0: 6c65 646e 616d 6573 203d 2027 2c27 2e6a  lednames = ','.j
+00020800: 6f69 6e28 5b76 5b27 6e61 6d65 275d 2066  oin([v['name'] f
+00020810: 6f72 2076 2069 6e20 6661 696c 6564 766d  or v in failedvm
+00020820: 735d 290a 2020 2020 2020 2020 2020 2020  s]).            
+00020830: 7265 7475 726e 6461 7461 5b27 7265 6173  returndata['reas
+00020840: 6f6e 275d 203d 2066 2754 6865 2066 6f6c  on'] = f'The fol
+00020850: 6c6f 7769 6e67 2076 6d73 2066 6169 6c65  lowing vms faile
+00020860: 643a 207b 6661 696c 6564 6e61 6d65 737d  d: {failednames}
+00020870: 270a 2020 2020 2020 2020 6966 2067 6574  '.        if get
+00020880: 6261 636b 206f 7220 746f 636c 6561 6e3a  back or toclean:
+00020890: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+000208a0: 6368 6469 7228 272e 2e27 290a 2020 2020  chdir('..').    
+000208b0: 2020 2020 6966 2074 6f63 6c65 616e 3a0a      if toclean:.
+000208c0: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
+000208d0: 6565 2870 6174 6829 0a20 2020 2020 2020  ee(path).       
+000208e0: 2069 6620 696e 7075 7473 7472 696e 6720   if inputstring 
+000208f0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00020900: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+00020910: 2274 656d 705f 706c 616e 5f7b 706c 616e  "temp_plan_{plan
+00020920: 7d2e 796d 6c22 293a 0a20 2020 2020 2020  }.yml"):.       
+00020930: 2020 2020 206f 732e 7265 6d6f 7665 2866       os.remove(f
+00020940: 2274 656d 705f 706c 616e 5f7b 706c 616e  "temp_plan_{plan
+00020950: 7d2e 796d 6c22 290a 2020 2020 2020 2020  }.yml").        
+00020960: 666f 7220 656e 7472 7920 696e 2061 7379  for entry in asy
+00020970: 6e63 7761 6974 766d 733a 0a20 2020 2020  ncwaitvms:.     
+00020980: 2020 2020 2020 206e 616d 652c 2066 696e         name, fin
+00020990: 6973 6866 696c 6573 203d 2065 6e74 7279  ishfiles = entry
+000209a0: 5b27 6e61 6d65 275d 2c20 656e 7472 795b  ['name'], entry[
+000209b0: 2766 696e 6973 6866 696c 6573 275d 0a20  'finishfiles']. 
+000209c0: 2020 2020 2020 2020 2020 2077 6169 7463             waitc
+000209d0: 6f6d 6d61 6e64 2c20 7761 6974 7469 6d65  ommand, waittime
+000209e0: 6f75 7420 3d20 656e 7472 795b 2777 6169  out = entry['wai
+000209f0: 7463 6f6d 6d61 6e64 275d 2c20 656e 7472  tcommand'], entr
+00020a00: 795b 2777 6169 7474 696d 656f 7574 275d  y['waittimeout']
+00020a10: 0a20 2020 2020 2020 2020 2020 2076 6d63  .            vmc
+00020a20: 6c69 656e 7420 3d20 656e 7472 795b 2776  lient = entry['v
+00020a30: 6d63 6c69 656e 7427 5d0a 2020 2020 2020  mclient'].      
+00020a40: 2020 2020 2020 7365 6c66 2e77 6169 745f        self.wait_
+00020a50: 6669 6e69 7368 286e 616d 652c 2077 6169  finish(name, wai
+00020a60: 7463 6f6d 6d61 6e64 3d77 6169 7463 6f6d  tcommand=waitcom
+00020a70: 6d61 6e64 2c20 7761 6974 7469 6d65 6f75  mand, waittimeou
+00020a80: 743d 7761 6974 7469 6d65 6f75 742c 2076  t=waittimeout, v
+00020a90: 6d63 6c69 656e 743d 766d 636c 6965 6e74  mclient=vmclient
+00020aa0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00020ab0: 2066 696e 6973 6866 696c 6573 3a0a 2020   finishfiles:.  
+00020ac0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00020ad0: 6c66 2e68 616e 646c 655f 6669 6e69 7368  lf.handle_finish
+00020ae0: 6669 6c65 7328 6e61 6d65 2c20 6669 6e69  files(name, fini
+00020af0: 7368 6669 6c65 732c 2076 6d63 6c69 656e  shfiles, vmclien
+00020b00: 743d 766d 636c 6965 6e74 290a 2020 2020  t=vmclient).    
+00020b10: 2020 2020 706f 7374 5f73 6372 6970 7420      post_script 
+00020b20: 3d20 6627 7b69 6e70 7574 6469 727d 2f6b  = f'{inputdir}/k
+00020b30: 636c 695f 706f 7374 2e73 6827 0a20 2020  cli_post.sh'.   
+00020b40: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00020b50: 6578 6973 7473 2870 6f73 745f 7363 7269  exists(post_scri
+00020b60: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
+00020b70: 2069 6620 706f 7374 3a0a 2020 2020 2020   if post:.      
+00020b80: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00020b90: 2822 5275 6e6e 696e 6720 6b63 6c69 5f70  ("Running kcli_p
+00020ba0: 6f73 742e 7368 2229 0a20 2020 2020 2020  ost.sh").       
+00020bb0: 2020 2020 2020 2020 2077 6974 6820 5465           with Te
+00020bc0: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
+00020bd0: 2829 2061 7320 746d 7064 6972 3a0a 2020  () as tmpdir:.  
+00020be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bf0: 2020 706f 7374 5f73 6372 6970 7420 3d20    post_script = 
+00020c00: 7365 6c66 2e70 726f 6365 7373 5f69 6e70  self.process_inp
+00020c10: 7574 6669 6c65 2827 7878 7827 2c20 706f  utfile('xxx', po
+00020c20: 7374 5f73 6372 6970 742c 206f 7665 7272  st_script, overr
+00020c30: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00020c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c50: 2020 2020 7769 7468 206f 7065 6e28 6622      with open(f"
+00020c60: 7b74 6d70 6469 727d 2f70 6f73 742e 7368  {tmpdir}/post.sh
+00020c70: 222c 2027 7727 2920 6173 2066 3a0a 2020  ", 'w') as f:.  
+00020c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c90: 2020 2020 2020 662e 7772 6974 6528 706f        f.write(po
+00020ca0: 7374 5f73 6372 6970 7429 0a20 2020 2020  st_script).     
+00020cb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00020cc0: 6f73 745f 7275 6e20 3d20 7275 6e28 6627  ost_run = run(f'
+00020cd0: 6261 7368 207b 746d 7064 6972 7d2f 706f  bash {tmpdir}/po
+00020ce0: 7374 2e73 6827 2c20 7368 656c 6c3d 5472  st.sh', shell=Tr
+00020cf0: 7565 2c20 7374 646f 7574 3d50 4950 452c  ue, stdout=PIPE,
+00020d00: 2073 7464 6572 723d 5354 444f 5554 2c0a   stderr=STDOUT,.
+00020d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d30: 2020 2075 6e69 7665 7273 616c 5f6e 6577     universal_new
+00020d40: 6c69 6e65 733d 5472 7565 290a 2020 2020  lines=True).    
+00020d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d60: 6966 2070 6f73 745f 7275 6e2e 7265 7475  if post_run.retu
+00020d70: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
+00020d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d90: 2020 2020 206d 7367 203d 2066 2249 7373       msg = f"Iss
+00020da0: 7565 2077 6865 6e20 7275 6e6e 696e 6720  ue when running 
+00020db0: 6b63 6c69 5f70 6f73 742e 7368 203a 5c6e  kcli_post.sh :\n
+00020dc0: 7b70 6f73 745f 7275 6e2e 7374 646f 7574  {post_run.stdout
+00020dd0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00020de0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00020df0: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+00020e00: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00020e10: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00020e20: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+00020e30: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
+00020e40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00020e50: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00020e60: 696e 6728 2253 6b69 7070 696e 6720 6b63  ing("Skipping kc
+00020e70: 6c69 5f70 6f73 742e 7368 2061 7320 7265  li_post.sh as re
+00020e80: 7175 6573 7465 6422 290a 2020 2020 2020  quested").      
+00020e90: 2020 6966 206f 7665 7272 6964 6573 2e67    if overrides.g
+00020ea0: 6574 2827 7465 6d70 6b65 7964 6972 2729  et('tempkeydir')
+00020eb0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00020ec0: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
+00020ed0: 6465 732e 6765 7428 2774 656d 706b 6579  des.get('tempkey
+00020ee0: 6469 7227 292e 636c 6561 6e75 7028 290a  dir').cleanup().
+00020ef0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00020f00: 6574 7572 6e64 6174 610a 0a20 2020 2064  eturndata..    d
+00020f10: 6566 2068 616e 646c 655f 686f 7374 2873  ef handle_host(s
+00020f20: 656c 662c 2070 6f6f 6c3d 4e6f 6e65 2c20  elf, pool=None, 
+00020f30: 696d 6167 653d 4e6f 6e65 2c20 7377 6974  image=None, swit
+00020f40: 6368 3d4e 6f6e 652c 2064 6f77 6e6c 6f61  ch=None, downloa
+00020f50: 643d 4661 6c73 652c 0a20 2020 2020 2020  d=False,.       
+00020f60: 2020 2020 2020 2020 2020 2020 2075 726c               url
+00020f70: 3d4e 6f6e 652c 2063 6d64 3d4e 6f6e 652c  =None, cmd=None,
+00020f80: 2073 796e 633d 4661 6c73 652c 2073 697a   sync=False, siz
+00020f90: 653d 4e6f 6e65 2c20 6172 6368 3d27 7838  e=None, arch='x8
+00020fa0: 365f 3634 272c 0a20 2020 2020 2020 2020  6_64',.         
+00020fb0: 2020 2020 2020 2020 2020 206b 766d 5f6f             kvm_o
+00020fc0: 7065 6e73 7461 636b 3d54 7275 652c 2072  penstack=True, r
+00020fd0: 6863 6f73 5f63 6f6d 6d69 743d 4e6f 6e65  hcos_commit=None
+00020fe0: 2c20 7268 636f 735f 696e 7374 616c 6c65  , rhcos_installe
+00020ff0: 723d 4661 6c73 6529 3a0a 2020 2020 2020  r=False):.      
+00021000: 2020 6966 2064 6f77 6e6c 6f61 643a 0a20    if download:. 
+00021010: 2020 2020 2020 2020 2020 206b 203d 2073             k = s
+00021020: 656c 662e 6b0a 2020 2020 2020 2020 2020  elf.k.          
+00021030: 2020 6966 2070 6f6f 6c20 6973 204e 6f6e    if pool is Non
+00021040: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00021050: 2020 2070 6f6f 6c20 3d20 7365 6c66 2e70     pool = self.p
+00021060: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+00021070: 2020 2020 7070 7269 6e74 2866 2255 7369      pprint(f"Usi
+00021080: 6e67 2070 6f6f 6c20 7b70 6f6f 6c7d 2229  ng pool {pool}")
+00021090: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000210a0: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+000210b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000210c0: 2020 2069 6620 7572 6c20 6973 204e 6f6e     if url is Non
+000210d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000210e0: 2020 2020 2020 2069 6620 6172 6368 2021         if arch !
+000210f0: 3d20 2778 3836 5f36 3427 3a0a 2020 2020  = 'x86_64':.    
+00021100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021110: 2020 2020 494d 4147 4553 2e75 7064 6174      IMAGES.updat
+00021120: 6528 7b69 3a20 494d 4147 4553 5b69 5d2e  e({i: IMAGES[i].
+00021130: 7265 706c 6163 6528 2778 3836 5f36 3427  replace('x86_64'
+00021140: 2c20 6172 6368 292e 7265 706c 6163 6528  , arch).replace(
+00021150: 2761 6d64 3634 272c 2061 7263 6829 0a20  'amd64', arch). 
+00021160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021180: 2020 2020 2020 666f 7220 6920 696e 2049        for i in I
+00021190: 4d41 4745 537d 290a 2020 2020 2020 2020  MAGES}).        
+000211a0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000211b0: 6d61 6765 206e 6f74 2069 6e20 494d 4147  mage not in IMAG
+000211c0: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
+000211d0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000211e0: 7228 6622 496d 6167 6520 7b69 6d61 6765  r(f"Image {image
+000211f0: 7d20 6861 7320 6e6f 2061 7373 6f63 6961  } has no associa
+00021200: 7465 6420 7572 6c22 290a 2020 2020 2020  ted url").      
+00021210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021220: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+00021230: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+00021240: 7265 6173 6f6e 273a 2022 496e 636f 7272  reason': "Incorr
+00021250: 6563 7420 696d 6167 6522 7d0a 2020 2020  ect image"}.    
+00021260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021270: 7572 6c20 3d20 494d 4147 4553 5b69 6d61  url = IMAGES[ima
+00021280: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
+00021290: 2020 2020 2020 2020 696d 6167 655f 7479          image_ty
+000212a0: 7065 203d 2027 6f70 656e 7374 6163 6b27  pe = 'openstack'
+000212b0: 2069 6620 6b76 6d5f 6f70 656e 7374 6163   if kvm_openstac
+000212c0: 6b20 616e 6420 7365 6c66 2e74 7970 6520  k and self.type 
+000212d0: 3d3d 2027 6b76 6d27 2065 6c73 6520 7365  == 'kvm' else se
+000212e0: 6c66 2e74 7970 650a 2020 2020 2020 2020  lf.type.        
+000212f0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00021300: 6f74 206b 766d 5f6f 7065 6e73 7461 636b  ot kvm_openstack
+00021310: 2061 6e64 2073 656c 662e 7479 7065 203d   and self.type =
+00021320: 3d20 276b 766d 273a 0a20 2020 2020 2020  = 'kvm':.       
+00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021340: 2069 6d61 6765 202b 3d20 222d 7165 6d75   image += "-qemu
+00021350: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00021360: 2020 2020 2020 6966 2027 7268 636f 7327        if 'rhcos'
+00021370: 2069 6e20 696d 6167 6520 616e 6420 6e6f   in image and no
+00021380: 7420 696d 6167 652e 656e 6473 7769 7468  t image.endswith
+00021390: 2827 7163 6f77 322e 677a 2729 3a0a 2020  ('qcow2.gz'):.  
+000213a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000213b0: 2020 2020 2020 6966 2072 6863 6f73 5f63        if rhcos_c
+000213c0: 6f6d 6d69 7420 6973 206e 6f74 204e 6f6e  ommit is not Non
+000213d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000213e0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000213f0: 726c 203d 2063 6f6d 6d6f 6e2e 6765 745f  rl = common.get_
+00021400: 636f 6d6d 6974 5f72 6863 6f73 2872 6863  commit_rhcos(rhc
+00021410: 6f73 5f63 6f6d 6d69 742c 205f 7479 7065  os_commit, _type
+00021420: 3d69 6d61 6765 5f74 7970 6529 0a20 2020  =image_type).   
+00021430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021440: 2020 2020 2065 6c69 6620 7268 636f 735f       elif rhcos_
+00021450: 696e 7374 616c 6c65 723a 0a20 2020 2020  installer:.     
+00021460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021470: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
+00021480: 6e5b 2750 4154 4827 5d20 2b3d 2066 273a  n['PATH'] += f':
+00021490: 7b6f 732e 6765 7463 7764 2829 7d27 0a20  {os.getcwd()}'. 
+000214a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214b0: 2020 2020 2020 2020 2020 2075 726c 203d             url =
+000214c0: 2063 6f6d 6d6f 6e2e 6765 745f 696e 7374   common.get_inst
+000214d0: 616c 6c65 725f 7268 636f 7328 5f74 7970  aller_rhcos(_typ
+000214e0: 653d 696d 6167 655f 7479 7065 2c20 6172  e=image_type, ar
+000214f0: 6368 3d61 7263 6829 0a20 2020 2020 2020  ch=arch).       
+00021500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021510: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
 00021520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021530: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00021540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021550: 2020 2020 2020 2020 2020 6966 2061 7263            if arc
-00021560: 6820 213d 2027 7838 365f 3634 273a 0a20  h != 'x86_64':. 
-00021570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021580: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00021590: 726c 202b 3d20 6627 2d7b 6172 6368 7d27  rl += f'-{arch}'
-000215a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000215b0: 2020 2020 2020 2020 2020 2020 2075 726c               url
-000215c0: 203d 2063 6f6d 6d6f 6e2e 6765 745f 6c61   = common.get_la
-000215d0: 7465 7374 5f72 6863 6f73 2875 726c 2c20  test_rhcos(url, 
-000215e0: 5f74 7970 653d 696d 6167 655f 7479 7065  _type=image_type
-000215f0: 2c20 6172 6368 3d61 7263 6829 0a20 2020  , arch=arch).   
+00021530: 2020 2069 6620 6172 6368 2021 3d20 2778     if arch != 'x
+00021540: 3836 5f36 3427 3a0a 2020 2020 2020 2020  86_64':.        
+00021550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021560: 2020 2020 2020 2020 7572 6c20 2b3d 2066          url += f
+00021570: 272d 7b61 7263 687d 270a 2020 2020 2020  '-{arch}'.      
+00021580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021590: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
+000215a0: 6f6e 2e67 6574 5f6c 6174 6573 745f 7268  on.get_latest_rh
+000215b0: 636f 7328 7572 6c2c 205f 7479 7065 3d69  cos(url, _type=i
+000215c0: 6d61 6765 5f74 7970 652c 2061 7263 683d  mage_type, arch=
+000215d0: 6172 6368 290a 2020 2020 2020 2020 2020  arch).          
+000215e0: 2020 2020 2020 2020 2020 6966 2027 6663            if 'fc
+000215f0: 6f73 2720 696e 2069 6d61 6765 3a0a 2020  os' in image:.  
 00021600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021610: 2069 6620 2766 636f 7327 2069 6e20 696d   if 'fcos' in im
-00021620: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
-00021630: 2020 2020 2020 2020 2020 2020 2075 726c               url
-00021640: 203d 2063 6f6d 6d6f 6e2e 6765 745f 6c61   = common.get_la
-00021650: 7465 7374 5f66 636f 7328 7572 6c2c 205f  test_fcos(url, _
-00021660: 7479 7065 3d69 6d61 6765 5f74 7970 6529  type=image_type)
-00021670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021680: 2020 2020 2069 6620 696d 6167 6520 3d3d       if image ==
-00021690: 2027 6665 646f 7261 6c61 7465 7374 273a   'fedoralatest':
-000216a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000216b0: 2020 2020 2020 2020 2075 726c 203d 2063           url = c
-000216c0: 6f6d 6d6f 6e2e 6765 745f 6c61 7465 7374  ommon.get_latest
-000216d0: 5f66 6564 6f72 6128 7572 6c29 0a20 2020  _fedora(url).   
-000216e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216f0: 2069 6d61 6765 203d 206f 732e 7061 7468   image = os.path
-00021700: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
-00021710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021720: 2020 2020 2069 6620 696d 6167 652e 7374       if image.st
-00021730: 6172 7473 7769 7468 2827 7268 656c 2729  artswith('rhel')
-00021740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021750: 2020 2020 2020 2020 2020 6966 2027 7765            if 'we
-00021760: 6227 2069 6e20 7379 732e 6172 6776 5b30  b' in sys.argv[0
-00021770: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00021780: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021790: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-000217a0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-000217b0: 736f 6e27 3a20 224d 6973 7369 6e67 2075  son': "Missing u
-000217c0: 726c 227d 0a20 2020 2020 2020 2020 2020  rl"}.           
-000217d0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-000217e0: 696e 7428 6622 4f70 656e 696e 6720 7572  int(f"Opening ur
-000217f0: 6c20 7b75 726c 7d20 666f 7220 796f 7520  l {url} for you 
-00021800: 746f 2067 7261 6220 636f 6d70 6c65 7465  to grab complete
-00021810: 2075 726c 2066 6f72 207b 696d 6167 657d   url for {image}
-00021820: 206b 766d 2067 7565 7374 2069 6d61 6765   kvm guest image
-00021830: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00021840: 2020 2020 2020 2020 2020 2077 6562 6272             webbr
-00021850: 6f77 7365 722e 6f70 656e 2875 726c 2c20  owser.open(url, 
-00021860: 6e65 773d 322c 2061 7574 6f72 6169 7365  new=2, autoraise
-00021870: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00021880: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00021890: 726c 203d 2069 6e70 7574 2822 436f 7079  rl = input("Copy
-000218a0: 2055 726c 3a5c 6e22 290a 2020 2020 2020   Url:\n").      
-000218b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218c0: 2020 6966 2075 726c 2e73 7472 6970 2829    if url.strip()
-000218d0: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
-000218e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218f0: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
-00021900: 6e67 2070 726f 7065 7220 7572 6c2e 4c65  ng proper url.Le
-00021910: 6176 696e 672e 2e2e 2229 0a20 2020 2020  aving...").     
-00021920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021930: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-00021940: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-00021950: 6527 2c20 2772 6561 736f 6e27 3a20 224d  e', 'reason': "M
-00021960: 6973 7369 6e67 2069 6d61 6765 227d 0a20  issing image"}. 
-00021970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021980: 6620 636d 6420 6973 204e 6f6e 6520 616e  f cmd is None an
-00021990: 6420 696d 6167 6520 213d 2027 2720 616e  d image != '' an
-000219a0: 6420 696d 6167 6520 696e 2049 4d41 4745  d image in IMAGE
-000219b0: 5343 4f4d 4d41 4e44 533a 0a20 2020 2020  SCOMMANDS:.     
-000219c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000219d0: 6d64 203d 2049 4d41 4745 5343 4f4d 4d41  md = IMAGESCOMMA
-000219e0: 4e44 535b 696d 6167 655d 0a20 2020 2020  NDS[image].     
-000219f0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00021a00: 7428 6622 4772 6162 6269 6e67 2069 6d61  t(f"Grabbing ima
-00021a10: 6765 207b 696d 6167 657d 2066 726f 6d20  ge {image} from 
-00021a20: 7572 6c20 7b75 726c 7d22 290a 2020 2020  url {url}").    
-00021a30: 2020 2020 2020 2020 2020 2020 6e65 6564              need
-00021a40: 5f69 736f 203d 2027 6170 692f 6173 7369  _iso = 'api/assi
-00021a50: 7374 6564 2d69 6d61 6765 732f 696d 6167  sted-images/imag
-00021a60: 6573 2720 696e 2075 726c 0a20 2020 2020  es' in url.     
-00021a70: 2020 2020 2020 2020 2020 2073 686f 7274             short
-00021a80: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-00021a90: 6173 656e 616d 6528 7572 6c29 2e73 706c  asename(url).spl
-00021aa0: 6974 2827 3f27 295b 305d 0a20 2020 2020  it('?')[0].     
-00021ab0: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
-00021ac0: 6564 5f69 736f 3a0a 2020 2020 2020 2020  ed_iso:.        
-00021ad0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00021ae0: 6520 3d20 6627 626f 6f74 2d7b 7368 6f72  e = f'boot-{shor
-00021af0: 746e 616d 657d 2e69 736f 270a 2020 2020  tname}.iso'.    
-00021b00: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00021b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021b20: 2020 2020 2063 6f6e 7665 7274 203d 2027       convert = '
-00021b30: 2e72 6177 2e27 2069 6e20 7572 6c0a 2020  .raw.' in url.  
-00021b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b50: 2020 7265 7375 6c74 203d 206b 2e61 6464    result = k.add
-00021b60: 5f69 6d61 6765 2875 726c 2c20 706f 6f6c  _image(url, pool
-00021b70: 2c20 636d 643d 636d 642c 206e 616d 653d  , cmd=cmd, name=
-00021b80: 696d 6167 652c 2073 697a 653d 7369 7a65  image, size=size
-00021b90: 2c20 636f 6e76 6572 743d 636f 6e76 6572  , convert=conver
-00021ba0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00021bb0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00021bc0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00021bd0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00021be0: 726f 7228 6622 476f 7420 7b65 7d22 290a  ror(f"Got {e}").
-00021bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c00: 2020 2020 6572 726f 7228 6622 506c 6561      error(f"Plea
-00021c10: 7365 2072 756e 206b 636c 6920 6465 6c65  se run kcli dele
-00021c20: 7465 2069 6d61 6765 202d 2d79 6573 207b  te image --yes {
-00021c30: 7368 6f72 746e 616d 657d 2229 0a20 2020  shortname}").   
-00021c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c50: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00021c60: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-00021c70: 6561 736f 6e27 3a20 2255 7365 7220 696e  eason': "User in
-00021c80: 7465 7272 7570 7469 6f6e 227d 0a20 2020  terruption"}.   
-00021c90: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-00021ca0: 6e64 203d 2027 666f 756e 6427 2069 6e20  nd = 'found' in 
-00021cb0: 7265 7375 6c74 0a20 2020 2020 2020 2020  result.         
-00021cc0: 2020 2020 2020 2069 6620 666f 756e 643a         if found:
-00021cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021ce0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00021cf0: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
-00021d00: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00021d10: 2020 636f 6d6d 6f6e 2e68 616e 646c 655f    common.handle_
-00021d20: 7265 7370 6f6e 7365 2872 6573 756c 742c  response(result,
-00021d30: 2069 6d61 6765 2c20 656c 656d 656e 743d   image, element=
-00021d40: 2749 6d61 6765 272c 2061 6374 696f 6e3d  'Image', action=
-00021d50: 2741 6464 6564 2729 0a20 2020 2020 2020  'Added').       
-00021d60: 2020 2020 2020 2020 2069 6620 7265 7375           if resu
-00021d70: 6c74 5b27 7265 7375 6c74 275d 2021 3d20  lt['result'] != 
-00021d80: 2773 7563 6365 7373 273a 0a20 2020 2020  'success':.     
-00021d90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021da0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00021db0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-00021dc0: 736f 6e27 3a20 7265 7375 6c74 5b27 7265  son': result['re
-00021dd0: 6173 6f6e 275d 7d0a 2020 2020 2020 2020  ason']}.        
-00021de0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00021df0: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
-00021e00: 0a20 2020 2020 2020 2065 6c69 6620 7377  .        elif sw
-00021e10: 6974 6368 3a0a 2020 2020 2020 2020 2020  itch:.          
-00021e20: 2020 6966 2073 7769 7463 6820 6e6f 7420    if switch not 
-00021e30: 696e 2073 656c 662e 636c 6965 6e74 733a  in self.clients:
-00021e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021e50: 2065 7272 6f72 2866 2243 6c69 656e 7420   error(f"Client 
-00021e60: 7b73 7769 7463 687d 206e 6f74 2066 6f75  {switch} not fou
-00021e70: 6e64 2069 6e20 636f 6e66 6967 2e4c 6561  nd in config.Lea
-00021e80: 7669 6e67 2e2e 2e2e 2229 0a20 2020 2020  ving....").     
-00021e90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00021ea0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-00021eb0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-00021ec0: 3a20 6622 436c 6965 6e74 207b 7377 6974  : f"Client {swit
-00021ed0: 6368 7d20 6e6f 7420 666f 756e 6420 696e  ch} not found in
-00021ee0: 2063 6f6e 6669 6722 7d0a 2020 2020 2020   config"}.      
-00021ef0: 2020 2020 2020 656e 6162 6c65 6420 3d20        enabled = 
-00021f00: 7365 6c66 2e69 6e69 5b73 7769 7463 685d  self.ini[switch]
-00021f10: 2e67 6574 2827 656e 6162 6c65 6427 2c20  .get('enabled', 
-00021f20: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00021f30: 2020 6966 206e 6f74 2065 6e61 626c 6564    if not enabled
-00021f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021f50: 2020 6572 726f 7228 6622 436c 6965 6e74    error(f"Client
-00021f60: 207b 7377 6974 6368 7d20 6973 2064 6973   {switch} is dis
-00021f70: 6162 6c65 642e 4c65 6176 696e 672e 2e2e  abled.Leaving...
-00021f80: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00021f90: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00021fa0: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
-00021fb0: 2027 7265 6173 6f6e 273a 2066 2243 6c69   'reason': f"Cli
-00021fc0: 656e 7420 7b73 7769 7463 687d 2069 7320  ent {switch} is 
-00021fd0: 6469 7361 626c 6564 227d 0a20 2020 2020  disabled"}.     
-00021fe0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00021ff0: 5377 6974 6368 696e 6720 746f 2063 6c69  Switching to cli
-00022000: 656e 7420 7b73 7769 7463 687d 2e2e 2e22  ent {switch}..."
-00022010: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00022020: 6966 696c 6520 3d20 2225 732f 2e6b 636c  ifile = "%s/.kcl
-00022030: 692f 636f 6e66 6967 2e79 6d6c 2220 2520  i/config.yml" % 
-00022040: 6f73 2e65 6e76 6972 6f6e 2e67 6574 2827  os.environ.get('
-00022050: 484f 4d45 2729 0a20 2020 2020 2020 2020  HOME').         
-00022060: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-00022070: 6973 7473 2869 6e69 6669 6c65 293a 0a20  ists(inifile):. 
-00022080: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00022090: 6577 696e 6920 3d20 2727 0a20 2020 2020  ewini = ''.     
-000220a0: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
-000220b0: 696e 6520 696e 206f 7065 6e28 696e 6966  ine in open(inif
-000220c0: 696c 6529 2e72 6561 646c 696e 6573 2829  ile).readlines()
-000220d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000220e0: 2020 2020 2020 6966 2027 636c 6965 6e74        if 'client
-000220f0: 2720 696e 206c 696e 653a 0a20 2020 2020  ' in line:.     
-00022100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022110: 2020 206e 6577 696e 6920 2b3d 2066 2220     newini += f" 
-00022120: 636c 6965 6e74 3a20 7b73 7769 7463 687d  client: {switch}
-00022130: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-00022140: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00022150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022160: 2020 2020 2020 6e65 7769 6e69 202b 3d20        newini += 
-00022170: 6c69 6e65 0a20 2020 2020 2020 2020 2020  line.           
-00022180: 2020 2020 206f 7065 6e28 696e 6966 696c       open(inifil
-00022190: 652c 2027 7727 292e 7772 6974 6528 6e65  e, 'w').write(ne
-000221a0: 7769 6e69 290a 2020 2020 2020 2020 2020  wini).          
-000221b0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-000221c0: 7427 3a20 2773 7563 6365 7373 277d 0a20  t': 'success'}. 
-000221d0: 2020 2020 2020 2065 6c69 6620 7379 6e63         elif sync
-000221e0: 3a0a 2020 2020 2020 2020 2020 2020 6b20  :.            k 
-000221f0: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
-00022200: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00022210: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
-00022220: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00022230: 6172 6e69 6e67 2822 4e6f 7468 696e 6720  arning("Nothing 
-00022240: 746f 2064 6f2e 204c 6561 7669 6e67 2e2e  to do. Leaving..
-00022250: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00022260: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00022270: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
-00022280: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00022290: 2063 6c69 2069 6e20 7365 6c66 2e65 7874   cli in self.ext
-000222a0: 7261 636c 6965 6e74 733a 0a20 2020 2020  raclients:.     
-000222b0: 2020 2020 2020 2020 2020 2064 6573 7420             dest 
-000222c0: 3d20 7365 6c66 2e65 7874 7261 636c 6965  = self.extraclie
-000222d0: 6e74 735b 636c 695d 0a20 2020 2020 2020  nts[cli].       
-000222e0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-000222f0: 6622 7379 6e63 696e 6720 636c 6965 6e74  f"syncing client
-00022300: 2069 6d61 6765 7320 6672 6f6d 207b 7365   images from {se
-00022310: 6c66 2e63 6c69 656e 747d 2074 6f20 7b63  lf.client} to {c
-00022320: 6c69 7d22 290a 2020 2020 2020 2020 2020  li}").          
-00022330: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
-00022340: 6f74 6520 7268 656c 2069 6d61 6765 7320  ote rhel images 
-00022350: 6172 6520 6375 7272 656e 746c 7920 6e6f  are currently no
-00022360: 7420 7379 6e63 6564 2229 0a20 2020 2020  t synced").     
-00022370: 2020 2020 2020 2066 6f72 2076 6f6c 2069         for vol i
-00022380: 6e20 6b2e 766f 6c75 6d65 7328 293a 0a20  n k.volumes():. 
-00022390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000223a0: 6d61 6765 203d 206f 732e 7061 7468 2e62  mage = os.path.b
-000223b0: 6173 656e 616d 6528 766f 6c29 0a20 2020  asename(vol).   
-000223c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000223d0: 696d 6167 6520 696e 205b 6f73 2e70 6174  image in [os.pat
-000223e0: 682e 6261 7365 6e61 6d65 2876 2920 666f  h.basename(v) fo
-000223f0: 7220 7620 696e 2064 6573 742e 766f 6c75  r v in dest.volu
-00022400: 6d65 7328 295d 3a0a 2020 2020 2020 2020  mes()]:.        
-00022410: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00022420: 696e 6728 6622 4967 6e6f 7269 6e67 207b  ing(f"Ignoring {
-00022430: 696d 6167 657d 2061 7320 6974 2773 2061  image} as it's a
-00022440: 6c72 6561 6479 2074 6865 7265 2229 0a20  lready there"). 
-00022450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022460: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00022470: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00022480: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00022490: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-000224a0: 6c69 7374 2849 4d41 4745 532e 7661 6c75  list(IMAGES.valu
-000224b0: 6573 2829 293a 0a20 2020 2020 2020 2020  es()):.         
-000224c0: 2020 2020 2020 2020 2020 2069 6620 6e20             if n 
-000224d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000224e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224f0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00022500: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00022510: 6966 206e 2e73 706c 6974 2827 2f27 295b  if n.split('/')[
-00022520: 2d31 5d20 3d3d 2069 6d61 6765 3a0a 2020  -1] == image:.  
-00022530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022540: 2020 2020 2020 7572 6c20 3d20 6e0a 2020        url = n.  
-00022550: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00022560: 2075 726c 2069 7320 4e6f 6e65 3a0a 2020   url is None:.  
-00022570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022580: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00022590: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
-000225a0: 7265 6173 6f6e 273a 2022 696d 6167 6520  reason': "image 
-000225b0: 6e6f 7420 696e 2064 6566 6175 6c74 206c  not in default l
-000225c0: 6973 7422 7d0a 2020 2020 2020 2020 2020  ist"}.          
-000225d0: 2020 2020 2020 6966 2069 6d61 6765 2e73        if image.s
-000225e0: 7461 7274 7377 6974 6828 2772 6865 6c27  tartswith('rhel'
-000225f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00022600: 2020 2020 2020 2069 6620 2777 6562 2720         if 'web' 
-00022610: 696e 2073 7973 2e61 7267 765b 305d 3a0a  in sys.argv[0]:.
-00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022630: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00022640: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
-00022650: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
-00022660: 4d69 7373 696e 6720 7572 6c22 7d0a 2020  Missing url"}.  
-00022670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022680: 2020 7070 7269 6e74 2866 224f 7065 6e69    pprint(f"Openi
-00022690: 6e67 2075 726c 207b 7572 6c7d 2066 6f72  ng url {url} for
-000226a0: 2079 6f75 2074 6f20 6772 6162 2063 6f6d   you to grab com
-000226b0: 706c 6574 6520 7572 6c20 666f 7220 7b76  plete url for {v
-000226c0: 6f6c 7d20 6b76 6d20 6775 6573 7420 696d  ol} kvm guest im
-000226d0: 6167 6522 290a 2020 2020 2020 2020 2020  age").          
-000226e0: 2020 2020 2020 2020 2020 7765 6262 726f            webbro
-000226f0: 7773 6572 2e6f 7065 6e28 7572 6c2c 206e  wser.open(url, n
-00022700: 6577 3d32 2c20 6175 746f 7261 6973 653d  ew=2, autoraise=
-00022710: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00022720: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-00022730: 696e 7075 7428 2243 6f70 7920 5572 6c3a  input("Copy Url:
-00022740: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00022750: 2020 2020 2020 2020 2069 6620 7572 6c2e           if url.
-00022760: 7374 7269 7028 2920 3d3d 2027 273a 0a20  strip() == '':. 
-00022770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022780: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-00022790: 7373 696e 6720 7072 6f70 6572 2075 726c  ssing proper url
-000227a0: 2e4c 6561 7669 6e67 2e2e 2e22 290a 2020  .Leaving...").  
-000227b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227c0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-000227d0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-000227e0: 272c 2027 7265 6173 6f6e 273a 2022 4d69  ', 'reason': "Mi
-000227f0: 7373 696e 6720 696d 6167 6522 7d0a 2020  ssing image"}.  
-00022800: 2020 2020 2020 2020 2020 2020 2020 636d                cm
-00022810: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
-00022820: 2020 2020 2020 2020 2069 6620 766f 6c20           if vol 
-00022830: 696e 2049 4d41 4745 5343 4f4d 4d41 4e44  in IMAGESCOMMAND
-00022840: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
-00022850: 2020 2020 2020 2063 6d64 203d 2049 4d41         cmd = IMA
-00022860: 4745 5343 4f4d 4d41 4e44 535b 696d 6167  GESCOMMANDS[imag
-00022870: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00022880: 2020 2070 7072 696e 7428 6622 4772 6162     pprint(f"Grab
-00022890: 6269 6e67 2069 6d61 6765 207b 696d 6167  bing image {imag
-000228a0: 657d 2e2e 2e22 290a 2020 2020 2020 2020  e}...").        
-000228b0: 2020 2020 2020 2020 6465 7374 2e61 6464          dest.add
-000228c0: 5f69 6d61 6765 2875 726c 2c20 706f 6f6c  _image(url, pool
-000228d0: 2c20 636d 643d 636d 6429 0a20 2020 2020  , cmd=cmd).     
-000228e0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-000228f0: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
-00022900: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
-00022910: 6c6f 6164 6261 6c61 6e63 6572 2873 656c  loadbalancer(sel
-00022920: 662c 206e 616d 652c 2064 6f6d 6169 6e3d  f, name, domain=
-00022930: 4e6f 6e65 293a 0a20 2020 2020 2020 206b  None):.        k
-00022940: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
-00022950: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
-00022960: 696e 6720 6c6f 6164 6261 6c61 6e63 6572  ing loadbalancer
-00022970: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
-00022980: 2020 6966 2073 656c 662e 7479 7065 2069    if self.type i
-00022990: 6e20 5b27 6177 7327 2c20 2767 6370 272c  n ['aws', 'gcp',
-000229a0: 2027 6962 6d27 5d3a 0a20 2020 2020 2020   'ibm']:.       
-000229b0: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
-000229c0: 206b 2e64 656c 6574 655f 6c6f 6164 6261   k.delete_loadba
-000229d0: 6c61 6e63 6572 286e 616d 6529 0a20 2020  lancer(name).   
-000229e0: 2020 2020 2020 2020 2069 6620 646f 6d61           if doma
-000229f0: 696e 2069 7320 6e6f 7420 4e6f 6e65 2061  in is not None a
-00022a00: 6e64 2064 6e73 636c 6965 6e74 2069 7320  nd dnsclient is 
-00022a10: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7369  not None and isi
-00022a20: 6e73 7461 6e63 6528 646e 7363 6c69 656e  nstance(dnsclien
-00022a30: 742c 2073 7472 293a 0a20 2020 2020 2020  t, str):.       
-00022a40: 2020 2020 2020 2020 2069 6620 646e 7363           if dnsc
-00022a50: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
-00022a60: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-00022a70: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
-00022a80: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
-00022a90: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
-00022aa0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00022ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022ac0: 2020 2020 2077 6172 6e69 6e67 2866 2243       warning(f"C
-00022ad0: 6c69 656e 7420 7b64 6e73 636c 6965 6e74  lient {dnsclient
-00022ae0: 7d20 6e6f 7420 666f 756e 642e 2053 6b69  } not found. Ski
-00022af0: 7070 696e 6722 290a 2020 2020 2020 2020  pping").        
-00022b00: 2020 2020 2020 2020 7a2e 6465 6c65 7465          z.delete
-00022b10: 5f64 6e73 286e 616d 652e 7265 706c 6163  _dns(name.replac
-00022b20: 6528 275f 272c 2027 2d27 292c 2064 6f6d  e('_', '-'), dom
-00022b30: 6169 6e29 0a20 2020 2020 2020 2065 6c69  ain).        eli
-00022b40: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
-00022b50: 6b76 6d27 3a0a 2020 2020 2020 2020 2020  kvm':.          
-00022b60: 2020 6b2e 6465 6c65 7465 286e 616d 6529    k.delete(name)
-00022b70: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00022b80: 5f6c 6f61 6462 616c 616e 6365 7228 7365  _loadbalancer(se
-00022b90: 6c66 2c20 6e61 6d65 2c20 6e65 7473 3d5b  lf, name, nets=[
-00022ba0: 2764 6566 6175 6c74 275d 2c20 706f 7274  'default'], port
-00022bb0: 733d 5b5d 2c20 6368 6563 6b70 6174 683d  s=[], checkpath=
-00022bc0: 272f 272c 2076 6d73 3d5b 5d2c 2064 6f6d  '/', vms=[], dom
-00022bd0: 6169 6e3d 4e6f 6e65 2c0a 2020 2020 2020  ain=None,.      
-00022be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bf0: 2020 2020 2020 706c 616e 3d4e 6f6e 652c        plan=None,
-00022c00: 2063 6865 636b 706f 7274 3d38 302c 2061   checkport=80, a
-00022c10: 6c69 6173 3d5b 5d2c 2069 6e74 6572 6e61  lias=[], interna
-00022c20: 6c3d 4661 6c73 652c 2064 6e73 636c 6965  l=False, dnsclie
-00022c30: 6e74 3d4e 6f6e 652c 2073 7562 6e65 7469  nt=None, subneti
-00022c40: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
-00022c50: 206e 616d 6520 3d20 6e61 6d65 7574 696c   name = nameutil
-00022c60: 732e 6765 745f 7261 6e64 6f6d 5f6e 616d  s.get_random_nam
-00022c70: 6528 292e 7265 706c 6163 6528 275f 272c  e().replace('_',
-00022c80: 2027 2d27 2920 6966 206e 616d 6520 6973   '-') if name is
-00022c90: 204e 6f6e 6520 656c 7365 206e 616d 650a   None else name.
-00022ca0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00022cb0: 2244 6570 6c6f 7969 6e67 206c 6f61 6462  "Deploying loadb
-00022cc0: 616c 616e 6365 7220 7b6e 616d 657d 2229  alancer {name}")
-00022cd0: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-00022ce0: 662e 6b0a 2020 2020 2020 2020 6966 2073  f.k.        if s
-00022cf0: 656c 662e 7479 7065 2069 6e20 5b27 6177  elf.type in ['aw
-00022d00: 7327 2c20 2767 6370 272c 2027 6962 6d27  s', 'gcp', 'ibm'
-00022d10: 5d3a 0a20 2020 2020 2020 2020 2020 206c  ]:.            l
-00022d20: 625f 6970 203d 206b 2e63 7265 6174 655f  b_ip = k.create_
-00022d30: 6c6f 6164 6261 6c61 6e63 6572 286e 616d  loadbalancer(nam
-00022d40: 652c 2070 6f72 7473 3d70 6f72 7473 2c20  e, ports=ports, 
-00022d50: 6368 6563 6b70 6174 683d 6368 6563 6b70  checkpath=checkp
-00022d60: 6174 682c 2076 6d73 3d76 6d73 2c20 646f  ath, vms=vms, do
-00022d70: 6d61 696e 3d64 6f6d 6169 6e2c 0a20 2020  main=domain,.   
-00022d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022da0: 2020 2020 2020 2063 6865 636b 706f 7274         checkport
-00022db0: 3d63 6865 636b 706f 7274 2c20 616c 6961  =checkport, alia
-00022dc0: 733d 616c 6961 732c 2069 6e74 6572 6e61  s=alias, interna
-00022dd0: 6c3d 696e 7465 726e 616c 2c0a 2020 2020  l=internal,.    
-00022de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e00: 2020 2020 2020 646e 7363 6c69 656e 743d        dnsclient=
-00022e10: 646e 7363 6c69 656e 742c 2073 7562 6e65  dnsclient, subne
-00022e20: 7469 643d 7375 626e 6574 6964 290a 2020  tid=subnetid).  
-00022e30: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
-00022e40: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
-00022e50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00022e60: 2020 2020 6966 2064 6e73 636c 6965 6e74      if dnsclient
-00022e70: 2069 6e20 7365 6c66 2e63 6c69 656e 7473   in self.clients
-00022e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022e90: 2020 2020 2020 7a20 3d20 4b63 6f6e 6669        z = Kconfi
-00022ea0: 6728 636c 6965 6e74 3d64 6e73 636c 6965  g(client=dnsclie
-00022eb0: 6e74 292e 6b0a 2020 2020 2020 2020 2020  nt).k.          
-00022ec0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00022ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ee0: 7761 726e 696e 6728 6622 436c 6965 6e74  warning(f"Client
-00022ef0: 207b 646e 7363 6c69 656e 747d 206e 6f74   {dnsclient} not
-00022f00: 2066 6f75 6e64 2e20 536b 6970 7069 6e67   found. Skipping
-00022f10: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00022f20: 2020 207a 2e72 6573 6572 7665 5f64 6e73     z.reserve_dns
-00022f30: 286e 616d 652e 7265 706c 6163 6528 275f  (name.replace('_
-00022f40: 272c 2027 2d27 292c 2069 703d 6c62 5f69  ', '-'), ip=lb_i
-00022f50: 702c 2064 6f6d 6169 6e3d 646f 6d61 696e  p, domain=domain
-00022f60: 2c20 616c 6961 733d 616c 6961 7329 0a20  , alias=alias). 
-00022f70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00022f80: 2020 2020 2020 2020 2076 6d69 6e66 6f20           vminfo 
-00022f90: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00022fa0: 2066 6f72 2076 6d20 696e 2076 6d73 3a0a   for vm in vms:.
-00022fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022fc0: 6966 2076 616c 6964 5f69 7028 766d 293a  if valid_ip(vm):
-00022fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022fe0: 2020 2020 2076 6d6e 616d 6520 3d20 766d       vmname = vm
-00022ff0: 2e72 6570 6c61 6365 2827 3a27 2c20 272d  .replace(':', '-
-00023000: 2729 2e72 6570 6c61 6365 2827 2e27 2c20  ').replace('.', 
-00023010: 272d 2729 0a20 2020 2020 2020 2020 2020  '-').           
-00023020: 2020 2020 2020 2020 2076 6d69 6e66 6f2e           vminfo.
-00023030: 6170 7065 6e64 287b 276e 616d 6527 3a20  append({'name': 
-00023040: 766d 6e61 6d65 2c20 2769 7027 3a20 766d  vmname, 'ip': vm
-00023050: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-00023060: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00023070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023080: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
-00023090: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-000230a0: 6520 636f 756e 7465 7220 213d 2031 3030  e counter != 100
-000230b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000230c0: 2020 2020 2020 6970 203d 206b 2e69 7028        ip = k.ip(
-000230d0: 766d 290a 2020 2020 2020 2020 2020 2020  vm).            
-000230e0: 2020 2020 2020 2020 6966 2069 7020 6973          if ip is
-000230f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00023100: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00023110: 6c65 6570 2835 290a 2020 2020 2020 2020  leep(5).        
-00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023130: 7072 696e 7428 6622 5761 6974 696e 6720  print(f"Waiting 
-00023140: 3520 7365 636f 6e64 7320 746f 2067 7261  5 seconds to gra
-00023150: 6220 6970 2066 6f72 2076 6d20 7b76 6d7d  b ip for vm {vm}
-00023160: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00023170: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00023180: 756e 7465 7220 2b3d 2035 0a20 2020 2020  unter += 5.     
-00023190: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000231a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000231b0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-000231c0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-000231d0: 2020 2076 6d69 6e66 6f2e 6170 7065 6e64     vminfo.append
-000231e0: 287b 276e 616d 6527 3a20 766d 2c20 2769  ({'name': vm, 'i
-000231f0: 7027 3a20 6970 7d29 0a20 2020 2020 2020  p': ip}).       
-00023200: 2020 2020 206f 7665 7272 6964 6573 203d       overrides =
-00023210: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00023220: 2020 2022 6e61 6d65 223a 206e 616d 652c     "name": name,
-00023230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023240: 2022 766d 7322 3a20 766d 696e 666f 2c0a   "vms": vminfo,.
-00023250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023260: 226e 6574 7322 3a20 6e65 7473 2c0a 2020  "nets": nets,.  
-00023270: 2020 2020 2020 2020 2020 2020 2020 2270                "p
-00023280: 6f72 7473 223a 2070 6f72 7473 2c0a 2020  orts": ports,.  
-00023290: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-000232a0: 6865 636b 7061 7468 223a 2063 6865 636b  heckpath": check
-000232b0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-000232c0: 2020 2020 2020 2264 6f6d 6169 6e22 3a20        "domain": 
-000232d0: 646f 6d61 696e 2c0a 2020 2020 2020 2020  domain,.        
-000232e0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-000232f0: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
-00023300: 2c20 696e 7075 7473 7472 696e 673d 6861  , inputstring=ha
-00023310: 7072 6f78 7970 6c61 6e2c 206f 7665 7272  proxyplan, overr
-00023320: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00023330: 0a20 2020 2064 6566 206c 6973 745f 6c6f  .    def list_lo
-00023340: 6164 6261 6c61 6e63 6572 7328 7365 6c66  adbalancers(self
-00023350: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00023360: 656c 662e 6b0a 2020 2020 2020 2020 6966  elf.k.        if
-00023370: 2073 656c 662e 7479 7065 206e 6f74 2069   self.type not i
-00023380: 6e20 5b27 6177 7327 2c20 2767 6370 272c  n ['aws', 'gcp',
-00023390: 2027 6962 6d27 5d3a 0a20 2020 2020 2020   'ibm']:.       
-000233a0: 2020 2020 2072 6573 756c 7473 203d 205b       results = [
-000233b0: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-000233c0: 7220 766d 2069 6e20 6b2e 6c69 7374 2829  r vm in k.list()
-000233d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000233e0: 2020 6966 2076 6d5b 2770 726f 6669 6c65    if vm['profile
-000233f0: 275d 2e73 7461 7274 7377 6974 6828 276c  '].startswith('l
-00023400: 6f61 6462 616c 616e 6365 7227 2920 616e  oadbalancer') an
-00023410: 6420 6c65 6e28 766d 5b27 7072 6f66 696c  d len(vm['profil
-00023420: 6527 5d2e 7370 6c69 7428 272d 2729 2920  e'].split('-')) 
-00023430: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-00023440: 2020 2020 2020 2020 2020 706f 7274 7320            ports 
-00023450: 3d20 766d 5b27 7072 6f66 696c 6527 5d2e  = vm['profile'].
-00023460: 7370 6c69 7428 272d 2729 5b31 5d0a 2020  split('-')[1].  
-00023470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023480: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
-00023490: 285b 766d 5b27 6e61 6d65 275d 2c20 766d  ([vm['name'], vm
-000234a0: 5b27 6970 275d 2c20 2774 6370 272c 2070  ['ip'], 'tcp', p
-000234b0: 6f72 7473 2c20 2727 5d29 0a20 2020 2020  orts, '']).     
-000234c0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000234d0: 7375 6c74 730a 2020 2020 2020 2020 656c  sults.        el
-000234e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000234f0: 7265 7475 726e 206b 2e6c 6973 745f 6c6f  return k.list_lo
-00023500: 6164 6261 6c61 6e63 6572 7328 290a 0a20  adbalancers().. 
-00023510: 2020 2064 6566 2077 6169 745f 6669 6e69     def wait_fini
-00023520: 7368 2873 656c 662c 206e 616d 652c 2069  sh(self, name, i
-00023530: 6d61 6765 3d4e 6f6e 652c 2071 7569 6574  mage=None, quiet
-00023540: 3d46 616c 7365 2c20 7761 6974 636f 6d6d  =False, waitcomm
-00023550: 616e 643d 4e6f 6e65 2c20 7761 6974 7469  and=None, waitti
-00023560: 6d65 6f75 743d 302c 2069 6465 6e74 6974  meout=0, identit
-00023570: 7966 696c 653d 4e6f 6e65 2c0a 2020 2020  yfile=None,.    
-00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023590: 766d 636c 6965 6e74 3d4e 6f6e 6529 3a0a  vmclient=None):.
-000235a0: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
-000235b0: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
-000235c0: 766d 636c 6965 6e74 2920 6966 2076 6d63  vmclient) if vmc
-000235d0: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
-000235e0: 6520 656c 7365 2073 656c 660a 2020 2020  e else self.    
-000235f0: 2020 2020 6b20 3d20 636f 6e66 6967 2e6b      k = config.k
-00023600: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
-00023610: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00023620: 2020 2020 2020 2069 6d61 6765 203d 206b         image = k
-00023630: 2e69 6e66 6f28 6e61 6d65 295b 2769 6d61  .info(name)['ima
-00023640: 6765 275d 0a20 2020 2020 2020 2070 7072  ge'].        ppr
-00023650: 696e 7428 6622 5761 6974 696e 6720 666f  int(f"Waiting fo
-00023660: 7220 766d 207b 6e61 6d65 7d20 746f 2066  r vm {name} to f
-00023670: 696e 6973 6820 6375 7374 6f6d 6973 6174  inish customisat
-00023680: 696f 6e22 290a 2020 2020 2020 2020 6966  ion").        if
-00023690: 2077 6169 7463 6f6d 6d61 6e64 2069 7320   waitcommand is 
-000236a0: 6e6f 7420 4e6f 6e65 2061 6e64 2027 323e  not None and '2>
-000236b0: 2720 6e6f 7420 696e 2077 6169 7463 6f6d  ' not in waitcom
-000236c0: 6d61 6e64 3a0a 2020 2020 2020 2020 2020  mand:.          
-000236d0: 2020 7761 6974 636f 6d6d 616e 6420 2b3d    waitcommand +=
-000236e0: 2022 2032 3e2f 6465 762f 6e75 6c6c 220a   " 2>/dev/null".
-000236f0: 2020 2020 2020 2020 6966 2063 6f6d 6d6f          if commo
-00023700: 6e2e 6e65 6564 735f 6967 6e69 7469 6f6e  n.needs_ignition
-00023710: 2869 6d61 6765 293a 0a20 2020 2020 2020  (image):.       
-00023720: 2020 2020 2063 6d64 203d 2077 6169 7463       cmd = waitc
-00023730: 6f6d 6d61 6e64 206f 7220 2773 7564 6f20  ommand or 'sudo 
-00023740: 6a6f 7572 6e61 6c63 746c 202d 2d61 6c6c  journalctl --all
-00023750: 202d 2d6e 6f2d 7061 6765 7227 0a20 2020   --no-pager'.   
-00023760: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00023770: 2020 2020 2020 2063 6d64 203d 2077 6169         cmd = wai
-00023780: 7463 6f6d 6d61 6e64 206f 7220 6622 7375  tcommand or f"su
-00023790: 646f 2074 6169 6c20 2d6e 2035 3020 7b63  do tail -n 50 {c
-000237a0: 6f6d 6d6f 6e2e 6765 745f 636c 6f75 6469  ommon.get_cloudi
-000237b0: 6e69 7466 696c 6528 696d 6167 6529 7d22  nitfile(image)}"
-000237c0: 0a20 2020 2020 2020 2075 7365 722c 2069  .        user, i
-000237d0: 702c 2076 6d70 6f72 7420 3d20 4e6f 6e65  p, vmport = None
-000237e0: 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  , None, None.   
-000237f0: 2020 2020 2068 6f73 7469 7020 3d20 4e6f       hostip = No
-00023800: 6e65 0a20 2020 2020 2020 2074 696d 656f  ne.        timeo
-00023810: 7574 203d 2030 0a20 2020 2020 2020 2077  ut = 0.        w
-00023820: 6869 6c65 2069 7020 6973 204e 6f6e 653a  hile ip is None:
-00023830: 0a20 2020 2020 2020 2020 2020 2069 6e66  .            inf
-00023840: 6f20 3d20 6b2e 696e 666f 286e 616d 6529  o = k.info(name)
-00023850: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00023860: 636f 6e66 6967 2e74 7970 6520 3d3d 2027  config.type == '
-00023870: 7061 636b 6574 2720 616e 6420 696e 666f  packet' and info
-00023880: 2e67 6574 2827 7374 6174 7573 2729 2021  .get('status') !
-00023890: 3d20 2761 6374 6976 6527 3a0a 2020 2020  = 'active':.    
-000238a0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-000238b0: 696e 6728 2257 6169 7469 6e67 2066 6f72  ing("Waiting for
-000238c0: 206e 6f64 6520 746f 2062 6520 6163 7469   node to be acti
-000238d0: 7665 2229 0a20 2020 2020 2020 2020 2020  ve").           
-000238e0: 2020 2020 2069 7020 3d20 4e6f 6e65 0a20       ip = None. 
-000238f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00023900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023910: 2075 7365 722c 2069 7020 3d20 636f 6e66   user, ip = conf
-00023920: 6967 2e76 6d75 7365 7220 6f72 2069 6e66  ig.vmuser or inf
-00023930: 6f2e 6765 7428 2775 7365 7227 292c 2069  o.get('user'), i
-00023940: 6e66 6f2e 6765 7428 2769 7027 290a 2020  nfo.get('ip').  
-00023950: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00023960: 2063 6f6e 6669 672e 7479 7065 203d 3d20   config.type == 
-00023970: 276b 7562 6576 6972 7427 3a0a 2020 2020  'kubevirt':.    
-00023980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023990: 6966 206b 2e61 6363 6573 735f 6d6f 6465  if k.access_mode
-000239a0: 203d 3d20 274e 6f64 6550 6f72 7427 3a0a   == 'NodePort':.
-000239b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239c0: 2020 2020 2020 2020 766d 706f 7274 203d          vmport =
-000239d0: 2069 6e66 6f2e 6765 7428 276e 6f64 6570   info.get('nodep
-000239e0: 6f72 7427 290a 2020 2020 2020 2020 2020  ort').          
-000239f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00023a00: 2068 6f73 7469 7020 6973 204e 6f6e 653a   hostip is None:
-00023a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023a20: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
-00023a30: 7469 7020 3d20 6b2e 6e6f 6465 5f68 6f73  tip = k.node_hos
-00023a40: 7428 6e61 6d65 3d69 6e66 6f2e 6765 7428  t(name=info.get(
-00023a50: 2768 6f73 7427 2929 0a20 2020 2020 2020  'host')).       
-00023a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a70: 2069 7020 3d20 686f 7374 6970 0a20 2020   ip = hostip.   
-00023a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a90: 2065 6c69 6620 6b2e 6163 6365 7373 5f6d   elif k.access_m
-00023aa0: 6f64 6520 3d3d 2027 4c6f 6164 4261 6c61  ode == 'LoadBala
-00023ab0: 6e63 6572 273a 0a20 2020 2020 2020 2020  ncer':.         
-00023ac0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023ad0: 7020 3d20 696e 666f 2e67 6574 2827 6c6f  p = info.get('lo
-00023ae0: 6164 6261 6c61 6e63 6572 6970 2729 0a20  adbalancerip'). 
-00023af0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023b00: 6620 7573 6572 2069 7320 6e6f 7420 4e6f  f user is not No
-00023b10: 6e65 2061 6e64 2069 7020 6973 206e 6f74  ne and ip is not
-00023b20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00023b30: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00023b40: 6e66 6967 2e74 7970 6520 3d3d 2027 6f70  nfig.type == 'op
-00023b50: 656e 7374 6163 6b27 2061 6e64 2069 6e66  enstack' and inf
-00023b60: 6f2e 6765 7428 2770 7269 7661 7465 6970  o.get('privateip
-00023b70: 2729 203d 3d20 6970 2061 6e64 206b 2e65  ') == ip and k.e
-00023b80: 7874 6572 6e61 6c5f 6e65 7477 6f72 6b20  xternal_network 
-00023b90: 6973 206e 6f74 204e 6f6e 655c 0a20 2020  is not None\.   
-00023ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bb0: 2020 2020 2020 2020 2061 6e64 2069 6e66           and inf
-00023bc0: 6f2e 6765 7428 276e 6574 7327 295b 305d  o.get('nets')[0]
-00023bd0: 5b27 6e65 7427 5d20 213d 206b 2e65 7874  ['net'] != k.ext
-00023be0: 6572 6e61 6c5f 6e65 7477 6f72 6b3a 0a20  ernal_network:. 
-00023bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c00: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-00023c10: 5761 6974 696e 6720 666f 7220 666c 6f61  Waiting for floa
-00023c20: 7469 6e67 2069 7020 696e 7374 6561 6420  ting ip instead 
-00023c30: 6f66 2061 2070 7269 7661 7465 2069 702e  of a private ip.
-00023c40: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-00023c50: 2020 2020 2020 2020 2020 2020 2069 7020               ip 
-00023c60: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00023c70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00023c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023c90: 2020 2020 2020 2020 2074 6573 7463 6d64           testcmd
-00023ca0: 203d 2063 6f6d 6d6f 6e2e 7373 6828 6e61   = common.ssh(na
-00023cb0: 6d65 2c20 7573 6572 3d75 7365 722c 2069  me, user=user, i
-00023cc0: 703d 6970 2c20 7475 6e6e 656c 3d63 6f6e  p=ip, tunnel=con
-00023cd0: 6669 672e 7475 6e6e 656c 2c20 7475 6e6e  fig.tunnel, tunn
-00023ce0: 656c 686f 7374 3d63 6f6e 6669 672e 7475  elhost=config.tu
-00023cf0: 6e6e 656c 686f 7374 2c0a 2020 2020 2020  nnelhost,.      
-00023d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d20: 2020 2020 2020 2074 756e 6e65 6c70 6f72         tunnelpor
-00023d30: 743d 636f 6e66 6967 2e74 756e 6e65 6c70  t=config.tunnelp
-00023d40: 6f72 742c 2074 756e 6e65 6c75 7365 723d  ort, tunneluser=
-00023d50: 636f 6e66 6967 2e74 756e 6e65 6c75 7365  config.tunneluse
-00023d60: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00023d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d90: 696e 7365 6375 7265 3d63 6f6e 6669 672e  insecure=config.
-00023da0: 696e 7365 6375 7265 2c20 636d 643d 2769  insecure, cmd='i
-00023db0: 6420 2d75 6e27 2c20 766d 706f 7274 3d76  d -un', vmport=v
-00023dc0: 6d70 6f72 742c 0a20 2020 2020 2020 2020  mport,.         
-00023dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023df0: 2020 2020 6964 656e 7469 7479 6669 6c65      identityfile
-00023e00: 3d69 6465 6e74 6974 7966 696c 652c 2070  =identityfile, p
-00023e10: 6173 7377 6f72 643d 4661 6c73 6529 0a20  assword=False). 
-00023e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e30: 2020 2020 2020 2069 6620 6f73 2e70 6f70         if os.pop
-00023e40: 656e 2874 6573 7463 6d64 292e 7265 6164  en(testcmd).read
-00023e50: 2829 2e73 7472 6970 2829 2021 3d20 7573  ().strip() != us
-00023e60: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00023e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e80: 7761 726e 696e 6728 2247 6174 6865 7265  warning("Gathere
-00023e90: 6420 6970 206e 6f74 2066 756e 6374 696f  d ip not functio
-00023ea0: 6e61 6c20 7965 742e 2e2e 2229 0a20 2020  nal yet...").   
-00023eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ec0: 2020 2020 2020 2020 2069 7020 3d20 4e6f           ip = No
-00023ed0: 6e65 0a20 2020 2020 2020 2020 2020 2070  ne.            p
-00023ee0: 7072 696e 7428 2257 6169 7469 6e67 2066  print("Waiting f
-00023ef0: 6f72 2076 6d20 746f 2062 6520 6163 6365  or vm to be acce
-00023f00: 7373 6962 6c65 2e2e 2e22 290a 2020 2020  ssible...").    
-00023f10: 2020 2020 2020 2020 736c 6565 7028 3529          sleep(5)
-00023f20: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-00023f30: 656f 7574 202b 3d20 350a 2020 2020 2020  eout += 5.      
-00023f40: 2020 2020 2020 6966 2077 6169 7474 696d        if waittim
-00023f50: 656f 7574 203e 2030 2061 6e64 2074 696d  eout > 0 and tim
-00023f60: 656f 7574 203e 2077 6169 7474 696d 656f  eout > waittimeo
-00023f70: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
-00023f80: 2020 2020 6572 726f 7228 2254 696d 656f      error("Timeo
-00023f90: 7574 2077 6169 7469 6e67 2066 6f72 2076  ut waiting for v
-00023fa0: 6d20 746f 2062 6520 6163 6365 7373 6962  m to be accessib
-00023fb0: 6c65 2e2e 2e22 290a 2020 2020 2020 2020  le...").        
-00023fc0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00023fd0: 2020 2020 2020 736c 6565 7028 3529 0a20        sleep(5). 
-00023fe0: 2020 2020 2020 206f 6c64 6f75 7470 7574         oldoutput
-00023ff0: 203d 2027 270a 2020 2020 2020 2020 7469   = ''.        ti
-00024000: 6d65 6f75 7420 3d20 300a 2020 2020 2020  meout = 0.      
-00024010: 2020 7768 696c 6520 5472 7565 3a0a 2020    while True:.  
-00024020: 2020 2020 2020 2020 2020 7373 6863 6d64            sshcmd
-00024030: 203d 2063 6f6d 6d6f 6e2e 7373 6828 6e61   = common.ssh(na
-00024040: 6d65 2c20 7573 6572 3d27 726f 6f74 272c  me, user='root',
-00024050: 2069 703d 6970 2c20 7475 6e6e 656c 3d63   ip=ip, tunnel=c
-00024060: 6f6e 6669 672e 7475 6e6e 656c 2c20 7475  onfig.tunnel, tu
-00024070: 6e6e 656c 686f 7374 3d63 6f6e 6669 672e  nnelhost=config.
-00024080: 7475 6e6e 656c 686f 7374 2c0a 2020 2020  tunnelhost,.    
-00024090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240a0: 2020 2020 2020 2020 2020 2020 766d 706f              vmpo
-000240b0: 7274 3d76 6d70 6f72 742c 2074 756e 6e65  rt=vmport, tunne
-000240c0: 6c70 6f72 743d 636f 6e66 6967 2e74 756e  lport=config.tun
-000240d0: 6e65 6c70 6f72 742c 2074 756e 6e65 6c75  nelport, tunnelu
-000240e0: 7365 723d 636f 6e66 6967 2e74 756e 6e65  ser=config.tunne
-000240f0: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
-00024100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024110: 2020 2020 2020 2069 6e73 6563 7572 653d         insecure=
-00024120: 636f 6e66 6967 2e69 6e73 6563 7572 652c  config.insecure,
-00024130: 2063 6d64 3d63 6d64 2c20 6964 656e 7469   cmd=cmd, identi
-00024140: 7479 6669 6c65 3d69 6465 6e74 6974 7966  tyfile=identityf
-00024150: 696c 652c 2070 6173 7377 6f72 643d 4661  ile, password=Fa
-00024160: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-00024170: 206f 7574 7075 7420 3d20 6f73 2e70 6f70   output = os.pop
-00024180: 656e 2873 7368 636d 6429 2e72 6561 6428  en(sshcmd).read(
-00024190: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000241a0: 2077 6169 7463 6f6d 6d61 6e64 2069 7320   waitcommand is 
-000241b0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000241c0: 2020 2020 2020 2020 2020 6966 206f 7574            if out
-000241d0: 7075 7420 213d 2027 273a 0a20 2020 2020  put != '':.     
-000241e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000241f0: 7269 6e74 286f 7574 7075 7429 0a20 2020  rint(output).   
-00024200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024210: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00024220: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00024230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024240: 2070 7072 696e 7428 2257 6169 7469 6e67   pprint("Waiting
-00024250: 2066 6f72 2077 6169 7463 6f6d 6d61 6e64   for waitcommand
-00024260: 2074 6f20 7375 6363 6565 642e 2e2e 2229   to succeed...")
-00024270: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00024280: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00024290: 2020 2069 6620 276b 636c 6920 626f 6f74     if 'kcli boot
-000242a0: 2066 696e 6973 6865 6427 2069 6e20 6f75   finished' in ou
-000242b0: 7470 7574 206f 7220 2749 676e 6974 696f  tput or 'Ignitio
-000242c0: 6e20 6669 6e69 7368 6564 2073 7563 6365  n finished succe
-000242d0: 7373 6675 6c6c 7927 2069 6e20 6f75 7470  ssfully' in outp
-000242e0: 7574 206f 725c 0a20 2020 2020 2020 2020  ut or\.         
-000242f0: 2020 2020 2020 2020 2020 2746 696e 6973            'Finis
-00024300: 6865 6420 436f 6d62 7573 7469 6f6e 2720  hed Combustion' 
-00024310: 696e 206f 7574 7075 743a 0a20 2020 2020  in output:.     
-00024320: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00024330: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00024340: 2020 2020 206f 7574 7075 7420 3d20 6f75       output = ou
-00024350: 7470 7574 2e72 6570 6c61 6365 286f 6c64  tput.replace(old
-00024360: 6f75 7470 7574 2c20 2727 290a 2020 2020  output, '').    
-00024370: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00024380: 6f74 2071 7569 6574 3a0a 2020 2020 2020  ot quiet:.      
-00024390: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000243a0: 696e 7428 6f75 7470 7574 290a 2020 2020  int(output).    
-000243b0: 2020 2020 2020 2020 2020 2020 6f6c 646f              oldo
-000243c0: 7574 7075 7420 3d20 6f75 7470 7574 0a20  utput = output. 
-000243d0: 2020 2020 2020 2020 2020 2073 6c65 6570             sleep
-000243e0: 2832 290a 2020 2020 2020 2020 2020 2020  (2).            
-000243f0: 7469 6d65 6f75 7420 2b3d 2032 0a20 2020  timeout += 2.   
-00024400: 2020 2020 2020 2020 2069 6620 7761 6974           if wait
-00024410: 7469 6d65 6f75 7420 3e20 3020 616e 6420  timeout > 0 and 
-00024420: 7469 6d65 6f75 7420 3e20 7761 6974 7469  timeout > waitti
-00024430: 6d65 6f75 743a 0a20 2020 2020 2020 2020  meout:.         
-00024440: 2020 2020 2020 2065 7272 6f72 2822 5469         error("Ti
-00024450: 6d65 6f75 7420 7761 6974 696e 6720 666f  meout waiting fo
-00024460: 7220 7761 6974 636f 6d6d 616e 6420 746f  r waitcommand to
-00024470: 2065 7865 6375 7465 2e2e 2e22 290a 2020   execute...").  
-00024480: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00024490: 6561 6b0a 2020 2020 2020 2020 7265 7475  eak.        retu
-000244a0: 726e 2054 7275 650a 0a20 2020 2064 6566  rn True..    def
-000244b0: 2063 6c65 616e 5f74 656d 706b 6579 2873   clean_tempkey(s
-000244c0: 656c 662c 206e 616d 652c 2069 6465 6e74  elf, name, ident
-000244d0: 6974 7966 696c 653d 4e6f 6e65 293a 0a20  ityfile=None):. 
-000244e0: 2020 2020 2020 2063 6d64 203d 2022 7365         cmd = "se
-000244f0: 6420 2d69 2027 2f74 656d 702d 6b63 6c69  d -i '/temp-kcli
-00024500: 2d6b 6579 2f64 2720 2f68 6f6d 652f 2a2f  -key/d' /home/*/
-00024510: 2e73 7368 2f61 7574 686f 7269 7a65 645f  .ssh/authorized_
-00024520: 6b65 7973 202f 726f 6f74 2f2e 7373 682f  keys /root/.ssh/
-00024530: 6175 7468 6f72 697a 6564 5f6b 6579 7322  authorized_keys"
-00024540: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-00024550: 662e 6b0a 2020 2020 2020 2020 696e 666f  f.k.        info
-00024560: 203d 206b 2e69 6e66 6f28 6e61 6d65 290a   = k.info(name).
-00024570: 2020 2020 2020 2020 766d 706f 7274 203d          vmport =
-00024580: 204e 6f6e 650a 2020 2020 2020 2020 6970   None.        ip
-00024590: 203d 2069 6e66 6f2e 6765 7428 2769 7027   = info.get('ip'
-000245a0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-000245b0: 662e 7479 7065 203d 3d20 276b 7562 6576  f.type == 'kubev
-000245c0: 6972 7427 3a0a 2020 2020 2020 2020 2020  irt':.          
-000245d0: 2020 6966 206b 2e61 6363 6573 735f 6d6f    if k.access_mo
-000245e0: 6465 203d 3d20 274e 6f64 6550 6f72 7427  de == 'NodePort'
-000245f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00024600: 2020 766d 706f 7274 203d 2069 6e66 6f2e    vmport = info.
-00024610: 6765 7428 276e 6f64 6570 6f72 7427 290a  get('nodeport').
-00024620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024630: 6970 203d 206b 2e6e 6f64 655f 686f 7374  ip = k.node_host
-00024640: 286e 616d 653d 696e 666f 2e67 6574 2827  (name=info.get('
-00024650: 686f 7374 2729 290a 2020 2020 2020 2020  host')).        
-00024660: 2020 2020 656c 6966 206b 2e61 6363 6573      elif k.acces
-00024670: 735f 6d6f 6465 203d 3d20 274c 6f61 6442  s_mode == 'LoadB
-00024680: 616c 616e 6365 7227 3a0a 2020 2020 2020  alancer':.      
-00024690: 2020 2020 2020 2020 2020 6970 203d 2069            ip = i
-000246a0: 6e66 6f2e 6765 7428 276c 6f61 6462 616c  nfo.get('loadbal
-000246b0: 616e 6365 7269 7027 290a 2020 2020 2020  ancerip').      
-000246c0: 2020 7373 6863 6d64 203d 2063 6f6d 6d6f    sshcmd = commo
-000246d0: 6e2e 7373 6828 6e61 6d65 2c20 7573 6572  n.ssh(name, user
-000246e0: 3d27 726f 6f74 272c 2069 703d 6970 2c20  ='root', ip=ip, 
-000246f0: 7475 6e6e 656c 3d73 656c 662e 7475 6e6e  tunnel=self.tunn
-00024700: 656c 2c20 7475 6e6e 656c 686f 7374 3d73  el, tunnelhost=s
-00024710: 656c 662e 7475 6e6e 656c 686f 7374 2c20  elf.tunnelhost, 
-00024720: 766d 706f 7274 3d76 6d70 6f72 742c 0a20  vmport=vmport,. 
-00024730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024740: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-00024750: 6c70 6f72 743d 7365 6c66 2e74 756e 6e65  lport=self.tunne
-00024760: 6c70 6f72 742c 2074 756e 6e65 6c75 7365  lport, tunneluse
-00024770: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
-00024780: 722c 2069 6e73 6563 7572 653d 7365 6c66  r, insecure=self
-00024790: 2e69 6e73 6563 7572 652c 2063 6d64 3d63  .insecure, cmd=c
-000247a0: 6d64 2c0a 2020 2020 2020 2020 2020 2020  md,.            
-000247b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000247c0: 6964 656e 7469 7479 6669 6c65 3d69 6465  identityfile=ide
-000247d0: 6e74 6974 7966 696c 652c 2070 6173 7377  ntityfile, passw
-000247e0: 6f72 643d 4661 6c73 6529 0a20 2020 2020  ord=False).     
-000247f0: 2020 206f 732e 706f 7065 6e28 7373 6863     os.popen(sshc
-00024800: 6d64 292e 7265 6164 2829 0a0a 2020 2020  md).read()..    
-00024810: 6465 6620 7468 7265 6164 6564 5f63 7265  def threaded_cre
-00024820: 6174 655f 6b75 6265 2873 656c 662c 2063  ate_kube(self, c
-00024830: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
-00024840: 2c20 6b75 6265 5f6f 7665 7272 6964 6573  , kube_overrides
-00024850: 293a 0a20 2020 2020 2020 2069 7070 6f6f  ):.        ippoo
-00024860: 6c20 3d20 6b75 6265 5f6f 7665 7272 6964  l = kube_overrid
-00024870: 6573 2e67 6574 2827 6970 706f 6f6c 2729  es.get('ippool')
-00024880: 206f 7220 6b75 6265 5f6f 7665 7272 6964   or kube_overrid
-00024890: 6573 2e67 6574 2827 636f 6e66 706f 6f6c  es.get('confpool
-000248a0: 2729 0a20 2020 2020 2020 2062 6172 656d  ').        barem
-000248b0: 6574 616c 706f 6f6c 203d 206b 7562 655f  etalpool = kube_
-000248c0: 6f76 6572 7269 6465 732e 6765 7428 2769  overrides.get('i
-000248d0: 7070 6f6f 6c27 2920 6f72 206b 7562 655f  ppool') or kube_
-000248e0: 6f76 6572 7269 6465 732e 6765 7428 2763  overrides.get('c
-000248f0: 6f6e 6670 6f6f 6c27 290a 2020 2020 2020  onfpool').      
-00024900: 2020 6966 2069 7070 6f6f 6c20 6973 206e    if ippool is n
-00024910: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00024920: 2020 2020 2073 656c 662e 6765 745f 7669       self.get_vi
-00024930: 705f 6672 6f6d 5f63 6f6e 6670 6f6f 6c28  p_from_confpool(
-00024940: 636c 7573 7465 722c 2069 7070 6f6f 6c2c  cluster, ippool,
-00024950: 206f 7665 7272 6964 6573 3d6b 7562 655f   overrides=kube_
-00024960: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-00024970: 2020 2069 6620 6261 7265 6d65 7461 6c70     if baremetalp
-00024980: 6f6f 6c20 6973 206e 6f74 204e 6f6e 653a  ool is not None:
-00024990: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000249a0: 662e 6765 745f 6261 7265 6d65 7461 6c5f  f.get_baremetal_
-000249b0: 686f 7374 735f 6672 6f6d 5f63 6f6e 6670  hosts_from_confp
-000249c0: 6f6f 6c28 636c 7573 7465 722c 2062 6172  ool(cluster, bar
-000249d0: 656d 6574 616c 706f 6f6c 2c20 6f76 6572  emetalpool, over
-000249e0: 7269 6465 733d 6b75 6265 5f6f 7665 7272  rides=kube_overr
-000249f0: 6964 6573 290a 2020 2020 2020 2020 7365  ides).        se
-00024a00: 6c66 2e63 7265 6174 655f 6b75 6265 2863  lf.create_kube(c
-00024a10: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
-00024a20: 2c20 6b75 6265 5f6f 7665 7272 6964 6573  , kube_overrides
-00024a30: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-00024a40: 655f 6b75 6265 2873 656c 662c 2063 6c75  e_kube(self, clu
-00024a50: 7374 6572 2c20 6b75 6265 7479 7065 2c20  ster, kubetype, 
-00024a60: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-00024a70: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-00024a80: 7970 6520 3d3d 2027 7765 6227 2061 6e64  ype == 'web' and
-00024a90: 2073 656c 662e 6b2e 6c6f 6361 6c6b 7562   self.k.localkub
-00024aa0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00024ab0: 6574 7572 6e20 7365 6c66 2e6b 2e63 7265  eturn self.k.cre
-00024ac0: 6174 655f 6b75 6265 2863 6c75 7374 6572  ate_kube(cluster
-00024ad0: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
-00024ae0: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
-00024af0: 0a20 2020 2020 2020 2069 7070 6f6f 6c20  .        ippool 
-00024b00: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-00024b10: 2769 7070 6f6f 6c27 2920 6f72 206f 7665  'ippool') or ove
-00024b20: 7272 6964 6573 2e67 6574 2827 636f 6e66  rrides.get('conf
-00024b30: 706f 6f6c 2729 0a20 2020 2020 2020 2062  pool').        b
-00024b40: 6172 656d 6574 616c 706f 6f6c 203d 206f  aremetalpool = o
-00024b50: 7665 7272 6964 6573 2e67 6574 2827 6970  verrides.get('ip
-00024b60: 706f 6f6c 2729 206f 7220 6f76 6572 7269  pool') or overri
-00024b70: 6465 732e 6765 7428 2763 6f6e 6670 6f6f  des.get('confpoo
-00024b80: 6c27 290a 2020 2020 2020 2020 6966 2069  l').        if i
-00024b90: 7070 6f6f 6c20 6973 206e 6f74 204e 6f6e  ppool is not Non
-00024ba0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00024bb0: 656c 662e 6765 745f 7669 705f 6672 6f6d  elf.get_vip_from
-00024bc0: 5f63 6f6e 6670 6f6f 6c28 636c 7573 7465  _confpool(cluste
-00024bd0: 722c 2069 7070 6f6f 6c2c 206f 7665 7272  r, ippool, overr
-00024be0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00024bf0: 2020 2020 2020 2020 6966 2062 6172 656d          if barem
-00024c00: 6574 616c 706f 6f6c 2069 7320 6e6f 7420  etalpool is not 
-00024c10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00024c20: 2020 7365 6c66 2e67 6574 5f62 6172 656d    self.get_barem
-00024c30: 6574 616c 5f68 6f73 7473 5f66 726f 6d5f  etal_hosts_from_
-00024c40: 636f 6e66 706f 6f6c 2863 6c75 7374 6572  confpool(cluster
-00024c50: 2c20 6261 7265 6d65 7461 6c70 6f6f 6c2c  , baremetalpool,
-00024c60: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00024c70: 6964 6573 290a 2020 2020 2020 2020 6966  ides).        if
-00024c80: 206b 7562 6574 7970 6520 3d3d 2027 6f70   kubetype == 'op
-00024c90: 656e 7368 6966 7427 3a0a 2020 2020 2020  enshift':.      
-00024ca0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-00024cb0: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
-00024cc0: 6f70 656e 7368 6966 7428 636c 7573 7465  openshift(cluste
-00024cd0: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
-00024ce0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
-00024cf0: 656c 6966 206b 7562 6574 7970 6520 3d3d  elif kubetype ==
-00024d00: 2027 6879 7065 7273 6869 6674 273a 0a20   'hypershift':. 
-00024d10: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00024d20: 7420 3d20 7365 6c66 2e63 7265 6174 655f  t = self.create_
-00024d30: 6b75 6265 5f68 7970 6572 7368 6966 7428  kube_hypershift(
-00024d40: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00024d50: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00024d60: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
-00024d70: 7970 6520 3d3d 2027 6d69 6372 6f73 6869  ype == 'microshi
-00024d80: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
-00024d90: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
-00024da0: 7265 6174 655f 6b75 6265 5f6d 6963 726f  reate_kube_micro
-00024db0: 7368 6966 7428 636c 7573 7465 722c 206f  shift(cluster, o
-00024dc0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00024dd0: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
-00024de0: 206b 7562 6574 7970 6520 3d3d 2027 6b69   kubetype == 'ki
-00024df0: 6e64 273a 0a20 2020 2020 2020 2020 2020  nd':.           
-00024e00: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
-00024e10: 7265 6174 655f 6b75 6265 5f6b 696e 6428  reate_kube_kind(
-00024e20: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00024e30: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00024e40: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
-00024e50: 7970 6520 3d3d 2027 6b33 7327 3a0a 2020  ype == 'k3s':.  
-00024e60: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00024e70: 203d 2073 656c 662e 6372 6561 7465 5f6b   = self.create_k
-00024e80: 7562 655f 6b33 7328 636c 7573 7465 722c  ube_k3s(cluster,
-00024e90: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00024ea0: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
-00024eb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00024ec0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
-00024ed0: 6561 7465 5f6b 7562 655f 6765 6e65 7269  eate_kube_generi
-00024ee0: 6328 636c 7573 7465 722c 206f 7665 7272  c(cluster, overr
-00024ef0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00024f00: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00024f10: 6573 756c 740a 0a20 2020 2064 6566 2063  esult..    def c
-00024f20: 7265 6174 655f 6b75 6265 5f67 656e 6572  reate_kube_gener
-00024f30: 6963 2873 656c 662c 2063 6c75 7374 6572  ic(self, cluster
-00024f40: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
-00024f50: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00024f60: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
-00024f70: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-00024f80: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
-00024f90: 273a 2f77 6f72 6b64 6972 270a 2020 2020  ':/workdir'.    
-00024fa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00024fb0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00024fc0: 5b27 5041 5448 275d 202b 3d20 273a 2573  ['PATH'] += ':%s
-00024fd0: 2720 2520 6f73 2e67 6574 6377 6428 290a  ' % os.getcwd().
-00024fe0: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-00024ff0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00025000: 6528 6b75 6265 6164 6d2e 6372 6561 7465  e(kubeadm.create
-00025010: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-00025020: 656e 616d 6529 0a20 2020 2020 2020 2072  ename).        r
-00025030: 6574 7572 6e20 6b75 6265 6164 6d2e 6372  eturn kubeadm.cr
-00025040: 6561 7465 2873 656c 662c 2070 6c61 6e64  eate(self, pland
-00025050: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
-00025060: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
-00025070: 2063 7265 6174 655f 6b75 6265 5f6b 696e   create_kube_kin
-00025080: 6428 7365 6c66 2c20 636c 7573 7465 722c  d(self, cluster,
-00025090: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-000250a0: 2020 2020 2020 2020 6966 2063 6f6e 7461          if conta
-000250b0: 696e 6572 5f6d 6f64 6528 293a 0a20 2020  iner_mode():.   
-000250c0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-000250d0: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
-000250e0: 3a2f 776f 726b 6469 7227 0a20 2020 2020  :/workdir'.     
-000250f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00025100: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-00025110: 2750 4154 4827 5d20 2b3d 2027 3a25 7327  'PATH'] += ':%s'
-00025120: 2025 206f 732e 6765 7463 7764 2829 0a20   % os.getcwd(). 
-00025130: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
-00025140: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-00025150: 286b 696e 642e 6372 6561 7465 2e5f 5f63  (kind.create.__c
-00025160: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-00025170: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00025180: 6e20 6b69 6e64 2e63 7265 6174 6528 7365  n kind.create(se
-00025190: 6c66 2c20 706c 616e 6469 722c 2063 6c75  lf, plandir, clu
-000251a0: 7374 6572 2c20 6f76 6572 7269 6465 7329  ster, overrides)
-000251b0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-000251c0: 5f6b 7562 655f 6d69 6372 6f73 6869 6674  _kube_microshift
-000251d0: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
-000251e0: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-000251f0: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-00025200: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
-00025210: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-00025220: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-00025230: 2f77 6f72 6b64 6972 270a 2020 2020 2020  /workdir'.      
-00025240: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00025250: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-00025260: 5041 5448 275d 202b 3d20 273a 2573 2720  PATH'] += ':%s' 
-00025270: 2520 6f73 2e67 6574 6377 6428 290a 2020  % os.getcwd().  
-00025280: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00025290: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-000252a0: 6d69 6372 6f73 6869 6674 2e63 7265 6174  microshift.creat
-000252b0: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
-000252c0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-000252d0: 7265 7475 726e 206d 6963 726f 7368 6966  return microshif
-000252e0: 742e 6372 6561 7465 2873 656c 662c 2070  t.create(self, p
-000252f0: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
-00025300: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
-00025310: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
-00025320: 5f6b 3373 2873 656c 662c 2063 6c75 7374  _k3s(self, clust
-00025330: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
-00025340: 293a 0a20 2020 2020 2020 2069 6620 636f  ):.        if co
-00025350: 6e74 6169 6e65 725f 6d6f 6465 2829 3a0a  ntainer_mode():.
-00025360: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
-00025370: 6e76 6972 6f6e 5b27 5041 5448 275d 202b  nviron['PATH'] +
-00025380: 3d20 273a 2f77 6f72 6b64 6972 270a 2020  = ':/workdir'.  
-00025390: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000253a0: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-000253b0: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-000253c0: 2573 2720 2520 6f73 2e67 6574 6377 6428  %s' % os.getcwd(
-000253d0: 290a 2020 2020 2020 2020 706c 616e 6469  ).        plandi
-000253e0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-000253f0: 616d 6528 6b33 732e 6372 6561 7465 2e5f  ame(k3s.create._
-00025400: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
-00025410: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
-00025420: 7572 6e20 6b33 732e 6372 6561 7465 2873  urn k3s.create(s
-00025430: 656c 662c 2070 6c61 6e64 6972 2c20 636c  elf, plandir, cl
-00025440: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025450: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-00025460: 655f 6b75 6265 5f68 7970 6572 7368 6966  e_kube_hypershif
-00025470: 7428 7365 6c66 2c20 636c 7573 7465 722c  t(self, cluster,
-00025480: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-00025490: 2020 2020 2020 2020 6966 2063 6f6e 7461          if conta
-000254a0: 696e 6572 5f6d 6f64 6528 293a 0a20 2020  iner_mode():.   
-000254b0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-000254c0: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
-000254d0: 3a2f 776f 726b 6469 7227 0a20 2020 2020  :/workdir'.     
-000254e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000254f0: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-00025500: 2750 4154 4827 5d20 2b3d 2027 3a25 7327  'PATH'] += ':%s'
-00025510: 2025 206f 732e 6765 7463 7764 2829 0a20   % os.getcwd(). 
-00025520: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
-00025530: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-00025540: 2868 7970 6572 7368 6966 742e 6372 6561  (hypershift.crea
-00025550: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
-00025560: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00025570: 2023 2064 6e73 636c 6965 6e74 203d 206f   # dnsclient = o
-00025580: 7665 7272 6964 6573 2e67 6574 2827 646e  verrides.get('dn
-00025590: 7363 6c69 656e 7427 290a 2020 2020 2020  sclient').      
-000255a0: 2020 2320 646e 7363 6f6e 6669 6720 3d20    # dnsconfig = 
-000255b0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
-000255c0: 6e73 636c 6965 6e74 2920 6966 2064 6e73  nsclient) if dns
-000255d0: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
-000255e0: 6e65 2065 6c73 6520 4e6f 6e65 0a20 2020  ne else None.   
-000255f0: 2020 2020 2072 6574 7572 6e20 6879 7065       return hype
-00025600: 7273 6869 6674 2e63 7265 6174 6528 7365  rshift.create(se
-00025610: 6c66 2c20 706c 616e 6469 722c 2063 6c75  lf, plandir, clu
-00025620: 7374 6572 2c20 6f76 6572 7269 6465 7329  ster, overrides)
-00025630: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00025640: 5f6b 7562 655f 6f70 656e 7368 6966 7428  _kube_openshift(
-00025650: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
-00025660: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
-00025670: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
-00025680: 6572 5f6d 6f64 6528 293a 0a20 2020 2020  er_mode():.     
-00025690: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-000256a0: 6e5b 2750 4154 4827 5d20 2b3d 2027 3a2f  n['PATH'] += ':/
-000256b0: 776f 726b 6469 7227 0a20 2020 2020 2020  workdir'.       
-000256c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000256d0: 2020 206f 732e 656e 7669 726f 6e5b 2750     os.environ['P
-000256e0: 4154 4827 5d20 2b3d 2027 3a25 7327 2025  ATH'] += ':%s' %
-000256f0: 206f 732e 6765 7463 7764 2829 0a20 2020   os.getcwd().   
-00025700: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
-00025710: 732e 7061 7468 2e64 6972 6e61 6d65 286f  s.path.dirname(o
-00025720: 7065 6e73 6869 6674 2e63 7265 6174 652e  penshift.create.
-00025730: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
-00025740: 6e61 6d65 290a 2020 2020 2020 2020 646e  name).        dn
-00025750: 7363 6c69 656e 7420 3d20 6f76 6572 7269  sclient = overri
-00025760: 6465 732e 6765 7428 2764 6e73 636c 6965  des.get('dnsclie
-00025770: 6e74 2729 0a20 2020 2020 2020 2064 6e73  nt').        dns
-00025780: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
-00025790: 2863 6c69 656e 743d 646e 7363 6c69 656e  (client=dnsclien
-000257a0: 7429 2069 6620 646e 7363 6c69 656e 7420  t) if dnsclient 
-000257b0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-000257c0: 204e 6f6e 650a 2020 2020 2020 2020 7265   None.        re
-000257d0: 7475 726e 206f 7065 6e73 6869 6674 2e63  turn openshift.c
-000257e0: 7265 6174 6528 7365 6c66 2c20 706c 616e  reate(self, plan
-000257f0: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
-00025800: 6572 7269 6465 732c 2064 6e73 636f 6e66  errides, dnsconf
-00025810: 6967 3d64 6e73 636f 6e66 6967 290a 0a20  ig=dnsconfig).. 
-00025820: 2020 2064 6566 2064 656c 6574 655f 6b75     def delete_ku
-00025830: 6265 2873 656c 662c 2063 6c75 7374 6572  be(self, cluster
-00025840: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
-00025850: 0a20 2020 2020 2020 2068 7970 6572 7368  .        hypersh
-00025860: 6966 7420 3d20 4661 6c73 650a 2020 2020  ift = False.    
-00025870: 2020 2020 6173 7369 7374 6564 203d 2046      assisted = F
-00025880: 616c 7365 0a20 2020 2020 2020 2064 6f6d  alse.        dom
-00025890: 6169 6e20 3d20 6f76 6572 7269 6465 732e  ain = overrides.
-000258a0: 6765 7428 2764 6f6d 6169 6e27 2c20 276b  get('domain', 'k
-000258b0: 6172 6d61 6c61 6273 2e63 6f72 7027 290a  armalabs.corp').
-000258c0: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
-000258d0: 203d 2027 6765 6e65 7269 6327 0a20 2020   = 'generic'.   
-000258e0: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
-000258f0: 204e 6f6e 650a 2020 2020 2020 2020 6b20   None.        k 
-00025900: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
-00025910: 2069 6620 7365 6c66 2e74 7970 6520 3d3d   if self.type ==
-00025920: 2027 7765 6227 2061 6e64 2073 656c 662e   'web' and self.
-00025930: 6b2e 6c6f 6361 6c6b 7562 653a 0a20 2020  k.localkube:.   
-00025940: 2020 2020 2020 2020 206b 7562 6574 7970           kubetyp
-00025950: 6520 3d20 6f76 6572 7269 6465 732e 6765  e = overrides.ge
-00025960: 7428 276b 7562 6574 7970 6527 2c20 2767  t('kubetype', 'g
-00025970: 656e 6572 6963 2729 0a20 2020 2020 2020  eneric').       
-00025980: 2020 2020 2072 6574 7572 6e20 6b2e 6465       return k.de
-00025990: 6c65 7465 5f6b 7562 6528 636c 7573 7465  lete_kube(cluste
-000259a0: 722c 206b 7562 6574 7970 652c 206f 7665  r, kubetype, ove
-000259b0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-000259c0: 290a 2020 2020 2020 2020 636c 7573 7465  ).        cluste
-000259d0: 7220 3d20 6f76 6572 7269 6465 732e 6765  r = overrides.ge
-000259e0: 7428 2763 6c75 7374 6572 272c 2063 6c75  t('cluster', clu
-000259f0: 7374 6572 290a 2020 2020 2020 2020 6966  ster).        if
-00025a00: 2063 6c75 7374 6572 2069 7320 4e6f 6e65   cluster is None
-00025a10: 206f 7220 636c 7573 7465 7220 3d3d 2027   or cluster == '
-00025a20: 273a 0a20 2020 2020 2020 2020 2020 2063  ':.            c
-00025a30: 6c75 7374 6572 203d 2027 6d79 6b75 6265  luster = 'mykube
-00025a40: 270a 2020 2020 2020 2020 636c 7573 7465  '.        cluste
-00025a50: 7264 6972 203d 206f 732e 7061 7468 2e65  rdir = os.path.e
-00025a60: 7870 616e 6475 7365 7228 6622 7e2f 2e6b  xpanduser(f"~/.k
-00025a70: 636c 692f 636c 7573 7465 7273 2f7b 636c  cli/clusters/{cl
-00025a80: 7573 7465 727d 2229 0a20 2020 2020 2020  uster}").       
-00025a90: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-00025aa0: 7473 2863 6c75 7374 6572 6469 7229 3a0a  ts(clusterdir):.
-00025ab0: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00025ac0: 6d65 7465 7273 6669 6c65 203d 2066 227b  metersfile = f"{
-00025ad0: 636c 7573 7465 7264 6972 7d2f 6b63 6c69  clusterdir}/kcli
-00025ae0: 5f70 6172 616d 6574 6572 732e 796d 6c22  _parameters.yml"
-00025af0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00025b00: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-00025b10: 6172 616d 6574 6572 7366 696c 6529 3a0a  arametersfile):.
-00025b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b30: 7769 7468 206f 7065 6e28 7061 7261 6d65  with open(parame
-00025b40: 7465 7273 6669 6c65 2920 6173 2066 3a0a  tersfile) as f:.
-00025b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b60: 2020 2020 636c 7573 7465 7264 6174 6120      clusterdata 
-00025b70: 3d20 7961 6d6c 2e73 6166 655f 6c6f 6164  = yaml.safe_load
-00025b80: 2866 290a 2020 2020 2020 2020 2020 2020  (f).            
-00025b90: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
-00025ba0: 203d 2063 6c75 7374 6572 6461 7461 2e67   = clusterdata.g
-00025bb0: 6574 2827 6b75 6265 7479 7065 272c 2027  et('kubetype', '
-00025bc0: 6765 6e65 7269 6327 290a 2020 2020 2020  generic').      
-00025bd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00025be0: 206b 7562 6574 7970 6520 3d3d 2027 6879   kubetype == 'hy
-00025bf0: 7065 7273 6869 6674 273a 0a20 2020 2020  pershift':.     
-00025c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c10: 2020 2068 7970 6572 7368 6966 7420 3d20     hypershift = 
-00025c20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00025c30: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-00025c40: 6973 7465 6420 3d20 636c 7573 7465 7264  isted = clusterd
-00025c50: 6174 612e 6765 7428 2761 7373 6973 7465  ata.get('assiste
-00025c60: 6427 2c20 4661 6c73 6529 0a20 2020 2020  d', False).     
-00025c70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00025c80: 6f6d 6169 6e20 3d20 636c 7573 7465 7264  omain = clusterd
-00025c90: 6174 612e 6765 7428 2764 6f6d 6169 6e27  ata.get('domain'
-00025ca0: 2c20 646f 6d61 696e 290a 2020 2020 2020  , domain).      
-00025cb0: 2020 2020 2020 2020 2020 2020 2020 646e                dn
-00025cc0: 7363 6c69 656e 7420 3d20 636c 7573 7465  sclient = cluste
-00025cd0: 7264 6174 612e 6765 7428 2764 6e73 636c  rdata.get('dnscl
-00025ce0: 6965 6e74 2729 0a20 2020 2020 2020 2020  ient').         
-00025cf0: 2020 2069 6620 6e6f 7420 6879 7065 7273     if not hypers
-00025d00: 6869 6674 3a0a 2020 2020 2020 2020 2020  hift:.          
-00025d10: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
-00025d20: 656c 6574 696e 6720 6469 7265 6374 6f72  eleting director
-00025d30: 7920 7b63 6c75 7374 6572 6469 727d 2229  y {clusterdir}")
-00025d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025d50: 2072 6d74 7265 6528 636c 7573 7465 7264   rmtree(clusterd
-00025d60: 6972 290a 2020 2020 2020 2020 6465 6c65  ir).        dele
-00025d70: 7465 636c 6965 6e74 7320 3d20 7b73 656c  teclients = {sel
-00025d80: 662e 636c 6965 6e74 3a20 6b7d 0a20 2020  f.client: k}.   
-00025d90: 2020 2020 2076 6d63 6c69 656e 7473 203d       vmclients =
-00025da0: 205b 5d0a 2020 2020 2020 2020 766d 636c   [].        vmcl
-00025db0: 6965 6e74 735f 6669 6c65 203d 206f 732e  ients_file = os.
-00025dc0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-00025dd0: 6627 7e2f 2e6b 636c 692f 766d 636c 6965  f'~/.kcli/vmclie
-00025de0: 6e74 735f 7b63 6c75 7374 6572 7d27 290a  nts_{cluster}').
-00025df0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00025e00: 7468 2e65 7869 7374 7328 766d 636c 6965  th.exists(vmclie
-00025e10: 6e74 735f 6669 6c65 293a 0a20 2020 2020  nts_file):.     
-00025e20: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
-00025e30: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
-00025e40: 6428 6f70 656e 2876 6d63 6c69 656e 7473  d(open(vmclients
-00025e50: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
-00025e60: 2020 2020 6f73 2e72 656d 6f76 6528 766d      os.remove(vm
-00025e70: 636c 6965 6e74 735f 6669 6c65 290a 2020  clients_file).  
-00025e80: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-00025e90: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
-00025ea0: 2020 2020 2020 2020 6465 6c65 7465 636c          deletecl
-00025eb0: 6965 6e74 732e 7570 6461 7465 2873 656c  ients.update(sel
-00025ec0: 662e 6578 7472 6163 6c69 656e 7473 290a  f.extraclients).
-00025ed0: 2020 2020 2020 2020 656c 6966 2076 6d63          elif vmc
-00025ee0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-00025ef0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
-00025f00: 732e 7570 6461 7465 287b 636c 693a 204b  s.update({cli: K
-00025f10: 636f 6e66 6967 2863 6c69 656e 743d 636c  config(client=cl
-00025f20: 6929 2e6b 2066 6f72 2063 6c69 2069 6e20  i).k for cli in 
-00025f30: 766d 636c 6965 6e74 7320 6966 2063 6c69  vmclients if cli
-00025f40: 2021 3d20 7365 6c66 2e63 6c69 656e 747d   != self.client}
-00025f50: 290a 2020 2020 2020 2020 666f 7220 6879  ).        for hy
-00025f60: 7065 7276 6973 6f72 2069 6e20 6465 6c65  pervisor in dele
-00025f70: 7465 636c 6965 6e74 733a 0a20 2020 2020  teclients:.     
-00025f80: 2020 2020 2020 2063 203d 2064 656c 6574         c = delet
-00025f90: 6563 6c69 656e 7473 5b68 7970 6572 7669  eclients[hypervi
-00025fa0: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
-00025fb0: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
-00025fc0: 6428 632e 6c69 7374 2829 2c20 6b65 793d  d(c.list(), key=
-00025fd0: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
-00025fe0: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
-00025ff0: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
-00026000: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
-00026010: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-00026020: 7420 3d20 766d 2e67 6574 2827 646e 7363  t = vm.get('dnsc
-00026030: 6c69 656e 7427 2920 6f72 2064 6e73 636c  lient') or dnscl
-00026040: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
-00026050: 2020 2020 2063 7572 7265 6e74 636c 7573       currentclus
-00026060: 7465 7220 3d20 766d 2e67 6574 2827 6b75  ter = vm.get('ku
-00026070: 6265 2729 0a20 2020 2020 2020 2020 2020  be').           
-00026080: 2020 2020 2069 6620 6375 7272 656e 7463       if currentc
-00026090: 6c75 7374 6572 2069 7320 6e6f 7420 4e6f  luster is not No
-000260a0: 6e65 2061 6e64 2063 7572 7265 6e74 636c  ne and currentcl
-000260b0: 7573 7465 7220 3d3d 2063 6c75 7374 6572  uster == cluster
-000260c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000260d0: 2020 2020 2020 632e 6465 6c65 7465 286e        c.delete(n
-000260e0: 616d 652c 2073 6e61 7073 686f 7473 3d54  ame, snapshots=T
-000260f0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00026100: 2020 2020 2020 2020 2063 6f6d 6d6f 6e2e           common.
-00026110: 7365 745f 6c61 7374 766d 286e 616d 652c  set_lastvm(name,
-00026120: 2073 656c 662e 636c 6965 6e74 2c20 6465   self.client, de
-00026130: 6c65 7465 3d54 7275 6529 0a20 2020 2020  lete=True).     
-00026140: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00026150: 7563 6365 7373 2866 227b 6e61 6d65 7d20  uccess(f"{name} 
-00026160: 6465 6c65 7465 6420 6f6e 207b 6879 7065  deleted on {hype
-00026170: 7276 6973 6f72 7d21 2229 0a20 2020 2020  rvisor}!").     
-00026180: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-00026190: 3d3d 2027 6b75 6265 7669 7274 273a 0a20  == 'kubevirt':. 
-000261a0: 2020 2020 2020 2020 2020 2069 6620 6622             if f"
-000261b0: 7b63 6c75 7374 6572 7d2d 6170 6922 2069  {cluster}-api" i
-000261c0: 6e20 6b2e 6c69 7374 5f73 6572 7669 6365  n k.list_service
-000261d0: 7328 6b2e 6e61 6d65 7370 6163 6529 3a0a  s(k.namespace):.
-000261e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261f0: 6b2e 6465 6c65 7465 5f73 6572 7669 6365  k.delete_service
-00026200: 2866 227b 636c 7573 7465 727d 2d61 7069  (f"{cluster}-api
-00026210: 222c 206b 2e6e 616d 6573 7061 6365 290a  ", k.namespace).
-00026220: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00026230: 227b 636c 7573 7465 727d 2d69 6e67 7265  "{cluster}-ingre
-00026240: 7373 2220 696e 206b 2e6c 6973 745f 7365  ss" in k.list_se
-00026250: 7276 6963 6573 286b 2e6e 616d 6573 7061  rvices(k.namespa
-00026260: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
-00026270: 2020 2020 206b 2e64 656c 6574 655f 7365       k.delete_se
-00026280: 7276 6963 6528 6622 7b63 6c75 7374 6572  rvice(f"{cluster
-00026290: 7d2d 696e 6772 6573 7322 2c20 6b2e 6e61  }-ingress", k.na
-000262a0: 6d65 7370 6163 6529 0a20 2020 2020 2020  mespace).       
-000262b0: 2069 6620 7365 6c66 2e74 7970 6520 696e   if self.type in
-000262c0: 205b 2761 7773 272c 2027 6763 7027 2c20   ['aws', 'gcp', 
-000262d0: 2769 626d 275d 3a0a 2020 2020 2020 2020  'ibm']:.        
-000262e0: 2020 2020 6c62 7320 3d20 5b27 6170 6927      lbs = ['api'
-000262f0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00026300: 206b 7562 6574 7970 6520 6e6f 7420 696e   kubetype not in
-00026310: 205b 276b 3373 272c 2027 6765 6e65 7269   ['k3s', 'generi
-00026320: 6327 5d3a 0a20 2020 2020 2020 2020 2020  c']:.           
-00026330: 2020 2020 206c 6273 2e61 7070 656e 6428       lbs.append(
-00026340: 2761 7070 7327 290a 2020 2020 2020 2020  'apps').        
-00026350: 2020 2020 666f 7220 6c62 2069 6e20 6c62      for lb in lb
-00026360: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00026370: 2020 2073 656c 662e 6465 6c65 7465 5f6c     self.delete_l
-00026380: 6f61 6462 616c 616e 6365 7228 6622 7b6c  oadbalancer(f"{l
-00026390: 627d 2e7b 636c 7573 7465 727d 222c 2064  b}.{cluster}", d
-000263a0: 6f6d 6169 6e3d 646f 6d61 696e 290a 2020  omain=domain).  
-000263b0: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
-000263c0: 203d 2066 227b 636c 7573 7465 727d 2d7b   = f"{cluster}-{
-000263d0: 646f 6d61 696e 7d22 0a20 2020 2020 2020  domain}".       
-000263e0: 2020 2020 2069 6620 6275 636b 6574 2069       if bucket i
-000263f0: 6e20 7365 6c66 2e6b 2e6c 6973 745f 6275  n self.k.list_bu
-00026400: 636b 6574 7328 293a 0a20 2020 2020 2020  ckets():.       
-00026410: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00026420: 6622 4465 6c65 7469 6e67 2062 7563 6b65  f"Deleting bucke
-00026430: 7420 7b62 7563 6b65 747d 2229 0a20 2020  t {bucket}").   
-00026440: 2020 2020 2020 2020 2020 2020 206b 2e64               k.d
-00026450: 656c 6574 655f 6275 636b 6574 2862 7563  elete_bucket(buc
-00026460: 6b65 7429 0a20 2020 2020 2020 2065 6c69  ket).        eli
-00026470: 6620 646e 7363 6c69 656e 7420 6973 206e  f dnsclient is n
-00026480: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00026490: 2020 2020 207a 203d 204b 636f 6e66 6967       z = Kconfig
-000264a0: 2863 6c69 656e 743d 646e 7363 6c69 656e  (client=dnsclien
-000264b0: 7429 2e6b 0a20 2020 2020 2020 2020 2020  t).k.           
-000264c0: 207a 2e64 656c 6574 655f 646e 7328 6622   z.delete_dns(f"
-000264d0: 6170 692e 7b63 6c75 7374 6572 7d22 2c20  api.{cluster}", 
-000264e0: 646f 6d61 696e 290a 2020 2020 2020 2020  domain).        
-000264f0: 2020 2020 7a2e 6465 6c65 7465 5f64 6e73      z.delete_dns
-00026500: 2866 2261 7070 732e 7b63 6c75 7374 6572  (f"apps.{cluster
-00026510: 7d22 2c20 646f 6d61 696e 290a 2020 2020  }", domain).    
-00026520: 2020 2020 6966 2068 7970 6572 7368 6966      if hypershif
-00026530: 743a 0a20 2020 2020 2020 2020 2020 206b  t:.            k
-00026540: 7562 6563 6f6e 6669 676d 676d 7420 3d20  ubeconfigmgmt = 
-00026550: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
-00026560: 7562 6563 6f6e 6669 672e 6d67 6d74 220a  ubeconfig.mgmt".
-00026570: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00026580: 2866 274b 5542 4543 4f4e 4649 473d 7b6b  (f'KUBECONFIG={k
-00026590: 7562 6563 6f6e 6669 676d 676d 747d 206f  ubeconfigmgmt} o
-000265a0: 6320 6465 6c65 7465 202d 6620 7b63 6c75  c delete -f {clu
-000265b0: 7374 6572 6469 727d 2f61 7574 6f61 7070  sterdir}/autoapp
-000265c0: 726f 7665 7263 726f 6e2e 796d 6c27 2c20  rovercron.yml', 
-000265d0: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-000265e0: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
-000265f0: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
-00026600: 6f6e 6669 676d 676d 747d 206f 6320 6465  onfigmgmt} oc de
-00026610: 6c65 7465 202d 6620 7b63 6c75 7374 6572  lete -f {cluster
-00026620: 6469 727d 2f6e 6f64 6570 6f6f 6c2e 7961  dir}/nodepool.ya
-00026630: 6d6c 272c 2073 6865 6c6c 3d54 7275 6529  ml', shell=True)
-00026640: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-00026650: 6c28 6627 4b55 4245 434f 4e46 4947 3d7b  l(f'KUBECONFIG={
-00026660: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-00026670: 6f63 2064 656c 6574 6520 2d66 207b 636c  oc delete -f {cl
-00026680: 7573 7465 7264 6972 7d2f 686f 7374 6564  usterdir}/hosted
-00026690: 636c 7573 7465 722e 7961 6d6c 272c 2073  cluster.yaml', s
-000266a0: 6865 6c6c 3d54 7275 6529 0a20 2020 2020  hell=True).     
-000266b0: 2020 2020 2020 2069 6620 6e6f 7420 6173         if not as
-000266c0: 7369 7374 6564 2061 6e64 2028 2762 6172  sisted and ('bar
-000266d0: 656d 6574 616c 5f69 736f 2720 696e 2063  emetal_iso' in c
-000266e0: 6c75 7374 6572 6461 7461 206f 7220 2762  lusterdata or 'b
-000266f0: 6172 656d 6574 616c 5f68 6f73 7473 2720  aremetal_hosts' 
-00026700: 696e 2063 6c75 7374 6572 6461 7461 293a  in clusterdata):
-00026710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026720: 2063 616c 6c28 6627 4b55 4245 434f 4e46   call(f'KUBECONF
-00026730: 4947 3d7b 6b75 6265 636f 6e66 6967 6d67  IG={kubeconfigmg
-00026740: 6d74 7d20 6f63 202d 6e20 6465 6661 756c  mt} oc -n defaul
-00026750: 7420 6465 6c65 7465 2061 6c6c 202d 6c20  t delete all -l 
-00026760: 6170 703d 6874 7470 642d 6b63 6c69 272c  app=httpd-kcli',
-00026770: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00026780: 2020 2020 2020 2020 2020 2020 2063 616c               cal
-00026790: 6c28 6627 4b55 4245 434f 4e46 4947 3d7b  l(f'KUBECONFIG={
-000267a0: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-000267b0: 6f63 202d 6e20 6465 6661 756c 7420 6465  oc -n default de
-000267c0: 6c65 7465 2070 7663 2068 7474 7064 2d6b  lete pvc httpd-k
-000267d0: 636c 692d 7076 6327 2c20 7368 656c 6c3d  cli-pvc', shell=
-000267e0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000267f0: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
-00026800: 696e 6720 6469 7265 6374 6f72 7920 7b63  ing directory {c
-00026810: 6c75 7374 6572 6469 727d 2229 0a20 2020  lusterdir}").   
-00026820: 2020 2020 2020 2020 2072 6d74 7265 6528           rmtree(
-00026830: 636c 7573 7465 7264 6972 290a 2020 2020  clusterdir).    
-00026840: 2020 2020 666f 7220 636f 6e66 706f 6f6c      for confpool
-00026850: 2069 6e20 7365 6c66 2e63 6f6e 6670 6f6f   in self.confpoo
-00026860: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
-00026870: 6970 5f72 6573 6572 7661 7469 6f6e 7320  ip_reservations 
-00026880: 3d20 7365 6c66 2e63 6f6e 6670 6f6f 6c73  = self.confpools
-00026890: 5b63 6f6e 6670 6f6f 6c5d 2e67 6574 2827  [confpool].get('
-000268a0: 6970 5f72 6573 6572 7661 7469 6f6e 7327  ip_reservations'
-000268b0: 2c20 7b7d 290a 2020 2020 2020 2020 2020  , {}).          
-000268c0: 2020 6966 2063 6c75 7374 6572 2069 6e20    if cluster in 
-000268d0: 6970 5f72 6573 6572 7661 7469 6f6e 733a  ip_reservations:
-000268e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000268f0: 2064 656c 2069 705f 7265 7365 7276 6174   del ip_reservat
-00026900: 696f 6e73 5b63 6c75 7374 6572 5d0a 2020  ions[cluster].  
-00026910: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00026920: 6c66 2e75 7064 6174 655f 636f 6e66 706f  lf.update_confpo
-00026930: 6f6c 2863 6f6e 6670 6f6f 6c2c 207b 2769  ol(confpool, {'i
-00026940: 705f 7265 7365 7276 6174 696f 6e73 273a  p_reservations':
-00026950: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
-00026960: 7d29 0a20 2020 2020 2020 2020 2020 206e  }).            n
-00026970: 616d 655f 7265 7365 7276 6174 696f 6e73  ame_reservations
-00026980: 203d 2073 656c 662e 636f 6e66 706f 6f6c   = self.confpool
-00026990: 735b 636f 6e66 706f 6f6c 5d2e 6765 7428  s[confpool].get(
-000269a0: 276e 616d 655f 7265 7365 7276 6174 696f  'name_reservatio
-000269b0: 6e73 272c 205b 5d29 0a20 2020 2020 2020  ns', []).       
-000269c0: 2020 2020 2069 6620 636c 7573 7465 7220       if cluster 
-000269d0: 696e 206e 616d 655f 7265 7365 7276 6174  in name_reservat
-000269e0: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
-000269f0: 2020 2020 2020 6e61 6d65 5f72 6573 6572        name_reser
-00026a00: 7661 7469 6f6e 732e 7265 6d6f 7665 2863  vations.remove(c
-00026a10: 6c75 7374 6572 290a 2020 2020 2020 2020  luster).        
-00026a20: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00026a30: 6174 655f 636f 6e66 706f 6f6c 2863 6f6e  ate_confpool(con
-00026a40: 6670 6f6f 6c2c 207b 276e 616d 655f 7265  fpool, {'name_re
-00026a50: 7365 7276 6174 696f 6e73 273a 206e 616d  servations': nam
-00026a60: 655f 7265 7365 7276 6174 696f 6e73 7d29  e_reservations})
-00026a70: 0a20 2020 2020 2020 2020 2020 2063 6c75  .            clu
+00021610: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
+00021620: 6f6e 2e67 6574 5f6c 6174 6573 745f 6663  on.get_latest_fc
+00021630: 6f73 2875 726c 2c20 5f74 7970 653d 696d  os(url, _type=im
+00021640: 6167 655f 7479 7065 290a 2020 2020 2020  age_type).      
+00021650: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021660: 2069 6d61 6765 203d 3d20 2766 6564 6f72   image == 'fedor
+00021670: 616c 6174 6573 7427 3a0a 2020 2020 2020  alatest':.      
+00021680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021690: 2020 7572 6c20 3d20 636f 6d6d 6f6e 2e67    url = common.g
+000216a0: 6574 5f6c 6174 6573 745f 6665 646f 7261  et_latest_fedora
+000216b0: 2875 726c 290a 2020 2020 2020 2020 2020  (url).          
+000216c0: 2020 2020 2020 2020 2020 696d 6167 6520            image 
+000216d0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+000216e0: 6d65 2869 6d61 6765 290a 2020 2020 2020  me(image).      
+000216f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021700: 2069 6d61 6765 2e73 7461 7274 7377 6974   image.startswit
+00021710: 6828 2772 6865 6c27 293a 0a20 2020 2020  h('rhel'):.     
+00021720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021730: 2020 2069 6620 2777 6562 2720 696e 2073     if 'web' in s
+00021740: 7973 2e61 7267 765b 305d 3a0a 2020 2020  ys.argv[0]:.    
+00021750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021760: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00021770: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+00021780: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
+00021790: 4d69 7373 696e 6720 7572 6c22 7d0a 2020  Missing url"}.  
+000217a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000217b0: 2020 2020 2020 7070 7269 6e74 2866 224f        pprint(f"O
+000217c0: 7065 6e69 6e67 2075 726c 207b 7572 6c7d  pening url {url}
+000217d0: 2066 6f72 2079 6f75 2074 6f20 6772 6162   for you to grab
+000217e0: 2063 6f6d 706c 6574 6520 7572 6c20 666f   complete url fo
+000217f0: 7220 7b69 6d61 6765 7d20 6b76 6d20 6775  r {image} kvm gu
+00021800: 6573 7420 696d 6167 6522 290a 2020 2020  est image").    
+00021810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021820: 2020 2020 7765 6262 726f 7773 6572 2e6f      webbrowser.o
+00021830: 7065 6e28 7572 6c2c 206e 6577 3d32 2c20  pen(url, new=2, 
+00021840: 6175 746f 7261 6973 653d 5472 7565 290a  autoraise=True).
+00021850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021860: 2020 2020 2020 2020 7572 6c20 3d20 696e          url = in
+00021870: 7075 7428 2243 6f70 7920 5572 6c3a 5c6e  put("Copy Url:\n
+00021880: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00021890: 2020 2020 2020 2020 2020 2069 6620 7572             if ur
+000218a0: 6c2e 7374 7269 7028 2920 3d3d 2027 273a  l.strip() == '':
+000218b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000218c0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+000218d0: 6f72 2822 4d69 7373 696e 6720 7072 6f70  or("Missing prop
+000218e0: 6572 2075 726c 2e4c 6561 7669 6e67 2e2e  er url.Leaving..
+000218f0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00021900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021910: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00021920: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+00021930: 6173 6f6e 273a 2022 4d69 7373 696e 6720  ason': "Missing 
+00021940: 696d 6167 6522 7d0a 2020 2020 2020 2020  image"}.        
+00021950: 2020 2020 2020 2020 6966 2063 6d64 2069          if cmd i
+00021960: 7320 4e6f 6e65 2061 6e64 2069 6d61 6765  s None and image
+00021970: 2021 3d20 2727 2061 6e64 2069 6d61 6765   != '' and image
+00021980: 2069 6e20 494d 4147 4553 434f 4d4d 414e   in IMAGESCOMMAN
+00021990: 4453 3a0a 2020 2020 2020 2020 2020 2020  DS:.            
+000219a0: 2020 2020 2020 2020 636d 6420 3d20 494d          cmd = IM
+000219b0: 4147 4553 434f 4d4d 414e 4453 5b69 6d61  AGESCOMMANDS[ima
+000219c0: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
+000219d0: 2020 2020 7070 7269 6e74 2866 2247 7261      pprint(f"Gra
+000219e0: 6262 696e 6720 696d 6167 6520 7b69 6d61  bbing image {ima
+000219f0: 6765 7d20 6672 6f6d 2075 726c 207b 7572  ge} from url {ur
+00021a00: 6c7d 2229 0a20 2020 2020 2020 2020 2020  l}").           
+00021a10: 2020 2020 206e 6565 645f 6973 6f20 3d20       need_iso = 
+00021a20: 2761 7069 2f61 7373 6973 7465 642d 696d  'api/assisted-im
+00021a30: 6167 6573 2f69 6d61 6765 7327 2069 6e20  ages/images' in 
+00021a40: 7572 6c0a 2020 2020 2020 2020 2020 2020  url.            
+00021a50: 2020 2020 7368 6f72 746e 616d 6520 3d20      shortname = 
+00021a60: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00021a70: 2875 726c 292e 7370 6c69 7428 273f 2729  (url).split('?')
+00021a80: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00021a90: 2020 2020 6966 206e 6565 645f 6973 6f3a      if need_iso:
+00021aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021ab0: 2020 2020 2069 6d61 6765 203d 2066 2762       image = f'b
+00021ac0: 6f6f 742d 7b73 686f 7274 6e61 6d65 7d2e  oot-{shortname}.
+00021ad0: 6973 6f27 0a20 2020 2020 2020 2020 2020  iso'.           
+00021ae0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00021af0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00021b00: 6e76 6572 7420 3d20 272e 7261 772e 2720  nvert = '.raw.' 
+00021b10: 696e 2075 726c 0a20 2020 2020 2020 2020  in url.         
+00021b20: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00021b30: 7420 3d20 6b2e 6164 645f 696d 6167 6528  t = k.add_image(
+00021b40: 7572 6c2c 2070 6f6f 6c2c 2063 6d64 3d63  url, pool, cmd=c
+00021b50: 6d64 2c20 6e61 6d65 3d69 6d61 6765 2c20  md, name=image, 
+00021b60: 7369 7a65 3d73 697a 652c 2063 6f6e 7665  size=size, conve
+00021b70: 7274 3d63 6f6e 7665 7274 290a 2020 2020  rt=convert).    
+00021b80: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00021b90: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00021ba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00021bb0: 2020 2020 2020 2065 7272 6f72 2866 2247         error(f"G
+00021bc0: 6f74 207b 657d 2229 0a20 2020 2020 2020  ot {e}").       
+00021bd0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00021be0: 6f72 2866 2250 6c65 6173 6520 7275 6e20  or(f"Please run 
+00021bf0: 6b63 6c69 2064 656c 6574 6520 696d 6167  kcli delete imag
+00021c00: 6520 2d2d 7965 7320 7b73 686f 7274 6e61  e --yes {shortna
+00021c10: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00021c20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00021c30: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+00021c40: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
+00021c50: 2022 5573 6572 2069 6e74 6572 7275 7074   "User interrupt
+00021c60: 696f 6e22 7d0a 2020 2020 2020 2020 2020  ion"}.          
+00021c70: 2020 2020 2020 666f 756e 6420 3d20 2766        found = 'f
+00021c80: 6f75 6e64 2720 696e 2072 6573 756c 740a  ound' in result.
+00021c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ca0: 6966 2066 6f75 6e64 3a0a 2020 2020 2020  if found:.      
+00021cb0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00021cc0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00021cd0: 2773 7563 6365 7373 277d 0a20 2020 2020  'success'}.     
+00021ce0: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
+00021cf0: 6e2e 6861 6e64 6c65 5f72 6573 706f 6e73  n.handle_respons
+00021d00: 6528 7265 7375 6c74 2c20 696d 6167 652c  e(result, image,
+00021d10: 2065 6c65 6d65 6e74 3d27 496d 6167 6527   element='Image'
+00021d20: 2c20 6163 7469 6f6e 3d27 4164 6465 6427  , action='Added'
+00021d30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021d40: 2020 6966 2072 6573 756c 745b 2772 6573    if result['res
+00021d50: 756c 7427 5d20 213d 2027 7375 6363 6573  ult'] != 'succes
+00021d60: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+00021d70: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00021d80: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+00021d90: 7265 272c 2027 7265 6173 6f6e 273a 2072  re', 'reason': r
+00021da0: 6573 756c 745b 2772 6561 736f 6e27 5d7d  esult['reason']}
+00021db0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00021dc0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00021dd0: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
+00021de0: 2020 656c 6966 2073 7769 7463 683a 0a20    elif switch:. 
+00021df0: 2020 2020 2020 2020 2020 2069 6620 7377             if sw
+00021e00: 6974 6368 206e 6f74 2069 6e20 7365 6c66  itch not in self
+00021e10: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
+00021e20: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00021e30: 6622 436c 6965 6e74 207b 7377 6974 6368  f"Client {switch
+00021e40: 7d20 6e6f 7420 666f 756e 6420 696e 2063  } not found in c
+00021e50: 6f6e 6669 672e 4c65 6176 696e 672e 2e2e  onfig.Leaving...
+00021e60: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00021e70: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00021e80: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
+00021e90: 2027 7265 6173 6f6e 273a 2066 2243 6c69   'reason': f"Cli
+00021ea0: 656e 7420 7b73 7769 7463 687d 206e 6f74  ent {switch} not
+00021eb0: 2066 6f75 6e64 2069 6e20 636f 6e66 6967   found in config
+00021ec0: 227d 0a20 2020 2020 2020 2020 2020 2065  "}.            e
+00021ed0: 6e61 626c 6564 203d 2073 656c 662e 696e  nabled = self.in
+00021ee0: 695b 7377 6974 6368 5d2e 6765 7428 2765  i[switch].get('e
+00021ef0: 6e61 626c 6564 272c 2054 7275 6529 0a20  nabled', True). 
+00021f00: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00021f10: 7420 656e 6162 6c65 643a 0a20 2020 2020  t enabled:.     
+00021f20: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00021f30: 2866 2243 6c69 656e 7420 7b73 7769 7463  (f"Client {switc
+00021f40: 687d 2069 7320 6469 7361 626c 6564 2e4c  h} is disabled.L
+00021f50: 6561 7669 6e67 2e2e 2e2e 2229 0a20 2020  eaving....").   
+00021f60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00021f70: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00021f80: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+00021f90: 6e27 3a20 6622 436c 6965 6e74 207b 7377  n': f"Client {sw
+00021fa0: 6974 6368 7d20 6973 2064 6973 6162 6c65  itch} is disable
+00021fb0: 6422 7d0a 2020 2020 2020 2020 2020 2020  d"}.            
+00021fc0: 7070 7269 6e74 2866 2253 7769 7463 6869  pprint(f"Switchi
+00021fd0: 6e67 2074 6f20 636c 6965 6e74 207b 7377  ng to client {sw
+00021fe0: 6974 6368 7d2e 2e2e 2229 0a20 2020 2020  itch}...").     
+00021ff0: 2020 2020 2020 2069 6e69 6669 6c65 203d         inifile =
+00022000: 2022 2573 2f2e 6b63 6c69 2f63 6f6e 6669   "%s/.kcli/confi
+00022010: 672e 796d 6c22 2025 206f 732e 656e 7669  g.yml" % os.envi
+00022020: 726f 6e2e 6765 7428 2748 4f4d 4527 290a  ron.get('HOME').
+00022030: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00022040: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
+00022050: 6966 696c 6529 3a0a 2020 2020 2020 2020  ifile):.        
+00022060: 2020 2020 2020 2020 6e65 7769 6e69 203d          newini =
+00022070: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+00022080: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+00022090: 6f70 656e 2869 6e69 6669 6c65 292e 7265  open(inifile).re
+000220a0: 6164 6c69 6e65 7328 293a 0a20 2020 2020  adlines():.     
+000220b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000220c0: 6620 2763 6c69 656e 7427 2069 6e20 6c69  f 'client' in li
+000220d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000220e0: 2020 2020 2020 2020 2020 2020 6e65 7769              newi
+000220f0: 6e69 202b 3d20 6622 2063 6c69 656e 743a  ni += f" client:
+00022100: 207b 7377 6974 6368 7d5c 6e22 0a20 2020   {switch}\n".   
+00022110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022120: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00022130: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00022140: 6577 696e 6920 2b3d 206c 696e 650a 2020  ewini += line.  
+00022150: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+00022160: 656e 2869 6e69 6669 6c65 2c20 2777 2729  en(inifile, 'w')
+00022170: 2e77 7269 7465 286e 6577 696e 6929 0a20  .write(newini). 
+00022180: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022190: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+000221a0: 6363 6573 7327 7d0a 2020 2020 2020 2020  ccess'}.        
+000221b0: 656c 6966 2073 796e 633a 0a20 2020 2020  elif sync:.     
+000221c0: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+000221d0: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
+000221e0: 206e 6f74 2073 656c 662e 6578 7472 6163   not self.extrac
+000221f0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+00022200: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00022210: 224e 6f74 6869 6e67 2074 6f20 646f 2e20  "Nothing to do. 
+00022220: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
+00022230: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00022240: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00022250: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
+00022260: 2020 2020 2020 666f 7220 636c 6920 696e        for cli in
+00022270: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
+00022280: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00022290: 2020 2020 6465 7374 203d 2073 656c 662e      dest = self.
+000222a0: 6578 7472 6163 6c69 656e 7473 5b63 6c69  extraclients[cli
+000222b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000222c0: 2020 7070 7269 6e74 2866 2273 796e 6369    pprint(f"synci
+000222d0: 6e67 2063 6c69 656e 7420 696d 6167 6573  ng client images
+000222e0: 2066 726f 6d20 7b73 656c 662e 636c 6965   from {self.clie
+000222f0: 6e74 7d20 746f 207b 636c 697d 2229 0a20  nt} to {cli}"). 
+00022300: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00022310: 6172 6e69 6e67 2822 4e6f 7465 2072 6865  arning("Note rhe
+00022320: 6c20 696d 6167 6573 2061 7265 2063 7572  l images are cur
+00022330: 7265 6e74 6c79 206e 6f74 2073 796e 6365  rently not synce
+00022340: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+00022350: 666f 7220 766f 6c20 696e 206b 2e76 6f6c  for vol in k.vol
+00022360: 756d 6573 2829 3a0a 2020 2020 2020 2020  umes():.        
+00022370: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
+00022380: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00022390: 2876 6f6c 290a 2020 2020 2020 2020 2020  (vol).          
+000223a0: 2020 2020 2020 6966 2069 6d61 6765 2069        if image i
+000223b0: 6e20 5b6f 732e 7061 7468 2e62 6173 656e  n [os.path.basen
+000223c0: 616d 6528 7629 2066 6f72 2076 2069 6e20  ame(v) for v in 
+000223d0: 6465 7374 2e76 6f6c 756d 6573 2829 5d3a  dest.volumes()]:
+000223e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000223f0: 2020 2020 2077 6172 6e69 6e67 2866 2249       warning(f"I
+00022400: 676e 6f72 696e 6720 7b69 6d61 6765 7d20  gnoring {image} 
+00022410: 6173 2069 7427 7320 616c 7265 6164 7920  as it's already 
+00022420: 7468 6572 6522 290a 2020 2020 2020 2020  there").        
+00022430: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00022440: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00022450: 2020 2020 2075 726c 203d 204e 6f6e 650a       url = None.
+00022460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022470: 666f 7220 6e20 696e 206c 6973 7428 494d  for n in list(IM
+00022480: 4147 4553 2e76 616c 7565 7328 2929 3a0a  AGES.values()):.
+00022490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000224a0: 2020 2020 6966 206e 2069 7320 4e6f 6e65      if n is None
+000224b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000224c0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+000224d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+000224e0: 2020 2020 2020 2065 6c69 6620 6e2e 7370         elif n.sp
+000224f0: 6c69 7428 272f 2729 5b2d 315d 203d 3d20  lit('/')[-1] == 
+00022500: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
+00022510: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00022520: 726c 203d 206e 0a20 2020 2020 2020 2020  rl = n.         
+00022530: 2020 2020 2020 2069 6620 7572 6c20 6973         if url is
+00022540: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00022550: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00022560: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00022570: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+00022580: 3a20 2269 6d61 6765 206e 6f74 2069 6e20  : "image not in 
+00022590: 6465 6661 756c 7420 6c69 7374 227d 0a20  default list"}. 
+000225a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000225b0: 6620 696d 6167 652e 7374 6172 7473 7769  f image.startswi
+000225c0: 7468 2827 7268 656c 2729 3a0a 2020 2020  th('rhel'):.    
+000225d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225e0: 6966 2027 7765 6227 2069 6e20 7379 732e  if 'web' in sys.
+000225f0: 6172 6776 5b30 5d3a 0a20 2020 2020 2020  argv[0]:.       
+00022600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022610: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00022620: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+00022630: 6561 736f 6e27 3a20 224d 6973 7369 6e67  eason': "Missing
+00022640: 2075 726c 227d 0a20 2020 2020 2020 2020   url"}.         
+00022650: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00022660: 7428 6622 4f70 656e 696e 6720 7572 6c20  t(f"Opening url 
+00022670: 7b75 726c 7d20 666f 7220 796f 7520 746f  {url} for you to
+00022680: 2067 7261 6220 636f 6d70 6c65 7465 2075   grab complete u
+00022690: 726c 2066 6f72 207b 766f 6c7d 206b 766d  rl for {vol} kvm
+000226a0: 2067 7565 7374 2069 6d61 6765 2229 0a20   guest image"). 
+000226b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226c0: 2020 2077 6562 6272 6f77 7365 722e 6f70     webbrowser.op
+000226d0: 656e 2875 726c 2c20 6e65 773d 322c 2061  en(url, new=2, a
+000226e0: 7574 6f72 6169 7365 3d54 7275 6529 0a20  utoraise=True). 
+000226f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022700: 2020 2075 726c 203d 2069 6e70 7574 2822     url = input("
+00022710: 436f 7079 2055 726c 3a5c 6e22 290a 2020  Copy Url:\n").  
+00022720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022730: 2020 6966 2075 726c 2e73 7472 6970 2829    if url.strip()
+00022740: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
+00022750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022760: 6572 726f 7228 224d 6973 7369 6e67 2070  error("Missing p
+00022770: 726f 7065 7220 7572 6c2e 4c65 6176 696e  roper url.Leavin
+00022780: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
+00022790: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000227a0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+000227b0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+000227c0: 736f 6e27 3a20 224d 6973 7369 6e67 2069  son': "Missing i
+000227d0: 6d61 6765 227d 0a20 2020 2020 2020 2020  mage"}.         
+000227e0: 2020 2020 2020 2063 6d64 203d 204e 6f6e         cmd = Non
+000227f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00022800: 2020 6966 2076 6f6c 2069 6e20 494d 4147    if vol in IMAG
+00022810: 4553 434f 4d4d 414e 4453 3a0a 2020 2020  ESCOMMANDS:.    
+00022820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022830: 636d 6420 3d20 494d 4147 4553 434f 4d4d  cmd = IMAGESCOMM
+00022840: 414e 4453 5b69 6d61 6765 5d0a 2020 2020  ANDS[image].    
+00022850: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00022860: 6e74 2866 2247 7261 6262 696e 6720 696d  nt(f"Grabbing im
+00022870: 6167 6520 7b69 6d61 6765 7d2e 2e2e 2229  age {image}...")
+00022880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022890: 2064 6573 742e 6164 645f 696d 6167 6528   dest.add_image(
+000228a0: 7572 6c2c 2070 6f6f 6c2c 2063 6d64 3d63  url, pool, cmd=c
+000228b0: 6d64 290a 2020 2020 2020 2020 7265 7475  md).        retu
+000228c0: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
+000228d0: 7563 6365 7373 277d 0a0a 2020 2020 6465  uccess'}..    de
+000228e0: 6620 6465 6c65 7465 5f6c 6f61 6462 616c  f delete_loadbal
+000228f0: 616e 6365 7228 7365 6c66 2c20 6e61 6d65  ancer(self, name
+00022900: 2c20 646f 6d61 696e 3d4e 6f6e 6529 3a0a  , domain=None):.
+00022910: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
+00022920: 2e6b 0a20 2020 2020 2020 2070 7072 696e  .k.        pprin
+00022930: 7428 6622 4465 6c65 7469 6e67 206c 6f61  t(f"Deleting loa
+00022940: 6462 616c 616e 6365 7220 7b6e 616d 657d  dbalancer {name}
+00022950: 2229 0a20 2020 2020 2020 2069 6620 7365  ").        if se
+00022960: 6c66 2e74 7970 6520 696e 205b 2761 7773  lf.type in ['aws
+00022970: 272c 2027 6763 7027 2c20 2769 626d 275d  ', 'gcp', 'ibm']
+00022980: 3a0a 2020 2020 2020 2020 2020 2020 646e  :.            dn
+00022990: 7363 6c69 656e 7420 3d20 6b2e 6465 6c65  sclient = k.dele
+000229a0: 7465 5f6c 6f61 6462 616c 616e 6365 7228  te_loadbalancer(
+000229b0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+000229c0: 2020 6966 2064 6f6d 6169 6e20 6973 206e    if domain is n
+000229d0: 6f74 204e 6f6e 6520 616e 6420 646e 7363  ot None and dnsc
+000229e0: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
+000229f0: 6520 616e 6420 6973 696e 7374 616e 6365  e and isinstance
+00022a00: 2864 6e73 636c 6965 6e74 2c20 7374 7229  (dnsclient, str)
+00022a10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022a20: 2020 6966 2064 6e73 636c 6965 6e74 2069    if dnsclient i
+00022a30: 6e20 7365 6c66 2e63 6c69 656e 7473 3a0a  n self.clients:.
+00022a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a50: 2020 2020 7a20 3d20 4b63 6f6e 6669 6728      z = Kconfig(
+00022a60: 636c 6965 6e74 3d64 6e73 636c 6965 6e74  client=dnsclient
+00022a70: 292e 6b0a 2020 2020 2020 2020 2020 2020  ).k.            
+00022a80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00022a90: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00022aa0: 726e 696e 6728 6622 436c 6965 6e74 207b  rning(f"Client {
+00022ab0: 646e 7363 6c69 656e 747d 206e 6f74 2066  dnsclient} not f
+00022ac0: 6f75 6e64 2e20 536b 6970 7069 6e67 2229  ound. Skipping")
+00022ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ae0: 207a 2e64 656c 6574 655f 646e 7328 6e61   z.delete_dns(na
+00022af0: 6d65 2e72 6570 6c61 6365 2827 5f27 2c20  me.replace('_', 
+00022b00: 272d 2729 2c20 646f 6d61 696e 290a 2020  '-'), domain).  
+00022b10: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+00022b20: 7479 7065 203d 3d20 276b 766d 273a 0a20  type == 'kvm':. 
+00022b30: 2020 2020 2020 2020 2020 206b 2e64 656c             k.del
+00022b40: 6574 6528 6e61 6d65 290a 0a20 2020 2064  ete(name)..    d
+00022b50: 6566 2063 7265 6174 655f 6c6f 6164 6261  ef create_loadba
+00022b60: 6c61 6e63 6572 2873 656c 662c 206e 616d  lancer(self, nam
+00022b70: 652c 206e 6574 733d 5b27 6465 6661 756c  e, nets=['defaul
+00022b80: 7427 5d2c 2070 6f72 7473 3d5b 5d2c 2063  t'], ports=[], c
+00022b90: 6865 636b 7061 7468 3d27 2f27 2c20 766d  heckpath='/', vm
+00022ba0: 733d 5b5d 2c20 646f 6d61 696e 3d4e 6f6e  s=[], domain=Non
+00022bb0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00022bd0: 6c61 6e3d 4e6f 6e65 2c20 6368 6563 6b70  lan=None, checkp
+00022be0: 6f72 743d 3830 2c20 616c 6961 733d 5b5d  ort=80, alias=[]
+00022bf0: 2c20 696e 7465 726e 616c 3d46 616c 7365  , internal=False
+00022c00: 2c20 646e 7363 6c69 656e 743d 4e6f 6e65  , dnsclient=None
+00022c10: 2c20 7375 626e 6574 6964 3d4e 6f6e 6529  , subnetid=None)
+00022c20: 3a0a 2020 2020 2020 2020 6e61 6d65 203d  :.        name =
+00022c30: 206e 616d 6575 7469 6c73 2e67 6574 5f72   nameutils.get_r
+00022c40: 616e 646f 6d5f 6e61 6d65 2829 2e72 6570  andom_name().rep
+00022c50: 6c61 6365 2827 5f27 2c20 272d 2729 2069  lace('_', '-') i
+00022c60: 6620 6e61 6d65 2069 7320 4e6f 6e65 2065  f name is None e
+00022c70: 6c73 6520 6e61 6d65 0a20 2020 2020 2020  lse name.       
+00022c80: 2070 7072 696e 7428 6622 4465 706c 6f79   pprint(f"Deploy
+00022c90: 696e 6720 6c6f 6164 6261 6c61 6e63 6572  ing loadbalancer
+00022ca0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+00022cb0: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+00022cc0: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
+00022cd0: 6520 696e 205b 2761 7773 272c 2027 6763  e in ['aws', 'gc
+00022ce0: 7027 2c20 2769 626d 275d 3a0a 2020 2020  p', 'ibm']:.    
+00022cf0: 2020 2020 2020 2020 6c62 5f69 7020 3d20          lb_ip = 
+00022d00: 6b2e 6372 6561 7465 5f6c 6f61 6462 616c  k.create_loadbal
+00022d10: 616e 6365 7228 6e61 6d65 2c20 706f 7274  ancer(name, port
+00022d20: 733d 706f 7274 732c 2063 6865 636b 7061  s=ports, checkpa
+00022d30: 7468 3d63 6865 636b 7061 7468 2c20 766d  th=checkpath, vm
+00022d40: 733d 766d 732c 2064 6f6d 6169 6e3d 646f  s=vms, domain=do
+00022d50: 6d61 696e 2c0a 2020 2020 2020 2020 2020  main,.          
+00022d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d80: 6368 6563 6b70 6f72 743d 6368 6563 6b70  checkport=checkp
+00022d90: 6f72 742c 2061 6c69 6173 3d61 6c69 6173  ort, alias=alias
+00022da0: 2c20 696e 7465 726e 616c 3d69 6e74 6572  , internal=inter
+00022db0: 6e61 6c2c 0a20 2020 2020 2020 2020 2020  nal,.           
+00022dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022dd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00022de0: 6e73 636c 6965 6e74 3d64 6e73 636c 6965  nsclient=dnsclie
+00022df0: 6e74 2c20 7375 626e 6574 6964 3d73 7562  nt, subnetid=sub
+00022e00: 6e65 7469 6429 0a20 2020 2020 2020 2020  netid).         
+00022e10: 2020 2069 6620 646e 7363 6c69 656e 7420     if dnsclient 
+00022e20: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00022e30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00022e40: 646e 7363 6c69 656e 7420 696e 2073 656c  dnsclient in sel
+00022e50: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
+00022e60: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00022e70: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
+00022e80: 743d 646e 7363 6c69 656e 7429 2e6b 0a20  t=dnsclient).k. 
+00022e90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00022ea0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022eb0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00022ec0: 2866 2243 6c69 656e 7420 7b64 6e73 636c  (f"Client {dnscl
+00022ed0: 6965 6e74 7d20 6e6f 7420 666f 756e 642e  ient} not found.
+00022ee0: 2053 6b69 7070 696e 6722 290a 2020 2020   Skipping").    
+00022ef0: 2020 2020 2020 2020 2020 2020 7a2e 7265              z.re
+00022f00: 7365 7276 655f 646e 7328 6e61 6d65 2e72  serve_dns(name.r
+00022f10: 6570 6c61 6365 2827 5f27 2c20 272d 2729  eplace('_', '-')
+00022f20: 2c20 6970 3d6c 625f 6970 2c20 646f 6d61  , ip=lb_ip, doma
+00022f30: 696e 3d64 6f6d 6169 6e2c 2061 6c69 6173  in=domain, alias
+00022f40: 3d61 6c69 6173 290a 2020 2020 2020 2020  =alias).        
+00022f50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00022f60: 2020 766d 696e 666f 203d 205b 5d0a 2020    vminfo = [].  
+00022f70: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
+00022f80: 2069 6e20 766d 733a 0a20 2020 2020 2020   in vms:.       
+00022f90: 2020 2020 2020 2020 2069 6620 7661 6c69           if vali
+00022fa0: 645f 6970 2876 6d29 3a0a 2020 2020 2020  d_ip(vm):.      
+00022fb0: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+00022fc0: 6e61 6d65 203d 2076 6d2e 7265 706c 6163  name = vm.replac
+00022fd0: 6528 273a 272c 2027 2d27 292e 7265 706c  e(':', '-').repl
+00022fe0: 6163 6528 272e 272c 2027 2d27 290a 2020  ace('.', '-').  
+00022ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023000: 2020 766d 696e 666f 2e61 7070 656e 6428    vminfo.append(
+00023010: 7b27 6e61 6d65 273a 2076 6d6e 616d 652c  {'name': vmname,
+00023020: 2027 6970 273a 2076 6d7d 290a 2020 2020   'ip': vm}).    
+00023030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023040: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00023050: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
+00023060: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00023070: 2020 2020 2077 6869 6c65 2063 6f75 6e74       while count
+00023080: 6572 2021 3d20 3130 303a 0a20 2020 2020  er != 100:.     
+00023090: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000230a0: 7020 3d20 6b2e 6970 2876 6d29 0a20 2020  p = k.ip(vm).   
+000230b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230c0: 2069 6620 6970 2069 7320 4e6f 6e65 3a0a   if ip is None:.
+000230d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230e0: 2020 2020 2020 2020 736c 6565 7028 3529          sleep(5)
+000230f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023100: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00023110: 2257 6169 7469 6e67 2035 2073 6563 6f6e  "Waiting 5 secon
+00023120: 6473 2074 6f20 6772 6162 2069 7020 666f  ds to grab ip fo
+00023130: 7220 766d 207b 766d 7d2e 2e2e 2229 0a20  r vm {vm}..."). 
+00023140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023150: 2020 2020 2020 2063 6f75 6e74 6572 202b         counter +
+00023160: 3d20 350a 2020 2020 2020 2020 2020 2020  = 5.            
+00023170: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00023180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023190: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+000231a0: 2020 2020 2020 2020 2020 2020 766d 696e              vmin
+000231b0: 666f 2e61 7070 656e 6428 7b27 6e61 6d65  fo.append({'name
+000231c0: 273a 2076 6d2c 2027 6970 273a 2069 707d  ': vm, 'ip': ip}
+000231d0: 290a 2020 2020 2020 2020 2020 2020 6f76  ).            ov
+000231e0: 6572 7269 6465 7320 3d20 7b0a 2020 2020  errides = {.    
+000231f0: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
+00023200: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
+00023210: 2020 2020 2020 2020 2020 2276 6d73 223a            "vms":
+00023220: 2076 6d69 6e66 6f2c 0a20 2020 2020 2020   vminfo,.       
+00023230: 2020 2020 2020 2020 2022 6e65 7473 223a           "nets":
+00023240: 206e 6574 732c 0a20 2020 2020 2020 2020   nets,.         
+00023250: 2020 2020 2020 2022 706f 7274 7322 3a20         "ports": 
+00023260: 706f 7274 732c 0a20 2020 2020 2020 2020  ports,.         
+00023270: 2020 2020 2020 2022 6368 6563 6b70 6174         "checkpat
+00023280: 6822 3a20 6368 6563 6b70 6174 682c 0a20  h": checkpath,. 
+00023290: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000232a0: 646f 6d61 696e 223a 2064 6f6d 6169 6e2c  domain": domain,
+000232b0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+000232c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000232d0: 706c 616e 2870 6c61 6e2c 2069 6e70 7574  plan(plan, input
+000232e0: 7374 7269 6e67 3d68 6170 726f 7879 706c  string=haproxypl
+000232f0: 616e 2c20 6f76 6572 7269 6465 733d 6f76  an, overrides=ov
+00023300: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+00023310: 6620 6c69 7374 5f6c 6f61 6462 616c 616e  f list_loadbalan
+00023320: 6365 7273 2873 656c 6629 3a0a 2020 2020  cers(self):.    
+00023330: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+00023340: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00023350: 7970 6520 6e6f 7420 696e 205b 2761 7773  ype not in ['aws
+00023360: 272c 2027 6763 7027 2c20 2769 626d 275d  ', 'gcp', 'ibm']
+00023370: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00023380: 7375 6c74 7320 3d20 5b5d 0a20 2020 2020  sults = [].     
+00023390: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
+000233a0: 206b 2e6c 6973 7428 293a 0a20 2020 2020   k.list():.     
+000233b0: 2020 2020 2020 2020 2020 2069 6620 766d             if vm
+000233c0: 5b27 7072 6f66 696c 6527 5d2e 7374 6172  ['profile'].star
+000233d0: 7473 7769 7468 2827 6c6f 6164 6261 6c61  tswith('loadbala
+000233e0: 6e63 6572 2729 2061 6e64 206c 656e 2876  ncer') and len(v
+000233f0: 6d5b 2770 726f 6669 6c65 275d 2e73 706c  m['profile'].spl
+00023400: 6974 2827 2d27 2929 203d 3d20 323a 0a20  it('-')) == 2:. 
+00023410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023420: 2020 2070 6f72 7473 203d 2076 6d5b 2770     ports = vm['p
+00023430: 726f 6669 6c65 275d 2e73 706c 6974 2827  rofile'].split('
+00023440: 2d27 295b 315d 0a20 2020 2020 2020 2020  -')[1].         
+00023450: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00023460: 7473 2e61 7070 656e 6428 5b76 6d5b 276e  ts.append([vm['n
+00023470: 616d 6527 5d2c 2076 6d5b 2769 7027 5d2c  ame'], vm['ip'],
+00023480: 2027 7463 7027 2c20 706f 7274 732c 2027   'tcp', ports, '
+00023490: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+000234a0: 7265 7475 726e 2072 6573 756c 7473 0a20  return results. 
+000234b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000234c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000234d0: 6b2e 6c69 7374 5f6c 6f61 6462 616c 616e  k.list_loadbalan
+000234e0: 6365 7273 2829 0a0a 2020 2020 6465 6620  cers()..    def 
+000234f0: 7761 6974 5f66 696e 6973 6828 7365 6c66  wait_finish(self
+00023500: 2c20 6e61 6d65 2c20 696d 6167 653d 4e6f  , name, image=No
+00023510: 6e65 2c20 7175 6965 743d 4661 6c73 652c  ne, quiet=False,
+00023520: 2077 6169 7463 6f6d 6d61 6e64 3d4e 6f6e   waitcommand=Non
+00023530: 652c 2077 6169 7474 696d 656f 7574 3d30  e, waittimeout=0
+00023540: 2c20 6964 656e 7469 7479 6669 6c65 3d4e  , identityfile=N
+00023550: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00023560: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
+00023570: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
+00023580: 2063 6f6e 6669 6720 3d20 4b63 6f6e 6669   config = Kconfi
+00023590: 6728 636c 6965 6e74 3d76 6d63 6c69 656e  g(client=vmclien
+000235a0: 7429 2069 6620 766d 636c 6965 6e74 2069  t) if vmclient i
+000235b0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+000235c0: 7365 6c66 0a20 2020 2020 2020 206b 203d  self.        k =
+000235d0: 2063 6f6e 6669 672e 6b0a 2020 2020 2020   config.k.      
+000235e0: 2020 6966 2069 6d61 6765 2069 7320 4e6f    if image is No
+000235f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00023600: 696d 6167 6520 3d20 6b2e 696e 666f 286e  image = k.info(n
+00023610: 616d 6529 5b27 696d 6167 6527 5d0a 2020  ame)['image'].  
+00023620: 2020 2020 2020 7070 7269 6e74 2866 2257        pprint(f"W
+00023630: 6169 7469 6e67 2066 6f72 2076 6d20 7b6e  aiting for vm {n
+00023640: 616d 657d 2074 6f20 6669 6e69 7368 2063  ame} to finish c
+00023650: 7573 746f 6d69 7361 7469 6f6e 2229 0a20  ustomisation"). 
+00023660: 2020 2020 2020 2069 6620 7761 6974 636f         if waitco
+00023670: 6d6d 616e 6420 6973 206e 6f74 204e 6f6e  mmand is not Non
+00023680: 6520 616e 6420 2732 3e27 206e 6f74 2069  e and '2>' not i
+00023690: 6e20 7761 6974 636f 6d6d 616e 643a 0a20  n waitcommand:. 
+000236a0: 2020 2020 2020 2020 2020 2077 6169 7463             waitc
+000236b0: 6f6d 6d61 6e64 202b 3d20 2220 323e 2f64  ommand += " 2>/d
+000236c0: 6576 2f6e 756c 6c22 0a20 2020 2020 2020  ev/null".       
+000236d0: 2069 6620 636f 6d6d 6f6e 2e6e 6565 6473   if common.needs
+000236e0: 5f69 676e 6974 696f 6e28 696d 6167 6529  _ignition(image)
+000236f0: 3a0a 2020 2020 2020 2020 2020 2020 636d  :.            cm
+00023700: 6420 3d20 7761 6974 636f 6d6d 616e 6420  d = waitcommand 
+00023710: 6f72 2027 7375 646f 206a 6f75 726e 616c  or 'sudo journal
+00023720: 6374 6c20 2d2d 616c 6c20 2d2d 6e6f 2d70  ctl --all --no-p
+00023730: 6167 6572 270a 2020 2020 2020 2020 656c  ager'.        el
+00023740: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00023750: 636d 6420 3d20 7761 6974 636f 6d6d 616e  cmd = waitcomman
+00023760: 6420 6f72 2066 2273 7564 6f20 7461 696c  d or f"sudo tail
+00023770: 202d 6e20 3530 207b 636f 6d6d 6f6e 2e67   -n 50 {common.g
+00023780: 6574 5f63 6c6f 7564 696e 6974 6669 6c65  et_cloudinitfile
+00023790: 2869 6d61 6765 297d 220a 2020 2020 2020  (image)}".      
+000237a0: 2020 7573 6572 2c20 6970 2c20 766d 706f    user, ip, vmpo
+000237b0: 7274 203d 204e 6f6e 652c 204e 6f6e 652c  rt = None, None,
+000237c0: 204e 6f6e 650a 2020 2020 2020 2020 686f   None.        ho
+000237d0: 7374 6970 203d 204e 6f6e 650a 2020 2020  stip = None.    
+000237e0: 2020 2020 7469 6d65 6f75 7420 3d20 300a      timeout = 0.
+000237f0: 2020 2020 2020 2020 7768 696c 6520 6970          while ip
+00023800: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00023810: 2020 2020 2020 696e 666f 203d 206b 2e69        info = k.i
+00023820: 6e66 6f28 6e61 6d65 290a 2020 2020 2020  nfo(name).      
+00023830: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
+00023840: 7479 7065 203d 3d20 2770 6163 6b65 7427  type == 'packet'
+00023850: 2061 6e64 2069 6e66 6f2e 6765 7428 2773   and info.get('s
+00023860: 7461 7475 7327 2920 213d 2027 6163 7469  tatus') != 'acti
+00023870: 7665 273a 0a20 2020 2020 2020 2020 2020  ve':.           
+00023880: 2020 2020 2077 6172 6e69 6e67 2822 5761       warning("Wa
+00023890: 6974 696e 6720 666f 7220 6e6f 6465 2074  iting for node t
+000238a0: 6f20 6265 2061 6374 6976 6522 290a 2020  o be active").  
+000238b0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+000238c0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000238d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000238e0: 2020 2020 2020 2020 2020 7573 6572 2c20            user, 
+000238f0: 6970 203d 2063 6f6e 6669 672e 766d 7573  ip = config.vmus
+00023900: 6572 206f 7220 696e 666f 2e67 6574 2827  er or info.get('
+00023910: 7573 6572 2729 2c20 696e 666f 2e67 6574  user'), info.get
+00023920: 2827 6970 2729 0a20 2020 2020 2020 2020  ('ip').         
+00023930: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
+00023940: 2e74 7970 6520 3d3d 2027 6b75 6265 7669  .type == 'kubevi
+00023950: 7274 273a 0a20 2020 2020 2020 2020 2020  rt':.           
+00023960: 2020 2020 2020 2020 2069 6620 6b2e 6163           if k.ac
+00023970: 6365 7373 5f6d 6f64 6520 3d3d 2027 4e6f  cess_mode == 'No
+00023980: 6465 506f 7274 273a 0a20 2020 2020 2020  dePort':.       
+00023990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239a0: 2076 6d70 6f72 7420 3d20 696e 666f 2e67   vmport = info.g
+000239b0: 6574 2827 6e6f 6465 706f 7274 2729 0a20  et('nodeport'). 
+000239c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239d0: 2020 2020 2020 2069 6620 686f 7374 6970         if hostip
+000239e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000239f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a00: 2020 2020 2020 686f 7374 6970 203d 206b        hostip = k
+00023a10: 2e6e 6f64 655f 686f 7374 286e 616d 653d  .node_host(name=
+00023a20: 696e 666f 2e67 6574 2827 686f 7374 2729  info.get('host')
+00023a30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023a40: 2020 2020 2020 2020 2020 6970 203d 2068            ip = h
+00023a50: 6f73 7469 700a 2020 2020 2020 2020 2020  ostip.          
+00023a60: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
+00023a70: 2e61 6363 6573 735f 6d6f 6465 203d 3d20  .access_mode == 
+00023a80: 274c 6f61 6442 616c 616e 6365 7227 3a0a  'LoadBalancer':.
+00023a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023aa0: 2020 2020 2020 2020 6970 203d 2069 6e66          ip = inf
+00023ab0: 6f2e 6765 7428 276c 6f61 6462 616c 616e  o.get('loadbalan
+00023ac0: 6365 7269 7027 290a 2020 2020 2020 2020  cerip').        
+00023ad0: 2020 2020 2020 2020 6966 2075 7365 7220          if user 
+00023ae0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00023af0: 6970 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ip is not None:.
+00023b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b10: 2020 2020 6966 2063 6f6e 6669 672e 7479      if config.ty
+00023b20: 7065 203d 3d20 276f 7065 6e73 7461 636b  pe == 'openstack
+00023b30: 2720 616e 6420 696e 666f 2e67 6574 2827  ' and info.get('
+00023b40: 7072 6976 6174 6569 7027 2920 3d3d 2069  privateip') == i
+00023b50: 7020 616e 6420 6b2e 6578 7465 726e 616c  p and k.external
+00023b60: 5f6e 6574 776f 726b 2069 7320 6e6f 7420  _network is not 
+00023b70: 4e6f 6e65 5c0a 2020 2020 2020 2020 2020  None\.          
+00023b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b90: 2020 616e 6420 696e 666f 2e67 6574 2827    and info.get('
+00023ba0: 6e65 7473 2729 5b30 5d5b 276e 6574 275d  nets')[0]['net']
+00023bb0: 2021 3d20 6b2e 6578 7465 726e 616c 5f6e   != k.external_n
+00023bc0: 6574 776f 726b 3a0a 2020 2020 2020 2020  etwork:.        
+00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023be0: 7761 726e 696e 6728 2257 6169 7469 6e67  warning("Waiting
+00023bf0: 2066 6f72 2066 6c6f 6174 696e 6720 6970   for floating ip
+00023c00: 2069 6e73 7465 6164 206f 6620 6120 7072   instead of a pr
+00023c10: 6976 6174 6520 6970 2e2e 2e22 290a 2020  ivate ip...").  
+00023c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c30: 2020 2020 2020 6970 203d 204e 6f6e 650a        ip = None.
+00023c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c70: 2020 7465 7374 636d 6420 3d20 636f 6d6d    testcmd = comm
+00023c80: 6f6e 2e73 7368 286e 616d 652c 2075 7365  on.ssh(name, use
+00023c90: 723d 7573 6572 2c20 6970 3d69 702c 2074  r=user, ip=ip, t
+00023ca0: 756e 6e65 6c3d 636f 6e66 6967 2e74 756e  unnel=config.tun
+00023cb0: 6e65 6c2c 2074 756e 6e65 6c68 6f73 743d  nel, tunnelhost=
+00023cc0: 636f 6e66 6967 2e74 756e 6e65 6c68 6f73  config.tunnelhos
+00023cd0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d00: 7475 6e6e 656c 706f 7274 3d63 6f6e 6669  tunnelport=confi
+00023d10: 672e 7475 6e6e 656c 706f 7274 2c20 7475  g.tunnelport, tu
+00023d20: 6e6e 656c 7573 6572 3d63 6f6e 6669 672e  nneluser=config.
+00023d30: 7475 6e6e 656c 7573 6572 2c0a 2020 2020  tunneluser,.    
+00023d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d60: 2020 2020 2020 2020 2069 6e73 6563 7572           insecur
+00023d70: 653d 636f 6e66 6967 2e69 6e73 6563 7572  e=config.insecur
+00023d80: 652c 2063 6d64 3d27 6964 202d 756e 272c  e, cmd='id -un',
+00023d90: 2076 6d70 6f72 743d 766d 706f 7274 2c0a   vmport=vmport,.
+00023da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023dc0: 2020 2020 2020 2020 2020 2020 2069 6465               ide
+00023dd0: 6e74 6974 7966 696c 653d 6964 656e 7469  ntityfile=identi
+00023de0: 7479 6669 6c65 2c20 7061 7373 776f 7264  tyfile, password
+00023df0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00023e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e10: 6966 206f 732e 706f 7065 6e28 7465 7374  if os.popen(test
+00023e20: 636d 6429 2e72 6561 6428 292e 7374 7269  cmd).read().stri
+00023e30: 7028 2920 213d 2075 7365 723a 0a20 2020  p() != user:.   
+00023e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e50: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00023e60: 2822 4761 7468 6572 6564 2069 7020 6e6f  ("Gathered ip no
+00023e70: 7420 6675 6e63 7469 6f6e 616c 2079 6574  t functional yet
+00023e80: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00023e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ea0: 2020 6970 203d 204e 6f6e 650a 2020 2020    ip = None.    
+00023eb0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+00023ec0: 5761 6974 696e 6720 666f 7220 766d 2074  Waiting for vm t
+00023ed0: 6f20 6265 2061 6363 6573 7369 626c 652e  o be accessible.
+00023ee0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00023ef0: 2073 6c65 6570 2835 290a 2020 2020 2020   sleep(5).      
+00023f00: 2020 2020 2020 7469 6d65 6f75 7420 2b3d        timeout +=
+00023f10: 2035 0a20 2020 2020 2020 2020 2020 2069   5.            i
+00023f20: 6620 7761 6974 7469 6d65 6f75 7420 3e20  f waittimeout > 
+00023f30: 3020 616e 6420 7469 6d65 6f75 7420 3e20  0 and timeout > 
+00023f40: 7761 6974 7469 6d65 6f75 743a 0a20 2020  waittimeout:.   
+00023f50: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00023f60: 6f72 2822 5469 6d65 6f75 7420 7761 6974  or("Timeout wait
+00023f70: 696e 6720 666f 7220 766d 2074 6f20 6265  ing for vm to be
+00023f80: 2061 6363 6573 7369 626c 652e 2e2e 2229   accessible...")
+00023f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023fa0: 2062 7265 616b 0a20 2020 2020 2020 2073   break.        s
+00023fb0: 6c65 6570 2835 290a 2020 2020 2020 2020  leep(5).        
+00023fc0: 6f6c 646f 7574 7075 7420 3d20 2727 0a20  oldoutput = ''. 
+00023fd0: 2020 2020 2020 2074 696d 656f 7574 203d         timeout =
+00023fe0: 2030 0a20 2020 2020 2020 2077 6869 6c65   0.        while
+00023ff0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+00024000: 2020 2073 7368 636d 6420 3d20 636f 6d6d     sshcmd = comm
+00024010: 6f6e 2e73 7368 286e 616d 652c 2075 7365  on.ssh(name, use
+00024020: 723d 2772 6f6f 7427 2c20 6970 3d69 702c  r='root', ip=ip,
+00024030: 2074 756e 6e65 6c3d 636f 6e66 6967 2e74   tunnel=config.t
+00024040: 756e 6e65 6c2c 2074 756e 6e65 6c68 6f73  unnel, tunnelhos
+00024050: 743d 636f 6e66 6967 2e74 756e 6e65 6c68  t=config.tunnelh
+00024060: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
+00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024080: 2020 2020 2076 6d70 6f72 743d 766d 706f       vmport=vmpo
+00024090: 7274 2c20 7475 6e6e 656c 706f 7274 3d63  rt, tunnelport=c
+000240a0: 6f6e 6669 672e 7475 6e6e 656c 706f 7274  onfig.tunnelport
+000240b0: 2c20 7475 6e6e 656c 7573 6572 3d63 6f6e  , tunneluser=con
+000240c0: 6669 672e 7475 6e6e 656c 7573 6572 2c0a  fig.tunneluser,.
+000240d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240f0: 696e 7365 6375 7265 3d63 6f6e 6669 672e  insecure=config.
+00024100: 696e 7365 6375 7265 2c20 636d 643d 636d  insecure, cmd=cm
+00024110: 642c 2069 6465 6e74 6974 7966 696c 653d  d, identityfile=
+00024120: 6964 656e 7469 7479 6669 6c65 2c20 7061  identityfile, pa
+00024130: 7373 776f 7264 3d46 616c 7365 290a 2020  ssword=False).  
+00024140: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00024150: 203d 206f 732e 706f 7065 6e28 7373 6863   = os.popen(sshc
+00024160: 6d64 292e 7265 6164 2829 0a20 2020 2020  md).read().     
+00024170: 2020 2020 2020 2069 6620 7761 6974 636f         if waitco
+00024180: 6d6d 616e 6420 6973 206e 6f74 204e 6f6e  mmand is not Non
+00024190: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000241a0: 2020 2069 6620 6f75 7470 7574 2021 3d20     if output != 
+000241b0: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+000241c0: 2020 2020 2020 2020 7072 696e 7428 6f75          print(ou
+000241d0: 7470 7574 290a 2020 2020 2020 2020 2020  tput).          
+000241e0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+000241f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024200: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00024210: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00024220: 2822 5761 6974 696e 6720 666f 7220 7761  ("Waiting for wa
+00024230: 6974 636f 6d6d 616e 6420 746f 2073 7563  itcommand to suc
+00024240: 6365 6564 2e2e 2e22 290a 2020 2020 2020  ceed...").      
+00024250: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00024260: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00024270: 6b63 6c69 2062 6f6f 7420 6669 6e69 7368  kcli boot finish
+00024280: 6564 2720 696e 206f 7574 7075 7420 6f72  ed' in output or
+00024290: 2027 4967 6e69 7469 6f6e 2066 696e 6973   'Ignition finis
+000242a0: 6865 6420 7375 6363 6573 7366 756c 6c79  hed successfully
+000242b0: 2720 696e 206f 7574 7075 7420 6f72 5c0a  ' in output or\.
+000242c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000242d0: 2020 2027 4669 6e69 7368 6564 2043 6f6d     'Finished Com
+000242e0: 6275 7374 696f 6e27 2069 6e20 6f75 7470  bustion' in outp
+000242f0: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
+00024300: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00024310: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+00024320: 7470 7574 203d 206f 7574 7075 742e 7265  tput = output.re
+00024330: 706c 6163 6528 6f6c 646f 7574 7075 742c  place(oldoutput,
+00024340: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
+00024350: 2020 2020 2069 6620 6e6f 7420 7175 6965       if not quie
+00024360: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00024370: 2020 2020 2020 2070 7269 6e74 286f 7574         print(out
+00024380: 7075 7429 0a20 2020 2020 2020 2020 2020  put).           
+00024390: 2020 2020 206f 6c64 6f75 7470 7574 203d       oldoutput =
+000243a0: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
+000243b0: 2020 2020 736c 6565 7028 3229 0a20 2020      sleep(2).   
+000243c0: 2020 2020 2020 2020 2074 696d 656f 7574           timeout
+000243d0: 202b 3d20 320a 2020 2020 2020 2020 2020   += 2.          
+000243e0: 2020 6966 2077 6169 7474 696d 656f 7574    if waittimeout
+000243f0: 203e 2030 2061 6e64 2074 696d 656f 7574   > 0 and timeout
+00024400: 203e 2077 6169 7474 696d 656f 7574 3a0a   > waittimeout:.
+00024410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024420: 6572 726f 7228 2254 696d 656f 7574 2077  error("Timeout w
+00024430: 6169 7469 6e67 2066 6f72 2077 6169 7463  aiting for waitc
+00024440: 6f6d 6d61 6e64 2074 6f20 6578 6563 7574  ommand to execut
+00024450: 652e 2e2e 2229 0a20 2020 2020 2020 2020  e...").         
+00024460: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00024470: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00024480: 0a0a 2020 2020 6465 6620 636c 6561 6e5f  ..    def clean_
+00024490: 7465 6d70 6b65 7928 7365 6c66 2c20 6e61  tempkey(self, na
+000244a0: 6d65 2c20 6964 656e 7469 7479 6669 6c65  me, identityfile
+000244b0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+000244c0: 636d 6420 3d20 2273 6564 202d 6920 272f  cmd = "sed -i '/
+000244d0: 7465 6d70 2d6b 636c 692d 6b65 792f 6427  temp-kcli-key/d'
+000244e0: 202f 686f 6d65 2f2a 2f2e 7373 682f 6175   /home/*/.ssh/au
+000244f0: 7468 6f72 697a 6564 5f6b 6579 7320 2f72  thorized_keys /r
+00024500: 6f6f 742f 2e73 7368 2f61 7574 686f 7269  oot/.ssh/authori
+00024510: 7a65 645f 6b65 7973 220a 2020 2020 2020  zed_keys".      
+00024520: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+00024530: 2020 2020 2069 6e66 6f20 3d20 6b2e 696e       info = k.in
+00024540: 666f 286e 616d 6529 0a20 2020 2020 2020  fo(name).       
+00024550: 2076 6d70 6f72 7420 3d20 4e6f 6e65 0a20   vmport = None. 
+00024560: 2020 2020 2020 2069 7020 3d20 696e 666f         ip = info
+00024570: 2e67 6574 2827 6970 2729 0a20 2020 2020  .get('ip').     
+00024580: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
+00024590: 3d3d 2027 6b75 6265 7669 7274 273a 0a20  == 'kubevirt':. 
+000245a0: 2020 2020 2020 2020 2020 2069 6620 6b2e             if k.
+000245b0: 6163 6365 7373 5f6d 6f64 6520 3d3d 2027  access_mode == '
+000245c0: 4e6f 6465 506f 7274 273a 0a20 2020 2020  NodePort':.     
+000245d0: 2020 2020 2020 2020 2020 2076 6d70 6f72             vmpor
+000245e0: 7420 3d20 696e 666f 2e67 6574 2827 6e6f  t = info.get('no
+000245f0: 6465 706f 7274 2729 0a20 2020 2020 2020  deport').       
+00024600: 2020 2020 2020 2020 2069 7020 3d20 6b2e           ip = k.
+00024610: 6e6f 6465 5f68 6f73 7428 6e61 6d65 3d69  node_host(name=i
+00024620: 6e66 6f2e 6765 7428 2768 6f73 7427 2929  nfo.get('host'))
+00024630: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00024640: 6620 6b2e 6163 6365 7373 5f6d 6f64 6520  f k.access_mode 
+00024650: 3d3d 2027 4c6f 6164 4261 6c61 6e63 6572  == 'LoadBalancer
+00024660: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00024670: 2020 2069 7020 3d20 696e 666f 2e67 6574     ip = info.get
+00024680: 2827 6c6f 6164 6261 6c61 6e63 6572 6970  ('loadbalancerip
+00024690: 2729 0a20 2020 2020 2020 2073 7368 636d  ').        sshcm
+000246a0: 6420 3d20 636f 6d6d 6f6e 2e73 7368 286e  d = common.ssh(n
+000246b0: 616d 652c 2075 7365 723d 2772 6f6f 7427  ame, user='root'
+000246c0: 2c20 6970 3d69 702c 2074 756e 6e65 6c3d  , ip=ip, tunnel=
+000246d0: 7365 6c66 2e74 756e 6e65 6c2c 2074 756e  self.tunnel, tun
+000246e0: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
+000246f0: 6e65 6c68 6f73 742c 2076 6d70 6f72 743d  nelhost, vmport=
+00024700: 766d 706f 7274 2c0a 2020 2020 2020 2020  vmport,.        
+00024710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024720: 2020 2020 7475 6e6e 656c 706f 7274 3d73      tunnelport=s
+00024730: 656c 662e 7475 6e6e 656c 706f 7274 2c20  elf.tunnelport, 
+00024740: 7475 6e6e 656c 7573 6572 3d73 656c 662e  tunneluser=self.
+00024750: 7475 6e6e 656c 7573 6572 2c20 696e 7365  tunneluser, inse
+00024760: 6375 7265 3d73 656c 662e 696e 7365 6375  cure=self.insecu
+00024770: 7265 2c20 636d 643d 636d 642c 0a20 2020  re, cmd=cmd,.   
+00024780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024790: 2020 2020 2020 2020 2069 6465 6e74 6974           identit
+000247a0: 7966 696c 653d 6964 656e 7469 7479 6669  yfile=identityfi
+000247b0: 6c65 2c20 7061 7373 776f 7264 3d46 616c  le, password=Fal
+000247c0: 7365 290a 2020 2020 2020 2020 6f73 2e70  se).        os.p
+000247d0: 6f70 656e 2873 7368 636d 6429 2e72 6561  open(sshcmd).rea
+000247e0: 6428 290a 0a20 2020 2064 6566 2074 6872  d()..    def thr
+000247f0: 6561 6465 645f 6372 6561 7465 5f6b 7562  eaded_create_kub
+00024800: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
+00024810: 206b 7562 6574 7970 652c 206b 7562 655f   kubetype, kube_
+00024820: 6f76 6572 7269 6465 7329 3a0a 2020 2020  overrides):.    
+00024830: 2020 2020 6970 706f 6f6c 203d 206b 7562      ippool = kub
+00024840: 655f 6f76 6572 7269 6465 732e 6765 7428  e_overrides.get(
+00024850: 2769 7070 6f6f 6c27 2920 6f72 206b 7562  'ippool') or kub
+00024860: 655f 6f76 6572 7269 6465 732e 6765 7428  e_overrides.get(
+00024870: 2763 6f6e 6670 6f6f 6c27 290a 2020 2020  'confpool').    
+00024880: 2020 2020 6261 7265 6d65 7461 6c70 6f6f      baremetalpoo
+00024890: 6c20 3d20 6b75 6265 5f6f 7665 7272 6964  l = kube_overrid
+000248a0: 6573 2e67 6574 2827 6970 706f 6f6c 2729  es.get('ippool')
+000248b0: 206f 7220 6b75 6265 5f6f 7665 7272 6964   or kube_overrid
+000248c0: 6573 2e67 6574 2827 636f 6e66 706f 6f6c  es.get('confpool
+000248d0: 2729 0a20 2020 2020 2020 2069 6620 6970  ').        if ip
+000248e0: 706f 6f6c 2069 7320 6e6f 7420 4e6f 6e65  pool is not None
+000248f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00024900: 6c66 2e67 6574 5f76 6970 5f66 726f 6d5f  lf.get_vip_from_
+00024910: 636f 6e66 706f 6f6c 2863 6c75 7374 6572  confpool(cluster
+00024920: 2c20 6970 706f 6f6c 2c20 6f76 6572 7269  , ippool, overri
+00024930: 6465 733d 6b75 6265 5f6f 7665 7272 6964  des=kube_overrid
+00024940: 6573 290a 2020 2020 2020 2020 6966 2062  es).        if b
+00024950: 6172 656d 6574 616c 706f 6f6c 2069 7320  aremetalpool is 
+00024960: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00024970: 2020 2020 2020 7365 6c66 2e67 6574 5f62        self.get_b
+00024980: 6172 656d 6574 616c 5f68 6f73 7473 5f66  aremetal_hosts_f
+00024990: 726f 6d5f 636f 6e66 706f 6f6c 2863 6c75  rom_confpool(clu
+000249a0: 7374 6572 2c20 6261 7265 6d65 7461 6c70  ster, baremetalp
+000249b0: 6f6f 6c2c 206f 7665 7272 6964 6573 3d6b  ool, overrides=k
+000249c0: 7562 655f 6f76 6572 7269 6465 7329 0a20  ube_overrides). 
+000249d0: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+000249e0: 7465 5f6b 7562 6528 636c 7573 7465 722c  te_kube(cluster,
+000249f0: 206b 7562 6574 7970 652c 206b 7562 655f   kubetype, kube_
+00024a00: 6f76 6572 7269 6465 7329 0a0a 2020 2020  overrides)..    
+00024a10: 6465 6620 6372 6561 7465 5f6b 7562 6528  def create_kube(
+00024a20: 7365 6c66 2c20 636c 7573 7465 722c 206b  self, cluster, k
+00024a30: 7562 6574 7970 652c 206f 7665 7272 6964  ubetype, overrid
+00024a40: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
+00024a50: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
+00024a60: 2777 6562 2720 616e 6420 7365 6c66 2e6b  'web' and self.k
+00024a70: 2e6c 6f63 616c 6b75 6265 3a0a 2020 2020  .localkube:.    
+00024a80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00024a90: 656c 662e 6b2e 6372 6561 7465 5f6b 7562  elf.k.create_kub
+00024aa0: 6528 636c 7573 7465 722c 206b 7562 6574  e(cluster, kubet
+00024ab0: 7970 652c 206f 7665 7272 6964 6573 3d6f  ype, overrides=o
+00024ac0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+00024ad0: 2020 6970 706f 6f6c 203d 206f 7665 7272    ippool = overr
+00024ae0: 6964 6573 2e67 6574 2827 6970 706f 6f6c  ides.get('ippool
+00024af0: 2729 206f 7220 6f76 6572 7269 6465 732e  ') or overrides.
+00024b00: 6765 7428 2763 6f6e 6670 6f6f 6c27 290a  get('confpool').
+00024b10: 2020 2020 2020 2020 6261 7265 6d65 7461          baremeta
+00024b20: 6c70 6f6f 6c20 3d20 6f76 6572 7269 6465  lpool = override
+00024b30: 732e 6765 7428 2769 7070 6f6f 6c27 2920  s.get('ippool') 
+00024b40: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
+00024b50: 2827 636f 6e66 706f 6f6c 2729 0a20 2020  ('confpool').   
+00024b60: 2020 2020 2069 6620 6970 706f 6f6c 2069       if ippool i
+00024b70: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00024b80: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+00024b90: 5f76 6970 5f66 726f 6d5f 636f 6e66 706f  _vip_from_confpo
+00024ba0: 6f6c 2863 6c75 7374 6572 2c20 6970 706f  ol(cluster, ippo
+00024bb0: 6f6c 2c20 6f76 6572 7269 6465 733d 6f76  ol, overrides=ov
+00024bc0: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00024bd0: 2069 6620 6261 7265 6d65 7461 6c70 6f6f   if baremetalpoo
+00024be0: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
+00024bf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00024c00: 6765 745f 6261 7265 6d65 7461 6c5f 686f  get_baremetal_ho
+00024c10: 7374 735f 6672 6f6d 5f63 6f6e 6670 6f6f  sts_from_confpoo
+00024c20: 6c28 636c 7573 7465 722c 2062 6172 656d  l(cluster, barem
+00024c30: 6574 616c 706f 6f6c 2c20 6f76 6572 7269  etalpool, overri
+00024c40: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
+00024c50: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
+00024c60: 7065 203d 3d20 276f 7065 6e73 6869 6674  pe == 'openshift
+00024c70: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
+00024c80: 6573 756c 7420 3d20 7365 6c66 2e63 7265  esult = self.cre
+00024c90: 6174 655f 6b75 6265 5f6f 7065 6e73 6869  ate_kube_openshi
+00024ca0: 6674 2863 6c75 7374 6572 2c20 6f76 6572  ft(cluster, over
+00024cb0: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+00024cc0: 0a20 2020 2020 2020 2065 6c69 6620 6b75  .        elif ku
+00024cd0: 6265 7479 7065 203d 3d20 2768 7970 6572  betype == 'hyper
+00024ce0: 7368 6966 7427 3a0a 2020 2020 2020 2020  shift':.        
+00024cf0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+00024d00: 662e 6372 6561 7465 5f6b 7562 655f 6879  f.create_kube_hy
+00024d10: 7065 7273 6869 6674 2863 6c75 7374 6572  pershift(cluster
+00024d20: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00024d30: 7269 6465 7329 0a20 2020 2020 2020 2065  rides).        e
+00024d40: 6c69 6620 6b75 6265 7479 7065 203d 3d20  lif kubetype == 
+00024d50: 276d 6963 726f 7368 6966 7427 3a0a 2020  'microshift':.  
+00024d60: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00024d70: 203d 2073 656c 662e 6372 6561 7465 5f6b   = self.create_k
+00024d80: 7562 655f 6d69 6372 6f73 6869 6674 2863  ube_microshift(c
+00024d90: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00024da0: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
+00024db0: 2020 2020 2065 6c69 6620 6b75 6265 7479       elif kubety
+00024dc0: 7065 203d 3d20 276b 3373 273a 0a20 2020  pe == 'k3s':.   
+00024dd0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00024de0: 3d20 7365 6c66 2e63 7265 6174 655f 6b75  = self.create_ku
+00024df0: 6265 5f6b 3373 2863 6c75 7374 6572 2c20  be_k3s(cluster, 
+00024e00: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
+00024e10: 6465 7329 0a20 2020 2020 2020 2065 6c73  des).        els
+00024e20: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00024e30: 6573 756c 7420 3d20 7365 6c66 2e63 7265  esult = self.cre
+00024e40: 6174 655f 6b75 6265 5f67 656e 6572 6963  ate_kube_generic
+00024e50: 2863 6c75 7374 6572 2c20 6f76 6572 7269  (cluster, overri
+00024e60: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
+00024e70: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00024e80: 7375 6c74 0a0a 2020 2020 6465 6620 6372  sult..    def cr
+00024e90: 6561 7465 5f6b 7562 655f 6765 6e65 7269  eate_kube_generi
+00024ea0: 6328 7365 6c66 2c20 636c 7573 7465 722c  c(self, cluster,
+00024eb0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
+00024ec0: 2020 2020 2020 2020 6966 2063 6f6e 7461          if conta
+00024ed0: 696e 6572 5f6d 6f64 6528 293a 0a20 2020  iner_mode():.   
+00024ee0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+00024ef0: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
+00024f00: 3a2f 776f 726b 6469 7227 0a20 2020 2020  :/workdir'.     
+00024f10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00024f20: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
+00024f30: 2750 4154 4827 5d20 2b3d 2027 3a25 7327  'PATH'] += ':%s'
+00024f40: 2025 206f 732e 6765 7463 7764 2829 0a20   % os.getcwd(). 
+00024f50: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
+00024f60: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+00024f70: 286b 7562 6561 646d 2e63 7265 6174 652e  (kubeadm.create.
+00024f80: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
+00024f90: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
+00024fa0: 7475 726e 206b 7562 6561 646d 2e63 7265  turn kubeadm.cre
+00024fb0: 6174 6528 7365 6c66 2c20 706c 616e 6469  ate(self, plandi
+00024fc0: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
+00024fd0: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+00024fe0: 6372 6561 7465 5f6b 7562 655f 6d69 6372  create_kube_micr
+00024ff0: 6f73 6869 6674 2873 656c 662c 2063 6c75  oshift(self, clu
+00025000: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00025010: 7b7d 293a 0a20 2020 2020 2020 2069 6620  {}):.        if 
+00025020: 636f 6e74 6169 6e65 725f 6d6f 6465 2829  container_mode()
+00025030: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00025040: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+00025050: 202b 3d20 273a 2f77 6f72 6b64 6972 270a   += ':/workdir'.
+00025060: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00025070: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+00025080: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
+00025090: 273a 2573 2720 2520 6f73 2e67 6574 6377  ':%s' % os.getcw
+000250a0: 6428 290a 2020 2020 2020 2020 706c 616e  d().        plan
+000250b0: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+000250c0: 726e 616d 6528 6d69 6372 6f73 6869 6674  rname(microshift
+000250d0: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
+000250e0: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
+000250f0: 2020 2020 2020 7265 7475 726e 206d 6963        return mic
+00025100: 726f 7368 6966 742e 6372 6561 7465 2873  roshift.create(s
+00025110: 656c 662c 2070 6c61 6e64 6972 2c20 636c  elf, plandir, cl
+00025120: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00025130: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
+00025140: 655f 6b75 6265 5f6b 3373 2873 656c 662c  e_kube_k3s(self,
+00025150: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
+00025160: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
+00025170: 2069 6620 636f 6e74 6169 6e65 725f 6d6f   if container_mo
+00025180: 6465 2829 3a0a 2020 2020 2020 2020 2020  de():.          
+00025190: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+000251a0: 5448 275d 202b 3d20 273a 2f77 6f72 6b64  TH'] += ':/workd
+000251b0: 6972 270a 2020 2020 2020 2020 656c 7365  ir'.        else
+000251c0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+000251d0: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+000251e0: 202b 3d20 273a 2573 2720 2520 6f73 2e67   += ':%s' % os.g
+000251f0: 6574 6377 6428 290a 2020 2020 2020 2020  etcwd().        
+00025200: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+00025210: 682e 6469 726e 616d 6528 6b33 732e 6372  h.dirname(k3s.cr
+00025220: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
+00025230: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+00025240: 2020 2072 6574 7572 6e20 6b33 732e 6372     return k3s.cr
+00025250: 6561 7465 2873 656c 662c 2070 6c61 6e64  eate(self, pland
+00025260: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
+00025270: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
+00025280: 2063 7265 6174 655f 6b75 6265 5f68 7970   create_kube_hyp
+00025290: 6572 7368 6966 7428 7365 6c66 2c20 636c  ershift(self, cl
+000252a0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+000252b0: 3d7b 7d29 3a0a 2020 2020 2020 2020 6966  ={}):.        if
+000252c0: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
+000252d0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+000252e0: 732e 656e 7669 726f 6e5b 2750 4154 4827  s.environ['PATH'
+000252f0: 5d20 2b3d 2027 3a2f 776f 726b 6469 7227  ] += ':/workdir'
+00025300: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00025310: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
+00025320: 7669 726f 6e5b 2750 4154 4827 5d20 2b3d  viron['PATH'] +=
+00025330: 2027 3a25 7327 2025 206f 732e 6765 7463   ':%s' % os.getc
+00025340: 7764 2829 0a20 2020 2020 2020 2070 6c61  wd().        pla
+00025350: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
+00025360: 6972 6e61 6d65 2868 7970 6572 7368 6966  irname(hypershif
+00025370: 742e 6372 6561 7465 2e5f 5f63 6f64 655f  t.create.__code_
+00025380: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+00025390: 2020 2020 2020 2023 2064 6e73 636c 6965         # dnsclie
+000253a0: 6e74 203d 206f 7665 7272 6964 6573 2e67  nt = overrides.g
+000253b0: 6574 2827 646e 7363 6c69 656e 7427 290a  et('dnsclient').
+000253c0: 2020 2020 2020 2020 2320 646e 7363 6f6e          # dnscon
+000253d0: 6669 6720 3d20 4b63 6f6e 6669 6728 636c  fig = Kconfig(cl
+000253e0: 6965 6e74 3d64 6e73 636c 6965 6e74 2920  ient=dnsclient) 
+000253f0: 6966 2064 6e73 636c 6965 6e74 2069 7320  if dnsclient is 
+00025400: 6e6f 7420 4e6f 6e65 2065 6c73 6520 4e6f  not None else No
+00025410: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
+00025420: 6e20 6879 7065 7273 6869 6674 2e63 7265  n hypershift.cre
+00025430: 6174 6528 7365 6c66 2c20 706c 616e 6469  ate(self, plandi
+00025440: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
+00025450: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+00025460: 6372 6561 7465 5f6b 7562 655f 6f70 656e  create_kube_open
+00025470: 7368 6966 7428 7365 6c66 2c20 636c 7573  shift(self, clus
+00025480: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00025490: 7d29 3a0a 2020 2020 2020 2020 6966 2063  }):.        if c
+000254a0: 6f6e 7461 696e 6572 5f6d 6f64 6528 293a  ontainer_mode():
+000254b0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+000254c0: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+000254d0: 2b3d 2027 3a2f 776f 726b 6469 7227 0a20  += ':/workdir'. 
+000254e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000254f0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+00025500: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
+00025510: 3a25 7327 2025 206f 732e 6765 7463 7764  :%s' % os.getcwd
+00025520: 2829 0a20 2020 2020 2020 2070 6c61 6e64  ().        pland
+00025530: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+00025540: 6e61 6d65 286f 7065 6e73 6869 6674 2e63  name(openshift.c
+00025550: 7265 6174 652e 5f5f 636f 6465 5f5f 2e63  reate.__code__.c
+00025560: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
+00025570: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
+00025580: 6f76 6572 7269 6465 732e 6765 7428 2764  overrides.get('d
+00025590: 6e73 636c 6965 6e74 2729 0a20 2020 2020  nsclient').     
+000255a0: 2020 2064 6e73 636f 6e66 6967 203d 204b     dnsconfig = K
+000255b0: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
+000255c0: 7363 6c69 656e 7429 2069 6620 646e 7363  sclient) if dnsc
+000255d0: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
+000255e0: 6520 656c 7365 204e 6f6e 650a 2020 2020  e else None.    
+000255f0: 2020 2020 7265 7475 726e 206f 7065 6e73      return opens
+00025600: 6869 6674 2e63 7265 6174 6528 7365 6c66  hift.create(self
+00025610: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
+00025620: 6572 2c20 6f76 6572 7269 6465 732c 2064  er, overrides, d
+00025630: 6e73 636f 6e66 6967 3d64 6e73 636f 6e66  nsconfig=dnsconf
+00025640: 6967 290a 0a20 2020 2064 6566 2064 656c  ig)..    def del
+00025650: 6574 655f 6b75 6265 2873 656c 662c 2063  ete_kube(self, c
+00025660: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00025670: 733d 7b7d 293a 0a20 2020 2020 2020 2068  s={}):.        h
+00025680: 7970 6572 7368 6966 7420 3d20 4661 6c73  ypershift = Fals
+00025690: 650a 2020 2020 2020 2020 6173 7369 7374  e.        assist
+000256a0: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+000256b0: 2020 2064 6f6d 6169 6e20 3d20 6f76 6572     domain = over
+000256c0: 7269 6465 732e 6765 7428 2764 6f6d 6169  rides.get('domai
+000256d0: 6e27 2c20 276b 6172 6d61 6c61 6273 2e63  n', 'karmalabs.c
+000256e0: 6f72 7027 290a 2020 2020 2020 2020 6b75  orp').        ku
+000256f0: 6265 7479 7065 203d 206f 7665 7272 6964  betype = overrid
+00025700: 6573 2e67 6574 2827 6b75 6265 7479 7065  es.get('kubetype
+00025710: 272c 2027 6765 6e65 7269 6327 290a 2020  ', 'generic').  
+00025720: 2020 2020 2020 646e 7363 6c69 656e 7420        dnsclient 
+00025730: 3d20 4e6f 6e65 0a20 2020 2020 2020 206b  = None.        k
+00025740: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00025750: 2020 6966 2073 656c 662e 7479 7065 203d    if self.type =
+00025760: 3d20 2777 6562 2720 616e 6420 7365 6c66  = 'web' and self
+00025770: 2e6b 2e6c 6f63 616c 6b75 6265 3a0a 2020  .k.localkube:.  
+00025780: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00025790: 206b 2e64 656c 6574 655f 6b75 6265 2863   k.delete_kube(c
+000257a0: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
+000257b0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+000257c0: 7269 6465 7329 0a20 2020 2020 2020 2063  rides).        c
+000257d0: 6c75 7374 6572 203d 206f 7665 7272 6964  luster = overrid
+000257e0: 6573 2e67 6574 2827 636c 7573 7465 7227  es.get('cluster'
+000257f0: 2c20 636c 7573 7465 7229 0a20 2020 2020  , cluster).     
+00025800: 2020 2069 6620 636c 7573 7465 7220 6973     if cluster is
+00025810: 204e 6f6e 6520 6f72 2063 6c75 7374 6572   None or cluster
+00025820: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
+00025830: 2020 2020 6465 6661 756c 745f 636c 7573      default_clus
+00025840: 7465 7273 203d 207b 2767 656e 6572 6963  ters = {'generic
+00025850: 273a 2027 6d79 6b75 6265 272c 2027 6879  ': 'mykube', 'hy
+00025860: 7065 7273 6869 6674 273a 2027 6d79 6879  pershift': 'myhy
+00025870: 7065 7273 6869 6674 272c 2027 6f70 656e  pershift', 'open
+00025880: 7368 6966 7427 3a20 276d 796f 7065 6e73  shift': 'myopens
+00025890: 6869 6674 272c 0a20 2020 2020 2020 2020  hift',.         
+000258a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000258b0: 2020 2020 2020 2027 6b33 7327 3a20 276d         'k3s': 'm
+000258c0: 796b 3373 272c 2027 6d69 6372 6f73 6869  yk3s', 'microshi
+000258d0: 6674 273a 2027 6d79 6d69 6372 6f73 6869  ft': 'mymicroshi
+000258e0: 6674 277d 0a20 2020 2020 2020 2020 2020  ft'}.           
+000258f0: 2063 6c75 7374 6572 203d 2064 6566 6175   cluster = defau
+00025900: 6c74 5f63 6c75 7374 6572 735b 6b75 6265  lt_clusters[kube
+00025910: 7479 7065 5d0a 2020 2020 2020 2020 636c  type].        cl
+00025920: 7573 7465 7264 6972 203d 206f 732e 7061  usterdir = os.pa
+00025930: 7468 2e65 7870 616e 6475 7365 7228 6622  th.expanduser(f"
+00025940: 7e2f 2e6b 636c 692f 636c 7573 7465 7273  ~/.kcli/clusters
+00025950: 2f7b 636c 7573 7465 727d 2229 0a20 2020  /{cluster}").   
+00025960: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00025970: 6578 6973 7473 2863 6c75 7374 6572 6469  exists(clusterdi
+00025980: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00025990: 7061 7261 6d65 7465 7273 6669 6c65 203d  parametersfile =
+000259a0: 2066 227b 636c 7573 7465 7264 6972 7d2f   f"{clusterdir}/
+000259b0: 6b63 6c69 5f70 6172 616d 6574 6572 732e  kcli_parameters.
+000259c0: 796d 6c22 0a20 2020 2020 2020 2020 2020  yml".           
+000259d0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+000259e0: 7473 2870 6172 616d 6574 6572 7366 696c  ts(parametersfil
+000259f0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00025a00: 2020 2020 7769 7468 206f 7065 6e28 7061      with open(pa
+00025a10: 7261 6d65 7465 7273 6669 6c65 2920 6173  rametersfile) as
+00025a20: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00025a30: 2020 2020 2020 2020 636c 7573 7465 7264          clusterd
+00025a40: 6174 6120 3d20 7961 6d6c 2e73 6166 655f  ata = yaml.safe_
+00025a50: 6c6f 6164 2866 290a 2020 2020 2020 2020  load(f).        
+00025a60: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00025a70: 7479 7065 203d 2063 6c75 7374 6572 6461  type = clusterda
+00025a80: 7461 2e67 6574 2827 6b75 6265 7479 7065  ta.get('kubetype
+00025a90: 272c 2027 6765 6e65 7269 6327 290a 2020  ', 'generic').  
+00025aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ab0: 2020 6966 206b 7562 6574 7970 6520 3d3d    if kubetype ==
+00025ac0: 2027 6879 7065 7273 6869 6674 273a 0a20   'hypershift':. 
+00025ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ae0: 2020 2020 2020 2068 7970 6572 7368 6966         hypershif
+00025af0: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
+00025b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b10: 2061 7373 6973 7465 6420 3d20 636c 7573   assisted = clus
+00025b20: 7465 7264 6174 612e 6765 7428 2761 7373  terdata.get('ass
+00025b30: 6973 7465 6427 2c20 4661 6c73 6529 0a20  isted', False). 
+00025b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b50: 2020 2064 6f6d 6169 6e20 3d20 636c 7573     domain = clus
+00025b60: 7465 7264 6174 612e 6765 7428 2764 6f6d  terdata.get('dom
+00025b70: 6169 6e27 2c20 646f 6d61 696e 290a 2020  ain', domain).  
+00025b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b90: 2020 646e 7363 6c69 656e 7420 3d20 636c    dnsclient = cl
+00025ba0: 7573 7465 7264 6174 612e 6765 7428 2764  usterdata.get('d
+00025bb0: 6e73 636c 6965 6e74 2729 0a20 2020 2020  nsclient').     
+00025bc0: 2020 2020 2020 2069 6620 6e6f 7420 6879         if not hy
+00025bd0: 7065 7273 6869 6674 3a0a 2020 2020 2020  pershift:.      
+00025be0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00025bf0: 2866 2244 656c 6574 696e 6720 6469 7265  (f"Deleting dire
+00025c00: 6374 6f72 7920 7b63 6c75 7374 6572 6469  ctory {clusterdi
+00025c10: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
+00025c20: 2020 2020 2072 6d74 7265 6528 636c 7573       rmtree(clus
+00025c30: 7465 7264 6972 290a 2020 2020 2020 2020  terdir).        
+00025c40: 6465 6c65 7465 636c 6965 6e74 7320 3d20  deleteclients = 
+00025c50: 7b73 656c 662e 636c 6965 6e74 3a20 6b7d  {self.client: k}
+00025c60: 0a20 2020 2020 2020 2076 6d63 6c69 656e  .        vmclien
+00025c70: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00025c80: 766d 636c 6965 6e74 735f 6669 6c65 203d  vmclients_file =
+00025c90: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+00025ca0: 7365 7228 6627 7e2f 2e6b 636c 692f 766d  ser(f'~/.kcli/vm
+00025cb0: 636c 6965 6e74 735f 7b63 6c75 7374 6572  clients_{cluster
+00025cc0: 7d27 290a 2020 2020 2020 2020 6966 206f  }').        if o
+00025cd0: 732e 7061 7468 2e65 7869 7374 7328 766d  s.path.exists(vm
+00025ce0: 636c 6965 6e74 735f 6669 6c65 293a 0a20  clients_file):. 
+00025cf0: 2020 2020 2020 2020 2020 2076 6d63 6c69             vmcli
+00025d00: 656e 7473 203d 2079 616d 6c2e 7361 6665  ents = yaml.safe
+00025d10: 5f6c 6f61 6428 6f70 656e 2876 6d63 6c69  _load(open(vmcli
+00025d20: 656e 7473 5f66 696c 6529 290a 2020 2020  ents_file)).    
+00025d30: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+00025d40: 6528 766d 636c 6965 6e74 735f 6669 6c65  e(vmclients_file
+00025d50: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+00025d60: 662e 6578 7472 6163 6c69 656e 7473 3a0a  f.extraclients:.
+00025d70: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
+00025d80: 7465 636c 6965 6e74 732e 7570 6461 7465  teclients.update
+00025d90: 2873 656c 662e 6578 7472 6163 6c69 656e  (self.extraclien
+00025da0: 7473 290a 2020 2020 2020 2020 656c 6966  ts).        elif
+00025db0: 2076 6d63 6c69 656e 7473 3a0a 2020 2020   vmclients:.    
+00025dc0: 2020 2020 2020 2020 6465 6c65 7465 636c          deletecl
+00025dd0: 6965 6e74 732e 7570 6461 7465 287b 636c  ients.update({cl
+00025de0: 693a 204b 636f 6e66 6967 2863 6c69 656e  i: Kconfig(clien
+00025df0: 743d 636c 6929 2e6b 2066 6f72 2063 6c69  t=cli).k for cli
+00025e00: 2069 6e20 766d 636c 6965 6e74 7320 6966   in vmclients if
+00025e10: 2063 6c69 2021 3d20 7365 6c66 2e63 6c69   cli != self.cli
+00025e20: 656e 747d 290a 2020 2020 2020 2020 666f  ent}).        fo
+00025e30: 7220 6879 7065 7276 6973 6f72 2069 6e20  r hypervisor in 
+00025e40: 6465 6c65 7465 636c 6965 6e74 733a 0a20  deleteclients:. 
+00025e50: 2020 2020 2020 2020 2020 2063 203d 2064             c = d
+00025e60: 656c 6574 6563 6c69 656e 7473 5b68 7970  eleteclients[hyp
+00025e70: 6572 7669 736f 725d 0a20 2020 2020 2020  ervisor].       
+00025e80: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
+00025e90: 6f72 7465 6428 632e 6c69 7374 2829 2c20  orted(c.list(), 
+00025ea0: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
+00025eb0: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
+00025ec0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00025ed0: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+00025ee0: 2020 2020 2020 2020 2020 2020 646e 7363              dnsc
+00025ef0: 6c69 656e 7420 3d20 766d 2e67 6574 2827  lient = vm.get('
+00025f00: 646e 7363 6c69 656e 7427 2920 6f72 2064  dnsclient') or d
+00025f10: 6e73 636c 6965 6e74 0a20 2020 2020 2020  nsclient.       
+00025f20: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00025f30: 636c 7573 7465 7220 3d20 766d 2e67 6574  cluster = vm.get
+00025f40: 2827 6b75 6265 2729 0a20 2020 2020 2020  ('kube').       
+00025f50: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
+00025f60: 656e 7463 6c75 7374 6572 2069 7320 6e6f  entcluster is no
+00025f70: 7420 4e6f 6e65 2061 6e64 2063 7572 7265  t None and curre
+00025f80: 6e74 636c 7573 7465 7220 3d3d 2063 6c75  ntcluster == clu
+00025f90: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
+00025fa0: 2020 2020 2020 2020 2020 632e 6465 6c65            c.dele
+00025fb0: 7465 286e 616d 652c 2073 6e61 7073 686f  te(name, snapsho
+00025fc0: 7473 3d54 7275 6529 0a20 2020 2020 2020  ts=True).       
+00025fd0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00025fe0: 6d6f 6e2e 7365 745f 6c61 7374 766d 286e  mon.set_lastvm(n
+00025ff0: 616d 652c 2073 656c 662e 636c 6965 6e74  ame, self.client
+00026000: 2c20 6465 6c65 7465 3d54 7275 6529 0a20  , delete=True). 
+00026010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026020: 2020 2073 7563 6365 7373 2866 227b 6e61     success(f"{na
+00026030: 6d65 7d20 6465 6c65 7465 6420 6f6e 207b  me} deleted on {
+00026040: 6879 7065 7276 6973 6f72 7d21 2229 0a20  hypervisor}!"). 
+00026050: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00026060: 7970 6520 3d3d 2027 6b75 6265 7669 7274  ype == 'kubevirt
+00026070: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
+00026080: 6620 6622 7b63 6c75 7374 6572 7d2d 6170  f f"{cluster}-ap
+00026090: 6922 2069 6e20 6b2e 6c69 7374 5f73 6572  i" in k.list_ser
+000260a0: 7669 6365 7328 6b2e 6e61 6d65 7370 6163  vices(k.namespac
+000260b0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000260c0: 2020 2020 6b2e 6465 6c65 7465 5f73 6572      k.delete_ser
+000260d0: 7669 6365 2866 227b 636c 7573 7465 727d  vice(f"{cluster}
+000260e0: 2d61 7069 222c 206b 2e6e 616d 6573 7061  -api", k.namespa
+000260f0: 6365 290a 2020 2020 2020 2020 2020 2020  ce).            
+00026100: 6966 2066 227b 636c 7573 7465 727d 2d69  if f"{cluster}-i
+00026110: 6e67 7265 7373 2220 696e 206b 2e6c 6973  ngress" in k.lis
+00026120: 745f 7365 7276 6963 6573 286b 2e6e 616d  t_services(k.nam
+00026130: 6573 7061 6365 293a 0a20 2020 2020 2020  espace):.       
+00026140: 2020 2020 2020 2020 206b 2e64 656c 6574           k.delet
+00026150: 655f 7365 7276 6963 6528 6622 7b63 6c75  e_service(f"{clu
+00026160: 7374 6572 7d2d 696e 6772 6573 7322 2c20  ster}-ingress", 
+00026170: 6b2e 6e61 6d65 7370 6163 6529 0a20 2020  k.namespace).   
+00026180: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
+00026190: 6520 696e 205b 2761 7773 272c 2027 6763  e in ['aws', 'gc
+000261a0: 7027 2c20 2769 626d 275d 3a0a 2020 2020  p', 'ibm']:.    
+000261b0: 2020 2020 2020 2020 6c62 7320 3d20 5b27          lbs = ['
+000261c0: 6170 6927 5d0a 2020 2020 2020 2020 2020  api'].          
+000261d0: 2020 6966 206b 7562 6574 7970 6520 6e6f    if kubetype no
+000261e0: 7420 696e 205b 276b 3373 272c 2027 6765  t in ['k3s', 'ge
+000261f0: 6e65 7269 6327 5d3a 0a20 2020 2020 2020  neric']:.       
+00026200: 2020 2020 2020 2020 206c 6273 2e61 7070           lbs.app
+00026210: 656e 6428 2761 7070 7327 290a 2020 2020  end('apps').    
+00026220: 2020 2020 2020 2020 666f 7220 6c62 2069          for lb i
+00026230: 6e20 6c62 733a 0a20 2020 2020 2020 2020  n lbs:.         
+00026240: 2020 2020 2020 2073 656c 662e 6465 6c65         self.dele
+00026250: 7465 5f6c 6f61 6462 616c 616e 6365 7228  te_loadbalancer(
+00026260: 6622 7b6c 627d 2e7b 636c 7573 7465 727d  f"{lb}.{cluster}
+00026270: 222c 2064 6f6d 6169 6e3d 646f 6d61 696e  ", domain=domain
+00026280: 290a 2020 2020 2020 2020 2020 2020 6275  ).            bu
+00026290: 636b 6574 203d 2066 227b 636c 7573 7465  cket = f"{cluste
+000262a0: 727d 2d7b 646f 6d61 696e 7d22 0a20 2020  r}-{domain}".   
+000262b0: 2020 2020 2020 2020 2069 6620 6275 636b           if buck
+000262c0: 6574 2069 6e20 7365 6c66 2e6b 2e6c 6973  et in self.k.lis
+000262d0: 745f 6275 636b 6574 7328 293a 0a20 2020  t_buckets():.   
+000262e0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+000262f0: 696e 7428 6622 4465 6c65 7469 6e67 2062  int(f"Deleting b
+00026300: 7563 6b65 7420 7b62 7563 6b65 747d 2229  ucket {bucket}")
+00026310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026320: 206b 2e64 656c 6574 655f 6275 636b 6574   k.delete_bucket
+00026330: 2862 7563 6b65 7429 0a20 2020 2020 2020  (bucket).       
+00026340: 2065 6c69 6620 646e 7363 6c69 656e 7420   elif dnsclient 
+00026350: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00026360: 2020 2020 2020 2020 207a 203d 204b 636f           z = Kco
+00026370: 6e66 6967 2863 6c69 656e 743d 646e 7363  nfig(client=dnsc
+00026380: 6c69 656e 7429 2e6b 0a20 2020 2020 2020  lient).k.       
+00026390: 2020 2020 207a 2e64 656c 6574 655f 646e       z.delete_dn
+000263a0: 7328 6622 6170 692e 7b63 6c75 7374 6572  s(f"api.{cluster
+000263b0: 7d22 2c20 646f 6d61 696e 290a 2020 2020  }", domain).    
+000263c0: 2020 2020 2020 2020 7a2e 6465 6c65 7465          z.delete
+000263d0: 5f64 6e73 2866 2261 7070 732e 7b63 6c75  _dns(f"apps.{clu
+000263e0: 7374 6572 7d22 2c20 646f 6d61 696e 290a  ster}", domain).
+000263f0: 2020 2020 2020 2020 6966 2068 7970 6572          if hyper
+00026400: 7368 6966 743a 0a20 2020 2020 2020 2020  shift:.         
+00026410: 2020 206b 7562 6563 6f6e 6669 676d 676d     kubeconfigmgm
+00026420: 7420 3d20 6622 7b63 6c75 7374 6572 6469  t = f"{clusterdi
+00026430: 727d 2f6b 7562 6563 6f6e 6669 672e 6d67  r}/kubeconfig.mg
+00026440: 6d74 220a 2020 2020 2020 2020 2020 2020  mt".            
+00026450: 6361 6c6c 2866 274b 5542 4543 4f4e 4649  call(f'KUBECONFI
+00026460: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
+00026470: 747d 206f 6320 6465 6c65 7465 202d 6620  t} oc delete -f 
+00026480: 7b63 6c75 7374 6572 6469 727d 2f61 7574  {clusterdir}/aut
+00026490: 6f61 7070 726f 7665 7263 726f 6e2e 796d  oapprovercron.ym
+000264a0: 6c27 2c20 7368 656c 6c3d 5472 7565 290a  l', shell=True).
+000264b0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+000264c0: 2866 274b 5542 4543 4f4e 4649 473d 7b6b  (f'KUBECONFIG={k
+000264d0: 7562 6563 6f6e 6669 676d 676d 747d 206f  ubeconfigmgmt} o
+000264e0: 6320 6465 6c65 7465 202d 6620 7b63 6c75  c delete -f {clu
+000264f0: 7374 6572 6469 727d 2f6e 6f64 6570 6f6f  sterdir}/nodepoo
+00026500: 6c2e 7961 6d6c 272c 2073 6865 6c6c 3d54  l.yaml', shell=T
+00026510: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00026520: 2063 616c 6c28 6627 4b55 4245 434f 4e46   call(f'KUBECONF
+00026530: 4947 3d7b 6b75 6265 636f 6e66 6967 6d67  IG={kubeconfigmg
+00026540: 6d74 7d20 6f63 2064 656c 6574 6520 2d66  mt} oc delete -f
+00026550: 207b 636c 7573 7465 7264 6972 7d2f 686f   {clusterdir}/ho
+00026560: 7374 6564 636c 7573 7465 722e 7961 6d6c  stedcluster.yaml
+00026570: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
+00026580: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00026590: 7420 6173 7369 7374 6564 2061 6e64 2028  t assisted and (
+000265a0: 2762 6172 656d 6574 616c 5f69 736f 2720  'baremetal_iso' 
+000265b0: 696e 2063 6c75 7374 6572 6461 7461 206f  in clusterdata o
+000265c0: 7220 2762 6172 656d 6574 616c 5f68 6f73  r 'baremetal_hos
+000265d0: 7473 2720 696e 2063 6c75 7374 6572 6461  ts' in clusterda
+000265e0: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
+000265f0: 2020 2020 2063 616c 6c28 6627 4b55 4245       call(f'KUBE
+00026600: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
+00026610: 6967 6d67 6d74 7d20 6f63 202d 6e20 6465  igmgmt} oc -n de
+00026620: 6661 756c 7420 6465 6c65 7465 2061 6c6c  fault delete all
+00026630: 202d 6c20 6170 703d 6874 7470 642d 6b63   -l app=httpd-kc
+00026640: 6c69 272c 2073 6865 6c6c 3d54 7275 6529  li', shell=True)
+00026650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026660: 2063 616c 6c28 6627 4b55 4245 434f 4e46   call(f'KUBECONF
+00026670: 4947 3d7b 6b75 6265 636f 6e66 6967 6d67  IG={kubeconfigmg
+00026680: 6d74 7d20 6f63 202d 6e20 6465 6661 756c  mt} oc -n defaul
+00026690: 7420 6465 6c65 7465 2070 7663 2068 7474  t delete pvc htt
+000266a0: 7064 2d6b 636c 692d 7076 6327 2c20 7368  pd-kcli-pvc', sh
+000266b0: 656c 6c3d 5472 7565 290a 2020 2020 2020  ell=True).      
+000266c0: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
+000266d0: 656c 6574 696e 6720 6469 7265 6374 6f72  eleting director
+000266e0: 7920 7b63 6c75 7374 6572 6469 727d 2229  y {clusterdir}")
+000266f0: 0a20 2020 2020 2020 2020 2020 2072 6d74  .            rmt
+00026700: 7265 6528 636c 7573 7465 7264 6972 290a  ree(clusterdir).
+00026710: 2020 2020 2020 2020 666f 7220 636f 6e66          for conf
+00026720: 706f 6f6c 2069 6e20 7365 6c66 2e63 6f6e  pool in self.con
+00026730: 6670 6f6f 6c73 3a0a 2020 2020 2020 2020  fpools:.        
+00026740: 2020 2020 6970 5f72 6573 6572 7661 7469      ip_reservati
+00026750: 6f6e 7320 3d20 7365 6c66 2e63 6f6e 6670  ons = self.confp
+00026760: 6f6f 6c73 5b63 6f6e 6670 6f6f 6c5d 2e67  ools[confpool].g
+00026770: 6574 2827 6970 5f72 6573 6572 7661 7469  et('ip_reservati
+00026780: 6f6e 7327 2c20 7b7d 290a 2020 2020 2020  ons', {}).      
+00026790: 2020 2020 2020 6966 2063 6c75 7374 6572        if cluster
+000267a0: 2069 6e20 6970 5f72 6573 6572 7661 7469   in ip_reservati
+000267b0: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+000267c0: 2020 2020 2064 656c 2069 705f 7265 7365       del ip_rese
+000267d0: 7276 6174 696f 6e73 5b63 6c75 7374 6572  rvations[cluster
+000267e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000267f0: 2020 7365 6c66 2e75 7064 6174 655f 636f    self.update_co
+00026800: 6e66 706f 6f6c 2863 6f6e 6670 6f6f 6c2c  nfpool(confpool,
+00026810: 207b 2769 705f 7265 7365 7276 6174 696f   {'ip_reservatio
+00026820: 6e73 273a 2069 705f 7265 7365 7276 6174  ns': ip_reservat
+00026830: 696f 6e73 7d29 0a20 2020 2020 2020 2020  ions}).         
+00026840: 2020 206e 616d 655f 7265 7365 7276 6174     name_reservat
+00026850: 696f 6e73 203d 2073 656c 662e 636f 6e66  ions = self.conf
+00026860: 706f 6f6c 735b 636f 6e66 706f 6f6c 5d2e  pools[confpool].
+00026870: 6765 7428 276e 616d 655f 7265 7365 7276  get('name_reserv
+00026880: 6174 696f 6e73 272c 205b 5d29 0a20 2020  ations', []).   
+00026890: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
+000268a0: 7465 7220 696e 206e 616d 655f 7265 7365  ter in name_rese
+000268b0: 7276 6174 696f 6e73 3a0a 2020 2020 2020  rvations:.      
+000268c0: 2020 2020 2020 2020 2020 6e61 6d65 5f72            name_r
+000268d0: 6573 6572 7661 7469 6f6e 732e 7265 6d6f  eservations.remo
+000268e0: 7665 2863 6c75 7374 6572 290a 2020 2020  ve(cluster).    
+000268f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00026900: 2e75 7064 6174 655f 636f 6e66 706f 6f6c  .update_confpool
+00026910: 2863 6f6e 6670 6f6f 6c2c 207b 276e 616d  (confpool, {'nam
+00026920: 655f 7265 7365 7276 6174 696f 6e73 273a  e_reservations':
+00026930: 206e 616d 655f 7265 7365 7276 6174 696f   name_reservatio
+00026940: 6e73 7d29 0a20 2020 2020 2020 2020 2020  ns}).           
+00026950: 2063 6c75 7374 6572 5f62 6172 656d 6574   cluster_baremet
+00026960: 616c 5f72 6573 6572 7661 7469 6f6e 7320  al_reservations 
+00026970: 3d20 7365 6c66 2e63 6f6e 6670 6f6f 6c73  = self.confpools
+00026980: 5b63 6f6e 6670 6f6f 6c5d 2e67 6574 2827  [confpool].get('
+00026990: 636c 7573 7465 725f 6261 7265 6d65 7461  cluster_baremeta
+000269a0: 6c5f 7265 7365 7276 6174 696f 6e73 272c  l_reservations',
+000269b0: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
+000269c0: 2069 6620 636c 7573 7465 7220 696e 2063   if cluster in c
+000269d0: 6c75 7374 6572 5f62 6172 656d 6574 616c  luster_baremetal
+000269e0: 5f72 6573 6572 7661 7469 6f6e 733a 0a20  _reservations:. 
+000269f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00026a00: 656c 2063 6c75 7374 6572 5f62 6172 656d  el cluster_barem
+00026a10: 6574 616c 5f72 6573 6572 7661 7469 6f6e  etal_reservation
+00026a20: 735b 636c 7573 7465 725d 0a20 2020 2020  s[cluster].     
+00026a30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00026a40: 7570 6461 7465 5f63 6f6e 6670 6f6f 6c28  update_confpool(
+00026a50: 636f 6e66 706f 6f6c 2c20 7b27 636c 7573  confpool, {'clus
+00026a60: 7465 725f 6261 7265 6d65 7461 6c5f 7265  ter_baremetal_re
+00026a70: 7365 7276 6174 696f 6e73 273a 2063 6c75  servations': clu
 00026a80: 7374 6572 5f62 6172 656d 6574 616c 5f72  ster_baremetal_r
-00026a90: 6573 6572 7661 7469 6f6e 7320 3d20 7365  eservations = se
-00026aa0: 6c66 2e63 6f6e 6670 6f6f 6c73 5b63 6f6e  lf.confpools[con
-00026ab0: 6670 6f6f 6c5d 2e67 6574 2827 636c 7573  fpool].get('clus
-00026ac0: 7465 725f 6261 7265 6d65 7461 6c5f 7265  ter_baremetal_re
-00026ad0: 7365 7276 6174 696f 6e73 272c 207b 7d29  servations', {})
-00026ae0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026af0: 636c 7573 7465 7220 696e 2063 6c75 7374  cluster in clust
-00026b00: 6572 5f62 6172 656d 6574 616c 5f72 6573  er_baremetal_res
-00026b10: 6572 7661 7469 6f6e 733a 0a20 2020 2020  ervations:.     
-00026b20: 2020 2020 2020 2020 2020 2064 656c 2063             del c
-00026b30: 6c75 7374 6572 5f62 6172 656d 6574 616c  luster_baremetal
-00026b40: 5f72 6573 6572 7661 7469 6f6e 735b 636c  _reservations[cl
-00026b50: 7573 7465 725d 0a20 2020 2020 2020 2020  uster].         
-00026b60: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00026b70: 7465 5f63 6f6e 6670 6f6f 6c28 636f 6e66  te_confpool(conf
-00026b80: 706f 6f6c 2c20 7b27 636c 7573 7465 725f  pool, {'cluster_
-00026b90: 6261 7265 6d65 7461 6c5f 7265 7365 7276  baremetal_reserv
-00026ba0: 6174 696f 6e73 273a 2063 6c75 7374 6572  ations': cluster
-00026bb0: 5f62 6172 656d 6574 616c 5f72 6573 6572  _baremetal_reser
-00026bc0: 7661 7469 6f6e 737d 290a 2020 2020 2020  vations}).      
-00026bd0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00026be0: 7427 3a20 2773 7563 6365 7373 277d 0a0a  t': 'success'}..
-00026bf0: 2020 2020 6465 6620 7363 616c 655f 6b75      def scale_ku
-00026c00: 6265 2873 656c 662c 2063 6c75 7374 6572  be(self, cluster
-00026c10: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
-00026c20: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
-00026c30: 2020 2069 6620 6b75 6265 7479 7065 203d     if kubetype =
-00026c40: 3d20 2767 656e 6572 6963 273a 0a20 2020  = 'generic':.   
-00026c50: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00026c60: 3d20 7365 6c66 2e73 6361 6c65 5f6b 7562  = self.scale_kub
-00026c70: 655f 6765 6e65 7269 6328 636c 7573 7465  e_generic(cluste
-00026c80: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
-00026c90: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
-00026ca0: 656c 6966 206b 7562 6574 7970 6520 3d3d  elif kubetype ==
-00026cb0: 2027 6b33 7327 3a0a 2020 2020 2020 2020   'k3s':.        
-00026cc0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00026cd0: 662e 7363 616c 655f 6b75 6265 5f6b 3373  f.scale_kube_k3s
-00026ce0: 2863 6c75 7374 6572 2c20 6f76 6572 7269  (cluster, overri
-00026cf0: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
-00026d00: 2020 2020 2020 2065 6c69 6620 6b75 6265         elif kube
-00026d10: 7479 7065 203d 3d20 276f 7065 6e73 6869  type == 'openshi
-00026d20: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
-00026d30: 2072 6573 756c 7420 3d20 7365 6c66 2e73   result = self.s
-00026d40: 6361 6c65 5f6b 7562 655f 6f70 656e 7368  cale_kube_opensh
-00026d50: 6966 7428 636c 7573 7465 722c 206f 7665  ift(cluster, ove
-00026d60: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00026d70: 290a 2020 2020 2020 2020 656c 6966 206b  ).        elif k
-00026d80: 7562 6574 7970 6520 3d3d 2027 6879 7065  ubetype == 'hype
-00026d90: 7273 6869 6674 273a 0a20 2020 2020 2020  rshift':.       
-00026da0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00026db0: 6c66 2e73 6361 6c65 5f6b 7562 655f 6879  lf.scale_kube_hy
-00026dc0: 7065 7273 6869 6674 2863 6c75 7374 6572  pershift(cluster
-00026dd0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00026de0: 7269 6465 7329 0a20 2020 2020 2020 2072  rides).        r
-00026df0: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
-00026e00: 2020 6465 6620 7363 616c 655f 6b75 6265    def scale_kube
-00026e10: 5f67 656e 6572 6963 2873 656c 662c 2063  _generic(self, c
-00026e20: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00026e30: 733d 7b7d 293a 0a20 2020 2020 2020 2070  s={}):.        p
-00026e40: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
-00026e50: 2e64 6972 6e61 6d65 286b 7562 6561 646d  .dirname(kubeadm
-00026e60: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
-00026e70: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
-00026e80: 2020 2020 2020 7265 7475 726e 206b 7562        return kub
-00026e90: 6561 646d 2e73 6361 6c65 2873 656c 662c  eadm.scale(self,
-00026ea0: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
-00026eb0: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
-00026ec0: 2020 2064 6566 2073 6361 6c65 5f6b 7562     def scale_kub
-00026ed0: 655f 6b33 7328 7365 6c66 2c20 636c 7573  e_k3s(self, clus
-00026ee0: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
-00026ef0: 7d29 3a0a 2020 2020 2020 2020 706c 616e  }):.        plan
-00026f00: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-00026f10: 726e 616d 6528 6b33 732e 6372 6561 7465  rname(k3s.create
-00026f20: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-00026f30: 656e 616d 6529 0a20 2020 2020 2020 2072  ename).        r
-00026f40: 6574 7572 6e20 6b33 732e 7363 616c 6528  eturn k3s.scale(
-00026f50: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
-00026f60: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00026f70: 7329 0a0a 2020 2020 6465 6620 7363 616c  s)..    def scal
-00026f80: 655f 6b75 6265 5f68 7970 6572 7368 6966  e_kube_hypershif
-00026f90: 7428 7365 6c66 2c20 636c 7573 7465 722c  t(self, cluster,
-00026fa0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-00026fb0: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-00026fc0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00026fd0: 6528 6879 7065 7273 6869 6674 2e63 7265  e(hypershift.cre
-00026fe0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
-00026ff0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-00027000: 2020 7265 7475 726e 2068 7970 6572 7368    return hypersh
-00027010: 6966 742e 7363 616c 6528 7365 6c66 2c20  ift.scale(self, 
-00027020: 706c 616e 6469 722c 2063 6c75 7374 6572  plandir, cluster
-00027030: 2c20 6f76 6572 7269 6465 7329 0a0a 2020  , overrides)..  
-00027040: 2020 6465 6620 7363 616c 655f 6b75 6265    def scale_kube
-00027050: 5f6f 7065 6e73 6869 6674 2873 656c 662c  _openshift(self,
-00027060: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-00027070: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-00027080: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
-00027090: 7468 2e64 6972 6e61 6d65 286f 7065 6e73  th.dirname(opens
-000270a0: 6869 6674 2e63 7265 6174 652e 5f5f 636f  hift.create.__co
-000270b0: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
-000270c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000270d0: 206f 7065 6e73 6869 6674 2e73 6361 6c65   openshift.scale
-000270e0: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
-000270f0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00027100: 6573 290a 0a20 2020 2064 6566 2075 7064  es)..    def upd
-00027110: 6174 655f 6b75 6265 2873 656c 662c 2063  ate_kube(self, c
-00027120: 6c75 7374 6572 2c20 5f74 7970 652c 206f  luster, _type, o
-00027130: 7665 7272 6964 6573 3d7b 7d2c 2070 6c61  verrides={}, pla
-00027140: 6e3d 4e6f 6e65 293a 0a20 2020 2020 2020  n=None):.       
-00027150: 206f 7665 7272 6964 6573 5b27 736b 6970   overrides['skip
-00027160: 5f66 696c 6573 5f72 656d 6564 6961 7469  _files_remediati
-00027170: 6f6e 275d 203d 2054 7275 650a 2020 2020  on'] = True.    
-00027180: 2020 2020 6f76 6572 7269 6465 735b 2773      overrides['s
-00027190: 6361 6c65 275d 203d 2054 7275 650a 2020  cale'] = True.  
-000271a0: 2020 2020 2020 636c 7573 7465 7264 6972        clusterdir
-000271b0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-000271c0: 6475 7365 7228 6622 7e2f 2e6b 636c 692f  duser(f"~/.kcli/
-000271d0: 636c 7573 7465 7273 2f7b 636c 7573 7465  clusters/{cluste
-000271e0: 727d 2229 0a20 2020 2020 2020 2070 6c61  r}").        pla
-000271f0: 6e76 6d73 203d 205b 5d0a 2020 2020 2020  nvms = [].      
-00027200: 2020 6966 2070 6c61 6e20 6973 204e 6f6e    if plan is Non
-00027210: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00027220: 6c61 6e20 3d20 636c 7573 7465 720a 2020  lan = cluster.  
-00027230: 2020 2020 2020 6966 205f 7479 7065 203d        if _type =
-00027240: 3d20 2767 656e 6572 6963 273a 0a20 2020  = 'generic':.   
-00027250: 2020 2020 2020 2020 2072 6f6c 6573 203d           roles =
-00027260: 205b 2763 746c 706c 616e 6573 272c 2027   ['ctlplanes', '
-00027270: 776f 726b 6572 7327 5d0a 2020 2020 2020  workers'].      
-00027280: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00027290: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-000272a0: 6b75 6265 6164 6d2e 6372 6561 7465 2e5f  kubeadm.create._
-000272b0: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
-000272c0: 616d 6529 0a20 2020 2020 2020 2065 6c69  ame).        eli
-000272d0: 6620 5f74 7970 6520 3d3d 2027 6b33 7327  f _type == 'k3s'
+00026a90: 6573 6572 7661 7469 6f6e 737d 290a 2020  eservations}).  
+00026aa0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+00026ab0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+00026ac0: 277d 0a0a 2020 2020 6465 6620 7363 616c  '}..    def scal
+00026ad0: 655f 6b75 6265 2873 656c 662c 2063 6c75  e_kube(self, clu
+00026ae0: 7374 6572 2c20 6b75 6265 7479 7065 2c20  ster, kubetype, 
+00026af0: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+00026b00: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
+00026b10: 7065 203d 3d20 2767 656e 6572 6963 273a  pe == 'generic':
+00026b20: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00026b30: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
+00026b40: 5f6b 7562 655f 6765 6e65 7269 6328 636c  _kube_generic(cl
+00026b50: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00026b60: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00026b70: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
+00026b80: 6520 3d3d 2027 6b33 7327 3a0a 2020 2020  e == 'k3s':.    
+00026b90: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00026ba0: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
+00026bb0: 5f6b 3373 2863 6c75 7374 6572 2c20 6f76  _k3s(cluster, ov
+00026bc0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00026bd0: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
+00026be0: 6b75 6265 7479 7065 203d 3d20 276f 7065  kubetype == 'ope
+00026bf0: 6e73 6869 6674 273a 0a20 2020 2020 2020  nshift':.       
+00026c00: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+00026c10: 6c66 2e73 6361 6c65 5f6b 7562 655f 6f70  lf.scale_kube_op
+00026c20: 656e 7368 6966 7428 636c 7573 7465 722c  enshift(cluster,
+00026c30: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00026c40: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
+00026c50: 6966 206b 7562 6574 7970 6520 3d3d 2027  if kubetype == '
+00026c60: 6879 7065 7273 6869 6674 273a 0a20 2020  hypershift':.   
+00026c70: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00026c80: 3d20 7365 6c66 2e73 6361 6c65 5f6b 7562  = self.scale_kub
+00026c90: 655f 6879 7065 7273 6869 6674 2863 6c75  e_hypershift(clu
+00026ca0: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00026cb0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00026cc0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00026cd0: 0a0a 2020 2020 6465 6620 7363 616c 655f  ..    def scale_
+00026ce0: 6b75 6265 5f67 656e 6572 6963 2873 656c  kube_generic(sel
+00026cf0: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
+00026d00: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+00026d10: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
+00026d20: 7061 7468 2e64 6972 6e61 6d65 286b 7562  path.dirname(kub
+00026d30: 6561 646d 2e63 7265 6174 652e 5f5f 636f  eadm.create.__co
+00026d40: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
+00026d50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00026d60: 206b 7562 6561 646d 2e73 6361 6c65 2873   kubeadm.scale(s
+00026d70: 656c 662c 2070 6c61 6e64 6972 2c20 636c  elf, plandir, cl
+00026d80: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00026d90: 290a 0a20 2020 2064 6566 2073 6361 6c65  )..    def scale
+00026da0: 5f6b 7562 655f 6b33 7328 7365 6c66 2c20  _kube_k3s(self, 
+00026db0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00026dc0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
+00026dd0: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+00026de0: 682e 6469 726e 616d 6528 6b33 732e 6372  h.dirname(k3s.cr
+00026df0: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
+00026e00: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+00026e10: 2020 2072 6574 7572 6e20 6b33 732e 7363     return k3s.sc
+00026e20: 616c 6528 7365 6c66 2c20 706c 616e 6469  ale(self, plandi
+00026e30: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
+00026e40: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+00026e50: 7363 616c 655f 6b75 6265 5f68 7970 6572  scale_kube_hyper
+00026e60: 7368 6966 7428 7365 6c66 2c20 636c 7573  shift(self, clus
+00026e70: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00026e80: 7d29 3a0a 2020 2020 2020 2020 706c 616e  }):.        plan
+00026e90: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00026ea0: 726e 616d 6528 6879 7065 7273 6869 6674  rname(hypershift
+00026eb0: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
+00026ec0: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
+00026ed0: 2020 2020 2020 7265 7475 726e 2068 7970        return hyp
+00026ee0: 6572 7368 6966 742e 7363 616c 6528 7365  ershift.scale(se
+00026ef0: 6c66 2c20 706c 616e 6469 722c 2063 6c75  lf, plandir, clu
+00026f00: 7374 6572 2c20 6f76 6572 7269 6465 7329  ster, overrides)
+00026f10: 0a0a 2020 2020 6465 6620 7363 616c 655f  ..    def scale_
+00026f20: 6b75 6265 5f6f 7065 6e73 6869 6674 2873  kube_openshift(s
+00026f30: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00026f40: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+00026f50: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
+00026f60: 732e 7061 7468 2e64 6972 6e61 6d65 286f  s.path.dirname(o
+00026f70: 7065 6e73 6869 6674 2e63 7265 6174 652e  penshift.create.
+00026f80: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
+00026f90: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
+00026fa0: 7475 726e 206f 7065 6e73 6869 6674 2e73  turn openshift.s
+00026fb0: 6361 6c65 2873 656c 662c 2070 6c61 6e64  cale(self, pland
+00026fc0: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
+00026fd0: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
+00026fe0: 2075 7064 6174 655f 6b75 6265 2873 656c   update_kube(sel
+00026ff0: 662c 2063 6c75 7374 6572 2c20 5f74 7970  f, cluster, _typ
+00027000: 652c 206f 7665 7272 6964 6573 3d7b 7d2c  e, overrides={},
+00027010: 2070 6c61 6e3d 4e6f 6e65 293a 0a20 2020   plan=None):.   
+00027020: 2020 2020 206f 7665 7272 6964 6573 5b27       overrides['
+00027030: 736b 6970 5f66 696c 6573 5f72 656d 6564  skip_files_remed
+00027040: 6961 7469 6f6e 275d 203d 2054 7275 650a  iation'] = True.
+00027050: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+00027060: 735b 2773 6361 6c65 275d 203d 2054 7275  s['scale'] = Tru
+00027070: 650a 2020 2020 2020 2020 636c 7573 7465  e.        cluste
+00027080: 7264 6972 203d 206f 732e 7061 7468 2e65  rdir = os.path.e
+00027090: 7870 616e 6475 7365 7228 6622 7e2f 2e6b  xpanduser(f"~/.k
+000270a0: 636c 692f 636c 7573 7465 7273 2f7b 636c  cli/clusters/{cl
+000270b0: 7573 7465 727d 2229 0a20 2020 2020 2020  uster}").       
+000270c0: 2070 6c61 6e76 6d73 203d 205b 5d0a 2020   planvms = [].  
+000270d0: 2020 2020 2020 6966 2070 6c61 6e20 6973        if plan is
+000270e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000270f0: 2020 2070 6c61 6e20 3d20 636c 7573 7465     plan = cluste
+00027100: 720a 2020 2020 2020 2020 6966 205f 7479  r.        if _ty
+00027110: 7065 203d 3d20 2767 656e 6572 6963 273a  pe == 'generic':
+00027120: 0a20 2020 2020 2020 2020 2020 2072 6f6c  .            rol
+00027130: 6573 203d 205b 2763 746c 706c 616e 6573  es = ['ctlplanes
+00027140: 272c 2027 776f 726b 6572 7327 5d0a 2020  ', 'workers'].  
+00027150: 2020 2020 2020 2020 2020 706c 616e 6469            plandi
+00027160: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00027170: 616d 6528 6b75 6265 6164 6d2e 6372 6561  ame(kubeadm.crea
+00027180: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
+00027190: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+000271a0: 2065 6c69 6620 5f74 7970 6520 3d3d 2027   elif _type == '
+000271b0: 6b33 7327 3a0a 2020 2020 2020 2020 2020  k3s':.          
+000271c0: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
+000271d0: 6174 682e 6469 726e 616d 6528 6b33 732e  ath.dirname(k3s.
+000271e0: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
+000271f0: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
+00027200: 2020 2020 2020 2020 2072 6f6c 6573 203d           roles =
+00027210: 205b 2762 6f6f 7473 7472 6170 272c 2027   ['bootstrap', '
+00027220: 776f 726b 6572 7327 5d20 6966 206f 7665  workers'] if ove
+00027230: 7272 6964 6573 2e67 6574 2827 6374 6c70  rrides.get('ctlp
+00027240: 6c61 6e65 7327 2c20 3129 203d 3d20 3120  lanes', 1) == 1 
+00027250: 656c 7365 205b 2762 6f6f 7473 7472 6170  else ['bootstrap
+00027260: 272c 2027 6374 6c70 6c61 6e65 7327 2c0a  ', 'ctlplanes',.
+00027270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000272a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000272b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000272c0: 2020 2020 2020 2020 2027 776f 726b 6572           'worker
+000272d0: 7327 5d0a 2020 2020 2020 2020 656c 7365  s'].        else
 000272e0: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
 000272f0: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
-00027300: 6469 726e 616d 6528 6b33 732e 6372 6561  dirname(k3s.crea
-00027310: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
-00027320: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00027330: 2020 2020 2072 6f6c 6573 203d 205b 2762       roles = ['b
-00027340: 6f6f 7473 7472 6170 272c 2027 776f 726b  ootstrap', 'work
-00027350: 6572 7327 5d20 6966 206f 7665 7272 6964  ers'] if overrid
-00027360: 6573 2e67 6574 2827 6374 6c70 6c61 6e65  es.get('ctlplane
-00027370: 7327 2c20 3129 203d 3d20 3120 656c 7365  s', 1) == 1 else
-00027380: 205b 2762 6f6f 7473 7472 6170 272c 2027   ['bootstrap', '
-00027390: 6374 6c70 6c61 6e65 7327 2c0a 2020 2020  ctlplanes',.    
-000273a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273f0: 2020 2020 2027 776f 726b 6572 7327 5d0a       'workers'].
-00027400: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00027410: 2020 2020 2020 2020 2020 706c 616e 6469            plandi
-00027420: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-00027430: 616d 6528 6f70 656e 7368 6966 742e 6372  ame(openshift.cr
-00027440: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
-00027450: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
-00027460: 2020 2020 2020 2072 6f6c 6573 203d 205b         roles = [
-00027470: 2763 6c6f 7564 5f63 746c 706c 616e 6573  'cloud_ctlplanes
-00027480: 272c 2027 636c 6f75 645f 776f 726b 6572  ', 'cloud_worker
-00027490: 7327 5d20 6966 2073 656c 662e 7479 7065  s'] if self.type
-000274a0: 2069 6e20 5b27 6177 7327 2c20 2767 6370   in ['aws', 'gcp
-000274b0: 275d 2065 6c73 6520 5b27 6374 6c70 6c61  '] else ['ctlpla
-000274c0: 6e65 7327 2c20 2777 6f72 6b65 7273 275d  nes', 'workers']
-000274d0: 0a20 2020 2020 2020 2069 6620 6f76 6572  .        if over
-000274e0: 7269 6465 732e 6765 7428 2777 6f72 6b65  rides.get('worke
-000274f0: 7273 272c 2030 2920 3d3d 2030 3a0a 2020  rs', 0) == 0:.  
-00027500: 2020 2020 2020 2020 2020 6465 6c20 726f            del ro
-00027510: 6c65 735b 2d31 5d0a 2020 2020 2020 2020  les[-1].        
-00027520: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00027530: 7328 6622 7b63 6c75 7374 6572 6469 727d  s(f"{clusterdir}
-00027540: 2f6b 636c 695f 7061 7261 6d65 7465 7273  /kcli_parameters
-00027550: 2e79 6d6c 2229 3a0a 2020 2020 2020 2020  .yml"):.        
-00027560: 2020 2020 6461 7461 203d 207b 2763 6c75      data = {'clu
-00027570: 7374 6572 273a 2063 6c75 7374 6572 2c20  ster': cluster, 
-00027580: 276b 7562 6527 3a20 636c 7573 7465 722c  'kube': cluster,
-00027590: 2027 6b75 6265 7479 7065 273a 205f 7479   'kubetype': _ty
-000275a0: 7065 7d0a 2020 2020 2020 2020 2020 2020  pe}.            
-000275b0: 7769 7468 206f 7065 6e28 6622 7b63 6c75  with open(f"{clu
-000275c0: 7374 6572 6469 727d 2f6b 636c 695f 7061  sterdir}/kcli_pa
-000275d0: 7261 6d65 7465 7273 2e79 6d6c 222c 2027  rameters.yml", '
-000275e0: 7227 2920 6173 2069 6e73 7461 6c6c 3a0a  r') as install:.
-000275f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027600: 696e 7374 616c 6c70 6172 616d 203d 2079  installparam = y
-00027610: 616d 6c2e 7361 6665 5f6c 6f61 6428 696e  aml.safe_load(in
-00027620: 7374 616c 6c29 0a20 2020 2020 2020 2020  stall).         
-00027630: 2020 2020 2020 2064 6174 612e 7570 6461         data.upda
-00027640: 7465 2869 6e73 7461 6c6c 7061 7261 6d29  te(installparam)
-00027650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027660: 2070 6c61 6e20 3d20 696e 7374 616c 6c70   plan = installp
-00027670: 6172 616d 2e67 6574 2827 706c 616e 272c  aram.get('plan',
-00027680: 2070 6c61 6e29 0a20 2020 2020 2020 2020   plan).         
-00027690: 2020 2064 6174 612e 7570 6461 7465 286f     data.update(o
-000276a0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-000276b0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-000276c0: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
-000276d0: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
-000276e0: 6d6c 222c 2027 7727 2920 6173 2070 6172  ml", 'w') as par
-000276f0: 616d 6669 6c65 3a0a 2020 2020 2020 2020  amfile:.        
-00027700: 2020 2020 2020 2020 7961 6d6c 2e73 6166          yaml.saf
-00027710: 655f 6475 6d70 2864 6174 612c 2070 6172  e_dump(data, par
-00027720: 616d 6669 6c65 290a 2020 2020 2020 2020  amfile).        
-00027730: 6f73 2e63 6864 6972 286f 732e 7061 7468  os.chdir(os.path
-00027740: 2e65 7870 616e 6475 7365 7228 227e 2f2e  .expanduser("~/.
-00027750: 6b63 6c69 2229 290a 2020 2020 2020 2020  kcli")).        
-00027760: 666f 7220 726f 6c65 2069 6e20 726f 6c65  for role in role
-00027770: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00027780: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
-00027790: 2076 6d73 2077 6974 6820 7b72 6f6c 657d   vms with {role}
-000277a0: 2072 6f6c 6522 290a 2020 2020 2020 2020   role").        
-000277b0: 2020 2020 706c 616e 6461 7461 203d 2073      plandata = s
-000277c0: 656c 662e 706c 616e 2870 6c61 6e2c 2069  elf.plan(plan, i
-000277d0: 6e70 7574 6669 6c65 3d66 277b 706c 616e  nputfile=f'{plan
-000277e0: 6469 727d 2f7b 726f 6c65 7d2e 796d 6c27  dir}/{role}.yml'
-000277f0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00027800: 7269 6465 732c 2075 7064 6174 653d 5472  rides, update=Tr
-00027810: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00027820: 706c 616e 766d 732e 6578 7465 6e64 2870  planvms.extend(p
-00027830: 6c61 6e64 6174 615b 276e 6577 766d 7327  landata['newvms'
-00027840: 5d20 2b20 706c 616e 6461 7461 5b27 6578  ] + plandata['ex
-00027850: 6973 7469 6e67 766d 7327 5d29 0a20 2020  istingvms']).   
-00027860: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-00027870: 274b 5542 4543 4f4e 4649 4727 5d20 3d20  'KUBECONFIG'] = 
-00027880: 6622 7b63 6c75 7374 6572 6469 727d 2f61  f"{clusterdir}/a
-00027890: 7574 682f 6b75 6265 636f 6e66 6967 220a  uth/kubeconfig".
-000278a0: 2020 2020 2020 2020 6269 6e61 7279 203d          binary =
-000278b0: 2027 6f63 2720 6966 2077 6869 6368 2827   'oc' if which('
-000278c0: 6f63 2729 2069 7320 6e6f 7420 4e6f 6e65  oc') is not None
-000278d0: 2065 6c73 6520 276b 7562 6563 746c 270a   else 'kubectl'.
-000278e0: 2020 2020 2020 2020 6e6f 6465 7363 6d64          nodescmd
-000278f0: 203d 2066 277b 6269 6e61 7279 7d20 6765   = f'{binary} ge
-00027900: 7420 6e6f 6465 202d 6f20 6e61 6d65 270a  t node -o name'.
-00027910: 2020 2020 2020 2020 6e6f 6465 7320 3d20          nodes = 
-00027920: 5b6e 2e73 7472 6970 2829 2e72 6570 6c61  [n.strip().repla
-00027930: 6365 2827 6e6f 6465 2f27 2c20 2727 2920  ce('node/', '') 
-00027940: 666f 7220 6e20 696e 206f 732e 706f 7065  for n in os.pope
-00027950: 6e28 6e6f 6465 7363 6d64 292e 7265 6164  n(nodescmd).read
-00027960: 6c69 6e65 7328 295d 0a20 2020 2020 2020  lines()].       
-00027970: 2066 6f72 2076 6d20 696e 2073 656c 662e   for vm in self.
-00027980: 6b2e 6c69 7374 2829 3a0a 2020 2020 2020  k.list():.      
-00027990: 2020 2020 2020 766d 6e61 6d65 203d 2076        vmname = v
-000279a0: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
-000279b0: 2020 2020 2020 766d 706c 616e 203d 2076        vmplan = v
-000279c0: 6d2e 6765 7428 2770 6c61 6e27 2c20 276b  m.get('plan', 'k
-000279d0: 7669 7274 2729 0a20 2020 2020 2020 2020  virt').         
-000279e0: 2020 2069 6620 766d 706c 616e 203d 3d20     if vmplan == 
-000279f0: 706c 616e 2061 6e64 2076 6d6e 616d 6520  plan and vmname 
-00027a00: 6e6f 7420 696e 2070 6c61 6e76 6d73 3a0a  not in planvms:.
-00027a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a20: 7070 7269 6e74 2866 2244 656c 6574 696e  pprint(f"Deletin
-00027a30: 6720 766d 207b 766d 6e61 6d65 7d22 290a  g vm {vmname}").
-00027a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a50: 7365 6c66 2e6b 2e64 656c 6574 6528 766d  self.k.delete(vm
-00027a60: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00027a70: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
-00027a80: 6e20 6e6f 6465 733a 0a20 2020 2020 2020  n nodes:.       
-00027a90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00027aa0: 6e6f 6465 2e73 706c 6974 2827 2e27 295b  node.split('.')[
-00027ab0: 305d 203d 3d20 766d 6e61 6d65 3a0a 2020  0] == vmname:.  
-00027ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ad0: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
-00027ae0: 656c 6574 696e 6720 6e6f 6465 207b 6e6f  eleting node {no
-00027af0: 6465 7d20 6672 6f6d 2079 6f75 7220 636c  de} from your cl
-00027b00: 7573 7465 7222 290a 2020 2020 2020 2020  uster").        
-00027b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b20: 6361 6c6c 2866 277b 6269 6e61 7279 7d20  call(f'{binary} 
-00027b30: 6465 6c65 7465 206e 6f64 6520 7b6e 6f64  delete node {nod
-00027b40: 657d 272c 2073 6865 6c6c 3d54 7275 6529  e}', shell=True)
-00027b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027b60: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
-00027b70: 2020 2020 6465 6620 6578 706f 7365 5f70      def expose_p
-00027b80: 6c61 6e28 7365 6c66 2c20 706c 616e 2c20  lan(self, plan, 
-00027b90: 696e 7075 7466 696c 653d 4e6f 6e65 2c20  inputfile=None, 
-00027ba0: 6f76 6572 7269 6465 733d 7b7d 2c20 706f  overrides={}, po
-00027bb0: 7274 3d39 3030 302c 2070 666d 6f64 653d  rt=9000, pfmode=
-00027bc0: 4661 6c73 652c 2063 6c75 7374 6572 3d46  False, cluster=F
-00027bd0: 616c 7365 293a 0a20 2020 2020 2020 2069  alse):.        i
-00027be0: 6e70 7574 6669 6c65 203d 206f 732e 7061  nputfile = os.pa
-00027bf0: 7468 2e65 7870 616e 6475 7365 7228 696e  th.expanduser(in
-00027c00: 7075 7466 696c 6529 0a20 2020 2020 2020  putfile).       
-00027c10: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00027c20: 6578 6973 7473 2869 6e70 7574 6669 6c65  exists(inputfile
-00027c30: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-00027c40: 7272 6f72 2822 4e6f 2069 6e70 7574 2066  rror("No input f
-00027c50: 696c 6520 666f 756e 6420 6e6f 7220 6465  ile found nor de
-00027c60: 6661 756c 7420 6b63 6c69 5f70 6c61 6e2e  fault kcli_plan.
-00027c70: 796d 6c2e 4c65 6176 696e 672e 2e2e 2e22  yml.Leaving...."
-00027c80: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-00027c90: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00027ca0: 2020 7070 7269 6e74 2866 2248 616e 646c    pprint(f"Handl
-00027cb0: 696e 6720 6578 706f 7365 206f 6620 706c  ing expose of pl
-00027cc0: 616e 2077 6974 6820 6e61 6d65 207b 706c  an with name {pl
-00027cd0: 616e 7d20 616e 6420 696e 7075 7466 696c  an} and inputfil
-00027ce0: 6520 7b69 6e70 7574 6669 6c65 7d22 290a  e {inputfile}").
-00027cf0: 2020 2020 2020 2020 6b65 7870 6f73 6572          kexposer
-00027d00: 203d 204b 6578 706f 7365 7228 7365 6c66   = Kexposer(self
-00027d10: 2c20 706c 616e 2c20 696e 7075 7466 696c  , plan, inputfil
-00027d20: 652c 206f 7665 7272 6964 6573 3d6f 7665  e, overrides=ove
-00027d30: 7272 6964 6573 2c20 706f 7274 3d70 6f72  rrides, port=por
-00027d40: 742c 2070 666d 6f64 653d 7066 6d6f 6465  t, pfmode=pfmode
-00027d50: 2c20 636c 7573 7465 723d 636c 7573 7465  , cluster=cluste
-00027d60: 7229 0a20 2020 2020 2020 206b 6578 706f  r).        kexpo
-00027d70: 7365 722e 7275 6e28 290a 0a20 2020 2064  ser.run()..    d
-00027d80: 6566 2063 7265 6174 655f 6f70 656e 7368  ef create_opensh
-00027d90: 6966 745f 6973 6f28 7365 6c66 2c20 636c  ift_iso(self, cl
-00027da0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00027db0: 3d7b 7d2c 2069 676e 6974 696f 6e66 696c  ={}, ignitionfil
-00027dc0: 653d 4e6f 6e65 2c20 706f 646d 616e 3d46  e=None, podman=F
-00027dd0: 616c 7365 2c20 696e 7374 616c 6c65 723d  alse, installer=
-00027de0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00027df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e00: 2020 2020 6469 7265 6374 3d46 616c 7365      direct=False
-00027e10: 293a 0a20 2020 2020 2020 206d 6574 616c  ):.        metal
-00027e20: 5f75 726c 203d 204e 6f6e 650a 2020 2020  _url = None.    
-00027e30: 2020 2020 6973 6f5f 7665 7273 696f 6e20      iso_version 
-00027e40: 3d20 7374 7228 6f76 6572 7269 6465 732e  = str(overrides.
-00027e50: 6765 7428 2776 6572 7369 6f6e 272c 2027  get('version', '
-00027e60: 6c61 7465 7374 2729 290a 2020 2020 2020  latest')).      
-00027e70: 2020 6966 206e 6f74 2069 6e73 7461 6c6c    if not install
-00027e80: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00027e90: 6966 2069 736f 5f76 6572 7369 6f6e 206e  if iso_version n
-00027ea0: 6f74 2069 6e20 5b27 6c61 7465 7374 272c  ot in ['latest',
-00027eb0: 2027 7072 652d 7265 6c65 6173 6527 5d20   'pre-release'] 
-00027ec0: 616e 6420 6e6f 7420 6973 6f5f 7665 7273  and not iso_vers
-00027ed0: 696f 6e2e 7374 6172 7473 7769 7468 2827  ion.startswith('
-00027ee0: 342e 2729 3a0a 2020 2020 2020 2020 2020  4.'):.          
-00027ef0: 2020 2020 2020 7761 726e 696e 6728 2246        warning("F
-00027f00: 6f72 6369 6e67 206c 6976 6520 6973 6f20  orcing live iso 
-00027f10: 7665 7273 696f 6e20 746f 206c 6174 6573  version to lates
-00027f20: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
-00027f30: 2020 2020 6973 6f5f 7665 7273 696f 6e20      iso_version 
-00027f40: 3d20 276c 6174 6573 7427 0a20 2020 2020  = 'latest'.     
-00027f50: 2020 2020 2020 2065 6c69 6620 6973 6f5f         elif iso_
-00027f60: 7665 7273 696f 6e2e 7374 6172 7473 7769  version.startswi
-00027f70: 7468 2827 342e 2729 3a0a 2020 2020 2020  th('4.'):.      
-00027f80: 2020 2020 2020 2020 2020 6d69 6e6f 725f            minor_
-00027f90: 7665 7273 696f 6e20 3d20 6973 6f5f 7665  version = iso_ve
-00027fa0: 7273 696f 6e2e 7370 6c69 7428 272e 2729  rsion.split('.')
-00027fb0: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00027fc0: 2020 2020 6966 206d 696e 6f72 5f76 6572      if minor_ver
-00027fd0: 7369 6f6e 2e69 7364 6967 6974 2829 2061  sion.isdigit() a
-00027fe0: 6e64 2069 6e74 286d 696e 6f72 5f76 6572  nd int(minor_ver
-00027ff0: 7369 6f6e 2920 3c20 363a 0a20 2020 2020  sion) < 6:.     
-00028000: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00028010: 6574 616c 5f75 726c 203d 2066 2268 7474  etal_url = f"htt
-00028020: 7073 3a2f 2f6d 6972 726f 722e 6f70 656e  ps://mirror.open
-00028030: 7368 6966 742e 636f 6d2f 7075 622f 6f70  shift.com/pub/op
-00028040: 656e 7368 6966 742d 7634 2f64 6570 656e  enshift-v4/depen
-00028050: 6465 6e63 6965 732f 7268 636f 732f 7b69  dencies/rhcos/{i
-00028060: 736f 5f76 6572 7369 6f6e 7d2f 6c61 7465  so_version}/late
-00028070: 7374 220a 2020 2020 2020 2020 2020 2020  st".            
-00028080: 2020 2020 2020 2020 6d65 7461 6c5f 7572          metal_ur
-00028090: 6c20 2b3d 2022 2f72 6863 6f73 2d6d 6574  l += "/rhcos-met
-000280a0: 616c 2e78 3836 5f36 342e 7261 772e 677a  al.x86_64.raw.gz
-000280b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000280c0: 2020 2020 2020 7761 726e 696e 6728 2245        warning("E
-000280d0: 6d62 6564 6469 6e67 206d 6574 616c 2075  mbedding metal u
-000280e0: 726c 2069 6e20 6973 6f20 666f 7220 7461  rl in iso for ta
-000280f0: 7267 6574 2076 6572 7369 6f6e 2061 6e64  rget version and
-00028100: 2069 6e73 7461 6c6c 696e 6720 7769 7468   installing with
-00028110: 2061 206d 6f72 6520 7265 6365 6e74 2069   a more recent i
-00028120: 736f 2229 0a20 2020 2020 2020 2020 2020  so").           
-00028130: 2020 2020 2069 736f 5f76 6572 7369 6f6e       iso_version
-00028140: 203d 2027 6c61 7465 7374 270a 2020 2020   = 'latest'.    
-00028150: 2020 2020 6170 695f 6970 203d 206f 7665      api_ip = ove
-00028160: 7272 6964 6573 2e67 6574 2827 6170 695f  rrides.get('api_
-00028170: 6970 2729 0a20 2020 2020 2020 2069 676e  ip').        ign
-00028180: 6974 696f 6e5f 7665 7273 696f 6e20 3d20  ition_version = 
-00028190: 6f76 6572 7269 6465 732e 6765 7428 2769  overrides.get('i
-000281a0: 676e 6974 696f 6e5f 7665 7273 696f 6e27  gnition_version'
-000281b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000281c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281d0: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
-000281e0: 6e2e 6967 6e69 7469 6f6e 5f76 6572 7369  n.ignition_versi
-000281f0: 6f6e 2822 7268 636f 732d 2573 2220 2520  on("rhcos-%s" % 
-00028200: 6973 6f5f 7665 7273 696f 6e2e 7265 706c  iso_version.repl
-00028210: 6163 6528 272e 272c 2027 2729 2929 0a20  ace('.', ''))). 
-00028220: 2020 2020 2020 2072 6f6c 6520 3d20 6f76         role = ov
-00028230: 6572 7269 6465 732e 6765 7428 2772 6f6c  errides.get('rol
-00028240: 6527 2c20 2777 6f72 6b65 7227 290a 2020  e', 'worker').  
-00028250: 2020 2020 2020 6973 6f20 3d20 6f76 6572        iso = over
-00028260: 7269 6465 732e 6765 7428 2769 736f 272c  rides.get('iso',
-00028270: 2054 7275 6529 0a20 2020 2020 2020 2064   True).        d
-00028280: 6f6d 6169 6e20 3d20 6f76 6572 7269 6465  omain = override
-00028290: 732e 6765 7428 2764 6f6d 6169 6e27 290a  s.get('domain').
-000282a0: 2020 2020 2020 2020 6966 2027 2e27 2069          if '.' i
-000282b0: 6e20 636c 7573 7465 723a 0a20 2020 2020  n cluster:.     
-000282c0: 2020 2020 2020 2064 6f6d 6169 6e20 3d20         domain = 
-000282d0: 272e 272e 6a6f 696e 2863 6c75 7374 6572  '.'.join(cluster
-000282e0: 2e73 706c 6974 2827 2e27 295b 313a 5d29  .split('.')[1:])
-000282f0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-00028300: 696e 7428 6622 5573 696e 6720 646f 6d61  int(f"Using doma
-00028310: 696e 207b 646f 6d61 696e 7d22 290a 2020  in {domain}").  
-00028320: 2020 2020 2020 2020 2020 636c 7573 7465            cluste
-00028330: 7220 3d20 636c 7573 7465 722e 7265 706c  r = cluster.repl
-00028340: 6163 6528 6622 2e7b 646f 6d61 696e 7d22  ace(f".{domain}"
-00028350: 2c20 2727 290a 2020 2020 2020 2020 6966  , '').        if
-00028360: 2063 6c75 7374 6572 2e73 7461 7274 7377   cluster.startsw
-00028370: 6974 6828 2761 7069 2e27 293a 0a20 2020  ith('api.'):.   
-00028380: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
-00028390: 203d 2063 6c75 7374 6572 2e72 6570 6c61   = cluster.repla
-000283a0: 6365 2822 6170 692e 222c 2027 2729 0a20  ce("api.", ''). 
-000283b0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-000283c0: 7428 6622 5573 696e 6720 636c 7573 7465  t(f"Using cluste
-000283d0: 7220 7b63 6c75 7374 6572 7d22 290a 2020  r {cluster}").  
-000283e0: 2020 2020 2020 686f 7374 735f 636f 6e74        hosts_cont
-000283f0: 656e 7420 3d20 4e6f 6e65 0a20 2020 2020  ent = None.     
-00028400: 2020 2066 696e 616c 6461 7461 203d 204e     finaldata = N
-00028410: 6f6e 650a 2020 2020 2020 2020 6966 2069  one.        if i
-00028420: 676e 6974 696f 6e66 696c 6520 6973 206e  gnitionfile is n
-00028430: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00028440: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-00028450: 6174 682e 6578 6973 7473 2869 676e 6974  ath.exists(ignit
-00028460: 696f 6e66 696c 6529 3a0a 2020 2020 2020  ionfile):.      
-00028470: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00028480: 6622 7b69 676e 6974 696f 6e66 696c 657d  f"{ignitionfile}
-00028490: 206e 6f74 2066 6f75 6e64 2229 0a20 2020   not found").   
-000284a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-000284b0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-000284c0: 2020 2020 2066 696e 616c 6461 7461 203d       finaldata =
-000284d0: 206f 7065 6e28 6967 6e69 7469 6f6e 6669   open(ignitionfi
-000284e0: 6c65 292e 7265 6164 2829 0a20 2020 2020  le).read().     
-000284f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00028500: 2020 2020 2069 676e 6974 696f 6e66 696c       ignitionfil
-00028510: 6520 3d20 6622 7b72 6f6c 657d 2e69 676e  e = f"{role}.ign
-00028520: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-00028530: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00028540: 6967 6e69 7469 6f6e 6669 6c65 293a 0a20  ignitionfile):. 
-00028550: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00028560: 6172 6e69 6e67 2866 2255 7369 6e67 2065  arning(f"Using e
-00028570: 7869 7374 696e 6720 7b69 676e 6974 696f  xisting {ignitio
-00028580: 6e66 696c 657d 2229 0a20 2020 2020 2020  nfile}").       
-00028590: 2020 2020 2020 2020 2066 696e 616c 6461           finalda
-000285a0: 7461 203d 206f 7065 6e28 6967 6e69 7469  ta = open(igniti
-000285b0: 6f6e 6669 6c65 292e 7265 6164 2829 0a20  onfile).read(). 
-000285c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000285d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000285e0: 2069 6620 6170 695f 6970 2069 7320 4e6f   if api_ip is No
-000285f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00028600: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00028610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028620: 2020 2020 2061 7069 5f69 7020 3d20 736f       api_ip = so
-00028630: 636b 6574 2e67 6574 686f 7374 6279 6e61  cket.gethostbyna
-00028640: 6d65 2866 2761 7069 2e7b 636c 7573 7465  me(f'api.{cluste
-00028650: 727d 2e7b 646f 6d61 696e 7d27 290a 2020  r}.{domain}').  
-00028660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028670: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-00028680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028690: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-000286a0: 2020 2020 2020 2069 6620 6170 695f 6970         if api_ip
-000286b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000286c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000286d0: 2064 6f6d 6169 6e20 6973 204e 6f6e 653a   domain is None:
-000286e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000286f0: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-00028700: 436f 756c 646e 2774 2066 6967 7572 6520  Couldn't figure 
-00028710: 6f75 7420 6170 695f 6970 206e 6f72 2072  out api_ip nor r
-00028720: 656c 7920 6f6e 2064 6e73 2073 696e 6365  ely on dns since
-00028730: 2064 6f6d 6169 6e20 6973 206e 6f74 2073   domain is not s
-00028740: 6574 2229 0a20 2020 2020 2020 2020 2020  et").           
-00028750: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00028760: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00028770: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00028780: 6e69 6e67 2822 436f 756c 646e 2774 2066  ning("Couldn't f
-00028790: 6967 7572 6520 6f75 7420 6170 695f 6970  igure out api_ip
-000287a0: 2e20 5265 6c79 696e 6720 6f6e 2064 6e73  . Relying on dns
-000287b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000287c0: 2020 2020 2020 2061 7069 5f69 7020 3d20         api_ip = 
-000287d0: 6622 6170 692e 7b63 6c75 7374 6572 7d2e  f"api.{cluster}.
-000287e0: 7b64 6f6d 6169 6e7d 220a 2020 2020 2020  {domain}".      
-000287f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00028800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028810: 2020 2020 686f 7374 735f 636f 6e74 656e      hosts_conten
-00028820: 7420 3d20 2231 3237 2e30 2e30 2e31 2020  t = "127.0.0.1  
-00028830: 206c 6f63 616c 686f 7374 206c 6f63 616c   localhost local
-00028840: 686f 7374 2e6c 6f63 616c 646f 6d61 696e  host.localdomain
-00028850: 206c 6f63 616c 686f 7374 3420 6c6f 6361   localhost4 loca
-00028860: 6c68 6f73 7434 2e6c 6f63 616c 646f 6d61  lhost4.localdoma
-00028870: 696e 345c 6e22 0a20 2020 2020 2020 2020  in4\n".         
-00028880: 2020 2020 2020 2020 2020 2068 6f73 7473             hosts
-00028890: 5f63 6f6e 7465 6e74 202b 3d20 223a 3a31  _content += "::1
-000288a0: 2020 2020 2020 2020 206c 6f63 616c 686f           localho
-000288b0: 7374 206c 6f63 616c 686f 7374 2e6c 6f63  st localhost.loc
-000288c0: 616c 646f 6d61 696e 206c 6f63 616c 686f  aldomain localho
-000288d0: 7374 3620 6c6f 6361 6c68 6f73 7436 2e6c  st6 localhost6.l
-000288e0: 6f63 616c 646f 6d61 696e 365c 6e22 0a20  ocaldomain6\n". 
-000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028900: 2020 2068 6f73 7473 5f63 6f6e 7465 6e74     hosts_content
-00028910: 202b 3d20 6622 7b61 7069 5f69 707d 2061   += f"{api_ip} a
-00028920: 7069 2d69 6e74 2e7b 636c 7573 7465 727d  pi-int.{cluster}
-00028930: 2e7b 646f 6d61 696e 7d20 6170 692e 7b63  .{domain} api.{c
-00028940: 6c75 7374 6572 7d2e 7b64 6f6d 6169 6e7d  luster}.{domain}
-00028950: 220a 2020 2020 2020 2020 706c 616e 6469  ".        plandi
-00028960: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-00028970: 616d 6528 6f70 656e 7368 6966 742e 6372  ame(openshift.cr
-00028980: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
-00028990: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
-000289a0: 2020 2077 6974 6820 6f70 656e 2822 6973     with open("is
-000289b0: 6f2e 6967 6e22 2c20 2777 2729 2061 7320  o.ign", 'w') as 
-000289c0: 663a 0a20 2020 2020 2020 2020 2020 2066  f:.            f
-000289d0: 756c 6c5f 6e61 6d65 203d 2066 277b 636c  ull_name = f'{cl
-000289e0: 7573 7465 727d 2e7b 646f 6d61 696e 7d27  uster}.{domain}'
-000289f0: 2069 6620 646f 6d61 696e 2069 7320 6e6f   if domain is no
-00028a00: 7420 4e6f 6e65 2065 6c73 6520 636c 7573  t None else clus
-00028a10: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-00028a20: 7070 7269 6e74 2866 2257 7269 7469 6e67  pprint(f"Writing
-00028a30: 2066 696c 6520 6973 6f2e 6967 6e20 666f   file iso.ign fo
-00028a40: 7220 7b72 6f6c 657d 2069 6e20 7b66 756c  r {role} in {ful
-00028a50: 6c5f 6e61 6d65 7d22 290a 2020 2020 2020  l_name}").      
-00028a60: 2020 2020 2020 6973 6f64 6972 203d 206f        isodir = o
-00028a70: 732e 7061 7468 2e64 6972 6e61 6d65 2863  s.path.dirname(c
-00028a80: 6f6d 6d6f 6e2e 5f5f 6669 6c65 5f5f 290a  ommon.__file__).
-00028a90: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00028aa0: 696e 616c 6461 7461 2069 7320 4e6f 6e65  inaldata is None
-00028ab0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028ac0: 2020 656e 7620 3d20 456e 7669 726f 6e6d    env = Environm
-00028ad0: 656e 7428 6c6f 6164 6572 3d46 696c 6553  ent(loader=FileS
-00028ae0: 7973 7465 6d4c 6f61 6465 7228 6973 6f64  ystemLoader(isod
-00028af0: 6972 292c 2065 7874 656e 7369 6f6e 733d  ir), extensions=
-00028b00: 5b27 6a69 6e6a 6132 2e65 7874 2e64 6f27  ['jinja2.ext.do'
-00028b10: 5d2c 2074 7269 6d5f 626c 6f63 6b73 3d54  ], trim_blocks=T
-00028b20: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00028b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b40: 2020 2020 2020 206c 7374 7269 705f 626c         lstrip_bl
-00028b50: 6f63 6b73 3d54 7275 6529 0a20 2020 2020  ocks=True).     
-00028b60: 2020 2020 2020 2020 2020 2074 656d 706c             templ
-00028b70: 203d 2065 6e76 2e67 6574 5f74 656d 706c   = env.get_templ
-00028b80: 6174 6528 6f73 2e70 6174 682e 6261 7365  ate(os.path.base
-00028b90: 6e61 6d65 2822 6967 6e69 7469 6f6e 2e6a  name("ignition.j
-00028ba0: 3222 2929 0a20 2020 2020 2020 2020 2020  2")).           
-00028bb0: 2020 2020 2069 6620 686f 7374 735f 636f       if hosts_co
-00028bc0: 6e74 656e 7420 6973 206e 6f74 204e 6f6e  ntent is not Non
-00028bd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00028be0: 2020 2020 2020 2068 6f73 7473 5f63 6f6e         hosts_con
-00028bf0: 7465 6e74 203d 2062 6173 6536 342e 6236  tent = base64.b6
-00028c00: 3465 6e63 6f64 6528 686f 7374 735f 636f  4encode(hosts_co
-00028c10: 6e74 656e 742e 656e 636f 6465 2829 292e  ntent.encode()).
-00028c20: 6465 636f 6465 2822 5554 462d 3822 290a  decode("UTF-8").
-00028c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c40: 6966 2027 3a27 2069 6e20 6170 695f 6970  if ':' in api_ip
-00028c50: 3a20 2020 2320 4950 7636 2061 6464 7265  :   # IPv6 addre
-00028c60: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-00028c70: 2020 2020 2020 2069 676e 6974 696f 6e5f         ignition_
-00028c80: 7572 6c20 3d20 6622 6874 7470 3a2f 2f5b  url = f"http://[
-00028c90: 7b61 7069 5f69 707d 5d3a 3232 3632 342f  {api_ip}]:22624/
-00028ca0: 636f 6e66 6967 2f7b 726f 6c65 7d22 0a20  config/{role}". 
-00028cb0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00028cc0: 6c73 653a 2020 2020 2020 2020 2020 2020  lse:            
-00028cd0: 2020 2023 2049 5076 3420 6164 6472 6573     # IPv4 addres
-00028ce0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00028cf0: 2020 2020 2020 6967 6e69 7469 6f6e 5f75        ignition_u
-00028d00: 726c 203d 2066 2268 7474 703a 2f2f 7b61  rl = f"http://{a
-00028d10: 7069 5f69 707d 3a32 3236 3234 2f63 6f6e  pi_ip}:22624/con
-00028d20: 6669 672f 7b72 6f6c 657d 220a 2020 2020  fig/{role}".    
-00028d30: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-00028d40: 6c64 6174 6120 3d20 7465 6d70 6c2e 7265  ldata = templ.re
-00028d50: 6e64 6572 2869 676e 6974 696f 6e5f 7572  nder(ignition_ur
-00028d60: 6c3d 6967 6e69 7469 6f6e 5f75 726c 2c20  l=ignition_url, 
-00028d70: 686f 7374 735f 636f 6e74 656e 743d 686f  hosts_content=ho
-00028d80: 7374 735f 636f 6e74 656e 742c 0a20 2020  sts_content,.   
-00028d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028db0: 2020 2020 2020 6967 6e69 7469 6f6e 5f76        ignition_v
-00028dc0: 6572 7369 6f6e 3d69 676e 6974 696f 6e5f  ersion=ignition_
-00028dd0: 7665 7273 696f 6e29 0a20 2020 2020 2020  version).       
-00028de0: 2020 2020 2069 6620 6469 7265 6374 3a0a       if direct:.
-00028df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e00: 662e 7772 6974 6528 6669 6e61 6c64 6174  f.write(finaldat
-00028e10: 6129 0a20 2020 2020 2020 2020 2020 2065  a).            e
-00028e20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00028e30: 2020 2020 205f 6669 6c65 7320 3d20 5b7b       _files = [{
-00028e40: 2270 6174 6822 3a20 222f 726f 6f74 2f63  "path": "/root/c
-00028e50: 6f6e 6669 672e 6967 6e22 2c20 2263 6f6e  onfig.ign", "con
-00028e60: 7465 6e74 223a 2066 696e 616c 6461 7461  tent": finaldata
-00028e70: 7d5d 0a20 2020 2020 2020 2020 2020 2020  }].             
-00028e80: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-00028e90: 6973 7473 2827 6973 6f2e 7368 2729 3a0a  ists('iso.sh'):.
-00028ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028eb0: 2020 2020 7070 7269 6e74 2822 5573 696e      pprint("Usin
-00028ec0: 6720 6c6f 6361 6c20 6973 6f2e 7368 2073  g local iso.sh s
-00028ed0: 6372 6970 7422 290a 2020 2020 2020 2020  cript").        
-00028ee0: 2020 2020 2020 2020 2020 2020 6973 6f73              isos
-00028ef0: 6372 6970 7420 3d20 2769 736f 2e73 6827  cript = 'iso.sh'
-00028f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028f10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00028f20: 2020 2020 2020 2020 2020 2069 736f 7363             isosc
-00028f30: 7269 7074 203d 2066 277b 706c 616e 6469  ript = f'{plandi
-00028f40: 727d 2f69 736f 2e73 6827 0a20 2020 2020  r}/iso.sh'.     
-00028f50: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-00028f60: 2e70 6174 682e 6578 6973 7473 2827 6d61  .path.exists('ma
-00028f70: 6373 2e74 7874 2729 3a0a 2020 2020 2020  cs.txt'):.      
-00028f80: 2020 2020 2020 2020 2020 2020 2020 5f66                _f
-00028f90: 696c 6573 2e61 7070 656e 6428 7b22 7061  iles.append({"pa
-00028fa0: 7468 223a 2022 2f72 6f6f 742f 6d61 6373  th": "/root/macs
-00028fb0: 2e74 7874 222c 2022 6f72 6967 696e 223a  .txt", "origin":
-00028fc0: 2027 6d61 6373 2e74 7874 277d 290a 2020   'macs.txt'}).  
-00028fd0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00028fe0: 6f5f 6f76 6572 7269 6465 7320 3d20 7b27  o_overrides = {'
-00028ff0: 7363 7269 7074 7327 3a20 5b69 736f 7363  scripts': [isosc
-00029000: 7269 7074 5d2c 2027 6669 6c65 7327 3a20  ript], 'files': 
-00029010: 5f66 696c 6573 2c20 276d 6574 616c 5f75  _files, 'metal_u
-00029020: 726c 273a 206d 6574 616c 5f75 726c 2c20  rl': metal_url, 
-00029030: 276e 6f6e 616d 6527 3a20 5472 7565 2c0a  'noname': True,.
-00029040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029060: 2027 696d 6167 6527 3a20 2772 6863 6f73   'image': 'rhcos
-00029070: 3430 3030 277d 0a20 2020 2020 2020 2020  4000'}.         
-00029080: 2020 2020 2020 2069 6620 6d65 7461 6c5f         if metal_
-00029090: 7572 6c20 6973 206e 6f74 204e 6f6e 653a  url is not None:
-000290a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000290b0: 2020 2020 2069 736f 5f6f 7665 7272 6964       iso_overrid
-000290c0: 6573 5b27 6e65 6564 5f6e 6574 776f 726b  es['need_network
-000290d0: 275d 203d 2054 7275 650a 2020 2020 2020  '] = True.      
-000290e0: 2020 2020 2020 2020 2020 6973 6f5f 6f76            iso_ov
-000290f0: 6572 7269 6465 732e 7570 6461 7465 286f  errides.update(o
-00029100: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-00029110: 2020 2020 2020 2020 2020 6966 2027 6e61            if 'na
-00029120: 6d65 2720 696e 206f 7665 7272 6964 6573  me' in overrides
-00029130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029140: 2020 2020 2020 6973 6f5f 6e61 6d65 203d        iso_name =
-00029150: 206f 7665 7272 6964 6573 5b27 6e61 6d65   overrides['name
-00029160: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00029170: 2020 2020 2020 2069 736f 5f6f 7665 7272         iso_overr
-00029180: 6964 6573 5b27 6e6f 6e61 6d65 275d 203d  ides['noname'] =
-00029190: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-000291a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000291b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291c0: 2069 736f 5f6e 616d 6520 3d20 2761 7574   iso_name = 'aut
-000291d0: 6f69 6e73 7461 6c6c 6572 270a 2020 2020  oinstaller'.    
-000291e0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000291f0: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
-00029200: 5f76 6d28 6973 6f5f 6e61 6d65 2c20 6f76  _vm(iso_name, ov
-00029210: 6572 7269 6465 733d 6973 6f5f 6f76 6572  errides=iso_over
-00029220: 7269 6465 732c 206f 6e6c 7961 7373 6574  rides, onlyasset
-00029230: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
-00029240: 2020 2020 2020 2020 6966 2027 7265 6173          if 'reas
-00029250: 6f6e 2720 696e 2072 6573 756c 743a 0a20  on' in result:. 
+00027300: 6469 726e 616d 6528 6f70 656e 7368 6966  dirname(openshif
+00027310: 742e 6372 6561 7465 2e5f 5f63 6f64 655f  t.create.__code_
+00027320: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+00027330: 2020 2020 2020 2020 2020 2072 6f6c 6573             roles
+00027340: 203d 205b 2763 6c6f 7564 5f63 746c 706c   = ['cloud_ctlpl
+00027350: 616e 6573 272c 2027 636c 6f75 645f 776f  anes', 'cloud_wo
+00027360: 726b 6572 7327 5d20 6966 2073 656c 662e  rkers'] if self.
+00027370: 7479 7065 2069 6e20 5b27 6177 7327 2c20  type in ['aws', 
+00027380: 2767 6370 275d 2065 6c73 6520 5b27 6374  'gcp'] else ['ct
+00027390: 6c70 6c61 6e65 7327 2c20 2777 6f72 6b65  lplanes', 'worke
+000273a0: 7273 275d 0a20 2020 2020 2020 2069 6620  rs'].        if 
+000273b0: 6f76 6572 7269 6465 732e 6765 7428 2777  overrides.get('w
+000273c0: 6f72 6b65 7273 272c 2030 2920 3d3d 2030  orkers', 0) == 0
+000273d0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+000273e0: 6c20 726f 6c65 735b 2d31 5d0a 2020 2020  l roles[-1].    
+000273f0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00027400: 7869 7374 7328 6622 7b63 6c75 7374 6572  xists(f"{cluster
+00027410: 6469 727d 2f6b 636c 695f 7061 7261 6d65  dir}/kcli_parame
+00027420: 7465 7273 2e79 6d6c 2229 3a0a 2020 2020  ters.yml"):.    
+00027430: 2020 2020 2020 2020 6461 7461 203d 207b          data = {
+00027440: 2763 6c75 7374 6572 273a 2063 6c75 7374  'cluster': clust
+00027450: 6572 2c20 276b 7562 6527 3a20 636c 7573  er, 'kube': clus
+00027460: 7465 722c 2027 6b75 6265 7479 7065 273a  ter, 'kubetype':
+00027470: 205f 7479 7065 7d0a 2020 2020 2020 2020   _type}.        
+00027480: 2020 2020 7769 7468 206f 7065 6e28 6622      with open(f"
+00027490: 7b63 6c75 7374 6572 6469 727d 2f6b 636c  {clusterdir}/kcl
+000274a0: 695f 7061 7261 6d65 7465 7273 2e79 6d6c  i_parameters.yml
+000274b0: 222c 2027 7227 2920 6173 2069 6e73 7461  ", 'r') as insta
+000274c0: 6c6c 3a0a 2020 2020 2020 2020 2020 2020  ll:.            
+000274d0: 2020 2020 696e 7374 616c 6c70 6172 616d      installparam
+000274e0: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
+000274f0: 6428 696e 7374 616c 6c29 0a20 2020 2020  d(install).     
+00027500: 2020 2020 2020 2020 2020 2064 6174 612e             data.
+00027510: 7570 6461 7465 2869 6e73 7461 6c6c 7061  update(installpa
+00027520: 7261 6d29 0a20 2020 2020 2020 2020 2020  ram).           
+00027530: 2020 2020 2070 6c61 6e20 3d20 696e 7374       plan = inst
+00027540: 616c 6c70 6172 616d 2e67 6574 2827 706c  allparam.get('pl
+00027550: 616e 272c 2070 6c61 6e29 0a20 2020 2020  an', plan).     
+00027560: 2020 2020 2020 2064 6174 612e 7570 6461         data.upda
+00027570: 7465 286f 7665 7272 6964 6573 290a 2020  te(overrides).  
+00027580: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+00027590: 7065 6e28 6622 7b63 6c75 7374 6572 6469  pen(f"{clusterdi
+000275a0: 727d 2f6b 636c 695f 7061 7261 6d65 7465  r}/kcli_paramete
+000275b0: 7273 2e79 6d6c 222c 2027 7727 2920 6173  rs.yml", 'w') as
+000275c0: 2070 6172 616d 6669 6c65 3a0a 2020 2020   paramfile:.    
+000275d0: 2020 2020 2020 2020 2020 2020 7961 6d6c              yaml
+000275e0: 2e73 6166 655f 6475 6d70 2864 6174 612c  .safe_dump(data,
+000275f0: 2070 6172 616d 6669 6c65 290a 2020 2020   paramfile).    
+00027600: 2020 2020 6f73 2e63 6864 6972 286f 732e      os.chdir(os.
+00027610: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+00027620: 227e 2f2e 6b63 6c69 2229 290a 2020 2020  "~/.kcli")).    
+00027630: 2020 2020 666f 7220 726f 6c65 2069 6e20      for role in 
+00027640: 726f 6c65 733a 0a20 2020 2020 2020 2020  roles:.         
+00027650: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
+00027660: 7469 6e67 2076 6d73 2077 6974 6820 7b72  ting vms with {r
+00027670: 6f6c 657d 2072 6f6c 6522 290a 2020 2020  ole} role").    
+00027680: 2020 2020 2020 2020 706c 616e 6461 7461          plandata
+00027690: 203d 2073 656c 662e 706c 616e 2870 6c61   = self.plan(pla
+000276a0: 6e2c 2069 6e70 7574 6669 6c65 3d66 277b  n, inputfile=f'{
+000276b0: 706c 616e 6469 727d 2f7b 726f 6c65 7d2e  plandir}/{role}.
+000276c0: 796d 6c27 2c20 6f76 6572 7269 6465 733d  yml', overrides=
+000276d0: 6f76 6572 7269 6465 732c 2075 7064 6174  overrides, updat
+000276e0: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+000276f0: 2020 2020 706c 616e 766d 732e 6578 7465      planvms.exte
+00027700: 6e64 2870 6c61 6e64 6174 615b 276e 6577  nd(plandata['new
+00027710: 766d 7327 5d20 2b20 706c 616e 6461 7461  vms'] + plandata
+00027720: 5b27 6578 6973 7469 6e67 766d 7327 5d29  ['existingvms'])
+00027730: 0a20 2020 2020 2020 206f 732e 656e 7669  .        os.envi
+00027740: 726f 6e5b 274b 5542 4543 4f4e 4649 4727  ron['KUBECONFIG'
+00027750: 5d20 3d20 6622 7b63 6c75 7374 6572 6469  ] = f"{clusterdi
+00027760: 727d 2f61 7574 682f 6b75 6265 636f 6e66  r}/auth/kubeconf
+00027770: 6967 220a 2020 2020 2020 2020 6269 6e61  ig".        bina
+00027780: 7279 203d 2027 6f63 2720 6966 2077 6869  ry = 'oc' if whi
+00027790: 6368 2827 6f63 2729 2069 7320 6e6f 7420  ch('oc') is not 
+000277a0: 4e6f 6e65 2065 6c73 6520 276b 7562 6563  None else 'kubec
+000277b0: 746c 270a 2020 2020 2020 2020 6e6f 6465  tl'.        node
+000277c0: 7363 6d64 203d 2066 277b 6269 6e61 7279  scmd = f'{binary
+000277d0: 7d20 6765 7420 6e6f 6465 202d 6f20 6e61  } get node -o na
+000277e0: 6d65 270a 2020 2020 2020 2020 6e6f 6465  me'.        node
+000277f0: 7320 3d20 5b6e 2e73 7472 6970 2829 2e72  s = [n.strip().r
+00027800: 6570 6c61 6365 2827 6e6f 6465 2f27 2c20  eplace('node/', 
+00027810: 2727 2920 666f 7220 6e20 696e 206f 732e  '') for n in os.
+00027820: 706f 7065 6e28 6e6f 6465 7363 6d64 292e  popen(nodescmd).
+00027830: 7265 6164 6c69 6e65 7328 295d 0a20 2020  readlines()].   
+00027840: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
+00027850: 656c 662e 6b2e 6c69 7374 2829 3a0a 2020  elf.k.list():.  
+00027860: 2020 2020 2020 2020 2020 766d 6e61 6d65            vmname
+00027870: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
+00027880: 2020 2020 2020 2020 2020 766d 706c 616e            vmplan
+00027890: 203d 2076 6d2e 6765 7428 2770 6c61 6e27   = vm.get('plan'
+000278a0: 2c20 276b 7669 7274 2729 0a20 2020 2020  , 'kvirt').     
+000278b0: 2020 2020 2020 2069 6620 766d 706c 616e         if vmplan
+000278c0: 203d 3d20 706c 616e 2061 6e64 2076 6d6e   == plan and vmn
+000278d0: 616d 6520 6e6f 7420 696e 2070 6c61 6e76  ame not in planv
+000278e0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+000278f0: 2020 2020 7070 7269 6e74 2866 2244 656c      pprint(f"Del
+00027900: 6574 696e 6720 766d 207b 766d 6e61 6d65  eting vm {vmname
+00027910: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00027920: 2020 2020 7365 6c66 2e6b 2e64 656c 6574      self.k.delet
+00027930: 6528 766d 6e61 6d65 290a 2020 2020 2020  e(vmname).      
+00027940: 2020 2020 2020 2020 2020 666f 7220 6e6f            for no
+00027950: 6465 2069 6e20 6e6f 6465 733a 0a20 2020  de in nodes:.   
+00027960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027970: 2069 6620 6e6f 6465 2e73 706c 6974 2827   if node.split('
+00027980: 2e27 295b 305d 203d 3d20 766d 6e61 6d65  .')[0] == vmname
+00027990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000279a0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+000279b0: 2866 2244 656c 6574 696e 6720 6e6f 6465  (f"Deleting node
+000279c0: 207b 6e6f 6465 7d20 6672 6f6d 2079 6f75   {node} from you
+000279d0: 7220 636c 7573 7465 7222 290a 2020 2020  r cluster").    
+000279e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279f0: 2020 2020 6361 6c6c 2866 277b 6269 6e61      call(f'{bina
+00027a00: 7279 7d20 6465 6c65 7465 206e 6f64 6520  ry} delete node 
+00027a10: 7b6e 6f64 657d 272c 2073 6865 6c6c 3d54  {node}', shell=T
+00027a20: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00027a30: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00027a40: 616b 0a0a 2020 2020 6465 6620 6578 706f  ak..    def expo
+00027a50: 7365 5f70 6c61 6e28 7365 6c66 2c20 706c  se_plan(self, pl
+00027a60: 616e 2c20 696e 7075 7466 696c 653d 4e6f  an, inputfile=No
+00027a70: 6e65 2c20 6f76 6572 7269 6465 733d 7b7d  ne, overrides={}
+00027a80: 2c20 706f 7274 3d39 3030 302c 2070 666d  , port=9000, pfm
+00027a90: 6f64 653d 4661 6c73 652c 2063 6c75 7374  ode=False, clust
+00027aa0: 6572 3d46 616c 7365 293a 0a20 2020 2020  er=False):.     
+00027ab0: 2020 2069 6e70 7574 6669 6c65 203d 206f     inputfile = o
+00027ac0: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+00027ad0: 7228 696e 7075 7466 696c 6529 0a20 2020  r(inputfile).   
+00027ae0: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00027af0: 6174 682e 6578 6973 7473 2869 6e70 7574  ath.exists(input
+00027b00: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+00027b10: 2020 2065 7272 6f72 2822 4e6f 2069 6e70     error("No inp
+00027b20: 7574 2066 696c 6520 666f 756e 6420 6e6f  ut file found no
+00027b30: 7220 6465 6661 756c 7420 6b63 6c69 5f70  r default kcli_p
+00027b40: 6c61 6e2e 796d 6c2e 4c65 6176 696e 672e  lan.yml.Leaving.
+00027b50: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00027b60: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+00027b70: 2020 2020 2020 7070 7269 6e74 2866 2248        pprint(f"H
+00027b80: 616e 646c 696e 6720 6578 706f 7365 206f  andling expose o
+00027b90: 6620 706c 616e 2077 6974 6820 6e61 6d65  f plan with name
+00027ba0: 207b 706c 616e 7d20 616e 6420 696e 7075   {plan} and inpu
+00027bb0: 7466 696c 6520 7b69 6e70 7574 6669 6c65  tfile {inputfile
+00027bc0: 7d22 290a 2020 2020 2020 2020 6b65 7870  }").        kexp
+00027bd0: 6f73 6572 203d 204b 6578 706f 7365 7228  oser = Kexposer(
+00027be0: 7365 6c66 2c20 706c 616e 2c20 696e 7075  self, plan, inpu
+00027bf0: 7466 696c 652c 206f 7665 7272 6964 6573  tfile, overrides
+00027c00: 3d6f 7665 7272 6964 6573 2c20 706f 7274  =overrides, port
+00027c10: 3d70 6f72 742c 2070 666d 6f64 653d 7066  =port, pfmode=pf
+00027c20: 6d6f 6465 2c20 636c 7573 7465 723d 636c  mode, cluster=cl
+00027c30: 7573 7465 7229 0a20 2020 2020 2020 206b  uster).        k
+00027c40: 6578 706f 7365 722e 7275 6e28 290a 0a20  exposer.run().. 
+00027c50: 2020 2064 6566 2063 7265 6174 655f 6f70     def create_op
+00027c60: 656e 7368 6966 745f 6973 6f28 7365 6c66  enshift_iso(self
+00027c70: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00027c80: 6964 6573 3d7b 7d2c 2069 676e 6974 696f  ides={}, ignitio
+00027c90: 6e66 696c 653d 4e6f 6e65 2c20 706f 646d  nfile=None, podm
+00027ca0: 616e 3d46 616c 7365 2c20 696e 7374 616c  an=False, instal
+00027cb0: 6c65 723d 4661 6c73 652c 0a20 2020 2020  ler=False,.     
+00027cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027cd0: 2020 2020 2020 2020 6469 7265 6374 3d46          direct=F
+00027ce0: 616c 7365 293a 0a20 2020 2020 2020 206d  alse):.        m
+00027cf0: 6574 616c 5f75 726c 203d 204e 6f6e 650a  etal_url = None.
+00027d00: 2020 2020 2020 2020 6973 6f5f 7665 7273          iso_vers
+00027d10: 696f 6e20 3d20 7374 7228 6f76 6572 7269  ion = str(overri
+00027d20: 6465 732e 6765 7428 2776 6572 7369 6f6e  des.get('version
+00027d30: 272c 2027 6c61 7465 7374 2729 290a 2020  ', 'latest')).  
+00027d40: 2020 2020 2020 6966 206e 6f74 2069 6e73        if not ins
+00027d50: 7461 6c6c 6572 3a0a 2020 2020 2020 2020  taller:.        
+00027d60: 2020 2020 6966 2069 736f 5f76 6572 7369      if iso_versi
+00027d70: 6f6e 206e 6f74 2069 6e20 5b27 6c61 7465  on not in ['late
+00027d80: 7374 272c 2027 7072 652d 7265 6c65 6173  st', 'pre-releas
+00027d90: 6527 5d20 616e 6420 6e6f 7420 6973 6f5f  e'] and not iso_
+00027da0: 7665 7273 696f 6e2e 7374 6172 7473 7769  version.startswi
+00027db0: 7468 2827 342e 2729 3a0a 2020 2020 2020  th('4.'):.      
+00027dc0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00027dd0: 6728 2246 6f72 6369 6e67 206c 6976 6520  g("Forcing live 
+00027de0: 6973 6f20 7665 7273 696f 6e20 746f 206c  iso version to l
+00027df0: 6174 6573 7422 290a 2020 2020 2020 2020  atest").        
+00027e00: 2020 2020 2020 2020 6973 6f5f 7665 7273          iso_vers
+00027e10: 696f 6e20 3d20 276c 6174 6573 7427 0a20  ion = 'latest'. 
+00027e20: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00027e30: 6973 6f5f 7665 7273 696f 6e2e 7374 6172  iso_version.star
+00027e40: 7473 7769 7468 2827 342e 2729 3a0a 2020  tswith('4.'):.  
+00027e50: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00027e60: 6e6f 725f 7665 7273 696f 6e20 3d20 6973  nor_version = is
+00027e70: 6f5f 7665 7273 696f 6e2e 7370 6c69 7428  o_version.split(
+00027e80: 272e 2729 5b31 5d0a 2020 2020 2020 2020  '.')[1].        
+00027e90: 2020 2020 2020 2020 6966 206d 696e 6f72          if minor
+00027ea0: 5f76 6572 7369 6f6e 2e69 7364 6967 6974  _version.isdigit
+00027eb0: 2829 2061 6e64 2069 6e74 286d 696e 6f72  () and int(minor
+00027ec0: 5f76 6572 7369 6f6e 2920 3c20 363a 0a20  _version) < 6:. 
+00027ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ee0: 2020 206d 6574 616c 5f75 726c 203d 2066     metal_url = f
+00027ef0: 2268 7474 7073 3a2f 2f6d 6972 726f 722e  "https://mirror.
+00027f00: 6f70 656e 7368 6966 742e 636f 6d2f 7075  openshift.com/pu
+00027f10: 622f 6f70 656e 7368 6966 742d 7634 2f64  b/openshift-v4/d
+00027f20: 6570 656e 6465 6e63 6965 732f 7268 636f  ependencies/rhco
+00027f30: 732f 7b69 736f 5f76 6572 7369 6f6e 7d2f  s/{iso_version}/
+00027f40: 6c61 7465 7374 220a 2020 2020 2020 2020  latest".        
+00027f50: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+00027f60: 6c5f 7572 6c20 2b3d 2022 2f72 6863 6f73  l_url += "/rhcos
+00027f70: 2d6d 6574 616c 2e78 3836 5f36 342e 7261  -metal.x86_64.ra
+00027f80: 772e 677a 220a 2020 2020 2020 2020 2020  w.gz".          
+00027f90: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00027fa0: 6728 2245 6d62 6564 6469 6e67 206d 6574  g("Embedding met
+00027fb0: 616c 2075 726c 2069 6e20 6973 6f20 666f  al url in iso fo
+00027fc0: 7220 7461 7267 6574 2076 6572 7369 6f6e  r target version
+00027fd0: 2061 6e64 2069 6e73 7461 6c6c 696e 6720   and installing 
+00027fe0: 7769 7468 2061 206d 6f72 6520 7265 6365  with a more rece
+00027ff0: 6e74 2069 736f 2229 0a20 2020 2020 2020  nt iso").       
+00028000: 2020 2020 2020 2020 2069 736f 5f76 6572           iso_ver
+00028010: 7369 6f6e 203d 2027 6c61 7465 7374 270a  sion = 'latest'.
+00028020: 2020 2020 2020 2020 6170 695f 6970 203d          api_ip =
+00028030: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+00028040: 6170 695f 6970 2729 0a20 2020 2020 2020  api_ip').       
+00028050: 2069 676e 6974 696f 6e5f 7665 7273 696f   ignition_versio
+00028060: 6e20 3d20 6f76 6572 7269 6465 732e 6765  n = overrides.ge
+00028070: 7428 2769 676e 6974 696f 6e5f 7665 7273  t('ignition_vers
+00028080: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
+00028090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000280a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000280b0: 6f6d 6d6f 6e2e 6967 6e69 7469 6f6e 5f76  ommon.ignition_v
+000280c0: 6572 7369 6f6e 2822 7268 636f 732d 2573  ersion("rhcos-%s
+000280d0: 2220 2520 6973 6f5f 7665 7273 696f 6e2e  " % iso_version.
+000280e0: 7265 706c 6163 6528 272e 272c 2027 2729  replace('.', '')
+000280f0: 2929 0a20 2020 2020 2020 2072 6f6c 6520  )).        role 
+00028100: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00028110: 2772 6f6c 6527 2c20 2777 6f72 6b65 7227  'role', 'worker'
+00028120: 290a 2020 2020 2020 2020 6973 6f20 3d20  ).        iso = 
+00028130: 6f76 6572 7269 6465 732e 6765 7428 2769  overrides.get('i
+00028140: 736f 272c 2054 7275 6529 0a20 2020 2020  so', True).     
+00028150: 2020 2064 6f6d 6169 6e20 3d20 6f76 6572     domain = over
+00028160: 7269 6465 732e 6765 7428 2764 6f6d 6169  rides.get('domai
+00028170: 6e27 290a 2020 2020 2020 2020 6966 2027  n').        if '
+00028180: 2e27 2069 6e20 636c 7573 7465 723a 0a20  .' in cluster:. 
+00028190: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+000281a0: 6e20 3d20 272e 272e 6a6f 696e 2863 6c75  n = '.'.join(clu
+000281b0: 7374 6572 2e73 706c 6974 2827 2e27 295b  ster.split('.')[
+000281c0: 313a 5d29 0a20 2020 2020 2020 2020 2020  1:]).           
+000281d0: 2070 7072 696e 7428 6622 5573 696e 6720   pprint(f"Using 
+000281e0: 646f 6d61 696e 207b 646f 6d61 696e 7d22  domain {domain}"
+000281f0: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
+00028200: 7573 7465 7220 3d20 636c 7573 7465 722e  uster = cluster.
+00028210: 7265 706c 6163 6528 6622 2e7b 646f 6d61  replace(f".{doma
+00028220: 696e 7d22 2c20 2727 290a 2020 2020 2020  in}", '').      
+00028230: 2020 6966 2063 6c75 7374 6572 2e73 7461    if cluster.sta
+00028240: 7274 7377 6974 6828 2761 7069 2e27 293a  rtswith('api.'):
+00028250: 0a20 2020 2020 2020 2020 2020 2063 6c75  .            clu
+00028260: 7374 6572 203d 2063 6c75 7374 6572 2e72  ster = cluster.r
+00028270: 6570 6c61 6365 2822 6170 692e 222c 2027  eplace("api.", '
+00028280: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+00028290: 7072 696e 7428 6622 5573 696e 6720 636c  print(f"Using cl
+000282a0: 7573 7465 7220 7b63 6c75 7374 6572 7d22  uster {cluster}"
+000282b0: 290a 2020 2020 2020 2020 686f 7374 735f  ).        hosts_
+000282c0: 636f 6e74 656e 7420 3d20 4e6f 6e65 0a20  content = None. 
+000282d0: 2020 2020 2020 2066 696e 616c 6461 7461         finaldata
+000282e0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000282f0: 6966 2069 676e 6974 696f 6e66 696c 6520  if ignitionfile 
+00028300: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00028310: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00028320: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
+00028330: 676e 6974 696f 6e66 696c 6529 3a0a 2020  gnitionfile):.  
+00028340: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00028350: 726f 7228 6622 7b69 676e 6974 696f 6e66  ror(f"{ignitionf
+00028360: 696c 657d 206e 6f74 2066 6f75 6e64 2229  ile} not found")
+00028370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028380: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00028390: 2020 2020 2020 2020 2066 696e 616c 6461           finalda
+000283a0: 7461 203d 206f 7065 6e28 6967 6e69 7469  ta = open(igniti
+000283b0: 6f6e 6669 6c65 292e 7265 6164 2829 0a20  onfile).read(). 
+000283c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000283d0: 2020 2020 2020 2020 2069 676e 6974 696f           ignitio
+000283e0: 6e66 696c 6520 3d20 6622 7b72 6f6c 657d  nfile = f"{role}
+000283f0: 2e69 676e 220a 2020 2020 2020 2020 2020  .ign".          
+00028400: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+00028410: 7374 7328 6967 6e69 7469 6f6e 6669 6c65  sts(ignitionfile
+00028420: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00028430: 2020 2077 6172 6e69 6e67 2866 2255 7369     warning(f"Usi
+00028440: 6e67 2065 7869 7374 696e 6720 7b69 676e  ng existing {ign
+00028450: 6974 696f 6e66 696c 657d 2229 0a20 2020  itionfile}").   
+00028460: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+00028470: 616c 6461 7461 203d 206f 7065 6e28 6967  aldata = open(ig
+00028480: 6e69 7469 6f6e 6669 6c65 292e 7265 6164  nitionfile).read
+00028490: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
+000284a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000284b0: 2020 2020 2069 6620 6170 695f 6970 2069       if api_ip i
+000284c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000284d0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+000284e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000284f0: 2020 2020 2020 2020 2061 7069 5f69 7020           api_ip 
+00028500: 3d20 736f 636b 6574 2e67 6574 686f 7374  = socket.gethost
+00028510: 6279 6e61 6d65 2866 2761 7069 2e7b 636c  byname(f'api.{cl
+00028520: 7573 7465 727d 2e7b 646f 6d61 696e 7d27  uster}.{domain}'
+00028530: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00028540: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00028550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028560: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00028570: 2020 2020 2020 2020 2020 2069 6620 6170             if ap
+00028580: 695f 6970 2069 7320 4e6f 6e65 3a0a 2020  i_ip is None:.  
+00028590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000285a0: 2020 6966 2064 6f6d 6169 6e20 6973 204e    if domain is N
+000285b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000285c0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+000285d0: 6f72 2822 436f 756c 646e 2774 2066 6967  or("Couldn't fig
+000285e0: 7572 6520 6f75 7420 6170 695f 6970 206e  ure out api_ip n
+000285f0: 6f72 2072 656c 7920 6f6e 2064 6e73 2073  or rely on dns s
+00028600: 696e 6365 2064 6f6d 6169 6e20 6973 206e  ince domain is n
+00028610: 6f74 2073 6574 2229 0a20 2020 2020 2020  ot set").       
+00028620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028630: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00028640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028650: 2077 6172 6e69 6e67 2822 436f 756c 646e   warning("Couldn
+00028660: 2774 2066 6967 7572 6520 6f75 7420 6170  't figure out ap
+00028670: 695f 6970 2e20 5265 6c79 696e 6720 6f6e  i_ip. Relying on
+00028680: 2064 6e73 2229 0a20 2020 2020 2020 2020   dns").         
+00028690: 2020 2020 2020 2020 2020 2061 7069 5f69             api_i
+000286a0: 7020 3d20 6622 6170 692e 7b63 6c75 7374  p = f"api.{clust
+000286b0: 6572 7d2e 7b64 6f6d 6169 6e7d 220a 2020  er}.{domain}".  
+000286c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000286d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000286e0: 2020 2020 2020 2020 686f 7374 735f 636f          hosts_co
+000286f0: 6e74 656e 7420 3d20 2231 3237 2e30 2e30  ntent = "127.0.0
+00028700: 2e31 2020 206c 6f63 616c 686f 7374 206c  .1   localhost l
+00028710: 6f63 616c 686f 7374 2e6c 6f63 616c 646f  ocalhost.localdo
+00028720: 6d61 696e 206c 6f63 616c 686f 7374 3420  main localhost4 
+00028730: 6c6f 6361 6c68 6f73 7434 2e6c 6f63 616c  localhost4.local
+00028740: 646f 6d61 696e 345c 6e22 0a20 2020 2020  domain4\n".     
+00028750: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00028760: 6f73 7473 5f63 6f6e 7465 6e74 202b 3d20  osts_content += 
+00028770: 223a 3a31 2020 2020 2020 2020 206c 6f63  "::1         loc
+00028780: 616c 686f 7374 206c 6f63 616c 686f 7374  alhost localhost
+00028790: 2e6c 6f63 616c 646f 6d61 696e 206c 6f63  .localdomain loc
+000287a0: 616c 686f 7374 3620 6c6f 6361 6c68 6f73  alhost6 localhos
+000287b0: 7436 2e6c 6f63 616c 646f 6d61 696e 365c  t6.localdomain6\
+000287c0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+000287d0: 2020 2020 2020 2068 6f73 7473 5f63 6f6e         hosts_con
+000287e0: 7465 6e74 202b 3d20 6622 7b61 7069 5f69  tent += f"{api_i
+000287f0: 707d 2061 7069 2d69 6e74 2e7b 636c 7573  p} api-int.{clus
+00028800: 7465 727d 2e7b 646f 6d61 696e 7d20 6170  ter}.{domain} ap
+00028810: 692e 7b63 6c75 7374 6572 7d2e 7b64 6f6d  i.{cluster}.{dom
+00028820: 6169 6e7d 220a 2020 2020 2020 2020 706c  ain}".        pl
+00028830: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
+00028840: 6469 726e 616d 6528 6f70 656e 7368 6966  dirname(openshif
+00028850: 742e 6372 6561 7465 2e5f 5f63 6f64 655f  t.create.__code_
+00028860: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+00028870: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+00028880: 2822 6973 6f2e 6967 6e22 2c20 2777 2729  ("iso.ign", 'w')
+00028890: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+000288a0: 2020 2066 756c 6c5f 6e61 6d65 203d 2066     full_name = f
+000288b0: 277b 636c 7573 7465 727d 2e7b 646f 6d61  '{cluster}.{doma
+000288c0: 696e 7d27 2069 6620 646f 6d61 696e 2069  in}' if domain i
+000288d0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+000288e0: 636c 7573 7465 720a 2020 2020 2020 2020  cluster.        
+000288f0: 2020 2020 7070 7269 6e74 2866 2257 7269      pprint(f"Wri
+00028900: 7469 6e67 2066 696c 6520 6973 6f2e 6967  ting file iso.ig
+00028910: 6e20 666f 7220 7b72 6f6c 657d 2069 6e20  n for {role} in 
+00028920: 7b66 756c 6c5f 6e61 6d65 7d22 290a 2020  {full_name}").  
+00028930: 2020 2020 2020 2020 2020 6973 6f64 6972            isodir
+00028940: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00028950: 6d65 2863 6f6d 6d6f 6e2e 5f5f 6669 6c65  me(common.__file
+00028960: 5f5f 290a 2020 2020 2020 2020 2020 2020  __).            
+00028970: 6966 2066 696e 616c 6461 7461 2069 7320  if finaldata is 
+00028980: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00028990: 2020 2020 2020 656e 7620 3d20 456e 7669        env = Envi
+000289a0: 726f 6e6d 656e 7428 6c6f 6164 6572 3d46  ronment(loader=F
+000289b0: 696c 6553 7973 7465 6d4c 6f61 6465 7228  ileSystemLoader(
+000289c0: 6973 6f64 6972 292c 2065 7874 656e 7369  isodir), extensi
+000289d0: 6f6e 733d 5b27 6a69 6e6a 6132 2e65 7874  ons=['jinja2.ext
+000289e0: 2e64 6f27 5d2c 2074 7269 6d5f 626c 6f63  .do'], trim_bloc
+000289f0: 6b73 3d54 7275 652c 0a20 2020 2020 2020  ks=True,.       
+00028a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a10: 2020 2020 2020 2020 2020 206c 7374 7269             lstri
+00028a20: 705f 626c 6f63 6b73 3d54 7275 6529 0a20  p_blocks=True). 
+00028a30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00028a40: 656d 706c 203d 2065 6e76 2e67 6574 5f74  empl = env.get_t
+00028a50: 656d 706c 6174 6528 6f73 2e70 6174 682e  emplate(os.path.
+00028a60: 6261 7365 6e61 6d65 2822 6967 6e69 7469  basename("igniti
+00028a70: 6f6e 2e6a 3222 2929 0a20 2020 2020 2020  on.j2")).       
+00028a80: 2020 2020 2020 2020 2069 6620 686f 7374           if host
+00028a90: 735f 636f 6e74 656e 7420 6973 206e 6f74  s_content is not
+00028aa0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00028ab0: 2020 2020 2020 2020 2020 2068 6f73 7473             hosts
+00028ac0: 5f63 6f6e 7465 6e74 203d 2062 6173 6536  _content = base6
+00028ad0: 342e 6236 3465 6e63 6f64 6528 686f 7374  4.b64encode(host
+00028ae0: 735f 636f 6e74 656e 742e 656e 636f 6465  s_content.encode
+00028af0: 2829 292e 6465 636f 6465 2822 5554 462d  ()).decode("UTF-
+00028b00: 3822 290a 2020 2020 2020 2020 2020 2020  8").            
+00028b10: 2020 2020 6966 2027 3a27 2069 6e20 6170      if ':' in ap
+00028b20: 695f 6970 3a20 2020 2320 4950 7636 2061  i_ip:   # IPv6 a
+00028b30: 6464 7265 7373 0a20 2020 2020 2020 2020  ddress.         
+00028b40: 2020 2020 2020 2020 2020 2069 676e 6974             ignit
+00028b50: 696f 6e5f 7572 6c20 3d20 6622 6874 7470  ion_url = f"http
+00028b60: 3a2f 2f5b 7b61 7069 5f69 707d 5d3a 3232  ://[{api_ip}]:22
+00028b70: 3632 342f 636f 6e66 6967 2f7b 726f 6c65  624/config/{role
+00028b80: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00028b90: 2020 2065 6c73 653a 2020 2020 2020 2020     else:        
+00028ba0: 2020 2020 2020 2023 2049 5076 3420 6164         # IPv4 ad
+00028bb0: 6472 6573 730a 2020 2020 2020 2020 2020  dress.          
+00028bc0: 2020 2020 2020 2020 2020 6967 6e69 7469            igniti
+00028bd0: 6f6e 5f75 726c 203d 2066 2268 7474 703a  on_url = f"http:
+00028be0: 2f2f 7b61 7069 5f69 707d 3a32 3236 3234  //{api_ip}:22624
+00028bf0: 2f63 6f6e 6669 672f 7b72 6f6c 657d 220a  /config/{role}".
+00028c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c10: 6669 6e61 6c64 6174 6120 3d20 7465 6d70  finaldata = temp
+00028c20: 6c2e 7265 6e64 6572 2869 676e 6974 696f  l.render(ignitio
+00028c30: 6e5f 7572 6c3d 6967 6e69 7469 6f6e 5f75  n_url=ignition_u
+00028c40: 726c 2c20 686f 7374 735f 636f 6e74 656e  rl, hosts_conten
+00028c50: 743d 686f 7374 735f 636f 6e74 656e 742c  t=hosts_content,
+00028c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c80: 2020 2020 2020 2020 2020 6967 6e69 7469            igniti
+00028c90: 6f6e 5f76 6572 7369 6f6e 3d69 676e 6974  on_version=ignit
+00028ca0: 696f 6e5f 7665 7273 696f 6e29 0a20 2020  ion_version).   
+00028cb0: 2020 2020 2020 2020 2069 6620 6469 7265           if dire
+00028cc0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+00028cd0: 2020 2020 662e 7772 6974 6528 6669 6e61      f.write(fina
+00028ce0: 6c64 6174 6129 0a20 2020 2020 2020 2020  ldata).         
+00028cf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00028d00: 2020 2020 2020 2020 205f 6669 6c65 7320           _files 
+00028d10: 3d20 5b7b 2270 6174 6822 3a20 222f 726f  = [{"path": "/ro
+00028d20: 6f74 2f63 6f6e 6669 672e 6967 6e22 2c20  ot/config.ign", 
+00028d30: 2263 6f6e 7465 6e74 223a 2066 696e 616c  "content": final
+00028d40: 6461 7461 7d5d 0a20 2020 2020 2020 2020  data}].         
+00028d50: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00028d60: 682e 6578 6973 7473 2827 6973 6f2e 7368  h.exists('iso.sh
+00028d70: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+00028d80: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+00028d90: 5573 696e 6720 6c6f 6361 6c20 6973 6f2e  Using local iso.
+00028da0: 7368 2073 6372 6970 7422 290a 2020 2020  sh script").    
+00028db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028dc0: 6973 6f73 6372 6970 7420 3d20 2769 736f  isoscript = 'iso
+00028dd0: 2e73 6827 0a20 2020 2020 2020 2020 2020  .sh'.           
+00028de0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00028df0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00028e00: 736f 7363 7269 7074 203d 2066 277b 706c  soscript = f'{pl
+00028e10: 616e 6469 727d 2f69 736f 2e73 6827 0a20  andir}/iso.sh'. 
+00028e20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00028e30: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00028e40: 2827 6d61 6373 2e74 7874 2729 3a0a 2020  ('macs.txt'):.  
+00028e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028e60: 2020 5f66 696c 6573 2e61 7070 656e 6428    _files.append(
+00028e70: 7b22 7061 7468 223a 2022 2f72 6f6f 742f  {"path": "/root/
+00028e80: 6d61 6373 2e74 7874 222c 2022 6f72 6967  macs.txt", "orig
+00028e90: 696e 223a 2027 6d61 6373 2e74 7874 277d  in": 'macs.txt'}
+00028ea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00028eb0: 2020 6973 6f5f 6f76 6572 7269 6465 7320    iso_overrides 
+00028ec0: 3d20 7b27 7363 7269 7074 7327 3a20 5b69  = {'scripts': [i
+00028ed0: 736f 7363 7269 7074 5d2c 2027 6669 6c65  soscript], 'file
+00028ee0: 7327 3a20 5f66 696c 6573 2c20 276d 6574  s': _files, 'met
+00028ef0: 616c 5f75 726c 273a 206d 6574 616c 5f75  al_url': metal_u
+00028f00: 726c 2c20 276e 6f6e 616d 6527 3a20 5472  rl, 'noname': Tr
+00028f10: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00028f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f30: 2020 2020 2027 696d 6167 6527 3a20 2772       'image': 'r
+00028f40: 6863 6f73 3430 3030 277d 0a20 2020 2020  hcos4000'}.     
+00028f50: 2020 2020 2020 2020 2020 2069 6620 6d65             if me
+00028f60: 7461 6c5f 7572 6c20 6973 206e 6f74 204e  tal_url is not N
+00028f70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00028f80: 2020 2020 2020 2020 2069 736f 5f6f 7665           iso_ove
+00028f90: 7272 6964 6573 5b27 6e65 6564 5f6e 6574  rrides['need_net
+00028fa0: 776f 726b 275d 203d 2054 7275 650a 2020  work'] = True.  
+00028fb0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00028fc0: 6f5f 6f76 6572 7269 6465 732e 7570 6461  o_overrides.upda
+00028fd0: 7465 286f 7665 7272 6964 6573 290a 2020  te(overrides).  
+00028fe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00028ff0: 2027 6e61 6d65 2720 696e 206f 7665 7272   'name' in overr
+00029000: 6964 6573 3a0a 2020 2020 2020 2020 2020  ides:.          
+00029010: 2020 2020 2020 2020 2020 6973 6f5f 6e61            iso_na
+00029020: 6d65 203d 206f 7665 7272 6964 6573 5b27  me = overrides['
+00029030: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+00029040: 2020 2020 2020 2020 2020 2069 736f 5f6f             iso_o
+00029050: 7665 7272 6964 6573 5b27 6e6f 6e61 6d65  verrides['noname
+00029060: 275d 203d 2046 616c 7365 0a20 2020 2020  '] = False.     
+00029070: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00029080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029090: 2020 2020 2069 736f 5f6e 616d 6520 3d20       iso_name = 
+000290a0: 2761 7574 6f69 6e73 7461 6c6c 6572 270a  'autoinstaller'.
+000290b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290c0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
+000290d0: 6561 7465 5f76 6d28 6973 6f5f 6e61 6d65  eate_vm(iso_name
+000290e0: 2c20 6f76 6572 7269 6465 733d 6973 6f5f  , overrides=iso_
+000290f0: 6f76 6572 7269 6465 732c 206f 6e6c 7961  overrides, onlya
+00029100: 7373 6574 733d 5472 7565 290a 2020 2020  ssets=True).    
+00029110: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00029120: 7265 6173 6f6e 2720 696e 2072 6573 756c  reason' in resul
+00029130: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00029140: 2020 2020 2020 2065 7272 6f72 2872 6573         error(res
+00029150: 756c 745b 2772 6561 736f 6e27 5d29 0a20  ult['reason']). 
+00029160: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00029170: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00029180: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+00029190: 2872 6573 756c 745b 2764 6174 6127 5d29  (result['data'])
+000291a0: 0a20 2020 2020 2020 2069 6620 6973 6f3a  .        if iso:
+000291b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000291c0: 7365 6c66 2e74 7970 6520 6e6f 7420 696e  self.type not in
+000291d0: 205b 276b 766d 272c 2027 6661 6b65 272c   ['kvm', 'fake',
+000291e0: 2027 6b75 6265 7669 7274 272c 2027 7673   'kubevirt', 'vs
+000291f0: 7068 6572 6527 2c20 276f 7065 6e73 7461  phere', 'opensta
+00029200: 636b 275d 3a0a 2020 2020 2020 2020 2020  ck']:.          
+00029210: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+00029220: 4973 6f20 6765 6e65 7261 7469 6f6e 206e  Iso generation n
+00029230: 6f74 2073 7570 706f 7274 6564 206f 6e20  ot supported on 
+00029240: 7b73 656c 662e 7479 7065 7d22 290a 2020  {self.type}").  
+00029250: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 00029260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029270: 2020 2065 7272 6f72 2872 6573 756c 745b     error(result[
-00029280: 2772 6561 736f 6e27 5d29 0a20 2020 2020  'reason']).     
-00029290: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000292a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000292b0: 2020 2020 2066 2e77 7269 7465 2872 6573       f.write(res
-000292c0: 756c 745b 2764 6174 6127 5d29 0a20 2020  ult['data']).   
-000292d0: 2020 2020 2069 6620 6973 6f3a 0a20 2020       if iso:.   
-000292e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000292f0: 2e74 7970 6520 6e6f 7420 696e 205b 276b  .type not in ['k
-00029300: 766d 272c 2027 6661 6b65 272c 2027 6b75  vm', 'fake', 'ku
-00029310: 6265 7669 7274 272c 2027 7673 7068 6572  bevirt', 'vspher
-00029320: 6527 2c20 276f 7065 6e73 7461 636b 275d  e', 'openstack']
-00029330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029340: 2020 7761 726e 696e 6728 6622 4973 6f20    warning(f"Iso 
-00029350: 6765 6e65 7261 7469 6f6e 206e 6f74 2073  generation not s
-00029360: 7570 706f 7274 6564 206f 6e20 7b73 656c  upported on {sel
-00029370: 662e 7479 7065 7d22 290a 2020 2020 2020  f.type}").      
-00029380: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00029390: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
-000293a0: 706f 6f6c 203d 206f 7665 7272 6964 6573  pool = overrides
-000293b0: 2e67 6574 2827 706f 6f6c 2729 206f 7220  .get('pool') or 
-000293c0: 7365 6c66 2e70 6f6f 6c0a 2020 2020 2020  self.pool.      
-000293d0: 2020 2020 2020 2020 2020 6765 6e65 7261            genera
-000293e0: 7465 5f72 6863 6f73 5f69 736f 2873 656c  te_rhcos_iso(sel
-000293f0: 662e 6b2c 2066 227b 636c 7573 7465 727d  f.k, f"{cluster}
-00029400: 2d7b 726f 6c65 7d22 2c20 6973 6f5f 706f  -{role}", iso_po
-00029410: 6f6c 2c20 7665 7273 696f 6e3d 6973 6f5f  ol, version=iso_
-00029420: 7665 7273 696f 6e2c 2070 6f64 6d61 6e3d  version, podman=
-00029430: 706f 646d 616e 2c0a 2020 2020 2020 2020  podman,.        
-00029440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029450: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
-00029460: 6c6c 6572 3d69 6e73 7461 6c6c 6572 290a  ller=installer).
-00029470: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-00029480: 6f70 656e 7368 6966 745f 6469 7363 6f6e  openshift_discon
-00029490: 6e65 6374 6564 2873 656c 662c 2070 6c61  nected(self, pla
-000294a0: 6e2c 206f 7665 7272 6964 6573 3d7b 7d29  n, overrides={})
-000294b0: 3a0a 2020 2020 2020 2020 6461 7461 203d  :.        data =
-000294c0: 206f 7665 7272 6964 6573 0a20 2020 2020   overrides.     
-000294d0: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
-000294e0: 7061 7468 2e64 6972 6e61 6d65 286f 7065  path.dirname(ope
-000294f0: 6e73 6869 6674 2e63 7265 6174 652e 5f5f  nshift.create.__
-00029500: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
-00029510: 6d65 290a 2020 2020 2020 2020 636c 7573  me).        clus
-00029520: 7465 7220 3d20 6461 7461 2e67 6574 2827  ter = data.get('
-00029530: 636c 7573 7465 7227 2c20 276d 796f 7065  cluster', 'myope
-00029540: 6e73 6869 6674 2729 0a20 2020 2020 2020  nshift').       
-00029550: 2075 7073 7472 6561 6d20 3d20 6461 7461   upstream = data
-00029560: 2e67 6574 2827 7570 7374 7265 616d 272c  .get('upstream',
-00029570: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-00029580: 7665 7273 696f 6e20 3d20 6461 7461 2e67  version = data.g
-00029590: 6574 2827 7665 7273 696f 6e27 2c20 2773  et('version', 's
-000295a0: 7461 626c 6527 290a 2020 2020 2020 2020  table').        
-000295b0: 7461 6720 3d20 6461 7461 2e67 6574 2827  tag = data.get('
-000295c0: 7461 6727 2c20 4f50 454e 5348 4946 545f  tag', OPENSHIFT_
-000295d0: 5441 4729 0a20 2020 2020 2020 2070 7072  TAG).        ppr
-000295e0: 696e 7428 6622 5573 696e 6720 7665 7273  int(f"Using vers
-000295f0: 696f 6e20 7b76 6572 7369 6f6e 7d20 616e  ion {version} an
-00029600: 6420 7461 6720 7b74 6167 7d22 290a 2020  d tag {tag}").  
-00029610: 2020 2020 2020 6469 7363 6f6e 6e65 6374        disconnect
-00029620: 6564 5f76 6d20 3d20 6622 7b63 6c75 7374  ed_vm = f"{clust
-00029630: 6572 7d2d 6469 7363 6f6e 6e65 6374 6564  er}-disconnected
-00029640: 220a 2020 2020 2020 2020 6469 7363 6f6e  ".        discon
-00029650: 6e65 6374 6564 5f72 6575 7365 203d 2064  nected_reuse = d
-00029660: 6174 612e 6765 7428 2764 6973 636f 6e6e  ata.get('disconn
-00029670: 6563 7465 645f 7265 7573 6527 2c20 4661  ected_reuse', Fa
-00029680: 6c73 6529 0a20 2020 2020 2020 2064 6973  lse).        dis
-00029690: 636f 6e6e 6563 7465 645f 7379 6e63 203d  connected_sync =
-000296a0: 2064 6174 612e 6765 7428 2764 6973 636f   data.get('disco
-000296b0: 6e6e 6563 7465 645f 7379 6e63 272c 2054  nnected_sync', T
-000296c0: 7275 6529 0a20 2020 2020 2020 2070 7072  rue).        ppr
-000296d0: 696e 7428 6622 4465 706c 6f79 696e 6720  int(f"Deploying 
-000296e0: 6469 7363 6f6e 6e65 6374 6564 2076 6d20  disconnected vm 
-000296f0: 7b64 6973 636f 6e6e 6563 7465 645f 766d  {disconnected_vm
-00029700: 7d22 290a 2020 2020 2020 2020 6966 2064  }").        if d
-00029710: 6973 636f 6e6e 6563 7465 645f 7379 6e63  isconnected_sync
-00029720: 3a0a 2020 2020 2020 2020 2020 2020 7075  :.            pu
-00029730: 6c6c 5f73 6563 7265 7420 3d20 7077 645f  ll_secret = pwd_
-00029740: 7061 7468 2864 6174 612e 6765 7428 2770  path(data.get('p
-00029750: 756c 6c5f 7365 6372 6574 2729 2920 6966  ull_secret')) if
-00029760: 206e 6f74 2075 7073 7472 6561 6d20 656c   not upstream el
-00029770: 7365 2066 227b 706c 616e 6469 727d 2f66  se f"{plandir}/f
-00029780: 616b 655f 7075 6c6c 2e6a 736f 6e22 0a20  ake_pull.json". 
-00029790: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000297a0: 7420 7570 7374 7265 616d 3a0a 2020 2020  t upstream:.    
-000297b0: 2020 2020 2020 2020 2020 2020 7075 6c6c              pull
-000297c0: 5f73 6563 7265 7420 3d20 7077 645f 7061  _secret = pwd_pa
-000297d0: 7468 2864 6174 612e 6765 7428 2770 756c  th(data.get('pul
-000297e0: 6c5f 7365 6372 6574 272c 2027 6f70 656e  l_secret', 'open
-000297f0: 7368 6966 745f 7075 6c6c 2e6a 736f 6e27  shift_pull.json'
-00029800: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
-00029810: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00029820: 2020 2020 2070 756c 6c5f 7365 6372 6574       pull_secret
-00029830: 203d 2066 227b 706c 616e 6469 727d 2f66   = f"{plandir}/f
-00029840: 616b 655f 7075 6c6c 2e6a 736f 6e22 0a20  ake_pull.json". 
-00029850: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00029860: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00029870: 2870 756c 6c5f 7365 6372 6574 293a 0a20  (pull_secret):. 
-00029880: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00029890: 7272 6f72 2866 224d 6973 7369 6e67 2070  rror(f"Missing p
-000298a0: 756c 6c20 7365 6372 6574 2066 696c 6520  ull secret file 
-000298b0: 7b70 756c 6c5f 7365 6372 6574 7d22 290a  {pull_secret}").
-000298c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000298d0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-000298e0: 2020 2020 2020 2020 6461 7461 5b27 7075          data['pu
-000298f0: 6c6c 5f73 6563 7265 7427 5d20 3d20 7265  ll_secret'] = re
-00029900: 2e73 7562 2872 225c 7322 2c20 2222 2c20  .sub(r"\s", "", 
-00029910: 6f70 656e 2870 756c 6c5f 7365 6372 6574  open(pull_secret
-00029920: 292e 7265 6164 2829 290a 2020 2020 2020  ).read()).      
-00029930: 2020 6469 7363 6f6e 6e65 6374 6564 5f70    disconnected_p
-00029940: 6c61 6e20 3d20 6622 7b70 6c61 6e7d 2d72  lan = f"{plan}-r
-00029950: 6575 7365 2220 6966 2064 6973 636f 6e6e  euse" if disconn
-00029960: 6563 7465 645f 7265 7573 6520 656c 7365  ected_reuse else
-00029970: 2070 6c61 6e0a 2020 2020 2020 2020 6966   plan.        if
-00029980: 2076 6572 7369 6f6e 203d 3d20 2763 6927   version == 'ci'
-00029990: 2061 6e64 2027 6469 7363 6f6e 6e65 6374   and 'disconnect
-000299a0: 6564 5f6f 7269 6769 6e27 206e 6f74 2069  ed_origin' not i
-000299b0: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
-000299c0: 2020 2020 2020 2020 2072 6567 203d 2027           reg = '
-000299d0: 7265 6769 7374 7279 2e62 7569 6c64 3031  registry.build01
-000299e0: 2e63 692e 6f70 656e 7368 6966 742e 6f72  .ci.openshift.or
-000299f0: 6727 2069 6620 7374 7228 7461 6729 2e73  g' if str(tag).s
-00029a00: 7461 7274 7377 6974 6828 2763 692d 2729  tartswith('ci-')
-00029a10: 2065 6c73 6520 2772 6567 6973 7472 792e   else 'registry.
-00029a20: 6369 2e6f 7065 6e73 6869 6674 2e6f 7267  ci.openshift.org
-00029a30: 270a 2020 2020 2020 2020 2020 2020 7761  '.            wa
-00029a40: 726e 696e 6728 6622 466f 7263 696e 6720  rning(f"Forcing 
-00029a50: 6469 7363 6f6e 6e65 6374 6564 5f6f 7269  disconnected_ori
-00029a60: 6769 6e20 746f 207b 7265 677d 2229 0a20  gin to {reg}"). 
-00029a70: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-00029a80: 2764 6973 636f 6e6e 6563 7465 645f 6f72  'disconnected_or
-00029a90: 6967 696e 275d 203d 2072 6567 0a20 2020  igin'] = reg.   
-00029aa0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00029ab0: 6c66 2e70 6c61 6e28 6469 7363 6f6e 6e65  lf.plan(disconne
-00029ac0: 6374 6564 5f70 6c61 6e2c 2069 6e70 7574  cted_plan, input
-00029ad0: 6669 6c65 3d66 277b 706c 616e 6469 727d  file=f'{plandir}
-00029ae0: 2f64 6973 636f 6e6e 6563 7465 642e 796d  /disconnected.ym
-00029af0: 6c27 2c20 6f76 6572 7269 6465 733d 6461  l', overrides=da
-00029b00: 7461 290a 2020 2020 2020 2020 6966 2072  ta).        if r
-00029b10: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
-00029b20: 213d 2027 7375 6363 6573 7327 3a0a 2020  != 'success':.  
-00029b30: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00029b40: 6974 2831 290a 2020 2020 2020 2020 656c  it(1).        el
-00029b50: 6966 2064 6973 636f 6e6e 6563 7465 645f  if disconnected_
-00029b60: 7379 6e63 3a0a 2020 2020 2020 2020 2020  sync:.          
-00029b70: 2020 7070 7269 6e74 2822 5573 6520 7468    pprint("Use th
-00029b80: 6520 666f 6c6c 6f77 696e 6720 4f50 454e  e following OPEN
-00029b90: 5348 4946 545f 494e 5354 414c 4c5f 5245  SHIFT_INSTALL_RE
-00029ba0: 4c45 4153 455f 494d 4147 455f 4f56 4552  LEASE_IMAGE_OVER
-00029bb0: 5249 4445 2229 0a20 2020 2020 2020 2020  RIDE").         
-00029bc0: 2020 206e 616d 6520 3d20 6461 7461 2e67     name = data.g
-00029bd0: 6574 2827 6469 7363 6f6e 6e65 6374 6564  et('disconnected
-00029be0: 5f72 6575 7365 5f6e 616d 6527 2920 6f72  _reuse_name') or
-00029bf0: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
-00029c00: 2020 2020 2069 702c 2076 6d70 6f72 7420       ip, vmport 
-00029c10: 3d20 5f73 7368 5f63 7265 6465 6e74 6961  = _ssh_credentia
-00029c20: 6c73 2873 656c 662e 6b2c 2066 277b 6e61  ls(self.k, f'{na
-00029c30: 6d65 7d2d 6469 7363 6f6e 6e65 6374 6564  me}-disconnected
-00029c40: 2729 5b31 3a5d 0a20 2020 2020 2020 2020  ')[1:].         
-00029c50: 2020 2063 6d64 203d 2022 6361 7420 2f72     cmd = "cat /r
-00029c60: 6f6f 742f 7665 7273 696f 6e2e 7478 7422  oot/version.txt"
-00029c70: 0a20 2020 2020 2020 2020 2020 2073 7368  .            ssh
-00029c80: 636d 6420 3d20 7373 6828 6e61 6d65 2c20  cmd = ssh(name, 
-00029c90: 6970 3d69 702c 2075 7365 723d 2772 6f6f  ip=ip, user='roo
-00029ca0: 7427 2c20 7475 6e6e 656c 3d73 656c 662e  t', tunnel=self.
-00029cb0: 7475 6e6e 656c 2c0a 2020 2020 2020 2020  tunnel,.        
-00029cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029cd0: 2074 756e 6e65 6c68 6f73 743d 7365 6c66   tunnelhost=self
-00029ce0: 2e74 756e 6e65 6c68 6f73 742c 2074 756e  .tunnelhost, tun
-00029cf0: 6e65 6c70 6f72 743d 7365 6c66 2e74 756e  nelport=self.tun
-00029d00: 6e65 6c70 6f72 742c 0a20 2020 2020 2020  nelport,.       
-00029d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d20: 2020 7475 6e6e 656c 7573 6572 3d73 656c    tunneluser=sel
-00029d30: 662e 7475 6e6e 656c 7573 6572 2c20 696e  f.tunneluser, in
-00029d40: 7365 6375 7265 3d54 7275 652c 2063 6d64  secure=True, cmd
-00029d50: 3d63 6d64 2c20 766d 706f 7274 3d76 6d70  =cmd, vmport=vmp
-00029d60: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
-00029d70: 206f 732e 7379 7374 656d 2873 7368 636d   os.system(sshcm
-00029d80: 6429 0a0a 2020 2020 6465 6620 6861 6e64  d)..    def hand
-00029d90: 6c65 5f66 696e 6973 6866 696c 6573 2873  le_finishfiles(s
-00029da0: 656c 662c 206e 616d 652c 2066 696e 6973  elf, name, finis
-00029db0: 6866 696c 6573 2c20 6964 656e 7469 7479  hfiles, identity
-00029dc0: 6669 6c65 3d4e 6f6e 652c 2076 6d63 6c69  file=None, vmcli
-00029dd0: 656e 743d 4e6f 6e65 293a 0a20 2020 2020  ent=None):.     
-00029de0: 2020 2063 6f6e 6669 6720 3d20 4b63 6f6e     config = Kcon
-00029df0: 6669 6728 636c 6965 6e74 3d76 6d63 6c69  fig(client=vmcli
-00029e00: 656e 7429 2069 6620 766d 636c 6965 6e74  ent) if vmclient
-00029e10: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00029e20: 6520 7365 6c66 0a20 2020 2020 2020 206b  e self.        k
-00029e30: 203d 2063 6f6e 6669 672e 6b0a 2020 2020   = config.k.    
-00029e40: 2020 2020 6375 7272 656e 745f 6970 203d      current_ip =
-00029e50: 2063 6f6d 6d6f 6e2e 5f73 7368 5f63 7265   common._ssh_cre
-00029e60: 6465 6e74 6961 6c73 286b 2c20 6e61 6d65  dentials(k, name
-00029e70: 295b 315d 0a20 2020 2020 2020 2066 6f72  )[1].        for
-00029e80: 2066 696e 6973 6866 696c 6520 696e 2066   finishfile in f
-00029e90: 696e 6973 6866 696c 6573 3a0a 2020 2020  inishfiles:.    
-00029ea0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00029eb0: 7461 6e63 6528 6669 6e69 7368 6669 6c65  tance(finishfile
-00029ec0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00029ed0: 2020 2020 2020 2020 6465 7374 696e 6174          destinat
-00029ee0: 696f 6e20 3d20 272e 270a 2020 2020 2020  ion = '.'.      
-00029ef0: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00029f00: 203d 2066 696e 6973 6866 696c 6520 6966   = finishfile if
-00029f10: 2027 2f27 2069 6e20 6669 6e69 7368 6669   '/' in finishfi
-00029f20: 6c65 2065 6c73 6520 6627 2f72 6f6f 742f  le else f'/root/
-00029f30: 7b66 696e 6973 6866 696c 657d 270a 2020  {finishfile}'.  
-00029f40: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00029f50: 7369 6e73 7461 6e63 6528 6669 6e69 7368  sinstance(finish
-00029f60: 6669 6c65 2c20 6469 6374 2920 616e 6420  file, dict) and 
-00029f70: 276f 7269 6769 6e27 2069 6e20 6669 6e69  'origin' in fini
-00029f80: 7368 6669 6c65 2061 6e64 2027 7061 7468  shfile and 'path
-00029f90: 2720 696e 2066 696e 6973 6866 696c 653a  ' in finishfile:
-00029fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029fb0: 2073 6f75 7263 652c 2064 6573 7469 6e61   source, destina
-00029fc0: 7469 6f6e 203d 2066 696e 6973 6866 696c  tion = finishfil
-00029fd0: 652e 6765 7428 276f 7269 6769 6e27 292c  e.get('origin'),
-00029fe0: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-00029ff0: 7365 7228 6669 6e69 7368 6669 6c65 2e67  ser(finishfile.g
-0002a000: 6574 2827 7061 7468 272c 2027 2e27 2929  et('path', '.'))
-0002a010: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002a020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002a030: 2020 2077 6172 6e69 6e67 2866 2249 6e63     warning(f"Inc
-0002a040: 6f72 7265 6374 2066 696e 6973 6866 696c  orrect finishfil
-0002a050: 6520 656e 7472 7920 7b66 696e 6973 6866  e entry {finishf
-0002a060: 696c 657d 2e20 536b 6970 7069 6e67 2229  ile}. Skipping")
-0002a070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a080: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-0002a090: 2020 2020 2020 7363 7063 6d64 203d 2063        scpcmd = c
-0002a0a0: 6f6d 6d6f 6e2e 7363 7028 6e61 6d65 2c20  ommon.scp(name, 
-0002a0b0: 6970 3d63 7572 7265 6e74 5f69 702c 2075  ip=current_ip, u
-0002a0c0: 7365 723d 2772 6f6f 7427 2c20 736f 7572  ser='root', sour
-0002a0d0: 6365 3d73 6f75 7263 652c 2064 6573 7469  ce=source, desti
-0002a0e0: 6e61 7469 6f6e 3d64 6573 7469 6e61 7469  nation=destinati
-0002a0f0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0002a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a110: 2020 2020 7475 6e6e 656c 3d63 6f6e 6669      tunnel=confi
-0002a120: 672e 7475 6e6e 656c 2c20 7475 6e6e 656c  g.tunnel, tunnel
-0002a130: 686f 7374 3d63 6f6e 6669 672e 7475 6e6e  host=config.tunn
-0002a140: 656c 686f 7374 2c20 7475 6e6e 656c 706f  elhost, tunnelpo
-0002a150: 7274 3d63 6f6e 6669 672e 7475 6e6e 656c  rt=config.tunnel
-0002a160: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
-0002a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a180: 2020 2020 2020 7475 6e6e 656c 7573 6572        tunneluser
-0002a190: 3d73 656c 662e 7475 6e6e 656c 7573 6572  =self.tunneluser
-0002a1a0: 2c20 646f 776e 6c6f 6164 3d54 7275 652c  , download=True,
-0002a1b0: 2069 6e73 6563 7572 653d 5472 7565 2c20   insecure=True, 
-0002a1c0: 6964 656e 7469 7479 6669 6c65 3d69 6465  identityfile=ide
-0002a1d0: 6e74 6974 7966 696c 6529 0a20 2020 2020  ntityfile).     
-0002a1e0: 2020 2020 2020 206f 732e 7379 7374 656d         os.system
-0002a1f0: 2873 6370 636d 6429 0a0a 2020 2020 6465  (scpcmd)..    de
-0002a200: 6620 6861 6e64 6c65 5f6e 6f74 6966 6963  f handle_notific
-0002a210: 6174 696f 6e73 2873 656c 662c 206e 616d  ations(self, nam
-0002a220: 652c 206e 6f74 6966 796d 6574 686f 6473  e, notifymethods
-0002a230: 3d5b 5d2c 2070 7573 6862 756c 6c65 7474  =[], pushbullett
-0002a240: 6f6b 656e 3d4e 6f6e 652c 206e 6f74 6966  oken=None, notif
-0002a250: 7973 6372 6970 743d 4e6f 6e65 2c20 6e6f  yscript=None, no
-0002a260: 7469 6679 636d 643d 4e6f 6e65 2c0a 2020  tifycmd=None,.  
-0002a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a280: 2020 2020 2020 2020 2020 2073 6c61 636b             slack
-0002a290: 6368 616e 6e65 6c3d 4e6f 6e65 2c20 736c  channel=None, sl
-0002a2a0: 6163 6b74 6f6b 656e 3d4e 6f6e 652c 206d  acktoken=None, m
-0002a2b0: 6169 6c73 6572 7665 723d 4e6f 6e65 2c20  ailserver=None, 
-0002a2c0: 6d61 696c 6672 6f6d 3d4e 6f6e 652c 206d  mailfrom=None, m
-0002a2d0: 6169 6c74 6f3d 4e6f 6e65 2c0a 2020 2020  ailto=None,.    
-0002a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a2f0: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
-0002a300: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0002a310: 205f 7479 7065 203d 2027 436c 7573 7465   _type = 'Cluste
-0002a320: 7227 2069 6620 636c 7573 7465 7220 656c  r' if cluster el
-0002a330: 7365 2027 566d 270a 2020 2020 2020 2020  se 'Vm'.        
-0002a340: 7469 746c 6520 3d20 6622 7b5f 7479 7065  title = f"{_type
-0002a350: 7d20 7b6e 616d 657d 206f 6e20 7b73 656c  } {name} on {sel
-0002a360: 662e 636c 6965 6e74 7d20 7265 706f 7274  f.client} report
-0002a370: 220a 2020 2020 2020 2020 636d 6473 2c20  ".        cmds, 
-0002a380: 6d61 696c 636f 6e74 656e 7420 3d20 5b5d  mailcontent = []
-0002a390: 2c20 4e6f 6e65 0a20 2020 2020 2020 2066  , None.        f
-0002a3a0: 6f72 206e 6f74 6966 796d 6574 686f 6420  or notifymethod 
-0002a3b0: 696e 2073 6f72 7465 6428 6e6f 7469 6679  in sorted(notify
-0002a3c0: 6d65 7468 6f64 732c 2072 6576 6572 7365  methods, reverse
-0002a3d0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0002a3e0: 2020 2020 6966 206e 6f74 6966 796d 6574      if notifymet
-0002a3f0: 686f 6420 3d3d 2027 7075 7368 6275 6c6c  hod == 'pushbull
-0002a400: 6574 273a 0a20 2020 2020 2020 2020 2020  et':.           
-0002a410: 2020 2020 2069 6620 7075 7368 6275 6c6c       if pushbull
-0002a420: 6574 746f 6b65 6e20 6973 204e 6f6e 653a  ettoken is None:
-0002a430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a440: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
-0002a450: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
-0002a460: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
-0002a470: 6275 7420 6d69 7373 696e 6720 7075 7368  but missing push
-0002a480: 6275 6c6c 6574 746f 6b65 6e22 290a 2020  bullettoken").  
-0002a490: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002a4a0: 6966 206e 6f74 6966 7973 6372 6970 7420  if notifyscript 
-0002a4b0: 6973 204e 6f6e 6520 616e 6420 6e6f 7469  is None and noti
-0002a4c0: 6679 636d 6420 6973 204e 6f6e 653a 0a20  fycmd is None:. 
-0002a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4e0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0002a4f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002a500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a510: 2020 2020 2020 746f 6b65 6e20 3d20 7075        token = pu
-0002a520: 7368 6275 6c6c 6574 746f 6b65 6e0a 2020  shbullettoken.  
-0002a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a540: 2020 7062 636d 6420 3d20 2763 7572 6c20    pbcmd = 'curl 
-0002a550: 2d73 7520 2225 733a 2220 2d64 2074 7970  -su "%s:" -d typ
-0002a560: 653d 226e 6f74 6522 202d 6420 626f 6479  e="note" -d body
-0002a570: 3d22 6025 7320 323e 2631 6022 202d 6420  ="`%s 2>&1`" -d 
-0002a580: 7469 746c 653d 2225 7322 2027 2025 2028  title="%s" ' % (
-0002a590: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
-0002a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5f0: 2020 2020 2020 2020 206e 6f74 6966 7963           notifyc
-0002a600: 6d64 2c0a 2020 2020 2020 2020 2020 2020  md,.            
-0002a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a660: 2020 2020 2020 7469 746c 6529 0a20 2020        title).   
-0002a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a680: 2070 6263 6d64 202b 3d20 2768 7474 7073   pbcmd += 'https
-0002a690: 3a2f 2f61 7069 2e70 7573 6862 756c 6c65  ://api.pushbulle
-0002a6a0: 742e 636f 6d2f 7632 2f70 7573 6865 7327  t.com/v2/pushes'
-0002a6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a6c0: 2020 2020 2063 6d64 732e 6170 7065 6e64       cmds.append
-0002a6d0: 2870 6263 6d64 290a 2020 2020 2020 2020  (pbcmd).        
-0002a6e0: 2020 2020 656c 6966 206e 6f74 6966 796d      elif notifym
-0002a6f0: 6574 686f 6420 3d3d 2027 736c 6163 6b27  ethod == 'slack'
-0002a700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a710: 2020 6966 2073 6c61 636b 6368 616e 6e65    if slackchanne
-0002a720: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-0002a730: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002a740: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
-0002a750: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
-0002a760: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
-0002a770: 7373 696e 6720 736c 6163 6b20 6368 616e  ssing slack chan
-0002a780: 6e65 6c22 290a 2020 2020 2020 2020 2020  nel").          
-0002a790: 2020 2020 2020 656c 6966 2073 6c61 636b        elif slack
-0002a7a0: 746f 6b65 6e20 6973 204e 6f6e 653a 0a20  token is None:. 
-0002a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a7c0: 2020 2077 6172 6e69 6e67 2866 224e 6f74     warning(f"Not
-0002a7d0: 6966 6963 6174 696f 6e20 7265 7175 6972  ification requir
-0002a7e0: 6564 2066 6f72 207b 6e61 6d65 7d20 6275  ed for {name} bu
-0002a7f0: 7420 6d69 7373 696e 6720 736c 6163 6b74  t missing slackt
-0002a800: 6f6b 656e 2229 0a20 2020 2020 2020 2020  oken").         
-0002a810: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a830: 2073 6c61 636b 636d 6420 3d20 6622 696e   slackcmd = f"in
-0002a840: 666f 3d60 7b6e 6f74 6966 7963 6d64 7d20  fo=`{notifycmd} 
-0002a850: 323e 2631 207c 2073 6564 2027 732f 5c5c  2>&1 | sed 's/\\
-0002a860: 7832 2f20 2f67 2760 3b22 0a20 2020 2020  x2/ /g'`;".     
-0002a870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002a880: 6c61 636b 636d 6420 2b3d 2022 2222 6375  lackcmd += """cu
-0002a890: 726c 202d 5820 504f 5354 202d 4820 2741  rl -X POST -H 'A
-0002a8a0: 7574 686f 7269 7a61 7469 6f6e 3a20 4265  uthorization: Be
-0002a8b0: 6172 6572 2025 7327 0a20 2d48 2027 436f  arer %s'. -H 'Co
-0002a8c0: 6e74 656e 742d 7479 7065 3a20 6170 706c  ntent-type: appl
-0002a8d0: 6963 6174 696f 6e2f 6a73 6f6e 3b20 6368  ication/json; ch
-0002a8e0: 6172 7365 743d 7574 662d 3827 0a20 2d2d  arset=utf-8'. --
-0002a8f0: 6461 7461 2027 7b22 6368 616e 6e65 6c22  data '{"channel"
-0002a900: 3a22 2573 222c 2274 6578 7422 3a22 2573  :"%s","text":"%s
-0002a910: 222c 2261 7474 6163 686d 656e 7473 223a  ","attachments":
-0002a920: 205b 7b22 7465 7874 223a 2227 2224 696e   [{"text":"'"$in
-0002a930: 666f 2227 222c 2266 616c 6c62 6163 6b22  fo"'","fallback"
-0002a940: 3a22 6e6f 7468 696e 6722 2c0a 2263 6f6c  :"nothing",."col
-0002a950: 6f72 223a 2223 3341 4133 4533 222c 2261  or":"#3AA3E3","a
-0002a960: 7474 6163 686d 656e 745f 7479 7065 223a  ttachment_type":
-0002a970: 2264 6566 6175 6c74 227d 5d7d 2720 6874  "default"}]}' ht
-0002a980: 7470 733a 2f2f 736c 6163 6b2e 636f 6d2f  tps://slack.com/
-0002a990: 6170 692f 6368 6174 2e70 6f73 744d 6573  api/chat.postMes
-0002a9a0: 7361 6765 2222 2220 2520 2873 6c61 636b  sage""" % (slack
-0002a9b0: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
-0002a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aa10: 2020 2020 2020 736c 6163 6b63 6861 6e6e        slackchann
-0002aa20: 656c 2c20 7469 746c 6529 0a20 2020 2020  el, title).     
-0002aa30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002aa40: 6c61 636b 636d 6420 3d20 736c 6163 6b63  lackcmd = slackc
-0002aa50: 6d64 2e72 6570 6c61 6365 2827 5c6e 272c  md.replace('\n',
-0002aa60: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
-0002aa70: 2020 2020 2020 2020 2063 6d64 732e 6170           cmds.ap
-0002aa80: 7065 6e64 2873 6c61 636b 636d 6429 0a20  pend(slackcmd). 
-0002aa90: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0002aaa0: 6e6f 7469 6679 6d65 7468 6f64 203d 3d20  notifymethod == 
-0002aab0: 276d 6169 6c27 3a0a 2020 2020 2020 2020  'mail':.        
-0002aac0: 2020 2020 2020 2020 6966 206d 6169 6c73          if mails
-0002aad0: 6572 7665 7220 6973 204e 6f6e 653a 0a20  erver is None:. 
-0002aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aaf0: 2020 2077 6172 6e69 6e67 2866 224e 6f74     warning(f"Not
-0002ab00: 6966 6963 6174 696f 6e20 7265 7175 6972  ification requir
-0002ab10: 6564 2066 6f72 207b 6e61 6d65 7d20 6275  ed for {name} bu
-0002ab20: 7420 6d69 7373 696e 6720 6d61 696c 7365  t missing mailse
-0002ab30: 7276 6572 2229 0a20 2020 2020 2020 2020  rver").         
-0002ab40: 2020 2020 2020 2065 6c69 6620 6d61 696c         elif mail
-0002ab50: 6672 6f6d 2069 7320 4e6f 6e65 3a0a 2020  from is None:.  
-0002ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ab70: 2020 7761 726e 696e 6728 6622 4e6f 7469    warning(f"Noti
-0002ab80: 6669 6361 7469 6f6e 2072 6571 7569 7265  fication require
-0002ab90: 6420 666f 7220 7b6e 616d 657d 2062 7574  d for {name} but
-0002aba0: 206d 6973 7369 6e67 206d 6169 6c66 726f   missing mailfro
-0002abb0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
-0002abc0: 2020 2020 656c 6966 206e 6f74 206d 6169      elif not mai
-0002abd0: 6c74 6f3a 0a20 2020 2020 2020 2020 2020  lto:.           
-0002abe0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0002abf0: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
-0002ac00: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
-0002ac10: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
-0002ac20: 6d61 696c 746f 2229 0a20 2020 2020 2020  mailto").       
-0002ac30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ac50: 2020 206e 6f77 203d 2064 6174 6574 696d     now = datetim
-0002ac60: 652e 6e6f 7728 290a 2020 2020 2020 2020  e.now().        
-0002ac70: 2020 2020 2020 2020 2020 2020 6e6f 7720              now 
-0002ac80: 3d20 6e6f 772e 2073 7472 6674 696d 6528  = now. strftime(
-0002ac90: 2225 612c 2564 2025 6220 2559 2025 483a  "%a,%d %b %Y %H:
-0002aca0: 254d 3a25 5322 290a 2020 2020 2020 2020  %M:%S").        
-0002acb0: 2020 2020 2020 2020 2020 2020 746f 7320              tos 
-0002acc0: 3d20 272c 272e 6a6f 696e 285b 6622 3c7b  = ','.join([f"<{
-0002acd0: 746f 7d3e 2220 666f 7220 746f 2069 6e20  to}>" for to in 
-0002ace0: 6d61 696c 746f 5d29 0a20 2020 2020 2020  mailto]).       
-0002acf0: 2020 2020 2020 2020 2020 2020 206d 6169               mai
-0002ad00: 6c63 6f6e 7465 6e74 203d 2066 2246 726f  lcontent = f"Fro
-0002ad10: 6d3a 207b 6d61 696c 6672 6f6d 7d20 3c7b  m: {mailfrom} <{
-0002ad20: 6d61 696c 6672 6f6d 7d3e 5c6e 546f 3a20  mailfrom}>\nTo: 
-0002ad30: 7b74 6f73 7d5c 6e44 6174 653a 207b 6e6f  {tos}\nDate: {no
-0002ad40: 777d 5c6e 5375 626a 6563 743a 207b 7469  w}\nSubject: {ti
-0002ad50: 746c 657d 220a 2020 2020 2020 2020 2020  tle}".          
-0002ad60: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
-0002ad70: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
-0002ad80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0002ad90: 7420 636c 7573 7465 723a 0a20 2020 2020  t cluster:.     
-0002ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002adb0: 2020 206d 6169 6c63 6d64 2e61 7070 656e     mailcmd.appen
-0002adc0: 6428 2774 6573 7420 2d66 202f 6574 632f  d('test -f /etc/
-0002add0: 6465 6269 616e 5f76 6572 7369 6f6e 2026  debian_version &
-0002ade0: 2620 6170 742d 6765 7420 2d79 2069 6e73  & apt-get -y ins
-0002adf0: 7461 6c6c 2063 7572 6c27 290a 2020 2020  tall curl').    
-0002ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ae10: 2020 2020 6d61 696c 636d 642e 6170 7065      mailcmd.appe
-0002ae20: 6e64 2827 6563 686f 2022 2220 3e3e 202f  nd('echo "" >> /
-0002ae30: 7661 722f 746d 702f 6d61 696c 2e74 7874  var/tmp/mail.txt
-0002ae40: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0002ae50: 2020 2020 2020 206d 6169 6c63 6d64 2e61         mailcmd.a
-0002ae60: 7070 656e 6428 6627 7b6e 6f74 6966 7963  ppend(f'{notifyc
-0002ae70: 6d64 7d20 323e 2631 203e 3e20 2f76 6172  md} 2>&1 >> /var
-0002ae80: 2f74 6d70 2f6d 6169 6c2e 7478 7427 290a  /tmp/mail.txt').
-0002ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aea0: 2020 2020 6375 726c 636d 6420 3d20 6622      curlcmd = f"
-0002aeb0: 6375 726c 202d 2d73 696c 656e 7420 2d2d  curl --silent --
-0002aec0: 7572 6c20 736d 7470 3a2f 2f7b 6d61 696c  url smtp://{mail
-0002aed0: 7365 7276 6572 7d3a 3235 202d 2d6d 6169  server}:25 --mai
-0002aee0: 6c2d 6672 6f6d 207b 6d61 696c 6672 6f6d  l-from {mailfrom
-0002aef0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0002af00: 2020 2020 2020 2066 6f72 2061 6464 7265         for addre
-0002af10: 7373 2069 6e20 6d61 696c 746f 3a0a 2020  ss in mailto:.  
-0002af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002af30: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
-0002af40: 2066 2220 2d2d 6d61 696c 2d72 6370 7420   f" --mail-rcpt 
-0002af50: 7b61 6464 7265 7373 7d20 220a 2020 2020  {address} ".    
-0002af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002af70: 6966 2063 6c75 7374 6572 3a0a 2020 2020  if cluster:.    
-0002af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002af90: 2020 2020 6d61 696c 636f 6e74 656e 7420      mailcontent 
-0002afa0: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
-0002afb0: 2020 2020 2020 2020 2020 2020 206b 7562               kub
-0002afc0: 6563 6f6e 6669 6720 3d20 6627 2f65 7463  econfig = f'/etc
-0002afd0: 2f6b 7562 6572 6e65 7465 732f 6b75 6265  /kubernetes/kube
-0002afe0: 636f 6e66 6967 2e7b 6e61 6d65 7d27 0a20  config.{name}'. 
-0002aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b000: 2020 2020 2020 2063 7572 6c63 6d64 202b         curlcmd +
-0002b010: 3d20 6627 202d 4820 2253 7562 6a65 6374  = f' -H "Subject
-0002b020: 3a20 7b74 6974 6c65 7d22 202d 4820 2246  : {title}" -H "F
-0002b030: 726f 6d3a 207b 6d61 696c 6672 6f6d 7d20  rom: {mailfrom} 
-0002b040: 3c7b 6d61 696c 6672 6f6d 7d3e 2227 0a20  <{mailfrom}>"'. 
-0002b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b060: 2020 2020 2020 2066 6f72 2061 6464 7265         for addre
-0002b070: 7373 2069 6e20 6d61 696c 746f 3a0a 2020  ss in mailto:.  
-0002b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b090: 2020 2020 2020 2020 2020 6375 726c 636d            curlcm
-0002b0a0: 6420 2b3d 2066 2720 2d48 2022 546f 3a20  d += f' -H "To: 
-0002b0b0: 7b61 6464 7265 7373 7d20 3c7b 6164 6472  {address} <{addr
-0002b0c0: 6573 737d 3e22 270a 2020 2020 2020 2020  ess}>"'.        
-0002b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b0e0: 6375 726c 636d 6420 2b3d 2027 202d 4620  curlcmd += ' -F 
-0002b0f0: 223d 283b 7479 7065 3d6d 756c 7469 7061  "=(;type=multipa
-0002b100: 7274 2f6d 6978 6564 2220 2d46 2022 3d24  rt/mixed" -F "=$
-0002b110: 2863 6174 202f 7661 722f 746d 702f 6d61  (cat /var/tmp/ma
-0002b120: 696c 2e74 7874 293b 7479 7065 3d74 6578  il.txt);type=tex
-0002b130: 742f 706c 6169 6e22 270a 2020 2020 2020  t/plain"'.      
-0002b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b150: 2020 6375 726c 636d 6420 2b3d 2066 2720    curlcmd += f' 
-0002b160: 2d46 2022 6669 6c65 3d40 7b6b 7562 6563  -F "file=@{kubec
-0002b170: 6f6e 6669 677d 3b74 7970 653d 7465 7874  onfig};type=text
-0002b180: 2f70 6c61 696e 3b65 6e63 6f64 6572 3d62  /plain;encoder=b
-0002b190: 6173 6536 3422 202d 4620 223d 2922 270a  ase64" -F "=)"'.
-0002b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b1b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b1d0: 2020 6375 726c 636d 6420 2b3d 2022 202d    curlcmd += " -
-0002b1e0: 2d75 706c 6f61 642d 6669 6c65 202f 7661  -upload-file /va
-0002b1f0: 722f 746d 702f 6d61 696c 2e74 7874 220a  r/tmp/mail.txt".
-0002b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b210: 2020 2020 6d61 696c 636d 642e 6170 7065      mailcmd.appe
-0002b220: 6e64 2863 7572 6c63 6d64 290a 2020 2020  nd(curlcmd).    
-0002b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b240: 636d 6473 2e65 7874 656e 6428 6d61 696c  cmds.extend(mail
-0002b250: 636d 6429 0a20 2020 2020 2020 2020 2020  cmd).           
-0002b260: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002b270: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
-0002b280: 6e76 616c 6964 206d 6574 686f 6420 7b6e  nvalid method {n
-0002b290: 6f74 6966 796d 6574 686f 647d 2229 0a20  otifymethod}"). 
-0002b2a0: 2020 2020 2020 2072 6574 7572 6e20 636d         return cm
-0002b2b0: 6473 2c20 6d61 696c 636f 6e74 656e 740a  ds, mailcontent.
-0002b2c0: 0a20 2020 2064 6566 2068 616e 646c 655f  .    def handle_
-0002b2d0: 766d 5f72 6573 756c 7428 7365 6c66 2c20  vm_result(self, 
-0002b2e0: 6e61 6d65 2c20 7072 6f66 696c 652c 2072  name, profile, r
-0002b2f0: 6573 756c 742c 206e 6577 766d 732c 2066  esult, newvms, f
-0002b300: 6169 6c65 6476 6d73 2c20 6173 796e 6377  ailedvms, asyncw
-0002b310: 6169 7476 6d73 2c20 6f6e 6c79 6173 7365  aitvms, onlyasse
-0002b320: 7473 3d46 616c 7365 2c20 6e65 7761 7373  ts=False, newass
-0002b330: 6574 733d 5b5d 2c0a 2020 2020 2020 2020  ets=[],.        
-0002b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b350: 2076 6d63 6c69 656e 743d 4e6f 6e65 293a   vmclient=None):
-0002b360: 0a20 2020 2020 2020 2069 6620 2772 6573  .        if 'res
-0002b370: 756c 7427 2069 6e20 7265 7375 6c74 2061  ult' in result a
-0002b380: 6e64 2072 6573 756c 745b 2772 6573 756c  nd result['resul
-0002b390: 7427 5d20 3d3d 2027 7375 6363 6573 7327  t'] == 'success'
-0002b3a0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
-0002b3b0: 7776 6d73 2e61 7070 656e 6428 6e61 6d65  wvms.append(name
-0002b3c0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0002b3d0: 2020 2020 2020 2020 2020 2020 6661 696c              fail
-0002b3e0: 6564 766d 732e 6170 7065 6e64 287b 276e  edvms.append({'n
-0002b3f0: 616d 6527 3a20 6e61 6d65 2c20 2772 6561  ame': name, 'rea
-0002b400: 736f 6e27 3a20 7265 7375 6c74 5b27 7265  son': result['re
-0002b410: 6173 6f6e 275d 7d29 0a20 2020 2020 2020  ason']}).       
-0002b420: 2073 7461 7274 203d 2070 726f 6669 6c65   start = profile
-0002b430: 2e67 6574 2827 7374 6172 7427 2c20 5472  .get('start', Tr
-0002b440: 7565 290a 2020 2020 2020 2020 636c 6f75  ue).        clou
-0002b450: 6469 6e69 7420 3d20 7072 6f66 696c 652e  dinit = profile.
-0002b460: 6765 7428 2763 6c6f 7564 696e 6974 272c  get('cloudinit',
-0002b470: 2054 7275 6529 0a20 2020 2020 2020 2061   True).        a
-0002b480: 7379 6e63 7761 6974 203d 2070 726f 6669  syncwait = profi
-0002b490: 6c65 2e67 6574 2827 6173 796e 6377 6169  le.get('asyncwai
-0002b4a0: 7427 2c20 4661 6c73 6529 0a20 2020 2020  t', False).     
-0002b4b0: 2020 2066 696e 6973 6866 696c 6573 203d     finishfiles =
-0002b4c0: 2070 726f 6669 6c65 2e67 6574 2827 6669   profile.get('fi
-0002b4d0: 6e69 7368 6669 6c65 7327 2c20 5b5d 290a  nishfiles', []).
-0002b4e0: 2020 2020 2020 2020 6966 206f 6e6c 7961          if onlya
-0002b4f0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-0002b500: 2020 2069 6620 2764 6174 6127 2069 6e20     if 'data' in 
-0002b510: 7265 7375 6c74 3a0a 2020 2020 2020 2020  result:.        
-0002b520: 2020 2020 2020 2020 6e65 7761 7373 6574          newasset
-0002b530: 732e 6170 7065 6e64 2872 6573 756c 745b  s.append(result[
-0002b540: 2764 6174 6127 5d29 0a20 2020 2020 2020  'data']).       
-0002b550: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002b560: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0002b570: 2872 6573 756c 745b 2772 6561 736f 6e27  (result['reason'
-0002b580: 5d29 0a20 2020 2020 2020 2069 6620 6e6f  ]).        if no
-0002b590: 7420 6173 796e 6377 6169 743a 0a20 2020  t asyncwait:.   
-0002b5a0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0002b5b0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
-0002b5c0: 2073 7461 7274 206f 7220 6e6f 7420 636c   start or not cl
-0002b5d0: 6f75 6469 6e69 7420 6f72 2070 726f 6669  oudinit or profi
-0002b5e0: 6c65 2e67 6574 2827 696d 6167 6527 2920  le.get('image') 
-0002b5f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0002b600: 2020 2020 2070 7072 696e 7428 6622 536b       pprint(f"Sk
-0002b610: 6970 7069 6e67 2077 6169 7420 6f6e 207b  ipping wait on {
-0002b620: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0002b630: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002b640: 2020 7761 6974 636f 6d6d 616e 6420 3d20    waitcommand = 
-0002b650: 7072 6f66 696c 652e 6765 7428 2777 6169  profile.get('wai
-0002b660: 7463 6f6d 6d61 6e64 2729 0a20 2020 2020  tcommand').     
-0002b670: 2020 2020 2020 2077 6169 7474 696d 656f         waittimeo
-0002b680: 7574 203d 2070 726f 6669 6c65 2e67 6574  ut = profile.get
-0002b690: 2827 7761 6974 7469 6d65 6f75 7427 2c20  ('waittimeout', 
-0002b6a0: 3029 0a20 2020 2020 2020 2020 2020 2061  0).            a
-0002b6b0: 7379 6e63 7761 6974 766d 203d 207b 276e  syncwaitvm = {'n
-0002b6c0: 616d 6527 3a20 6e61 6d65 2c20 2766 696e  ame': name, 'fin
-0002b6d0: 6973 6866 696c 6573 273a 2066 696e 6973  ishfiles': finis
-0002b6e0: 6866 696c 6573 2c20 2777 6169 7463 6f6d  hfiles, 'waitcom
-0002b6f0: 6d61 6e64 273a 2077 6169 7463 6f6d 6d61  mand': waitcomma
-0002b700: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
-0002b710: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0002b720: 7761 6974 7469 6d65 6f75 7427 3a20 7761  waittimeout': wa
-0002b730: 6974 7469 6d65 6f75 742c 2027 766d 636c  ittimeout, 'vmcl
-0002b740: 6965 6e74 273a 2076 6d63 6c69 656e 747d  ient': vmclient}
-0002b750: 0a20 2020 2020 2020 2020 2020 2061 7379  .            asy
-0002b760: 6e63 7761 6974 766d 732e 6170 7065 6e64  ncwaitvms.append
-0002b770: 2861 7379 6e63 7761 6974 766d 290a 0a20  (asyncwaitvm).. 
-0002b780: 2020 2064 6566 2074 6872 6561 6465 645f     def threaded_
-0002b790: 6372 6561 7465 5f76 6d28 7365 6c66 2c20  create_vm(self, 
-0002b7a0: 6e61 6d65 2c20 7072 6f66 696c 656e 616d  name, profilenam
-0002b7b0: 652c 2063 7572 7265 6e74 6f76 6572 7269  e, currentoverri
-0002b7c0: 6465 732c 2070 726f 6669 6c65 2c20 7a2c  des, profile, z,
-0002b7d0: 2070 6c61 6e2c 2063 7572 7265 6e74 706c   plan, currentpl
-0002b7e0: 616e 6469 722c 2076 6d63 6c69 656e 742c  andir, vmclient,
-0002b7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b800: 2020 2020 2020 2020 2020 2020 6f6e 666c              onfl
-0002b810: 792c 206f 6e6c 7961 7373 6574 732c 206e  y, onlyassets, n
-0002b820: 6577 766d 732c 2066 6169 6c65 6476 6d73  ewvms, failedvms
-0002b830: 2c20 6173 796e 6377 6169 7476 6d73 2c20  , asyncwaitvms, 
-0002b840: 6e65 7761 7373 6574 7329 3a0a 2020 2020  newassets):.    
-0002b850: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-0002b860: 662e 6372 6561 7465 5f76 6d28 6e61 6d65  f.create_vm(name
-0002b870: 2c20 7072 6f66 696c 656e 616d 652c 206f  , profilename, o
-0002b880: 7665 7272 6964 6573 3d63 7572 7265 6e74  verrides=current
-0002b890: 6f76 6572 7269 6465 732c 2063 7573 746f  overrides, custo
-0002b8a0: 6d70 726f 6669 6c65 3d70 726f 6669 6c65  mprofile=profile
-0002b8b0: 2c20 6b3d 7a2c 0a20 2020 2020 2020 2020  , k=z,.         
-0002b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b8d0: 2020 2020 2020 2070 6c61 6e3d 706c 616e         plan=plan
-0002b8e0: 2c20 6261 7365 6469 723d 6375 7272 656e  , basedir=curren
-0002b8f0: 7470 6c61 6e64 6972 2c20 636c 6965 6e74  tplandir, client
-0002b900: 3d76 6d63 6c69 656e 742c 206f 6e66 6c79  =vmclient, onfly
-0002b910: 3d6f 6e66 6c79 2c0a 2020 2020 2020 2020  =onfly,.        
-0002b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b930: 2020 2020 2020 2020 6f6e 6c79 6173 7365          onlyasse
-0002b940: 7473 3d6f 6e6c 7961 7373 6574 7329 0a20  ts=onlyassets). 
-0002b950: 2020 2020 2020 2069 6620 6e6f 7420 6f6e         if not on
-0002b960: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-0002b970: 2020 2020 2020 636f 6d6d 6f6e 2e68 616e        common.han
-0002b980: 646c 655f 7265 7370 6f6e 7365 2872 6573  dle_response(res
-0002b990: 756c 742c 206e 616d 652c 2063 6c69 656e  ult, name, clien
-0002b9a0: 743d 766d 636c 6965 6e74 290a 2020 2020  t=vmclient).    
-0002b9b0: 2020 2020 7365 6c66 2e68 616e 646c 655f      self.handle_
-0002b9c0: 766d 5f72 6573 756c 7428 6e61 6d65 2c20  vm_result(name, 
-0002b9d0: 7072 6f66 696c 652c 2072 6573 756c 743d  profile, result=
-0002b9e0: 7265 7375 6c74 2c20 6e65 7776 6d73 3d6e  result, newvms=n
-0002b9f0: 6577 766d 732c 2066 6169 6c65 6476 6d73  ewvms, failedvms
-0002ba00: 3d66 6169 6c65 6476 6d73 2c0a 2020 2020  =failedvms,.    
-0002ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba20: 2020 2020 2020 2020 2020 6173 796e 6377            asyncw
-0002ba30: 6169 7476 6d73 3d61 7379 6e63 7761 6974  aitvms=asyncwait
-0002ba40: 766d 732c 206f 6e6c 7961 7373 6574 733d  vms, onlyassets=
-0002ba50: 6f6e 6c79 6173 7365 7473 2c20 6e65 7761  onlyassets, newa
-0002ba60: 7373 6574 733d 6e65 7761 7373 6574 732c  ssets=newassets,
-0002ba70: 2076 6d63 6c69 656e 743d 766d 636c 6965   vmclient=vmclie
-0002ba80: 6e74 290a 0a20 2020 2064 6566 2070 6172  nt)..    def par
-0002ba90: 7365 5f66 696c 6573 2873 656c 662c 206e  se_files(self, n
-0002baa0: 616d 652c 2066 696c 6573 2c20 6261 7365  ame, files, base
-0002bab0: 6469 723d 272e 272c 206f 6e66 6c79 3d4e  dir='.', onfly=N
-0002bac0: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
-0002bad0: 206e 6f74 2066 696c 6573 3a0a 2020 2020   not files:.    
-0002bae0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0002baf0: 2020 2020 2020 2066 6f72 2069 6e64 6578         for index
-0002bb00: 2c20 6669 6c20 696e 2065 6e75 6d65 7261  , fil in enumera
-0002bb10: 7465 2866 696c 6573 293a 0a20 2020 2020  te(files):.     
-0002bb20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0002bb30: 616e 6365 2866 696c 2c20 7374 7229 3a0a  ance(fil, str):.
-0002bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bb50: 7061 7468 203d 2066 222f 726f 6f74 2f7b  path = f"/root/{
-0002bb60: 6669 6c7d 220a 2020 2020 2020 2020 2020  fil}".          
-0002bb70: 2020 2020 2020 6966 2062 6173 6564 6972        if basedir
-0002bb80: 2021 3d20 272e 273a 0a20 2020 2020 2020   != '.':.       
-0002bb90: 2020 2020 2020 2020 2020 2020 206f 7269               ori
-0002bba0: 6769 6e20 3d20 6622 7b62 6173 6564 6972  gin = f"{basedir
-0002bbb0: 7d2f 7b70 6174 687d 220a 2020 2020 2020  }/{path}".      
-0002bbc0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-0002bbd0: 203d 2066 696c 0a20 2020 2020 2020 2020   = fil.         
-0002bbe0: 2020 2020 2020 2063 6f6e 7465 6e74 203d         content =
-0002bbf0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0002bc00: 2020 2020 2020 6669 6c65 735b 696e 6465        files[inde
-0002bc10: 785d 203d 207b 2770 6174 6827 3a20 7061  x] = {'path': pa
-0002bc20: 7468 2c20 276f 7269 6769 6e27 3a20 6f72  th, 'origin': or
-0002bc30: 6967 696e 7d0a 2020 2020 2020 2020 2020  igin}.          
-0002bc40: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0002bc50: 6528 6669 6c2c 2064 6963 7429 3a0a 2020  e(fil, dict):.  
-0002bc60: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0002bc70: 6967 696e 203d 2066 696c 2e67 6574 2827  igin = fil.get('
-0002bc80: 6f72 6967 696e 2729 0a20 2020 2020 2020  origin').       
-0002bc90: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
-0002bca0: 203d 2066 696c 2e67 6574 2827 636f 6e74   = fil.get('cont
-0002bcb0: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
-0002bcc0: 2020 2020 2020 7061 7468 203d 2066 696c        path = fil
-0002bcd0: 2e67 6574 2827 7061 7468 2729 0a20 2020  .get('path').   
-0002bce0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002bcf0: 7061 7468 2069 7320 4e6f 6e65 3a0a 2020  path is None:.  
-0002bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd10: 2020 6966 206f 7269 6769 6e20 6973 206e    if origin is n
-0002bd20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00029270: 6973 6f5f 706f 6f6c 203d 206f 7665 7272  iso_pool = overr
+00029280: 6964 6573 2e67 6574 2827 706f 6f6c 2729  ides.get('pool')
+00029290: 206f 7220 7365 6c66 2e70 6f6f 6c0a 2020   or self.pool.  
+000292a0: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+000292b0: 6e65 7261 7465 5f72 6863 6f73 5f69 736f  nerate_rhcos_iso
+000292c0: 2873 656c 662e 6b2c 2066 227b 636c 7573  (self.k, f"{clus
+000292d0: 7465 727d 2d7b 726f 6c65 7d22 2c20 6973  ter}-{role}", is
+000292e0: 6f5f 706f 6f6c 2c20 7665 7273 696f 6e3d  o_pool, version=
+000292f0: 6973 6f5f 7665 7273 696f 6e2c 2070 6f64  iso_version, pod
+00029300: 6d61 6e3d 706f 646d 616e 2c0a 2020 2020  man=podman,.    
+00029310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029320: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029330: 6e73 7461 6c6c 6572 3d69 6e73 7461 6c6c  nstaller=install
+00029340: 6572 290a 0a20 2020 2064 6566 2063 7265  er)..    def cre
+00029350: 6174 655f 6f70 656e 7368 6966 745f 6469  ate_openshift_di
+00029360: 7363 6f6e 6e65 6374 6564 2873 656c 662c  sconnected(self,
+00029370: 2070 6c61 6e2c 206f 7665 7272 6964 6573   plan, overrides
+00029380: 3d7b 7d29 3a0a 2020 2020 2020 2020 6461  ={}):.        da
+00029390: 7461 203d 206f 7665 7272 6964 6573 0a20  ta = overrides. 
+000293a0: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
+000293b0: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+000293c0: 286f 7065 6e73 6869 6674 2e63 7265 6174  (openshift.creat
+000293d0: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
+000293e0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+000293f0: 636c 7573 7465 7220 3d20 6461 7461 2e67  cluster = data.g
+00029400: 6574 2827 636c 7573 7465 7227 2c20 276d  et('cluster', 'm
+00029410: 796f 7065 6e73 6869 6674 2729 0a20 2020  yopenshift').   
+00029420: 2020 2020 2075 7073 7472 6561 6d20 3d20       upstream = 
+00029430: 6461 7461 2e67 6574 2827 7570 7374 7265  data.get('upstre
+00029440: 616d 272c 2046 616c 7365 290a 2020 2020  am', False).    
+00029450: 2020 2020 7665 7273 696f 6e20 3d20 6461      version = da
+00029460: 7461 2e67 6574 2827 7665 7273 696f 6e27  ta.get('version'
+00029470: 2c20 2773 7461 626c 6527 290a 2020 2020  , 'stable').    
+00029480: 2020 2020 7461 6720 3d20 6461 7461 2e67      tag = data.g
+00029490: 6574 2827 7461 6727 2c20 4f50 454e 5348  et('tag', OPENSH
+000294a0: 4946 545f 5441 4729 0a20 2020 2020 2020  IFT_TAG).       
+000294b0: 2070 7072 696e 7428 6622 5573 696e 6720   pprint(f"Using 
+000294c0: 7665 7273 696f 6e20 7b76 6572 7369 6f6e  version {version
+000294d0: 7d20 616e 6420 7461 6720 7b74 6167 7d22  } and tag {tag}"
+000294e0: 290a 2020 2020 2020 2020 6469 7363 6f6e  ).        discon
+000294f0: 6e65 6374 6564 5f76 6d20 3d20 6622 7b63  nected_vm = f"{c
+00029500: 6c75 7374 6572 7d2d 6469 7363 6f6e 6e65  luster}-disconne
+00029510: 6374 6564 220a 2020 2020 2020 2020 6469  cted".        di
+00029520: 7363 6f6e 6e65 6374 6564 5f72 6575 7365  sconnected_reuse
+00029530: 203d 2064 6174 612e 6765 7428 2764 6973   = data.get('dis
+00029540: 636f 6e6e 6563 7465 645f 7265 7573 6527  connected_reuse'
+00029550: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
+00029560: 2064 6973 636f 6e6e 6563 7465 645f 7379   disconnected_sy
+00029570: 6e63 203d 2064 6174 612e 6765 7428 2764  nc = data.get('d
+00029580: 6973 636f 6e6e 6563 7465 645f 7379 6e63  isconnected_sync
+00029590: 272c 2054 7275 6529 0a20 2020 2020 2020  ', True).       
+000295a0: 2070 7072 696e 7428 6622 4465 706c 6f79   pprint(f"Deploy
+000295b0: 696e 6720 6469 7363 6f6e 6e65 6374 6564  ing disconnected
+000295c0: 2076 6d20 7b64 6973 636f 6e6e 6563 7465   vm {disconnecte
+000295d0: 645f 766d 7d22 290a 2020 2020 2020 2020  d_vm}").        
+000295e0: 6966 2064 6973 636f 6e6e 6563 7465 645f  if disconnected_
+000295f0: 7379 6e63 3a0a 2020 2020 2020 2020 2020  sync:.          
+00029600: 2020 7075 6c6c 5f73 6563 7265 7420 3d20    pull_secret = 
+00029610: 7077 645f 7061 7468 2864 6174 612e 6765  pwd_path(data.ge
+00029620: 7428 2770 756c 6c5f 7365 6372 6574 2729  t('pull_secret')
+00029630: 2920 6966 206e 6f74 2075 7073 7472 6561  ) if not upstrea
+00029640: 6d20 656c 7365 2066 227b 706c 616e 6469  m else f"{plandi
+00029650: 727d 2f66 616b 655f 7075 6c6c 2e6a 736f  r}/fake_pull.jso
+00029660: 6e22 0a20 2020 2020 2020 2020 2020 2069  n".            i
+00029670: 6620 6e6f 7420 7570 7374 7265 616d 3a0a  f not upstream:.
+00029680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029690: 7075 6c6c 5f73 6563 7265 7420 3d20 7077  pull_secret = pw
+000296a0: 645f 7061 7468 2864 6174 612e 6765 7428  d_path(data.get(
+000296b0: 2770 756c 6c5f 7365 6372 6574 272c 2027  'pull_secret', '
+000296c0: 6f70 656e 7368 6966 745f 7075 6c6c 2e6a  openshift_pull.j
+000296d0: 736f 6e27 2929 0a20 2020 2020 2020 2020  son')).         
+000296e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000296f0: 2020 2020 2020 2020 2070 756c 6c5f 7365           pull_se
+00029700: 6372 6574 203d 2066 227b 706c 616e 6469  cret = f"{plandi
+00029710: 727d 2f66 616b 655f 7075 6c6c 2e6a 736f  r}/fake_pull.jso
+00029720: 6e22 0a20 2020 2020 2020 2020 2020 2069  n".            i
+00029730: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+00029740: 6973 7473 2870 756c 6c5f 7365 6372 6574  ists(pull_secret
+00029750: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00029760: 2020 2065 7272 6f72 2866 224d 6973 7369     error(f"Missi
+00029770: 6e67 2070 756c 6c20 7365 6372 6574 2066  ng pull secret f
+00029780: 696c 6520 7b70 756c 6c5f 7365 6372 6574  ile {pull_secret
+00029790: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000297a0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+000297b0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000297c0: 5b27 7075 6c6c 5f73 6563 7265 7427 5d20  ['pull_secret'] 
+000297d0: 3d20 7265 2e73 7562 2872 225c 7322 2c20  = re.sub(r"\s", 
+000297e0: 2222 2c20 6f70 656e 2870 756c 6c5f 7365  "", open(pull_se
+000297f0: 6372 6574 292e 7265 6164 2829 290a 2020  cret).read()).  
+00029800: 2020 2020 2020 6469 7363 6f6e 6e65 6374        disconnect
+00029810: 6564 5f70 6c61 6e20 3d20 6622 7b70 6c61  ed_plan = f"{pla
+00029820: 6e7d 2d72 6575 7365 2220 6966 2064 6973  n}-reuse" if dis
+00029830: 636f 6e6e 6563 7465 645f 7265 7573 6520  connected_reuse 
+00029840: 656c 7365 2070 6c61 6e0a 2020 2020 2020  else plan.      
+00029850: 2020 6966 2076 6572 7369 6f6e 203d 3d20    if version == 
+00029860: 2763 6927 2061 6e64 2027 6469 7363 6f6e  'ci' and 'discon
+00029870: 6e65 6374 6564 5f6f 7269 6769 6e27 206e  nected_origin' n
+00029880: 6f74 2069 6e20 6f76 6572 7269 6465 733a  ot in overrides:
+00029890: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+000298a0: 203d 2027 7265 6769 7374 7279 2e62 7569   = 'registry.bui
+000298b0: 6c64 3031 2e63 692e 6f70 656e 7368 6966  ld01.ci.openshif
+000298c0: 742e 6f72 6727 2069 6620 7374 7228 7461  t.org' if str(ta
+000298d0: 6729 2e73 7461 7274 7377 6974 6828 2763  g).startswith('c
+000298e0: 692d 2729 2065 6c73 6520 2772 6567 6973  i-') else 'regis
+000298f0: 7472 792e 6369 2e6f 7065 6e73 6869 6674  try.ci.openshift
+00029900: 2e6f 7267 270a 2020 2020 2020 2020 2020  .org'.          
+00029910: 2020 7761 726e 696e 6728 6622 466f 7263    warning(f"Forc
+00029920: 696e 6720 6469 7363 6f6e 6e65 6374 6564  ing disconnected
+00029930: 5f6f 7269 6769 6e20 746f 207b 7265 677d  _origin to {reg}
+00029940: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
+00029950: 6174 615b 2764 6973 636f 6e6e 6563 7465  ata['disconnecte
+00029960: 645f 6f72 6967 696e 275d 203d 2072 6567  d_origin'] = reg
+00029970: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+00029980: 3d20 7365 6c66 2e70 6c61 6e28 6469 7363  = self.plan(disc
+00029990: 6f6e 6e65 6374 6564 5f70 6c61 6e2c 2069  onnected_plan, i
+000299a0: 6e70 7574 6669 6c65 3d66 277b 706c 616e  nputfile=f'{plan
+000299b0: 6469 727d 2f64 6973 636f 6e6e 6563 7465  dir}/disconnecte
+000299c0: 642e 796d 6c27 2c20 6f76 6572 7269 6465  d.yml', override
+000299d0: 733d 6461 7461 290a 2020 2020 2020 2020  s=data).        
+000299e0: 6966 2072 6573 756c 745b 2772 6573 756c  if result['resul
+000299f0: 7427 5d20 213d 2027 7375 6363 6573 7327  t'] != 'success'
+00029a00: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+00029a10: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00029a20: 2020 656c 6966 2064 6973 636f 6e6e 6563    elif disconnec
+00029a30: 7465 645f 7379 6e63 3a0a 2020 2020 2020  ted_sync:.      
+00029a40: 2020 2020 2020 7070 7269 6e74 2822 5573        pprint("Us
+00029a50: 6520 7468 6520 666f 6c6c 6f77 696e 6720  e the following 
+00029a60: 4f50 454e 5348 4946 545f 494e 5354 414c  OPENSHIFT_INSTAL
+00029a70: 4c5f 5245 4c45 4153 455f 494d 4147 455f  L_RELEASE_IMAGE_
+00029a80: 4f56 4552 5249 4445 2229 0a20 2020 2020  OVERRIDE").     
+00029a90: 2020 2020 2020 206e 616d 6520 3d20 6461         name = da
+00029aa0: 7461 2e67 6574 2827 6469 7363 6f6e 6e65  ta.get('disconne
+00029ab0: 6374 6564 5f72 6575 7365 5f6e 616d 6527  cted_reuse_name'
+00029ac0: 2920 6f72 2063 6c75 7374 6572 0a20 2020  ) or cluster.   
+00029ad0: 2020 2020 2020 2020 2069 702c 2076 6d70           ip, vmp
+00029ae0: 6f72 7420 3d20 5f73 7368 5f63 7265 6465  ort = _ssh_crede
+00029af0: 6e74 6961 6c73 2873 656c 662e 6b2c 2066  ntials(self.k, f
+00029b00: 277b 6e61 6d65 7d2d 6469 7363 6f6e 6e65  '{name}-disconne
+00029b10: 6374 6564 2729 5b31 3a5d 0a20 2020 2020  cted')[1:].     
+00029b20: 2020 2020 2020 2063 6d64 203d 2022 6361         cmd = "ca
+00029b30: 7420 2f72 6f6f 742f 7665 7273 696f 6e2e  t /root/version.
+00029b40: 7478 7422 0a20 2020 2020 2020 2020 2020  txt".           
+00029b50: 2073 7368 636d 6420 3d20 7373 6828 6e61   sshcmd = ssh(na
+00029b60: 6d65 2c20 6970 3d69 702c 2075 7365 723d  me, ip=ip, user=
+00029b70: 2772 6f6f 7427 2c20 7475 6e6e 656c 3d73  'root', tunnel=s
+00029b80: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
+00029b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ba0: 2020 2020 2074 756e 6e65 6c68 6f73 743d       tunnelhost=
+00029bb0: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
+00029bc0: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
+00029bd0: 2e74 756e 6e65 6c70 6f72 742c 0a20 2020  .tunnelport,.   
+00029be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029bf0: 2020 2020 2020 7475 6e6e 656c 7573 6572        tunneluser
+00029c00: 3d73 656c 662e 7475 6e6e 656c 7573 6572  =self.tunneluser
+00029c10: 2c20 696e 7365 6375 7265 3d54 7275 652c  , insecure=True,
+00029c20: 2063 6d64 3d63 6d64 2c20 766d 706f 7274   cmd=cmd, vmport
+00029c30: 3d76 6d70 6f72 7429 0a20 2020 2020 2020  =vmport).       
+00029c40: 2020 2020 206f 732e 7379 7374 656d 2873       os.system(s
+00029c50: 7368 636d 6429 0a0a 2020 2020 6465 6620  shcmd)..    def 
+00029c60: 6861 6e64 6c65 5f66 696e 6973 6866 696c  handle_finishfil
+00029c70: 6573 2873 656c 662c 206e 616d 652c 2066  es(self, name, f
+00029c80: 696e 6973 6866 696c 6573 2c20 6964 656e  inishfiles, iden
+00029c90: 7469 7479 6669 6c65 3d4e 6f6e 652c 2076  tityfile=None, v
+00029ca0: 6d63 6c69 656e 743d 4e6f 6e65 293a 0a20  mclient=None):. 
+00029cb0: 2020 2020 2020 2063 6f6e 6669 6720 3d20         config = 
+00029cc0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d76  Kconfig(client=v
+00029cd0: 6d63 6c69 656e 7429 2069 6620 766d 636c  mclient) if vmcl
+00029ce0: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+00029cf0: 2065 6c73 6520 7365 6c66 0a20 2020 2020   else self.     
+00029d00: 2020 206b 203d 2063 6f6e 6669 672e 6b0a     k = config.k.
+00029d10: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00029d20: 6970 203d 2063 6f6d 6d6f 6e2e 5f73 7368  ip = common._ssh
+00029d30: 5f63 7265 6465 6e74 6961 6c73 286b 2c20  _credentials(k, 
+00029d40: 6e61 6d65 295b 315d 0a20 2020 2020 2020  name)[1].       
+00029d50: 2066 6f72 2066 696e 6973 6866 696c 6520   for finishfile 
+00029d60: 696e 2066 696e 6973 6866 696c 6573 3a0a  in finishfiles:.
+00029d70: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00029d80: 7369 6e73 7461 6e63 6528 6669 6e69 7368  sinstance(finish
+00029d90: 6669 6c65 2c20 7374 7229 3a0a 2020 2020  file, str):.    
+00029da0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+00029db0: 696e 6174 696f 6e20 3d20 272e 270a 2020  ination = '.'.  
+00029dc0: 2020 2020 2020 2020 2020 2020 2020 736f                so
+00029dd0: 7572 6365 203d 2066 696e 6973 6866 696c  urce = finishfil
+00029de0: 6520 6966 2027 2f27 2069 6e20 6669 6e69  e if '/' in fini
+00029df0: 7368 6669 6c65 2065 6c73 6520 6627 2f72  shfile else f'/r
+00029e00: 6f6f 742f 7b66 696e 6973 6866 696c 657d  oot/{finishfile}
+00029e10: 270a 2020 2020 2020 2020 2020 2020 656c  '.            el
+00029e20: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
+00029e30: 6e69 7368 6669 6c65 2c20 6469 6374 2920  nishfile, dict) 
+00029e40: 616e 6420 276f 7269 6769 6e27 2069 6e20  and 'origin' in 
+00029e50: 6669 6e69 7368 6669 6c65 2061 6e64 2027  finishfile and '
+00029e60: 7061 7468 2720 696e 2066 696e 6973 6866  path' in finishf
+00029e70: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+00029e80: 2020 2020 2073 6f75 7263 652c 2064 6573       source, des
+00029e90: 7469 6e61 7469 6f6e 203d 2066 696e 6973  tination = finis
+00029ea0: 6866 696c 652e 6765 7428 276f 7269 6769  hfile.get('origi
+00029eb0: 6e27 292c 206f 732e 7061 7468 2e65 7870  n'), os.path.exp
+00029ec0: 616e 6475 7365 7228 6669 6e69 7368 6669  anduser(finishfi
+00029ed0: 6c65 2e67 6574 2827 7061 7468 272c 2027  le.get('path', '
+00029ee0: 2e27 2929 0a20 2020 2020 2020 2020 2020  .')).           
+00029ef0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00029f00: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+00029f10: 2249 6e63 6f72 7265 6374 2066 696e 6973  "Incorrect finis
+00029f20: 6866 696c 6520 656e 7472 7920 7b66 696e  hfile entry {fin
+00029f30: 6973 6866 696c 657d 2e20 536b 6970 7069  ishfile}. Skippi
+00029f40: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+00029f50: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00029f60: 2020 2020 2020 2020 2020 7363 7063 6d64            scpcmd
+00029f70: 203d 2063 6f6d 6d6f 6e2e 7363 7028 6e61   = common.scp(na
+00029f80: 6d65 2c20 6970 3d63 7572 7265 6e74 5f69  me, ip=current_i
+00029f90: 702c 2075 7365 723d 2772 6f6f 7427 2c20  p, user='root', 
+00029fa0: 736f 7572 6365 3d73 6f75 7263 652c 2064  source=source, d
+00029fb0: 6573 7469 6e61 7469 6f6e 3d64 6573 7469  estination=desti
+00029fc0: 6e61 7469 6f6e 2c0a 2020 2020 2020 2020  nation,.        
+00029fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029fe0: 2020 2020 2020 2020 7475 6e6e 656c 3d63          tunnel=c
+00029ff0: 6f6e 6669 672e 7475 6e6e 656c 2c20 7475  onfig.tunnel, tu
+0002a000: 6e6e 656c 686f 7374 3d63 6f6e 6669 672e  nnelhost=config.
+0002a010: 7475 6e6e 656c 686f 7374 2c20 7475 6e6e  tunnelhost, tunn
+0002a020: 656c 706f 7274 3d63 6f6e 6669 672e 7475  elport=config.tu
+0002a030: 6e6e 656c 706f 7274 2c0a 2020 2020 2020  nnelport,.      
+0002a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a050: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
+0002a060: 7573 6572 3d73 656c 662e 7475 6e6e 656c  user=self.tunnel
+0002a070: 7573 6572 2c20 646f 776e 6c6f 6164 3d54  user, download=T
+0002a080: 7275 652c 2069 6e73 6563 7572 653d 5472  rue, insecure=Tr
+0002a090: 7565 2c20 6964 656e 7469 7479 6669 6c65  ue, identityfile
+0002a0a0: 3d69 6465 6e74 6974 7966 696c 6529 0a20  =identityfile). 
+0002a0b0: 2020 2020 2020 2020 2020 206f 732e 7379             os.sy
+0002a0c0: 7374 656d 2873 6370 636d 6429 0a0a 2020  stem(scpcmd)..  
+0002a0d0: 2020 6465 6620 6861 6e64 6c65 5f6e 6f74    def handle_not
+0002a0e0: 6966 6963 6174 696f 6e73 2873 656c 662c  ifications(self,
+0002a0f0: 206e 616d 652c 206e 6f74 6966 796d 6574   name, notifymet
+0002a100: 686f 6473 3d5b 5d2c 2070 7573 6862 756c  hods=[], pushbul
+0002a110: 6c65 7474 6f6b 656e 3d4e 6f6e 652c 206e  lettoken=None, n
+0002a120: 6f74 6966 7973 6372 6970 743d 4e6f 6e65  otifyscript=None
+0002a130: 2c20 6e6f 7469 6679 636d 643d 4e6f 6e65  , notifycmd=None
+0002a140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002a150: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002a160: 6c61 636b 6368 616e 6e65 6c3d 4e6f 6e65  lackchannel=None
+0002a170: 2c20 736c 6163 6b74 6f6b 656e 3d4e 6f6e  , slacktoken=Non
+0002a180: 652c 206d 6169 6c73 6572 7665 723d 4e6f  e, mailserver=No
+0002a190: 6e65 2c20 6d61 696c 6672 6f6d 3d4e 6f6e  ne, mailfrom=Non
+0002a1a0: 652c 206d 6169 6c74 6f3d 4e6f 6e65 2c0a  e, mailto=None,.
+0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1c0: 2020 2020 2020 2020 2020 2020 2063 6c75               clu
+0002a1d0: 7374 6572 3d46 616c 7365 293a 0a20 2020  ster=False):.   
+0002a1e0: 2020 2020 205f 7479 7065 203d 2027 436c       _type = 'Cl
+0002a1f0: 7573 7465 7227 2069 6620 636c 7573 7465  uster' if cluste
+0002a200: 7220 656c 7365 2027 566d 270a 2020 2020  r else 'Vm'.    
+0002a210: 2020 2020 7469 746c 6520 3d20 6622 7b5f      title = f"{_
+0002a220: 7479 7065 7d20 7b6e 616d 657d 206f 6e20  type} {name} on 
+0002a230: 7b73 656c 662e 636c 6965 6e74 7d20 7265  {self.client} re
+0002a240: 706f 7274 220a 2020 2020 2020 2020 636d  port".        cm
+0002a250: 6473 2c20 6d61 696c 636f 6e74 656e 7420  ds, mailcontent 
+0002a260: 3d20 5b5d 2c20 4e6f 6e65 0a20 2020 2020  = [], None.     
+0002a270: 2020 2066 6f72 206e 6f74 6966 796d 6574     for notifymet
+0002a280: 686f 6420 696e 2073 6f72 7465 6428 6e6f  hod in sorted(no
+0002a290: 7469 6679 6d65 7468 6f64 732c 2072 6576  tifymethods, rev
+0002a2a0: 6572 7365 3d54 7275 6529 3a0a 2020 2020  erse=True):.    
+0002a2b0: 2020 2020 2020 2020 6966 206e 6f74 6966          if notif
+0002a2c0: 796d 6574 686f 6420 3d3d 2027 7075 7368  ymethod == 'push
+0002a2d0: 6275 6c6c 6574 273a 0a20 2020 2020 2020  bullet':.       
+0002a2e0: 2020 2020 2020 2020 2069 6620 7075 7368           if push
+0002a2f0: 6275 6c6c 6574 746f 6b65 6e20 6973 204e  bullettoken is N
+0002a300: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002a310: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0002a320: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
+0002a330: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
+0002a340: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
+0002a350: 7075 7368 6275 6c6c 6574 746f 6b65 6e22  pushbullettoken"
+0002a360: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002a370: 2020 656c 6966 206e 6f74 6966 7973 6372    elif notifyscr
+0002a380: 6970 7420 6973 204e 6f6e 6520 616e 6420  ipt is None and 
+0002a390: 6e6f 7469 6679 636d 6420 6973 204e 6f6e  notifycmd is Non
+0002a3a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a3b0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0002a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a3d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002a3e0: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
+0002a3f0: 3d20 7075 7368 6275 6c6c 6574 746f 6b65  = pushbullettoke
+0002a400: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0002a410: 2020 2020 2020 7062 636d 6420 3d20 2763        pbcmd = 'c
+0002a420: 7572 6c20 2d73 7520 2225 733a 2220 2d64  url -su "%s:" -d
+0002a430: 2074 7970 653d 226e 6f74 6522 202d 6420   type="note" -d 
+0002a440: 626f 6479 3d22 6025 7320 323e 2631 6022  body="`%s 2>&1`"
+0002a450: 202d 6420 7469 746c 653d 2225 7322 2027   -d title="%s" '
+0002a460: 2025 2028 746f 6b65 6e2c 0a20 2020 2020   % (token,.     
+0002a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4c0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0002a4d0: 6966 7963 6d64 2c0a 2020 2020 2020 2020  ifycmd,.        
+0002a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a530: 2020 2020 2020 2020 2020 7469 746c 6529            title)
+0002a540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a550: 2020 2020 2070 6263 6d64 202b 3d20 2768       pbcmd += 'h
+0002a560: 7474 7073 3a2f 2f61 7069 2e70 7573 6862  ttps://api.pushb
+0002a570: 756c 6c65 742e 636f 6d2f 7632 2f70 7573  ullet.com/v2/pus
+0002a580: 6865 7327 0a20 2020 2020 2020 2020 2020  hes'.           
+0002a590: 2020 2020 2020 2020 2063 6d64 732e 6170           cmds.ap
+0002a5a0: 7065 6e64 2870 6263 6d64 290a 2020 2020  pend(pbcmd).    
+0002a5b0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+0002a5c0: 6966 796d 6574 686f 6420 3d3d 2027 736c  ifymethod == 'sl
+0002a5d0: 6163 6b27 3a0a 2020 2020 2020 2020 2020  ack':.          
+0002a5e0: 2020 2020 2020 6966 2073 6c61 636b 6368        if slackch
+0002a5f0: 616e 6e65 6c20 6973 204e 6f6e 653a 0a20  annel is None:. 
+0002a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a610: 2020 2077 6172 6e69 6e67 2866 224e 6f74     warning(f"Not
+0002a620: 6966 6963 6174 696f 6e20 7265 7175 6972  ification requir
+0002a630: 6564 2066 6f72 207b 6e61 6d65 7d20 6275  ed for {name} bu
+0002a640: 7420 6d69 7373 696e 6720 736c 6163 6b20  t missing slack 
+0002a650: 6368 616e 6e65 6c22 290a 2020 2020 2020  channel").      
+0002a660: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+0002a670: 6c61 636b 746f 6b65 6e20 6973 204e 6f6e  lacktoken is Non
+0002a680: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a690: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0002a6a0: 224e 6f74 6966 6963 6174 696f 6e20 7265  "Notification re
+0002a6b0: 7175 6972 6564 2066 6f72 207b 6e61 6d65  quired for {name
+0002a6c0: 7d20 6275 7420 6d69 7373 696e 6720 736c  } but missing sl
+0002a6d0: 6163 6b74 6f6b 656e 2229 0a20 2020 2020  acktoken").     
+0002a6e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002a6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a700: 2020 2020 2073 6c61 636b 636d 6420 3d20       slackcmd = 
+0002a710: 6622 696e 666f 3d60 7b6e 6f74 6966 7963  f"info=`{notifyc
+0002a720: 6d64 7d20 323e 2631 207c 2073 6564 2027  md} 2>&1 | sed '
+0002a730: 732f 5c5c 7832 2f20 2f67 2760 3b22 0a20  s/\\x2/ /g'`;". 
+0002a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a750: 2020 2073 6c61 636b 636d 6420 2b3d 2022     slackcmd += "
+0002a760: 2222 6375 726c 202d 5820 504f 5354 202d  ""curl -X POST -
+0002a770: 4820 2741 7574 686f 7269 7a61 7469 6f6e  H 'Authorization
+0002a780: 3a20 4265 6172 6572 2025 7327 0a20 2d48  : Bearer %s'. -H
+0002a790: 2027 436f 6e74 656e 742d 7479 7065 3a20   'Content-type: 
+0002a7a0: 6170 706c 6963 6174 696f 6e2f 6a73 6f6e  application/json
+0002a7b0: 3b20 6368 6172 7365 743d 7574 662d 3827  ; charset=utf-8'
+0002a7c0: 0a20 2d2d 6461 7461 2027 7b22 6368 616e  . --data '{"chan
+0002a7d0: 6e65 6c22 3a22 2573 222c 2274 6578 7422  nel":"%s","text"
+0002a7e0: 3a22 2573 222c 2261 7474 6163 686d 656e  :"%s","attachmen
+0002a7f0: 7473 223a 205b 7b22 7465 7874 223a 2227  ts": [{"text":"'
+0002a800: 2224 696e 666f 2227 222c 2266 616c 6c62  "$info"'","fallb
+0002a810: 6163 6b22 3a22 6e6f 7468 696e 6722 2c0a  ack":"nothing",.
+0002a820: 2263 6f6c 6f72 223a 2223 3341 4133 4533  "color":"#3AA3E3
+0002a830: 222c 2261 7474 6163 686d 656e 745f 7479  ","attachment_ty
+0002a840: 7065 223a 2264 6566 6175 6c74 227d 5d7d  pe":"default"}]}
+0002a850: 2720 6874 7470 733a 2f2f 736c 6163 6b2e  ' https://slack.
+0002a860: 636f 6d2f 6170 692f 6368 6174 2e70 6f73  com/api/chat.pos
+0002a870: 744d 6573 7361 6765 2222 2220 2520 2873  tMessage""" % (s
+0002a880: 6c61 636b 746f 6b65 6e2c 0a20 2020 2020  lacktoken,.     
+0002a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8e0: 2020 2020 2020 2020 2020 736c 6163 6b63            slackc
+0002a8f0: 6861 6e6e 656c 2c20 7469 746c 6529 0a20  hannel, title). 
+0002a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a910: 2020 2073 6c61 636b 636d 6420 3d20 736c     slackcmd = sl
+0002a920: 6163 6b63 6d64 2e72 6570 6c61 6365 2827  ackcmd.replace('
+0002a930: 5c6e 272c 2027 2729 0a20 2020 2020 2020  \n', '').       
+0002a940: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+0002a950: 732e 6170 7065 6e64 2873 6c61 636b 636d  s.append(slackcm
+0002a960: 6429 0a20 2020 2020 2020 2020 2020 2065  d).            e
+0002a970: 6c69 6620 6e6f 7469 6679 6d65 7468 6f64  lif notifymethod
+0002a980: 203d 3d20 276d 6169 6c27 3a0a 2020 2020   == 'mail':.    
+0002a990: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+0002a9a0: 6169 6c73 6572 7665 7220 6973 204e 6f6e  ailserver is Non
+0002a9b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002a9c0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0002a9d0: 224e 6f74 6966 6963 6174 696f 6e20 7265  "Notification re
+0002a9e0: 7175 6972 6564 2066 6f72 207b 6e61 6d65  quired for {name
+0002a9f0: 7d20 6275 7420 6d69 7373 696e 6720 6d61  } but missing ma
+0002aa00: 696c 7365 7276 6572 2229 0a20 2020 2020  ilserver").     
+0002aa10: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0002aa20: 6d61 696c 6672 6f6d 2069 7320 4e6f 6e65  mailfrom is None
+0002aa30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002aa40: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0002aa50: 4e6f 7469 6669 6361 7469 6f6e 2072 6571  Notification req
+0002aa60: 7569 7265 6420 666f 7220 7b6e 616d 657d  uired for {name}
+0002aa70: 2062 7574 206d 6973 7369 6e67 206d 6169   but missing mai
+0002aa80: 6c66 726f 6d22 290a 2020 2020 2020 2020  lfrom").        
+0002aa90: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+0002aaa0: 206d 6169 6c74 6f3a 0a20 2020 2020 2020   mailto:.       
+0002aab0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0002aac0: 6e69 6e67 2866 224e 6f74 6966 6963 6174  ning(f"Notificat
+0002aad0: 696f 6e20 7265 7175 6972 6564 2066 6f72  ion required for
+0002aae0: 207b 6e61 6d65 7d20 6275 7420 6d69 7373   {name} but miss
+0002aaf0: 696e 6720 6d61 696c 746f 2229 0a20 2020  ing mailto").   
+0002ab00: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0002ab10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002ab20: 2020 2020 2020 206e 6f77 203d 2064 6174         now = dat
+0002ab30: 6574 696d 652e 6e6f 7728 290a 2020 2020  etime.now().    
+0002ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab50: 6e6f 7720 3d20 6e6f 772e 2073 7472 6674  now = now. strft
+0002ab60: 696d 6528 2225 612c 2564 2025 6220 2559  ime("%a,%d %b %Y
+0002ab70: 2025 483a 254d 3a25 5322 290a 2020 2020   %H:%M:%S").    
+0002ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab90: 746f 7320 3d20 272c 272e 6a6f 696e 285b  tos = ','.join([
+0002aba0: 6622 3c7b 746f 7d3e 2220 666f 7220 746f  f"<{to}>" for to
+0002abb0: 2069 6e20 6d61 696c 746f 5d29 0a20 2020   in mailto]).   
+0002abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002abd0: 206d 6169 6c63 6f6e 7465 6e74 203d 2066   mailcontent = f
+0002abe0: 2246 726f 6d3a 207b 6d61 696c 6672 6f6d  "From: {mailfrom
+0002abf0: 7d20 3c7b 6d61 696c 6672 6f6d 7d3e 5c6e  } <{mailfrom}>\n
+0002ac00: 546f 3a20 7b74 6f73 7d5c 6e44 6174 653a  To: {tos}\nDate:
+0002ac10: 207b 6e6f 777d 5c6e 5375 626a 6563 743a   {now}\nSubject:
+0002ac20: 207b 7469 746c 657d 220a 2020 2020 2020   {title}".      
+0002ac30: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0002ac40: 696c 636d 6420 3d20 5b5d 0a20 2020 2020  ilcmd = [].     
+0002ac50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002ac60: 6620 6e6f 7420 636c 7573 7465 723a 0a20  f not cluster:. 
+0002ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac80: 2020 2020 2020 206d 6169 6c63 6d64 2e61         mailcmd.a
+0002ac90: 7070 656e 6428 2774 6573 7420 2d66 202f  ppend('test -f /
+0002aca0: 6574 632f 6465 6269 616e 5f76 6572 7369  etc/debian_versi
+0002acb0: 6f6e 2026 2620 6170 742d 6765 7420 2d79  on && apt-get -y
+0002acc0: 2069 6e73 7461 6c6c 2063 7572 6c27 290a   install curl').
+0002acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ace0: 2020 2020 2020 2020 6d61 696c 636d 642e          mailcmd.
+0002acf0: 6170 7065 6e64 2827 6563 686f 2022 2220  append('echo "" 
+0002ad00: 3e3e 202f 7661 722f 746d 702f 6d61 696c  >> /var/tmp/mail
+0002ad10: 2e74 7874 2729 0a20 2020 2020 2020 2020  .txt').         
+0002ad20: 2020 2020 2020 2020 2020 206d 6169 6c63             mailc
+0002ad30: 6d64 2e61 7070 656e 6428 6627 7b6e 6f74  md.append(f'{not
+0002ad40: 6966 7963 6d64 7d20 323e 2631 203e 3e20  ifycmd} 2>&1 >> 
+0002ad50: 2f76 6172 2f74 6d70 2f6d 6169 6c2e 7478  /var/tmp/mail.tx
+0002ad60: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+0002ad70: 2020 2020 2020 2020 6375 726c 636d 6420          curlcmd 
+0002ad80: 3d20 6622 6375 726c 202d 2d73 696c 656e  = f"curl --silen
+0002ad90: 7420 2d2d 7572 6c20 736d 7470 3a2f 2f7b  t --url smtp://{
+0002ada0: 6d61 696c 7365 7276 6572 7d3a 3235 202d  mailserver}:25 -
+0002adb0: 2d6d 6169 6c2d 6672 6f6d 207b 6d61 696c  -mail-from {mail
+0002adc0: 6672 6f6d 7d22 0a20 2020 2020 2020 2020  from}".         
+0002add0: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+0002ade0: 6464 7265 7373 2069 6e20 6d61 696c 746f  ddress in mailto
+0002adf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002ae00: 2020 2020 2020 2020 2020 6375 726c 636d            curlcm
+0002ae10: 6420 2b3d 2066 2220 2d2d 6d61 696c 2d72  d += f" --mail-r
+0002ae20: 6370 7420 7b61 6464 7265 7373 7d20 220a  cpt {address} ".
+0002ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae40: 2020 2020 6966 2063 6c75 7374 6572 3a0a      if cluster:.
+0002ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae60: 2020 2020 2020 2020 6d61 696c 636f 6e74          mailcont
+0002ae70: 656e 7420 3d20 2222 0a20 2020 2020 2020  ent = "".       
+0002ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae90: 206b 7562 6563 6f6e 6669 6720 3d20 6627   kubeconfig = f'
+0002aea0: 2f65 7463 2f6b 7562 6572 6e65 7465 732f  /etc/kubernetes/
+0002aeb0: 6b75 6265 636f 6e66 6967 2e7b 6e61 6d65  kubeconfig.{name
+0002aec0: 7d27 0a20 2020 2020 2020 2020 2020 2020  }'.             
+0002aed0: 2020 2020 2020 2020 2020 2063 7572 6c63             curlc
+0002aee0: 6d64 202b 3d20 6627 202d 4820 2253 7562  md += f' -H "Sub
+0002aef0: 6a65 6374 3a20 7b74 6974 6c65 7d22 202d  ject: {title}" -
+0002af00: 4820 2246 726f 6d3a 207b 6d61 696c 6672  H "From: {mailfr
+0002af10: 6f6d 7d20 3c7b 6d61 696c 6672 6f6d 7d3e  om} <{mailfrom}>
+0002af20: 2227 0a20 2020 2020 2020 2020 2020 2020  "'.             
+0002af30: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+0002af40: 6464 7265 7373 2069 6e20 6d61 696c 746f  ddress in mailto
+0002af50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002af60: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0002af70: 726c 636d 6420 2b3d 2066 2720 2d48 2022  rlcmd += f' -H "
+0002af80: 546f 3a20 7b61 6464 7265 7373 7d20 3c7b  To: {address} <{
+0002af90: 6164 6472 6573 737d 3e22 270a 2020 2020  address}>"'.    
+0002afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002afb0: 2020 2020 6375 726c 636d 6420 2b3d 2027      curlcmd += '
+0002afc0: 202d 4620 223d 283b 7479 7065 3d6d 756c   -F "=(;type=mul
+0002afd0: 7469 7061 7274 2f6d 6978 6564 2220 2d46  tipart/mixed" -F
+0002afe0: 2022 3d24 2863 6174 202f 7661 722f 746d   "=$(cat /var/tm
+0002aff0: 702f 6d61 696c 2e74 7874 293b 7479 7065  p/mail.txt);type
+0002b000: 3d74 6578 742f 706c 6169 6e22 270a 2020  =text/plain"'.  
+0002b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b020: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
+0002b030: 2066 2720 2d46 2022 6669 6c65 3d40 7b6b   f' -F "file=@{k
+0002b040: 7562 6563 6f6e 6669 677d 3b74 7970 653d  ubeconfig};type=
+0002b050: 7465 7874 2f70 6c61 696e 3b65 6e63 6f64  text/plain;encod
+0002b060: 6572 3d62 6173 6536 3422 202d 4620 223d  er=base64" -F "=
+0002b070: 2922 270a 2020 2020 2020 2020 2020 2020  )"'.            
+0002b080: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b0a0: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
+0002b0b0: 2022 202d 2d75 706c 6f61 642d 6669 6c65   " --upload-file
+0002b0c0: 202f 7661 722f 746d 702f 6d61 696c 2e74   /var/tmp/mail.t
+0002b0d0: 7874 220a 2020 2020 2020 2020 2020 2020  xt".            
+0002b0e0: 2020 2020 2020 2020 6d61 696c 636d 642e          mailcmd.
+0002b0f0: 6170 7065 6e64 2863 7572 6c63 6d64 290a  append(curlcmd).
+0002b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b110: 2020 2020 636d 6473 2e65 7874 656e 6428      cmds.extend(
+0002b120: 6d61 696c 636d 6429 0a20 2020 2020 2020  mailcmd).       
+0002b130: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002b140: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0002b150: 2866 2249 6e76 616c 6964 206d 6574 686f  (f"Invalid metho
+0002b160: 6420 7b6e 6f74 6966 796d 6574 686f 647d  d {notifymethod}
+0002b170: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+0002b180: 6e20 636d 6473 2c20 6d61 696c 636f 6e74  n cmds, mailcont
+0002b190: 656e 740a 0a20 2020 2064 6566 2068 616e  ent..    def han
+0002b1a0: 646c 655f 766d 5f72 6573 756c 7428 7365  dle_vm_result(se
+0002b1b0: 6c66 2c20 6e61 6d65 2c20 7072 6f66 696c  lf, name, profil
+0002b1c0: 652c 2072 6573 756c 742c 206e 6577 766d  e, result, newvm
+0002b1d0: 732c 2066 6169 6c65 6476 6d73 2c20 6173  s, failedvms, as
+0002b1e0: 796e 6377 6169 7476 6d73 2c20 6f6e 6c79  yncwaitvms, only
+0002b1f0: 6173 7365 7473 3d46 616c 7365 2c20 6e65  assets=False, ne
+0002b200: 7761 7373 6574 733d 5b5d 2c0a 2020 2020  wassets=[],.    
+0002b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b220: 2020 2020 2076 6d63 6c69 656e 743d 4e6f       vmclient=No
+0002b230: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
+0002b240: 2772 6573 756c 7427 2069 6e20 7265 7375  'result' in resu
+0002b250: 6c74 2061 6e64 2072 6573 756c 745b 2772  lt and result['r
+0002b260: 6573 756c 7427 5d20 3d3d 2027 7375 6363  esult'] == 'succ
+0002b270: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
+0002b280: 2020 6e65 7776 6d73 2e61 7070 656e 6428    newvms.append(
+0002b290: 6e61 6d65 290a 2020 2020 2020 2020 656c  name).        el
+0002b2a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002b2b0: 6661 696c 6564 766d 732e 6170 7065 6e64  failedvms.append
+0002b2c0: 287b 276e 616d 6527 3a20 6e61 6d65 2c20  ({'name': name, 
+0002b2d0: 2772 6561 736f 6e27 3a20 7265 7375 6c74  'reason': result
+0002b2e0: 5b27 7265 6173 6f6e 275d 7d29 0a20 2020  ['reason']}).   
+0002b2f0: 2020 2020 2073 7461 7274 203d 2070 726f       start = pro
+0002b300: 6669 6c65 2e67 6574 2827 7374 6172 7427  file.get('start'
+0002b310: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+0002b320: 636c 6f75 6469 6e69 7420 3d20 7072 6f66  cloudinit = prof
+0002b330: 696c 652e 6765 7428 2763 6c6f 7564 696e  ile.get('cloudin
+0002b340: 6974 272c 2054 7275 6529 0a20 2020 2020  it', True).     
+0002b350: 2020 2061 7379 6e63 7761 6974 203d 2070     asyncwait = p
+0002b360: 726f 6669 6c65 2e67 6574 2827 6173 796e  rofile.get('asyn
+0002b370: 6377 6169 7427 2c20 4661 6c73 6529 0a20  cwait', False). 
+0002b380: 2020 2020 2020 2066 696e 6973 6866 696c         finishfil
+0002b390: 6573 203d 2070 726f 6669 6c65 2e67 6574  es = profile.get
+0002b3a0: 2827 6669 6e69 7368 6669 6c65 7327 2c20  ('finishfiles', 
+0002b3b0: 5b5d 290a 2020 2020 2020 2020 6966 206f  []).        if o
+0002b3c0: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
+0002b3d0: 2020 2020 2020 2069 6620 2764 6174 6127         if 'data'
+0002b3e0: 2069 6e20 7265 7375 6c74 3a0a 2020 2020   in result:.    
+0002b3f0: 2020 2020 2020 2020 2020 2020 6e65 7761              newa
+0002b400: 7373 6574 732e 6170 7065 6e64 2872 6573  ssets.append(res
+0002b410: 756c 745b 2764 6174 6127 5d29 0a20 2020  ult['data']).   
+0002b420: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002b430: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002b440: 7272 6f72 2872 6573 756c 745b 2772 6561  rror(result['rea
+0002b450: 736f 6e27 5d29 0a20 2020 2020 2020 2069  son']).        i
+0002b460: 6620 6e6f 7420 6173 796e 6377 6169 743a  f not asyncwait:
+0002b470: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002b480: 7572 6e0a 2020 2020 2020 2020 656c 6966  urn.        elif
+0002b490: 206e 6f74 2073 7461 7274 206f 7220 6e6f   not start or no
+0002b4a0: 7420 636c 6f75 6469 6e69 7420 6f72 2070  t cloudinit or p
+0002b4b0: 726f 6669 6c65 2e67 6574 2827 696d 6167  rofile.get('imag
+0002b4c0: 6527 2920 6973 204e 6f6e 653a 0a20 2020  e') is None:.   
+0002b4d0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0002b4e0: 6622 536b 6970 7069 6e67 2077 6169 7420  f"Skipping wait 
+0002b4f0: 6f6e 207b 6e61 6d65 7d22 290a 2020 2020  on {name}").    
+0002b500: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002b510: 2020 2020 2020 7761 6974 636f 6d6d 616e        waitcomman
+0002b520: 6420 3d20 7072 6f66 696c 652e 6765 7428  d = profile.get(
+0002b530: 2777 6169 7463 6f6d 6d61 6e64 2729 0a20  'waitcommand'). 
+0002b540: 2020 2020 2020 2020 2020 2077 6169 7474             waitt
+0002b550: 696d 656f 7574 203d 2070 726f 6669 6c65  imeout = profile
+0002b560: 2e67 6574 2827 7761 6974 7469 6d65 6f75  .get('waittimeou
+0002b570: 7427 2c20 3029 0a20 2020 2020 2020 2020  t', 0).         
+0002b580: 2020 2061 7379 6e63 7761 6974 766d 203d     asyncwaitvm =
+0002b590: 207b 276e 616d 6527 3a20 6e61 6d65 2c20   {'name': name, 
+0002b5a0: 2766 696e 6973 6866 696c 6573 273a 2066  'finishfiles': f
+0002b5b0: 696e 6973 6866 696c 6573 2c20 2777 6169  inishfiles, 'wai
+0002b5c0: 7463 6f6d 6d61 6e64 273a 2077 6169 7463  tcommand': waitc
+0002b5d0: 6f6d 6d61 6e64 2c0a 2020 2020 2020 2020  ommand,.        
+0002b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5f0: 2020 2027 7761 6974 7469 6d65 6f75 7427     'waittimeout'
+0002b600: 3a20 7761 6974 7469 6d65 6f75 742c 2027  : waittimeout, '
+0002b610: 766d 636c 6965 6e74 273a 2076 6d63 6c69  vmclient': vmcli
+0002b620: 656e 747d 0a20 2020 2020 2020 2020 2020  ent}.           
+0002b630: 2061 7379 6e63 7761 6974 766d 732e 6170   asyncwaitvms.ap
+0002b640: 7065 6e64 2861 7379 6e63 7761 6974 766d  pend(asyncwaitvm
+0002b650: 290a 0a20 2020 2064 6566 2074 6872 6561  )..    def threa
+0002b660: 6465 645f 6372 6561 7465 5f76 6d28 7365  ded_create_vm(se
+0002b670: 6c66 2c20 6e61 6d65 2c20 7072 6f66 696c  lf, name, profil
+0002b680: 656e 616d 652c 2063 7572 7265 6e74 6f76  ename, currentov
+0002b690: 6572 7269 6465 732c 2070 726f 6669 6c65  errides, profile
+0002b6a0: 2c20 7a2c 2070 6c61 6e2c 2063 7572 7265  , z, plan, curre
+0002b6b0: 6e74 706c 616e 6469 722c 2076 6d63 6c69  ntplandir, vmcli
+0002b6c0: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+0002b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b6e0: 6f6e 666c 792c 206f 6e6c 7961 7373 6574  onfly, onlyasset
+0002b6f0: 732c 206e 6577 766d 732c 2066 6169 6c65  s, newvms, faile
+0002b700: 6476 6d73 2c20 6173 796e 6377 6169 7476  dvms, asyncwaitv
+0002b710: 6d73 2c20 6e65 7761 7373 6574 7329 3a0a  ms, newassets):.
+0002b720: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002b730: 2073 656c 662e 6372 6561 7465 5f76 6d28   self.create_vm(
+0002b740: 6e61 6d65 2c20 7072 6f66 696c 656e 616d  name, profilenam
+0002b750: 652c 206f 7665 7272 6964 6573 3d63 7572  e, overrides=cur
+0002b760: 7265 6e74 6f76 6572 7269 6465 732c 2063  rentoverrides, c
+0002b770: 7573 746f 6d70 726f 6669 6c65 3d70 726f  ustomprofile=pro
+0002b780: 6669 6c65 2c20 6b3d 7a2c 0a20 2020 2020  file, k=z,.     
+0002b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b7a0: 2020 2020 2020 2020 2020 2070 6c61 6e3d             plan=
+0002b7b0: 706c 616e 2c20 6261 7365 6469 723d 6375  plan, basedir=cu
+0002b7c0: 7272 656e 7470 6c61 6e64 6972 2c20 636c  rrentplandir, cl
+0002b7d0: 6965 6e74 3d76 6d63 6c69 656e 742c 206f  ient=vmclient, o
+0002b7e0: 6e66 6c79 3d6f 6e66 6c79 2c0a 2020 2020  nfly=onfly,.    
+0002b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b800: 2020 2020 2020 2020 2020 2020 6f6e 6c79              only
+0002b810: 6173 7365 7473 3d6f 6e6c 7961 7373 6574  assets=onlyasset
+0002b820: 7329 0a20 2020 2020 2020 2069 6620 6e6f  s).        if no
+0002b830: 7420 6f6e 6c79 6173 7365 7473 3a0a 2020  t onlyassets:.  
+0002b840: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+0002b850: 2e68 616e 646c 655f 7265 7370 6f6e 7365  .handle_response
+0002b860: 2872 6573 756c 742c 206e 616d 652c 2063  (result, name, c
+0002b870: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
+0002b880: 2020 2020 2020 2020 7365 6c66 2e68 616e          self.han
+0002b890: 646c 655f 766d 5f72 6573 756c 7428 6e61  dle_vm_result(na
+0002b8a0: 6d65 2c20 7072 6f66 696c 652c 2072 6573  me, profile, res
+0002b8b0: 756c 743d 7265 7375 6c74 2c20 6e65 7776  ult=result, newv
+0002b8c0: 6d73 3d6e 6577 766d 732c 2066 6169 6c65  ms=newvms, faile
+0002b8d0: 6476 6d73 3d66 6169 6c65 6476 6d73 2c0a  dvms=failedvms,.
+0002b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b8f0: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0002b900: 796e 6377 6169 7476 6d73 3d61 7379 6e63  yncwaitvms=async
+0002b910: 7761 6974 766d 732c 206f 6e6c 7961 7373  waitvms, onlyass
+0002b920: 6574 733d 6f6e 6c79 6173 7365 7473 2c20  ets=onlyassets, 
+0002b930: 6e65 7761 7373 6574 733d 6e65 7761 7373  newassets=newass
+0002b940: 6574 732c 2076 6d63 6c69 656e 743d 766d  ets, vmclient=vm
+0002b950: 636c 6965 6e74 290a 0a20 2020 2064 6566  client)..    def
+0002b960: 2070 6172 7365 5f66 696c 6573 2873 656c   parse_files(sel
+0002b970: 662c 206e 616d 652c 2066 696c 6573 2c20  f, name, files, 
+0002b980: 6261 7365 6469 723d 272e 272c 206f 6e66  basedir='.', onf
+0002b990: 6c79 3d4e 6f6e 6529 3a0a 2020 2020 2020  ly=None):.      
+0002b9a0: 2020 6966 206e 6f74 2066 696c 6573 3a0a    if not files:.
+0002b9b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002b9c0: 726e 0a20 2020 2020 2020 2066 6f72 2069  rn.        for i
+0002b9d0: 6e64 6578 2c20 6669 6c20 696e 2065 6e75  ndex, fil in enu
+0002b9e0: 6d65 7261 7465 2866 696c 6573 293a 0a20  merate(files):. 
+0002b9f0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0002ba00: 696e 7374 616e 6365 2866 696c 2c20 7374  instance(fil, st
+0002ba10: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0002ba20: 2020 2020 7061 7468 203d 2066 222f 726f      path = f"/ro
+0002ba30: 6f74 2f7b 6669 6c7d 220a 2020 2020 2020  ot/{fil}".      
+0002ba40: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
+0002ba50: 6564 6972 2021 3d20 272e 273a 0a20 2020  edir != '.':.   
+0002ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ba70: 206f 7269 6769 6e20 3d20 6622 7b62 6173   origin = f"{bas
+0002ba80: 6564 6972 7d2f 7b70 6174 687d 220a 2020  edir}/{path}".  
+0002ba90: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0002baa0: 6967 696e 203d 2066 696c 0a20 2020 2020  igin = fil.     
+0002bab0: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
+0002bac0: 6e74 203d 204e 6f6e 650a 2020 2020 2020  nt = None.      
+0002bad0: 2020 2020 2020 2020 2020 6669 6c65 735b            files[
+0002bae0: 696e 6465 785d 203d 207b 2770 6174 6827  index] = {'path'
+0002baf0: 3a20 7061 7468 2c20 276f 7269 6769 6e27  : path, 'origin'
+0002bb00: 3a20 6f72 6967 696e 7d0a 2020 2020 2020  : origin}.      
+0002bb10: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0002bb20: 7461 6e63 6528 6669 6c2c 2064 6963 7429  tance(fil, dict)
+0002bb30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002bb40: 2020 6f72 6967 696e 203d 2066 696c 2e67    origin = fil.g
+0002bb50: 6574 2827 6f72 6967 696e 2729 0a20 2020  et('origin').   
+0002bb60: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0002bb70: 7465 6e74 203d 2066 696c 2e67 6574 2827  tent = fil.get('
+0002bb80: 636f 6e74 656e 7427 290a 2020 2020 2020  content').      
+0002bb90: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+0002bba0: 2066 696c 2e67 6574 2827 7061 7468 2729   fil.get('path')
+0002bbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bbc0: 2069 6620 7061 7468 2069 7320 4e6f 6e65   if path is None
+0002bbd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002bbe0: 2020 2020 2020 6966 206f 7269 6769 6e20        if origin 
+0002bbf0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0002bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc10: 2020 2020 2066 696c 6573 5b69 6e64 6578       files[index
+0002bc20: 5d5b 2770 6174 6827 5d20 3d20 6622 2f72  ]['path'] = f"/r
+0002bc30: 6f6f 742f 7b6f 7269 6769 6e7d 220a 2020  oot/{origin}".  
+0002bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc70: 6572 726f 7228 6622 496e 636f 7272 6563  error(f"Incorrec
+0002bc80: 7420 656e 7472 7920 7b66 696c 7d2e 4c65  t entry {fil}.Le
+0002bc90: 6176 696e 672e 2e2e 2229 0a20 2020 2020  aving...").     
+0002bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bcb0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+0002bcc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002bcd0: 6c69 6620 6e6f 7420 7061 7468 2e73 7461  lif not path.sta
+0002bce0: 7274 7377 6974 6828 272f 2729 3a0a 2020  rtswith('/'):.  
+0002bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd00: 2020 6572 726f 7228 6622 496e 636f 7272    error(f"Incorr
+0002bd10: 6563 7420 7061 7468 207b 7061 7468 7d2e  ect path {path}.
+0002bd20: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
 0002bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd40: 2066 696c 6573 5b69 6e64 6578 5d5b 2770   files[index]['p
-0002bd50: 6174 6827 5d20 3d20 6622 2f72 6f6f 742f  ath'] = f"/root/
-0002bd60: 7b6f 7269 6769 6e7d 220a 2020 2020 2020  {origin}".      
-0002bd70: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002bd80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002bd90: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-0002bda0: 7228 6622 496e 636f 7272 6563 7420 656e  r(f"Incorrect en
-0002bdb0: 7472 7920 7b66 696c 7d2e 4c65 6176 696e  try {fil}.Leavin
-0002bdc0: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
-0002bdd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002bde0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-0002bdf0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0002be00: 6e6f 7420 7061 7468 2e73 7461 7274 7377  not path.startsw
-0002be10: 6974 6828 272f 2729 3a0a 2020 2020 2020  ith('/'):.      
-0002be20: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0002be30: 726f 7228 6622 496e 636f 7272 6563 7420  ror(f"Incorrect 
-0002be40: 7061 7468 207b 7061 7468 7d2e 4c65 6176  path {path}.Leav
-0002be50: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
-0002be60: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0002be70: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-0002be80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002be90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002bea0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-0002beb0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-0002bec0: 3a20 2249 6e63 6f72 7265 6374 2066 696c  : "Incorrect fil
-0002bed0: 6520 656e 7472 7922 7d0a 2020 2020 2020  e entry"}.      
-0002bee0: 2020 2020 2020 6966 206f 7269 6769 6e20        if origin 
-0002bef0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0002bf00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002bf10: 6f6e 666c 7920 6973 206e 6f74 204e 6f6e  onfly is not Non
-0002bf20: 6520 616e 6420 277e 2720 6e6f 7420 696e  e and '~' not in
-0002bf30: 206f 7269 6769 6e3a 0a20 2020 2020 2020   origin:.       
-0002bf40: 2020 2020 2020 2020 2020 2020 2064 6573               des
-0002bf50: 7464 6972 203d 2062 6173 6564 6972 0a20  tdir = basedir. 
-0002bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf70: 2020 2069 6620 272f 2720 696e 206f 7269     if '/' in ori
-0002bf80: 6769 6e3a 0a20 2020 2020 2020 2020 2020  gin:.           
-0002bf90: 2020 2020 2020 2020 2020 2020 2064 6573               des
-0002bfa0: 7464 6972 203d 206f 732e 7061 7468 2e64  tdir = os.path.d
-0002bfb0: 6972 6e61 6d65 286f 7269 6769 6e29 0a20  irname(origin). 
+0002bd40: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+0002bd50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002bd60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002bd70: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+0002bd80: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+0002bd90: 736f 6e27 3a20 2249 6e63 6f72 7265 6374  son': "Incorrect
+0002bda0: 2066 696c 6520 656e 7472 7922 7d0a 2020   file entry"}.  
+0002bdb0: 2020 2020 2020 2020 2020 6966 206f 7269            if ori
+0002bdc0: 6769 6e20 6973 206e 6f74 204e 6f6e 653a  gin is not None:
+0002bdd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bde0: 2069 6620 6f6e 666c 7920 6973 206e 6f74   if onfly is not
+0002bdf0: 204e 6f6e 6520 616e 6420 277e 2720 6e6f   None and '~' no
+0002be00: 7420 696e 206f 7269 6769 6e3a 0a20 2020  t in origin:.   
+0002be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be20: 2064 6573 7464 6972 203d 2062 6173 6564   destdir = based
+0002be30: 6972 0a20 2020 2020 2020 2020 2020 2020  ir.             
+0002be40: 2020 2020 2020 2069 6620 272f 2720 696e         if '/' in
+0002be50: 206f 7269 6769 6e3a 0a20 2020 2020 2020   origin:.       
+0002be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be70: 2064 6573 7464 6972 203d 206f 732e 7061   destdir = os.pa
+0002be80: 7468 2e64 6972 6e61 6d65 286f 7269 6769  th.dirname(origi
+0002be90: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+0002bea0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+0002beb0: 6b65 6469 7273 2864 6573 7464 6972 2c20  kedirs(destdir, 
+0002bec0: 6578 6973 745f 6f6b 3d54 7275 6529 0a20  exist_ok=True). 
+0002bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bee0: 2020 2063 6f6d 6d6f 6e2e 6665 7463 6828     common.fetch(
+0002bef0: 6622 7b6f 6e66 6c79 7d2f 7b6f 7269 6769  f"{onfly}/{origi
+0002bf00: 6e7d 222c 2064 6573 7464 6972 290a 2020  n}", destdir).  
+0002bf10: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0002bf20: 6967 696e 203d 206f 732e 7061 7468 2e65  igin = os.path.e
+0002bf30: 7870 616e 6475 7365 7228 6f72 6967 696e  xpanduser(origin
+0002bf40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002bf50: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+0002bf60: 2e69 7361 6273 286f 7269 6769 6e29 3a0a  .isabs(origin):.
+0002bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bf80: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0002bf90: 6528 6669 6c2c 2064 6963 7429 2061 6e64  e(fil, dict) and
+0002bfa0: 2066 696c 2e67 6574 2827 6375 7272 656e   fil.get('curren
+0002bfb0: 7464 6972 272c 2046 616c 7365 293a 0a20  tdir', False):. 
 0002bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bfd0: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-0002bfe0: 7273 2864 6573 7464 6972 2c20 6578 6973  rs(destdir, exis
-0002bff0: 745f 6f6b 3d54 7275 6529 0a20 2020 2020  t_ok=True).     
-0002c000: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002c010: 6f6d 6d6f 6e2e 6665 7463 6828 6622 7b6f  ommon.fetch(f"{o
-0002c020: 6e66 6c79 7d2f 7b6f 7269 6769 6e7d 222c  nfly}/{origin}",
-0002c030: 2064 6573 7464 6972 290a 2020 2020 2020   destdir).      
-0002c040: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-0002c050: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-0002c060: 6475 7365 7228 6f72 6967 696e 290a 2020  duser(origin).  
-0002c070: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002c080: 206e 6f74 206f 732e 7061 7468 2e69 7361   not os.path.isa
-0002c090: 6273 286f 7269 6769 6e29 3a0a 2020 2020  bs(origin):.    
-0002c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0b0: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
-0002c0c0: 6c2c 2064 6963 7429 2061 6e64 2066 696c  l, dict) and fil
-0002c0d0: 2e67 6574 2827 6375 7272 656e 7464 6972  .get('currentdir
-0002c0e0: 272c 2046 616c 7365 293a 0a20 2020 2020  ', False):.     
-0002c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c100: 2020 206f 7269 6769 6e20 3d20 6622 7b6f     origin = f"{o
-0002c110: 732e 6765 7463 7764 2829 7d2f 7b6f 7269  s.getcwd()}/{ori
-0002c120: 6769 6e7d 220a 2020 2020 2020 2020 2020  gin}".          
-0002c130: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0002c140: 6c65 735b 696e 6465 785d 5b27 6f72 6967  les[index]['orig
-0002c150: 696e 275d 203d 206f 7269 6769 6e0a 2020  in'] = origin.  
-0002c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c170: 2020 656c 6966 2062 6173 6564 6972 2021    elif basedir !
-0002c180: 3d20 272e 2720 616e 6420 6e6f 7420 6f72  = '.' and not or
-0002c190: 6967 696e 2e73 7461 7274 7377 6974 6828  igin.startswith(
-0002c1a0: 272e 2f27 2920 616e 6420 6e6f 7420 6f72  './') and not or
-0002c1b0: 6967 696e 2e73 7461 7274 7377 6974 6828  igin.startswith(
-0002c1c0: 272f 776f 726b 6469 722f 2729 3a0a 2020  '/workdir/'):.  
-0002c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c1e0: 2020 2020 2020 6f72 6967 696e 203d 2066        origin = f
-0002c1f0: 227b 6261 7365 6469 727d 2f7b 6f72 6967  "{basedir}/{orig
-0002c200: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
-0002c210: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0002c220: 6573 5b69 6e64 6578 5d5b 276f 7269 6769  es[index]['origi
-0002c230: 6e27 5d20 3d20 6f72 6967 696e 0a20 2020  n'] = origin.   
-0002c240: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002c250: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-0002c260: 7473 286f 7269 6769 6e29 3a0a 2020 2020  ts(origin):.    
-0002c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c280: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-0002c290: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-0002c2a0: 6173 6f6e 273a 2066 224f 7269 6769 6e20  ason': f"Origin 
-0002c2b0: 6669 6c65 207b 6f72 6967 696e 7d20 6e6f  file {origin} no
-0002c2c0: 7420 666f 756e 6420 666f 7220 7b6e 616d  t found for {nam
-0002c2d0: 657d 227d 0a20 2020 2020 2020 2020 2020  e}"}.           
-0002c2e0: 2065 6c69 6620 636f 6e74 656e 7420 6973   elif content is
-0002c2f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002c300: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002c310: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-0002c320: 6527 2c20 2772 6561 736f 6e27 3a20 6622  e', 'reason': f"
-0002c330: 436f 6e74 656e 7420 6f66 2066 696c 6520  Content of file 
-0002c340: 7b70 6174 687d 206e 6f74 2066 6f75 6e64  {path} not found
-0002c350: 2066 6f72 207b 6e61 6d65 7d22 7d0a 0a20   for {name}"}.. 
-0002c360: 2020 2064 6566 2070 7265 7065 6e64 5f69     def prepend_i
-0002c370: 6e70 7574 5f64 6972 2873 656c 662c 206e  nput_dir(self, n
-0002c380: 6577 6669 6c65 732c 2069 6e70 7574 6469  ewfiles, inputdi
-0002c390: 7229 3a0a 2020 2020 2020 2020 7265 7375  r):.        resu
-0002c3a0: 6c74 7320 3d20 5b5d 0a20 2020 2020 2020  lts = [].       
-0002c3b0: 2066 6f72 2066 6963 2069 6e20 6e65 7766   for fic in newf
-0002c3c0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-0002c3d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0002c3e0: 6669 632c 2073 7472 2920 616e 6420 6e6f  fic, str) and no
-0002c3f0: 7420 6f73 2e70 6174 682e 6973 6162 7328  t os.path.isabs(
-0002c400: 6669 6329 3a0a 2020 2020 2020 2020 2020  fic):.          
-0002c410: 2020 2020 2020 6e65 775f 6669 6320 3d20        new_fic = 
-0002c420: 6622 7b69 6e70 7574 6469 727d 2f7b 6669  f"{inputdir}/{fi
-0002c430: 637d 220a 2020 2020 2020 2020 2020 2020  c}".            
-0002c440: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0002c450: 6669 632c 2064 6963 7429 2061 6e64 2027  fic, dict) and '
-0002c460: 6f72 6967 696e 2720 696e 2066 6963 2061  origin' in fic a
-0002c470: 6e64 206e 6f74 206f 732e 7061 7468 2e69  nd not os.path.i
-0002c480: 7361 6273 286f 732e 7061 7468 2e65 7870  sabs(os.path.exp
-0002c490: 616e 6475 7365 7228 6669 635b 276f 7269  anduser(fic['ori
-0002c4a0: 6769 6e27 5d29 293a 0a20 2020 2020 2020  gin'])):.       
-0002c4b0: 2020 2020 2020 2020 206e 6577 5f66 6963           new_fic
-0002c4c0: 203d 2066 6963 2e63 6f70 7928 290a 2020   = fic.copy().  
-0002c4d0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0002c4e0: 775f 6669 635b 276f 7269 6769 6e27 5d20  w_fic['origin'] 
-0002c4f0: 3d20 6622 7b69 6e70 7574 6469 727d 2f7b  = f"{inputdir}/{
-0002c500: 6669 635b 276f 7269 6769 6e27 5d7d 220a  fic['origin']}".
-0002c510: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002c520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002c530: 2020 6e65 775f 6669 6320 3d20 6669 630a    new_fic = fic.
-0002c540: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0002c550: 6c74 732e 6170 7065 6e64 286e 6577 5f66  lts.append(new_f
-0002c560: 6963 290a 2020 2020 2020 2020 7265 7475  ic).        retu
-0002c570: 726e 2072 6573 756c 7473 0a0a 2020 2020  rn results..    
-0002c580: 6465 6620 7265 6d65 6469 6174 655f 6669  def remediate_fi
-0002c590: 6c65 7328 7365 6c66 2c20 6e61 6d65 2c20  les(self, name, 
-0002c5a0: 6e65 7766 696c 6573 2c20 6f76 6572 7269  newfiles, overri
-0002c5b0: 6465 733d 7b7d 2c20 696e 7075 7464 6972  des={}, inputdir
-0002c5c0: 3d27 2e27 293a 0a20 2020 2020 2020 2075  ='.'):.        u
-0002c5d0: 7064 6174 6564 5f66 696c 6573 203d 205b  pdated_files = [
-0002c5e0: 5d0a 2020 2020 2020 2020 6970 2c20 766d  ].        ip, vm
-0002c5f0: 706f 7274 203d 205f 7373 685f 6372 6564  port = _ssh_cred
-0002c600: 656e 7469 616c 7328 7365 6c66 2e6b 2c20  entials(self.k, 
-0002c610: 6e61 6d65 295b 313a 5d0a 2020 2020 2020  name)[1:].      
-0002c620: 2020 6966 2069 6e70 7574 6469 7220 213d    if inputdir !=
-0002c630: 2027 2e27 3a0a 2020 2020 2020 2020 2020   '.':.          
-0002c640: 2020 6e65 7766 696c 6573 203d 2073 656c    newfiles = sel
-0002c650: 662e 7072 6570 656e 645f 696e 7075 745f  f.prepend_input_
-0002c660: 6469 7228 6e65 7766 696c 6573 2c20 696e  dir(newfiles, in
-0002c670: 7075 7464 6972 290a 2020 2020 2020 2020  putdir).        
-0002c680: 7365 6c66 2e70 6172 7365 5f66 696c 6573  self.parse_files
-0002c690: 286e 616d 652c 206e 6577 6669 6c65 7329  (name, newfiles)
-0002c6a0: 0a20 2020 2020 2020 206f 7665 7272 6964  .        overrid
-0002c6b0: 6573 5f66 696c 6573 203d 206f 7665 7272  es_files = overr
-0002c6c0: 6964 6573 2e63 6f70 7928 290a 2020 2020  ides.copy().    
-0002c6d0: 2020 2020 6f76 6572 7269 6465 735f 6669      overrides_fi
-0002c6e0: 6c65 735b 276e 616d 6527 5d20 3d20 6e61  les['name'] = na
-0002c6f0: 6d65 0a20 2020 2020 2020 2064 6174 6120  me.        data 
-0002c700: 3d20 7072 6f63 6573 735f 6669 6c65 7328  = process_files(
-0002c710: 6669 6c65 733d 6e65 7766 696c 6573 2c20  files=newfiles, 
-0002c720: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
-0002c730: 6465 735f 6669 6c65 732c 2072 656d 6564  des_files, remed
-0002c740: 6961 7465 3d54 7275 6529 0a20 2020 2020  iate=True).     
-0002c750: 2020 2064 6174 6164 6972 7320 3d20 7b7d     datadirs = {}
-0002c760: 0a20 2020 2020 2020 2077 6974 6820 5465  .        with Te
-0002c770: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
-0002c780: 2829 2061 7320 746d 7064 6972 3a0a 2020  () as tmpdir:.  
-0002c790: 2020 2020 2020 2020 2020 666f 7220 696e            for in
-0002c7a0: 6465 782c 2065 6e74 7279 2069 6e20 656e  dex, entry in en
-0002c7b0: 756d 6572 6174 6528 6461 7461 293a 0a20  umerate(data):. 
-0002c7c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0002c7d0: 6573 7469 6e61 7469 6f6e 203d 2065 6e74  estination = ent
-0002c7e0: 7279 5b27 7061 7468 275d 0a20 2020 2020  ry['path'].     
-0002c7f0: 2020 2020 2020 2020 2020 2070 6174 6864             pathd
-0002c800: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
-0002c810: 6e61 6d65 2864 6573 7469 6e61 7469 6f6e  name(destination
-0002c820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002c830: 2020 6966 2070 6174 6864 6972 206e 6f74    if pathdir not
-0002c840: 2069 6e20 6461 7461 6469 7273 3a0a 2020   in datadirs:.  
-0002c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c860: 2020 7061 7468 6469 7263 6d64 203d 2066    pathdircmd = f
-0002c870: 276c 7320 2d61 207b 7061 7468 6469 727d  'ls -a {pathdir}
-0002c880: 2032 3e26 3127 0a20 2020 2020 2020 2020   2>&1'.         
-0002c890: 2020 2020 2020 2020 2020 2070 6174 6864             pathd
-0002c8a0: 6972 636d 6420 3d20 7373 6828 6e61 6d65  ircmd = ssh(name
-0002c8b0: 2c20 6970 3d69 702c 2075 7365 723d 2772  , ip=ip, user='r
-0002c8c0: 6f6f 7427 2c20 7475 6e6e 656c 3d73 656c  oot', tunnel=sel
-0002c8d0: 662e 7475 6e6e 656c 2c20 7475 6e6e 656c  f.tunnel, tunnel
-0002c8e0: 686f 7374 3d73 656c 662e 7475 6e6e 656c  host=self.tunnel
-0002c8f0: 686f 7374 2c0a 2020 2020 2020 2020 2020  host,.          
-0002c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c910: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-0002c920: 6c70 6f72 743d 7365 6c66 2e74 756e 6e65  lport=self.tunne
-0002c930: 6c70 6f72 742c 2074 756e 6e65 6c75 7365  lport, tunneluse
-0002c940: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
-0002c950: 722c 2069 6e73 6563 7572 653d 5472 7565  r, insecure=True
-0002c960: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c980: 2020 2020 2020 2063 6d64 3d70 6174 6864         cmd=pathd
-0002c990: 6972 636d 642c 2076 6d70 6f72 743d 766d  ircmd, vmport=vm
-0002c9a0: 706f 7274 290a 2020 2020 2020 2020 2020  port).          
-0002c9b0: 2020 2020 2020 2020 2020 7061 7468 6469            pathdi
-0002c9c0: 7266 696c 6573 203d 206f 732e 706f 7065  rfiles = os.pope
-0002c9d0: 6e28 7061 7468 6469 7263 6d64 292e 7265  n(pathdircmd).re
-0002c9e0: 6164 6c69 6e65 7328 290a 2020 2020 2020  adlines().      
-0002c9f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002ca00: 206c 656e 2870 6174 6864 6972 6669 6c65   len(pathdirfile
-0002ca10: 7329 203d 3d20 3120 616e 6420 274e 6f20  s) == 1 and 'No 
-0002ca20: 7375 6368 2066 696c 6520 6f72 2064 6972  such file or dir
-0002ca30: 6563 746f 7279 2720 696e 2070 6174 6864  ectory' in pathd
-0002ca40: 6972 6669 6c65 735b 305d 3a0a 2020 2020  irfiles[0]:.    
+0002bfd0: 2020 2020 2020 206f 7269 6769 6e20 3d20         origin = 
+0002bfe0: 6622 7b6f 732e 6765 7463 7764 2829 7d2f  f"{os.getcwd()}/
+0002bff0: 7b6f 7269 6769 6e7d 220a 2020 2020 2020  {origin}".      
+0002c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c010: 2020 6669 6c65 735b 696e 6465 785d 5b27    files[index]['
+0002c020: 6f72 6967 696e 275d 203d 206f 7269 6769  origin'] = origi
+0002c030: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0002c040: 2020 2020 2020 656c 6966 2062 6173 6564        elif based
+0002c050: 6972 2021 3d20 272e 2720 616e 6420 6e6f  ir != '.' and no
+0002c060: 7420 6f72 6967 696e 2e73 7461 7274 7377  t origin.startsw
+0002c070: 6974 6828 272e 2f27 2920 616e 6420 6e6f  ith('./') and no
+0002c080: 7420 6f72 6967 696e 2e73 7461 7274 7377  t origin.startsw
+0002c090: 6974 6828 272f 776f 726b 6469 722f 2729  ith('/workdir/')
+0002c0a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c0b0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+0002c0c0: 203d 2066 227b 6261 7365 6469 727d 2f7b   = f"{basedir}/{
+0002c0d0: 6f72 6967 696e 7d22 0a20 2020 2020 2020  origin}".       
+0002c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c0f0: 2066 696c 6573 5b69 6e64 6578 5d5b 276f   files[index]['o
+0002c100: 7269 6769 6e27 5d20 3d20 6f72 6967 696e  rigin'] = origin
+0002c110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c120: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0002c130: 6578 6973 7473 286f 7269 6769 6e29 3a0a  exists(origin):.
+0002c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c150: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+0002c160: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
+0002c170: 2027 7265 6173 6f6e 273a 2066 224f 7269   'reason': f"Ori
+0002c180: 6769 6e20 6669 6c65 207b 6f72 6967 696e  gin file {origin
+0002c190: 7d20 6e6f 7420 666f 756e 6420 666f 7220  } not found for 
+0002c1a0: 7b6e 616d 657d 227d 0a20 2020 2020 2020  {name}"}.       
+0002c1b0: 2020 2020 2065 6c69 6620 636f 6e74 656e       elif conten
+0002c1c0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+0002c1d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002c1e0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+0002c1f0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+0002c200: 3a20 6622 436f 6e74 656e 7420 6f66 2066  : f"Content of f
+0002c210: 696c 6520 7b70 6174 687d 206e 6f74 2066  ile {path} not f
+0002c220: 6f75 6e64 2066 6f72 207b 6e61 6d65 7d22  ound for {name}"
+0002c230: 7d0a 0a20 2020 2064 6566 2070 7265 7065  }..    def prepe
+0002c240: 6e64 5f69 6e70 7574 5f64 6972 2873 656c  nd_input_dir(sel
+0002c250: 662c 206e 6577 6669 6c65 732c 2069 6e70  f, newfiles, inp
+0002c260: 7574 6469 7229 3a0a 2020 2020 2020 2020  utdir):.        
+0002c270: 7265 7375 6c74 7320 3d20 5b5d 0a20 2020  results = [].   
+0002c280: 2020 2020 2066 6f72 2066 6963 2069 6e20       for fic in 
+0002c290: 6e65 7766 696c 6573 3a0a 2020 2020 2020  newfiles:.      
+0002c2a0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0002c2b0: 6e63 6528 6669 632c 2073 7472 2920 616e  nce(fic, str) an
+0002c2c0: 6420 6e6f 7420 6f73 2e70 6174 682e 6973  d not os.path.is
+0002c2d0: 6162 7328 6669 6329 3a0a 2020 2020 2020  abs(fic):.      
+0002c2e0: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
+0002c2f0: 6320 3d20 6622 7b69 6e70 7574 6469 727d  c = f"{inputdir}
+0002c300: 2f7b 6669 637d 220a 2020 2020 2020 2020  /{fic}".        
+0002c310: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+0002c320: 6e63 6528 6669 632c 2064 6963 7429 2061  nce(fic, dict) a
+0002c330: 6e64 2027 6f72 6967 696e 2720 696e 2066  nd 'origin' in f
+0002c340: 6963 2061 6e64 206e 6f74 206f 732e 7061  ic and not os.pa
+0002c350: 7468 2e69 7361 6273 286f 732e 7061 7468  th.isabs(os.path
+0002c360: 2e65 7870 616e 6475 7365 7228 6669 635b  .expanduser(fic[
+0002c370: 276f 7269 6769 6e27 5d29 293a 0a20 2020  'origin'])):.   
+0002c380: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0002c390: 5f66 6963 203d 2066 6963 2e63 6f70 7928  _fic = fic.copy(
+0002c3a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002c3b0: 2020 6e65 775f 6669 635b 276f 7269 6769    new_fic['origi
+0002c3c0: 6e27 5d20 3d20 6622 7b69 6e70 7574 6469  n'] = f"{inputdi
+0002c3d0: 727d 2f7b 6669 635b 276f 7269 6769 6e27  r}/{fic['origin'
+0002c3e0: 5d7d 220a 2020 2020 2020 2020 2020 2020  ]}".            
+0002c3f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002c400: 2020 2020 2020 6e65 775f 6669 6320 3d20        new_fic = 
+0002c410: 6669 630a 2020 2020 2020 2020 2020 2020  fic.            
+0002c420: 7265 7375 6c74 732e 6170 7065 6e64 286e  results.append(n
+0002c430: 6577 5f66 6963 290a 2020 2020 2020 2020  ew_fic).        
+0002c440: 7265 7475 726e 2072 6573 756c 7473 0a0a  return results..
+0002c450: 2020 2020 6465 6620 7265 6d65 6469 6174      def remediat
+0002c460: 655f 6669 6c65 7328 7365 6c66 2c20 6e61  e_files(self, na
+0002c470: 6d65 2c20 6e65 7766 696c 6573 2c20 6f76  me, newfiles, ov
+0002c480: 6572 7269 6465 733d 7b7d 2c20 696e 7075  errides={}, inpu
+0002c490: 7464 6972 3d27 2e27 293a 0a20 2020 2020  tdir='.'):.     
+0002c4a0: 2020 2075 7064 6174 6564 5f66 696c 6573     updated_files
+0002c4b0: 203d 205b 5d0a 2020 2020 2020 2020 6970   = [].        ip
+0002c4c0: 2c20 766d 706f 7274 203d 205f 7373 685f  , vmport = _ssh_
+0002c4d0: 6372 6564 656e 7469 616c 7328 7365 6c66  credentials(self
+0002c4e0: 2e6b 2c20 6e61 6d65 295b 313a 5d0a 2020  .k, name)[1:].  
+0002c4f0: 2020 2020 2020 6966 2069 6e70 7574 6469        if inputdi
+0002c500: 7220 213d 2027 2e27 3a0a 2020 2020 2020  r != '.':.      
+0002c510: 2020 2020 2020 6e65 7766 696c 6573 203d        newfiles =
+0002c520: 2073 656c 662e 7072 6570 656e 645f 696e   self.prepend_in
+0002c530: 7075 745f 6469 7228 6e65 7766 696c 6573  put_dir(newfiles
+0002c540: 2c20 696e 7075 7464 6972 290a 2020 2020  , inputdir).    
+0002c550: 2020 2020 7365 6c66 2e70 6172 7365 5f66      self.parse_f
+0002c560: 696c 6573 286e 616d 652c 206e 6577 6669  iles(name, newfi
+0002c570: 6c65 7329 0a20 2020 2020 2020 206f 7665  les).        ove
+0002c580: 7272 6964 6573 5f66 696c 6573 203d 206f  rrides_files = o
+0002c590: 7665 7272 6964 6573 2e63 6f70 7928 290a  verrides.copy().
+0002c5a0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+0002c5b0: 735f 6669 6c65 735b 276e 616d 6527 5d20  s_files['name'] 
+0002c5c0: 3d20 6e61 6d65 0a20 2020 2020 2020 2064  = name.        d
+0002c5d0: 6174 6120 3d20 7072 6f63 6573 735f 6669  ata = process_fi
+0002c5e0: 6c65 7328 6669 6c65 733d 6e65 7766 696c  les(files=newfil
+0002c5f0: 6573 2c20 6f76 6572 7269 6465 733d 6f76  es, overrides=ov
+0002c600: 6572 7269 6465 735f 6669 6c65 732c 2072  errides_files, r
+0002c610: 656d 6564 6961 7465 3d54 7275 6529 0a20  emediate=True). 
+0002c620: 2020 2020 2020 2064 6174 6164 6972 7320         datadirs 
+0002c630: 3d20 7b7d 0a20 2020 2020 2020 2077 6974  = {}.        wit
+0002c640: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
+0002c650: 746f 7279 2829 2061 7320 746d 7064 6972  tory() as tmpdir
+0002c660: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+0002c670: 7220 696e 6465 782c 2065 6e74 7279 2069  r index, entry i
+0002c680: 6e20 656e 756d 6572 6174 6528 6461 7461  n enumerate(data
+0002c690: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002c6a0: 2020 2064 6573 7469 6e61 7469 6f6e 203d     destination =
+0002c6b0: 2065 6e74 7279 5b27 7061 7468 275d 0a20   entry['path']. 
+0002c6c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002c6d0: 6174 6864 6972 203d 206f 732e 7061 7468  athdir = os.path
+0002c6e0: 2e64 6972 6e61 6d65 2864 6573 7469 6e61  .dirname(destina
+0002c6f0: 7469 6f6e 290a 2020 2020 2020 2020 2020  tion).          
+0002c700: 2020 2020 2020 6966 2070 6174 6864 6972        if pathdir
+0002c710: 206e 6f74 2069 6e20 6461 7461 6469 7273   not in datadirs
+0002c720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c730: 2020 2020 2020 7061 7468 6469 7263 6d64        pathdircmd
+0002c740: 203d 2066 276c 7320 2d61 207b 7061 7468   = f'ls -a {path
+0002c750: 6469 727d 2032 3e26 3127 0a20 2020 2020  dir} 2>&1'.     
+0002c760: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002c770: 6174 6864 6972 636d 6420 3d20 7373 6828  athdircmd = ssh(
+0002c780: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
+0002c790: 723d 2772 6f6f 7427 2c20 7475 6e6e 656c  r='root', tunnel
+0002c7a0: 3d73 656c 662e 7475 6e6e 656c 2c20 7475  =self.tunnel, tu
+0002c7b0: 6e6e 656c 686f 7374 3d73 656c 662e 7475  nnelhost=self.tu
+0002c7c0: 6e6e 656c 686f 7374 2c0a 2020 2020 2020  nnelhost,.      
+0002c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c7e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002c7f0: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
+0002c800: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
+0002c810: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
+0002c820: 6c75 7365 722c 2069 6e73 6563 7572 653d  luser, insecure=
+0002c830: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0002c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c850: 2020 2020 2020 2020 2020 2063 6d64 3d70             cmd=p
+0002c860: 6174 6864 6972 636d 642c 2076 6d70 6f72  athdircmd, vmpor
+0002c870: 743d 766d 706f 7274 290a 2020 2020 2020  t=vmport).      
+0002c880: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0002c890: 7468 6469 7266 696c 6573 203d 206f 732e  thdirfiles = os.
+0002c8a0: 706f 7065 6e28 7061 7468 6469 7263 6d64  popen(pathdircmd
+0002c8b0: 292e 7265 6164 6c69 6e65 7328 290a 2020  ).readlines().  
+0002c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c8d0: 2020 6966 206c 656e 2870 6174 6864 6972    if len(pathdir
+0002c8e0: 6669 6c65 7329 203d 3d20 3120 616e 6420  files) == 1 and 
+0002c8f0: 274e 6f20 7375 6368 2066 696c 6520 6f72  'No such file or
+0002c900: 2064 6972 6563 746f 7279 2720 696e 2070   directory' in p
+0002c910: 6174 6864 6972 6669 6c65 735b 305d 3a0a  athdirfiles[0]:.
+0002c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c930: 2020 2020 2020 2020 6372 6561 7465 6469          createdi
+0002c940: 7263 6d64 203d 2066 276d 6b64 6972 202d  rcmd = f'mkdir -
+0002c950: 7020 7b70 6174 6864 6972 7d27 0a20 2020  p {pathdir}'.   
+0002c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c970: 2020 2020 2063 7265 6174 6564 6972 636d       createdircm
+0002c980: 6420 3d20 7373 6828 6e61 6d65 2c20 6970  d = ssh(name, ip
+0002c990: 3d69 702c 2075 7365 723d 2772 6f6f 7427  =ip, user='root'
+0002c9a0: 2c20 7475 6e6e 656c 3d73 656c 662e 7475  , tunnel=self.tu
+0002c9b0: 6e6e 656c 2c20 7475 6e6e 656c 686f 7374  nnel, tunnelhost
+0002c9c0: 3d73 656c 662e 7475 6e6e 656c 686f 7374  =self.tunnelhost
+0002c9d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9f0: 2020 2020 2020 2020 2020 2020 2074 756e               tun
+0002ca00: 6e65 6c70 6f72 743d 7365 6c66 2e74 756e  nelport=self.tun
+0002ca10: 6e65 6c70 6f72 742c 2074 756e 6e65 6c75  nelport, tunnelu
+0002ca20: 7365 723d 7365 6c66 2e74 756e 6e65 6c75  ser=self.tunnelu
+0002ca30: 7365 722c 2069 6e73 6563 7572 653d 5472  ser, insecure=Tr
+0002ca40: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
 0002ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca60: 2020 2020 6372 6561 7465 6469 7263 6d64      createdircmd
-0002ca70: 203d 2066 276d 6b64 6972 202d 7020 7b70   = f'mkdir -p {p
-0002ca80: 6174 6864 6972 7d27 0a20 2020 2020 2020  athdir}'.       
+0002ca60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002ca70: 6d64 3d63 7265 6174 6564 6972 636d 642c  md=createdircmd,
+0002ca80: 2076 6d70 6f72 743d 766d 706f 7274 290a   vmport=vmport).
 0002ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002caa0: 2063 7265 6174 6564 6972 636d 6420 3d20   createdircmd = 
-0002cab0: 7373 6828 6e61 6d65 2c20 6970 3d69 702c  ssh(name, ip=ip,
-0002cac0: 2075 7365 723d 2772 6f6f 7427 2c20 7475   user='root', tu
-0002cad0: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
-0002cae0: 2c20 7475 6e6e 656c 686f 7374 3d73 656c  , tunnelhost=sel
-0002caf0: 662e 7475 6e6e 656c 686f 7374 2c0a 2020  f.tunnelhost,.  
-0002cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb20: 2020 2020 2020 2020 2074 756e 6e65 6c70           tunnelp
-0002cb30: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
-0002cb40: 6f72 742c 2074 756e 6e65 6c75 7365 723d  ort, tunneluser=
-0002cb50: 7365 6c66 2e74 756e 6e65 6c75 7365 722c  self.tunneluser,
-0002cb60: 2069 6e73 6563 7572 653d 5472 7565 2c0a   insecure=True,.
-0002cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb90: 2020 2020 2020 2020 2020 2063 6d64 3d63             cmd=c
-0002cba0: 7265 6174 6564 6972 636d 642c 2076 6d70  reatedircmd, vmp
-0002cbb0: 6f72 743d 766d 706f 7274 290a 2020 2020  ort=vmport).    
-0002cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cbd0: 2020 2020 6f73 2e70 6f70 656e 2863 7265      os.popen(cre
-0002cbe0: 6174 6564 6972 636d 6429 0a20 2020 2020  atedircmd).     
-0002cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc00: 2020 2070 6174 6864 6972 6669 6c65 7320     pathdirfiles 
-0002cc10: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0002cc20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc40: 2020 2020 2020 2070 6174 6864 6972 6669         pathdirfi
-0002cc50: 6c65 7320 3d20 5b78 2e73 7472 6970 2829  les = [x.strip()
-0002cc60: 2066 6f72 2078 2069 6e20 7061 7468 6469   for x in pathdi
-0002cc70: 7266 696c 6573 5d0a 2020 2020 2020 2020  rfiles].        
-0002cc80: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0002cc90: 6469 7273 5b70 6174 6864 6972 5d20 3d20  dirs[pathdir] = 
-0002cca0: 7061 7468 6469 7266 696c 6573 0a20 2020  pathdirfiles.   
-0002ccb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002ccc0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-0002ccd0: 2864 6573 7469 6e61 7469 6f6e 2920 6e6f  (destination) no
-0002cce0: 7420 696e 2064 6174 6164 6972 735b 7061  t in datadirs[pa
-0002ccf0: 7468 6469 725d 3a0a 2020 2020 2020 2020  thdir]:.        
-0002cd00: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0002cd10: 6e74 2866 2255 7064 6174 696e 6720 7b64  nt(f"Updating {d
-0002cd20: 6573 7469 6e61 7469 6f6e 7d20 696e 207b  estination} in {
-0002cd30: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0002cd40: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-0002cd50: 6365 203d 2066 227b 746d 7064 6972 7d2f  ce = f"{tmpdir}/
-0002cd60: 6669 637b 696e 6465 787d 220a 2020 2020  fic{index}".    
-0002cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd80: 7769 7468 206f 7065 6e28 736f 7572 6365  with open(source
-0002cd90: 2c20 2777 2729 2061 7320 663a 0a20 2020  , 'w') as f:.   
+0002caa0: 2020 2020 2020 2020 6f73 2e70 6f70 656e          os.popen
+0002cab0: 2863 7265 6174 6564 6972 636d 6429 0a20  (createdircmd). 
+0002cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cad0: 2020 2020 2020 2070 6174 6864 6972 6669         pathdirfi
+0002cae0: 6c65 7320 3d20 5b5d 0a20 2020 2020 2020  les = [].       
+0002caf0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0002cb00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002cb10: 2020 2020 2020 2020 2020 2070 6174 6864             pathd
+0002cb20: 6972 6669 6c65 7320 3d20 5b78 2e73 7472  irfiles = [x.str
+0002cb30: 6970 2829 2066 6f72 2078 2069 6e20 7061  ip() for x in pa
+0002cb40: 7468 6469 7266 696c 6573 5d0a 2020 2020  thdirfiles].    
+0002cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cb60: 6461 7461 6469 7273 5b70 6174 6864 6972  datadirs[pathdir
+0002cb70: 5d20 3d20 7061 7468 6469 7266 696c 6573  ] = pathdirfiles
+0002cb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cb90: 2069 6620 6f73 2e70 6174 682e 6261 7365   if os.path.base
+0002cba0: 6e61 6d65 2864 6573 7469 6e61 7469 6f6e  name(destination
+0002cbb0: 2920 6e6f 7420 696e 2064 6174 6164 6972  ) not in datadir
+0002cbc0: 735b 7061 7468 6469 725d 3a0a 2020 2020  s[pathdir]:.    
+0002cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cbe0: 7070 7269 6e74 2866 2255 7064 6174 696e  pprint(f"Updatin
+0002cbf0: 6720 7b64 6573 7469 6e61 7469 6f6e 7d20  g {destination} 
+0002cc00: 696e 207b 6e61 6d65 7d22 290a 2020 2020  in {name}").    
+0002cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc20: 736f 7572 6365 203d 2066 227b 746d 7064  source = f"{tmpd
+0002cc30: 6972 7d2f 6669 637b 696e 6465 787d 220a  ir}/fic{index}".
+0002cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc50: 2020 2020 7769 7468 206f 7065 6e28 736f      with open(so
+0002cc60: 7572 6365 2c20 2777 2729 2061 7320 663a  urce, 'w') as f:
+0002cc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cc80: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+0002cc90: 2865 6e74 7279 5b27 636f 6e74 656e 7427  (entry['content'
+0002cca0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0002ccb0: 2020 2020 2020 2073 6370 636d 6420 3d20         scpcmd = 
+0002ccc0: 7363 7028 6e61 6d65 2c20 6970 3d69 702c  scp(name, ip=ip,
+0002ccd0: 2075 7365 723d 2772 6f6f 7427 2c20 736f   user='root', so
+0002cce0: 7572 6365 3d73 6f75 7263 652c 2064 6573  urce=source, des
+0002ccf0: 7469 6e61 7469 6f6e 3d64 6573 7469 6e61  tination=destina
+0002cd00: 7469 6f6e 2c20 7475 6e6e 656c 3d73 656c  tion, tunnel=sel
+0002cd10: 662e 7475 6e6e 656c 2c0a 2020 2020 2020  f.tunnel,.      
+0002cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd30: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
+0002cd40: 6c68 6f73 743d 7365 6c66 2e74 756e 6e65  lhost=self.tunne
+0002cd50: 6c68 6f73 742c 2074 756e 6e65 6c70 6f72  lhost, tunnelpor
+0002cd60: 743d 7365 6c66 2e74 756e 6e65 6c70 6f72  t=self.tunnelpor
+0002cd70: 742c 2074 756e 6e65 6c75 7365 723d 7365  t, tunneluser=se
+0002cd80: 6c66 2e74 756e 6e65 6c75 7365 722c 0a20  lf.tunneluser,. 
+0002cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cdb0: 2020 2020 2066 2e77 7269 7465 2865 6e74       f.write(ent
-0002cdc0: 7279 5b27 636f 6e74 656e 7427 5d29 0a20  ry['content']). 
-0002cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cde0: 2020 2073 6370 636d 6420 3d20 7363 7028     scpcmd = scp(
-0002cdf0: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
-0002ce00: 723d 2772 6f6f 7427 2c20 736f 7572 6365  r='root', source
-0002ce10: 3d73 6f75 7263 652c 2064 6573 7469 6e61  =source, destina
-0002ce20: 7469 6f6e 3d64 6573 7469 6e61 7469 6f6e  tion=destination
-0002ce30: 2c20 7475 6e6e 656c 3d73 656c 662e 7475  , tunnel=self.tu
-0002ce40: 6e6e 656c 2c0a 2020 2020 2020 2020 2020  nnel,.          
-0002ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce60: 2020 2020 2020 2074 756e 6e65 6c68 6f73         tunnelhos
-0002ce70: 743d 7365 6c66 2e74 756e 6e65 6c68 6f73  t=self.tunnelhos
-0002ce80: 742c 2074 756e 6e65 6c70 6f72 743d 7365  t, tunnelport=se
-0002ce90: 6c66 2e74 756e 6e65 6c70 6f72 742c 2074  lf.tunnelport, t
-0002cea0: 756e 6e65 6c75 7365 723d 7365 6c66 2e74  unneluser=self.t
-0002ceb0: 756e 6e65 6c75 7365 722c 0a20 2020 2020  unneluser,.     
-0002cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ced0: 2020 2020 2020 2020 2020 2020 646f 776e              down
-0002cee0: 6c6f 6164 3d46 616c 7365 2c20 696e 7365  load=False, inse
-0002cef0: 6375 7265 3d54 7275 652c 2076 6d70 6f72  cure=True, vmpor
-0002cf00: 743d 766d 706f 7274 290a 2020 2020 2020  t=vmport).      
-0002cf10: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-0002cf20: 2e73 7973 7465 6d28 7363 7063 6d64 290a  .system(scpcmd).
-0002cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf40: 2020 2020 7570 6461 7465 645f 6669 6c65      updated_file
-0002cf50: 732e 6170 7065 6e64 2864 6573 7469 6e61  s.append(destina
-0002cf60: 7469 6f6e 290a 2020 2020 2020 2020 7265  tion).        re
-0002cf70: 7475 726e 2075 7064 6174 6564 5f66 696c  turn updated_fil
-0002cf80: 6573 0a0a 2020 2020 6465 6620 696e 666f  es..    def info
-0002cf90: 5f73 7065 6369 6669 635f 706c 616e 2873  _specific_plan(s
-0002cfa0: 656c 662c 2070 6c61 6e29 3a0a 2020 2020  elf, plan):.    
-0002cfb0: 2020 2020 7070 7269 6e74 2866 2250 726f      pprint(f"Pro
-0002cfc0: 7669 6469 6e67 2069 6e66 6f72 6d61 7469  viding informati
-0002cfd0: 6f6e 2061 626f 7574 2070 6c61 6e20 7b70  on about plan {p
-0002cfe0: 6c61 6e7d 2229 0a20 2020 2020 2020 206b  lan}").        k
-0002cff0: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
-0002d000: 2020 7265 7375 6c74 7320 3d20 5b5d 0a20    results = []. 
-0002d010: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-0002d020: 206b 2e6c 6973 7428 293a 0a20 2020 2020   k.list():.     
-0002d030: 2020 2020 2020 2069 6620 766d 2e67 6574         if vm.get
-0002d040: 2827 706c 616e 272c 2027 2729 203d 3d20  ('plan', '') == 
-0002d050: 706c 616e 3a0a 2020 2020 2020 2020 2020  plan:.          
-0002d060: 2020 2020 2020 7265 7375 6c74 732e 6170        results.ap
-0002d070: 7065 6e64 2876 6d29 0a20 2020 2020 2020  pend(vm).       
-0002d080: 2072 6574 7572 6e20 7265 7375 6c74 730a   return results.
-0002d090: 0a20 2020 2064 6566 2061 7574 6f73 6361  .    def autosca
-0002d0a0: 6c65 5f63 6c75 7374 6572 2873 656c 662c  le_cluster(self,
-0002d0b0: 206b 7562 652c 206b 7562 6574 7970 652c   kube, kubetype,
-0002d0c0: 2077 6f72 6b65 7273 2c20 7468 7265 7368   workers, thresh
-0002d0d0: 6f6c 642c 2069 646c 6529 3a0a 2020 2020  old, idle):.    
-0002d0e0: 2020 2020 6966 2074 6872 6573 686f 6c64      if threshold
-0002d0f0: 203e 2039 3939 393a 0a20 2020 2020 2020   > 9999:.       
-0002d100: 2020 2020 2070 7072 696e 7428 6622 536b       pprint(f"Sk
-0002d110: 6970 7069 6e67 2061 7574 6f73 6361 6c69  ipping autoscali
-0002d120: 6e67 2075 7020 6368 6563 6b73 2066 6f72  ng up checks for
-0002d130: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
-0002d140: 6173 2070 6572 2074 6872 6573 686f 6c64  as per threshold
-0002d150: 207b 7468 7265 7368 6f6c 647d 2229 0a20   {threshold}"). 
-0002d160: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002d170: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-0002d180: 6363 6573 7327 2c20 2777 6f72 6b65 7273  ccess', 'workers
-0002d190: 273a 2077 6f72 6b65 7273 7d0a 2020 2020  ': workers}.    
-0002d1a0: 2020 2020 6966 2069 646c 6520 3c20 313a      if idle < 1:
-0002d1b0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-0002d1c0: 696e 7428 6622 536b 6970 7069 6e67 2061  int(f"Skipping a
-0002d1d0: 7574 6f73 6361 6c69 6e67 2064 6f77 6e20  utoscaling down 
-0002d1e0: 6368 6563 6b73 2066 6f72 2063 6c75 7374  checks for clust
-0002d1f0: 6572 207b 6b75 6265 7d20 6173 2070 6572  er {kube} as per
-0002d200: 2069 646c 6520 7b69 646c 657d 2229 0a20   idle {idle}"). 
-0002d210: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002d220: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-0002d230: 6363 6573 7327 2c20 2777 6f72 6b65 7273  ccess', 'workers
-0002d240: 273a 2077 6f72 6b65 7273 7d0a 2020 2020  ': workers}.    
-0002d250: 2020 2020 7070 7269 6e74 2866 2243 6865      pprint(f"Che
-0002d260: 636b 696e 6720 6e6f 6e20 7363 6865 6475  cking non schedu
-0002d270: 6c65 6420 706f 6473 2063 6f75 6e74 206f  led pods count o
-0002d280: 6e20 636c 7573 7465 7220 7b6b 7562 657d  n cluster {kube}
-0002d290: 2229 0a20 2020 2020 2020 2073 656c 6563  ").        selec
-0002d2a0: 746f 7220 3d20 2221 6e6f 6465 2d72 6f6c  tor = "!node-rol
-0002d2b0: 652e 6b75 6265 726e 6574 6573 2e69 6f2f  e.kubernetes.io/
-0002d2c0: 636f 6e74 726f 6c2d 706c 616e 652c 6e6f  control-plane,no
-0002d2d0: 6465 2d72 6f6c 652e 6b75 6265 726e 6574  de-role.kubernet
-0002d2e0: 6573 2e69 6f2f 776f 726b 6572 220a 2020  es.io/worker".  
-0002d2f0: 2020 2020 2020 6375 7272 656e 7463 6d64        currentcmd
-0002d300: 203d 2066 226b 7562 6563 746c 2067 6574   = f"kubectl get
-0002d310: 206e 6f64 6520 2d2d 7365 6c65 6374 6f72   node --selector
-0002d320: 3d27 7b73 656c 6563 746f 727d 2722 0a20  ='{selector}'". 
-0002d330: 2020 2020 2020 2063 7572 7265 6e74 636d         currentcm
-0002d340: 6420 2b3d 2022 207c 2067 7265 7020 2720  d += " | grep ' 
-0002d350: 5265 6164 7927 220a 2020 2020 2020 2020  Ready'".        
-0002d360: 776f 726b 6572 7320 3d20 6c65 6e28 6f73  workers = len(os
-0002d370: 2e70 6f70 656e 2863 7572 7265 6e74 636d  .popen(currentcm
-0002d380: 6429 2e72 6561 646c 696e 6573 2829 290a  d).readlines()).
-0002d390: 2020 2020 2020 2020 7065 6e64 696e 6763          pendingc
-0002d3a0: 6d64 203d 2022 6b75 6265 6374 6c20 6765  md = "kubectl ge
-0002d3b0: 7420 706f 6473 202d 4120 2d2d 6669 656c  t pods -A --fiel
-0002d3c0: 642d 7365 6c65 6374 6f72 3d73 7461 7475  d-selector=statu
-0002d3d0: 732e 7068 6173 653d 5065 6e64 696e 6720  s.phase=Pending 
-0002d3e0: 2d6f 2079 616d 6c22 0a20 2020 2020 2020  -o yaml".       
-0002d3f0: 2070 656e 6469 6e67 5f70 6f64 7320 3d20   pending_pods = 
-0002d400: 7961 6d6c 2e73 6166 655f 6c6f 6164 286f  yaml.safe_load(o
-0002d410: 732e 706f 7065 6e28 7065 6e64 696e 6763  s.popen(pendingc
-0002d420: 6d64 292e 7265 6164 2829 295b 2769 7465  md).read())['ite
-0002d430: 6d73 275d 0a20 2020 2020 2020 2069 6620  ms'].        if 
-0002d440: 6c65 6e28 7065 6e64 696e 675f 706f 6473  len(pending_pods
-0002d450: 2920 3e20 7468 7265 7368 6f6c 643a 0a20  ) > threshold:. 
-0002d460: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0002d470: 7428 6622 5472 6967 6765 7269 6e67 2073  t(f"Triggering s
-0002d480: 6361 6c69 6e67 2075 7020 666f 7220 636c  caling up for cl
-0002d490: 7573 7465 7220 7b6b 7562 657d 2061 7320  uster {kube} as 
-0002d4a0: 7468 6572 6520 6172 6520 7b6c 656e 2870  there are {len(p
-0002d4b0: 656e 6469 6e67 5f70 6f64 7329 7d20 7065  ending_pods)} pe
-0002d4c0: 6e64 696e 6720 706f 6473 2229 0a20 2020  nding pods").   
-0002d4d0: 2020 2020 2020 2020 2077 6f72 6b65 7273           workers
-0002d4e0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0002d4f0: 2020 7070 7269 6e74 2822 5363 616c 696e    pprint("Scalin
-0002d500: 6720 7570 2063 6c75 7374 6572 207b 6b75  g up cluster {ku
-0002d510: 6265 7d20 746f 207b 776f 726b 6572 737d  be} to {workers}
-0002d520: 2077 6f72 6b65 7273 2229 0a20 2020 2020   workers").     
-0002d530: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0002d540: 7365 6c66 2e73 6361 6c65 5f6b 7562 6528  self.scale_kube(
-0002d550: 6b75 6265 2c20 6b75 6265 7479 7065 2c20  kube, kubetype, 
-0002d560: 6f76 6572 7269 6465 733d 7b27 776f 726b  overrides={'work
-0002d570: 6572 7327 3a20 776f 726b 6572 737d 290a  ers': workers}).
-0002d580: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0002d590: 6c74 5b27 776f 726b 6572 7327 5d20 3d20  lt['workers'] = 
-0002d5a0: 776f 726b 6572 730a 2020 2020 2020 2020  workers.        
-0002d5b0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0002d5c0: 740a 2020 2020 2020 2020 6e6f 6465 7320  t.        nodes 
-0002d5d0: 3d20 7b7d 0a20 2020 2020 2020 2063 7572  = {}.        cur
-0002d5e0: 7265 6e74 636d 6420 3d20 226b 7562 6563  rentcmd = "kubec
-0002d5f0: 746c 2067 6574 2070 6f64 202d 4120 2d6f  tl get pod -A -o
-0002d600: 2079 616d 6c22 0a20 2020 2020 2020 2061   yaml".        a
-0002d610: 6c6c 706f 6473 203d 2079 616d 6c2e 7361  llpods = yaml.sa
-0002d620: 6665 5f6c 6f61 6428 6f73 2e70 6f70 656e  fe_load(os.popen
-0002d630: 2863 7572 7265 6e74 636d 6429 2e72 6561  (currentcmd).rea
-0002d640: 6428 2929 5b27 6974 656d 7327 5d0a 2020  d())['items'].  
-0002d650: 2020 2020 2020 666f 7220 706f 6420 696e        for pod in
-0002d660: 2061 6c6c 706f 6473 3a0a 2020 2020 2020   allpods:.      
-0002d670: 2020 2020 2020 6e6f 6465 6e61 6d65 203d        nodename =
-0002d680: 2070 6f64 5b27 7370 6563 275d 5b27 6e6f   pod['spec']['no
-0002d690: 6465 4e61 6d65 275d 0a20 2020 2020 2020  deName'].       
-0002d6a0: 2020 2020 2073 7461 7475 7320 3d20 706f       status = po
-0002d6b0: 645b 2773 7461 7475 7327 5d5b 2770 6861  d['status']['pha
-0002d6c0: 7365 275d 0a20 2020 2020 2020 2020 2020  se'].           
-0002d6d0: 2069 6620 7374 6174 7573 2021 3d20 2752   if status != 'R
-0002d6e0: 756e 6e69 6e67 273a 0a20 2020 2020 2020  unning':.       
-0002d6f0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0002d700: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0002d710: 206e 6f64 656e 616d 6520 6e6f 7420 696e   nodename not in
-0002d720: 206e 6f64 6573 3a0a 2020 2020 2020 2020   nodes:.        
-0002d730: 2020 2020 2020 2020 6e6f 6465 735b 6e6f          nodes[no
-0002d740: 6465 6e61 6d65 5d20 3d20 310a 2020 2020  dename] = 1.    
-0002d750: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002d760: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0002d770: 6465 735b 6e6f 6465 6e61 6d65 5d20 2b3d  des[nodename] +=
-0002d780: 2031 0a20 2020 2020 2020 2074 6f64 656c   1.        todel
-0002d790: 6574 6520 3d20 300a 2020 2020 2020 2020  ete = 0.        
-0002d7a0: 666f 7220 6e6f 6465 2069 6e20 6e6f 6465  for node in node
-0002d7b0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0002d7c0: 6620 6e6f 6465 735b 6e6f 6465 5d20 3c20  f nodes[node] < 
-0002d7d0: 6964 6c65 3a0a 2020 2020 2020 2020 2020  idle:.          
-0002d7e0: 2020 2020 2020 7070 7269 6e74 2866 226e        pprint(f"n
-0002d7f0: 6f64 6520 7b6e 6f64 657d 2074 6f20 6265  ode {node} to be
-0002d800: 2072 656d 6f76 6564 2073 696e 6365 2069   removed since i
-0002d810: 7420 6f6e 6c79 2068 6173 2074 6865 2066  t only has the f
-0002d820: 6f6c 6c6f 7769 6e67 2070 6f64 733a 207b  ollowing pods: {
-0002d830: 6e6f 6465 735b 6e6f 6465 5d7d 2229 0a20  nodes[node]}"). 
-0002d840: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0002d850: 6f64 656c 6574 6520 2b3d 2031 0a20 2020  odelete += 1.   
-0002d860: 2020 2020 2069 6620 746f 6465 6c65 7465       if todelete
-0002d870: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0002d880: 2020 7070 7269 6e74 2866 2254 7269 6767    pprint(f"Trigg
-0002d890: 6572 696e 6720 7363 616c 696e 6720 646f  ering scaling do
-0002d8a0: 776e 2066 6f72 2063 6c75 7374 6572 207b  wn for cluster {
-0002d8b0: 6b75 6265 7d20 6173 2074 6865 7265 2061  kube} as there a
-0002d8c0: 7265 207b 746f 6465 6c65 7465 7d20 6964  re {todelete} id
-0002d8d0: 6c65 206e 6f64 6573 2229 0a20 2020 2020  le nodes").     
-0002d8e0: 2020 2020 2020 2077 6f72 6b65 7273 203d         workers =
-0002d8f0: 2077 6f72 6b65 7273 202d 2074 6f64 656c   workers - todel
-0002d900: 6574 650a 2020 2020 2020 2020 2020 2020  ete.            
-0002d910: 7070 7269 6e74 2866 2253 6361 6c69 6e67  pprint(f"Scaling
-0002d920: 2064 6f77 6e20 636c 7573 7465 7220 7b6b   down cluster {k
-0002d930: 7562 657d 2074 6f20 7b77 6f72 6b65 7273  ube} to {workers
-0002d940: 7d20 776f 726b 6572 7322 290a 2020 2020  } workers").    
-0002d950: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0002d960: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
-0002d970: 286b 7562 652c 206b 7562 6574 7970 652c  (kube, kubetype,
-0002d980: 206f 7665 7272 6964 6573 3d7b 2777 6f72   overrides={'wor
-0002d990: 6b65 7273 273a 2077 6f72 6b65 7273 7d29  kers': workers})
-0002d9a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0002d9b0: 756c 745b 2777 6f72 6b65 7273 275d 203d  ult['workers'] =
-0002d9c0: 2077 6f72 6b65 7273 0a20 2020 2020 2020   workers.       
-0002d9d0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-0002d9e0: 6c74 0a20 2020 2020 2020 2072 6574 7572  lt.        retur
-0002d9f0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-0002da00: 6363 6573 7327 2c20 2777 6f72 6b65 7273  ccess', 'workers
-0002da10: 273a 2077 6f72 6b65 7273 7d0a 0a20 2020  ': workers}..   
-0002da20: 2064 6566 206c 6f6f 705f 6175 746f 7363   def loop_autosc
-0002da30: 616c 655f 636c 7573 7465 7228 7365 6c66  ale_cluster(self
-0002da40: 2c20 6b75 6265 2c20 6b75 6265 7479 7065  , kube, kubetype
-0002da50: 2c20 776f 726b 6572 732c 2074 6872 6573  , workers, thres
-0002da60: 686f 6c64 2c20 6964 6c65 293a 0a20 2020  hold, idle):.   
-0002da70: 2020 2020 2070 7072 696e 7428 6622 5374       pprint(f"St
-0002da80: 6172 7469 6e67 2077 6974 6820 7b77 6f72  arting with {wor
-0002da90: 6b65 7273 7d20 776f 726b 6572 7322 290a  kers} workers").
-0002daa0: 2020 2020 2020 2020 6966 2077 6869 6368          if which
-0002dab0: 2827 6b75 6265 6374 6c27 2920 6973 204e  ('kubectl') is N
-0002dac0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002dad0: 2063 6f6d 6d6f 6e2e 6765 745f 6b75 6265   common.get_kube
-0002dae0: 6374 6c28 290a 2020 2020 2020 2020 2020  ctl().          
-0002daf0: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
-0002db00: 5448 275d 202b 3d20 273a 2e27 0a20 2020  TH'] += ':.'.   
-0002db10: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-0002db20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002db30: 6563 746f 7220 3d20 2221 6e6f 6465 2d72  ector = "!node-r
-0002db40: 6f6c 652e 6b75 6265 726e 6574 6573 2e69  ole.kubernetes.i
-0002db50: 6f2f 636f 6e74 726f 6c2d 706c 616e 652c  o/control-plane,
-0002db60: 6e6f 6465 2d72 6f6c 652e 6b75 6265 726e  node-role.kubern
-0002db70: 6574 6573 2e69 6f2f 776f 726b 6572 220a  etes.io/worker".
-0002db80: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0002db90: 656e 7463 6d64 203d 2066 226b 7562 6563  entcmd = f"kubec
-0002dba0: 746c 2067 6574 206e 6f64 6520 2d2d 7365  tl get node --se
-0002dbb0: 6c65 6374 6f72 3d27 7b73 656c 6563 746f  lector='{selecto
-0002dbc0: 727d 2722 0a20 2020 2020 2020 2020 2020  r}'".           
-0002dbd0: 2063 7572 7265 6e74 636d 6420 2b3d 2022   currentcmd += "
-0002dbe0: 207c 2067 7265 7020 2720 5265 6164 7927   | grep ' Ready'
-0002dbf0: 220a 2020 2020 2020 2020 2020 2020 6375  ".            cu
-0002dc00: 7272 656e 746e 6f64 6573 203d 206f 732e  rrentnodes = os.
-0002dc10: 706f 7065 6e28 6375 7272 656e 7463 6d64  popen(currentcmd
-0002dc20: 292e 7265 6164 6c69 6e65 7328 290a 2020  ).readlines().  
-0002dc30: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0002dc40: 2863 7572 7265 6e74 6e6f 6465 7329 2021  (currentnodes) !
-0002dc50: 3d20 776f 726b 6572 733a 0a20 2020 2020  = workers:.     
-0002dc60: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0002dc70: 7428 6622 4f6e 676f 696e 6720 7363 616c  t(f"Ongoing scal
-0002dc80: 696e 6720 6f70 6572 6174 696f 6e20 6f6e  ing operation on
-0002dc90: 2063 6c75 7374 6572 207b 6b75 6265 7d22   cluster {kube}"
-0002dca0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0002dcb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002dcc0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-0002dcd0: 662e 6175 746f 7363 616c 655f 636c 7573  f.autoscale_clus
-0002dce0: 7465 7228 6b75 6265 2c20 6b75 6265 7479  ter(kube, kubety
-0002dcf0: 7065 2c20 776f 726b 6572 732c 2074 6872  pe, workers, thr
-0002dd00: 6573 686f 6c64 2c20 6964 6c65 290a 2020  eshold, idle).  
-0002dd10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002dd20: 2072 6573 756c 745b 2772 6573 756c 7427   result['result'
-0002dd30: 5d20 213d 2027 7375 6363 6573 7327 3a0a  ] != 'success':.
-0002dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd50: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0002dd60: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0002dd70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002dd80: 2020 2020 2020 2020 2020 2020 776f 726b              work
-0002dd90: 6572 7320 3d20 7265 7375 6c74 5b27 776f  ers = result['wo
-0002dda0: 726b 6572 7327 5d0a 2020 2020 2020 2020  rkers'].        
-0002ddb0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0002ddc0: 6e74 2866 2243 7572 7265 6e74 2077 6f72  nt(f"Current wor
-0002ddd0: 6b65 7273 206e 756d 6265 7220 6465 7369  kers number desi
-0002dde0: 7265 643a 207b 776f 726b 6572 737d 2229  red: {workers}")
-0002ddf0: 0a20 2020 2020 2020 2020 2020 2073 6c65  .            sle
-0002de00: 6570 2836 3029 0a0a 2020 2020 6465 6620  ep(60)..    def 
-0002de10: 7468 7265 6164 6564 5f77 6562 5f63 6f6e  threaded_web_con
-0002de20: 736f 6c65 2873 656c 662c 2070 6f72 742c  sole(self, port,
-0002de30: 206e 616d 6529 3a0a 2020 2020 2020 2020   name):.        
-0002de40: 636f 6e73 6f6c 6520 3d20 4b6d 696e 6963  console = Kminic
-0002de50: 6f6e 736f 6c65 2863 6f6e 6669 673d 7365  onsole(config=se
-0002de60: 6c66 2c20 706f 7274 3d70 6f72 742c 206e  lf, port=port, n
-0002de70: 616d 653d 6e61 6d65 290a 2020 2020 2020  ame=name).      
-0002de80: 2020 636f 6e73 6f6c 652e 7275 6e28 290a    console.run().
-0002de90: 0a20 2020 2064 6566 2077 6562 636f 6e73  .    def webcons
-0002dea0: 6f6c 6528 7365 6c66 2c20 6e61 6d65 293a  ole(self, name):
-0002deb0: 0a20 2020 2020 2020 2070 6f72 7420 3d20  .        port = 
-0002dec0: 6765 745f 6672 6565 5f70 6f72 7428 290a  get_free_port().
-0002ded0: 2020 2020 2020 2020 7420 3d20 7468 7265          t = thre
-0002dee0: 6164 696e 672e 5468 7265 6164 2874 6172  ading.Thread(tar
-0002def0: 6765 743d 7365 6c66 2e74 6872 6561 6465  get=self.threade
-0002df00: 645f 7765 625f 636f 6e73 6f6c 652c 2061  d_web_console, a
-0002df10: 7267 733d 2870 6f72 742c 206e 616d 652c  rgs=(port, name,
-0002df20: 2929 0a20 2020 2020 2020 2074 2e73 7461  )).        t.sta
-0002df30: 7274 2829 0a20 2020 2020 2020 2077 6562  rt().        web
-0002df40: 6272 6f77 7365 722e 6f70 656e 2866 2268  browser.open(f"h
-0002df50: 7474 703a 2f2f 3132 372e 302e 302e 313a  ttp://127.0.0.1:
-0002df60: 7b70 6f72 747d 222c 206e 6577 3d32 2c20  {port}", new=2, 
-0002df70: 6175 746f 7261 6973 653d 5472 7565 290a  autoraise=True).
+0002cdb0: 646f 776e 6c6f 6164 3d46 616c 7365 2c20  download=False, 
+0002cdc0: 696e 7365 6375 7265 3d54 7275 652c 2076  insecure=True, v
+0002cdd0: 6d70 6f72 743d 766d 706f 7274 290a 2020  mport=vmport).  
+0002cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cdf0: 2020 6f73 2e73 7973 7465 6d28 7363 7063    os.system(scpc
+0002ce00: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
+0002ce10: 2020 2020 2020 2020 7570 6461 7465 645f          updated_
+0002ce20: 6669 6c65 732e 6170 7065 6e64 2864 6573  files.append(des
+0002ce30: 7469 6e61 7469 6f6e 290a 2020 2020 2020  tination).      
+0002ce40: 2020 7265 7475 726e 2075 7064 6174 6564    return updated
+0002ce50: 5f66 696c 6573 0a0a 2020 2020 6465 6620  _files..    def 
+0002ce60: 696e 666f 5f73 7065 6369 6669 635f 706c  info_specific_pl
+0002ce70: 616e 2873 656c 662c 2070 6c61 6e29 3a0a  an(self, plan):.
+0002ce80: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002ce90: 2250 726f 7669 6469 6e67 2069 6e66 6f72  "Providing infor
+0002cea0: 6d61 7469 6f6e 2061 626f 7574 2070 6c61  mation about pla
+0002ceb0: 6e20 7b70 6c61 6e7d 2229 0a20 2020 2020  n {plan}").     
+0002cec0: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
+0002ced0: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
+0002cee0: 5b5d 0a20 2020 2020 2020 2066 6f72 2076  [].        for v
+0002cef0: 6d20 696e 206b 2e6c 6973 7428 293a 0a20  m in k.list():. 
+0002cf00: 2020 2020 2020 2020 2020 2069 6620 766d             if vm
+0002cf10: 2e67 6574 2827 706c 616e 272c 2027 2729  .get('plan', '')
+0002cf20: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
+0002cf30: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0002cf40: 732e 6170 7065 6e64 2876 6d29 0a20 2020  s.append(vm).   
+0002cf50: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+0002cf60: 6c74 730a 0a20 2020 2064 6566 2061 7574  lts..    def aut
+0002cf70: 6f73 6361 6c65 5f63 6c75 7374 6572 2873  oscale_cluster(s
+0002cf80: 656c 662c 206b 7562 652c 206b 7562 6574  elf, kube, kubet
+0002cf90: 7970 652c 2077 6f72 6b65 7273 2c20 7468  ype, workers, th
+0002cfa0: 7265 7368 6f6c 642c 2069 646c 6529 3a0a  reshold, idle):.
+0002cfb0: 2020 2020 2020 2020 6966 2074 6872 6573          if thres
+0002cfc0: 686f 6c64 203e 2039 3939 393a 0a20 2020  hold > 9999:.   
+0002cfd0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0002cfe0: 6622 536b 6970 7069 6e67 2061 7574 6f73  f"Skipping autos
+0002cff0: 6361 6c69 6e67 2075 7020 6368 6563 6b73  caling up checks
+0002d000: 2066 6f72 2063 6c75 7374 6572 207b 6b75   for cluster {ku
+0002d010: 6265 7d20 6173 2070 6572 2074 6872 6573  be} as per thres
+0002d020: 686f 6c64 207b 7468 7265 7368 6f6c 647d  hold {threshold}
+0002d030: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0002d040: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+0002d050: 2027 7375 6363 6573 7327 2c20 2777 6f72   'success', 'wor
+0002d060: 6b65 7273 273a 2077 6f72 6b65 7273 7d0a  kers': workers}.
+0002d070: 2020 2020 2020 2020 6966 2069 646c 6520          if idle 
+0002d080: 3c20 313a 0a20 2020 2020 2020 2020 2020  < 1:.           
+0002d090: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
+0002d0a0: 6e67 2061 7574 6f73 6361 6c69 6e67 2064  ng autoscaling d
+0002d0b0: 6f77 6e20 6368 6563 6b73 2066 6f72 2063  own checks for c
+0002d0c0: 6c75 7374 6572 207b 6b75 6265 7d20 6173  luster {kube} as
+0002d0d0: 2070 6572 2069 646c 6520 7b69 646c 657d   per idle {idle}
+0002d0e0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0002d0f0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+0002d100: 2027 7375 6363 6573 7327 2c20 2777 6f72   'success', 'wor
+0002d110: 6b65 7273 273a 2077 6f72 6b65 7273 7d0a  kers': workers}.
+0002d120: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002d130: 2243 6865 636b 696e 6720 6e6f 6e20 7363  "Checking non sc
+0002d140: 6865 6475 6c65 6420 706f 6473 2063 6f75  heduled pods cou
+0002d150: 6e74 206f 6e20 636c 7573 7465 7220 7b6b  nt on cluster {k
+0002d160: 7562 657d 2229 0a20 2020 2020 2020 2073  ube}").        s
+0002d170: 656c 6563 746f 7220 3d20 2221 6e6f 6465  elector = "!node
+0002d180: 2d72 6f6c 652e 6b75 6265 726e 6574 6573  -role.kubernetes
+0002d190: 2e69 6f2f 636f 6e74 726f 6c2d 706c 616e  .io/control-plan
+0002d1a0: 652c 6e6f 6465 2d72 6f6c 652e 6b75 6265  e,node-role.kube
+0002d1b0: 726e 6574 6573 2e69 6f2f 776f 726b 6572  rnetes.io/worker
+0002d1c0: 220a 2020 2020 2020 2020 6375 7272 656e  ".        curren
+0002d1d0: 7463 6d64 203d 2066 226b 7562 6563 746c  tcmd = f"kubectl
+0002d1e0: 2067 6574 206e 6f64 6520 2d2d 7365 6c65   get node --sele
+0002d1f0: 6374 6f72 3d27 7b73 656c 6563 746f 727d  ctor='{selector}
+0002d200: 2722 0a20 2020 2020 2020 2063 7572 7265  '".        curre
+0002d210: 6e74 636d 6420 2b3d 2022 207c 2067 7265  ntcmd += " | gre
+0002d220: 7020 2720 5265 6164 7927 220a 2020 2020  p ' Ready'".    
+0002d230: 2020 2020 776f 726b 6572 7320 3d20 6c65      workers = le
+0002d240: 6e28 6f73 2e70 6f70 656e 2863 7572 7265  n(os.popen(curre
+0002d250: 6e74 636d 6429 2e72 6561 646c 696e 6573  ntcmd).readlines
+0002d260: 2829 290a 2020 2020 2020 2020 7065 6e64  ()).        pend
+0002d270: 696e 6763 6d64 203d 2022 6b75 6265 6374  ingcmd = "kubect
+0002d280: 6c20 6765 7420 706f 6473 202d 4120 2d2d  l get pods -A --
+0002d290: 6669 656c 642d 7365 6c65 6374 6f72 3d73  field-selector=s
+0002d2a0: 7461 7475 732e 7068 6173 653d 5065 6e64  tatus.phase=Pend
+0002d2b0: 696e 6720 2d6f 2079 616d 6c22 0a20 2020  ing -o yaml".   
+0002d2c0: 2020 2020 2070 656e 6469 6e67 5f70 6f64       pending_pod
+0002d2d0: 7320 3d20 7961 6d6c 2e73 6166 655f 6c6f  s = yaml.safe_lo
+0002d2e0: 6164 286f 732e 706f 7065 6e28 7065 6e64  ad(os.popen(pend
+0002d2f0: 696e 6763 6d64 292e 7265 6164 2829 295b  ingcmd).read())[
+0002d300: 2769 7465 6d73 275d 0a20 2020 2020 2020  'items'].       
+0002d310: 2069 6620 6c65 6e28 7065 6e64 696e 675f   if len(pending_
+0002d320: 706f 6473 2920 3e20 7468 7265 7368 6f6c  pods) > threshol
+0002d330: 643a 0a20 2020 2020 2020 2020 2020 2070  d:.            p
+0002d340: 7072 696e 7428 6622 5472 6967 6765 7269  print(f"Triggeri
+0002d350: 6e67 2073 6361 6c69 6e67 2075 7020 666f  ng scaling up fo
+0002d360: 7220 636c 7573 7465 7220 7b6b 7562 657d  r cluster {kube}
+0002d370: 2061 7320 7468 6572 6520 6172 6520 7b6c   as there are {l
+0002d380: 656e 2870 656e 6469 6e67 5f70 6f64 7329  en(pending_pods)
+0002d390: 7d20 7065 6e64 696e 6720 706f 6473 2229  } pending pods")
+0002d3a0: 0a20 2020 2020 2020 2020 2020 2077 6f72  .            wor
+0002d3b0: 6b65 7273 202b 3d20 310a 2020 2020 2020  kers += 1.      
+0002d3c0: 2020 2020 2020 7070 7269 6e74 2822 5363        pprint("Sc
+0002d3d0: 616c 696e 6720 7570 2063 6c75 7374 6572  aling up cluster
+0002d3e0: 207b 6b75 6265 7d20 746f 207b 776f 726b   {kube} to {work
+0002d3f0: 6572 737d 2077 6f72 6b65 7273 2229 0a20  ers} workers"). 
+0002d400: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0002d410: 7420 3d20 7365 6c66 2e73 6361 6c65 5f6b  t = self.scale_k
+0002d420: 7562 6528 6b75 6265 2c20 6b75 6265 7479  ube(kube, kubety
+0002d430: 7065 2c20 6f76 6572 7269 6465 733d 7b27  pe, overrides={'
+0002d440: 776f 726b 6572 7327 3a20 776f 726b 6572  workers': worker
+0002d450: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
+0002d460: 7265 7375 6c74 5b27 776f 726b 6572 7327  result['workers'
+0002d470: 5d20 3d20 776f 726b 6572 730a 2020 2020  ] = workers.    
+0002d480: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0002d490: 6573 756c 740a 2020 2020 2020 2020 6e6f  esult.        no
+0002d4a0: 6465 7320 3d20 7b7d 0a20 2020 2020 2020  des = {}.       
+0002d4b0: 2063 7572 7265 6e74 636d 6420 3d20 226b   currentcmd = "k
+0002d4c0: 7562 6563 746c 2067 6574 2070 6f64 202d  ubectl get pod -
+0002d4d0: 4120 2d6f 2079 616d 6c22 0a20 2020 2020  A -o yaml".     
+0002d4e0: 2020 2061 6c6c 706f 6473 203d 2079 616d     allpods = yam
+0002d4f0: 6c2e 7361 6665 5f6c 6f61 6428 6f73 2e70  l.safe_load(os.p
+0002d500: 6f70 656e 2863 7572 7265 6e74 636d 6429  open(currentcmd)
+0002d510: 2e72 6561 6428 2929 5b27 6974 656d 7327  .read())['items'
+0002d520: 5d0a 2020 2020 2020 2020 666f 7220 706f  ].        for po
+0002d530: 6420 696e 2061 6c6c 706f 6473 3a0a 2020  d in allpods:.  
+0002d540: 2020 2020 2020 2020 2020 6e6f 6465 6e61            nodena
+0002d550: 6d65 203d 2070 6f64 5b27 7370 6563 275d  me = pod['spec']
+0002d560: 5b27 6e6f 6465 4e61 6d65 275d 0a20 2020  ['nodeName'].   
+0002d570: 2020 2020 2020 2020 2073 7461 7475 7320           status 
+0002d580: 3d20 706f 645b 2773 7461 7475 7327 5d5b  = pod['status'][
+0002d590: 2770 6861 7365 275d 0a20 2020 2020 2020  'phase'].       
+0002d5a0: 2020 2020 2069 6620 7374 6174 7573 2021       if status !
+0002d5b0: 3d20 2752 756e 6e69 6e67 273a 0a20 2020  = 'Running':.   
+0002d5c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0002d5d0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0002d5e0: 2020 6966 206e 6f64 656e 616d 6520 6e6f    if nodename no
+0002d5f0: 7420 696e 206e 6f64 6573 3a0a 2020 2020  t in nodes:.    
+0002d600: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
+0002d610: 735b 6e6f 6465 6e61 6d65 5d20 3d20 310a  s[nodename] = 1.
+0002d620: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002d630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d640: 2020 6e6f 6465 735b 6e6f 6465 6e61 6d65    nodes[nodename
+0002d650: 5d20 2b3d 2031 0a20 2020 2020 2020 2074  ] += 1.        t
+0002d660: 6f64 656c 6574 6520 3d20 300a 2020 2020  odelete = 0.    
+0002d670: 2020 2020 666f 7220 6e6f 6465 2069 6e20      for node in 
+0002d680: 6e6f 6465 733a 0a20 2020 2020 2020 2020  nodes:.         
+0002d690: 2020 2069 6620 6e6f 6465 735b 6e6f 6465     if nodes[node
+0002d6a0: 5d20 3c20 6964 6c65 3a0a 2020 2020 2020  ] < idle:.      
+0002d6b0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0002d6c0: 2866 226e 6f64 6520 7b6e 6f64 657d 2074  (f"node {node} t
+0002d6d0: 6f20 6265 2072 656d 6f76 6564 2073 696e  o be removed sin
+0002d6e0: 6365 2069 7420 6f6e 6c79 2068 6173 2074  ce it only has t
+0002d6f0: 6865 2066 6f6c 6c6f 7769 6e67 2070 6f64  he following pod
+0002d700: 733a 207b 6e6f 6465 735b 6e6f 6465 5d7d  s: {nodes[node]}
+0002d710: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0002d720: 2020 2074 6f64 656c 6574 6520 2b3d 2031     todelete += 1
+0002d730: 0a20 2020 2020 2020 2069 6620 746f 6465  .        if tode
+0002d740: 6c65 7465 203e 2030 3a0a 2020 2020 2020  lete > 0:.      
+0002d750: 2020 2020 2020 7070 7269 6e74 2866 2254        pprint(f"T
+0002d760: 7269 6767 6572 696e 6720 7363 616c 696e  riggering scalin
+0002d770: 6720 646f 776e 2066 6f72 2063 6c75 7374  g down for clust
+0002d780: 6572 207b 6b75 6265 7d20 6173 2074 6865  er {kube} as the
+0002d790: 7265 2061 7265 207b 746f 6465 6c65 7465  re are {todelete
+0002d7a0: 7d20 6964 6c65 206e 6f64 6573 2229 0a20  } idle nodes"). 
+0002d7b0: 2020 2020 2020 2020 2020 2077 6f72 6b65             worke
+0002d7c0: 7273 203d 2077 6f72 6b65 7273 202d 2074  rs = workers - t
+0002d7d0: 6f64 656c 6574 650a 2020 2020 2020 2020  odelete.        
+0002d7e0: 2020 2020 7070 7269 6e74 2866 2253 6361      pprint(f"Sca
+0002d7f0: 6c69 6e67 2064 6f77 6e20 636c 7573 7465  ling down cluste
+0002d800: 7220 7b6b 7562 657d 2074 6f20 7b77 6f72  r {kube} to {wor
+0002d810: 6b65 7273 7d20 776f 726b 6572 7322 290a  kers} workers").
+0002d820: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0002d830: 6c74 203d 2073 656c 662e 7363 616c 655f  lt = self.scale_
+0002d840: 6b75 6265 286b 7562 652c 206b 7562 6574  kube(kube, kubet
+0002d850: 7970 652c 206f 7665 7272 6964 6573 3d7b  ype, overrides={
+0002d860: 2777 6f72 6b65 7273 273a 2077 6f72 6b65  'workers': worke
+0002d870: 7273 7d29 0a20 2020 2020 2020 2020 2020  rs}).           
+0002d880: 2072 6573 756c 745b 2777 6f72 6b65 7273   result['workers
+0002d890: 275d 203d 2077 6f72 6b65 7273 0a20 2020  '] = workers.   
+0002d8a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002d8b0: 7265 7375 6c74 0a20 2020 2020 2020 2072  result.        r
+0002d8c0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+0002d8d0: 2027 7375 6363 6573 7327 2c20 2777 6f72   'success', 'wor
+0002d8e0: 6b65 7273 273a 2077 6f72 6b65 7273 7d0a  kers': workers}.
+0002d8f0: 0a20 2020 2064 6566 206c 6f6f 705f 6175  .    def loop_au
+0002d900: 746f 7363 616c 655f 636c 7573 7465 7228  toscale_cluster(
+0002d910: 7365 6c66 2c20 6b75 6265 2c20 6b75 6265  self, kube, kube
+0002d920: 7479 7065 2c20 776f 726b 6572 732c 2074  type, workers, t
+0002d930: 6872 6573 686f 6c64 2c20 6964 6c65 293a  hreshold, idle):
+0002d940: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
+0002d950: 6622 5374 6172 7469 6e67 2077 6974 6820  f"Starting with 
+0002d960: 7b77 6f72 6b65 7273 7d20 776f 726b 6572  {workers} worker
+0002d970: 7322 290a 2020 2020 2020 2020 6966 2077  s").        if w
+0002d980: 6869 6368 2827 6b75 6265 6374 6c27 2920  hich('kubectl') 
+0002d990: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002d9a0: 2020 2020 2063 6f6d 6d6f 6e2e 6765 745f       common.get_
+0002d9b0: 6b75 6265 6374 6c28 290a 2020 2020 2020  kubectl().      
+0002d9c0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+0002d9d0: 5b27 5041 5448 275d 202b 3d20 273a 2e27  ['PATH'] += ':.'
+0002d9e0: 0a20 2020 2020 2020 2077 6869 6c65 2054  .        while T
+0002d9f0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+0002da00: 2073 656c 6563 746f 7220 3d20 2221 6e6f   selector = "!no
+0002da10: 6465 2d72 6f6c 652e 6b75 6265 726e 6574  de-role.kubernet
+0002da20: 6573 2e69 6f2f 636f 6e74 726f 6c2d 706c  es.io/control-pl
+0002da30: 616e 652c 6e6f 6465 2d72 6f6c 652e 6b75  ane,node-role.ku
+0002da40: 6265 726e 6574 6573 2e69 6f2f 776f 726b  bernetes.io/work
+0002da50: 6572 220a 2020 2020 2020 2020 2020 2020  er".            
+0002da60: 6375 7272 656e 7463 6d64 203d 2066 226b  currentcmd = f"k
+0002da70: 7562 6563 746c 2067 6574 206e 6f64 6520  ubectl get node 
+0002da80: 2d2d 7365 6c65 6374 6f72 3d27 7b73 656c  --selector='{sel
+0002da90: 6563 746f 727d 2722 0a20 2020 2020 2020  ector}'".       
+0002daa0: 2020 2020 2063 7572 7265 6e74 636d 6420       currentcmd 
+0002dab0: 2b3d 2022 207c 2067 7265 7020 2720 5265  += " | grep ' Re
+0002dac0: 6164 7927 220a 2020 2020 2020 2020 2020  ady'".          
+0002dad0: 2020 6375 7272 656e 746e 6f64 6573 203d    currentnodes =
+0002dae0: 206f 732e 706f 7065 6e28 6375 7272 656e   os.popen(curren
+0002daf0: 7463 6d64 292e 7265 6164 6c69 6e65 7328  tcmd).readlines(
+0002db00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0002db10: 206c 656e 2863 7572 7265 6e74 6e6f 6465   len(currentnode
+0002db20: 7329 2021 3d20 776f 726b 6572 733a 0a20  s) != workers:. 
+0002db30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002db40: 7072 696e 7428 6622 4f6e 676f 696e 6720  print(f"Ongoing 
+0002db50: 7363 616c 696e 6720 6f70 6572 6174 696f  scaling operatio
+0002db60: 6e20 6f6e 2063 6c75 7374 6572 207b 6b75  n on cluster {ku
+0002db70: 6265 7d22 290a 2020 2020 2020 2020 2020  be}").          
+0002db80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002db90: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002dba0: 2073 656c 662e 6175 746f 7363 616c 655f   self.autoscale_
+0002dbb0: 636c 7573 7465 7228 6b75 6265 2c20 6b75  cluster(kube, ku
+0002dbc0: 6265 7479 7065 2c20 776f 726b 6572 732c  betype, workers,
+0002dbd0: 2074 6872 6573 686f 6c64 2c20 6964 6c65   threshold, idle
+0002dbe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002dbf0: 2020 6966 2072 6573 756c 745b 2772 6573    if result['res
+0002dc00: 756c 7427 5d20 213d 2027 7375 6363 6573  ult'] != 'succes
+0002dc10: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+0002dc20: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0002dc30: 6573 756c 740a 2020 2020 2020 2020 2020  esult.          
+0002dc40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc60: 776f 726b 6572 7320 3d20 7265 7375 6c74  workers = result
+0002dc70: 5b27 776f 726b 6572 7327 5d0a 2020 2020  ['workers'].    
+0002dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc90: 7070 7269 6e74 2866 2243 7572 7265 6e74  pprint(f"Current
+0002dca0: 2077 6f72 6b65 7273 206e 756d 6265 7220   workers number 
+0002dcb0: 6465 7369 7265 643a 207b 776f 726b 6572  desired: {worker
+0002dcc0: 737d 2229 0a20 2020 2020 2020 2020 2020  s}").           
+0002dcd0: 2073 6c65 6570 2836 3029 0a0a 2020 2020   sleep(60)..    
+0002dce0: 6465 6620 7468 7265 6164 6564 5f77 6562  def threaded_web
+0002dcf0: 5f63 6f6e 736f 6c65 2873 656c 662c 2070  _console(self, p
+0002dd00: 6f72 742c 206e 616d 6529 3a0a 2020 2020  ort, name):.    
+0002dd10: 2020 2020 636f 6e73 6f6c 6520 3d20 4b6d      console = Km
+0002dd20: 696e 6963 6f6e 736f 6c65 2863 6f6e 6669  iniconsole(confi
+0002dd30: 673d 7365 6c66 2c20 706f 7274 3d70 6f72  g=self, port=por
+0002dd40: 742c 206e 616d 653d 6e61 6d65 290a 2020  t, name=name).  
+0002dd50: 2020 2020 2020 636f 6e73 6f6c 652e 7275        console.ru
+0002dd60: 6e28 290a 0a20 2020 2064 6566 2077 6562  n()..    def web
+0002dd70: 636f 6e73 6f6c 6528 7365 6c66 2c20 6e61  console(self, na
+0002dd80: 6d65 293a 0a20 2020 2020 2020 2070 6f72  me):.        por
+0002dd90: 7420 3d20 6765 745f 6672 6565 5f70 6f72  t = get_free_por
+0002dda0: 7428 290a 2020 2020 2020 2020 7420 3d20  t().        t = 
+0002ddb0: 7468 7265 6164 696e 672e 5468 7265 6164  threading.Thread
+0002ddc0: 2874 6172 6765 743d 7365 6c66 2e74 6872  (target=self.thr
+0002ddd0: 6561 6465 645f 7765 625f 636f 6e73 6f6c  eaded_web_consol
+0002dde0: 652c 2061 7267 733d 2870 6f72 742c 206e  e, args=(port, n
+0002ddf0: 616d 652c 2929 0a20 2020 2020 2020 2074  ame,)).        t
+0002de00: 2e73 7461 7274 2829 0a20 2020 2020 2020  .start().       
+0002de10: 2077 6562 6272 6f77 7365 722e 6f70 656e   webbrowser.open
+0002de20: 2866 2268 7474 703a 2f2f 3132 372e 302e  (f"http://127.0.
+0002de30: 302e 313a 7b70 6f72 747d 222c 206e 6577  0.1:{port}", new
+0002de40: 3d32 2c20 6175 746f 7261 6973 653d 5472  =2, autoraise=Tr
+0002de50: 7565 290a                                ue).
```

## kvirt/examples.py

```diff
@@ -155,24 +155,14 @@
 # Do the same but customize some parameters
 $ kcli create kube generic -P ctlplanes=1 -P workers=2 mykube
 
 # Use a parameter file
 $ kcli create kube generic --paramfile=myparameters.yml mykube
 """
 
-kubekindcreate = """# Create a kube kind instance named mykube with default values
-$ kcli create kube kind mykind
-
-# Do the same with workers
-$ kcli create kube kind -P workers=2 mykind
-
-# Use a parameter file
-$ kcli create kube kind --paramfile=myparameters.yml mykind
-"""
-
 kubemicroshiftcreate = """# Create a kube microshift instance named mymicroshift with default values
 $ kcli create kube microshift mymicroshift
 
 # Create a kube microshift instance named mymicroshift providing rhn creds on the commandline
 $ kcli create kube microshift -P rhnuser=xxx@good.es -P rhnpassword=supercool mymicroshift
 
 # Create a kube microshift instance named mymicroshift based on centos8stream
```

## kvirt/cluster/k3s/bootstrap.yml

```diff
@@ -2,15 +2,15 @@
   type: image
 {% if kubevirt_disk_size != None and config_type == 'kubevirt' %}
   size: {{ kubevirt_disk_size }}
 {% endif %}
 
 {% set all_files = files|default([]) %}
 {% set all_scripts = ["bootstrap.sh"] %}
-{% if config_type not in ['aws', 'gcp', 'ibm'] %}
+{% if config_type not in ['aws', 'gcp', 'ibm'] and api_ip != None %}
 {% do all_files.append("keepalived.conf") %}
 {% do all_scripts.append("keepalived.sh") %}
 {% endif %}
 
 {% if extra_ctlplane_networks %}
  {% set extra_networks = extra_ctlplane_networks %}
 {% endif %}
```

## kvirt/cluster/k3s/ctlplanes.yml

```diff
@@ -5,15 +5,15 @@
 {% endif %}
 {% if extra_ctlplane_disks %}
  {% set extra_disks = extra_ctlplane_disks %}
 {% endif %}
 
 {% set all_files = files|default([]) %}
 {% set all_scripts = ["ctlplanes.sh"] %}
-{% if config_type not in ['aws', 'gcp', 'ibm'] %}
+{% if config_type not in ['aws', 'gcp', 'ibm'] and api_ip != None %}
 {% do all_files.append("keepalived.conf") %}
 {% do all_scripts.append("keepalived.sh") %}
 {% elif config_type == 'gcp' %}
 {% do all_files.append({"path" : "/usr/local/bin/gcp-hack.sh", "origin": 'gcp-hack.sh', "mode": 755}) %}
 {% do all_files.append({"path" : "/usr/lib/systemd/system/gcp-hack.service", "origin": 'gcp-hack.service', "mode": 644}) %}
 {% endif %}
```

## kvirt/version/git

```diff
@@ -1 +1 @@
-97c773c 2023/05/08
+c852e72 2023/05/09
```

## Comparing `kcli-99.0.202305080926.dist-info/LICENSE` & `kcli-99.0.202305090950.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kcli-99.0.202305080926.dist-info/METADATA` & `kcli-99.0.202305090950.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kcli
-Version: 99.0.202305080926
+Version: 99.0.202305090950
 Summary: Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
 Home-page: http://github.com/karmab/kcli
 Author: Karim Boumedhel
 Author-email: karimboumedhel@gmail.com
 License: ASL
 Platform: UNKNOWN
 License-File: LICENSE
```

## Comparing `kcli-99.0.202305080926.dist-info/RECORD` & `kcli-99.0.202305090950.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 kvirt/__init__.py,sha256=eoZ6GfifbqhMLNzjlqRDVil-yyBkOmVN9ujSgJWNBlY,15
-kvirt/baseconfig.py,sha256=VmhNP3-G3J-FQVFhHvoZJ5FfvXq6i9dlFwZGm5_Fssg,100853
+kvirt/baseconfig.py,sha256=SzgYeUSNxobgg3R7EuQYV4ZMq2LsyQLxaIU0dJKiThE,100595
 kvirt/bottle.py,sha256=DMuCINuwVog8XC-D6nPFVzRmo6lnJZ1H3sNK2VICKKE,171487
-kvirt/cli.py,sha256=IdqcbyRzsXMoo1ao9jUinvxZfoZ9x9U-rzDSF0Ds5ro,251073
-kvirt/config.py,sha256=hTXWE4boZBtVV7zDUIw4ucRxM602rpE2KwUmTDUP6XM,188288
+kvirt/cli.py,sha256=YC0BlOji5MtWsZzw8A8MOtA_O-mndS0uN7P3fX-DIYE,249548
+kvirt/config.py,sha256=bprDRlsIBYK84Rl5prrN8tAV9NuDXzLSZNtX2egO3b8,187988
 kvirt/containerconfig.py,sha256=Pfp1wWU1u1S6S0IT00mWFEAa8FlbTV2qrFE21_cquWA,2851
 kvirt/defaults.py,sha256=Z8y97_PXEwZhuWVYqmW2Ej1gl87XtykXPygmgMpr3yc,11687
-kvirt/examples.py,sha256=riyTCaNWCfriBNgTPDog3kBraPN-D_n5mZZqqbq2yUY,18876
+kvirt/examples.py,sha256=POc1ATuIjoMnl8fhD39AYLzg9piH2T130FygHsL7AKI,18601
 kvirt/ignitionmerger.py,sha256=K22COM_XqYOG28ezUJzoRjQL-jbJqpFWgm7lUwDiVbE,4333
 kvirt/keywords.yaml,sha256=LalO2sLqsgqDa2w5esNYw8QlSOwsv30_Z3ECfNB5PTU,10280
 kvirt/klist.py,sha256=6rUa1Z7aH-Yx8MAVW-7TvB2DzteGkquBBlPQmei1p8E,3487
 kvirt/ansibleutils/__init__.py,sha256=uxy2it8uvuhDZSIlKOimpqPZtFTPsZ0AX_DLs5y7fSo,6009
 kvirt/cluster/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kvirt/cluster/hypershift/99-apps.yaml,sha256=nWmGvSlPFTU8roqqkO89Hd-1lDiCaMM8mp_G_f-7Epk,931
 kvirt/cluster/hypershift/99-forcedns,sha256=J53iIXocjMnmXRizQW2MiIOeg9MTqmA4xEKS6e5VXk8,694
@@ -34,30 +34,26 @@
 kvirt/cluster/hypershift/nodepool.yaml,sha256=h3mZpyNbnoqIPZx5YIn-r_FDNUfBeeKSCeM9aVGLHFc,766
 kvirt/cluster/hypershift/nonlocalbind.conf,sha256=eRCLfWYHqx2UgY3QE1pbXm2iFwERatyihNySEEbeuE8,60
 kvirt/cluster/hypershift/staticpods/coredns.yml,sha256=eWg3JyDJBEajn_jwvlx8SfvgEpe2GQUif-QWkPOFdW4,1992
 kvirt/cluster/hypershift/staticpods/keepalived.yml,sha256=3IP1snMk0P3l30qaCFAMtC2gGBYoAocRQ2UX5T2Gzoc,2244
 kvirt/cluster/hypershift/staticpods/mdns.yml,sha256=ttElI3ATZ2Y1kR1t5AJrcf-kdA6_t3RifaLOo4wU-IY,1721
 kvirt/cluster/k3s/__init__.py,sha256=wfGgaLkBY2Xx86TEQGfxlRxceBVzKCmBW8VTXWoabv8,11178
 kvirt/cluster/k3s/bootstrap.sh,sha256=FOIScuhKvrgrJWMJoixHt0F6guuCKeJ75lO7J5_4sCg,1081
-kvirt/cluster/k3s/bootstrap.yml,sha256=8Mj5XeIEPcX2gXNzf9wGK9OMFYARKSSgf_IJfNOh3fE,1031
+kvirt/cluster/k3s/bootstrap.yml,sha256=hQ6SyufxcFXp4p93_92lhL0mWh_Hr1ixg9kmHL5QeU8,1050
 kvirt/cluster/k3s/cloud_lb_api.yml,sha256=LdJU_0iPDPpj2UaBIvt6EX4w4DEOX1kn7T-50ZhsREU,305
 kvirt/cluster/k3s/ctlplanes.sh,sha256=2dPSucNNtgow8Q9_m7kuzGQ5el1LteX7MzObpZpeSfs,568
-kvirt/cluster/k3s/ctlplanes.yml,sha256=VpZkmJMps3xcW5PLa3zTK2xOSSajBCN0X0aT4xaj_io,1310
+kvirt/cluster/k3s/ctlplanes.yml,sha256=jG47m2RTA8iI-8sSXARab0EzWOC-digfFWv-CV7GM4Q,1329
 kvirt/cluster/k3s/gcp-hack.service,sha256=_qXIYflGx3ASpkA7CcawuQoTUAq3WW03Qc4esJWyIiY,214
 kvirt/cluster/k3s/gcp-hack.sh,sha256=cT2oRoHCuZzn_Ebuxj3l9FKHAAzNwxDQrVNo23yFD0s,390
 kvirt/cluster/k3s/join.sh,sha256=C_WUN5T2i87wfDe7bosWfE3bi_G0qV1f7jXGKpr77HQ,338
 kvirt/cluster/k3s/kcli_default.yml,sha256=w2ePXt44P1uVsPmyspXXHQ4-QTOy_RBb_Amqz3pFqAM,1207
 kvirt/cluster/k3s/keepalived.conf,sha256=XBC6ezpHtjHF2lUU9l3z7zvjp5YYHzGuAz30TXvsFCo,511
 kvirt/cluster/k3s/keepalived.sh,sha256=CpUcNspJekNZGqTBmLk6m_tCaulL5hmKEQLYj-Pxc5w,352
 kvirt/cluster/k3s/workers.sh,sha256=oVlb9rcwQtTiaz7bAC4PRIt6YfCwcBwjmZw_syJbsno,240
 kvirt/cluster/k3s/workers.yml,sha256=q2HenMnv0oAzZK28V1tADewZqIbYY0UlTxAh50TuPfo,914
-kvirt/cluster/kind/__init__.py,sha256=BwTq_vhgCRPlTcQXUFXmzG5rG3NN5oXPEBc8M7Ihr-U,2826
-kvirt/cluster/kind/config.yaml,sha256=tXdS_Rx-2ok4QAlWvR9tiCUInWjY7Kmbxzj69kazuh8,1115
-kvirt/cluster/kind/kcli_plan.yml,sha256=348Un8jOV7NsuWrx0AnYJftBgm6icayT4Cp3mbnoGg4,1505
-kvirt/cluster/kind/kcli_plan_default.yml,sha256=O5quxFlBgdMn68QTtdVX14H1u4Wwpmdeib7z9weSGK0,554
 kvirt/cluster/kubeadm/__init__.py,sha256=k8SxaR-c2srNhkOrRbQAr_TYKOKQ5G6jHEUlK7GWKrI,13530
 kvirt/cluster/kubeadm/bootstrap.sh,sha256=bM-p97BDmSlYvof0MehCaqASOycYtSDzDg_0jaowv_k,2707
 kvirt/cluster/kubeadm/bootstrap.yml,sha256=_ir1VAcHlggxsLlclaypz7VZxQUN2_ly7bEqfFcXt9A,1621
 kvirt/cluster/kubeadm/cloud_lb_api.yml,sha256=GnSSmlp-GVhUgPpd3fqyXSxgilyKqA6BmadyQ9z_jO4,325
 kvirt/cluster/kubeadm/ctlplanes.yml,sha256=PHkpHWdyapgr3M81uGc5GPv2LgtzUnsQjWwalL-5ICI,1367
 kvirt/cluster/kubeadm/deploy.sh,sha256=SjiS3NMTheOrfE6HZyqGpuI8iIFS24fNniCfQ0lXDSM,417
 kvirt/cluster/kubeadm/gcp-hack.service,sha256=_qXIYflGx3ASpkA7CcawuQoTUAq3WW03Qc4esJWyIiY,214
@@ -345,15 +341,15 @@
 kvirt/providers/ovirt/__init__.py,sha256=9znli5vpUeJOcNFqX4FuiQHJKRnm84ccOJ5uDGMbEPo,62531
 kvirt/providers/packet/__init__.py,sha256=QvNdslKLsv5BmPpr7mNUtleUa9L9sDKK7JEJdUfPff8,31099
 kvirt/providers/vsphere/__init__.py,sha256=pEMaRkkDegS77VbMR_Q8I0W4nqdnOMCFmiT1WG3Meio,73086
 kvirt/providers/vsphere/helpers.py,sha256=F1rB_AHISd8TFYQ6eRolQmCVqU8KFAa36CCwjDj-vqw,13655
 kvirt/providers/vsphere/tagging.py,sha256=7RqFIUETSzHAjS0F_8-j145-_8lca7aDUsCxs4DhQVQ,4893
 kvirt/providers/web/__init__.py,sha256=jHLAJAVGJ-1m5530cs6zPCR7Mo8OieiAgC3ZPczpesk,21273
 kvirt/version/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kvirt/version/git,sha256=G7mTZdXPQl8YauEhC_xD9zjKBMh_V6I-NSdjdcRNOX4,19
+kvirt/version/git,sha256=TGu4Hz2qC3a8sB0sz3fOJ3_6983qLRoE41X5JJIX7eA,19
 kvirt/web/__init__.py,sha256=pCYLpSFRyCKVkqv6WUXcJiYtX0A-EdVyvZeybCL7trg,46950
 kvirt/web/main.py,sha256=DIb6tW3ce7wCc83kD9HBCG4ALJuLItp9uaP6tzdsm_Y,261
 kvirt/web/static/css/bootstrap-notify.css,sha256=ibUTW-jDj-F8d1T1KZ4DOujRmVTFfvMKL9y14QgEaPQ,408
 kvirt/web/static/css/bootstrap-theme.min.css,sha256=ZT4HPpdCOt2lvDkXokHuhJfdOKSPFLzeAJik5U_Q-l4,23409
 kvirt/web/static/css/bootstrap.min.css,sha256=E-dwlJxOS7dOrKCvR-5WCqiHCbIHLl59MMDVsfU4oiU,121125
 kvirt/web/static/css/dataTables.checkboxes.css,sha256=H-x4lWeyX3jMsghnkCUUTO2lXjRpJ8pxhUj3YAqaBrQ,399
 kvirt/web/static/css/jquery.dataTables.min.css,sha256=-Z1rYa3ys5OdZNUck5G7lBvb8A13OrYwvf-d8PfEaHQ,13587
@@ -587,13 +583,13 @@
 kvirt/web/templates/repos.html,sha256=HaFCTQjX3zSaqyV05Y_wG0vSkOWDpc-wj6Uj5TLbiFg,475
 kvirt/web/templates/repostable.html,sha256=6HH8sgdppR-yojQspdcI59ju4e9HZYVvV6uvnPxqbeo,1203
 kvirt/web/templates/vmcreate.html,sha256=FG3OoQEKTpeo8spJ1WiqYVkOp672saYRQKujNWOA3uQ,958
 kvirt/web/templates/vmprofiles.html,sha256=T65Cv7povhBtD2dyuWkWJE6byaA9EYtLSk5gtcQlHIU,486
 kvirt/web/templates/vmprofilestable.html,sha256=-8viNOqSvN_yzimENxq7Q0187zbflOn8p8zpgx0Vyek,1420
 kvirt/web/templates/vms.html,sha256=k2ptKeiLFdpzgfbk6xi__sduu0UALYXXrnrmDEmAfaQ,470
 kvirt/web/templates/vmstable.html,sha256=ikuYkIm_ocvGIBXFyJt1-tBjwQWCyqkgC08leoXgR54,4894
-kcli-99.0.202305080926.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-kcli-99.0.202305080926.dist-info/METADATA,sha256=0SRqHsFD640JYuFqjKmIqaWowWdcnrz2mp7fdK6AX18,2914
-kcli-99.0.202305080926.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-kcli-99.0.202305080926.dist-info/entry_points.txt,sha256=Rks05_15yZkzTe2QTbrkV_O8uruW_WjUDzmfMApHUvw,209
-kcli-99.0.202305080926.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
-kcli-99.0.202305080926.dist-info/RECORD,,
+kcli-99.0.202305090950.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+kcli-99.0.202305090950.dist-info/METADATA,sha256=9z3cv_i56OXNXLAmVccsiC65UXcgrrtQbpxMfTKLT68,2914
+kcli-99.0.202305090950.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+kcli-99.0.202305090950.dist-info/entry_points.txt,sha256=Rks05_15yZkzTe2QTbrkV_O8uruW_WjUDzmfMApHUvw,209
+kcli-99.0.202305090950.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
+kcli-99.0.202305090950.dist-info/RECORD,,
```

