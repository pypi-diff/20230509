# Comparing `tmp/returnn-1.20230509.160323.tar.gz` & `tmp/returnn-1.20230509.190819.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/returnn-1.20230509.160323.tar", last modified: Tue May  9 14:27:16 2023, max compression
+gzip compressed data, was "dist/returnn-1.20230509.190819.tar", last modified: Tue May  9 17:25:23 2023, max compression
```

## Comparing `returnn-1.20230509.160323.tar` & `returnn-1.20230509.190819.tar`

### file list

```diff
@@ -1,440 +1,441 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/
--rw-r--r--   0 runner    (1001) docker     (123)      198 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.editorconfig
--rw-r--r--   0 runner    (1001) docker     (123)      526 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)      828 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.gitmodules
--rw-r--r--   0 runner    (1001) docker     (123)       79 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.kateconfig
--rw-r--r--   0 runner    (1001) docker     (123)     8556 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/CHANGELOG.md
--rw-r--r--   0 runner    (1001) docker     (123)      704 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/CODEOWNERS
--rw-r--r--   0 runner    (1001) docker     (123)     4880 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/CONTRIBUTING.md
--rw-r--r--   0 runner    (1001) docker     (123)    10244 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      579 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/README.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)       77 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/_setup_info_generated.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/
--rw-r--r--   0 runner    (1001) docker     (123)    36006 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/12AX.cluster_map
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/_setup_returnn_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-fwd.config
--rw-r--r--   0 runner    (1001) docker     (123)     2703 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-horovod-mpi.py
--rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-horovod-mpi.py.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)      264 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-horovod-mpi.sh
--rw-r--r--   0 runner    (1001) docker     (123)     1756 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-hyper-param-tuning.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     2396 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-iter-dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3635 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-list-devices.py
--rw-r--r--   0 runner    (1001) docker     (123)     2848 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-lua-torch-layer.config
--rw-r--r--   0 runner    (1001) docker     (123)      487 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-pretrain.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     2331 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-record-and-push-to-webserver.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1950 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-returnn-as-framework.py
--rw-r--r--   0 runner    (1001) docker     (123)     3040 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-rf.config
--rw-r--r--   0 runner    (1001) docker     (123)     2331 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-rhn-enwik8.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     1378 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-sprint-interface.py
--rw-r--r--   0 runner    (1001) docker     (123)     3147 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-att-copy.config
--rw-r--r--   0 runner    (1001) docker     (123)     2428 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-attention.config
--rw-r--r--   0 runner    (1001) docker     (123)     1481 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-chunking-blstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-contribrnn-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     3073 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-enc-dec.config
--rwxr-xr-x   0 runner    (1001) docker     (123)    11615 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-hard-att-copy.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     7287 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-lstm-benchmark.py
--rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-maxgradnorm-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1413 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm-lowmem.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1075 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.tuned.config
--rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-neural-transducer.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1825 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-rec-explicit-lstm.config
--rw-r--r--   0 runner    (1001) docker     (123)     1202 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-rec-explicit-rnn.config
--rw-r--r--   0 runner    (1001) docker     (123)     2018 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-rec-self-att.config
--rw-r--r--   0 runner    (1001) docker     (123)     5188 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-search-compiled-graph.py
--rw-r--r--   0 runner    (1001) docker     (123)     1430 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-vanilla-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     4818 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-timit-lstm-ctc.config
--rw-r--r--   0 runner    (1001) docker     (123)     2855 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-torch.config
--rw-r--r--   0 runner    (1001) docker     (123)      766 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-upd-mult-model.lstm.12ax.config
--rwxr-xr-x   0 runner    (1001) docker     (123)      651 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo.sh
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/
--rwxr-xr-x   0 runner    (1001) docker     (123)    43239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png
--rwxr-xr-x   0 runner    (1001) docker     (123)    43552 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-04.png
--rwxr-xr-x   0 runner    (1001) docker     (123)    45111 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-06.png
--rw-r--r--   0 runner    (1001) docker     (123)     1709 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/README.txt
--rw-r--r--   0 runner    (1001) docker     (123)      158 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/chars.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1896 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/config_demo
--rw-r--r--   0 runner    (1001) docker     (123)     1981 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/config_fwd
--rw-r--r--   0 runner    (1001) docker     (123)     1983 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/config_real
--rwxr-xr-x   0 runner    (1001) docker     (123)    10194 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/create_IAM_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      749 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/decode.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/features/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/features/raw/
--rw-r--r--   0 runner    (1001) docker     (123)   248580 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/features/raw/demo.h5
--rwxr-xr-x   0 runner    (1001) docker     (123)       86 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      235 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/lines.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/
--rw-r--r--   0 runner    (1001) docker     (123)     2712 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/eval.txt
--rw-r--r--   0 runner    (1001) docker     (123)    69536 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/train.txt
--rw-r--r--   0 runner    (1001) docker     (123)      934 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/valid.txt
--rw-r--r--   0 runner    (1001) docker     (123)      230 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/
--rwxr-xr-x   0 runner    (1001) docker     (123)     2804 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/create_test_h5.py
--rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/forwardconfig
--rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/trainconfig
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/
--rwxr-xr-x   0 runner    (1001) docker     (123)     2966 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/create_test_h5.py
--rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/forwardconfig
--rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/trainconfig
--rw-r--r--   0 runner    (1001) docker     (123)      463 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)       18 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/requirements.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/
--rw-r--r--   0 runner    (1001) docker     (123)     1012 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    24324 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__main__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__old_mod_loader__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4659 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__setup__.py
--rw-r--r--   0 runner    (1001) docker     (123)    24267 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/config.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/datasets/
--rw-r--r--   0 runner    (1001) docker     (123)      390 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    18032 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/audio.py
--rw-r--r--   0 runner    (1001) docker     (123)    62931 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/bundle_file.py
--rw-r--r--   0 runner    (1001) docker     (123)    24892 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/cached.py
--rw-r--r--   0 runner    (1001) docker     (123)    11658 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/cached2.py
--rw-r--r--   0 runner    (1001) docker     (123)    94213 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/generating.py
--rw-r--r--   0 runner    (1001) docker     (123)    65113 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/hdf.py
--rw-r--r--   0 runner    (1001) docker     (123)    85120 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/lm.py
--rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/map.py
--rw-r--r--   0 runner    (1001) docker     (123)    75821 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/meta.py
--rw-r--r--   0 runner    (1001) docker     (123)    11167 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/multi_proc.py
--rw-r--r--   0 runner    (1001) docker     (123)    14596 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/normalization_data.py
--rw-r--r--   0 runner    (1001) docker     (123)     5291 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/numpy_dump.py
--rw-r--r--   0 runner    (1001) docker     (123)     9127 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/raw_wav.py
--rw-r--r--   0 runner    (1001) docker     (123)    56015 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/sprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    17608 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/stereo.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/datasets/util/
--rw-r--r--   0 runner    (1001) docker     (123)       52 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    23915 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/util/feature_extraction.py
--rw-r--r--   0 runner    (1001) docker     (123)    20445 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/util/vocabulary.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/engine/
--rw-r--r--   0 runner    (1001) docker     (123)      228 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/engine/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9325 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/engine/base.py
--rw-r--r--   0 runner    (1001) docker     (123)     9912 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/engine/batch.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/
--rw-r--r--   0 runner    (1001) docker     (123)     4005 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4024 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/
--rw-r--r--   0 runner    (1001) docker     (123)       65 2023-05-09 14:26:47.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/.git
--rw-r--r--   0 runner    (1001) docker     (123)        6 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1448 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/README.md
--rw-r--r--   0 runner    (1001) docker     (123)    13770 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/aligner.gif
--rw-r--r--   0 runner    (1001) docker     (123)    51077 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/check.png
--rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.cu
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.h
--rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core_cpu.cpp
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/
--rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)       70 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     2089 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     3485 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp
--rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h
--rw-r--r--   0 runner    (1001) docker     (123)       28 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/requirements.txt
--rw-r--r--   0 runner    (1001) docker     (123)     2079 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/
--rw-r--r--   0 runner    (1001) docker     (123)     2885 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6961 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py
--rw-r--r--   0 runner    (1001) docker     (123)     4141 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/ref_rna.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/
--rw-r--r--   0 runner    (1001) docker     (123)     6150 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/
--rw-r--r--   0 runner    (1001) docker     (123)     1693 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc
--rw-r--r--   0 runner    (1001) docker     (123)     6030 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/
--rw-r--r--   0 runner    (1001) docker     (123)     2076 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/test.cpp
--rw-r--r--   0 runner    (1001) docker     (123)      135 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     1239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8479 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/edit.py
--rw-r--r--   0 runner    (1001) docker     (123)    19826 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/reroute.py
--rw-r--r--   0 runner    (1001) docker     (123)    29772 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/select.py
--rw-r--r--   0 runner    (1001) docker     (123)    26578 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/subgraph.py
--rw-r--r--   0 runner    (1001) docker     (123)    30380 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/transform.py
--rw-r--r--   0 runner    (1001) docker     (123)    18727 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/util.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/frontend/
--rw-r--r--   0 runner    (1001) docker     (123)     1260 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    37689 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/_numpy_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5127 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17465 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/array_.py
--rw-r--r--   0 runner    (1001) docker     (123)    20833 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/attention.py
--rw-r--r--   0 runner    (1001) docker     (123)     1023 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/cond.py
--rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/const.py
--rw-r--r--   0 runner    (1001) docker     (123)     6015 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/container.py
--rw-r--r--   0 runner    (1001) docker     (123)      413 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/control_flow_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)    22357 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/conv.py
--rw-r--r--   0 runner    (1001) docker     (123)      519 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/device.py
--rw-r--r--   0 runner    (1001) docker     (123)     3538 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/dims.py
--rw-r--r--   0 runner    (1001) docker     (123)     3334 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/dropout.py
--rw-r--r--   0 runner    (1001) docker     (123)      964 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/dtype.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/frontend/encoder/
--rw-r--r--   0 runner    (1001) docker     (123)       17 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/encoder/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2109 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/encoder/base.py
--rw-r--r--   0 runner    (1001) docker     (123)    15428 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/encoder/conformer.py
--rw-r--r--   0 runner    (1001) docker     (123)      330 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/gradient.py
--rw-r--r--   0 runner    (1001) docker     (123)     5855 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/init.py
--rw-r--r--   0 runner    (1001) docker     (123)     2147 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/linear.py
--rw-r--r--   0 runner    (1001) docker     (123)      808 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/loop.py
--rw-r--r--   0 runner    (1001) docker     (123)     1898 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/loss.py
--rw-r--r--   0 runner    (1001) docker     (123)    13440 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/math_.py
--rw-r--r--   0 runner    (1001) docker     (123)     1945 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/matmul.py
--rw-r--r--   0 runner    (1001) docker     (123)     9877 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/module.py
--rw-r--r--   0 runner    (1001) docker     (123)     9687 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/normalization.py
--rw-r--r--   0 runner    (1001) docker     (123)     7158 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/parameter.py
--rw-r--r--   0 runner    (1001) docker     (123)    10723 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/rand.py
--rw-r--r--   0 runner    (1001) docker     (123)     2374 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/rec.py
--rw-r--r--   0 runner    (1001) docker     (123)     4750 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/reduce.py
--rw-r--r--   0 runner    (1001) docker     (123)    12245 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/run_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)     9385 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/signal.py
--rw-r--r--   0 runner    (1001) docker     (123)     2188 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/state.py
--rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/types.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/import_/
--rw-r--r--   0 runner    (1001) docker     (123)      243 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8148 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    13961 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/git.py
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/import_.py
--rw-r--r--   0 runner    (1001) docker     (123)    33063 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/learning_rate_control.py
--rw-r--r--   0 runner    (1001) docker     (123)    11738 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/log.py
--rw-r--r--   0 runner    (1001) docker     (123)    35760 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/native_op.cpp
--rw-r--r--   0 runner    (1001) docker     (123)   244393 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/native_op.py
--rw-r--r--   0 runner    (1001) docker     (123)    23542 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/pretrain.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/sprint/
--rw-r--r--   0 runner    (1001) docker     (123)       64 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    31545 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/cache.py
--rw-r--r--   0 runner    (1001) docker     (123)    31137 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/control.py
--rw-r--r--   0 runner    (1001) docker     (123)    23313 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/error_signals.py
--rw-r--r--   0 runner    (1001) docker     (123)    12305 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/extern_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    36475 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tensor/
--rw-r--r--   0 runner    (1001) docker     (123)      501 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    99004 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_dim_extra.py
--rw-r--r--   0 runner    (1001) docker     (123)   157144 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_tensor_extra.py
--rw-r--r--   0 runner    (1001) docker     (123)      643 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_tensor_mixin_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     4890 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_tensor_op_overloads.py
--rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/control_flow_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)     3884 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/dim.py
--rw-r--r--   0 runner    (1001) docker     (123)     1884 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/marked_dim.py
--rw-r--r--   0 runner    (1001) docker     (123)     7491 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/tensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     4187 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/tensor_dict.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/
--rw-r--r--   0 runner    (1001) docker     (123)       88 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1632 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/compat.py
--rw-r--r--   0 runner    (1001) docker     (123)    36852 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/data_pipeline.py
--rw-r--r--   0 runner    (1001) docker     (123)    15108 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/distributed.py
--rw-r--r--   0 runner    (1001) docker     (123)   151443 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/engine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/
--rw-r--r--   0 runner    (1001) docker     (123)      452 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    37861 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     3702 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    14297 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/cond.py
--rw-r--r--   0 runner    (1001) docker     (123)     4304 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/config_entry_points.py
--rw-r--r--   0 runner    (1001) docker     (123)      888 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/debug_eager_mode.py
--rw-r--r--   0 runner    (1001) docker     (123)     5712 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/dims.py
--rw-r--r--   0 runner    (1001) docker     (123)    71987 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/layer.py
--rw-r--r--   0 runner    (1001) docker     (123)    15829 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/make_layer.py
--rw-r--r--   0 runner    (1001) docker     (123)     5107 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/parameter_assign.py
--rw-r--r--   0 runner    (1001) docker     (123)     2239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/prev_tensor_ref.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/frontend_low_level/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_low_level/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20261 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_low_level/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5404 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/horovod.py
--rw-r--r--   0 runner    (1001) docker     (123)    31611 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/hyper_param_tuning.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/layers/
--rw-r--r--   0 runner    (1001) docker     (123)       72 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   149447 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/base.py
--rw-r--r--   0 runner    (1001) docker     (123)   585273 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)   539812 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/rec.py
--rw-r--r--   0 runner    (1001) docker     (123)    21515 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/segmental_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    52409 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/signal_processing.py
--rw-r--r--   0 runner    (1001) docker     (123)    11239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/variable.py
--rw-r--r--   0 runner    (1001) docker     (123)    79733 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/native_op.py
--rw-r--r--   0 runner    (1001) docker     (123)   222320 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/network.py
--rw-r--r--   0 runner    (1001) docker     (123)     5471 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/sprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    71410 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/updater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/util/
--rw-r--r--   0 runner    (1001) docker     (123)       92 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   296804 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)    28839 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/data.py
--rw-r--r--   0 runner    (1001) docker     (123)    17333 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/ken_lm.py
--rw-r--r--   0 runner    (1001) docker     (123)    11277 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/open_fst.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/
--rw-r--r--   0 runner    (1001) docker     (123)       85 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       24 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/data/
--rw-r--r--   0 runner    (1001) docker     (123)      132 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9483 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/pipeline.py
--rw-r--r--   0 runner    (1001) docker     (123)     5410 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/returnn_dataset_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/tensor_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/engine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/frontend/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    60006 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     1830 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/_rand.py
--rw-r--r--   0 runner    (1001) docker     (123)     2714 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/bridge.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/functional/
--rw-r--r--   0 runner    (1001) docker     (123)      193 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/functional/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       26 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/functional/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11449 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/updater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/util/
--rw-r--r--   0 runner    (1001) docker     (123)      336 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   144927 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)    59572 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/better_exchook.py
--rw-r--r--   0 runner    (1001) docker     (123)    17977 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/bpe.py
--rw-r--r--   0 runner    (1001) docker     (123)    15987 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/debug.py
--rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/debug_helpers.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    59177 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/fsa.py
--rw-r--r--   0 runner    (1001) docker     (123)     2009 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/literal_py_to_pickle.py
--rw-r--r--   0 runner    (1001) docker     (123)     8131 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/pprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    14846 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/py-to-pickle.cpp
--rw-r--r--   0 runner    (1001) docker     (123)      277 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/py_compat.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     7273 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/sig_proc.py
--rw-r--r--   0 runner    (1001) docker     (123)    27230 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/task_system.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    12268 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/top_level.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)      461 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/rnn.py
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     4159 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/
--rwxr-xr-x   0 runner    (1001) docker     (123)     3392 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/DummySprintExec.py
--rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm-inspection-profile.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/.name
--rw-r--r--   0 runner    (1001) docker     (123)      512 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyleSettings.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyles/
--rw-r--r--   0 runner    (1001) docker     (123)      328 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyles/Project.xml
--rw-r--r--   0 runner    (1001) docker     (123)      142 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyles/codeStyleConfig.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/
--rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml
--rw-r--r--   0 runner    (1001) docker     (123)      181 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/profiles_settings.xml
--rw-r--r--   0 runner    (1001) docker     (123)      318 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/misc.xml
--rw-r--r--   0 runner    (1001) docker     (123)      267 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/modules.xml
--rw-r--r--   0 runner    (1001) docker     (123)      417 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/returnn.iml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/scopes/
--rw-r--r--   0 runner    (1001) docker     (123)      139 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/scopes/scope_settings.xml
--rw-r--r--   0 runner    (1001) docker     (123)      871 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/_set_num_threads1.py
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/_setup_returnn_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     8833 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/_setup_test_env.py
--rw-r--r--   0 runner    (1001) docker     (123)      794 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/bpe-unicode-demo.codes
--rw-r--r--   0 runner    (1001) docker     (123)     2205 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/bpe-unicode-demo.vocab
--rw-r--r--   0 runner    (1001) docker     (123)      386 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.fst
--rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.isyms
--rw-r--r--   0 runner    (1001) docker     (123)    34282 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.jpg
--rw-r--r--   0 runner    (1001) docker     (123)       41 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.osyms
--rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lint_common.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    29203 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/pycharm-inspect.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2960 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/pylint.py
--rw-r--r--   0 runner    (1001) docker     (123)     2963 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/returnn-as-framework.py
--rw-r--r--   0 runner    (1001) docker     (123)    11619 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/rf_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      617 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/spelling.dic
--rw-r--r--   0 runner    (1001) docker     (123)     7845 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Config.py
--rw-r--r--   0 runner    (1001) docker     (123)    18921 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    13634 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Fsa.py
--rw-r--r--   0 runner    (1001) docker     (123)     8904 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_GeneratingDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    32796 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_HDFDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    10326 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_LearningRateControl.py
--rw-r--r--   0 runner    (1001) docker     (123)     7187 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Log.py
--rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_MultiProcDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3333 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_PTDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     2465 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Pretrain.py
--rw-r--r--   0 runner    (1001) docker     (123)    21403 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_ResNet.py
--rw-r--r--   0 runner    (1001) docker     (123)     5014 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_SprintDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3330 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_SprintInterface.py
--rw-r--r--   0 runner    (1001) docker     (123)   238053 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFEngine.py
--rw-r--r--   0 runner    (1001) docker     (123)   135453 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNativeOp.py
--rw-r--r--   0 runner    (1001) docker     (123)   551354 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNetworkLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)   549696 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNetworkRecLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    14485 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNetworkSigProcLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    20440 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFUpdater.py
--rw-r--r--   0 runner    (1001) docker     (123)   187644 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFUtil.py
--rw-r--r--   0 runner    (1001) docker     (123)     3082 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TF_determinism.py
--rw-r--r--   0 runner    (1001) docker     (123)     2156 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TaskSystem.py
--rw-r--r--   0 runner    (1001) docker     (123)     5088 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TaskSystem_SharedMem.py
--rw-r--r--   0 runner    (1001) docker     (123)     9378 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TranslationDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Util.py
--rw-r--r--   0 runner    (1001) docker     (123)    10578 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_demos.py
--rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_fork_exec.py
--rw-r--r--   0 runner    (1001) docker     (123)     2893 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_hdf_dump.py
--rw-r--r--   0 runner    (1001) docker     (123)     4725 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_array.py
--rw-r--r--   0 runner    (1001) docker     (123)     4491 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_attention.py
--rw-r--r--   0 runner    (1001) docker     (123)     7608 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     9490 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_cond.py
--rw-r--r--   0 runner    (1001) docker     (123)     4591 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_container.py
--rw-r--r--   0 runner    (1001) docker     (123)    10228 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_conv.py
--rw-r--r--   0 runner    (1001) docker     (123)     1963 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_encoder_conformer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2312 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_math.py
--rw-r--r--   0 runner    (1001) docker     (123)     1933 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_normalization.py
--rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_rec.py
--rw-r--r--   0 runner    (1001) docker     (123)     1052 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_signal.py
--rw-r--r--   0 runner    (1001) docker     (123)     1135 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_tensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     8435 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)    15594 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_torch_frontend.py
--rw-r--r--   0 runner    (1001) docker     (123)    15534 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_torch_internal_frontend.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/_setup_returnn_env.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     9650 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/analyze-dataset-batches.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3943 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-collect-seq-lens.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      780 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-dump-text.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6608 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-get-segment-names.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    18221 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-to-ogg-zip.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5644 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bpe-create-lexicon.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    10532 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/calculate-word-error-rate.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1759 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/cleanup-old-models.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    10783 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/collect-orth-symbols.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6801 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/collect-words.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     4395 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/compile_native_op.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    81620 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/compile_tf_graph.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     8500 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/debug-dump-search-scores.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    47001 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/debug-plot-search-scores.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6048 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-dataset-raw-strings.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    12524 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5770 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-forward-stats.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2576 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-forward.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1596 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-network-json.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      719 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-pickle.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    16425 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/extract_state_tying_from_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    14986 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/get-attention-weights.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2936 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/get-best-model-epoch.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3900 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/hdf_dump.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    19622 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/hdf_dump_translation_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    49563 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/import-blocks-mt-model.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    31498 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/import-t2t-mt-model.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/lattice_rescorer/
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     2254 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/Makefile
--rw-r--r--   0 runner    (1001) docker     (123)     7825 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/
--rw-r--r--   0 runner    (1001) docker     (123)     1282 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      100 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/libs_list
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/
--rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config
--rw-r--r--   0 runner    (1001) docker     (123)     6110 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config
--rwxr-xr-x   0 runner    (1001) docker     (123)      800 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/rescore_lattice.sh
--rw-r--r--   0 runner    (1001) docker     (123)      296 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/state_vars_list
--rw-r--r--   0 runner    (1001) docker     (123)      155 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/tensor_names_list
--rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/file.h
--rw-r--r--   0 runner    (1001) docker     (123)    26055 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.cc
--rw-r--r--   0 runner    (1001) docker     (123)    10856 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.h
--rw-r--r--   0 runner    (1001) docker     (123)    12488 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/main.cc
--rw-r--r--   0 runner    (1001) docker     (123)     2184 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/rescorer.h
--rw-r--r--   0 runner    (1001) docker     (123)     5563 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.cc
--rw-r--r--   0 runner    (1001) docker     (123)     3023 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.h
--rwxr-xr-x   0 runner    (1001) docker     (123)     5438 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/tf_avg_checkpoints.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6269 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/tf_inspect_checkpoint.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1288 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/tf_inspect_summary_log.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/
+-rw-r--r--   0 runner    (1001) docker     (123)      198 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/.editorconfig
+-rw-r--r--   0 runner    (1001) docker     (123)      526 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)      828 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/.gitmodules
+-rw-r--r--   0 runner    (1001) docker     (123)       79 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/.kateconfig
+-rw-r--r--   0 runner    (1001) docker     (123)     8556 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/CHANGELOG.md
+-rw-r--r--   0 runner    (1001) docker     (123)      704 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/CODEOWNERS
+-rw-r--r--   0 runner    (1001) docker     (123)     4880 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/CONTRIBUTING.md
+-rw-r--r--   0 runner    (1001) docker     (123)    10244 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      579 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/README.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)       77 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/_setup_info_generated.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/
+-rw-r--r--   0 runner    (1001) docker     (123)    36006 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/12AX.cluster_map
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/_setup_returnn_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-fwd.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2703 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-horovod-mpi.py
+-rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-horovod-mpi.py.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)      264 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-horovod-mpi.sh
+-rw-r--r--   0 runner    (1001) docker     (123)     1756 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-hyper-param-tuning.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2396 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-iter-dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3635 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-list-devices.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2848 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-lua-torch-layer.config
+-rw-r--r--   0 runner    (1001) docker     (123)      487 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-pretrain.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2331 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-record-and-push-to-webserver.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1950 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-returnn-as-framework.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3040 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-rf.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2331 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-rhn-enwik8.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1378 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-sprint-interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3147 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-att-copy.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2428 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-attention.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1481 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-chunking-blstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-contribrnn-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     3073 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-enc-dec.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)    11615 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-hard-att-copy.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7287 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-lstm-benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-maxgradnorm-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1413 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-native-lstm-lowmem.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-native-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-native-lstm2.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1075 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-native-lstm2.12ax.tuned.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-neural-transducer.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1825 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-rec-explicit-lstm.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1202 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-rec-explicit-rnn.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2018 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-rec-self-att.config
+-rw-r--r--   0 runner    (1001) docker     (123)     5188 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-search-compiled-graph.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1430 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-tf-vanilla-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     4818 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-timit-lstm-ctc.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2855 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-torch.config
+-rw-r--r--   0 runner    (1001) docker     (123)      766 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo-upd-mult-model.lstm.12ax.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)      651 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/demo.sh
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/
+-rwxr-xr-x   0 runner    (1001) docker     (123)    43239 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)    43552 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/a01-007-04.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)    45111 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/a01-007-06.png
+-rw-r--r--   0 runner    (1001) docker     (123)     1709 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/README.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      158 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/chars.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1896 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/config_demo
+-rw-r--r--   0 runner    (1001) docker     (123)     1981 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/config_fwd
+-rw-r--r--   0 runner    (1001) docker     (123)     1983 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/config_real
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10194 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/create_IAM_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      749 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/decode.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/features/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/features/raw/
+-rw-r--r--   0 runner    (1001) docker     (123)   248580 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/features/raw/demo.h5
+-rwxr-xr-x   0 runner    (1001) docker     (123)       86 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      235 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/lines.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/split/
+-rw-r--r--   0 runner    (1001) docker     (123)     2712 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/split/eval.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    69536 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/split/train.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      934 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/IAM/split/valid.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      230 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/artificial/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2804 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial/create_test_h5.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial/forwardconfig
+-rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial/trainconfig
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2966 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/create_test_h5.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/forwardconfig
+-rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/trainconfig
+-rw-r--r--   0 runner    (1001) docker     (123)      463 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)       18 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/requirements.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/
+-rw-r--r--   0 runner    (1001) docker     (123)     1012 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24324 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/__main__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/__old_mod_loader__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4659 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/__setup__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24267 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/config.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/datasets/
+-rw-r--r--   0 runner    (1001) docker     (123)      390 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18032 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/audio.py
+-rw-r--r--   0 runner    (1001) docker     (123)    62931 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/bundle_file.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24892 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/cached.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11658 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/cached2.py
+-rw-r--r--   0 runner    (1001) docker     (123)    94213 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/generating.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65113 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/hdf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    85120 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/lm.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/map.py
+-rw-r--r--   0 runner    (1001) docker     (123)    75821 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/meta.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11167 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/multi_proc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14596 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/normalization_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5291 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/numpy_dump.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9127 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/raw_wav.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56015 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/sprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17608 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/stereo.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/datasets/util/
+-rw-r--r--   0 runner    (1001) docker     (123)       52 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23915 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/util/feature_extraction.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20445 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/datasets/util/vocabulary.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/engine/
+-rw-r--r--   0 runner    (1001) docker     (123)      228 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/engine/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9325 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/engine/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9912 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/engine/batch.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/
+-rw-r--r--   0 runner    (1001) docker     (123)     4005 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4024 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/
+-rw-r--r--   0 runner    (1001) docker     (123)       65 2023-05-09 17:24:57.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/.git
+-rw-r--r--   0 runner    (1001) docker     (123)        6 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1448 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)    13770 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/aligner.gif
+-rw-r--r--   0 runner    (1001) docker     (123)    51077 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/check.png
+-rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/core.cu
+-rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/core.h
+-rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/core_cpu.cpp
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/
+-rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)       70 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     2089 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     3485 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu
+-rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h
+-rw-r--r--   0 runner    (1001) docker     (123)       28 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/requirements.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     2079 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/
+-rw-r--r--   0 runner    (1001) docker     (123)     2885 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6961 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4141 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/ref_rna.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/
+-rw-r--r--   0 runner    (1001) docker     (123)     6150 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/
+-rw-r--r--   0 runner    (1001) docker     (123)     1693 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     6030 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/
+-rw-r--r--   0 runner    (1001) docker     (123)     2076 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-05-09 17:25:05.000000 returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/test.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)      135 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1239 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8479 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/edit.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19826 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/reroute.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29772 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/select.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26578 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/subgraph.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30380 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/transform.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18727 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/extern/graph_editor/util.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/frontend/
+-rw-r--r--   0 runner    (1001) docker     (123)     1260 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37689 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/_numpy_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5127 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17465 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/array_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20833 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1023 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/cond.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/const.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6015 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/container.py
+-rw-r--r--   0 runner    (1001) docker     (123)      413 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/control_flow_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22357 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)      519 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/device.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3538 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/dims.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3334 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/dropout.py
+-rw-r--r--   0 runner    (1001) docker     (123)      964 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/dtype.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/frontend/encoder/
+-rw-r--r--   0 runner    (1001) docker     (123)       17 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/encoder/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2109 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/encoder/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15428 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/encoder/conformer.py
+-rw-r--r--   0 runner    (1001) docker     (123)      330 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/gradient.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5855 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/init.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2147 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/linear.py
+-rw-r--r--   0 runner    (1001) docker     (123)      808 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/loop.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1898 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/loss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13440 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/math_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1945 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/matmul.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9877 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/module.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9687 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/normalization.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7158 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/parameter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10723 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/rand.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2374 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4750 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/reduce.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12245 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/run_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9385 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/signal.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2188 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/state.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/frontend/types.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/import_/
+-rw-r--r--   0 runner    (1001) docker     (123)      243 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/import_/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8148 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/import_/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13961 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/import_/git.py
+-rw-r--r--   0 runner    (1001) docker     (123)      798 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/import_/import_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    33063 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/learning_rate_control.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11738 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/log.py
+-rw-r--r--   0 runner    (1001) docker     (123)    35760 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/native_op.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)   244393 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/native_op.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23542 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/pretrain.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/sprint/
+-rw-r--r--   0 runner    (1001) docker     (123)       64 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/sprint/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31545 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/sprint/cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31137 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/sprint/control.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23313 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/sprint/error_signals.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12305 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/sprint/extern_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36475 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/sprint/interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/tensor/
+-rw-r--r--   0 runner    (1001) docker     (123)      501 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    99004 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/_dim_extra.py
+-rw-r--r--   0 runner    (1001) docker     (123)   157144 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/_tensor_extra.py
+-rw-r--r--   0 runner    (1001) docker     (123)      643 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/_tensor_mixin_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4890 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/_tensor_op_overloads.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/control_flow_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3884 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/dim.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1884 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/marked_dim.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7491 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/tensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4187 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tensor/tensor_dict.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/tf/
+-rw-r--r--   0 runner    (1001) docker     (123)       88 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1632 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36852 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/data_pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15108 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/distributed.py
+-rw-r--r--   0 runner    (1001) docker     (123)   151443 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/engine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/
+-rw-r--r--   0 runner    (1001) docker     (123)      452 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37861 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3702 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14297 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/cond.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4304 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/config_entry_points.py
+-rw-r--r--   0 runner    (1001) docker     (123)      888 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/debug_eager_mode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5712 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/dims.py
+-rw-r--r--   0 runner    (1001) docker     (123)    71987 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/layer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15829 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/make_layer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5107 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/parameter_assign.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2239 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_layers/prev_tensor_ref.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/tf/frontend_low_level/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_low_level/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20261 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/frontend_low_level/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5404 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/horovod.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31611 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/hyper_param_tuning.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/tf/layers/
+-rw-r--r--   0 runner    (1001) docker     (123)       72 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   149447 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)   585273 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)   539812 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21515 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/segmental_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52409 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/signal_processing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11239 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/layers/variable.py
+-rw-r--r--   0 runner    (1001) docker     (123)    79733 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/native_op.py
+-rw-r--r--   0 runner    (1001) docker     (123)   222320 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/network.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5471 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/sprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    71410 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/updater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/tf/util/
+-rw-r--r--   0 runner    (1001) docker     (123)       92 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   296804 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/util/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28839 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/util/data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17333 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/util/ken_lm.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11277 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/tf/util/open_fst.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/torch/
+-rw-r--r--   0 runner    (1001) docker     (123)       85 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       24 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/torch/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      132 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9483 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/data/pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5410 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/data/returnn_dataset_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/data/tensor_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/engine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/torch/frontend/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/frontend/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    60006 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/frontend/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1830 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/frontend/_rand.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3022 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/frontend/bridge.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/torch/functional/
+-rw-r--r--   0 runner    (1001) docker     (123)      193 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/functional/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       26 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/functional/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11449 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/torch/updater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      336 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   145021 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    59572 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/better_exchook.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17977 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/bpe.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15987 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/debug.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/debug_helpers.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    59177 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/fsa.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2009 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/literal_py_to_pickle.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8131 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/pprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14846 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/py-to-pickle.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)      277 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/py_compat.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7273 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/sig_proc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27230 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/returnn/util/task_system.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    12292 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/returnn.egg-info/top_level.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)      461 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/rnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     4159 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tests/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3392 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/DummySprintExec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm-inspection-profile.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tests/PyCharm.idea/
+-rw-r--r--   0 runner    (1001) docker     (123)       47 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/.name
+-rw-r--r--   0 runner    (1001) docker     (123)      512 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/codeStyleSettings.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tests/PyCharm.idea/codeStyles/
+-rw-r--r--   0 runner    (1001) docker     (123)      328 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/codeStyles/Project.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      142 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/codeStyles/codeStyleConfig.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tests/PyCharm.idea/inspectionProfiles/
+-rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/inspectionProfiles/profiles_settings.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      318 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/misc.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      267 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/modules.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      417 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/returnn.iml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tests/PyCharm.idea/scopes/
+-rw-r--r--   0 runner    (1001) docker     (123)      139 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/PyCharm.idea/scopes/scope_settings.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      871 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/_set_num_threads1.py
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/_setup_returnn_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8833 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/_setup_test_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)      794 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/bpe-unicode-demo.codes
+-rw-r--r--   0 runner    (1001) docker     (123)     2205 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/bpe-unicode-demo.vocab
+-rw-r--r--   0 runner    (1001) docker     (123)      386 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/lexicon_opt.fst
+-rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/lexicon_opt.isyms
+-rw-r--r--   0 runner    (1001) docker     (123)    34282 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/lexicon_opt.jpg
+-rw-r--r--   0 runner    (1001) docker     (123)       41 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/lexicon_opt.osyms
+-rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/lint_common.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    29203 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/pycharm-inspect.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2960 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/pylint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2963 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/returnn-as-framework.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11619 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/rf_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      617 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/spelling.dic
+-rw-r--r--   0 runner    (1001) docker     (123)     7845 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_Config.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18921 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_Dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    13634 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_Fsa.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8904 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_GeneratingDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32796 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_HDFDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10326 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_LearningRateControl.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7187 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_Log.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_MultiProcDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3333 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_PTDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2465 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_Pretrain.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21403 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_ResNet.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5014 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_SprintDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3330 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_SprintInterface.py
+-rw-r--r--   0 runner    (1001) docker     (123)   238053 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFEngine.py
+-rw-r--r--   0 runner    (1001) docker     (123)   135453 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFNativeOp.py
+-rw-r--r--   0 runner    (1001) docker     (123)   551354 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFNetworkLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)   549696 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFNetworkRecLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14485 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFNetworkSigProcLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20440 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFUpdater.py
+-rw-r--r--   0 runner    (1001) docker     (123)   187644 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TFUtil.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3082 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TF_determinism.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2156 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TaskSystem.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5088 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TaskSystem_SharedMem.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9378 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_TranslationDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_Util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10578 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_demos.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_fork_exec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2893 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_hdf_dump.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4725 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_array.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4491 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7608 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9490 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_cond.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4591 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_container.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10228 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1963 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_encoder_conformer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2312 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_math.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1933 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_normalization.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1052 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_rf_signal.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1135 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_tensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8435 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15594 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_torch_frontend.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15534 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tests/test_torch_internal_frontend.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tools/
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/_setup_returnn_env.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     9650 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/analyze-dataset-batches.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3943 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/bliss-collect-seq-lens.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      780 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/bliss-dump-text.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6608 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/bliss-get-segment-names.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    18221 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/bliss-to-ogg-zip.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5644 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/bpe-create-lexicon.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10532 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/calculate-word-error-rate.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1759 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/cleanup-old-models.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10783 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/collect-orth-symbols.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6801 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/collect-words.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     4395 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/compile_native_op.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    81620 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/compile_tf_graph.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     8500 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/debug-dump-search-scores.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    47001 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/debug-plot-search-scores.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6048 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/dump-dataset-raw-strings.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    12524 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/dump-dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5770 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/dump-forward-stats.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2576 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/dump-forward.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1596 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/dump-network-json.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      719 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/dump-pickle.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8760 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/export_to_onnx.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    16425 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/extract_state_tying_from_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    14986 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/get-attention-weights.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2936 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/get-best-model-epoch.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3900 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/hdf_dump.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    19622 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/hdf_dump_translation_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    49563 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/import-blocks-mt-model.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    31498 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/import-t2t-mt-model.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tools/lattice_rescorer/
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     2254 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/Makefile
+-rw-r--r--   0 runner    (1001) docker     (123)     7825 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/
+-rw-r--r--   0 runner    (1001) docker     (123)     1282 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      100 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/libs_list
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 17:25:23.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/network.040/
+-rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config
+-rw-r--r--   0 runner    (1001) docker     (123)     6110 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)      800 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/rescore_lattice.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      296 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/state_vars_list
+-rw-r--r--   0 runner    (1001) docker     (123)      155 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/example/tensor_names_list
+-rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/file.h
+-rw-r--r--   0 runner    (1001) docker     (123)    26055 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/htklatticerescorer.cc
+-rw-r--r--   0 runner    (1001) docker     (123)    10856 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/htklatticerescorer.h
+-rw-r--r--   0 runner    (1001) docker     (123)    12488 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/main.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     2184 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/rescorer.h
+-rw-r--r--   0 runner    (1001) docker     (123)     5563 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/vocabulary.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     3023 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/lattice_rescorer/vocabulary.h
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5438 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/tf_avg_checkpoints.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6269 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/tf_inspect_checkpoint.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1288 2023-05-09 17:24:53.000000 returnn-1.20230509.190819/tools/tf_inspect_summary_log.py
```

### Comparing `returnn-1.20230509.160323/.gitignore` & `returnn-1.20230509.190819/.gitignore`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/.gitmodules` & `returnn-1.20230509.190819/.gitmodules`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/CHANGELOG.md` & `returnn-1.20230509.190819/CHANGELOG.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/CODEOWNERS` & `returnn-1.20230509.190819/CODEOWNERS`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/CONTRIBUTING.md` & `returnn-1.20230509.190819/CONTRIBUTING.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/LICENSE` & `returnn-1.20230509.190819/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/MANIFEST.in` & `returnn-1.20230509.190819/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/PKG-INFO` & `returnn-1.20230509.190819/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: returnn
-Version: 1.20230509.160323
+Version: 1.20230509.190819
 Summary: The RWTH extensible training framework for universal recurrent neural networks
 Home-page: https://github.com/rwth-i6/returnn/
 Author: Albert Zeyer
 Author-email: albzey@gmail.com
 License: RETURNN license
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `returnn-1.20230509.160323/README.rst` & `returnn-1.20230509.190819/README.rst`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/__init__.py` & `returnn-1.20230509.190819/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/12AX.cluster_map` & `returnn-1.20230509.190819/demos/12AX.cluster_map`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-fwd.config` & `returnn-1.20230509.190819/demos/demo-fwd.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-horovod-mpi.py` & `returnn-1.20230509.190819/demos/demo-horovod-mpi.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-horovod-mpi.py.sh` & `returnn-1.20230509.190819/demos/demo-horovod-mpi.py.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-hyper-param-tuning.config` & `returnn-1.20230509.190819/demos/demo-hyper-param-tuning.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-iter-dataset.py` & `returnn-1.20230509.190819/demos/demo-iter-dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-list-devices.py` & `returnn-1.20230509.190819/demos/demo-list-devices.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-lua-torch-layer.config` & `returnn-1.20230509.190819/demos/demo-lua-torch-layer.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-record-and-push-to-webserver.py` & `returnn-1.20230509.190819/demos/demo-record-and-push-to-webserver.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-returnn-as-framework.py` & `returnn-1.20230509.190819/demos/demo-returnn-as-framework.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-rf.config` & `returnn-1.20230509.190819/demos/demo-rf.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-rhn-enwik8.config` & `returnn-1.20230509.190819/demos/demo-rhn-enwik8.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-sprint-interface.py` & `returnn-1.20230509.190819/demos/demo-sprint-interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-att-copy.config` & `returnn-1.20230509.190819/demos/demo-tf-att-copy.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-attention.config` & `returnn-1.20230509.190819/demos/demo-tf-attention.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-chunking-blstm.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-chunking-blstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-contribrnn-lstm.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-contribrnn-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-enc-dec.config` & `returnn-1.20230509.190819/demos/demo-tf-enc-dec.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-hard-att-copy.config` & `returnn-1.20230509.190819/demos/demo-tf-hard-att-copy.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-lstm-benchmark.py` & `returnn-1.20230509.190819/demos/demo-tf-lstm-benchmark.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-maxgradnorm-lstm.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-maxgradnorm-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-native-lstm-lowmem.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-native-lstm-lowmem.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-native-lstm.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-native-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-native-lstm2.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.tuned.config` & `returnn-1.20230509.190819/demos/demo-tf-native-lstm2.12ax.tuned.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-neural-transducer.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-neural-transducer.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-rec-explicit-lstm.config` & `returnn-1.20230509.190819/demos/demo-tf-rec-explicit-lstm.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-rec-explicit-rnn.config` & `returnn-1.20230509.190819/demos/demo-tf-rec-explicit-rnn.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-rec-self-att.config` & `returnn-1.20230509.190819/demos/demo-tf-rec-self-att.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-search-compiled-graph.py` & `returnn-1.20230509.190819/demos/demo-tf-search-compiled-graph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-tf-vanilla-lstm.12ax.config` & `returnn-1.20230509.190819/demos/demo-tf-vanilla-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-timit-lstm-ctc.config` & `returnn-1.20230509.190819/demos/demo-timit-lstm-ctc.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-torch.config` & `returnn-1.20230509.190819/demos/demo-torch.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo-upd-mult-model.lstm.12ax.config` & `returnn-1.20230509.190819/demos/demo-upd-mult-model.lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/demo.sh` & `returnn-1.20230509.190819/demos/demo.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png` & `returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-04.png` & `returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/a01-007-04.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-06.png` & `returnn-1.20230509.190819/demos/mdlstm/IAM/IAM_lines/a01-007-06.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/README.txt` & `returnn-1.20230509.190819/demos/mdlstm/IAM/README.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/config_demo` & `returnn-1.20230509.190819/demos/mdlstm/IAM/config_demo`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/config_fwd` & `returnn-1.20230509.190819/demos/mdlstm/IAM/config_fwd`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/config_real` & `returnn-1.20230509.190819/demos/mdlstm/IAM/config_real`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/create_IAM_dataset.py` & `returnn-1.20230509.190819/demos/mdlstm/IAM/create_IAM_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/decode.py` & `returnn-1.20230509.190819/demos/mdlstm/IAM/decode.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/features/raw/demo.h5` & `returnn-1.20230509.190819/demos/mdlstm/IAM/features/raw/demo.h5`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/split/eval.txt` & `returnn-1.20230509.190819/demos/mdlstm/IAM/split/eval.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/split/train.txt` & `returnn-1.20230509.190819/demos/mdlstm/IAM/split/train.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/IAM/split/valid.txt` & `returnn-1.20230509.190819/demos/mdlstm/IAM/split/valid.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/artificial/create_test_h5.py` & `returnn-1.20230509.190819/demos/mdlstm/artificial/create_test_h5.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/artificial/forwardconfig` & `returnn-1.20230509.190819/demos/mdlstm/artificial/forwardconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/artificial/trainconfig` & `returnn-1.20230509.190819/demos/mdlstm/artificial/trainconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/create_test_h5.py` & `returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/create_test_h5.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/forwardconfig` & `returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/forwardconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/trainconfig` & `returnn-1.20230509.190819/demos/mdlstm/artificial_rgb/trainconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/__init__.py` & `returnn-1.20230509.190819/returnn/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/__main__.py` & `returnn-1.20230509.190819/returnn/__main__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/__old_mod_loader__.py` & `returnn-1.20230509.190819/returnn/__old_mod_loader__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/__setup__.py` & `returnn-1.20230509.190819/returnn/__setup__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/config.py` & `returnn-1.20230509.190819/returnn/config.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/audio.py` & `returnn-1.20230509.190819/returnn/datasets/audio.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/basic.py` & `returnn-1.20230509.190819/returnn/datasets/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/bundle_file.py` & `returnn-1.20230509.190819/returnn/datasets/bundle_file.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/cached.py` & `returnn-1.20230509.190819/returnn/datasets/cached.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/cached2.py` & `returnn-1.20230509.190819/returnn/datasets/cached2.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/generating.py` & `returnn-1.20230509.190819/returnn/datasets/generating.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/hdf.py` & `returnn-1.20230509.190819/returnn/datasets/hdf.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/lm.py` & `returnn-1.20230509.190819/returnn/datasets/lm.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/map.py` & `returnn-1.20230509.190819/returnn/datasets/map.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/meta.py` & `returnn-1.20230509.190819/returnn/datasets/meta.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/multi_proc.py` & `returnn-1.20230509.190819/returnn/datasets/multi_proc.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/normalization_data.py` & `returnn-1.20230509.190819/returnn/datasets/normalization_data.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/numpy_dump.py` & `returnn-1.20230509.190819/returnn/datasets/numpy_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/raw_wav.py` & `returnn-1.20230509.190819/returnn/datasets/raw_wav.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/sprint.py` & `returnn-1.20230509.190819/returnn/datasets/sprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/stereo.py` & `returnn-1.20230509.190819/returnn/datasets/stereo.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/util/feature_extraction.py` & `returnn-1.20230509.190819/returnn/datasets/util/feature_extraction.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/datasets/util/vocabulary.py` & `returnn-1.20230509.190819/returnn/datasets/util/vocabulary.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/engine/base.py` & `returnn-1.20230509.190819/returnn/engine/base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/engine/batch.py` & `returnn-1.20230509.190819/returnn/engine/batch.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/__init__.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/__main__.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/__main__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/LICENSE` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/README.md` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/aligner.gif` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/aligner.gif`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/check.png` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/check.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.cu` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/core.cu`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.h` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/core.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core_cpu.cpp` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/core_cpu.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/ref_rna.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/ref_rna.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/test.cpp` & `returnn-1.20230509.190819/returnn/extern/WarpRna/warp-rna/test.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/__init__.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/edit.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/edit.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/reroute.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/reroute.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/select.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/select.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/subgraph.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/subgraph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/transform.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/transform.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/extern/graph_editor/util.py` & `returnn-1.20230509.190819/returnn/extern/graph_editor/util.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/__init__.py` & `returnn-1.20230509.190819/returnn/frontend/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/_backend.py` & `returnn-1.20230509.190819/returnn/frontend/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/_numpy_backend.py` & `returnn-1.20230509.190819/returnn/frontend/_numpy_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/_utils.py` & `returnn-1.20230509.190819/returnn/frontend/_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/array_.py` & `returnn-1.20230509.190819/returnn/frontend/array_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/attention.py` & `returnn-1.20230509.190819/returnn/frontend/attention.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/cond.py` & `returnn-1.20230509.190819/returnn/frontend/cond.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/const.py` & `returnn-1.20230509.190819/returnn/frontend/const.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/container.py` & `returnn-1.20230509.190819/returnn/frontend/container.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/conv.py` & `returnn-1.20230509.190819/returnn/frontend/conv.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/device.py` & `returnn-1.20230509.190819/returnn/frontend/device.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/dims.py` & `returnn-1.20230509.190819/returnn/frontend/dims.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/dropout.py` & `returnn-1.20230509.190819/returnn/frontend/dropout.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/dtype.py` & `returnn-1.20230509.190819/returnn/frontend/dtype.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/encoder/base.py` & `returnn-1.20230509.190819/returnn/frontend/encoder/base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/encoder/conformer.py` & `returnn-1.20230509.190819/returnn/frontend/encoder/conformer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/init.py` & `returnn-1.20230509.190819/returnn/frontend/init.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/linear.py` & `returnn-1.20230509.190819/returnn/frontend/linear.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/loop.py` & `returnn-1.20230509.190819/returnn/frontend/loop.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/loss.py` & `returnn-1.20230509.190819/returnn/frontend/loss.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/math_.py` & `returnn-1.20230509.190819/returnn/frontend/math_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/matmul.py` & `returnn-1.20230509.190819/returnn/frontend/matmul.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/module.py` & `returnn-1.20230509.190819/returnn/frontend/module.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/normalization.py` & `returnn-1.20230509.190819/returnn/frontend/normalization.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/parameter.py` & `returnn-1.20230509.190819/returnn/frontend/parameter.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/rand.py` & `returnn-1.20230509.190819/returnn/frontend/rand.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/rec.py` & `returnn-1.20230509.190819/returnn/frontend/rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/reduce.py` & `returnn-1.20230509.190819/returnn/frontend/reduce.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/run_ctx.py` & `returnn-1.20230509.190819/returnn/frontend/run_ctx.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/signal.py` & `returnn-1.20230509.190819/returnn/frontend/signal.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/state.py` & `returnn-1.20230509.190819/returnn/frontend/state.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/frontend/types.py` & `returnn-1.20230509.190819/returnn/frontend/types.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/import_/common.py` & `returnn-1.20230509.190819/returnn/import_/common.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/import_/git.py` & `returnn-1.20230509.190819/returnn/import_/git.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/import_/import_.py` & `returnn-1.20230509.190819/returnn/import_/import_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/learning_rate_control.py` & `returnn-1.20230509.190819/returnn/learning_rate_control.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/log.py` & `returnn-1.20230509.190819/returnn/log.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/native_op.cpp` & `returnn-1.20230509.190819/returnn/native_op.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/native_op.py` & `returnn-1.20230509.190819/returnn/native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/pretrain.py` & `returnn-1.20230509.190819/returnn/pretrain.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/sprint/cache.py` & `returnn-1.20230509.190819/returnn/sprint/cache.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/sprint/control.py` & `returnn-1.20230509.190819/returnn/sprint/control.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/sprint/error_signals.py` & `returnn-1.20230509.190819/returnn/sprint/error_signals.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/sprint/extern_interface.py` & `returnn-1.20230509.190819/returnn/sprint/extern_interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/sprint/interface.py` & `returnn-1.20230509.190819/returnn/sprint/interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/_dim_extra.py` & `returnn-1.20230509.190819/returnn/tensor/_dim_extra.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/_tensor_extra.py` & `returnn-1.20230509.190819/returnn/tensor/_tensor_extra.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/_tensor_mixin_base.py` & `returnn-1.20230509.190819/returnn/tensor/_tensor_mixin_base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/_tensor_op_overloads.py` & `returnn-1.20230509.190819/returnn/tensor/_tensor_op_overloads.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/control_flow_ctx.py` & `returnn-1.20230509.190819/returnn/tensor/control_flow_ctx.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/dim.py` & `returnn-1.20230509.190819/returnn/tensor/dim.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/marked_dim.py` & `returnn-1.20230509.190819/returnn/tensor/marked_dim.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/tensor.py` & `returnn-1.20230509.190819/returnn/tensor/tensor.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tensor/tensor_dict.py` & `returnn-1.20230509.190819/returnn/tensor/tensor_dict.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/compat.py` & `returnn-1.20230509.190819/returnn/tf/compat.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/data_pipeline.py` & `returnn-1.20230509.190819/returnn/tf/data_pipeline.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/distributed.py` & `returnn-1.20230509.190819/returnn/tf/distributed.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/engine.py` & `returnn-1.20230509.190819/returnn/tf/engine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/_backend.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/_utils.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/cond.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/cond.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/config_entry_points.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/config_entry_points.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/debug_eager_mode.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/debug_eager_mode.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/dims.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/dims.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/layer.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/layer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/make_layer.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/make_layer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/parameter_assign.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/parameter_assign.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_layers/prev_tensor_ref.py` & `returnn-1.20230509.190819/returnn/tf/frontend_layers/prev_tensor_ref.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/frontend_low_level/_backend.py` & `returnn-1.20230509.190819/returnn/tf/frontend_low_level/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/horovod.py` & `returnn-1.20230509.190819/returnn/tf/horovod.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/hyper_param_tuning.py` & `returnn-1.20230509.190819/returnn/tf/hyper_param_tuning.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/layers/base.py` & `returnn-1.20230509.190819/returnn/tf/layers/base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/layers/basic.py` & `returnn-1.20230509.190819/returnn/tf/layers/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/layers/rec.py` & `returnn-1.20230509.190819/returnn/tf/layers/rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/layers/segmental_model.py` & `returnn-1.20230509.190819/returnn/tf/layers/segmental_model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/layers/signal_processing.py` & `returnn-1.20230509.190819/returnn/tf/layers/signal_processing.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/layers/variable.py` & `returnn-1.20230509.190819/returnn/tf/layers/variable.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/native_op.py` & `returnn-1.20230509.190819/returnn/tf/native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/network.py` & `returnn-1.20230509.190819/returnn/tf/network.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/sprint.py` & `returnn-1.20230509.190819/returnn/tf/sprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/updater.py` & `returnn-1.20230509.190819/returnn/tf/updater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/util/basic.py` & `returnn-1.20230509.190819/returnn/tf/util/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/util/data.py` & `returnn-1.20230509.190819/returnn/tf/util/data.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/util/ken_lm.py` & `returnn-1.20230509.190819/returnn/tf/util/ken_lm.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/tf/util/open_fst.py` & `returnn-1.20230509.190819/returnn/tf/util/open_fst.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/data/pipeline.py` & `returnn-1.20230509.190819/returnn/torch/data/pipeline.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/data/returnn_dataset_wrapper.py` & `returnn-1.20230509.190819/returnn/torch/data/returnn_dataset_wrapper.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/data/tensor_utils.py` & `returnn-1.20230509.190819/returnn/torch/data/tensor_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/engine.py` & `returnn-1.20230509.190819/returnn/torch/engine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/frontend/_backend.py` & `returnn-1.20230509.190819/returnn/torch/frontend/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/frontend/_rand.py` & `returnn-1.20230509.190819/returnn/torch/frontend/_rand.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/torch/frontend/bridge.py` & `returnn-1.20230509.190819/returnn/torch/frontend/bridge.py`

 * *Files 4% similar despite different names*

```diff
@@ -83,7 +83,18 @@
     def rf_module(self) -> rf.Module:
         """RF module"""
         return self._rf_module
 
     def forward(self, *args, **kwargs):
         """forward"""
         return self._rf_module(*args, **kwargs)
+
+
+class _RFTensorAsPTTensor(torch.Tensor):
+    """
+    This class is meant to be instantiated through torch_tensor_object.as_subclass(_RFTensorAsPTTensor),
+    so it doesn't have __init__().
+    """
+
+    def __init__(self, rf_tensor: rf.Tensor):
+        super().__init__()
+        self.rf_tensor = rf_tensor
```

### Comparing `returnn-1.20230509.160323/returnn/torch/updater.py` & `returnn-1.20230509.190819/returnn/torch/updater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/basic.py` & `returnn-1.20230509.190819/returnn/util/basic.py`

 * *Files 0% similar despite different names*

```diff
@@ -3122,5937 +3122,5943 @@
 0000c310: 653a 2054 7c69 6e74 7c66 6c6f 6174 0a20  e: T|int|float. 
 0000c320: 2020 2022 2222 0a20 2020 2069 6620 6c65     """.    if le
 0000c330: 6e28 6c73 2920 3d3d 2030 3a0a 2020 2020  n(ls) == 0:.    
 0000c340: 2020 2020 7265 7475 726e 2031 0a20 2020      return 1.   
 0000c350: 2078 203d 206c 735b 305d 0a20 2020 2066   x = ls[0].    f
 0000c360: 6f72 2079 2069 6e20 6c73 5b31 3a5d 3a0a  or y in ls[1:]:.
 0000c370: 2020 2020 2020 2020 7820 3d20 7820 2a20          x = x * 
-0000c380: 790a 2020 2020 7265 7475 726e 2078 0a0a  y.    return x..
-0000c390: 0a64 6566 2070 6172 7365 5f6f 7274 686f  .def parse_ortho
-0000c3a0: 6772 6170 6879 5f69 6e74 6f5f 7379 6d62  graphy_into_symb
-0000c3b0: 6f6c 7328 0a20 2020 206f 7274 686f 6772  ols(.    orthogr
-0000c3c0: 6170 6879 2c20 7570 7065 725f 6361 7365  aphy, upper_case
-0000c3d0: 5f73 7065 6369 616c 3d54 7275 652c 2077  _special=True, w
-0000c3e0: 6f72 645f 6261 7365 643d 4661 6c73 652c  ord_based=False,
-0000c3f0: 2073 7175 6172 655f 6272 6163 6b65 7473   square_brackets
-0000c400: 5f66 6f72 5f73 7065 6369 616c 733d 5472  _for_specials=Tr
-0000c410: 7565 0a29 3a0a 2020 2020 2222 220a 2020  ue.):.    """.  
-0000c420: 2020 466f 7220 5370 6565 6368 2e0a 2020    For Speech..  
-0000c430: 2020 4578 616d 706c 653a 0a20 2020 2020    Example:.     
-0000c440: 206f 7274 686f 6772 6170 6879 203d 2022   orthography = "
-0000c450: 6865 6c6c 6f20 5b48 4553 4954 4154 494f  hello [HESITATIO
-0000c460: 4e5d 2074 6865 7265 2022 0a20 2020 2020  N] there ".     
-0000c470: 2077 6974 6820 776f 7264 5f62 6173 6564   with word_based
-0000c480: 203d 3d20 4661 6c73 653a 2072 6574 7572   == False: retur
-0000c490: 6e73 206c 6973 7428 2268 656c 6c6f 2022  ns list("hello "
-0000c4a0: 2920 2b20 5b22 5b48 4553 4954 4154 494f  ) + ["[HESITATIO
-0000c4b0: 4e5d 225d 202b 206c 6973 7428 2220 7468  N]"] + list(" th
-0000c4c0: 6572 6520 2229 2e0a 2020 2020 2020 7769  ere ")..      wi
-0000c4d0: 7468 2077 6f72 645f 6261 7365 6420 3d3d  th word_based ==
-0000c4e0: 2054 7275 653a 2072 6574 7572 6e73 205b   True: returns [
-0000c4f0: 2268 656c 6c6f 222c 2022 5b48 4553 4954  "hello", "[HESIT
-0000c500: 4154 494f 4e5d 222c 2022 7468 6572 6522  ATION]", "there"
-0000c510: 5d0a 2020 2020 4e6f 2070 7265 2f70 6f73  ].    No pre/pos
-0000c520: 742d 7072 6f63 6573 7369 6e67 2073 7563  t-processing suc
-0000c530: 6820 6173 3a0a 2020 2020 5370 6163 6573  h as:.    Spaces
-0000c540: 2061 7265 206b 6570 7420 6173 2d69 732e   are kept as-is.
-0000c550: 204e 6f20 7374 7269 7070 696e 6720 6174   No stripping at
-0000c560: 2062 6567 696e 2f65 6e64 2e20 2845 2e67   begin/end. (E.g
-0000c570: 2e20 7472 6169 6c69 6e67 2073 7061 6365  . trailing space
-0000c580: 7320 6172 6520 6e6f 7420 7265 6d6f 7665  s are not remove
-0000c590: 642e 290a 2020 2020 4e6f 2074 6f6c 6f77  d.).    No tolow
-0000c5a0: 6572 2f74 6f75 7070 6572 2e0a 2020 2020  er/toupper..    
-0000c5b0: 446f 6573 6e27 7420 6164 6420 5b42 4547  Doesn't add [BEG
-0000c5c0: 494e 5d2f 5b45 4e44 5d20 7379 6d62 6f6c  IN]/[END] symbol
-0000c5d0: 7320 6f72 2073 6f2e 0a20 2020 2041 6e79  s or so..    Any
-0000c5e0: 2073 7563 6820 6f70 6572 6174 696f 6e73   such operations
-0000c5f0: 2073 686f 756c 6420 6265 2064 6f6e 6520   should be done 
-0000c600: 6578 706c 6963 6974 6c79 2069 6e20 616e  explicitly in an
-0000c610: 2061 6464 6974 696f 6e61 6c20 6675 6e63   additional func
-0000c620: 7469 6f6e 2e0a 2020 2020 416e 7974 6869  tion..    Anythi
-0000c630: 6e67 2069 6e20 5b5d 2d62 7261 636b 6574  ng in []-bracket
-0000c640: 7320 6172 6520 6d65 616e 7420 6173 2073  s are meant as s
-0000c650: 7065 6369 616c 2d73 796d 626f 6c73 2e0a  pecial-symbols..
-0000c660: 2020 2020 416c 736f 2073 6565 2070 6172      Also see par
-0000c670: 7365 5f6f 7274 686f 6772 6170 6879 2829  se_orthography()
-0000c680: 2077 6869 6368 2069 6e63 6c75 6465 7320   which includes 
-0000c690: 736f 6d65 2070 7265 7072 6f63 6573 7369  some preprocessi
-0000c6a0: 6e67 2e0a 0a20 2020 203a 7061 7261 6d20  ng...    :param 
-0000c6b0: 7374 7220 6f72 7468 6f67 7261 7068 793a  str orthography:
-0000c6c0: 2065 7861 6d70 6c65 3a20 2268 656c 6c6f   example: "hello
-0000c6d0: 205b 4845 5349 5441 5449 4f4e 5d20 7468   [HESITATION] th
-0000c6e0: 6572 6520 220a 2020 2020 3a70 6172 616d  ere ".    :param
-0000c6f0: 2062 6f6f 6c20 7570 7065 725f 6361 7365   bool upper_case
-0000c700: 5f73 7065 6369 616c 3a20 7768 6574 6865  _special: whethe
-0000c710: 7220 7468 6520 7370 6563 6961 6c20 7379  r the special sy
-0000c720: 6d62 6f6c 7320 6172 6520 616c 7761 7973  mbols are always
-0000c730: 206d 6164 6520 7570 7065 7220 6361 7365   made upper case
-0000c740: 0a20 2020 203a 7061 7261 6d20 626f 6f6c  .    :param bool
-0000c750: 2077 6f72 645f 6261 7365 643a 2077 6865   word_based: whe
-0000c760: 7468 6572 2077 6520 7370 6c69 7420 6f6e  ther we split on
-0000c770: 2073 7061 6365 2061 6e64 2072 6574 7572   space and retur
-0000c780: 6e20 6675 6c6c 2077 6f72 6473 0a20 2020  n full words.   
-0000c790: 203a 7061 7261 6d20 626f 6f6c 2073 7175   :param bool squ
-0000c7a0: 6172 655f 6272 6163 6b65 7473 5f66 6f72  are_brackets_for
-0000c7b0: 5f73 7065 6369 616c 733a 2068 616e 646c  _specials: handl
-0000c7c0: 6520 225b 2e2e 2e5d 220a 2020 2020 3a72  e "[...]".    :r
-0000c7d0: 7479 7065 3a20 6c69 7374 5b73 7472 5d0a  type: list[str].
-0000c7e0: 2020 2020 2222 220a 2020 2020 7265 7420      """.    ret 
-0000c7f0: 3d20 5b5d 0a20 2020 2069 6e5f 7370 6563  = [].    in_spec
-0000c800: 6961 6c20 3d20 300a 2020 2020 666f 7220  ial = 0.    for 
-0000c810: 6320 696e 206f 7274 686f 6772 6170 6879  c in orthography
-0000c820: 3a0a 2020 2020 2020 2020 6966 2069 6e5f  :.        if in_
-0000c830: 7370 6563 6961 6c3a 0a20 2020 2020 2020  special:.       
-0000c840: 2020 2020 2069 6620 6320 3d3d 2022 5b22       if c == "["
-0000c850: 3a20 2023 2073 7065 6369 616c 2d73 7065  :  # special-spe
-0000c860: 6369 616c 0a20 2020 2020 2020 2020 2020  cial.           
-0000c870: 2020 2020 2069 6e5f 7370 6563 6961 6c20       in_special 
-0000c880: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0000c890: 2020 2020 2072 6574 5b2d 315d 202b 3d20       ret[-1] += 
-0000c8a0: 225b 220a 2020 2020 2020 2020 2020 2020  "[".            
-0000c8b0: 656c 6966 2063 203d 3d20 225d 223a 0a20  elif c == "]":. 
-0000c8c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c8d0: 6e5f 7370 6563 6961 6c20 2d3d 2031 0a20  n_special -= 1. 
-0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c8f0: 6574 5b2d 315d 202b 3d20 225d 220a 2020  et[-1] += "]".  
-0000c900: 2020 2020 2020 2020 2020 656c 6966 2075            elif u
-0000c910: 7070 6572 5f63 6173 655f 7370 6563 6961  pper_case_specia
-0000c920: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
-0000c930: 2020 2072 6574 5b2d 315d 202b 3d20 632e     ret[-1] += c.
-0000c940: 7570 7065 7228 290a 2020 2020 2020 2020  upper().        
-0000c950: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000c960: 2020 2020 2020 2020 2020 7265 745b 2d31            ret[-1
-0000c970: 5d20 2b3d 2063 0a20 2020 2020 2020 2065  ] += c.        e
-0000c980: 6c73 653a 2020 2320 6e6f 7420 696e 5f73  lse:  # not in_s
-0000c990: 7065 6369 616c 0a20 2020 2020 2020 2020  pecial.         
-0000c9a0: 2020 2069 6620 7371 7561 7265 5f62 7261     if square_bra
-0000c9b0: 636b 6574 735f 666f 725f 7370 6563 6961  ckets_for_specia
-0000c9c0: 6c73 2061 6e64 2063 203d 3d20 225b 223a  ls and c == "[":
-0000c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9e0: 2069 6e5f 7370 6563 6961 6c20 3d20 310a   in_special = 1.
-0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca00: 7265 7420 2b3d 205b 225b 225d 0a20 2020  ret += ["["].   
-0000ca10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000ca20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000ca30: 6620 776f 7264 5f62 6173 6564 3a0a 2020  f word_based:.  
-0000ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca50: 2020 6966 2063 2e69 7373 7061 6365 2829    if c.isspace()
-0000ca60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ca70: 2020 2020 2020 2020 2020 7265 7420 2b3d            ret +=
-0000ca80: 205b 2222 5d0a 2020 2020 2020 2020 2020   [""].          
-0000ca90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c380: 7920 2023 202a 3d20 646f 6573 6e27 7420  y  # *= doesn't 
+0000c390: 776f 726b 2062 6563 6175 7365 2078 206d  work because x m
+0000c3a0: 6967 6874 2062 6520 6120 7465 6e73 6f72  ight be a tensor
+0000c3b0: 2c20 616e 6420 666f 7220 652e 672e 2074  , and for e.g. t
+0000c3c0: 6f72 6368 2e54 656e 736f 7220 7468 6973  orch.Tensor this
+0000c3d0: 206f 7020 6973 2069 6e2d 706c 6163 650a   op is in-place.
+0000c3e0: 2020 2020 7265 7475 726e 2078 0a0a 0a64      return x...d
+0000c3f0: 6566 2070 6172 7365 5f6f 7274 686f 6772  ef parse_orthogr
+0000c400: 6170 6879 5f69 6e74 6f5f 7379 6d62 6f6c  aphy_into_symbol
+0000c410: 7328 0a20 2020 206f 7274 686f 6772 6170  s(.    orthograp
+0000c420: 6879 2c20 7570 7065 725f 6361 7365 5f73  hy, upper_case_s
+0000c430: 7065 6369 616c 3d54 7275 652c 2077 6f72  pecial=True, wor
+0000c440: 645f 6261 7365 643d 4661 6c73 652c 2073  d_based=False, s
+0000c450: 7175 6172 655f 6272 6163 6b65 7473 5f66  quare_brackets_f
+0000c460: 6f72 5f73 7065 6369 616c 733d 5472 7565  or_specials=True
+0000c470: 0a29 3a0a 2020 2020 2222 220a 2020 2020  .):.    """.    
+0000c480: 466f 7220 5370 6565 6368 2e0a 2020 2020  For Speech..    
+0000c490: 4578 616d 706c 653a 0a20 2020 2020 206f  Example:.      o
+0000c4a0: 7274 686f 6772 6170 6879 203d 2022 6865  rthography = "he
+0000c4b0: 6c6c 6f20 5b48 4553 4954 4154 494f 4e5d  llo [HESITATION]
+0000c4c0: 2074 6865 7265 2022 0a20 2020 2020 2077   there ".      w
+0000c4d0: 6974 6820 776f 7264 5f62 6173 6564 203d  ith word_based =
+0000c4e0: 3d20 4661 6c73 653a 2072 6574 7572 6e73  = False: returns
+0000c4f0: 206c 6973 7428 2268 656c 6c6f 2022 2920   list("hello ") 
+0000c500: 2b20 5b22 5b48 4553 4954 4154 494f 4e5d  + ["[HESITATION]
+0000c510: 225d 202b 206c 6973 7428 2220 7468 6572  "] + list(" ther
+0000c520: 6520 2229 2e0a 2020 2020 2020 7769 7468  e ")..      with
+0000c530: 2077 6f72 645f 6261 7365 6420 3d3d 2054   word_based == T
+0000c540: 7275 653a 2072 6574 7572 6e73 205b 2268  rue: returns ["h
+0000c550: 656c 6c6f 222c 2022 5b48 4553 4954 4154  ello", "[HESITAT
+0000c560: 494f 4e5d 222c 2022 7468 6572 6522 5d0a  ION]", "there"].
+0000c570: 2020 2020 4e6f 2070 7265 2f70 6f73 742d      No pre/post-
+0000c580: 7072 6f63 6573 7369 6e67 2073 7563 6820  processing such 
+0000c590: 6173 3a0a 2020 2020 5370 6163 6573 2061  as:.    Spaces a
+0000c5a0: 7265 206b 6570 7420 6173 2d69 732e 204e  re kept as-is. N
+0000c5b0: 6f20 7374 7269 7070 696e 6720 6174 2062  o stripping at b
+0000c5c0: 6567 696e 2f65 6e64 2e20 2845 2e67 2e20  egin/end. (E.g. 
+0000c5d0: 7472 6169 6c69 6e67 2073 7061 6365 7320  trailing spaces 
+0000c5e0: 6172 6520 6e6f 7420 7265 6d6f 7665 642e  are not removed.
+0000c5f0: 290a 2020 2020 4e6f 2074 6f6c 6f77 6572  ).    No tolower
+0000c600: 2f74 6f75 7070 6572 2e0a 2020 2020 446f  /toupper..    Do
+0000c610: 6573 6e27 7420 6164 6420 5b42 4547 494e  esn't add [BEGIN
+0000c620: 5d2f 5b45 4e44 5d20 7379 6d62 6f6c 7320  ]/[END] symbols 
+0000c630: 6f72 2073 6f2e 0a20 2020 2041 6e79 2073  or so..    Any s
+0000c640: 7563 6820 6f70 6572 6174 696f 6e73 2073  uch operations s
+0000c650: 686f 756c 6420 6265 2064 6f6e 6520 6578  hould be done ex
+0000c660: 706c 6963 6974 6c79 2069 6e20 616e 2061  plicitly in an a
+0000c670: 6464 6974 696f 6e61 6c20 6675 6e63 7469  dditional functi
+0000c680: 6f6e 2e0a 2020 2020 416e 7974 6869 6e67  on..    Anything
+0000c690: 2069 6e20 5b5d 2d62 7261 636b 6574 7320   in []-brackets 
+0000c6a0: 6172 6520 6d65 616e 7420 6173 2073 7065  are meant as spe
+0000c6b0: 6369 616c 2d73 796d 626f 6c73 2e0a 2020  cial-symbols..  
+0000c6c0: 2020 416c 736f 2073 6565 2070 6172 7365    Also see parse
+0000c6d0: 5f6f 7274 686f 6772 6170 6879 2829 2077  _orthography() w
+0000c6e0: 6869 6368 2069 6e63 6c75 6465 7320 736f  hich includes so
+0000c6f0: 6d65 2070 7265 7072 6f63 6573 7369 6e67  me preprocessing
+0000c700: 2e0a 0a20 2020 203a 7061 7261 6d20 7374  ...    :param st
+0000c710: 7220 6f72 7468 6f67 7261 7068 793a 2065  r orthography: e
+0000c720: 7861 6d70 6c65 3a20 2268 656c 6c6f 205b  xample: "hello [
+0000c730: 4845 5349 5441 5449 4f4e 5d20 7468 6572  HESITATION] ther
+0000c740: 6520 220a 2020 2020 3a70 6172 616d 2062  e ".    :param b
+0000c750: 6f6f 6c20 7570 7065 725f 6361 7365 5f73  ool upper_case_s
+0000c760: 7065 6369 616c 3a20 7768 6574 6865 7220  pecial: whether 
+0000c770: 7468 6520 7370 6563 6961 6c20 7379 6d62  the special symb
+0000c780: 6f6c 7320 6172 6520 616c 7761 7973 206d  ols are always m
+0000c790: 6164 6520 7570 7065 7220 6361 7365 0a20  ade upper case. 
+0000c7a0: 2020 203a 7061 7261 6d20 626f 6f6c 2077     :param bool w
+0000c7b0: 6f72 645f 6261 7365 643a 2077 6865 7468  ord_based: wheth
+0000c7c0: 6572 2077 6520 7370 6c69 7420 6f6e 2073  er we split on s
+0000c7d0: 7061 6365 2061 6e64 2072 6574 7572 6e20  pace and return 
+0000c7e0: 6675 6c6c 2077 6f72 6473 0a20 2020 203a  full words.    :
+0000c7f0: 7061 7261 6d20 626f 6f6c 2073 7175 6172  param bool squar
+0000c800: 655f 6272 6163 6b65 7473 5f66 6f72 5f73  e_brackets_for_s
+0000c810: 7065 6369 616c 733a 2068 616e 646c 6520  pecials: handle 
+0000c820: 225b 2e2e 2e5d 220a 2020 2020 3a72 7479  "[...]".    :rty
+0000c830: 7065 3a20 6c69 7374 5b73 7472 5d0a 2020  pe: list[str].  
+0000c840: 2020 2222 220a 2020 2020 7265 7420 3d20    """.    ret = 
+0000c850: 5b5d 0a20 2020 2069 6e5f 7370 6563 6961  [].    in_specia
+0000c860: 6c20 3d20 300a 2020 2020 666f 7220 6320  l = 0.    for c 
+0000c870: 696e 206f 7274 686f 6772 6170 6879 3a0a  in orthography:.
+0000c880: 2020 2020 2020 2020 6966 2069 6e5f 7370          if in_sp
+0000c890: 6563 6961 6c3a 0a20 2020 2020 2020 2020  ecial:.         
+0000c8a0: 2020 2069 6620 6320 3d3d 2022 5b22 3a20     if c == "[": 
+0000c8b0: 2023 2073 7065 6369 616c 2d73 7065 6369   # special-speci
+0000c8c0: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
+0000c8d0: 2020 2069 6e5f 7370 6563 6961 6c20 2b3d     in_special +=
+0000c8e0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0000c8f0: 2020 2072 6574 5b2d 315d 202b 3d20 225b     ret[-1] += "[
+0000c900: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
+0000c910: 6966 2063 203d 3d20 225d 223a 0a20 2020  if c == "]":.   
+0000c920: 2020 2020 2020 2020 2020 2020 2069 6e5f               in_
+0000c930: 7370 6563 6961 6c20 2d3d 2031 0a20 2020  special -= 1.   
+0000c940: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000c950: 5b2d 315d 202b 3d20 225d 220a 2020 2020  [-1] += "]".    
+0000c960: 2020 2020 2020 2020 656c 6966 2075 7070          elif upp
+0000c970: 6572 5f63 6173 655f 7370 6563 6961 6c3a  er_case_special:
+0000c980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c990: 2072 6574 5b2d 315d 202b 3d20 632e 7570   ret[-1] += c.up
+0000c9a0: 7065 7228 290a 2020 2020 2020 2020 2020  per().          
+0000c9b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c9c0: 2020 2020 2020 2020 7265 745b 2d31 5d20          ret[-1] 
+0000c9d0: 2b3d 2063 0a20 2020 2020 2020 2065 6c73  += c.        els
+0000c9e0: 653a 2020 2320 6e6f 7420 696e 5f73 7065  e:  # not in_spe
+0000c9f0: 6369 616c 0a20 2020 2020 2020 2020 2020  cial.           
+0000ca00: 2069 6620 7371 7561 7265 5f62 7261 636b   if square_brack
+0000ca10: 6574 735f 666f 725f 7370 6563 6961 6c73  ets_for_specials
+0000ca20: 2061 6e64 2063 203d 3d20 225b 223a 0a20   and c == "[":. 
+0000ca30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ca40: 6e5f 7370 6563 6961 6c20 3d20 310a 2020  n_special = 1.  
+0000ca50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ca60: 7420 2b3d 205b 225b 225d 0a20 2020 2020  t += ["["].     
+0000ca70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000ca80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ca90: 776f 7264 5f62 6173 6564 3a0a 2020 2020  word_based:.    
 0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cab0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-0000cac0: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-0000cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cae0: 7265 7420 2b3d 205b 2222 5d0a 2020 2020  ret += [""].    
-0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb00: 2020 2020 7265 745b 2d31 5d20 2b3d 2063      ret[-1] += c
-0000cb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb20: 2065 6c73 653a 2020 2320 6e6f 7420 776f   else:  # not wo
-0000cb30: 7264 5f62 6173 6564 0a20 2020 2020 2020  rd_based.       
-0000cb40: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000cb50: 202b 3d20 630a 2020 2020 7265 7475 726e   += c.    return
-0000cb60: 2072 6574 0a0a 0a64 6566 2070 6172 7365   ret...def parse
-0000cb70: 5f6f 7274 686f 6772 6170 6879 280a 2020  _orthography(.  
-0000cb80: 2020 6f72 7468 6f67 7261 7068 792c 2070    orthography, p
-0000cb90: 7265 6669 783d 2829 2c20 706f 7374 6669  refix=(), postfi
-0000cba0: 783d 2822 5b45 4e44 5d22 2c29 2c20 7265  x=("[END]",), re
-0000cbb0: 6d6f 7665 5f63 6861 7273 3d22 2829 7b7d  move_chars="(){}
-0000cbc0: 222c 2063 6f6c 6c61 7073 655f 7370 6163  ", collapse_spac
-0000cbd0: 6573 3d54 7275 652c 2066 696e 616c 5f73  es=True, final_s
-0000cbe0: 7472 6970 3d54 7275 652c 202a 2a6b 7761  trip=True, **kwa
-0000cbf0: 7267 730a 293a 0a20 2020 2022 2222 0a20  rgs.):.    """. 
-0000cc00: 2020 2046 6f72 2053 7065 6563 682e 2046     For Speech. F
-0000cc10: 756c 6c20 7072 6f63 6573 7369 6e67 2e0a  ull processing..
-0000cc20: 2020 2020 4578 616d 706c 653a 0a20 2020      Example:.   
-0000cc30: 2020 206f 7274 686f 6772 6170 6879 203d     orthography =
-0000cc40: 2022 6865 6c6c 6f20 5b48 4553 4954 4154   "hello [HESITAT
-0000cc50: 494f 4e5d 2074 6865 7265 2022 0a20 2020  ION] there ".   
-0000cc60: 2020 2077 6974 6820 776f 7264 5f62 6173     with word_bas
-0000cc70: 6564 203d 3d20 4661 6c73 653a 2072 6574  ed == False: ret
-0000cc80: 7572 6e73 206c 6973 7428 2268 656c 6c6f  urns list("hello
-0000cc90: 2022 2920 2b20 5b22 5b48 4553 4954 4154   ") + ["[HESITAT
-0000cca0: 494f 4e5d 225d 202b 206c 6973 7428 2220  ION]"] + list(" 
-0000ccb0: 7468 6572 6522 2920 2b20 5b22 5b45 4e44  there") + ["[END
-0000ccc0: 5d22 5d0a 2020 2020 2020 7769 7468 2077  ]"].      with w
-0000ccd0: 6f72 645f 6261 7365 6420 3d3d 2054 7275  ord_based == Tru
-0000cce0: 653a 2072 6574 7572 6e73 205b 2268 656c  e: returns ["hel
-0000ccf0: 6c6f 222c 2022 5b48 4553 4954 4154 494f  lo", "[HESITATIO
-0000cd00: 4e5d 222c 2022 7468 6572 6522 2c20 225b  N]", "there", "[
-0000cd10: 454e 445d 225d 0a20 2020 2044 6f65 7320  END]"].    Does 
-0000cd20: 736f 6d65 2070 7265 7072 6f63 6573 7369  some preprocessi
-0000cd30: 6e67 206f 6e20 6f72 7468 6f67 7261 7068  ng on orthograph
-0000cd40: 7920 616e 6420 7468 656e 2070 6173 7365  y and then passe
-0000cd50: 7320 6974 206f 6e20 746f 2070 6172 7365  s it on to parse
-0000cd60: 5f6f 7274 686f 6772 6170 6879 5f69 6e74  _orthography_int
-0000cd70: 6f5f 7379 6d62 6f6c 7328 292e 0a0a 2020  o_symbols()...  
-0000cd80: 2020 3a70 6172 616d 2073 7472 206f 7274    :param str ort
-0000cd90: 686f 6772 6170 6879 3a20 652e 672e 2022  hography: e.g. "
-0000cda0: 6865 6c6c 6f20 5b48 4553 4954 4154 494f  hello [HESITATIO
-0000cdb0: 4e5d 2074 6865 7265 2022 0a20 2020 203a  N] there ".    :
-0000cdc0: 7061 7261 6d20 6c69 7374 5b73 7472 5d20  param list[str] 
-0000cdd0: 7072 6566 6978 3a20 7769 6c6c 2061 6464  prefix: will add
-0000cde0: 2074 6869 7320 7072 6566 6978 0a20 2020   this prefix.   
-0000cdf0: 203a 7061 7261 6d20 6c69 7374 5b73 7472   :param list[str
-0000ce00: 5d20 706f 7374 6669 783a 2077 696c 6c20  ] postfix: will 
-0000ce10: 6164 6420 7468 6973 2070 6f73 7466 6978  add this postfix
-0000ce20: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
-0000ce30: 7265 6d6f 7665 5f63 6861 7273 3a20 7468  remove_chars: th
-0000ce40: 6f73 6520 6368 6172 7320 7769 6c6c 206a  ose chars will j
-0000ce50: 7573 7420 6265 2072 656d 6f76 6564 2061  ust be removed a
-0000ce60: 7420 7468 6520 6265 6769 6e6e 696e 670a  t the beginning.
-0000ce70: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
-0000ce80: 636f 6c6c 6170 7365 5f73 7061 6365 733a  collapse_spaces:
-0000ce90: 2077 6865 7468 6572 206d 756c 7469 706c   whether multipl
-0000cea0: 6520 7370 6163 6573 2061 6e64 2074 6162  e spaces and tab
-0000ceb0: 7320 6172 6520 636f 6c6c 6170 7365 6420  s are collapsed 
-0000cec0: 696e 746f 2061 2073 696e 676c 6520 7370  into a single sp
-0000ced0: 6163 650a 2020 2020 3a70 6172 616d 2062  ace.    :param b
-0000cee0: 6f6f 6c20 6669 6e61 6c5f 7374 7269 703a  ool final_strip:
-0000cef0: 2077 6865 7468 6572 2077 6520 7374 7269   whether we stri
-0000cf00: 7020 6c65 6674 2061 6e64 2072 6967 6874  p left and right
-0000cf10: 0a20 2020 203a 7061 7261 6d20 6b77 6172  .    :param kwar
-0000cf20: 6773 3a20 7061 7373 6564 206f 6e20 746f  gs: passed on to
-0000cf30: 2070 6172 7365 5f6f 7274 686f 6772 6170   parse_orthograp
-0000cf40: 6879 5f69 6e74 6f5f 7379 6d62 6f6c 7328  hy_into_symbols(
-0000cf50: 290a 2020 2020 3a72 7479 7065 3a20 6c69  ).    :rtype: li
-0000cf60: 7374 5b73 7472 5d0a 2020 2020 2222 220a  st[str].    """.
-0000cf70: 2020 2020 666f 7220 6320 696e 2072 656d      for c in rem
-0000cf80: 6f76 655f 6368 6172 733a 0a20 2020 2020  ove_chars:.     
-0000cf90: 2020 206f 7274 686f 6772 6170 6879 203d     orthography =
-0000cfa0: 206f 7274 686f 6772 6170 6879 2e72 6570   orthography.rep
-0000cfb0: 6c61 6365 2863 2c20 2222 290a 2020 2020  lace(c, "").    
-0000cfc0: 6966 2063 6f6c 6c61 7073 655f 7370 6163  if collapse_spac
-0000cfd0: 6573 3a0a 2020 2020 2020 2020 6f72 7468  es:.        orth
-0000cfe0: 6f67 7261 7068 7920 3d20 2220 222e 6a6f  ography = " ".jo
-0000cff0: 696e 286f 7274 686f 6772 6170 6879 2e73  in(orthography.s
-0000d000: 706c 6974 2829 290a 2020 2020 6966 2066  plit()).    if f
-0000d010: 696e 616c 5f73 7472 6970 3a0a 2020 2020  inal_strip:.    
-0000d020: 2020 2020 6f72 7468 6f67 7261 7068 7920      orthography 
-0000d030: 3d20 6f72 7468 6f67 7261 7068 792e 7374  = orthography.st
-0000d040: 7269 7028 290a 2020 2020 7265 7475 726e  rip().    return
-0000d050: 206c 6973 7428 7072 6566 6978 2920 2b20   list(prefix) + 
-0000d060: 7061 7273 655f 6f72 7468 6f67 7261 7068  parse_orthograph
-0000d070: 795f 696e 746f 5f73 796d 626f 6c73 286f  y_into_symbols(o
-0000d080: 7274 686f 6772 6170 6879 2c20 2a2a 6b77  rthography, **kw
-0000d090: 6172 6773 2920 2b20 6c69 7374 2870 6f73  args) + list(pos
-0000d0a0: 7466 6978 290a 0a0a 6465 6620 6a73 6f6e  tfix)...def json
-0000d0b0: 5f72 656d 6f76 655f 636f 6d6d 656e 7473  _remove_comments
-0000d0c0: 2873 7472 696e 672c 2073 7472 6970 5f73  (string, strip_s
-0000d0d0: 7061 6365 3d54 7275 6529 3a0a 2020 2020  pace=True):.    
-0000d0e0: 2222 220a 2020 2020 3a74 7970 6520 7374  """.    :type st
-0000d0f0: 7269 6e67 3a20 7374 720a 2020 2020 3a70  ring: str.    :p
-0000d100: 6172 616d 2062 6f6f 6c20 7374 7269 705f  aram bool strip_
-0000d110: 7370 6163 653a 0a20 2020 203a 7274 7970  space:.    :rtyp
-0000d120: 653a 2073 7472 0a0a 2020 2020 7669 6120  e: str..    via 
-0000d130: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0000d140: 6f6d 2f67 6574 6966 792f 4a53 4f4e 2e6d  om/getify/JSON.m
-0000d150: 696e 6966 792f 626c 6f62 2f6d 6173 7465  inify/blob/maste
-0000d160: 722f 6d69 6e69 6679 5f6a 736f 6e2e 7079  r/minify_json.py
-0000d170: 2c0a 2020 2020 6279 2047 6572 616c 6420  ,.    by Gerald 
-0000d180: 5374 6f72 6572 2c20 5072 6164 7975 6e20  Storer, Pradyun 
-0000d190: 532e 2047 6564 616d 2c20 6d6f 6469 6669  S. Gedam, modifi
-0000d1a0: 6564 2062 7920 7573 2e0a 2020 2020 2222  ed by us..    ""
-0000d1b0: 220a 2020 2020 746f 6b65 6e69 7a65 7220  ".    tokenizer 
-0000d1c0: 3d20 7265 2e63 6f6d 7069 6c65 2827 227c  = re.compile('"|
-0000d1d0: 282f 5c5c 2a29 7c28 5c5c 2a2f 297c 282f  (/\\*)|(\\*/)|(/
-0000d1e0: 2f29 7c5c 6e7c 5c72 2729 0a20 2020 2065  /)|\n|\r').    e
-0000d1f0: 6e64 5f73 6c61 7368 6573 5f72 6520 3d20  nd_slashes_re = 
-0000d200: 7265 2e63 6f6d 7069 6c65 2872 2228 5c5c  re.compile(r"(\\
-0000d210: 292a 2422 290a 0a20 2020 2069 6e5f 7374  )*$")..    in_st
-0000d220: 7269 6e67 203d 2046 616c 7365 0a20 2020  ring = False.   
-0000d230: 2069 6e5f 6d75 6c74 6920 3d20 4661 6c73   in_multi = Fals
-0000d240: 650a 2020 2020 696e 5f73 696e 676c 6520  e.    in_single 
-0000d250: 3d20 4661 6c73 650a 0a20 2020 206e 6577  = False..    new
-0000d260: 5f73 7472 203d 205b 5d0a 2020 2020 696e  _str = [].    in
-0000d270: 6465 7820 3d20 300a 0a20 2020 2066 6f72  dex = 0..    for
-0000d280: 206d 6174 6368 2069 6e20 7265 2e66 696e   match in re.fin
-0000d290: 6469 7465 7228 746f 6b65 6e69 7a65 722c  diter(tokenizer,
-0000d2a0: 2073 7472 696e 6729 3a0a 0a20 2020 2020   string):..     
-0000d2b0: 2020 2069 6620 6e6f 7420 2869 6e5f 6d75     if not (in_mu
-0000d2c0: 6c74 6920 6f72 2069 6e5f 7369 6e67 6c65  lti or in_single
-0000d2d0: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
-0000d2e0: 6d70 203d 2073 7472 696e 675b 696e 6465  mp = string[inde
-0000d2f0: 7820 3a20 6d61 7463 682e 7374 6172 7428  x : match.start(
-0000d300: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
-0000d310: 6620 6e6f 7420 696e 5f73 7472 696e 6720  f not in_string 
-0000d320: 616e 6420 7374 7269 705f 7370 6163 653a  and strip_space:
-0000d330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d340: 2023 2072 6570 6c61 6365 2077 6869 7465   # replace white
-0000d350: 2073 7061 6365 2061 7320 6465 6669 6e65   space as define
-0000d360: 6420 696e 2073 7461 6e64 6172 640a 2020  d in standard.  
-0000d370: 2020 2020 2020 2020 2020 2020 2020 746d                tm
-0000d380: 7020 3d20 7265 2e73 7562 2822 5b20 5c74  p = re.sub("[ \t
-0000d390: 5c6e 5c72 5d2b 222c 2022 222c 2074 6d70  \n\r]+", "", tmp
-0000d3a0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-0000d3b0: 775f 7374 722e 6170 7065 6e64 2874 6d70  w_str.append(tmp
-0000d3c0: 290a 0a20 2020 2020 2020 2069 6e64 6578  )..        index
-0000d3d0: 203d 206d 6174 6368 2e65 6e64 2829 0a20   = match.end(). 
-0000d3e0: 2020 2020 2020 2076 616c 203d 206d 6174         val = mat
-0000d3f0: 6368 2e67 726f 7570 2829 0a0a 2020 2020  ch.group()..    
-0000d400: 2020 2020 6966 2076 616c 203d 3d20 2722      if val == '"
-0000d410: 2720 616e 6420 6e6f 7420 2869 6e5f 6d75  ' and not (in_mu
-0000d420: 6c74 6920 6f72 2069 6e5f 7369 6e67 6c65  lti or in_single
-0000d430: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-0000d440: 7363 6170 6564 203d 2065 6e64 5f73 6c61  scaped = end_sla
-0000d450: 7368 6573 5f72 652e 7365 6172 6368 2873  shes_re.search(s
-0000d460: 7472 696e 672c 2030 2c20 6d61 7463 682e  tring, 0, match.
-0000d470: 7374 6172 7428 2929 0a0a 2020 2020 2020  start())..      
-0000d480: 2020 2020 2020 2320 7374 6172 7420 6f66        # start of
-0000d490: 2073 7472 696e 6720 6f72 2075 6e65 7363   string or unesc
-0000d4a0: 6170 6564 2071 756f 7465 2063 6861 7261  aped quote chara
-0000d4b0: 6374 6572 2074 6f20 656e 6420 7374 7269  cter to end stri
-0000d4c0: 6e67 0a20 2020 2020 2020 2020 2020 2069  ng.            i
-0000d4d0: 6620 6e6f 7420 696e 5f73 7472 696e 6720  f not in_string 
-0000d4e0: 6f72 2028 6573 6361 7065 6420 6973 204e  or (escaped is N
-0000d4f0: 6f6e 6520 6f72 206c 656e 2865 7363 6170  one or len(escap
-0000d500: 6564 2e67 726f 7570 2829 2920 2520 3220  ed.group()) % 2 
-0000d510: 3d3d 2030 293a 0a20 2020 2020 2020 2020  == 0):.         
-0000d520: 2020 2020 2020 2069 6e5f 7374 7269 6e67         in_string
-0000d530: 203d 206e 6f74 2069 6e5f 7374 7269 6e67   = not in_string
-0000d540: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-0000d550: 6578 202d 3d20 3120 2023 2069 6e63 6c75  ex -= 1  # inclu
-0000d560: 6465 2022 2063 6861 7261 6374 6572 2069  de " character i
-0000d570: 6e20 6e65 7874 2063 6174 6368 0a20 2020  n next catch.   
-0000d580: 2020 2020 2065 6c69 6620 6e6f 7420 2869       elif not (i
-0000d590: 6e5f 7374 7269 6e67 206f 7220 696e 5f6d  n_string or in_m
-0000d5a0: 756c 7469 206f 7220 696e 5f73 696e 676c  ulti or in_singl
-0000d5b0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000d5c0: 6966 2076 616c 203d 3d20 222f 2a22 3a0a  if val == "/*":.
-0000d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5e0: 696e 5f6d 756c 7469 203d 2054 7275 650a  in_multi = True.
-0000d5f0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000d600: 2076 616c 203d 3d20 222f 2f22 3a0a 2020   val == "//":.  
-0000d610: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0000d620: 5f73 696e 676c 6520 3d20 5472 7565 0a20  _single = True. 
-0000d630: 2020 2020 2020 2065 6c69 6620 7661 6c20         elif val 
-0000d640: 3d3d 2022 2a2f 2220 616e 6420 696e 5f6d  == "*/" and in_m
-0000d650: 756c 7469 2061 6e64 206e 6f74 2028 696e  ulti and not (in
-0000d660: 5f73 7472 696e 6720 6f72 2069 6e5f 7369  _string or in_si
-0000d670: 6e67 6c65 293a 0a20 2020 2020 2020 2020  ngle):.         
-0000d680: 2020 2069 6e5f 6d75 6c74 6920 3d20 4661     in_multi = Fa
-0000d690: 6c73 650a 2020 2020 2020 2020 656c 6966  lse.        elif
-0000d6a0: 2076 616c 2069 6e20 225c 725c 6e22 2061   val in "\r\n" a
-0000d6b0: 6e64 206e 6f74 2028 696e 5f6d 756c 7469  nd not (in_multi
-0000d6c0: 206f 7220 696e 5f73 7472 696e 6729 2061   or in_string) a
-0000d6d0: 6e64 2069 6e5f 7369 6e67 6c65 3a0a 2020  nd in_single:.  
-0000d6e0: 2020 2020 2020 2020 2020 696e 5f73 696e            in_sin
-0000d6f0: 676c 6520 3d20 4661 6c73 650a 2020 2020  gle = False.    
-0000d700: 2020 2020 656c 6966 206e 6f74 2028 2869      elif not ((i
-0000d710: 6e5f 6d75 6c74 6920 6f72 2069 6e5f 7369  n_multi or in_si
-0000d720: 6e67 6c65 2920 6f72 2028 7661 6c20 696e  ngle) or (val in
-0000d730: 2022 205c 725c 6e5c 7422 2061 6e64 2073   " \r\n\t" and s
-0000d740: 7472 6970 5f73 7061 6365 2929 3a0a 2020  trip_space)):.  
-0000d750: 2020 2020 2020 2020 2020 6e65 775f 7374            new_st
-0000d760: 722e 6170 7065 6e64 2876 616c 290a 0a20  r.append(val).. 
-0000d770: 2020 206e 6577 5f73 7472 2e61 7070 656e     new_str.appen
-0000d780: 6428 7374 7269 6e67 5b69 6e64 6578 3a5d  d(string[index:]
-0000d790: 290a 2020 2020 7265 7475 726e 2022 222e  ).    return "".
-0000d7a0: 6a6f 696e 286e 6577 5f73 7472 290a 0a0a  join(new_str)...
-0000d7b0: 6465 6620 5f70 7932 5f75 6e69 636f 6465  def _py2_unicode
-0000d7c0: 5f74 6f5f 7374 725f 7265 6375 7273 6976  _to_str_recursiv
-0000d7d0: 6528 7329 3a0a 2020 2020 2222 220a 2020  e(s):.    """.  
-0000d7e0: 2020 5468 6973 2069 7320 7375 7070 6f73    This is suppos
-0000d7f0: 6564 2074 6f20 6265 2072 756e 2077 6974  ed to be run wit
-0000d800: 6820 5079 7468 6f6e 2032 2e0a 2020 2020  h Python 2..    
-0000d810: 416c 736f 2073 6565 203a 6675 6e63 3a60  Also see :func:`
-0000d820: 6173 5f73 7472 6020 616e 6420 3a66 756e  as_str` and :fun
-0000d830: 633a 6070 7932 5f75 7466 385f 7374 725f  c:`py2_utf8_str_
-0000d840: 746f 5f75 6e69 636f 6465 602e 0a0a 2020  to_unicode`...  
-0000d850: 2020 3a70 6172 616d 2073 7472 7c75 6e69    :param str|uni
-0000d860: 636f 6465 2073 3a20 6f72 2061 6e79 2072  code s: or any r
-0000d870: 6563 7572 7369 7665 2073 7472 7563 7475  ecursive structu
-0000d880: 7265 2073 7563 6820 6173 2064 6963 742c  re such as dict,
-0000d890: 206c 6973 742c 2074 7570 6c65 0a20 2020   list, tuple.   
-0000d8a0: 203a 7265 7475 726e 3a20 5079 7468 6f6e   :return: Python
-0000d8b0: 2032 2073 7472 2028 6973 206c 696b 6520   2 str (is like 
-0000d8c0: 5079 7468 6f6e 2033 2055 5446 2d38 2066  Python 3 UTF-8 f
-0000d8d0: 6f72 6d61 7474 6564 2062 7974 6573 290a  ormatted bytes).
-0000d8e0: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
-0000d8f0: 2020 2020 2222 220a 2020 2020 6966 2069      """.    if i
-0000d900: 7369 6e73 7461 6e63 6528 732c 2064 6963  sinstance(s, dic
-0000d910: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
-0000d920: 726e 207b 5f70 7932 5f75 6e69 636f 6465  rn {_py2_unicode
-0000d930: 5f74 6f5f 7374 725f 7265 6375 7273 6976  _to_str_recursiv
-0000d940: 6528 6b65 7929 3a20 5f70 7932 5f75 6e69  e(key): _py2_uni
-0000d950: 636f 6465 5f74 6f5f 7374 725f 7265 6375  code_to_str_recu
-0000d960: 7273 6976 6528 7661 6c75 6529 2066 6f72  rsive(value) for
-0000d970: 206b 6579 2c20 7661 6c75 6520 696e 2073   key, value in s
-0000d980: 2e69 7465 6d73 2829 7d0a 2020 2020 656c  .items()}.    el
-0000d990: 6966 2069 7369 6e73 7461 6e63 6528 732c  if isinstance(s,
-0000d9a0: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
-0000d9b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d9c0: 6d61 6b65 5f73 6571 5f6f 665f 7479 7065  make_seq_of_type
-0000d9d0: 2874 7970 6528 7329 2c20 5b5f 7079 325f  (type(s), [_py2_
-0000d9e0: 756e 6963 6f64 655f 746f 5f73 7472 5f72  unicode_to_str_r
-0000d9f0: 6563 7572 7369 7665 2865 6c65 6d65 6e74  ecursive(element
-0000da00: 2920 666f 7220 656c 656d 656e 7420 696e  ) for element in
-0000da10: 2073 5d29 0a20 2020 2065 6c69 6620 6973   s]).    elif is
-0000da20: 696e 7374 616e 6365 2873 2c20 756e 6963  instance(s, unic
-0000da30: 6f64 6529 3a0a 2020 2020 2020 2020 7265  ode):.        re
-0000da40: 7475 726e 2073 2e65 6e63 6f64 6528 2275  turn s.encode("u
-0000da50: 7466 2d38 2229 2020 2320 5079 7468 6f6e  tf-8")  # Python
-0000da60: 2032 2073 7472 2c20 5079 7468 6f6e 2033   2 str, Python 3
-0000da70: 2062 7974 6573 0a20 2020 2065 6c73 653a   bytes.    else:
-0000da80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000da90: 730a 0a0a 6465 6620 6c6f 6164 5f6a 736f  s...def load_jso
-0000daa0: 6e28 6669 6c65 6e61 6d65 3d4e 6f6e 652c  n(filename=None,
-0000dab0: 2063 6f6e 7465 6e74 3d4e 6f6e 6529 3a0a   content=None):.
-0000dac0: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-0000dad0: 616d 2073 7472 7c4e 6f6e 6520 6669 6c65  am str|None file
-0000dae0: 6e61 6d65 3a0a 2020 2020 3a70 6172 616d  name:.    :param
-0000daf0: 2073 7472 7c4e 6f6e 6520 636f 6e74 656e   str|None conten
-0000db00: 743a 0a20 2020 203a 7274 7970 653a 2064  t:.    :rtype: d
-0000db10: 6963 745b 7374 725d 0a20 2020 2022 2222  ict[str].    """
-0000db20: 0a20 2020 2069 6620 636f 6e74 656e 743a  .    if content:
-0000db30: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0000db40: 6e6f 7420 6669 6c65 6e61 6d65 0a20 2020  not filename.   
-0000db50: 2065 6c73 653a 0a20 2020 2020 2020 2063   else:.        c
-0000db60: 6f6e 7465 6e74 203d 206f 7065 6e28 6669  ontent = open(fi
-0000db70: 6c65 6e61 6d65 292e 7265 6164 2829 0a20  lename).read(). 
-0000db80: 2020 2069 6d70 6f72 7420 6a73 6f6e 0a0a     import json..
-0000db90: 2020 2020 636f 6e74 656e 7420 3d20 6a73      content = js
-0000dba0: 6f6e 5f72 656d 6f76 655f 636f 6d6d 656e  on_remove_commen
-0000dbb0: 7473 2863 6f6e 7465 6e74 290a 2020 2020  ts(content).    
-0000dbc0: 7472 793a 0a20 2020 2020 2020 206a 736f  try:.        jso
-0000dbd0: 6e5f 636f 6e74 656e 7420 3d20 6a73 6f6e  n_content = json
-0000dbe0: 2e6c 6f61 6473 2863 6f6e 7465 6e74 290a  .loads(content).
-0000dbf0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-0000dc00: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0000dc10: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0000dc20: 696f 6e28 2263 6f6e 6669 6720 6c6f 6f6b  ion("config look
-0000dc30: 7320 6c69 6b65 204a 534f 4e20 6275 7420  s like JSON but 
-0000dc40: 696e 7661 6c69 6420 6a73 6f6e 2063 6f6e  invalid json con
-0000dc50: 7465 6e74 2c20 2572 2220 2520 6529 0a20  tent, %r" % e). 
-0000dc60: 2020 2069 6620 6e6f 7420 5059 333a 0a20     if not PY3:. 
-0000dc70: 2020 2020 2020 206a 736f 6e5f 636f 6e74         json_cont
-0000dc80: 656e 7420 3d20 5f70 7932 5f75 6e69 636f  ent = _py2_unico
-0000dc90: 6465 5f74 6f5f 7374 725f 7265 6375 7273  de_to_str_recurs
-0000dca0: 6976 6528 6a73 6f6e 5f63 6f6e 7465 6e74  ive(json_content
-0000dcb0: 290a 2020 2020 7265 7475 726e 206a 736f  ).    return jso
-0000dcc0: 6e5f 636f 6e74 656e 740a 0a0a 636c 6173  n_content...clas
-0000dcd0: 7320 4e75 6d62 6572 7344 6963 743a 0a20  s NumbersDict:. 
-0000dce0: 2020 2022 2222 0a20 2020 2049 7427 7320     """.    It's 
-0000dcf0: 6d6f 7374 6c79 206c 696b 6520 6469 6374  mostly like dict
-0000dd00: 5b73 7472 2c66 6c6f 6174 7c69 6e74 5d20  [str,float|int] 
-0000dd10: 2620 736f 6d65 206f 7074 696f 6e61 6c20  & some optional 
-0000dd20: 6272 6f61 6463 6173 7420 6465 6661 756c  broadcast defaul
-0000dd30: 7420 7661 6c75 652e 0a20 2020 2049 7420  t value..    It 
-0000dd40: 696d 706c 656d 656e 7473 2074 6865 2073  implements the s
-0000dd50: 7461 6e64 6172 6420 6d61 7468 2062 696e  tandard math bin
-0000dd60: 206f 7073 2069 6e20 6120 7374 7261 6967   ops in a straig
-0000dd70: 6874 2d66 6f72 7761 7264 2077 6179 2e0a  ht-forward way..
-0000dd80: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-0000dd90: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0000dda0: 6175 746f 5f63 6f6e 7665 7274 3d4e 6f6e  auto_convert=Non
-0000ddb0: 652c 206e 756d 6265 7273 5f64 6963 743d  e, numbers_dict=
-0000ddc0: 4e6f 6e65 2c20 6272 6f61 6463 6173 745f  None, broadcast_
-0000ddd0: 7661 6c75 653d 4e6f 6e65 293a 0a20 2020  value=None):.   
-0000dde0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000ddf0: 203a 7061 7261 6d20 6469 6374 7c4e 756d   :param dict|Num
-0000de00: 6265 7273 4469 6374 7c54 2061 7574 6f5f  bersDict|T auto_
-0000de10: 636f 6e76 6572 743a 2066 6972 7374 2061  convert: first a
-0000de20: 7267 756d 656e 742c 2073 6f20 7468 6174  rgument, so that
-0000de30: 2077 6520 6361 6e20 6175 746f 6d61 7469   we can automati
-0000de40: 6361 6c6c 7920 636f 6e76 6572 742f 636f  cally convert/co
-0000de50: 7079 0a20 2020 2020 2020 203a 7061 7261  py.        :para
-0000de60: 6d20 6469 6374 206e 756d 6265 7273 5f64  m dict numbers_d
-0000de70: 6963 743a 0a20 2020 2020 2020 203a 7061  ict:.        :pa
-0000de80: 7261 6d20 5420 6272 6f61 6463 6173 745f  ram T broadcast_
-0000de90: 7661 6c75 653a 0a20 2020 2020 2020 2022  value:.        "
-0000dea0: 2222 0a20 2020 2020 2020 2069 6620 6175  "".        if au
-0000deb0: 746f 5f63 6f6e 7665 7274 2069 7320 6e6f  to_convert is no
-0000dec0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000ded0: 2020 2020 6173 7365 7274 2062 726f 6164      assert broad
-0000dee0: 6361 7374 5f76 616c 7565 2069 7320 4e6f  cast_value is No
-0000def0: 6e65 0a20 2020 2020 2020 2020 2020 2061  ne.            a
-0000df00: 7373 6572 7420 6e75 6d62 6572 735f 6469  ssert numbers_di
-0000df10: 6374 2069 7320 4e6f 6e65 0a20 2020 2020  ct is None.     
-0000df20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000df30: 616e 6365 2861 7574 6f5f 636f 6e76 6572  ance(auto_conver
-0000df40: 742c 2064 6963 7429 3a0a 2020 2020 2020  t, dict):.      
-0000df50: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
-0000df60: 735f 6469 6374 203d 2061 7574 6f5f 636f  s_dict = auto_co
-0000df70: 6e76 6572 740a 2020 2020 2020 2020 2020  nvert.          
-0000df80: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0000df90: 6528 6175 746f 5f63 6f6e 7665 7274 2c20  e(auto_convert, 
-0000dfa0: 4e75 6d62 6572 7344 6963 7429 3a0a 2020  NumbersDict):.  
-0000dfb0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-0000dfc0: 6d62 6572 735f 6469 6374 203d 2061 7574  mbers_dict = aut
-0000dfd0: 6f5f 636f 6e76 6572 742e 6469 6374 0a20  o_convert.dict. 
-0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000dff0: 726f 6164 6361 7374 5f76 616c 7565 203d  roadcast_value =
-0000e000: 2061 7574 6f5f 636f 6e76 6572 742e 7661   auto_convert.va
-0000e010: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-0000e020: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000e030: 2020 2020 2020 6272 6f61 6463 6173 745f        broadcast_
-0000e040: 7661 6c75 6520 3d20 6175 746f 5f63 6f6e  value = auto_con
-0000e050: 7665 7274 0a20 2020 2020 2020 2069 6620  vert.        if 
-0000e060: 6e75 6d62 6572 735f 6469 6374 2069 7320  numbers_dict is 
-0000e070: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e080: 2020 6e75 6d62 6572 735f 6469 6374 203d    numbers_dict =
-0000e090: 207b 7d0a 2020 2020 2020 2020 656c 7365   {}.        else
-0000e0a0: 3a0a 2020 2020 2020 2020 2020 2020 6e75  :.            nu
-0000e0b0: 6d62 6572 735f 6469 6374 203d 2064 6963  mbers_dict = dic
-0000e0c0: 7428 6e75 6d62 6572 735f 6469 6374 2920  t(numbers_dict) 
-0000e0d0: 2023 2066 6f72 6365 2063 6f70 790a 0a20   # force copy.. 
-0000e0e0: 2020 2020 2020 2073 656c 662e 6469 6374         self.dict
-0000e0f0: 203d 206e 756d 6265 7273 5f64 6963 740a   = numbers_dict.
-0000e100: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-0000e110: 7565 203d 2062 726f 6164 6361 7374 5f76  ue = broadcast_v
-0000e120: 616c 7565 0a20 2020 2020 2020 2073 656c  alue.        sel
-0000e130: 662e 6d61 7820 3d20 7365 6c66 2e5f 6d61  f.max = self._ma
-0000e140: 785f 6572 726f 720a 0a20 2020 2064 6566  x_error..    def
-0000e150: 2063 6f70 7928 7365 6c66 293a 0a20 2020   copy(self):.   
-0000e160: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e170: 203a 7274 7970 653a 204e 756d 6265 7273   :rtype: Numbers
-0000e180: 4469 6374 0a20 2020 2020 2020 2022 2222  Dict.        """
-0000e190: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000e1a0: 4e75 6d62 6572 7344 6963 7428 7365 6c66  NumbersDict(self
-0000e1b0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-0000e1c0: 686f 640a 2020 2020 6465 6620 636f 6e73  hod.    def cons
-0000e1d0: 7461 6e74 5f6c 696b 6528 636c 732c 2063  tant_like(cls, c
-0000e1e0: 6f6e 7374 5f6e 756d 6265 722c 206e 756d  onst_number, num
-0000e1f0: 6265 7273 5f64 6963 7429 3a0a 2020 2020  bers_dict):.    
-0000e200: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e210: 3a70 6172 616d 2069 6e74 7c66 6c6f 6174  :param int|float
-0000e220: 7c6f 626a 6563 7420 636f 6e73 745f 6e75  |object const_nu
-0000e230: 6d62 6572 3a0a 2020 2020 2020 2020 3a70  mber:.        :p
-0000e240: 6172 616d 204e 756d 6265 7273 4469 6374  aram NumbersDict
-0000e250: 206e 756d 6265 7273 5f64 6963 743a 0a20   numbers_dict:. 
-0000e260: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0000e270: 4e75 6d62 6572 7344 6963 7420 7769 7468  NumbersDict with
-0000e280: 2073 616d 6520 6b65 7973 2061 7320 6e75   same keys as nu
-0000e290: 6d62 6572 735f 6469 6374 0a20 2020 2020  mbers_dict.     
-0000e2a0: 2020 203a 7274 7970 653a 204e 756d 6265     :rtype: Numbe
-0000e2b0: 7273 4469 6374 0a20 2020 2020 2020 2022  rsDict.        "
-0000e2c0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000e2d0: 6e20 4e75 6d62 6572 7344 6963 7428 0a20  n NumbersDict(. 
-0000e2e0: 2020 2020 2020 2020 2020 2062 726f 6164             broad
-0000e2f0: 6361 7374 5f76 616c 7565 3d63 6f6e 7374  cast_value=const
-0000e300: 5f6e 756d 6265 7220 6966 2028 6e75 6d62  _number if (numb
-0000e310: 6572 735f 6469 6374 2e76 616c 7565 2069  ers_dict.value i
-0000e320: 7320 6e6f 7420 4e6f 6e65 2920 656c 7365  s not None) else
-0000e330: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-0000e340: 2020 206e 756d 6265 7273 5f64 6963 743d     numbers_dict=
-0000e350: 7b6b 3a20 636f 6e73 745f 6e75 6d62 6572  {k: const_number
-0000e360: 2066 6f72 206b 2069 6e20 6e75 6d62 6572   for k in number
-0000e370: 735f 6469 6374 2e64 6963 742e 6b65 7973  s_dict.dict.keys
-0000e380: 2829 7d2c 0a20 2020 2020 2020 2029 0a0a  ()},.        )..
-0000e390: 2020 2020 6465 6620 636f 7079 5f6c 696b      def copy_lik
-0000e3a0: 6528 7365 6c66 2c20 6e75 6d62 6572 735f  e(self, numbers_
-0000e3b0: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
-0000e3c0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-0000e3d0: 6d20 4e75 6d62 6572 7344 6963 7420 6e75  m NumbersDict nu
-0000e3e0: 6d62 6572 735f 6469 6374 3a0a 2020 2020  mbers_dict:.    
-0000e3f0: 2020 2020 3a72 6574 7572 6e3a 2063 6f70      :return: cop
-0000e400: 7920 6f66 2073 656c 6620 7769 7468 2073  y of self with s
-0000e410: 616d 6520 6b65 7973 2061 7320 6e75 6d62  ame keys as numb
-0000e420: 6572 735f 6469 6374 2061 7320 6661 7220  ers_dict as far 
-0000e430: 6173 2077 6520 6861 7665 2074 6865 6d0a  as we have them.
-0000e440: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-0000e450: 4e75 6d62 6572 7344 6963 740a 2020 2020  NumbersDict.    
-0000e460: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e470: 6966 2073 656c 662e 7661 6c75 6520 6973  if self.value is
-0000e480: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000e490: 2020 2020 2020 2072 6574 7572 6e20 4e75         return Nu
-0000e4a0: 6d62 6572 7344 6963 7428 0a20 2020 2020  mbersDict(.     
-0000e4b0: 2020 2020 2020 2020 2020 2062 726f 6164             broad
-0000e4c0: 6361 7374 5f76 616c 7565 3d73 656c 662e  cast_value=self.
-0000e4d0: 7661 6c75 6520 6966 2028 6e75 6d62 6572  value if (number
-0000e4e0: 735f 6469 6374 2e76 616c 7565 2069 7320  s_dict.value is 
-0000e4f0: 6e6f 7420 4e6f 6e65 2920 656c 7365 204e  not None) else N
-0000e500: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0000e510: 2020 2020 206e 756d 6265 7273 5f64 6963       numbers_dic
-0000e520: 743d 7b6b 3a20 7365 6c66 5b6b 5d20 666f  t={k: self[k] fo
-0000e530: 7220 6b20 696e 206e 756d 6265 7273 5f64  r k in numbers_d
-0000e540: 6963 742e 6469 6374 2e6b 6579 7328 297d  ict.dict.keys()}
-0000e550: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000e560: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000e570: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000e580: 204e 756d 6265 7273 4469 6374 280a 2020   NumbersDict(.  
-0000e590: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0000e5a0: 6f61 6463 6173 745f 7661 6c75 653d 4e6f  oadcast_value=No
-0000e5b0: 6e65 2c20 6e75 6d62 6572 735f 6469 6374  ne, numbers_dict
-0000e5c0: 3d7b 6b3a 2073 656c 665b 6b5d 2066 6f72  ={k: self[k] for
-0000e5d0: 206b 2069 6e20 6e75 6d62 6572 735f 6469   k in numbers_di
-0000e5e0: 6374 2e64 6963 742e 6b65 7973 2829 2069  ct.dict.keys() i
-0000e5f0: 6620 6b20 696e 2073 656c 662e 6469 6374  f k in self.dict
-0000e600: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
-0000e610: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0000e620: 2020 2064 6566 206b 6579 735f 7365 7428     def keys_set(
-0000e630: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000e640: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
-0000e650: 653a 2073 6574 5b73 7472 5d0a 2020 2020  e: set[str].    
-0000e660: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e670: 7265 7475 726e 2073 6574 2873 656c 662e  return set(self.
-0000e680: 6469 6374 2e6b 6579 7328 2929 0a0a 2020  dict.keys())..  
-0000e690: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
-0000e6a0: 5f28 7365 6c66 2c20 6b65 7929 3a0a 2020  _(self, key):.  
-0000e6b0: 2020 2020 2020 6966 2073 656c 662e 7661        if self.va
-0000e6c0: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
-0000e6d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e6e0: 7572 6e20 7365 6c66 2e64 6963 742e 6765  urn self.dict.ge
-0000e6f0: 7428 6b65 792c 2073 656c 662e 7661 6c75  t(key, self.valu
-0000e700: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-0000e710: 6e20 7365 6c66 2e64 6963 745b 6b65 795d  n self.dict[key]
-0000e720: 0a0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
-0000e730: 7465 6d5f 5f28 7365 6c66 2c20 6b65 792c  tem__(self, key,
-0000e740: 2076 616c 7565 293a 0a20 2020 2020 2020   value):.       
-0000e750: 2073 656c 662e 6469 6374 5b6b 6579 5d20   self.dict[key] 
-0000e760: 3d20 7661 6c75 650a 0a20 2020 2064 6566  = value..    def
-0000e770: 205f 5f64 656c 6974 656d 5f5f 2873 656c   __delitem__(sel
-0000e780: 662c 206b 6579 293a 0a20 2020 2020 2020  f, key):.       
-0000e790: 2064 656c 2073 656c 662e 6469 6374 5b6b   del self.dict[k
-0000e7a0: 6579 5d0a 0a20 2020 2064 6566 2067 6574  ey]..    def get
-0000e7b0: 2873 656c 662c 206b 6579 2c20 6465 6661  (self, key, defa
-0000e7c0: 756c 743d 4e6f 6e65 293a 0a20 2020 2020  ult=None):.     
-0000e7d0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-0000e7e0: 7061 7261 6d20 7374 7220 6b65 793a 0a20  param str key:. 
-0000e7f0: 2020 2020 2020 203a 7061 7261 6d20 5420         :param T 
-0000e800: 6465 6661 756c 743a 0a20 2020 2020 2020  default:.       
-0000e810: 203a 7274 7970 653a 206f 626a 6563 747c   :rtype: object|
-0000e820: 540a 2020 2020 2020 2020 2222 220a 2020  T.        """.  
-0000e830: 2020 2020 2020 2320 4b65 6570 2063 6f6e        # Keep con
-0000e840: 7369 7374 656e 7420 7769 7468 2073 656c  sistent with sel
-0000e850: 662e 5f5f 6765 745f 6974 656d 5f5f 2e20  f.__get_item__. 
-0000e860: 4966 2073 656c 662e 7661 6c75 6520 6973  If self.value is
-0000e870: 2073 6574 2c20 7468 6973 2077 696c 6c20   set, this will 
-0000e880: 616c 7761 7973 2062 6520 7468 6520 6465  always be the de
-0000e890: 6661 756c 7420 7661 6c75 652e 0a20 2020  fault value..   
-0000e8a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000e8b0: 2e64 6963 742e 6765 7428 6b65 792c 2073  .dict.get(key, s
-0000e8c0: 656c 662e 7661 6c75 6520 6966 2073 656c  elf.value if sel
-0000e8d0: 662e 7661 6c75 6520 6973 206e 6f74 204e  f.value is not N
-0000e8e0: 6f6e 6520 656c 7365 2064 6566 6175 6c74  one else default
-0000e8f0: 290a 0a20 2020 2064 6566 2070 6f70 2873  )..    def pop(s
-0000e900: 656c 662c 206b 6579 2c20 2a61 7267 7329  elf, key, *args)
-0000e910: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000e920: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
-0000e930: 206b 6579 3a0a 2020 2020 2020 2020 3a70   key:.        :p
-0000e940: 6172 616d 2054 2061 7267 733a 2064 6566  aram T args: def
-0000e950: 6175 6c74 2c20 6f72 206e 6f74 0a20 2020  ault, or not.   
-0000e960: 2020 2020 203a 7274 7970 653a 206f 626a       :rtype: obj
-0000e970: 6563 747c 540a 2020 2020 2020 2020 2222  ect|T.        ""
-0000e980: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000e990: 2073 656c 662e 6469 6374 2e70 6f70 286b   self.dict.pop(k
-0000e9a0: 6579 2c20 2a61 7267 7329 0a0a 2020 2020  ey, *args)..    
-0000e9b0: 6465 6620 5f5f 6974 6572 5f5f 2873 656c  def __iter__(sel
-0000e9c0: 6629 3a0a 2020 2020 2020 2020 2320 5468  f):.        # Th
-0000e9d0: 6973 2063 616e 2070 6f74 656e 7469 616c  is can potential
-0000e9e0: 6c79 2063 6175 7365 2063 6f6e 6675 7369  ly cause confusi
-0000e9f0: 6f6e 2e20 536f 2065 6e66 6f72 6365 2065  on. So enforce e
-0000ea00: 7870 6c69 6369 746e 6573 732e 0a20 2020  xplicitness..   
-0000ea10: 2020 2020 2023 2046 6f72 2061 2064 6963       # For a dic
-0000ea20: 742c 2077 6520 776f 756c 6420 7265 7475  t, we would retu
-0000ea30: 726e 2074 6865 2064 6963 7420 6b65 7973  rn the dict keys
-0000ea40: 2068 6572 652e 0a20 2020 2020 2020 2023   here..        #
-0000ea50: 2041 6c73 6f2c 206d 6178 2873 656c 6629   Also, max(self)
-0000ea60: 2077 6f75 6c64 2072 6573 756c 7420 696e   would result in
-0000ea70: 2061 2063 616c 6c20 746f 2073 656c 662e   a call to self.
-0000ea80: 5f5f 6974 6572 5f5f 2829 2c0a 2020 2020  __iter__(),.    
-0000ea90: 2020 2020 2320 7768 6963 6820 776f 756c      # which woul
-0000eaa0: 6420 6f6e 6c79 206d 616b 6520 7365 6e73  d only make sens
-0000eab0: 6520 666f 7220 6f75 7220 7661 6c75 6573  e for our values
-0000eac0: 2c20 6e6f 7420 7468 6520 6469 6374 206b  , not the dict k
-0000ead0: 6579 732e 0a20 2020 2020 2020 2072 6169  eys..        rai
-0000eae0: 7365 2045 7863 6570 7469 6f6e 2822 2573  se Exception("%s
-0000eaf0: 2e5f 5f69 7465 725f 5f20 6973 2075 6e64  .__iter__ is und
-0000eb00: 6566 696e 6564 2220 2520 7365 6c66 2e5f  efined" % self._
-0000eb10: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0000eb20: 5f29 0a0a 2020 2020 6465 6620 6b65 7973  _)..    def keys
-0000eb30: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000eb40: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
-0000eb50: 7065 3a20 7365 745b 7374 725d 0a20 2020  pe: set[str].   
-0000eb60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000eb70: 2072 6574 7572 6e20 7365 6c66 2e64 6963   return self.dic
-0000eb80: 742e 6b65 7973 2829 0a0a 2020 2020 6465  t.keys()..    de
-0000eb90: 6620 7661 6c75 6573 2873 656c 6629 3a0a  f values(self):.
-0000eba0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000ebb0: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
-0000ebc0: 5b6f 626a 6563 745d 0a20 2020 2020 2020  [object].       
-0000ebd0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0000ebe0: 7572 6e20 6c69 7374 2873 656c 662e 6469  urn list(self.di
-0000ebf0: 6374 2e76 616c 7565 7328 2929 202b 2028  ct.values()) + (
-0000ec00: 5b73 656c 662e 7661 6c75 655d 2069 6620  [self.value] if 
-0000ec10: 7365 6c66 2e76 616c 7565 2069 7320 6e6f  self.value is no
-0000ec20: 7420 4e6f 6e65 2065 6c73 6520 5b5d 290a  t None else []).
-0000ec30: 0a20 2020 2064 6566 2069 7465 6d73 2873  .    def items(s
-0000ec40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000ec50: 220a 2020 2020 2020 2020 3a72 6574 7572  ".        :retur
-0000ec60: 6e3a 2064 6963 7420 6974 656d 732e 2074  n: dict items. t
-0000ec70: 6869 7320 6578 636c 7564 6573 2073 656c  his excludes sel
-0000ec80: 662e 7661 6c75 650a 2020 2020 2020 2020  f.value.        
-0000ec90: 3a72 7479 7065 3a20 7374 725b 2873 7472  :rtype: str[(str
-0000eca0: 2c6f 626a 6563 7429 5d0a 2020 2020 2020  ,object)].      
-0000ecb0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0000ecc0: 7475 726e 2073 656c 662e 6469 6374 2e69  turn self.dict.i
-0000ecd0: 7465 6d73 2829 0a0a 2020 2020 6465 6620  tems()..    def 
-0000ece0: 6861 735f 7661 6c75 6573 2873 656c 6629  has_values(self)
-0000ecf0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000ed00: 2020 2020 2020 3a72 7479 7065 3a20 626f        :rtype: bo
-0000ed10: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
-0000ed20: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
-0000ed30: 6f6c 2873 656c 662e 6469 6374 2920 6f72  ol(self.dict) or
-0000ed40: 2073 656c 662e 7661 6c75 6520 6973 206e   self.value is n
-0000ed50: 6f74 204e 6f6e 650a 0a20 2020 2064 6566  ot None..    def
-0000ed60: 2075 6e61 7279 5f6f 7028 7365 6c66 2c20   unary_op(self, 
-0000ed70: 6f70 293a 0a20 2020 2020 2020 2022 2222  op):.        """
-0000ed80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000ed90: 2854 292d 3e54 3220 6f70 3a0a 2020 2020  (T)->T2 op:.    
-0000eda0: 2020 2020 3a72 6574 7572 6e3a 206e 6577      :return: new
-0000edb0: 204e 756d 6265 7273 4469 6374 2c20 7768   NumbersDict, wh
-0000edc0: 6572 6520 6060 6f70 6060 2069 7320 6170  ere ``op`` is ap
-0000edd0: 706c 6965 6420 6f6e 2061 6c6c 2076 616c  plied on all val
-0000ede0: 7565 730a 2020 2020 2020 2020 3a72 7479  ues.        :rty
-0000edf0: 7065 3a20 4e75 6d62 6572 7344 6963 740a  pe: NumbersDict.
-0000ee00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000ee10: 2020 2020 7265 7320 3d20 4e75 6d62 6572      res = Number
-0000ee20: 7344 6963 7428 290a 2020 2020 2020 2020  sDict().        
-0000ee30: 6966 2073 656c 662e 7661 6c75 6520 6973  if self.value is
-0000ee40: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000ee50: 2020 2020 2020 2072 6573 2e76 616c 7565         res.value
-0000ee60: 203d 206f 7028 7365 6c66 2e76 616c 7565   = op(self.value
-0000ee70: 290a 2020 2020 2020 2020 666f 7220 6b2c  ).        for k,
-0000ee80: 2076 2069 6e20 7365 6c66 2e64 6963 742e   v in self.dict.
-0000ee90: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0000eea0: 2020 2020 2072 6573 2e64 6963 745b 6b5d       res.dict[k]
-0000eeb0: 203d 206f 7028 7629 0a20 2020 2020 2020   = op(v).       
-0000eec0: 2072 6574 7572 6e20 7265 730a 0a20 2020   return res..   
-0000eed0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000eee0: 2020 6465 6620 6269 6e5f 6f70 5f73 6361    def bin_op_sca
-0000eef0: 6c61 725f 6f70 7469 6f6e 616c 2863 6c73  lar_optional(cls
-0000ef00: 2c20 7365 6c66 2c20 6f74 6865 722c 207a  , self, other, z
-0000ef10: 6572 6f2c 206f 7029 3a0a 2020 2020 2020  ero, op):.      
-0000ef20: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-0000ef30: 6172 616d 2054 2073 656c 663a 0a20 2020  aram T self:.   
-0000ef40: 2020 2020 203a 7061 7261 6d20 5420 6f74       :param T ot
-0000ef50: 6865 723a 0a20 2020 2020 2020 203a 7061  her:.        :pa
-0000ef60: 7261 6d20 5420 7a65 726f 3a0a 2020 2020  ram T zero:.    
-0000ef70: 2020 2020 3a70 6172 616d 2028 542c 5429      :param (T,T)
-0000ef80: 2d3e 5420 6f70 3a0a 2020 2020 2020 2020  ->T op:.        
-0000ef90: 3a72 7479 7065 3a20 540a 2020 2020 2020  :rtype: T.      
-0000efa0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-0000efb0: 2073 656c 6620 6973 204e 6f6e 6520 616e   self is None an
-0000efc0: 6420 6f74 6865 7220 6973 204e 6f6e 653a  d other is None:
-0000efd0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000efe0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000eff0: 2069 6620 7365 6c66 2069 7320 4e6f 6e65   if self is None
-0000f000: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000f010: 6c66 203d 207a 6572 6f0a 2020 2020 2020  lf = zero.      
-0000f020: 2020 6966 206f 7468 6572 2069 7320 4e6f    if other is No
-0000f030: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000f040: 6f74 6865 7220 3d20 7a65 726f 0a20 2020  other = zero.   
-0000f050: 2020 2020 2072 6574 7572 6e20 6f70 2873       return op(s
-0000f060: 656c 662c 206f 7468 6572 290a 0a20 2020  elf, other)..   
-0000f070: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000f080: 2020 6465 6620 6269 6e5f 6f70 2863 6c73    def bin_op(cls
-0000f090: 2c20 7365 6c66 2c20 6f74 6865 722c 206f  , self, other, o
-0000f0a0: 702c 207a 6572 6f2c 2072 6573 756c 743d  p, zero, result=
-0000f0b0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-0000f0c0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-0000f0d0: 6d20 4e75 6d62 6572 7344 6963 747c 696e  m NumbersDict|in
-0000f0e0: 747c 666c 6f61 747c 5420 7365 6c66 3a0a  t|float|T self:.
-0000f0f0: 2020 2020 2020 2020 3a70 6172 616d 204e          :param N
-0000f100: 756d 6265 7273 4469 6374 7c69 6e74 7c66  umbersDict|int|f
-0000f110: 6c6f 6174 7c54 206f 7468 6572 3a0a 2020  loat|T other:.  
-0000f120: 2020 2020 2020 3a70 6172 616d 2028 542c        :param (T,
-0000f130: 5429 2d3e 5420 6f70 3a0a 2020 2020 2020  T)->T op:.      
-0000f140: 2020 3a70 6172 616d 2054 207a 6572 6f3a    :param T zero:
-0000f150: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000f160: 4e75 6d62 6572 7344 6963 747c 4e6f 6e65  NumbersDict|None
-0000f170: 2072 6573 756c 743a 0a20 2020 2020 2020   result:.       
-0000f180: 203a 7274 7970 653a 204e 756d 6265 7273   :rtype: Numbers
-0000f190: 4469 6374 0a20 2020 2020 2020 2022 2222  Dict.        """
-0000f1a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000f1b0: 6973 696e 7374 616e 6365 2873 656c 662c  isinstance(self,
-0000f1c0: 204e 756d 6265 7273 4469 6374 293a 0a20   NumbersDict):. 
-0000f1d0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0000f1e0: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
-0000f1f0: 4e75 6d62 6572 7344 6963 7429 3a0a 2020  NumbersDict):.  
-0000f200: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000f210: 6c66 203d 204e 756d 6265 7273 4469 6374  lf = NumbersDict
-0000f220: 2e63 6f6e 7374 616e 745f 6c69 6b65 2873  .constant_like(s
-0000f230: 656c 662c 206e 756d 6265 7273 5f64 6963  elf, numbers_dic
-0000f240: 743d 6f74 6865 7229 0a20 2020 2020 2020  t=other).       
-0000f250: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000f260: 2020 2020 2020 2020 2020 2073 656c 6620             self 
-0000f270: 3d20 4e75 6d62 6572 7344 6963 7428 7365  = NumbersDict(se
-0000f280: 6c66 290a 2020 2020 2020 2020 6966 206e  lf).        if n
-0000f290: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
-0000f2a0: 6865 722c 204e 756d 6265 7273 4469 6374  her, NumbersDict
-0000f2b0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-0000f2c0: 7468 6572 203d 204e 756d 6265 7273 4469  ther = NumbersDi
-0000f2d0: 6374 2e63 6f6e 7374 616e 745f 6c69 6b65  ct.constant_like
-0000f2e0: 286f 7468 6572 2c20 6e75 6d62 6572 735f  (other, numbers_
-0000f2f0: 6469 6374 3d73 656c 6629 0a20 2020 2020  dict=self).     
-0000f300: 2020 2069 6620 7265 7375 6c74 2069 7320     if result is 
-0000f310: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000f320: 2020 7265 7375 6c74 203d 204e 756d 6265    result = Numbe
-0000f330: 7273 4469 6374 2829 0a20 2020 2020 2020  rsDict().       
-0000f340: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-0000f350: 6365 2872 6573 756c 742c 204e 756d 6265  ce(result, Numbe
-0000f360: 7273 4469 6374 290a 2020 2020 2020 2020  rsDict).        
-0000f370: 666f 7220 6b20 696e 2073 656c 662e 6b65  for k in self.ke
-0000f380: 7973 5f73 6574 207c 206f 7468 6572 2e6b  ys_set | other.k
-0000f390: 6579 735f 7365 743a 0a20 2020 2020 2020  eys_set:.       
-0000f3a0: 2020 2020 2072 6573 756c 745b 6b5d 203d       result[k] =
-0000f3b0: 2063 6c73 2e62 696e 5f6f 705f 7363 616c   cls.bin_op_scal
-0000f3c0: 6172 5f6f 7074 696f 6e61 6c28 7365 6c66  ar_optional(self
-0000f3d0: 2e67 6574 286b 2c20 4e6f 6e65 292c 206f  .get(k, None), o
-0000f3e0: 7468 6572 2e67 6574 286b 2c20 4e6f 6e65  ther.get(k, None
-0000f3f0: 292c 207a 6572 6f3d 7a65 726f 2c20 6f70  ), zero=zero, op
-0000f400: 3d6f 7029 0a20 2020 2020 2020 2072 6573  =op).        res
-0000f410: 756c 742e 7661 6c75 6520 3d20 636c 732e  ult.value = cls.
-0000f420: 6269 6e5f 6f70 5f73 6361 6c61 725f 6f70  bin_op_scalar_op
-0000f430: 7469 6f6e 616c 2873 656c 662e 7661 6c75  tional(self.valu
-0000f440: 652c 206f 7468 6572 2e76 616c 7565 2c20  e, other.value, 
-0000f450: 7a65 726f 3d7a 6572 6f2c 206f 703d 6f70  zero=zero, op=op
-0000f460: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000f470: 2072 6573 756c 740a 0a20 2020 2064 6566   result..    def
-0000f480: 205f 5f61 6464 5f5f 2873 656c 662c 206f   __add__(self, o
-0000f490: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-0000f4a0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
-0000f4b0: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000f4c0: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
-0000f4d0: 202b 2062 2c20 7a65 726f 3d30 290a 0a20   + b, zero=0).. 
-0000f4e0: 2020 205f 5f72 6164 645f 5f20 3d20 5f5f     __radd__ = __
-0000f4f0: 6164 645f 5f0a 0a20 2020 2064 6566 205f  add__..    def _
-0000f500: 5f69 6164 645f 5f28 7365 6c66 2c20 6f74  _iadd__(self, ot
-0000f510: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-0000f520: 7475 726e 2073 656c 662e 6269 6e5f 6f70  turn self.bin_op
-0000f530: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
-0000f540: 3d6c 616d 6264 6120 612c 2062 3a20 6120  =lambda a, b: a 
-0000f550: 2b20 622c 207a 6572 6f3d 302c 2072 6573  + b, zero=0, res
-0000f560: 756c 743d 7365 6c66 290a 0a20 2020 2064  ult=self)..    d
-0000f570: 6566 205f 5f73 7562 5f5f 2873 656c 662c  ef __sub__(self,
-0000f580: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-0000f590: 2072 6574 7572 6e20 7365 6c66 2e62 696e   return self.bin
-0000f5a0: 5f6f 7028 7365 6c66 2c20 6f74 6865 722c  _op(self, other,
-0000f5b0: 206f 703d 6c61 6d62 6461 2061 2c20 623a   op=lambda a, b:
-0000f5c0: 2061 202d 2062 2c20 7a65 726f 3d30 290a   a - b, zero=0).
-0000f5d0: 0a20 2020 2064 6566 205f 5f72 7375 625f  .    def __rsub_
-0000f5e0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-0000f5f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000f600: 656c 662e 6269 6e5f 6f70 2873 656c 662c  elf.bin_op(self,
-0000f610: 206f 7468 6572 2c20 6f70 3d6c 616d 6264   other, op=lambd
-0000f620: 6120 612c 2062 3a20 6220 2d20 612c 207a  a a, b: b - a, z
-0000f630: 6572 6f3d 3029 0a0a 2020 2020 6465 6620  ero=0)..    def 
-0000f640: 5f5f 6973 7562 5f5f 2873 656c 662c 206f  __isub__(self, o
-0000f650: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-0000f660: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
-0000f670: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000f680: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
-0000f690: 202d 2062 2c20 7a65 726f 3d30 2c20 7265   - b, zero=0, re
-0000f6a0: 7375 6c74 3d73 656c 6629 0a0a 2020 2020  sult=self)..    
-0000f6b0: 6465 6620 5f5f 6d75 6c5f 5f28 7365 6c66  def __mul__(self
-0000f6c0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-0000f6d0: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
-0000f6e0: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
-0000f6f0: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
-0000f700: 3a20 6120 2a20 622c 207a 6572 6f3d 3129  : a * b, zero=1)
-0000f710: 0a0a 2020 2020 5f5f 726d 756c 5f5f 203d  ..    __rmul__ =
-0000f720: 205f 5f6d 756c 5f5f 0a0a 2020 2020 6465   __mul__..    de
-0000f730: 6620 5f5f 696d 756c 5f5f 2873 656c 662c  f __imul__(self,
-0000f740: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-0000f750: 2072 6574 7572 6e20 7365 6c66 2e62 696e   return self.bin
-0000f760: 5f6f 7028 7365 6c66 2c20 6f74 6865 722c  _op(self, other,
-0000f770: 206f 703d 6c61 6d62 6461 2061 2c20 623a   op=lambda a, b:
-0000f780: 2061 202a 2062 2c20 7a65 726f 3d31 2c20   a * b, zero=1, 
-0000f790: 7265 7375 6c74 3d73 656c 6629 0a0a 2020  result=self)..  
-0000f7a0: 2020 6465 6620 5f5f 6469 765f 5f28 7365    def __div__(se
-0000f7b0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-0000f7c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000f7d0: 6269 6e5f 6f70 2873 656c 662c 206f 7468  bin_op(self, oth
-0000f7e0: 6572 2c20 6f70 3d6c 616d 6264 6120 612c  er, op=lambda a,
-0000f7f0: 2062 3a20 6120 2f20 622c 207a 6572 6f3d   b: a / b, zero=
-0000f800: 3129 0a0a 2020 2020 5f5f 7264 6976 5f5f  1)..    __rdiv__
-0000f810: 203d 205f 5f64 6976 5f5f 0a20 2020 205f   = __div__.    _
-0000f820: 5f74 7275 6564 6976 5f5f 203d 205f 5f64  _truediv__ = __d
-0000f830: 6976 5f5f 0a0a 2020 2020 6465 6620 5f5f  iv__..    def __
-0000f840: 6964 6976 5f5f 2873 656c 662c 206f 7468  idiv__(self, oth
-0000f850: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
-0000f860: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
-0000f870: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
-0000f880: 6c61 6d62 6461 2061 2c20 623a 2061 202f  lambda a, b: a /
-0000f890: 2062 2c20 7a65 726f 3d31 2c20 7265 7375   b, zero=1, resu
-0000f8a0: 6c74 3d73 656c 6629 0a0a 2020 2020 5f5f  lt=self)..    __
-0000f8b0: 6974 7275 6564 6976 5f5f 203d 205f 5f69  itruediv__ = __i
-0000f8c0: 6469 765f 5f0a 0a20 2020 2064 6566 205f  div__..    def _
-0000f8d0: 5f66 6c6f 6f72 6469 765f 5f28 7365 6c66  _floordiv__(self
-0000f8e0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-0000f8f0: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
-0000f900: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
-0000f910: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
-0000f920: 3a20 6120 2f2f 2062 2c20 7a65 726f 3d31  : a // b, zero=1
-0000f930: 290a 0a20 2020 2064 6566 205f 5f69 666c  )..    def __ifl
-0000f940: 6f6f 7264 6976 5f5f 2873 656c 662c 206f  oordiv__(self, o
-0000f950: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-0000f960: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
-0000f970: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000f980: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
-0000f990: 202f 2f20 622c 207a 6572 6f3d 312c 2072   // b, zero=1, r
-0000f9a0: 6573 756c 743d 7365 6c66 290a 0a20 2020  esult=self)..   
-0000f9b0: 2064 6566 205f 5f6e 6567 5f5f 2873 656c   def __neg__(sel
-0000f9c0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-0000f9d0: 726e 2073 656c 662e 756e 6172 795f 6f70  rn self.unary_op
-0000f9e0: 286f 703d 6c61 6d62 6461 2061 3a20 2d61  (op=lambda a: -a
-0000f9f0: 290a 0a20 2020 2064 6566 205f 5f62 6f6f  )..    def __boo
-0000fa00: 6c5f 5f28 7365 6c66 293a 0a20 2020 2020  l__(self):.     
-0000fa10: 2020 2072 6574 7572 6e20 616e 7928 7365     return any(se
-0000fa20: 6c66 2e76 616c 7565 7328 2929 0a0a 2020  lf.values())..  
-0000fa30: 2020 5f5f 6e6f 6e7a 6572 6f5f 5f20 3d20    __nonzero__ = 
-0000fa40: 5f5f 626f 6f6c 5f5f 2020 2320 5079 7468  __bool__  # Pyth
-0000fa50: 6f6e 2032 0a0a 2020 2020 6465 6620 656c  on 2..    def el
-0000fa60: 656d 5f65 7128 7365 6c66 2c20 6f74 6865  em_eq(self, othe
-0000fa70: 722c 2072 6573 756c 745f 7769 7468 5f64  r, result_with_d
-0000fa80: 6566 6175 6c74 3d54 7275 6529 3a0a 2020  efault=True):.  
-0000fa90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000faa0: 2020 456c 656d 656e 742d 7769 7365 2065    Element-wise e
-0000fab0: 7175 616c 6974 7920 6368 6563 6b20 7769  quality check wi
-0000fac0: 7468 206f 7468 6572 2e0a 2020 2020 2020  th other..      
-0000fad0: 2020 4e6f 7465 2061 626f 7574 2062 726f    Note about bro
-0000fae0: 6164 6361 7374 2064 6566 6175 6c74 2076  adcast default v
-0000faf0: 616c 7565 3a20 436f 6e73 6964 6572 2073  alue: Consider s
-0000fb00: 6f6d 6520 6b65 7920 7768 6963 6820 6973  ome key which is
-0000fb10: 206e 6569 7468 6572 2069 6e20 7365 6c66   neither in self
-0000fb20: 206e 6f72 2069 6e20 6f74 6865 722e 0a20   nor in other.. 
-0000fb30: 2020 2020 2020 2020 2054 6869 7320 6d65           This me
-0000fb40: 616e 7320 7468 6174 2073 656c 665b 6b65  ans that self[ke
-0000fb50: 795d 203d 3d20 7365 6c66 2e64 6566 6175  y] == self.defau
-0000fb60: 6c74 2c20 6f74 6865 725b 6b65 795d 203d  lt, other[key] =
-0000fb70: 3d20 6f74 6865 722e 6465 6661 756c 742e  = other.default.
-0000fb80: 0a20 2020 2020 2020 2020 2054 6875 732c  .          Thus,
-0000fb90: 2069 6e20 6361 7365 2074 6861 7420 7365   in case that se
-0000fba0: 6c66 2e64 6566 6175 6c74 2021 3d20 6f74  lf.default != ot
-0000fbb0: 6865 722e 6465 6661 756c 742c 2077 6520  her.default, we 
-0000fbc0: 6765 7420 7265 732e 6465 6661 756c 7420  get res.default 
-0000fbd0: 3d3d 2046 616c 7365 2e0a 2020 2020 2020  == False..      
-0000fbe0: 2020 2020 5468 656e 2c20 616c 6c28 7265      Then, all(re
-0000fbf0: 732e 7661 6c75 6573 2829 2920 3d3d 2046  s.values()) == F
-0000fc00: 616c 7365 2c20 6576 656e 2077 6865 6e20  alse, even when 
-0000fc10: 616c 6c20 6f74 6865 7220 7661 6c75 6573  all other values
-0000fc20: 2061 7265 2054 7275 652e 0a20 2020 2020   are True..     
-0000fc30: 2020 2020 2054 6869 7320 6973 2073 6f6d       This is som
-0000fc40: 6574 696d 6573 206e 6f74 2077 6861 7420  etimes not what 
-0000fc50: 7765 2077 616e 742e 0a20 2020 2020 2020  we want..       
-0000fc60: 2020 2059 6f75 2063 616e 2063 6f6e 7472     You can contr
-0000fc70: 6f6c 2074 6865 2062 6568 6176 696f 7220  ol the behavior 
-0000fc80: 7669 6120 7265 7375 6c74 5f77 6974 685f  via result_with_
-0000fc90: 6465 6661 756c 742e 0a0a 2020 2020 2020  default...      
-0000fca0: 2020 3a70 6172 616d 204e 756d 6265 7273    :param Numbers
-0000fcb0: 4469 6374 7c54 206f 7468 6572 3a0a 2020  Dict|T other:.  
-0000fcc0: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
-0000fcd0: 6c20 7265 7375 6c74 5f77 6974 685f 6465  l result_with_de
-0000fce0: 6661 756c 743a 0a20 2020 2020 2020 203a  fault:.        :
-0000fcf0: 7274 7970 653a 204e 756d 6265 7273 4469  rtype: NumbersDi
-0000fd00: 6374 0a20 2020 2020 2020 2022 2222 0a0a  ct.        """..
-0000fd10: 2020 2020 2020 2020 6465 6620 6f70 2861          def op(a
-0000fd20: 2c20 6229 3a0a 2020 2020 2020 2020 2020  , b):.          
-0000fd30: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
-0000fd40: 2020 3a70 6172 616d 2061 3a0a 2020 2020    :param a:.    
-0000fd50: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
-0000fd60: 3a0a 2020 2020 2020 2020 2020 2020 3a72  :.            :r
-0000fd70: 7479 7065 3a20 626f 6f6c 7c4e 6f6e 650a  type: bool|None.
-0000fd80: 2020 2020 2020 2020 2020 2020 2222 220a              """.
-0000fd90: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0000fda0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000fdb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000fdc0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000fdd0: 2020 6966 2062 2069 7320 4e6f 6e65 3a0a    if b is None:.
-0000fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdf0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-0000fe00: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-0000fe10: 203d 3d20 620a 0a20 2020 2020 2020 2072   == b..        r
-0000fe20: 6573 203d 2073 656c 662e 6269 6e5f 6f70  es = self.bin_op
-0000fe30: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
-0000fe40: 3d6f 702c 207a 6572 6f3d 4e6f 6e65 290a  =op, zero=None).
-0000fe50: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-0000fe60: 6573 756c 745f 7769 7468 5f64 6566 6175  esult_with_defau
-0000fe70: 6c74 3a0a 2020 2020 2020 2020 2020 2020  lt:.            
-0000fe80: 7265 732e 7661 6c75 6520 3d20 4e6f 6e65  res.value = None
-0000fe90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fea0: 7265 730a 0a20 2020 2064 6566 205f 5f65  res..    def __e
-0000feb0: 715f 5f28 7365 6c66 2c20 6f74 6865 7229  q__(self, other)
-0000fec0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000fed0: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
-0000fee0: 6265 7273 4469 6374 7c54 206f 7468 6572  bersDict|T other
-0000fef0: 3a0a 2020 2020 2020 2020 3a72 6574 7572  :.        :retur
-0000ff00: 6e3a 2077 6865 7468 6572 2073 656c 6620  n: whether self 
-0000ff10: 3d3d 206f 7468 6572 2065 6c65 6d77 6973  == other elemwis
-0000ff20: 652e 2073 6565 2073 656c 662e 656c 656d  e. see self.elem
-0000ff30: 5f65 710a 2020 2020 2020 2020 3a72 7479  _eq.        :rty
-0000ff40: 7065 3a20 626f 6f6c 0a20 2020 2020 2020  pe: bool.       
-0000ff50: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0000ff60: 7572 6e20 616c 6c28 7365 6c66 2e65 6c65  urn all(self.ele
-0000ff70: 6d5f 6571 286f 7468 6572 292e 7661 6c75  m_eq(other).valu
-0000ff80: 6573 2829 290a 0a20 2020 2064 6566 205f  es())..    def _
-0000ff90: 5f6e 655f 5f28 7365 6c66 2c20 6f74 6865  _ne__(self, othe
-0000ffa0: 7229 3a0a 2020 2020 2020 2020 2222 220a  r):.        """.
-0000ffb0: 2020 2020 2020 2020 3a70 6172 616d 204e          :param N
-0000ffc0: 756d 6265 7273 4469 6374 7c54 206f 7468  umbersDict|T oth
-0000ffd0: 6572 3a0a 2020 2020 2020 2020 3a72 6574  er:.        :ret
-0000ffe0: 7572 6e3a 206e 6f74 2028 7365 6c66 203d  urn: not (self =
-0000fff0: 3d20 6f74 6865 7229 0a20 2020 2020 2020  = other).       
-00010000: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
-00010010: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010020: 2020 7265 7475 726e 206e 6f74 2028 7365    return not (se
-00010030: 6c66 203d 3d20 6f74 6865 7229 0a0a 2020  lf == other)..  
-00010040: 2020 6465 6620 5f5f 636d 705f 5f28 7365    def __cmp__(se
-00010050: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-00010060: 2020 2020 2320 5468 6572 6520 6973 206e      # There is n
-00010070: 6f20 676f 6f64 2073 7472 6169 6768 742d  o good straight-
-00010080: 666f 7277 6172 6420 696d 706c 656d 656e  forward implemen
-00010090: 7461 7469 6f6e 0a20 2020 2020 2020 2023  tation.        #
-000100a0: 2061 6e64 2069 7420 776f 756c 6420 6a75   and it would ju
-000100b0: 7374 2063 6f6e 6675 7365 2e0a 2020 2020  st confuse..    
-000100c0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-000100d0: 696f 6e28 2225 732e 5f5f 636d 705f 5f20  ion("%s.__cmp__ 
-000100e0: 6973 2075 6e64 6566 696e 6564 2220 2520  is undefined" % 
-000100f0: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-00010100: 5f6e 616d 655f 5f29 0a0a 2020 2020 6465  _name__)..    de
-00010110: 6620 616e 795f 636f 6d70 6172 6528 7365  f any_compare(se
-00010120: 6c66 2c20 6f74 6865 722c 2063 6d70 293a  lf, other, cmp):
-00010130: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010140: 2020 2020 203a 7061 7261 6d20 4e75 6d62       :param Numb
-00010150: 6572 7344 6963 7420 6f74 6865 723a 0a20  ersDict other:. 
-00010160: 2020 2020 2020 203a 7061 7261 6d20 2828         :param ((
-00010170: 6f62 6a65 6374 2c6f 626a 6563 7429 2d3e  object,object)->
-00010180: 5472 7565 2920 636d 703a 0a20 2020 2020  True) cmp:.     
-00010190: 2020 203a 7274 7970 653a 2054 7275 650a     :rtype: True.
-000101a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000101b0: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
-000101c0: 656c 662e 6b65 7973 2829 3a0a 2020 2020  elf.keys():.    
-000101d0: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-000101e0: 6e20 6f74 6865 722e 6b65 7973 2829 3a0a  n other.keys():.
-000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010200: 6966 2063 6d70 2873 656c 665b 6b65 795d  if cmp(self[key]
-00010210: 2c20 6f74 6865 725b 6b65 795d 293a 0a20  , other[key]):. 
-00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010230: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-00010240: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00010250: 6f74 6865 722e 7661 6c75 6520 6973 206e  other.value is n
-00010260: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00010270: 2020 2020 2020 2020 2069 6620 636d 7028           if cmp(
-00010280: 7365 6c66 5b6b 6579 5d2c 206f 7468 6572  self[key], other
-00010290: 2e76 616c 7565 293a 0a20 2020 2020 2020  .value):.       
-000102a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000102b0: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-000102c0: 2069 6620 7365 6c66 2e76 616c 7565 2069   if self.value i
-000102d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206f  s not None and o
-000102e0: 7468 6572 2e76 616c 7565 2069 7320 6e6f  ther.value is no
-000102f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00010300: 2020 2020 6966 2063 6d70 2873 656c 662e      if cmp(self.
-00010310: 7661 6c75 652c 206f 7468 6572 2e76 616c  value, other.val
-00010320: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
-00010330: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00010340: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010350: 4661 6c73 650a 0a20 2020 2040 7374 6174  False..    @stat
-00010360: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00010370: 205f 6d61 7828 2a61 7267 7329 3a0a 2020   _max(*args):.  
-00010380: 2020 2020 2020 6172 6773 203d 205b 6120        args = [a 
-00010390: 666f 7220 6120 696e 2061 7267 7320 6966  for a in args if
-000103a0: 2061 2069 7320 6e6f 7420 4e6f 6e65 5d0a   a is not None].
-000103b0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-000103c0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000103d0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-000103e0: 2020 2020 2069 6620 6c65 6e28 6172 6773       if len(args
-000103f0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
-00010400: 2020 2020 7265 7475 726e 2061 7267 735b      return args[
-00010410: 305d 0a20 2020 2020 2020 2072 6574 7572  0].        retur
-00010420: 6e20 6d61 7828 2a61 7267 7329 0a0a 2020  n max(*args)..  
-00010430: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-00010440: 2020 2020 6465 6620 5f6d 696e 282a 6172      def _min(*ar
-00010450: 6773 293a 0a20 2020 2020 2020 2061 7267  gs):.        arg
-00010460: 7320 3d20 5b61 2066 6f72 2061 2069 6e20  s = [a for a in 
-00010470: 6172 6773 2069 6620 6120 6973 206e 6f74  args if a is not
-00010480: 204e 6f6e 655d 0a20 2020 2020 2020 2069   None].        i
-00010490: 6620 6e6f 7420 6172 6773 3a0a 2020 2020  f not args:.    
-000104a0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000104b0: 6f6e 650a 2020 2020 2020 2020 6966 206c  one.        if l
-000104c0: 656e 2861 7267 7329 203d 3d20 313a 0a20  en(args) == 1:. 
-000104d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000104e0: 6e20 6172 6773 5b30 5d0a 2020 2020 2020  n args[0].      
-000104f0: 2020 7265 7475 726e 206d 696e 282a 6172    return min(*ar
-00010500: 6773 290a 0a20 2020 2040 636c 6173 736d  gs)..    @classm
-00010510: 6574 686f 640a 2020 2020 6465 6620 6d61  ethod.    def ma
-00010520: 7828 636c 732c 2069 7465 6d73 293a 0a20  x(cls, items):. 
-00010530: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010540: 2020 2045 6c65 6d65 6e74 2d77 6973 6520     Element-wise 
-00010550: 6d61 7869 6d75 6d20 666f 7220 6974 656d  maximum for item
-00010560: 2069 6e20 6974 656d 732e 0a20 2020 2020   in items..     
-00010570: 2020 203a 7061 7261 6d20 6c69 7374 5b4e     :param list[N
-00010580: 756d 6265 7273 4469 6374 7c69 6e74 7c66  umbersDict|int|f
-00010590: 6c6f 6174 5d20 6974 656d 733a 0a20 2020  loat] items:.   
-000105a0: 2020 2020 203a 7274 7970 653a 204e 756d       :rtype: Num
-000105b0: 6265 7273 4469 6374 0a20 2020 2020 2020  bersDict.       
-000105c0: 2022 2222 0a20 2020 2020 2020 2061 7373   """.        ass
-000105d0: 6572 7420 6974 656d 730a 2020 2020 2020  ert items.      
-000105e0: 2020 6966 206c 656e 2869 7465 6d73 2920    if len(items) 
-000105f0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00010600: 2020 7265 7475 726e 204e 756d 6265 7273    return Numbers
-00010610: 4469 6374 2869 7465 6d73 5b30 5d29 0a20  Dict(items[0]). 
-00010620: 2020 2020 2020 2069 6620 6c65 6e28 6974         if len(it
-00010630: 656d 7329 203d 3d20 323a 0a20 2020 2020  ems) == 2:.     
-00010640: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
-00010650: 732e 6269 6e5f 6f70 2869 7465 6d73 5b30  s.bin_op(items[0
-00010660: 5d2c 2069 7465 6d73 5b31 5d2c 206f 703d  ], items[1], op=
-00010670: 636c 732e 5f6d 6178 2c20 7a65 726f 3d4e  cls._max, zero=N
-00010680: 6f6e 6529 0a20 2020 2020 2020 2072 6574  one).        ret
-00010690: 7572 6e20 636c 732e 6d61 7828 5b69 7465  urn cls.max([ite
-000106a0: 6d73 5b30 5d2c 2063 6c73 2e6d 6178 2869  ms[0], cls.max(i
-000106b0: 7465 6d73 5b31 3a5d 295d 290a 0a20 2020  tems[1:])])..   
-000106c0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000106d0: 2020 6465 6620 6d69 6e28 636c 732c 2069    def min(cls, i
-000106e0: 7465 6d73 293a 0a20 2020 2020 2020 2022  tems):.        "
-000106f0: 2222 0a20 2020 2020 2020 2045 6c65 6d65  "".        Eleme
-00010700: 6e74 2d77 6973 6520 6d69 6e69 6d75 6d20  nt-wise minimum 
-00010710: 666f 7220 6974 656d 2069 6e20 6974 656d  for item in item
-00010720: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-00010730: 6d20 6c69 7374 5b4e 756d 6265 7273 4469  m list[NumbersDi
-00010740: 6374 7c69 6e74 7c66 6c6f 6174 5d20 6974  ct|int|float] it
-00010750: 656d 733a 0a20 2020 2020 2020 203a 7274  ems:.        :rt
-00010760: 7970 653a 204e 756d 6265 7273 4469 6374  ype: NumbersDict
-00010770: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010780: 2020 2020 2061 7373 6572 7420 6974 656d       assert item
-00010790: 730a 2020 2020 2020 2020 6966 206c 656e  s.        if len
-000107a0: 2869 7465 6d73 2920 3d3d 2031 3a0a 2020  (items) == 1:.  
-000107b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000107c0: 204e 756d 6265 7273 4469 6374 2869 7465   NumbersDict(ite
-000107d0: 6d73 5b30 5d29 0a20 2020 2020 2020 2069  ms[0]).        i
-000107e0: 6620 6c65 6e28 6974 656d 7329 203d 3d20  f len(items) == 
-000107f0: 323a 0a20 2020 2020 2020 2020 2020 2072  2:.            r
-00010800: 6574 7572 6e20 636c 732e 6269 6e5f 6f70  eturn cls.bin_op
-00010810: 2869 7465 6d73 5b30 5d2c 2069 7465 6d73  (items[0], items
-00010820: 5b31 5d2c 206f 703d 636c 732e 5f6d 696e  [1], op=cls._min
-00010830: 2c20 7a65 726f 3d4e 6f6e 6529 0a20 2020  , zero=None).   
-00010840: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
-00010850: 6d69 6e28 5b69 7465 6d73 5b30 5d2c 2063  min([items[0], c
-00010860: 6c73 2e6d 696e 2869 7465 6d73 5b31 3a5d  ls.min(items[1:]
-00010870: 295d 290a 0a20 2020 2040 7374 6174 6963  )])..    @static
-00010880: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-00010890: 6d61 785f 6572 726f 7228 293a 0a20 2020  max_error():.   
-000108a0: 2020 2020 2023 2057 696c 6c20 7265 706c       # Will repl
-000108b0: 6163 6520 7365 6c66 2e6d 6178 2066 6f72  ace self.max for
-000108c0: 2065 6163 6820 696e 7374 616e 6365 2e20   each instance. 
-000108d0: 546f 2062 6520 7375 7265 2074 6861 7420  To be sure that 
-000108e0: 7765 2064 6f6e 2774 2063 6f6e 6675 7365  we don't confuse
-000108f0: 2069 7420 7769 7468 2073 656c 662e 6d61   it with self.ma
-00010900: 785f 7661 6c75 652e 0a20 2020 2020 2020  x_value..       
-00010910: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00010920: 2822 5573 6520 6d61 785f 7661 6c75 6520  ("Use max_value 
-00010930: 696e 7374 6561 642e 2229 0a0a 2020 2020  instead.")..    
-00010940: 6465 6620 6d61 785f 7661 6c75 6528 7365  def max_value(se
-00010950: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00010960: 0a20 2020 2020 2020 204d 6178 696d 756d  .        Maximum
-00010970: 206f 6620 6f75 7220 7661 6c75 6573 2e0a   of our values..
-00010980: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010990: 2020 2020 7265 7475 726e 206d 6178 2873      return max(s
-000109a0: 656c 662e 7661 6c75 6573 2829 290a 0a20  elf.values()).. 
-000109b0: 2020 2064 6566 206d 696e 5f76 616c 7565     def min_value
-000109c0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000109d0: 2222 220a 2020 2020 2020 2020 4d69 6e69  """.        Mini
-000109e0: 6d75 6d20 6f66 206f 7572 2076 616c 7565  mum of our value
-000109f0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00010a00: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
-00010a10: 6e28 7365 6c66 2e76 616c 7565 7328 2929  n(self.values())
-00010a20: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-00010a30: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-00010a40: 2020 6966 2073 656c 662e 7661 6c75 6520    if self.value 
-00010a50: 6973 204e 6f6e 6520 616e 6420 6e6f 7420  is None and not 
-00010a60: 7365 6c66 2e64 6963 743a 0a20 2020 2020  self.dict:.     
-00010a70: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
-00010a80: 7328 2922 2025 2073 656c 662e 5f5f 636c  s()" % self.__cl
-00010a90: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 0a20  ass__.__name__. 
-00010aa0: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
-00010ab0: 616c 7565 2069 7320 4e6f 6e65 2061 6e64  alue is None and
-00010ac0: 2073 656c 662e 6469 6374 3a0a 2020 2020   self.dict:.    
-00010ad0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00010ae0: 2573 2825 7229 2220 2520 2873 656c 662e  %s(%r)" % (self.
-00010af0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00010b00: 5f5f 2c20 7365 6c66 2e64 6963 7429 0a20  __, self.dict). 
-00010b10: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00010b20: 6c66 2e64 6963 7420 616e 6420 7365 6c66  lf.dict and self
-00010b30: 2e76 616c 7565 2069 7320 6e6f 7420 4e6f  .value is not No
-00010b40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00010b50: 7265 7475 726e 2022 2573 2825 7229 2220  return "%s(%r)" 
-00010b60: 2520 2873 656c 662e 5f5f 636c 6173 735f  % (self.__class_
-00010b70: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365 6c66  _.__name__, self
-00010b80: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
-00010b90: 7265 7475 726e 2022 2573 286e 756d 6265  return "%s(numbe
-00010ba0: 7273 5f64 6963 743d 2572 2c20 6272 6f61  rs_dict=%r, broa
-00010bb0: 6463 6173 745f 7661 6c75 653d 2572 2922  dcast_value=%r)"
-00010bc0: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
-00010bd0: 5f5f 2e5f 5f6e 616d 655f 5f2c 2073 656c  __.__name__, sel
-00010be0: 662e 6469 6374 2c20 7365 6c66 2e76 616c  f.dict, self.val
-00010bf0: 7565 290a 0a0a 6465 6620 636f 6c6c 6563  ue)...def collec
-00010c00: 745f 636c 6173 735f 696e 6974 5f6b 7761  t_class_init_kwa
-00010c10: 7267 7328 636c 732c 206f 6e6c 795f 7769  rgs(cls, only_wi
-00010c20: 7468 5f64 6566 6175 6c74 3d46 616c 7365  th_default=False
-00010c30: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00010c40: 7061 7261 6d20 7479 7065 2063 6c73 3a20  param type cls: 
-00010c50: 636c 6173 732c 2077 6865 7265 2069 7420  class, where it 
-00010c60: 6173 7375 6d65 7320 7468 6174 206b 7761  assumes that kwa
-00010c70: 7267 7320 6172 6520 7061 7373 6564 206f  rgs are passed o
-00010c80: 6e20 746f 2062 6173 6520 636c 6173 7365  n to base classe
-00010c90: 730a 2020 2020 3a70 6172 616d 2062 6f6f  s.    :param boo
-00010ca0: 6c20 6f6e 6c79 5f77 6974 685f 6465 6661  l only_with_defa
-00010cb0: 756c 743a 2069 6620 6769 7665 6e20 7769  ult: if given wi
-00010cc0: 6c6c 206f 6e6c 7920 7265 7475 726e 2074  ll only return t
-00010cd0: 6865 206b 7761 7267 7320 7769 7468 2064  he kwargs with d
-00010ce0: 6566 6175 6c74 2076 616c 7565 730a 2020  efault values.  
-00010cf0: 2020 3a72 6574 7572 6e3a 2073 6574 2069    :return: set i
-00010d00: 6620 6e6f 7420 7769 7468 5f64 6566 6175  f not with_defau
-00010d10: 6c74 2c20 6f74 6865 7277 6973 6520 7468  lt, otherwise th
-00010d20: 6520 6469 6374 2074 6f20 7468 6520 6465  e dict to the de
-00010d30: 6661 756c 7420 7661 6c75 6573 0a20 2020  fault values.   
-00010d40: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
-00010d50: 725d 207c 2064 6963 745b 7374 725d 0a20  r] | dict[str]. 
-00010d60: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-00010d70: 636f 6c6c 6563 7469 6f6e 7320 696d 706f  collections impo
-00010d80: 7274 204f 7264 6572 6564 4469 6374 0a0a  rt OrderedDict..
-00010d90: 2020 2020 6966 206f 6e6c 795f 7769 7468      if only_with
-00010da0: 5f64 6566 6175 6c74 3a0a 2020 2020 2020  _default:.      
-00010db0: 2020 6b77 6172 6773 203d 204f 7264 6572    kwargs = Order
-00010dc0: 6564 4469 6374 2829 0a20 2020 2065 6c73  edDict().    els
-00010dd0: 653a 0a20 2020 2020 2020 206b 7761 7267  e:.        kwarg
-00010de0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2063  s = [].    for c
-00010df0: 6c73 5f20 696e 2069 6e73 7065 6374 2e67  ls_ in inspect.g
-00010e00: 6574 6d72 6f28 636c 7329 3a0a 2020 2020  etmro(cls):.    
-00010e10: 2020 2020 2320 4368 6563 6b20 5079 7468      # Check Pyth
-00010e20: 6f6e 2066 756e 6374 696f 6e2e 2043 6f75  on function. Cou
-00010e30: 6c64 2062 6520 6275 696c 7469 6e20 6675  ld be builtin fu
-00010e40: 6e63 206f 7220 736f 2e20 5079 7468 6f6e  nc or so. Python
-00010e50: 2032 2067 6574 6172 6773 7065 6320 646f   2 getargspec do
-00010e60: 6573 206e 6f74 2077 6f72 6b20 696e 2074  es not work in t
-00010e70: 6861 7420 6361 7365 2e0a 2020 2020 2020  hat case..      
-00010e80: 2020 6966 206e 6f74 2069 6e73 7065 6374    if not inspect
-00010e90: 2e69 736d 6574 686f 6428 636c 735f 2e5f  .ismethod(cls_._
-00010ea0: 5f69 6e69 745f 5f29 2061 6e64 206e 6f74  _init__) and not
-00010eb0: 2069 6e73 7065 6374 2e69 7366 756e 6374   inspect.isfunct
-00010ec0: 696f 6e28 636c 735f 2e5f 5f69 6e69 745f  ion(cls_.__init_
-00010ed0: 5f29 3a0a 2020 2020 2020 2020 2020 2020  _):.            
-00010ee0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00010ef0: 2061 7267 5f73 7065 6320 3d20 6765 7461   arg_spec = geta
-00010f00: 7267 7370 6563 2863 6c73 5f2e 5f5f 696e  rgspec(cls_.__in
-00010f10: 6974 5f5f 290a 2020 2020 2020 2020 6172  it__).        ar
-00010f20: 6773 203d 2061 7267 5f73 7065 632e 6172  gs = arg_spec.ar
-00010f30: 6773 5b31 3a5d 2020 2320 6669 7273 7420  gs[1:]  # first 
-00010f40: 6172 6720 6973 2073 656c 662c 2069 676e  arg is self, ign
-00010f50: 6f72 650a 2020 2020 2020 2020 6966 206f  ore.        if o
-00010f60: 6e6c 795f 7769 7468 5f64 6566 6175 6c74  nly_with_default
-00010f70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00010f80: 2061 7267 5f73 7065 632e 6465 6661 756c   arg_spec.defaul
-00010f90: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00010fa0: 2020 2020 6173 7365 7274 206c 656e 2861      assert len(a
-00010fb0: 7267 5f73 7065 632e 6465 6661 756c 7473  rg_spec.defaults
-00010fc0: 2920 3c3d 206c 656e 2861 7267 7329 0a20  ) <= len(args). 
-00010fd0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00010fe0: 7267 7320 3d20 6172 6773 5b6c 656e 2861  rgs = args[len(a
-00010ff0: 7267 7329 202d 206c 656e 2861 7267 5f73  rgs) - len(arg_s
-00011000: 7065 632e 6465 6661 756c 7473 2920 3a5d  pec.defaults) :]
-00011010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011020: 2061 7373 6572 7420 6c65 6e28 6172 675f   assert len(arg_
-00011030: 7370 6563 2e64 6566 6175 6c74 7329 203d  spec.defaults) =
-00011040: 3d20 6c65 6e28 6172 6773 292c 2061 7267  = len(args), arg
-00011050: 5f73 7065 630a 2020 2020 2020 2020 2020  _spec.          
-00011060: 2020 2020 2020 666f 7220 6172 672c 2064        for arg, d
-00011070: 6566 6175 6c74 2069 6e20 7a69 7028 6172  efault in zip(ar
-00011080: 6773 2c20 6172 675f 7370 6563 2e64 6566  gs, arg_spec.def
-00011090: 6175 6c74 7329 3a0a 2020 2020 2020 2020  aults):.        
-000110a0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-000110b0: 6773 5b61 7267 5d20 3d20 6465 6661 756c  gs[arg] = defaul
-000110c0: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
-000110d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000110e0: 6172 6720 696e 2061 7267 733a 0a20 2020  arg in args:.   
-000110f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011100: 6172 6720 6e6f 7420 696e 206b 7761 7267  arg not in kwarg
-00011110: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00011120: 2020 2020 2020 206b 7761 7267 732e 6170         kwargs.ap
-00011130: 7065 6e64 2861 7267 290a 2020 2020 7265  pend(arg).    re
-00011140: 7475 726e 206b 7761 7267 730a 0a0a 6465  turn kwargs...de
-00011150: 6620 6765 7461 7267 7370 6563 2866 756e  f getargspec(fun
-00011160: 6329 3a0a 2020 2020 2222 220a 2020 2020  c):.    """.    
-00011170: 3a66 756e 633a 6069 6e73 7065 6374 2e67  :func:`inspect.g
-00011180: 6574 6675 6c6c 6172 6773 7065 6360 206f  etfullargspec` o
-00011190: 7220 6069 6e73 7065 6374 2e67 6574 6172  r `inspect.getar
-000111a0: 6773 7065 6360 2028 5079 7468 6f6e 2032  gspec` (Python 2
-000111b0: 290a 0a20 2020 203a 7061 7261 6d20 6675  )..    :param fu
-000111c0: 6e63 3a0a 2020 2020 3a72 6574 7572 6e3a  nc:.    :return:
-000111d0: 2046 756c 6c41 7267 5370 6563 0a20 2020   FullArgSpec.   
-000111e0: 2022 2222 0a20 2020 2069 6620 5059 333a   """.    if PY3:
-000111f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011200: 696e 7370 6563 742e 6765 7466 756c 6c61  inspect.getfulla
-00011210: 7267 7370 6563 2866 756e 6329 0a20 2020  rgspec(func).   
-00011220: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
-00011230: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
-00011240: 4465 7072 6563 6174 696f 6e0a 2020 2020  Deprecation.    
-00011250: 2020 2020 7265 7475 726e 2069 6e73 7065      return inspe
-00011260: 6374 2e67 6574 6172 6773 7065 6328 6675  ct.getargspec(fu
-00011270: 6e63 290a 0a0a 6465 6620 636f 6c6c 6563  nc)...def collec
-00011280: 745f 6d61 6e64 6174 6f72 795f 636c 6173  t_mandatory_clas
-00011290: 735f 696e 6974 5f6b 7761 7267 7328 636c  s_init_kwargs(cl
-000112a0: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
-000112b0: 3a70 6172 616d 2074 7970 6520 636c 733a  :param type cls:
-000112c0: 0a20 2020 203a 7265 7475 726e 3a20 6c69  .    :return: li
-000112d0: 7374 206f 6620 6b77 6172 6773 2077 6869  st of kwargs whi
-000112e0: 6368 2068 6176 6520 6e6f 2064 6566 6175  ch have no defau
-000112f0: 6c74 2c20 692e 652e 2077 6869 6368 206d  lt, i.e. which m
-00011300: 7573 7420 6265 2070 726f 7669 6465 640a  ust be provided.
-00011310: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
-00011320: 5b73 7472 5d0a 2020 2020 2222 220a 2020  [str].    """.  
-00011330: 2020 616c 6c5f 6b77 6172 6773 203d 2063    all_kwargs = c
-00011340: 6f6c 6c65 6374 5f63 6c61 7373 5f69 6e69  ollect_class_ini
-00011350: 745f 6b77 6172 6773 2863 6c73 2c20 6f6e  t_kwargs(cls, on
-00011360: 6c79 5f77 6974 685f 6465 6661 756c 743d  ly_with_default=
-00011370: 4661 6c73 6529 0a20 2020 2064 6566 6175  False).    defau
-00011380: 6c74 5f6b 7761 7267 7320 3d20 636f 6c6c  lt_kwargs = coll
-00011390: 6563 745f 636c 6173 735f 696e 6974 5f6b  ect_class_init_k
-000113a0: 7761 7267 7328 636c 732c 206f 6e6c 795f  wargs(cls, only_
-000113b0: 7769 7468 5f64 6566 6175 6c74 3d54 7275  with_default=Tru
-000113c0: 6529 0a20 2020 206d 616e 6461 746f 7279  e).    mandatory
-000113d0: 5f6b 7761 7267 7320 3d20 5b5d 0a20 2020  _kwargs = [].   
-000113e0: 2066 6f72 2061 7267 2069 6e20 616c 6c5f   for arg in all_
-000113f0: 6b77 6172 6773 3a0a 2020 2020 2020 2020  kwargs:.        
-00011400: 6966 2061 7267 206e 6f74 2069 6e20 6465  if arg not in de
-00011410: 6661 756c 745f 6b77 6172 6773 3a0a 2020  fault_kwargs:.  
-00011420: 2020 2020 2020 2020 2020 6d61 6e64 6174            mandat
-00011430: 6f72 795f 6b77 6172 6773 2e61 7070 656e  ory_kwargs.appen
-00011440: 6428 6172 6729 0a20 2020 2072 6574 7572  d(arg).    retur
-00011450: 6e20 6d61 6e64 6174 6f72 795f 6b77 6172  n mandatory_kwar
-00011460: 6773 0a0a 0a64 6566 2068 656c 705f 6f6e  gs...def help_on
-00011470: 5f74 7970 655f 6572 726f 725f 7772 6f6e  _type_error_wron
-00011480: 675f 6172 6773 2863 6c73 2c20 6b77 6172  g_args(cls, kwar
-00011490: 6773 293a 0a20 2020 2022 2222 0a20 2020  gs):.    """.   
-000114a0: 203a 7061 7261 6d20 7479 7065 2063 6c73   :param type cls
-000114b0: 3a0a 2020 2020 3a70 6172 616d 206c 6973  :.    :param lis
-000114c0: 745b 7374 725d 206b 7761 7267 733a 0a20  t[str] kwargs:. 
-000114d0: 2020 2022 2222 0a20 2020 206d 616e 6461     """.    manda
-000114e0: 746f 7279 5f61 7267 7320 3d20 636f 6c6c  tory_args = coll
-000114f0: 6563 745f 6d61 6e64 6174 6f72 795f 636c  ect_mandatory_cl
-00011500: 6173 735f 696e 6974 5f6b 7761 7267 7328  ass_init_kwargs(
-00011510: 636c 7329 0a20 2020 2066 6f72 2061 7267  cls).    for arg
-00011520: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
-00011530: 2020 2020 6966 2061 7267 2069 6e20 6d61      if arg in ma
-00011540: 6e64 6174 6f72 795f 6172 6773 3a0a 2020  ndatory_args:.  
-00011550: 2020 2020 2020 2020 2020 6d61 6e64 6174            mandat
-00011560: 6f72 795f 6172 6773 2e72 656d 6f76 6528  ory_args.remove(
-00011570: 6172 6729 0a20 2020 2061 6c6c 5f6b 7761  arg).    all_kwa
-00011580: 7267 7320 3d20 636f 6c6c 6563 745f 636c  rgs = collect_cl
-00011590: 6173 735f 696e 6974 5f6b 7761 7267 7328  ass_init_kwargs(
-000115a0: 636c 7329 0a20 2020 2075 6e6b 6e6f 776e  cls).    unknown
-000115b0: 5f61 7267 7320 3d20 5b5d 0a20 2020 2066  _args = [].    f
-000115c0: 6f72 2061 7267 2069 6e20 6b77 6172 6773  or arg in kwargs
-000115d0: 3a0a 2020 2020 2020 2020 6966 2061 7267  :.        if arg
-000115e0: 206e 6f74 2069 6e20 616c 6c5f 6b77 6172   not in all_kwar
-000115f0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00011600: 756e 6b6e 6f77 6e5f 6172 6773 2e61 7070  unknown_args.app
-00011610: 656e 6428 6172 6729 0a20 2020 2069 6620  end(arg).    if 
-00011620: 6d61 6e64 6174 6f72 795f 6172 6773 206f  mandatory_args o
-00011630: 7220 756e 6b6e 6f77 6e5f 6172 6773 3a0a  r unknown_args:.
-00011640: 2020 2020 2020 2020 7072 696e 7428 2241          print("A
-00011650: 7267 7320 6d69 736d 6174 6368 3f20 4d69  rgs mismatch? Mi
-00011660: 7373 696e 6720 6172 6520 2572 2c20 756e  ssing are %r, un
-00011670: 6b6e 6f77 6e73 2061 7265 2025 722e 204b  knowns are %r. K
-00011680: 7761 7267 7320 2572 2e22 2025 2028 6d61  wargs %r." % (ma
-00011690: 6e64 6174 6f72 795f 6172 6773 2c20 756e  ndatory_args, un
-000116a0: 6b6e 6f77 6e5f 6172 6773 2c20 6b77 6172  known_args, kwar
-000116b0: 6773 2929 0a0a 0a64 6566 2063 7573 746f  gs))...def custo
-000116c0: 6d5f 6578 6563 2873 6f75 7263 652c 2073  m_exec(source, s
-000116d0: 6f75 7263 655f 6669 6c65 6e61 6d65 2c20  ource_filename, 
-000116e0: 7573 6572 5f6e 732c 2075 7365 725f 676c  user_ns, user_gl
-000116f0: 6f62 616c 5f6e 7329 3a0a 2020 2020 2222  obal_ns):.    ""
-00011700: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
-00011710: 2073 6f75 7263 653a 0a20 2020 203a 7061   source:.    :pa
-00011720: 7261 6d20 7374 7220 736f 7572 6365 5f66  ram str source_f
-00011730: 696c 656e 616d 653a 0a20 2020 203a 7061  ilename:.    :pa
-00011740: 7261 6d20 6469 6374 5b73 7472 5d20 7573  ram dict[str] us
-00011750: 6572 5f6e 733a 0a20 2020 203a 7061 7261  er_ns:.    :para
-00011760: 6d20 6469 6374 5b73 7472 5d20 7573 6572  m dict[str] user
-00011770: 5f67 6c6f 6261 6c5f 6e73 3a0a 2020 2020  _global_ns:.    
-00011780: 3a72 6574 7572 6e3a 206e 6f74 6869 6e67  :return: nothing
-00011790: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-000117a0: 6e6f 7420 736f 7572 6365 2e65 6e64 7377  not source.endsw
-000117b0: 6974 6828 225c 6e22 293a 0a20 2020 2020  ith("\n"):.     
-000117c0: 2020 2073 6f75 7263 6520 2b3d 2022 5c6e     source += "\n
-000117d0: 220a 2020 2020 636f 203d 2063 6f6d 7069  ".    co = compi
-000117e0: 6c65 2873 6f75 7263 652c 2073 6f75 7263  le(source, sourc
-000117f0: 655f 6669 6c65 6e61 6d65 2c20 2265 7865  e_filename, "exe
-00011800: 6322 290a 2020 2020 7573 6572 5f67 6c6f  c").    user_glo
-00011810: 6261 6c5f 6e73 5b22 5f5f 7061 636b 6167  bal_ns["__packag
-00011820: 655f 5f22 5d20 3d20 2272 6574 7572 6e6e  e__"] = "returnn
-00011830: 2220 2023 2069 6d70 6f72 7461 6e74 2073  "  # important s
-00011840: 6f20 7468 6174 2069 6d70 6f72 7473 2077  o that imports w
-00011850: 6f72 6b0a 2020 2020 6576 616c 2863 6f2c  ork.    eval(co,
-00011860: 2075 7365 725f 676c 6f62 616c 5f6e 732c   user_global_ns,
-00011870: 2075 7365 725f 6e73 290a 0a0a 636c 6173   user_ns)...clas
-00011880: 7320 4672 6f7a 656e 4469 6374 2864 6963  s FrozenDict(dic
-00011890: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
-000118a0: 4672 6f7a 656e 2064 6963 742e 0a20 2020  Frozen dict..   
-000118b0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-000118c0: 7365 7469 7465 6d5f 5f28 7365 6c66 2c20  setitem__(self, 
-000118d0: 6b65 792c 2076 616c 7565 293a 0a20 2020  key, value):.   
-000118e0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000118f0: 4572 726f 7228 2246 726f 7a65 6e44 6963  Error("FrozenDic
-00011900: 7420 6361 6e6e 6f74 2062 6520 6d6f 6469  t cannot be modi
-00011910: 6669 6564 2229 0a0a 2020 2020 6465 6620  fied")..    def 
-00011920: 5f5f 6861 7368 5f5f 2873 656c 6629 3a0a  __hash__(self):.
-00011930: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-00011940: 6173 6828 7475 706c 6528 736f 7274 6564  ash(tuple(sorted
-00011950: 2873 656c 662e 6974 656d 7328 2929 2929  (self.items())))
-00011960: 0a0a 0a64 6566 206d 616b 655f 6861 7368  ...def make_hash
-00011970: 6162 6c65 286f 626a 293a 0a20 2020 2022  able(obj):.    "
-00011980: 2222 0a20 2020 2054 6865 616e 6f20 6e65  "".    Theano ne
-00011990: 6564 7320 6861 7368 6162 6c65 206f 626a  eds hashable obj
-000119a0: 6563 7473 2069 6e20 736f 6d65 2063 6173  ects in some cas
-000119b0: 6573 2c20 652e 672e 2074 6865 2070 726f  es, e.g. the pro
-000119c0: 7065 7274 6965 7320 6f66 204f 7073 2e0a  perties of Ops..
-000119d0: 2020 2020 5468 6973 2063 6f6e 7665 7274      This convert
-000119e0: 7320 616c 6c20 6f62 6a65 6374 7320 6173  s all objects as
-000119f0: 2073 7563 682c 2069 2e65 2e20 696e 746f   such, i.e. into
-00011a00: 2069 6d6d 7574 6162 6c65 2066 726f 7a65   immutable froze
-00011a10: 6e20 7479 7065 732e 0a0a 2020 2020 3a70  n types...    :p
-00011a20: 6172 616d 2054 7c64 6963 747c 6c69 7374  aram T|dict|list
-00011a30: 7c74 7570 6c65 206f 626a 3a0a 2020 2020  |tuple obj:.    
-00011a40: 3a72 7479 7065 3a20 547c 4672 6f7a 656e  :rtype: T|Frozen
-00011a50: 4469 6374 7c74 7570 6c65 0a20 2020 2022  Dict|tuple.    "
-00011a60: 2222 0a20 2020 2069 6620 6973 696e 7374  "".    if isinst
-00011a70: 616e 6365 286f 626a 2c20 6469 6374 293a  ance(obj, dict):
-00011a80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011a90: 4672 6f7a 656e 4469 6374 285b 6d61 6b65  FrozenDict([make
-00011aa0: 5f68 6173 6861 626c 6528 6974 656d 2920  _hashable(item) 
-00011ab0: 666f 7220 6974 656d 2069 6e20 6f62 6a2e  for item in obj.
-00011ac0: 6974 656d 7328 295d 290a 2020 2020 6966  items()]).    if
-00011ad0: 2069 7369 6e73 7461 6e63 6528 6f62 6a2c   isinstance(obj,
-00011ae0: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
-00011af0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011b00: 7475 706c 6528 5b6d 616b 655f 6861 7368  tuple([make_hash
-00011b10: 6162 6c65 2869 7465 6d29 2066 6f72 2069  able(item) for i
-00011b20: 7465 6d20 696e 206f 626a 5d29 0a20 2020  tem in obj]).   
-00011b30: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-00011b40: 626a 2c20 2873 7472 2c20 756e 6963 6f64  bj, (str, unicod
-00011b50: 652c 2066 6c6f 6174 2c20 696e 742c 206c  e, float, int, l
-00011b60: 6f6e 6729 293a 0a20 2020 2020 2020 2072  ong)):.        r
-00011b70: 6574 7572 6e20 6f62 6a0a 2020 2020 6966  eturn obj.    if
-00011b80: 206f 626a 2069 7320 4e6f 6e65 3a0a 2020   obj is None:.  
-00011b90: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
-00011ba0: 0a20 2020 2069 6620 2274 656e 736f 7266  .    if "tensorf
-00011bb0: 6c6f 7722 2069 6e20 7379 732e 6d6f 6475  low" in sys.modu
-00011bc0: 6c65 733a 0a20 2020 2020 2020 2069 6d70  les:.        imp
-00011bd0: 6f72 7420 7465 6e73 6f72 666c 6f77 2061  ort tensorflow a
-00011be0: 7320 7466 0a0a 2020 2020 2020 2020 6966  s tf..        if
-00011bf0: 2069 7369 6e73 7461 6e63 6528 6f62 6a2c   isinstance(obj,
-00011c00: 2074 662e 5465 6e73 6f72 293a 0a20 2020   tf.Tensor):.   
-00011c10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011c20: 5265 6649 6445 7128 6f62 6a29 0a20 2020  RefIdEq(obj).   
-00011c30: 2061 7373 6572 7420 4661 6c73 652c 2022   assert False, "
-00011c40: 646f 6e27 7420 6b6e 6f77 2068 6f77 2074  don't know how t
-00011c50: 6f20 6d61 6b65 2068 6173 6861 626c 653a  o make hashable:
-00011c60: 2025 7220 2825 7229 2220 2520 286f 626a   %r (%r)" % (obj
-00011c70: 2c20 7479 7065 286f 626a 2929 0a0a 0a63  , type(obj))...c
-00011c80: 6c61 7373 2052 6566 4964 4571 2847 656e  lass RefIdEq(Gen
-00011c90: 6572 6963 5b54 5d29 3a0a 2020 2020 2222  eric[T]):.    ""
-00011ca0: 220a 2020 2020 5265 6665 7265 6e63 6520  ".    Reference 
-00011cb0: 746f 2073 6f6d 6520 6f62 6a65 6374 2028  to some object (
-00011cc0: 652e 672e 2074 2e66 5465 6e73 6f72 292c  e.g. t.fTensor),
-00011cd0: 2062 7574 2074 6869 7320 6f62 6a65 6374   but this object
-00011ce0: 2069 7320 616c 7761 7973 2068 6173 6861   is always hasha
-00011cf0: 626c 652c 0a20 2020 2061 6e64 2075 7365  ble,.    and use
-00011d00: 7320 7468 6520 6069 6460 206f 6620 7468  s the `id` of th
-00011d10: 6520 6675 6e63 7469 6f6e 2066 6f72 2074  e function for t
-00011d20: 6865 2068 6173 6820 616e 6420 6571 7561  he hash and equa
-00011d30: 6c69 7479 2e0a 0a20 2020 2028 496e 2063  lity...    (In c
-00011d40: 6173 6520 6f66 2074 662e 5465 6e73 6f72  ase of tf.Tensor
-00011d50: 2c20 7468 6973 2069 7320 666f 7220 636f  , this is for co
-00011d60: 6d70 6174 6962 696c 6974 790a 2020 2020  mpatibility.    
-00011d70: 2062 6563 6175 7365 2074 662e 5465 6e73   because tf.Tens
-00011d80: 6f72 2e72 6566 2829 2077 6173 206e 6f74  or.ref() was not
-00011d90: 2061 7661 696c 6162 6c65 2069 6e20 6561   available in ea
-00011da0: 726c 6965 7220 5446 2076 6572 7369 6f6e  rlier TF version
-00011db0: 732e 0a20 2020 2020 486f 7765 7665 722c  s..     However,
-00011dc0: 2077 6520 616c 736f 206e 6565 6420 7468   we also need th
-00011dd0: 6973 2066 6f72 203a 636c 6173 733a 6044  is for :class:`D
-00011de0: 6963 7452 6566 4b65 7973 602e 290a 2020  ictRefKeys`.).  
-00011df0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-00011e00: 5f69 6e69 745f 5f28 7365 6c66 2c20 6f62  _init__(self, ob
-00011e10: 6a3a 2054 293a 0a20 2020 2020 2020 2022  j: T):.        "
-00011e20: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-00011e30: 6d20 6f62 6a3a 2066 6f72 2065 7861 6d70  m obj: for examp
-00011e40: 6c65 2074 662e 5465 6e73 6f72 0a20 2020  le tf.Tensor.   
-00011e50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00011e60: 2073 656c 662e 6f62 6a20 3d20 6f62 6a0a   self.obj = obj.
-00011e70: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
-00011e80: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00011e90: 2072 6574 7572 6e20 2254 656e 736f 7252   return "TensorR
-00011ea0: 6566 7b25 727d 2220 2520 7365 6c66 2e6f  ef{%r}" % self.o
-00011eb0: 626a 0a0a 2020 2020 6465 6620 5f5f 6571  bj..    def __eq
-00011ec0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-00011ed0: 0a20 2020 2020 2020 2069 6620 6f74 6865  .        if othe
-00011ee0: 7220 6973 204e 6f6e 6520 6f72 206e 6f74  r is None or not
-00011ef0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-00011f00: 722c 2052 6566 4964 4571 293a 0a20 2020  r, RefIdEq):.   
-00011f10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011f20: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
-00011f30: 7475 726e 2073 656c 662e 6f62 6a20 6973  turn self.obj is
-00011f40: 206f 7468 6572 2e6f 626a 0a0a 2020 2020   other.obj..    
-00011f50: 6465 6620 5f5f 6e65 5f5f 2873 656c 662c  def __ne__(self,
-00011f60: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00011f70: 2072 6574 7572 6e20 6e6f 7420 7365 6c66   return not self
-00011f80: 2e5f 5f65 715f 5f28 6f74 6865 7229 0a0a  .__eq__(other)..
-00011f90: 2020 2020 6465 6620 5f5f 6861 7368 5f5f      def __hash__
-00011fa0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00011fb0: 7265 7475 726e 2069 6428 7365 6c66 2e6f  return id(self.o
-00011fc0: 626a 290a 0a0a 636c 6173 7320 4469 6374  bj)...class Dict
-00011fd0: 5265 664b 6579 7328 4765 6e65 7269 635b  RefKeys(Generic[
-00011fe0: 4b2c 2056 5d29 3a0a 2020 2020 2222 220a  K, V]):.    """.
-00011ff0: 2020 2020 4c69 6b65 2060 6469 6374 602c      Like `dict`,
-00012000: 2062 7574 2068 6173 6820 616e 6420 6571   but hash and eq
-00012010: 7561 6c69 7479 206f 6620 7468 6520 6b65  uality of the ke
-00012020: 7973 0a20 2020 2022 2222 0a0a 2020 2020  ys.    """..    
-00012030: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00012040: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-00012050: 2e5f 6420 3d20 7b7d 2020 2320 7479 7065  ._d = {}  # type
-00012060: 3a20 4469 6374 5b52 6566 4964 4571 5b4b  : Dict[RefIdEq[K
-00012070: 5d2c 2056 5d0a 0a20 2020 2064 6566 205f  ], V]..    def _
-00012080: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
-00012090: 2020 2020 2020 2072 6574 7572 6e20 2244         return "D
-000120a0: 6963 7452 6566 4b65 7973 2825 7329 2220  ictRefKeys(%s)" 
-000120b0: 2520 222c 2022 2e6a 6f69 6e28 5b22 2572  % ", ".join(["%r
-000120c0: 3a20 2572 2220 2520 286b 2c20 7629 2066  : %r" % (k, v) f
-000120d0: 6f72 2028 6b2c 2076 2920 696e 2073 656c  or (k, v) in sel
-000120e0: 662e 6974 656d 7328 295d 290a 0a20 2020  f.items()])..   
-000120f0: 2064 6566 2069 7465 6d73 2873 656c 6629   def items(self)
-00012100: 202d 3e20 4974 6572 6162 6c65 5b54 7570   -> Iterable[Tup
-00012110: 6c65 5b4b 2c20 565d 5d3a 0a20 2020 2020  le[K, V]]:.     
-00012120: 2020 2022 2222 6974 656d 7322 2222 0a20     """items""". 
-00012130: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00012140: 696e 2073 656c 662e 5f64 2e69 7465 6d73  in self._d.items
-00012150: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00012160: 7969 656c 6420 6b2e 6f62 6a2c 2076 0a0a  yield k.obj, v..
-00012170: 2020 2020 6465 6620 6b65 7973 2873 656c      def keys(sel
-00012180: 6629 202d 3e20 4974 6572 6162 6c65 5b4b  f) -> Iterable[K
-00012190: 5d3a 0a20 2020 2020 2020 2022 2222 6b65  ]:.        """ke
-000121a0: 7973 2222 220a 2020 2020 2020 2020 666f  ys""".        fo
-000121b0: 7220 6b20 696e 2073 656c 662e 5f64 2e6b  r k in self._d.k
-000121c0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-000121d0: 2020 2079 6965 6c64 206b 2e6f 626a 0a0a     yield k.obj..
-000121e0: 2020 2020 6465 6620 7661 6c75 6573 2873      def values(s
-000121f0: 656c 6629 202d 3e20 4974 6572 6162 6c65  elf) -> Iterable
-00012200: 5b56 5d3a 0a20 2020 2020 2020 2022 2222  [V]:.        """
-00012210: 7661 6c75 6573 2222 220a 2020 2020 2020  values""".      
-00012220: 2020 666f 7220 7620 696e 2073 656c 662e    for v in self.
-00012230: 5f64 2e76 616c 7565 7328 293a 0a20 2020  _d.values():.   
-00012240: 2020 2020 2020 2020 2079 6965 6c64 2076           yield v
-00012250: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
-00012260: 7465 6d5f 5f28 7365 6c66 2c20 6974 656d  tem__(self, item
-00012270: 3a20 4b29 202d 3e20 563a 0a20 2020 2020  : K) -> V:.     
-00012280: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00012290: 645b 5265 6649 6445 7128 6974 656d 295d  d[RefIdEq(item)]
-000122a0: 0a0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
-000122b0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 793a  tem__(self, key:
-000122c0: 204b 2c20 7661 6c75 653a 2056 293a 0a20   K, value: V):. 
-000122d0: 2020 2020 2020 2073 656c 662e 5f64 5b52         self._d[R
-000122e0: 6566 4964 4571 286b 6579 295d 203d 2076  efIdEq(key)] = v
-000122f0: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
-00012300: 636f 6e74 6169 6e73 5f5f 2873 656c 662c  contains__(self,
-00012310: 2069 7465 6d3a 204b 293a 0a20 2020 2020   item: K):.     
-00012320: 2020 2072 6574 7572 6e20 5265 6649 6445     return RefIdE
-00012330: 7128 6974 656d 2920 696e 2073 656c 662e  q(item) in self.
-00012340: 5f64 0a0a 0a64 6566 206d 616b 655f 646c  _d...def make_dl
-00012350: 6c5f 6e61 6d65 2862 6173 656e 616d 6529  l_name(basename)
-00012360: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00012370: 6172 616d 2073 7472 2062 6173 656e 616d  aram str basenam
-00012380: 653a 0a20 2020 203a 7265 7475 726e 3a20  e:.    :return: 
-00012390: 652e 672e 2022 6c69 6225 732e 736f 2220  e.g. "lib%s.so" 
-000123a0: 2520 6261 7365 6e61 6d65 2c20 6465 7065  % basename, depe
-000123b0: 6e64 696e 6720 6f6e 2073 7973 2e70 6c61  nding on sys.pla
-000123c0: 7466 6f72 6d0a 2020 2020 3a72 7479 7065  tform.    :rtype
-000123d0: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
-000123e0: 2020 6966 2073 7973 2e70 6c61 7466 6f72    if sys.platfor
-000123f0: 6d20 3d3d 2022 6461 7277 696e 223a 0a20  m == "darwin":. 
-00012400: 2020 2020 2020 2072 6574 7572 6e20 226c         return "l
-00012410: 6962 2573 2e64 796c 6962 2220 2520 6261  ib%s.dylib" % ba
-00012420: 7365 6e61 6d65 0a20 2020 2065 6c69 6620  sename.    elif 
-00012430: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
-00012440: 2277 696e 3332 223a 0a20 2020 2020 2020  "win32":.       
-00012450: 2072 6574 7572 6e20 2225 732e 646c 6c22   return "%s.dll"
-00012460: 2025 2062 6173 656e 616d 650a 2020 2020   % basename.    
-00012470: 656c 7365 3a20 2023 204c 696e 7578 2c20  else:  # Linux, 
-00012480: 556e 6978 0a20 2020 2020 2020 2072 6574  Unix.        ret
-00012490: 7572 6e20 226c 6962 2573 2e73 6f22 2025  urn "lib%s.so" %
-000124a0: 2062 6173 656e 616d 650a 0a0a 6465 6620   basename...def 
-000124b0: 6573 6361 7065 5f63 5f73 7472 2873 293a  escape_c_str(s):
-000124c0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-000124d0: 7261 6d20 7374 7220 733a 0a20 2020 203a  ram str s:.    :
-000124e0: 7265 7475 726e 3a20 432d 6573 6361 7065  return: C-escape
-000124f0: 6420 7374 720a 2020 2020 3a72 7479 7065  d str.    :rtype
-00012500: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
-00012510: 2020 7265 7475 726e 2027 2225 7322 2720    return '"%s"' 
-00012520: 2520 732e 7265 706c 6163 6528 225c 5c5c  % s.replace("\\\
-00012530: 5c22 2c20 225c 5c22 292e 7265 706c 6163  \", "\\").replac
-00012540: 6528 225c 6e22 2c20 225c 5c6e 2229 2e72  e("\n", "\\n").r
-00012550: 6570 6c61 6365 2827 2227 2c20 275c 5c22  eplace('"', '\\"
-00012560: 2729 2e72 6570 6c61 6365 2822 2722 2c20  ').replace("'", 
-00012570: 225c 5c27 2229 0a0a 0a64 6566 2061 7474  "\\'")...def att
-00012580: 725f 6368 6169 6e28 6261 7365 2c20 6174  r_chain(base, at
-00012590: 7472 6962 7329 3a0a 2020 2020 2222 220a  tribs):.    """.
-000125a0: 2020 2020 3a70 6172 616d 206f 626a 6563      :param objec
-000125b0: 7420 6261 7365 3a0a 2020 2020 3a70 6172  t base:.    :par
-000125c0: 616d 206c 6973 745b 7374 725d 7c74 7570  am list[str]|tup
-000125d0: 6c65 5b73 7472 5d7c 7374 7220 6174 7472  le[str]|str attr
-000125e0: 6962 733a 0a20 2020 203a 7265 7475 726e  ibs:.    :return
-000125f0: 3a20 6765 7461 7474 7228 6765 7461 7474  : getattr(getatt
-00012600: 7228 6f62 6a65 6374 2c20 6174 7472 6962  r(object, attrib
-00012610: 735b 305d 292c 2061 7474 7269 6273 5b31  s[0]), attribs[1
-00012620: 5d29 202e 2e2e 0a20 2020 203a 7274 7970  ]) ....    :rtyp
-00012630: 653a 206f 626a 6563 740a 2020 2020 2222  e: object.    ""
-00012640: 220a 2020 2020 6966 206e 6f74 2069 7369  ".    if not isi
-00012650: 6e73 7461 6e63 6528 6174 7472 6962 732c  nstance(attribs,
-00012660: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
-00012670: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00012680: 6973 696e 7374 616e 6365 2861 7474 7269  isinstance(attri
-00012690: 6273 2c20 7374 7229 0a20 2020 2020 2020  bs, str).       
-000126a0: 2061 7474 7269 6273 203d 205b 6174 7472   attribs = [attr
-000126b0: 6962 735d 0a20 2020 2065 6c73 653a 0a20  ibs].    else:. 
-000126c0: 2020 2020 2020 2061 7474 7269 6273 203d         attribs =
-000126d0: 206c 6973 7428 6174 7472 6962 7329 0a20   list(attribs). 
-000126e0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000126f0: 6528 6c65 6e28 6174 7472 6962 7329 293a  e(len(attribs)):
-00012700: 0a20 2020 2020 2020 2062 6173 6520 3d20  .        base = 
-00012710: 6765 7461 7474 7228 6261 7365 2c20 6174  getattr(base, at
-00012720: 7472 6962 735b 695d 290a 2020 2020 7265  tribs[i]).    re
-00012730: 7475 726e 2062 6173 650a 0a0a 6465 6620  turn base...def 
-00012740: 746f 5f62 6f6f 6c28 7629 3a0a 2020 2020  to_bool(v):.    
-00012750: 2222 220a 2020 2020 3a70 6172 616d 2069  """.    :param i
-00012760: 6e74 7c66 6c6f 6174 7c73 7472 2076 3a20  nt|float|str v: 
-00012770: 6966 2069 7420 6973 2061 2073 7472 696e  if it is a strin
-00012780: 672c 2069 7420 7368 6f75 6c64 2072 6570  g, it should rep
-00012790: 7265 7365 6e74 2073 6f6d 6520 696e 7465  resent some inte
-000127a0: 6765 722c 206f 7220 616c 7465 726e 6174  ger, or alternat
-000127b0: 6976 656c 7920 2274 7275 6522 206f 7220  ively "true" or 
-000127c0: 2266 616c 7365 220a 2020 2020 3a72 7479  "false".    :rty
-000127d0: 7065 3a20 626f 6f6c 0a20 2020 2022 2222  pe: bool.    """
-000127e0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-000127f0: 2020 7265 7475 726e 2062 6f6f 6c28 696e    return bool(in
-00012800: 7428 7629 290a 2020 2020 6578 6365 7074  t(v)).    except
-00012810: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
-00012820: 2020 2020 2070 6173 730a 2020 2020 6966       pass.    if
-00012830: 2069 7369 6e73 7461 6e63 6528 762c 2028   isinstance(v, (
-00012840: 7374 722c 2075 6e69 636f 6465 2929 3a0a  str, unicode)):.
-00012850: 2020 2020 2020 2020 7620 3d20 762e 6c6f          v = v.lo
-00012860: 7765 7228 290a 2020 2020 2020 2020 6966  wer().        if
-00012870: 2076 2069 6e20 5b22 7472 7565 222c 2022   v in ["true", "
-00012880: 7965 7322 2c20 226f 6e22 2c20 2231 225d  yes", "on", "1"]
-00012890: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000128a0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-000128b0: 2020 6966 2076 2069 6e20 5b22 6661 6c73    if v in ["fals
-000128c0: 6522 2c20 226e 6f22 2c20 226f 6666 222c  e", "no", "off",
-000128d0: 2022 3022 5d3a 0a20 2020 2020 2020 2020   "0"]:.         
-000128e0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-000128f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00012900: 7272 6f72 2822 746f 5f62 6f6f 6c20 6361  rror("to_bool ca
-00012910: 6e6e 6f74 2068 616e 646c 6520 2572 2220  nnot handle %r" 
-00012920: 2520 7629 0a0a 0a64 6566 2061 735f 7374  % v)...def as_st
-00012930: 7228 7329 3a0a 2020 2020 2222 220a 2020  r(s):.    """.  
-00012940: 2020 3a70 6172 616d 2073 7472 7c75 6e69    :param str|uni
-00012950: 636f 6465 7c62 7974 6573 2073 3a0a 2020  code|bytes s:.  
-00012960: 2020 3a72 7479 7065 3a20 7374 727c 756e    :rtype: str|un
-00012970: 6963 6f64 650a 2020 2020 2222 220a 2020  icode.    """.  
-00012980: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00012990: 732c 2073 7472 2920 6f72 2022 756e 6963  s, str) or "unic
-000129a0: 6f64 6522 2069 6e20 7374 7228 7479 7065  ode" in str(type
-000129b0: 2873 2929 3a0a 2020 2020 2020 2020 7265  (s)):.        re
-000129c0: 7475 726e 2073 0a20 2020 2069 6620 6973  turn s.    if is
-000129d0: 696e 7374 616e 6365 2873 2c20 6279 7465  instance(s, byte
-000129e0: 7329 206f 7220 6973 696e 7374 616e 6365  s) or isinstance
-000129f0: 2873 2c20 756e 6963 6f64 6529 3a0a 2020  (s, unicode):.  
-00012a00: 2020 2020 2020 2320 6e6f 696e 7370 6563        # noinspec
-00012a10: 7469 6f6e 2050 7955 6e72 6573 6f6c 7665  tion PyUnresolve
-00012a20: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
-00012a30: 2020 2020 7265 7475 726e 2073 2e64 6563      return s.dec
-00012a40: 6f64 6528 2275 7466 3822 290a 2020 2020  ode("utf8").    
-00012a50: 6173 7365 7274 2046 616c 7365 2c20 2275  assert False, "u
-00012a60: 6e6b 6e6f 776e 2074 7970 6520 2573 2220  nknown type %s" 
-00012a70: 2520 7479 7065 2873 290a 0a0a 6465 6620  % type(s)...def 
-00012a80: 7079 325f 7574 6638 5f73 7472 5f74 6f5f  py2_utf8_str_to_
-00012a90: 756e 6963 6f64 6528 7329 3a0a 2020 2020  unicode(s):.    
-00012aa0: 2222 220a 2020 2020 3a70 6172 616d 2073  """.    :param s
-00012ab0: 7472 2073 3a20 652e 672e 2074 6865 2073  tr s: e.g. the s
-00012ac0: 7472 696e 6720 6c69 7465 7261 6c20 22c3  tring literal ".
-00012ad0: a4c3 b6c3 bc22 2069 6e20 5079 7468 6f6e  ....." in Python
-00012ae0: 2033 2069 7320 636f 7272 6563 742c 2062   3 is correct, b
-00012af0: 7574 2069 6e20 5079 7468 6f6e 2032 2069  ut in Python 2 i
-00012b00: 7420 7368 6f75 6c64 2068 6176 6520 6265  t should have be
-00012b10: 656e 2075 22c3 a4c3 b6c3 bc22 2c0a 2020  en u"......",.  
-00012b20: 2020 2020 6275 7420 6a75 7374 2075 7369      but just usi
-00012b30: 6e67 2022 c3a4 c3b6 c3bc 2220 7769 6c6c  ng "......" will
-00012b40: 2061 6374 7561 6c6c 7920 6265 2074 6865   actually be the
-00012b50: 2072 6177 2075 7466 3820 6279 7465 2073   raw utf8 byte s
-00012b60: 6571 7565 6e63 652e 0a20 2020 2020 2054  equence..      T
-00012b70: 6869 7320 6361 6e20 6861 7070 656e 2077  his can happen w
-00012b80: 6865 6e20 796f 7520 6576 616c 2829 2073  hen you eval() s
-00012b90: 6f6d 6520 7374 7269 6e67 2e0a 2020 2020  ome string..    
-00012ba0: 2020 5765 2061 7373 756d 6520 7468 6174    We assume that
-00012bb0: 2079 6f75 2061 7265 2075 7369 6e67 2050   you are using P
-00012bc0: 7974 686f 6e20 322c 2061 6e64 2067 6f74  ython 2, and got
-00012bd0: 2074 6865 2073 7472 696e 6720 286e 6f74   the string (not
-00012be0: 2075 6e69 636f 6465 206f 626a 6563 7429   unicode object)
-00012bf0: 2022 c3a4 c3b6 c3bc 222c 206f 7220 6d61   "......", or ma
-00012c00: 7962 6520 2261 6263 222e 0a20 2020 2020  ybe "abc"..     
-00012c10: 2041 6c73 6f20 7365 6520 3a66 756e 633a   Also see :func:
-00012c20: 605f 7079 325f 756e 6963 6f64 655f 746f  `_py2_unicode_to
-00012c30: 5f73 7472 5f72 6563 7572 7369 7665 6020  _str_recursive` 
-00012c40: 616e 6420 3a66 756e 633a 6061 735f 7374  and :func:`as_st
-00012c50: 7260 2e0a 2020 2020 3a72 6574 7572 6e3a  r`..    :return:
-00012c60: 2069 6620 6974 2069 7320 696e 6465 6564   if it is indeed
-00012c70: 2075 6e69 636f 6465 2c20 6974 2077 696c   unicode, it wil
-00012c80: 6c20 7265 7475 726e 2074 6865 2075 6e69  l return the uni
-00012c90: 636f 6465 206f 626a 6563 742c 206f 7468  code object, oth
-00012ca0: 6572 7769 7365 2069 7420 6b65 6570 7320  erwise it keeps 
-00012cb0: 7468 6520 7374 7269 6e67 0a20 2020 203a  the string.    :
-00012cc0: 7274 7970 653a 2073 7472 7c75 6e69 636f  rtype: str|unico
-00012cd0: 6465 0a20 2020 2022 2222 0a20 2020 2061  de.    """.    a
-00012ce0: 7373 6572 7420 6e6f 7420 5059 330a 2020  ssert not PY3.  
-00012cf0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-00012d00: 6e63 6528 732c 2073 7472 290a 2020 2020  nce(s, str).    
-00012d10: 7472 793a 0a20 2020 2020 2020 2023 206e  try:.        # n
-00012d20: 6f69 6e73 7065 6374 696f 6e20 5079 556e  oinspection PyUn
-00012d30: 7265 736f 6c76 6564 5265 6665 7265 6e63  resolvedReferenc
-00012d40: 6573 0a20 2020 2020 2020 2073 2e64 6563  es.        s.dec
-00012d50: 6f64 6528 2261 7363 6969 2229 0a20 2020  ode("ascii").   
-00012d60: 2020 2020 2072 6574 7572 6e20 730a 2020       return s.  
-00012d70: 2020 6578 6365 7074 2055 6e69 636f 6465    except Unicode
-00012d80: 4465 636f 6465 4572 726f 723a 0a20 2020  DecodeError:.   
-00012d90: 2020 2020 2070 6173 730a 2020 2020 2320       pass.    # 
-00012da0: 6e6f 696e 7370 6563 7469 6f6e 2050 7955  noinspection PyU
-00012db0: 6e72 6573 6f6c 7665 6452 6566 6572 656e  nresolvedReferen
-00012dc0: 6365 730a 2020 2020 7265 7475 726e 2073  ces.    return s
-00012dd0: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
-00012de0: 0a0a 6465 6620 756e 6963 6f64 655f 746f  ..def unicode_to
-00012df0: 5f73 7472 2873 293a 0a20 2020 2022 2222  _str(s):.    """
-00012e00: 0a20 2020 2054 6865 2062 6568 6176 696f  .    The behavio
-00012e10: 7220 6973 2064 6966 6665 7265 6e74 2064  r is different d
-00012e20: 6570 656e 6469 6e67 206f 6e20 5079 7468  epending on Pyth
-00012e30: 6f6e 2032 206f 7220 5079 7468 6f6e 2033  on 2 or Python 3
-00012e40: 2e20 496e 2061 6c6c 2063 6173 6573 2c20  . In all cases, 
-00012e50: 7468 6520 7265 7475 726e 6564 2074 7970  the returned typ
-00012e60: 6520 6973 2061 2073 7472 206f 626a 6563  e is a str objec
-00012e70: 742e 0a20 2020 2050 7974 686f 6e20 323a  t..    Python 2:
-00012e80: 0a20 2020 2020 2057 6520 7265 7475 726e  .      We return
-00012e90: 2074 6865 2075 7466 3820 656e 636f 6465   the utf8 encode
-00012ea0: 6420 7374 7220 2877 6869 6368 2069 7320  d str (which is 
-00012eb0: 6c69 6b65 2050 7974 686f 6e20 3320 6279  like Python 3 by
-00012ec0: 7465 732c 206f 7220 666f 7220 4153 4349  tes, or for ASCI
-00012ed0: 492c 2074 6865 7265 2069 7320 6e6f 2064  I, there is no d
-00012ee0: 6966 6665 7265 6e63 6529 2e0a 2020 2020  ifference)..    
-00012ef0: 5079 7468 6f6e 2033 3a0a 2020 2020 2020  Python 3:.      
-00012f00: 5765 2072 6574 7572 6e20 6120 7374 7220  We return a str 
-00012f10: 6f62 6a65 6374 2e0a 2020 2020 4e6f 7465  object..    Note
-00012f20: 2074 6861 7420 7468 6973 2066 756e 6374   that this funct
-00012f30: 696f 6e20 7072 6f62 6162 6c79 2064 6f65  ion probably doe
-00012f40: 7320 6e6f 7420 6d61 6b65 206d 7563 6820  s not make much 
-00012f50: 7365 6e73 652e 0a20 2020 2049 7420 6d69  sense..    It mi
-00012f60: 6768 7420 6265 2075 7365 6420 7768 656e  ght be used when
-00012f70: 2074 6865 7265 2069 7320 6f74 6865 7220   there is other 
-00012f80: 636f 6465 2077 6869 6368 2065 7870 6563  code which expec
-00012f90: 7473 2061 2073 7472 206f 626a 6563 742c  ts a str object,
-00012fa0: 206e 6f20 6d61 7474 6572 2069 6620 5079   no matter if Py
-00012fb0: 7468 6f6e 2032 206f 7220 5079 7468 6f6e  thon 2 or Python
-00012fc0: 2033 2e0a 2020 2020 496e 2050 7974 686f   3..    In Pytho
-00012fd0: 6e20 322c 2061 2073 7472 206f 626a 6563  n 2, a str objec
-00012fe0: 7420 6f66 7465 6e20 686f 6c64 7320 5554  t often holds UT
-00012ff0: 4638 2074 6578 742c 2073 6f20 7468 6520  F8 text, so the 
-00013000: 6265 6861 7669 6f72 206f 6620 7468 6973  behavior of this
-00013010: 2066 756e 6374 696f 6e20 6973 2066 696e   function is fin
-00013020: 6520 7468 656e 2e0a 2020 2020 416c 736f  e then..    Also
-00013030: 2073 6565 203a 6675 6e63 3a60 6173 5f73   see :func:`as_s
-00013040: 7472 602e 0a0a 2020 2020 3a70 6172 616d  tr`...    :param
-00013050: 2073 7472 7c75 6e69 636f 6465 7c62 7974   str|unicode|byt
-00013060: 6573 2073 3a0a 2020 2020 3a72 7479 7065  es s:.    :rtype
-00013070: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
-00013080: 2020 6966 2050 5933 2061 6e64 2069 7369    if PY3 and isi
-00013090: 6e73 7461 6e63 6528 732c 2062 7974 6573  nstance(s, bytes
-000130a0: 293a 0a20 2020 2020 2020 2073 203d 2073  ):.        s = s
-000130b0: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
-000130c0: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
-000130d0: 7369 6e73 7461 6e63 6528 732c 2073 7472  sinstance(s, str
-000130e0: 290a 2020 2020 6966 206e 6f74 2050 5933  ).    if not PY3
-000130f0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
-00013100: 732c 2075 6e69 636f 6465 293a 0a20 2020  s, unicode):.   
-00013110: 2020 2020 2073 203d 2073 2e65 6e63 6f64       s = s.encod
-00013120: 6528 2275 7466 3822 290a 2020 2020 2020  e("utf8").      
-00013130: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-00013140: 6e63 6528 732c 2073 7472 290a 2020 2020  nce(s, str).    
-00013150: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-00013160: 6528 732c 2073 7472 290a 2020 2020 7265  e(s, str).    re
-00013170: 7475 726e 2073 0a0a 0a64 6566 2064 6565  turn s...def dee
-00013180: 7063 6f70 7928 782c 2073 746f 705f 7479  pcopy(x, stop_ty
-00013190: 7065 733d 4e6f 6e65 293a 0a20 2020 2022  pes=None):.    "
-000131a0: 2222 0a20 2020 2053 696d 706c 6572 2076  "".    Simpler v
-000131b0: 6172 6961 6e74 206f 6620 636f 7079 2e64  ariant of copy.d
-000131c0: 6565 7063 6f70 7928 292e 0a20 2020 2053  eepcopy()..    S
-000131d0: 686f 756c 6420 6861 6e64 6c65 2073 6f6d  hould handle som
-000131e0: 6520 6564 6765 2063 6173 6573 2061 7320  e edge cases as 
-000131f0: 7765 6c6c 2c20 6c69 6b65 2063 6f70 7969  well, like copyi
-00013200: 6e67 206d 6f64 756c 6520 7265 6665 7265  ng module refere
-00013210: 6e63 6573 2e0a 0a20 2020 203a 7061 7261  nces...    :para
-00013220: 6d20 5420 783a 2061 6e20 6172 6269 7472  m T x: an arbitr
-00013230: 6172 7920 6f62 6a65 6374 0a20 2020 203a  ary object.    :
-00013240: 7061 7261 6d20 6c69 7374 5b74 7970 655d  param list[type]
-00013250: 7c4e 6f6e 6520 7374 6f70 5f74 7970 6573  |None stop_types
-00013260: 3a20 6f62 6a65 6374 7320 6f66 2074 6865  : objects of the
-00013270: 7365 2074 7970 6573 2077 696c 6c20 6e6f  se types will no
-00013280: 7420 6265 2064 6565 702d 636f 7069 6564  t be deep-copied
-00013290: 2c20 6f6e 6c79 2074 6865 2072 6566 6572  , only the refer
-000132a0: 656e 6365 2069 7320 7061 7373 6564 0a20  ence is passed. 
-000132b0: 2020 203a 7274 7970 653a 2054 0a20 2020     :rtype: T.   
-000132c0: 2022 2222 0a20 2020 2023 2053 6565 2061   """.    # See a
-000132d0: 6c73 6f20 636c 6173 7320 5069 636b 6c65  lso class Pickle
-000132e0: 7220 6672 6f6d 2054 6173 6b53 7973 7465  r from TaskSyste
-000132f0: 6d2e 0a20 2020 2023 204f 723a 2068 7474  m..    # Or: htt
-00013300: 7073 3a2f 2f6d 6169 6c2e 7079 7468 6f6e  ps://mail.python
-00013310: 2e6f 7267 2f70 6970 6572 6d61 696c 2f70  .org/pipermail/p
-00013320: 7974 686f 6e2d 6964 6561 732f 3230 3133  ython-ideas/2013
-00013330: 2d4a 756c 792f 3032 3139 3539 2e68 746d  -July/021959.htm
-00013340: 6c0a 2020 2020 6672 6f6d 202e 7461 736b  l.    from .task
-00013350: 5f73 7973 7465 6d20 696d 706f 7274 2050  _system import P
-00013360: 6963 6b6c 6572 2c20 556e 7069 636b 6c65  ickler, Unpickle
-00013370: 720a 0a20 2020 2070 6572 7369 7374 656e  r..    persisten
-00013380: 745f 6d65 6d6f 203d 207b 7d20 2023 2069  t_memo = {}  # i
-00013390: 6420 2d3e 206f 626a 0a0a 2020 2020 6465  d -> obj..    de
-000133a0: 6620 7065 7273 6973 7465 6e74 5f69 6428  f persistent_id(
-000133b0: 6f62 6a29 3a0a 2020 2020 2020 2020 2222  obj):.        ""
-000133c0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
-000133d0: 206f 626a 6563 7420 6f62 6a3a 0a20 2020   object obj:.   
-000133e0: 2020 2020 203a 7274 7970 653a 2069 6e74       :rtype: int
-000133f0: 7c4e 6f6e 650a 2020 2020 2020 2020 2222  |None.        ""
-00013400: 220a 2020 2020 2020 2020 6966 2073 746f  ".        if sto
-00013410: 705f 7479 7065 7320 616e 6420 6973 696e  p_types and isin
-00013420: 7374 616e 6365 286f 626a 2c20 7475 706c  stance(obj, tupl
-00013430: 6528 7374 6f70 5f74 7970 6573 2929 3a0a  e(stop_types)):.
-00013440: 2020 2020 2020 2020 2020 2020 7065 7273              pers
-00013450: 6973 7465 6e74 5f6d 656d 6f5b 6964 286f  istent_memo[id(o
-00013460: 626a 295d 203d 206f 626a 0a20 2020 2020  bj)] = obj.     
-00013470: 2020 2020 2020 2072 6574 7572 6e20 6964         return id
-00013480: 286f 626a 290a 2020 2020 2020 2020 7265  (obj).        re
-00013490: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
-000134a0: 6566 2070 6963 6b6c 655f 6475 6d70 7328  ef pickle_dumps(
-000134b0: 6f62 6a29 3a0a 2020 2020 2020 2020 2222  obj):.        ""
-000134c0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
-000134d0: 206f 626a 6563 7420 6f62 6a3a 0a20 2020   object obj:.   
-000134e0: 2020 2020 203a 7274 7970 653a 2062 7974       :rtype: byt
-000134f0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
-00013500: 2020 2020 2020 2073 696f 203d 2042 7974         sio = Byt
-00013510: 6573 494f 2829 0a20 2020 2020 2020 2070  esIO().        p
-00013520: 203d 2050 6963 6b6c 6572 2873 696f 290a   = Pickler(sio).
-00013530: 2020 2020 2020 2020 702e 7065 7273 6973          p.persis
-00013540: 7465 6e74 5f69 6420 3d20 7065 7273 6973  tent_id = persis
-00013550: 7465 6e74 5f69 640a 2020 2020 2020 2020  tent_id.        
-00013560: 702e 6475 6d70 286f 626a 290a 2020 2020  p.dump(obj).    
-00013570: 2020 2020 7265 7475 726e 2073 696f 2e67      return sio.g
-00013580: 6574 7661 6c75 6528 290a 0a20 2020 2023  etvalue()..    #
-00013590: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
-000135a0: 5368 6164 6f77 696e 674e 616d 6573 0a20  ShadowingNames. 
-000135b0: 2020 2064 6566 2070 6963 6b6c 655f 6c6f     def pickle_lo
-000135c0: 6164 7328 7329 3a0a 2020 2020 2020 2020  ads(s):.        
-000135d0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-000135e0: 616d 2062 7974 6573 2073 3a0a 2020 2020  am bytes s:.    
-000135f0: 2020 2020 3a72 7479 7065 3a20 6f62 6a65      :rtype: obje
-00013600: 6374 0a20 2020 2020 2020 2022 2222 0a20  ct.        """. 
-00013610: 2020 2020 2020 2070 203d 2055 6e70 6963         p = Unpic
-00013620: 6b6c 6572 2842 7974 6573 494f 2873 2929  kler(BytesIO(s))
-00013630: 0a20 2020 2020 2020 2070 2e70 6572 7369  .        p.persi
-00013640: 7374 656e 745f 6c6f 6164 203d 2070 6572  stent_load = per
-00013650: 7369 7374 656e 745f 6d65 6d6f 2e5f 5f67  sistent_memo.__g
-00013660: 6574 6974 656d 5f5f 0a20 2020 2020 2020  etitem__.       
-00013670: 2072 6574 7572 6e20 702e 6c6f 6164 2829   return p.load()
-00013680: 0a0a 2020 2020 7320 3d20 7069 636b 6c65  ..    s = pickle
-00013690: 5f64 756d 7073 2878 290a 2020 2020 6320  _dumps(x).    c 
-000136a0: 3d20 7069 636b 6c65 5f6c 6f61 6473 2873  = pickle_loads(s
-000136b0: 290a 2020 2020 7265 7475 726e 2063 0a0a  ).    return c..
-000136c0: 0a64 6566 206c 6f61 645f 7478 745f 7665  .def load_txt_ve
-000136d0: 6374 6f72 2866 696c 656e 616d 6529 3a0a  ctor(filename):.
-000136e0: 2020 2020 2222 220a 2020 2020 4578 7065      """.    Expe
-000136f0: 6374 206c 696e 652d 6261 7365 6420 7465  ct line-based te
-00013700: 7874 2065 6e63 6f64 696e 6720 696e 2066  xt encoding in f
-00013710: 696c 652e 0a20 2020 2057 6520 616c 736f  ile..    We also
-00013720: 2073 7570 706f 7274 2053 7072 696e 7420   support Sprint 
-00013730: 584d 4c20 666f 726d 6174 2c20 7768 6963  XML format, whic
-00013740: 6820 6861 7320 736f 6d65 2061 6464 6974  h has some addit
-00013750: 696f 6e61 6c20 786d 6c20 6865 6164 6572  ional xml header
-00013760: 2061 6e64 2066 6f6f 7465 722c 0a20 2020   and footer,.   
-00013770: 2077 6869 6368 2077 6520 7769 6c6c 206a   which we will j
-00013780: 7573 7420 7374 7269 7020 6177 6179 2e0a  ust strip away..
-00013790: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
-000137a0: 6669 6c65 6e61 6d65 3a0a 2020 2020 3a72  filename:.    :r
-000137b0: 7479 7065 3a20 6c69 7374 5b66 6c6f 6174  type: list[float
-000137c0: 5d0a 2020 2020 2222 220a 2020 2020 7265  ].    """.    re
-000137d0: 7475 726e 205b 666c 6f61 7428 6c69 6e65  turn [float(line
-000137e0: 2920 666f 7220 6c69 6e65 2069 6e20 6f70  ) for line in op
-000137f0: 656e 2866 696c 656e 616d 6529 2e72 6561  en(filename).rea
-00013800: 6428 292e 7370 6c69 746c 696e 6573 2829  d().splitlines()
-00013810: 2069 6620 6c69 6e65 2061 6e64 206e 6f74   if line and not
-00013820: 206c 696e 652e 7374 6172 7473 7769 7468   line.startswith
-00013830: 2822 3c22 295d 0a0a 0a63 6c61 7373 2043  ("<")]...class C
-00013840: 6f6c 6c65 6374 696f 6e52 6561 6443 6865  ollectionReadChe
-00013850: 636b 436f 7665 7265 643a 0a20 2020 2022  ckCovered:.    "
-00013860: 2222 0a20 2020 2057 7261 7073 2061 726f  "".    Wraps aro
-00013870: 756e 6420 6120 6469 6374 2e20 4974 206b  und a dict. It k
-00013880: 6565 7073 2074 7261 636b 2061 626f 7574  eeps track about
-00013890: 2061 6c6c 2074 6865 206b 6579 7320 7768   all the keys wh
-000138a0: 6963 6820 7765 7265 2072 6561 6420 6672  ich were read fr
-000138b0: 6f6d 2074 6865 2064 6963 742e 0a20 2020  om the dict..   
-000138c0: 2056 6961 203a 6675 6e63 3a60 6173 7365   Via :func:`asse
-000138d0: 7274 5f61 6c6c 5f72 6561 6460 2c20 796f  rt_all_read`, yo
-000138e0: 7520 6361 6e20 6368 6563 6b20 7468 6174  u can check that
-000138f0: 2074 6865 7265 2061 7265 206e 6f20 6b65   there are no ke
-00013900: 7973 2069 6e20 7468 6520 6469 6374 2077  ys in the dict w
-00013910: 6869 6368 2077 6572 6520 6e6f 7420 7265  hich were not re
-00013920: 6164 2e0a 2020 2020 5468 6520 7573 6167  ad..    The usag
-00013930: 6520 6973 2066 6f72 2063 6f6e 6669 6720  e is for config 
-00013940: 6469 6374 206f 7074 696f 6e73 2c20 7768  dict options, wh
-00013950: 6572 6520 7468 6520 7573 6572 2068 6173  ere the user has
-00013960: 2073 7065 6369 6669 6564 2061 2072 616e   specified a ran
-00013970: 6765 206f 6620 6f70 7469 6f6e 732c 0a20  ge of options,. 
-00013980: 2020 2061 6e64 2077 6865 7265 2069 6e20     and where in 
-00013990: 7468 6520 636f 6465 2074 6865 7265 2069  the code there i
-000139a0: 7320 7573 7561 6c6c 7920 6120 6465 6661  s usually a defa
-000139b0: 756c 7420 666f 7220 6576 6572 7920 6e6f  ult for every no
-000139c0: 6e2d 7370 6563 6966 6965 6420 6f70 7469  n-specified opti
-000139d0: 6f6e 2c0a 2020 2020 746f 2063 6865 636b  on,.    to check
-000139e0: 2077 6865 7468 6572 2061 6c6c 2074 6865   whether all the
-000139f0: 2075 7365 722d 7370 6563 6966 6965 6420   user-specified 
-00013a00: 6f70 7469 6f6e 7320 6172 6520 616c 736f  options are also
-00013a10: 2075 7365 6420 286d 6179 6265 2074 6865   used (maybe the
-00013a20: 2075 7365 7220 6d61 6465 2061 2074 7970   user made a typ
-00013a30: 6f29 2e0a 2020 2020 2222 220a 0a20 2020  o)..    """..   
-00013a40: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00013a50: 6c66 2c20 636f 6c6c 6563 7469 6f6e 2c20  lf, collection, 
-00013a60: 7472 7574 685f 7661 6c75 653d 4e6f 6e65  truth_value=None
-00013a70: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00013a80: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
-00013a90: 6374 5b73 7472 5d20 636f 6c6c 6563 7469  ct[str] collecti
-00013aa0: 6f6e 3a0a 2020 2020 2020 2020 3a70 6172  on:.        :par
-00013ab0: 616d 204e 6f6e 657c 626f 6f6c 2074 7275  am None|bool tru
-00013ac0: 7468 5f76 616c 7565 3a20 6e6f 7465 3a20  th_value: note: 
-00013ad0: 6368 6563 6b20 6578 706c 6963 6974 6c79  check explicitly
-00013ae0: 2066 6f72 2073 656c 662e 7472 7574 685f   for self.truth_
-00013af0: 7661 6c75 652c 2062 6f6f 6c28 7365 6c66  value, bool(self
-00013b00: 2920 6973 206e 6f74 2074 6865 2073 616d  ) is not the sam
-00013b10: 6521 0a20 2020 2020 2020 2022 2222 0a20  e!.        """. 
-00013b20: 2020 2020 2020 2073 656c 662e 636f 6c6c         self.coll
-00013b30: 6563 7469 6f6e 203d 2063 6f6c 6c65 6374  ection = collect
-00013b40: 696f 6e0a 2020 2020 2020 2020 6966 2074  ion.        if t
-00013b50: 7275 7468 5f76 616c 7565 2069 7320 4e6f  ruth_value is No
-00013b60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00013b70: 7472 7574 685f 7661 6c75 6520 3d20 626f  truth_value = bo
-00013b80: 6f6c 2873 656c 662e 636f 6c6c 6563 7469  ol(self.collecti
-00013b90: 6f6e 290a 2020 2020 2020 2020 7365 6c66  on).        self
-00013ba0: 2e74 7275 7468 5f76 616c 7565 203d 2074  .truth_value = t
-00013bb0: 7275 7468 5f76 616c 7565 0a20 2020 2020  ruth_value.     
-00013bc0: 2020 2073 656c 662e 676f 745f 6974 656d     self.got_item
-00013bd0: 7320 3d20 7365 7428 290a 0a20 2020 2064  s = set()..    d
-00013be0: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
-00013bf0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00013c00: 6e20 2225 7328 2572 2c20 7472 7574 685f  n "%s(%r, truth_
-00013c10: 7661 6c75 653d 2572 2922 2025 2028 7365  value=%r)" % (se
-00013c20: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
-00013c30: 616d 655f 5f2c 2073 656c 662e 636f 6c6c  ame__, self.coll
-00013c40: 6563 7469 6f6e 2c20 7365 6c66 2e74 7275  ection, self.tru
-00013c50: 7468 5f76 616c 7565 290a 0a20 2020 2040  th_value)..    @
-00013c60: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00013c70: 6465 6620 6672 6f6d 5f62 6f6f 6c5f 6f72  def from_bool_or
-00013c80: 5f64 6963 7428 636c 732c 2076 616c 7565  _dict(cls, value
-00013c90: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00013ca0: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
-00013cb0: 6f6c 7c64 6963 745b 7374 725d 2076 616c  ol|dict[str] val
-00013cc0: 7565 3a0a 2020 2020 2020 2020 3a72 7479  ue:.        :rty
-00013cd0: 7065 3a20 436f 6c6c 6563 7469 6f6e 5265  pe: CollectionRe
-00013ce0: 6164 4368 6563 6b43 6f76 6572 6564 0a20  adCheckCovered. 
-00013cf0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013d00: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00013d10: 2876 616c 7565 2c20 626f 6f6c 293a 0a20  (value, bool):. 
-00013d20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013d30: 6e20 636c 7328 636f 6c6c 6563 7469 6f6e  n cls(collection
-00013d40: 3d7b 7d2c 2074 7275 7468 5f76 616c 7565  ={}, truth_value
-00013d50: 3d76 616c 7565 290a 2020 2020 2020 2020  =value).        
-00013d60: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
-00013d70: 6c75 652c 2064 6963 7429 3a0a 2020 2020  lue, dict):.    
-00013d80: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00013d90: 6c73 2863 6f6c 6c65 6374 696f 6e3d 7661  ls(collection=va
-00013da0: 6c75 6529 0a20 2020 2020 2020 2072 6169  lue).        rai
-00013db0: 7365 2054 7970 6545 7272 6f72 2822 696e  se TypeError("in
-00013dc0: 7661 6c69 6420 7479 7065 3a20 2573 2220  valid type: %s" 
-00013dd0: 2520 7479 7065 2876 616c 7565 2929 0a0a  % type(value))..
-00013de0: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-00013df0: 6d5f 5f28 7365 6c66 2c20 6974 656d 293a  m__(self, item):
-00013e00: 0a20 2020 2020 2020 2072 6573 203d 2073  .        res = s
-00013e10: 656c 662e 636f 6c6c 6563 7469 6f6e 5b69  elf.collection[i
-00013e20: 7465 6d5d 0a20 2020 2020 2020 2073 656c  tem].        sel
-00013e30: 662e 676f 745f 6974 656d 732e 6164 6428  f.got_items.add(
-00013e40: 6974 656d 290a 2020 2020 2020 2020 7265  item).        re
-00013e50: 7475 726e 2072 6573 0a0a 2020 2020 6465  turn res..    de
-00013e60: 6620 6765 7428 7365 6c66 2c20 6974 656d  f get(self, item
-00013e70: 2c20 6465 6661 756c 743d 4e6f 6e65 293a  , default=None):
-00013e80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013e90: 2020 2020 203a 7061 7261 6d20 7374 7220       :param str 
-00013ea0: 6974 656d 3a0a 2020 2020 2020 2020 3a70  item:.        :p
-00013eb0: 6172 616d 2054 2064 6566 6175 6c74 3a0a  aram T default:.
-00013ec0: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00013ed0: 547c 7479 7069 6e67 2e41 6e79 7c4e 6f6e  T|typing.Any|Non
-00013ee0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00013ef0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00013f00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00013f10: 6c66 5b69 7465 6d5d 0a20 2020 2020 2020  lf[item].       
-00013f20: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-00013f30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013f40: 7475 726e 2064 6566 6175 6c74 0a0a 2020  turn default..  
-00013f50: 2020 6465 6620 5f5f 626f 6f6c 5f5f 2873    def __bool__(s
-00013f60: 656c 6629 3a20 2023 2050 7974 686f 6e20  elf):  # Python 
-00013f70: 330a 2020 2020 2020 2020 7265 7475 726e  3.        return
-00013f80: 2073 656c 662e 7472 7574 685f 7661 6c75   self.truth_valu
-00013f90: 650a 0a20 2020 205f 5f6e 6f6e 7a65 726f  e..    __nonzero
-00013fa0: 5f5f 203d 205f 5f62 6f6f 6c5f 5f20 2023  __ = __bool__  #
-00013fb0: 2050 7974 686f 6e20 320a 0a20 2020 2064   Python 2..    d
-00013fc0: 6566 205f 5f6c 656e 5f5f 2873 656c 6629  ef __len__(self)
-00013fd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00013fe0: 206c 656e 2873 656c 662e 636f 6c6c 6563   len(self.collec
-00013ff0: 7469 6f6e 290a 0a20 2020 2064 6566 205f  tion)..    def _
-00014000: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
-00014010: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-00014020: 7365 6c66 2e63 6f6c 6c65 6374 696f 6e3a  self.collection:
-00014030: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
-00014040: 6c64 2073 656c 665b 6b5d 0a0a 2020 2020  ld self[k]..    
-00014050: 6465 6620 6173 7365 7274 5f61 6c6c 5f72  def assert_all_r
-00014060: 6561 6428 7365 6c66 293a 0a20 2020 2020  ead(self):.     
-00014070: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-00014080: 7373 6572 7473 2074 6861 7420 616c 6c20  sserts that all 
-00014090: 6974 656d 7320 6861 7665 2062 6565 6e20  items have been 
-000140a0: 7265 6164 2e0a 2020 2020 2020 2020 2222  read..        ""
-000140b0: 220a 2020 2020 2020 2020 7265 6d61 696e  ".        remain
-000140c0: 696e 6720 3d20 7365 7428 7365 6c66 2e63  ing = set(self.c
-000140d0: 6f6c 6c65 6374 696f 6e29 2e64 6966 6665  ollection).diffe
-000140e0: 7265 6e63 6528 7365 6c66 2e67 6f74 5f69  rence(self.got_i
-000140f0: 7465 6d73 290a 2020 2020 2020 2020 6173  tems).        as
-00014100: 7365 7274 206e 6f74 2072 656d 6169 6e69  sert not remaini
-00014110: 6e67 2c20 2254 6865 206b 6579 7320 2572  ng, "The keys %r
-00014120: 2077 6572 6520 6e6f 7420 7265 6164 2069   were not read i
-00014130: 6e20 7468 6520 636f 6c6c 6563 7469 6f6e  n the collection
-00014140: 2025 722e 2220 2520 2872 656d 6169 6e69   %r." % (remaini
-00014150: 6e67 2c20 7365 6c66 2e63 6f6c 6c65 6374  ng, self.collect
-00014160: 696f 6e29 0a0a 0a64 6566 2077 6869 6368  ion)...def which
-00014170: 2870 726f 6772 616d 293a 0a20 2020 2022  (program):.    "
-00014180: 2222 0a20 2020 2046 696e 6473 2060 7072  "".    Finds `pr
-00014190: 6f67 7261 6d60 2069 6e20 736f 6d65 206f  ogram` in some o
-000141a0: 6620 7468 6520 6469 7273 206f 6620 7468  f the dirs of th
-000141b0: 6520 5041 5448 2065 6e76 2076 6172 2e0a  e PATH env var..
-000141c0: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
-000141d0: 7072 6f67 7261 6d3a 2065 2e67 2e20 2270  program: e.g. "p
-000141e0: 7974 686f 6e22 0a20 2020 203a 7265 7475  ython".    :retu
-000141f0: 726e 3a20 6675 6c6c 2070 6174 682c 2065  rn: full path, e
-00014200: 2e67 2e20 222f 7573 722f 6269 6e2f 7079  .g. "/usr/bin/py
-00014210: 7468 6f6e 222c 206f 7220 4e6f 6e65 0a20  thon", or None. 
-00014220: 2020 203a 7274 7970 653a 2073 7472 7c4e     :rtype: str|N
-00014230: 6f6e 650a 2020 2020 2222 220a 2020 2020  one.    """.    
-00014240: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
-00014250: 7953 6861 646f 7769 6e67 4e61 6d65 730a  yShadowingNames.
-00014260: 2020 2020 6465 6620 6973 5f65 7865 2870      def is_exe(p
-00014270: 6174 6829 3a0a 2020 2020 2020 2020 2222  ath):.        ""
-00014280: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
-00014290: 2073 7472 2070 6174 683a 0a20 2020 2020   str path:.     
-000142a0: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
-000142b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000142c0: 2020 2072 6574 7572 6e20 6f73 2e70 6174     return os.pat
-000142d0: 682e 6973 6669 6c65 2870 6174 6829 2061  h.isfile(path) a
-000142e0: 6e64 206f 732e 6163 6365 7373 2870 6174  nd os.access(pat
-000142f0: 682c 206f 732e 585f 4f4b 290a 0a20 2020  h, os.X_OK)..   
-00014300: 2066 7061 7468 2c20 666e 616d 6520 3d20   fpath, fname = 
-00014310: 6f73 2e70 6174 682e 7370 6c69 7428 7072  os.path.split(pr
-00014320: 6f67 7261 6d29 0a20 2020 2069 6620 6670  ogram).    if fp
-00014330: 6174 683a 0a20 2020 2020 2020 2069 6620  ath:.        if 
-00014340: 6973 5f65 7865 2870 726f 6772 616d 293a  is_exe(program):
-00014350: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00014360: 7572 6e20 7072 6f67 7261 6d0a 2020 2020  urn program.    
-00014370: 656c 7365 3a0a 2020 2020 2020 2020 666f  else:.        fo
-00014380: 7220 7061 7468 2069 6e20 6f73 2e65 6e76  r path in os.env
-00014390: 6972 6f6e 5b22 5041 5448 225d 2e73 706c  iron["PATH"].spl
-000143a0: 6974 286f 732e 7061 7468 7365 7029 3a0a  it(os.pathsep):.
-000143b0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-000143c0: 203d 2070 6174 682e 7374 7269 7028 2722   = path.strip('"
-000143d0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
-000143e0: 7865 5f66 696c 6520 3d20 6f73 2e70 6174  xe_file = os.pat
-000143f0: 682e 6a6f 696e 2870 6174 682c 2070 726f  h.join(path, pro
-00014400: 6772 616d 290a 2020 2020 2020 2020 2020  gram).          
-00014410: 2020 6966 2069 735f 6578 6528 6578 655f    if is_exe(exe_
-00014420: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-00014430: 2020 2020 2020 2072 6574 7572 6e20 6578         return ex
-00014440: 655f 6669 6c65 0a0a 2020 2020 7265 7475  e_file..    retu
-00014450: 726e 204e 6f6e 650a 0a0a 6465 6620 7768  rn None...def wh
-00014460: 6963 685f 7069 7028 293a 0a20 2020 2022  ich_pip():.    "
-00014470: 2222 0a20 2020 203a 7274 7970 653a 2073  "".    :rtype: s
-00014480: 7472 0a20 2020 203a 7265 7475 726e 3a20  tr.    :return: 
-00014490: 7061 7468 2074 6f20 7069 7020 666f 7220  path to pip for 
-000144a0: 7468 6520 6375 7272 656e 7420 5079 7468  the current Pyth
-000144b0: 6f6e 2065 6e76 0a20 2020 2022 2222 0a20  on env.    """. 
-000144c0: 2020 2023 2042 6566 6f72 6520 7765 206c     # Before we l
-000144d0: 6f6f 6b20 616e 7977 6865 7265 2069 6e20  ook anywhere in 
-000144e0: 5041 5448 2c20 6368 6563 6b20 6966 2074  PATH, check if t
-000144f0: 6865 7265 2069 7320 736f 6d65 2070 6970  here is some pip
-00014500: 2061 6c6f 6e67 7369 6465 2074 6f20 7468   alongside to th
-00014510: 6520 5079 7468 6f6e 2065 7865 6375 7461  e Python executa
-00014520: 626c 652e 0a20 2020 2023 2054 6869 7320  ble..    # This 
-00014530: 6d69 6768 7420 6265 206d 6f72 6520 7265  might be more re
-00014540: 6c69 6162 6c65 2e0a 2020 2020 7079 203d  liable..    py =
-00014550: 2073 7973 2e65 7865 6375 7461 626c 650a   sys.executable.
-00014560: 2020 2020 6469 725f 6e61 6d65 2c20 6261      dir_name, ba
-00014570: 7365 6e61 6d65 203d 2070 792e 7273 706c  sename = py.rspl
-00014580: 6974 2822 2f22 2c20 3129 0a20 2020 2069  it("/", 1).    i
-00014590: 6620 6261 7365 6e61 6d65 2e73 7461 7274  f basename.start
-000145a0: 7377 6974 6828 2270 7974 686f 6e22 293a  swith("python"):
-000145b0: 0a20 2020 2020 2020 2070 6f73 7466 6978  .        postfix
-000145c0: 203d 2062 6173 656e 616d 655b 6c65 6e28   = basename[len(
-000145d0: 2270 7974 686f 6e22 2920 3a5d 0a20 2020  "python") :].   
-000145e0: 2020 2020 2070 6970 5f70 6174 6820 3d20       pip_path = 
-000145f0: 2225 732f 7069 7025 7322 2025 2028 6469  "%s/pip%s" % (di
-00014600: 725f 6e61 6d65 2c20 706f 7374 6669 7829  r_name, postfix)
-00014610: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00014620: 6174 682e 6578 6973 7473 2870 6970 5f70  ath.exists(pip_p
-00014630: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-00014640: 2020 7265 7475 726e 2070 6970 5f70 6174    return pip_pat
-00014650: 680a 2020 2020 2320 4765 6e65 7269 6320  h.    # Generic 
-00014660: 6661 6c6c 6261 636b 2e0a 2020 2020 7069  fallback..    pi
-00014670: 705f 7061 7468 203d 2077 6869 6368 2822  p_path = which("
-00014680: 7069 7022 290a 2020 2020 7265 7475 726e  pip").    return
-00014690: 2070 6970 5f70 6174 680a 0a0a 6465 6620   pip_path...def 
-000146a0: 7069 705f 696e 7374 616c 6c28 2a70 6b67  pip_install(*pkg
-000146b0: 5f6e 616d 6573 293a 0a20 2020 2022 2222  _names):.    """
-000146c0: 0a20 2020 2049 6e73 7461 6c6c 2070 6163  .    Install pac
-000146d0: 6b61 6765 7320 7669 6120 7069 7020 666f  kages via pip fo
-000146e0: 7220 7468 6520 6375 7272 656e 7420 5079  r the current Py
-000146f0: 7468 6f6e 2065 6e76 2e0a 0a20 2020 203a  thon env...    :
-00014700: 7061 7261 6d20 7374 7220 706b 675f 6e61  param str pkg_na
-00014710: 6d65 733a 0a20 2020 2022 2222 0a20 2020  mes:.    """.   
-00014720: 2070 7920 3d20 7379 732e 6578 6563 7574   py = sys.execut
-00014730: 6162 6c65 0a20 2020 2070 6970 5f70 6174  able.    pip_pat
-00014740: 6820 3d20 7768 6963 685f 7069 7028 290a  h = which_pip().
-00014750: 2020 2020 7072 696e 7428 2250 6970 2069      print("Pip i
-00014760: 6e73 7461 6c6c 222c 202a 706b 675f 6e61  nstall", *pkg_na
-00014770: 6d65 7329 0a20 2020 2069 6e5f 7669 7274  mes).    in_virt
-00014780: 7561 6c5f 656e 7620 3d20 6861 7361 7474  ual_env = hasatt
-00014790: 7228 7379 732c 2022 7265 616c 5f70 7265  r(sys, "real_pre
-000147a0: 6669 7822 2920 2023 2068 7474 7073 3a2f  fix")  # https:/
-000147b0: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
-000147c0: 6f6d 2f71 7565 7374 696f 6e73 2f31 3837  om/questions/187
-000147d0: 3135 3439 2f0a 2020 2020 636d 6420 3d20  1549/.    cmd = 
-000147e0: 5b70 792c 2070 6970 5f70 6174 682c 2022  [py, pip_path, "
-000147f0: 696e 7374 616c 6c22 5d0a 2020 2020 6966  install"].    if
-00014800: 206e 6f74 2069 6e5f 7669 7274 7561 6c5f   not in_virtual_
-00014810: 656e 763a 0a20 2020 2020 2020 2063 6d64  env:.        cmd
-00014820: 202b 3d20 5b22 2d2d 7573 6572 225d 0a20   += ["--user"]. 
-00014830: 2020 2063 6d64 202b 3d20 6c69 7374 2870     cmd += list(p
-00014840: 6b67 5f6e 616d 6573 290a 2020 2020 7072  kg_names).    pr
-00014850: 696e 7428 2224 2025 7322 2025 2022 2022  int("$ %s" % " "
-00014860: 2e6a 6f69 6e28 636d 6429 290a 2020 2020  .join(cmd)).    
-00014870: 7375 6270 726f 6365 7373 2e63 6865 636b  subprocess.check
-00014880: 5f63 616c 6c28 636d 642c 2063 7764 3d22  _call(cmd, cwd="
-00014890: 2f22 290a 2020 2020 5f70 6970 5f69 6e73  /").    _pip_ins
-000148a0: 7461 6c6c 6564 5f70 6163 6b61 6765 732e  talled_packages.
-000148b0: 636c 6561 7228 2920 2023 2066 6f72 6365  clear()  # force
-000148c0: 2072 656c 6f61 640a 0a0a 5f70 6970 5f69   reload..._pip_i
-000148d0: 6e73 7461 6c6c 6564 5f70 6163 6b61 6765  nstalled_package
-000148e0: 7320 3d20 7365 7428 290a 0a0a 6465 6620  s = set()...def 
-000148f0: 7069 705f 6368 6563 6b5f 6973 5f69 6e73  pip_check_is_ins
-00014900: 7461 6c6c 6564 2870 6b67 5f6e 616d 6529  talled(pkg_name)
-00014910: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00014920: 6172 616d 2073 7472 2070 6b67 5f6e 616d  aram str pkg_nam
-00014930: 653a 2077 6974 686f 7574 2076 6572 7369  e: without versi
-00014940: 6f6e 2c20 652e 672e 206a 7573 7420 2274  on, e.g. just "t
-00014950: 656e 736f 7266 6c6f 7722 2c20 6f72 2077  ensorflow", or w
-00014960: 6974 6820 7665 7273 696f 6e2c 2065 2e67  ith version, e.g
-00014970: 2e20 2274 656e 736f 7266 6c6f 773d 3d31  . "tensorflow==1
-00014980: 2e32 2e33 220a 2020 2020 3a72 7479 7065  .2.3".    :rtype
-00014990: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
-000149a0: 2020 2069 6620 6e6f 7420 5f70 6970 5f69     if not _pip_i
-000149b0: 6e73 7461 6c6c 6564 5f70 6163 6b61 6765  nstalled_package
-000149c0: 733a 0a20 2020 2020 2020 2070 7920 3d20  s:.        py = 
-000149d0: 7379 732e 6578 6563 7574 6162 6c65 0a20  sys.executable. 
-000149e0: 2020 2020 2020 2070 6970 5f70 6174 6820         pip_path 
-000149f0: 3d20 7768 6963 685f 7069 7028 290a 2020  = which_pip().  
-00014a00: 2020 2020 2020 636d 6420 3d20 5b70 792c        cmd = [py,
-00014a10: 2070 6970 5f70 6174 682c 2022 6672 6565   pip_path, "free
-00014a20: 7a65 225d 0a20 2020 2020 2020 2066 6f72  ze"].        for
-00014a30: 206c 696e 6520 696e 2073 7973 5f65 7865   line in sys_exe
-00014a40: 635f 6f75 7428 2a63 6d64 292e 7370 6c69  c_out(*cmd).spli
-00014a50: 746c 696e 6573 2829 3a0a 2020 2020 2020  tlines():.      
-00014a60: 2020 2020 2020 6966 206c 696e 6520 616e        if line an
-00014a70: 6420 223d 3d22 2069 6e20 6c69 6e65 3a0a  d "==" in line:.
-00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a90: 6966 2022 3d3d 2220 6e6f 7420 696e 2070  if "==" not in p
-00014aa0: 6b67 5f6e 616d 653a 0a20 2020 2020 2020  kg_name:.       
-00014ab0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-00014ac0: 6520 3d20 6c69 6e65 5b3a 206c 696e 652e  e = line[: line.
-00014ad0: 696e 6465 7828 223d 3d22 295d 0a20 2020  index("==")].   
-00014ae0: 2020 2020 2020 2020 2020 2020 205f 7069               _pi
-00014af0: 705f 696e 7374 616c 6c65 645f 7061 636b  p_installed_pack
-00014b00: 6167 6573 2e61 6464 286c 696e 6529 0a20  ages.add(line). 
-00014b10: 2020 2072 6574 7572 6e20 706b 675f 6e61     return pkg_na
-00014b20: 6d65 2069 6e20 5f70 6970 5f69 6e73 7461  me in _pip_insta
-00014b30: 6c6c 6564 5f70 6163 6b61 6765 730a 0a0a  lled_packages...
-00014b40: 5f6f 7269 6769 6e61 6c5f 6578 6563 7620  _original_execv 
-00014b50: 3d20 4e6f 6e65 0a5f 6f72 6967 696e 616c  = None._original
-00014b60: 5f65 7865 6376 6520 3d20 4e6f 6e65 0a5f  _execve = None._
-00014b70: 6f72 6967 696e 616c 5f65 7865 6376 7065  original_execvpe
-00014b80: 203d 204e 6f6e 650a 0a0a 6465 6620 6f76   = None...def ov
-00014b90: 6572 7772 6974 655f 6f73 5f65 7865 6328  erwrite_os_exec(
-00014ba0: 7072 6566 6978 5f61 7267 7329 3a0a 2020  prefix_args):.  
-00014bb0: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
-00014bc0: 206c 6973 745b 7374 725d 2070 7265 6669   list[str] prefi
-00014bd0: 785f 6172 6773 3a0a 2020 2020 2222 220a  x_args:.    """.
-00014be0: 2020 2020 676c 6f62 616c 205f 6f72 6967      global _orig
-00014bf0: 696e 616c 5f65 7865 6376 2c20 5f6f 7269  inal_execv, _ori
-00014c00: 6769 6e61 6c5f 6578 6563 7665 2c20 5f6f  ginal_execve, _o
-00014c10: 7269 6769 6e61 6c5f 6578 6563 7670 650a  riginal_execvpe.
-00014c20: 2020 2020 6966 206e 6f74 205f 6f72 6967      if not _orig
-00014c30: 696e 616c 5f65 7865 6376 3a0a 2020 2020  inal_execv:.    
-00014c40: 2020 2020 5f6f 7269 6769 6e61 6c5f 6578      _original_ex
-00014c50: 6563 7620 3d20 6f73 2e65 7865 6376 0a20  ecv = os.execv. 
-00014c60: 2020 2069 6620 6e6f 7420 5f6f 7269 6769     if not _origi
-00014c70: 6e61 6c5f 6578 6563 7665 3a0a 2020 2020  nal_execve:.    
-00014c80: 2020 2020 5f6f 7269 6769 6e61 6c5f 6578      _original_ex
-00014c90: 6563 7665 203d 206f 732e 6578 6563 7665  ecve = os.execve
-00014ca0: 0a20 2020 2069 6620 6e6f 7420 5f6f 7269  .    if not _ori
-00014cb0: 6769 6e61 6c5f 6578 6563 7670 653a 0a20  ginal_execvpe:. 
-00014cc0: 2020 2020 2020 2023 206e 6f69 6e73 7065         # noinspe
-00014cd0: 6374 696f 6e20 5079 5072 6f74 6563 7465  ction PyProtecte
-00014ce0: 644d 656d 6265 722c 5079 556e 7265 736f  dMember,PyUnreso
-00014cf0: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
-00014d00: 2020 2020 2020 205f 6f72 6967 696e 616c         _original
-00014d10: 5f65 7865 6376 7065 203d 206f 732e 5f65  _execvpe = os._e
-00014d20: 7865 6376 7065 0a0a 2020 2020 2320 6e6f  xecvpe..    # no
-00014d30: 696e 7370 6563 7469 6f6e 2050 7955 6e75  inspection PyUnu
-00014d40: 7365 644c 6f63 616c 0a20 2020 2064 6566  sedLocal.    def
-00014d50: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
-00014d60: 2866 696c 652c 2061 7267 732c 2065 6e76  (file, args, env
-00014d70: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00014d80: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-00014d90: 616d 2066 696c 653a 0a20 2020 2020 2020  am file:.       
-00014da0: 203a 7061 7261 6d20 6c69 7374 5b73 7472   :param list[str
-00014db0: 5d7c 7475 706c 655b 7374 725d 2061 7267  ]|tuple[str] arg
-00014dc0: 733a 0a20 2020 2020 2020 203a 7061 7261  s:.        :para
-00014dd0: 6d20 6469 6374 5b73 7472 5d20 656e 763a  m dict[str] env:
-00014de0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014df0: 2020 2020 206e 6577 5f61 7267 7320 3d20       new_args = 
-00014e00: 7072 6566 6978 5f61 7267 7320 2b20 5b77  prefix_args + [w
-00014e10: 6869 6368 2861 7267 735b 305d 295d 202b  hich(args[0])] +
-00014e20: 2061 7267 735b 313a 5d0a 2020 2020 2020   args[1:].      
-00014e30: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-00014e40: 7465 2822 2420 2573 5c6e 2220 2520 2220  te("$ %s\n" % " 
-00014e50: 222e 6a6f 696e 286e 6577 5f61 7267 7329  ".join(new_args)
-00014e60: 290a 2020 2020 2020 2020 7379 732e 7374  ).        sys.st
-00014e70: 6465 7272 2e66 6c75 7368 2829 0a20 2020  derr.flush().   
-00014e80: 2020 2020 205f 6f72 6967 696e 616c 5f65       _original_e
-00014e90: 7865 6376 7065 2866 696c 653d 7072 6566  xecvpe(file=pref
-00014ea0: 6978 5f61 7267 735b 305d 2c20 6172 6773  ix_args[0], args
-00014eb0: 3d6e 6577 5f61 7267 732c 2065 6e76 3d65  =new_args, env=e
-00014ec0: 6e76 290a 0a20 2020 2064 6566 2065 7865  nv)..    def exe
-00014ed0: 6376 2870 6174 682c 2061 7267 7329 3a0a  cv(path, args):.
-00014ee0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014ef0: 2020 2020 3a70 6172 616d 2073 7472 2070      :param str p
-00014f00: 6174 683a 0a20 2020 2020 2020 203a 7061  ath:.        :pa
-00014f10: 7261 6d20 6c69 7374 5b73 7472 5d7c 7475  ram list[str]|tu
-00014f20: 706c 655b 7374 725d 2061 7267 733a 0a20  ple[str] args:. 
-00014f30: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00014f40: 2020 2069 6620 6172 6773 5b3a 206c 656e     if args[: len
-00014f50: 2870 7265 6669 785f 6172 6773 295d 203d  (prefix_args)] =
-00014f60: 3d20 7072 6566 6978 5f61 7267 733a 0a20  = prefix_args:. 
-00014f70: 2020 2020 2020 2020 2020 205f 6f72 6967             _orig
-00014f80: 696e 616c 5f65 7865 6376 2870 6174 682c  inal_execv(path,
-00014f90: 2061 7267 7329 0a20 2020 2020 2020 2065   args).        e
-00014fa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014fb0: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
-00014fc0: 2870 6174 682c 2061 7267 7329 0a0a 2020  (path, args)..  
-00014fd0: 2020 6465 6620 6578 6563 7665 2870 6174    def execve(pat
-00014fe0: 682c 2061 7267 732c 2065 6e76 293a 0a20  h, args, env):. 
-00014ff0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015000: 2020 203a 7061 7261 6d20 7374 7220 7061     :param str pa
-00015010: 7468 3a0a 2020 2020 2020 2020 3a70 6172  th:.        :par
-00015020: 616d 206c 6973 745b 7374 725d 7c74 7570  am list[str]|tup
-00015030: 6c65 5b73 7472 5d20 6172 6773 3a0a 2020  le[str] args:.  
-00015040: 2020 2020 2020 3a70 6172 616d 2064 6963        :param dic
-00015050: 745b 7374 725d 2065 6e76 3a0a 2020 2020  t[str] env:.    
-00015060: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015070: 6966 2061 7267 735b 3a20 6c65 6e28 7072  if args[: len(pr
-00015080: 6566 6978 5f61 7267 7329 5d20 3d3d 2070  efix_args)] == p
-00015090: 7265 6669 785f 6172 6773 3a0a 2020 2020  refix_args:.    
-000150a0: 2020 2020 2020 2020 5f6f 7269 6769 6e61          _origina
-000150b0: 6c5f 6578 6563 7665 2870 6174 682c 2061  l_execve(path, a
-000150c0: 7267 732c 2065 6e76 290a 2020 2020 2020  rgs, env).      
-000150d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000150e0: 2020 2020 7772 6170 7065 645f 6578 6563      wrapped_exec
-000150f0: 7670 6528 7061 7468 2c20 6172 6773 2c20  vpe(path, args, 
-00015100: 656e 7629 0a0a 2020 2020 6465 6620 6578  env)..    def ex
-00015110: 6563 6c28 6669 6c65 2c20 2a61 7267 7329  ecl(file, *args)
-00015120: 3a0a 2020 2020 2020 2020 2222 2265 7865  :.        """exe
-00015130: 636c 2866 696c 652c 202a 6172 6773 290a  cl(file, *args).
-00015140: 0a20 2020 2020 2020 2045 7865 6375 7465  .        Execute
-00015150: 2074 6865 2065 7865 6375 7461 626c 6520   the executable 
-00015160: 6669 6c65 2077 6974 6820 6172 6775 6d65  file with argume
-00015170: 6e74 206c 6973 7420 6172 6773 2c20 7265  nt list args, re
-00015180: 706c 6163 696e 6720 7468 650a 2020 2020  placing the.    
-00015190: 2020 2020 6375 7272 656e 7420 7072 6f63      current proc
-000151a0: 6573 732e 2222 220a 2020 2020 2020 2020  ess.""".        
-000151b0: 6f73 2e65 7865 6376 2866 696c 652c 2061  os.execv(file, a
-000151c0: 7267 7329 0a0a 2020 2020 6465 6620 6578  rgs)..    def ex
-000151d0: 6563 6c65 2866 696c 652c 202a 6172 6773  ecle(file, *args
-000151e0: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
-000151f0: 6563 6c65 2866 696c 652c 202a 6172 6773  ecle(file, *args
-00015200: 2c20 656e 7629 0a0a 2020 2020 2020 2020  , env)..        
-00015210: 4578 6563 7574 6520 7468 6520 6578 6563  Execute the exec
-00015220: 7574 6162 6c65 2066 696c 6520 7769 7468  utable file with
-00015230: 2061 7267 756d 656e 7420 6c69 7374 2061   argument list a
-00015240: 7267 7320 616e 640a 2020 2020 2020 2020  rgs and.        
-00015250: 656e 7669 726f 6e6d 656e 7420 656e 762c  environment env,
-00015260: 2072 6570 6c61 6369 6e67 2074 6865 2063   replacing the c
-00015270: 7572 7265 6e74 2070 726f 6365 7373 2e22  urrent process."
-00015280: 2222 0a20 2020 2020 2020 2065 6e76 203d  "".        env =
-00015290: 2061 7267 735b 2d31 5d0a 2020 2020 2020   args[-1].      
-000152a0: 2020 6f73 2e65 7865 6376 6528 6669 6c65    os.execve(file
-000152b0: 2c20 6172 6773 5b3a 2d31 5d2c 2065 6e76  , args[:-1], env
-000152c0: 290a 0a20 2020 2064 6566 2065 7865 636c  )..    def execl
-000152d0: 7028 6669 6c65 2c20 2a61 7267 7329 3a0a  p(file, *args):.
-000152e0: 2020 2020 2020 2020 2222 2265 7865 636c          """execl
-000152f0: 7028 6669 6c65 2c20 2a61 7267 7329 0a0a  p(file, *args)..
-00015300: 2020 2020 2020 2020 4578 6563 7574 6520          Execute 
-00015310: 7468 6520 6578 6563 7574 6162 6c65 2066  the executable f
-00015320: 696c 6520 2877 6869 6368 2069 7320 7365  ile (which is se
-00015330: 6172 6368 6564 2066 6f72 2061 6c6f 6e67  arched for along
-00015340: 2024 5041 5448 290a 2020 2020 2020 2020   $PATH).        
-00015350: 7769 7468 2061 7267 756d 656e 7420 6c69  with argument li
-00015360: 7374 2061 7267 732c 2072 6570 6c61 6369  st args, replaci
-00015370: 6e67 2074 6865 2063 7572 7265 6e74 2070  ng the current p
-00015380: 726f 6365 7373 2e22 2222 0a20 2020 2020  rocess.""".     
-00015390: 2020 206f 732e 6578 6563 7670 2866 696c     os.execvp(fil
-000153a0: 652c 2061 7267 7329 0a0a 2020 2020 6465  e, args)..    de
-000153b0: 6620 6578 6563 6c70 6528 6669 6c65 2c20  f execlpe(file, 
-000153c0: 2a61 7267 7329 3a0a 2020 2020 2020 2020  *args):.        
-000153d0: 2222 2265 7865 636c 7065 2866 696c 652c  """execlpe(file,
-000153e0: 202a 6172 6773 2c20 656e 7629 0a0a 2020   *args, env)..  
-000153f0: 2020 2020 2020 4578 6563 7574 6520 7468        Execute th
-00015400: 6520 6578 6563 7574 6162 6c65 2066 696c  e executable fil
-00015410: 6520 2877 6869 6368 2069 7320 7365 6172  e (which is sear
-00015420: 6368 6564 2066 6f72 2061 6c6f 6e67 2024  ched for along $
-00015430: 5041 5448 290a 2020 2020 2020 2020 7769  PATH).        wi
-00015440: 7468 2061 7267 756d 656e 7420 6c69 7374  th argument list
-00015450: 2061 7267 7320 616e 6420 656e 7669 726f   args and enviro
-00015460: 6e6d 656e 7420 656e 762c 2072 6570 6c61  nment env, repla
-00015470: 6369 6e67 2074 6865 2063 7572 7265 6e74  cing the current
-00015480: 0a20 2020 2020 2020 2070 726f 6365 7373  .        process
-00015490: 2e22 2222 0a20 2020 2020 2020 2065 6e76  .""".        env
-000154a0: 203d 2061 7267 735b 2d31 5d0a 2020 2020   = args[-1].    
-000154b0: 2020 2020 6f73 2e65 7865 6376 7065 2866      os.execvpe(f
-000154c0: 696c 652c 2061 7267 735b 3a2d 315d 2c20  ile, args[:-1], 
-000154d0: 656e 7629 0a0a 2020 2020 6465 6620 6578  env)..    def ex
-000154e0: 6563 7670 2866 696c 652c 2061 7267 7329  ecvp(file, args)
-000154f0: 3a0a 2020 2020 2020 2020 2222 2265 7865  :.        """exe
-00015500: 6376 7028 6669 6c65 2c20 6172 6773 290a  cvp(file, args).
-00015510: 0a20 2020 2020 2020 2045 7865 6375 7465  .        Execute
-00015520: 2074 6865 2065 7865 6375 7461 626c 6520   the executable 
-00015530: 6669 6c65 2028 7768 6963 6820 6973 2073  file (which is s
-00015540: 6561 7263 6865 6420 666f 7220 616c 6f6e  earched for alon
-00015550: 6720 2450 4154 4829 0a20 2020 2020 2020  g $PATH).       
-00015560: 2077 6974 6820 6172 6775 6d65 6e74 206c   with argument l
-00015570: 6973 7420 6172 6773 2c20 7265 706c 6163  ist args, replac
-00015580: 696e 6720 7468 6520 6375 7272 656e 7420  ing the current 
-00015590: 7072 6f63 6573 732e 0a20 2020 2020 2020  process..       
-000155a0: 2061 7267 7320 6d61 7920 6265 2061 206c   args may be a l
-000155b0: 6973 7420 6f72 2074 7570 6c65 206f 6620  ist or tuple of 
-000155c0: 7374 7269 6e67 732e 2222 220a 2020 2020  strings.""".    
-000155d0: 2020 2020 7772 6170 7065 645f 6578 6563      wrapped_exec
-000155e0: 7670 6528 6669 6c65 2c20 6172 6773 290a  vpe(file, args).
-000155f0: 0a20 2020 2064 6566 2065 7865 6376 7065  .    def execvpe
-00015600: 2866 696c 652c 2061 7267 732c 2065 6e76  (file, args, env
-00015610: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
-00015620: 6563 7670 6528 6669 6c65 2c20 6172 6773  ecvpe(file, args
-00015630: 2c20 656e 7629 0a0a 2020 2020 2020 2020  , env)..        
-00015640: 4578 6563 7574 6520 7468 6520 6578 6563  Execute the exec
-00015650: 7574 6162 6c65 2066 696c 6520 2877 6869  utable file (whi
-00015660: 6368 2069 7320 7365 6172 6368 6564 2066  ch is searched f
-00015670: 6f72 2061 6c6f 6e67 2024 5041 5448 290a  or along $PATH).
-00015680: 2020 2020 2020 2020 7769 7468 2061 7267          with arg
-00015690: 756d 656e 7420 6c69 7374 2061 7267 7320  ument list args 
-000156a0: 616e 6420 656e 7669 726f 6e6d 656e 7420  and environment 
-000156b0: 656e 7620 2c20 7265 706c 6163 696e 6720  env , replacing 
-000156c0: 7468 650a 2020 2020 2020 2020 6375 7272  the.        curr
-000156d0: 656e 7420 7072 6f63 6573 732e 0a20 2020  ent process..   
-000156e0: 2020 2020 2061 7267 7320 6d61 7920 6265       args may be
-000156f0: 2061 206c 6973 7420 6f72 2074 7570 6c65   a list or tuple
-00015700: 206f 6620 7374 7269 6e67 732e 2222 220a   of strings.""".
-00015710: 2020 2020 2020 2020 7772 6170 7065 645f          wrapped_
-00015720: 6578 6563 7670 6528 6669 6c65 2c20 6172  execvpe(file, ar
-00015730: 6773 2c20 656e 7629 0a0a 2020 2020 6f73  gs, env)..    os
-00015740: 2e65 7865 6376 203d 2065 7865 6376 0a20  .execv = execv. 
-00015750: 2020 206f 732e 6578 6563 7665 203d 2065     os.execve = e
-00015760: 7865 6376 650a 2020 2020 6f73 2e65 7865  xecve.    os.exe
-00015770: 636c 203d 2065 7865 636c 0a20 2020 206f  cl = execl.    o
-00015780: 732e 6578 6563 6c65 203d 2065 7865 636c  s.execle = execl
-00015790: 650a 2020 2020 6f73 2e65 7865 636c 7020  e.    os.execlp 
-000157a0: 3d20 6578 6563 6c70 0a20 2020 206f 732e  = execlp.    os.
-000157b0: 6578 6563 6c70 6520 3d20 6578 6563 6c70  execlpe = execlp
-000157c0: 650a 2020 2020 6f73 2e65 7865 6376 7020  e.    os.execvp 
-000157d0: 3d20 6578 6563 7670 0a20 2020 206f 732e  = execvp.    os.
-000157e0: 6578 6563 7670 6520 3d20 6578 6563 7670  execvpe = execvp
-000157f0: 650a 2020 2020 6f73 2e5f 6578 6563 7670  e.    os._execvp
-00015800: 6520 3d20 7772 6170 7065 645f 6578 6563  e = wrapped_exec
-00015810: 7670 650a 0a0a 6465 6620 6765 745f 6c73  vpe...def get_ls
-00015820: 625f 7265 6c65 6173 6528 293a 0a20 2020  b_release():.   
-00015830: 2022 2222 0a20 2020 203a 7265 7475 726e   """.    :return
-00015840: 3a20 6060 2f65 7463 2f6c 7362 2d72 656c  : ``/etc/lsb-rel
-00015850: 6561 7365 6060 2070 6172 7365 6420 6173  ease`` parsed as
-00015860: 2061 2064 6963 740a 2020 2020 3a72 7479   a dict.    :rty
-00015870: 7065 3a20 6469 6374 5b73 7472 2c73 7472  pe: dict[str,str
-00015880: 5d0a 2020 2020 2222 220a 2020 2020 6420  ].    """.    d 
-00015890: 3d20 7b7d 0a20 2020 2066 6f72 206c 696e  = {}.    for lin
-000158a0: 6520 696e 206f 7065 6e28 222f 6574 632f  e in open("/etc/
-000158b0: 6c73 622d 7265 6c65 6173 6522 292e 7265  lsb-release").re
-000158c0: 6164 2829 2e73 706c 6974 6c69 6e65 7328  ad().splitlines(
-000158d0: 293a 0a20 2020 2020 2020 206b 2c20 7620  ):.        k, v 
-000158e0: 3d20 6c69 6e65 2e73 706c 6974 2822 3d22  = line.split("="
-000158f0: 2c20 3129 0a20 2020 2020 2020 2069 6620  , 1).        if 
-00015900: 765b 305d 203d 3d20 765b 2d31 5d20 3d3d  v[0] == v[-1] ==
-00015910: 2027 2227 3a0a 2020 2020 2020 2020 2020   '"':.          
-00015920: 2020 7620 3d20 765b 313a 2d31 5d0a 2020    v = v[1:-1].  
-00015930: 2020 2020 2020 645b 6b5d 203d 2076 0a20        d[k] = v. 
-00015940: 2020 2072 6574 7572 6e20 640a 0a0a 6465     return d...de
-00015950: 6620 6765 745f 7562 756e 7475 5f6d 616a  f get_ubuntu_maj
-00015960: 6f72 5f76 6572 7369 6f6e 2829 3a0a 2020  or_version():.  
-00015970: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
-00015980: 3a20 696e 747c 4e6f 6e65 0a20 2020 2022  : int|None.    "
-00015990: 2222 0a20 2020 2064 203d 2067 6574 5f6c  "".    d = get_l
-000159a0: 7362 5f72 656c 6561 7365 2829 0a20 2020  sb_release().   
-000159b0: 2069 6620 645b 2244 4953 5452 4942 5f49   if d["DISTRIB_I
-000159c0: 4422 5d20 213d 2022 5562 756e 7475 223a  D"] != "Ubuntu":
-000159d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000159e0: 4e6f 6e65 0a20 2020 2072 6574 7572 6e20  None.    return 
-000159f0: 696e 7428 666c 6f61 7428 645b 2244 4953  int(float(d["DIS
-00015a00: 5452 4942 5f52 454c 4541 5345 225d 2929  TRIB_RELEASE"]))
-00015a10: 0a0a 0a64 6566 2061 7574 6f5f 7072 6566  ...def auto_pref
-00015a20: 6978 5f6f 735f 6578 6563 5f70 7265 6669  ix_os_exec_prefi
-00015a30: 785f 7562 756e 7475 2870 7265 6669 785f  x_ubuntu(prefix_
-00015a40: 6172 6773 2c20 7562 756e 7475 5f6d 696e  args, ubuntu_min
-00015a50: 5f76 6572 7369 6f6e 3d31 3629 3a0a 2020  _version=16):.  
-00015a60: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
-00015a70: 206c 6973 745b 7374 725d 2070 7265 6669   list[str] prefi
-00015a80: 785f 6172 6773 3a0a 2020 2020 3a70 6172  x_args:.    :par
-00015a90: 616d 2069 6e74 2075 6275 6e74 755f 6d69  am int ubuntu_mi
-00015aa0: 6e5f 7665 7273 696f 6e3a 0a0a 2020 2020  n_version:..    
-00015ab0: 4578 616d 706c 6520 7573 6167 653a 0a20  Example usage:. 
-00015ac0: 2020 2020 2061 7574 6f5f 7072 6566 6978       auto_prefix
-00015ad0: 5f6f 735f 6578 6563 5f70 7265 6669 785f  _os_exec_prefix_
-00015ae0: 7562 756e 7475 285b 222f 752f 7a65 7965  ubuntu(["/u/zeye
-00015af0: 722f 746f 6f6c 732f 676c 6962 6332 3137  r/tools/glibc217
-00015b00: 2f6c 642d 6c69 6e75 782d 7838 362d 3634  /ld-linux-x86-64
-00015b10: 2e73 6f2e 3222 5d29 0a20 2020 2022 2222  .so.2"]).    """
-00015b20: 0a20 2020 2075 6275 6e74 755f 7665 7273  .    ubuntu_vers
-00015b30: 696f 6e20 3d20 6765 745f 7562 756e 7475  ion = get_ubuntu
-00015b40: 5f6d 616a 6f72 5f76 6572 7369 6f6e 2829  _major_version()
-00015b50: 0a20 2020 2069 6620 7562 756e 7475 5f76  .    if ubuntu_v
-00015b60: 6572 7369 6f6e 2069 7320 4e6f 6e65 3a0a  ersion is None:.
-00015b70: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00015b80: 2020 2069 6620 7562 756e 7475 5f76 6572     if ubuntu_ver
-00015b90: 7369 6f6e 203e 3d20 7562 756e 7475 5f6d  sion >= ubuntu_m
-00015ba0: 696e 5f76 6572 7369 6f6e 3a0a 2020 2020  in_version:.    
-00015bb0: 2020 2020 7265 7475 726e 0a20 2020 2070      return.    p
-00015bc0: 7269 6e74 2822 596f 7520 6172 6520 7275  rint("You are ru
-00015bd0: 6e6e 696e 6720 5562 756e 7475 2025 692c  nning Ubuntu %i,
-00015be0: 2074 6875 7320 7765 2070 7265 6669 7820   thus we prefix 
-00015bf0: 616c 6c20 6f73 2e65 7865 6320 7769 7468  all os.exec with
-00015c00: 2025 732e 2220 2520 2875 6275 6e74 755f   %s." % (ubuntu_
-00015c10: 7665 7273 696f 6e2c 2070 7265 6669 785f  version, prefix_
-00015c20: 6172 6773 2929 0a20 2020 2061 7373 6572  args)).    asser
-00015c30: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00015c40: 2870 7265 6669 785f 6172 6773 5b30 5d29  (prefix_args[0])
-00015c50: 0a20 2020 206f 7665 7277 7269 7465 5f6f  .    overwrite_o
-00015c60: 735f 6578 6563 2870 7265 6669 785f 6172  s_exec(prefix_ar
-00015c70: 6773 3d70 7265 6669 785f 6172 6773 290a  gs=prefix_args).
-00015c80: 0a0a 6465 6620 636c 6561 6e75 705f 656e  ..def cleanup_en
-00015c90: 765f 7661 725f 7061 7468 2865 6e76 5f76  v_var_path(env_v
-00015ca0: 6172 2c20 7061 7468 5f70 7265 6669 7829  ar, path_prefix)
-00015cb0: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00015cc0: 6172 616d 2073 7472 2065 6e76 5f76 6172  aram str env_var
-00015cd0: 3a20 652e 672e 2022 4c44 5f4c 4942 5241  : e.g. "LD_LIBRA
-00015ce0: 5259 5f50 4154 4822 0a20 2020 203a 7061  RY_PATH".    :pa
-00015cf0: 7261 6d20 7374 7220 7061 7468 5f70 7265  ram str path_pre
-00015d00: 6669 783a 0a0a 2020 2020 5769 6c6c 2072  fix:..    Will r
-00015d10: 656d 6f76 6520 616c 6c20 7061 7468 7320  emove all paths 
-00015d20: 696e 206f 732e 656e 7669 726f 6e5b 656e  in os.environ[en
-00015d30: 765f 7661 725d 2077 6869 6368 2061 7265  v_var] which are
-00015d40: 2070 7265 6669 7865 6420 7769 7468 2070   prefixed with p
-00015d50: 6174 685f 7072 6566 6978 2e0a 2020 2020  ath_prefix..    
-00015d60: 2222 220a 2020 2020 6966 2065 6e76 5f76  """.    if env_v
-00015d70: 6172 206e 6f74 2069 6e20 6f73 2e65 6e76  ar not in os.env
-00015d80: 6972 6f6e 3a0a 2020 2020 2020 2020 7265  iron:.        re
-00015d90: 7475 726e 0a20 2020 2070 7320 3d20 6f73  turn.    ps = os
-00015da0: 2e65 6e76 6972 6f6e 5b65 6e76 5f76 6172  .environ[env_var
-00015db0: 5d2e 7370 6c69 7428 223a 2229 0a0a 2020  ].split(":")..  
-00015dc0: 2020 6465 6620 6628 7029 3a0a 2020 2020    def f(p):.    
-00015dd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015de0: 3a70 6172 616d 2073 7472 2070 3a0a 2020  :param str p:.  
-00015df0: 2020 2020 2020 3a72 7479 7065 3a20 626f        :rtype: bo
-00015e00: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
-00015e10: 2020 2020 2020 2069 6620 7020 3d3d 2070         if p == p
-00015e20: 6174 685f 7072 6566 6978 206f 7220 702e  ath_prefix or p.
-00015e30: 7374 6172 7473 7769 7468 2870 6174 685f  startswith(path_
-00015e40: 7072 6566 6978 202b 2022 2f22 293a 0a20  prefix + "/"):. 
-00015e50: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00015e60: 2822 5265 6d6f 7669 6e67 2025 7320 6672  ("Removing %s fr
-00015e70: 6f6d 2025 732e 2220 2520 2870 2c20 656e  om %s." % (p, en
-00015e80: 765f 7661 7229 290a 2020 2020 2020 2020  v_var)).        
-00015e90: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00015ea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00015eb0: 5472 7565 0a0a 2020 2020 7073 203d 2066  True..    ps = f
-00015ec0: 696c 7465 7228 662c 2070 7329 0a20 2020  ilter(f, ps).   
-00015ed0: 206f 732e 656e 7669 726f 6e5b 656e 765f   os.environ[env_
-00015ee0: 7661 725d 203d 2022 3a22 2e6a 6f69 6e28  var] = ":".join(
-00015ef0: 7073 290a 0a0a 6465 6620 6765 745f 6c6f  ps)...def get_lo
-00015f00: 6769 6e5f 7573 6572 6e61 6d65 2829 3a0a  gin_username():.
-00015f10: 2020 2020 2222 220a 2020 2020 3a72 7479      """.    :rty
-00015f20: 7065 3a20 7374 720a 2020 2020 3a72 6574  pe: str.    :ret
-00015f30: 7572 6e3a 2074 6865 2075 7365 726e 616d  urn: the usernam
-00015f40: 6520 6f66 2074 6865 2063 7572 7265 6e74  e of the current
-00015f50: 2075 7365 722e 0a20 2020 2055 7365 2074   user..    Use t
-00015f60: 6869 7320 6173 2061 2072 6570 6c61 6365  his as a replace
-00015f70: 6d65 6e74 2066 6f72 206f 732e 6765 746c  ment for os.getl
-00015f80: 6f67 696e 2829 2e0a 2020 2020 2222 220a  ogin()..    """.
-00015f90: 2020 2020 696d 706f 7274 206f 730a 0a20      import os.. 
-00015fa0: 2020 2069 6620 7379 732e 706c 6174 666f     if sys.platfo
-00015fb0: 726d 203d 3d20 2277 696e 3332 223a 0a20  rm == "win32":. 
-00015fc0: 2020 2020 2020 2072 6574 7572 6e20 6f73         return os
-00015fd0: 2e67 6574 6c6f 6769 6e28 290a 2020 2020  .getlogin().    
-00015fe0: 696d 706f 7274 2070 7764 0a0a 2020 2020  import pwd..    
-00015ff0: 7472 793a 0a20 2020 2020 2020 2072 6574  try:.        ret
-00016000: 7572 6e20 7077 642e 6765 7470 7775 6964  urn pwd.getpwuid
-00016010: 286f 732e 6765 7475 6964 2829 295b 305d  (os.getuid())[0]
-00016020: 0a20 2020 2065 7863 6570 7420 4b65 7945  .    except KeyE
-00016030: 7272 6f72 3a0a 2020 2020 2020 2020 2320  rror:.        # 
-00016040: 7077 642e 6765 7470 7775 6964 2829 2063  pwd.getpwuid() c
-00016050: 616e 2074 6872 6f77 204b 6579 4572 726f  an throw KeyErro
-00016060: 723a 2027 6765 7470 7775 6964 2829 3a20  r: 'getpwuid(): 
-00016070: 7569 6420 6e6f 7420 666f 756e 643a 2031  uid not found: 1
-00016080: 3233 3435 270a 2020 2020 2020 2020 2320  2345'.        # 
-00016090: 7468 6973 2063 616e 2068 6170 7065 6e20  this can happen 
-000160a0: 652e 672e 2069 6e20 6120 646f 636b 6572  e.g. in a docker
-000160b0: 2065 6e76 6972 6f6e 6d65 6e74 2077 6974   environment wit
-000160c0: 6820 6d61 7070 6564 2075 6964 7320 756e  h mapped uids un
-000160d0: 6b6e 6f77 6e20 746f 2074 6865 2064 6f63  known to the doc
-000160e0: 6b65 7220 4f53 0a20 2020 2020 2020 2072  ker OS.        r
-000160f0: 6574 7572 6e20 7374 7228 6f73 2e67 6574  eturn str(os.get
-00016100: 7569 6428 2929 0a0a 0a64 6566 2067 6574  uid())...def get
-00016110: 5f74 656d 705f 6469 7228 293a 0a20 2020  _temp_dir():.   
-00016120: 2022 2222 0a20 2020 203a 7274 7970 653a   """.    :rtype:
-00016130: 2073 7472 0a20 2020 203a 7265 7475 726e   str.    :return
-00016140: 3a20 652e 672e 2022 2f74 6d70 2f24 5553  : e.g. "/tmp/$US
-00016150: 4552 4e41 4d45 220a 2020 2020 2222 220a  ERNAME".    """.
-00016160: 2020 2020 7573 6572 6e61 6d65 203d 2067      username = g
-00016170: 6574 5f6c 6f67 696e 5f75 7365 726e 616d  et_login_usernam
-00016180: 6528 290a 2020 2020 666f 7220 656e 766e  e().    for envn
-00016190: 616d 6520 696e 205b 2254 4d50 4449 5222  ame in ["TMPDIR"
-000161a0: 2c20 2254 454d 5022 2c20 2254 4d50 225d  , "TEMP", "TMP"]
-000161b0: 3a0a 2020 2020 2020 2020 6469 726e 616d  :.        dirnam
-000161c0: 6520 3d20 6f73 2e67 6574 656e 7628 656e  e = os.getenv(en
-000161d0: 766e 616d 6529 0a20 2020 2020 2020 2069  vname).        i
-000161e0: 6620 6469 726e 616d 653a 0a20 2020 2020  f dirname:.     
-000161f0: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
-00016200: 732f 2573 2220 2520 2864 6972 6e61 6d65  s/%s" % (dirname
-00016210: 2c20 7573 6572 6e61 6d65 290a 2020 2020  , username).    
-00016220: 2320 2f76 6172 2f74 6d70 2073 686f 756c  # /var/tmp shoul
-00016230: 6420 6265 206d 6f72 6520 7065 7273 6973  d be more persis
-00016240: 7465 6e74 2074 6861 6e20 2f74 6d70 2075  tent than /tmp u
-00016250: 7375 616c 6c79 2e0a 2020 2020 6966 206f  sually..    if o
-00016260: 732e 7061 7468 2e65 7869 7374 7328 222f  s.path.exists("/
-00016270: 7661 722f 746d 7022 293a 0a20 2020 2020  var/tmp"):.     
-00016280: 2020 2072 6574 7572 6e20 222f 7661 722f     return "/var/
-00016290: 746d 702f 2573 2220 2520 7573 6572 6e61  tmp/%s" % userna
-000162a0: 6d65 0a20 2020 2072 6574 7572 6e20 222f  me.    return "/
-000162b0: 746d 702f 2573 2220 2520 7573 6572 6e61  tmp/%s" % userna
-000162c0: 6d65 0a0a 0a64 6566 2067 6574 5f63 6163  me...def get_cac
-000162d0: 6865 5f64 6972 2829 3a0a 2020 2020 2222  he_dir():.    ""
-000162e0: 220a 2020 2020 3a72 6574 7572 6e3a 2075  ".    :return: u
-000162f0: 7365 6420 746f 2063 6163 6865 206e 6f6e  sed to cache non
-00016300: 2d63 7269 7469 6361 6c20 7468 696e 6773  -critical things
-00016310: 2e20 6279 2064 6566 6175 6c74 2067 6574  . by default get
-00016320: 5f74 656d 705f 6469 722e 2075 6e6c 6573  _temp_dir. unles
-00016330: 7320 796f 7520 6465 6669 6e65 2065 6e76  s you define env
-00016340: 2052 4554 5552 4e4e 5f43 4143 4845 5f44   RETURNN_CACHE_D
-00016350: 4952 0a20 2020 203a 7274 7970 653a 2073  IR.    :rtype: s
-00016360: 7472 0a20 2020 2022 2222 0a20 2020 2069  tr.    """.    i
-00016370: 6620 2252 4554 5552 4e4e 5f43 4143 4845  f "RETURNN_CACHE
-00016380: 5f44 4952 2220 696e 206f 732e 656e 7669  _DIR" in os.envi
-00016390: 726f 6e3a 0a20 2020 2020 2020 2072 6574  ron:.        ret
-000163a0: 7572 6e20 6f73 2e65 6e76 6972 6f6e 5b22  urn os.environ["
-000163b0: 5245 5455 524e 4e5f 4341 4348 455f 4449  RETURNN_CACHE_DI
-000163c0: 5222 5d0a 2020 2020 7265 7475 726e 2067  R"].    return g
-000163d0: 6574 5f74 656d 705f 6469 7228 290a 0a0a  et_temp_dir()...
-000163e0: 636c 6173 7320 4c6f 636b 4669 6c65 286f  class LockFile(o
-000163f0: 626a 6563 7429 3a0a 2020 2020 2222 220a  bject):.    """.
-00016400: 2020 2020 5369 6d70 6c65 206c 6f63 6b20      Simple lock 
-00016410: 6669 6c65 2e0a 2020 2020 2222 220a 0a20  file..    """.. 
-00016420: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00016430: 7365 6c66 2c20 6469 7265 6374 6f72 792c  self, directory,
-00016440: 206e 616d 653d 226c 6f63 6b5f 6669 6c65   name="lock_file
-00016450: 222c 206c 6f63 6b5f 7469 6d65 6f75 743d  ", lock_timeout=
-00016460: 3120 2a20 3630 202a 2036 3029 3a0a 2020  1 * 60 * 60):.  
-00016470: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016480: 2020 3a70 6172 616d 2073 7472 2064 6972    :param str dir
-00016490: 6563 746f 7279 3a0a 2020 2020 2020 2020  ectory:.        
-000164a0: 3a70 6172 616d 2069 6e74 7c66 6c6f 6174  :param int|float
-000164b0: 206c 6f63 6b5f 7469 6d65 6f75 743a 2069   lock_timeout: i
-000164c0: 6e20 7365 636f 6e64 730a 2020 2020 2020  n seconds.      
-000164d0: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-000164e0: 6c66 2e64 6972 6563 746f 7279 203d 2064  lf.directory = d
-000164f0: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
-00016500: 2073 656c 662e 6e61 6d65 203d 206e 616d   self.name = nam
-00016510: 650a 2020 2020 2020 2020 7365 6c66 2e66  e.        self.f
-00016520: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
-00016530: 2073 656c 662e 6c6f 636b 5f74 696d 656f   self.lock_timeo
-00016540: 7574 203d 206c 6f63 6b5f 7469 6d65 6f75  ut = lock_timeou
-00016550: 740a 2020 2020 2020 2020 7365 6c66 2e6c  t.        self.l
-00016560: 6f63 6b66 696c 6520 3d20 2225 732f 2573  ockfile = "%s/%s
-00016570: 2220 2520 2864 6972 6563 746f 7279 2c20  " % (directory, 
-00016580: 6e61 6d65 290a 0a20 2020 2064 6566 2069  name)..    def i
-00016590: 735f 6f6c 645f 6c6f 636b 6669 6c65 2873  s_old_lockfile(s
-000165a0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-000165b0: 220a 2020 2020 2020 2020 3a72 6574 7572  ".        :retur
-000165c0: 6e3a 2057 6865 7468 6572 2074 6865 7265  n: Whether there
-000165d0: 2069 7320 616e 2065 7869 7374 696e 6720   is an existing 
-000165e0: 6c6f 636b 2066 696c 6520 616e 6420 7468  lock file and th
-000165f0: 6520 6578 6973 7469 6e67 206c 6f63 6b20  e existing lock 
-00016600: 6669 6c65 2069 7320 6f6c 642e 0a20 2020  file is old..   
-00016610: 2020 2020 203a 7274 7970 653a 2062 6f6f       :rtype: boo
-00016620: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-00016630: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00016640: 2020 2020 2020 206d 7469 6d65 203d 206f         mtime = o
-00016650: 732e 7061 7468 2e67 6574 6d74 696d 6528  s.path.getmtime(
-00016660: 7365 6c66 2e6c 6f63 6b66 696c 6529 0a20  self.lockfile). 
-00016670: 2020 2020 2020 2065 7863 6570 7420 4f53         except OS
-00016680: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00016690: 2020 206d 7469 6d65 203d 204e 6f6e 650a     mtime = None.
-000166a0: 2020 2020 2020 2020 6966 206d 7469 6d65          if mtime
-000166b0: 2061 6e64 2028 6162 7328 7469 6d65 2e74   and (abs(time.t
-000166c0: 696d 6528 2920 2d20 6d74 696d 6529 203e  ime() - mtime) >
-000166d0: 2073 656c 662e 6c6f 636b 5f74 696d 656f   self.lock_timeo
-000166e0: 7574 293a 0a20 2020 2020 2020 2020 2020  ut):.           
-000166f0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-00016700: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00016710: 650a 0a20 2020 2064 6566 206d 6179 6265  e..    def maybe
-00016720: 5f72 656d 6f76 655f 6f6c 645f 6c6f 636b  _remove_old_lock
-00016730: 6669 6c65 2873 656c 6629 3a0a 2020 2020  file(self):.    
-00016740: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00016750: 5265 6d6f 7665 7320 616e 2065 7869 7374  Removes an exist
-00016760: 696e 6720 6f6c 6420 6c6f 636b 6669 6c65  ing old lockfile
-00016770: 2c20 6966 2074 6865 7265 2069 7320 6f6e  , if there is on
-00016780: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00016790: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-000167a0: 6c66 2e69 735f 6f6c 645f 6c6f 636b 6669  lf.is_old_lockfi
-000167b0: 6c65 2829 3a0a 2020 2020 2020 2020 2020  le():.          
-000167c0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-000167d0: 2070 7269 6e74 2822 5265 6d6f 7669 6e67   print("Removing
-000167e0: 206f 6c64 206c 6f63 6b66 696c 6520 2572   old lockfile %r
-000167f0: 2028 7072 6f62 6162 6c79 2063 7261 7368   (probably crash
-00016800: 6564 2070 726f 6329 2e22 2025 2073 656c  ed proc)." % sel
-00016810: 662e 6c6f 636b 6669 6c65 290a 2020 2020  f.lockfile).    
-00016820: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00016830: 2020 2020 206f 732e 7265 6d6f 7665 2873       os.remove(s
-00016840: 656c 662e 6c6f 636b 6669 6c65 290a 2020  elf.lockfile).  
-00016850: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
-00016860: 7272 6f72 2061 7320 6578 633a 0a20 2020  rror as exc:.   
-00016870: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00016880: 5265 6d6f 7665 206c 6f63 6b66 696c 6520  Remove lockfile 
-00016890: 6578 6365 7074 696f 6e20 2572 2e20 4967  exception %r. Ig
-000168a0: 6e6f 7269 6e67 2069 742e 2220 2520 6578  noring it." % ex
-000168b0: 6329 0a0a 2020 2020 6465 6620 6973 5f6c  c)..    def is_l
-000168c0: 6f63 6b65 6428 7365 6c66 293a 0a20 2020  ocked(self):.   
-000168d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000168e0: 203a 7265 7475 726e 3a20 7768 6574 6865   :return: whethe
-000168f0: 7220 7468 6572 6520 6973 2061 6e20 6163  r there is an ac
-00016900: 7469 7665 2028 6e6f 7420 6f6c 6429 206c  tive (not old) l
-00016910: 6f63 6b66 696c 650a 2020 2020 2020 2020  ockfile.        
-00016920: 3a72 7479 7065 3a20 626f 6f6c 0a20 2020  :rtype: bool.   
-00016930: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016940: 2069 6620 7365 6c66 2e69 735f 6f6c 645f   if self.is_old_
-00016950: 6c6f 636b 6669 6c65 2829 3a0a 2020 2020  lockfile():.    
-00016960: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00016970: 616c 7365 0a20 2020 2020 2020 2074 7279  alse.        try
-00016980: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00016990: 7475 726e 206f 732e 7061 7468 2e65 7869  turn os.path.exi
-000169a0: 7374 7328 7365 6c66 2e6c 6f63 6b66 696c  sts(self.lockfil
-000169b0: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
-000169c0: 7420 4f53 4572 726f 723a 0a20 2020 2020  t OSError:.     
-000169d0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000169e0: 6c73 650a 0a20 2020 2064 6566 206c 6f63  lse..    def loc
-000169f0: 6b28 7365 6c66 293a 0a20 2020 2020 2020  k(self):.       
-00016a00: 2022 2222 0a20 2020 2020 2020 2041 6371   """.        Acq
-00016a10: 7569 7265 7320 7468 6520 6c6f 636b 2e0a  uires the lock..
-00016a20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016a30: 2020 2020 696d 706f 7274 2074 696d 650a      import time.
-00016a40: 2020 2020 2020 2020 696d 706f 7274 2065          import e
-00016a50: 7272 6e6f 0a0a 2020 2020 2020 2020 7761  rrno..        wa
-00016a60: 6974 5f63 6f75 6e74 203d 2030 0a20 2020  it_count = 0.   
-00016a70: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-00016a80: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00016a90: 7279 2074 6f20 6372 6561 7465 2064 6972  ry to create dir
-00016aa0: 6563 746f 7279 2069 6620 6974 2064 6f65  ectory if it doe
-00016ab0: 7320 6e6f 7420 6578 6973 742e 0a20 2020  s not exist..   
-00016ac0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00016ae0: 2e6d 616b 6564 6972 7328 7365 6c66 2e64  .makedirs(self.d
-00016af0: 6972 6563 746f 7279 290a 2020 2020 2020  irectory).      
-00016b00: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
-00016b10: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00016b20: 2020 2020 2020 7061 7373 2020 2320 4967        pass  # Ig
-00016b30: 6e6f 7265 2061 6e79 2065 7272 6f72 732e  nore any errors.
-00016b40: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
-00016b50: 6f77 2074 7279 2074 6f20 6372 6561 7465  ow try to create
-00016b60: 2074 6865 206c 6f63 6b2e 0a20 2020 2020   the lock..     
-00016b70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00016b80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016b90: 2e66 6420 3d20 6f73 2e6f 7065 6e28 7365  .fd = os.open(se
-00016ba0: 6c66 2e6c 6f63 6b66 696c 652c 206f 732e  lf.lockfile, os.
-00016bb0: 4f5f 4352 4541 5420 7c20 6f73 2e4f 5f45  O_CREAT | os.O_E
-00016bc0: 5843 4c20 7c20 6f73 2e4f 5f52 4457 5229  XCL | os.O_RDWR)
-00016bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016be0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00016bf0: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
-00016c00: 6f72 2061 7320 6578 633a 0a20 2020 2020  or as exc:.     
-00016c10: 2020 2020 2020 2020 2020 2023 2050 6f73             # Pos
-00016c20: 7369 626c 6520 6572 726f 7273 3a0a 2020  sible errors:.  
-00016c30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00016c40: 454e 4f45 4e54 2028 4e6f 2073 7563 6820  ENOENT (No such 
-00016c50: 6669 6c65 206f 7220 6469 7265 6374 6f72  file or director
-00016c60: 7929 2c20 652e 672e 2069 6620 7468 6520  y), e.g. if the 
-00016c70: 6469 7265 6374 6f72 7920 7761 7320 6465  directory was de
-00016c80: 6c65 7465 642e 0a20 2020 2020 2020 2020  leted..         
-00016c90: 2020 2020 2020 2023 2045 4558 4953 5420         # EEXIST 
-00016ca0: 2846 696c 6520 6578 6973 7473 292c 2069  (File exists), i
-00016cb0: 6620 7468 6520 6c6f 636b 2061 6c72 6561  f the lock alrea
-00016cc0: 6479 2065 7869 7374 732e 0a20 2020 2020  dy exists..     
-00016cd0: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
-00016ce0: 632e 6572 726e 6f20 6e6f 7420 696e 205b  c.errno not in [
-00016cf0: 6572 726e 6f2e 454e 4f45 4e54 2c20 6572  errno.ENOENT, er
-00016d00: 726e 6f2e 4545 5849 5354 5d3a 0a20 2020  rno.EEXIST]:.   
-00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d20: 2072 6169 7365 2020 2320 4f74 6865 7220   raise  # Other 
-00016d30: 6572 726f 722c 2073 6f20 7265 7261 6973  error, so rerais
-00016d40: 652e 0a20 2020 2020 2020 2020 2020 2023  e..            #
-00016d50: 2057 6520 6469 6420 6e6f 7420 6765 7420   We did not get 
-00016d60: 7468 6520 6c6f 636b 2e0a 2020 2020 2020  the lock..      
-00016d70: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-00016d80: 2069 7420 6973 2061 2072 6561 6c6c 7920   it is a really 
-00016d90: 6f6c 6420 6f6e 652e 0a20 2020 2020 2020  old one..       
-00016da0: 2020 2020 2073 656c 662e 6d61 7962 655f       self.maybe_
-00016db0: 7265 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66  remove_old_lockf
-00016dc0: 696c 6528 290a 2020 2020 2020 2020 2020  ile().          
-00016dd0: 2020 2320 5761 6974 2061 2062 6974 2c20    # Wait a bit, 
-00016de0: 616e 6420 7468 656e 2072 6574 7279 2e0a  and then retry..
-00016df0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-00016e00: 2e73 6c65 6570 2831 290a 2020 2020 2020  .sleep(1).      
-00016e10: 2020 2020 2020 7761 6974 5f63 6f75 6e74        wait_count
-00016e20: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00016e30: 2020 6966 2077 6169 745f 636f 756e 7420    if wait_count 
-00016e40: 3d3d 2031 303a 0a20 2020 2020 2020 2020  == 10:.         
-00016e50: 2020 2020 2020 2070 7269 6e74 2822 5761         print("Wa
-00016e60: 6974 696e 6720 666f 7220 6c6f 636b 2d66  iting for lock-f
-00016e70: 696c 653a 2025 7322 2025 2073 656c 662e  ile: %s" % self.
-00016e80: 6c6f 636b 6669 6c65 290a 0a20 2020 2064  lockfile)..    d
-00016e90: 6566 2075 6e6c 6f63 6b28 7365 6c66 293a  ef unlock(self):
-00016ea0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016eb0: 2020 2020 2052 656c 6561 7365 7320 7468       Releases th
-00016ec0: 6520 6c6f 636b 2e0a 2020 2020 2020 2020  e lock..        
-00016ed0: 2222 220a 2020 2020 2020 2020 6f73 2e63  """.        os.c
-00016ee0: 6c6f 7365 2873 656c 662e 6664 290a 2020  lose(self.fd).  
-00016ef0: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
-00016f00: 7365 6c66 2e6c 6f63 6b66 696c 6529 0a0a  self.lockfile)..
-00016f10: 2020 2020 6465 6620 5f5f 656e 7465 725f      def __enter_
-00016f20: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00016f30: 2073 656c 662e 6c6f 636b 2829 0a0a 2020   self.lock()..  
-00016f40: 2020 6465 6620 5f5f 6578 6974 5f5f 2873    def __exit__(s
-00016f50: 656c 662c 2065 7863 5f74 7970 652c 2065  elf, exc_type, e
-00016f60: 7863 5f76 616c 2c20 6578 635f 7462 293a  xc_val, exc_tb):
-00016f70: 0a20 2020 2020 2020 2073 656c 662e 756e  .        self.un
-00016f80: 6c6f 636b 2829 0a0a 0a64 6566 2073 7472  lock()...def str
-00016f90: 5f69 735f 6e75 6d62 6572 2873 293a 0a20  _is_number(s):. 
-00016fa0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00016fb0: 6d20 7374 7220 733a 2065 2e67 2e20 2231  m str s: e.g. "1
-00016fc0: 222c 2022 2e33 2220 6f72 2022 7822 0a20  ", ".3" or "x". 
-00016fd0: 2020 203a 7265 7475 726e 3a20 7768 6574     :return: whet
-00016fe0: 6865 7220 7320 6361 6e20 6265 2063 6173  her s can be cas
-00016ff0: 7465 6420 746f 2066 6c6f 6174 206f 7220  ted to float or 
-00017000: 696e 740a 2020 2020 3a72 7479 7065 3a20  int.    :rtype: 
-00017010: 626f 6f6c 0a20 2020 2022 2222 0a20 2020  bool.    """.   
-00017020: 2074 7279 3a0a 2020 2020 2020 2020 666c   try:.        fl
-00017030: 6f61 7428 7329 0a20 2020 2020 2020 2072  oat(s).        r
-00017040: 6574 7572 6e20 5472 7565 0a20 2020 2065  eturn True.    e
-00017050: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-00017060: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00017070: 2046 616c 7365 0a0a 0a64 6566 2073 6f72   False...def sor
-00017080: 7465 645f 7661 6c75 6573 5f66 726f 6d5f  ted_values_from_
-00017090: 6469 6374 2864 293a 0a20 2020 2022 2222  dict(d):.    """
-000170a0: 0a20 2020 203a 7061 7261 6d20 6469 6374  .    :param dict
-000170b0: 5b54 2c56 5d20 643a 0a20 2020 203a 7274  [T,V] d:.    :rt
-000170c0: 7970 653a 206c 6973 745b 565d 0a20 2020  ype: list[V].   
-000170d0: 2022 2222 0a20 2020 2061 7373 6572 7420   """.    assert 
-000170e0: 6973 696e 7374 616e 6365 2864 2c20 6469  isinstance(d, di
-000170f0: 6374 290a 2020 2020 7265 7475 726e 205b  ct).    return [
-00017100: 7620 666f 7220 286b 2c20 7629 2069 6e20  v for (k, v) in 
-00017110: 736f 7274 6564 2864 2e69 7465 6d73 2829  sorted(d.items()
-00017120: 295d 0a0a 0a64 6566 2064 6963 745f 7a69  )]...def dict_zi
-00017130: 7028 6b65 7973 2c20 7661 6c75 6573 293a  p(keys, values):
-00017140: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-00017150: 7261 6d20 6c69 7374 5b54 5d20 6b65 7973  ram list[T] keys
-00017160: 3a0a 2020 2020 3a70 6172 616d 206c 6973  :.    :param lis
-00017170: 745b 565d 2076 616c 7565 733a 0a20 2020  t[V] values:.   
-00017180: 203a 7274 7970 653a 2064 6963 745b 542c   :rtype: dict[T,
-00017190: 565d 0a20 2020 2022 2222 0a20 2020 2061  V].    """.    a
-000171a0: 7373 6572 7420 6c65 6e28 6b65 7973 2920  ssert len(keys) 
-000171b0: 3d3d 206c 656e 2876 616c 7565 7329 0a20  == len(values). 
-000171c0: 2020 2072 6574 7572 6e20 6469 6374 287a     return dict(z
-000171d0: 6970 286b 6579 732c 2076 616c 7565 7329  ip(keys, values)
-000171e0: 290a 0a0a 6465 6620 7061 7273 655f 6c64  )...def parse_ld
-000171f0: 5f63 6f6e 665f 6669 6c65 2866 6e29 3a0a  _conf_file(fn):.
-00017200: 2020 2020 2222 220a 2020 2020 5669 6120      """.    Via 
-00017210: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00017220: 6f6d 2f61 6c62 6572 747a 2f73 7973 7465  om/albertz/syste
-00017230: 6d2d 746f 6f6c 732f 626c 6f62 2f6d 6173  m-tools/blob/mas
-00017240: 7465 722f 6269 6e2f 6669 6e64 2d6c 6962  ter/bin/find-lib
-00017250: 2d69 6e2d 7061 7468 2e70 792e 0a0a 2020  -in-path.py...  
-00017260: 2020 3a70 6172 616d 2073 7472 2066 6e3a    :param str fn:
-00017270: 2065 2e67 2e20 222f 6574 632f 6c64 2e73   e.g. "/etc/ld.s
-00017280: 6f2e 636f 6e66 220a 2020 2020 3a72 6574  o.conf".    :ret
-00017290: 7572 6e3a 206c 6973 7420 6f66 2070 6174  urn: list of pat
-000172a0: 6873 2066 6f72 206c 6962 730a 2020 2020  hs for libs.    
-000172b0: 3a72 7479 7065 3a20 6c69 7374 5b73 7472  :rtype: list[str
-000172c0: 5d0a 2020 2020 2222 220a 2020 2020 6672  ].    """.    fr
-000172d0: 6f6d 2067 6c6f 6220 696d 706f 7274 2067  om glob import g
-000172e0: 6c6f 620a 0a20 2020 2070 6174 6873 203d  lob..    paths =
-000172f0: 205b 5d0a 2020 2020 666f 7220 6c69 6e65   [].    for line
-00017300: 2069 6e20 6f70 656e 2866 6e29 2e72 6561   in open(fn).rea
-00017310: 6428 292e 7370 6c69 746c 696e 6573 2829  d().splitlines()
-00017320: 3a0a 2020 2020 2020 2020 6c69 6e65 203d  :.        line =
-00017330: 206c 696e 652e 7374 7269 7028 290a 2020   line.strip().  
-00017340: 2020 2020 2020 6966 206e 6f74 206c 696e        if not lin
-00017350: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-00017360: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00017370: 6966 206c 696e 652e 7374 6172 7473 7769  if line.startswi
-00017380: 7468 2822 2322 293a 0a20 2020 2020 2020  th("#"):.       
-00017390: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-000173a0: 2020 2020 2020 6966 206c 696e 652e 7374        if line.st
-000173b0: 6172 7473 7769 7468 2822 696e 636c 7564  artswith("includ
-000173c0: 6520 2229 3a0a 2020 2020 2020 2020 2020  e "):.          
-000173d0: 2020 666f 7220 7375 625f 666e 2069 6e20    for sub_fn in 
-000173e0: 676c 6f62 286c 696e 655b 6c65 6e28 2269  glob(line[len("i
-000173f0: 6e63 6c75 6465 2022 2920 3a5d 293a 0a20  nclude ") :]):. 
-00017400: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00017410: 6174 6873 2e65 7874 656e 6428 7061 7273  aths.extend(pars
-00017420: 655f 6c64 5f63 6f6e 665f 6669 6c65 2873  e_ld_conf_file(s
-00017430: 7562 5f66 6e29 290a 2020 2020 2020 2020  ub_fn)).        
-00017440: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00017450: 2020 2020 2070 6174 6873 2e61 7070 656e       paths.appen
-00017460: 6428 6c69 6e65 290a 2020 2020 7265 7475  d(line).    retu
-00017470: 726e 2070 6174 6873 0a0a 0a64 6566 2067  rn paths...def g
-00017480: 6574 5f6c 645f 7061 7468 7328 293a 0a20  et_ld_paths():. 
-00017490: 2020 2022 2222 0a20 2020 2054 6f20 6265     """.    To be
-000174a0: 2076 6572 7920 636f 7272 6563 742c 2073   very correct, s
-000174b0: 6565 206d 616e 2d70 6167 6520 6f66 206c  ee man-page of l
-000174c0: 642e 736f 2e0a 2020 2020 416e 6420 6865  d.so..    And he
-000174d0: 7265 3a20 6874 7470 733a 2f2f 756e 6978  re: https://unix
-000174e0: 2e73 7461 636b 6578 6368 616e 6765 2e63  .stackexchange.c
-000174f0: 6f6d 2f71 7565 7374 696f 6e73 2f33 3534  om/questions/354
-00017500: 3239 352f 7768 6174 2d69 732d 7468 652d  295/what-is-the-
-00017510: 6465 6661 756c 742d 7661 6c75 652d 6f66  default-value-of
-00017520: 2d6c 642d 6c69 6272 6172 792d 7061 7468  -ld-library-path
-00017530: 2f33 3534 3239 360a 2020 2020 5368 6f72  /354296.    Shor
-00017540: 7420 7665 7273 696f 6e2c 206e 6f74 2073  t version, not s
-00017550: 7065 6369 6669 6320 746f 2061 6e20 6578  pecific to an ex
-00017560: 6563 7574 6162 6c65 2c20 696e 2074 6869  ecutable, in thi
-00017570: 7320 6f72 6465 723a 0a20 2020 202d 204c  s order:.    - L
-00017580: 445f 4c49 4252 4152 595f 5041 5448 0a20  D_LIBRARY_PATH. 
-00017590: 2020 202d 202f 6574 632f 6c64 2e73 6f2e     - /etc/ld.so.
-000175a0: 6361 6368 6520 2869 6e73 7465 6164 2077  cache (instead w
-000175b0: 6520 7769 6c6c 2070 6172 7365 202f 6574  e will parse /et
-000175c0: 632f 6c64 2e73 6f2e 636f 6e66 290a 2020  c/ld.so.conf).  
-000175d0: 2020 2d20 2f6c 6962 2c20 2f75 7372 2f6c    - /lib, /usr/l
-000175e0: 6962 2028 6f72 206d 6179 6265 202f 6c69  ib (or maybe /li
-000175f0: 6236 342c 202f 7573 722f 6c69 6236 3429  b64, /usr/lib64)
-00017600: 0a20 2020 2056 6961 2068 7474 7073 3a2f  .    Via https:/
-00017610: 2f67 6974 6875 622e 636f 6d2f 616c 6265  /github.com/albe
-00017620: 7274 7a2f 7379 7374 656d 2d74 6f6f 6c73  rtz/system-tools
-00017630: 2f62 6c6f 622f 6d61 7374 6572 2f62 696e  /blob/master/bin
-00017640: 2f66 696e 642d 6c69 622d 696e 2d70 6174  /find-lib-in-pat
-00017650: 682e 7079 2e0a 0a20 2020 203a 7274 7970  h.py...    :rtyp
-00017660: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
-00017670: 203a 7265 7475 726e 3a20 6c69 7374 206f   :return: list o
-00017680: 6620 7061 7468 7320 746f 2073 6561 7263  f paths to searc
-00017690: 6820 666f 7220 6c69 6273 2028 2a2e 736f  h for libs (*.so
-000176a0: 2066 696c 6573 290a 2020 2020 2222 220a   files).    """.
-000176b0: 2020 2020 7061 7468 7320 3d20 5b5d 0a20      paths = []. 
-000176c0: 2020 2069 6620 224c 445f 4c49 4252 4152     if "LD_LIBRAR
-000176d0: 595f 5041 5448 2220 696e 206f 732e 656e  Y_PATH" in os.en
-000176e0: 7669 726f 6e3a 0a20 2020 2020 2020 2070  viron:.        p
-000176f0: 6174 6873 2e65 7874 656e 6428 6f73 2e65  aths.extend(os.e
-00017700: 6e76 6972 6f6e 5b22 4c44 5f4c 4942 5241  nviron["LD_LIBRA
-00017710: 5259 5f50 4154 4822 5d2e 7370 6c69 7428  RY_PATH"].split(
-00017720: 223a 2229 290a 2020 2020 6966 206f 732e  ":")).    if os.
-00017730: 7061 7468 2e65 7869 7374 7328 222f 6574  path.exists("/et
-00017740: 632f 6c64 2e73 6f2e 636f 6e66 2229 3a0a  c/ld.so.conf"):.
-00017750: 2020 2020 2020 2020 7061 7468 732e 6578          paths.ex
-00017760: 7465 6e64 2870 6172 7365 5f6c 645f 636f  tend(parse_ld_co
-00017770: 6e66 5f66 696c 6528 222f 6574 632f 6c64  nf_file("/etc/ld
-00017780: 2e73 6f2e 636f 6e66 2229 290a 2020 2020  .so.conf")).    
-00017790: 7061 7468 732e 6578 7465 6e64 285b 222f  paths.extend(["/
-000177a0: 6c69 6222 2c20 222f 7573 722f 6c69 6222  lib", "/usr/lib"
-000177b0: 2c20 222f 6c69 6236 3422 2c20 222f 7573  , "/lib64", "/us
-000177c0: 722f 6c69 6236 3422 5d29 0a20 2020 2072  r/lib64"]).    r
-000177d0: 6574 7572 6e20 7061 7468 730a 0a0a 6465  eturn paths...de
-000177e0: 6620 6669 6e64 5f6c 6962 286c 6962 5f6e  f find_lib(lib_n
-000177f0: 616d 6529 3a0a 2020 2020 2222 220a 2020  ame):.    """.  
-00017800: 2020 3a70 6172 616d 2073 7472 206c 6962    :param str lib
-00017810: 5f6e 616d 653a 2077 6974 686f 7574 2070  _name: without p
-00017820: 6f73 7466 6978 2f70 7265 6669 782c 2065  ostfix/prefix, e
-00017830: 2e67 2e20 2263 7564 6172 7422 206f 7220  .g. "cudart" or 
-00017840: 2262 6c61 7322 0a20 2020 203a 7265 7475  "blas".    :retu
-00017850: 726e 3a20 7265 7475 726e 7320 6675 6c6c  rn: returns full
-00017860: 2070 6174 6820 746f 206c 6962 206f 7220   path to lib or 
-00017870: 4e6f 6e65 0a20 2020 203a 7274 7970 653a  None.    :rtype:
-00017880: 2073 7472 7c4e 6f6e 650a 2020 2020 2222   str|None.    ""
-00017890: 220a 2020 2020 6966 2073 7973 2e70 6c61  ".    if sys.pla
-000178a0: 7466 6f72 6d20 3d3d 2022 6461 7277 696e  tform == "darwin
-000178b0: 223a 0a20 2020 2020 2020 2070 7265 6669  ":.        prefi
-000178c0: 7820 3d20 226c 6962 220a 2020 2020 2020  x = "lib".      
-000178d0: 2020 706f 7374 6669 7820 3d20 222e 6479    postfix = ".dy
-000178e0: 6c69 6222 0a20 2020 2065 6c69 6620 7379  lib".    elif sy
-000178f0: 732e 706c 6174 666f 726d 203d 3d20 2277  s.platform == "w
-00017900: 696e 3332 223a 0a20 2020 2020 2020 2070  in32":.        p
-00017910: 7265 6669 7820 3d20 2222 0a20 2020 2020  refix = "".     
-00017920: 2020 2070 6f73 7466 6978 203d 2022 2e64     postfix = ".d
-00017930: 6c6c 220a 2020 2020 656c 7365 3a0a 2020  ll".    else:.  
-00017940: 2020 2020 2020 7072 6566 6978 203d 2022        prefix = "
-00017950: 6c69 6222 0a20 2020 2020 2020 2070 6f73  lib".        pos
-00017960: 7466 6978 203d 2022 2e73 6f22 0a20 2020  tfix = ".so".   
-00017970: 2066 6f72 2070 6174 6820 696e 2067 6574   for path in get
-00017980: 5f6c 645f 7061 7468 7328 293a 0a20 2020  _ld_paths():.   
-00017990: 2020 2020 2066 6e20 3d20 2225 732f 2573       fn = "%s/%s
-000179a0: 2573 2573 2220 2520 2870 6174 682c 2070  %s%s" % (path, p
-000179b0: 7265 6669 782c 206c 6962 5f6e 616d 652c  refix, lib_name,
-000179c0: 2070 6f73 7466 6978 290a 2020 2020 2020   postfix).      
-000179d0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-000179e0: 7374 7328 666e 293a 0a20 2020 2020 2020  sts(fn):.       
-000179f0: 2020 2020 2072 6574 7572 6e20 666e 0a20       return fn. 
-00017a00: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
-00017a10: 0a64 6566 2072 6561 645f 7367 655f 6e75  .def read_sge_nu
-00017a20: 6d5f 7072 6f63 7328 6a6f 625f 6964 3d4e  m_procs(job_id=N
-00017a30: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
-00017a40: 2020 4672 6f6d 2074 6865 2053 756e 2047    From the Sun G
-00017a50: 7269 6420 456e 6769 6e65 2028 5347 4529  rid Engine (SGE)
-00017a60: 2c20 7265 6164 7320 7468 6520 6e75 6d5f  , reads the num_
-00017a70: 7072 6f63 2073 6574 7469 6e67 2066 6f72  proc setting for
-00017a80: 2061 2070 6172 7469 6375 6c61 7220 6a6f   a particular jo
-00017a90: 622e 0a20 2020 2049 6620 6a6f 625f 6964  b..    If job_id
-00017aa0: 2069 7320 6e6f 7420 7072 6f76 6964 6564   is not provided
-00017ab0: 2061 6e64 2074 6865 204a 4f42 5f49 4420   and the JOB_ID 
-00017ac0: 656e 7620 6973 2073 6574 2c20 6974 2077  env is set, it w
-00017ad0: 696c 6c20 7573 6520 7468 6174 2069 6e73  ill use that ins
-00017ae0: 7465 6164 2028 692e 652e 2069 7420 7573  tead (i.e. it us
-00017af0: 6573 2074 6865 2063 7572 7265 6e74 206a  es the current j
-00017b00: 6f62 292e 0a20 2020 2054 6869 7320 6361  ob)..    This ca
-00017b10: 6c6c 7320 7173 7461 7420 746f 2066 6967  lls qstat to fig
-00017b20: 7572 6520 6f75 7420 7468 6973 2073 6574  ure out this set
-00017b30: 7469 6e67 2e20 5468 6572 6520 6172 6520  ting. There are 
-00017b40: 6d75 6c74 6970 6c65 2077 6179 7320 7468  multiple ways th
-00017b50: 6973 2063 616e 2067 6f20 7772 6f6e 672c  is can go wrong,
-00017b60: 0a20 2020 2073 6f20 6265 7474 6572 2063  .    so better c
-00017b70: 6174 6368 2061 6e79 2065 7863 6570 7469  atch any excepti
-00017b80: 6f6e 2e0a 0a20 2020 203a 7061 7261 6d20  on...    :param 
-00017b90: 696e 747c 4e6f 6e65 206a 6f62 5f69 643a  int|None job_id:
-00017ba0: 0a20 2020 203a 7265 7475 726e 3a20 6e75  .    :return: nu
-00017bb0: 6d5f 7072 6f63 0a20 2020 203a 7274 7970  m_proc.    :rtyp
-00017bc0: 653a 2069 6e74 7c4e 6f6e 650a 2020 2020  e: int|None.    
-00017bd0: 2222 220a 2020 2020 6966 206e 6f74 206a  """.    if not j
-00017be0: 6f62 5f69 643a 0a20 2020 2020 2020 2069  ob_id:.        i
-00017bf0: 6620 6e6f 7420 6f73 2e65 6e76 6972 6f6e  f not os.environ
-00017c00: 2e67 6574 2822 5347 455f 524f 4f54 2229  .get("SGE_ROOT")
-00017c10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00017c20: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-00017c30: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00017c40: 2020 2023 2071 696e 742e 7079 206d 6967     # qint.py mig
-00017c50: 6874 206f 7665 7277 7269 7465 204a 4f42  ht overwrite JOB
-00017c60: 5f49 4420 6275 7420 7365 7473 2053 4745  _ID but sets SGE
-00017c70: 5f4a 4f42 5f49 4420 696e 7374 6561 642e  _JOB_ID instead.
-00017c80: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
-00017c90: 5f69 6420 3d20 696e 7428 6f73 2e65 6e76  _id = int(os.env
-00017ca0: 6972 6f6e 2e67 6574 2822 5347 455f 4a4f  iron.get("SGE_JO
-00017cb0: 425f 4944 2229 206f 7220 6f73 2e65 6e76  B_ID") or os.env
-00017cc0: 6972 6f6e 2e67 6574 2822 4a4f 425f 4944  iron.get("JOB_ID
-00017cd0: 2229 206f 7220 3029 0a20 2020 2020 2020  ") or 0).       
-00017ce0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-00017cf0: 6f72 2061 7320 6578 633a 0a20 2020 2020  or as exc:.     
-00017d00: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00017d10: 6570 7469 6f6e 2822 7265 6164 5f73 6765  eption("read_sge
-00017d20: 5f6e 756d 5f70 726f 6373 3a20 2572 2c20  _num_procs: %r, 
-00017d30: 696e 7661 6c69 6420 4a4f 425f 4944 3a20  invalid JOB_ID: 
-00017d40: 2572 2220 2520 2865 7863 2c20 6f73 2e65  %r" % (exc, os.e
-00017d50: 6e76 6972 6f6e 2e67 6574 2822 4a4f 425f  nviron.get("JOB_
-00017d60: 4944 2229 2929 0a20 2020 2020 2020 2069  ID"))).        i
-00017d70: 6620 6e6f 7420 6a6f 625f 6964 3a0a 2020  f not job_id:.  
-00017d80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017d90: 204e 6f6e 650a 2020 2020 6672 6f6d 2073   None.    from s
-00017da0: 7562 7072 6f63 6573 7320 696d 706f 7274  ubprocess import
-00017db0: 2050 6f70 656e 2c20 5049 5045 2c20 4361   Popen, PIPE, Ca
-00017dc0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00017dd0: 0a0a 2020 2020 7367 655f 636d 6420 3d20  ..    sge_cmd = 
-00017de0: 5b22 7173 7461 7422 2c20 222d 6a22 2c20  ["qstat", "-j", 
-00017df0: 7374 7228 6a6f 625f 6964 295d 0a20 2020  str(job_id)].   
-00017e00: 2070 726f 6320 3d20 506f 7065 6e28 7367   proc = Popen(sg
-00017e10: 655f 636d 642c 2073 7464 6f75 743d 5049  e_cmd, stdout=PI
-00017e20: 5045 290a 2020 2020 7374 646f 7574 2c20  PE).    stdout, 
-00017e30: 5f20 3d20 7072 6f63 2e63 6f6d 6d75 6e69  _ = proc.communi
-00017e40: 6361 7465 2829 0a20 2020 2069 6620 7072  cate().    if pr
-00017e50: 6f63 2e72 6574 7572 6e63 6f64 653a 0a20  oc.returncode:. 
-00017e60: 2020 2020 2020 2072 6169 7365 2043 616c         raise Cal
-00017e70: 6c65 6450 726f 6365 7373 4572 726f 7228  ledProcessError(
-00017e80: 7072 6f63 2e72 6574 7572 6e63 6f64 652c  proc.returncode,
-00017e90: 2073 6765 5f63 6d64 2c20 7374 646f 7574   sge_cmd, stdout
-00017ea0: 290a 2020 2020 7374 646f 7574 203d 2073  ).    stdout = s
-00017eb0: 7464 6f75 742e 6465 636f 6465 2822 7574  tdout.decode("ut
-00017ec0: 6638 2229 0a20 2020 206c 7320 3d20 5b0a  f8").    ls = [.
-00017ed0: 2020 2020 2020 2020 6c69 6e65 5b6c 656e          line[len
-00017ee0: 2822 6861 7264 2072 6573 6f75 7263 655f  ("hard resource_
-00017ef0: 6c69 7374 3a22 2920 3a5d 2e73 7472 6970  list:") :].strip
-00017f00: 2829 0a20 2020 2020 2020 2066 6f72 206c  ().        for l
-00017f10: 696e 6520 696e 2073 7464 6f75 742e 7370  ine in stdout.sp
-00017f20: 6c69 746c 696e 6573 2829 0a20 2020 2020  litlines().     
-00017f30: 2020 2069 6620 6c69 6e65 2e73 7461 7274     if line.start
-00017f40: 7377 6974 6828 2268 6172 6420 7265 736f  swith("hard reso
-00017f50: 7572 6365 5f6c 6973 743a 2229 0a20 2020  urce_list:").   
-00017f60: 205d 0a20 2020 2061 7373 6572 7420 6c65   ].    assert le
-00017f70: 6e28 6c73 2920 3d3d 2031 0a20 2020 206f  n(ls) == 1.    o
-00017f80: 7074 7320 3d20 6469 6374 285b 6f70 742e  pts = dict([opt.
-00017f90: 7370 6c69 7428 223d 222c 2031 2920 666f  split("=", 1) fo
-00017fa0: 7220 6f70 7420 696e 206c 735b 305d 2e73  r opt in ls[0].s
-00017fb0: 706c 6974 2822 2c22 295d 2920 2023 206e  plit(",")])  # n
-00017fc0: 6f71 610a 2020 2020 7472 793a 0a20 2020  oqa.    try:.   
-00017fd0: 2020 2020 2072 6574 7572 6e20 696e 7428       return int(
-00017fe0: 6f70 7473 5b22 6e75 6d5f 7072 6f63 225d  opts["num_proc"]
-00017ff0: 290a 2020 2020 6578 6365 7074 2056 616c  ).    except Val
-00018000: 7565 4572 726f 7220 6173 2065 7863 3a0a  ueError as exc:.
-00018010: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00018020: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-00018030: 2020 2020 2022 7265 6164 5f73 6765 5f6e       "read_sge_n
-00018040: 756d 5f70 726f 6373 3a20 2572 2c20 696e  um_procs: %r, in
-00018050: 7661 6c69 6420 6e75 6d5f 7072 6f63 2025  valid num_proc %
-00018060: 7220 666f 7220 6a6f 6220 6964 2025 692e  r for job id %i.
-00018070: 5c6e 6c69 6e65 3a20 2572 220a 2020 2020  \nline: %r".    
-00018080: 2020 2020 2020 2020 2520 2865 7863 2c20          % (exc, 
-00018090: 6f70 7473 5b22 6e75 6d5f 7072 6f63 225d  opts["num_proc"]
-000180a0: 2c20 6a6f 625f 6964 2c20 6c73 5b30 5d29  , job_id, ls[0])
-000180b0: 0a20 2020 2020 2020 2029 0a0a 0a64 6566  .        )...def
-000180c0: 2067 6574 5f6e 756d 6265 725f 6176 6169   get_number_avai
-000180d0: 6c61 626c 655f 6370 7573 2829 3a0a 2020  lable_cpus():.  
-000180e0: 2020 2222 220a 2020 2020 3a72 6574 7572    """.    :retur
-000180f0: 6e3a 206e 756d 6265 7220 6f66 2061 7661  n: number of ava
-00018100: 696c 6162 6c65 2043 5055 732c 2069 6620  ilable CPUs, if 
-00018110: 7765 2063 616e 2066 6967 7572 6520 6974  we can figure it
-00018120: 206f 7574 0a20 2020 203a 7274 7970 653a   out.    :rtype:
-00018130: 2069 6e74 7c4e 6f6e 650a 2020 2020 2222   int|None.    ""
-00018140: 220a 2020 2020 6966 2068 6173 6174 7472  ".    if hasattr
-00018150: 286f 732c 2022 7363 6865 645f 6765 7461  (os, "sched_geta
-00018160: 6666 696e 6974 7922 293a 2020 2320 5079  ffinity"):  # Py
-00018170: 7468 6f6e 203e 3d33 2e34 0a20 2020 2020  thon >=3.4.     
-00018180: 2020 2072 6574 7572 6e20 6c65 6e28 6f73     return len(os
-00018190: 2e73 6368 6564 5f67 6574 6166 6669 6e69  .sched_getaffini
-000181a0: 7479 2830 2929 0a20 2020 2074 7279 3a0a  ty(0)).    try:.
-000181b0: 2020 2020 2020 2020 2320 6e6f 696e 7370          # noinsp
-000181c0: 6563 7469 6f6e 2050 7950 6163 6b61 6765  ection PyPackage
-000181d0: 5265 7175 6972 656d 656e 7473 2c50 7955  Requirements,PyU
-000181e0: 6e72 6573 6f6c 7665 6452 6566 6572 656e  nresolvedReferen
-000181f0: 6365 730a 2020 2020 2020 2020 696d 706f  ces.        impo
-00018200: 7274 2070 7375 7469 6c0a 0a20 2020 2020  rt psutil..     
-00018210: 2020 2070 726f 6320 3d20 7073 7574 696c     proc = psutil
-00018220: 2e50 726f 6365 7373 2829 0a20 2020 2020  .Process().     
-00018230: 2020 2069 6620 6861 7361 7474 7228 7072     if hasattr(pr
-00018240: 6f63 2c20 2263 7075 5f61 6666 696e 6974  oc, "cpu_affinit
-00018250: 7922 293a 0a20 2020 2020 2020 2020 2020  y"):.           
-00018260: 2072 6574 7572 6e20 6c65 6e28 7072 6f63   return len(proc
-00018270: 2e63 7075 5f61 6666 696e 6974 7928 2929  .cpu_affinity())
-00018280: 0a20 2020 2065 7863 6570 7420 496d 706f  .    except Impo
-00018290: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
-000182a0: 2070 6173 730a 2020 2020 6966 2068 6173   pass.    if has
-000182b0: 6174 7472 286f 732c 2022 7379 7363 6f6e  attr(os, "syscon
-000182c0: 6622 2920 616e 6420 2253 435f 4e50 524f  f") and "SC_NPRO
-000182d0: 4345 5353 4f52 535f 4f4e 4c4e 2220 696e  CESSORS_ONLN" in
-000182e0: 206f 732e 7379 7363 6f6e 665f 6e61 6d65   os.sysconf_name
-000182f0: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
-00018300: 6e20 6f73 2e73 7973 636f 6e66 2822 5343  n os.sysconf("SC
-00018310: 5f4e 5052 4f43 4553 534f 5253 5f4f 4e4c  _NPROCESSORS_ONL
-00018320: 4e22 290a 2020 2020 6966 2068 6173 6174  N").    if hasat
-00018330: 7472 286f 732c 2022 6370 755f 636f 756e  tr(os, "cpu_coun
-00018340: 7422 293a 2020 2320 5079 7468 6f6e 203e  t"):  # Python >
-00018350: 3d33 2e34 0a20 2020 2020 2020 2072 6574  =3.4.        ret
-00018360: 7572 6e20 6f73 2e63 7075 5f63 6f75 6e74  urn os.cpu_count
-00018370: 2829 2020 2320 6e6f 7420 7175 6974 6520  ()  # not quite 
-00018380: 636f 7272 6563 743b 2074 6861 7420 6172  correct; that ar
-00018390: 6520 616c 6c20 696e 2074 6865 2073 7973  e all in the sys
-000183a0: 7465 6d0a 2020 2020 7265 7475 726e 204e  tem.    return N
-000183b0: 6f6e 650a 0a0a 6465 6620 6775 6573 735f  one...def guess_
-000183c0: 7265 7175 6573 7465 645f 6d61 785f 6e75  requested_max_nu
-000183d0: 6d5f 7468 7265 6164 7328 6c6f 675f 6669  m_threads(log_fi
-000183e0: 6c65 3d4e 6f6e 652c 2066 616c 6c62 6163  le=None, fallbac
-000183f0: 6b5f 6e75 6d5f 6370 7573 3d54 7275 6529  k_num_cpus=True)
-00018400: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00018410: 6172 616d 2069 6f2e 4669 6c65 206c 6f67  aram io.File log
-00018420: 5f66 696c 653a 0a20 2020 203a 7061 7261  _file:.    :para
-00018430: 6d20 626f 6f6c 2066 616c 6c62 6163 6b5f  m bool fallback_
-00018440: 6e75 6d5f 6370 7573 3a0a 2020 2020 3a72  num_cpus:.    :r
-00018450: 7479 7065 3a20 696e 747c 4e6f 6e65 0a20  type: int|None. 
-00018460: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
-00018470: 2020 2020 2020 2020 7367 655f 6e75 6d5f          sge_num_
-00018480: 7072 6f63 7320 3d20 7265 6164 5f73 6765  procs = read_sge
-00018490: 5f6e 756d 5f70 726f 6373 2829 0a20 2020  _num_procs().   
-000184a0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000184b0: 6e20 6173 2065 7863 3a0a 2020 2020 2020  n as exc:.      
-000184c0: 2020 6966 206c 6f67 5f66 696c 653a 0a20    if log_file:. 
-000184d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000184e0: 2822 4572 726f 7220 7768 696c 6520 6765  ("Error while ge
-000184f0: 7474 696e 6720 5347 4520 6e75 6d5f 7072  tting SGE num_pr
-00018500: 6f63 3a20 2572 2220 2520 6578 632c 2066  oc: %r" % exc, f
-00018510: 696c 653d 6c6f 675f 6669 6c65 290a 2020  ile=log_file).  
-00018520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00018530: 6966 2073 6765 5f6e 756d 5f70 726f 6373  if sge_num_procs
-00018540: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00018550: 206c 6f67 5f66 696c 653a 0a20 2020 2020   log_file:.     
-00018560: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00018570: 2822 5573 6520 6e75 6d5f 7468 7265 6164  ("Use num_thread
-00018580: 733d 2569 2028 6275 7420 6d69 6e20 3229  s=%i (but min 2)
-00018590: 2076 6961 2053 4745 206e 756d 5f70 726f   via SGE num_pro
-000185a0: 632e 2220 2520 7367 655f 6e75 6d5f 7072  c." % sge_num_pr
-000185b0: 6f63 732c 2066 696c 653d 6c6f 675f 6669  ocs, file=log_fi
-000185c0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-000185d0: 7265 7475 726e 206d 6178 2873 6765 5f6e  return max(sge_n
-000185e0: 756d 5f70 726f 6373 2c20 3229 0a20 2020  um_procs, 2).   
-000185f0: 206f 6d70 5f6e 756d 5f74 6872 6561 6473   omp_num_threads
-00018600: 203d 2069 6e74 286f 732e 656e 7669 726f   = int(os.enviro
-00018610: 6e2e 6765 7428 224f 4d50 5f4e 554d 5f54  n.get("OMP_NUM_T
-00018620: 4852 4541 4453 2229 206f 7220 3029 0a20  HREADS") or 0). 
-00018630: 2020 2069 6620 6f6d 705f 6e75 6d5f 7468     if omp_num_th
-00018640: 7265 6164 733a 0a20 2020 2020 2020 2023  reads:.        #
-00018650: 204d 696e 696d 756d 206f 6620 3220 7468   Minimum of 2 th
-00018660: 7265 6164 732c 2073 686f 756c 6420 6e6f  reads, should no
-00018670: 7420 6875 7274 2e0a 2020 2020 2020 2020  t hurt..        
-00018680: 6966 206c 6f67 5f66 696c 653a 0a20 2020  if log_file:.   
-00018690: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-000186a0: 5573 6520 6e75 6d5f 7468 7265 6164 733d  Use num_threads=
-000186b0: 2569 2028 6275 7420 6d69 6e20 3229 2076  %i (but min 2) v
-000186c0: 6961 204f 4d50 5f4e 554d 5f54 4852 4541  ia OMP_NUM_THREA
-000186d0: 4453 2e22 2025 206f 6d70 5f6e 756d 5f74  DS." % omp_num_t
-000186e0: 6872 6561 6473 2c20 6669 6c65 3d6c 6f67  hreads, file=log
-000186f0: 5f66 696c 6529 0a20 2020 2020 2020 2072  _file).        r
-00018700: 6574 7572 6e20 6d61 7828 6f6d 705f 6e75  eturn max(omp_nu
-00018710: 6d5f 7468 7265 6164 732c 2032 290a 2020  m_threads, 2).  
-00018720: 2020 6966 2066 616c 6c62 6163 6b5f 6e75    if fallback_nu
-00018730: 6d5f 6370 7573 3a0a 2020 2020 2020 2020  m_cpus:.        
-00018740: 7265 7475 726e 2067 6574 5f6e 756d 6265  return get_numbe
-00018750: 725f 6176 6169 6c61 626c 655f 6370 7573  r_available_cpus
-00018760: 2829 0a20 2020 2072 6574 7572 6e20 4e6f  ().    return No
-00018770: 6e65 0a0a 0a54 6865 616e 6f46 6c61 6773  ne...TheanoFlags
-00018780: 203d 207b 0a20 2020 206b 6579 3a20 7661   = {.    key: va
-00018790: 6c75 6520 666f 7220 286b 6579 2c20 7661  lue for (key, va
-000187a0: 6c75 6529 2069 6e20 5b73 2e73 706c 6974  lue) in [s.split
-000187b0: 2822 3d22 2c20 3129 2066 6f72 2073 2069  ("=", 1) for s i
-000187c0: 6e20 6f73 2e65 6e76 6972 6f6e 2e67 6574  n os.environ.get
-000187d0: 2822 5448 4541 4e4f 5f46 4c41 4753 222c  ("THEANO_FLAGS",
-000187e0: 2022 2229 2e73 706c 6974 2822 2c22 2920   "").split(",") 
-000187f0: 6966 2073 5d0a 7d0a 0a0a 6465 6620 5f63  if s].}...def _c
-00018800: 6f6e 7369 6465 725f 6368 6563 6b5f 666f  onsider_check_fo
-00018810: 725f 6770 7528 293a 0a20 2020 2022 2222  r_gpu():.    """
-00018820: 0a20 2020 2054 6865 7265 2061 7265 2063  .    There are c
-00018830: 6173 6573 2077 6865 7265 206e 7669 6469  ases where nvidi
-00018840: 612d 736d 6920 636f 756c 6420 6861 6e67  a-smi could hang
-00018850: 2e0a 2020 2020 2841 6e79 2072 6561 6420  ..    (Any read 
-00018860: 6f66 202f 7072 6f63 2f6d 6f64 756c 6573  of /proc/modules
-00018870: 206d 6967 6874 2068 616e 6720 696e 2074   might hang in t
-00018880: 6861 7420 6361 7365 2c20 6d61 7962 6520  hat case, maybe 
-00018890: 6361 7573 6564 0a20 2020 2020 6279 2074  caused.     by t
-000188a0: 7279 696e 6720 746f 2060 6d6f 6470 726f  rying to `modpro
-000188b0: 6265 206e 7669 6469 6160 2074 6f20 6368  be nvidia` to ch
-000188c0: 6563 6b20 6966 2074 6865 7265 2069 7320  eck if there is 
-000188d0: 6120 4e76 6964 6961 2063 6172 642e 290a  a Nvidia card.).
-000188e0: 2020 2020 5468 6973 2073 6f6d 6574 696d      This sometim
-000188f0: 6573 2068 6170 7065 6e73 2069 6e20 6f75  es happens in ou
-00018900: 7220 5347 4520 636c 7573 7465 7220 6f6e  r SGE cluster on
-00018910: 206e 6f64 6573 2077 6974 686f 7574 204e   nodes without N
-00018920: 7669 6469 6120 6361 7264 732e 0a20 2020  vidia cards..   
-00018930: 204d 6179 6265 2069 7427 7320 616c 736f   Maybe it's also
-00018940: 2061 204c 696e 7578 204b 6572 6e65 6c20   a Linux Kernel 
-00018950: 6275 672e 0a20 2020 2041 6e79 7761 792c  bug..    Anyway,
-00018960: 206a 7573 7420 6176 6f69 6420 616e 7920   just avoid any 
-00018970: 7375 6368 2063 6865 636b 2069 6620 7765  such check if we
-00018980: 2064 6f6e 2774 2061 736b 6564 2066 6f72   don't asked for
-00018990: 2061 2047 5055 2e0a 0a20 2020 203a 7274   a GPU...    :rt
-000189a0: 7970 653a 2062 6f6f 6c0a 2020 2020 2222  ype: bool.    ""
-000189b0: 220a 2020 2020 6966 2022 6465 7669 6365  ".    if "device
-000189c0: 2220 696e 2054 6865 616e 6f46 6c61 6773  " in TheanoFlags
-000189d0: 3a0a 2020 2020 2020 2020 6465 7620 3d20  :.        dev = 
-000189e0: 5468 6561 6e6f 466c 6167 735b 2264 6576  TheanoFlags["dev
-000189f0: 6963 6522 5d0a 2020 2020 2020 2020 6966  ice"].        if
-00018a00: 2064 6576 2e73 7461 7274 7377 6974 6828   dev.startswith(
-00018a10: 2267 7075 2229 206f 7220 6465 762e 7374  "gpu") or dev.st
-00018a20: 6172 7473 7769 7468 2822 6375 6461 2229  artswith("cuda")
-00018a30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018a40: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-00018a50: 2020 2320 5448 4541 4e4f 5f46 4c41 4753    # THEANO_FLAGS
-00018a60: 2077 696c 6c20 6f76 6572 7772 6974 6520   will overwrite 
-00018a70: 7468 6973 2063 6f6e 6669 6720 6f70 7469  this config opti
-00018a80: 6f6e 2e20 5365 6520 726e 6e2e 696e 6974  on. See rnn.init
-00018a90: 4465 7669 6365 7328 292e 0a20 2020 2020  Devices()..     
-00018aa0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00018ab0: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
-00018ac0: 6f6e 2050 7942 726f 6164 4578 6365 7074  on PyBroadExcept
-00018ad0: 696f 6e0a 2020 2020 7472 793a 0a20 2020  ion.    try:.   
-00018ae0: 2020 2020 2066 726f 6d20 7265 7475 726e       from return
-00018af0: 6e2e 636f 6e66 6967 2069 6d70 6f72 7420  n.config import 
-00018b00: 6765 745f 676c 6f62 616c 5f63 6f6e 6669  get_global_confi
-00018b10: 670a 0a20 2020 2020 2020 2063 6f6e 6669  g..        confi
-00018b20: 6720 3d20 6765 745f 676c 6f62 616c 5f63  g = get_global_c
-00018b30: 6f6e 6669 6728 290a 2020 2020 6578 6365  onfig().    exce
-00018b40: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00018b50: 2020 2020 2020 636f 6e66 6967 203d 204e        config = N
-00018b60: 6f6e 650a 2020 2020 6966 2063 6f6e 6669  one.    if confi
-00018b70: 673a 0a20 2020 2020 2020 2066 6f72 2064  g:.        for d
-00018b80: 6576 2069 6e20 636f 6e66 6967 2e6c 6973  ev in config.lis
-00018b90: 7428 2264 6576 6963 6522 2c20 5b5d 293a  t("device", []):
-00018ba0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00018bb0: 6465 762e 7374 6172 7473 7769 7468 2822  dev.startswith("
-00018bc0: 6770 7522 2920 6f72 2064 6576 2e73 7461  gpu") or dev.sta
-00018bd0: 7274 7377 6974 6828 2263 7564 6122 293a  rtswith("cuda"):
-00018be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018bf0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-00018c00: 2020 2020 2020 2020 2069 6620 6465 7620           if dev 
-00018c10: 3d3d 2022 616c 6c22 3a0a 2020 2020 2020  == "all":.      
-00018c20: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00018c30: 2054 7275 650a 2020 2020 7265 7475 726e   True.    return
-00018c40: 2046 616c 7365 0a0a 0a64 6566 2067 6574   False...def get
-00018c50: 5f67 7075 5f6e 616d 6573 2829 3a0a 2020  _gpu_names():.  
-00018c60: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
-00018c70: 3a20 6c69 7374 5b73 7472 5d0a 2020 2020  : list[str].    
-00018c80: 2222 220a 2020 2020 6966 206e 6f74 205f  """.    if not _
-00018c90: 636f 6e73 6964 6572 5f63 6865 636b 5f66  consider_check_f
-00018ca0: 6f72 5f67 7075 2829 3a0a 2020 2020 2020  or_gpu():.      
-00018cb0: 2020 7265 7475 726e 205b 5d0a 2020 2020    return [].    
-00018cc0: 6966 206f 732e 6e61 6d65 203d 3d20 226e  if os.name == "n
-00018cd0: 7422 3a0a 2020 2020 2020 2020 7265 7475  t":.        retu
-00018ce0: 726e 2022 4765 466f 7263 6520 4754 5820  rn "GeForce GTX 
-00018cf0: 3737 3022 2020 2320 544f 444f 0a20 2020  770"  # TODO.   
-00018d00: 2065 6c69 6620 7379 732e 706c 6174 666f   elif sys.platfo
-00018d10: 726d 203d 3d20 2264 6172 7769 6e22 3a0a  rm == "darwin":.
-00018d20: 2020 2020 2020 2020 2320 544f 444f 2070          # TODO p
-00018d30: 6172 7365 2076 6961 2078 6d6c 206f 7574  arse via xml out
-00018d40: 7075 740a 2020 2020 2020 2020 7265 7475  put.        retu
-00018d50: 726e 2073 7973 5f63 6d64 5f6f 7574 5f6c  rn sys_cmd_out_l
-00018d60: 696e 6573 280a 2020 2020 2020 2020 2020  ines(.          
-00018d70: 2020 2273 7973 7465 6d5f 7072 6f66 696c    "system_profil
-00018d80: 6572 2053 5044 6973 706c 6179 7344 6174  er SPDisplaysDat
-00018d90: 6154 7970 6520 7c20 220a 2020 2020 2020  aType | ".      
-00018da0: 2020 2020 2020 2267 7265 7020 2743 6869        "grep 'Chi
-00018db0: 7073 6574 204d 6f64 656c 3a20 4e56 4944  pset Model: NVID
-00018dc0: 4941 2720 7c20 220a 2020 2020 2020 2020  IA' | ".        
-00018dd0: 2020 2020 2273 6564 2027 732f 2e2a 4368      "sed 's/.*Ch
-00018de0: 6970 7365 7420 4d6f 6465 6c3a 204e 5649  ipset Model: NVI
-00018df0: 4449 4120 2a2f 2f3b 732f 202a 242f 2f27  DIA *//;s/ *$//'
-00018e00: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00018e10: 656c 7365 3a0a 2020 2020 2020 2020 7472  else:.        tr
-00018e20: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00018e30: 6574 7572 6e20 7379 735f 636d 645f 6f75  eturn sys_cmd_ou
-00018e40: 745f 6c69 6e65 7328 226e 7669 6469 612d  t_lines("nvidia-
-00018e50: 736d 6920 2d4c 207c 2063 7574 202d 6420  smi -L | cut -d 
-00018e60: 2728 2720 2d66 2031 207c 2063 7574 202d  '(' -f 1 | cut -
-00018e70: 6420 2720 2720 2d66 2033 2d20 7c20 7365  d ' ' -f 3- | se
-00018e80: 6420 2d65 2027 732f 5c5c 2024 2f2f 2722  d -e 's/\\ $//'"
-00018e90: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00018ea0: 2043 616c 6c65 6450 726f 6365 7373 4572   CalledProcessEr
-00018eb0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00018ec0: 2072 6574 7572 6e20 5b5d 0a0a 0a64 6566   return []...def
-00018ed0: 205f 6765 745f 6e75 6d5f 6770 755f 6465   _get_num_gpu_de
-00018ee0: 7669 6365 7328 293a 0a20 2020 2022 2222  vices():.    """
-00018ef0: 0a20 2020 203a 7265 7475 726e 3a20 6370  .    :return: cp
-00018f00: 752c 6770 750a 2020 2020 3a72 7479 7065  u,gpu.    :rtype
-00018f10: 3a20 2869 6e74 2c69 6e74 290a 2020 2020  : (int,int).    
-00018f20: 2222 220a 2020 2020 6966 206f 732e 6e61  """.    if os.na
-00018f30: 6d65 203d 3d20 226e 7422 3a0a 2020 2020  me == "nt":.    
-00018f40: 2020 2020 7265 7475 726e 2031 2c20 3120      return 1, 1 
-00018f50: 2023 2054 4f44 4f0a 2020 2020 656c 6966   # TODO.    elif
-00018f60: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
-00018f70: 2022 6461 7277 696e 223a 0a20 2020 2020   "darwin":.     
-00018f80: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-00018f90: 2020 2020 2020 2020 696e 7428 7379 735f          int(sys_
-00018fa0: 636d 645f 6f75 745f 6c69 6e65 7328 2273  cmd_out_lines("s
-00018fb0: 7973 6374 6c20 2d61 207c 2067 7265 7020  ysctl -a | grep 
-00018fc0: 6d61 6368 6465 702e 6370 752e 636f 7265  machdep.cpu.core
-00018fd0: 5f63 6f75 6e74 207c 2061 776b 2027 7b70  _count | awk '{p
-00018fe0: 7269 6e74 2024 327d 2722 295b 305d 292c  rint $2}'")[0]),
-00018ff0: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
-00019000: 2873 7973 5f63 6d64 5f6f 7574 5f6c 696e  (sys_cmd_out_lin
-00019010: 6573 2822 7379 7374 656d 5f70 726f 6669  es("system_profi
-00019020: 6c65 7220 5350 4469 7370 6c61 7973 4461  ler SPDisplaysDa
-00019030: 7461 5479 7065 207c 2067 7265 7020 2743  taType | grep 'C
-00019040: 6869 7073 6574 204d 6f64 656c 3a20 4e56  hipset Model: NV
-00019050: 4944 4941 2720 7c20 6361 7422 2929 2c0a  IDIA' | cat")),.
-00019060: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
-00019070: 7365 3a0a 2020 2020 2020 2020 6e75 6d5f  se:.        num_
-00019080: 6370 7573 203d 206c 656e 2873 7973 5f63  cpus = len(sys_c
-00019090: 6d64 5f6f 7574 5f6c 696e 6573 2822 6361  md_out_lines("ca
-000190a0: 7420 2f70 726f 632f 6370 7569 6e66 6f20  t /proc/cpuinfo 
-000190b0: 7c20 6772 6570 2070 726f 6365 7373 6f72  | grep processor
-000190c0: 2229 2920 6f72 2031 0a20 2020 2020 2020  ")) or 1.       
-000190d0: 206e 756d 5f67 7075 7320 3d20 300a 2020   num_gpus = 0.  
-000190e0: 2020 2020 2020 6966 205f 636f 6e73 6964        if _consid
-000190f0: 6572 5f63 6865 636b 5f66 6f72 5f67 7075  er_check_for_gpu
-00019100: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00019110: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00019120: 2020 2020 206e 756d 5f67 7075 7320 3d20       num_gpus = 
-00019130: 6c65 6e28 7379 735f 636d 645f 6f75 745f  len(sys_cmd_out_
-00019140: 6c69 6e65 7328 226e 7669 6469 612d 736d  lines("nvidia-sm
-00019150: 6920 2d4c 2229 290a 2020 2020 2020 2020  i -L")).        
-00019160: 2020 2020 6578 6365 7074 2043 616c 6c65      except Calle
-00019170: 6450 726f 6365 7373 4572 726f 723a 0a20  dProcessError:. 
-00019180: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019190: 6173 730a 2020 2020 2020 2020 7265 7475  ass.        retu
-000191a0: 726e 206e 756d 5f63 7075 732c 206e 756d  rn num_cpus, num
-000191b0: 5f67 7075 730a 0a0a 5f6e 756d 5f64 6576  _gpus..._num_dev
-000191c0: 6963 6573 203d 204e 6f6e 650a 0a0a 6465  ices = None...de
-000191d0: 6620 6765 745f 6e75 6d5f 6770 755f 6465  f get_num_gpu_de
-000191e0: 7669 6365 7328 293a 0a20 2020 2022 2222  vices():.    """
-000191f0: 0a20 2020 203a 7265 7475 726e 3a20 2863  .    :return: (c
-00019200: 7075 2063 6f75 6e74 2c20 6770 7520 636f  pu count, gpu co
-00019210: 756e 7429 0a20 2020 203a 7274 7970 653a  unt).    :rtype:
-00019220: 2028 696e 742c 2069 6e74 290a 2020 2020   (int, int).    
-00019230: 2222 220a 2020 2020 676c 6f62 616c 205f  """.    global _
-00019240: 6e75 6d5f 6465 7669 6365 730a 2020 2020  num_devices.    
-00019250: 6966 205f 6e75 6d5f 6465 7669 6365 7320  if _num_devices 
-00019260: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00019270: 2020 2020 2072 6574 7572 6e20 5f6e 756d       return _num
-00019280: 5f64 6576 6963 6573 0a20 2020 205f 6e75  _devices.    _nu
-00019290: 6d5f 6465 7669 6365 7320 3d20 5f67 6574  m_devices = _get
-000192a0: 5f6e 756d 5f67 7075 5f64 6576 6963 6573  _num_gpu_devices
-000192b0: 2829 0a20 2020 2072 6574 7572 6e20 5f6e  ().    return _n
-000192c0: 756d 5f64 6576 6963 6573 0a0a 0a64 6566  um_devices...def
-000192d0: 2068 6176 655f 6770 7528 293a 0a20 2020   have_gpu():.   
-000192e0: 2022 2222 0a20 2020 203a 7274 7970 653a   """.    :rtype:
-000192f0: 2062 6f6f 6c0a 2020 2020 2222 220a 2020   bool.    """.  
-00019300: 2020 6370 7573 2c20 6770 7573 203d 2067    cpus, gpus = g
-00019310: 6574 5f6e 756d 5f67 7075 5f64 6576 6963  et_num_gpu_devic
-00019320: 6573 2829 0a20 2020 2072 6574 7572 6e20  es().    return 
-00019330: 6770 7573 203e 2030 0a0a 0a64 6566 2074  gpus > 0...def t
-00019340: 7279 5f61 6e64 5f69 676e 6f72 655f 6578  ry_and_ignore_ex
-00019350: 6365 7074 696f 6e28 6629 3a0a 2020 2020  ception(f):.    
-00019360: 2222 220a 2020 2020 4361 6c6c 7320 6060  """.    Calls ``
-00019370: 6660 602c 2061 6e64 2069 676e 6f72 6573  f``, and ignores
-00019380: 2061 6e79 2065 7863 6570 7469 6f6e 2e0a   any exception..
-00019390: 0a20 2020 203a 7061 7261 6d20 2829 2d3e  .    :param ()->
-000193a0: 5420 663a 0a20 2020 203a 7265 7475 726e  T f:.    :return
-000193b0: 3a20 7768 6174 6576 6572 2060 6066 6060  : whatever ``f``
-000193c0: 2072 6574 7572 6e73 2c20 6f72 204e 6f6e   returns, or Non
-000193d0: 650a 2020 2020 3a72 7479 7065 3a20 547c  e.    :rtype: T|
-000193e0: 4e6f 6e65 0a20 2020 2022 2222 0a20 2020  None.    """.   
-000193f0: 2074 7279 3a0a 2020 2020 2020 2020 7265   try:.        re
-00019400: 7475 726e 2066 2829 0a20 2020 2065 7863  turn f().    exc
-00019410: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-00019420: 2065 7863 3a0a 2020 2020 2020 2020 7072   exc:.        pr
-00019430: 696e 7428 2274 7279 5f61 6e64 5f69 676e  int("try_and_ign
-00019440: 6f72 655f 6578 6365 7074 696f 6e3a 2025  ore_exception: %
-00019450: 7220 6661 696c 6564 3a20 2573 2220 2520  r failed: %s" % 
-00019460: 2866 2c20 6578 6329 290a 2020 2020 2020  (f, exc)).      
-00019470: 2020 7379 732e 6578 6365 7074 686f 6f6b    sys.excepthook
-00019480: 282a 7379 732e 6578 635f 696e 666f 2829  (*sys.exc_info()
-00019490: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000194a0: 204e 6f6e 650a 0a0a 6465 6620 7472 795f   None...def try_
-000194b0: 6765 745f 7374 6163 6b5f 6672 616d 6528  get_stack_frame(
-000194c0: 6465 7074 683d 3129 3a0a 2020 2020 2222  depth=1):.    ""
-000194d0: 220a 2020 2020 3a70 6172 616d 2069 6e74  ".    :param int
-000194e0: 2064 6570 7468 3a0a 2020 2020 3a72 7479   depth:.    :rty
-000194f0: 7065 3a20 7479 7065 732e 4672 616d 6554  pe: types.FrameT
-00019500: 7970 657c 4e6f 6e65 0a20 2020 203a 7265  ype|None.    :re
-00019510: 7475 726e 3a20 6361 6c6c 6572 2066 756e  turn: caller fun
-00019520: 6374 696f 6e20 6e61 6d65 2e20 7468 6973  ction name. this
-00019530: 2069 7320 6a75 7374 2066 6f72 2064 6562   is just for deb
-00019540: 7567 6769 6e67 0a20 2020 2022 2222 0a20  ugging.    """. 
-00019550: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
-00019560: 6e20 5079 4272 6f61 6445 7863 6570 7469  n PyBroadExcepti
-00019570: 6f6e 0a20 2020 2074 7279 3a0a 2020 2020  on.    try:.    
-00019580: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
-00019590: 6f6e 2050 7950 726f 7465 6374 6564 4d65  on PyProtectedMe
-000195a0: 6d62 6572 2c50 7955 6e72 6573 6f6c 7665  mber,PyUnresolve
-000195b0: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
-000195c0: 2020 2020 6672 616d 6520 3d20 7379 732e      frame = sys.
-000195d0: 5f67 6574 6672 616d 6528 6465 7074 6820  _getframe(depth 
-000195e0: 2b20 3129 2020 2320 6f6e 6520 6d6f 7265  + 1)  # one more
-000195f0: 2074 6f20 636f 756e 7420 6f75 7273 656c   to count oursel
-00019600: 7665 730a 2020 2020 2020 2020 7265 7475  ves.        retu
-00019610: 726e 2066 7261 6d65 0a20 2020 2065 7863  rn frame.    exc
-00019620: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00019630: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00019640: 6e65 0a0a 0a64 6566 2074 7279 5f67 6574  ne...def try_get
-00019650: 5f63 616c 6c65 725f 6e61 6d65 2864 6570  _caller_name(dep
-00019660: 7468 3d31 2c20 6661 6c6c 6261 636b 3d4e  th=1, fallback=N
-00019670: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
-00019680: 2020 3a70 6172 616d 2069 6e74 2064 6570    :param int dep
-00019690: 7468 3a0a 2020 2020 3a70 6172 616d 2073  th:.    :param s
-000196a0: 7472 7c4e 6f6e 6520 6661 6c6c 6261 636b  tr|None fallback
-000196b0: 3a20 7468 6973 2069 7320 7265 7475 726e  : this is return
-000196c0: 6564 2069 6620 7765 2066 6169 6c20 666f  ed if we fail fo
-000196d0: 7220 736f 6d65 2072 6561 736f 6e0a 2020  r some reason.  
-000196e0: 2020 3a72 7479 7065 3a20 7374 727c 4e6f    :rtype: str|No
-000196f0: 6e65 0a20 2020 203a 7265 7475 726e 3a20  ne.    :return: 
-00019700: 6361 6c6c 6572 2066 756e 6374 696f 6e20  caller function 
-00019710: 6e61 6d65 2e20 7468 6973 2069 7320 6a75  name. this is ju
-00019720: 7374 2066 6f72 2064 6562 7567 6769 6e67  st for debugging
-00019730: 0a20 2020 2022 2222 0a20 2020 2066 7261  .    """.    fra
-00019740: 6d65 203d 2074 7279 5f67 6574 5f73 7461  me = try_get_sta
-00019750: 636b 5f66 7261 6d65 2864 6570 7468 202b  ck_frame(depth +
-00019760: 2031 2920 2023 206f 6e65 206d 6f72 6520   1)  # one more 
-00019770: 746f 2063 6f75 6e74 206f 7572 7365 6c76  to count ourselv
-00019780: 6573 0a20 2020 2069 6620 6672 616d 653a  es.    if frame:
-00019790: 0a20 2020 2020 2020 2066 726f 6d20 2e62  .        from .b
-000197a0: 6574 7465 725f 6578 6368 6f6f 6b20 696d  etter_exchook im
-000197b0: 706f 7274 2067 6574 5f66 756e 635f 7374  port get_func_st
-000197c0: 725f 6672 6f6d 5f63 6f64 655f 6f62 6a65  r_from_code_obje
-000197d0: 6374 0a0a 2020 2020 2020 2020 7265 7475  ct..        retu
-000197e0: 726e 2067 6574 5f66 756e 635f 7374 725f  rn get_func_str_
-000197f0: 6672 6f6d 5f63 6f64 655f 6f62 6a65 6374  from_code_object
-00019800: 2866 7261 6d65 2e66 5f63 6f64 6529 0a20  (frame.f_code). 
-00019810: 2020 2072 6574 7572 6e20 6661 6c6c 6261     return fallba
-00019820: 636b 0a0a 0a63 6c61 7373 2049 6e66 696e  ck...class Infin
-00019830: 6974 6552 6563 7572 7369 6f6e 4465 7465  iteRecursionDete
-00019840: 6374 6564 2845 7863 6570 7469 6f6e 293a  cted(Exception):
-00019850: 0a20 2020 2022 2222 0a20 2020 2052 6169  .    """.    Rai
-00019860: 7365 6420 7768 656e 2061 6e20 696e 6669  sed when an infi
-00019870: 6e69 7465 2072 6563 7572 7369 6f6e 2069  nite recursion i
-00019880: 7320 6465 7465 6374 6564 2c20 6279 2067  s detected, by g
-00019890: 7561 7264 5f69 6e66 696e 6974 655f 7265  uard_infinite_re
-000198a0: 6375 7273 696f 6e2e 0a20 2020 2022 2222  cursion..    """
-000198b0: 0a0a 0a5f 6775 6172 645f 696e 6669 6e69  ..._guard_infini
-000198c0: 7465 5f72 6563 7572 7369 6f6e 5f63 6163  te_recursion_cac
-000198d0: 6865 203d 2074 6872 6561 6469 6e67 2e6c  he = threading.l
-000198e0: 6f63 616c 2829 0a0a 0a40 636f 6e74 6578  ocal()...@contex
-000198f0: 746c 6962 2e63 6f6e 7465 7874 6d61 6e61  tlib.contextmana
-00019900: 6765 720a 6465 6620 6775 6172 645f 696e  ger.def guard_in
-00019910: 6669 6e69 7465 5f72 6563 7572 7369 6f6e  finite_recursion
-00019920: 282a 6172 6773 293a 0a20 2020 2022 2222  (*args):.    """
-00019930: 0a20 2020 2052 6567 6973 7465 7273 2061  .    Registers a
-00019940: 7267 7320 2863 6f75 6c64 2062 6520 6675  rgs (could be fu
-00019950: 6e63 202b 2061 7267 7329 2069 6e20 736f  nc + args) in so
-00019960: 6d65 2063 6163 6865 2e0a 2020 2020 4966  me cache..    If
-00019970: 2074 686f 7365 2061 7267 7320 6172 6520   those args are 
-00019980: 616c 7265 6164 7920 696e 2074 6865 2063  already in the c
-00019990: 6163 6865 2c20 6974 2077 696c 6c20 7261  ache, it will ra
-000199a0: 6973 6520 616e 2065 7863 6570 7469 6f6e  ise an exception
-000199b0: 2e0a 0a20 2020 2049 7420 7769 6c6c 2075  ...    It will u
-000199c0: 7365 2074 6865 2069 6420 6f66 2074 6865  se the id of the
-000199d0: 2061 7267 7320 6173 206b 6579 2061 6e64   args as key and
-000199e0: 206e 6f74 2075 7365 2061 6e79 2068 6173   not use any has
-000199f0: 6869 6e67 0a20 2020 2074 6f20 616c 6c6f  hing.    to allo
-00019a00: 7720 7468 6174 2067 7561 7264 5f69 6e66  w that guard_inf
-00019a10: 696e 6974 655f 7265 6375 7273 696f 6e20  inite_recursion 
-00019a20: 6361 6e20 6265 2075 7365 640a 2020 2020  can be used.    
-00019a30: 746f 2067 7561 7264 2063 7573 746f 6d20  to guard custom 
-00019a40: 5f5f 6861 7368 5f5f 2069 6d70 6c65 6d65  __hash__ impleme
-00019a50: 6e74 6174 696f 6e73 2061 7320 7765 6c6c  ntations as well
-00019a60: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-00019a70: 206e 6f74 2061 7267 733a 0a20 2020 2020   not args:.     
-00019a80: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00019a90: 726f 7228 2267 7561 7264 5f69 6e66 696e  ror("guard_infin
-00019aa0: 6974 655f 7265 6375 7273 696f 6e20 6e65  ite_recursion ne
-00019ab0: 6564 7320 6174 206c 6561 7374 206f 6e65  eds at least one
-00019ac0: 2061 7267 2229 0a20 2020 206b 6579 203d   arg").    key =
-00019ad0: 2074 7570 6c65 2869 6428 6172 6729 2066   tuple(id(arg) f
-00019ae0: 6f72 2061 7267 2069 6e20 6172 6773 290a  or arg in args).
-00019af0: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-00019b00: 7472 285f 6775 6172 645f 696e 6669 6e69  tr(_guard_infini
-00019b10: 7465 5f72 6563 7572 7369 6f6e 5f63 6163  te_recursion_cac
-00019b20: 6865 2c20 2263 6163 6865 2229 3a0a 2020  he, "cache"):.  
-00019b30: 2020 2020 2020 5f67 7561 7264 5f69 6e66        _guard_inf
-00019b40: 696e 6974 655f 7265 6375 7273 696f 6e5f  inite_recursion_
-00019b50: 6361 6368 652e 6361 6368 6520 3d20 7365  cache.cache = se
-00019b60: 7428 290a 2020 2020 6966 206b 6579 2069  t().    if key i
-00019b70: 6e20 5f67 7561 7264 5f69 6e66 696e 6974  n _guard_infinit
-00019b80: 655f 7265 6375 7273 696f 6e5f 6361 6368  e_recursion_cach
-00019b90: 652e 6361 6368 653a 0a20 2020 2020 2020  e.cache:.       
-00019ba0: 2072 6169 7365 2049 6e66 696e 6974 6552   raise InfiniteR
-00019bb0: 6563 7572 7369 6f6e 4465 7465 6374 6564  ecursionDetected
-00019bc0: 2822 696e 6669 6e69 7465 2072 6563 7572  ("infinite recur
-00019bd0: 7369 6f6e 2064 6574 6563 7465 6422 290a  sion detected").
-00019be0: 2020 2020 5f67 7561 7264 5f69 6e66 696e      _guard_infin
-00019bf0: 6974 655f 7265 6375 7273 696f 6e5f 6361  ite_recursion_ca
-00019c00: 6368 652e 6361 6368 652e 6164 6428 6b65  che.cache.add(ke
-00019c10: 7929 0a20 2020 2074 7279 3a0a 2020 2020  y).    try:.    
-00019c20: 2020 2020 7969 656c 640a 2020 2020 6669      yield.    fi
-00019c30: 6e61 6c6c 793a 0a20 2020 2020 2020 205f  nally:.        _
-00019c40: 6775 6172 645f 696e 6669 6e69 7465 5f72  guard_infinite_r
-00019c50: 6563 7572 7369 6f6e 5f63 6163 6865 2e63  ecursion_cache.c
-00019c60: 6163 6865 2e72 656d 6f76 6528 6b65 7929  ache.remove(key)
-00019c70: 0a0a 0a64 6566 2063 616d 656c 5f63 6173  ...def camel_cas
-00019c80: 655f 746f 5f73 6e61 6b65 5f63 6173 6528  e_to_snake_case(
-00019c90: 6e61 6d65 293a 0a20 2020 2022 2222 0a20  name):.    """. 
-00019ca0: 2020 203a 7061 7261 6d20 7374 7220 6e61     :param str na
-00019cb0: 6d65 3a20 652e 672e 2022 4361 6d65 6c43  me: e.g. "CamelC
-00019cc0: 6173 6522 0a20 2020 203a 7265 7475 726e  ase".    :return
-00019cd0: 3a20 652e 672e 2022 6361 6d65 6c5f 6361  : e.g. "camel_ca
-00019ce0: 7365 220a 2020 2020 3a72 7479 7065 3a20  se".    :rtype: 
-00019cf0: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
-00019d00: 7331 203d 2072 652e 7375 6228 2228 2e29  s1 = re.sub("(.)
-00019d10: 285b 412d 5a5d 5b61 2d7a 5d2b 2922 2c20  ([A-Z][a-z]+)", 
-00019d20: 7222 5c31 5f5c 3222 2c20 6e61 6d65 290a  r"\1_\2", name).
-00019d30: 2020 2020 7265 7475 726e 2072 652e 7375      return re.su
-00019d40: 6228 2228 5b61 2d7a 302d 395d 2928 5b41  b("([a-z0-9])([A
-00019d50: 2d5a 5d29 222c 2072 225c 315f 5c32 222c  -Z])", r"\1_\2",
-00019d60: 2073 3129 2e6c 6f77 6572 2829 0a0a 0a64   s1).lower()...d
-00019d70: 6566 2067 6574 5f68 6f73 746e 616d 6528  ef get_hostname(
-00019d80: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00019d90: 7265 7475 726e 3a20 652e 672e 2022 636c  return: e.g. "cl
-00019da0: 7573 7465 722d 636e 2d32 3131 220a 2020  uster-cn-211".  
-00019db0: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-00019dc0: 2020 2222 220a 2020 2020 2320 6368 6563    """.    # chec
-00019dd0: 6b5f 6f75 7470 7574 285b 2268 6f73 746e  k_output(["hostn
-00019de0: 616d 6522 5d29 2e73 7472 6970 2829 2e64  ame"]).strip().d
-00019df0: 6563 6f64 6528 2275 7466 3822 290a 2020  ecode("utf8").  
-00019e00: 2020 696d 706f 7274 2073 6f63 6b65 740a    import socket.
-00019e10: 0a20 2020 2072 6574 7572 6e20 736f 636b  .    return sock
-00019e20: 6574 2e67 6574 686f 7374 6e61 6d65 2829  et.gethostname()
-00019e30: 0a0a 0a64 6566 2069 735f 7275 6e6e 696e  ...def is_runnin
-00019e40: 675f 6f6e 5f63 6c75 7374 6572 2829 3a0a  g_on_cluster():.
-00019e50: 2020 2020 2222 220a 2020 2020 3a72 6574      """.    :ret
-00019e60: 7572 6e3a 2069 3620 7370 6563 6966 6963  urn: i6 specific
-00019e70: 2e20 5768 6574 6865 7220 7765 2072 756e  . Whether we run
-00019e80: 206f 6e20 736f 6d65 206f 6620 7468 6520   on some of the 
-00019e90: 636c 7573 7465 7220 6e6f 6465 732e 0a20  cluster nodes.. 
-00019ea0: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
-00019eb0: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
-00019ec0: 726e 2067 6574 5f68 6f73 746e 616d 6528  rn get_hostname(
-00019ed0: 292e 7374 6172 7473 7769 7468 2822 636c  ).startswith("cl
-00019ee0: 7573 7465 722d 636e 2d22 2920 6f72 2067  uster-cn-") or g
-00019ef0: 6574 5f68 6f73 746e 616d 6528 292e 7374  et_hostname().st
-00019f00: 6172 7473 7769 7468 2822 636e 2d22 290a  artswith("cn-").
-00019f10: 0a0a 7374 6172 745f 7469 6d65 203d 2074  ..start_time = t
-00019f20: 696d 652e 7469 6d65 2829 0a0a 0a64 6566  ime.time()...def
-00019f30: 2067 6574 5f75 7463 5f73 7461 7274 5f74   get_utc_start_t
-00019f40: 696d 655f 6669 6c65 6e61 6d65 5f70 6172  ime_filename_par
-00019f50: 7428 293a 0a20 2020 2022 2222 0a20 2020  t():.    """.   
-00019f60: 203a 7265 7475 726e 3a20 7374 7269 6e67   :return: string
-00019f70: 2077 6869 6368 2063 616e 2062 6520 7573   which can be us
-00019f80: 6564 2061 7320 7061 7274 206f 6620 6120  ed as part of a 
-00019f90: 6669 6c65 6e61 6d65 2c20 7768 6963 6820  filename, which 
-00019fa0: 7265 7072 6573 656e 7473 2074 6865 2073  represents the s
-00019fb0: 7461 7274 2074 696d 6520 6f66 2052 4554  tart time of RET
-00019fc0: 5552 4e4e 2069 6e20 5554 430a 2020 2020  URNN in UTC.    
-00019fd0: 3a72 7479 7065 3a20 7374 720a 2020 2020  :rtype: str.    
-00019fe0: 2222 220a 2020 2020 7265 7475 726e 2074  """.    return t
-00019ff0: 696d 652e 7374 7266 7469 6d65 2822 2559  ime.strftime("%Y
-0001a000: 2d25 6d2d 2564 2d25 482d 254d 2d25 5322  -%m-%d-%H-%M-%S"
-0001a010: 2c20 7469 6d65 2e67 6d74 696d 6528 7374  , time.gmtime(st
-0001a020: 6172 745f 7469 6d65 2929 0a0a 0a64 6566  art_time))...def
-0001a030: 206d 6179 6265 5f6d 616b 655f 6469 7273   maybe_make_dirs
-0001a040: 2864 6972 6e61 6d65 293a 0a20 2020 2022  (dirname):.    "
-0001a050: 2222 0a20 2020 2043 7265 6174 6573 2074  "".    Creates t
-0001a060: 6865 2064 6972 6563 746f 7279 2069 6620  he directory if 
-0001a070: 6974 2064 6f65 7320 6e6f 7420 7965 7420  it does not yet 
-0001a080: 6578 6973 742e 0a0a 2020 2020 3a70 6172  exist...    :par
-0001a090: 616d 2073 7472 2064 6972 6e61 6d65 3a20  am str dirname: 
-0001a0a0: 5468 6520 7061 7468 206f 6620 7468 6520  The path of the 
-0001a0b0: 6469 7265 6374 6f72 790a 2020 2020 2222  directory.    ""
-0001a0c0: 220a 2020 2020 696d 706f 7274 206f 730a  ".    import os.
-0001a0d0: 0a20 2020 2069 6620 6e6f 7420 6f73 2e70  .    if not os.p
-0001a0e0: 6174 682e 6578 6973 7473 2864 6972 6e61  ath.exists(dirna
-0001a0f0: 6d65 293a 0a20 2020 2020 2020 2074 7279  me):.        try
-0001a100: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-0001a110: 2e6d 616b 6564 6972 7328 6469 726e 616d  .makedirs(dirnam
-0001a120: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
-0001a130: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-0001a140: 7863 3a0a 2020 2020 2020 2020 2020 2020  xc:.            
-0001a150: 7072 696e 7428 226d 6179 6265 5f63 7265  print("maybe_cre
-0001a160: 6174 655f 666f 6c64 6572 3a20 6578 6365  ate_folder: exce
-0001a170: 7074 696f 6e20 6372 6561 7469 6e67 2064  ption creating d
-0001a180: 6972 3a22 2c20 6578 6329 0a20 2020 2020  ir:", exc).     
-0001a190: 2020 2020 2020 2023 204d 6179 6265 2061         # Maybe a
-0001a1a0: 2063 6f6e 6375 7272 656e 7420 7072 6f63   concurrent proc
-0001a1b0: 6573 732c 2065 2e67 2e20 7466 2e63 6f6d  ess, e.g. tf.com
-0001a1c0: 7061 742e 7631 2e73 756d 6d61 7279 2e46  pat.v1.summary.F
-0001a1d0: 696c 6557 7269 7465 7220 6372 6561 7465  ileWriter create
-0001a1e0: 6420 6974 2069 6e20 7468 6520 6d65 616e  d it in the mean
-0001a1f0: 2d77 6869 6c65 2c0a 2020 2020 2020 2020  -while,.        
-0001a200: 2020 2020 2320 736f 2074 6865 6e20 6974      # so then it
-0001a210: 2077 6f75 6c64 2062 6520 6f6b 206e 6f77   would be ok now
-0001a220: 2069 6620 6974 2065 7869 7374 732c 2062   if it exists, b
-0001a230: 7574 2066 6169 6c20 6966 2069 7420 646f  ut fail if it do
-0001a240: 6573 206e 6f74 2065 7869 7374 2e0a 2020  es not exist..  
-0001a250: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0001a260: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001a270: 6469 726e 616d 6529 0a0a 0a64 6566 206c  dirname)...def l
-0001a280: 6f67 5f72 756e 7469 6d65 5f69 6e66 6f5f  og_runtime_info_
-0001a290: 746f 5f64 6972 2870 6174 682c 2063 6f6e  to_dir(path, con
-0001a2a0: 6669 6729 3a0a 2020 2020 2222 220a 2020  fig):.    """.  
-0001a2b0: 2020 5468 6973 2077 696c 6c20 7772 6974    This will writ
-0001a2c0: 6520 6d75 6c74 6970 6c65 206c 6f67 6769  e multiple loggi
-0001a2d0: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2069  ng information i
-0001a2e0: 6e74 6f20 7468 6520 7061 7468 2e0a 2020  nto the path..  
-0001a2f0: 2020 4974 2077 696c 6c20 6372 6561 7465    It will create
-0001a300: 2072 6574 7572 6e6e 2e2a 2e6c 6f67 2077   returnn.*.log w
-0001a310: 6974 6820 736f 6d65 206d 6574 6120 696e  ith some meta in
-0001a320: 666f 726d 6174 696f 6e2c 0a20 2020 2061  formation,.    a
-0001a330: 7320 7765 6c6c 2061 7320 636f 7079 2074  s well as copy t
-0001a340: 6865 2075 7365 6420 636f 6e66 6967 2066  he used config f
-0001a350: 696c 652e 0a0a 2020 2020 3a70 6172 616d  ile...    :param
-0001a360: 2073 7472 2070 6174 683a 2064 6972 6563   str path: direc
-0001a370: 746f 7279 2070 6174 680a 2020 2020 3a70  tory path.    :p
-0001a380: 6172 616d 2072 6574 7572 6e6e 2e63 6f6e  aram returnn.con
-0001a390: 6669 672e 436f 6e66 6967 2063 6f6e 6669  fig.Config confi
-0001a3a0: 673a 0a20 2020 2022 2222 0a20 2020 2069  g:.    """.    i
-0001a3b0: 6d70 6f72 7420 6f73 0a20 2020 2069 6d70  mport os.    imp
-0001a3c0: 6f72 7420 7379 730a 2020 2020 696d 706f  ort sys.    impo
-0001a3d0: 7274 2073 6875 7469 6c0a 2020 2020 6672  rt shutil.    fr
-0001a3e0: 6f6d 2072 6574 7572 6e6e 2e63 6f6e 6669  om returnn.confi
-0001a3f0: 6720 696d 706f 7274 2043 6f6e 6669 670a  g import Config.
-0001a400: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-0001a410: 2020 686f 7374 6e61 6d65 203d 2067 6574    hostname = get
-0001a420: 5f68 6f73 746e 616d 6528 290a 2020 2020  _hostname().    
-0001a430: 2020 2020 636f 6e74 656e 7420 3d20 5b0a      content = [.
-0001a440: 2020 2020 2020 2020 2020 2020 2254 696d              "Tim
-0001a450: 653a 2025 7322 2025 2074 696d 652e 7374  e: %s" % time.st
-0001a460: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
-0001a470: 2025 483a 254d 3a25 5322 2c20 7469 6d65   %H:%M:%S", time
-0001a480: 2e67 6d74 696d 6528 7374 6172 745f 7469  .gmtime(start_ti
-0001a490: 6d65 2929 2c0a 2020 2020 2020 2020 2020  me)),.          
-0001a4a0: 2020 2243 616c 6c3a 2025 7322 2025 2028    "Call: %s" % (
-0001a4b0: 7379 732e 6172 6776 2c29 2c0a 2020 2020  sys.argv,),.    
-0001a4c0: 2020 2020 2020 2020 2250 6174 683a 2025          "Path: %
-0001a4d0: 7322 2025 2028 6f73 2e67 6574 6377 6428  s" % (os.getcwd(
-0001a4e0: 292c 292c 0a20 2020 2020 2020 2020 2020  ),),.           
-0001a4f0: 2022 486f 7374 6e61 6d65 3a20 2573 2220   "Hostname: %s" 
-0001a500: 2520 6765 745f 686f 7374 6e61 6d65 2829  % get_hostname()
-0001a510: 2c0a 2020 2020 2020 2020 2020 2020 2250  ,.            "P
-0001a520: 4944 3a20 2569 2220 2520 6f73 2e67 6574  ID: %i" % os.get
-0001a530: 7069 6428 292c 0a20 2020 2020 2020 2020  pid(),.         
-0001a540: 2020 2022 5265 7475 726e 6e3a 2025 7322     "Returnn: %s"
-0001a550: 2025 2028 6465 7363 7269 6265 5f72 6574   % (describe_ret
-0001a560: 7572 6e6e 5f76 6572 7369 6f6e 2829 2c29  urnn_version(),)
-0001a570: 2c0a 2020 2020 2020 2020 2020 2020 2254  ,.            "T
-0001a580: 656e 736f 7246 6c6f 773a 2025 7322 2025  ensorFlow: %s" %
-0001a590: 2028 6465 7363 7269 6265 5f74 656e 736f   (describe_tenso
-0001a5a0: 7266 6c6f 775f 7665 7273 696f 6e28 292c  rflow_version(),
-0001a5b0: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
-0001a5c0: 436f 6e66 6967 2066 696c 6573 3a20 2573  Config files: %s
-0001a5d0: 2220 2520 2863 6f6e 6669 672e 6669 6c65  " % (config.file
-0001a5e0: 732c 292c 0a20 2020 2020 2020 205d 0a20  s,),.        ]. 
-0001a5f0: 2020 2020 2020 206d 6179 6265 5f6d 616b         maybe_mak
-0001a600: 655f 6469 7273 2870 6174 6829 0a20 2020  e_dirs(path).   
-0001a610: 2020 2020 206c 6f67 5f66 6e20 3d20 2225       log_fn = "%
-0001a620: 732f 7265 7475 726e 6e2e 2573 2e25 732e  s/returnn.%s.%s.
-0001a630: 2569 2e6c 6f67 2220 2520 2870 6174 682c  %i.log" % (path,
-0001a640: 2067 6574 5f75 7463 5f73 7461 7274 5f74   get_utc_start_t
-0001a650: 696d 655f 6669 6c65 6e61 6d65 5f70 6172  ime_filename_par
-0001a660: 7428 292c 2068 6f73 746e 616d 652c 206f  t(), hostname, o
-0001a670: 732e 6765 7470 6964 2829 290a 2020 2020  s.getpid()).    
-0001a680: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001a690: 7468 2e65 7869 7374 7328 6c6f 675f 666e  th.exists(log_fn
-0001a6a0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
-0001a6b0: 6974 6820 6f70 656e 286c 6f67 5f66 6e2c  ith open(log_fn,
-0001a6c0: 2022 7722 2920 6173 2066 3a0a 2020 2020   "w") as f:.    
-0001a6d0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-0001a6e0: 6974 6528 2252 6574 7572 6e6e 206c 6f67  ite("Returnn log
-0001a6f0: 2066 696c 653a 5c6e 2220 2b20 2222 2e6a   file:\n" + "".j
-0001a700: 6f69 6e28 5b22 2573 5c6e 2220 2520 7320  oin(["%s\n" % s 
-0001a710: 666f 7220 7320 696e 2063 6f6e 7465 6e74  for s in content
-0001a720: 5d29 202b 2022 5c6e 2229 0a20 2020 2020  ]) + "\n").     
-0001a730: 2020 2066 6f72 2066 6e20 696e 2063 6f6e     for fn in con
-0001a740: 6669 672e 6669 6c65 733a 0a20 2020 2020  fig.files:.     
-0001a750: 2020 2020 2020 2062 6173 655f 666e 203d         base_fn =
-0001a760: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-0001a770: 6528 666e 290a 2020 2020 2020 2020 2020  e(fn).          
-0001a780: 2020 7461 7267 6574 5f66 6e20 3d20 2225    target_fn = "%
-0001a790: 732f 2573 2220 2520 2870 6174 682c 2062  s/%s" % (path, b
-0001a7a0: 6173 655f 666e 290a 2020 2020 2020 2020  ase_fn).        
-0001a7b0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-0001a7c0: 7869 7374 7328 7461 7267 6574 5f66 6e29  xists(target_fn)
-0001a7d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a7e0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001a7f0: 2020 2020 2020 2073 6875 7469 6c2e 636f         shutil.co
-0001a800: 7079 2866 6e2c 2074 6172 6765 745f 666e  py(fn, target_fn
-0001a810: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-0001a820: 6e66 6967 5f74 7970 6520 3d20 436f 6e66  nfig_type = Conf
-0001a830: 6967 2e67 6574 5f63 6f6e 6669 675f 6669  ig.get_config_fi
-0001a840: 6c65 5f74 7970 6528 666e 290a 2020 2020  le_type(fn).    
-0001a850: 2020 2020 2020 2020 636f 6d6d 656e 745f          comment_
-0001a860: 7072 6566 6978 203d 2022 2322 0a20 2020  prefix = "#".   
-0001a870: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-0001a880: 6967 5f74 7970 6520 3d3d 2022 6a73 223a  ig_type == "js":
-0001a890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a8a0: 2063 6f6d 6d65 6e74 5f70 7265 6669 7820   comment_prefix 
-0001a8b0: 3d20 222f 2f22 0a20 2020 2020 2020 2020  = "//".         
-0001a8c0: 2020 2077 6974 6820 6f70 656e 2874 6172     with open(tar
-0001a8d0: 6765 745f 666e 2c20 2261 2229 2061 7320  get_fn, "a") as 
-0001a8e0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0001a8f0: 2020 2066 2e77 7269 7465 280a 2020 2020     f.write(.    
-0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a910: 225c 6e5c 6e5c 6e22 0a20 2020 2020 2020  "\n\n\n".       
-0001a920: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0001a930: 222e 6a6f 696e 280a 2020 2020 2020 2020  ".join(.        
-0001a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a950: 5b22 2573 2043 6f6e 6669 672d 6669 6c65  ["%s Config-file
-0001a960: 2063 6f70 6965 6420 666f 7220 6c6f 6767   copied for logg
-0001a970: 696e 6720 7075 7270 6f73 6520 6279 2052  ing purpose by R
-0001a980: 6574 7572 6e6e 2e5c 6e22 2025 2063 6f6d  eturnn.\n" % com
-0001a990: 6d65 6e74 5f70 7265 6669 785d 0a20 2020  ment_prefix].   
-0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9b0: 2020 2020 202b 205b 2225 7320 2573 5c6e       + ["%s %s\n
-0001a9c0: 2220 2520 2863 6f6d 6d65 6e74 5f70 7265  " % (comment_pre
-0001a9d0: 6669 782c 2073 2920 666f 7220 7320 696e  fix, s) for s in
-0001a9e0: 2063 6f6e 7465 6e74 5d0a 2020 2020 2020   content].      
-0001a9f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000cab0: 6966 2063 2e69 7373 7061 6365 2829 3a0a  if c.isspace():.
+0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cad0: 2020 2020 2020 2020 7265 7420 2b3d 205b          ret += [
+0000cae0: 2222 5d0a 2020 2020 2020 2020 2020 2020  ""].            
+0000caf0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb10: 2020 2020 2020 6966 206e 6f74 2072 6574        if not ret
+0000cb20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cb30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000cb40: 7420 2b3d 205b 2222 5d0a 2020 2020 2020  t += [""].      
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb60: 2020 7265 745b 2d31 5d20 2b3d 2063 0a20    ret[-1] += c. 
+0000cb70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000cb80: 6c73 653a 2020 2320 6e6f 7420 776f 7264  lse:  # not word
+0000cb90: 5f62 6173 6564 0a20 2020 2020 2020 2020  _based.         
+0000cba0: 2020 2020 2020 2020 2020 2072 6574 202b             ret +
+0000cbb0: 3d20 630a 2020 2020 7265 7475 726e 2072  = c.    return r
+0000cbc0: 6574 0a0a 0a64 6566 2070 6172 7365 5f6f  et...def parse_o
+0000cbd0: 7274 686f 6772 6170 6879 280a 2020 2020  rthography(.    
+0000cbe0: 6f72 7468 6f67 7261 7068 792c 2070 7265  orthography, pre
+0000cbf0: 6669 783d 2829 2c20 706f 7374 6669 783d  fix=(), postfix=
+0000cc00: 2822 5b45 4e44 5d22 2c29 2c20 7265 6d6f  ("[END]",), remo
+0000cc10: 7665 5f63 6861 7273 3d22 2829 7b7d 222c  ve_chars="(){}",
+0000cc20: 2063 6f6c 6c61 7073 655f 7370 6163 6573   collapse_spaces
+0000cc30: 3d54 7275 652c 2066 696e 616c 5f73 7472  =True, final_str
+0000cc40: 6970 3d54 7275 652c 202a 2a6b 7761 7267  ip=True, **kwarg
+0000cc50: 730a 293a 0a20 2020 2022 2222 0a20 2020  s.):.    """.   
+0000cc60: 2046 6f72 2053 7065 6563 682e 2046 756c   For Speech. Ful
+0000cc70: 6c20 7072 6f63 6573 7369 6e67 2e0a 2020  l processing..  
+0000cc80: 2020 4578 616d 706c 653a 0a20 2020 2020    Example:.     
+0000cc90: 206f 7274 686f 6772 6170 6879 203d 2022   orthography = "
+0000cca0: 6865 6c6c 6f20 5b48 4553 4954 4154 494f  hello [HESITATIO
+0000ccb0: 4e5d 2074 6865 7265 2022 0a20 2020 2020  N] there ".     
+0000ccc0: 2077 6974 6820 776f 7264 5f62 6173 6564   with word_based
+0000ccd0: 203d 3d20 4661 6c73 653a 2072 6574 7572   == False: retur
+0000cce0: 6e73 206c 6973 7428 2268 656c 6c6f 2022  ns list("hello "
+0000ccf0: 2920 2b20 5b22 5b48 4553 4954 4154 494f  ) + ["[HESITATIO
+0000cd00: 4e5d 225d 202b 206c 6973 7428 2220 7468  N]"] + list(" th
+0000cd10: 6572 6522 2920 2b20 5b22 5b45 4e44 5d22  ere") + ["[END]"
+0000cd20: 5d0a 2020 2020 2020 7769 7468 2077 6f72  ].      with wor
+0000cd30: 645f 6261 7365 6420 3d3d 2054 7275 653a  d_based == True:
+0000cd40: 2072 6574 7572 6e73 205b 2268 656c 6c6f   returns ["hello
+0000cd50: 222c 2022 5b48 4553 4954 4154 494f 4e5d  ", "[HESITATION]
+0000cd60: 222c 2022 7468 6572 6522 2c20 225b 454e  ", "there", "[EN
+0000cd70: 445d 225d 0a20 2020 2044 6f65 7320 736f  D]"].    Does so
+0000cd80: 6d65 2070 7265 7072 6f63 6573 7369 6e67  me preprocessing
+0000cd90: 206f 6e20 6f72 7468 6f67 7261 7068 7920   on orthography 
+0000cda0: 616e 6420 7468 656e 2070 6173 7365 7320  and then passes 
+0000cdb0: 6974 206f 6e20 746f 2070 6172 7365 5f6f  it on to parse_o
+0000cdc0: 7274 686f 6772 6170 6879 5f69 6e74 6f5f  rthography_into_
+0000cdd0: 7379 6d62 6f6c 7328 292e 0a0a 2020 2020  symbols()...    
+0000cde0: 3a70 6172 616d 2073 7472 206f 7274 686f  :param str ortho
+0000cdf0: 6772 6170 6879 3a20 652e 672e 2022 6865  graphy: e.g. "he
+0000ce00: 6c6c 6f20 5b48 4553 4954 4154 494f 4e5d  llo [HESITATION]
+0000ce10: 2074 6865 7265 2022 0a20 2020 203a 7061   there ".    :pa
+0000ce20: 7261 6d20 6c69 7374 5b73 7472 5d20 7072  ram list[str] pr
+0000ce30: 6566 6978 3a20 7769 6c6c 2061 6464 2074  efix: will add t
+0000ce40: 6869 7320 7072 6566 6978 0a20 2020 203a  his prefix.    :
+0000ce50: 7061 7261 6d20 6c69 7374 5b73 7472 5d20  param list[str] 
+0000ce60: 706f 7374 6669 783a 2077 696c 6c20 6164  postfix: will ad
+0000ce70: 6420 7468 6973 2070 6f73 7466 6978 0a20  d this postfix. 
+0000ce80: 2020 203a 7061 7261 6d20 7374 7220 7265     :param str re
+0000ce90: 6d6f 7665 5f63 6861 7273 3a20 7468 6f73  move_chars: thos
+0000cea0: 6520 6368 6172 7320 7769 6c6c 206a 7573  e chars will jus
+0000ceb0: 7420 6265 2072 656d 6f76 6564 2061 7420  t be removed at 
+0000cec0: 7468 6520 6265 6769 6e6e 696e 670a 2020  the beginning.  
+0000ced0: 2020 3a70 6172 616d 2062 6f6f 6c20 636f    :param bool co
+0000cee0: 6c6c 6170 7365 5f73 7061 6365 733a 2077  llapse_spaces: w
+0000cef0: 6865 7468 6572 206d 756c 7469 706c 6520  hether multiple 
+0000cf00: 7370 6163 6573 2061 6e64 2074 6162 7320  spaces and tabs 
+0000cf10: 6172 6520 636f 6c6c 6170 7365 6420 696e  are collapsed in
+0000cf20: 746f 2061 2073 696e 676c 6520 7370 6163  to a single spac
+0000cf30: 650a 2020 2020 3a70 6172 616d 2062 6f6f  e.    :param boo
+0000cf40: 6c20 6669 6e61 6c5f 7374 7269 703a 2077  l final_strip: w
+0000cf50: 6865 7468 6572 2077 6520 7374 7269 7020  hether we strip 
+0000cf60: 6c65 6674 2061 6e64 2072 6967 6874 0a20  left and right. 
+0000cf70: 2020 203a 7061 7261 6d20 6b77 6172 6773     :param kwargs
+0000cf80: 3a20 7061 7373 6564 206f 6e20 746f 2070  : passed on to p
+0000cf90: 6172 7365 5f6f 7274 686f 6772 6170 6879  arse_orthography
+0000cfa0: 5f69 6e74 6f5f 7379 6d62 6f6c 7328 290a  _into_symbols().
+0000cfb0: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
+0000cfc0: 5b73 7472 5d0a 2020 2020 2222 220a 2020  [str].    """.  
+0000cfd0: 2020 666f 7220 6320 696e 2072 656d 6f76    for c in remov
+0000cfe0: 655f 6368 6172 733a 0a20 2020 2020 2020  e_chars:.       
+0000cff0: 206f 7274 686f 6772 6170 6879 203d 206f   orthography = o
+0000d000: 7274 686f 6772 6170 6879 2e72 6570 6c61  rthography.repla
+0000d010: 6365 2863 2c20 2222 290a 2020 2020 6966  ce(c, "").    if
+0000d020: 2063 6f6c 6c61 7073 655f 7370 6163 6573   collapse_spaces
+0000d030: 3a0a 2020 2020 2020 2020 6f72 7468 6f67  :.        orthog
+0000d040: 7261 7068 7920 3d20 2220 222e 6a6f 696e  raphy = " ".join
+0000d050: 286f 7274 686f 6772 6170 6879 2e73 706c  (orthography.spl
+0000d060: 6974 2829 290a 2020 2020 6966 2066 696e  it()).    if fin
+0000d070: 616c 5f73 7472 6970 3a0a 2020 2020 2020  al_strip:.      
+0000d080: 2020 6f72 7468 6f67 7261 7068 7920 3d20    orthography = 
+0000d090: 6f72 7468 6f67 7261 7068 792e 7374 7269  orthography.stri
+0000d0a0: 7028 290a 2020 2020 7265 7475 726e 206c  p().    return l
+0000d0b0: 6973 7428 7072 6566 6978 2920 2b20 7061  ist(prefix) + pa
+0000d0c0: 7273 655f 6f72 7468 6f67 7261 7068 795f  rse_orthography_
+0000d0d0: 696e 746f 5f73 796d 626f 6c73 286f 7274  into_symbols(ort
+0000d0e0: 686f 6772 6170 6879 2c20 2a2a 6b77 6172  hography, **kwar
+0000d0f0: 6773 2920 2b20 6c69 7374 2870 6f73 7466  gs) + list(postf
+0000d100: 6978 290a 0a0a 6465 6620 6a73 6f6e 5f72  ix)...def json_r
+0000d110: 656d 6f76 655f 636f 6d6d 656e 7473 2873  emove_comments(s
+0000d120: 7472 696e 672c 2073 7472 6970 5f73 7061  tring, strip_spa
+0000d130: 6365 3d54 7275 6529 3a0a 2020 2020 2222  ce=True):.    ""
+0000d140: 220a 2020 2020 3a74 7970 6520 7374 7269  ".    :type stri
+0000d150: 6e67 3a20 7374 720a 2020 2020 3a70 6172  ng: str.    :par
+0000d160: 616d 2062 6f6f 6c20 7374 7269 705f 7370  am bool strip_sp
+0000d170: 6163 653a 0a20 2020 203a 7274 7970 653a  ace:.    :rtype:
+0000d180: 2073 7472 0a0a 2020 2020 7669 6120 6874   str..    via ht
+0000d190: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+0000d1a0: 2f67 6574 6966 792f 4a53 4f4e 2e6d 696e  /getify/JSON.min
+0000d1b0: 6966 792f 626c 6f62 2f6d 6173 7465 722f  ify/blob/master/
+0000d1c0: 6d69 6e69 6679 5f6a 736f 6e2e 7079 2c0a  minify_json.py,.
+0000d1d0: 2020 2020 6279 2047 6572 616c 6420 5374      by Gerald St
+0000d1e0: 6f72 6572 2c20 5072 6164 7975 6e20 532e  orer, Pradyun S.
+0000d1f0: 2047 6564 616d 2c20 6d6f 6469 6669 6564   Gedam, modified
+0000d200: 2062 7920 7573 2e0a 2020 2020 2222 220a   by us..    """.
+0000d210: 2020 2020 746f 6b65 6e69 7a65 7220 3d20      tokenizer = 
+0000d220: 7265 2e63 6f6d 7069 6c65 2827 227c 282f  re.compile('"|(/
+0000d230: 5c5c 2a29 7c28 5c5c 2a2f 297c 282f 2f29  \\*)|(\\*/)|(//)
+0000d240: 7c5c 6e7c 5c72 2729 0a20 2020 2065 6e64  |\n|\r').    end
+0000d250: 5f73 6c61 7368 6573 5f72 6520 3d20 7265  _slashes_re = re
+0000d260: 2e63 6f6d 7069 6c65 2872 2228 5c5c 292a  .compile(r"(\\)*
+0000d270: 2422 290a 0a20 2020 2069 6e5f 7374 7269  $")..    in_stri
+0000d280: 6e67 203d 2046 616c 7365 0a20 2020 2069  ng = False.    i
+0000d290: 6e5f 6d75 6c74 6920 3d20 4661 6c73 650a  n_multi = False.
+0000d2a0: 2020 2020 696e 5f73 696e 676c 6520 3d20      in_single = 
+0000d2b0: 4661 6c73 650a 0a20 2020 206e 6577 5f73  False..    new_s
+0000d2c0: 7472 203d 205b 5d0a 2020 2020 696e 6465  tr = [].    inde
+0000d2d0: 7820 3d20 300a 0a20 2020 2066 6f72 206d  x = 0..    for m
+0000d2e0: 6174 6368 2069 6e20 7265 2e66 696e 6469  atch in re.findi
+0000d2f0: 7465 7228 746f 6b65 6e69 7a65 722c 2073  ter(tokenizer, s
+0000d300: 7472 696e 6729 3a0a 0a20 2020 2020 2020  tring):..       
+0000d310: 2069 6620 6e6f 7420 2869 6e5f 6d75 6c74   if not (in_mult
+0000d320: 6920 6f72 2069 6e5f 7369 6e67 6c65 293a  i or in_single):
+0000d330: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
+0000d340: 203d 2073 7472 696e 675b 696e 6465 7820   = string[index 
+0000d350: 3a20 6d61 7463 682e 7374 6172 7428 295d  : match.start()]
+0000d360: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d370: 6e6f 7420 696e 5f73 7472 696e 6720 616e  not in_string an
+0000d380: 6420 7374 7269 705f 7370 6163 653a 0a20  d strip_space:. 
+0000d390: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000d3a0: 2072 6570 6c61 6365 2077 6869 7465 2073   replace white s
+0000d3b0: 7061 6365 2061 7320 6465 6669 6e65 6420  pace as defined 
+0000d3c0: 696e 2073 7461 6e64 6172 640a 2020 2020  in standard.    
+0000d3d0: 2020 2020 2020 2020 2020 2020 746d 7020              tmp 
+0000d3e0: 3d20 7265 2e73 7562 2822 5b20 5c74 5c6e  = re.sub("[ \t\n
+0000d3f0: 5c72 5d2b 222c 2022 222c 2074 6d70 290a  \r]+", "", tmp).
+0000d400: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000d410: 7374 722e 6170 7065 6e64 2874 6d70 290a  str.append(tmp).
+0000d420: 0a20 2020 2020 2020 2069 6e64 6578 203d  .        index =
+0000d430: 206d 6174 6368 2e65 6e64 2829 0a20 2020   match.end().   
+0000d440: 2020 2020 2076 616c 203d 206d 6174 6368       val = match
+0000d450: 2e67 726f 7570 2829 0a0a 2020 2020 2020  .group()..      
+0000d460: 2020 6966 2076 616c 203d 3d20 2722 2720    if val == '"' 
+0000d470: 616e 6420 6e6f 7420 2869 6e5f 6d75 6c74  and not (in_mult
+0000d480: 6920 6f72 2069 6e5f 7369 6e67 6c65 293a  i or in_single):
+0000d490: 0a20 2020 2020 2020 2020 2020 2065 7363  .            esc
+0000d4a0: 6170 6564 203d 2065 6e64 5f73 6c61 7368  aped = end_slash
+0000d4b0: 6573 5f72 652e 7365 6172 6368 2873 7472  es_re.search(str
+0000d4c0: 696e 672c 2030 2c20 6d61 7463 682e 7374  ing, 0, match.st
+0000d4d0: 6172 7428 2929 0a0a 2020 2020 2020 2020  art())..        
+0000d4e0: 2020 2020 2320 7374 6172 7420 6f66 2073      # start of s
+0000d4f0: 7472 696e 6720 6f72 2075 6e65 7363 6170  tring or unescap
+0000d500: 6564 2071 756f 7465 2063 6861 7261 6374  ed quote charact
+0000d510: 6572 2074 6f20 656e 6420 7374 7269 6e67  er to end string
+0000d520: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d530: 6e6f 7420 696e 5f73 7472 696e 6720 6f72  not in_string or
+0000d540: 2028 6573 6361 7065 6420 6973 204e 6f6e   (escaped is Non
+0000d550: 6520 6f72 206c 656e 2865 7363 6170 6564  e or len(escaped
+0000d560: 2e67 726f 7570 2829 2920 2520 3220 3d3d  .group()) % 2 ==
+0000d570: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+0000d580: 2020 2020 2069 6e5f 7374 7269 6e67 203d       in_string =
+0000d590: 206e 6f74 2069 6e5f 7374 7269 6e67 0a20   not in_string. 
+0000d5a0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000d5b0: 202d 3d20 3120 2023 2069 6e63 6c75 6465   -= 1  # include
+0000d5c0: 2022 2063 6861 7261 6374 6572 2069 6e20   " character in 
+0000d5d0: 6e65 7874 2063 6174 6368 0a20 2020 2020  next catch.     
+0000d5e0: 2020 2065 6c69 6620 6e6f 7420 2869 6e5f     elif not (in_
+0000d5f0: 7374 7269 6e67 206f 7220 696e 5f6d 756c  string or in_mul
+0000d600: 7469 206f 7220 696e 5f73 696e 676c 6529  ti or in_single)
+0000d610: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000d620: 2076 616c 203d 3d20 222f 2a22 3a0a 2020   val == "/*":.  
+0000d630: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000d640: 5f6d 756c 7469 203d 2054 7275 650a 2020  _multi = True.  
+0000d650: 2020 2020 2020 2020 2020 656c 6966 2076            elif v
+0000d660: 616c 203d 3d20 222f 2f22 3a0a 2020 2020  al == "//":.    
+0000d670: 2020 2020 2020 2020 2020 2020 696e 5f73              in_s
+0000d680: 696e 676c 6520 3d20 5472 7565 0a20 2020  ingle = True.   
+0000d690: 2020 2020 2065 6c69 6620 7661 6c20 3d3d       elif val ==
+0000d6a0: 2022 2a2f 2220 616e 6420 696e 5f6d 756c   "*/" and in_mul
+0000d6b0: 7469 2061 6e64 206e 6f74 2028 696e 5f73  ti and not (in_s
+0000d6c0: 7472 696e 6720 6f72 2069 6e5f 7369 6e67  tring or in_sing
+0000d6d0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0000d6e0: 2069 6e5f 6d75 6c74 6920 3d20 4661 6c73   in_multi = Fals
+0000d6f0: 650a 2020 2020 2020 2020 656c 6966 2076  e.        elif v
+0000d700: 616c 2069 6e20 225c 725c 6e22 2061 6e64  al in "\r\n" and
+0000d710: 206e 6f74 2028 696e 5f6d 756c 7469 206f   not (in_multi o
+0000d720: 7220 696e 5f73 7472 696e 6729 2061 6e64  r in_string) and
+0000d730: 2069 6e5f 7369 6e67 6c65 3a0a 2020 2020   in_single:.    
+0000d740: 2020 2020 2020 2020 696e 5f73 696e 676c          in_singl
+0000d750: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
+0000d760: 2020 656c 6966 206e 6f74 2028 2869 6e5f    elif not ((in_
+0000d770: 6d75 6c74 6920 6f72 2069 6e5f 7369 6e67  multi or in_sing
+0000d780: 6c65 2920 6f72 2028 7661 6c20 696e 2022  le) or (val in "
+0000d790: 205c 725c 6e5c 7422 2061 6e64 2073 7472   \r\n\t" and str
+0000d7a0: 6970 5f73 7061 6365 2929 3a0a 2020 2020  ip_space)):.    
+0000d7b0: 2020 2020 2020 2020 6e65 775f 7374 722e          new_str.
+0000d7c0: 6170 7065 6e64 2876 616c 290a 0a20 2020  append(val)..   
+0000d7d0: 206e 6577 5f73 7472 2e61 7070 656e 6428   new_str.append(
+0000d7e0: 7374 7269 6e67 5b69 6e64 6578 3a5d 290a  string[index:]).
+0000d7f0: 2020 2020 7265 7475 726e 2022 222e 6a6f      return "".jo
+0000d800: 696e 286e 6577 5f73 7472 290a 0a0a 6465  in(new_str)...de
+0000d810: 6620 5f70 7932 5f75 6e69 636f 6465 5f74  f _py2_unicode_t
+0000d820: 6f5f 7374 725f 7265 6375 7273 6976 6528  o_str_recursive(
+0000d830: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+0000d840: 5468 6973 2069 7320 7375 7070 6f73 6564  This is supposed
+0000d850: 2074 6f20 6265 2072 756e 2077 6974 6820   to be run with 
+0000d860: 5079 7468 6f6e 2032 2e0a 2020 2020 416c  Python 2..    Al
+0000d870: 736f 2073 6565 203a 6675 6e63 3a60 6173  so see :func:`as
+0000d880: 5f73 7472 6020 616e 6420 3a66 756e 633a  _str` and :func:
+0000d890: 6070 7932 5f75 7466 385f 7374 725f 746f  `py2_utf8_str_to
+0000d8a0: 5f75 6e69 636f 6465 602e 0a0a 2020 2020  _unicode`...    
+0000d8b0: 3a70 6172 616d 2073 7472 7c75 6e69 636f  :param str|unico
+0000d8c0: 6465 2073 3a20 6f72 2061 6e79 2072 6563  de s: or any rec
+0000d8d0: 7572 7369 7665 2073 7472 7563 7475 7265  ursive structure
+0000d8e0: 2073 7563 6820 6173 2064 6963 742c 206c   such as dict, l
+0000d8f0: 6973 742c 2074 7570 6c65 0a20 2020 203a  ist, tuple.    :
+0000d900: 7265 7475 726e 3a20 5079 7468 6f6e 2032  return: Python 2
+0000d910: 2073 7472 2028 6973 206c 696b 6520 5079   str (is like Py
+0000d920: 7468 6f6e 2033 2055 5446 2d38 2066 6f72  thon 3 UTF-8 for
+0000d930: 6d61 7474 6564 2062 7974 6573 290a 2020  matted bytes).  
+0000d940: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+0000d950: 2020 2222 220a 2020 2020 6966 2069 7369    """.    if isi
+0000d960: 6e73 7461 6e63 6528 732c 2064 6963 7429  nstance(s, dict)
+0000d970: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000d980: 207b 5f70 7932 5f75 6e69 636f 6465 5f74   {_py2_unicode_t
+0000d990: 6f5f 7374 725f 7265 6375 7273 6976 6528  o_str_recursive(
+0000d9a0: 6b65 7929 3a20 5f70 7932 5f75 6e69 636f  key): _py2_unico
+0000d9b0: 6465 5f74 6f5f 7374 725f 7265 6375 7273  de_to_str_recurs
+0000d9c0: 6976 6528 7661 6c75 6529 2066 6f72 206b  ive(value) for k
+0000d9d0: 6579 2c20 7661 6c75 6520 696e 2073 2e69  ey, value in s.i
+0000d9e0: 7465 6d73 2829 7d0a 2020 2020 656c 6966  tems()}.    elif
+0000d9f0: 2069 7369 6e73 7461 6e63 6528 732c 2028   isinstance(s, (
+0000da00: 6c69 7374 2c20 7475 706c 6529 293a 0a20  list, tuple)):. 
+0000da10: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+0000da20: 6b65 5f73 6571 5f6f 665f 7479 7065 2874  ke_seq_of_type(t
+0000da30: 7970 6528 7329 2c20 5b5f 7079 325f 756e  ype(s), [_py2_un
+0000da40: 6963 6f64 655f 746f 5f73 7472 5f72 6563  icode_to_str_rec
+0000da50: 7572 7369 7665 2865 6c65 6d65 6e74 2920  ursive(element) 
+0000da60: 666f 7220 656c 656d 656e 7420 696e 2073  for element in s
+0000da70: 5d29 0a20 2020 2065 6c69 6620 6973 696e  ]).    elif isin
+0000da80: 7374 616e 6365 2873 2c20 756e 6963 6f64  stance(s, unicod
+0000da90: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+0000daa0: 726e 2073 2e65 6e63 6f64 6528 2275 7466  rn s.encode("utf
+0000dab0: 2d38 2229 2020 2320 5079 7468 6f6e 2032  -8")  # Python 2
+0000dac0: 2073 7472 2c20 5079 7468 6f6e 2033 2062   str, Python 3 b
+0000dad0: 7974 6573 0a20 2020 2065 6c73 653a 0a20  ytes.    else:. 
+0000dae0: 2020 2020 2020 2072 6574 7572 6e20 730a         return s.
+0000daf0: 0a0a 6465 6620 6c6f 6164 5f6a 736f 6e28  ..def load_json(
+0000db00: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2063  filename=None, c
+0000db10: 6f6e 7465 6e74 3d4e 6f6e 6529 3a0a 2020  ontent=None):.  
+0000db20: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+0000db30: 2073 7472 7c4e 6f6e 6520 6669 6c65 6e61   str|None filena
+0000db40: 6d65 3a0a 2020 2020 3a70 6172 616d 2073  me:.    :param s
+0000db50: 7472 7c4e 6f6e 6520 636f 6e74 656e 743a  tr|None content:
+0000db60: 0a20 2020 203a 7274 7970 653a 2064 6963  .    :rtype: dic
+0000db70: 745b 7374 725d 0a20 2020 2022 2222 0a20  t[str].    """. 
+0000db80: 2020 2069 6620 636f 6e74 656e 743a 0a20     if content:. 
+0000db90: 2020 2020 2020 2061 7373 6572 7420 6e6f         assert no
+0000dba0: 7420 6669 6c65 6e61 6d65 0a20 2020 2065  t filename.    e
+0000dbb0: 6c73 653a 0a20 2020 2020 2020 2063 6f6e  lse:.        con
+0000dbc0: 7465 6e74 203d 206f 7065 6e28 6669 6c65  tent = open(file
+0000dbd0: 6e61 6d65 292e 7265 6164 2829 0a20 2020  name).read().   
+0000dbe0: 2069 6d70 6f72 7420 6a73 6f6e 0a0a 2020   import json..  
+0000dbf0: 2020 636f 6e74 656e 7420 3d20 6a73 6f6e    content = json
+0000dc00: 5f72 656d 6f76 655f 636f 6d6d 656e 7473  _remove_comments
+0000dc10: 2863 6f6e 7465 6e74 290a 2020 2020 7472  (content).    tr
+0000dc20: 793a 0a20 2020 2020 2020 206a 736f 6e5f  y:.        json_
+0000dc30: 636f 6e74 656e 7420 3d20 6a73 6f6e 2e6c  content = json.l
+0000dc40: 6f61 6473 2863 6f6e 7465 6e74 290a 2020  oads(content).  
+0000dc50: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+0000dc60: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0000dc70: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0000dc80: 6e28 2263 6f6e 6669 6720 6c6f 6f6b 7320  n("config looks 
+0000dc90: 6c69 6b65 204a 534f 4e20 6275 7420 696e  like JSON but in
+0000dca0: 7661 6c69 6420 6a73 6f6e 2063 6f6e 7465  valid json conte
+0000dcb0: 6e74 2c20 2572 2220 2520 6529 0a20 2020  nt, %r" % e).   
+0000dcc0: 2069 6620 6e6f 7420 5059 333a 0a20 2020   if not PY3:.   
+0000dcd0: 2020 2020 206a 736f 6e5f 636f 6e74 656e       json_conten
+0000dce0: 7420 3d20 5f70 7932 5f75 6e69 636f 6465  t = _py2_unicode
+0000dcf0: 5f74 6f5f 7374 725f 7265 6375 7273 6976  _to_str_recursiv
+0000dd00: 6528 6a73 6f6e 5f63 6f6e 7465 6e74 290a  e(json_content).
+0000dd10: 2020 2020 7265 7475 726e 206a 736f 6e5f      return json_
+0000dd20: 636f 6e74 656e 740a 0a0a 636c 6173 7320  content...class 
+0000dd30: 4e75 6d62 6572 7344 6963 743a 0a20 2020  NumbersDict:.   
+0000dd40: 2022 2222 0a20 2020 2049 7427 7320 6d6f   """.    It's mo
+0000dd50: 7374 6c79 206c 696b 6520 6469 6374 5b73  stly like dict[s
+0000dd60: 7472 2c66 6c6f 6174 7c69 6e74 5d20 2620  tr,float|int] & 
+0000dd70: 736f 6d65 206f 7074 696f 6e61 6c20 6272  some optional br
+0000dd80: 6f61 6463 6173 7420 6465 6661 756c 7420  oadcast default 
+0000dd90: 7661 6c75 652e 0a20 2020 2049 7420 696d  value..    It im
+0000dda0: 706c 656d 656e 7473 2074 6865 2073 7461  plements the sta
+0000ddb0: 6e64 6172 6420 6d61 7468 2062 696e 206f  ndard math bin o
+0000ddc0: 7073 2069 6e20 6120 7374 7261 6967 6874  ps in a straight
+0000ddd0: 2d66 6f72 7761 7264 2077 6179 2e0a 2020  -forward way..  
+0000dde0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0000ddf0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6175  _init__(self, au
+0000de00: 746f 5f63 6f6e 7665 7274 3d4e 6f6e 652c  to_convert=None,
+0000de10: 206e 756d 6265 7273 5f64 6963 743d 4e6f   numbers_dict=No
+0000de20: 6e65 2c20 6272 6f61 6463 6173 745f 7661  ne, broadcast_va
+0000de30: 6c75 653d 4e6f 6e65 293a 0a20 2020 2020  lue=None):.     
+0000de40: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0000de50: 7061 7261 6d20 6469 6374 7c4e 756d 6265  param dict|Numbe
+0000de60: 7273 4469 6374 7c54 2061 7574 6f5f 636f  rsDict|T auto_co
+0000de70: 6e76 6572 743a 2066 6972 7374 2061 7267  nvert: first arg
+0000de80: 756d 656e 742c 2073 6f20 7468 6174 2077  ument, so that w
+0000de90: 6520 6361 6e20 6175 746f 6d61 7469 6361  e can automatica
+0000dea0: 6c6c 7920 636f 6e76 6572 742f 636f 7079  lly convert/copy
+0000deb0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000dec0: 6469 6374 206e 756d 6265 7273 5f64 6963  dict numbers_dic
+0000ded0: 743a 0a20 2020 2020 2020 203a 7061 7261  t:.        :para
+0000dee0: 6d20 5420 6272 6f61 6463 6173 745f 7661  m T broadcast_va
+0000def0: 6c75 653a 0a20 2020 2020 2020 2022 2222  lue:.        """
+0000df00: 0a20 2020 2020 2020 2069 6620 6175 746f  .        if auto
+0000df10: 5f63 6f6e 7665 7274 2069 7320 6e6f 7420  _convert is not 
+0000df20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000df30: 2020 6173 7365 7274 2062 726f 6164 6361    assert broadca
+0000df40: 7374 5f76 616c 7565 2069 7320 4e6f 6e65  st_value is None
+0000df50: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000df60: 6572 7420 6e75 6d62 6572 735f 6469 6374  ert numbers_dict
+0000df70: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
+0000df80: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000df90: 6365 2861 7574 6f5f 636f 6e76 6572 742c  ce(auto_convert,
+0000dfa0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0000dfb0: 2020 2020 2020 2020 6e75 6d62 6572 735f          numbers_
+0000dfc0: 6469 6374 203d 2061 7574 6f5f 636f 6e76  dict = auto_conv
+0000dfd0: 6572 740a 2020 2020 2020 2020 2020 2020  ert.            
+0000dfe0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0000dff0: 6175 746f 5f63 6f6e 7665 7274 2c20 4e75  auto_convert, Nu
+0000e000: 6d62 6572 7344 6963 7429 3a0a 2020 2020  mbersDict):.    
+0000e010: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+0000e020: 6572 735f 6469 6374 203d 2061 7574 6f5f  ers_dict = auto_
+0000e030: 636f 6e76 6572 742e 6469 6374 0a20 2020  convert.dict.   
+0000e040: 2020 2020 2020 2020 2020 2020 2062 726f               bro
+0000e050: 6164 6361 7374 5f76 616c 7565 203d 2061  adcast_value = a
+0000e060: 7574 6f5f 636f 6e76 6572 742e 7661 6c75  uto_convert.valu
+0000e070: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+0000e080: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000e090: 2020 2020 6272 6f61 6463 6173 745f 7661      broadcast_va
+0000e0a0: 6c75 6520 3d20 6175 746f 5f63 6f6e 7665  lue = auto_conve
+0000e0b0: 7274 0a20 2020 2020 2020 2069 6620 6e75  rt.        if nu
+0000e0c0: 6d62 6572 735f 6469 6374 2069 7320 4e6f  mbers_dict is No
+0000e0d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000e0e0: 6e75 6d62 6572 735f 6469 6374 203d 207b  numbers_dict = {
+0000e0f0: 7d0a 2020 2020 2020 2020 656c 7365 3a0a  }.        else:.
+0000e100: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+0000e110: 6572 735f 6469 6374 203d 2064 6963 7428  ers_dict = dict(
+0000e120: 6e75 6d62 6572 735f 6469 6374 2920 2023  numbers_dict)  #
+0000e130: 2066 6f72 6365 2063 6f70 790a 0a20 2020   force copy..   
+0000e140: 2020 2020 2073 656c 662e 6469 6374 203d       self.dict =
+0000e150: 206e 756d 6265 7273 5f64 6963 740a 2020   numbers_dict.  
+0000e160: 2020 2020 2020 7365 6c66 2e76 616c 7565        self.value
+0000e170: 203d 2062 726f 6164 6361 7374 5f76 616c   = broadcast_val
+0000e180: 7565 0a20 2020 2020 2020 2073 656c 662e  ue.        self.
+0000e190: 6d61 7820 3d20 7365 6c66 2e5f 6d61 785f  max = self._max_
+0000e1a0: 6572 726f 720a 0a20 2020 2064 6566 2063  error..    def c
+0000e1b0: 6f70 7928 7365 6c66 293a 0a20 2020 2020  opy(self):.     
+0000e1c0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0000e1d0: 7274 7970 653a 204e 756d 6265 7273 4469  rtype: NumbersDi
+0000e1e0: 6374 0a20 2020 2020 2020 2022 2222 0a20  ct.        """. 
+0000e1f0: 2020 2020 2020 2072 6574 7572 6e20 4e75         return Nu
+0000e200: 6d62 6572 7344 6963 7428 7365 6c66 290a  mbersDict(self).
+0000e210: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000e220: 640a 2020 2020 6465 6620 636f 6e73 7461  d.    def consta
+0000e230: 6e74 5f6c 696b 6528 636c 732c 2063 6f6e  nt_like(cls, con
+0000e240: 7374 5f6e 756d 6265 722c 206e 756d 6265  st_number, numbe
+0000e250: 7273 5f64 6963 7429 3a0a 2020 2020 2020  rs_dict):.      
+0000e260: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+0000e270: 6172 616d 2069 6e74 7c66 6c6f 6174 7c6f  aram int|float|o
+0000e280: 626a 6563 7420 636f 6e73 745f 6e75 6d62  bject const_numb
+0000e290: 6572 3a0a 2020 2020 2020 2020 3a70 6172  er:.        :par
+0000e2a0: 616d 204e 756d 6265 7273 4469 6374 206e  am NumbersDict n
+0000e2b0: 756d 6265 7273 5f64 6963 743a 0a20 2020  umbers_dict:.   
+0000e2c0: 2020 2020 203a 7265 7475 726e 3a20 4e75       :return: Nu
+0000e2d0: 6d62 6572 7344 6963 7420 7769 7468 2073  mbersDict with s
+0000e2e0: 616d 6520 6b65 7973 2061 7320 6e75 6d62  ame keys as numb
+0000e2f0: 6572 735f 6469 6374 0a20 2020 2020 2020  ers_dict.       
+0000e300: 203a 7274 7970 653a 204e 756d 6265 7273   :rtype: Numbers
+0000e310: 4469 6374 0a20 2020 2020 2020 2022 2222  Dict.        """
+0000e320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e330: 4e75 6d62 6572 7344 6963 7428 0a20 2020  NumbersDict(.   
+0000e340: 2020 2020 2020 2020 2062 726f 6164 6361           broadca
+0000e350: 7374 5f76 616c 7565 3d63 6f6e 7374 5f6e  st_value=const_n
+0000e360: 756d 6265 7220 6966 2028 6e75 6d62 6572  umber if (number
+0000e370: 735f 6469 6374 2e76 616c 7565 2069 7320  s_dict.value is 
+0000e380: 6e6f 7420 4e6f 6e65 2920 656c 7365 204e  not None) else N
+0000e390: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0000e3a0: 206e 756d 6265 7273 5f64 6963 743d 7b6b   numbers_dict={k
+0000e3b0: 3a20 636f 6e73 745f 6e75 6d62 6572 2066  : const_number f
+0000e3c0: 6f72 206b 2069 6e20 6e75 6d62 6572 735f  or k in numbers_
+0000e3d0: 6469 6374 2e64 6963 742e 6b65 7973 2829  dict.dict.keys()
+0000e3e0: 7d2c 0a20 2020 2020 2020 2029 0a0a 2020  },.        )..  
+0000e3f0: 2020 6465 6620 636f 7079 5f6c 696b 6528    def copy_like(
+0000e400: 7365 6c66 2c20 6e75 6d62 6572 735f 6469  self, numbers_di
+0000e410: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
+0000e420: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000e430: 4e75 6d62 6572 7344 6963 7420 6e75 6d62  NumbersDict numb
+0000e440: 6572 735f 6469 6374 3a0a 2020 2020 2020  ers_dict:.      
+0000e450: 2020 3a72 6574 7572 6e3a 2063 6f70 7920    :return: copy 
+0000e460: 6f66 2073 656c 6620 7769 7468 2073 616d  of self with sam
+0000e470: 6520 6b65 7973 2061 7320 6e75 6d62 6572  e keys as number
+0000e480: 735f 6469 6374 2061 7320 6661 7220 6173  s_dict as far as
+0000e490: 2077 6520 6861 7665 2074 6865 6d0a 2020   we have them.  
+0000e4a0: 2020 2020 2020 3a72 7479 7065 3a20 4e75        :rtype: Nu
+0000e4b0: 6d62 6572 7344 6963 740a 2020 2020 2020  mbersDict.      
+0000e4c0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000e4d0: 2073 656c 662e 7661 6c75 6520 6973 206e   self.value is n
+0000e4e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000e4f0: 2020 2020 2072 6574 7572 6e20 4e75 6d62       return Numb
+0000e500: 6572 7344 6963 7428 0a20 2020 2020 2020  ersDict(.       
+0000e510: 2020 2020 2020 2020 2062 726f 6164 6361           broadca
+0000e520: 7374 5f76 616c 7565 3d73 656c 662e 7661  st_value=self.va
+0000e530: 6c75 6520 6966 2028 6e75 6d62 6572 735f  lue if (numbers_
+0000e540: 6469 6374 2e76 616c 7565 2069 7320 6e6f  dict.value is no
+0000e550: 7420 4e6f 6e65 2920 656c 7365 204e 6f6e  t None) else Non
+0000e560: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000e570: 2020 206e 756d 6265 7273 5f64 6963 743d     numbers_dict=
+0000e580: 7b6b 3a20 7365 6c66 5b6b 5d20 666f 7220  {k: self[k] for 
+0000e590: 6b20 696e 206e 756d 6265 7273 5f64 6963  k in numbers_dic
+0000e5a0: 742e 6469 6374 2e6b 6579 7328 297d 2c0a  t.dict.keys()},.
+0000e5b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000e5c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000e5d0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000e5e0: 756d 6265 7273 4469 6374 280a 2020 2020  umbersDict(.    
+0000e5f0: 2020 2020 2020 2020 2020 2020 6272 6f61              broa
+0000e600: 6463 6173 745f 7661 6c75 653d 4e6f 6e65  dcast_value=None
+0000e610: 2c20 6e75 6d62 6572 735f 6469 6374 3d7b  , numbers_dict={
+0000e620: 6b3a 2073 656c 665b 6b5d 2066 6f72 206b  k: self[k] for k
+0000e630: 2069 6e20 6e75 6d62 6572 735f 6469 6374   in numbers_dict
+0000e640: 2e64 6963 742e 6b65 7973 2829 2069 6620  .dict.keys() if 
+0000e650: 6b20 696e 2073 656c 662e 6469 6374 7d0a  k in self.dict}.
+0000e660: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000e670: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+0000e680: 2064 6566 206b 6579 735f 7365 7428 7365   def keys_set(se
+0000e690: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000e6a0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+0000e6b0: 2073 6574 5b73 7472 5d0a 2020 2020 2020   set[str].      
+0000e6c0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000e6d0: 7475 726e 2073 6574 2873 656c 662e 6469  turn set(self.di
+0000e6e0: 6374 2e6b 6579 7328 2929 0a0a 2020 2020  ct.keys())..    
+0000e6f0: 6465 6620 5f5f 6765 7469 7465 6d5f 5f28  def __getitem__(
+0000e700: 7365 6c66 2c20 6b65 7929 3a0a 2020 2020  self, key):.    
+0000e710: 2020 2020 6966 2073 656c 662e 7661 6c75      if self.valu
+0000e720: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0000e730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e740: 6e20 7365 6c66 2e64 6963 742e 6765 7428  n self.dict.get(
+0000e750: 6b65 792c 2073 656c 662e 7661 6c75 6529  key, self.value)
+0000e760: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e770: 7365 6c66 2e64 6963 745b 6b65 795d 0a0a  self.dict[key]..
+0000e780: 2020 2020 6465 6620 5f5f 7365 7469 7465      def __setite
+0000e790: 6d5f 5f28 7365 6c66 2c20 6b65 792c 2076  m__(self, key, v
+0000e7a0: 616c 7565 293a 0a20 2020 2020 2020 2073  alue):.        s
+0000e7b0: 656c 662e 6469 6374 5b6b 6579 5d20 3d20  elf.dict[key] = 
+0000e7c0: 7661 6c75 650a 0a20 2020 2064 6566 205f  value..    def _
+0000e7d0: 5f64 656c 6974 656d 5f5f 2873 656c 662c  _delitem__(self,
+0000e7e0: 206b 6579 293a 0a20 2020 2020 2020 2064   key):.        d
+0000e7f0: 656c 2073 656c 662e 6469 6374 5b6b 6579  el self.dict[key
+0000e800: 5d0a 0a20 2020 2064 6566 2067 6574 2873  ]..    def get(s
+0000e810: 656c 662c 206b 6579 2c20 6465 6661 756c  elf, key, defaul
+0000e820: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
+0000e830: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
+0000e840: 7261 6d20 7374 7220 6b65 793a 0a20 2020  ram str key:.   
+0000e850: 2020 2020 203a 7061 7261 6d20 5420 6465       :param T de
+0000e860: 6661 756c 743a 0a20 2020 2020 2020 203a  fault:.        :
+0000e870: 7274 7970 653a 206f 626a 6563 747c 540a  rtype: object|T.
+0000e880: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e890: 2020 2020 2320 4b65 6570 2063 6f6e 7369      # Keep consi
+0000e8a0: 7374 656e 7420 7769 7468 2073 656c 662e  stent with self.
+0000e8b0: 5f5f 6765 745f 6974 656d 5f5f 2e20 4966  __get_item__. If
+0000e8c0: 2073 656c 662e 7661 6c75 6520 6973 2073   self.value is s
+0000e8d0: 6574 2c20 7468 6973 2077 696c 6c20 616c  et, this will al
+0000e8e0: 7761 7973 2062 6520 7468 6520 6465 6661  ways be the defa
+0000e8f0: 756c 7420 7661 6c75 652e 0a20 2020 2020  ult value..     
+0000e900: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+0000e910: 6963 742e 6765 7428 6b65 792c 2073 656c  ict.get(key, sel
+0000e920: 662e 7661 6c75 6520 6966 2073 656c 662e  f.value if self.
+0000e930: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
+0000e940: 6520 656c 7365 2064 6566 6175 6c74 290a  e else default).
+0000e950: 0a20 2020 2064 6566 2070 6f70 2873 656c  .    def pop(sel
+0000e960: 662c 206b 6579 2c20 2a61 7267 7329 3a0a  f, key, *args):.
+0000e970: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e980: 2020 2020 3a70 6172 616d 2073 7472 206b      :param str k
+0000e990: 6579 3a0a 2020 2020 2020 2020 3a70 6172  ey:.        :par
+0000e9a0: 616d 2054 2061 7267 733a 2064 6566 6175  am T args: defau
+0000e9b0: 6c74 2c20 6f72 206e 6f74 0a20 2020 2020  lt, or not.     
+0000e9c0: 2020 203a 7274 7970 653a 206f 626a 6563     :rtype: objec
+0000e9d0: 747c 540a 2020 2020 2020 2020 2222 220a  t|T.        """.
+0000e9e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000e9f0: 656c 662e 6469 6374 2e70 6f70 286b 6579  elf.dict.pop(key
+0000ea00: 2c20 2a61 7267 7329 0a0a 2020 2020 6465  , *args)..    de
+0000ea10: 6620 5f5f 6974 6572 5f5f 2873 656c 6629  f __iter__(self)
+0000ea20: 3a0a 2020 2020 2020 2020 2320 5468 6973  :.        # This
+0000ea30: 2063 616e 2070 6f74 656e 7469 616c 6c79   can potentially
+0000ea40: 2063 6175 7365 2063 6f6e 6675 7369 6f6e   cause confusion
+0000ea50: 2e20 536f 2065 6e66 6f72 6365 2065 7870  . So enforce exp
+0000ea60: 6c69 6369 746e 6573 732e 0a20 2020 2020  licitness..     
+0000ea70: 2020 2023 2046 6f72 2061 2064 6963 742c     # For a dict,
+0000ea80: 2077 6520 776f 756c 6420 7265 7475 726e   we would return
+0000ea90: 2074 6865 2064 6963 7420 6b65 7973 2068   the dict keys h
+0000eaa0: 6572 652e 0a20 2020 2020 2020 2023 2041  ere..        # A
+0000eab0: 6c73 6f2c 206d 6178 2873 656c 6629 2077  lso, max(self) w
+0000eac0: 6f75 6c64 2072 6573 756c 7420 696e 2061  ould result in a
+0000ead0: 2063 616c 6c20 746f 2073 656c 662e 5f5f   call to self.__
+0000eae0: 6974 6572 5f5f 2829 2c0a 2020 2020 2020  iter__(),.      
+0000eaf0: 2020 2320 7768 6963 6820 776f 756c 6420    # which would 
+0000eb00: 6f6e 6c79 206d 616b 6520 7365 6e73 6520  only make sense 
+0000eb10: 666f 7220 6f75 7220 7661 6c75 6573 2c20  for our values, 
+0000eb20: 6e6f 7420 7468 6520 6469 6374 206b 6579  not the dict key
+0000eb30: 732e 0a20 2020 2020 2020 2072 6169 7365  s..        raise
+0000eb40: 2045 7863 6570 7469 6f6e 2822 2573 2e5f   Exception("%s._
+0000eb50: 5f69 7465 725f 5f20 6973 2075 6e64 6566  _iter__ is undef
+0000eb60: 696e 6564 2220 2520 7365 6c66 2e5f 5f63  ined" % self.__c
+0000eb70: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f29  lass__.__name__)
+0000eb80: 0a0a 2020 2020 6465 6620 6b65 7973 2873  ..    def keys(s
+0000eb90: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000eba0: 220a 2020 2020 2020 2020 3a72 7479 7065  ".        :rtype
+0000ebb0: 3a20 7365 745b 7374 725d 0a20 2020 2020  : set[str].     
+0000ebc0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0000ebd0: 6574 7572 6e20 7365 6c66 2e64 6963 742e  eturn self.dict.
+0000ebe0: 6b65 7973 2829 0a0a 2020 2020 6465 6620  keys()..    def 
+0000ebf0: 7661 6c75 6573 2873 656c 6629 3a0a 2020  values(self):.  
+0000ec00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ec10: 2020 3a72 7479 7065 3a20 6c69 7374 5b6f    :rtype: list[o
+0000ec20: 626a 6563 745d 0a20 2020 2020 2020 2022  bject].        "
+0000ec30: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000ec40: 6e20 6c69 7374 2873 656c 662e 6469 6374  n list(self.dict
+0000ec50: 2e76 616c 7565 7328 2929 202b 2028 5b73  .values()) + ([s
+0000ec60: 656c 662e 7661 6c75 655d 2069 6620 7365  elf.value] if se
+0000ec70: 6c66 2e76 616c 7565 2069 7320 6e6f 7420  lf.value is not 
+0000ec80: 4e6f 6e65 2065 6c73 6520 5b5d 290a 0a20  None else []).. 
+0000ec90: 2020 2064 6566 2069 7465 6d73 2873 656c     def items(sel
+0000eca0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0000ecb0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0000ecc0: 2064 6963 7420 6974 656d 732e 2074 6869   dict items. thi
+0000ecd0: 7320 6578 636c 7564 6573 2073 656c 662e  s excludes self.
+0000ece0: 7661 6c75 650a 2020 2020 2020 2020 3a72  value.        :r
+0000ecf0: 7479 7065 3a20 7374 725b 2873 7472 2c6f  type: str[(str,o
+0000ed00: 626a 6563 7429 5d0a 2020 2020 2020 2020  bject)].        
+0000ed10: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000ed20: 726e 2073 656c 662e 6469 6374 2e69 7465  rn self.dict.ite
+0000ed30: 6d73 2829 0a0a 2020 2020 6465 6620 6861  ms()..    def ha
+0000ed40: 735f 7661 6c75 6573 2873 656c 6629 3a0a  s_values(self):.
+0000ed50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ed60: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
+0000ed70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ed80: 2020 2020 2072 6574 7572 6e20 626f 6f6c       return bool
+0000ed90: 2873 656c 662e 6469 6374 2920 6f72 2073  (self.dict) or s
+0000eda0: 656c 662e 7661 6c75 6520 6973 206e 6f74  elf.value is not
+0000edb0: 204e 6f6e 650a 0a20 2020 2064 6566 2075   None..    def u
+0000edc0: 6e61 7279 5f6f 7028 7365 6c66 2c20 6f70  nary_op(self, op
+0000edd0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0000ede0: 2020 2020 2020 203a 7061 7261 6d20 2854         :param (T
+0000edf0: 292d 3e54 3220 6f70 3a0a 2020 2020 2020  )->T2 op:.      
+0000ee00: 2020 3a72 6574 7572 6e3a 206e 6577 204e    :return: new N
+0000ee10: 756d 6265 7273 4469 6374 2c20 7768 6572  umbersDict, wher
+0000ee20: 6520 6060 6f70 6060 2069 7320 6170 706c  e ``op`` is appl
+0000ee30: 6965 6420 6f6e 2061 6c6c 2076 616c 7565  ied on all value
+0000ee40: 730a 2020 2020 2020 2020 3a72 7479 7065  s.        :rtype
+0000ee50: 3a20 4e75 6d62 6572 7344 6963 740a 2020  : NumbersDict.  
+0000ee60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ee70: 2020 7265 7320 3d20 4e75 6d62 6572 7344    res = NumbersD
+0000ee80: 6963 7428 290a 2020 2020 2020 2020 6966  ict().        if
+0000ee90: 2073 656c 662e 7661 6c75 6520 6973 206e   self.value is n
+0000eea0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000eeb0: 2020 2020 2072 6573 2e76 616c 7565 203d       res.value =
+0000eec0: 206f 7028 7365 6c66 2e76 616c 7565 290a   op(self.value).
+0000eed0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+0000eee0: 2069 6e20 7365 6c66 2e64 6963 742e 6974   in self.dict.it
+0000eef0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0000ef00: 2020 2072 6573 2e64 6963 745b 6b5d 203d     res.dict[k] =
+0000ef10: 206f 7028 7629 0a20 2020 2020 2020 2072   op(v).        r
+0000ef20: 6574 7572 6e20 7265 730a 0a20 2020 2040  eturn res..    @
+0000ef30: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000ef40: 6465 6620 6269 6e5f 6f70 5f73 6361 6c61  def bin_op_scala
+0000ef50: 725f 6f70 7469 6f6e 616c 2863 6c73 2c20  r_optional(cls, 
+0000ef60: 7365 6c66 2c20 6f74 6865 722c 207a 6572  self, other, zer
+0000ef70: 6f2c 206f 7029 3a0a 2020 2020 2020 2020  o, op):.        
+0000ef80: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+0000ef90: 616d 2054 2073 656c 663a 0a20 2020 2020  am T self:.     
+0000efa0: 2020 203a 7061 7261 6d20 5420 6f74 6865     :param T othe
+0000efb0: 723a 0a20 2020 2020 2020 203a 7061 7261  r:.        :para
+0000efc0: 6d20 5420 7a65 726f 3a0a 2020 2020 2020  m T zero:.      
+0000efd0: 2020 3a70 6172 616d 2028 542c 5429 2d3e    :param (T,T)->
+0000efe0: 5420 6f70 3a0a 2020 2020 2020 2020 3a72  T op:.        :r
+0000eff0: 7479 7065 3a20 540a 2020 2020 2020 2020  type: T.        
+0000f000: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+0000f010: 656c 6620 6973 204e 6f6e 6520 616e 6420  elf is None and 
+0000f020: 6f74 6865 7220 6973 204e 6f6e 653a 0a20  other is None:. 
+0000f030: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000f040: 6e20 4e6f 6e65 0a20 2020 2020 2020 2069  n None.        i
+0000f050: 6620 7365 6c66 2069 7320 4e6f 6e65 3a0a  f self is None:.
+0000f060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f070: 203d 207a 6572 6f0a 2020 2020 2020 2020   = zero.        
+0000f080: 6966 206f 7468 6572 2069 7320 4e6f 6e65  if other is None
+0000f090: 3a0a 2020 2020 2020 2020 2020 2020 6f74  :.            ot
+0000f0a0: 6865 7220 3d20 7a65 726f 0a20 2020 2020  her = zero.     
+0000f0b0: 2020 2072 6574 7572 6e20 6f70 2873 656c     return op(sel
+0000f0c0: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+0000f0d0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000f0e0: 6465 6620 6269 6e5f 6f70 2863 6c73 2c20  def bin_op(cls, 
+0000f0f0: 7365 6c66 2c20 6f74 6865 722c 206f 702c  self, other, op,
+0000f100: 207a 6572 6f2c 2072 6573 756c 743d 4e6f   zero, result=No
+0000f110: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0000f120: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000f130: 4e75 6d62 6572 7344 6963 747c 696e 747c  NumbersDict|int|
+0000f140: 666c 6f61 747c 5420 7365 6c66 3a0a 2020  float|T self:.  
+0000f150: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
+0000f160: 6265 7273 4469 6374 7c69 6e74 7c66 6c6f  bersDict|int|flo
+0000f170: 6174 7c54 206f 7468 6572 3a0a 2020 2020  at|T other:.    
+0000f180: 2020 2020 3a70 6172 616d 2028 542c 5429      :param (T,T)
+0000f190: 2d3e 5420 6f70 3a0a 2020 2020 2020 2020  ->T op:.        
+0000f1a0: 3a70 6172 616d 2054 207a 6572 6f3a 0a20  :param T zero:. 
+0000f1b0: 2020 2020 2020 203a 7061 7261 6d20 4e75         :param Nu
+0000f1c0: 6d62 6572 7344 6963 747c 4e6f 6e65 2072  mbersDict|None r
+0000f1d0: 6573 756c 743a 0a20 2020 2020 2020 203a  esult:.        :
+0000f1e0: 7274 7970 653a 204e 756d 6265 7273 4469  rtype: NumbersDi
+0000f1f0: 6374 0a20 2020 2020 2020 2022 2222 0a20  ct.        """. 
+0000f200: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000f210: 696e 7374 616e 6365 2873 656c 662c 204e  instance(self, N
+0000f220: 756d 6265 7273 4469 6374 293a 0a20 2020  umbersDict):.   
+0000f230: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000f240: 7374 616e 6365 286f 7468 6572 2c20 4e75  stance(other, Nu
+0000f250: 6d62 6572 7344 6963 7429 3a0a 2020 2020  mbersDict):.    
+0000f260: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f270: 203d 204e 756d 6265 7273 4469 6374 2e63   = NumbersDict.c
+0000f280: 6f6e 7374 616e 745f 6c69 6b65 2873 656c  onstant_like(sel
+0000f290: 662c 206e 756d 6265 7273 5f64 6963 743d  f, numbers_dict=
+0000f2a0: 6f74 6865 7229 0a20 2020 2020 2020 2020  other).         
+0000f2b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f2c0: 2020 2020 2020 2020 2073 656c 6620 3d20           self = 
+0000f2d0: 4e75 6d62 6572 7344 6963 7428 7365 6c66  NumbersDict(self
+0000f2e0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0000f2f0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+0000f300: 722c 204e 756d 6265 7273 4469 6374 293a  r, NumbersDict):
+0000f310: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0000f320: 6572 203d 204e 756d 6265 7273 4469 6374  er = NumbersDict
+0000f330: 2e63 6f6e 7374 616e 745f 6c69 6b65 286f  .constant_like(o
+0000f340: 7468 6572 2c20 6e75 6d62 6572 735f 6469  ther, numbers_di
+0000f350: 6374 3d73 656c 6629 0a20 2020 2020 2020  ct=self).       
+0000f360: 2069 6620 7265 7375 6c74 2069 7320 4e6f   if result is No
+0000f370: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000f380: 7265 7375 6c74 203d 204e 756d 6265 7273  result = Numbers
+0000f390: 4469 6374 2829 0a20 2020 2020 2020 2061  Dict().        a
+0000f3a0: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
+0000f3b0: 2872 6573 756c 742c 204e 756d 6265 7273  (result, Numbers
+0000f3c0: 4469 6374 290a 2020 2020 2020 2020 666f  Dict).        fo
+0000f3d0: 7220 6b20 696e 2073 656c 662e 6b65 7973  r k in self.keys
+0000f3e0: 5f73 6574 207c 206f 7468 6572 2e6b 6579  _set | other.key
+0000f3f0: 735f 7365 743a 0a20 2020 2020 2020 2020  s_set:.         
+0000f400: 2020 2072 6573 756c 745b 6b5d 203d 2063     result[k] = c
+0000f410: 6c73 2e62 696e 5f6f 705f 7363 616c 6172  ls.bin_op_scalar
+0000f420: 5f6f 7074 696f 6e61 6c28 7365 6c66 2e67  _optional(self.g
+0000f430: 6574 286b 2c20 4e6f 6e65 292c 206f 7468  et(k, None), oth
+0000f440: 6572 2e67 6574 286b 2c20 4e6f 6e65 292c  er.get(k, None),
+0000f450: 207a 6572 6f3d 7a65 726f 2c20 6f70 3d6f   zero=zero, op=o
+0000f460: 7029 0a20 2020 2020 2020 2072 6573 756c  p).        resul
+0000f470: 742e 7661 6c75 6520 3d20 636c 732e 6269  t.value = cls.bi
+0000f480: 6e5f 6f70 5f73 6361 6c61 725f 6f70 7469  n_op_scalar_opti
+0000f490: 6f6e 616c 2873 656c 662e 7661 6c75 652c  onal(self.value,
+0000f4a0: 206f 7468 6572 2e76 616c 7565 2c20 7a65   other.value, ze
+0000f4b0: 726f 3d7a 6572 6f2c 206f 703d 6f70 290a  ro=zero, op=op).
+0000f4c0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000f4d0: 6573 756c 740a 0a20 2020 2064 6566 205f  esult..    def _
+0000f4e0: 5f61 6464 5f5f 2873 656c 662c 206f 7468  _add__(self, oth
+0000f4f0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+0000f500: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
+0000f510: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
+0000f520: 6c61 6d62 6461 2061 2c20 623a 2061 202b  lambda a, b: a +
+0000f530: 2062 2c20 7a65 726f 3d30 290a 0a20 2020   b, zero=0)..   
+0000f540: 205f 5f72 6164 645f 5f20 3d20 5f5f 6164   __radd__ = __ad
+0000f550: 645f 5f0a 0a20 2020 2064 6566 205f 5f69  d__..    def __i
+0000f560: 6164 645f 5f28 7365 6c66 2c20 6f74 6865  add__(self, othe
+0000f570: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+0000f580: 726e 2073 656c 662e 6269 6e5f 6f70 2873  rn self.bin_op(s
+0000f590: 656c 662c 206f 7468 6572 2c20 6f70 3d6c  elf, other, op=l
+0000f5a0: 616d 6264 6120 612c 2062 3a20 6120 2b20  ambda a, b: a + 
+0000f5b0: 622c 207a 6572 6f3d 302c 2072 6573 756c  b, zero=0, resul
+0000f5c0: 743d 7365 6c66 290a 0a20 2020 2064 6566  t=self)..    def
+0000f5d0: 205f 5f73 7562 5f5f 2873 656c 662c 206f   __sub__(self, o
+0000f5e0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+0000f5f0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
+0000f600: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
+0000f610: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
+0000f620: 202d 2062 2c20 7a65 726f 3d30 290a 0a20   - b, zero=0).. 
+0000f630: 2020 2064 6566 205f 5f72 7375 625f 5f28     def __rsub__(
+0000f640: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+0000f650: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000f660: 662e 6269 6e5f 6f70 2873 656c 662c 206f  f.bin_op(self, o
+0000f670: 7468 6572 2c20 6f70 3d6c 616d 6264 6120  ther, op=lambda 
+0000f680: 612c 2062 3a20 6220 2d20 612c 207a 6572  a, b: b - a, zer
+0000f690: 6f3d 3029 0a0a 2020 2020 6465 6620 5f5f  o=0)..    def __
+0000f6a0: 6973 7562 5f5f 2873 656c 662c 206f 7468  isub__(self, oth
+0000f6b0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+0000f6c0: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
+0000f6d0: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
+0000f6e0: 6c61 6d62 6461 2061 2c20 623a 2061 202d  lambda a, b: a -
+0000f6f0: 2062 2c20 7a65 726f 3d30 2c20 7265 7375   b, zero=0, resu
+0000f700: 6c74 3d73 656c 6629 0a0a 2020 2020 6465  lt=self)..    de
+0000f710: 6620 5f5f 6d75 6c5f 5f28 7365 6c66 2c20  f __mul__(self, 
+0000f720: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+0000f730: 7265 7475 726e 2073 656c 662e 6269 6e5f  return self.bin_
+0000f740: 6f70 2873 656c 662c 206f 7468 6572 2c20  op(self, other, 
+0000f750: 6f70 3d6c 616d 6264 6120 612c 2062 3a20  op=lambda a, b: 
+0000f760: 6120 2a20 622c 207a 6572 6f3d 3129 0a0a  a * b, zero=1)..
+0000f770: 2020 2020 5f5f 726d 756c 5f5f 203d 205f      __rmul__ = _
+0000f780: 5f6d 756c 5f5f 0a0a 2020 2020 6465 6620  _mul__..    def 
+0000f790: 5f5f 696d 756c 5f5f 2873 656c 662c 206f  __imul__(self, o
+0000f7a0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+0000f7b0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
+0000f7c0: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
+0000f7d0: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
+0000f7e0: 202a 2062 2c20 7a65 726f 3d31 2c20 7265   * b, zero=1, re
+0000f7f0: 7375 6c74 3d73 656c 6629 0a0a 2020 2020  sult=self)..    
+0000f800: 6465 6620 5f5f 6469 765f 5f28 7365 6c66  def __div__(self
+0000f810: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+0000f820: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
+0000f830: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
+0000f840: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
+0000f850: 3a20 6120 2f20 622c 207a 6572 6f3d 3129  : a / b, zero=1)
+0000f860: 0a0a 2020 2020 5f5f 7264 6976 5f5f 203d  ..    __rdiv__ =
+0000f870: 205f 5f64 6976 5f5f 0a20 2020 205f 5f74   __div__.    __t
+0000f880: 7275 6564 6976 5f5f 203d 205f 5f64 6976  ruediv__ = __div
+0000f890: 5f5f 0a0a 2020 2020 6465 6620 5f5f 6964  __..    def __id
+0000f8a0: 6976 5f5f 2873 656c 662c 206f 7468 6572  iv__(self, other
+0000f8b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000f8c0: 6e20 7365 6c66 2e62 696e 5f6f 7028 7365  n self.bin_op(se
+0000f8d0: 6c66 2c20 6f74 6865 722c 206f 703d 6c61  lf, other, op=la
+0000f8e0: 6d62 6461 2061 2c20 623a 2061 202f 2062  mbda a, b: a / b
+0000f8f0: 2c20 7a65 726f 3d31 2c20 7265 7375 6c74  , zero=1, result
+0000f900: 3d73 656c 6629 0a0a 2020 2020 5f5f 6974  =self)..    __it
+0000f910: 7275 6564 6976 5f5f 203d 205f 5f69 6469  ruediv__ = __idi
+0000f920: 765f 5f0a 0a20 2020 2064 6566 205f 5f66  v__..    def __f
+0000f930: 6c6f 6f72 6469 765f 5f28 7365 6c66 2c20  loordiv__(self, 
+0000f940: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+0000f950: 7265 7475 726e 2073 656c 662e 6269 6e5f  return self.bin_
+0000f960: 6f70 2873 656c 662c 206f 7468 6572 2c20  op(self, other, 
+0000f970: 6f70 3d6c 616d 6264 6120 612c 2062 3a20  op=lambda a, b: 
+0000f980: 6120 2f2f 2062 2c20 7a65 726f 3d31 290a  a // b, zero=1).
+0000f990: 0a20 2020 2064 6566 205f 5f69 666c 6f6f  .    def __ifloo
+0000f9a0: 7264 6976 5f5f 2873 656c 662c 206f 7468  rdiv__(self, oth
+0000f9b0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+0000f9c0: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
+0000f9d0: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
+0000f9e0: 6c61 6d62 6461 2061 2c20 623a 2061 202f  lambda a, b: a /
+0000f9f0: 2f20 622c 207a 6572 6f3d 312c 2072 6573  / b, zero=1, res
+0000fa00: 756c 743d 7365 6c66 290a 0a20 2020 2064  ult=self)..    d
+0000fa10: 6566 205f 5f6e 6567 5f5f 2873 656c 6629  ef __neg__(self)
+0000fa20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000fa30: 2073 656c 662e 756e 6172 795f 6f70 286f   self.unary_op(o
+0000fa40: 703d 6c61 6d62 6461 2061 3a20 2d61 290a  p=lambda a: -a).
+0000fa50: 0a20 2020 2064 6566 205f 5f62 6f6f 6c5f  .    def __bool_
+0000fa60: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+0000fa70: 2072 6574 7572 6e20 616e 7928 7365 6c66   return any(self
+0000fa80: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
+0000fa90: 5f5f 6e6f 6e7a 6572 6f5f 5f20 3d20 5f5f  __nonzero__ = __
+0000faa0: 626f 6f6c 5f5f 2020 2320 5079 7468 6f6e  bool__  # Python
+0000fab0: 2032 0a0a 2020 2020 6465 6620 656c 656d   2..    def elem
+0000fac0: 5f65 7128 7365 6c66 2c20 6f74 6865 722c  _eq(self, other,
+0000fad0: 2072 6573 756c 745f 7769 7468 5f64 6566   result_with_def
+0000fae0: 6175 6c74 3d54 7275 6529 3a0a 2020 2020  ault=True):.    
+0000faf0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000fb00: 456c 656d 656e 742d 7769 7365 2065 7175  Element-wise equ
+0000fb10: 616c 6974 7920 6368 6563 6b20 7769 7468  ality check with
+0000fb20: 206f 7468 6572 2e0a 2020 2020 2020 2020   other..        
+0000fb30: 4e6f 7465 2061 626f 7574 2062 726f 6164  Note about broad
+0000fb40: 6361 7374 2064 6566 6175 6c74 2076 616c  cast default val
+0000fb50: 7565 3a20 436f 6e73 6964 6572 2073 6f6d  ue: Consider som
+0000fb60: 6520 6b65 7920 7768 6963 6820 6973 206e  e key which is n
+0000fb70: 6569 7468 6572 2069 6e20 7365 6c66 206e  either in self n
+0000fb80: 6f72 2069 6e20 6f74 6865 722e 0a20 2020  or in other..   
+0000fb90: 2020 2020 2020 2054 6869 7320 6d65 616e         This mean
+0000fba0: 7320 7468 6174 2073 656c 665b 6b65 795d  s that self[key]
+0000fbb0: 203d 3d20 7365 6c66 2e64 6566 6175 6c74   == self.default
+0000fbc0: 2c20 6f74 6865 725b 6b65 795d 203d 3d20  , other[key] == 
+0000fbd0: 6f74 6865 722e 6465 6661 756c 742e 0a20  other.default.. 
+0000fbe0: 2020 2020 2020 2020 2054 6875 732c 2069           Thus, i
+0000fbf0: 6e20 6361 7365 2074 6861 7420 7365 6c66  n case that self
+0000fc00: 2e64 6566 6175 6c74 2021 3d20 6f74 6865  .default != othe
+0000fc10: 722e 6465 6661 756c 742c 2077 6520 6765  r.default, we ge
+0000fc20: 7420 7265 732e 6465 6661 756c 7420 3d3d  t res.default ==
+0000fc30: 2046 616c 7365 2e0a 2020 2020 2020 2020   False..        
+0000fc40: 2020 5468 656e 2c20 616c 6c28 7265 732e    Then, all(res.
+0000fc50: 7661 6c75 6573 2829 2920 3d3d 2046 616c  values()) == Fal
+0000fc60: 7365 2c20 6576 656e 2077 6865 6e20 616c  se, even when al
+0000fc70: 6c20 6f74 6865 7220 7661 6c75 6573 2061  l other values a
+0000fc80: 7265 2054 7275 652e 0a20 2020 2020 2020  re True..       
+0000fc90: 2020 2054 6869 7320 6973 2073 6f6d 6574     This is somet
+0000fca0: 696d 6573 206e 6f74 2077 6861 7420 7765  imes not what we
+0000fcb0: 2077 616e 742e 0a20 2020 2020 2020 2020   want..         
+0000fcc0: 2059 6f75 2063 616e 2063 6f6e 7472 6f6c   You can control
+0000fcd0: 2074 6865 2062 6568 6176 696f 7220 7669   the behavior vi
+0000fce0: 6120 7265 7375 6c74 5f77 6974 685f 6465  a result_with_de
+0000fcf0: 6661 756c 742e 0a0a 2020 2020 2020 2020  fault...        
+0000fd00: 3a70 6172 616d 204e 756d 6265 7273 4469  :param NumbersDi
+0000fd10: 6374 7c54 206f 7468 6572 3a0a 2020 2020  ct|T other:.    
+0000fd20: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
+0000fd30: 7265 7375 6c74 5f77 6974 685f 6465 6661  result_with_defa
+0000fd40: 756c 743a 0a20 2020 2020 2020 203a 7274  ult:.        :rt
+0000fd50: 7970 653a 204e 756d 6265 7273 4469 6374  ype: NumbersDict
+0000fd60: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000fd70: 2020 2020 2020 6465 6620 6f70 2861 2c20        def op(a, 
+0000fd80: 6229 3a0a 2020 2020 2020 2020 2020 2020  b):.            
+0000fd90: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0000fda0: 3a70 6172 616d 2061 3a0a 2020 2020 2020  :param a:.      
+0000fdb0: 2020 2020 2020 3a70 6172 616d 2062 3a0a        :param b:.
+0000fdc0: 2020 2020 2020 2020 2020 2020 3a72 7479              :rty
+0000fdd0: 7065 3a20 626f 6f6c 7c4e 6f6e 650a 2020  pe: bool|None.  
+0000fde0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+0000fdf0: 2020 2020 2020 2020 2020 6966 2061 2069            if a i
+0000fe00: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000fe10: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000fe20: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0000fe30: 6966 2062 2069 7320 4e6f 6e65 3a0a 2020  if b is None:.  
+0000fe40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000fe50: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+0000fe60: 2020 2020 2020 7265 7475 726e 2061 203d        return a =
+0000fe70: 3d20 620a 0a20 2020 2020 2020 2072 6573  = b..        res
+0000fe80: 203d 2073 656c 662e 6269 6e5f 6f70 2873   = self.bin_op(s
+0000fe90: 656c 662c 206f 7468 6572 2c20 6f70 3d6f  elf, other, op=o
+0000fea0: 702c 207a 6572 6f3d 4e6f 6e65 290a 2020  p, zero=None).  
+0000feb0: 2020 2020 2020 6966 206e 6f74 2072 6573        if not res
+0000fec0: 756c 745f 7769 7468 5f64 6566 6175 6c74  ult_with_default
+0000fed0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000fee0: 732e 7661 6c75 6520 3d20 4e6f 6e65 0a20  s.value = None. 
+0000fef0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000ff00: 730a 0a20 2020 2064 6566 205f 5f65 715f  s..    def __eq_
+0000ff10: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+0000ff20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ff30: 2020 2020 3a70 6172 616d 204e 756d 6265      :param Numbe
+0000ff40: 7273 4469 6374 7c54 206f 7468 6572 3a0a  rsDict|T other:.
+0000ff50: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0000ff60: 2077 6865 7468 6572 2073 656c 6620 3d3d   whether self ==
+0000ff70: 206f 7468 6572 2065 6c65 6d77 6973 652e   other elemwise.
+0000ff80: 2073 6565 2073 656c 662e 656c 656d 5f65   see self.elem_e
+0000ff90: 710a 2020 2020 2020 2020 3a72 7479 7065  q.        :rtype
+0000ffa0: 3a20 626f 6f6c 0a20 2020 2020 2020 2022  : bool.        "
+0000ffb0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000ffc0: 6e20 616c 6c28 7365 6c66 2e65 6c65 6d5f  n all(self.elem_
+0000ffd0: 6571 286f 7468 6572 292e 7661 6c75 6573  eq(other).values
+0000ffe0: 2829 290a 0a20 2020 2064 6566 205f 5f6e  ())..    def __n
+0000fff0: 655f 5f28 7365 6c66 2c20 6f74 6865 7229  e__(self, other)
+00010000: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00010010: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
+00010020: 6265 7273 4469 6374 7c54 206f 7468 6572  bersDict|T other
+00010030: 3a0a 2020 2020 2020 2020 3a72 6574 7572  :.        :retur
+00010040: 6e3a 206e 6f74 2028 7365 6c66 203d 3d20  n: not (self == 
+00010050: 6f74 6865 7229 0a20 2020 2020 2020 203a  other).        :
+00010060: 7274 7970 653a 2062 6f6f 6c0a 2020 2020  rtype: bool.    
+00010070: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010080: 7265 7475 726e 206e 6f74 2028 7365 6c66  return not (self
+00010090: 203d 3d20 6f74 6865 7229 0a0a 2020 2020   == other)..    
+000100a0: 6465 6620 5f5f 636d 705f 5f28 7365 6c66  def __cmp__(self
+000100b0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+000100c0: 2020 2320 5468 6572 6520 6973 206e 6f20    # There is no 
+000100d0: 676f 6f64 2073 7472 6169 6768 742d 666f  good straight-fo
+000100e0: 7277 6172 6420 696d 706c 656d 656e 7461  rward implementa
+000100f0: 7469 6f6e 0a20 2020 2020 2020 2023 2061  tion.        # a
+00010100: 6e64 2069 7420 776f 756c 6420 6a75 7374  nd it would just
+00010110: 2063 6f6e 6675 7365 2e0a 2020 2020 2020   confuse..      
+00010120: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00010130: 6e28 2225 732e 5f5f 636d 705f 5f20 6973  n("%s.__cmp__ is
+00010140: 2075 6e64 6566 696e 6564 2220 2520 7365   undefined" % se
+00010150: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+00010160: 616d 655f 5f29 0a0a 2020 2020 6465 6620  ame__)..    def 
+00010170: 616e 795f 636f 6d70 6172 6528 7365 6c66  any_compare(self
+00010180: 2c20 6f74 6865 722c 2063 6d70 293a 0a20  , other, cmp):. 
+00010190: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000101a0: 2020 203a 7061 7261 6d20 4e75 6d62 6572     :param Number
+000101b0: 7344 6963 7420 6f74 6865 723a 0a20 2020  sDict other:.   
+000101c0: 2020 2020 203a 7061 7261 6d20 2828 6f62       :param ((ob
+000101d0: 6a65 6374 2c6f 626a 6563 7429 2d3e 5472  ject,object)->Tr
+000101e0: 7565 2920 636d 703a 0a20 2020 2020 2020  ue) cmp:.       
+000101f0: 203a 7274 7970 653a 2054 7275 650a 2020   :rtype: True.  
+00010200: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010210: 2020 666f 7220 6b65 7920 696e 2073 656c    for key in sel
+00010220: 662e 6b65 7973 2829 3a0a 2020 2020 2020  f.keys():.      
+00010230: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+00010240: 6f74 6865 722e 6b65 7973 2829 3a0a 2020  other.keys():.  
+00010250: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010260: 2063 6d70 2873 656c 665b 6b65 795d 2c20   cmp(self[key], 
+00010270: 6f74 6865 725b 6b65 795d 293a 0a20 2020  other[key]):.   
+00010280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010290: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+000102a0: 2020 2020 2020 2020 2065 6c69 6620 6f74           elif ot
+000102b0: 6865 722e 7661 6c75 6520 6973 206e 6f74  her.value is not
+000102c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000102d0: 2020 2020 2020 2069 6620 636d 7028 7365         if cmp(se
+000102e0: 6c66 5b6b 6579 5d2c 206f 7468 6572 2e76  lf[key], other.v
+000102f0: 616c 7565 293a 0a20 2020 2020 2020 2020  alue):.         
+00010300: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010310: 6e20 5472 7565 0a20 2020 2020 2020 2069  n True.        i
+00010320: 6620 7365 6c66 2e76 616c 7565 2069 7320  f self.value is 
+00010330: 6e6f 7420 4e6f 6e65 2061 6e64 206f 7468  not None and oth
+00010340: 6572 2e76 616c 7565 2069 7320 6e6f 7420  er.value is not 
+00010350: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00010360: 2020 6966 2063 6d70 2873 656c 662e 7661    if cmp(self.va
+00010370: 6c75 652c 206f 7468 6572 2e76 616c 7565  lue, other.value
+00010380: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00010390: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+000103a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000103b0: 6c73 650a 0a20 2020 2040 7374 6174 6963  lse..    @static
+000103c0: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+000103d0: 6d61 7828 2a61 7267 7329 3a0a 2020 2020  max(*args):.    
+000103e0: 2020 2020 6172 6773 203d 205b 6120 666f      args = [a fo
+000103f0: 7220 6120 696e 2061 7267 7320 6966 2061  r a in args if a
+00010400: 2069 7320 6e6f 7420 4e6f 6e65 5d0a 2020   is not None].  
+00010410: 2020 2020 2020 6966 206e 6f74 2061 7267        if not arg
+00010420: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00010430: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+00010440: 2020 2069 6620 6c65 6e28 6172 6773 2920     if len(args) 
+00010450: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00010460: 2020 7265 7475 726e 2061 7267 735b 305d    return args[0]
+00010470: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00010480: 6d61 7828 2a61 7267 7329 0a0a 2020 2020  max(*args)..    
+00010490: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+000104a0: 2020 6465 6620 5f6d 696e 282a 6172 6773    def _min(*args
+000104b0: 293a 0a20 2020 2020 2020 2061 7267 7320  ):.        args 
+000104c0: 3d20 5b61 2066 6f72 2061 2069 6e20 6172  = [a for a in ar
+000104d0: 6773 2069 6620 6120 6973 206e 6f74 204e  gs if a is not N
+000104e0: 6f6e 655d 0a20 2020 2020 2020 2069 6620  one].        if 
+000104f0: 6e6f 7420 6172 6773 3a0a 2020 2020 2020  not args:.      
+00010500: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00010510: 650a 2020 2020 2020 2020 6966 206c 656e  e.        if len
+00010520: 2861 7267 7329 203d 3d20 313a 0a20 2020  (args) == 1:.   
+00010530: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00010540: 6172 6773 5b30 5d0a 2020 2020 2020 2020  args[0].        
+00010550: 7265 7475 726e 206d 696e 282a 6172 6773  return min(*args
+00010560: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00010570: 686f 640a 2020 2020 6465 6620 6d61 7828  hod.    def max(
+00010580: 636c 732c 2069 7465 6d73 293a 0a20 2020  cls, items):.   
+00010590: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000105a0: 2045 6c65 6d65 6e74 2d77 6973 6520 6d61   Element-wise ma
+000105b0: 7869 6d75 6d20 666f 7220 6974 656d 2069  ximum for item i
+000105c0: 6e20 6974 656d 732e 0a20 2020 2020 2020  n items..       
+000105d0: 203a 7061 7261 6d20 6c69 7374 5b4e 756d   :param list[Num
+000105e0: 6265 7273 4469 6374 7c69 6e74 7c66 6c6f  bersDict|int|flo
+000105f0: 6174 5d20 6974 656d 733a 0a20 2020 2020  at] items:.     
+00010600: 2020 203a 7274 7970 653a 204e 756d 6265     :rtype: Numbe
+00010610: 7273 4469 6374 0a20 2020 2020 2020 2022  rsDict.        "
+00010620: 2222 0a20 2020 2020 2020 2061 7373 6572  "".        asser
+00010630: 7420 6974 656d 730a 2020 2020 2020 2020  t items.        
+00010640: 6966 206c 656e 2869 7465 6d73 2920 3d3d  if len(items) ==
+00010650: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00010660: 7265 7475 726e 204e 756d 6265 7273 4469  return NumbersDi
+00010670: 6374 2869 7465 6d73 5b30 5d29 0a20 2020  ct(items[0]).   
+00010680: 2020 2020 2069 6620 6c65 6e28 6974 656d       if len(item
+00010690: 7329 203d 3d20 323a 0a20 2020 2020 2020  s) == 2:.       
+000106a0: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
+000106b0: 6269 6e5f 6f70 2869 7465 6d73 5b30 5d2c  bin_op(items[0],
+000106c0: 2069 7465 6d73 5b31 5d2c 206f 703d 636c   items[1], op=cl
+000106d0: 732e 5f6d 6178 2c20 7a65 726f 3d4e 6f6e  s._max, zero=Non
+000106e0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+000106f0: 6e20 636c 732e 6d61 7828 5b69 7465 6d73  n cls.max([items
+00010700: 5b30 5d2c 2063 6c73 2e6d 6178 2869 7465  [0], cls.max(ite
+00010710: 6d73 5b31 3a5d 295d 290a 0a20 2020 2040  ms[1:])])..    @
+00010720: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00010730: 6465 6620 6d69 6e28 636c 732c 2069 7465  def min(cls, ite
+00010740: 6d73 293a 0a20 2020 2020 2020 2022 2222  ms):.        """
+00010750: 0a20 2020 2020 2020 2045 6c65 6d65 6e74  .        Element
+00010760: 2d77 6973 6520 6d69 6e69 6d75 6d20 666f  -wise minimum fo
+00010770: 7220 6974 656d 2069 6e20 6974 656d 732e  r item in items.
+00010780: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00010790: 6c69 7374 5b4e 756d 6265 7273 4469 6374  list[NumbersDict
+000107a0: 7c69 6e74 7c66 6c6f 6174 5d20 6974 656d  |int|float] item
+000107b0: 733a 0a20 2020 2020 2020 203a 7274 7970  s:.        :rtyp
+000107c0: 653a 204e 756d 6265 7273 4469 6374 0a20  e: NumbersDict. 
+000107d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000107e0: 2020 2061 7373 6572 7420 6974 656d 730a     assert items.
+000107f0: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00010800: 7465 6d73 2920 3d3d 2031 3a0a 2020 2020  tems) == 1:.    
+00010810: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00010820: 756d 6265 7273 4469 6374 2869 7465 6d73  umbersDict(items
+00010830: 5b30 5d29 0a20 2020 2020 2020 2069 6620  [0]).        if 
+00010840: 6c65 6e28 6974 656d 7329 203d 3d20 323a  len(items) == 2:
+00010850: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00010860: 7572 6e20 636c 732e 6269 6e5f 6f70 2869  urn cls.bin_op(i
+00010870: 7465 6d73 5b30 5d2c 2069 7465 6d73 5b31  tems[0], items[1
+00010880: 5d2c 206f 703d 636c 732e 5f6d 696e 2c20  ], op=cls._min, 
+00010890: 7a65 726f 3d4e 6f6e 6529 0a20 2020 2020  zero=None).     
+000108a0: 2020 2072 6574 7572 6e20 636c 732e 6d69     return cls.mi
+000108b0: 6e28 5b69 7465 6d73 5b30 5d2c 2063 6c73  n([items[0], cls
+000108c0: 2e6d 696e 2869 7465 6d73 5b31 3a5d 295d  .min(items[1:])]
+000108d0: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
+000108e0: 7468 6f64 0a20 2020 2064 6566 205f 6d61  thod.    def _ma
+000108f0: 785f 6572 726f 7228 293a 0a20 2020 2020  x_error():.     
+00010900: 2020 2023 2057 696c 6c20 7265 706c 6163     # Will replac
+00010910: 6520 7365 6c66 2e6d 6178 2066 6f72 2065  e self.max for e
+00010920: 6163 6820 696e 7374 616e 6365 2e20 546f  ach instance. To
+00010930: 2062 6520 7375 7265 2074 6861 7420 7765   be sure that we
+00010940: 2064 6f6e 2774 2063 6f6e 6675 7365 2069   don't confuse i
+00010950: 7420 7769 7468 2073 656c 662e 6d61 785f  t with self.max_
+00010960: 7661 6c75 652e 0a20 2020 2020 2020 2072  value..        r
+00010970: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+00010980: 5573 6520 6d61 785f 7661 6c75 6520 696e  Use max_value in
+00010990: 7374 6561 642e 2229 0a0a 2020 2020 6465  stead.")..    de
+000109a0: 6620 6d61 785f 7661 6c75 6528 7365 6c66  f max_value(self
+000109b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000109c0: 2020 2020 2020 204d 6178 696d 756d 206f         Maximum o
+000109d0: 6620 6f75 7220 7661 6c75 6573 2e0a 2020  f our values..  
+000109e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000109f0: 2020 7265 7475 726e 206d 6178 2873 656c    return max(sel
+00010a00: 662e 7661 6c75 6573 2829 290a 0a20 2020  f.values())..   
+00010a10: 2064 6566 206d 696e 5f76 616c 7565 2873   def min_value(s
+00010a20: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00010a30: 220a 2020 2020 2020 2020 4d69 6e69 6d75  ".        Minimu
+00010a40: 6d20 6f66 206f 7572 2076 616c 7565 732e  m of our values.
+00010a50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010a60: 2020 2020 2072 6574 7572 6e20 6d69 6e28       return min(
+00010a70: 7365 6c66 2e76 616c 7565 7328 2929 0a0a  self.values())..
+00010a80: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+00010a90: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00010aa0: 6966 2073 656c 662e 7661 6c75 6520 6973  if self.value is
+00010ab0: 204e 6f6e 6520 616e 6420 6e6f 7420 7365   None and not se
+00010ac0: 6c66 2e64 6963 743a 0a20 2020 2020 2020  lf.dict:.       
+00010ad0: 2020 2020 2072 6574 7572 6e20 2225 7328       return "%s(
+00010ae0: 2922 2025 2073 656c 662e 5f5f 636c 6173  )" % self.__clas
+00010af0: 735f 5f2e 5f5f 6e61 6d65 5f5f 0a20 2020  s__.__name__.   
+00010b00: 2020 2020 2069 6620 7365 6c66 2e76 616c       if self.val
+00010b10: 7565 2069 7320 4e6f 6e65 2061 6e64 2073  ue is None and s
+00010b20: 656c 662e 6469 6374 3a0a 2020 2020 2020  elf.dict:.      
+00010b30: 2020 2020 2020 7265 7475 726e 2022 2573        return "%s
+00010b40: 2825 7229 2220 2520 2873 656c 662e 5f5f  (%r)" % (self.__
+00010b50: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00010b60: 2c20 7365 6c66 2e64 6963 7429 0a20 2020  , self.dict).   
+00010b70: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00010b80: 2e64 6963 7420 616e 6420 7365 6c66 2e76  .dict and self.v
+00010b90: 616c 7565 2069 7320 6e6f 7420 4e6f 6e65  alue is not None
+00010ba0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00010bb0: 7475 726e 2022 2573 2825 7229 2220 2520  turn "%s(%r)" % 
+00010bc0: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
+00010bd0: 5f5f 6e61 6d65 5f5f 2c20 7365 6c66 2e76  __name__, self.v
+00010be0: 616c 7565 290a 2020 2020 2020 2020 7265  alue).        re
+00010bf0: 7475 726e 2022 2573 286e 756d 6265 7273  turn "%s(numbers
+00010c00: 5f64 6963 743d 2572 2c20 6272 6f61 6463  _dict=%r, broadc
+00010c10: 6173 745f 7661 6c75 653d 2572 2922 2025  ast_value=%r)" %
+00010c20: 2028 7365 6c66 2e5f 5f63 6c61 7373 5f5f   (self.__class__
+00010c30: 2e5f 5f6e 616d 655f 5f2c 2073 656c 662e  .__name__, self.
+00010c40: 6469 6374 2c20 7365 6c66 2e76 616c 7565  dict, self.value
+00010c50: 290a 0a0a 6465 6620 636f 6c6c 6563 745f  )...def collect_
+00010c60: 636c 6173 735f 696e 6974 5f6b 7761 7267  class_init_kwarg
+00010c70: 7328 636c 732c 206f 6e6c 795f 7769 7468  s(cls, only_with
+00010c80: 5f64 6566 6175 6c74 3d46 616c 7365 293a  _default=False):
+00010c90: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00010ca0: 7261 6d20 7479 7065 2063 6c73 3a20 636c  ram type cls: cl
+00010cb0: 6173 732c 2077 6865 7265 2069 7420 6173  ass, where it as
+00010cc0: 7375 6d65 7320 7468 6174 206b 7761 7267  sumes that kwarg
+00010cd0: 7320 6172 6520 7061 7373 6564 206f 6e20  s are passed on 
+00010ce0: 746f 2062 6173 6520 636c 6173 7365 730a  to base classes.
+00010cf0: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
+00010d00: 6f6e 6c79 5f77 6974 685f 6465 6661 756c  only_with_defaul
+00010d10: 743a 2069 6620 6769 7665 6e20 7769 6c6c  t: if given will
+00010d20: 206f 6e6c 7920 7265 7475 726e 2074 6865   only return the
+00010d30: 206b 7761 7267 7320 7769 7468 2064 6566   kwargs with def
+00010d40: 6175 6c74 2076 616c 7565 730a 2020 2020  ault values.    
+00010d50: 3a72 6574 7572 6e3a 2073 6574 2069 6620  :return: set if 
+00010d60: 6e6f 7420 7769 7468 5f64 6566 6175 6c74  not with_default
+00010d70: 2c20 6f74 6865 7277 6973 6520 7468 6520  , otherwise the 
+00010d80: 6469 6374 2074 6f20 7468 6520 6465 6661  dict to the defa
+00010d90: 756c 7420 7661 6c75 6573 0a20 2020 203a  ult values.    :
+00010da0: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
+00010db0: 207c 2064 6963 745b 7374 725d 0a20 2020   | dict[str].   
+00010dc0: 2022 2222 0a20 2020 2066 726f 6d20 636f   """.    from co
+00010dd0: 6c6c 6563 7469 6f6e 7320 696d 706f 7274  llections import
+00010de0: 204f 7264 6572 6564 4469 6374 0a0a 2020   OrderedDict..  
+00010df0: 2020 6966 206f 6e6c 795f 7769 7468 5f64    if only_with_d
+00010e00: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+00010e10: 6b77 6172 6773 203d 204f 7264 6572 6564  kwargs = Ordered
+00010e20: 4469 6374 2829 0a20 2020 2065 6c73 653a  Dict().    else:
+00010e30: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
+00010e40: 3d20 5b5d 0a20 2020 2066 6f72 2063 6c73  = [].    for cls
+00010e50: 5f20 696e 2069 6e73 7065 6374 2e67 6574  _ in inspect.get
+00010e60: 6d72 6f28 636c 7329 3a0a 2020 2020 2020  mro(cls):.      
+00010e70: 2020 2320 4368 6563 6b20 5079 7468 6f6e    # Check Python
+00010e80: 2066 756e 6374 696f 6e2e 2043 6f75 6c64   function. Could
+00010e90: 2062 6520 6275 696c 7469 6e20 6675 6e63   be builtin func
+00010ea0: 206f 7220 736f 2e20 5079 7468 6f6e 2032   or so. Python 2
+00010eb0: 2067 6574 6172 6773 7065 6320 646f 6573   getargspec does
+00010ec0: 206e 6f74 2077 6f72 6b20 696e 2074 6861   not work in tha
+00010ed0: 7420 6361 7365 2e0a 2020 2020 2020 2020  t case..        
+00010ee0: 6966 206e 6f74 2069 6e73 7065 6374 2e69  if not inspect.i
+00010ef0: 736d 6574 686f 6428 636c 735f 2e5f 5f69  smethod(cls_.__i
+00010f00: 6e69 745f 5f29 2061 6e64 206e 6f74 2069  nit__) and not i
+00010f10: 6e73 7065 6374 2e69 7366 756e 6374 696f  nspect.isfunctio
+00010f20: 6e28 636c 735f 2e5f 5f69 6e69 745f 5f29  n(cls_.__init__)
+00010f30: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00010f40: 6e74 696e 7565 0a20 2020 2020 2020 2061  ntinue.        a
+00010f50: 7267 5f73 7065 6320 3d20 6765 7461 7267  rg_spec = getarg
+00010f60: 7370 6563 2863 6c73 5f2e 5f5f 696e 6974  spec(cls_.__init
+00010f70: 5f5f 290a 2020 2020 2020 2020 6172 6773  __).        args
+00010f80: 203d 2061 7267 5f73 7065 632e 6172 6773   = arg_spec.args
+00010f90: 5b31 3a5d 2020 2320 6669 7273 7420 6172  [1:]  # first ar
+00010fa0: 6720 6973 2073 656c 662c 2069 676e 6f72  g is self, ignor
+00010fb0: 650a 2020 2020 2020 2020 6966 206f 6e6c  e.        if onl
+00010fc0: 795f 7769 7468 5f64 6566 6175 6c74 3a0a  y_with_default:.
+00010fd0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00010fe0: 7267 5f73 7065 632e 6465 6661 756c 7473  rg_spec.defaults
+00010ff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011000: 2020 6173 7365 7274 206c 656e 2861 7267    assert len(arg
+00011010: 5f73 7065 632e 6465 6661 756c 7473 2920  _spec.defaults) 
+00011020: 3c3d 206c 656e 2861 7267 7329 0a20 2020  <= len(args).   
+00011030: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+00011040: 7320 3d20 6172 6773 5b6c 656e 2861 7267  s = args[len(arg
+00011050: 7329 202d 206c 656e 2861 7267 5f73 7065  s) - len(arg_spe
+00011060: 632e 6465 6661 756c 7473 2920 3a5d 0a20  c.defaults) :]. 
+00011070: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00011080: 7373 6572 7420 6c65 6e28 6172 675f 7370  ssert len(arg_sp
+00011090: 6563 2e64 6566 6175 6c74 7329 203d 3d20  ec.defaults) == 
+000110a0: 6c65 6e28 6172 6773 292c 2061 7267 5f73  len(args), arg_s
+000110b0: 7065 630a 2020 2020 2020 2020 2020 2020  pec.            
+000110c0: 2020 2020 666f 7220 6172 672c 2064 6566      for arg, def
+000110d0: 6175 6c74 2069 6e20 7a69 7028 6172 6773  ault in zip(args
+000110e0: 2c20 6172 675f 7370 6563 2e64 6566 6175  , arg_spec.defau
+000110f0: 6c74 7329 3a0a 2020 2020 2020 2020 2020  lts):.          
+00011100: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+00011110: 5b61 7267 5d20 3d20 6465 6661 756c 740a  [arg] = default.
+00011120: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00011130: 2020 2020 2020 2020 2020 666f 7220 6172            for ar
+00011140: 6720 696e 2061 7267 733a 0a20 2020 2020  g in args:.     
+00011150: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
+00011160: 6720 6e6f 7420 696e 206b 7761 7267 733a  g not in kwargs:
+00011170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011180: 2020 2020 206b 7761 7267 732e 6170 7065       kwargs.appe
+00011190: 6e64 2861 7267 290a 2020 2020 7265 7475  nd(arg).    retu
+000111a0: 726e 206b 7761 7267 730a 0a0a 6465 6620  rn kwargs...def 
+000111b0: 6765 7461 7267 7370 6563 2866 756e 6329  getargspec(func)
+000111c0: 3a0a 2020 2020 2222 220a 2020 2020 3a66  :.    """.    :f
+000111d0: 756e 633a 6069 6e73 7065 6374 2e67 6574  unc:`inspect.get
+000111e0: 6675 6c6c 6172 6773 7065 6360 206f 7220  fullargspec` or 
+000111f0: 6069 6e73 7065 6374 2e67 6574 6172 6773  `inspect.getargs
+00011200: 7065 6360 2028 5079 7468 6f6e 2032 290a  pec` (Python 2).
+00011210: 0a20 2020 203a 7061 7261 6d20 6675 6e63  .    :param func
+00011220: 3a0a 2020 2020 3a72 6574 7572 6e3a 2046  :.    :return: F
+00011230: 756c 6c41 7267 5370 6563 0a20 2020 2022  ullArgSpec.    "
+00011240: 2222 0a20 2020 2069 6620 5059 333a 0a20  "".    if PY3:. 
+00011250: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+00011260: 7370 6563 742e 6765 7466 756c 6c61 7267  spect.getfullarg
+00011270: 7370 6563 2866 756e 6329 0a20 2020 2065  spec(func).    e
+00011280: 6c73 653a 0a20 2020 2020 2020 2023 206e  lse:.        # n
+00011290: 6f69 6e73 7065 6374 696f 6e20 5079 4465  oinspection PyDe
+000112a0: 7072 6563 6174 696f 6e0a 2020 2020 2020  precation.      
+000112b0: 2020 7265 7475 726e 2069 6e73 7065 6374    return inspect
+000112c0: 2e67 6574 6172 6773 7065 6328 6675 6e63  .getargspec(func
+000112d0: 290a 0a0a 6465 6620 636f 6c6c 6563 745f  )...def collect_
+000112e0: 6d61 6e64 6174 6f72 795f 636c 6173 735f  mandatory_class_
+000112f0: 696e 6974 5f6b 7761 7267 7328 636c 7329  init_kwargs(cls)
+00011300: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00011310: 6172 616d 2074 7970 6520 636c 733a 0a20  aram type cls:. 
+00011320: 2020 203a 7265 7475 726e 3a20 6c69 7374     :return: list
+00011330: 206f 6620 6b77 6172 6773 2077 6869 6368   of kwargs which
+00011340: 2068 6176 6520 6e6f 2064 6566 6175 6c74   have no default
+00011350: 2c20 692e 652e 2077 6869 6368 206d 7573  , i.e. which mus
+00011360: 7420 6265 2070 726f 7669 6465 640a 2020  t be provided.  
+00011370: 2020 3a72 7479 7065 3a20 6c69 7374 5b73    :rtype: list[s
+00011380: 7472 5d0a 2020 2020 2222 220a 2020 2020  tr].    """.    
+00011390: 616c 6c5f 6b77 6172 6773 203d 2063 6f6c  all_kwargs = col
+000113a0: 6c65 6374 5f63 6c61 7373 5f69 6e69 745f  lect_class_init_
+000113b0: 6b77 6172 6773 2863 6c73 2c20 6f6e 6c79  kwargs(cls, only
+000113c0: 5f77 6974 685f 6465 6661 756c 743d 4661  _with_default=Fa
+000113d0: 6c73 6529 0a20 2020 2064 6566 6175 6c74  lse).    default
+000113e0: 5f6b 7761 7267 7320 3d20 636f 6c6c 6563  _kwargs = collec
+000113f0: 745f 636c 6173 735f 696e 6974 5f6b 7761  t_class_init_kwa
+00011400: 7267 7328 636c 732c 206f 6e6c 795f 7769  rgs(cls, only_wi
+00011410: 7468 5f64 6566 6175 6c74 3d54 7275 6529  th_default=True)
+00011420: 0a20 2020 206d 616e 6461 746f 7279 5f6b  .    mandatory_k
+00011430: 7761 7267 7320 3d20 5b5d 0a20 2020 2066  wargs = [].    f
+00011440: 6f72 2061 7267 2069 6e20 616c 6c5f 6b77  or arg in all_kw
+00011450: 6172 6773 3a0a 2020 2020 2020 2020 6966  args:.        if
+00011460: 2061 7267 206e 6f74 2069 6e20 6465 6661   arg not in defa
+00011470: 756c 745f 6b77 6172 6773 3a0a 2020 2020  ult_kwargs:.    
+00011480: 2020 2020 2020 2020 6d61 6e64 6174 6f72          mandator
+00011490: 795f 6b77 6172 6773 2e61 7070 656e 6428  y_kwargs.append(
+000114a0: 6172 6729 0a20 2020 2072 6574 7572 6e20  arg).    return 
+000114b0: 6d61 6e64 6174 6f72 795f 6b77 6172 6773  mandatory_kwargs
+000114c0: 0a0a 0a64 6566 2068 656c 705f 6f6e 5f74  ...def help_on_t
+000114d0: 7970 655f 6572 726f 725f 7772 6f6e 675f  ype_error_wrong_
+000114e0: 6172 6773 2863 6c73 2c20 6b77 6172 6773  args(cls, kwargs
+000114f0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00011500: 7061 7261 6d20 7479 7065 2063 6c73 3a0a  param type cls:.
+00011510: 2020 2020 3a70 6172 616d 206c 6973 745b      :param list[
+00011520: 7374 725d 206b 7761 7267 733a 0a20 2020  str] kwargs:.   
+00011530: 2022 2222 0a20 2020 206d 616e 6461 746f   """.    mandato
+00011540: 7279 5f61 7267 7320 3d20 636f 6c6c 6563  ry_args = collec
+00011550: 745f 6d61 6e64 6174 6f72 795f 636c 6173  t_mandatory_clas
+00011560: 735f 696e 6974 5f6b 7761 7267 7328 636c  s_init_kwargs(cl
+00011570: 7329 0a20 2020 2066 6f72 2061 7267 2069  s).    for arg i
+00011580: 6e20 6b77 6172 6773 3a0a 2020 2020 2020  n kwargs:.      
+00011590: 2020 6966 2061 7267 2069 6e20 6d61 6e64    if arg in mand
+000115a0: 6174 6f72 795f 6172 6773 3a0a 2020 2020  atory_args:.    
+000115b0: 2020 2020 2020 2020 6d61 6e64 6174 6f72          mandator
+000115c0: 795f 6172 6773 2e72 656d 6f76 6528 6172  y_args.remove(ar
+000115d0: 6729 0a20 2020 2061 6c6c 5f6b 7761 7267  g).    all_kwarg
+000115e0: 7320 3d20 636f 6c6c 6563 745f 636c 6173  s = collect_clas
+000115f0: 735f 696e 6974 5f6b 7761 7267 7328 636c  s_init_kwargs(cl
+00011600: 7329 0a20 2020 2075 6e6b 6e6f 776e 5f61  s).    unknown_a
+00011610: 7267 7320 3d20 5b5d 0a20 2020 2066 6f72  rgs = [].    for
+00011620: 2061 7267 2069 6e20 6b77 6172 6773 3a0a   arg in kwargs:.
+00011630: 2020 2020 2020 2020 6966 2061 7267 206e          if arg n
+00011640: 6f74 2069 6e20 616c 6c5f 6b77 6172 6773  ot in all_kwargs
+00011650: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
+00011660: 6b6e 6f77 6e5f 6172 6773 2e61 7070 656e  known_args.appen
+00011670: 6428 6172 6729 0a20 2020 2069 6620 6d61  d(arg).    if ma
+00011680: 6e64 6174 6f72 795f 6172 6773 206f 7220  ndatory_args or 
+00011690: 756e 6b6e 6f77 6e5f 6172 6773 3a0a 2020  unknown_args:.  
+000116a0: 2020 2020 2020 7072 696e 7428 2241 7267        print("Arg
+000116b0: 7320 6d69 736d 6174 6368 3f20 4d69 7373  s mismatch? Miss
+000116c0: 696e 6720 6172 6520 2572 2c20 756e 6b6e  ing are %r, unkn
+000116d0: 6f77 6e73 2061 7265 2025 722e 204b 7761  owns are %r. Kwa
+000116e0: 7267 7320 2572 2e22 2025 2028 6d61 6e64  rgs %r." % (mand
+000116f0: 6174 6f72 795f 6172 6773 2c20 756e 6b6e  atory_args, unkn
+00011700: 6f77 6e5f 6172 6773 2c20 6b77 6172 6773  own_args, kwargs
+00011710: 2929 0a0a 0a64 6566 2063 7573 746f 6d5f  ))...def custom_
+00011720: 6578 6563 2873 6f75 7263 652c 2073 6f75  exec(source, sou
+00011730: 7263 655f 6669 6c65 6e61 6d65 2c20 7573  rce_filename, us
+00011740: 6572 5f6e 732c 2075 7365 725f 676c 6f62  er_ns, user_glob
+00011750: 616c 5f6e 7329 3a0a 2020 2020 2222 220a  al_ns):.    """.
+00011760: 2020 2020 3a70 6172 616d 2073 7472 2073      :param str s
+00011770: 6f75 7263 653a 0a20 2020 203a 7061 7261  ource:.    :para
+00011780: 6d20 7374 7220 736f 7572 6365 5f66 696c  m str source_fil
+00011790: 656e 616d 653a 0a20 2020 203a 7061 7261  ename:.    :para
+000117a0: 6d20 6469 6374 5b73 7472 5d20 7573 6572  m dict[str] user
+000117b0: 5f6e 733a 0a20 2020 203a 7061 7261 6d20  _ns:.    :param 
+000117c0: 6469 6374 5b73 7472 5d20 7573 6572 5f67  dict[str] user_g
+000117d0: 6c6f 6261 6c5f 6e73 3a0a 2020 2020 3a72  lobal_ns:.    :r
+000117e0: 6574 7572 6e3a 206e 6f74 6869 6e67 0a20  eturn: nothing. 
+000117f0: 2020 2022 2222 0a20 2020 2069 6620 6e6f     """.    if no
+00011800: 7420 736f 7572 6365 2e65 6e64 7377 6974  t source.endswit
+00011810: 6828 225c 6e22 293a 0a20 2020 2020 2020  h("\n"):.       
+00011820: 2073 6f75 7263 6520 2b3d 2022 5c6e 220a   source += "\n".
+00011830: 2020 2020 636f 203d 2063 6f6d 7069 6c65      co = compile
+00011840: 2873 6f75 7263 652c 2073 6f75 7263 655f  (source, source_
+00011850: 6669 6c65 6e61 6d65 2c20 2265 7865 6322  filename, "exec"
+00011860: 290a 2020 2020 7573 6572 5f67 6c6f 6261  ).    user_globa
+00011870: 6c5f 6e73 5b22 5f5f 7061 636b 6167 655f  l_ns["__package_
+00011880: 5f22 5d20 3d20 2272 6574 7572 6e6e 2220  _"] = "returnn" 
+00011890: 2023 2069 6d70 6f72 7461 6e74 2073 6f20   # important so 
+000118a0: 7468 6174 2069 6d70 6f72 7473 2077 6f72  that imports wor
+000118b0: 6b0a 2020 2020 6576 616c 2863 6f2c 2075  k.    eval(co, u
+000118c0: 7365 725f 676c 6f62 616c 5f6e 732c 2075  ser_global_ns, u
+000118d0: 7365 725f 6e73 290a 0a0a 636c 6173 7320  ser_ns)...class 
+000118e0: 4672 6f7a 656e 4469 6374 2864 6963 7429  FrozenDict(dict)
+000118f0: 3a0a 2020 2020 2222 220a 2020 2020 4672  :.    """.    Fr
+00011900: 6f7a 656e 2064 6963 742e 0a20 2020 2022  ozen dict..    "
+00011910: 2222 0a0a 2020 2020 6465 6620 5f5f 7365  ""..    def __se
+00011920: 7469 7465 6d5f 5f28 7365 6c66 2c20 6b65  titem__(self, ke
+00011930: 792c 2076 616c 7565 293a 0a20 2020 2020  y, value):.     
+00011940: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00011950: 726f 7228 2246 726f 7a65 6e44 6963 7420  ror("FrozenDict 
+00011960: 6361 6e6e 6f74 2062 6520 6d6f 6469 6669  cannot be modifi
+00011970: 6564 2229 0a0a 2020 2020 6465 6620 5f5f  ed")..    def __
+00011980: 6861 7368 5f5f 2873 656c 6629 3a0a 2020  hash__(self):.  
+00011990: 2020 2020 2020 7265 7475 726e 2068 6173        return has
+000119a0: 6828 7475 706c 6528 736f 7274 6564 2873  h(tuple(sorted(s
+000119b0: 656c 662e 6974 656d 7328 2929 2929 0a0a  elf.items())))..
+000119c0: 0a64 6566 206d 616b 655f 6861 7368 6162  .def make_hashab
+000119d0: 6c65 286f 626a 293a 0a20 2020 2022 2222  le(obj):.    """
+000119e0: 0a20 2020 2054 6865 616e 6f20 6e65 6564  .    Theano need
+000119f0: 7320 6861 7368 6162 6c65 206f 626a 6563  s hashable objec
+00011a00: 7473 2069 6e20 736f 6d65 2063 6173 6573  ts in some cases
+00011a10: 2c20 652e 672e 2074 6865 2070 726f 7065  , e.g. the prope
+00011a20: 7274 6965 7320 6f66 204f 7073 2e0a 2020  rties of Ops..  
+00011a30: 2020 5468 6973 2063 6f6e 7665 7274 7320    This converts 
+00011a40: 616c 6c20 6f62 6a65 6374 7320 6173 2073  all objects as s
+00011a50: 7563 682c 2069 2e65 2e20 696e 746f 2069  uch, i.e. into i
+00011a60: 6d6d 7574 6162 6c65 2066 726f 7a65 6e20  mmutable frozen 
+00011a70: 7479 7065 732e 0a0a 2020 2020 3a70 6172  types...    :par
+00011a80: 616d 2054 7c64 6963 747c 6c69 7374 7c74  am T|dict|list|t
+00011a90: 7570 6c65 206f 626a 3a0a 2020 2020 3a72  uple obj:.    :r
+00011aa0: 7479 7065 3a20 547c 4672 6f7a 656e 4469  type: T|FrozenDi
+00011ab0: 6374 7c74 7570 6c65 0a20 2020 2022 2222  ct|tuple.    """
+00011ac0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00011ad0: 6365 286f 626a 2c20 6469 6374 293a 0a20  ce(obj, dict):. 
+00011ae0: 2020 2020 2020 2072 6574 7572 6e20 4672         return Fr
+00011af0: 6f7a 656e 4469 6374 285b 6d61 6b65 5f68  ozenDict([make_h
+00011b00: 6173 6861 626c 6528 6974 656d 2920 666f  ashable(item) fo
+00011b10: 7220 6974 656d 2069 6e20 6f62 6a2e 6974  r item in obj.it
+00011b20: 656d 7328 295d 290a 2020 2020 6966 2069  ems()]).    if i
+00011b30: 7369 6e73 7461 6e63 6528 6f62 6a2c 2028  sinstance(obj, (
+00011b40: 6c69 7374 2c20 7475 706c 6529 293a 0a20  list, tuple)):. 
+00011b50: 2020 2020 2020 2072 6574 7572 6e20 7475         return tu
+00011b60: 706c 6528 5b6d 616b 655f 6861 7368 6162  ple([make_hashab
+00011b70: 6c65 2869 7465 6d29 2066 6f72 2069 7465  le(item) for ite
+00011b80: 6d20 696e 206f 626a 5d29 0a20 2020 2069  m in obj]).    i
+00011b90: 6620 6973 696e 7374 616e 6365 286f 626a  f isinstance(obj
+00011ba0: 2c20 2873 7472 2c20 756e 6963 6f64 652c  , (str, unicode,
+00011bb0: 2066 6c6f 6174 2c20 696e 742c 206c 6f6e   float, int, lon
+00011bc0: 6729 293a 0a20 2020 2020 2020 2072 6574  g)):.        ret
+00011bd0: 7572 6e20 6f62 6a0a 2020 2020 6966 206f  urn obj.    if o
+00011be0: 626a 2069 7320 4e6f 6e65 3a0a 2020 2020  bj is None:.    
+00011bf0: 2020 2020 7265 7475 726e 206f 626a 0a20      return obj. 
+00011c00: 2020 2069 6620 2274 656e 736f 7266 6c6f     if "tensorflo
+00011c10: 7722 2069 6e20 7379 732e 6d6f 6475 6c65  w" in sys.module
+00011c20: 733a 0a20 2020 2020 2020 2069 6d70 6f72  s:.        impor
+00011c30: 7420 7465 6e73 6f72 666c 6f77 2061 7320  t tensorflow as 
+00011c40: 7466 0a0a 2020 2020 2020 2020 6966 2069  tf..        if i
+00011c50: 7369 6e73 7461 6e63 6528 6f62 6a2c 2074  sinstance(obj, t
+00011c60: 662e 5465 6e73 6f72 293a 0a20 2020 2020  f.Tensor):.     
+00011c70: 2020 2020 2020 2072 6574 7572 6e20 5265         return Re
+00011c80: 6649 6445 7128 6f62 6a29 0a20 2020 2061  fIdEq(obj).    a
+00011c90: 7373 6572 7420 4661 6c73 652c 2022 646f  ssert False, "do
+00011ca0: 6e27 7420 6b6e 6f77 2068 6f77 2074 6f20  n't know how to 
+00011cb0: 6d61 6b65 2068 6173 6861 626c 653a 2025  make hashable: %
+00011cc0: 7220 2825 7229 2220 2520 286f 626a 2c20  r (%r)" % (obj, 
+00011cd0: 7479 7065 286f 626a 2929 0a0a 0a63 6c61  type(obj))...cla
+00011ce0: 7373 2052 6566 4964 4571 2847 656e 6572  ss RefIdEq(Gener
+00011cf0: 6963 5b54 5d29 3a0a 2020 2020 2222 220a  ic[T]):.    """.
+00011d00: 2020 2020 5265 6665 7265 6e63 6520 746f      Reference to
+00011d10: 2073 6f6d 6520 6f62 6a65 6374 2028 652e   some object (e.
+00011d20: 672e 2074 2e66 5465 6e73 6f72 292c 2062  g. t.fTensor), b
+00011d30: 7574 2074 6869 7320 6f62 6a65 6374 2069  ut this object i
+00011d40: 7320 616c 7761 7973 2068 6173 6861 626c  s always hashabl
+00011d50: 652c 0a20 2020 2061 6e64 2075 7365 7320  e,.    and uses 
+00011d60: 7468 6520 6069 6460 206f 6620 7468 6520  the `id` of the 
+00011d70: 6675 6e63 7469 6f6e 2066 6f72 2074 6865  function for the
+00011d80: 2068 6173 6820 616e 6420 6571 7561 6c69   hash and equali
+00011d90: 7479 2e0a 0a20 2020 2028 496e 2063 6173  ty...    (In cas
+00011da0: 6520 6f66 2074 662e 5465 6e73 6f72 2c20  e of tf.Tensor, 
+00011db0: 7468 6973 2069 7320 666f 7220 636f 6d70  this is for comp
+00011dc0: 6174 6962 696c 6974 790a 2020 2020 2062  atibility.     b
+00011dd0: 6563 6175 7365 2074 662e 5465 6e73 6f72  ecause tf.Tensor
+00011de0: 2e72 6566 2829 2077 6173 206e 6f74 2061  .ref() was not a
+00011df0: 7661 696c 6162 6c65 2069 6e20 6561 726c  vailable in earl
+00011e00: 6965 7220 5446 2076 6572 7369 6f6e 732e  ier TF versions.
+00011e10: 0a20 2020 2020 486f 7765 7665 722c 2077  .     However, w
+00011e20: 6520 616c 736f 206e 6565 6420 7468 6973  e also need this
+00011e30: 2066 6f72 203a 636c 6173 733a 6044 6963   for :class:`Dic
+00011e40: 7452 6566 4b65 7973 602e 290a 2020 2020  tRefKeys`.).    
+00011e50: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+00011e60: 6e69 745f 5f28 7365 6c66 2c20 6f62 6a3a  nit__(self, obj:
+00011e70: 2054 293a 0a20 2020 2020 2020 2022 2222   T):.        """
+00011e80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00011e90: 6f62 6a3a 2066 6f72 2065 7861 6d70 6c65  obj: for example
+00011ea0: 2074 662e 5465 6e73 6f72 0a20 2020 2020   tf.Tensor.     
+00011eb0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00011ec0: 656c 662e 6f62 6a20 3d20 6f62 6a0a 0a20  elf.obj = obj.. 
+00011ed0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+00011ee0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00011ef0: 6574 7572 6e20 2254 656e 736f 7252 6566  eturn "TensorRef
+00011f00: 7b25 727d 2220 2520 7365 6c66 2e6f 626a  {%r}" % self.obj
+00011f10: 0a0a 2020 2020 6465 6620 5f5f 6571 5f5f  ..    def __eq__
+00011f20: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+00011f30: 2020 2020 2020 2069 6620 6f74 6865 7220         if other 
+00011f40: 6973 204e 6f6e 6520 6f72 206e 6f74 2069  is None or not i
+00011f50: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
+00011f60: 2052 6566 4964 4571 293a 0a20 2020 2020   RefIdEq):.     
+00011f70: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00011f80: 6c73 650a 2020 2020 2020 2020 7265 7475  lse.        retu
+00011f90: 726e 2073 656c 662e 6f62 6a20 6973 206f  rn self.obj is o
+00011fa0: 7468 6572 2e6f 626a 0a0a 2020 2020 6465  ther.obj..    de
+00011fb0: 6620 5f5f 6e65 5f5f 2873 656c 662c 206f  f __ne__(self, o
+00011fc0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+00011fd0: 6574 7572 6e20 6e6f 7420 7365 6c66 2e5f  eturn not self._
+00011fe0: 5f65 715f 5f28 6f74 6865 7229 0a0a 2020  _eq__(other)..  
+00011ff0: 2020 6465 6620 5f5f 6861 7368 5f5f 2873    def __hash__(s
+00012000: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00012010: 7475 726e 2069 6428 7365 6c66 2e6f 626a  turn id(self.obj
+00012020: 290a 0a0a 636c 6173 7320 4469 6374 5265  )...class DictRe
+00012030: 664b 6579 7328 4765 6e65 7269 635b 4b2c  fKeys(Generic[K,
+00012040: 2056 5d29 3a0a 2020 2020 2222 220a 2020   V]):.    """.  
+00012050: 2020 4c69 6b65 2060 6469 6374 602c 2062    Like `dict`, b
+00012060: 7574 2068 6173 6820 616e 6420 6571 7561  ut hash and equa
+00012070: 6c69 7479 206f 6620 7468 6520 6b65 7973  lity of the keys
+00012080: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00012090: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+000120a0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+000120b0: 6420 3d20 7b7d 2020 2320 7479 7065 3a20  d = {}  # type: 
+000120c0: 4469 6374 5b52 6566 4964 4571 5b4b 5d2c  Dict[RefIdEq[K],
+000120d0: 2056 5d0a 0a20 2020 2064 6566 205f 5f72   V]..    def __r
+000120e0: 6570 725f 5f28 7365 6c66 293a 0a20 2020  epr__(self):.   
+000120f0: 2020 2020 2072 6574 7572 6e20 2244 6963       return "Dic
+00012100: 7452 6566 4b65 7973 2825 7329 2220 2520  tRefKeys(%s)" % 
+00012110: 222c 2022 2e6a 6f69 6e28 5b22 2572 3a20  ", ".join(["%r: 
+00012120: 2572 2220 2520 286b 2c20 7629 2066 6f72  %r" % (k, v) for
+00012130: 2028 6b2c 2076 2920 696e 2073 656c 662e   (k, v) in self.
+00012140: 6974 656d 7328 295d 290a 0a20 2020 2064  items()])..    d
+00012150: 6566 2069 7465 6d73 2873 656c 6629 202d  ef items(self) -
+00012160: 3e20 4974 6572 6162 6c65 5b54 7570 6c65  > Iterable[Tuple
+00012170: 5b4b 2c20 565d 5d3a 0a20 2020 2020 2020  [K, V]]:.       
+00012180: 2022 2222 6974 656d 7322 2222 0a20 2020   """items""".   
+00012190: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+000121a0: 2073 656c 662e 5f64 2e69 7465 6d73 2829   self._d.items()
+000121b0: 3a0a 2020 2020 2020 2020 2020 2020 7969  :.            yi
+000121c0: 656c 6420 6b2e 6f62 6a2c 2076 0a0a 2020  eld k.obj, v..  
+000121d0: 2020 6465 6620 6b65 7973 2873 656c 6629    def keys(self)
+000121e0: 202d 3e20 4974 6572 6162 6c65 5b4b 5d3a   -> Iterable[K]:
+000121f0: 0a20 2020 2020 2020 2022 2222 6b65 7973  .        """keys
+00012200: 2222 220a 2020 2020 2020 2020 666f 7220  """.        for 
+00012210: 6b20 696e 2073 656c 662e 5f64 2e6b 6579  k in self._d.key
+00012220: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00012230: 2079 6965 6c64 206b 2e6f 626a 0a0a 2020   yield k.obj..  
+00012240: 2020 6465 6620 7661 6c75 6573 2873 656c    def values(sel
+00012250: 6629 202d 3e20 4974 6572 6162 6c65 5b56  f) -> Iterable[V
+00012260: 5d3a 0a20 2020 2020 2020 2022 2222 7661  ]:.        """va
+00012270: 6c75 6573 2222 220a 2020 2020 2020 2020  lues""".        
+00012280: 666f 7220 7620 696e 2073 656c 662e 5f64  for v in self._d
+00012290: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
+000122a0: 2020 2020 2020 2079 6965 6c64 2076 0a0a         yield v..
+000122b0: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+000122c0: 6d5f 5f28 7365 6c66 2c20 6974 656d 3a20  m__(self, item: 
+000122d0: 4b29 202d 3e20 563a 0a20 2020 2020 2020  K) -> V:.       
+000122e0: 2072 6574 7572 6e20 7365 6c66 2e5f 645b   return self._d[
+000122f0: 5265 6649 6445 7128 6974 656d 295d 0a0a  RefIdEq(item)]..
+00012300: 2020 2020 6465 6620 5f5f 7365 7469 7465      def __setite
+00012310: 6d5f 5f28 7365 6c66 2c20 6b65 793a 204b  m__(self, key: K
+00012320: 2c20 7661 6c75 653a 2056 293a 0a20 2020  , value: V):.   
+00012330: 2020 2020 2073 656c 662e 5f64 5b52 6566       self._d[Ref
+00012340: 4964 4571 286b 6579 295d 203d 2076 616c  IdEq(key)] = val
+00012350: 7565 0a0a 2020 2020 6465 6620 5f5f 636f  ue..    def __co
+00012360: 6e74 6169 6e73 5f5f 2873 656c 662c 2069  ntains__(self, i
+00012370: 7465 6d3a 204b 293a 0a20 2020 2020 2020  tem: K):.       
+00012380: 2072 6574 7572 6e20 5265 6649 6445 7128   return RefIdEq(
+00012390: 6974 656d 2920 696e 2073 656c 662e 5f64  item) in self._d
+000123a0: 0a0a 0a64 6566 206d 616b 655f 646c 6c5f  ...def make_dll_
+000123b0: 6e61 6d65 2862 6173 656e 616d 6529 3a0a  name(basename):.
+000123c0: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+000123d0: 616d 2073 7472 2062 6173 656e 616d 653a  am str basename:
+000123e0: 0a20 2020 203a 7265 7475 726e 3a20 652e  .    :return: e.
+000123f0: 672e 2022 6c69 6225 732e 736f 2220 2520  g. "lib%s.so" % 
+00012400: 6261 7365 6e61 6d65 2c20 6465 7065 6e64  basename, depend
+00012410: 696e 6720 6f6e 2073 7973 2e70 6c61 7466  ing on sys.platf
+00012420: 6f72 6d0a 2020 2020 3a72 7479 7065 3a20  orm.    :rtype: 
+00012430: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
+00012440: 6966 2073 7973 2e70 6c61 7466 6f72 6d20  if sys.platform 
+00012450: 3d3d 2022 6461 7277 696e 223a 0a20 2020  == "darwin":.   
+00012460: 2020 2020 2072 6574 7572 6e20 226c 6962       return "lib
+00012470: 2573 2e64 796c 6962 2220 2520 6261 7365  %s.dylib" % base
+00012480: 6e61 6d65 0a20 2020 2065 6c69 6620 7379  name.    elif sy
+00012490: 732e 706c 6174 666f 726d 203d 3d20 2277  s.platform == "w
+000124a0: 696e 3332 223a 0a20 2020 2020 2020 2072  in32":.        r
+000124b0: 6574 7572 6e20 2225 732e 646c 6c22 2025  eturn "%s.dll" %
+000124c0: 2062 6173 656e 616d 650a 2020 2020 656c   basename.    el
+000124d0: 7365 3a20 2023 204c 696e 7578 2c20 556e  se:  # Linux, Un
+000124e0: 6978 0a20 2020 2020 2020 2072 6574 7572  ix.        retur
+000124f0: 6e20 226c 6962 2573 2e73 6f22 2025 2062  n "lib%s.so" % b
+00012500: 6173 656e 616d 650a 0a0a 6465 6620 6573  asename...def es
+00012510: 6361 7065 5f63 5f73 7472 2873 293a 0a20  cape_c_str(s):. 
+00012520: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+00012530: 6d20 7374 7220 733a 0a20 2020 203a 7265  m str s:.    :re
+00012540: 7475 726e 3a20 432d 6573 6361 7065 6420  turn: C-escaped 
+00012550: 7374 720a 2020 2020 3a72 7479 7065 3a20  str.    :rtype: 
+00012560: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
+00012570: 7265 7475 726e 2027 2225 7322 2720 2520  return '"%s"' % 
+00012580: 732e 7265 706c 6163 6528 225c 5c5c 5c22  s.replace("\\\\"
+00012590: 2c20 225c 5c22 292e 7265 706c 6163 6528  , "\\").replace(
+000125a0: 225c 6e22 2c20 225c 5c6e 2229 2e72 6570  "\n", "\\n").rep
+000125b0: 6c61 6365 2827 2227 2c20 275c 5c22 2729  lace('"', '\\"')
+000125c0: 2e72 6570 6c61 6365 2822 2722 2c20 225c  .replace("'", "\
+000125d0: 5c27 2229 0a0a 0a64 6566 2061 7474 725f  \'")...def attr_
+000125e0: 6368 6169 6e28 6261 7365 2c20 6174 7472  chain(base, attr
+000125f0: 6962 7329 3a0a 2020 2020 2222 220a 2020  ibs):.    """.  
+00012600: 2020 3a70 6172 616d 206f 626a 6563 7420    :param object 
+00012610: 6261 7365 3a0a 2020 2020 3a70 6172 616d  base:.    :param
+00012620: 206c 6973 745b 7374 725d 7c74 7570 6c65   list[str]|tuple
+00012630: 5b73 7472 5d7c 7374 7220 6174 7472 6962  [str]|str attrib
+00012640: 733a 0a20 2020 203a 7265 7475 726e 3a20  s:.    :return: 
+00012650: 6765 7461 7474 7228 6765 7461 7474 7228  getattr(getattr(
+00012660: 6f62 6a65 6374 2c20 6174 7472 6962 735b  object, attribs[
+00012670: 305d 292c 2061 7474 7269 6273 5b31 5d29  0]), attribs[1])
+00012680: 202e 2e2e 0a20 2020 203a 7274 7970 653a   ....    :rtype:
+00012690: 206f 626a 6563 740a 2020 2020 2222 220a   object.    """.
+000126a0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+000126b0: 7461 6e63 6528 6174 7472 6962 732c 2028  tance(attribs, (
+000126c0: 6c69 7374 2c20 7475 706c 6529 293a 0a20  list, tuple)):. 
+000126d0: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+000126e0: 696e 7374 616e 6365 2861 7474 7269 6273  instance(attribs
+000126f0: 2c20 7374 7229 0a20 2020 2020 2020 2061  , str).        a
+00012700: 7474 7269 6273 203d 205b 6174 7472 6962  ttribs = [attrib
+00012710: 735d 0a20 2020 2065 6c73 653a 0a20 2020  s].    else:.   
+00012720: 2020 2020 2061 7474 7269 6273 203d 206c       attribs = l
+00012730: 6973 7428 6174 7472 6962 7329 0a20 2020  ist(attribs).   
+00012740: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00012750: 6c65 6e28 6174 7472 6962 7329 293a 0a20  len(attribs)):. 
+00012760: 2020 2020 2020 2062 6173 6520 3d20 6765         base = ge
+00012770: 7461 7474 7228 6261 7365 2c20 6174 7472  tattr(base, attr
+00012780: 6962 735b 695d 290a 2020 2020 7265 7475  ibs[i]).    retu
+00012790: 726e 2062 6173 650a 0a0a 6465 6620 746f  rn base...def to
+000127a0: 5f62 6f6f 6c28 7629 3a0a 2020 2020 2222  _bool(v):.    ""
+000127b0: 220a 2020 2020 3a70 6172 616d 2069 6e74  ".    :param int
+000127c0: 7c66 6c6f 6174 7c73 7472 2076 3a20 6966  |float|str v: if
+000127d0: 2069 7420 6973 2061 2073 7472 696e 672c   it is a string,
+000127e0: 2069 7420 7368 6f75 6c64 2072 6570 7265   it should repre
+000127f0: 7365 6e74 2073 6f6d 6520 696e 7465 6765  sent some intege
+00012800: 722c 206f 7220 616c 7465 726e 6174 6976  r, or alternativ
+00012810: 656c 7920 2274 7275 6522 206f 7220 2266  ely "true" or "f
+00012820: 616c 7365 220a 2020 2020 3a72 7479 7065  alse".    :rtype
+00012830: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
+00012840: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00012850: 7265 7475 726e 2062 6f6f 6c28 696e 7428  return bool(int(
+00012860: 7629 290a 2020 2020 6578 6365 7074 2056  v)).    except V
+00012870: 616c 7565 4572 726f 723a 0a20 2020 2020  alueError:.     
+00012880: 2020 2070 6173 730a 2020 2020 6966 2069     pass.    if i
+00012890: 7369 6e73 7461 6e63 6528 762c 2028 7374  sinstance(v, (st
+000128a0: 722c 2075 6e69 636f 6465 2929 3a0a 2020  r, unicode)):.  
+000128b0: 2020 2020 2020 7620 3d20 762e 6c6f 7765        v = v.lowe
+000128c0: 7228 290a 2020 2020 2020 2020 6966 2076  r().        if v
+000128d0: 2069 6e20 5b22 7472 7565 222c 2022 7965   in ["true", "ye
+000128e0: 7322 2c20 226f 6e22 2c20 2231 225d 3a0a  s", "on", "1"]:.
+000128f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012900: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+00012910: 6966 2076 2069 6e20 5b22 6661 6c73 6522  if v in ["false"
+00012920: 2c20 226e 6f22 2c20 226f 6666 222c 2022  , "no", "off", "
+00012930: 3022 5d3a 0a20 2020 2020 2020 2020 2020  0"]:.           
+00012940: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00012950: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00012960: 6f72 2822 746f 5f62 6f6f 6c20 6361 6e6e  or("to_bool cann
+00012970: 6f74 2068 616e 646c 6520 2572 2220 2520  ot handle %r" % 
+00012980: 7629 0a0a 0a64 6566 2061 735f 7374 7228  v)...def as_str(
+00012990: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+000129a0: 3a70 6172 616d 2073 7472 7c75 6e69 636f  :param str|unico
+000129b0: 6465 7c62 7974 6573 2073 3a0a 2020 2020  de|bytes s:.    
+000129c0: 3a72 7479 7065 3a20 7374 727c 756e 6963  :rtype: str|unic
+000129d0: 6f64 650a 2020 2020 2222 220a 2020 2020  ode.    """.    
+000129e0: 6966 2069 7369 6e73 7461 6e63 6528 732c  if isinstance(s,
+000129f0: 2073 7472 2920 6f72 2022 756e 6963 6f64   str) or "unicod
+00012a00: 6522 2069 6e20 7374 7228 7479 7065 2873  e" in str(type(s
+00012a10: 2929 3a0a 2020 2020 2020 2020 7265 7475  )):.        retu
+00012a20: 726e 2073 0a20 2020 2069 6620 6973 696e  rn s.    if isin
+00012a30: 7374 616e 6365 2873 2c20 6279 7465 7329  stance(s, bytes)
+00012a40: 206f 7220 6973 696e 7374 616e 6365 2873   or isinstance(s
+00012a50: 2c20 756e 6963 6f64 6529 3a0a 2020 2020  , unicode):.    
+00012a60: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
+00012a70: 6f6e 2050 7955 6e72 6573 6f6c 7665 6452  on PyUnresolvedR
+00012a80: 6566 6572 656e 6365 730a 2020 2020 2020  eferences.      
+00012a90: 2020 7265 7475 726e 2073 2e64 6563 6f64    return s.decod
+00012aa0: 6528 2275 7466 3822 290a 2020 2020 6173  e("utf8").    as
+00012ab0: 7365 7274 2046 616c 7365 2c20 2275 6e6b  sert False, "unk
+00012ac0: 6e6f 776e 2074 7970 6520 2573 2220 2520  nown type %s" % 
+00012ad0: 7479 7065 2873 290a 0a0a 6465 6620 7079  type(s)...def py
+00012ae0: 325f 7574 6638 5f73 7472 5f74 6f5f 756e  2_utf8_str_to_un
+00012af0: 6963 6f64 6528 7329 3a0a 2020 2020 2222  icode(s):.    ""
+00012b00: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
+00012b10: 2073 3a20 652e 672e 2074 6865 2073 7472   s: e.g. the str
+00012b20: 696e 6720 6c69 7465 7261 6c20 22c3 a4c3  ing literal "...
+00012b30: b6c3 bc22 2069 6e20 5079 7468 6f6e 2033  ..." in Python 3
+00012b40: 2069 7320 636f 7272 6563 742c 2062 7574   is correct, but
+00012b50: 2069 6e20 5079 7468 6f6e 2032 2069 7420   in Python 2 it 
+00012b60: 7368 6f75 6c64 2068 6176 6520 6265 656e  should have been
+00012b70: 2075 22c3 a4c3 b6c3 bc22 2c0a 2020 2020   u"......",.    
+00012b80: 2020 6275 7420 6a75 7374 2075 7369 6e67    but just using
+00012b90: 2022 c3a4 c3b6 c3bc 2220 7769 6c6c 2061   "......" will a
+00012ba0: 6374 7561 6c6c 7920 6265 2074 6865 2072  ctually be the r
+00012bb0: 6177 2075 7466 3820 6279 7465 2073 6571  aw utf8 byte seq
+00012bc0: 7565 6e63 652e 0a20 2020 2020 2054 6869  uence..      Thi
+00012bd0: 7320 6361 6e20 6861 7070 656e 2077 6865  s can happen whe
+00012be0: 6e20 796f 7520 6576 616c 2829 2073 6f6d  n you eval() som
+00012bf0: 6520 7374 7269 6e67 2e0a 2020 2020 2020  e string..      
+00012c00: 5765 2061 7373 756d 6520 7468 6174 2079  We assume that y
+00012c10: 6f75 2061 7265 2075 7369 6e67 2050 7974  ou are using Pyt
+00012c20: 686f 6e20 322c 2061 6e64 2067 6f74 2074  hon 2, and got t
+00012c30: 6865 2073 7472 696e 6720 286e 6f74 2075  he string (not u
+00012c40: 6e69 636f 6465 206f 626a 6563 7429 2022  nicode object) "
+00012c50: c3a4 c3b6 c3bc 222c 206f 7220 6d61 7962  ......", or mayb
+00012c60: 6520 2261 6263 222e 0a20 2020 2020 2041  e "abc"..      A
+00012c70: 6c73 6f20 7365 6520 3a66 756e 633a 605f  lso see :func:`_
+00012c80: 7079 325f 756e 6963 6f64 655f 746f 5f73  py2_unicode_to_s
+00012c90: 7472 5f72 6563 7572 7369 7665 6020 616e  tr_recursive` an
+00012ca0: 6420 3a66 756e 633a 6061 735f 7374 7260  d :func:`as_str`
+00012cb0: 2e0a 2020 2020 3a72 6574 7572 6e3a 2069  ..    :return: i
+00012cc0: 6620 6974 2069 7320 696e 6465 6564 2075  f it is indeed u
+00012cd0: 6e69 636f 6465 2c20 6974 2077 696c 6c20  nicode, it will 
+00012ce0: 7265 7475 726e 2074 6865 2075 6e69 636f  return the unico
+00012cf0: 6465 206f 626a 6563 742c 206f 7468 6572  de object, other
+00012d00: 7769 7365 2069 7420 6b65 6570 7320 7468  wise it keeps th
+00012d10: 6520 7374 7269 6e67 0a20 2020 203a 7274  e string.    :rt
+00012d20: 7970 653a 2073 7472 7c75 6e69 636f 6465  ype: str|unicode
+00012d30: 0a20 2020 2022 2222 0a20 2020 2061 7373  .    """.    ass
+00012d40: 6572 7420 6e6f 7420 5059 330a 2020 2020  ert not PY3.    
+00012d50: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+00012d60: 6528 732c 2073 7472 290a 2020 2020 7472  e(s, str).    tr
+00012d70: 793a 0a20 2020 2020 2020 2023 206e 6f69  y:.        # noi
+00012d80: 6e73 7065 6374 696f 6e20 5079 556e 7265  nspection PyUnre
+00012d90: 736f 6c76 6564 5265 6665 7265 6e63 6573  solvedReferences
+00012da0: 0a20 2020 2020 2020 2073 2e64 6563 6f64  .        s.decod
+00012db0: 6528 2261 7363 6969 2229 0a20 2020 2020  e("ascii").     
+00012dc0: 2020 2072 6574 7572 6e20 730a 2020 2020     return s.    
+00012dd0: 6578 6365 7074 2055 6e69 636f 6465 4465  except UnicodeDe
+00012de0: 636f 6465 4572 726f 723a 0a20 2020 2020  codeError:.     
+00012df0: 2020 2070 6173 730a 2020 2020 2320 6e6f     pass.    # no
+00012e00: 696e 7370 6563 7469 6f6e 2050 7955 6e72  inspection PyUnr
+00012e10: 6573 6f6c 7665 6452 6566 6572 656e 6365  esolvedReference
+00012e20: 730a 2020 2020 7265 7475 726e 2073 2e64  s.    return s.d
+00012e30: 6563 6f64 6528 2275 7466 3822 290a 0a0a  ecode("utf8")...
+00012e40: 6465 6620 756e 6963 6f64 655f 746f 5f73  def unicode_to_s
+00012e50: 7472 2873 293a 0a20 2020 2022 2222 0a20  tr(s):.    """. 
+00012e60: 2020 2054 6865 2062 6568 6176 696f 7220     The behavior 
+00012e70: 6973 2064 6966 6665 7265 6e74 2064 6570  is different dep
+00012e80: 656e 6469 6e67 206f 6e20 5079 7468 6f6e  ending on Python
+00012e90: 2032 206f 7220 5079 7468 6f6e 2033 2e20   2 or Python 3. 
+00012ea0: 496e 2061 6c6c 2063 6173 6573 2c20 7468  In all cases, th
+00012eb0: 6520 7265 7475 726e 6564 2074 7970 6520  e returned type 
+00012ec0: 6973 2061 2073 7472 206f 626a 6563 742e  is a str object.
+00012ed0: 0a20 2020 2050 7974 686f 6e20 323a 0a20  .    Python 2:. 
+00012ee0: 2020 2020 2057 6520 7265 7475 726e 2074       We return t
+00012ef0: 6865 2075 7466 3820 656e 636f 6465 6420  he utf8 encoded 
+00012f00: 7374 7220 2877 6869 6368 2069 7320 6c69  str (which is li
+00012f10: 6b65 2050 7974 686f 6e20 3320 6279 7465  ke Python 3 byte
+00012f20: 732c 206f 7220 666f 7220 4153 4349 492c  s, or for ASCII,
+00012f30: 2074 6865 7265 2069 7320 6e6f 2064 6966   there is no dif
+00012f40: 6665 7265 6e63 6529 2e0a 2020 2020 5079  ference)..    Py
+00012f50: 7468 6f6e 2033 3a0a 2020 2020 2020 5765  thon 3:.      We
+00012f60: 2072 6574 7572 6e20 6120 7374 7220 6f62   return a str ob
+00012f70: 6a65 6374 2e0a 2020 2020 4e6f 7465 2074  ject..    Note t
+00012f80: 6861 7420 7468 6973 2066 756e 6374 696f  hat this functio
+00012f90: 6e20 7072 6f62 6162 6c79 2064 6f65 7320  n probably does 
+00012fa0: 6e6f 7420 6d61 6b65 206d 7563 6820 7365  not make much se
+00012fb0: 6e73 652e 0a20 2020 2049 7420 6d69 6768  nse..    It migh
+00012fc0: 7420 6265 2075 7365 6420 7768 656e 2074  t be used when t
+00012fd0: 6865 7265 2069 7320 6f74 6865 7220 636f  here is other co
+00012fe0: 6465 2077 6869 6368 2065 7870 6563 7473  de which expects
+00012ff0: 2061 2073 7472 206f 626a 6563 742c 206e   a str object, n
+00013000: 6f20 6d61 7474 6572 2069 6620 5079 7468  o matter if Pyth
+00013010: 6f6e 2032 206f 7220 5079 7468 6f6e 2033  on 2 or Python 3
+00013020: 2e0a 2020 2020 496e 2050 7974 686f 6e20  ..    In Python 
+00013030: 322c 2061 2073 7472 206f 626a 6563 7420  2, a str object 
+00013040: 6f66 7465 6e20 686f 6c64 7320 5554 4638  often holds UTF8
+00013050: 2074 6578 742c 2073 6f20 7468 6520 6265   text, so the be
+00013060: 6861 7669 6f72 206f 6620 7468 6973 2066  havior of this f
+00013070: 756e 6374 696f 6e20 6973 2066 696e 6520  unction is fine 
+00013080: 7468 656e 2e0a 2020 2020 416c 736f 2073  then..    Also s
+00013090: 6565 203a 6675 6e63 3a60 6173 5f73 7472  ee :func:`as_str
+000130a0: 602e 0a0a 2020 2020 3a70 6172 616d 2073  `...    :param s
+000130b0: 7472 7c75 6e69 636f 6465 7c62 7974 6573  tr|unicode|bytes
+000130c0: 2073 3a0a 2020 2020 3a72 7479 7065 3a20   s:.    :rtype: 
+000130d0: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
+000130e0: 6966 2050 5933 2061 6e64 2069 7369 6e73  if PY3 and isins
+000130f0: 7461 6e63 6528 732c 2062 7974 6573 293a  tance(s, bytes):
+00013100: 0a20 2020 2020 2020 2073 203d 2073 2e64  .        s = s.d
+00013110: 6563 6f64 6528 2275 7466 3822 290a 2020  ecode("utf8").  
+00013120: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+00013130: 6e73 7461 6e63 6528 732c 2073 7472 290a  nstance(s, str).
+00013140: 2020 2020 6966 206e 6f74 2050 5933 2061      if not PY3 a
+00013150: 6e64 2069 7369 6e73 7461 6e63 6528 732c  nd isinstance(s,
+00013160: 2075 6e69 636f 6465 293a 0a20 2020 2020   unicode):.     
+00013170: 2020 2073 203d 2073 2e65 6e63 6f64 6528     s = s.encode(
+00013180: 2275 7466 3822 290a 2020 2020 2020 2020  "utf8").        
+00013190: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+000131a0: 6528 732c 2073 7472 290a 2020 2020 6173  e(s, str).    as
+000131b0: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+000131c0: 732c 2073 7472 290a 2020 2020 7265 7475  s, str).    retu
+000131d0: 726e 2073 0a0a 0a64 6566 2064 6565 7063  rn s...def deepc
+000131e0: 6f70 7928 782c 2073 746f 705f 7479 7065  opy(x, stop_type
+000131f0: 733d 4e6f 6e65 293a 0a20 2020 2022 2222  s=None):.    """
+00013200: 0a20 2020 2053 696d 706c 6572 2076 6172  .    Simpler var
+00013210: 6961 6e74 206f 6620 636f 7079 2e64 6565  iant of copy.dee
+00013220: 7063 6f70 7928 292e 0a20 2020 2053 686f  pcopy()..    Sho
+00013230: 756c 6420 6861 6e64 6c65 2073 6f6d 6520  uld handle some 
+00013240: 6564 6765 2063 6173 6573 2061 7320 7765  edge cases as we
+00013250: 6c6c 2c20 6c69 6b65 2063 6f70 7969 6e67  ll, like copying
+00013260: 206d 6f64 756c 6520 7265 6665 7265 6e63   module referenc
+00013270: 6573 2e0a 0a20 2020 203a 7061 7261 6d20  es...    :param 
+00013280: 5420 783a 2061 6e20 6172 6269 7472 6172  T x: an arbitrar
+00013290: 7920 6f62 6a65 6374 0a20 2020 203a 7061  y object.    :pa
+000132a0: 7261 6d20 6c69 7374 5b74 7970 655d 7c4e  ram list[type]|N
+000132b0: 6f6e 6520 7374 6f70 5f74 7970 6573 3a20  one stop_types: 
+000132c0: 6f62 6a65 6374 7320 6f66 2074 6865 7365  objects of these
+000132d0: 2074 7970 6573 2077 696c 6c20 6e6f 7420   types will not 
+000132e0: 6265 2064 6565 702d 636f 7069 6564 2c20  be deep-copied, 
+000132f0: 6f6e 6c79 2074 6865 2072 6566 6572 656e  only the referen
+00013300: 6365 2069 7320 7061 7373 6564 0a20 2020  ce is passed.   
+00013310: 203a 7274 7970 653a 2054 0a20 2020 2022   :rtype: T.    "
+00013320: 2222 0a20 2020 2023 2053 6565 2061 6c73  "".    # See als
+00013330: 6f20 636c 6173 7320 5069 636b 6c65 7220  o class Pickler 
+00013340: 6672 6f6d 2054 6173 6b53 7973 7465 6d2e  from TaskSystem.
+00013350: 0a20 2020 2023 204f 723a 2068 7474 7073  .    # Or: https
+00013360: 3a2f 2f6d 6169 6c2e 7079 7468 6f6e 2e6f  ://mail.python.o
+00013370: 7267 2f70 6970 6572 6d61 696c 2f70 7974  rg/pipermail/pyt
+00013380: 686f 6e2d 6964 6561 732f 3230 3133 2d4a  hon-ideas/2013-J
+00013390: 756c 792f 3032 3139 3539 2e68 746d 6c0a  uly/021959.html.
+000133a0: 2020 2020 6672 6f6d 202e 7461 736b 5f73      from .task_s
+000133b0: 7973 7465 6d20 696d 706f 7274 2050 6963  ystem import Pic
+000133c0: 6b6c 6572 2c20 556e 7069 636b 6c65 720a  kler, Unpickler.
+000133d0: 0a20 2020 2070 6572 7369 7374 656e 745f  .    persistent_
+000133e0: 6d65 6d6f 203d 207b 7d20 2023 2069 6420  memo = {}  # id 
+000133f0: 2d3e 206f 626a 0a0a 2020 2020 6465 6620  -> obj..    def 
+00013400: 7065 7273 6973 7465 6e74 5f69 6428 6f62  persistent_id(ob
+00013410: 6a29 3a0a 2020 2020 2020 2020 2222 220a  j):.        """.
+00013420: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00013430: 626a 6563 7420 6f62 6a3a 0a20 2020 2020  bject obj:.     
+00013440: 2020 203a 7274 7970 653a 2069 6e74 7c4e     :rtype: int|N
+00013450: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
+00013460: 2020 2020 2020 2020 6966 2073 746f 705f          if stop_
+00013470: 7479 7065 7320 616e 6420 6973 696e 7374  types and isinst
+00013480: 616e 6365 286f 626a 2c20 7475 706c 6528  ance(obj, tuple(
+00013490: 7374 6f70 5f74 7970 6573 2929 3a0a 2020  stop_types)):.  
+000134a0: 2020 2020 2020 2020 2020 7065 7273 6973            persis
+000134b0: 7465 6e74 5f6d 656d 6f5b 6964 286f 626a  tent_memo[id(obj
+000134c0: 295d 203d 206f 626a 0a20 2020 2020 2020  )] = obj.       
+000134d0: 2020 2020 2072 6574 7572 6e20 6964 286f       return id(o
+000134e0: 626a 290a 2020 2020 2020 2020 7265 7475  bj).        retu
+000134f0: 726e 204e 6f6e 650a 0a20 2020 2064 6566  rn None..    def
+00013500: 2070 6963 6b6c 655f 6475 6d70 7328 6f62   pickle_dumps(ob
+00013510: 6a29 3a0a 2020 2020 2020 2020 2222 220a  j):.        """.
+00013520: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00013530: 626a 6563 7420 6f62 6a3a 0a20 2020 2020  bject obj:.     
+00013540: 2020 203a 7274 7970 653a 2062 7974 6573     :rtype: bytes
+00013550: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013560: 2020 2020 2073 696f 203d 2042 7974 6573       sio = Bytes
+00013570: 494f 2829 0a20 2020 2020 2020 2070 203d  IO().        p =
+00013580: 2050 6963 6b6c 6572 2873 696f 290a 2020   Pickler(sio).  
+00013590: 2020 2020 2020 702e 7065 7273 6973 7465        p.persiste
+000135a0: 6e74 5f69 6420 3d20 7065 7273 6973 7465  nt_id = persiste
+000135b0: 6e74 5f69 640a 2020 2020 2020 2020 702e  nt_id.        p.
+000135c0: 6475 6d70 286f 626a 290a 2020 2020 2020  dump(obj).      
+000135d0: 2020 7265 7475 726e 2073 696f 2e67 6574    return sio.get
+000135e0: 7661 6c75 6528 290a 0a20 2020 2023 206e  value()..    # n
+000135f0: 6f69 6e73 7065 6374 696f 6e20 5079 5368  oinspection PySh
+00013600: 6164 6f77 696e 674e 616d 6573 0a20 2020  adowingNames.   
+00013610: 2064 6566 2070 6963 6b6c 655f 6c6f 6164   def pickle_load
+00013620: 7328 7329 3a0a 2020 2020 2020 2020 2222  s(s):.        ""
+00013630: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+00013640: 2062 7974 6573 2073 3a0a 2020 2020 2020   bytes s:.      
+00013650: 2020 3a72 7479 7065 3a20 6f62 6a65 6374    :rtype: object
+00013660: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013670: 2020 2020 2070 203d 2055 6e70 6963 6b6c       p = Unpickl
+00013680: 6572 2842 7974 6573 494f 2873 2929 0a20  er(BytesIO(s)). 
+00013690: 2020 2020 2020 2070 2e70 6572 7369 7374         p.persist
+000136a0: 656e 745f 6c6f 6164 203d 2070 6572 7369  ent_load = persi
+000136b0: 7374 656e 745f 6d65 6d6f 2e5f 5f67 6574  stent_memo.__get
+000136c0: 6974 656d 5f5f 0a20 2020 2020 2020 2072  item__.        r
+000136d0: 6574 7572 6e20 702e 6c6f 6164 2829 0a0a  eturn p.load()..
+000136e0: 2020 2020 7320 3d20 7069 636b 6c65 5f64      s = pickle_d
+000136f0: 756d 7073 2878 290a 2020 2020 6320 3d20  umps(x).    c = 
+00013700: 7069 636b 6c65 5f6c 6f61 6473 2873 290a  pickle_loads(s).
+00013710: 2020 2020 7265 7475 726e 2063 0a0a 0a64      return c...d
+00013720: 6566 206c 6f61 645f 7478 745f 7665 6374  ef load_txt_vect
+00013730: 6f72 2866 696c 656e 616d 6529 3a0a 2020  or(filename):.  
+00013740: 2020 2222 220a 2020 2020 4578 7065 6374    """.    Expect
+00013750: 206c 696e 652d 6261 7365 6420 7465 7874   line-based text
+00013760: 2065 6e63 6f64 696e 6720 696e 2066 696c   encoding in fil
+00013770: 652e 0a20 2020 2057 6520 616c 736f 2073  e..    We also s
+00013780: 7570 706f 7274 2053 7072 696e 7420 584d  upport Sprint XM
+00013790: 4c20 666f 726d 6174 2c20 7768 6963 6820  L format, which 
+000137a0: 6861 7320 736f 6d65 2061 6464 6974 696f  has some additio
+000137b0: 6e61 6c20 786d 6c20 6865 6164 6572 2061  nal xml header a
+000137c0: 6e64 2066 6f6f 7465 722c 0a20 2020 2077  nd footer,.    w
+000137d0: 6869 6368 2077 6520 7769 6c6c 206a 7573  hich we will jus
+000137e0: 7420 7374 7269 7020 6177 6179 2e0a 0a20  t strip away... 
+000137f0: 2020 203a 7061 7261 6d20 7374 7220 6669     :param str fi
+00013800: 6c65 6e61 6d65 3a0a 2020 2020 3a72 7479  lename:.    :rty
+00013810: 7065 3a20 6c69 7374 5b66 6c6f 6174 5d0a  pe: list[float].
+00013820: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
+00013830: 726e 205b 666c 6f61 7428 6c69 6e65 2920  rn [float(line) 
+00013840: 666f 7220 6c69 6e65 2069 6e20 6f70 656e  for line in open
+00013850: 2866 696c 656e 616d 6529 2e72 6561 6428  (filename).read(
+00013860: 292e 7370 6c69 746c 696e 6573 2829 2069  ).splitlines() i
+00013870: 6620 6c69 6e65 2061 6e64 206e 6f74 206c  f line and not l
+00013880: 696e 652e 7374 6172 7473 7769 7468 2822  ine.startswith("
+00013890: 3c22 295d 0a0a 0a63 6c61 7373 2043 6f6c  <")]...class Col
+000138a0: 6c65 6374 696f 6e52 6561 6443 6865 636b  lectionReadCheck
+000138b0: 436f 7665 7265 643a 0a20 2020 2022 2222  Covered:.    """
+000138c0: 0a20 2020 2057 7261 7073 2061 726f 756e  .    Wraps aroun
+000138d0: 6420 6120 6469 6374 2e20 4974 206b 6565  d a dict. It kee
+000138e0: 7073 2074 7261 636b 2061 626f 7574 2061  ps track about a
+000138f0: 6c6c 2074 6865 206b 6579 7320 7768 6963  ll the keys whic
+00013900: 6820 7765 7265 2072 6561 6420 6672 6f6d  h were read from
+00013910: 2074 6865 2064 6963 742e 0a20 2020 2056   the dict..    V
+00013920: 6961 203a 6675 6e63 3a60 6173 7365 7274  ia :func:`assert
+00013930: 5f61 6c6c 5f72 6561 6460 2c20 796f 7520  _all_read`, you 
+00013940: 6361 6e20 6368 6563 6b20 7468 6174 2074  can check that t
+00013950: 6865 7265 2061 7265 206e 6f20 6b65 7973  here are no keys
+00013960: 2069 6e20 7468 6520 6469 6374 2077 6869   in the dict whi
+00013970: 6368 2077 6572 6520 6e6f 7420 7265 6164  ch were not read
+00013980: 2e0a 2020 2020 5468 6520 7573 6167 6520  ..    The usage 
+00013990: 6973 2066 6f72 2063 6f6e 6669 6720 6469  is for config di
+000139a0: 6374 206f 7074 696f 6e73 2c20 7768 6572  ct options, wher
+000139b0: 6520 7468 6520 7573 6572 2068 6173 2073  e the user has s
+000139c0: 7065 6369 6669 6564 2061 2072 616e 6765  pecified a range
+000139d0: 206f 6620 6f70 7469 6f6e 732c 0a20 2020   of options,.   
+000139e0: 2061 6e64 2077 6865 7265 2069 6e20 7468   and where in th
+000139f0: 6520 636f 6465 2074 6865 7265 2069 7320  e code there is 
+00013a00: 7573 7561 6c6c 7920 6120 6465 6661 756c  usually a defaul
+00013a10: 7420 666f 7220 6576 6572 7920 6e6f 6e2d  t for every non-
+00013a20: 7370 6563 6966 6965 6420 6f70 7469 6f6e  specified option
+00013a30: 2c0a 2020 2020 746f 2063 6865 636b 2077  ,.    to check w
+00013a40: 6865 7468 6572 2061 6c6c 2074 6865 2075  hether all the u
+00013a50: 7365 722d 7370 6563 6966 6965 6420 6f70  ser-specified op
+00013a60: 7469 6f6e 7320 6172 6520 616c 736f 2075  tions are also u
+00013a70: 7365 6420 286d 6179 6265 2074 6865 2075  sed (maybe the u
+00013a80: 7365 7220 6d61 6465 2061 2074 7970 6f29  ser made a typo)
+00013a90: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00013aa0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00013ab0: 2c20 636f 6c6c 6563 7469 6f6e 2c20 7472  , collection, tr
+00013ac0: 7574 685f 7661 6c75 653d 4e6f 6e65 293a  uth_value=None):
+00013ad0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013ae0: 2020 2020 203a 7061 7261 6d20 6469 6374       :param dict
+00013af0: 5b73 7472 5d20 636f 6c6c 6563 7469 6f6e  [str] collection
+00013b00: 3a0a 2020 2020 2020 2020 3a70 6172 616d  :.        :param
+00013b10: 204e 6f6e 657c 626f 6f6c 2074 7275 7468   None|bool truth
+00013b20: 5f76 616c 7565 3a20 6e6f 7465 3a20 6368  _value: note: ch
+00013b30: 6563 6b20 6578 706c 6963 6974 6c79 2066  eck explicitly f
+00013b40: 6f72 2073 656c 662e 7472 7574 685f 7661  or self.truth_va
+00013b50: 6c75 652c 2062 6f6f 6c28 7365 6c66 2920  lue, bool(self) 
+00013b60: 6973 206e 6f74 2074 6865 2073 616d 6521  is not the same!
+00013b70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013b80: 2020 2020 2073 656c 662e 636f 6c6c 6563       self.collec
+00013b90: 7469 6f6e 203d 2063 6f6c 6c65 6374 696f  tion = collectio
+00013ba0: 6e0a 2020 2020 2020 2020 6966 2074 7275  n.        if tru
+00013bb0: 7468 5f76 616c 7565 2069 7320 4e6f 6e65  th_value is None
+00013bc0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00013bd0: 7574 685f 7661 6c75 6520 3d20 626f 6f6c  uth_value = bool
+00013be0: 2873 656c 662e 636f 6c6c 6563 7469 6f6e  (self.collection
+00013bf0: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
+00013c00: 7275 7468 5f76 616c 7565 203d 2074 7275  ruth_value = tru
+00013c10: 7468 5f76 616c 7565 0a20 2020 2020 2020  th_value.       
+00013c20: 2073 656c 662e 676f 745f 6974 656d 7320   self.got_items 
+00013c30: 3d20 7365 7428 290a 0a20 2020 2064 6566  = set()..    def
+00013c40: 205f 5f72 6570 725f 5f28 7365 6c66 293a   __repr__(self):
+00013c50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013c60: 2225 7328 2572 2c20 7472 7574 685f 7661  "%s(%r, truth_va
+00013c70: 6c75 653d 2572 2922 2025 2028 7365 6c66  lue=%r)" % (self
+00013c80: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+00013c90: 655f 5f2c 2073 656c 662e 636f 6c6c 6563  e__, self.collec
+00013ca0: 7469 6f6e 2c20 7365 6c66 2e74 7275 7468  tion, self.truth
+00013cb0: 5f76 616c 7565 290a 0a20 2020 2040 636c  _value)..    @cl
+00013cc0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00013cd0: 6620 6672 6f6d 5f62 6f6f 6c5f 6f72 5f64  f from_bool_or_d
+00013ce0: 6963 7428 636c 732c 2076 616c 7565 293a  ict(cls, value):
+00013cf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013d00: 2020 2020 203a 7061 7261 6d20 626f 6f6c       :param bool
+00013d10: 7c64 6963 745b 7374 725d 2076 616c 7565  |dict[str] value
+00013d20: 3a0a 2020 2020 2020 2020 3a72 7479 7065  :.        :rtype
+00013d30: 3a20 436f 6c6c 6563 7469 6f6e 5265 6164  : CollectionRead
+00013d40: 4368 6563 6b43 6f76 6572 6564 0a20 2020  CheckCovered.   
+00013d50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013d60: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
+00013d70: 616c 7565 2c20 626f 6f6c 293a 0a20 2020  alue, bool):.   
+00013d80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013d90: 636c 7328 636f 6c6c 6563 7469 6f6e 3d7b  cls(collection={
+00013da0: 7d2c 2074 7275 7468 5f76 616c 7565 3d76  }, truth_value=v
+00013db0: 616c 7565 290a 2020 2020 2020 2020 6966  alue).        if
+00013dc0: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+00013dd0: 652c 2064 6963 7429 3a0a 2020 2020 2020  e, dict):.      
+00013de0: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+00013df0: 2863 6f6c 6c65 6374 696f 6e3d 7661 6c75  (collection=valu
+00013e00: 6529 0a20 2020 2020 2020 2072 6169 7365  e).        raise
+00013e10: 2054 7970 6545 7272 6f72 2822 696e 7661   TypeError("inva
+00013e20: 6c69 6420 7479 7065 3a20 2573 2220 2520  lid type: %s" % 
+00013e30: 7479 7065 2876 616c 7565 2929 0a0a 2020  type(value))..  
+00013e40: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
+00013e50: 5f28 7365 6c66 2c20 6974 656d 293a 0a20  _(self, item):. 
+00013e60: 2020 2020 2020 2072 6573 203d 2073 656c         res = sel
+00013e70: 662e 636f 6c6c 6563 7469 6f6e 5b69 7465  f.collection[ite
+00013e80: 6d5d 0a20 2020 2020 2020 2073 656c 662e  m].        self.
+00013e90: 676f 745f 6974 656d 732e 6164 6428 6974  got_items.add(it
+00013ea0: 656d 290a 2020 2020 2020 2020 7265 7475  em).        retu
+00013eb0: 726e 2072 6573 0a0a 2020 2020 6465 6620  rn res..    def 
+00013ec0: 6765 7428 7365 6c66 2c20 6974 656d 2c20  get(self, item, 
+00013ed0: 6465 6661 756c 743d 4e6f 6e65 293a 0a20  default=None):. 
+00013ee0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013ef0: 2020 203a 7061 7261 6d20 7374 7220 6974     :param str it
+00013f00: 656d 3a0a 2020 2020 2020 2020 3a70 6172  em:.        :par
+00013f10: 616d 2054 2064 6566 6175 6c74 3a0a 2020  am T default:.  
+00013f20: 2020 2020 2020 3a72 7479 7065 3a20 547c        :rtype: T|
+00013f30: 7479 7069 6e67 2e41 6e79 7c4e 6f6e 650a  typing.Any|None.
+00013f40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013f50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00013f60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013f70: 5b69 7465 6d5d 0a20 2020 2020 2020 2065  [item].        e
+00013f80: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
+00013f90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013fa0: 726e 2064 6566 6175 6c74 0a0a 2020 2020  rn default..    
+00013fb0: 6465 6620 5f5f 626f 6f6c 5f5f 2873 656c  def __bool__(sel
+00013fc0: 6629 3a20 2023 2050 7974 686f 6e20 330a  f):  # Python 3.
+00013fd0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00013fe0: 656c 662e 7472 7574 685f 7661 6c75 650a  elf.truth_value.
+00013ff0: 0a20 2020 205f 5f6e 6f6e 7a65 726f 5f5f  .    __nonzero__
+00014000: 203d 205f 5f62 6f6f 6c5f 5f20 2023 2050   = __bool__  # P
+00014010: 7974 686f 6e20 320a 0a20 2020 2064 6566  ython 2..    def
+00014020: 205f 5f6c 656e 5f5f 2873 656c 6629 3a0a   __len__(self):.
+00014030: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00014040: 656e 2873 656c 662e 636f 6c6c 6563 7469  en(self.collecti
+00014050: 6f6e 290a 0a20 2020 2064 6566 205f 5f69  on)..    def __i
+00014060: 7465 725f 5f28 7365 6c66 293a 0a20 2020  ter__(self):.   
+00014070: 2020 2020 2066 6f72 206b 2069 6e20 7365       for k in se
+00014080: 6c66 2e63 6f6c 6c65 6374 696f 6e3a 0a20  lf.collection:. 
+00014090: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+000140a0: 2073 656c 665b 6b5d 0a0a 2020 2020 6465   self[k]..    de
+000140b0: 6620 6173 7365 7274 5f61 6c6c 5f72 6561  f assert_all_rea
+000140c0: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
+000140d0: 2022 2222 0a20 2020 2020 2020 2041 7373   """.        Ass
+000140e0: 6572 7473 2074 6861 7420 616c 6c20 6974  erts that all it
+000140f0: 656d 7320 6861 7665 2062 6565 6e20 7265  ems have been re
+00014100: 6164 2e0a 2020 2020 2020 2020 2222 220a  ad..        """.
+00014110: 2020 2020 2020 2020 7265 6d61 696e 696e          remainin
+00014120: 6720 3d20 7365 7428 7365 6c66 2e63 6f6c  g = set(self.col
+00014130: 6c65 6374 696f 6e29 2e64 6966 6665 7265  lection).differe
+00014140: 6e63 6528 7365 6c66 2e67 6f74 5f69 7465  nce(self.got_ite
+00014150: 6d73 290a 2020 2020 2020 2020 6173 7365  ms).        asse
+00014160: 7274 206e 6f74 2072 656d 6169 6e69 6e67  rt not remaining
+00014170: 2c20 2254 6865 206b 6579 7320 2572 2077  , "The keys %r w
+00014180: 6572 6520 6e6f 7420 7265 6164 2069 6e20  ere not read in 
+00014190: 7468 6520 636f 6c6c 6563 7469 6f6e 2025  the collection %
+000141a0: 722e 2220 2520 2872 656d 6169 6e69 6e67  r." % (remaining
+000141b0: 2c20 7365 6c66 2e63 6f6c 6c65 6374 696f  , self.collectio
+000141c0: 6e29 0a0a 0a64 6566 2077 6869 6368 2870  n)...def which(p
+000141d0: 726f 6772 616d 293a 0a20 2020 2022 2222  rogram):.    """
+000141e0: 0a20 2020 2046 696e 6473 2060 7072 6f67  .    Finds `prog
+000141f0: 7261 6d60 2069 6e20 736f 6d65 206f 6620  ram` in some of 
+00014200: 7468 6520 6469 7273 206f 6620 7468 6520  the dirs of the 
+00014210: 5041 5448 2065 6e76 2076 6172 2e0a 0a20  PATH env var... 
+00014220: 2020 203a 7061 7261 6d20 7374 7220 7072     :param str pr
+00014230: 6f67 7261 6d3a 2065 2e67 2e20 2270 7974  ogram: e.g. "pyt
+00014240: 686f 6e22 0a20 2020 203a 7265 7475 726e  hon".    :return
+00014250: 3a20 6675 6c6c 2070 6174 682c 2065 2e67  : full path, e.g
+00014260: 2e20 222f 7573 722f 6269 6e2f 7079 7468  . "/usr/bin/pyth
+00014270: 6f6e 222c 206f 7220 4e6f 6e65 0a20 2020  on", or None.   
+00014280: 203a 7274 7970 653a 2073 7472 7c4e 6f6e   :rtype: str|Non
+00014290: 650a 2020 2020 2222 220a 2020 2020 2320  e.    """.    # 
+000142a0: 6e6f 696e 7370 6563 7469 6f6e 2050 7953  noinspection PyS
+000142b0: 6861 646f 7769 6e67 4e61 6d65 730a 2020  hadowingNames.  
+000142c0: 2020 6465 6620 6973 5f65 7865 2870 6174    def is_exe(pat
+000142d0: 6829 3a0a 2020 2020 2020 2020 2222 220a  h):.        """.
+000142e0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+000142f0: 7472 2070 6174 683a 0a20 2020 2020 2020  tr path:.       
+00014300: 203a 7274 7970 653a 2073 7472 0a20 2020   :rtype: str.   
+00014310: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00014320: 2072 6574 7572 6e20 6f73 2e70 6174 682e   return os.path.
+00014330: 6973 6669 6c65 2870 6174 6829 2061 6e64  isfile(path) and
+00014340: 206f 732e 6163 6365 7373 2870 6174 682c   os.access(path,
+00014350: 206f 732e 585f 4f4b 290a 0a20 2020 2066   os.X_OK)..    f
+00014360: 7061 7468 2c20 666e 616d 6520 3d20 6f73  path, fname = os
+00014370: 2e70 6174 682e 7370 6c69 7428 7072 6f67  .path.split(prog
+00014380: 7261 6d29 0a20 2020 2069 6620 6670 6174  ram).    if fpat
+00014390: 683a 0a20 2020 2020 2020 2069 6620 6973  h:.        if is
+000143a0: 5f65 7865 2870 726f 6772 616d 293a 0a20  _exe(program):. 
+000143b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000143c0: 6e20 7072 6f67 7261 6d0a 2020 2020 656c  n program.    el
+000143d0: 7365 3a0a 2020 2020 2020 2020 666f 7220  se:.        for 
+000143e0: 7061 7468 2069 6e20 6f73 2e65 6e76 6972  path in os.envir
+000143f0: 6f6e 5b22 5041 5448 225d 2e73 706c 6974  on["PATH"].split
+00014400: 286f 732e 7061 7468 7365 7029 3a0a 2020  (os.pathsep):.  
+00014410: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+00014420: 2070 6174 682e 7374 7269 7028 2722 2729   path.strip('"')
+00014430: 0a20 2020 2020 2020 2020 2020 2065 7865  .            exe
+00014440: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
+00014450: 6a6f 696e 2870 6174 682c 2070 726f 6772  join(path, progr
+00014460: 616d 290a 2020 2020 2020 2020 2020 2020  am).            
+00014470: 6966 2069 735f 6578 6528 6578 655f 6669  if is_exe(exe_fi
+00014480: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00014490: 2020 2020 2072 6574 7572 6e20 6578 655f       return exe_
+000144a0: 6669 6c65 0a0a 2020 2020 7265 7475 726e  file..    return
+000144b0: 204e 6f6e 650a 0a0a 6465 6620 7768 6963   None...def whic
+000144c0: 685f 7069 7028 293a 0a20 2020 2022 2222  h_pip():.    """
+000144d0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+000144e0: 0a20 2020 203a 7265 7475 726e 3a20 7061  .    :return: pa
+000144f0: 7468 2074 6f20 7069 7020 666f 7220 7468  th to pip for th
+00014500: 6520 6375 7272 656e 7420 5079 7468 6f6e  e current Python
+00014510: 2065 6e76 0a20 2020 2022 2222 0a20 2020   env.    """.   
+00014520: 2023 2042 6566 6f72 6520 7765 206c 6f6f   # Before we loo
+00014530: 6b20 616e 7977 6865 7265 2069 6e20 5041  k anywhere in PA
+00014540: 5448 2c20 6368 6563 6b20 6966 2074 6865  TH, check if the
+00014550: 7265 2069 7320 736f 6d65 2070 6970 2061  re is some pip a
+00014560: 6c6f 6e67 7369 6465 2074 6f20 7468 6520  longside to the 
+00014570: 5079 7468 6f6e 2065 7865 6375 7461 626c  Python executabl
+00014580: 652e 0a20 2020 2023 2054 6869 7320 6d69  e..    # This mi
+00014590: 6768 7420 6265 206d 6f72 6520 7265 6c69  ght be more reli
+000145a0: 6162 6c65 2e0a 2020 2020 7079 203d 2073  able..    py = s
+000145b0: 7973 2e65 7865 6375 7461 626c 650a 2020  ys.executable.  
+000145c0: 2020 6469 725f 6e61 6d65 2c20 6261 7365    dir_name, base
+000145d0: 6e61 6d65 203d 2070 792e 7273 706c 6974  name = py.rsplit
+000145e0: 2822 2f22 2c20 3129 0a20 2020 2069 6620  ("/", 1).    if 
+000145f0: 6261 7365 6e61 6d65 2e73 7461 7274 7377  basename.startsw
+00014600: 6974 6828 2270 7974 686f 6e22 293a 0a20  ith("python"):. 
+00014610: 2020 2020 2020 2070 6f73 7466 6978 203d         postfix =
+00014620: 2062 6173 656e 616d 655b 6c65 6e28 2270   basename[len("p
+00014630: 7974 686f 6e22 2920 3a5d 0a20 2020 2020  ython") :].     
+00014640: 2020 2070 6970 5f70 6174 6820 3d20 2225     pip_path = "%
+00014650: 732f 7069 7025 7322 2025 2028 6469 725f  s/pip%s" % (dir_
+00014660: 6e61 6d65 2c20 706f 7374 6669 7829 0a20  name, postfix). 
+00014670: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00014680: 682e 6578 6973 7473 2870 6970 5f70 6174  h.exists(pip_pat
+00014690: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+000146a0: 7265 7475 726e 2070 6970 5f70 6174 680a  return pip_path.
+000146b0: 2020 2020 2320 4765 6e65 7269 6320 6661      # Generic fa
+000146c0: 6c6c 6261 636b 2e0a 2020 2020 7069 705f  llback..    pip_
+000146d0: 7061 7468 203d 2077 6869 6368 2822 7069  path = which("pi
+000146e0: 7022 290a 2020 2020 7265 7475 726e 2070  p").    return p
+000146f0: 6970 5f70 6174 680a 0a0a 6465 6620 7069  ip_path...def pi
+00014700: 705f 696e 7374 616c 6c28 2a70 6b67 5f6e  p_install(*pkg_n
+00014710: 616d 6573 293a 0a20 2020 2022 2222 0a20  ames):.    """. 
+00014720: 2020 2049 6e73 7461 6c6c 2070 6163 6b61     Install packa
+00014730: 6765 7320 7669 6120 7069 7020 666f 7220  ges via pip for 
+00014740: 7468 6520 6375 7272 656e 7420 5079 7468  the current Pyth
+00014750: 6f6e 2065 6e76 2e0a 0a20 2020 203a 7061  on env...    :pa
+00014760: 7261 6d20 7374 7220 706b 675f 6e61 6d65  ram str pkg_name
+00014770: 733a 0a20 2020 2022 2222 0a20 2020 2070  s:.    """.    p
+00014780: 7920 3d20 7379 732e 6578 6563 7574 6162  y = sys.executab
+00014790: 6c65 0a20 2020 2070 6970 5f70 6174 6820  le.    pip_path 
+000147a0: 3d20 7768 6963 685f 7069 7028 290a 2020  = which_pip().  
+000147b0: 2020 7072 696e 7428 2250 6970 2069 6e73    print("Pip ins
+000147c0: 7461 6c6c 222c 202a 706b 675f 6e61 6d65  tall", *pkg_name
+000147d0: 7329 0a20 2020 2069 6e5f 7669 7274 7561  s).    in_virtua
+000147e0: 6c5f 656e 7620 3d20 6861 7361 7474 7228  l_env = hasattr(
+000147f0: 7379 732c 2022 7265 616c 5f70 7265 6669  sys, "real_prefi
+00014800: 7822 2920 2023 2068 7474 7073 3a2f 2f73  x")  # https://s
+00014810: 7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com
+00014820: 2f71 7565 7374 696f 6e73 2f31 3837 3135  /questions/18715
+00014830: 3439 2f0a 2020 2020 636d 6420 3d20 5b70  49/.    cmd = [p
+00014840: 792c 2070 6970 5f70 6174 682c 2022 696e  y, pip_path, "in
+00014850: 7374 616c 6c22 5d0a 2020 2020 6966 206e  stall"].    if n
+00014860: 6f74 2069 6e5f 7669 7274 7561 6c5f 656e  ot in_virtual_en
+00014870: 763a 0a20 2020 2020 2020 2063 6d64 202b  v:.        cmd +
+00014880: 3d20 5b22 2d2d 7573 6572 225d 0a20 2020  = ["--user"].   
+00014890: 2063 6d64 202b 3d20 6c69 7374 2870 6b67   cmd += list(pkg
+000148a0: 5f6e 616d 6573 290a 2020 2020 7072 696e  _names).    prin
+000148b0: 7428 2224 2025 7322 2025 2022 2022 2e6a  t("$ %s" % " ".j
+000148c0: 6f69 6e28 636d 6429 290a 2020 2020 7375  oin(cmd)).    su
+000148d0: 6270 726f 6365 7373 2e63 6865 636b 5f63  bprocess.check_c
+000148e0: 616c 6c28 636d 642c 2063 7764 3d22 2f22  all(cmd, cwd="/"
+000148f0: 290a 2020 2020 5f70 6970 5f69 6e73 7461  ).    _pip_insta
+00014900: 6c6c 6564 5f70 6163 6b61 6765 732e 636c  lled_packages.cl
+00014910: 6561 7228 2920 2023 2066 6f72 6365 2072  ear()  # force r
+00014920: 656c 6f61 640a 0a0a 5f70 6970 5f69 6e73  eload..._pip_ins
+00014930: 7461 6c6c 6564 5f70 6163 6b61 6765 7320  talled_packages 
+00014940: 3d20 7365 7428 290a 0a0a 6465 6620 7069  = set()...def pi
+00014950: 705f 6368 6563 6b5f 6973 5f69 6e73 7461  p_check_is_insta
+00014960: 6c6c 6564 2870 6b67 5f6e 616d 6529 3a0a  lled(pkg_name):.
+00014970: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+00014980: 616d 2073 7472 2070 6b67 5f6e 616d 653a  am str pkg_name:
+00014990: 2077 6974 686f 7574 2076 6572 7369 6f6e   without version
+000149a0: 2c20 652e 672e 206a 7573 7420 2274 656e  , e.g. just "ten
+000149b0: 736f 7266 6c6f 7722 2c20 6f72 2077 6974  sorflow", or wit
+000149c0: 6820 7665 7273 696f 6e2c 2065 2e67 2e20  h version, e.g. 
+000149d0: 2274 656e 736f 7266 6c6f 773d 3d31 2e32  "tensorflow==1.2
+000149e0: 2e33 220a 2020 2020 3a72 7479 7065 3a20  .3".    :rtype: 
+000149f0: 626f 6f6c 0a20 2020 2022 2222 0a20 2020  bool.    """.   
+00014a00: 2069 6620 6e6f 7420 5f70 6970 5f69 6e73   if not _pip_ins
+00014a10: 7461 6c6c 6564 5f70 6163 6b61 6765 733a  talled_packages:
+00014a20: 0a20 2020 2020 2020 2070 7920 3d20 7379  .        py = sy
+00014a30: 732e 6578 6563 7574 6162 6c65 0a20 2020  s.executable.   
+00014a40: 2020 2020 2070 6970 5f70 6174 6820 3d20       pip_path = 
+00014a50: 7768 6963 685f 7069 7028 290a 2020 2020  which_pip().    
+00014a60: 2020 2020 636d 6420 3d20 5b70 792c 2070      cmd = [py, p
+00014a70: 6970 5f70 6174 682c 2022 6672 6565 7a65  ip_path, "freeze
+00014a80: 225d 0a20 2020 2020 2020 2066 6f72 206c  "].        for l
+00014a90: 696e 6520 696e 2073 7973 5f65 7865 635f  ine in sys_exec_
+00014aa0: 6f75 7428 2a63 6d64 292e 7370 6c69 746c  out(*cmd).splitl
+00014ab0: 696e 6573 2829 3a0a 2020 2020 2020 2020  ines():.        
+00014ac0: 2020 2020 6966 206c 696e 6520 616e 6420      if line and 
+00014ad0: 223d 3d22 2069 6e20 6c69 6e65 3a0a 2020  "==" in line:.  
+00014ae0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014af0: 2022 3d3d 2220 6e6f 7420 696e 2070 6b67   "==" not in pkg
+00014b00: 5f6e 616d 653a 0a20 2020 2020 2020 2020  _name:.         
+00014b10: 2020 2020 2020 2020 2020 206c 696e 6520             line 
+00014b20: 3d20 6c69 6e65 5b3a 206c 696e 652e 696e  = line[: line.in
+00014b30: 6465 7828 223d 3d22 295d 0a20 2020 2020  dex("==")].     
+00014b40: 2020 2020 2020 2020 2020 205f 7069 705f             _pip_
+00014b50: 696e 7374 616c 6c65 645f 7061 636b 6167  installed_packag
+00014b60: 6573 2e61 6464 286c 696e 6529 0a20 2020  es.add(line).   
+00014b70: 2072 6574 7572 6e20 706b 675f 6e61 6d65   return pkg_name
+00014b80: 2069 6e20 5f70 6970 5f69 6e73 7461 6c6c   in _pip_install
+00014b90: 6564 5f70 6163 6b61 6765 730a 0a0a 5f6f  ed_packages..._o
+00014ba0: 7269 6769 6e61 6c5f 6578 6563 7620 3d20  riginal_execv = 
+00014bb0: 4e6f 6e65 0a5f 6f72 6967 696e 616c 5f65  None._original_e
+00014bc0: 7865 6376 6520 3d20 4e6f 6e65 0a5f 6f72  xecve = None._or
+00014bd0: 6967 696e 616c 5f65 7865 6376 7065 203d  iginal_execvpe =
+00014be0: 204e 6f6e 650a 0a0a 6465 6620 6f76 6572   None...def over
+00014bf0: 7772 6974 655f 6f73 5f65 7865 6328 7072  write_os_exec(pr
+00014c00: 6566 6978 5f61 7267 7329 3a0a 2020 2020  efix_args):.    
+00014c10: 2222 220a 2020 2020 3a70 6172 616d 206c  """.    :param l
+00014c20: 6973 745b 7374 725d 2070 7265 6669 785f  ist[str] prefix_
+00014c30: 6172 6773 3a0a 2020 2020 2222 220a 2020  args:.    """.  
+00014c40: 2020 676c 6f62 616c 205f 6f72 6967 696e    global _origin
+00014c50: 616c 5f65 7865 6376 2c20 5f6f 7269 6769  al_execv, _origi
+00014c60: 6e61 6c5f 6578 6563 7665 2c20 5f6f 7269  nal_execve, _ori
+00014c70: 6769 6e61 6c5f 6578 6563 7670 650a 2020  ginal_execvpe.  
+00014c80: 2020 6966 206e 6f74 205f 6f72 6967 696e    if not _origin
+00014c90: 616c 5f65 7865 6376 3a0a 2020 2020 2020  al_execv:.      
+00014ca0: 2020 5f6f 7269 6769 6e61 6c5f 6578 6563    _original_exec
+00014cb0: 7620 3d20 6f73 2e65 7865 6376 0a20 2020  v = os.execv.   
+00014cc0: 2069 6620 6e6f 7420 5f6f 7269 6769 6e61   if not _origina
+00014cd0: 6c5f 6578 6563 7665 3a0a 2020 2020 2020  l_execve:.      
+00014ce0: 2020 5f6f 7269 6769 6e61 6c5f 6578 6563    _original_exec
+00014cf0: 7665 203d 206f 732e 6578 6563 7665 0a20  ve = os.execve. 
+00014d00: 2020 2069 6620 6e6f 7420 5f6f 7269 6769     if not _origi
+00014d10: 6e61 6c5f 6578 6563 7670 653a 0a20 2020  nal_execvpe:.   
+00014d20: 2020 2020 2023 206e 6f69 6e73 7065 6374       # noinspect
+00014d30: 696f 6e20 5079 5072 6f74 6563 7465 644d  ion PyProtectedM
+00014d40: 656d 6265 722c 5079 556e 7265 736f 6c76  ember,PyUnresolv
+00014d50: 6564 5265 6665 7265 6e63 6573 0a20 2020  edReferences.   
+00014d60: 2020 2020 205f 6f72 6967 696e 616c 5f65       _original_e
+00014d70: 7865 6376 7065 203d 206f 732e 5f65 7865  xecvpe = os._exe
+00014d80: 6376 7065 0a0a 2020 2020 2320 6e6f 696e  cvpe..    # noin
+00014d90: 7370 6563 7469 6f6e 2050 7955 6e75 7365  spection PyUnuse
+00014da0: 644c 6f63 616c 0a20 2020 2064 6566 2077  dLocal.    def w
+00014db0: 7261 7070 6564 5f65 7865 6376 7065 2866  rapped_execvpe(f
+00014dc0: 696c 652c 2061 7267 732c 2065 6e76 3d4e  ile, args, env=N
+00014dd0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00014de0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+00014df0: 2066 696c 653a 0a20 2020 2020 2020 203a   file:.        :
+00014e00: 7061 7261 6d20 6c69 7374 5b73 7472 5d7c  param list[str]|
+00014e10: 7475 706c 655b 7374 725d 2061 7267 733a  tuple[str] args:
+00014e20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00014e30: 6469 6374 5b73 7472 5d20 656e 763a 0a20  dict[str] env:. 
+00014e40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014e50: 2020 206e 6577 5f61 7267 7320 3d20 7072     new_args = pr
+00014e60: 6566 6978 5f61 7267 7320 2b20 5b77 6869  efix_args + [whi
+00014e70: 6368 2861 7267 735b 305d 295d 202b 2061  ch(args[0])] + a
+00014e80: 7267 735b 313a 5d0a 2020 2020 2020 2020  rgs[1:].        
+00014e90: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00014ea0: 2822 2420 2573 5c6e 2220 2520 2220 222e  ("$ %s\n" % " ".
+00014eb0: 6a6f 696e 286e 6577 5f61 7267 7329 290a  join(new_args)).
+00014ec0: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+00014ed0: 7272 2e66 6c75 7368 2829 0a20 2020 2020  rr.flush().     
+00014ee0: 2020 205f 6f72 6967 696e 616c 5f65 7865     _original_exe
+00014ef0: 6376 7065 2866 696c 653d 7072 6566 6978  cvpe(file=prefix
+00014f00: 5f61 7267 735b 305d 2c20 6172 6773 3d6e  _args[0], args=n
+00014f10: 6577 5f61 7267 732c 2065 6e76 3d65 6e76  ew_args, env=env
+00014f20: 290a 0a20 2020 2064 6566 2065 7865 6376  )..    def execv
+00014f30: 2870 6174 682c 2061 7267 7329 3a0a 2020  (path, args):.  
+00014f40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00014f50: 2020 3a70 6172 616d 2073 7472 2070 6174    :param str pat
+00014f60: 683a 0a20 2020 2020 2020 203a 7061 7261  h:.        :para
+00014f70: 6d20 6c69 7374 5b73 7472 5d7c 7475 706c  m list[str]|tupl
+00014f80: 655b 7374 725d 2061 7267 733a 0a20 2020  e[str] args:.   
+00014f90: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00014fa0: 2069 6620 6172 6773 5b3a 206c 656e 2870   if args[: len(p
+00014fb0: 7265 6669 785f 6172 6773 295d 203d 3d20  refix_args)] == 
+00014fc0: 7072 6566 6978 5f61 7267 733a 0a20 2020  prefix_args:.   
+00014fd0: 2020 2020 2020 2020 205f 6f72 6967 696e           _origin
+00014fe0: 616c 5f65 7865 6376 2870 6174 682c 2061  al_execv(path, a
+00014ff0: 7267 7329 0a20 2020 2020 2020 2065 6c73  rgs).        els
+00015000: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
+00015010: 7261 7070 6564 5f65 7865 6376 7065 2870  rapped_execvpe(p
+00015020: 6174 682c 2061 7267 7329 0a0a 2020 2020  ath, args)..    
+00015030: 6465 6620 6578 6563 7665 2870 6174 682c  def execve(path,
+00015040: 2061 7267 732c 2065 6e76 293a 0a20 2020   args, env):.   
+00015050: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00015060: 203a 7061 7261 6d20 7374 7220 7061 7468   :param str path
+00015070: 3a0a 2020 2020 2020 2020 3a70 6172 616d  :.        :param
+00015080: 206c 6973 745b 7374 725d 7c74 7570 6c65   list[str]|tuple
+00015090: 5b73 7472 5d20 6172 6773 3a0a 2020 2020  [str] args:.    
+000150a0: 2020 2020 3a70 6172 616d 2064 6963 745b      :param dict[
+000150b0: 7374 725d 2065 6e76 3a0a 2020 2020 2020  str] env:.      
+000150c0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+000150d0: 2061 7267 735b 3a20 6c65 6e28 7072 6566   args[: len(pref
+000150e0: 6978 5f61 7267 7329 5d20 3d3d 2070 7265  ix_args)] == pre
+000150f0: 6669 785f 6172 6773 3a0a 2020 2020 2020  fix_args:.      
+00015100: 2020 2020 2020 5f6f 7269 6769 6e61 6c5f        _original_
+00015110: 6578 6563 7665 2870 6174 682c 2061 7267  execve(path, arg
+00015120: 732c 2065 6e76 290a 2020 2020 2020 2020  s, env).        
+00015130: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00015140: 2020 7772 6170 7065 645f 6578 6563 7670    wrapped_execvp
+00015150: 6528 7061 7468 2c20 6172 6773 2c20 656e  e(path, args, en
+00015160: 7629 0a0a 2020 2020 6465 6620 6578 6563  v)..    def exec
+00015170: 6c28 6669 6c65 2c20 2a61 7267 7329 3a0a  l(file, *args):.
+00015180: 2020 2020 2020 2020 2222 2265 7865 636c          """execl
+00015190: 2866 696c 652c 202a 6172 6773 290a 0a20  (file, *args).. 
+000151a0: 2020 2020 2020 2045 7865 6375 7465 2074         Execute t
+000151b0: 6865 2065 7865 6375 7461 626c 6520 6669  he executable fi
+000151c0: 6c65 2077 6974 6820 6172 6775 6d65 6e74  le with argument
+000151d0: 206c 6973 7420 6172 6773 2c20 7265 706c   list args, repl
+000151e0: 6163 696e 6720 7468 650a 2020 2020 2020  acing the.      
+000151f0: 2020 6375 7272 656e 7420 7072 6f63 6573    current proces
+00015200: 732e 2222 220a 2020 2020 2020 2020 6f73  s.""".        os
+00015210: 2e65 7865 6376 2866 696c 652c 2061 7267  .execv(file, arg
+00015220: 7329 0a0a 2020 2020 6465 6620 6578 6563  s)..    def exec
+00015230: 6c65 2866 696c 652c 202a 6172 6773 293a  le(file, *args):
+00015240: 0a20 2020 2020 2020 2022 2222 6578 6563  .        """exec
+00015250: 6c65 2866 696c 652c 202a 6172 6773 2c20  le(file, *args, 
+00015260: 656e 7629 0a0a 2020 2020 2020 2020 4578  env)..        Ex
+00015270: 6563 7574 6520 7468 6520 6578 6563 7574  ecute the execut
+00015280: 6162 6c65 2066 696c 6520 7769 7468 2061  able file with a
+00015290: 7267 756d 656e 7420 6c69 7374 2061 7267  rgument list arg
+000152a0: 7320 616e 640a 2020 2020 2020 2020 656e  s and.        en
+000152b0: 7669 726f 6e6d 656e 7420 656e 762c 2072  vironment env, r
+000152c0: 6570 6c61 6369 6e67 2074 6865 2063 7572  eplacing the cur
+000152d0: 7265 6e74 2070 726f 6365 7373 2e22 2222  rent process."""
+000152e0: 0a20 2020 2020 2020 2065 6e76 203d 2061  .        env = a
+000152f0: 7267 735b 2d31 5d0a 2020 2020 2020 2020  rgs[-1].        
+00015300: 6f73 2e65 7865 6376 6528 6669 6c65 2c20  os.execve(file, 
+00015310: 6172 6773 5b3a 2d31 5d2c 2065 6e76 290a  args[:-1], env).
+00015320: 0a20 2020 2064 6566 2065 7865 636c 7028  .    def execlp(
+00015330: 6669 6c65 2c20 2a61 7267 7329 3a0a 2020  file, *args):.  
+00015340: 2020 2020 2020 2222 2265 7865 636c 7028        """execlp(
+00015350: 6669 6c65 2c20 2a61 7267 7329 0a0a 2020  file, *args)..  
+00015360: 2020 2020 2020 4578 6563 7574 6520 7468        Execute th
+00015370: 6520 6578 6563 7574 6162 6c65 2066 696c  e executable fil
+00015380: 6520 2877 6869 6368 2069 7320 7365 6172  e (which is sear
+00015390: 6368 6564 2066 6f72 2061 6c6f 6e67 2024  ched for along $
+000153a0: 5041 5448 290a 2020 2020 2020 2020 7769  PATH).        wi
+000153b0: 7468 2061 7267 756d 656e 7420 6c69 7374  th argument list
+000153c0: 2061 7267 732c 2072 6570 6c61 6369 6e67   args, replacing
+000153d0: 2074 6865 2063 7572 7265 6e74 2070 726f   the current pro
+000153e0: 6365 7373 2e22 2222 0a20 2020 2020 2020  cess.""".       
+000153f0: 206f 732e 6578 6563 7670 2866 696c 652c   os.execvp(file,
+00015400: 2061 7267 7329 0a0a 2020 2020 6465 6620   args)..    def 
+00015410: 6578 6563 6c70 6528 6669 6c65 2c20 2a61  execlpe(file, *a
+00015420: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00015430: 2265 7865 636c 7065 2866 696c 652c 202a  "execlpe(file, *
+00015440: 6172 6773 2c20 656e 7629 0a0a 2020 2020  args, env)..    
+00015450: 2020 2020 4578 6563 7574 6520 7468 6520      Execute the 
+00015460: 6578 6563 7574 6162 6c65 2066 696c 6520  executable file 
+00015470: 2877 6869 6368 2069 7320 7365 6172 6368  (which is search
+00015480: 6564 2066 6f72 2061 6c6f 6e67 2024 5041  ed for along $PA
+00015490: 5448 290a 2020 2020 2020 2020 7769 7468  TH).        with
+000154a0: 2061 7267 756d 656e 7420 6c69 7374 2061   argument list a
+000154b0: 7267 7320 616e 6420 656e 7669 726f 6e6d  rgs and environm
+000154c0: 656e 7420 656e 762c 2072 6570 6c61 6369  ent env, replaci
+000154d0: 6e67 2074 6865 2063 7572 7265 6e74 0a20  ng the current. 
+000154e0: 2020 2020 2020 2070 726f 6365 7373 2e22         process."
+000154f0: 2222 0a20 2020 2020 2020 2065 6e76 203d  "".        env =
+00015500: 2061 7267 735b 2d31 5d0a 2020 2020 2020   args[-1].      
+00015510: 2020 6f73 2e65 7865 6376 7065 2866 696c    os.execvpe(fil
+00015520: 652c 2061 7267 735b 3a2d 315d 2c20 656e  e, args[:-1], en
+00015530: 7629 0a0a 2020 2020 6465 6620 6578 6563  v)..    def exec
+00015540: 7670 2866 696c 652c 2061 7267 7329 3a0a  vp(file, args):.
+00015550: 2020 2020 2020 2020 2222 2265 7865 6376          """execv
+00015560: 7028 6669 6c65 2c20 6172 6773 290a 0a20  p(file, args).. 
+00015570: 2020 2020 2020 2045 7865 6375 7465 2074         Execute t
+00015580: 6865 2065 7865 6375 7461 626c 6520 6669  he executable fi
+00015590: 6c65 2028 7768 6963 6820 6973 2073 6561  le (which is sea
+000155a0: 7263 6865 6420 666f 7220 616c 6f6e 6720  rched for along 
+000155b0: 2450 4154 4829 0a20 2020 2020 2020 2077  $PATH).        w
+000155c0: 6974 6820 6172 6775 6d65 6e74 206c 6973  ith argument lis
+000155d0: 7420 6172 6773 2c20 7265 706c 6163 696e  t args, replacin
+000155e0: 6720 7468 6520 6375 7272 656e 7420 7072  g the current pr
+000155f0: 6f63 6573 732e 0a20 2020 2020 2020 2061  ocess..        a
+00015600: 7267 7320 6d61 7920 6265 2061 206c 6973  rgs may be a lis
+00015610: 7420 6f72 2074 7570 6c65 206f 6620 7374  t or tuple of st
+00015620: 7269 6e67 732e 2222 220a 2020 2020 2020  rings.""".      
+00015630: 2020 7772 6170 7065 645f 6578 6563 7670    wrapped_execvp
+00015640: 6528 6669 6c65 2c20 6172 6773 290a 0a20  e(file, args).. 
+00015650: 2020 2064 6566 2065 7865 6376 7065 2866     def execvpe(f
+00015660: 696c 652c 2061 7267 732c 2065 6e76 293a  ile, args, env):
+00015670: 0a20 2020 2020 2020 2022 2222 6578 6563  .        """exec
+00015680: 7670 6528 6669 6c65 2c20 6172 6773 2c20  vpe(file, args, 
+00015690: 656e 7629 0a0a 2020 2020 2020 2020 4578  env)..        Ex
+000156a0: 6563 7574 6520 7468 6520 6578 6563 7574  ecute the execut
+000156b0: 6162 6c65 2066 696c 6520 2877 6869 6368  able file (which
+000156c0: 2069 7320 7365 6172 6368 6564 2066 6f72   is searched for
+000156d0: 2061 6c6f 6e67 2024 5041 5448 290a 2020   along $PATH).  
+000156e0: 2020 2020 2020 7769 7468 2061 7267 756d        with argum
+000156f0: 656e 7420 6c69 7374 2061 7267 7320 616e  ent list args an
+00015700: 6420 656e 7669 726f 6e6d 656e 7420 656e  d environment en
+00015710: 7620 2c20 7265 706c 6163 696e 6720 7468  v , replacing th
+00015720: 650a 2020 2020 2020 2020 6375 7272 656e  e.        curren
+00015730: 7420 7072 6f63 6573 732e 0a20 2020 2020  t process..     
+00015740: 2020 2061 7267 7320 6d61 7920 6265 2061     args may be a
+00015750: 206c 6973 7420 6f72 2074 7570 6c65 206f   list or tuple o
+00015760: 6620 7374 7269 6e67 732e 2222 220a 2020  f strings.""".  
+00015770: 2020 2020 2020 7772 6170 7065 645f 6578        wrapped_ex
+00015780: 6563 7670 6528 6669 6c65 2c20 6172 6773  ecvpe(file, args
+00015790: 2c20 656e 7629 0a0a 2020 2020 6f73 2e65  , env)..    os.e
+000157a0: 7865 6376 203d 2065 7865 6376 0a20 2020  xecv = execv.   
+000157b0: 206f 732e 6578 6563 7665 203d 2065 7865   os.execve = exe
+000157c0: 6376 650a 2020 2020 6f73 2e65 7865 636c  cve.    os.execl
+000157d0: 203d 2065 7865 636c 0a20 2020 206f 732e   = execl.    os.
+000157e0: 6578 6563 6c65 203d 2065 7865 636c 650a  execle = execle.
+000157f0: 2020 2020 6f73 2e65 7865 636c 7020 3d20      os.execlp = 
+00015800: 6578 6563 6c70 0a20 2020 206f 732e 6578  execlp.    os.ex
+00015810: 6563 6c70 6520 3d20 6578 6563 6c70 650a  eclpe = execlpe.
+00015820: 2020 2020 6f73 2e65 7865 6376 7020 3d20      os.execvp = 
+00015830: 6578 6563 7670 0a20 2020 206f 732e 6578  execvp.    os.ex
+00015840: 6563 7670 6520 3d20 6578 6563 7670 650a  ecvpe = execvpe.
+00015850: 2020 2020 6f73 2e5f 6578 6563 7670 6520      os._execvpe 
+00015860: 3d20 7772 6170 7065 645f 6578 6563 7670  = wrapped_execvp
+00015870: 650a 0a0a 6465 6620 6765 745f 6c73 625f  e...def get_lsb_
+00015880: 7265 6c65 6173 6528 293a 0a20 2020 2022  release():.    "
+00015890: 2222 0a20 2020 203a 7265 7475 726e 3a20  "".    :return: 
+000158a0: 6060 2f65 7463 2f6c 7362 2d72 656c 6561  ``/etc/lsb-relea
+000158b0: 7365 6060 2070 6172 7365 6420 6173 2061  se`` parsed as a
+000158c0: 2064 6963 740a 2020 2020 3a72 7479 7065   dict.    :rtype
+000158d0: 3a20 6469 6374 5b73 7472 2c73 7472 5d0a  : dict[str,str].
+000158e0: 2020 2020 2222 220a 2020 2020 6420 3d20      """.    d = 
+000158f0: 7b7d 0a20 2020 2066 6f72 206c 696e 6520  {}.    for line 
+00015900: 696e 206f 7065 6e28 222f 6574 632f 6c73  in open("/etc/ls
+00015910: 622d 7265 6c65 6173 6522 292e 7265 6164  b-release").read
+00015920: 2829 2e73 706c 6974 6c69 6e65 7328 293a  ().splitlines():
+00015930: 0a20 2020 2020 2020 206b 2c20 7620 3d20  .        k, v = 
+00015940: 6c69 6e65 2e73 706c 6974 2822 3d22 2c20  line.split("=", 
+00015950: 3129 0a20 2020 2020 2020 2069 6620 765b  1).        if v[
+00015960: 305d 203d 3d20 765b 2d31 5d20 3d3d 2027  0] == v[-1] == '
+00015970: 2227 3a0a 2020 2020 2020 2020 2020 2020  "':.            
+00015980: 7620 3d20 765b 313a 2d31 5d0a 2020 2020  v = v[1:-1].    
+00015990: 2020 2020 645b 6b5d 203d 2076 0a20 2020      d[k] = v.   
+000159a0: 2072 6574 7572 6e20 640a 0a0a 6465 6620   return d...def 
+000159b0: 6765 745f 7562 756e 7475 5f6d 616a 6f72  get_ubuntu_major
+000159c0: 5f76 6572 7369 6f6e 2829 3a0a 2020 2020  _version():.    
+000159d0: 2222 220a 2020 2020 3a72 7479 7065 3a20  """.    :rtype: 
+000159e0: 696e 747c 4e6f 6e65 0a20 2020 2022 2222  int|None.    """
+000159f0: 0a20 2020 2064 203d 2067 6574 5f6c 7362  .    d = get_lsb
+00015a00: 5f72 656c 6561 7365 2829 0a20 2020 2069  _release().    i
+00015a10: 6620 645b 2244 4953 5452 4942 5f49 4422  f d["DISTRIB_ID"
+00015a20: 5d20 213d 2022 5562 756e 7475 223a 0a20  ] != "Ubuntu":. 
+00015a30: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00015a40: 6e65 0a20 2020 2072 6574 7572 6e20 696e  ne.    return in
+00015a50: 7428 666c 6f61 7428 645b 2244 4953 5452  t(float(d["DISTR
+00015a60: 4942 5f52 454c 4541 5345 225d 2929 0a0a  IB_RELEASE"]))..
+00015a70: 0a64 6566 2061 7574 6f5f 7072 6566 6978  .def auto_prefix
+00015a80: 5f6f 735f 6578 6563 5f70 7265 6669 785f  _os_exec_prefix_
+00015a90: 7562 756e 7475 2870 7265 6669 785f 6172  ubuntu(prefix_ar
+00015aa0: 6773 2c20 7562 756e 7475 5f6d 696e 5f76  gs, ubuntu_min_v
+00015ab0: 6572 7369 6f6e 3d31 3629 3a0a 2020 2020  ersion=16):.    
+00015ac0: 2222 220a 2020 2020 3a70 6172 616d 206c  """.    :param l
+00015ad0: 6973 745b 7374 725d 2070 7265 6669 785f  ist[str] prefix_
+00015ae0: 6172 6773 3a0a 2020 2020 3a70 6172 616d  args:.    :param
+00015af0: 2069 6e74 2075 6275 6e74 755f 6d69 6e5f   int ubuntu_min_
+00015b00: 7665 7273 696f 6e3a 0a0a 2020 2020 4578  version:..    Ex
+00015b10: 616d 706c 6520 7573 6167 653a 0a20 2020  ample usage:.   
+00015b20: 2020 2061 7574 6f5f 7072 6566 6978 5f6f     auto_prefix_o
+00015b30: 735f 6578 6563 5f70 7265 6669 785f 7562  s_exec_prefix_ub
+00015b40: 756e 7475 285b 222f 752f 7a65 7965 722f  untu(["/u/zeyer/
+00015b50: 746f 6f6c 732f 676c 6962 6332 3137 2f6c  tools/glibc217/l
+00015b60: 642d 6c69 6e75 782d 7838 362d 3634 2e73  d-linux-x86-64.s
+00015b70: 6f2e 3222 5d29 0a20 2020 2022 2222 0a20  o.2"]).    """. 
+00015b80: 2020 2075 6275 6e74 755f 7665 7273 696f     ubuntu_versio
+00015b90: 6e20 3d20 6765 745f 7562 756e 7475 5f6d  n = get_ubuntu_m
+00015ba0: 616a 6f72 5f76 6572 7369 6f6e 2829 0a20  ajor_version(). 
+00015bb0: 2020 2069 6620 7562 756e 7475 5f76 6572     if ubuntu_ver
+00015bc0: 7369 6f6e 2069 7320 4e6f 6e65 3a0a 2020  sion is None:.  
+00015bd0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00015be0: 2069 6620 7562 756e 7475 5f76 6572 7369   if ubuntu_versi
+00015bf0: 6f6e 203e 3d20 7562 756e 7475 5f6d 696e  on >= ubuntu_min
+00015c00: 5f76 6572 7369 6f6e 3a0a 2020 2020 2020  _version:.      
+00015c10: 2020 7265 7475 726e 0a20 2020 2070 7269    return.    pri
+00015c20: 6e74 2822 596f 7520 6172 6520 7275 6e6e  nt("You are runn
+00015c30: 696e 6720 5562 756e 7475 2025 692c 2074  ing Ubuntu %i, t
+00015c40: 6875 7320 7765 2070 7265 6669 7820 616c  hus we prefix al
+00015c50: 6c20 6f73 2e65 7865 6320 7769 7468 2025  l os.exec with %
+00015c60: 732e 2220 2520 2875 6275 6e74 755f 7665  s." % (ubuntu_ve
+00015c70: 7273 696f 6e2c 2070 7265 6669 785f 6172  rsion, prefix_ar
+00015c80: 6773 2929 0a20 2020 2061 7373 6572 7420  gs)).    assert 
+00015c90: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
+00015ca0: 7265 6669 785f 6172 6773 5b30 5d29 0a20  refix_args[0]). 
+00015cb0: 2020 206f 7665 7277 7269 7465 5f6f 735f     overwrite_os_
+00015cc0: 6578 6563 2870 7265 6669 785f 6172 6773  exec(prefix_args
+00015cd0: 3d70 7265 6669 785f 6172 6773 290a 0a0a  =prefix_args)...
+00015ce0: 6465 6620 636c 6561 6e75 705f 656e 765f  def cleanup_env_
+00015cf0: 7661 725f 7061 7468 2865 6e76 5f76 6172  var_path(env_var
+00015d00: 2c20 7061 7468 5f70 7265 6669 7829 3a0a  , path_prefix):.
+00015d10: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+00015d20: 616d 2073 7472 2065 6e76 5f76 6172 3a20  am str env_var: 
+00015d30: 652e 672e 2022 4c44 5f4c 4942 5241 5259  e.g. "LD_LIBRARY
+00015d40: 5f50 4154 4822 0a20 2020 203a 7061 7261  _PATH".    :para
+00015d50: 6d20 7374 7220 7061 7468 5f70 7265 6669  m str path_prefi
+00015d60: 783a 0a0a 2020 2020 5769 6c6c 2072 656d  x:..    Will rem
+00015d70: 6f76 6520 616c 6c20 7061 7468 7320 696e  ove all paths in
+00015d80: 206f 732e 656e 7669 726f 6e5b 656e 765f   os.environ[env_
+00015d90: 7661 725d 2077 6869 6368 2061 7265 2070  var] which are p
+00015da0: 7265 6669 7865 6420 7769 7468 2070 6174  refixed with pat
+00015db0: 685f 7072 6566 6978 2e0a 2020 2020 2222  h_prefix..    ""
+00015dc0: 220a 2020 2020 6966 2065 6e76 5f76 6172  ".    if env_var
+00015dd0: 206e 6f74 2069 6e20 6f73 2e65 6e76 6972   not in os.envir
+00015de0: 6f6e 3a0a 2020 2020 2020 2020 7265 7475  on:.        retu
+00015df0: 726e 0a20 2020 2070 7320 3d20 6f73 2e65  rn.    ps = os.e
+00015e00: 6e76 6972 6f6e 5b65 6e76 5f76 6172 5d2e  nviron[env_var].
+00015e10: 7370 6c69 7428 223a 2229 0a0a 2020 2020  split(":")..    
+00015e20: 6465 6620 6628 7029 3a0a 2020 2020 2020  def f(p):.      
+00015e30: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+00015e40: 6172 616d 2073 7472 2070 3a0a 2020 2020  aram str p:.    
+00015e50: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
+00015e60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00015e70: 2020 2020 2069 6620 7020 3d3d 2070 6174       if p == pat
+00015e80: 685f 7072 6566 6978 206f 7220 702e 7374  h_prefix or p.st
+00015e90: 6172 7473 7769 7468 2870 6174 685f 7072  artswith(path_pr
+00015ea0: 6566 6978 202b 2022 2f22 293a 0a20 2020  efix + "/"):.   
+00015eb0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00015ec0: 5265 6d6f 7669 6e67 2025 7320 6672 6f6d  Removing %s from
+00015ed0: 2025 732e 2220 2520 2870 2c20 656e 765f   %s." % (p, env_
+00015ee0: 7661 7229 290a 2020 2020 2020 2020 2020  var)).          
+00015ef0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00015f00: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00015f10: 7565 0a0a 2020 2020 7073 203d 2066 696c  ue..    ps = fil
+00015f20: 7465 7228 662c 2070 7329 0a20 2020 206f  ter(f, ps).    o
+00015f30: 732e 656e 7669 726f 6e5b 656e 765f 7661  s.environ[env_va
+00015f40: 725d 203d 2022 3a22 2e6a 6f69 6e28 7073  r] = ":".join(ps
+00015f50: 290a 0a0a 6465 6620 6765 745f 6c6f 6769  )...def get_logi
+00015f60: 6e5f 7573 6572 6e61 6d65 2829 3a0a 2020  n_username():.  
+00015f70: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
+00015f80: 3a20 7374 720a 2020 2020 3a72 6574 7572  : str.    :retur
+00015f90: 6e3a 2074 6865 2075 7365 726e 616d 6520  n: the username 
+00015fa0: 6f66 2074 6865 2063 7572 7265 6e74 2075  of the current u
+00015fb0: 7365 722e 0a20 2020 2055 7365 2074 6869  ser..    Use thi
+00015fc0: 7320 6173 2061 2072 6570 6c61 6365 6d65  s as a replaceme
+00015fd0: 6e74 2066 6f72 206f 732e 6765 746c 6f67  nt for os.getlog
+00015fe0: 696e 2829 2e0a 2020 2020 2222 220a 2020  in()..    """.  
+00015ff0: 2020 696d 706f 7274 206f 730a 0a20 2020    import os..   
+00016000: 2069 6620 7379 732e 706c 6174 666f 726d   if sys.platform
+00016010: 203d 3d20 2277 696e 3332 223a 0a20 2020   == "win32":.   
+00016020: 2020 2020 2072 6574 7572 6e20 6f73 2e67       return os.g
+00016030: 6574 6c6f 6769 6e28 290a 2020 2020 696d  etlogin().    im
+00016040: 706f 7274 2070 7764 0a0a 2020 2020 7472  port pwd..    tr
+00016050: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
+00016060: 6e20 7077 642e 6765 7470 7775 6964 286f  n pwd.getpwuid(o
+00016070: 732e 6765 7475 6964 2829 295b 305d 0a20  s.getuid())[0]. 
+00016080: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00016090: 6f72 3a0a 2020 2020 2020 2020 2320 7077  or:.        # pw
+000160a0: 642e 6765 7470 7775 6964 2829 2063 616e  d.getpwuid() can
+000160b0: 2074 6872 6f77 204b 6579 4572 726f 723a   throw KeyError:
+000160c0: 2027 6765 7470 7775 6964 2829 3a20 7569   'getpwuid(): ui
+000160d0: 6420 6e6f 7420 666f 756e 643a 2031 3233  d not found: 123
+000160e0: 3435 270a 2020 2020 2020 2020 2320 7468  45'.        # th
+000160f0: 6973 2063 616e 2068 6170 7065 6e20 652e  is can happen e.
+00016100: 672e 2069 6e20 6120 646f 636b 6572 2065  g. in a docker e
+00016110: 6e76 6972 6f6e 6d65 6e74 2077 6974 6820  nvironment with 
+00016120: 6d61 7070 6564 2075 6964 7320 756e 6b6e  mapped uids unkn
+00016130: 6f77 6e20 746f 2074 6865 2064 6f63 6b65  own to the docke
+00016140: 7220 4f53 0a20 2020 2020 2020 2072 6574  r OS.        ret
+00016150: 7572 6e20 7374 7228 6f73 2e67 6574 7569  urn str(os.getui
+00016160: 6428 2929 0a0a 0a64 6566 2067 6574 5f74  d())...def get_t
+00016170: 656d 705f 6469 7228 293a 0a20 2020 2022  emp_dir():.    "
+00016180: 2222 0a20 2020 203a 7274 7970 653a 2073  "".    :rtype: s
+00016190: 7472 0a20 2020 203a 7265 7475 726e 3a20  tr.    :return: 
+000161a0: 652e 672e 2022 2f74 6d70 2f24 5553 4552  e.g. "/tmp/$USER
+000161b0: 4e41 4d45 220a 2020 2020 2222 220a 2020  NAME".    """.  
+000161c0: 2020 7573 6572 6e61 6d65 203d 2067 6574    username = get
+000161d0: 5f6c 6f67 696e 5f75 7365 726e 616d 6528  _login_username(
+000161e0: 290a 2020 2020 666f 7220 656e 766e 616d  ).    for envnam
+000161f0: 6520 696e 205b 2254 4d50 4449 5222 2c20  e in ["TMPDIR", 
+00016200: 2254 454d 5022 2c20 2254 4d50 225d 3a0a  "TEMP", "TMP"]:.
+00016210: 2020 2020 2020 2020 6469 726e 616d 6520          dirname 
+00016220: 3d20 6f73 2e67 6574 656e 7628 656e 766e  = os.getenv(envn
+00016230: 616d 6529 0a20 2020 2020 2020 2069 6620  ame).        if 
+00016240: 6469 726e 616d 653a 0a20 2020 2020 2020  dirname:.       
+00016250: 2020 2020 2072 6574 7572 6e20 2225 732f       return "%s/
+00016260: 2573 2220 2520 2864 6972 6e61 6d65 2c20  %s" % (dirname, 
+00016270: 7573 6572 6e61 6d65 290a 2020 2020 2320  username).    # 
+00016280: 2f76 6172 2f74 6d70 2073 686f 756c 6420  /var/tmp should 
+00016290: 6265 206d 6f72 6520 7065 7273 6973 7465  be more persiste
+000162a0: 6e74 2074 6861 6e20 2f74 6d70 2075 7375  nt than /tmp usu
+000162b0: 616c 6c79 2e0a 2020 2020 6966 206f 732e  ally..    if os.
+000162c0: 7061 7468 2e65 7869 7374 7328 222f 7661  path.exists("/va
+000162d0: 722f 746d 7022 293a 0a20 2020 2020 2020  r/tmp"):.       
+000162e0: 2072 6574 7572 6e20 222f 7661 722f 746d   return "/var/tm
+000162f0: 702f 2573 2220 2520 7573 6572 6e61 6d65  p/%s" % username
+00016300: 0a20 2020 2072 6574 7572 6e20 222f 746d  .    return "/tm
+00016310: 702f 2573 2220 2520 7573 6572 6e61 6d65  p/%s" % username
+00016320: 0a0a 0a64 6566 2067 6574 5f63 6163 6865  ...def get_cache
+00016330: 5f64 6972 2829 3a0a 2020 2020 2222 220a  _dir():.    """.
+00016340: 2020 2020 3a72 6574 7572 6e3a 2075 7365      :return: use
+00016350: 6420 746f 2063 6163 6865 206e 6f6e 2d63  d to cache non-c
+00016360: 7269 7469 6361 6c20 7468 696e 6773 2e20  ritical things. 
+00016370: 6279 2064 6566 6175 6c74 2067 6574 5f74  by default get_t
+00016380: 656d 705f 6469 722e 2075 6e6c 6573 7320  emp_dir. unless 
+00016390: 796f 7520 6465 6669 6e65 2065 6e76 2052  you define env R
+000163a0: 4554 5552 4e4e 5f43 4143 4845 5f44 4952  ETURNN_CACHE_DIR
+000163b0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+000163c0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000163d0: 2252 4554 5552 4e4e 5f43 4143 4845 5f44  "RETURNN_CACHE_D
+000163e0: 4952 2220 696e 206f 732e 656e 7669 726f  IR" in os.enviro
+000163f0: 6e3a 0a20 2020 2020 2020 2072 6574 7572  n:.        retur
+00016400: 6e20 6f73 2e65 6e76 6972 6f6e 5b22 5245  n os.environ["RE
+00016410: 5455 524e 4e5f 4341 4348 455f 4449 5222  TURNN_CACHE_DIR"
+00016420: 5d0a 2020 2020 7265 7475 726e 2067 6574  ].    return get
+00016430: 5f74 656d 705f 6469 7228 290a 0a0a 636c  _temp_dir()...cl
+00016440: 6173 7320 4c6f 636b 4669 6c65 286f 626a  ass LockFile(obj
+00016450: 6563 7429 3a0a 2020 2020 2222 220a 2020  ect):.    """.  
+00016460: 2020 5369 6d70 6c65 206c 6f63 6b20 6669    Simple lock fi
+00016470: 6c65 2e0a 2020 2020 2222 220a 0a20 2020  le..    """..   
+00016480: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00016490: 6c66 2c20 6469 7265 6374 6f72 792c 206e  lf, directory, n
+000164a0: 616d 653d 226c 6f63 6b5f 6669 6c65 222c  ame="lock_file",
+000164b0: 206c 6f63 6b5f 7469 6d65 6f75 743d 3120   lock_timeout=1 
+000164c0: 2a20 3630 202a 2036 3029 3a0a 2020 2020  * 60 * 60):.    
+000164d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000164e0: 3a70 6172 616d 2073 7472 2064 6972 6563  :param str direc
+000164f0: 746f 7279 3a0a 2020 2020 2020 2020 3a70  tory:.        :p
+00016500: 6172 616d 2069 6e74 7c66 6c6f 6174 206c  aram int|float l
+00016510: 6f63 6b5f 7469 6d65 6f75 743a 2069 6e20  ock_timeout: in 
+00016520: 7365 636f 6e64 730a 2020 2020 2020 2020  seconds.        
+00016530: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
+00016540: 2e64 6972 6563 746f 7279 203d 2064 6972  .directory = dir
+00016550: 6563 746f 7279 0a20 2020 2020 2020 2073  ectory.        s
+00016560: 656c 662e 6e61 6d65 203d 206e 616d 650a  elf.name = name.
+00016570: 2020 2020 2020 2020 7365 6c66 2e66 6420          self.fd 
+00016580: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+00016590: 656c 662e 6c6f 636b 5f74 696d 656f 7574  elf.lock_timeout
+000165a0: 203d 206c 6f63 6b5f 7469 6d65 6f75 740a   = lock_timeout.
+000165b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f63          self.loc
+000165c0: 6b66 696c 6520 3d20 2225 732f 2573 2220  kfile = "%s/%s" 
+000165d0: 2520 2864 6972 6563 746f 7279 2c20 6e61  % (directory, na
+000165e0: 6d65 290a 0a20 2020 2064 6566 2069 735f  me)..    def is_
+000165f0: 6f6c 645f 6c6f 636b 6669 6c65 2873 656c  old_lockfile(sel
+00016600: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+00016610: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00016620: 2057 6865 7468 6572 2074 6865 7265 2069   Whether there i
+00016630: 7320 616e 2065 7869 7374 696e 6720 6c6f  s an existing lo
+00016640: 636b 2066 696c 6520 616e 6420 7468 6520  ck file and the 
+00016650: 6578 6973 7469 6e67 206c 6f63 6b20 6669  existing lock fi
+00016660: 6c65 2069 7320 6f6c 642e 0a20 2020 2020  le is old..     
+00016670: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
+00016680: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016690: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000166a0: 2020 2020 206d 7469 6d65 203d 206f 732e       mtime = os.
+000166b0: 7061 7468 2e67 6574 6d74 696d 6528 7365  path.getmtime(se
+000166c0: 6c66 2e6c 6f63 6b66 696c 6529 0a20 2020  lf.lockfile).   
+000166d0: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+000166e0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+000166f0: 206d 7469 6d65 203d 204e 6f6e 650a 2020   mtime = None.  
+00016700: 2020 2020 2020 6966 206d 7469 6d65 2061        if mtime a
+00016710: 6e64 2028 6162 7328 7469 6d65 2e74 696d  nd (abs(time.tim
+00016720: 6528 2920 2d20 6d74 696d 6529 203e 2073  e() - mtime) > s
+00016730: 656c 662e 6c6f 636b 5f74 696d 656f 7574  elf.lock_timeout
+00016740: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00016750: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
+00016760: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00016770: 0a20 2020 2064 6566 206d 6179 6265 5f72  .    def maybe_r
+00016780: 656d 6f76 655f 6f6c 645f 6c6f 636b 6669  emove_old_lockfi
+00016790: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
+000167a0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+000167b0: 6d6f 7665 7320 616e 2065 7869 7374 696e  moves an existin
+000167c0: 6720 6f6c 6420 6c6f 636b 6669 6c65 2c20  g old lockfile, 
+000167d0: 6966 2074 6865 7265 2069 7320 6f6e 652e  if there is one.
+000167e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000167f0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00016800: 2e69 735f 6f6c 645f 6c6f 636b 6669 6c65  .is_old_lockfile
+00016810: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00016820: 7265 7475 726e 0a20 2020 2020 2020 2070  return.        p
+00016830: 7269 6e74 2822 5265 6d6f 7669 6e67 206f  rint("Removing o
+00016840: 6c64 206c 6f63 6b66 696c 6520 2572 2028  ld lockfile %r (
+00016850: 7072 6f62 6162 6c79 2063 7261 7368 6564  probably crashed
+00016860: 2070 726f 6329 2e22 2025 2073 656c 662e   proc)." % self.
+00016870: 6c6f 636b 6669 6c65 290a 2020 2020 2020  lockfile).      
+00016880: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00016890: 2020 206f 732e 7265 6d6f 7665 2873 656c     os.remove(sel
+000168a0: 662e 6c6f 636b 6669 6c65 290a 2020 2020  f.lockfile).    
+000168b0: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+000168c0: 6f72 2061 7320 6578 633a 0a20 2020 2020  or as exc:.     
+000168d0: 2020 2020 2020 2070 7269 6e74 2822 5265         print("Re
+000168e0: 6d6f 7665 206c 6f63 6b66 696c 6520 6578  move lockfile ex
+000168f0: 6365 7074 696f 6e20 2572 2e20 4967 6e6f  ception %r. Igno
+00016900: 7269 6e67 2069 742e 2220 2520 6578 6329  ring it." % exc)
+00016910: 0a0a 2020 2020 6465 6620 6973 5f6c 6f63  ..    def is_loc
+00016920: 6b65 6428 7365 6c66 293a 0a20 2020 2020  ked(self):.     
+00016930: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+00016940: 7265 7475 726e 3a20 7768 6574 6865 7220  return: whether 
+00016950: 7468 6572 6520 6973 2061 6e20 6163 7469  there is an acti
+00016960: 7665 2028 6e6f 7420 6f6c 6429 206c 6f63  ve (not old) loc
+00016970: 6b66 696c 650a 2020 2020 2020 2020 3a72  kfile.        :r
+00016980: 7479 7065 3a20 626f 6f6c 0a20 2020 2020  type: bool.     
+00016990: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000169a0: 6620 7365 6c66 2e69 735f 6f6c 645f 6c6f  f self.is_old_lo
+000169b0: 636b 6669 6c65 2829 3a0a 2020 2020 2020  ckfile():.      
+000169c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000169d0: 7365 0a20 2020 2020 2020 2074 7279 3a0a  se.        try:.
+000169e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000169f0: 726e 206f 732e 7061 7468 2e65 7869 7374  rn os.path.exist
+00016a00: 7328 7365 6c66 2e6c 6f63 6b66 696c 6529  s(self.lockfile)
+00016a10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00016a20: 4f53 4572 726f 723a 0a20 2020 2020 2020  OSError:.       
+00016a30: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00016a40: 650a 0a20 2020 2064 6566 206c 6f63 6b28  e..    def lock(
+00016a50: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00016a60: 2222 0a20 2020 2020 2020 2041 6371 7569  "".        Acqui
+00016a70: 7265 7320 7468 6520 6c6f 636b 2e0a 2020  res the lock..  
+00016a80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016a90: 2020 696d 706f 7274 2074 696d 650a 2020    import time.  
+00016aa0: 2020 2020 2020 696d 706f 7274 2065 7272        import err
+00016ab0: 6e6f 0a0a 2020 2020 2020 2020 7761 6974  no..        wait
+00016ac0: 5f63 6f75 6e74 203d 2030 0a20 2020 2020  _count = 0.     
+00016ad0: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
+00016ae0: 2020 2020 2020 2020 2020 2023 2054 7279             # Try
+00016af0: 2074 6f20 6372 6561 7465 2064 6972 6563   to create direc
+00016b00: 746f 7279 2069 6620 6974 2064 6f65 7320  tory if it does 
+00016b10: 6e6f 7420 6578 6973 742e 0a20 2020 2020  not exist..     
+00016b20: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00016b30: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00016b40: 616b 6564 6972 7328 7365 6c66 2e64 6972  akedirs(self.dir
+00016b50: 6563 746f 7279 290a 2020 2020 2020 2020  ectory).        
+00016b60: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+00016b70: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00016b80: 2020 2020 7061 7373 2020 2320 4967 6e6f      pass  # Igno
+00016b90: 7265 2061 6e79 2065 7272 6f72 732e 0a20  re any errors.. 
+00016ba0: 2020 2020 2020 2020 2020 2023 204e 6f77             # Now
+00016bb0: 2074 7279 2074 6f20 6372 6561 7465 2074   try to create t
+00016bc0: 6865 206c 6f63 6b2e 0a20 2020 2020 2020  he lock..       
+00016bd0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00016be0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+00016bf0: 6420 3d20 6f73 2e6f 7065 6e28 7365 6c66  d = os.open(self
+00016c00: 2e6c 6f63 6b66 696c 652c 206f 732e 4f5f  .lockfile, os.O_
+00016c10: 4352 4541 5420 7c20 6f73 2e4f 5f45 5843  CREAT | os.O_EXC
+00016c20: 4c20 7c20 6f73 2e4f 5f52 4457 5229 0a20  L | os.O_RDWR). 
+00016c30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016c40: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
+00016c50: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
+00016c60: 2061 7320 6578 633a 0a20 2020 2020 2020   as exc:.       
+00016c70: 2020 2020 2020 2020 2023 2050 6f73 7369           # Possi
+00016c80: 626c 6520 6572 726f 7273 3a0a 2020 2020  ble errors:.    
+00016c90: 2020 2020 2020 2020 2020 2020 2320 454e              # EN
+00016ca0: 4f45 4e54 2028 4e6f 2073 7563 6820 6669  OENT (No such fi
+00016cb0: 6c65 206f 7220 6469 7265 6374 6f72 7929  le or directory)
+00016cc0: 2c20 652e 672e 2069 6620 7468 6520 6469  , e.g. if the di
+00016cd0: 7265 6374 6f72 7920 7761 7320 6465 6c65  rectory was dele
+00016ce0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
+00016cf0: 2020 2020 2023 2045 4558 4953 5420 2846       # EEXIST (F
+00016d00: 696c 6520 6578 6973 7473 292c 2069 6620  ile exists), if 
+00016d10: 7468 6520 6c6f 636b 2061 6c72 6561 6479  the lock already
+00016d20: 2065 7869 7374 732e 0a20 2020 2020 2020   exists..       
+00016d30: 2020 2020 2020 2020 2069 6620 6578 632e           if exc.
+00016d40: 6572 726e 6f20 6e6f 7420 696e 205b 6572  errno not in [er
+00016d50: 726e 6f2e 454e 4f45 4e54 2c20 6572 726e  rno.ENOENT, errn
+00016d60: 6f2e 4545 5849 5354 5d3a 0a20 2020 2020  o.EEXIST]:.     
+00016d70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016d80: 6169 7365 2020 2320 4f74 6865 7220 6572  aise  # Other er
+00016d90: 726f 722c 2073 6f20 7265 7261 6973 652e  ror, so reraise.
+00016da0: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
+00016db0: 6520 6469 6420 6e6f 7420 6765 7420 7468  e did not get th
+00016dc0: 6520 6c6f 636b 2e0a 2020 2020 2020 2020  e lock..        
+00016dd0: 2020 2020 2320 4368 6563 6b20 6966 2069      # Check if i
+00016de0: 7420 6973 2061 2072 6561 6c6c 7920 6f6c  t is a really ol
+00016df0: 6420 6f6e 652e 0a20 2020 2020 2020 2020  d one..         
+00016e00: 2020 2073 656c 662e 6d61 7962 655f 7265     self.maybe_re
+00016e10: 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66 696c  move_old_lockfil
+00016e20: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00016e30: 2320 5761 6974 2061 2062 6974 2c20 616e  # Wait a bit, an
+00016e40: 6420 7468 656e 2072 6574 7279 2e0a 2020  d then retry..  
+00016e50: 2020 2020 2020 2020 2020 7469 6d65 2e73            time.s
+00016e60: 6c65 6570 2831 290a 2020 2020 2020 2020  leep(1).        
+00016e70: 2020 2020 7761 6974 5f63 6f75 6e74 202b      wait_count +
+00016e80: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00016e90: 6966 2077 6169 745f 636f 756e 7420 3d3d  if wait_count ==
+00016ea0: 2031 303a 0a20 2020 2020 2020 2020 2020   10:.           
+00016eb0: 2020 2020 2070 7269 6e74 2822 5761 6974       print("Wait
+00016ec0: 696e 6720 666f 7220 6c6f 636b 2d66 696c  ing for lock-fil
+00016ed0: 653a 2025 7322 2025 2073 656c 662e 6c6f  e: %s" % self.lo
+00016ee0: 636b 6669 6c65 290a 0a20 2020 2064 6566  ckfile)..    def
+00016ef0: 2075 6e6c 6f63 6b28 7365 6c66 293a 0a20   unlock(self):. 
+00016f00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00016f10: 2020 2052 656c 6561 7365 7320 7468 6520     Releases the 
+00016f20: 6c6f 636b 2e0a 2020 2020 2020 2020 2222  lock..        ""
+00016f30: 220a 2020 2020 2020 2020 6f73 2e63 6c6f  ".        os.clo
+00016f40: 7365 2873 656c 662e 6664 290a 2020 2020  se(self.fd).    
+00016f50: 2020 2020 6f73 2e72 656d 6f76 6528 7365      os.remove(se
+00016f60: 6c66 2e6c 6f63 6b66 696c 6529 0a0a 2020  lf.lockfile)..  
+00016f70: 2020 6465 6620 5f5f 656e 7465 725f 5f28    def __enter__(
+00016f80: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+00016f90: 656c 662e 6c6f 636b 2829 0a0a 2020 2020  elf.lock()..    
+00016fa0: 6465 6620 5f5f 6578 6974 5f5f 2873 656c  def __exit__(sel
+00016fb0: 662c 2065 7863 5f74 7970 652c 2065 7863  f, exc_type, exc
+00016fc0: 5f76 616c 2c20 6578 635f 7462 293a 0a20  _val, exc_tb):. 
+00016fd0: 2020 2020 2020 2073 656c 662e 756e 6c6f         self.unlo
+00016fe0: 636b 2829 0a0a 0a64 6566 2073 7472 5f69  ck()...def str_i
+00016ff0: 735f 6e75 6d62 6572 2873 293a 0a20 2020  s_number(s):.   
+00017000: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00017010: 7374 7220 733a 2065 2e67 2e20 2231 222c  str s: e.g. "1",
+00017020: 2022 2e33 2220 6f72 2022 7822 0a20 2020   ".3" or "x".   
+00017030: 203a 7265 7475 726e 3a20 7768 6574 6865   :return: whethe
+00017040: 7220 7320 6361 6e20 6265 2063 6173 7465  r s can be caste
+00017050: 6420 746f 2066 6c6f 6174 206f 7220 696e  d to float or in
+00017060: 740a 2020 2020 3a72 7479 7065 3a20 626f  t.    :rtype: bo
+00017070: 6f6c 0a20 2020 2022 2222 0a20 2020 2074  ol.    """.    t
+00017080: 7279 3a0a 2020 2020 2020 2020 666c 6f61  ry:.        floa
+00017090: 7428 7329 0a20 2020 2020 2020 2072 6574  t(s).        ret
+000170a0: 7572 6e20 5472 7565 0a20 2020 2065 7863  urn True.    exc
+000170b0: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
+000170c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000170d0: 616c 7365 0a0a 0a64 6566 2073 6f72 7465  alse...def sorte
+000170e0: 645f 7661 6c75 6573 5f66 726f 6d5f 6469  d_values_from_di
+000170f0: 6374 2864 293a 0a20 2020 2022 2222 0a20  ct(d):.    """. 
+00017100: 2020 203a 7061 7261 6d20 6469 6374 5b54     :param dict[T
+00017110: 2c56 5d20 643a 0a20 2020 203a 7274 7970  ,V] d:.    :rtyp
+00017120: 653a 206c 6973 745b 565d 0a20 2020 2022  e: list[V].    "
+00017130: 2222 0a20 2020 2061 7373 6572 7420 6973  "".    assert is
+00017140: 696e 7374 616e 6365 2864 2c20 6469 6374  instance(d, dict
+00017150: 290a 2020 2020 7265 7475 726e 205b 7620  ).    return [v 
+00017160: 666f 7220 286b 2c20 7629 2069 6e20 736f  for (k, v) in so
+00017170: 7274 6564 2864 2e69 7465 6d73 2829 295d  rted(d.items())]
+00017180: 0a0a 0a64 6566 2064 6963 745f 7a69 7028  ...def dict_zip(
+00017190: 6b65 7973 2c20 7661 6c75 6573 293a 0a20  keys, values):. 
+000171a0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+000171b0: 6d20 6c69 7374 5b54 5d20 6b65 7973 3a0a  m list[T] keys:.
+000171c0: 2020 2020 3a70 6172 616d 206c 6973 745b      :param list[
+000171d0: 565d 2076 616c 7565 733a 0a20 2020 203a  V] values:.    :
+000171e0: 7274 7970 653a 2064 6963 745b 542c 565d  rtype: dict[T,V]
+000171f0: 0a20 2020 2022 2222 0a20 2020 2061 7373  .    """.    ass
+00017200: 6572 7420 6c65 6e28 6b65 7973 2920 3d3d  ert len(keys) ==
+00017210: 206c 656e 2876 616c 7565 7329 0a20 2020   len(values).   
+00017220: 2072 6574 7572 6e20 6469 6374 287a 6970   return dict(zip
+00017230: 286b 6579 732c 2076 616c 7565 7329 290a  (keys, values)).
+00017240: 0a0a 6465 6620 7061 7273 655f 6c64 5f63  ..def parse_ld_c
+00017250: 6f6e 665f 6669 6c65 2866 6e29 3a0a 2020  onf_file(fn):.  
+00017260: 2020 2222 220a 2020 2020 5669 6120 6874    """.    Via ht
+00017270: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00017280: 2f61 6c62 6572 747a 2f73 7973 7465 6d2d  /albertz/system-
+00017290: 746f 6f6c 732f 626c 6f62 2f6d 6173 7465  tools/blob/maste
+000172a0: 722f 6269 6e2f 6669 6e64 2d6c 6962 2d69  r/bin/find-lib-i
+000172b0: 6e2d 7061 7468 2e70 792e 0a0a 2020 2020  n-path.py...    
+000172c0: 3a70 6172 616d 2073 7472 2066 6e3a 2065  :param str fn: e
+000172d0: 2e67 2e20 222f 6574 632f 6c64 2e73 6f2e  .g. "/etc/ld.so.
+000172e0: 636f 6e66 220a 2020 2020 3a72 6574 7572  conf".    :retur
+000172f0: 6e3a 206c 6973 7420 6f66 2070 6174 6873  n: list of paths
+00017300: 2066 6f72 206c 6962 730a 2020 2020 3a72   for libs.    :r
+00017310: 7479 7065 3a20 6c69 7374 5b73 7472 5d0a  type: list[str].
+00017320: 2020 2020 2222 220a 2020 2020 6672 6f6d      """.    from
+00017330: 2067 6c6f 6220 696d 706f 7274 2067 6c6f   glob import glo
+00017340: 620a 0a20 2020 2070 6174 6873 203d 205b  b..    paths = [
+00017350: 5d0a 2020 2020 666f 7220 6c69 6e65 2069  ].    for line i
+00017360: 6e20 6f70 656e 2866 6e29 2e72 6561 6428  n open(fn).read(
+00017370: 292e 7370 6c69 746c 696e 6573 2829 3a0a  ).splitlines():.
+00017380: 2020 2020 2020 2020 6c69 6e65 203d 206c          line = l
+00017390: 696e 652e 7374 7269 7028 290a 2020 2020  ine.strip().    
+000173a0: 2020 2020 6966 206e 6f74 206c 696e 653a      if not line:
+000173b0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000173c0: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
+000173d0: 206c 696e 652e 7374 6172 7473 7769 7468   line.startswith
+000173e0: 2822 2322 293a 0a20 2020 2020 2020 2020  ("#"):.         
+000173f0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00017400: 2020 2020 6966 206c 696e 652e 7374 6172      if line.star
+00017410: 7473 7769 7468 2822 696e 636c 7564 6520  tswith("include 
+00017420: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00017430: 666f 7220 7375 625f 666e 2069 6e20 676c  for sub_fn in gl
+00017440: 6f62 286c 696e 655b 6c65 6e28 2269 6e63  ob(line[len("inc
+00017450: 6c75 6465 2022 2920 3a5d 293a 0a20 2020  lude ") :]):.   
+00017460: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+00017470: 6873 2e65 7874 656e 6428 7061 7273 655f  hs.extend(parse_
+00017480: 6c64 5f63 6f6e 665f 6669 6c65 2873 7562  ld_conf_file(sub
+00017490: 5f66 6e29 290a 2020 2020 2020 2020 2020  _fn)).          
+000174a0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+000174b0: 2020 2070 6174 6873 2e61 7070 656e 6428     paths.append(
+000174c0: 6c69 6e65 290a 2020 2020 7265 7475 726e  line).    return
+000174d0: 2070 6174 6873 0a0a 0a64 6566 2067 6574   paths...def get
+000174e0: 5f6c 645f 7061 7468 7328 293a 0a20 2020  _ld_paths():.   
+000174f0: 2022 2222 0a20 2020 2054 6f20 6265 2076   """.    To be v
+00017500: 6572 7920 636f 7272 6563 742c 2073 6565  ery correct, see
+00017510: 206d 616e 2d70 6167 6520 6f66 206c 642e   man-page of ld.
+00017520: 736f 2e0a 2020 2020 416e 6420 6865 7265  so..    And here
+00017530: 3a20 6874 7470 733a 2f2f 756e 6978 2e73  : https://unix.s
+00017540: 7461 636b 6578 6368 616e 6765 2e63 6f6d  tackexchange.com
+00017550: 2f71 7565 7374 696f 6e73 2f33 3534 3239  /questions/35429
+00017560: 352f 7768 6174 2d69 732d 7468 652d 6465  5/what-is-the-de
+00017570: 6661 756c 742d 7661 6c75 652d 6f66 2d6c  fault-value-of-l
+00017580: 642d 6c69 6272 6172 792d 7061 7468 2f33  d-library-path/3
+00017590: 3534 3239 360a 2020 2020 5368 6f72 7420  54296.    Short 
+000175a0: 7665 7273 696f 6e2c 206e 6f74 2073 7065  version, not spe
+000175b0: 6369 6669 6320 746f 2061 6e20 6578 6563  cific to an exec
+000175c0: 7574 6162 6c65 2c20 696e 2074 6869 7320  utable, in this 
+000175d0: 6f72 6465 723a 0a20 2020 202d 204c 445f  order:.    - LD_
+000175e0: 4c49 4252 4152 595f 5041 5448 0a20 2020  LIBRARY_PATH.   
+000175f0: 202d 202f 6574 632f 6c64 2e73 6f2e 6361   - /etc/ld.so.ca
+00017600: 6368 6520 2869 6e73 7465 6164 2077 6520  che (instead we 
+00017610: 7769 6c6c 2070 6172 7365 202f 6574 632f  will parse /etc/
+00017620: 6c64 2e73 6f2e 636f 6e66 290a 2020 2020  ld.so.conf).    
+00017630: 2d20 2f6c 6962 2c20 2f75 7372 2f6c 6962  - /lib, /usr/lib
+00017640: 2028 6f72 206d 6179 6265 202f 6c69 6236   (or maybe /lib6
+00017650: 342c 202f 7573 722f 6c69 6236 3429 0a20  4, /usr/lib64). 
+00017660: 2020 2056 6961 2068 7474 7073 3a2f 2f67     Via https://g
+00017670: 6974 6875 622e 636f 6d2f 616c 6265 7274  ithub.com/albert
+00017680: 7a2f 7379 7374 656d 2d74 6f6f 6c73 2f62  z/system-tools/b
+00017690: 6c6f 622f 6d61 7374 6572 2f62 696e 2f66  lob/master/bin/f
+000176a0: 696e 642d 6c69 622d 696e 2d70 6174 682e  ind-lib-in-path.
+000176b0: 7079 2e0a 0a20 2020 203a 7274 7970 653a  py...    :rtype:
+000176c0: 206c 6973 745b 7374 725d 0a20 2020 203a   list[str].    :
+000176d0: 7265 7475 726e 3a20 6c69 7374 206f 6620  return: list of 
+000176e0: 7061 7468 7320 746f 2073 6561 7263 6820  paths to search 
+000176f0: 666f 7220 6c69 6273 2028 2a2e 736f 2066  for libs (*.so f
+00017700: 696c 6573 290a 2020 2020 2222 220a 2020  iles).    """.  
+00017710: 2020 7061 7468 7320 3d20 5b5d 0a20 2020    paths = [].   
+00017720: 2069 6620 224c 445f 4c49 4252 4152 595f   if "LD_LIBRARY_
+00017730: 5041 5448 2220 696e 206f 732e 656e 7669  PATH" in os.envi
+00017740: 726f 6e3a 0a20 2020 2020 2020 2070 6174  ron:.        pat
+00017750: 6873 2e65 7874 656e 6428 6f73 2e65 6e76  hs.extend(os.env
+00017760: 6972 6f6e 5b22 4c44 5f4c 4942 5241 5259  iron["LD_LIBRARY
+00017770: 5f50 4154 4822 5d2e 7370 6c69 7428 223a  _PATH"].split(":
+00017780: 2229 290a 2020 2020 6966 206f 732e 7061  ")).    if os.pa
+00017790: 7468 2e65 7869 7374 7328 222f 6574 632f  th.exists("/etc/
+000177a0: 6c64 2e73 6f2e 636f 6e66 2229 3a0a 2020  ld.so.conf"):.  
+000177b0: 2020 2020 2020 7061 7468 732e 6578 7465        paths.exte
+000177c0: 6e64 2870 6172 7365 5f6c 645f 636f 6e66  nd(parse_ld_conf
+000177d0: 5f66 696c 6528 222f 6574 632f 6c64 2e73  _file("/etc/ld.s
+000177e0: 6f2e 636f 6e66 2229 290a 2020 2020 7061  o.conf")).    pa
+000177f0: 7468 732e 6578 7465 6e64 285b 222f 6c69  ths.extend(["/li
+00017800: 6222 2c20 222f 7573 722f 6c69 6222 2c20  b", "/usr/lib", 
+00017810: 222f 6c69 6236 3422 2c20 222f 7573 722f  "/lib64", "/usr/
+00017820: 6c69 6236 3422 5d29 0a20 2020 2072 6574  lib64"]).    ret
+00017830: 7572 6e20 7061 7468 730a 0a0a 6465 6620  urn paths...def 
+00017840: 6669 6e64 5f6c 6962 286c 6962 5f6e 616d  find_lib(lib_nam
+00017850: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+00017860: 3a70 6172 616d 2073 7472 206c 6962 5f6e  :param str lib_n
+00017870: 616d 653a 2077 6974 686f 7574 2070 6f73  ame: without pos
+00017880: 7466 6978 2f70 7265 6669 782c 2065 2e67  tfix/prefix, e.g
+00017890: 2e20 2263 7564 6172 7422 206f 7220 2262  . "cudart" or "b
+000178a0: 6c61 7322 0a20 2020 203a 7265 7475 726e  las".    :return
+000178b0: 3a20 7265 7475 726e 7320 6675 6c6c 2070  : returns full p
+000178c0: 6174 6820 746f 206c 6962 206f 7220 4e6f  ath to lib or No
+000178d0: 6e65 0a20 2020 203a 7274 7970 653a 2073  ne.    :rtype: s
+000178e0: 7472 7c4e 6f6e 650a 2020 2020 2222 220a  tr|None.    """.
+000178f0: 2020 2020 6966 2073 7973 2e70 6c61 7466      if sys.platf
+00017900: 6f72 6d20 3d3d 2022 6461 7277 696e 223a  orm == "darwin":
+00017910: 0a20 2020 2020 2020 2070 7265 6669 7820  .        prefix 
+00017920: 3d20 226c 6962 220a 2020 2020 2020 2020  = "lib".        
+00017930: 706f 7374 6669 7820 3d20 222e 6479 6c69  postfix = ".dyli
+00017940: 6222 0a20 2020 2065 6c69 6620 7379 732e  b".    elif sys.
+00017950: 706c 6174 666f 726d 203d 3d20 2277 696e  platform == "win
+00017960: 3332 223a 0a20 2020 2020 2020 2070 7265  32":.        pre
+00017970: 6669 7820 3d20 2222 0a20 2020 2020 2020  fix = "".       
+00017980: 2070 6f73 7466 6978 203d 2022 2e64 6c6c   postfix = ".dll
+00017990: 220a 2020 2020 656c 7365 3a0a 2020 2020  ".    else:.    
+000179a0: 2020 2020 7072 6566 6978 203d 2022 6c69      prefix = "li
+000179b0: 6222 0a20 2020 2020 2020 2070 6f73 7466  b".        postf
+000179c0: 6978 203d 2022 2e73 6f22 0a20 2020 2066  ix = ".so".    f
+000179d0: 6f72 2070 6174 6820 696e 2067 6574 5f6c  or path in get_l
+000179e0: 645f 7061 7468 7328 293a 0a20 2020 2020  d_paths():.     
+000179f0: 2020 2066 6e20 3d20 2225 732f 2573 2573     fn = "%s/%s%s
+00017a00: 2573 2220 2520 2870 6174 682c 2070 7265  %s" % (path, pre
+00017a10: 6669 782c 206c 6962 5f6e 616d 652c 2070  fix, lib_name, p
+00017a20: 6f73 7466 6978 290a 2020 2020 2020 2020  ostfix).        
+00017a30: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
+00017a40: 7328 666e 293a 0a20 2020 2020 2020 2020  s(fn):.         
+00017a50: 2020 2072 6574 7572 6e20 666e 0a20 2020     return fn.   
+00017a60: 2072 6574 7572 6e20 4e6f 6e65 0a0a 0a64   return None...d
+00017a70: 6566 2072 6561 645f 7367 655f 6e75 6d5f  ef read_sge_num_
+00017a80: 7072 6f63 7328 6a6f 625f 6964 3d4e 6f6e  procs(job_id=Non
+00017a90: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+00017aa0: 4672 6f6d 2074 6865 2053 756e 2047 7269  From the Sun Gri
+00017ab0: 6420 456e 6769 6e65 2028 5347 4529 2c20  d Engine (SGE), 
+00017ac0: 7265 6164 7320 7468 6520 6e75 6d5f 7072  reads the num_pr
+00017ad0: 6f63 2073 6574 7469 6e67 2066 6f72 2061  oc setting for a
+00017ae0: 2070 6172 7469 6375 6c61 7220 6a6f 622e   particular job.
+00017af0: 0a20 2020 2049 6620 6a6f 625f 6964 2069  .    If job_id i
+00017b00: 7320 6e6f 7420 7072 6f76 6964 6564 2061  s not provided a
+00017b10: 6e64 2074 6865 204a 4f42 5f49 4420 656e  nd the JOB_ID en
+00017b20: 7620 6973 2073 6574 2c20 6974 2077 696c  v is set, it wil
+00017b30: 6c20 7573 6520 7468 6174 2069 6e73 7465  l use that inste
+00017b40: 6164 2028 692e 652e 2069 7420 7573 6573  ad (i.e. it uses
+00017b50: 2074 6865 2063 7572 7265 6e74 206a 6f62   the current job
+00017b60: 292e 0a20 2020 2054 6869 7320 6361 6c6c  )..    This call
+00017b70: 7320 7173 7461 7420 746f 2066 6967 7572  s qstat to figur
+00017b80: 6520 6f75 7420 7468 6973 2073 6574 7469  e out this setti
+00017b90: 6e67 2e20 5468 6572 6520 6172 6520 6d75  ng. There are mu
+00017ba0: 6c74 6970 6c65 2077 6179 7320 7468 6973  ltiple ways this
+00017bb0: 2063 616e 2067 6f20 7772 6f6e 672c 0a20   can go wrong,. 
+00017bc0: 2020 2073 6f20 6265 7474 6572 2063 6174     so better cat
+00017bd0: 6368 2061 6e79 2065 7863 6570 7469 6f6e  ch any exception
+00017be0: 2e0a 0a20 2020 203a 7061 7261 6d20 696e  ...    :param in
+00017bf0: 747c 4e6f 6e65 206a 6f62 5f69 643a 0a20  t|None job_id:. 
+00017c00: 2020 203a 7265 7475 726e 3a20 6e75 6d5f     :return: num_
+00017c10: 7072 6f63 0a20 2020 203a 7274 7970 653a  proc.    :rtype:
+00017c20: 2069 6e74 7c4e 6f6e 650a 2020 2020 2222   int|None.    ""
+00017c30: 220a 2020 2020 6966 206e 6f74 206a 6f62  ".    if not job
+00017c40: 5f69 643a 0a20 2020 2020 2020 2069 6620  _id:.        if 
+00017c50: 6e6f 7420 6f73 2e65 6e76 6972 6f6e 2e67  not os.environ.g
+00017c60: 6574 2822 5347 455f 524f 4f54 2229 3a0a  et("SGE_ROOT"):.
+00017c70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00017c80: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+00017c90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00017ca0: 2023 2071 696e 742e 7079 206d 6967 6874   # qint.py might
+00017cb0: 206f 7665 7277 7269 7465 204a 4f42 5f49   overwrite JOB_I
+00017cc0: 4420 6275 7420 7365 7473 2053 4745 5f4a  D but sets SGE_J
+00017cd0: 4f42 5f49 4420 696e 7374 6561 642e 0a20  OB_ID instead.. 
+00017ce0: 2020 2020 2020 2020 2020 206a 6f62 5f69             job_i
+00017cf0: 6420 3d20 696e 7428 6f73 2e65 6e76 6972  d = int(os.envir
+00017d00: 6f6e 2e67 6574 2822 5347 455f 4a4f 425f  on.get("SGE_JOB_
+00017d10: 4944 2229 206f 7220 6f73 2e65 6e76 6972  ID") or os.envir
+00017d20: 6f6e 2e67 6574 2822 4a4f 425f 4944 2229  on.get("JOB_ID")
+00017d30: 206f 7220 3029 0a20 2020 2020 2020 2065   or 0).        e
+00017d40: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00017d50: 2061 7320 6578 633a 0a20 2020 2020 2020   as exc:.       
+00017d60: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+00017d70: 7469 6f6e 2822 7265 6164 5f73 6765 5f6e  tion("read_sge_n
+00017d80: 756d 5f70 726f 6373 3a20 2572 2c20 696e  um_procs: %r, in
+00017d90: 7661 6c69 6420 4a4f 425f 4944 3a20 2572  valid JOB_ID: %r
+00017da0: 2220 2520 2865 7863 2c20 6f73 2e65 6e76  " % (exc, os.env
+00017db0: 6972 6f6e 2e67 6574 2822 4a4f 425f 4944  iron.get("JOB_ID
+00017dc0: 2229 2929 0a20 2020 2020 2020 2069 6620  "))).        if 
+00017dd0: 6e6f 7420 6a6f 625f 6964 3a0a 2020 2020  not job_id:.    
+00017de0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00017df0: 6f6e 650a 2020 2020 6672 6f6d 2073 7562  one.    from sub
+00017e00: 7072 6f63 6573 7320 696d 706f 7274 2050  process import P
+00017e10: 6f70 656e 2c20 5049 5045 2c20 4361 6c6c  open, PIPE, Call
+00017e20: 6564 5072 6f63 6573 7345 7272 6f72 0a0a  edProcessError..
+00017e30: 2020 2020 7367 655f 636d 6420 3d20 5b22      sge_cmd = ["
+00017e40: 7173 7461 7422 2c20 222d 6a22 2c20 7374  qstat", "-j", st
+00017e50: 7228 6a6f 625f 6964 295d 0a20 2020 2070  r(job_id)].    p
+00017e60: 726f 6320 3d20 506f 7065 6e28 7367 655f  roc = Popen(sge_
+00017e70: 636d 642c 2073 7464 6f75 743d 5049 5045  cmd, stdout=PIPE
+00017e80: 290a 2020 2020 7374 646f 7574 2c20 5f20  ).    stdout, _ 
+00017e90: 3d20 7072 6f63 2e63 6f6d 6d75 6e69 6361  = proc.communica
+00017ea0: 7465 2829 0a20 2020 2069 6620 7072 6f63  te().    if proc
+00017eb0: 2e72 6574 7572 6e63 6f64 653a 0a20 2020  .returncode:.   
+00017ec0: 2020 2020 2072 6169 7365 2043 616c 6c65       raise Calle
+00017ed0: 6450 726f 6365 7373 4572 726f 7228 7072  dProcessError(pr
+00017ee0: 6f63 2e72 6574 7572 6e63 6f64 652c 2073  oc.returncode, s
+00017ef0: 6765 5f63 6d64 2c20 7374 646f 7574 290a  ge_cmd, stdout).
+00017f00: 2020 2020 7374 646f 7574 203d 2073 7464      stdout = std
+00017f10: 6f75 742e 6465 636f 6465 2822 7574 6638  out.decode("utf8
+00017f20: 2229 0a20 2020 206c 7320 3d20 5b0a 2020  ").    ls = [.  
+00017f30: 2020 2020 2020 6c69 6e65 5b6c 656e 2822        line[len("
+00017f40: 6861 7264 2072 6573 6f75 7263 655f 6c69  hard resource_li
+00017f50: 7374 3a22 2920 3a5d 2e73 7472 6970 2829  st:") :].strip()
+00017f60: 0a20 2020 2020 2020 2066 6f72 206c 696e  .        for lin
+00017f70: 6520 696e 2073 7464 6f75 742e 7370 6c69  e in stdout.spli
+00017f80: 746c 696e 6573 2829 0a20 2020 2020 2020  tlines().       
+00017f90: 2069 6620 6c69 6e65 2e73 7461 7274 7377   if line.startsw
+00017fa0: 6974 6828 2268 6172 6420 7265 736f 7572  ith("hard resour
+00017fb0: 6365 5f6c 6973 743a 2229 0a20 2020 205d  ce_list:").    ]
+00017fc0: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
+00017fd0: 6c73 2920 3d3d 2031 0a20 2020 206f 7074  ls) == 1.    opt
+00017fe0: 7320 3d20 6469 6374 285b 6f70 742e 7370  s = dict([opt.sp
+00017ff0: 6c69 7428 223d 222c 2031 2920 666f 7220  lit("=", 1) for 
+00018000: 6f70 7420 696e 206c 735b 305d 2e73 706c  opt in ls[0].spl
+00018010: 6974 2822 2c22 295d 2920 2023 206e 6f71  it(",")])  # noq
+00018020: 610a 2020 2020 7472 793a 0a20 2020 2020  a.    try:.     
+00018030: 2020 2072 6574 7572 6e20 696e 7428 6f70     return int(op
+00018040: 7473 5b22 6e75 6d5f 7072 6f63 225d 290a  ts["num_proc"]).
+00018050: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+00018060: 4572 726f 7220 6173 2065 7863 3a0a 2020  Error as exc:.  
+00018070: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+00018080: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+00018090: 2020 2022 7265 6164 5f73 6765 5f6e 756d     "read_sge_num
+000180a0: 5f70 726f 6373 3a20 2572 2c20 696e 7661  _procs: %r, inva
+000180b0: 6c69 6420 6e75 6d5f 7072 6f63 2025 7220  lid num_proc %r 
+000180c0: 666f 7220 6a6f 6220 6964 2025 692e 5c6e  for job id %i.\n
+000180d0: 6c69 6e65 3a20 2572 220a 2020 2020 2020  line: %r".      
+000180e0: 2020 2020 2020 2520 2865 7863 2c20 6f70        % (exc, op
+000180f0: 7473 5b22 6e75 6d5f 7072 6f63 225d 2c20  ts["num_proc"], 
+00018100: 6a6f 625f 6964 2c20 6c73 5b30 5d29 0a20  job_id, ls[0]). 
+00018110: 2020 2020 2020 2029 0a0a 0a64 6566 2067         )...def g
+00018120: 6574 5f6e 756d 6265 725f 6176 6169 6c61  et_number_availa
+00018130: 626c 655f 6370 7573 2829 3a0a 2020 2020  ble_cpus():.    
+00018140: 2222 220a 2020 2020 3a72 6574 7572 6e3a  """.    :return:
+00018150: 206e 756d 6265 7220 6f66 2061 7661 696c   number of avail
+00018160: 6162 6c65 2043 5055 732c 2069 6620 7765  able CPUs, if we
+00018170: 2063 616e 2066 6967 7572 6520 6974 206f   can figure it o
+00018180: 7574 0a20 2020 203a 7274 7970 653a 2069  ut.    :rtype: i
+00018190: 6e74 7c4e 6f6e 650a 2020 2020 2222 220a  nt|None.    """.
+000181a0: 2020 2020 6966 2068 6173 6174 7472 286f      if hasattr(o
+000181b0: 732c 2022 7363 6865 645f 6765 7461 6666  s, "sched_getaff
+000181c0: 696e 6974 7922 293a 2020 2320 5079 7468  inity"):  # Pyth
+000181d0: 6f6e 203e 3d33 2e34 0a20 2020 2020 2020  on >=3.4.       
+000181e0: 2072 6574 7572 6e20 6c65 6e28 6f73 2e73   return len(os.s
+000181f0: 6368 6564 5f67 6574 6166 6669 6e69 7479  ched_getaffinity
+00018200: 2830 2929 0a20 2020 2074 7279 3a0a 2020  (0)).    try:.  
+00018210: 2020 2020 2020 2320 6e6f 696e 7370 6563        # noinspec
+00018220: 7469 6f6e 2050 7950 6163 6b61 6765 5265  tion PyPackageRe
+00018230: 7175 6972 656d 656e 7473 2c50 7955 6e72  quirements,PyUnr
+00018240: 6573 6f6c 7665 6452 6566 6572 656e 6365  esolvedReference
+00018250: 730a 2020 2020 2020 2020 696d 706f 7274  s.        import
+00018260: 2070 7375 7469 6c0a 0a20 2020 2020 2020   psutil..       
+00018270: 2070 726f 6320 3d20 7073 7574 696c 2e50   proc = psutil.P
+00018280: 726f 6365 7373 2829 0a20 2020 2020 2020  rocess().       
+00018290: 2069 6620 6861 7361 7474 7228 7072 6f63   if hasattr(proc
+000182a0: 2c20 2263 7075 5f61 6666 696e 6974 7922  , "cpu_affinity"
+000182b0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000182c0: 6574 7572 6e20 6c65 6e28 7072 6f63 2e63  eturn len(proc.c
+000182d0: 7075 5f61 6666 696e 6974 7928 2929 0a20  pu_affinity()). 
+000182e0: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
+000182f0: 4572 726f 723a 0a20 2020 2020 2020 2070  Error:.        p
+00018300: 6173 730a 2020 2020 6966 2068 6173 6174  ass.    if hasat
+00018310: 7472 286f 732c 2022 7379 7363 6f6e 6622  tr(os, "sysconf"
+00018320: 2920 616e 6420 2253 435f 4e50 524f 4345  ) and "SC_NPROCE
+00018330: 5353 4f52 535f 4f4e 4c4e 2220 696e 206f  SSORS_ONLN" in o
+00018340: 732e 7379 7363 6f6e 665f 6e61 6d65 733a  s.sysconf_names:
+00018350: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018360: 6f73 2e73 7973 636f 6e66 2822 5343 5f4e  os.sysconf("SC_N
+00018370: 5052 4f43 4553 534f 5253 5f4f 4e4c 4e22  PROCESSORS_ONLN"
+00018380: 290a 2020 2020 6966 2068 6173 6174 7472  ).    if hasattr
+00018390: 286f 732c 2022 6370 755f 636f 756e 7422  (os, "cpu_count"
+000183a0: 293a 2020 2320 5079 7468 6f6e 203e 3d33  ):  # Python >=3
+000183b0: 2e34 0a20 2020 2020 2020 2072 6574 7572  .4.        retur
+000183c0: 6e20 6f73 2e63 7075 5f63 6f75 6e74 2829  n os.cpu_count()
+000183d0: 2020 2320 6e6f 7420 7175 6974 6520 636f    # not quite co
+000183e0: 7272 6563 743b 2074 6861 7420 6172 6520  rrect; that are 
+000183f0: 616c 6c20 696e 2074 6865 2073 7973 7465  all in the syste
+00018400: 6d0a 2020 2020 7265 7475 726e 204e 6f6e  m.    return Non
+00018410: 650a 0a0a 6465 6620 6775 6573 735f 7265  e...def guess_re
+00018420: 7175 6573 7465 645f 6d61 785f 6e75 6d5f  quested_max_num_
+00018430: 7468 7265 6164 7328 6c6f 675f 6669 6c65  threads(log_file
+00018440: 3d4e 6f6e 652c 2066 616c 6c62 6163 6b5f  =None, fallback_
+00018450: 6e75 6d5f 6370 7573 3d54 7275 6529 3a0a  num_cpus=True):.
+00018460: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+00018470: 616d 2069 6f2e 4669 6c65 206c 6f67 5f66  am io.File log_f
+00018480: 696c 653a 0a20 2020 203a 7061 7261 6d20  ile:.    :param 
+00018490: 626f 6f6c 2066 616c 6c62 6163 6b5f 6e75  bool fallback_nu
+000184a0: 6d5f 6370 7573 3a0a 2020 2020 3a72 7479  m_cpus:.    :rty
+000184b0: 7065 3a20 696e 747c 4e6f 6e65 0a20 2020  pe: int|None.   
+000184c0: 2022 2222 0a20 2020 2074 7279 3a0a 2020   """.    try:.  
+000184d0: 2020 2020 2020 7367 655f 6e75 6d5f 7072        sge_num_pr
+000184e0: 6f63 7320 3d20 7265 6164 5f73 6765 5f6e  ocs = read_sge_n
+000184f0: 756d 5f70 726f 6373 2829 0a20 2020 2065  um_procs().    e
+00018500: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00018510: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
+00018520: 6966 206c 6f67 5f66 696c 653a 0a20 2020  if log_file:.   
+00018530: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00018540: 4572 726f 7220 7768 696c 6520 6765 7474  Error while gett
+00018550: 696e 6720 5347 4520 6e75 6d5f 7072 6f63  ing SGE num_proc
+00018560: 3a20 2572 2220 2520 6578 632c 2066 696c  : %r" % exc, fil
+00018570: 653d 6c6f 675f 6669 6c65 290a 2020 2020  e=log_file).    
+00018580: 656c 7365 3a0a 2020 2020 2020 2020 6966  else:.        if
+00018590: 2073 6765 5f6e 756d 5f70 726f 6373 3a0a   sge_num_procs:.
+000185a0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000185b0: 6f67 5f66 696c 653a 0a20 2020 2020 2020  og_file:.       
+000185c0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000185d0: 5573 6520 6e75 6d5f 7468 7265 6164 733d  Use num_threads=
+000185e0: 2569 2028 6275 7420 6d69 6e20 3229 2076  %i (but min 2) v
+000185f0: 6961 2053 4745 206e 756d 5f70 726f 632e  ia SGE num_proc.
+00018600: 2220 2520 7367 655f 6e75 6d5f 7072 6f63  " % sge_num_proc
+00018610: 732c 2066 696c 653d 6c6f 675f 6669 6c65  s, file=log_file
+00018620: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00018630: 7475 726e 206d 6178 2873 6765 5f6e 756d  turn max(sge_num
+00018640: 5f70 726f 6373 2c20 3229 0a20 2020 206f  _procs, 2).    o
+00018650: 6d70 5f6e 756d 5f74 6872 6561 6473 203d  mp_num_threads =
+00018660: 2069 6e74 286f 732e 656e 7669 726f 6e2e   int(os.environ.
+00018670: 6765 7428 224f 4d50 5f4e 554d 5f54 4852  get("OMP_NUM_THR
+00018680: 4541 4453 2229 206f 7220 3029 0a20 2020  EADS") or 0).   
+00018690: 2069 6620 6f6d 705f 6e75 6d5f 7468 7265   if omp_num_thre
+000186a0: 6164 733a 0a20 2020 2020 2020 2023 204d  ads:.        # M
+000186b0: 696e 696d 756d 206f 6620 3220 7468 7265  inimum of 2 thre
+000186c0: 6164 732c 2073 686f 756c 6420 6e6f 7420  ads, should not 
+000186d0: 6875 7274 2e0a 2020 2020 2020 2020 6966  hurt..        if
+000186e0: 206c 6f67 5f66 696c 653a 0a20 2020 2020   log_file:.     
+000186f0: 2020 2020 2020 2070 7269 6e74 2822 5573         print("Us
+00018700: 6520 6e75 6d5f 7468 7265 6164 733d 2569  e num_threads=%i
+00018710: 2028 6275 7420 6d69 6e20 3229 2076 6961   (but min 2) via
+00018720: 204f 4d50 5f4e 554d 5f54 4852 4541 4453   OMP_NUM_THREADS
+00018730: 2e22 2025 206f 6d70 5f6e 756d 5f74 6872  ." % omp_num_thr
+00018740: 6561 6473 2c20 6669 6c65 3d6c 6f67 5f66  eads, file=log_f
+00018750: 696c 6529 0a20 2020 2020 2020 2072 6574  ile).        ret
+00018760: 7572 6e20 6d61 7828 6f6d 705f 6e75 6d5f  urn max(omp_num_
+00018770: 7468 7265 6164 732c 2032 290a 2020 2020  threads, 2).    
+00018780: 6966 2066 616c 6c62 6163 6b5f 6e75 6d5f  if fallback_num_
+00018790: 6370 7573 3a0a 2020 2020 2020 2020 7265  cpus:.        re
+000187a0: 7475 726e 2067 6574 5f6e 756d 6265 725f  turn get_number_
+000187b0: 6176 6169 6c61 626c 655f 6370 7573 2829  available_cpus()
+000187c0: 0a20 2020 2072 6574 7572 6e20 4e6f 6e65  .    return None
+000187d0: 0a0a 0a54 6865 616e 6f46 6c61 6773 203d  ...TheanoFlags =
+000187e0: 207b 0a20 2020 206b 6579 3a20 7661 6c75   {.    key: valu
+000187f0: 6520 666f 7220 286b 6579 2c20 7661 6c75  e for (key, valu
+00018800: 6529 2069 6e20 5b73 2e73 706c 6974 2822  e) in [s.split("
+00018810: 3d22 2c20 3129 2066 6f72 2073 2069 6e20  =", 1) for s in 
+00018820: 6f73 2e65 6e76 6972 6f6e 2e67 6574 2822  os.environ.get("
+00018830: 5448 4541 4e4f 5f46 4c41 4753 222c 2022  THEANO_FLAGS", "
+00018840: 2229 2e73 706c 6974 2822 2c22 2920 6966  ").split(",") if
+00018850: 2073 5d0a 7d0a 0a0a 6465 6620 5f63 6f6e   s].}...def _con
+00018860: 7369 6465 725f 6368 6563 6b5f 666f 725f  sider_check_for_
+00018870: 6770 7528 293a 0a20 2020 2022 2222 0a20  gpu():.    """. 
+00018880: 2020 2054 6865 7265 2061 7265 2063 6173     There are cas
+00018890: 6573 2077 6865 7265 206e 7669 6469 612d  es where nvidia-
+000188a0: 736d 6920 636f 756c 6420 6861 6e67 2e0a  smi could hang..
+000188b0: 2020 2020 2841 6e79 2072 6561 6420 6f66      (Any read of
+000188c0: 202f 7072 6f63 2f6d 6f64 756c 6573 206d   /proc/modules m
+000188d0: 6967 6874 2068 616e 6720 696e 2074 6861  ight hang in tha
+000188e0: 7420 6361 7365 2c20 6d61 7962 6520 6361  t case, maybe ca
+000188f0: 7573 6564 0a20 2020 2020 6279 2074 7279  used.     by try
+00018900: 696e 6720 746f 2060 6d6f 6470 726f 6265  ing to `modprobe
+00018910: 206e 7669 6469 6160 2074 6f20 6368 6563   nvidia` to chec
+00018920: 6b20 6966 2074 6865 7265 2069 7320 6120  k if there is a 
+00018930: 4e76 6964 6961 2063 6172 642e 290a 2020  Nvidia card.).  
+00018940: 2020 5468 6973 2073 6f6d 6574 696d 6573    This sometimes
+00018950: 2068 6170 7065 6e73 2069 6e20 6f75 7220   happens in our 
+00018960: 5347 4520 636c 7573 7465 7220 6f6e 206e  SGE cluster on n
+00018970: 6f64 6573 2077 6974 686f 7574 204e 7669  odes without Nvi
+00018980: 6469 6120 6361 7264 732e 0a20 2020 204d  dia cards..    M
+00018990: 6179 6265 2069 7427 7320 616c 736f 2061  aybe it's also a
+000189a0: 204c 696e 7578 204b 6572 6e65 6c20 6275   Linux Kernel bu
+000189b0: 672e 0a20 2020 2041 6e79 7761 792c 206a  g..    Anyway, j
+000189c0: 7573 7420 6176 6f69 6420 616e 7920 7375  ust avoid any su
+000189d0: 6368 2063 6865 636b 2069 6620 7765 2064  ch check if we d
+000189e0: 6f6e 2774 2061 736b 6564 2066 6f72 2061  on't asked for a
+000189f0: 2047 5055 2e0a 0a20 2020 203a 7274 7970   GPU...    :rtyp
+00018a00: 653a 2062 6f6f 6c0a 2020 2020 2222 220a  e: bool.    """.
+00018a10: 2020 2020 6966 2022 6465 7669 6365 2220      if "device" 
+00018a20: 696e 2054 6865 616e 6f46 6c61 6773 3a0a  in TheanoFlags:.
+00018a30: 2020 2020 2020 2020 6465 7620 3d20 5468          dev = Th
+00018a40: 6561 6e6f 466c 6167 735b 2264 6576 6963  eanoFlags["devic
+00018a50: 6522 5d0a 2020 2020 2020 2020 6966 2064  e"].        if d
+00018a60: 6576 2e73 7461 7274 7377 6974 6828 2267  ev.startswith("g
+00018a70: 7075 2229 206f 7220 6465 762e 7374 6172  pu") or dev.star
+00018a80: 7473 7769 7468 2822 6375 6461 2229 3a0a  tswith("cuda"):.
+00018a90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018aa0: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+00018ab0: 2320 5448 4541 4e4f 5f46 4c41 4753 2077  # THEANO_FLAGS w
+00018ac0: 696c 6c20 6f76 6572 7772 6974 6520 7468  ill overwrite th
+00018ad0: 6973 2063 6f6e 6669 6720 6f70 7469 6f6e  is config option
+00018ae0: 2e20 5365 6520 726e 6e2e 696e 6974 4465  . See rnn.initDe
+00018af0: 7669 6365 7328 292e 0a20 2020 2020 2020  vices()..       
+00018b00: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00018b10: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
+00018b20: 2050 7942 726f 6164 4578 6365 7074 696f   PyBroadExceptio
+00018b30: 6e0a 2020 2020 7472 793a 0a20 2020 2020  n.    try:.     
+00018b40: 2020 2066 726f 6d20 7265 7475 726e 6e2e     from returnn.
+00018b50: 636f 6e66 6967 2069 6d70 6f72 7420 6765  config import ge
+00018b60: 745f 676c 6f62 616c 5f63 6f6e 6669 670a  t_global_config.
+00018b70: 0a20 2020 2020 2020 2063 6f6e 6669 6720  .        config 
+00018b80: 3d20 6765 745f 676c 6f62 616c 5f63 6f6e  = get_global_con
+00018b90: 6669 6728 290a 2020 2020 6578 6365 7074  fig().    except
+00018ba0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00018bb0: 2020 2020 636f 6e66 6967 203d 204e 6f6e      config = Non
+00018bc0: 650a 2020 2020 6966 2063 6f6e 6669 673a  e.    if config:
+00018bd0: 0a20 2020 2020 2020 2066 6f72 2064 6576  .        for dev
+00018be0: 2069 6e20 636f 6e66 6967 2e6c 6973 7428   in config.list(
+00018bf0: 2264 6576 6963 6522 2c20 5b5d 293a 0a20  "device", []):. 
+00018c00: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+00018c10: 762e 7374 6172 7473 7769 7468 2822 6770  v.startswith("gp
+00018c20: 7522 2920 6f72 2064 6576 2e73 7461 7274  u") or dev.start
+00018c30: 7377 6974 6828 2263 7564 6122 293a 0a20  swith("cuda"):. 
+00018c40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018c50: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
+00018c60: 2020 2020 2020 2069 6620 6465 7620 3d3d         if dev ==
+00018c70: 2022 616c 6c22 3a0a 2020 2020 2020 2020   "all":.        
+00018c80: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00018c90: 7275 650a 2020 2020 7265 7475 726e 2046  rue.    return F
+00018ca0: 616c 7365 0a0a 0a64 6566 2067 6574 5f67  alse...def get_g
+00018cb0: 7075 5f6e 616d 6573 2829 3a0a 2020 2020  pu_names():.    
+00018cc0: 2222 220a 2020 2020 3a72 7479 7065 3a20  """.    :rtype: 
+00018cd0: 6c69 7374 5b73 7472 5d0a 2020 2020 2222  list[str].    ""
+00018ce0: 220a 2020 2020 6966 206e 6f74 205f 636f  ".    if not _co
+00018cf0: 6e73 6964 6572 5f63 6865 636b 5f66 6f72  nsider_check_for
+00018d00: 5f67 7075 2829 3a0a 2020 2020 2020 2020  _gpu():.        
+00018d10: 7265 7475 726e 205b 5d0a 2020 2020 6966  return [].    if
+00018d20: 206f 732e 6e61 6d65 203d 3d20 226e 7422   os.name == "nt"
+00018d30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00018d40: 2022 4765 466f 7263 6520 4754 5820 3737   "GeForce GTX 77
+00018d50: 3022 2020 2320 544f 444f 0a20 2020 2065  0"  # TODO.    e
+00018d60: 6c69 6620 7379 732e 706c 6174 666f 726d  lif sys.platform
+00018d70: 203d 3d20 2264 6172 7769 6e22 3a0a 2020   == "darwin":.  
+00018d80: 2020 2020 2020 2320 544f 444f 2070 6172        # TODO par
+00018d90: 7365 2076 6961 2078 6d6c 206f 7574 7075  se via xml outpu
+00018da0: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
+00018db0: 2073 7973 5f63 6d64 5f6f 7574 5f6c 696e   sys_cmd_out_lin
+00018dc0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00018dd0: 2273 7973 7465 6d5f 7072 6f66 696c 6572  "system_profiler
+00018de0: 2053 5044 6973 706c 6179 7344 6174 6154   SPDisplaysDataT
+00018df0: 7970 6520 7c20 220a 2020 2020 2020 2020  ype | ".        
+00018e00: 2020 2020 2267 7265 7020 2743 6869 7073      "grep 'Chips
+00018e10: 6574 204d 6f64 656c 3a20 4e56 4944 4941  et Model: NVIDIA
+00018e20: 2720 7c20 220a 2020 2020 2020 2020 2020  ' | ".          
+00018e30: 2020 2273 6564 2027 732f 2e2a 4368 6970    "sed 's/.*Chip
+00018e40: 7365 7420 4d6f 6465 6c3a 204e 5649 4449  set Model: NVIDI
+00018e50: 4120 2a2f 2f3b 732f 202a 242f 2f27 220a  A *//;s/ *$//'".
+00018e60: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
+00018e70: 7365 3a0a 2020 2020 2020 2020 7472 793a  se:.        try:
+00018e80: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00018e90: 7572 6e20 7379 735f 636d 645f 6f75 745f  urn sys_cmd_out_
+00018ea0: 6c69 6e65 7328 226e 7669 6469 612d 736d  lines("nvidia-sm
+00018eb0: 6920 2d4c 207c 2063 7574 202d 6420 2728  i -L | cut -d '(
+00018ec0: 2720 2d66 2031 207c 2063 7574 202d 6420  ' -f 1 | cut -d 
+00018ed0: 2720 2720 2d66 2033 2d20 7c20 7365 6420  ' ' -f 3- | sed 
+00018ee0: 2d65 2027 732f 5c5c 2024 2f2f 2722 290a  -e 's/\\ $//'").
+00018ef0: 2020 2020 2020 2020 6578 6365 7074 2043          except C
+00018f00: 616c 6c65 6450 726f 6365 7373 4572 726f  alledProcessErro
+00018f10: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
+00018f20: 6574 7572 6e20 5b5d 0a0a 0a64 6566 205f  eturn []...def _
+00018f30: 6765 745f 6e75 6d5f 6770 755f 6465 7669  get_num_gpu_devi
+00018f40: 6365 7328 293a 0a20 2020 2022 2222 0a20  ces():.    """. 
+00018f50: 2020 203a 7265 7475 726e 3a20 6370 752c     :return: cpu,
+00018f60: 6770 750a 2020 2020 3a72 7479 7065 3a20  gpu.    :rtype: 
+00018f70: 2869 6e74 2c69 6e74 290a 2020 2020 2222  (int,int).    ""
+00018f80: 220a 2020 2020 6966 206f 732e 6e61 6d65  ".    if os.name
+00018f90: 203d 3d20 226e 7422 3a0a 2020 2020 2020   == "nt":.      
+00018fa0: 2020 7265 7475 726e 2031 2c20 3120 2023    return 1, 1  #
+00018fb0: 2054 4f44 4f0a 2020 2020 656c 6966 2073   TODO.    elif s
+00018fc0: 7973 2e70 6c61 7466 6f72 6d20 3d3d 2022  ys.platform == "
+00018fd0: 6461 7277 696e 223a 0a20 2020 2020 2020  darwin":.       
+00018fe0: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
+00018ff0: 2020 2020 2020 696e 7428 7379 735f 636d        int(sys_cm
+00019000: 645f 6f75 745f 6c69 6e65 7328 2273 7973  d_out_lines("sys
+00019010: 6374 6c20 2d61 207c 2067 7265 7020 6d61  ctl -a | grep ma
+00019020: 6368 6465 702e 6370 752e 636f 7265 5f63  chdep.cpu.core_c
+00019030: 6f75 6e74 207c 2061 776b 2027 7b70 7269  ount | awk '{pri
+00019040: 6e74 2024 327d 2722 295b 305d 292c 0a20  nt $2}'")[0]),. 
+00019050: 2020 2020 2020 2020 2020 206c 656e 2873             len(s
+00019060: 7973 5f63 6d64 5f6f 7574 5f6c 696e 6573  ys_cmd_out_lines
+00019070: 2822 7379 7374 656d 5f70 726f 6669 6c65  ("system_profile
+00019080: 7220 5350 4469 7370 6c61 7973 4461 7461  r SPDisplaysData
+00019090: 5479 7065 207c 2067 7265 7020 2743 6869  Type | grep 'Chi
+000190a0: 7073 6574 204d 6f64 656c 3a20 4e56 4944  pset Model: NVID
+000190b0: 4941 2720 7c20 6361 7422 2929 2c0a 2020  IA' | cat")),.  
+000190c0: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
+000190d0: 3a0a 2020 2020 2020 2020 6e75 6d5f 6370  :.        num_cp
+000190e0: 7573 203d 206c 656e 2873 7973 5f63 6d64  us = len(sys_cmd
+000190f0: 5f6f 7574 5f6c 696e 6573 2822 6361 7420  _out_lines("cat 
+00019100: 2f70 726f 632f 6370 7569 6e66 6f20 7c20  /proc/cpuinfo | 
+00019110: 6772 6570 2070 726f 6365 7373 6f72 2229  grep processor")
+00019120: 2920 6f72 2031 0a20 2020 2020 2020 206e  ) or 1.        n
+00019130: 756d 5f67 7075 7320 3d20 300a 2020 2020  um_gpus = 0.    
+00019140: 2020 2020 6966 205f 636f 6e73 6964 6572      if _consider
+00019150: 5f63 6865 636b 5f66 6f72 5f67 7075 2829  _check_for_gpu()
+00019160: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00019170: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00019180: 2020 206e 756d 5f67 7075 7320 3d20 6c65     num_gpus = le
+00019190: 6e28 7379 735f 636d 645f 6f75 745f 6c69  n(sys_cmd_out_li
+000191a0: 6e65 7328 226e 7669 6469 612d 736d 6920  nes("nvidia-smi 
+000191b0: 2d4c 2229 290a 2020 2020 2020 2020 2020  -L")).          
+000191c0: 2020 6578 6365 7074 2043 616c 6c65 6450    except CalledP
+000191d0: 726f 6365 7373 4572 726f 723a 0a20 2020  rocessError:.   
+000191e0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+000191f0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00019200: 206e 756d 5f63 7075 732c 206e 756d 5f67   num_cpus, num_g
+00019210: 7075 730a 0a0a 5f6e 756d 5f64 6576 6963  pus..._num_devic
+00019220: 6573 203d 204e 6f6e 650a 0a0a 6465 6620  es = None...def 
+00019230: 6765 745f 6e75 6d5f 6770 755f 6465 7669  get_num_gpu_devi
+00019240: 6365 7328 293a 0a20 2020 2022 2222 0a20  ces():.    """. 
+00019250: 2020 203a 7265 7475 726e 3a20 2863 7075     :return: (cpu
+00019260: 2063 6f75 6e74 2c20 6770 7520 636f 756e   count, gpu coun
+00019270: 7429 0a20 2020 203a 7274 7970 653a 2028  t).    :rtype: (
+00019280: 696e 742c 2069 6e74 290a 2020 2020 2222  int, int).    ""
+00019290: 220a 2020 2020 676c 6f62 616c 205f 6e75  ".    global _nu
+000192a0: 6d5f 6465 7669 6365 730a 2020 2020 6966  m_devices.    if
+000192b0: 205f 6e75 6d5f 6465 7669 6365 7320 6973   _num_devices is
+000192c0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000192d0: 2020 2072 6574 7572 6e20 5f6e 756d 5f64     return _num_d
+000192e0: 6576 6963 6573 0a20 2020 205f 6e75 6d5f  evices.    _num_
+000192f0: 6465 7669 6365 7320 3d20 5f67 6574 5f6e  devices = _get_n
+00019300: 756d 5f67 7075 5f64 6576 6963 6573 2829  um_gpu_devices()
+00019310: 0a20 2020 2072 6574 7572 6e20 5f6e 756d  .    return _num
+00019320: 5f64 6576 6963 6573 0a0a 0a64 6566 2068  _devices...def h
+00019330: 6176 655f 6770 7528 293a 0a20 2020 2022  ave_gpu():.    "
+00019340: 2222 0a20 2020 203a 7274 7970 653a 2062  "".    :rtype: b
+00019350: 6f6f 6c0a 2020 2020 2222 220a 2020 2020  ool.    """.    
+00019360: 6370 7573 2c20 6770 7573 203d 2067 6574  cpus, gpus = get
+00019370: 5f6e 756d 5f67 7075 5f64 6576 6963 6573  _num_gpu_devices
+00019380: 2829 0a20 2020 2072 6574 7572 6e20 6770  ().    return gp
+00019390: 7573 203e 2030 0a0a 0a64 6566 2074 7279  us > 0...def try
+000193a0: 5f61 6e64 5f69 676e 6f72 655f 6578 6365  _and_ignore_exce
+000193b0: 7074 696f 6e28 6629 3a0a 2020 2020 2222  ption(f):.    ""
+000193c0: 220a 2020 2020 4361 6c6c 7320 6060 6660  ".    Calls ``f`
+000193d0: 602c 2061 6e64 2069 676e 6f72 6573 2061  `, and ignores a
+000193e0: 6e79 2065 7863 6570 7469 6f6e 2e0a 0a20  ny exception... 
+000193f0: 2020 203a 7061 7261 6d20 2829 2d3e 5420     :param ()->T 
+00019400: 663a 0a20 2020 203a 7265 7475 726e 3a20  f:.    :return: 
+00019410: 7768 6174 6576 6572 2060 6066 6060 2072  whatever ``f`` r
+00019420: 6574 7572 6e73 2c20 6f72 204e 6f6e 650a  eturns, or None.
+00019430: 2020 2020 3a72 7479 7065 3a20 547c 4e6f      :rtype: T|No
+00019440: 6e65 0a20 2020 2022 2222 0a20 2020 2074  ne.    """.    t
+00019450: 7279 3a0a 2020 2020 2020 2020 7265 7475  ry:.        retu
+00019460: 726e 2066 2829 0a20 2020 2065 7863 6570  rn f().    excep
+00019470: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00019480: 7863 3a0a 2020 2020 2020 2020 7072 696e  xc:.        prin
+00019490: 7428 2274 7279 5f61 6e64 5f69 676e 6f72  t("try_and_ignor
+000194a0: 655f 6578 6365 7074 696f 6e3a 2025 7220  e_exception: %r 
+000194b0: 6661 696c 6564 3a20 2573 2220 2520 2866  failed: %s" % (f
+000194c0: 2c20 6578 6329 290a 2020 2020 2020 2020  , exc)).        
+000194d0: 7379 732e 6578 6365 7074 686f 6f6b 282a  sys.excepthook(*
+000194e0: 7379 732e 6578 635f 696e 666f 2829 290a  sys.exc_info()).
+000194f0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00019500: 6f6e 650a 0a0a 6465 6620 7472 795f 6765  one...def try_ge
+00019510: 745f 7374 6163 6b5f 6672 616d 6528 6465  t_stack_frame(de
+00019520: 7074 683d 3129 3a0a 2020 2020 2222 220a  pth=1):.    """.
+00019530: 2020 2020 3a70 6172 616d 2069 6e74 2064      :param int d
+00019540: 6570 7468 3a0a 2020 2020 3a72 7479 7065  epth:.    :rtype
+00019550: 3a20 7479 7065 732e 4672 616d 6554 7970  : types.FrameTyp
+00019560: 657c 4e6f 6e65 0a20 2020 203a 7265 7475  e|None.    :retu
+00019570: 726e 3a20 6361 6c6c 6572 2066 756e 6374  rn: caller funct
+00019580: 696f 6e20 6e61 6d65 2e20 7468 6973 2069  ion name. this i
+00019590: 7320 6a75 7374 2066 6f72 2064 6562 7567  s just for debug
+000195a0: 6769 6e67 0a20 2020 2022 2222 0a20 2020  ging.    """.   
+000195b0: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
+000195c0: 5079 4272 6f61 6445 7863 6570 7469 6f6e  PyBroadException
+000195d0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+000195e0: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
+000195f0: 2050 7950 726f 7465 6374 6564 4d65 6d62   PyProtectedMemb
+00019600: 6572 2c50 7955 6e72 6573 6f6c 7665 6452  er,PyUnresolvedR
+00019610: 6566 6572 656e 6365 730a 2020 2020 2020  eferences.      
+00019620: 2020 6672 616d 6520 3d20 7379 732e 5f67    frame = sys._g
+00019630: 6574 6672 616d 6528 6465 7074 6820 2b20  etframe(depth + 
+00019640: 3129 2020 2320 6f6e 6520 6d6f 7265 2074  1)  # one more t
+00019650: 6f20 636f 756e 7420 6f75 7273 656c 7665  o count ourselve
+00019660: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00019670: 2066 7261 6d65 0a20 2020 2065 7863 6570   frame.    excep
+00019680: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+00019690: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+000196a0: 0a0a 0a64 6566 2074 7279 5f67 6574 5f63  ...def try_get_c
+000196b0: 616c 6c65 725f 6e61 6d65 2864 6570 7468  aller_name(depth
+000196c0: 3d31 2c20 6661 6c6c 6261 636b 3d4e 6f6e  =1, fallback=Non
+000196d0: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+000196e0: 3a70 6172 616d 2069 6e74 2064 6570 7468  :param int depth
+000196f0: 3a0a 2020 2020 3a70 6172 616d 2073 7472  :.    :param str
+00019700: 7c4e 6f6e 6520 6661 6c6c 6261 636b 3a20  |None fallback: 
+00019710: 7468 6973 2069 7320 7265 7475 726e 6564  this is returned
+00019720: 2069 6620 7765 2066 6169 6c20 666f 7220   if we fail for 
+00019730: 736f 6d65 2072 6561 736f 6e0a 2020 2020  some reason.    
+00019740: 3a72 7479 7065 3a20 7374 727c 4e6f 6e65  :rtype: str|None
+00019750: 0a20 2020 203a 7265 7475 726e 3a20 6361  .    :return: ca
+00019760: 6c6c 6572 2066 756e 6374 696f 6e20 6e61  ller function na
+00019770: 6d65 2e20 7468 6973 2069 7320 6a75 7374  me. this is just
+00019780: 2066 6f72 2064 6562 7567 6769 6e67 0a20   for debugging. 
+00019790: 2020 2022 2222 0a20 2020 2066 7261 6d65     """.    frame
+000197a0: 203d 2074 7279 5f67 6574 5f73 7461 636b   = try_get_stack
+000197b0: 5f66 7261 6d65 2864 6570 7468 202b 2031  _frame(depth + 1
+000197c0: 2920 2023 206f 6e65 206d 6f72 6520 746f  )  # one more to
+000197d0: 2063 6f75 6e74 206f 7572 7365 6c76 6573   count ourselves
+000197e0: 0a20 2020 2069 6620 6672 616d 653a 0a20  .    if frame:. 
+000197f0: 2020 2020 2020 2066 726f 6d20 2e62 6574         from .bet
+00019800: 7465 725f 6578 6368 6f6f 6b20 696d 706f  ter_exchook impo
+00019810: 7274 2067 6574 5f66 756e 635f 7374 725f  rt get_func_str_
+00019820: 6672 6f6d 5f63 6f64 655f 6f62 6a65 6374  from_code_object
+00019830: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00019840: 2067 6574 5f66 756e 635f 7374 725f 6672   get_func_str_fr
+00019850: 6f6d 5f63 6f64 655f 6f62 6a65 6374 2866  om_code_object(f
+00019860: 7261 6d65 2e66 5f63 6f64 6529 0a20 2020  rame.f_code).   
+00019870: 2072 6574 7572 6e20 6661 6c6c 6261 636b   return fallback
+00019880: 0a0a 0a63 6c61 7373 2049 6e66 696e 6974  ...class Infinit
+00019890: 6552 6563 7572 7369 6f6e 4465 7465 6374  eRecursionDetect
+000198a0: 6564 2845 7863 6570 7469 6f6e 293a 0a20  ed(Exception):. 
+000198b0: 2020 2022 2222 0a20 2020 2052 6169 7365     """.    Raise
+000198c0: 6420 7768 656e 2061 6e20 696e 6669 6e69  d when an infini
+000198d0: 7465 2072 6563 7572 7369 6f6e 2069 7320  te recursion is 
+000198e0: 6465 7465 6374 6564 2c20 6279 2067 7561  detected, by gua
+000198f0: 7264 5f69 6e66 696e 6974 655f 7265 6375  rd_infinite_recu
+00019900: 7273 696f 6e2e 0a20 2020 2022 2222 0a0a  rsion..    """..
+00019910: 0a5f 6775 6172 645f 696e 6669 6e69 7465  ._guard_infinite
+00019920: 5f72 6563 7572 7369 6f6e 5f63 6163 6865  _recursion_cache
+00019930: 203d 2074 6872 6561 6469 6e67 2e6c 6f63   = threading.loc
+00019940: 616c 2829 0a0a 0a40 636f 6e74 6578 746c  al()...@contextl
+00019950: 6962 2e63 6f6e 7465 7874 6d61 6e61 6765  ib.contextmanage
+00019960: 720a 6465 6620 6775 6172 645f 696e 6669  r.def guard_infi
+00019970: 6e69 7465 5f72 6563 7572 7369 6f6e 282a  nite_recursion(*
+00019980: 6172 6773 293a 0a20 2020 2022 2222 0a20  args):.    """. 
+00019990: 2020 2052 6567 6973 7465 7273 2061 7267     Registers arg
+000199a0: 7320 2863 6f75 6c64 2062 6520 6675 6e63  s (could be func
+000199b0: 202b 2061 7267 7329 2069 6e20 736f 6d65   + args) in some
+000199c0: 2063 6163 6865 2e0a 2020 2020 4966 2074   cache..    If t
+000199d0: 686f 7365 2061 7267 7320 6172 6520 616c  hose args are al
+000199e0: 7265 6164 7920 696e 2074 6865 2063 6163  ready in the cac
+000199f0: 6865 2c20 6974 2077 696c 6c20 7261 6973  he, it will rais
+00019a00: 6520 616e 2065 7863 6570 7469 6f6e 2e0a  e an exception..
+00019a10: 0a20 2020 2049 7420 7769 6c6c 2075 7365  .    It will use
+00019a20: 2074 6865 2069 6420 6f66 2074 6865 2061   the id of the a
+00019a30: 7267 7320 6173 206b 6579 2061 6e64 206e  rgs as key and n
+00019a40: 6f74 2075 7365 2061 6e79 2068 6173 6869  ot use any hashi
+00019a50: 6e67 0a20 2020 2074 6f20 616c 6c6f 7720  ng.    to allow 
+00019a60: 7468 6174 2067 7561 7264 5f69 6e66 696e  that guard_infin
+00019a70: 6974 655f 7265 6375 7273 696f 6e20 6361  ite_recursion ca
+00019a80: 6e20 6265 2075 7365 640a 2020 2020 746f  n be used.    to
+00019a90: 2067 7561 7264 2063 7573 746f 6d20 5f5f   guard custom __
+00019aa0: 6861 7368 5f5f 2069 6d70 6c65 6d65 6e74  hash__ implement
+00019ab0: 6174 696f 6e73 2061 7320 7765 6c6c 2e0a  ations as well..
+00019ac0: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
+00019ad0: 6f74 2061 7267 733a 0a20 2020 2020 2020  ot args:.       
+00019ae0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00019af0: 7228 2267 7561 7264 5f69 6e66 696e 6974  r("guard_infinit
+00019b00: 655f 7265 6375 7273 696f 6e20 6e65 6564  e_recursion need
+00019b10: 7320 6174 206c 6561 7374 206f 6e65 2061  s at least one a
+00019b20: 7267 2229 0a20 2020 206b 6579 203d 2074  rg").    key = t
+00019b30: 7570 6c65 2869 6428 6172 6729 2066 6f72  uple(id(arg) for
+00019b40: 2061 7267 2069 6e20 6172 6773 290a 2020   arg in args).  
+00019b50: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00019b60: 285f 6775 6172 645f 696e 6669 6e69 7465  (_guard_infinite
+00019b70: 5f72 6563 7572 7369 6f6e 5f63 6163 6865  _recursion_cache
+00019b80: 2c20 2263 6163 6865 2229 3a0a 2020 2020  , "cache"):.    
+00019b90: 2020 2020 5f67 7561 7264 5f69 6e66 696e      _guard_infin
+00019ba0: 6974 655f 7265 6375 7273 696f 6e5f 6361  ite_recursion_ca
+00019bb0: 6368 652e 6361 6368 6520 3d20 7365 7428  che.cache = set(
+00019bc0: 290a 2020 2020 6966 206b 6579 2069 6e20  ).    if key in 
+00019bd0: 5f67 7561 7264 5f69 6e66 696e 6974 655f  _guard_infinite_
+00019be0: 7265 6375 7273 696f 6e5f 6361 6368 652e  recursion_cache.
+00019bf0: 6361 6368 653a 0a20 2020 2020 2020 2072  cache:.        r
+00019c00: 6169 7365 2049 6e66 696e 6974 6552 6563  aise InfiniteRec
+00019c10: 7572 7369 6f6e 4465 7465 6374 6564 2822  ursionDetected("
+00019c20: 696e 6669 6e69 7465 2072 6563 7572 7369  infinite recursi
+00019c30: 6f6e 2064 6574 6563 7465 6422 290a 2020  on detected").  
+00019c40: 2020 5f67 7561 7264 5f69 6e66 696e 6974    _guard_infinit
+00019c50: 655f 7265 6375 7273 696f 6e5f 6361 6368  e_recursion_cach
+00019c60: 652e 6361 6368 652e 6164 6428 6b65 7929  e.cache.add(key)
+00019c70: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00019c80: 2020 7969 656c 640a 2020 2020 6669 6e61    yield.    fina
+00019c90: 6c6c 793a 0a20 2020 2020 2020 205f 6775  lly:.        _gu
+00019ca0: 6172 645f 696e 6669 6e69 7465 5f72 6563  ard_infinite_rec
+00019cb0: 7572 7369 6f6e 5f63 6163 6865 2e63 6163  ursion_cache.cac
+00019cc0: 6865 2e72 656d 6f76 6528 6b65 7929 0a0a  he.remove(key)..
+00019cd0: 0a64 6566 2063 616d 656c 5f63 6173 655f  .def camel_case_
+00019ce0: 746f 5f73 6e61 6b65 5f63 6173 6528 6e61  to_snake_case(na
+00019cf0: 6d65 293a 0a20 2020 2022 2222 0a20 2020  me):.    """.   
+00019d00: 203a 7061 7261 6d20 7374 7220 6e61 6d65   :param str name
+00019d10: 3a20 652e 672e 2022 4361 6d65 6c43 6173  : e.g. "CamelCas
+00019d20: 6522 0a20 2020 203a 7265 7475 726e 3a20  e".    :return: 
+00019d30: 652e 672e 2022 6361 6d65 6c5f 6361 7365  e.g. "camel_case
+00019d40: 220a 2020 2020 3a72 7479 7065 3a20 7374  ".    :rtype: st
+00019d50: 720a 2020 2020 2222 220a 2020 2020 7331  r.    """.    s1
+00019d60: 203d 2072 652e 7375 6228 2228 2e29 285b   = re.sub("(.)([
+00019d70: 412d 5a5d 5b61 2d7a 5d2b 2922 2c20 7222  A-Z][a-z]+)", r"
+00019d80: 5c31 5f5c 3222 2c20 6e61 6d65 290a 2020  \1_\2", name).  
+00019d90: 2020 7265 7475 726e 2072 652e 7375 6228    return re.sub(
+00019da0: 2228 5b61 2d7a 302d 395d 2928 5b41 2d5a  "([a-z0-9])([A-Z
+00019db0: 5d29 222c 2072 225c 315f 5c32 222c 2073  ])", r"\1_\2", s
+00019dc0: 3129 2e6c 6f77 6572 2829 0a0a 0a64 6566  1).lower()...def
+00019dd0: 2067 6574 5f68 6f73 746e 616d 6528 293a   get_hostname():
+00019de0: 0a20 2020 2022 2222 0a20 2020 203a 7265  .    """.    :re
+00019df0: 7475 726e 3a20 652e 672e 2022 636c 7573  turn: e.g. "clus
+00019e00: 7465 722d 636e 2d32 3131 220a 2020 2020  ter-cn-211".    
+00019e10: 3a72 7479 7065 3a20 7374 720a 2020 2020  :rtype: str.    
+00019e20: 2222 220a 2020 2020 2320 6368 6563 6b5f  """.    # check_
+00019e30: 6f75 7470 7574 285b 2268 6f73 746e 616d  output(["hostnam
+00019e40: 6522 5d29 2e73 7472 6970 2829 2e64 6563  e"]).strip().dec
+00019e50: 6f64 6528 2275 7466 3822 290a 2020 2020  ode("utf8").    
+00019e60: 696d 706f 7274 2073 6f63 6b65 740a 0a20  import socket.. 
+00019e70: 2020 2072 6574 7572 6e20 736f 636b 6574     return socket
+00019e80: 2e67 6574 686f 7374 6e61 6d65 2829 0a0a  .gethostname()..
+00019e90: 0a64 6566 2069 735f 7275 6e6e 696e 675f  .def is_running_
+00019ea0: 6f6e 5f63 6c75 7374 6572 2829 3a0a 2020  on_cluster():.  
+00019eb0: 2020 2222 220a 2020 2020 3a72 6574 7572    """.    :retur
+00019ec0: 6e3a 2069 3620 7370 6563 6966 6963 2e20  n: i6 specific. 
+00019ed0: 5768 6574 6865 7220 7765 2072 756e 206f  Whether we run o
+00019ee0: 6e20 736f 6d65 206f 6620 7468 6520 636c  n some of the cl
+00019ef0: 7573 7465 7220 6e6f 6465 732e 0a20 2020  uster nodes..   
+00019f00: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+00019f10: 2020 2222 220a 2020 2020 7265 7475 726e    """.    return
+00019f20: 2067 6574 5f68 6f73 746e 616d 6528 292e   get_hostname().
+00019f30: 7374 6172 7473 7769 7468 2822 636c 7573  startswith("clus
+00019f40: 7465 722d 636e 2d22 2920 6f72 2067 6574  ter-cn-") or get
+00019f50: 5f68 6f73 746e 616d 6528 292e 7374 6172  _hostname().star
+00019f60: 7473 7769 7468 2822 636e 2d22 290a 0a0a  tswith("cn-")...
+00019f70: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
+00019f80: 652e 7469 6d65 2829 0a0a 0a64 6566 2067  e.time()...def g
+00019f90: 6574 5f75 7463 5f73 7461 7274 5f74 696d  et_utc_start_tim
+00019fa0: 655f 6669 6c65 6e61 6d65 5f70 6172 7428  e_filename_part(
+00019fb0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00019fc0: 7265 7475 726e 3a20 7374 7269 6e67 2077  return: string w
+00019fd0: 6869 6368 2063 616e 2062 6520 7573 6564  hich can be used
+00019fe0: 2061 7320 7061 7274 206f 6620 6120 6669   as part of a fi
+00019ff0: 6c65 6e61 6d65 2c20 7768 6963 6820 7265  lename, which re
+0001a000: 7072 6573 656e 7473 2074 6865 2073 7461  presents the sta
+0001a010: 7274 2074 696d 6520 6f66 2052 4554 5552  rt time of RETUR
+0001a020: 4e4e 2069 6e20 5554 430a 2020 2020 3a72  NN in UTC.    :r
+0001a030: 7479 7065 3a20 7374 720a 2020 2020 2222  type: str.    ""
+0001a040: 220a 2020 2020 7265 7475 726e 2074 696d  ".    return tim
+0001a050: 652e 7374 7266 7469 6d65 2822 2559 2d25  e.strftime("%Y-%
+0001a060: 6d2d 2564 2d25 482d 254d 2d25 5322 2c20  m-%d-%H-%M-%S", 
+0001a070: 7469 6d65 2e67 6d74 696d 6528 7374 6172  time.gmtime(star
+0001a080: 745f 7469 6d65 2929 0a0a 0a64 6566 206d  t_time))...def m
+0001a090: 6179 6265 5f6d 616b 655f 6469 7273 2864  aybe_make_dirs(d
+0001a0a0: 6972 6e61 6d65 293a 0a20 2020 2022 2222  irname):.    """
+0001a0b0: 0a20 2020 2043 7265 6174 6573 2074 6865  .    Creates the
+0001a0c0: 2064 6972 6563 746f 7279 2069 6620 6974   directory if it
+0001a0d0: 2064 6f65 7320 6e6f 7420 7965 7420 6578   does not yet ex
+0001a0e0: 6973 742e 0a0a 2020 2020 3a70 6172 616d  ist...    :param
+0001a0f0: 2073 7472 2064 6972 6e61 6d65 3a20 5468   str dirname: Th
+0001a100: 6520 7061 7468 206f 6620 7468 6520 6469  e path of the di
+0001a110: 7265 6374 6f72 790a 2020 2020 2222 220a  rectory.    """.
+0001a120: 2020 2020 696d 706f 7274 206f 730a 0a20      import os.. 
+0001a130: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+0001a140: 682e 6578 6973 7473 2864 6972 6e61 6d65  h.exists(dirname
+0001a150: 293a 0a20 2020 2020 2020 2074 7279 3a0a  ):.        try:.
+0001a160: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+0001a170: 616b 6564 6972 7328 6469 726e 616d 6529  akedirs(dirname)
+0001a180: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001a190: 4578 6365 7074 696f 6e20 6173 2065 7863  Exception as exc
+0001a1a0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0001a1b0: 696e 7428 226d 6179 6265 5f63 7265 6174  int("maybe_creat
+0001a1c0: 655f 666f 6c64 6572 3a20 6578 6365 7074  e_folder: except
+0001a1d0: 696f 6e20 6372 6561 7469 6e67 2064 6972  ion creating dir
+0001a1e0: 3a22 2c20 6578 6329 0a20 2020 2020 2020  :", exc).       
+0001a1f0: 2020 2020 2023 204d 6179 6265 2061 2063       # Maybe a c
+0001a200: 6f6e 6375 7272 656e 7420 7072 6f63 6573  oncurrent proces
+0001a210: 732c 2065 2e67 2e20 7466 2e63 6f6d 7061  s, e.g. tf.compa
+0001a220: 742e 7631 2e73 756d 6d61 7279 2e46 696c  t.v1.summary.Fil
+0001a230: 6557 7269 7465 7220 6372 6561 7465 6420  eWriter created 
+0001a240: 6974 2069 6e20 7468 6520 6d65 616e 2d77  it in the mean-w
+0001a250: 6869 6c65 2c0a 2020 2020 2020 2020 2020  hile,.          
+0001a260: 2020 2320 736f 2074 6865 6e20 6974 2077    # so then it w
+0001a270: 6f75 6c64 2062 6520 6f6b 206e 6f77 2069  ould be ok now i
+0001a280: 6620 6974 2065 7869 7374 732c 2062 7574  f it exists, but
+0001a290: 2066 6169 6c20 6966 2069 7420 646f 6573   fail if it does
+0001a2a0: 206e 6f74 2065 7869 7374 2e0a 2020 2020   not exist..    
+0001a2b0: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
+0001a2c0: 732e 7061 7468 2e65 7869 7374 7328 6469  s.path.exists(di
+0001a2d0: 726e 616d 6529 0a0a 0a64 6566 206c 6f67  rname)...def log
+0001a2e0: 5f72 756e 7469 6d65 5f69 6e66 6f5f 746f  _runtime_info_to
+0001a2f0: 5f64 6972 2870 6174 682c 2063 6f6e 6669  _dir(path, confi
+0001a300: 6729 3a0a 2020 2020 2222 220a 2020 2020  g):.    """.    
+0001a310: 5468 6973 2077 696c 6c20 7772 6974 6520  This will write 
+0001a320: 6d75 6c74 6970 6c65 206c 6f67 6769 6e67  multiple logging
+0001a330: 2069 6e66 6f72 6d61 7469 6f6e 2069 6e74   information int
+0001a340: 6f20 7468 6520 7061 7468 2e0a 2020 2020  o the path..    
+0001a350: 4974 2077 696c 6c20 6372 6561 7465 2072  It will create r
+0001a360: 6574 7572 6e6e 2e2a 2e6c 6f67 2077 6974  eturnn.*.log wit
+0001a370: 6820 736f 6d65 206d 6574 6120 696e 666f  h some meta info
+0001a380: 726d 6174 696f 6e2c 0a20 2020 2061 7320  rmation,.    as 
+0001a390: 7765 6c6c 2061 7320 636f 7079 2074 6865  well as copy the
+0001a3a0: 2075 7365 6420 636f 6e66 6967 2066 696c   used config fil
+0001a3b0: 652e 0a0a 2020 2020 3a70 6172 616d 2073  e...    :param s
+0001a3c0: 7472 2070 6174 683a 2064 6972 6563 746f  tr path: directo
+0001a3d0: 7279 2070 6174 680a 2020 2020 3a70 6172  ry path.    :par
+0001a3e0: 616d 2072 6574 7572 6e6e 2e63 6f6e 6669  am returnn.confi
+0001a3f0: 672e 436f 6e66 6967 2063 6f6e 6669 673a  g.Config config:
+0001a400: 0a20 2020 2022 2222 0a20 2020 2069 6d70  .    """.    imp
+0001a410: 6f72 7420 6f73 0a20 2020 2069 6d70 6f72  ort os.    impor
+0001a420: 7420 7379 730a 2020 2020 696d 706f 7274  t sys.    import
+0001a430: 2073 6875 7469 6c0a 2020 2020 6672 6f6d   shutil.    from
+0001a440: 2072 6574 7572 6e6e 2e63 6f6e 6669 6720   returnn.config 
+0001a450: 696d 706f 7274 2043 6f6e 6669 670a 0a20  import Config.. 
+0001a460: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001a470: 686f 7374 6e61 6d65 203d 2067 6574 5f68  hostname = get_h
+0001a480: 6f73 746e 616d 6528 290a 2020 2020 2020  ostname().      
+0001a490: 2020 636f 6e74 656e 7420 3d20 5b0a 2020    content = [.  
+0001a4a0: 2020 2020 2020 2020 2020 2254 696d 653a            "Time:
+0001a4b0: 2025 7322 2025 2074 696d 652e 7374 7266   %s" % time.strf
+0001a4c0: 7469 6d65 2822 2559 2d25 6d2d 2564 2025  time("%Y-%m-%d %
+0001a4d0: 483a 254d 3a25 5322 2c20 7469 6d65 2e67  H:%M:%S", time.g
+0001a4e0: 6d74 696d 6528 7374 6172 745f 7469 6d65  mtime(start_time
+0001a4f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+0001a500: 2243 616c 6c3a 2025 7322 2025 2028 7379  "Call: %s" % (sy
+0001a510: 732e 6172 6776 2c29 2c0a 2020 2020 2020  s.argv,),.      
+0001a520: 2020 2020 2020 2250 6174 683a 2025 7322        "Path: %s"
+0001a530: 2025 2028 6f73 2e67 6574 6377 6428 292c   % (os.getcwd(),
+0001a540: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
+0001a550: 486f 7374 6e61 6d65 3a20 2573 2220 2520  Hostname: %s" % 
+0001a560: 6765 745f 686f 7374 6e61 6d65 2829 2c0a  get_hostname(),.
+0001a570: 2020 2020 2020 2020 2020 2020 2250 4944              "PID
+0001a580: 3a20 2569 2220 2520 6f73 2e67 6574 7069  : %i" % os.getpi
+0001a590: 6428 292c 0a20 2020 2020 2020 2020 2020  d(),.           
+0001a5a0: 2022 5265 7475 726e 6e3a 2025 7322 2025   "Returnn: %s" %
+0001a5b0: 2028 6465 7363 7269 6265 5f72 6574 7572   (describe_retur
+0001a5c0: 6e6e 5f76 6572 7369 6f6e 2829 2c29 2c0a  nn_version(),),.
+0001a5d0: 2020 2020 2020 2020 2020 2020 2254 656e              "Ten
+0001a5e0: 736f 7246 6c6f 773a 2025 7322 2025 2028  sorFlow: %s" % (
+0001a5f0: 6465 7363 7269 6265 5f74 656e 736f 7266  describe_tensorf
+0001a600: 6c6f 775f 7665 7273 696f 6e28 292c 292c  low_version(),),
+0001a610: 0a20 2020 2020 2020 2020 2020 2022 436f  .            "Co
+0001a620: 6e66 6967 2066 696c 6573 3a20 2573 2220  nfig files: %s" 
+0001a630: 2520 2863 6f6e 6669 672e 6669 6c65 732c  % (config.files,
+0001a640: 292c 0a20 2020 2020 2020 205d 0a20 2020  ),.        ].   
+0001a650: 2020 2020 206d 6179 6265 5f6d 616b 655f       maybe_make_
+0001a660: 6469 7273 2870 6174 6829 0a20 2020 2020  dirs(path).     
+0001a670: 2020 206c 6f67 5f66 6e20 3d20 2225 732f     log_fn = "%s/
+0001a680: 7265 7475 726e 6e2e 2573 2e25 732e 2569  returnn.%s.%s.%i
+0001a690: 2e6c 6f67 2220 2520 2870 6174 682c 2067  .log" % (path, g
+0001a6a0: 6574 5f75 7463 5f73 7461 7274 5f74 696d  et_utc_start_tim
+0001a6b0: 655f 6669 6c65 6e61 6d65 5f70 6172 7428  e_filename_part(
+0001a6c0: 292c 2068 6f73 746e 616d 652c 206f 732e  ), hostname, os.
+0001a6d0: 6765 7470 6964 2829 290a 2020 2020 2020  getpid()).      
+0001a6e0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+0001a6f0: 2e65 7869 7374 7328 6c6f 675f 666e 293a  .exists(log_fn):
+0001a700: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0001a710: 6820 6f70 656e 286c 6f67 5f66 6e2c 2022  h open(log_fn, "
+0001a720: 7722 2920 6173 2066 3a0a 2020 2020 2020  w") as f:.      
+0001a730: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
+0001a740: 6528 2252 6574 7572 6e6e 206c 6f67 2066  e("Returnn log f
+0001a750: 696c 653a 5c6e 2220 2b20 2222 2e6a 6f69  ile:\n" + "".joi
+0001a760: 6e28 5b22 2573 5c6e 2220 2520 7320 666f  n(["%s\n" % s fo
+0001a770: 7220 7320 696e 2063 6f6e 7465 6e74 5d29  r s in content])
+0001a780: 202b 2022 5c6e 2229 0a20 2020 2020 2020   + "\n").       
+0001a790: 2066 6f72 2066 6e20 696e 2063 6f6e 6669   for fn in confi
+0001a7a0: 672e 6669 6c65 733a 0a20 2020 2020 2020  g.files:.       
+0001a7b0: 2020 2020 2062 6173 655f 666e 203d 206f       base_fn = o
+0001a7c0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001a7d0: 666e 290a 2020 2020 2020 2020 2020 2020  fn).            
+0001a7e0: 7461 7267 6574 5f66 6e20 3d20 2225 732f  target_fn = "%s/
+0001a7f0: 2573 2220 2520 2870 6174 682c 2062 6173  %s" % (path, bas
+0001a800: 655f 666e 290a 2020 2020 2020 2020 2020  e_fn).          
+0001a810: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+0001a820: 7374 7328 7461 7267 6574 5f66 6e29 3a0a  sts(target_fn):.
+0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a840: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001a850: 2020 2020 2073 6875 7469 6c2e 636f 7079       shutil.copy
+0001a860: 2866 6e2c 2074 6172 6765 745f 666e 290a  (fn, target_fn).
+0001a870: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0001a880: 6967 5f74 7970 6520 3d20 436f 6e66 6967  ig_type = Config
+0001a890: 2e67 6574 5f63 6f6e 6669 675f 6669 6c65  .get_config_file
+0001a8a0: 5f74 7970 6528 666e 290a 2020 2020 2020  _type(fn).      
+0001a8b0: 2020 2020 2020 636f 6d6d 656e 745f 7072        comment_pr
+0001a8c0: 6566 6978 203d 2022 2322 0a20 2020 2020  efix = "#".     
+0001a8d0: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
+0001a8e0: 5f74 7970 6520 3d3d 2022 6a73 223a 0a20  _type == "js":. 
+0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001a900: 6f6d 6d65 6e74 5f70 7265 6669 7820 3d20  omment_prefix = 
+0001a910: 222f 2f22 0a20 2020 2020 2020 2020 2020  "//".           
+0001a920: 2077 6974 6820 6f70 656e 2874 6172 6765   with open(targe
+0001a930: 745f 666e 2c20 2261 2229 2061 7320 663a  t_fn, "a") as f:
+0001a940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a950: 2066 2e77 7269 7465 280a 2020 2020 2020   f.write(.      
+0001a960: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+0001a970: 6e5c 6e5c 6e22 0a20 2020 2020 2020 2020  n\n\n".         
+0001a980: 2020 2020 2020 2020 2020 202b 2022 222e             + "".
+0001a990: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 5b22                ["
+0001a9b0: 2573 2043 6f6e 6669 672d 6669 6c65 2063  %s Config-file c
+0001a9c0: 6f70 6965 6420 666f 7220 6c6f 6767 696e  opied for loggin
+0001a9d0: 6720 7075 7270 6f73 6520 6279 2052 6574  g purpose by Ret
+0001a9e0: 7572 6e6e 2e5c 6e22 2025 2063 6f6d 6d65  urnn.\n" % comme
+0001a9f0: 6e74 5f70 7265 6669 785d 0a20 2020 2020  nt_prefix].     
 0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa10: 2020 2020 2b20 225c 6e22 0a20 2020 2020      + "\n".     
-0001aa20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001aa30: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-0001aa40: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
-0001aa50: 6966 2022 4469 736b 2071 756f 7461 2220  if "Disk quota" 
-0001aa60: 696e 2073 7472 2865 7863 293a 0a20 2020  in str(exc):.   
-0001aa70: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0001aa80: 6c6f 675f 7275 6e74 696d 655f 696e 666f  log_runtime_info
-0001aa90: 5f74 6f5f 6469 723a 2045 7272 6f72 2c20  _to_dir: Error, 
-0001aaa0: 6361 6e6e 6f74 2077 7269 7465 3a20 2573  cannot write: %s
-0001aab0: 2220 2520 6578 6329 0a20 2020 2020 2020  " % exc).       
-0001aac0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001aad0: 2020 2072 6169 7365 0a0a 0a64 6566 2073     raise...def s
-0001aae0: 686f 756c 645f 7772 6974 655f 746f 5f64  hould_write_to_d
-0001aaf0: 6973 6b28 636f 6e66 6967 293a 0a20 2020  isk(config):.   
-0001ab00: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-0001ab10: 7265 7475 726e 6e2e 636f 6e66 6967 2e43  returnn.config.C
-0001ab20: 6f6e 6669 6720 636f 6e66 6967 3a0a 2020  onfig config:.  
-0001ab30: 2020 3a72 7479 7065 3a20 626f 6f6c 0a20    :rtype: bool. 
-0001ab40: 2020 2022 2222 0a20 2020 2069 6620 636f     """.    if co
-0001ab50: 6e66 6967 2e69 735f 7472 7565 2822 7573  nfig.is_true("us
-0001ab60: 655f 686f 726f 766f 6422 293a 0a20 2020  e_horovod"):.   
-0001ab70: 2020 2020 2023 206e 6f69 6e73 7065 6374       # noinspect
-0001ab80: 696f 6e20 5079 5061 636b 6167 6552 6571  ion PyPackageReq
-0001ab90: 7569 7265 6d65 6e74 732c 5079 556e 7265  uirements,PyUnre
-0001aba0: 736f 6c76 6564 5265 6665 7265 6e63 6573  solvedReferences
-0001abb0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0001abc0: 686f 726f 766f 642e 7465 6e73 6f72 666c  horovod.tensorfl
-0001abd0: 6f77 2061 7320 6876 640a 0a20 2020 2020  ow as hvd..     
-0001abe0: 2020 2069 6620 6876 642e 7261 6e6b 2829     if hvd.rank()
-0001abf0: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-0001ac00: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001ac10: 2020 2020 6966 2063 6f6e 6669 672e 6973      if config.is
-0001ac20: 5f74 7275 6528 2264 7279 5f72 756e 2229  _true("dry_run")
-0001ac30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001ac40: 2046 616c 7365 0a20 2020 2072 6574 7572   False.    retur
-0001ac50: 6e20 5472 7565 0a0a 0a5f 6465 6661 756c  n True..._defaul
-0001ac60: 745f 676c 6f62 616c 5f69 6e66 5f76 616c  t_global_inf_val
-0001ac70: 7565 203d 2066 6c6f 6174 2822 696e 6622  ue = float("inf"
-0001ac80: 290a 0a0a 6465 6620 6765 745f 676c 6f62  )...def get_glob
-0001ac90: 616c 5f69 6e66 5f76 616c 7565 2829 202d  al_inf_value() -
-0001aca0: 3e20 666c 6f61 743a 0a20 2020 2022 2222  > float:.    """
-0001acb0: 0a20 2020 203a 7265 7475 726e 3a20 666c  .    :return: fl
-0001acc0: 6f61 7428 2269 6e66 2229 2062 7920 6465  oat("inf") by de
-0001acd0: 6661 756c 742c 2062 7574 2074 7269 6573  fault, but tries
-0001ace0: 2074 6f20 7265 6164 2060 696e 665f 7661   to read `inf_va
-0001acf0: 6c75 6560 2066 726f 6d20 7468 6520 676c  lue` from the gl
-0001ad00: 6f62 616c 2063 6f6e 6669 670a 2020 2020  obal config.    
-0001ad10: 2222 220a 2020 2020 6672 6f6d 2072 6574  """.    from ret
-0001ad20: 7572 6e6e 2e63 6f6e 6669 6720 696d 706f  urnn.config impo
-0001ad30: 7274 2067 6574 5f67 6c6f 6261 6c5f 636f  rt get_global_co
-0001ad40: 6e66 6967 0a0a 2020 2020 636f 6e66 6967  nfig..    config
-0001ad50: 203d 2067 6574 5f67 6c6f 6261 6c5f 636f   = get_global_co
-0001ad60: 6e66 6967 2872 6169 7365 5f65 7863 6570  nfig(raise_excep
-0001ad70: 7469 6f6e 3d46 616c 7365 290a 2020 2020  tion=False).    
-0001ad80: 6966 206e 6f74 2063 6f6e 6669 673a 0a20  if not config:. 
-0001ad90: 2020 2020 2020 2072 6574 7572 6e20 5f64         return _d
-0001ada0: 6566 6175 6c74 5f67 6c6f 6261 6c5f 696e  efault_global_in
-0001adb0: 665f 7661 6c75 650a 2020 2020 7265 7475  f_value.    retu
-0001adc0: 726e 2063 6f6e 6669 672e 666c 6f61 7428  rn config.float(
-0001add0: 2269 6e66 5f76 616c 7565 222c 205f 6465  "inf_value", _de
-0001ade0: 6661 756c 745f 676c 6f62 616c 5f69 6e66  fault_global_inf
-0001adf0: 5f76 616c 7565 290a 0a0a 636c 6173 7320  _value)...class 
-0001ae00: 4e61 7469 7665 436f 6465 436f 6d70 696c  NativeCodeCompil
-0001ae10: 6572 286f 626a 6563 7429 3a0a 2020 2020  er(object):.    
-0001ae20: 2222 220a 2020 2020 4865 6c70 6572 2063  """.    Helper c
-0001ae30: 6c61 7373 2074 6f20 636f 6d70 696c 6520  lass to compile 
-0001ae40: 6e61 7469 7665 2043 2f43 2b2b 2063 6f64  native C/C++ cod
-0001ae50: 6520 6f6e 2d74 6865 2d66 6c79 2e0a 2020  e on-the-fly..  
-0001ae60: 2020 2222 220a 0a20 2020 2043 6163 6865    """..    Cache
-0001ae70: 4469 724e 616d 6520 3d20 2272 6574 7572  DirName = "retur
-0001ae80: 6e6e 5f6e 6174 6976 6522 0a20 2020 2043  nn_native".    C
-0001ae90: 6f6c 6c65 6374 6564 436f 6d70 696c 6572  ollectedCompiler
-0001aea0: 7320 3d20 4e6f 6e65 2020 2320 7479 7065  s = None  # type
-0001aeb0: 3a20 7479 7069 6e67 2e4f 7074 696f 6e61  : typing.Optiona
-0001aec0: 6c5b 7479 7069 6e67 2e4c 6973 745b 4e61  l[typing.List[Na
-0001aed0: 7469 7665 436f 6465 436f 6d70 696c 6572  tiveCodeCompiler
-0001aee0: 5d5d 0a0a 2020 2020 6465 6620 5f5f 696e  ]]..    def __in
-0001aef0: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
-0001af00: 6c66 2c0a 2020 2020 2020 2020 6261 7365  lf,.        base
-0001af10: 5f6e 616d 652c 0a20 2020 2020 2020 2063  _name,.        c
-0001af20: 6f64 655f 7665 7273 696f 6e2c 0a20 2020  ode_version,.   
-0001af30: 2020 2020 2063 6f64 652c 0a20 2020 2020       code,.     
-0001af40: 2020 2069 735f 6370 703d 5472 7565 2c0a     is_cpp=True,.
-0001af50: 2020 2020 2020 2020 635f 6d61 6372 6f5f          c_macro_
-0001af60: 6465 6669 6e65 733d 4e6f 6e65 2c0a 2020  defines=None,.  
-0001af70: 2020 2020 2020 6c64 5f66 6c61 6773 3d4e        ld_flags=N
-0001af80: 6f6e 652c 0a20 2020 2020 2020 2069 6e63  one,.        inc
-0001af90: 6c75 6465 5f70 6174 6873 3d28 292c 0a20  lude_paths=(),. 
-0001afa0: 2020 2020 2020 2069 6e63 6c75 6465 5f64         include_d
-0001afb0: 6570 733d 4e6f 6e65 2c0a 2020 2020 2020  eps=None,.      
-0001afc0: 2020 7374 6174 6963 5f76 6572 7369 6f6e    static_version
-0001afd0: 5f6e 616d 653d 4e6f 6e65 2c0a 2020 2020  _name=None,.    
-0001afe0: 2020 2020 7368 6f75 6c64 5f63 6c65 616e      should_clean
-0001aff0: 7570 5f6f 6c64 5f61 6c6c 3d54 7275 652c  up_old_all=True,
-0001b000: 0a20 2020 2020 2020 2073 686f 756c 645f  .        should_
-0001b010: 636c 6561 6e75 705f 6f6c 645f 6d79 6469  cleanup_old_mydi
-0001b020: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
-0001b030: 2075 7365 5f63 7878 3131 5f61 6269 3d46   use_cxx11_abi=F
-0001b040: 616c 7365 2c0a 2020 2020 2020 2020 6c6f  alse,.        lo
-0001b050: 675f 7374 7265 616d 3d4e 6f6e 652c 0a20  g_stream=None,. 
-0001b060: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
-0001b070: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
-0001b080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001b090: 203a 7061 7261 6d20 7374 7220 6261 7365   :param str base
-0001b0a0: 5f6e 616d 653a 2062 6173 6520 6e61 6d65  _name: base name
-0001b0b0: 2066 6f72 2074 6865 206d 6f64 756c 652c   for the module,
-0001b0c0: 2065 2e67 2e20 227a 6572 6f5f 6f75 7422   e.g. "zero_out"
-0001b0d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001b0e0: 696e 747c 7475 706c 655b 696e 745d 2063  int|tuple[int] c
-0001b0f0: 6f64 655f 7665 7273 696f 6e3a 2063 6865  ode_version: che
-0001b100: 636b 2066 6f72 2074 6865 2063 6163 6865  ck for the cache
-0001b110: 2077 6865 7468 6572 2074 6f20 7265 7573   whether to reus
-0001b120: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
-0001b130: 2073 7472 2063 6f64 653a 2074 6865 2073   str code: the s
-0001b140: 6f75 7263 6520 636f 6465 2069 7473 656c  ource code itsel
-0001b150: 660a 2020 2020 2020 2020 3a70 6172 616d  f.        :param
-0001b160: 2062 6f6f 6c20 6973 5f63 7070 3a20 6966   bool is_cpp: if
-0001b170: 2046 616c 7365 2c20 4320 6973 2061 7373   False, C is ass
-0001b180: 756d 6564 0a20 2020 2020 2020 203a 7061  umed.        :pa
-0001b190: 7261 6d20 6469 6374 5b73 7472 2c73 7472  ram dict[str,str
-0001b1a0: 7c69 6e74 7c4e 6f6e 655d 7c4e 6f6e 6520  |int|None]|None 
-0001b1b0: 635f 6d61 6372 6f5f 6465 6669 6e65 733a  c_macro_defines:
-0001b1c0: 2065 2e67 2e20 7b22 5445 4e53 4f52 464c   e.g. {"TENSORFL
-0001b1d0: 4f57 223a 2031 7d0a 2020 2020 2020 2020  OW": 1}.        
-0001b1e0: 3a70 6172 616d 206c 6973 745b 7374 725d  :param list[str]
-0001b1f0: 7c4e 6f6e 6520 6c64 5f66 6c61 6773 3a20  |None ld_flags: 
-0001b200: 652e 672e 205b 222d 6c62 6c61 7322 5d0a  e.g. ["-lblas"].
-0001b210: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-0001b220: 6973 745b 7374 725d 7c74 7570 6c65 5b73  ist[str]|tuple[s
-0001b230: 7472 5d20 696e 636c 7564 655f 7061 7468  tr] include_path
-0001b240: 733a 0a20 2020 2020 2020 203a 7061 7261  s:.        :para
-0001b250: 6d20 6c69 7374 5b73 7472 5d7c 4e6f 6e65  m list[str]|None
-0001b260: 2069 6e63 6c75 6465 5f64 6570 733a 2069   include_deps: i
-0001b270: 6620 7072 6f76 6964 6564 2061 6e64 2061  f provided and a
-0001b280: 6e20 6578 6973 7469 6e67 206c 6962 2066  n existing lib f
-0001b290: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
-0001b2a0: 2077 6520 7769 6c6c 2063 6865 636b 2069   we will check i
-0001b2b0: 6620 616e 7920 6465 7065 6e64 656e 6379  f any dependency
-0001b2c0: 2069 7320 6e65 7765 720a 2020 2020 2020   is newer.      
-0001b2d0: 2020 2020 2020 616e 6420 7765 206e 6565        and we nee
-0001b2e0: 6420 746f 2072 6563 6f6d 7069 6c65 2e20  d to recompile. 
-0001b2f0: 7765 2063 6f75 6c64 2061 6c73 6f20 646f  we could also do
-0001b300: 2069 7420 6175 746f 6d61 7469 6361 6c6c   it automaticall
-0001b310: 7920 7669 6120 2d4d 4420 6275 7420 7468  y via -MD but th
-0001b320: 6174 2073 6565 6d73 206f 7665 726b 696c  at seems overkil
-0001b330: 6c20 616e 6420 746f 6f20 736c 6f77 2e0a  l and too slow..
-0001b340: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0001b350: 7472 7c4e 6f6e 6520 7374 6174 6963 5f76  tr|None static_v
-0001b360: 6572 7369 6f6e 5f6e 616d 653a 206e 6f72  ersion_name: nor
-0001b370: 6d61 6c6c 792c 2077 6520 7573 6520 2e2e  mally, we use ..
-0001b380: 2e2f 6261 7365 5f6e 616d 652f 6861 7368  ./base_name/hash
-0001b390: 2061 7320 7468 6520 6469 720a 2020 2020   as the dir.    
-0001b3a0: 2020 2020 2020 2020 6275 7420 7468 6973          but this
-0001b3b0: 2077 6f75 6c64 2075 7365 202e 2e2e 2f62   would use .../b
-0001b3c0: 6173 655f 6e61 6d65 2f73 7461 7469 635f  ase_name/static_
-0001b3d0: 7665 7273 696f 6e5f 6e61 6d65 2e0a 2020  version_name..  
-0001b3e0: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
-0001b3f0: 6c20 7368 6f75 6c64 5f63 6c65 616e 7570  l should_cleanup
-0001b400: 5f6f 6c64 5f61 6c6c 3a20 7768 6574 6865  _old_all: whethe
-0001b410: 7220 7765 2073 686f 756c 6420 6c6f 6f6b  r we should look
-0001b420: 2069 6e20 7468 6520 6361 6368 6520 6469   in the cache di
-0001b430: 720a 2020 2020 2020 2020 2020 2020 616e  r.            an
-0001b440: 6420 6368 6563 6b20 616c 6c20 6f70 7320  d check all ops 
-0001b450: 6966 2077 6520 6361 6e20 6465 6c65 7465  if we can delete
-0001b460: 2073 6f6d 6520 6f6c 6420 6f6e 6573 2077   some old ones w
-0001b470: 6869 6368 2061 7265 206f 6c64 6572 2074  hich are older t
-0001b480: 6861 6e20 736f 6d65 206c 696d 6974 0a20  han some limit. 
-0001b490: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
-0001b4a0: 2e5f 636c 6561 6e75 705f 7469 6d65 5f6c  ._cleanup_time_l
-0001b4b0: 696d 6974 5f64 6179 7329 0a20 2020 2020  imit_days).     
-0001b4c0: 2020 203a 7061 7261 6d20 626f 6f6c 2073     :param bool s
-0001b4d0: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
-0001b4e0: 645f 6d79 6469 723a 2077 6865 7468 6572  d_mydir: whether
-0001b4f0: 2077 6520 7368 6f75 6c64 2064 656c 6574   we should delet
-0001b500: 6520 6f75 7220 6f70 2064 6972 2062 6566  e our op dir bef
-0001b510: 6f72 6520 7765 2063 6f6d 7069 6c65 2074  ore we compile t
-0001b520: 6865 7265 2e0a 2020 2020 2020 2020 3a70  here..        :p
-0001b530: 6172 616d 2074 7970 696e 672e 5465 7874  aram typing.Text
-0001b540: 494f 7c4e 6f6e 6520 6c6f 675f 7374 7265  IO|None log_stre
-0001b550: 616d 3a20 6669 6c65 2073 7472 6561 6d20  am: file stream 
-0001b560: 666f 7220 7072 696e 7420 7374 6174 656d  for print statem
-0001b570: 656e 7473 0a20 2020 2020 2020 203a 7061  ents.        :pa
-0001b580: 7261 6d20 626f 6f6c 2076 6572 626f 7365  ram bool verbose
-0001b590: 3a20 6265 2073 6c69 6768 746c 7920 6d6f  : be slightly mo
-0001b5a0: 7265 2076 6572 626f 7365 0a20 2020 2020  re verbose.     
-0001b5b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001b5c0: 6620 7365 6c66 2e43 6f6c 6c65 6374 6564  f self.Collected
-0001b5d0: 436f 6d70 696c 6572 7320 6973 206e 6f74  Compilers is not
-0001b5e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001b5f0: 2020 2073 656c 662e 436f 6c6c 6563 7465     self.Collecte
-0001b600: 6443 6f6d 7069 6c65 7273 2e61 7070 656e  dCompilers.appen
-0001b610: 6428 7365 6c66 290a 2020 2020 2020 2020  d(self).        
-0001b620: 7365 6c66 2e76 6572 626f 7365 203d 2076  self.verbose = v
-0001b630: 6572 626f 7365 0a20 2020 2020 2020 2073  erbose.        s
-0001b640: 656c 662e 6361 6368 655f 6469 7220 3d20  elf.cache_dir = 
-0001b650: 2225 732f 2573 2220 2520 2867 6574 5f63  "%s/%s" % (get_c
-0001b660: 6163 6865 5f64 6972 2829 2c20 7365 6c66  ache_dir(), self
-0001b670: 2e43 6163 6865 4469 724e 616d 6529 0a20  .CacheDirName). 
-0001b680: 2020 2020 2020 2073 656c 662e 5f69 6e63         self._inc
-0001b690: 6c75 6465 5f70 6174 6873 203d 206c 6973  lude_paths = lis
-0001b6a0: 7428 696e 636c 7564 655f 7061 7468 7329  t(include_paths)
-0001b6b0: 0a20 2020 2020 2020 2073 656c 662e 6261  .        self.ba
-0001b6c0: 7365 5f6e 616d 6520 3d20 6261 7365 5f6e  se_name = base_n
-0001b6d0: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
-0001b6e0: 2e63 6f64 655f 7665 7273 696f 6e20 3d20  .code_version = 
-0001b6f0: 636f 6465 5f76 6572 7369 6f6e 0a20 2020  code_version.   
-0001b700: 2020 2020 2073 656c 662e 636f 6465 203d       self.code =
-0001b710: 2063 6f64 650a 2020 2020 2020 2020 7365   code.        se
-0001b720: 6c66 2e69 735f 6370 7020 3d20 6973 5f63  lf.is_cpp = is_c
-0001b730: 7070 0a20 2020 2020 2020 2073 656c 662e  pp.        self.
-0001b740: 635f 6d61 6372 6f5f 6465 6669 6e65 7320  c_macro_defines 
-0001b750: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-0001b760: 2069 6e20 2863 5f6d 6163 726f 5f64 6566   in (c_macro_def
-0001b770: 696e 6573 206f 7220 7b7d 292e 6974 656d  ines or {}).item
-0001b780: 7328 2920 6966 2076 2069 7320 6e6f 7420  s() if v is not 
-0001b790: 4e6f 6e65 7d0a 2020 2020 2020 2020 7365  None}.        se
-0001b7a0: 6c66 2e6c 645f 666c 6167 7320 3d20 6c64  lf.ld_flags = ld
-0001b7b0: 5f66 6c61 6773 206f 7220 5b5d 0a20 2020  _flags or [].   
-0001b7c0: 2020 2020 2073 656c 662e 696e 636c 7564       self.includ
-0001b7d0: 655f 6465 7073 203d 2069 6e63 6c75 6465  e_deps = include
-0001b7e0: 5f64 6570 730a 2020 2020 2020 2020 7365  _deps.        se
-0001b7f0: 6c66 2e73 7461 7469 635f 7665 7273 696f  lf.static_versio
-0001b800: 6e5f 6e61 6d65 203d 2073 7461 7469 635f  n_name = static_
-0001b810: 7665 7273 696f 6e5f 6e61 6d65 0a20 2020  version_name.   
-0001b820: 2020 2020 2073 656c 662e 5f63 6f64 655f       self._code_
-0001b830: 6861 7368 203d 2073 656c 662e 5f6d 616b  hash = self._mak
-0001b840: 655f 636f 6465 5f68 6173 6828 290a 2020  e_code_hash().  
-0001b850: 2020 2020 2020 7365 6c66 2e5f 696e 666f        self._info
-0001b860: 5f64 6963 7420 3d20 7365 6c66 2e5f 6d61  _dict = self._ma
-0001b870: 6b65 5f69 6e66 6f5f 6469 6374 2829 0a20  ke_info_dict(). 
-0001b880: 2020 2020 2020 2073 656c 662e 5f68 6173         self._has
-0001b890: 6820 3d20 7365 6c66 2e5f 6d61 6b65 5f68  h = self._make_h
-0001b8a0: 6173 6828 290a 2020 2020 2020 2020 7365  ash().        se
-0001b8b0: 6c66 2e5f 6374 7970 6573 5f6c 6962 203d  lf._ctypes_lib =
-0001b8c0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-0001b8d0: 2073 686f 756c 645f 636c 6561 6e75 705f   should_cleanup_
-0001b8e0: 6f6c 645f 616c 6c3a 0a20 2020 2020 2020  old_all:.       
-0001b8f0: 2020 2020 2073 656c 662e 5f63 6c65 616e       self._clean
-0001b900: 7570 5f6f 6c64 2829 0a20 2020 2020 2020  up_old().       
-0001b910: 2073 656c 662e 5f73 686f 756c 645f 636c   self._should_cl
-0001b920: 6561 6e75 705f 6f6c 645f 6d79 6469 7220  eanup_old_mydir 
-0001b930: 3d20 7368 6f75 6c64 5f63 6c65 616e 7570  = should_cleanup
-0001b940: 5f6f 6c64 5f6d 7964 6972 0a20 2020 2020  _old_mydir.     
-0001b950: 2020 2073 656c 662e 7573 655f 6378 7831     self.use_cxx1
-0001b960: 315f 6162 6920 3d20 7573 655f 6378 7831  1_abi = use_cxx1
-0001b970: 315f 6162 690a 2020 2020 2020 2020 7365  1_abi.        se
-0001b980: 6c66 2e5f 6c6f 675f 7374 7265 616d 203d  lf._log_stream =
-0001b990: 206c 6f67 5f73 7472 6561 6d0a 2020 2020   log_stream.    
-0001b9a0: 2020 2020 6966 2073 656c 662e 7665 7262      if self.verb
-0001b9b0: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-0001b9c0: 2070 7269 6e74 2822 2573 3a20 2572 2220   print("%s: %r" 
-0001b9d0: 2520 2873 656c 662e 5f5f 636c 6173 735f  % (self.__class_
-0001b9e0: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365 6c66  _.__name__, self
-0001b9f0: 292c 2066 696c 653d 6c6f 675f 7374 7265  ), file=log_stre
-0001ba00: 616d 290a 0a20 2020 2064 6566 205f 5f72  am)..    def __r
-0001ba10: 6570 725f 5f28 7365 6c66 293a 0a20 2020  epr__(self):.   
-0001ba20: 2020 2020 2072 6574 7572 6e20 223c 2573       return "<%s
-0001ba30: 2025 7220 696e 2025 723e 2220 2520 2873   %r in %r>" % (s
-0001ba40: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
-0001ba50: 6e61 6d65 5f5f 2c20 7365 6c66 2e62 6173  name__, self.bas
-0001ba60: 655f 6e61 6d65 2c20 7365 6c66 2e5f 6d6f  e_name, self._mo
-0001ba70: 645f 7061 7468 290a 0a20 2020 2040 7072  d_path)..    @pr
-0001ba80: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
-0001ba90: 6d6f 645f 7061 7468 2873 656c 6629 3a0a  mod_path(self):.
-0001baa0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-0001bab0: 2573 2f25 732f 2573 2220 2520 2873 656c  %s/%s/%s" % (sel
-0001bac0: 662e 6361 6368 655f 6469 722c 2073 656c  f.cache_dir, sel
-0001bad0: 662e 6261 7365 5f6e 616d 652c 2073 656c  f.base_name, sel
-0001bae0: 662e 7374 6174 6963 5f76 6572 7369 6f6e  f.static_version
-0001baf0: 5f6e 616d 6520 6f72 2073 656c 662e 5f68  _name or self._h
-0001bb00: 6173 685b 3a31 305d 290a 0a20 2020 2040  ash[:10])..    @
-0001bb10: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0001bb20: 205f 696e 666f 5f66 696c 656e 616d 6528   _info_filename(
-0001bb30: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0001bb40: 6574 7572 6e20 2225 732f 696e 666f 2e70  eturn "%s/info.p
-0001bb50: 7922 2025 2028 7365 6c66 2e5f 6d6f 645f  y" % (self._mod_
-0001bb60: 7061 7468 2c29 0a0a 2020 2020 4070 726f  path,)..    @pro
-0001bb70: 7065 7274 790a 2020 2020 6465 6620 5f73  perty.    def _s
-0001bb80: 6f5f 6669 6c65 6e61 6d65 2873 656c 6629  o_filename(self)
-0001bb90: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001bba0: 2022 2573 2f25 732e 736f 2220 2520 2873   "%s/%s.so" % (s
-0001bbb0: 656c 662e 5f6d 6f64 5f70 6174 682c 2073  elf._mod_path, s
-0001bbc0: 656c 662e 6261 7365 5f6e 616d 6529 0a0a  elf.base_name)..
-0001bbd0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-0001bbe0: 2020 6465 6620 5f63 5f66 696c 656e 616d    def _c_filenam
-0001bbf0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001bc00: 2069 6620 7365 6c66 2e69 735f 6370 703a   if self.is_cpp:
-0001bc10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001bc20: 7572 6e20 2225 732f 2573 2e63 6322 2025  urn "%s/%s.cc" %
-0001bc30: 2028 7365 6c66 2e5f 6d6f 645f 7061 7468   (self._mod_path
-0001bc40: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
-0001bc50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001bc60: 2022 2573 2f25 732e 6322 2025 2028 7365   "%s/%s.c" % (se
-0001bc70: 6c66 2e5f 6d6f 645f 7061 7468 2c20 7365  lf._mod_path, se
-0001bc80: 6c66 2e62 6173 655f 6e61 6d65 290a 0a20  lf.base_name).. 
-0001bc90: 2020 205f 636c 6561 6e75 705f 7469 6d65     _cleanup_time
-0001bca0: 5f6c 696d 6974 5f64 6179 7320 3d20 3630  _limit_days = 60
-0001bcb0: 0a0a 2020 2020 6465 6620 5f63 6c65 616e  ..    def _clean
-0001bcc0: 7570 5f6f 6c64 2873 656c 6629 3a0a 2020  up_old(self):.  
-0001bcd0: 2020 2020 2020 6d6f 645f 7061 7468 203d        mod_path =
-0001bce0: 2073 656c 662e 5f6d 6f64 5f70 6174 6820   self._mod_path 
-0001bcf0: 2023 202e 2e2e 2f62 6173 655f 6e61 6d65   # .../base_name
-0001bd00: 2f68 6173 680a 2020 2020 2020 2020 6261  /hash.        ba
-0001bd10: 7365 5f6d 6f64 5f70 6174 6820 3d20 6f73  se_mod_path = os
-0001bd20: 2e70 6174 682e 6469 726e 616d 6528 6d6f  .path.dirname(mo
-0001bd30: 645f 7061 7468 2920 2023 202e 2e2e 2f62  d_path)  # .../b
-0001bd40: 6173 655f 6e61 6d65 0a20 2020 2020 2020  ase_name.       
-0001bd50: 206d 795f 6d6f 645f 7061 7468 5f6e 616d   my_mod_path_nam
-0001bd60: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-0001bd70: 6e61 6d65 286d 6f64 5f70 6174 6829 0a20  name(mod_path). 
-0001bd80: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0001bd90: 2e70 6174 682e 6578 6973 7473 2862 6173  .path.exists(bas
-0001bda0: 655f 6d6f 645f 7061 7468 293a 0a20 2020  e_mod_path):.   
-0001bdb0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0001bdc0: 2020 2020 2020 2020 696d 706f 7274 2074          import t
-0001bdd0: 696d 650a 0a20 2020 2020 2020 2063 6c65  ime..        cle
-0001bde0: 616e 7570 5f74 696d 655f 6c69 6d69 745f  anup_time_limit_
-0001bdf0: 7365 6373 203d 2073 656c 662e 5f63 6c65  secs = self._cle
-0001be00: 616e 7570 5f74 696d 655f 6c69 6d69 745f  anup_time_limit_
-0001be10: 6461 7973 202a 2032 3420 2a20 3630 202a  days * 24 * 60 *
-0001be20: 2036 300a 2020 2020 2020 2020 666f 7220   60.        for 
-0001be30: 7020 696e 206f 732e 6c69 7374 6469 7228  p in os.listdir(
-0001be40: 6261 7365 5f6d 6f64 5f70 6174 6829 3a0a  base_mod_path):.
-0001be50: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0001be60: 203d 3d20 6d79 5f6d 6f64 5f70 6174 685f   == my_mod_path_
-0001be70: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0001be80: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001be90: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-0001bea0: 6469 725f 7061 7468 203d 2022 2573 2f25  dir_path = "%s/%
-0001beb0: 7322 2025 2028 6261 7365 5f6d 6f64 5f70  s" % (base_mod_p
-0001bec0: 6174 682c 2070 290a 2020 2020 2020 2020  ath, p).        
-0001bed0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001bee0: 7468 2e69 7364 6972 2866 756c 6c5f 6469  th.isdir(full_di
-0001bef0: 725f 7061 7468 293a 0a20 2020 2020 2020  r_path):.       
-0001bf00: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001bf10: 6520 2023 2069 676e 6f72 6520 666f 7220  e  # ignore for 
-0001bf20: 6e6f 770a 2020 2020 2020 2020 2020 2020  now.            
-0001bf30: 6c6f 636b 203d 204c 6f63 6b46 696c 6528  lock = LockFile(
-0001bf40: 6675 6c6c 5f64 6972 5f70 6174 6829 0a20  full_dir_path). 
-0001bf50: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
-0001bf60: 636b 2e69 735f 6c6f 636b 6564 2829 3a0a  ck.is_locked():.
-0001bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf80: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001bf90: 2020 2020 206c 6f63 6b2e 6d61 7962 655f       lock.maybe_
-0001bfa0: 7265 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66  remove_old_lockf
-0001bfb0: 696c 6528 290a 2020 2020 2020 2020 2020  ile().          
-0001bfc0: 2020 696e 666f 5f70 6174 6820 3d20 2225    info_path = "%
-0001bfd0: 732f 696e 666f 2e70 7922 2025 2066 756c  s/info.py" % ful
-0001bfe0: 6c5f 6469 725f 7061 7468 0a20 2020 2020  l_dir_path.     
-0001bff0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0001c000: 2e70 6174 682e 6578 6973 7473 2869 6e66  .path.exists(inf
-0001c010: 6f5f 7061 7468 293a 0a20 2020 2020 2020  o_path):.       
-0001c020: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0001c030: 6c65 616e 7570 5f6f 6c64 5f70 6174 6828  leanup_old_path(
-0001c040: 6675 6c6c 5f64 6972 5f70 6174 682c 2072  full_dir_path, r
-0001c050: 6561 736f 6e3d 2263 6f72 7275 7074 2064  eason="corrupt d
-0001c060: 6972 2c20 6d69 7373 696e 6720 696e 666f  ir, missing info
-0001c070: 2e70 7922 290a 2020 2020 2020 2020 2020  .py").          
-0001c080: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001c090: 2020 2020 2020 2020 2020 2073 6f5f 7061             so_pa
-0001c0a0: 7468 203d 2022 2573 2f25 732e 736f 2220  th = "%s/%s.so" 
-0001c0b0: 2520 2866 756c 6c5f 6469 725f 7061 7468  % (full_dir_path
-0001c0c0: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
-0001c0d0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0001c0e0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-0001c0f0: 7374 7328 736f 5f70 6174 6829 3a0a 2020  sts(so_path):.  
-0001c100: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001c110: 6c66 2e5f 636c 6561 6e75 705f 6f6c 645f  lf._cleanup_old_
-0001c120: 7061 7468 2866 756c 6c5f 6469 725f 7061  path(full_dir_pa
-0001c130: 7468 2c20 7265 6173 6f6e 3d22 636f 7272  th, reason="corr
-0001c140: 7570 7420 6469 722c 206d 6973 7369 6e67  upt dir, missing
-0001c150: 2073 6f22 290a 2020 2020 2020 2020 2020   so").          
-0001c160: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001c170: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
-0001c180: 7469 6d65 2e74 696d 6528 2920 2d20 6f73  time.time() - os
-0001c190: 2e70 6174 682e 6765 746d 7469 6d65 2873  .path.getmtime(s
-0001c1a0: 6f5f 7061 7468 290a 2020 2020 2020 2020  o_path).        
-0001c1b0: 2020 2020 6966 2064 7420 3e20 636c 6561      if dt > clea
-0001c1c0: 6e75 705f 7469 6d65 5f6c 696d 6974 5f73  nup_time_limit_s
-0001c1d0: 6563 733a 0a20 2020 2020 2020 2020 2020  ecs:.           
-0001c1e0: 2020 2020 2073 656c 662e 5f63 6c65 616e       self._clean
-0001c1f0: 7570 5f6f 6c64 5f70 6174 6828 6675 6c6c  up_old_path(full
-0001c200: 5f64 6972 5f70 6174 682c 2072 6561 736f  _dir_path, reaso
-0001c210: 6e3d 2225 7320 6f6c 6422 2025 2068 6d73  n="%s old" % hms
-0001c220: 2864 7429 290a 0a20 2020 2064 6566 205f  (dt))..    def _
-0001c230: 636c 6561 6e75 705f 6f6c 645f 7061 7468  cleanup_old_path
-0001c240: 2873 656c 662c 2070 2c20 7265 6173 6f6e  (self, p, reason
-0001c250: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
-0001c260: 2822 2573 2064 656c 6574 6520 6f6c 642c  ("%s delete old,
-0001c270: 2025 733a 2025 7322 2025 2028 7365 6c66   %s: %s" % (self
-0001c280: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0001c290: 655f 5f2c 2072 6561 736f 6e2c 2070 2929  e__, reason, p))
-0001c2a0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001c2b0: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-0001c2c0: 290a 2020 2020 2020 2020 696d 706f 7274  ).        import
-0001c2d0: 2073 6875 7469 6c0a 0a20 2020 2020 2020   shutil..       
-0001c2e0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001c2f0: 2020 7368 7574 696c 2e72 6d74 7265 6528    shutil.rmtree(
-0001c300: 7029 0a20 2020 2020 2020 2065 7863 6570  p).        excep
-0001c310: 7420 4f53 4572 726f 7220 6173 2065 7863  t OSError as exc
-0001c320: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0001c330: 696e 7428 2225 7320 6465 6c65 7465 2065  int("%s delete e
-0001c340: 7863 6570 7469 6f6e 2028 2573 292e 2057  xception (%s). W
-0001c350: 696c 6c20 6967 6e6f 7265 2061 6e64 2074  ill ignore and t
-0001c360: 7279 2074 6f20 636f 6e74 696e 7565 2061  ry to continue a
-0001c370: 6e79 7761 792e 2220 2520 2873 656c 662e  nyway." % (self.
-0001c380: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001c390: 5f5f 2c20 6578 6329 290a 0a20 2020 2064  __, exc))..    d
-0001c3a0: 6566 205f 6c6f 6164 5f69 6e66 6f28 7365  ef _load_info(se
-0001c3b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001c3c0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0001c3d0: 2064 6963 745b 7374 725d 7c4e 6f6e 650a   dict[str]|None.
-0001c3e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c3f0: 2020 2020 6669 6c65 6e61 6d65 203d 2073      filename = s
-0001c400: 656c 662e 5f69 6e66 6f5f 6669 6c65 6e61  elf._info_filena
-0001c410: 6d65 0a20 2020 2020 2020 2069 6620 6e6f  me.        if no
-0001c420: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-0001c430: 2866 696c 656e 616d 6529 3a0a 2020 2020  (filename):.    
-0001c440: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001c450: 6f6e 650a 2020 2020 2020 2020 7320 3d20  one.        s = 
-0001c460: 6f70 656e 2866 696c 656e 616d 6529 2e72  open(filename).r
-0001c470: 6561 6428 290a 2020 2020 2020 2020 7265  ead().        re
-0001c480: 7320 3d20 6576 616c 2873 290a 2020 2020  s = eval(s).    
-0001c490: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-0001c4a0: 7461 6e63 6528 7265 732c 2064 6963 7429  tance(res, dict)
-0001c4b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c4c0: 7265 730a 0a20 2020 205f 7265 6c65 7661  res..    _releva
-0001c4d0: 6e74 5f69 6e66 6f5f 6b65 7973 203d 2028  nt_info_keys = (
-0001c4e0: 2263 6f64 655f 7665 7273 696f 6e22 2c20  "code_version", 
-0001c4f0: 2263 6f64 655f 6861 7368 222c 2022 635f  "code_hash", "c_
-0001c500: 6d61 6372 6f5f 6465 6669 6e65 7322 2c20  macro_defines", 
-0001c510: 226c 645f 666c 6167 7322 2c20 2263 6f6d  "ld_flags", "com
-0001c520: 7069 6c65 725f 6269 6e22 290a 0a20 2020  piler_bin")..   
-0001c530: 2064 6566 205f 6d61 6b65 5f69 6e66 6f5f   def _make_info_
-0001c540: 6469 6374 2873 656c 6629 3a0a 2020 2020  dict(self):.    
-0001c550: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001c560: 3a72 7479 7065 3a20 6469 6374 5b73 7472  :rtype: dict[str
-0001c570: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-0001c580: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
-0001c590: 2020 2020 2020 2020 2020 2022 6261 7365             "base
-0001c5a0: 5f6e 616d 6522 3a20 7365 6c66 2e62 6173  _name": self.bas
-0001c5b0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-0001c5c0: 2020 2020 2269 6e63 6c75 6465 5f70 6174      "include_pat
-0001c5d0: 6873 223a 2073 656c 662e 5f69 6e63 6c75  hs": self._inclu
-0001c5e0: 6465 5f70 6174 6873 2c0a 2020 2020 2020  de_paths,.      
-0001c5f0: 2020 2020 2020 2263 6f64 655f 7665 7273        "code_vers
-0001c600: 696f 6e22 3a20 7365 6c66 2e63 6f64 655f  ion": self.code_
-0001c610: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
-0001c620: 2020 2020 2022 636f 6465 5f68 6173 6822       "code_hash"
-0001c630: 3a20 7365 6c66 2e5f 636f 6465 5f68 6173  : self._code_has
-0001c640: 682c 0a20 2020 2020 2020 2020 2020 2022  h,.            "
-0001c650: 635f 6d61 6372 6f5f 6465 6669 6e65 7322  c_macro_defines"
-0001c660: 3a20 7365 6c66 2e63 5f6d 6163 726f 5f64  : self.c_macro_d
-0001c670: 6566 696e 6573 2c0a 2020 2020 2020 2020  efines,.        
-0001c680: 2020 2020 226c 645f 666c 6167 7322 3a20      "ld_flags": 
-0001c690: 7365 6c66 2e6c 645f 666c 6167 732c 0a20  self.ld_flags,. 
-0001c6a0: 2020 2020 2020 2020 2020 2022 636f 6d70             "comp
-0001c6b0: 696c 6572 5f62 696e 223a 2073 656c 662e  iler_bin": self.
-0001c6c0: 5f67 6574 5f63 6f6d 7069 6c65 725f 6269  _get_compiler_bi
-0001c6d0: 6e28 292c 0a20 2020 2020 2020 207d 0a0a  n(),.        }..
-0001c6e0: 2020 2020 6465 6620 5f6d 616b 655f 636f      def _make_co
-0001c6f0: 6465 5f68 6173 6828 7365 6c66 293a 0a20  de_hash(self):. 
-0001c700: 2020 2020 2020 2069 6d70 6f72 7420 6861         import ha
-0001c710: 7368 6c69 620a 0a20 2020 2020 2020 2068  shlib..        h
-0001c720: 203d 2068 6173 686c 6962 2e6d 6435 2829   = hashlib.md5()
-0001c730: 0a20 2020 2020 2020 2068 2e75 7064 6174  .        h.updat
-0001c740: 6528 7365 6c66 2e63 6f64 652e 656e 636f  e(self.code.enco
-0001c750: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
-0001c760: 2020 2020 7265 7475 726e 2068 2e68 6578      return h.hex
-0001c770: 6469 6765 7374 2829 0a0a 2020 2020 6465  digest()..    de
-0001c780: 6620 5f6d 616b 655f 6861 7368 2873 656c  f _make_hash(sel
-0001c790: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
-0001c7a0: 7274 2068 6173 686c 6962 0a0a 2020 2020  rt hashlib..    
-0001c7b0: 2020 2020 6820 3d20 6861 7368 6c69 622e      h = hashlib.
-0001c7c0: 6d64 3528 290a 2020 2020 2020 2020 682e  md5().        h.
-0001c7d0: 7570 6461 7465 2822 7b22 2e65 6e63 6f64  update("{".encod
-0001c7e0: 6528 2275 7466 3822 2929 0a20 2020 2020  e("utf8")).     
-0001c7f0: 2020 2066 6f72 206b 6579 2069 6e20 7365     for key in se
-0001c800: 6c66 2e5f 7265 6c65 7661 6e74 5f69 6e66  lf._relevant_inf
-0001c810: 6f5f 6b65 7973 3a0a 2020 2020 2020 2020  o_keys:.        
-0001c820: 2020 2020 682e 7570 6461 7465 2828 2225      h.update(("%
-0001c830: 733a 7b25 737d 2220 2520 286b 6579 2c20  s:{%s}" % (key, 
-0001c840: 7365 6c66 2e5f 696e 666f 5f64 6963 745b  self._info_dict[
-0001c850: 6b65 795d 2929 2e65 6e63 6f64 6528 2275  key])).encode("u
-0001c860: 7466 3822 2929 0a20 2020 2020 2020 2068  tf8")).        h
-0001c870: 2e75 7064 6174 6528 227d 222e 656e 636f  .update("}".enco
-0001c880: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
-0001c890: 2020 2020 7265 7475 726e 2068 2e68 6578      return h.hex
-0001c8a0: 6469 6765 7374 2829 0a0a 2020 2020 6465  digest()..    de
-0001c8b0: 6620 5f73 6176 655f 696e 666f 2873 656c  f _save_info(sel
-0001c8c0: 6629 3a0a 2020 2020 2020 2020 6669 6c65  f):.        file
-0001c8d0: 6e61 6d65 203d 2073 656c 662e 5f69 6e66  name = self._inf
-0001c8e0: 6f5f 6669 6c65 6e61 6d65 0a20 2020 2020  o_filename.     
-0001c8f0: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
-0001c900: 656e 616d 652c 2022 7722 2920 6173 2066  ename, "w") as f
-0001c910: 3a0a 2020 2020 2020 2020 2020 2020 662e  :.            f.
-0001c920: 7772 6974 6528 2225 735c 6e22 2025 2062  write("%s\n" % b
-0001c930: 6574 7465 725f 7265 7072 2873 656c 662e  etter_repr(self.
-0001c940: 5f69 6e66 6f5f 6469 6374 2929 0a0a 2020  _info_dict))..  
-0001c950: 2020 6465 6620 5f6e 6565 645f 7265 636f    def _need_reco
-0001c960: 6d70 696c 6528 7365 6c66 293a 0a20 2020  mpile(self):.   
-0001c970: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c980: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
-0001c990: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001c9a0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-0001c9b0: 2e65 7869 7374 7328 7365 6c66 2e5f 736f  .exists(self._so
-0001c9c0: 5f66 696c 656e 616d 6529 3a0a 2020 2020  _filename):.    
-0001c9d0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0001c9e0: 7275 650a 2020 2020 2020 2020 6966 2073  rue.        if s
-0001c9f0: 656c 662e 696e 636c 7564 655f 6465 7073  elf.include_deps
-0001ca00: 3a0a 2020 2020 2020 2020 2020 2020 736f  :.            so
-0001ca10: 5f6d 7469 6d65 203d 206f 732e 7061 7468  _mtime = os.path
-0001ca20: 2e67 6574 6d74 696d 6528 7365 6c66 2e5f  .getmtime(self._
-0001ca30: 736f 5f66 696c 656e 616d 6529 0a20 2020  so_filename).   
-0001ca40: 2020 2020 2020 2020 2066 6f72 2066 6e20           for fn 
-0001ca50: 696e 2073 656c 662e 696e 636c 7564 655f  in self.include_
-0001ca60: 6465 7073 3a0a 2020 2020 2020 2020 2020  deps:.          
-0001ca70: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0001ca80: 2e67 6574 6d74 696d 6528 666e 2920 3e20  .getmtime(fn) > 
-0001ca90: 736f 5f6d 7469 6d65 3a0a 2020 2020 2020  so_mtime:.      
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001cab0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001cac0: 2020 6f6c 645f 696e 666f 203d 2073 656c    old_info = sel
-0001cad0: 662e 5f6c 6f61 645f 696e 666f 2829 0a20  f._load_info(). 
-0001cae0: 2020 2020 2020 206e 6577 5f69 6e66 6f20         new_info 
-0001caf0: 3d20 7365 6c66 2e5f 6d61 6b65 5f69 6e66  = self._make_inf
-0001cb00: 6f5f 6469 6374 2829 0a20 2020 2020 2020  o_dict().       
-0001cb10: 2069 6620 6e6f 7420 6f6c 645f 696e 666f   if not old_info
-0001cb20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001cb30: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001cb40: 2020 2320 5468 6520 6861 7368 2061 6c72    # The hash alr
-0001cb50: 6561 6479 206d 6174 6368 6564 2062 7574  eady matched but
-0001cb60: 2076 6572 7920 756e 6c69 6b65 6c79 2c20   very unlikely, 
-0001cb70: 7468 6973 2063 6f75 6c64 2062 6520 6120  this could be a 
-0001cb80: 636f 6c6c 6973 696f 6e2e 0a20 2020 2020  collision..     
-0001cb90: 2020 2023 2041 6e79 7761 792c 206a 7573     # Anyway, jus
-0001cba0: 7420 646f 2074 6869 7320 7665 7279 2063  t do this very c
-0001cbb0: 6865 6170 2063 6865 636b 2e0a 2020 2020  heap check..    
-0001cbc0: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
-0001cbd0: 656c 662e 5f72 656c 6576 616e 745f 696e  elf._relevant_in
-0001cbe0: 666f 5f6b 6579 733a 0a20 2020 2020 2020  fo_keys:.       
-0001cbf0: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
-0001cc00: 696e 206f 6c64 5f69 6e66 6f3a 0a20 2020  in old_info:.   
-0001cc10: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001cc20: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-0001cc30: 2020 2020 2069 6620 6f6c 645f 696e 666f       if old_info
-0001cc40: 5b6b 6579 5d20 213d 206e 6577 5f69 6e66  [key] != new_inf
-0001cc50: 6f5b 6b65 795d 3a0a 2020 2020 2020 2020  o[key]:.        
-0001cc60: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0001cc70: 7275 650a 2020 2020 2020 2020 2320 4966  rue.        # If
-0001cc80: 206e 6f20 636f 6465 2076 6572 7369 6f6e   no code version
-0001cc90: 2069 7320 7072 6f76 6964 6564 2c20 7765   is provided, we
-0001cca0: 2063 6f75 6c64 2061 6c73 6f20 6368 6563   could also chec
-0001ccb0: 6b20 7468 6520 636f 6465 2069 7473 656c  k the code itsel
-0001ccc0: 6620 6e6f 772e 0a20 2020 2020 2020 2023  f now..        #
-0001ccd0: 2042 7574 2049 2074 6869 6e6b 2074 6869   But I think thi
-0001cce0: 7320 6973 206f 7665 726b 696c 6c2e 0a20  s is overkill.. 
-0001ccf0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0001cd00: 6c73 650a 0a20 2020 2064 6566 205f 6d61  lse..    def _ma
-0001cd10: 7962 655f 636f 6d70 696c 6528 7365 6c66  ybe_compile(self
-0001cd20: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001cd30: 2020 2020 2020 204f 6e20 7375 6363 6573         On succes
-0001cd40: 7366 756c 2072 6574 7572 6e2c 2073 656c  sful return, sel
-0001cd50: 662e 5f73 6f5f 6669 6c65 6e61 6d65 2073  f._so_filename s
-0001cd60: 686f 756c 6420 6578 6973 7420 616e 6420  hould exist and 
-0001cd70: 6265 2075 702d 746f 2d64 6174 652e 0a20  be up-to-date.. 
-0001cd80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001cd90: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
-0001cda0: 6e65 6564 5f72 6563 6f6d 7069 6c65 2829  need_recompile()
-0001cdb0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001cdc0: 2073 656c 662e 7665 7262 6f73 653a 0a20   self.verbose:. 
-0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001cde0: 7269 6e74 2822 2573 3a20 4e6f 206e 6565  rint("%s: No nee
-0001cdf0: 6420 746f 2072 6563 6f6d 7069 6c65 3a20  d to recompile: 
-0001ce00: 2573 2220 2520 2873 656c 662e 5f5f 636c  %s" % (self.__cl
-0001ce10: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
-0001ce20: 7365 6c66 2e5f 736f 5f66 696c 656e 616d  self._so_filenam
-0001ce30: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0001ce40: 2320 546f 7563 6820 6974 2073 6f20 7468  # Touch it so th
-0001ce50: 6174 2077 6520 6361 6e20 7365 6520 7468  at we can see th
-0001ce60: 6174 2077 6520 7573 6564 2069 7420 7265  at we used it re
-0001ce70: 6365 6e74 6c79 2e0a 2020 2020 2020 2020  cently..        
-0001ce80: 2020 2020 6f73 2e75 7469 6d65 2873 656c      os.utime(sel
-0001ce90: 662e 5f69 6e66 6f5f 6669 6c65 6e61 6d65  f._info_filename
-0001cea0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0001ceb0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001cec0: 2020 206c 6f63 6b20 3d20 4c6f 636b 4669     lock = LockFi
-0001ced0: 6c65 2873 656c 662e 5f6d 6f64 5f70 6174  le(self._mod_pat
-0001cee0: 6829 0a20 2020 2020 2020 2069 6620 6e6f  h).        if no
-0001cef0: 7420 7365 6c66 2e5f 6e65 6564 5f72 6563  t self._need_rec
-0001cf00: 6f6d 7069 6c65 2829 3a20 2023 2063 6865  ompile():  # che
-0001cf10: 636b 2061 6761 696e 0a20 2020 2020 2020  ck again.       
-0001cf20: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
-0001cf30: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-0001cf40: 2020 2020 2020 7072 696e 7428 2225 733a        print("%s:
-0001cf50: 204e 6f20 6e65 6564 2074 6f20 7265 636f   No need to reco
-0001cf60: 6d70 696c 6520 6166 7465 7220 7765 2077  mpile after we w
-0001cf70: 6169 7465 643a 2025 7322 2025 2028 7365  aited: %s" % (se
-0001cf80: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
-0001cf90: 616d 655f 5f2c 2073 656c 662e 5f73 6f5f  ame__, self._so_
-0001cfa0: 6669 6c65 6e61 6d65 2929 0a20 2020 2020  filename)).     
-0001cfb0: 2020 2020 2020 206f 732e 7574 696d 6528         os.utime(
-0001cfc0: 7365 6c66 2e5f 696e 666f 5f66 696c 656e  self._info_filen
-0001cfd0: 616d 652c 204e 6f6e 6529 0a20 2020 2020  ame, None).     
-0001cfe0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001cff0: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
-0001d000: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
-0001d010: 645f 6d79 6469 7220 616e 6420 6e6f 7420  d_mydir and not 
-0001d020: 6c6f 636b 2e69 735f 6c6f 636b 6564 2829  lock.is_locked()
-0001d030: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001d040: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001d050: 7365 6c66 2e5f 6d6f 645f 7061 7468 293a  self._mod_path):
-0001d060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d070: 2073 656c 662e 5f63 6c65 616e 7570 5f6f   self._cleanup_o
-0001d080: 6c64 5f70 6174 6828 7365 6c66 2e5f 6d6f  ld_path(self._mo
-0001d090: 645f 7061 7468 2c20 7265 6173 6f6e 3d22  d_path, reason="
-0001d0a0: 6e65 6564 2072 6563 6f6d 7069 6c65 2229  need recompile")
-0001d0b0: 0a20 2020 2020 2020 2077 6974 6820 6c6f  .        with lo
-0001d0c0: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-0001d0d0: 7365 6c66 2e5f 6d61 7962 655f 636f 6d70  self._maybe_comp
-0001d0e0: 696c 655f 696e 6e65 7228 290a 0a20 2020  ile_inner()..   
-0001d0f0: 2064 6566 205f 6765 745f 636f 6d70 696c   def _get_compil
-0001d100: 6572 5f62 696e 2873 656c 6629 3a0a 2020  er_bin(self):.  
-0001d110: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001d120: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-0001d130: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001d140: 2020 6966 2073 656c 662e 6973 5f63 7070    if self.is_cpp
-0001d150: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001d160: 7475 726e 2022 672b 2b22 0a20 2020 2020  turn "g++".     
-0001d170: 2020 2072 6574 7572 6e20 2267 6363 220a     return "gcc".
-0001d180: 0a20 2020 2064 6566 205f 7472 616e 7366  .    def _transf
-0001d190: 6f72 6d5f 636f 6d70 696c 6572 5f6f 7074  orm_compiler_opt
-0001d1a0: 7328 7365 6c66 2c20 6f70 7473 293a 0a20  s(self, opts):. 
-0001d1b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001d1c0: 2020 203a 7061 7261 6d20 6c69 7374 5b73     :param list[s
-0001d1d0: 7472 5d20 6f70 7473 3a0a 2020 2020 2020  tr] opts:.      
-0001d1e0: 2020 3a72 7479 7065 3a20 6c69 7374 5b73    :rtype: list[s
-0001d1f0: 7472 5d0a 2020 2020 2020 2020 2222 220a  tr].        """.
-0001d200: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001d210: 7074 730a 0a20 2020 2064 6566 205f 6578  pts..    def _ex
-0001d220: 7472 615f 636f 6d6d 6f6e 5f6f 7074 7328  tra_common_opts(
-0001d230: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0001d240: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
-0001d250: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
-0001d260: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001d270: 2069 6620 7365 6c66 2e69 735f 6370 703a   if self.is_cpp:
-0001d280: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001d290: 7572 6e20 5b22 2d73 7464 3d63 2b2b 3131  urn ["-std=c++11
-0001d2a0: 225d 0a20 2020 2020 2020 2072 6574 7572  "].        retur
-0001d2b0: 6e20 5b5d 0a0a 2020 2020 4063 6c61 7373  n []..    @class
-0001d2c0: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-0001d2d0: 7472 616e 7366 6f72 6d5f 6c64 5f66 6c61  transform_ld_fla
-0001d2e0: 6728 636c 732c 206f 7074 293a 0a20 2020  g(cls, opt):.   
-0001d2f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001d300: 203a 7061 7261 6d20 7374 7220 6f70 743a   :param str opt:
-0001d310: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0001d320: 2073 7472 0a20 2020 2020 2020 2022 2222   str.        """
-0001d330: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
-0001d340: 706c 6174 666f 726d 203d 3d20 2264 6172  platform == "dar
-0001d350: 7769 6e22 3a0a 2020 2020 2020 2020 2020  win":.          
-0001d360: 2020 2320 4974 2073 6565 6d73 2073 6f6d    # It seems som
-0001d370: 6520 7665 7273 696f 6e73 206f 6620 4d61  e versions of Ma
-0001d380: 634f 5320 6c64 2063 616e 6e6f 7420 6861  cOS ld cannot ha
-0001d390: 6e64 6c65 2074 6865 2060 2d6c 3a66 696c  ndle the `-l:fil
-0001d3a0: 656e 616d 6560 2061 7267 756d 656e 7420  ename` argument 
-0001d3b0: 636f 7272 6563 746c 792e 0a20 2020 2020  correctly..     
-0001d3c0: 2020 2020 2020 2023 2045 2e67 2e20 5465         # E.g. Te
-0001d3d0: 6e73 6f72 466c 6f77 2031 2e31 3420 696e  nsorFlow 1.14 in
-0001d3e0: 636f 7272 6563 746c 7920 7573 6573 2074  correctly uses t
-0001d3f0: 6869 732e 0a20 2020 2020 2020 2020 2020  his..           
-0001d400: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
-0001d410: 622e 636f 6d2f 7465 6e73 6f72 666c 6f77  b.com/tensorflow
-0001d420: 2f74 656e 736f 7266 6c6f 772f 6973 7375  /tensorflow/issu
-0001d430: 6573 2f33 3035 3634 0a20 2020 2020 2020  es/30564.       
-0001d440: 2020 2020 2069 6620 6f70 742e 7374 6172       if opt.star
-0001d450: 7473 7769 7468 2822 2d6c 3a6c 6962 2229  tswith("-l:lib")
-0001d460: 2061 6e64 206f 7074 2e65 6e64 7377 6974   and opt.endswit
-0001d470: 6828 222e 6479 6c69 6222 293a 0a20 2020  h(".dylib"):.   
-0001d480: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001d490: 7572 6e20 222d 6c25 7322 2025 206f 7074  urn "-l%s" % opt
-0001d4a0: 5b6c 656e 2822 2d6c 3a6c 6962 2229 203a  [len("-l:lib") :
-0001d4b0: 202d 6c65 6e28 222e 6479 6c69 6222 295d   -len(".dylib")]
-0001d4c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d4d0: 6f70 740a 0a20 2020 2064 6566 205f 6d61  opt..    def _ma
-0001d4e0: 7962 655f 636f 6d70 696c 655f 696e 6e65  ybe_compile_inne
-0001d4f0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-0001d500: 2023 2044 6972 6563 746f 7279 2073 686f   # Directory sho
-0001d510: 756c 6420 6265 2063 7265 6174 6564 2062  uld be created b
-0001d520: 7920 7468 6520 6c6f 636b 696e 6720 6d65  y the locking me
-0001d530: 6368 616e 6973 6d2e 0a20 2020 2020 2020  chanism..       
-0001d540: 2061 7373 6572 7420 6f73 2e70 6174 682e   assert os.path.
-0001d550: 6578 6973 7473 2873 656c 662e 5f6d 6f64  exists(self._mod
-0001d560: 5f70 6174 6829 0a20 2020 2020 2020 2077  _path).        w
-0001d570: 6974 6820 6f70 656e 2873 656c 662e 5f63  ith open(self._c
-0001d580: 5f66 696c 656e 616d 652c 2022 7722 2920  _filename, "w") 
-0001d590: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-0001d5a0: 2020 662e 7772 6974 6528 7365 6c66 2e63    f.write(self.c
-0001d5b0: 6f64 6529 0a20 2020 2020 2020 2063 6f6d  ode).        com
-0001d5c0: 6d6f 6e5f 6f70 7473 203d 205b 222d 7368  mon_opts = ["-sh
-0001d5d0: 6172 6564 222c 2022 2d4f 3222 5d0a 2020  ared", "-O2"].  
-0001d5e0: 2020 2020 2020 636f 6d6d 6f6e 5f6f 7074        common_opt
-0001d5f0: 7320 2b3d 2073 656c 662e 5f65 7874 7261  s += self._extra
-0001d600: 5f63 6f6d 6d6f 6e5f 6f70 7473 2829 0a20  _common_opts(). 
-0001d610: 2020 2020 2020 2069 6620 7379 732e 706c         if sys.pl
-0001d620: 6174 666f 726d 203d 3d20 2264 6172 7769  atform == "darwi
-0001d630: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
-0001d640: 636f 6d6d 6f6e 5f6f 7074 7320 2b3d 205b  common_opts += [
-0001d650: 222d 756e 6465 6669 6e65 6422 2c20 2264  "-undefined", "d
-0001d660: 796e 616d 6963 5f6c 6f6f 6b75 7022 5d0a  ynamic_lookup"].
-0001d670: 2020 2020 2020 2020 666f 7220 696e 636c          for incl
-0001d680: 7564 655f 7061 7468 2069 6e20 7365 6c66  ude_path in self
-0001d690: 2e5f 696e 636c 7564 655f 7061 7468 733a  ._include_paths:
-0001d6a0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0001d6b0: 6d6f 6e5f 6f70 7473 202b 3d20 5b22 2d49  mon_opts += ["-I
-0001d6c0: 222c 2069 6e63 6c75 6465 5f70 6174 685d  ", include_path]
-0001d6d0: 0a20 2020 2020 2020 2063 6f6d 7069 6c65  .        compile
-0001d6e0: 725f 6f70 7473 203d 205b 222d 6650 4943  r_opts = ["-fPIC
-0001d6f0: 222c 2022 2d76 225d 0a20 2020 2020 2020  ", "-v"].       
-0001d700: 2063 6f6d 6d6f 6e5f 6f70 7473 202b 3d20   common_opts += 
-0001d710: 7365 6c66 2e5f 7472 616e 7366 6f72 6d5f  self._transform_
-0001d720: 636f 6d70 696c 6572 5f6f 7074 7328 636f  compiler_opts(co
-0001d730: 6d70 696c 6572 5f6f 7074 7329 0a20 2020  mpiler_opts).   
-0001d740: 2020 2020 2063 6f6d 6d6f 6e5f 6f70 7473       common_opts
-0001d750: 202b 3d20 5b22 2d44 5f47 4c49 4243 5858   += ["-D_GLIBCXX
-0001d760: 5f55 5345 5f43 5858 3131 5f41 4249 3d25  _USE_CXX11_ABI=%
-0001d770: 6922 2025 2028 3120 6966 2073 656c 662e  i" % (1 if self.
-0001d780: 7573 655f 6378 7831 315f 6162 6920 656c  use_cxx11_abi el
-0001d790: 7365 2030 295d 0a20 2020 2020 2020 2063  se 0)].        c
-0001d7a0: 6f6d 6d6f 6e5f 6f70 7473 202b 3d20 5b22  ommon_opts += ["
-0001d7b0: 2d44 2573 3d25 7322 2025 2069 7465 6d20  -D%s=%s" % item 
-0001d7c0: 666f 7220 6974 656d 2069 6e20 736f 7274  for item in sort
-0001d7d0: 6564 2873 656c 662e 635f 6d61 6372 6f5f  ed(self.c_macro_
-0001d7e0: 6465 6669 6e65 732e 6974 656d 7328 2929  defines.items())
-0001d7f0: 5d0a 2020 2020 2020 2020 636f 6d6d 6f6e  ].        common
-0001d800: 5f6f 7074 7320 2b3d 205b 222d 6722 5d0a  _opts += ["-g"].
-0001d810: 2020 2020 2020 2020 6f70 7473 203d 2063          opts = c
-0001d820: 6f6d 6d6f 6e5f 6f70 7473 202b 205b 7365  ommon_opts + [se
-0001d830: 6c66 2e5f 635f 6669 6c65 6e61 6d65 2c20  lf._c_filename, 
-0001d840: 222d 6f22 2c20 7365 6c66 2e5f 736f 5f66  "-o", self._so_f
-0001d850: 696c 656e 616d 655d 0a20 2020 2020 2020  ilename].       
-0001d860: 206f 7074 7320 2b3d 206c 6973 7428 6d61   opts += list(ma
-0001d870: 7028 7365 6c66 2e5f 7472 616e 7366 6f72  p(self._transfor
-0001d880: 6d5f 6c64 5f66 6c61 672c 2073 656c 662e  m_ld_flag, self.
-0001d890: 6c64 5f66 6c61 6773 2929 0a20 2020 2020  ld_flags)).     
-0001d8a0: 2020 2063 6d64 5f62 696e 203d 2073 656c     cmd_bin = sel
-0001d8b0: 662e 5f67 6574 5f63 6f6d 7069 6c65 725f  f._get_compiler_
-0001d8c0: 6269 6e28 290a 2020 2020 2020 2020 636d  bin().        cm
-0001d8d0: 645f 6172 6773 203d 205b 636d 645f 6269  d_args = [cmd_bi
-0001d8e0: 6e5d 202b 206f 7074 730a 2020 2020 2020  n] + opts.      
-0001d8f0: 2020 6672 6f6d 2073 7562 7072 6f63 6573    from subproces
-0001d900: 7320 696d 706f 7274 2050 6f70 656e 2c20  s import Popen, 
-0001d910: 5049 5045 2c20 5354 444f 5554 2c20 4361  PIPE, STDOUT, Ca
-0001d920: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-0001d930: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-0001d940: 2225 7320 6361 6c6c 3a20 2573 2220 2520  "%s call: %s" % 
-0001d950: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
-0001d960: 5f5f 6e61 6d65 5f5f 2c20 2220 222e 6a6f  __name__, " ".jo
-0001d970: 696e 2863 6d64 5f61 7267 7329 292c 2066  in(cmd_args)), f
-0001d980: 696c 653d 7365 6c66 2e5f 6c6f 675f 7374  ile=self._log_st
-0001d990: 7265 616d 290a 2020 2020 2020 2020 7072  ream).        pr
-0001d9a0: 6f63 203d 2050 6f70 656e 2863 6d64 5f61  oc = Popen(cmd_a
-0001d9b0: 7267 732c 2063 7764 3d73 656c 662e 5f6d  rgs, cwd=self._m
-0001d9c0: 6f64 5f70 6174 682c 2073 7464 6f75 743d  od_path, stdout=
-0001d9d0: 5049 5045 2c20 7374 6465 7272 3d53 5444  PIPE, stderr=STD
-0001d9e0: 4f55 5429 0a20 2020 2020 2020 2073 7464  OUT).        std
-0001d9f0: 6f75 742c 2073 7464 6572 7220 3d20 7072  out, stderr = pr
-0001da00: 6f63 2e63 6f6d 6d75 6e69 6361 7465 2829  oc.communicate()
-0001da10: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001da20: 7374 6465 7272 2069 7320 4e6f 6e65 2020  stderr is None  
-0001da30: 2320 7368 6f75 6c64 206f 6e6c 7920 6861  # should only ha
-0001da40: 7665 2073 7464 6f75 740a 2020 2020 2020  ve stdout.      
-0001da50: 2020 6966 2070 726f 632e 7265 7475 726e    if proc.return
-0001da60: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
-0001da70: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
-0001da80: 3a20 2573 2066 6169 6c65 642e 2220 2520  : %s failed." % 
-0001da90: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
-0001daa0: 5f5f 6e61 6d65 5f5f 2c20 636d 645f 6269  __name__, cmd_bi
-0001dab0: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
-0001dac0: 7072 696e 7428 224f 7269 6769 6e61 6c20  print("Original 
-0001dad0: 7374 646f 7574 2f73 7464 6572 723a 2229  stdout/stderr:")
-0001dae0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001daf0: 6e74 2873 7464 6f75 742e 6465 636f 6465  nt(stdout.decode
-0001db00: 2822 7574 6638 2229 290a 2020 2020 2020  ("utf8")).      
-0001db10: 2020 2020 2020 7072 696e 7428 290a 2020        print().  
-0001db20: 2020 2020 2020 2020 2020 6966 2063 6d64            if cmd
-0001db30: 5f62 696e 2e65 6e64 7377 6974 6828 222f  _bin.endswith("/
-0001db40: 6e76 6363 2229 2061 6e64 2062 2265 7272  nvcc") and b"err
-0001db50: 6f72 3a20 636f 6e73 7465 7870 7220 6675  or: constexpr fu
-0001db60: 6e63 7469 6f6e 2072 6574 7572 6e20 6973  nction return is
-0001db70: 206e 6f6e 2d63 6f6e 7374 616e 7422 2069   non-constant" i
-0001db80: 6e20 7374 646f 7574 3a0a 2020 2020 2020  n stdout:.      
-0001db90: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001dba0: 2254 6869 7320 6d69 6768 7420 6265 2074  "This might be t
-0001dbb0: 6865 2065 7272 6f72 3a20 6874 7470 733a  he error: https:
-0001dbc0: 2f2f 6769 7468 7562 2e63 6f6d 2f74 656e  //github.com/ten
-0001dbd0: 736f 7266 6c6f 772f 7465 6e73 6f72 666c  sorflow/tensorfl
-0001dbe0: 6f77 2f69 7373 7565 732f 3232 3736 3622  ow/issues/22766"
-0001dbf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001dc00: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
-0001dc10: 2020 2020 2020 6966 2063 6d64 5f62 696e        if cmd_bin
-0001dc20: 2e65 6e64 7377 6974 6828 222f 6e76 6363  .endswith("/nvcc
-0001dc30: 2229 2061 6e64 2062 2267 6363 2076 6572  ") and b"gcc ver
-0001dc40: 7369 6f6e 7320 6c61 7465 7220 7468 616e  sions later than
-0001dc50: 2220 696e 2073 7464 6f75 743a 0a20 2020  " in stdout:.   
-0001dc60: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001dc70: 6e74 2822 596f 7572 2047 4343 2076 6572  nt("Your GCC ver
-0001dc80: 7369 6f6e 206d 6967 6874 2062 6520 746f  sion might be to
-0001dc90: 6f20 6e65 772e 2054 6869 7320 6973 2061  o new. This is a
-0001dca0: 2070 726f 626c 656d 2077 6974 6820 736f   problem with so
-0001dcb0: 6d65 206e 7663 6320 7665 7273 696f 6e73  me nvcc versions
-0001dcc0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001dcd0: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-0001dce0: 2020 2020 2020 2020 7261 6973 6520 4361          raise Ca
-0001dcf0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-0001dd00: 2872 6574 7572 6e63 6f64 653d 7072 6f63  (returncode=proc
-0001dd10: 2e72 6574 7572 6e63 6f64 652c 2063 6d64  .returncode, cmd
-0001dd20: 3d63 6d64 5f61 7267 7329 0a20 2020 2020  =cmd_args).     
-0001dd30: 2020 2061 7373 6572 7420 6f73 2e70 6174     assert os.pat
-0001dd40: 682e 6578 6973 7473 2873 656c 662e 5f73  h.exists(self._s
-0001dd50: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
-0001dd60: 2020 2020 7769 7468 206f 7065 6e28 2225      with open("%
-0001dd70: 732f 636f 6d70 696c 652e 6c6f 6722 2025  s/compile.log" %
-0001dd80: 2073 656c 662e 5f6d 6f64 5f70 6174 682c   self._mod_path,
-0001dd90: 2022 7762 2229 2061 7320 663a 0a20 2020   "wb") as f:.   
-0001dda0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0001ddb0: 2e76 6572 626f 7365 3a0a 2020 2020 2020  .verbose:.      
-0001ddc0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001ddd0: 2225 733a 2077 7269 7465 2063 6f6d 7069  "%s: write compi
-0001dde0: 6c65 206c 6f67 2074 6f3a 2025 7322 2025  le log to: %s" %
-0001ddf0: 2028 7365 6c66 2e5f 5f63 6c61 7373 5f5f   (self.__class__
-0001de00: 2e5f 5f6e 616d 655f 5f2c 2066 2e6e 616d  .__name__, f.nam
-0001de10: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0001de20: 662e 7772 6974 6528 2822 2b20 2573 5c6e  f.write(("+ %s\n
-0001de30: 2220 2520 2220 222e 6a6f 696e 2863 6d64  " % " ".join(cmd
-0001de40: 5f61 7267 7329 292e 656e 636f 6465 2822  _args)).encode("
-0001de50: 7574 6638 2229 290a 2020 2020 2020 2020  utf8")).        
-0001de60: 2020 2020 662e 7772 6974 6528 7374 646f      f.write(stdo
-0001de70: 7574 290a 2020 2020 2020 2020 7365 6c66  ut).        self
-0001de80: 2e5f 7361 7665 5f69 6e66 6f28 290a 2020  ._save_info().  
-0001de90: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-0001dea0: 2073 656c 662e 5f6e 6565 645f 7265 636f   self._need_reco
-0001deb0: 6d70 696c 6528 290a 0a20 2020 2064 6566  mpile()..    def
-0001dec0: 206c 6f61 645f 6c69 625f 6374 7970 6573   load_lib_ctypes
-0001ded0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001dee0: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
-0001def0: 7065 3a20 6374 7970 6573 2e43 444c 4c0a  pe: ctypes.CDLL.
-0001df00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001df10: 2020 2020 6966 2073 656c 662e 5f63 7479      if self._cty
-0001df20: 7065 735f 6c69 623a 0a20 2020 2020 2020  pes_lib:.       
-0001df30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001df40: 2e5f 6374 7970 6573 5f6c 6962 0a20 2020  ._ctypes_lib.   
-0001df50: 2020 2020 2073 656c 662e 5f6d 6179 6265       self._maybe
-0001df60: 5f63 6f6d 7069 6c65 2829 0a20 2020 2020  _compile().     
-0001df70: 2020 2069 6d70 6f72 7420 6374 7970 6573     import ctypes
-0001df80: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0001df90: 6374 7970 6573 5f6c 6962 203d 2063 7479  ctypes_lib = cty
-0001dfa0: 7065 732e 6364 6c6c 2e4c 6f61 644c 6962  pes.cdll.LoadLib
-0001dfb0: 7261 7279 2873 656c 662e 5f73 6f5f 6669  rary(self._so_fi
-0001dfc0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0001dfd0: 7265 7475 726e 2073 656c 662e 5f63 7479  return self._cty
-0001dfe0: 7065 735f 6c69 620a 0a20 2020 2064 6566  pes_lib..    def
-0001dff0: 2067 6574 5f6c 6962 5f66 696c 656e 616d   get_lib_filenam
-0001e000: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001e010: 2022 2222 0a20 2020 2020 2020 203a 7274   """.        :rt
-0001e020: 7970 653a 2073 7472 0a20 2020 2020 2020  ype: str.       
-0001e030: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-0001e040: 662e 5f6d 6179 6265 5f63 6f6d 7069 6c65  f._maybe_compile
-0001e050: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-0001e060: 6e20 7365 6c66 2e5f 736f 5f66 696c 656e  n self._so_filen
-0001e070: 616d 650a 0a0a 2320 5365 6520 3a66 756e  ame...# See :fun
-0001e080: 633a 606d 6179 6265 5f72 6573 7461 7274  c:`maybe_restart
-0001e090: 5f72 6574 7572 6e6e 5f77 6974 685f 6174  _returnn_with_at
-0001e0a0: 666f 726b 5f70 6174 6368 6020 6265 6c6f  fork_patch` belo
-0001e0b0: 7720 666f 7220 7768 7920 796f 7520 6d69  w for why you mi
-0001e0c0: 6768 7420 7761 6e74 2074 6f20 7573 6520  ght want to use 
-0001e0d0: 7468 6973 2e0a 5f63 5f63 6f64 655f 7061  this.._c_code_pa
-0001e0e0: 7463 685f 6174 666f 726b 203d 2022 2222  tch_atfork = """
-0001e0f0: 0a23 6465 6669 6e65 205f 474e 555f 534f  .#define _GNU_SO
-0001e100: 5552 4345 0a23 696e 636c 7564 6520 3c73  URCE.#include <s
-0001e110: 6368 6564 2e68 3e0a 2369 6e63 6c75 6465  ched.h>.#include
-0001e120: 203c 7369 676e 616c 2e68 3e0a 2369 6e63   <signal.h>.#inc
-0001e130: 6c75 6465 203c 7379 732f 7379 7363 616c  lude <sys/syscal
-0001e140: 6c2e 683e 0a23 696e 636c 7564 6520 3c73  l.h>.#include <s
-0001e150: 7464 696f 2e68 3e0a 2369 6e63 6c75 6465  tdio.h>.#include
-0001e160: 203c 7374 646c 6962 2e68 3e0a 2369 6e63   <stdlib.h>.#inc
-0001e170: 6c75 6465 203c 756e 6973 7464 2e68 3e0a  lude <unistd.h>.
-0001e180: 0a2f 2f20 6874 7470 733a 2f2f 7374 6163  .// https://stac
-0001e190: 6b6f 7665 7266 6c6f 772e 636f 6d2f 7175  koverflow.com/qu
-0001e1a0: 6573 7469 6f6e 732f 3436 3834 3534 3936  estions/46845496
-0001e1b0: 2f6c 642d 7072 656c 6f61 642d 616e 642d  /ld-preload-and-
-0001e1c0: 6c69 6e6b 6167 650a 2f2f 2068 7474 7073  linkage.// https
-0001e1d0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
-0001e1e0: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f34  .com/questions/4
-0001e1f0: 3638 3130 3539 372f 666f 726b 6578 6563  6810597/forkexec
-0001e200: 2d77 6974 686f 7574 2d61 7466 6f72 6b2d  -without-atfork-
-0001e210: 6861 6e64 6c65 7273 0a0a 696e 7420 7074  handlers..int pt
-0001e220: 6872 6561 645f 6174 666f 726b 2876 6f69  hread_atfork(voi
-0001e230: 6420 282a 7072 6570 6172 6529 2876 6f69  d (*prepare)(voi
-0001e240: 6429 2c20 766f 6964 2028 2a70 6172 656e  d), void (*paren
-0001e250: 7429 2876 6f69 6429 2c20 766f 6964 2028  t)(void), void (
-0001e260: 2a63 6869 6c64 2928 766f 6964 2929 207b  *child)(void)) {
-0001e270: 0a20 2070 7269 6e74 6628 2249 676e 6f72  .  printf("Ignor
-0001e280: 696e 6720 7074 6872 6561 645f 6174 666f  ing pthread_atfo
-0001e290: 726b 2063 616c 6c21 5c5c 6e22 293b 0a20  rk call!\\n");. 
-0001e2a0: 2066 666c 7573 6828 7374 646f 7574 293b   fflush(stdout);
-0001e2b0: 0a20 2072 6574 7572 6e20 303b 0a7d 0a0a  .  return 0;.}..
-0001e2c0: 696e 7420 5f5f 7265 6769 7374 6572 5f61  int __register_a
-0001e2d0: 7466 6f72 6b28 766f 6964 2028 2a70 7265  tfork(void (*pre
-0001e2e0: 7061 7265 2928 766f 6964 292c 2076 6f69  pare)(void), voi
-0001e2f0: 6420 282a 7061 7265 6e74 2928 766f 6964  d (*parent)(void
-0001e300: 292c 2076 6f69 6420 282a 6368 696c 6429  ), void (*child)
-0001e310: 2876 6f69 6429 2920 7b0a 2020 7072 696e  (void)) {.  prin
-0001e320: 7466 2822 4967 6e6f 7269 6e67 205f 5f72  tf("Ignoring __r
-0001e330: 6567 6973 7465 725f 6174 666f 726b 2063  egister_atfork c
-0001e340: 616c 6c21 5c5c 6e22 293b 0a20 2066 666c  all!\\n");.  ffl
-0001e350: 7573 6828 7374 646f 7574 293b 0a20 2072  ush(stdout);.  r
-0001e360: 6574 7572 6e20 303b 0a7d 0a0a 2f2f 2041  eturn 0;.}..// A
-0001e370: 6e6f 7468 6572 2077 6179 2074 6f20 6967  nother way to ig
-0001e380: 6e6f 7265 2061 7466 6f72 6b20 6861 6e64  nore atfork hand
-0001e390: 6c65 7273 3a20 4f76 6572 7269 6465 2066  lers: Override f
-0001e3a0: 6f72 6b2e 0a23 6966 6465 6620 5f5f 6c69  ork..#ifdef __li
-0001e3b0: 6e75 785f 5f20 2f2f 206f 6e6c 7920 776f  nux__ // only wo
-0001e3c0: 726b 7320 6f6e 204c 696e 7578 2063 7572  rks on Linux cur
-0001e3d0: 7265 6e74 6c79 0a70 6964 5f74 2066 6f72  rently.pid_t for
-0001e3e0: 6b28 766f 6964 2920 7b0a 2020 7265 7475  k(void) {.  retu
-0001e3f0: 726e 2073 7973 6361 6c6c 2853 5953 5f63  rn syscall(SYS_c
-0001e400: 6c6f 6e65 2c20 5349 4743 484c 442c 2030  lone, SIGCHLD, 0
-0001e410: 293b 0a7d 0a23 656e 6469 660a 0a5f 5f61  );.}.#endif..__a
-0001e420: 7474 7269 6275 7465 5f5f 2828 636f 6e73  ttribute__((cons
-0001e430: 7472 7563 746f 7229 290a 766f 6964 2070  tructor)).void p
-0001e440: 6174 6368 5f61 7466 6f72 6b5f 696e 6974  atch_atfork_init
-0001e450: 2829 207b 0a20 2073 6574 656e 7628 225f  () {.  setenv("_
-0001e460: 5f52 4554 5552 4e4e 5f41 5446 4f52 4b5f  _RETURNN_ATFORK_
-0001e470: 5041 5443 4845 4422 2c20 2231 222c 2031  PATCHED", "1", 1
-0001e480: 293b 0a7d 0a22 2222 0a0a 0a64 6566 2067  );.}."""...def g
-0001e490: 6574 5f70 6174 6368 5f61 7466 6f72 6b5f  et_patch_atfork_
-0001e4a0: 6c69 6228 293a 0a20 2020 2022 2222 0a20  lib():.    """. 
-0001e4b0: 2020 203a 7265 7475 726e 3a20 7061 7468     :return: path
-0001e4c0: 2074 6f20 6f75 7220 7061 7463 685f 6174   to our patch_at
-0001e4d0: 666f 726b 206c 6962 2e20 7365 6520 3a66  fork lib. see :f
-0001e4e0: 756e 633a 606d 6179 6265 5f72 6573 7461  unc:`maybe_resta
-0001e4f0: 7274 5f72 6574 7572 6e6e 5f77 6974 685f  rt_returnn_with_
-0001e500: 6174 666f 726b 5f70 6174 6368 600a 2020  atfork_patch`.  
-0001e510: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-0001e520: 2020 2222 220a 2020 2020 6e61 7469 7665    """.    native
-0001e530: 203d 204e 6174 6976 6543 6f64 6543 6f6d   = NativeCodeCom
-0001e540: 7069 6c65 7228 6261 7365 5f6e 616d 653d  piler(base_name=
-0001e550: 2270 6174 6368 5f61 7466 6f72 6b22 2c20  "patch_atfork", 
-0001e560: 636f 6465 5f76 6572 7369 6f6e 3d32 2c20  code_version=2, 
-0001e570: 636f 6465 3d5f 635f 636f 6465 5f70 6174  code=_c_code_pat
-0001e580: 6368 5f61 7466 6f72 6b2c 2069 735f 6370  ch_atfork, is_cp
-0001e590: 703d 4661 6c73 6529 0a20 2020 2066 6e20  p=False).    fn 
-0001e5a0: 3d20 6e61 7469 7665 2e67 6574 5f6c 6962  = native.get_lib
-0001e5b0: 5f66 696c 656e 616d 6528 290a 2020 2020  _filename().    
-0001e5c0: 7265 7475 726e 2066 6e0a 0a0a 6465 6620  return fn...def 
-0001e5d0: 7265 7374 6172 745f 7265 7475 726e 6e28  restart_returnn(
-0001e5e0: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-0001e5f0: 6573 7461 7274 7320 5245 5455 524e 4e2e  estarts RETURNN.
-0001e600: 0a20 2020 2022 2222 0a20 2020 206c 6f67  .    """.    log
-0001e610: 2e66 6c75 7368 2829 0a20 2020 2073 7973  .flush().    sys
-0001e620: 2e73 7464 6f75 742e 666c 7573 6828 290a  .stdout.flush().
-0001e630: 2020 2020 7379 732e 7374 6465 7272 2e66      sys.stderr.f
-0001e640: 6c75 7368 2829 0a20 2020 2023 2068 7474  lush().    # htt
-0001e650: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
-0001e660: 6f77 2e63 6f6d 2f71 7565 7374 696f 6e73  ow.com/questions
-0001e670: 2f37 3233 3335 3930 342f 7369 6d70 6c65  /72335904/simple
-0001e680: 2d77 6179 2d74 6f2d 7265 7374 6172 742d  -way-to-restart-
-0001e690: 6170 706c 6963 6174 696f 6e0a 2020 2020  application.    
-0001e6a0: 636c 6f73 655f 616c 6c5f 6664 735f 6578  close_all_fds_ex
-0001e6b0: 6365 7074 287b 302c 2031 2c20 327d 290a  cept({0, 1, 2}).
-0001e6c0: 2020 2020 6f73 2e65 7865 6376 2873 7973      os.execv(sys
-0001e6d0: 2e65 7865 6375 7461 626c 652c 205b 7379  .executable, [sy
-0001e6e0: 732e 6578 6563 7574 6162 6c65 5d20 2b20  s.executable] + 
-0001e6f0: 7379 732e 6172 6776 290a 2020 2020 7261  sys.argv).    ra
-0001e700: 6973 6520 4578 6365 7074 696f 6e28 2272  ise Exception("r
-0001e710: 6573 7461 7274 5f72 6574 7572 6e6e 3a20  estart_returnn: 
-0001e720: 6578 6563 7620 6661 696c 6564 2229 0a0a  execv failed")..
-0001e730: 0a64 6566 206d 6179 6265 5f72 6573 7461  .def maybe_resta
-0001e740: 7274 5f72 6574 7572 6e6e 5f77 6974 685f  rt_returnn_with_
-0001e750: 6174 666f 726b 5f70 6174 6368 2829 3a0a  atfork_patch():.
-0001e760: 2020 2020 2222 220a 2020 2020 5768 6174      """.    What
-0001e770: 2077 6520 7761 6e74 3a20 7375 6270 726f   we want: subpro
-0001e780: 6365 7373 2e50 6f70 656e 2074 6f20 616c  cess.Popen to al
-0001e790: 7761 7973 2077 6f72 6b2e 0a20 2020 2050  ways work..    P
-0001e7a0: 726f 626c 656d 3a20 4974 2075 7365 7320  roblem: It uses 
-0001e7b0: 666f 726b 2b65 7865 6320 696e 7465 726e  fork+exec intern
-0001e7c0: 616c 6c79 2069 6e20 7375 6270 726f 6365  ally in subproce
-0001e7d0: 7373 5f66 6f72 6b5f 6578 6563 2c20 7669  ss_fork_exec, vi
-0001e7e0: 6120 5f70 6f73 6978 7375 6270 726f 6365  a _posixsubproce
-0001e7f0: 7373 2e66 6f72 6b5f 6578 6563 2e0a 2020  ss.fork_exec..  
-0001e800: 2020 5468 6174 2069 7320 6120 7072 6f62    That is a prob
-0001e810: 6c65 6d20 6265 6361 7573 6520 666f 726b  lem because fork
-0001e820: 2063 616e 2074 7269 6767 6572 2061 6e79   can trigger any
-0001e830: 2061 7466 6f72 6b20 6861 6e64 6c65 7273   atfork handlers
-0001e840: 2072 6567 6973 7465 7265 6420 7669 6120   registered via 
-0001e850: 7074 6872 6561 645f 6174 666f 726b 2c0a  pthread_atfork,.
-0001e860: 2020 2020 616e 6420 7468 6f73 6520 6361      and those ca
-0001e870: 6e20 6372 6173 682f 6465 6164 6c6f 636b  n crash/deadlock
-0001e880: 2069 6e20 736f 6d65 2063 6173 6573 2e0a   in some cases..
-0001e890: 0a20 2020 2068 7474 7073 3a2f 2f67 6974  .    https://git
-0001e8a0: 6875 622e 636f 6d2f 7465 6e73 6f72 666c  hub.com/tensorfl
-0001e8b0: 6f77 2f74 656e 736f 7266 6c6f 772f 6973  ow/tensorflow/is
-0001e8c0: 7375 6573 2f31 3338 3032 0a20 2020 2068  sues/13802.    h
-0001e8d0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0001e8e0: 6d2f 7869 616e 7969 2f4f 7065 6e42 4c41  m/xianyi/OpenBLA
-0001e8f0: 532f 6973 7375 6573 2f32 3430 0a20 2020  S/issues/240.   
-0001e900: 2068 7474 7073 3a2f 2f74 7261 632e 7361   https://trac.sa
-0001e910: 6765 6d61 7468 2e6f 7267 2f74 6963 6b65  gemath.org/ticke
-0001e920: 742f 3232 3032 310a 2020 2020 6874 7470  t/22021.    http
-0001e930: 733a 2f2f 6275 6773 2e70 7974 686f 6e2e  s://bugs.python.
-0001e940: 6f72 672f 6973 7375 6533 3138 3134 0a20  org/issue31814. 
-0001e950: 2020 2068 7474 7073 3a2f 2f73 7461 636b     https://stack
-0001e960: 6f76 6572 666c 6f77 2e63 6f6d 2f71 7565  overflow.com/que
-0001e970: 7374 696f 6e73 2f34 3638 3435 3439 362f  stions/46845496/
-0001e980: 6c64 2d70 7265 6c6f 6164 2d61 6e64 2d6c  ld-preload-and-l
-0001e990: 696e 6b61 6765 0a20 2020 2068 7474 7073  inkage.    https
-0001e9a0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
-0001e9b0: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f34  .com/questions/4
-0001e9c0: 3638 3130 3539 372f 666f 726b 6578 6563  6810597/forkexec
-0001e9d0: 2d77 6974 686f 7574 2d61 7466 6f72 6b2d  -without-atfork-
-0001e9e0: 6861 6e64 6c65 7273 0a0a 2020 2020 5468  handlers..    Th
-0001e9f0: 6520 736f 6c75 7469 6f6e 2068 6572 653a  e solution here:
-0001ea00: 204a 7573 7420 6f76 6572 7269 6465 2070   Just override p
-0001ea10: 7468 7265 6164 5f61 7466 6f72 6b2c 2076  thread_atfork, v
-0001ea20: 6961 204c 445f 5052 454c 4f41 442e 0a20  ia LD_PRELOAD.. 
-0001ea30: 2020 204e 6f74 6520 7468 6174 2069 6e20     Note that in 
-0001ea40: 736f 6d65 2063 6173 6573 2c20 7468 6973  some cases, this
-0001ea50: 2069 7320 6e6f 7420 656e 6f75 6768 2028   is not enough (
-0001ea60: 7365 6520 7468 6520 534f 2064 6973 6375  see the SO discu
-0001ea70: 7373 696f 6e29 2c0a 2020 2020 736f 2077  ssion),.    so w
-0001ea80: 6520 616c 736f 206f 7665 7277 7269 7465  e also overwrite
-0001ea90: 2066 6f72 6b20 6974 7365 6c66 2e0a 2020   fork itself..  
-0001eaa0: 2020 5365 6520 616c 736f 2074 6573 7473    See also tests
-0001eab0: 2f74 6573 745f 666f 726b 5f65 7865 632e  /test_fork_exec.
-0001eac0: 7079 2066 6f72 2061 2064 656d 6f2e 0a20  py for a demo.. 
-0001ead0: 2020 2022 2222 0a20 2020 2069 6620 6f73     """.    if os
-0001eae0: 2e65 6e76 6972 6f6e 2e67 6574 2822 5f5f  .environ.get("__
-0001eaf0: 5245 5455 524e 4e5f 4154 464f 524b 5f50  RETURNN_ATFORK_P
-0001eb00: 4154 4348 4544 2229 203d 3d20 2231 223a  ATCHED") == "1":
-0001eb10: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0001eb20: 5275 6e6e 696e 6720 7769 7468 2070 6174  Running with pat
-0001eb30: 6368 6564 2061 7466 6f72 6b2e 2229 0a20  ched atfork."). 
-0001eb40: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001eb50: 2020 6966 206f 732e 656e 7669 726f 6e2e    if os.environ.
-0001eb60: 6765 7428 225f 5f52 4554 5552 4e4e 5f54  get("__RETURNN_T
-0001eb70: 5259 5f41 5446 4f52 4b5f 5041 5443 4845  RY_ATFORK_PATCHE
-0001eb80: 4422 2920 3d3d 2022 3122 3a0a 2020 2020  D") == "1":.    
-0001eb90: 2020 2020 7072 696e 7428 2250 6174 6368      print("Patch
-0001eba0: 696e 6720 6174 666f 726b 2064 6964 206e  ing atfork did n
-0001ebb0: 6f74 2077 6f72 6b21 2057 696c 6c20 636f  ot work! Will co
-0001ebc0: 6e74 696e 7565 2061 6e79 7761 792e 2229  ntinue anyway.")
-0001ebd0: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
-0001ebe0: 2020 2020 6c69 6220 3d20 6765 745f 7061      lib = get_pa
-0001ebf0: 7463 685f 6174 666f 726b 5f6c 6962 2829  tch_atfork_lib()
-0001ec00: 0a20 2020 2065 6e76 203d 206f 732e 656e  .    env = os.en
-0001ec10: 7669 726f 6e2e 636f 7079 2829 0a20 2020  viron.copy().   
-0001ec20: 2065 6e76 5b22 4459 4c44 5f49 4e53 4552   env["DYLD_INSER
-0001ec30: 545f 4c49 4252 4152 4945 5322 2069 6620  T_LIBRARIES" if 
-0001ec40: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
-0001ec50: 2264 6172 7769 6e22 2065 6c73 6520 224c  "darwin" else "L
-0001ec60: 445f 5052 454c 4f41 4422 5d20 3d20 6c69  D_PRELOAD"] = li
-0001ec70: 620a 2020 2020 656e 765b 225f 5f52 4554  b.    env["__RET
-0001ec80: 5552 4e4e 5f54 5259 5f41 5446 4f52 4b5f  URNN_TRY_ATFORK_
-0001ec90: 5041 5443 4845 4422 5d20 3d20 2231 220a  PATCHED"] = "1".
-0001eca0: 2020 2020 7072 696e 7428 2252 6573 7461      print("Resta
-0001ecb0: 7274 696e 6720 5265 7475 726e 6e20 7769  rting Returnn wi
-0001ecc0: 7468 2061 7466 6f72 6b20 7061 7463 682e  th atfork patch.
-0001ecd0: 2e2e 222c 2073 7973 2e65 7865 6375 7461  ..", sys.executa
-0001ece0: 626c 652c 2073 7973 2e61 7267 7629 0a20  ble, sys.argv). 
-0001ecf0: 2020 2073 7973 2e73 7464 6f75 742e 666c     sys.stdout.fl
-0001ed00: 7573 6828 290a 2020 2020 6f73 2e65 7865  ush().    os.exe
-0001ed10: 6376 7065 2873 7973 2e65 7865 6375 7461  cvpe(sys.executa
-0001ed20: 626c 652c 205b 7379 732e 6578 6563 7574  ble, [sys.execut
-0001ed30: 6162 6c65 5d20 2b20 7379 732e 6172 6776  able] + sys.argv
-0001ed40: 2c20 656e 7629 0a20 2020 2070 7269 6e74  , env).    print
-0001ed50: 2822 6578 6563 7670 6520 6469 6420 6e6f  ("execvpe did no
-0001ed60: 7420 776f 726b 3f22 290a 0a0a 6465 6620  t work?")...def 
-0001ed70: 636c 6f73 655f 616c 6c5f 6664 735f 6578  close_all_fds_ex
-0001ed80: 6365 7074 2865 7863 6570 745f 6664 7329  cept(except_fds)
-0001ed90: 3a0a 2020 2020 2222 220a 2020 2020 4361  :.    """.    Ca
-0001eda0: 6c6c 7320 6f73 2e63 6c6f 7365 7261 6e67  lls os.closerang
-0001edb0: 6520 6578 6365 7074 2066 6f72 2074 6865  e except for the
-0001edc0: 2067 6976 656e 2066 6473 2e0a 2020 2020   given fds..    
-0001edd0: 436f 6465 2061 646f 7074 6564 2061 6e64  Code adopted and
-0001ede0: 2065 7874 656e 6465 6420 6672 6f6d 206d   extended from m
-0001edf0: 756c 7469 7072 6f63 6573 7369 6e67 2e75  ultiprocessing.u
-0001ee00: 7469 6c2e 636c 6f73 655f 616c 6c5f 6664  til.close_all_fd
-0001ee10: 735f 6578 6365 7074 2e0a 0a20 2020 203a  s_except...    :
-0001ee20: 7061 7261 6d20 7479 7069 6e67 2e43 6f6c  param typing.Col
-0001ee30: 6c65 6374 696f 6e5b 696e 745d 2065 7863  lection[int] exc
-0001ee40: 6570 745f 6664 733a 2075 7375 616c 6c79  ept_fds: usually
-0001ee50: 2061 7420 6c65 6173 7420 7b30 2c31 2c32   at least {0,1,2
-0001ee60: 7d0a 2020 2020 2222 220a 2020 2020 2320  }.    """.    # 
-0001ee70: 6e6f 696e 7370 6563 7469 6f6e 2050 7942  noinspection PyB
-0001ee80: 726f 6164 4578 6365 7074 696f 6e0a 2020  roadException.  
-0001ee90: 2020 7472 793a 0a20 2020 2020 2020 206d    try:.        m
-0001eea0: 6178 5f66 6420 3d20 6f73 2e73 7973 636f  ax_fd = os.sysco
-0001eeb0: 6e66 2822 5343 5f4f 5045 4e5f 4d41 5822  nf("SC_OPEN_MAX"
-0001eec0: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
-0001eed0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-0001eee0: 6d61 785f 6664 203d 2032 3536 0a0a 2020  max_fd = 256..  
-0001eef0: 2020 6578 6365 7074 5f66 6473 203d 2073    except_fds = s
-0001ef00: 6f72 7465 6428 6c69 7374 2865 7863 6570  orted(list(excep
-0001ef10: 745f 6664 7329 202b 205b 2d31 2c20 6d61  t_fds) + [-1, ma
-0001ef20: 785f 6664 5d29 0a20 2020 2061 7373 6572  x_fd]).    asser
-0001ef30: 7420 6578 6365 7074 5f66 6473 5b30 5d20  t except_fds[0] 
-0001ef40: 3d3d 202d 3120 616e 6420 6578 6365 7074  == -1 and except
-0001ef50: 5f66 6473 5b2d 315d 203d 3d20 6d61 785f  _fds[-1] == max_
-0001ef60: 6664 2c20 2266 6420 696e 7661 6c69 6422  fd, "fd invalid"
-0001ef70: 0a0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
-0001ef80: 616e 6765 286c 656e 2865 7863 6570 745f  ange(len(except_
-0001ef90: 6664 7329 202d 2031 293a 0a20 2020 2020  fds) - 1):.     
-0001efa0: 2020 2069 6620 6578 6365 7074 5f66 6473     if except_fds
-0001efb0: 5b69 5d20 2b20 3120 3c20 6578 6365 7074  [i] + 1 < except
-0001efc0: 5f66 6473 5b69 202b 2031 5d3a 0a20 2020  _fds[i + 1]:.   
-0001efd0: 2020 2020 2020 2020 206f 732e 636c 6f73           os.clos
-0001efe0: 6572 616e 6765 2865 7863 6570 745f 6664  erange(except_fd
-0001eff0: 735b 695d 202b 2031 2c20 6578 6365 7074  s[i] + 1, except
-0001f000: 5f66 6473 5b69 202b 2031 5d29 0a0a 0a63  _fds[i + 1])...c
-0001f010: 6c61 7373 2053 7461 7473 3a0a 2020 2020  lass Stats:.    
-0001f020: 2222 220a 2020 2020 436f 6c6c 6563 7473  """.    Collects
-0001f030: 206d 6561 6e20 616e 6420 7661 7269 616e   mean and varian
-0001f040: 6365 2c20 7275 6e6e 696e 6720 6176 6572  ce, running aver
-0001f050: 6167 652e 0a0a 2020 2020 6874 7470 733a  age...    https:
-0001f060: 2f2f 656e 2e77 696b 6970 6564 6961 2e6f  //en.wikipedia.o
-0001f070: 7267 2f77 696b 692f 416c 676f 7269 7468  rg/wiki/Algorith
-0001f080: 6d73 5f66 6f72 5f63 616c 6375 6c61 7469  ms_for_calculati
-0001f090: 6e67 5f76 6172 6961 6e63 650a 2020 2020  ng_variance.    
-0001f0a0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-0001f0b0: 6e69 745f 5f28 7365 6c66 2c20 666f 726d  nit__(self, form
-0001f0c0: 6174 5f73 7472 3d4e 6f6e 6529 3a0a 2020  at_str=None):.  
-0001f0d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001f0e0: 2020 3a70 6172 616d 204e 6f6e 657c 2828    :param None|((
-0001f0f0: 666c 6f61 747c 6e75 6d70 792e 6e64 6172  float|numpy.ndar
-0001f100: 7261 7929 2d3e 7374 7229 2066 6f72 6d61  ray)->str) forma
-0001f110: 745f 7374 723a 0a20 2020 2020 2020 2022  t_str:.        "
-0001f120: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-0001f130: 666f 726d 6174 5f73 7472 203d 2066 6f72  format_str = for
-0001f140: 6d61 745f 7374 7220 6f72 2073 7472 0a20  mat_str or str. 
-0001f150: 2020 2020 2020 2073 656c 662e 6d65 616e         self.mean
-0001f160: 203d 2030 2e30 0a20 2020 2020 2020 2073   = 0.0.        s
-0001f170: 656c 662e 6d65 616e 5f73 7120 3d20 302e  elf.mean_sq = 0.
-0001f180: 300a 2020 2020 2020 2020 7365 6c66 2e76  0.        self.v
-0001f190: 6172 203d 2030 2e30 0a20 2020 2020 2020  ar = 0.0.       
-0001f1a0: 2073 656c 662e 6d69 6e20 3d20 4e6f 6e65   self.min = None
-0001f1b0: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-0001f1c0: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
-0001f1d0: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
-0001f1e0: 5f6c 656e 203d 2030 0a20 2020 2020 2020  _len = 0.       
-0001f1f0: 2073 656c 662e 6e75 6d5f 7365 7173 203d   self.num_seqs =
-0001f200: 2030 0a0a 2020 2020 6465 6620 5f5f 7374   0..    def __st
-0001f210: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-0001f220: 2020 2069 6620 7365 6c66 2e6e 756d 5f73     if self.num_s
-0001f230: 6571 7320 3e20 303a 0a20 2020 2020 2020  eqs > 0:.       
-0001f240: 2020 2020 2069 6620 7365 6c66 2e6e 756d       if self.num
-0001f250: 5f73 6571 7320 3d3d 2073 656c 662e 746f  _seqs == self.to
-0001f260: 7461 6c5f 6461 7461 5f6c 656e 3a0a 2020  tal_data_len:.  
-0001f270: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0001f280: 7472 615f 7374 7220 3d20 2261 7667 5f64  tra_str = "avg_d
-0001f290: 6174 615f 6c65 6e3d 3122 0a20 2020 2020  ata_len=1".     
-0001f2a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001f2b0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0001f2c0: 7261 5f73 7472 203d 2022 746f 7461 6c5f  ra_str = "total_
-0001f2d0: 6461 7461 5f6c 656e 3d25 692c 2061 7667  data_len=%i, avg
-0001f2e0: 5f64 6174 615f 6c65 6e3d 2566 2220 2520  _data_len=%f" % 
-0001f2f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f300: 2020 2020 2020 7365 6c66 2e74 6f74 616c        self.total
-0001f310: 5f64 6174 615f 6c65 6e2c 0a20 2020 2020  _data_len,.     
-0001f320: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001f330: 6c6f 6174 2873 656c 662e 746f 7461 6c5f  loat(self.total_
-0001f340: 6461 7461 5f6c 656e 2920 2f20 7365 6c66  data_len) / self
-0001f350: 2e6e 756d 5f73 6571 732c 0a20 2020 2020  .num_seqs,.     
-0001f360: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001f370: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001f380: 2253 7461 7473 286d 6561 6e3d 2573 2c20  "Stats(mean=%s, 
-0001f390: 7374 645f 6465 763d 2573 2c20 6d69 6e3d  std_dev=%s, min=
-0001f3a0: 2573 2c20 6d61 783d 2573 2c20 6e75 6d5f  %s, max=%s, num_
-0001f3b0: 7365 7173 3d25 692c 2025 7329 2220 2520  seqs=%i, %s)" % 
-0001f3c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f3d0: 2020 7365 6c66 2e66 6f72 6d61 745f 7374    self.format_st
-0001f3e0: 7228 7365 6c66 2e67 6574 5f6d 6561 6e28  r(self.get_mean(
-0001f3f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-0001f400: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
-0001f410: 7374 7228 7365 6c66 2e67 6574 5f73 7464  str(self.get_std
-0001f420: 5f64 6576 2829 292c 0a20 2020 2020 2020  _dev()),.       
-0001f430: 2020 2020 2020 2020 2073 656c 662e 666f           self.fo
-0001f440: 726d 6174 5f73 7472 2873 656c 662e 6d69  rmat_str(self.mi
-0001f450: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
-0001f460: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
-0001f470: 7374 7228 7365 6c66 2e6d 6178 292c 0a20  str(self.max),. 
-0001f480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f490: 656c 662e 6e75 6d5f 7365 7173 2c0a 2020  elf.num_seqs,.  
-0001f4a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0001f4b0: 7472 615f 7374 722c 0a20 2020 2020 2020  tra_str,.       
-0001f4c0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0001f4d0: 6574 7572 6e20 2253 7461 7473 286e 756d  eturn "Stats(num
-0001f4e0: 5f73 6571 733d 3029 220a 0a20 2020 2064  _seqs=0)"..    d
-0001f4f0: 6566 2063 6f6c 6c65 6374 2873 656c 662c  ef collect(self,
-0001f500: 2064 6174 6129 3a0a 2020 2020 2020 2020   data):.        
-0001f510: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-0001f520: 616d 206e 756d 7079 2e6e 6461 7272 6179  am numpy.ndarray
-0001f530: 7c6c 6973 745b 696e 745d 7c6c 6973 745b  |list[int]|list[
-0001f540: 666c 6f61 745d 2064 6174 613a 2073 6861  float] data: sha
-0001f550: 7065 2028 7469 6d65 2c20 6469 6d29 206f  pe (time, dim) o
-0001f560: 7220 2874 696d 652c 290a 2020 2020 2020  r (time,).      
-0001f570: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-0001f580: 706f 7274 206e 756d 7079 0a0a 2020 2020  port numpy..    
-0001f590: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001f5a0: 6528 6461 7461 2c20 286c 6973 742c 2074  e(data, (list, t
-0001f5b0: 7570 6c65 2929 3a0a 2020 2020 2020 2020  uple)):.        
-0001f5c0: 2020 2020 6461 7461 203d 206e 756d 7079      data = numpy
-0001f5d0: 2e61 7272 6179 2864 6174 6129 0a20 2020  .array(data).   
-0001f5e0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
-0001f5f0: 7374 616e 6365 2864 6174 612c 206e 756d  stance(data, num
-0001f600: 7079 2e6e 6461 7272 6179 290a 2020 2020  py.ndarray).    
-0001f610: 2020 2020 6173 7365 7274 2064 6174 612e      assert data.
-0001f620: 6e64 696d 203e 3d20 310a 2020 2020 2020  ndim >= 1.      
-0001f630: 2020 6966 2064 6174 612e 7368 6170 655b    if data.shape[
-0001f640: 305d 203d 3d20 303a 0a20 2020 2020 2020  0] == 0:.       
-0001f650: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0001f660: 2020 2020 7365 6c66 2e6e 756d 5f73 6571      self.num_seq
-0001f670: 7320 2b3d 2031 0a20 2020 2020 2020 2064  s += 1.        d
-0001f680: 6174 615f 6d69 6e20 3d20 6e75 6d70 792e  ata_min = numpy.
-0001f690: 6d69 6e28 6461 7461 2c20 6178 6973 3d30  min(data, axis=0
-0001f6a0: 290a 2020 2020 2020 2020 6461 7461 5f6d  ).        data_m
-0001f6b0: 6178 203d 206e 756d 7079 2e6d 6178 2864  ax = numpy.max(d
-0001f6c0: 6174 612c 2061 7869 733d 3029 0a20 2020  ata, axis=0).   
-0001f6d0: 2020 2020 2069 6620 7365 6c66 2e6d 696e       if self.min
-0001f6e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001f6f0: 2020 2020 2020 7365 6c66 2e6d 696e 203d        self.min =
-0001f700: 2064 6174 615f 6d69 6e0a 2020 2020 2020   data_min.      
-0001f710: 2020 2020 2020 7365 6c66 2e6d 6178 203d        self.max =
-0001f720: 2064 6174 615f 6d61 780a 2020 2020 2020   data_max.      
-0001f730: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f740: 2020 2020 7365 6c66 2e6d 696e 203d 206e      self.min = n
-0001f750: 756d 7079 2e6d 696e 696d 756d 2873 656c  umpy.minimum(sel
-0001f760: 662e 6d69 6e2c 2064 6174 615f 6d69 6e29  f.min, data_min)
-0001f770: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001f780: 662e 6d61 7820 3d20 6e75 6d70 792e 6d61  f.max = numpy.ma
-0001f790: 7869 6d75 6d28 7365 6c66 2e6d 6178 2c20  ximum(self.max, 
-0001f7a0: 6461 7461 5f6d 6178 290a 2020 2020 2020  data_max).      
-0001f7b0: 2020 6e65 775f 746f 7461 6c5f 6461 7461    new_total_data
-0001f7c0: 5f6c 656e 203d 2073 656c 662e 746f 7461  _len = self.tota
-0001f7d0: 6c5f 6461 7461 5f6c 656e 202b 2064 6174  l_data_len + dat
-0001f7e0: 612e 7368 6170 655b 305d 0a20 2020 2020  a.shape[0].     
-0001f7f0: 2020 206d 6561 6e5f 6469 6666 203d 206e     mean_diff = n
-0001f800: 756d 7079 2e6d 6561 6e28 6461 7461 2c20  umpy.mean(data, 
-0001f810: 6178 6973 3d30 2920 2d20 7365 6c66 2e6d  axis=0) - self.m
-0001f820: 6561 6e0a 2020 2020 2020 2020 6d5f 6120  ean.        m_a 
-0001f830: 3d20 7365 6c66 2e76 6172 202a 2073 656c  = self.var * sel
-0001f840: 662e 746f 7461 6c5f 6461 7461 5f6c 656e  f.total_data_len
-0001f850: 0a20 2020 2020 2020 206d 5f62 203d 206e  .        m_b = n
-0001f860: 756d 7079 2e76 6172 2864 6174 612c 2061  umpy.var(data, a
-0001f870: 7869 733d 3029 202a 2064 6174 612e 7368  xis=0) * data.sh
-0001f880: 6170 655b 305d 0a20 2020 2020 2020 206d  ape[0].        m
-0001f890: 3220 3d20 6d5f 6120 2b20 6d5f 6220 2b20  2 = m_a + m_b + 
-0001f8a0: 6d65 616e 5f64 6966 662a 2a32 202a 2073  mean_diff**2 * s
-0001f8b0: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
-0001f8c0: 656e 202a 2064 6174 612e 7368 6170 655b  en * data.shape[
-0001f8d0: 305d 202f 206e 6577 5f74 6f74 616c 5f64  0] / new_total_d
-0001f8e0: 6174 615f 6c65 6e0a 2020 2020 2020 2020  ata_len.        
-0001f8f0: 7365 6c66 2e76 6172 203d 206d 3220 2f20  self.var = m2 / 
-0001f900: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
-0001f910: 656e 0a20 2020 2020 2020 2064 6174 615f  en.        data_
-0001f920: 7375 6d20 3d20 6e75 6d70 792e 7375 6d28  sum = numpy.sum(
-0001f930: 6461 7461 2c20 6178 6973 3d30 290a 2020  data, axis=0).  
-0001f940: 2020 2020 2020 6465 6c74 6120 3d20 6461        delta = da
-0001f950: 7461 5f73 756d 202d 2073 656c 662e 6d65  ta_sum - self.me
-0001f960: 616e 202a 2064 6174 612e 7368 6170 655b  an * data.shape[
-0001f970: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
-0001f980: 6d65 616e 202b 3d20 6465 6c74 6120 2f20  mean += delta / 
-0001f990: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
-0001f9a0: 656e 0a20 2020 2020 2020 2064 656c 7461  en.        delta
-0001f9b0: 5f73 7120 3d20 6e75 6d70 792e 7375 6d28  _sq = numpy.sum(
-0001f9c0: 6461 7461 202a 2064 6174 612c 2061 7869  data * data, axi
-0001f9d0: 733d 3029 202d 2073 656c 662e 6d65 616e  s=0) - self.mean
-0001f9e0: 5f73 7120 2a20 6461 7461 2e73 6861 7065  _sq * data.shape
-0001f9f0: 5b30 5d0a 2020 2020 2020 2020 7365 6c66  [0].        self
-0001fa00: 2e6d 6561 6e5f 7371 202b 3d20 6465 6c74  .mean_sq += delt
-0001fa10: 615f 7371 202f 206e 6577 5f74 6f74 616c  a_sq / new_total
-0001fa20: 5f64 6174 615f 6c65 6e0a 2020 2020 2020  _data_len.      
-0001fa30: 2020 7365 6c66 2e74 6f74 616c 5f64 6174    self.total_dat
-0001fa40: 615f 6c65 6e20 3d20 6e65 775f 746f 7461  a_len = new_tota
-0001fa50: 6c5f 6461 7461 5f6c 656e 0a0a 2020 2020  l_data_len..    
-0001fa60: 6465 6620 6765 745f 6d65 616e 2873 656c  def get_mean(sel
-0001fa70: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0001fa80: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0001fa90: 206d 6561 6e2c 2073 6861 7065 2028 6469   mean, shape (di
-0001faa0: 6d2c 290a 2020 2020 2020 2020 3a72 7479  m,).        :rty
-0001fab0: 7065 3a20 6e75 6d70 792e 6e64 6172 7261  pe: numpy.ndarra
-0001fac0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-0001fad0: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
-0001fae0: 662e 6e75 6d5f 7365 7173 203e 2030 0a20  f.num_seqs > 0. 
-0001faf0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001fb00: 6c66 2e6d 6561 6e0a 0a20 2020 2064 6566  lf.mean..    def
-0001fb10: 2067 6574 5f73 7464 5f64 6576 2873 656c   get_std_dev(sel
-0001fb20: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0001fb30: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0001fb40: 2073 7464 2064 6576 2c20 7368 6170 6520   std dev, shape 
-0001fb50: 2864 696d 2c29 0a20 2020 2020 2020 203a  (dim,).        :
-0001fb60: 7274 7970 653a 206e 756d 7079 2e6e 6461  rtype: numpy.nda
-0001fb70: 7272 6179 0a20 2020 2020 2020 2022 2222  rray.        """
-0001fb80: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0001fb90: 6e75 6d70 790a 0a20 2020 2020 2020 2061  numpy..        a
-0001fba0: 7373 6572 7420 7365 6c66 2e6e 756d 5f73  ssert self.num_s
-0001fbb0: 6571 7320 3e20 300a 2020 2020 2020 2020  eqs > 0.        
-0001fbc0: 7265 7475 726e 206e 756d 7079 2e73 7172  return numpy.sqr
-0001fbd0: 7428 7365 6c66 2e76 6172 290a 2020 2020  t(self.var).    
-0001fbe0: 2020 2020 2320 7265 7475 726e 206e 756d      # return num
-0001fbf0: 7079 2e73 7172 7428 7365 6c66 2e6d 6561  py.sqrt(self.mea
-0001fc00: 6e5f 7371 202d 2073 656c 662e 6d65 616e  n_sq - self.mean
-0001fc10: 202a 2073 656c 662e 6d65 616e 290a 0a20   * self.mean).. 
-0001fc20: 2020 2064 6566 2064 756d 7028 7365 6c66     def dump(self
-0001fc30: 2c20 6f75 7470 7574 5f66 696c 655f 7072  , output_file_pr
-0001fc40: 6566 6978 3d4e 6f6e 652c 2073 7472 6561  efix=None, strea
-0001fc50: 6d3d 4e6f 6e65 2c20 7374 7265 616d 5f70  m=None, stream_p
-0001fc60: 7265 6669 783d 2222 293a 0a20 2020 2020  refix=""):.     
-0001fc70: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-0001fc80: 7061 7261 6d20 7374 727c 4e6f 6e65 206f  param str|None o
-0001fc90: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
-0001fca0: 783a 2069 6620 6769 7665 6e2c 2077 696c  x: if given, wil
-0001fcb0: 6c20 6e75 6d70 792e 7361 7665 7478 7420  l numpy.savetxt 
-0001fcc0: 6d65 616e 7c73 7464 5f64 6576 2074 6f20  mean|std_dev to 
-0001fcd0: 6469 736b 0a20 2020 2020 2020 203a 7061  disk.        :pa
-0001fce0: 7261 6d20 7374 7220 7374 7265 616d 5f70  ram str stream_p
-0001fcf0: 7265 6669 783a 0a20 2020 2020 2020 203a  refix:.        :
-0001fd00: 7061 7261 6d20 696f 2e54 6578 7449 4f42  param io.TextIOB
-0001fd10: 6173 6520 7374 7265 616d 3a20 7379 732e  ase stream: sys.
-0001fd20: 7374 646f 7574 2062 7920 6465 6661 756c  stdout by defaul
-0001fd30: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-0001fd40: 2020 2020 2020 6966 2073 7472 6561 6d20        if stream 
-0001fd50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001fd60: 2020 2020 2073 7472 6561 6d20 3d20 7379       stream = sy
-0001fd70: 732e 7374 646f 7574 0a20 2020 2020 2020  s.stdout.       
-0001fd80: 2069 6d70 6f72 7420 6e75 6d70 790a 0a20   import numpy.. 
-0001fd90: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
-0001fda0: 5374 6174 733a 2220 2520 7374 7265 616d  Stats:" % stream
-0001fdb0: 5f70 7265 6669 782c 2066 696c 653d 7374  _prefix, file=st
-0001fdc0: 7265 616d 290a 2020 2020 2020 2020 6966  ream).        if
-0001fdd0: 2073 656c 662e 6e75 6d5f 7365 7173 2021   self.num_seqs !
-0001fde0: 3d20 7365 6c66 2e74 6f74 616c 5f64 6174  = self.total_dat
-0001fdf0: 615f 6c65 6e3a 0a20 2020 2020 2020 2020  a_len:.         
-0001fe00: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-0001fe10: 2020 2020 2020 2020 2020 2220 2025 6920            "  %i 
-0001fe20: 7365 7173 2c20 2569 2074 6f74 616c 2066  seqs, %i total f
-0001fe30: 7261 6d65 732c 2025 6620 6176 6572 6167  rames, %f averag
-0001fe40: 6520 6672 616d 6573 220a 2020 2020 2020  e frames".      
-0001fe50: 2020 2020 2020 2020 2020 2520 2873 656c            % (sel
-0001fe60: 662e 6e75 6d5f 7365 7173 2c20 7365 6c66  f.num_seqs, self
-0001fe70: 2e74 6f74 616c 5f64 6174 615f 6c65 6e2c  .total_data_len,
-0001fe80: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
-0001fe90: 5f6c 656e 202f 2066 6c6f 6174 2873 656c  _len / float(sel
-0001fea0: 662e 6e75 6d5f 7365 7173 2929 2c0a 2020  f.num_seqs)),.  
-0001feb0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0001fec0: 6c65 3d73 7472 6561 6d2c 0a20 2020 2020  le=stream,.     
-0001fed0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001fee0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001fef0: 2020 2070 7269 6e74 2822 2020 2569 2073     print("  %i s
-0001ff00: 6571 7322 2025 2028 7365 6c66 2e6e 756d  eqs" % (self.num
-0001ff10: 5f73 6571 732c 292c 2066 696c 653d 7374  _seqs,), file=st
-0001ff20: 7265 616d 290a 2020 2020 2020 2020 7072  ream).        pr
-0001ff30: 696e 7428 2220 204d 6561 6e3a 2025 7322  int("  Mean: %s"
-0001ff40: 2025 2028 7365 6c66 2e66 6f72 6d61 745f   % (self.format_
-0001ff50: 7374 7228 7365 6c66 2e67 6574 5f6d 6561  str(self.get_mea
-0001ff60: 6e28 2929 2c29 2c20 6669 6c65 3d73 7472  n()),), file=str
-0001ff70: 6561 6d29 0a20 2020 2020 2020 2070 7269  eam).        pri
-0001ff80: 6e74 2822 2020 5374 6420 6465 763a 2025  nt("  Std dev: %
-0001ff90: 7322 2025 2028 7365 6c66 2e66 6f72 6d61  s" % (self.forma
-0001ffa0: 745f 7374 7228 7365 6c66 2e67 6574 5f73  t_str(self.get_s
-0001ffb0: 7464 5f64 6576 2829 292c 292c 2066 696c  td_dev()),), fil
-0001ffc0: 653d 7374 7265 616d 290a 2020 2020 2020  e=stream).      
-0001ffd0: 2020 7072 696e 7428 2220 204d 696e 2f6d    print("  Min/m
-0001ffe0: 6178 3a20 2573 202f 2025 7322 2025 2028  ax: %s / %s" % (
-0001fff0: 7365 6c66 2e66 6f72 6d61 745f 7374 7228  self.format_str(
-00020000: 7365 6c66 2e6d 696e 292c 2073 656c 662e  self.min), self.
-00020010: 666f 726d 6174 5f73 7472 2873 656c 662e  format_str(self.
-00020020: 6d61 7829 292c 2066 696c 653d 7374 7265  max)), file=stre
-00020030: 616d 290a 2020 2020 2020 2020 2320 7072  am).        # pr
-00020040: 696e 7428 2253 7464 2064 6576 2028 6e61  int("Std dev (na
-00020050: 6976 6529 3a20 2573 2220 2520 6e75 6d70  ive): %s" % nump
-00020060: 792e 7371 7274 2873 656c 662e 6d65 616e  y.sqrt(self.mean
-00020070: 5f73 7120 2d20 7365 6c66 2e6d 6561 6e20  _sq - self.mean 
-00020080: 2a20 7365 6c66 2e6d 6561 6e29 2c20 6669  * self.mean), fi
-00020090: 6c65 3d73 7472 6561 6d29 0a20 2020 2020  le=stream).     
-000200a0: 2020 2069 6620 6f75 7470 7574 5f66 696c     if output_fil
-000200b0: 655f 7072 6566 6978 3a0a 2020 2020 2020  e_prefix:.      
-000200c0: 2020 2020 2020 7072 696e 7428 2220 2057        print("  W
-000200d0: 7269 7465 206d 6561 6e2f 7374 642d 6465  rite mean/std-de
-000200e0: 7620 746f 2025 732e 286d 6561 6e7c 7374  v to %s.(mean|st
-000200f0: 645f 6465 7629 2e74 7874 2e22 2025 2028  d_dev).txt." % (
-00020100: 6f75 7470 7574 5f66 696c 655f 7072 6566  output_file_pref
-00020110: 6978 2c29 2c20 6669 6c65 3d73 7472 6561  ix,), file=strea
-00020120: 6d29 0a20 2020 2020 2020 2020 2020 206e  m).            n
-00020130: 756d 7079 2e73 6176 6574 7874 2822 2573  umpy.savetxt("%s
-00020140: 2e6d 6561 6e2e 7478 7422 2025 206f 7574  .mean.txt" % out
-00020150: 7075 745f 6669 6c65 5f70 7265 6669 782c  put_file_prefix,
-00020160: 2073 656c 662e 6765 745f 6d65 616e 2829   self.get_mean()
-00020170: 290a 2020 2020 2020 2020 2020 2020 6e75  ).            nu
-00020180: 6d70 792e 7361 7665 7478 7428 2225 732e  mpy.savetxt("%s.
-00020190: 7374 645f 6465 762e 7478 7422 2025 206f  std_dev.txt" % o
-000201a0: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
-000201b0: 782c 2073 656c 662e 6765 745f 7374 645f  x, self.get_std_
-000201c0: 6465 7628 2929 0a0a 0a64 6566 2069 735f  dev())...def is_
-000201d0: 6e61 6d65 6474 7570 6c65 2863 6c73 293a  namedtuple(cls):
-000201e0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-000201f0: 7261 6d20 5420 636c 733a 2074 7570 6c65  ram T cls: tuple
-00020200: 2c20 6c69 7374 206f 7220 6e61 6d65 6474  , list or namedt
-00020210: 7570 6c65 2074 7970 650a 2020 2020 3a72  uple type.    :r
-00020220: 6574 7572 6e3a 2077 6865 7468 6572 2063  eturn: whether c
-00020230: 6c73 2069 7320 6120 6e61 6d65 6474 7570  ls is a namedtup
-00020240: 6c65 2074 7970 650a 2020 2020 3a72 7479  le type.    :rty
-00020250: 7065 3a20 626f 6f6c 0a20 2020 2022 2222  pe: bool.    """
-00020260: 0a20 2020 2072 6574 7572 6e20 6973 7375  .    return issu
-00020270: 6263 6c61 7373 2863 6c73 2c20 7475 706c  bclass(cls, tupl
-00020280: 6529 2061 6e64 2063 6c73 2069 7320 6e6f  e) and cls is no
-00020290: 7420 7475 706c 650a 0a0a 6465 6620 6d61  t tuple...def ma
-000202a0: 6b65 5f73 6571 5f6f 665f 7479 7065 2863  ke_seq_of_type(c
-000202b0: 6c73 2c20 7365 7129 3a0a 2020 2020 2222  ls, seq):.    ""
-000202c0: 220a 2020 2020 3a70 6172 616d 2074 7970  ".    :param typ
-000202d0: 655b 545d 2063 6c73 3a20 652e 672e 2074  e[T] cls: e.g. t
-000202e0: 7570 6c65 2c20 6c69 7374 206f 7220 6e61  uple, list or na
-000202f0: 6d65 6474 7570 6c65 0a20 2020 203a 7061  medtuple.    :pa
-00020300: 7261 6d20 6c69 7374 7c74 7570 6c65 7c54  ram list|tuple|T
-00020310: 2073 6571 3a0a 2020 2020 3a72 6574 7572   seq:.    :retur
-00020320: 6e3a 2063 6c73 2873 6571 2920 6f72 2063  n: cls(seq) or c
-00020330: 6c73 282a 7365 7129 0a20 2020 203a 7274  ls(*seq).    :rt
-00020340: 7970 653a 2054 7c6c 6973 747c 7475 706c  ype: T|list|tupl
-00020350: 650a 2020 2020 2222 220a 2020 2020 6173  e.    """.    as
-00020360: 7365 7274 2069 7373 7562 636c 6173 7328  sert issubclass(
-00020370: 636c 732c 2028 6c69 7374 2c20 7475 706c  cls, (list, tupl
-00020380: 6529 290a 2020 2020 6966 2069 735f 6e61  e)).    if is_na
-00020390: 6d65 6474 7570 6c65 2863 6c73 293a 0a20  medtuple(cls):. 
-000203a0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
-000203b0: 7328 2a73 6571 2920 2023 206e 6f71 610a  s(*seq)  # noqa.
-000203c0: 2020 2020 7265 7475 726e 2063 6c73 2873      return cls(s
-000203d0: 6571 2920 2023 206e 6f71 610a 0a0a 6465  eq)  # noqa...de
-000203e0: 6620 656e 7375 7265 5f6c 6973 745f 6f66  f ensure_list_of
-000203f0: 5f74 7970 6528 6c73 2c20 7479 7065 5f29  _type(ls, type_)
-00020400: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00020410: 6172 616d 206c 6973 7420 6c73 3a0a 2020  aram list ls:.  
-00020420: 2020 3a70 6172 616d 2028 2829 2d3e 5429    :param (()->T)
-00020430: 7c74 7970 655b 545d 2074 7970 655f 3a20  |type[T] type_: 
-00020440: 7479 7065 206f 6620 696e 7374 616e 6365  type of instance
-00020450: 7320 6f66 2060 6c73 602e 0a20 2020 2020  s of `ls`..     
-00020460: 204e 6f74 6520 7468 6520 7374 7261 6e67   Note the strang
-00020470: 6520 7479 7065 2068 6572 6520 696e 2074  e type here in t
-00020480: 6865 2064 6f63 7374 7269 6e67 2069 7320  he docstring is 
-00020490: 6475 6520 746f 2073 6f6d 6520 5079 4368  due to some PyCh
-000204a0: 6172 6d20 7479 7065 2069 6e66 6572 656e  arm type inferen
-000204b0: 6365 2070 726f 626c 656d 730a 2020 2020  ce problems.    
-000204c0: 2020 2868 7474 7073 3a2f 2f79 6f75 7472    (https://youtr
-000204d0: 6163 6b2e 6a65 7462 7261 696e 732e 636f  ack.jetbrains.co
-000204e0: 6d2f 6973 7375 652f 5059 2d35 3038 3238  m/issue/PY-50828
-000204f0: 292e 0a20 2020 203a 7274 7970 653a 206c  )..    :rtype: l
-00020500: 6973 745b 545d 0a20 2020 2022 2222 0a20  ist[T].    """. 
-00020510: 2020 2061 7373 6572 7420 616c 6c28 6973     assert all(is
-00020520: 696e 7374 616e 6365 2865 6c65 6d2c 2074  instance(elem, t
-00020530: 7970 655f 2920 666f 7220 656c 656d 2069  ype_) for elem i
-00020540: 6e20 6c73 290a 2020 2020 7265 7475 726e  n ls).    return
-00020550: 206c 730a 0a0a 4063 6f6e 7465 7874 6c69   ls...@contextli
-00020560: 622e 636f 6e74 6578 746d 616e 6167 6572  b.contextmanager
-00020570: 0a64 6566 2064 756d 6d79 5f6e 6f6f 705f  .def dummy_noop_
-00020580: 6374 7828 293a 0a20 2020 2022 2222 0a20  ctx():.    """. 
-00020590: 2020 2050 726f 7669 6465 7320 6120 6e6f     Provides a no
-000205a0: 2d6f 7020 636f 6e74 6578 7420 6d61 6e61  -op context mana
-000205b0: 6765 722e 0a20 2020 2022 2222 0a20 2020  ger..    """.   
-000205c0: 2079 6965 6c64 204e 6f6e 650a 0a0a 6465   yield None...de
-000205d0: 6620 5f67 6574 5f6e 6772 616d 7328 7365  f _get_ngrams(se
-000205e0: 676d 656e 742c 206d 6178 5f6f 7264 6572  gment, max_order
-000205f0: 293a 0a20 2020 2022 2222 4578 7472 6163  ):.    """Extrac
-00020600: 7473 2061 6c6c 206e 2d67 7261 6d73 2075  ts all n-grams u
-00020610: 7074 6f20 6120 6769 7665 6e20 6d61 7869  pto a given maxi
-00020620: 6d75 6d20 6f72 6465 7220 6672 6f6d 2061  mum order from a
-00020630: 6e20 696e 7075 7420 7365 676d 656e 742e  n input segment.
-00020640: 0a20 2020 2043 6f64 6520 6164 6170 7465  .    Code adapte
-00020650: 6420 6672 6f6d 2047 6f6f 676c 6520 5465  d from Google Te
-00020660: 6e73 6f72 3254 656e 736f 722e 0a0a 2020  nsor2Tensor...  
-00020670: 2020 4172 6773 3a0a 2020 2020 2020 7365    Args:.      se
-00020680: 676d 656e 7420 286c 6973 745b 696e 745d  gment (list[int]
-00020690: 7c6c 6973 745b 7374 725d 293a 2074 6578  |list[str]): tex
-000206a0: 7420 7365 676d 656e 7420 6672 6f6d 2077  t segment from w
-000206b0: 6869 6368 206e 2d67 7261 6d73 2077 696c  hich n-grams wil
-000206c0: 6c20 6265 2065 7874 7261 6374 6564 2e0a  l be extracted..
-000206d0: 2020 2020 2020 6d61 785f 6f72 6465 7220        max_order 
-000206e0: 2869 6e74 293a 206d 6178 696d 756d 206c  (int): maximum l
-000206f0: 656e 6774 6820 696e 2074 6f6b 656e 7320  ength in tokens 
-00020700: 6f66 2074 6865 206e 2d67 7261 6d73 2072  of the n-grams r
-00020710: 6574 7572 6e65 6420 6279 2074 6869 730a  eturned by this.
-00020720: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00020730: 732e 0a0a 2020 2020 5265 7475 726e 733a  s...    Returns:
-00020740: 0a20 2020 2020 2054 6865 2043 6f75 6e74  .      The Count
-00020750: 6572 2063 6f6e 7461 696e 696e 6720 616c  er containing al
-00020760: 6c20 6e2d 6772 616d 7320 7570 746f 206d  l n-grams upto m
-00020770: 6178 5f6f 7264 6572 2069 6e20 7365 676d  ax_order in segm
-00020780: 656e 740a 2020 2020 2020 7769 7468 2061  ent.      with a
-00020790: 2063 6f75 6e74 206f 6620 686f 7720 6d61   count of how ma
-000207a0: 6e79 2074 696d 6573 2065 6163 6820 6e2d  ny times each n-
-000207b0: 6772 616d 206f 6363 7572 7265 642e 0a20  gram occurred.. 
-000207c0: 2020 2022 2222 0a20 2020 2069 6d70 6f72     """.    impor
-000207d0: 7420 636f 6c6c 6563 7469 6f6e 730a 0a20  t collections.. 
-000207e0: 2020 206e 6772 616d 5f63 6f75 6e74 7320     ngram_counts 
-000207f0: 3d20 636f 6c6c 6563 7469 6f6e 732e 436f  = collections.Co
-00020800: 756e 7465 7228 290a 2020 2020 666f 7220  unter().    for 
-00020810: 6f72 6465 7220 696e 2072 616e 6765 2831  order in range(1
-00020820: 2c20 6d61 785f 6f72 6465 7220 2b20 3129  , max_order + 1)
-00020830: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
-00020840: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
-00020850: 7365 676d 656e 7429 202d 206f 7264 6572  segment) - order
-00020860: 202b 2031 293a 0a20 2020 2020 2020 2020   + 1):.         
-00020870: 2020 206e 6772 616d 203d 2074 7570 6c65     ngram = tuple
-00020880: 2873 6567 6d65 6e74 5b69 203a 2069 202b  (segment[i : i +
-00020890: 206f 7264 6572 5d29 0a20 2020 2020 2020   order]).       
-000208a0: 2020 2020 206e 6772 616d 5f63 6f75 6e74       ngram_count
-000208b0: 735b 6e67 7261 6d5d 202b 3d20 310a 2020  s[ngram] += 1.  
-000208c0: 2020 7265 7475 726e 206e 6772 616d 5f63    return ngram_c
-000208d0: 6f75 6e74 730a 0a0a 6465 6620 636f 6d70  ounts...def comp
-000208e0: 7574 655f 626c 6575 2872 6566 6572 656e  ute_bleu(referen
-000208f0: 6365 5f63 6f72 7075 732c 2074 7261 6e73  ce_corpus, trans
-00020900: 6c61 7469 6f6e 5f63 6f72 7075 732c 206d  lation_corpus, m
-00020910: 6178 5f6f 7264 6572 3d34 2c20 7573 655f  ax_order=4, use_
-00020920: 6270 3d54 7275 6529 3a0a 2020 2020 2222  bp=True):.    ""
-00020930: 2243 6f6d 7075 7465 7320 424c 4555 2073  "Computes BLEU s
-00020940: 636f 7265 206f 6620 7472 616e 736c 6174  core of translat
-00020950: 6564 2073 6567 6d65 6e74 7320 6167 6169  ed segments agai
-00020960: 6e73 7420 6f6e 6520 6f72 206d 6f72 6520  nst one or more 
-00020970: 7265 6665 7265 6e63 6573 2e0a 2020 2020  references..    
-00020980: 436f 6465 2061 6461 7074 6564 2066 726f  Code adapted fro
-00020990: 6d20 476f 6f67 6c65 2054 656e 736f 7232  m Google Tensor2
-000209a0: 5465 6e73 6f72 2e0a 0a20 2020 2041 7267  Tensor...    Arg
-000209b0: 733a 0a20 2020 2020 2072 6566 6572 656e  s:.      referen
-000209c0: 6365 5f63 6f72 7075 7320 286c 6973 745b  ce_corpus (list[
-000209d0: 6c69 7374 5b69 6e74 5d7c 6c69 7374 5b73  list[int]|list[s
-000209e0: 7472 5d5d 293a 206c 6973 7420 6f66 2072  tr]]): list of r
-000209f0: 6566 6572 656e 6365 7320 666f 7220 6561  eferences for ea
-00020a00: 6368 2074 7261 6e73 6c61 7469 6f6e 2e20  ch translation. 
-00020a10: 4561 6368 0a20 2020 2020 2020 2020 2072  Each.          r
-00020a20: 6566 6572 656e 6365 2073 686f 756c 6420  eference should 
-00020a30: 6265 2074 6f6b 656e 697a 6564 2069 6e74  be tokenized int
-00020a40: 6f20 6120 6c69 7374 206f 6620 746f 6b65  o a list of toke
-00020a50: 6e73 2e0a 2020 2020 2020 7472 616e 736c  ns..      transl
-00020a60: 6174 696f 6e5f 636f 7270 7573 2028 6c69  ation_corpus (li
-00020a70: 7374 5b6c 6973 745b 696e 745d 7c6c 6973  st[list[int]|lis
-00020a80: 745b 7374 725d 5d29 3a20 6c69 7374 206f  t[str]]): list o
-00020a90: 6620 7472 616e 736c 6174 696f 6e73 2074  f translations t
-00020aa0: 6f20 7363 6f72 652e 2045 6163 6820 7472  o score. Each tr
-00020ab0: 616e 736c 6174 696f 6e0a 2020 2020 2020  anslation.      
-00020ac0: 2020 2020 7368 6f75 6c64 2062 6520 746f      should be to
-00020ad0: 6b65 6e69 7a65 6420 696e 746f 2061 206c  kenized into a l
-00020ae0: 6973 7420 6f66 2074 6f6b 656e 732e 0a20  ist of tokens.. 
-00020af0: 2020 2020 206d 6178 5f6f 7264 6572 2028       max_order (
-00020b00: 696e 7429 3a20 4d61 7869 6d75 6d20 6e2d  int): Maximum n-
-00020b10: 6772 616d 206f 7264 6572 2074 6f20 7573  gram order to us
-00020b20: 6520 7768 656e 2063 6f6d 7075 7469 6e67  e when computing
-00020b30: 2042 4c45 5520 7363 6f72 652e 0a20 2020   BLEU score..   
-00020b40: 2020 2075 7365 5f62 7020 2862 6f6f 6c29     use_bp (bool)
-00020b50: 3a20 626f 6f6c 6561 6e2c 2077 6865 7468  : boolean, wheth
-00020b60: 6572 2074 6f20 6170 706c 7920 6272 6576  er to apply brev
-00020b70: 6974 7920 7065 6e61 6c74 792e 0a0a 2020  ity penalty...  
-00020b80: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00020b90: 2042 4c45 5520 7363 6f72 652e 0a20 2020   BLEU score..   
-00020ba0: 2022 2222 0a20 2020 2069 6d70 6f72 7420   """.    import 
-00020bb0: 6d61 7468 0a0a 2020 2020 7265 6665 7265  math..    refere
-00020bc0: 6e63 655f 6c65 6e67 7468 203d 2030 0a20  nce_length = 0. 
-00020bd0: 2020 2074 7261 6e73 6c61 7469 6f6e 5f6c     translation_l
-00020be0: 656e 6774 6820 3d20 300a 2020 2020 6270  ength = 0.    bp
-00020bf0: 203d 2031 2e30 0a20 2020 2067 656f 5f6d   = 1.0.    geo_m
-00020c00: 6561 6e20 3d20 300a 0a20 2020 206d 6174  ean = 0..    mat
-00020c10: 6368 6573 5f62 795f 6f72 6465 7220 3d20  ches_by_order = 
-00020c20: 5b30 5d20 2a20 6d61 785f 6f72 6465 720a  [0] * max_order.
-00020c30: 2020 2020 706f 7373 6962 6c65 5f6d 6174      possible_mat
-00020c40: 6368 6573 5f62 795f 6f72 6465 7220 3d20  ches_by_order = 
-00020c50: 5b30 5d20 2a20 6d61 785f 6f72 6465 720a  [0] * max_order.
-00020c60: 0a20 2020 2066 6f72 2028 7265 6665 7265  .    for (refere
-00020c70: 6e63 6573 2c20 7472 616e 736c 6174 696f  nces, translatio
-00020c80: 6e73 2920 696e 207a 6970 2872 6566 6572  ns) in zip(refer
-00020c90: 656e 6365 5f63 6f72 7075 732c 2074 7261  ence_corpus, tra
-00020ca0: 6e73 6c61 7469 6f6e 5f63 6f72 7075 7329  nslation_corpus)
-00020cb0: 3a0a 2020 2020 2020 2020 7265 6665 7265  :.        refere
-00020cc0: 6e63 655f 6c65 6e67 7468 202b 3d20 6c65  nce_length += le
-00020cd0: 6e28 7265 6665 7265 6e63 6573 290a 2020  n(references).  
-00020ce0: 2020 2020 2020 7472 616e 736c 6174 696f        translatio
-00020cf0: 6e5f 6c65 6e67 7468 202b 3d20 6c65 6e28  n_length += len(
-00020d00: 7472 616e 736c 6174 696f 6e73 290a 2020  translations).  
-00020d10: 2020 2020 2020 7265 665f 6e67 7261 6d5f        ref_ngram_
-00020d20: 636f 756e 7473 203d 205f 6765 745f 6e67  counts = _get_ng
-00020d30: 7261 6d73 2872 6566 6572 656e 6365 732c  rams(references,
-00020d40: 206d 6178 5f6f 7264 6572 290a 2020 2020   max_order).    
-00020d50: 2020 2020 7472 616e 736c 6174 696f 6e5f      translation_
-00020d60: 6e67 7261 6d5f 636f 756e 7473 203d 205f  ngram_counts = _
-00020d70: 6765 745f 6e67 7261 6d73 2874 7261 6e73  get_ngrams(trans
-00020d80: 6c61 7469 6f6e 732c 206d 6178 5f6f 7264  lations, max_ord
-00020d90: 6572 290a 0a20 2020 2020 2020 206f 7665  er)..        ove
-00020da0: 726c 6170 203d 207b 6e67 7261 6d3a 206d  rlap = {ngram: m
-00020db0: 696e 2863 6f75 6e74 2c20 7472 616e 736c  in(count, transl
-00020dc0: 6174 696f 6e5f 6e67 7261 6d5f 636f 756e  ation_ngram_coun
-00020dd0: 7473 5b6e 6772 616d 5d29 2066 6f72 206e  ts[ngram]) for n
-00020de0: 6772 616d 2c20 636f 756e 7420 696e 2072  gram, count in r
-00020df0: 6566 5f6e 6772 616d 5f63 6f75 6e74 732e  ef_ngram_counts.
-00020e00: 6974 656d 7328 297d 0a0a 2020 2020 2020  items()}..      
-00020e10: 2020 666f 7220 6e67 7261 6d20 696e 206f    for ngram in o
-00020e20: 7665 726c 6170 3a0a 2020 2020 2020 2020  verlap:.        
-00020e30: 2020 2020 6d61 7463 6865 735f 6279 5f6f      matches_by_o
-00020e40: 7264 6572 5b6c 656e 286e 6772 616d 2920  rder[len(ngram) 
-00020e50: 2d20 315d 202b 3d20 6f76 6572 6c61 705b  - 1] += overlap[
-00020e60: 6e67 7261 6d5d 0a20 2020 2020 2020 2066  ngram].        f
-00020e70: 6f72 206e 6772 616d 2069 6e20 7472 616e  or ngram in tran
-00020e80: 736c 6174 696f 6e5f 6e67 7261 6d5f 636f  slation_ngram_co
-00020e90: 756e 7473 3a0a 2020 2020 2020 2020 2020  unts:.          
-00020ea0: 2020 706f 7373 6962 6c65 5f6d 6174 6368    possible_match
-00020eb0: 6573 5f62 795f 6f72 6465 725b 6c65 6e28  es_by_order[len(
-00020ec0: 6e67 7261 6d29 202d 2031 5d20 2b3d 2074  ngram) - 1] += t
-00020ed0: 7261 6e73 6c61 7469 6f6e 5f6e 6772 616d  ranslation_ngram
-00020ee0: 5f63 6f75 6e74 735b 6e67 7261 6d5d 0a0a  _counts[ngram]..
-00020ef0: 2020 2020 7072 6563 6973 696f 6e73 203d      precisions =
-00020f00: 205b 302e 305d 202a 206d 6178 5f6f 7264   [0.0] * max_ord
-00020f10: 6572 0a20 2020 2073 6d6f 6f74 6820 3d20  er.    smooth = 
-00020f20: 312e 300a 2020 2020 666f 7220 6920 696e  1.0.    for i in
-00020f30: 2072 616e 6765 2830 2c20 6d61 785f 6f72   range(0, max_or
-00020f40: 6465 7229 3a0a 2020 2020 2020 2020 6966  der):.        if
-00020f50: 2070 6f73 7369 626c 655f 6d61 7463 6865   possible_matche
-00020f60: 735f 6279 5f6f 7264 6572 5b69 5d20 3e20  s_by_order[i] > 
-00020f70: 303a 0a20 2020 2020 2020 2020 2020 2070  0:.            p
-00020f80: 7265 6369 7369 6f6e 735b 695d 203d 206d  recisions[i] = m
-00020f90: 6174 6368 6573 5f62 795f 6f72 6465 725b  atches_by_order[
-00020fa0: 695d 202f 2070 6f73 7369 626c 655f 6d61  i] / possible_ma
-00020fb0: 7463 6865 735f 6279 5f6f 7264 6572 5b69  tches_by_order[i
-00020fc0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00020fd0: 206d 6174 6368 6573 5f62 795f 6f72 6465   matches_by_orde
-00020fe0: 725b 695d 203e 2030 3a0a 2020 2020 2020  r[i] > 0:.      
-00020ff0: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00021000: 696f 6e73 5b69 5d20 3d20 6d61 7463 6865  ions[i] = matche
-00021010: 735f 6279 5f6f 7264 6572 5b69 5d20 2f20  s_by_order[i] / 
-00021020: 706f 7373 6962 6c65 5f6d 6174 6368 6573  possible_matches
-00021030: 5f62 795f 6f72 6465 725b 695d 0a20 2020  _by_order[i].   
-00021040: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00021050: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021060: 6d6f 6f74 6820 2a3d 2032 0a20 2020 2020  mooth *= 2.     
-00021070: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-00021080: 7369 6f6e 735b 695d 203d 2031 2e30 202f  sions[i] = 1.0 /
-00021090: 2028 736d 6f6f 7468 202a 2070 6f73 7369   (smooth * possi
-000210a0: 626c 655f 6d61 7463 6865 735f 6279 5f6f  ble_matches_by_o
-000210b0: 7264 6572 5b69 5d29 0a20 2020 2020 2020  rder[i]).       
-000210c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000210d0: 2020 2070 7265 6369 7369 6f6e 735b 695d     precisions[i]
-000210e0: 203d 2030 2e30 0a0a 2020 2020 6966 206d   = 0.0..    if m
-000210f0: 6178 2870 7265 6369 7369 6f6e 7329 203e  ax(precisions) >
-00021100: 2030 3a0a 2020 2020 2020 2020 705f 6c6f   0:.        p_lo
-00021110: 675f 7375 6d20 3d20 7375 6d28 6d61 7468  g_sum = sum(math
-00021120: 2e6c 6f67 2870 2920 666f 7220 7020 696e  .log(p) for p in
-00021130: 2070 7265 6369 7369 6f6e 7320 6966 2070   precisions if p
-00021140: 290a 2020 2020 2020 2020 6765 6f5f 6d65  ).        geo_me
-00021150: 616e 203d 206d 6174 682e 6578 7028 705f  an = math.exp(p_
-00021160: 6c6f 675f 7375 6d20 2f20 6d61 785f 6f72  log_sum / max_or
-00021170: 6465 7229 0a0a 2020 2020 6966 2075 7365  der)..    if use
-00021180: 5f62 703a 0a20 2020 2020 2020 2072 6174  _bp:.        rat
-00021190: 696f 203d 2074 7261 6e73 6c61 7469 6f6e  io = translation
-000211a0: 5f6c 656e 6774 6820 2f20 7265 6665 7265  _length / refere
-000211b0: 6e63 655f 6c65 6e67 7468 0a20 2020 2020  nce_length.     
-000211c0: 2020 2069 6620 7261 7469 6f20 3c20 3165     if ratio < 1e
-000211d0: 2d33 303a 0a20 2020 2020 2020 2020 2020  -30:.           
-000211e0: 2062 7020 3d20 302e 300a 2020 2020 2020   bp = 0.0.      
-000211f0: 2020 656c 6966 2072 6174 696f 203c 2031    elif ratio < 1
-00021200: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
-00021210: 6270 203d 206d 6174 682e 6578 7028 3120  bp = math.exp(1 
-00021220: 2d20 312e 3020 2f20 7261 7469 6f29 0a20  - 1.0 / ratio). 
-00021230: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00021240: 2020 2020 2020 2020 2062 7020 3d20 312e           bp = 1.
-00021250: 300a 2020 2020 626c 6575 203d 2067 656f  0.    bleu = geo
-00021260: 5f6d 6561 6e20 2a20 6270 0a20 2020 2072  _mean * bp.    r
-00021270: 6574 7572 6e20 6e70 2e66 6c6f 6174 3332  eturn np.float32
-00021280: 2862 6c65 7529 0a0a 0a23 206e 6f69 6e73  (bleu)...# noins
-00021290: 7065 6374 696f 6e20 5079 5061 636b 6167  pection PyPackag
-000212a0: 6552 6571 7569 7265 6d65 6e74 730a 6465  eRequirements.de
-000212b0: 6620 6d6f 6e6b 6579 6669 785f 676c 6962  f monkeyfix_glib
-000212c0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-000212d0: 4669 7865 7320 736f 6d65 2073 7475 7069  Fixes some stupi
-000212e0: 6420 6275 6773 2073 7563 6820 7468 6174  d bugs such that
-000212f0: 2053 4947 494e 5420 6973 206e 6f74 2077   SIGINT is not w
-00021300: 6f72 6b69 6e67 2e0a 2020 2020 5468 6973  orking..    This
-00021310: 2069 7320 7573 6564 2062 7920 6175 6469   is used by audi
-00021320: 6f72 6561 642c 2061 6e64 2069 6e64 6972  oread, and indir
-00021330: 6563 746c 7920 6279 206c 6962 726f 7361  ectly by librosa
-00021340: 2066 6f72 206c 6f61 6469 6e67 2061 7564   for loading aud
-00021350: 696f 2e0a 2020 2020 6874 7470 733a 2f2f  io..    https://
-00021360: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
-00021370: 6d2f 7175 6573 7469 6f6e 732f 3136 3431  m/questions/1641
-00021380: 3038 3532 2f0a 2020 2020 5365 6520 616c  0852/.    See al
-00021390: 736f 203a 6675 6e63 3a60 6d6f 6e6b 6579  so :func:`monkey
-000213a0: 7061 7463 685f 6175 6469 6f72 6561 6460  patch_audioread`
-000213b0: 2e0a 2020 2020 2222 220a 2020 2020 7472  ..    """.    tr
-000213c0: 793a 0a20 2020 2020 2020 2069 6d70 6f72  y:.        impor
-000213d0: 7420 6769 0a20 2020 2065 7863 6570 7420  t gi.    except 
-000213e0: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
-000213f0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00021400: 7472 793a 0a20 2020 2020 2020 2066 726f  try:.        fro
-00021410: 6d20 6769 2e72 6570 6f73 6974 6f72 7920  m gi.repository 
-00021420: 696d 706f 7274 2047 4c69 620a 2020 2020  import GLib.    
-00021430: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-00021440: 6f72 3a0a 2020 2020 2020 2020 2320 6e6f  or:.        # no
-00021450: 696e 7370 6563 7469 6f6e 2050 7955 6e72  inspection PyUnr
-00021460: 6573 6f6c 7665 6452 6566 6572 656e 6365  esolvedReference
-00021470: 730a 2020 2020 2020 2020 6672 6f6d 2067  s.        from g
-00021480: 692e 6f76 6572 7269 6465 7320 696d 706f  i.overrides impo
-00021490: 7274 2047 4c69 620a 2020 2020 2320 446f  rt GLib.    # Do
-000214a0: 206e 6f74 6869 6e67 2e0a 2020 2020 2320   nothing..    # 
-000214b0: 5468 6520 6f72 6967 696e 616c 2062 6568  The original beh
-000214c0: 6176 696f 7220 776f 756c 6420 696e 7374  avior would inst
-000214d0: 616c 6c20 6120 5349 4749 4e54 2068 616e  all a SIGINT han
-000214e0: 646c 6572 2077 6869 6368 2063 616c 6c73  dler which calls
-000214f0: 2047 4c69 622e 4d61 696e 4c6f 6f70 2e71   GLib.MainLoop.q
-00021500: 7569 7428 292c 0a20 2020 2023 2061 6e64  uit(),.    # and
-00021510: 2074 6865 6e20 7265 7261 6973 6520 6120   then reraise a 
-00021520: 4b65 7962 6f61 7264 496e 7465 7272 7570  KeyboardInterrup
-00021530: 7420 696e 2074 6861 7420 7468 7265 6164  t in that thread
-00021540: 2e0a 2020 2020 2320 486f 7765 7665 722c  ..    # However,
-00021550: 2077 6520 7761 6e74 2061 6e64 2065 7870   we want and exp
-00021560: 6563 7420 746f 2067 6574 2074 6865 204b  ect to get the K
-00021570: 6579 626f 6172 6449 6e74 6572 7275 7074  eyboardInterrupt
-00021580: 2069 6e20 7468 6520 6d61 696e 2074 6872   in the main thr
-00021590: 6561 642e 0a20 2020 2047 4c69 622e 4d61  ead..    GLib.Ma
-000215a0: 696e 4c6f 6f70 2e5f 5f69 6e69 745f 5f20  inLoop.__init__ 
-000215b0: 3d20 6c61 6d62 6461 202a 6172 6773 2c20  = lambda *args, 
-000215c0: 2a2a 6b77 6172 6773 3a20 4e6f 6e65 0a0a  **kwargs: None..
-000215d0: 0a64 6566 206d 6f6e 6b65 7970 6174 6368  .def monkeypatch
-000215e0: 5f61 7564 696f 7265 6164 2829 3a0a 2020  _audioread():.  
-000215f0: 2020 2222 220a 2020 2020 6175 6469 6f72    """.    audior
-00021600: 6561 6420 646f 6573 206e 6f74 2062 6568  ead does not beh
-00021610: 6176 6520 6f70 7469 6d61 6c20 696e 2073  ave optimal in s
-00021620: 6f6d 6520 6361 7365 732e 0a20 2020 2045  ome cases..    E
-00021630: 2e67 2e20 6561 6368 2063 616c 6c20 746f  .g. each call to
-00021640: 205f 6361 5f61 7661 696c 6162 6c65 2829   _ca_available()
-00021650: 2074 616b 6573 2071 7569 7465 206c 6f6e   takes quite lon
-00021660: 6720 6265 6361 7573 6520 6f66 2074 6865  g because of the
-00021670: 2063 7479 7065 732e 7574 696c 2e66 696e   ctypes.util.fin
-00021680: 645f 6c69 6272 6172 7920 7573 6167 652e  d_library usage.
-00021690: 0a20 2020 2057 6520 7769 6c6c 2070 6174  .    We will pat
-000216a0: 6368 2074 6869 732e 0a0a 2020 2020 486f  ch this...    Ho
-000216b0: 7765 7665 722c 2074 6865 2072 6563 6f6d  wever, the recom
-000216c0: 6d65 6e64 6174 696f 6e20 776f 756c 6420  mendation would 
-000216d0: 6265 2074 6f20 6e6f 7420 7573 6520 6175  be to not use au
-000216e0: 6469 6f72 6561 6420 286c 6962 726f 7361  dioread (librosa
-000216f0: 2e6c 6f61 6429 2e0a 2020 2020 6175 6469  .load)..    audi
-00021700: 6f72 6561 6420 7573 6573 2047 7374 7265  oread uses Gstre
-00021710: 616d 6572 2061 7320 6120 6261 636b 656e  amer as a backen
-00021720: 6420 6279 2064 6566 6175 6c74 2063 7572  d by default cur
-00021730: 7265 6e74 6c79 2028 6f6e 204c 696e 7578  rently (on Linux
-00021740: 292e 0a20 2020 2047 7374 7265 616d 6572  )..    Gstreamer
-00021750: 2068 6173 206d 756c 7469 706c 6520 6973   has multiple is
-00021760: 7375 6573 2e20 5365 6520 616c 736f 203a  sues. See also :
-00021770: 6675 6e63 3a60 6d6f 6e6b 6579 6669 785f  func:`monkeyfix_
-00021780: 676c 6962 602c 2061 6e64 2068 6572 6520  glib`, and here 
-00021790: 666f 7220 6469 7363 7573 7369 6f6e 3a0a  for discussion:.
-000217a0: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
-000217b0: 7562 2e63 6f6d 2f62 6565 7462 6f78 2f61  ub.com/beetbox/a
-000217c0: 7564 696f 7265 6164 2f69 7373 7565 732f  udioread/issues/
-000217d0: 3632 0a20 2020 2068 7474 7073 3a2f 2f67  62.    https://g
-000217e0: 6974 6875 622e 636f 6d2f 6265 6574 626f  ithub.com/beetbo
-000217f0: 782f 6175 6469 6f72 6561 642f 6973 7375  x/audioread/issu
-00021800: 6573 2f36 330a 0a20 2020 2049 6e73 7465  es/63..    Inste
-00021810: 6164 2c20 7573 6520 5079 536f 756e 6446  ad, use PySoundF
-00021820: 696c 652c 2077 6869 6368 2069 7320 616c  ile, which is al
-00021830: 736f 2066 6173 7465 722e 2053 6565 2068  so faster. See h
-00021840: 6572 6520 666f 7220 6469 7363 7573 7369  ere for discussi
-00021850: 6f6e 733a 0a20 2020 2068 7474 7073 3a2f  ons:.    https:/
-00021860: 2f67 6974 6875 622e 636f 6d2f 6265 6574  /github.com/beet
-00021870: 626f 782f 6175 6469 6f72 6561 642f 6973  box/audioread/is
-00021880: 7375 6573 2f36 340a 2020 2020 6874 7470  sues/64.    http
-00021890: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f6c  s://github.com/l
-000218a0: 6962 726f 7361 2f6c 6962 726f 7361 2f69  ibrosa/librosa/i
-000218b0: 7373 7565 732f 3638 310a 2020 2020 2222  ssues/681.    ""
-000218c0: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
-000218d0: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
-000218e0: 6e20 5079 5061 636b 6167 6552 6571 7569  n PyPackageRequi
-000218f0: 7265 6d65 6e74 730a 2020 2020 2020 2020  rements.        
-00021900: 696d 706f 7274 2061 7564 696f 7265 6164  import audioread
-00021910: 0a20 2020 2065 7863 6570 7420 496d 706f  .    except Impo
-00021920: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
-00021930: 2072 6574 7572 6e0a 2020 2020 2320 6e6f   return.    # no
-00021940: 696e 7370 6563 7469 6f6e 2050 7950 726f  inspection PyPro
-00021950: 7465 6374 6564 4d65 6d62 6572 0a20 2020  tectedMember.   
-00021960: 2072 6573 203d 2061 7564 696f 7265 6164   res = audioread
-00021970: 2e5f 6361 5f61 7661 696c 6162 6c65 2829  ._ca_available()
-00021980: 0a20 2020 2061 7564 696f 7265 6164 2e5f  .    audioread._
-00021990: 6361 5f61 7661 696c 6162 6c65 203d 206c  ca_available = l
-000219a0: 616d 6264 613a 2072 6573 0a0a 0a5f 6366  ambda: res..._cf
-000219b0: 5f63 6163 6865 203d 207b 7d0a 5f63 665f  _cache = {}._cf_
-000219c0: 6d73 675f 7072 696e 7465 6420 3d20 4661  msg_printed = Fa
-000219d0: 6c73 650a 0a0a 6465 6620 6366 2866 696c  lse...def cf(fil
-000219e0: 656e 616d 6529 3a0a 2020 2020 2222 220a  ename):.    """.
-000219f0: 2020 2020 4361 6368 6520 6d61 6e61 6765      Cache manage
-00021a00: 722e 2069 3620 7370 6563 6966 6963 2e0a  r. i6 specific..
-00021a10: 0a20 2020 203a 7265 7475 726e 3a20 6669  .    :return: fi
-00021a20: 6c65 6e61 6d65 0a20 2020 203a 7274 7970  lename.    :rtyp
-00021a30: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
-00021a40: 2020 2067 6c6f 6261 6c20 5f63 665f 6d73     global _cf_ms
-00021a50: 675f 7072 696e 7465 640a 2020 2020 696d  g_printed.    im
-00021a60: 706f 7274 206f 730a 2020 2020 6672 6f6d  port os.    from
-00021a70: 2073 7562 7072 6f63 6573 7320 696d 706f   subprocess impo
-00021a80: 7274 2063 6865 636b 5f6f 7574 7075 740a  rt check_output.
-00021a90: 0a20 2020 2069 6620 6669 6c65 6e61 6d65  .    if filename
-00021aa0: 2069 6e20 5f63 665f 6361 6368 653a 0a20   in _cf_cache:. 
-00021ab0: 2020 2020 2020 2072 6574 7572 6e20 5f63         return _c
-00021ac0: 665f 6361 6368 655b 6669 6c65 6e61 6d65  f_cache[filename
-00021ad0: 5d0a 2020 2020 6465 6275 675f 6d6f 6465  ].    debug_mode
-00021ae0: 203d 2069 6e74 286f 732e 656e 7669 726f   = int(os.enviro
-00021af0: 6e2e 6765 7428 2244 4542 5547 222c 2030  n.get("DEBUG", 0
-00021b00: 2929 0a20 2020 2069 6620 6465 6275 675f  )).    if debug_
-00021b10: 6d6f 6465 206f 7220 6765 745f 686f 7374  mode or get_host
-00021b20: 6e61 6d65 2829 203d 3d20 2263 6c75 7374  name() == "clust
-00021b30: 6572 2d63 6e2d 3231 3122 206f 7220 6e6f  er-cn-211" or no
-00021b40: 7420 6973 5f72 756e 6e69 6e67 5f6f 6e5f  t is_running_on_
-00021b50: 636c 7573 7465 7228 293a 0a20 2020 2020  cluster():.     
-00021b60: 2020 2069 6620 6e6f 7420 5f63 665f 6d73     if not _cf_ms
-00021b70: 675f 7072 696e 7465 643a 0a20 2020 2020  g_printed:.     
-00021b80: 2020 2020 2020 2070 7269 6e74 2822 4361         print("Ca
-00021b90: 6368 6520 6d61 6e61 6765 723a 206e 6f74  che manager: not
-00021ba0: 2075 7365 642c 2075 7365 206c 6f63 616c   used, use local
-00021bb0: 2066 696c 653a 2025 7320 2864 6973 6361   file: %s (disca
-00021bc0: 7264 2066 7572 7468 6572 206d 6573 7361  rd further messa
-00021bd0: 6765 7329 2220 2520 6669 6c65 6e61 6d65  ges)" % filename
-00021be0: 290a 2020 2020 2020 2020 2020 2020 5f63  ).            _c
-00021bf0: 665f 6d73 675f 7072 696e 7465 6420 3d20  f_msg_printed = 
-00021c00: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-00021c10: 7572 6e20 6669 6c65 6e61 6d65 2020 2320  urn filename  # 
-00021c20: 666f 7220 6465 6275 6767 696e 670a 2020  for debugging.  
-00021c30: 2020 7472 793a 0a20 2020 2020 2020 2063    try:.        c
-00021c40: 6163 6865 645f 666e 203d 2063 6865 636b  ached_fn = check
-00021c50: 5f6f 7574 7075 7428 5b22 6366 222c 2066  _output(["cf", f
-00021c60: 696c 656e 616d 655d 292e 7374 7269 7028  ilename]).strip(
-00021c70: 292e 6465 636f 6465 2822 7574 6638 2229  ).decode("utf8")
-00021c80: 0a20 2020 2065 7863 6570 7420 4361 6c6c  .    except Call
-00021c90: 6564 5072 6f63 6573 7345 7272 6f72 3a0a  edProcessError:.
-00021ca0: 2020 2020 2020 2020 6966 206e 6f74 205f          if not _
-00021cb0: 6366 5f6d 7367 5f70 7269 6e74 6564 3a0a  cf_msg_printed:.
-00021cc0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00021cd0: 7428 2243 6163 6865 206d 616e 6167 6572  t("Cache manager
-00021ce0: 3a20 4572 726f 7220 6f63 6375 7272 6564  : Error occurred
-00021cf0: 2c20 7573 696e 6720 6c6f 6361 6c20 6669  , using local fi
-00021d00: 6c65 2229 0a20 2020 2020 2020 2020 2020  le").           
-00021d10: 205f 6366 5f6d 7367 5f70 7269 6e74 6564   _cf_msg_printed
-00021d20: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00021d30: 7265 7475 726e 2066 696c 656e 616d 650a  return filename.
-00021d40: 2020 2020 6173 7365 7274 206f 732e 7061      assert os.pa
-00021d50: 7468 2e65 7869 7374 7328 6361 6368 6564  th.exists(cached
-00021d60: 5f66 6e29 0a20 2020 205f 6366 5f63 6163  _fn).    _cf_cac
-00021d70: 6865 5b66 696c 656e 616d 655d 203d 2063  he[filename] = c
-00021d80: 6163 6865 645f 666e 0a20 2020 2072 6574  ached_fn.    ret
-00021d90: 7572 6e20 6361 6368 6564 5f66 6e0a 0a0a  urn cached_fn...
-00021da0: 6465 6620 6269 6e61 7279 5f73 6561 7263  def binary_searc
-00021db0: 685f 616e 7928 636d 702c 206c 6f77 2c20  h_any(cmp, low, 
-00021dc0: 6869 6768 293a 0a20 2020 2022 2222 0a20  high):.    """. 
-00021dd0: 2020 2042 696e 6172 7920 7365 6172 6368     Binary search
-00021de0: 2066 6f72 2061 2063 7573 746f 6d20 636f   for a custom co
-00021df0: 6d70 6172 6520 6675 6e63 7469 6f6e 2e0a  mpare function..
-00021e00: 0a20 2020 203a 7061 7261 6d20 2869 6e74  .    :param (int
-00021e10: 292d 3e69 6e74 2063 6d70 3a20 652e 672e  )->int cmp: e.g.
-00021e20: 2063 6d70 2869 6478 2920 3d3d 2063 6f6d   cmp(idx) == com
-00021e30: 7061 7265 2861 7272 6179 5b69 6478 5d2c  pare(array[idx],
-00021e40: 206b 6579 290a 2020 2020 3a70 6172 616d   key).    :param
-00021e50: 2069 6e74 206c 6f77 3a20 696e 636c 7573   int low: inclus
-00021e60: 6976 650a 2020 2020 3a70 6172 616d 2069  ive.    :param i
-00021e70: 6e74 2068 6967 683a 2065 7863 6c75 7369  nt high: exclusi
-00021e80: 7665 0a20 2020 203a 7274 7970 653a 2069  ve.    :rtype: i
-00021e90: 6e74 7c4e 6f6e 650a 2020 2020 2222 220a  nt|None.    """.
-00021ea0: 2020 2020 7768 696c 6520 6c6f 7720 3c20      while low < 
-00021eb0: 6869 6768 3a0a 2020 2020 2020 2020 6d69  high:.        mi
-00021ec0: 6420 3d20 286c 6f77 202b 2068 6967 6829  d = (low + high)
-00021ed0: 202f 2f20 320a 2020 2020 2020 2020 7220   // 2.        r 
-00021ee0: 3d20 636d 7028 6d69 6429 0a20 2020 2020  = cmp(mid).     
-00021ef0: 2020 2069 6620 7220 3c20 303a 0a20 2020     if r < 0:.   
-00021f00: 2020 2020 2020 2020 206c 6f77 203d 206d           low = m
-00021f10: 6964 202b 2031 0a20 2020 2020 2020 2065  id + 1.        e
-00021f20: 6c69 6620 7220 3e20 303a 0a20 2020 2020  lif r > 0:.     
-00021f30: 2020 2020 2020 2068 6967 6820 3d20 6d69         high = mi
-00021f40: 640a 2020 2020 2020 2020 656c 7365 3a0a  d.        else:.
-00021f50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00021f60: 726e 206d 6964 0a20 2020 2072 6574 7572  rn mid.    retur
-00021f70: 6e20 6c6f 770a 0a0a 6465 6620 6765 6e65  n low...def gene
-00021f80: 7269 635f 696d 706f 7274 5f6d 6f64 756c  ric_import_modul
-00021f90: 6528 6669 6c65 6e61 6d65 293a 0a20 2020  e(filename):.   
-00021fa0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-00021fb0: 7374 7220 6669 6c65 6e61 6d65 3a0a 2020  str filename:.  
-00021fc0: 2020 2020 5765 2074 7279 2074 6f20 6265      We try to be
-00021fd0: 2063 6c65 7665 7220 6162 6f75 7420 6669   clever about fi
-00021fe0: 6c65 6e61 6d65 2e0a 2020 2020 2020 4966  lename..      If
-00021ff0: 2069 7420 6c6f 6f6b 7320 6c69 6b65 2061   it looks like a
-00022000: 206d 6f64 756c 6520 6e61 6d65 2c20 6a75   module name, ju
-00022010: 7374 2064 6f20 696d 706f 7274 6c69 622e  st do importlib.
-00022020: 696d 706f 7274 5f6d 6f64 756c 652e 0a20  import_module.. 
-00022030: 2020 2020 2049 6620 6974 206c 6f6f 6b73       If it looks
-00022040: 206c 696b 6520 6120 6669 6c65 6e61 6d65   like a filename
-00022050: 2c20 7365 6172 6368 2066 6f72 2061 2062  , search for a b
-00022060: 6173 6520 7061 7468 2028 7768 6963 6820  ase path (which 
-00022070: 646f 6573 206e 6f74 2068 6176 6520 5f5f  does not have __
-00022080: 696e 6974 5f5f 2e70 7929 2c0a 2020 2020  init__.py),.    
-00022090: 2020 6164 6420 7468 6174 2070 6174 6820    add that path 
-000220a0: 746f 2073 7973 2e70 6174 6820 6966 206e  to sys.path if n
-000220b0: 6565 6465 642c 2061 6e64 2069 6d70 6f72  eeded, and impor
-000220c0: 7420 7468 6520 7265 6d61 696e 696e 6720  t the remaining 
-000220d0: 7768 6572 6520 222f 2220 6973 2072 6570  where "/" is rep
-000220e0: 6c61 6365 6420 6279 2022 2e22 0a20 2020  laced by ".".   
-000220f0: 2020 2061 6e64 2074 6865 2066 696c 6520     and the file 
-00022100: 6578 7465 6e73 696f 6e20 6973 2072 656d  extension is rem
-00022110: 6f76 6564 2e0a 2020 2020 3a72 6574 7572  oved..    :retur
-00022120: 6e3a 2074 6865 206d 6f64 756c 650a 2020  n: the module.  
-00022130: 2020 3a72 7479 7065 3a20 7479 7065 732e    :rtype: types.
-00022140: 4d6f 6475 6c65 5479 7065 0a20 2020 2022  ModuleType.    "
-00022150: 2222 0a20 2020 2061 7373 6572 7420 6669  "".    assert fi
-00022160: 6c65 6e61 6d65 0a20 2020 2069 6d70 6f72  lename.    impor
-00022170: 7420 696d 706f 7274 6c69 620a 0a20 2020  t importlib..   
-00022180: 2069 6620 222f 2220 6e6f 7420 696e 2066   if "/" not in f
-00022190: 696c 656e 616d 653a 0a20 2020 2020 2020  ilename:.       
-000221a0: 2072 6574 7572 6e20 696d 706f 7274 6c69   return importli
-000221b0: 622e 696d 706f 7274 5f6d 6f64 756c 6528  b.import_module(
-000221c0: 6669 6c65 6e61 6d65 290a 2020 2020 7072  filename).    pr
-000221d0: 6566 6978 5f64 6972 203d 2022 220a 2020  efix_dir = "".  
-000221e0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-000221f0: 2e65 7869 7374 7328 6669 6c65 6e61 6d65  .exists(filename
-00022200: 293a 0a20 2020 2020 2020 2061 7373 6572  ):.        asser
-00022210: 7420 6669 6c65 6e61 6d65 5b30 5d20 213d  t filename[0] !=
-00022220: 2022 2f22 0a20 2020 2020 2020 2023 204d   "/".        # M
-00022230: 6179 6265 2072 656c 6174 6976 6520 746f  aybe relative to
-00022240: 2052 6574 7572 6e6e 3f0a 2020 2020 2020   Returnn?.      
-00022250: 2020 7072 6566 6978 5f64 6972 203d 2022    prefix_dir = "
-00022260: 2573 2f22 2025 2072 6574 7572 6e6e 5f72  %s/" % returnn_r
-00022270: 6f6f 745f 6469 720a 2020 2020 6173 7365  oot_dir.    asse
-00022280: 7274 206f 732e 7061 7468 2e65 7869 7374  rt os.path.exist
-00022290: 7328 7072 6566 6978 5f64 6972 202b 2066  s(prefix_dir + f
-000222a0: 696c 656e 616d 6529 0a20 2020 2061 7373  ilename).    ass
-000222b0: 6572 7420 6669 6c65 6e61 6d65 2e65 6e64  ert filename.end
-000222c0: 7377 6974 6828 222e 7079 2229 206f 7220  swith(".py") or 
-000222d0: 6f73 2e70 6174 682e 6973 6469 7228 7072  os.path.isdir(pr
-000222e0: 6566 6978 5f64 6972 202b 2066 696c 656e  efix_dir + filen
-000222f0: 616d 6529 0a20 2020 2064 6972 7320 3d20  ame).    dirs = 
-00022300: 6669 6c65 6e61 6d65 2e73 706c 6974 2822  filename.split("
-00022310: 2f22 290a 2020 2020 6469 7273 2c20 6261  /").    dirs, ba
-00022320: 7365 5f66 6e20 3d20 6469 7273 5b3a 2d31  se_fn = dirs[:-1
-00022330: 5d2c 2064 6972 735b 2d31 5d0a 2020 2020  ], dirs[-1].    
-00022340: 6173 7365 7274 206c 656e 2864 6972 7329  assert len(dirs)
-00022350: 203e 3d20 310a 2020 2020 666f 7220 6920   >= 1.    for i 
-00022360: 696e 2072 6576 6572 7365 6428 7261 6e67  in reversed(rang
-00022370: 6528 6c65 6e28 6469 7273 2929 293a 0a20  e(len(dirs))):. 
-00022380: 2020 2020 2020 2064 203d 2070 7265 6669         d = prefi
-00022390: 785f 6469 7220 2b20 222f 222e 6a6f 696e  x_dir + "/".join
-000223a0: 2864 6972 735b 3a20 6920 2b20 315d 290a  (dirs[: i + 1]).
-000223b0: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
-000223c0: 732e 7061 7468 2e69 7364 6972 2864 290a  s.path.isdir(d).
-000223d0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-000223e0: 7468 2e65 7869 7374 7328 2225 732f 5f5f  th.exists("%s/__
-000223f0: 696e 6974 5f5f 2e70 7922 2025 2064 293a  init__.py" % d):
-00022400: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00022410: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
-00022420: 2064 206e 6f74 2069 6e20 7379 732e 7061   d not in sys.pa
-00022430: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-00022440: 7379 732e 7061 7468 2e61 7070 656e 6428  sys.path.append(
-00022450: 6429 0a20 2020 2020 2020 206d 203d 2022  d).        m = "
-00022460: 2e22 2e6a 6f69 6e28 6469 7273 5b69 202b  .".join(dirs[i +
-00022470: 2031 203a 5d20 2b20 5b62 6173 655f 666e   1 :] + [base_fn
-00022480: 5d29 0a20 2020 2020 2020 2069 6620 6261  ]).        if ba
-00022490: 7365 5f66 6e2e 656e 6473 7769 7468 2822  se_fn.endswith("
-000224a0: 2e70 7922 293a 0a20 2020 2020 2020 2020  .py"):.         
-000224b0: 2020 206d 203d 206d 5b3a 2d33 5d0a 2020     m = m[:-3].  
-000224c0: 2020 2020 2020 7265 7475 726e 2069 6d70        return imp
-000224d0: 6f72 746c 6962 2e69 6d70 6f72 745f 6d6f  ortlib.import_mo
-000224e0: 6475 6c65 286d 290a 2020 2020 7261 6973  dule(m).    rais
-000224f0: 6520 5661 6c75 6545 7272 6f72 2822 6361  e ValueError("ca
-00022500: 6e6e 6f74 2066 6967 7572 6520 6f75 7420  nnot figure out 
-00022510: 6261 7365 206d 6f64 756c 6520 7061 7468  base module path
-00022520: 2066 726f 6d20 2572 2220 2520 6669 6c65   from %r" % file
-00022530: 6e61 6d65 290a 0a0a 6465 6620 736f 6674  name)...def soft
-00022540: 6d61 7828 782c 2061 7869 733d 4e6f 6e65  max(x, axis=None
-00022550: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00022560: 7061 7261 6d20 6e75 6d70 792e 6e64 6172  param numpy.ndar
-00022570: 7261 7920 783a 0a20 2020 203a 7061 7261  ray x:.    :para
-00022580: 6d20 696e 747c 4e6f 6e65 2061 7869 733a  m int|None axis:
-00022590: 0a20 2020 203a 7274 7970 653a 206e 756d  .    :rtype: num
-000225a0: 7079 2e6e 6461 7272 6179 0a20 2020 2022  py.ndarray.    "
-000225b0: 2222 0a20 2020 2069 6d70 6f72 7420 6e75  "".    import nu
-000225c0: 6d70 790a 0a20 2020 2065 5f78 203d 206e  mpy..    e_x = n
-000225d0: 756d 7079 2e65 7870 2878 202d 206e 756d  umpy.exp(x - num
-000225e0: 7079 2e6d 6178 2878 2c20 6178 6973 3d61  py.max(x, axis=a
-000225f0: 7869 732c 206b 6565 7064 696d 733d 5472  xis, keepdims=Tr
-00022600: 7565 2929 0a20 2020 2072 6574 7572 6e20  ue)).    return 
-00022610: 655f 7820 2f20 6e75 6d70 792e 7375 6d28  e_x / numpy.sum(
-00022620: 655f 782c 2061 7869 733d 6178 6973 2c20  e_x, axis=axis, 
-00022630: 6b65 6570 6469 6d73 3d54 7275 6529 0a0a  keepdims=True)..
-00022640: 0a64 6566 2063 6f6c 6c65 6374 5f70 726f  .def collect_pro
-00022650: 635f 6d61 7073 5f65 7865 635f 6669 6c65  c_maps_exec_file
-00022660: 7328 293a 0a20 2020 2022 2222 0a20 2020  s():.    """.   
-00022670: 2043 7572 7265 6e74 6c79 206f 6e6c 7920   Currently only 
-00022680: 776f 726b 7320 6f6e 204c 696e 7578 2e2e  works on Linux..
-00022690: 2e0a 0a20 2020 203a 7265 7475 726e 3a20  ...    :return: 
-000226a0: 6c69 7374 206f 6620 6d61 7070 6564 2065  list of mapped e
-000226b0: 7865 6375 7461 626c 6573 2028 6c69 6273  xecutables (libs
-000226c0: 290a 2020 2020 3a72 7479 7065 3a20 6c69  ).    :rtype: li
-000226d0: 7374 5b73 7472 5d0a 2020 2020 2222 220a  st[str].    """.
-000226e0: 2020 2020 696d 706f 7274 2072 650a 0a20      import re.. 
-000226f0: 2020 2070 6964 203d 206f 732e 6765 7470     pid = os.getp
-00022700: 6964 2829 0a20 2020 2066 6e73 203d 205b  id().    fns = [
-00022710: 5d0a 2020 2020 666f 7220 6c69 6e65 2069  ].    for line i
-00022720: 6e20 6f70 656e 2822 2f70 726f 632f 2569  n open("/proc/%i
-00022730: 2f6d 6170 7322 2025 2070 6964 2c20 2272  /maps" % pid, "r
-00022740: 2229 2e72 6561 6428 292e 7370 6c69 746c  ").read().splitl
-00022750: 696e 6573 2829 3a20 2023 2066 6f72 2065  ines():  # for e
-00022760: 6163 6820 6d61 7070 6564 2072 6567 696f  ach mapped regio
-00022770: 6e0a 2020 2020 2020 2020 2320 6874 7470  n.        # http
-00022780: 733a 2f2f 7374 6163 6b6f 7665 7266 6c6f  s://stackoverflo
-00022790: 772e 636f 6d2f 7175 6573 7469 6f6e 732f  w.com/questions/
-000227a0: 3134 3031 3335 392f 756e 6465 7273 7461  1401359/understa
-000227b0: 6e64 696e 672d 6c69 6e75 782d 7072 6f63  nding-linux-proc
-000227c0: 2d69 642d 6d61 7073 0a20 2020 2020 2020  -id-maps.       
-000227d0: 2023 2061 6464 7265 7373 2020 2020 2020   # address      
-000227e0: 2020 2020 2070 6572 6d73 206f 6666 7365       perms offse
-000227f0: 7420 2064 6576 2020 2069 6e6f 6465 2020  t  dev   inode  
-00022800: 2070 6174 686e 616d 650a 2020 2020 2020   pathname.      
-00022810: 2020 2320 452e 672e 3a0a 2020 2020 2020    # E.g.:.      
-00022820: 2020 2320 3766 6632 6465 3931 6330 3030    # 7ff2de91c000
-00022830: 2d37 6666 3264 6539 3165 3030 3020 7277  -7ff2de91e000 rw
-00022840: 2d70 2030 3031 3763 3030 3020 3038 3a30  -p 0017c000 08:0
-00022850: 3220 3739 3438 3434 2020 2020 2020 2020  2 794844        
-00022860: 2020 2020 2020 2020 2020 2020 202f 7573               /us
-00022870: 722f 6c69 622f 7838 365f 3634 2d6c 696e  r/lib/x86_64-lin
-00022880: 7578 2d67 6e75 2f6c 6962 7374 6463 2b2e  ux-gnu/libstdc+.
-00022890: 2e2e 0a20 2020 2020 2020 206d 203d 2072  ...        m = r
-000228a0: 652e 6d61 7463 6828 0a20 2020 2020 2020  e.match(.       
-000228b0: 2020 2020 2072 225e 285b 302d 3941 2d46       r"^([0-9A-F
-000228c0: 612d 665d 2b29 2d28 5b30 2d39 412d 4661  a-f]+)-([0-9A-Fa
-000228d0: 2d66 5d2b 295c 732b 285b 7277 7870 735c  -f]+)\s+([rwxps\
-000228e0: 2d5d 2b29 5c73 2b28 5b30 2d39 412d 4661  -]+)\s+([0-9A-Fa
-000228f0: 2d66 5d2b 295c 732b 285b 302d 3941 2d46  -f]+)\s+([0-9A-F
-00022900: 612d 663a 5d2b 295c 732b 285b 302d 395d  a-f:]+)\s+([0-9]
-00022910: 2b29 5c73 2a28 2e2a 2924 222c 206c 696e  +)\s*(.*)$", lin
-00022920: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
-00022930: 2020 2020 6173 7365 7274 206d 2c20 226e      assert m, "n
-00022940: 6f20 6d61 7463 6820 666f 7220 2572 2220  o match for %r" 
-00022950: 2520 6c69 6e65 0a20 2020 2020 2020 2061  % line.        a
-00022960: 6464 7265 7373 5f73 7461 7274 2c20 6164  ddress_start, ad
-00022970: 6472 6573 735f 656e 642c 2070 6572 6d73  dress_end, perms
-00022980: 2c20 6f66 6673 6574 2c20 6465 762c 2069  , offset, dev, i
-00022990: 5f6e 6f64 652c 2070 6174 685f 6e61 6d65  _node, path_name
-000229a0: 203d 206d 2e67 726f 7570 7328 290a 2020   = m.groups().  
-000229b0: 2020 2020 2020 6966 2022 7822 206e 6f74        if "x" not
-000229c0: 2069 6e20 7065 726d 733a 0a20 2020 2020   in perms:.     
-000229d0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000229e0: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
-000229f0: 6174 685f 6e61 6d65 206f 7220 7061 7468  ath_name or path
-00022a00: 5f6e 616d 652e 7374 6172 7473 7769 7468  _name.startswith
-00022a10: 2822 5b22 2920 6f72 2022 2864 656c 6574  ("[") or "(delet
-00022a20: 6564 2922 2069 6e20 7061 7468 5f6e 616d  ed)" in path_nam
-00022a30: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-00022a40: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00022a50: 6966 2070 6174 685f 6e61 6d65 206e 6f74  if path_name not
-00022a60: 2069 6e20 666e 733a 0a20 2020 2020 2020   in fns:.       
-00022a70: 2020 2020 2066 6e73 2e61 7070 656e 6428       fns.append(
-00022a80: 7061 7468 5f6e 616d 6529 0a20 2020 2072  path_name).    r
-00022a90: 6574 7572 6e20 666e 730a 0a0a 6465 6620  eturn fns...def 
-00022aa0: 6669 6e64 5f73 796d 5f69 6e5f 6578 6563  find_sym_in_exec
-00022ab0: 2866 6e2c 2073 796d 293a 0a20 2020 2022  (fn, sym):.    "
-00022ac0: 2222 0a20 2020 2055 7365 7320 6060 6f62  "".    Uses ``ob
-00022ad0: 6a64 756d 7060 6020 746f 206c 6973 7420  jdump`` to list 
-00022ae0: 6176 6169 6c61 626c 6520 7379 6d62 6f6c  available symbol
-00022af0: 732c 2061 6e64 2066 696c 7465 7273 2074  s, and filters t
-00022b00: 6865 6d20 6279 2074 6865 2067 6976 656e  hem by the given
-00022b10: 2060 6073 796d 6060 2e0a 0a20 2020 203a   ``sym``...    :
-00022b20: 7061 7261 6d20 7374 7220 666e 3a20 7061  param str fn: pa
-00022b30: 7468 0a20 2020 203a 7061 7261 6d20 7374  th.    :param st
-00022b40: 7220 7379 6d3a 0a20 2020 203a 7265 7475  r sym:.    :retu
-00022b50: 726e 3a20 6d61 7463 6865 6420 6f75 742c  rn: matched out,
-00022b60: 206f 7220 4e6f 6e65 0a20 2020 203a 7274   or None.    :rt
-00022b70: 7970 653a 2073 7472 7c4e 6f6e 650a 2020  ype: str|None.  
-00022b80: 2020 2222 220a 2020 2020 6672 6f6d 2073    """.    from s
-00022b90: 7562 7072 6f63 6573 7320 696d 706f 7274  ubprocess import
-00022ba0: 2043 616c 6c65 6450 726f 6365 7373 4572   CalledProcessEr
-00022bb0: 726f 720a 0a20 2020 206f 626a 6475 6d70  ror..    objdump
-00022bc0: 203d 2022 6f62 6a64 756d 7020 2d54 220a   = "objdump -T".
-00022bd0: 2020 2020 6966 2073 7973 2e70 6c61 7466      if sys.platf
-00022be0: 6f72 6d20 3d3d 2022 6461 7277 696e 223a  orm == "darwin":
-00022bf0: 0a20 2020 2020 2020 206f 626a 6475 6d70  .        objdump
-00022c00: 203d 2022 6f74 6f6f 6c20 2d49 4847 7622   = "otool -IHGv"
-00022c10: 0a20 2020 2073 6865 6c6c 5f63 6d64 203d  .    shell_cmd =
-00022c20: 2022 2573 2025 7320 7c20 6772 6570 2025   "%s %s | grep %
-00022c30: 7322 2025 2028 6f62 6a64 756d 702c 2066  s" % (objdump, f
-00022c40: 6e2c 2073 796d 290a 2020 2020 7472 793a  n, sym).    try:
-00022c50: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
-00022c60: 7973 5f65 7865 635f 6f75 7428 7368 656c  ys_exec_out(shel
-00022c70: 6c5f 636d 642c 2073 6865 6c6c 3d54 7275  l_cmd, shell=Tru
-00022c80: 6529 0a20 2020 2065 7863 6570 7420 4361  e).    except Ca
-00022c90: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00022ca0: 3a20 2023 206e 6f6e 6520 666f 756e 640a  :  # none found.
-00022cb0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00022cc0: 6f6e 650a 2020 2020 6173 7365 7274 2069  one.    assert i
-00022cd0: 7369 6e73 7461 6e63 6528 6f75 742c 2028  sinstance(out, (
-00022ce0: 7374 722c 2075 6e69 636f 6465 2929 0a20  str, unicode)). 
-00022cf0: 2020 206f 7574 5f6c 6e73 203d 206f 7574     out_lns = out
-00022d00: 2e73 706c 6974 6c69 6e65 7328 290a 2020  .splitlines().  
-00022d10: 2020 6f75 745f 6c6e 7320 3d20 5b6c 6e20    out_lns = [ln 
-00022d20: 666f 7220 6c6e 2069 6e20 6f75 745f 6c6e  for ln in out_ln
-00022d30: 7320 6966 2022 2e74 6578 7422 2069 6e20  s if ".text" in 
-00022d40: 6c6e 5d20 2023 2073 6565 206f 626a 6475  ln]  # see objdu
-00022d50: 6d70 0a20 2020 206f 7574 5f6c 6e73 203d  mp.    out_lns =
-00022d60: 205b 6c6e 2066 6f72 206c 6e20 696e 206f   [ln for ln in o
-00022d70: 7574 5f6c 6e73 2069 6620 7379 6d20 696e  ut_lns if sym in
-00022d80: 206c 6e2e 7370 6c69 7428 295d 0a20 2020   ln.split()].   
-00022d90: 2069 6620 6e6f 7420 6f75 745f 6c6e 733a   if not out_lns:
-00022da0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022db0: 4e6f 6e65 0a20 2020 2072 6574 7572 6e20  None.    return 
-00022dc0: 2246 6f75 6e64 2025 7220 696e 2025 723a  "Found %r in %r:
-00022dd0: 5c6e 2573 2220 2520 2873 796d 2c20 666e  \n%s" % (sym, fn
-00022de0: 2c20 225c 6e22 2e6a 6f69 6e28 6f75 745f  , "\n".join(out_
-00022df0: 6c6e 7329 290a 0a0a 6465 6620 6475 6d6d  lns))...def dumm
-00022e00: 795f 6e75 6d70 795f 6765 6d6d 5f63 616c  y_numpy_gemm_cal
-00022e10: 6c28 293a 0a20 2020 2022 2222 0a20 2020  l():.    """.   
-00022e20: 204a 7573 7420 7065 7266 6f72 6d73 2073   Just performs s
-00022e30: 6f6d 6520 4745 4d4d 2063 616c 6c20 7669  ome GEMM call vi
-00022e40: 6120 4e75 6d70 792e 0a20 2020 2054 6869  a Numpy..    Thi
-00022e50: 7320 6d61 6b65 7320 7375 7265 2074 6861  s makes sure tha
-00022e60: 7420 7468 6520 424c 4153 206c 6962 7261  t the BLAS libra
-00022e70: 7279 2069 7320 6c6f 6164 6564 2e0a 2020  ry is loaded..  
-00022e80: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
-00022e90: 206e 756d 7079 0a0a 2020 2020 6120 3d20   numpy..    a = 
-00022ea0: 6e75 6d70 792e 7261 6e64 6f6d 2e72 616e  numpy.random.ran
-00022eb0: 646e 2835 2c20 3329 2e61 7374 7970 6528  dn(5, 3).astype(
-00022ec0: 6e75 6d70 792e 666c 6f61 7433 3229 0a20  numpy.float32). 
-00022ed0: 2020 2062 203d 206e 756d 7079 2e72 616e     b = numpy.ran
-00022ee0: 646f 6d2e 7261 6e64 6e28 332c 2037 292e  dom.randn(3, 7).
-00022ef0: 6173 7479 7065 286e 756d 7079 2e66 6c6f  astype(numpy.flo
-00022f00: 6174 3332 290a 2020 2020 6320 3d20 6e75  at32).    c = nu
-00022f10: 6d70 792e 646f 7428 612c 2062 290a 2020  mpy.dot(a, b).  
-00022f20: 2020 6173 7365 7274 206e 756d 7079 2e69    assert numpy.i
-00022f30: 7366 696e 6974 6528 6329 2e61 6c6c 2829  sfinite(c).all()
-00022f40: 0a0a 0a5f 6669 6e64 5f73 6765 6d6d 5f6c  ..._find_sgemm_l
-00022f50: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
-00022f60: 6361 6368 6564 203d 204e 6f6e 650a 0a0a  cached = None...
-00022f70: 6465 6620 6669 6e64 5f73 6765 6d6d 5f6c  def find_sgemm_l
-00022f80: 6962 735f 6672 6f6d 5f72 756e 7469 6d65  ibs_from_runtime
-00022f90: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00022fa0: 4c6f 6f6b 7320 7468 726f 7567 6820 616c  Looks through al
-00022fb0: 6c20 6c69 6273 2076 6961 203a 6675 6e63  l libs via :func
-00022fc0: 3a60 636f 6c6c 6563 745f 7072 6f63 5f6d  :`collect_proc_m
-00022fd0: 6170 735f 6578 6563 5f66 696c 6573 602c  aps_exec_files`,
-00022fe0: 0a20 2020 2061 6e64 2073 6561 7263 6865  .    and searche
-00022ff0: 7320 666f 7220 616c 6c20 7768 6963 6820  s for all which 
-00023000: 6861 7665 2074 6865 2060 6073 6765 6d6d  have the ``sgemm
-00023010: 6060 2073 796d 626f 6c2e 0a20 2020 2043  `` symbol..    C
-00023020: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
-00023030: 726b 7320 6f6e 204c 696e 7578 2028 6265  rks on Linux (be
-00023040: 6361 7573 6520 636f 6c6c 6563 745f 7072  cause collect_pr
-00023050: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
-00023060: 6573 292e 0a0a 2020 2020 3a72 6574 7572  es)...    :retur
-00023070: 6e3a 206c 6973 7420 6f66 206c 6962 7320  n: list of libs 
-00023080: 2874 6865 6972 2070 6174 6829 0a20 2020  (their path).   
-00023090: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
-000230a0: 725d 0a20 2020 2022 2222 0a20 2020 2069  r].    """.    i
-000230b0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-000230c0: 6973 7473 2822 2f70 726f 6322 293a 0a20  ists("/proc"):. 
-000230d0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000230e0: 6e65 0a20 2020 2067 6c6f 6261 6c20 5f66  ne.    global _f
-000230f0: 696e 645f 7367 656d 6d5f 6c69 625f 6672  ind_sgemm_lib_fr
-00023100: 6f6d 5f72 756e 7469 6d65 5f63 6163 6865  om_runtime_cache
-00023110: 640a 2020 2020 6966 205f 6669 6e64 5f73  d.    if _find_s
-00023120: 6765 6d6d 5f6c 6962 5f66 726f 6d5f 7275  gemm_lib_from_ru
-00023130: 6e74 696d 655f 6361 6368 6564 2069 7320  ntime_cached is 
-00023140: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00023150: 2020 7265 7475 726e 205f 6669 6e64 5f73    return _find_s
-00023160: 6765 6d6d 5f6c 6962 5f66 726f 6d5f 7275  gemm_lib_from_ru
-00023170: 6e74 696d 655f 6361 6368 6564 0a20 2020  ntime_cached.   
-00023180: 2064 756d 6d79 5f6e 756d 7079 5f67 656d   dummy_numpy_gem
-00023190: 6d5f 6361 6c6c 2829 2020 2320 6d61 6b65  m_call()  # make
-000231a0: 2073 7572 6520 7468 6174 204e 756d 7079   sure that Numpy
-000231b0: 2069 7320 6c6f 6164 6564 2061 6e64 204e   is loaded and N
-000231c0: 756d 7079 2073 6765 6d6d 2069 7320 6176  umpy sgemm is av
-000231d0: 6169 6c61 626c 650a 2020 2020 666e 7320  ailable.    fns 
-000231e0: 3d20 636f 6c6c 6563 745f 7072 6f63 5f6d  = collect_proc_m
-000231f0: 6170 735f 6578 6563 5f66 696c 6573 2829  aps_exec_files()
-00023200: 0a20 2020 2066 6e73 5f77 6974 685f 7367  .    fns_with_sg
-00023210: 656d 6d20 3d20 5b5d 0a20 2020 2066 6f72  emm = [].    for
-00023220: 2066 6e20 696e 2066 6e73 3a0a 2020 2020   fn in fns:.    
-00023230: 2020 2020 6f75 7420 3d20 6669 6e64 5f73      out = find_s
-00023240: 796d 5f69 6e5f 6578 6563 2866 6e2c 2022  ym_in_exec(fn, "
-00023250: 7367 656d 6d5f 2229 0a20 2020 2020 2020  sgemm_").       
-00023260: 2069 6620 6f75 743a 0a20 2020 2020 2020   if out:.       
-00023270: 2020 2020 2066 6e73 5f77 6974 685f 7367       fns_with_sg
-00023280: 656d 6d2e 6170 7065 6e64 2866 6e29 0a20  emm.append(fn). 
-00023290: 2020 205f 6669 6e64 5f73 6765 6d6d 5f6c     _find_sgemm_l
-000232a0: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
-000232b0: 6361 6368 6564 203d 2066 6e73 5f77 6974  cached = fns_wit
-000232c0: 685f 7367 656d 6d0a 2020 2020 7265 7475  h_sgemm.    retu
-000232d0: 726e 2066 6e73 5f77 6974 685f 7367 656d  rn fns_with_sgem
-000232e0: 6d0a 0a0a 5f66 696e 645f 6c69 6263 7564  m..._find_libcud
-000232f0: 6172 745f 6672 6f6d 5f72 756e 7469 6d65  art_from_runtime
-00023300: 5f63 6163 6865 6420 3d20 4e6f 6e65 0a0a  _cached = None..
-00023310: 0a64 6566 2066 696e 645f 6c69 6263 7564  .def find_libcud
-00023320: 6172 745f 6672 6f6d 5f72 756e 7469 6d65  art_from_runtime
-00023330: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00023340: 4c6f 6f6b 7320 7468 726f 7567 6820 616c  Looks through al
-00023350: 6c20 6c69 6273 2076 6961 203a 6675 6e63  l libs via :func
-00023360: 3a60 636f 6c6c 6563 745f 7072 6f63 5f6d  :`collect_proc_m
-00023370: 6170 735f 6578 6563 5f66 696c 6573 602c  aps_exec_files`,
-00023380: 0a20 2020 2061 6e64 2073 6561 7263 6865  .    and searche
-00023390: 7320 666f 7220 616c 6c20 7768 6963 6820  s for all which 
-000233a0: 6861 7665 2074 6865 2060 6073 6765 6d6d  have the ``sgemm
-000233b0: 6060 2073 796d 626f 6c2e 0a20 2020 2043  `` symbol..    C
-000233c0: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
-000233d0: 726b 7320 6f6e 204c 696e 7578 2028 6265  rks on Linux (be
-000233e0: 6361 7573 6520 636f 6c6c 6563 745f 7072  cause collect_pr
-000233f0: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
-00023400: 6573 292e 0a0a 2020 2020 3a72 6574 7572  es)...    :retur
-00023410: 6e3a 206c 6973 7420 6f66 206c 6962 7320  n: list of libs 
-00023420: 2874 6865 6972 2070 6174 6829 0a20 2020  (their path).   
-00023430: 203a 7274 7970 653a 2073 7472 7c4e 6f6e   :rtype: str|Non
-00023440: 650a 2020 2020 2222 220a 2020 2020 6966  e.    """.    if
-00023450: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-00023460: 7374 7328 222f 7072 6f63 2229 3a0a 2020  sts("/proc"):.  
-00023470: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00023480: 650a 2020 2020 676c 6f62 616c 205f 6669  e.    global _fi
-00023490: 6e64 5f6c 6962 6375 6461 7274 5f66 726f  nd_libcudart_fro
-000234a0: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
-000234b0: 0a20 2020 2069 6620 5f66 696e 645f 6c69  .    if _find_li
-000234c0: 6263 7564 6172 745f 6672 6f6d 5f72 756e  bcudart_from_run
-000234d0: 7469 6d65 5f63 6163 6865 6420 6973 206e  time_cached is n
-000234e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000234f0: 2072 6574 7572 6e20 5f66 696e 645f 6c69   return _find_li
-00023500: 6263 7564 6172 745f 6672 6f6d 5f72 756e  bcudart_from_run
-00023510: 7469 6d65 5f63 6163 6865 645b 305d 0a20  time_cached[0]. 
-00023520: 2020 2066 6e73 203d 2063 6f6c 6c65 6374     fns = collect
-00023530: 5f70 726f 635f 6d61 7073 5f65 7865 635f  _proc_maps_exec_
-00023540: 6669 6c65 7328 290a 2020 2020 666f 7220  files().    for 
-00023550: 666e 2069 6e20 666e 733a 0a20 2020 2020  fn in fns:.     
-00023560: 2020 2069 6620 7265 2e6d 6174 6368 2822     if re.match("
-00023570: 2e2a 2f6c 6962 6375 6461 7274 5c5c 2e73  .*/libcudart\\.s
-00023580: 6f28 5c5c 2e2e 2a29 3f22 2c20 666e 293a  o(\\..*)?", fn):
-00023590: 0a20 2020 2020 2020 2020 2020 205f 6669  .            _fi
-000235a0: 6e64 5f6c 6962 6375 6461 7274 5f66 726f  nd_libcudart_fro
-000235b0: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
-000235c0: 203d 205b 666e 5d0a 2020 2020 2020 2020   = [fn].        
-000235d0: 2020 2020 7265 7475 726e 2066 6e0a 2020      return fn.  
-000235e0: 2020 5f66 696e 645f 6c69 6263 7564 6172    _find_libcudar
-000235f0: 745f 6672 6f6d 5f72 756e 7469 6d65 5f63  t_from_runtime_c
-00023600: 6163 6865 6420 3d20 5b4e 6f6e 655d 0a20  ached = [None]. 
-00023610: 2020 2072 6574 7572 6e20 4e6f 6e65 0a       return None.
+0001aa10: 2020 202b 205b 2225 7320 2573 5c6e 2220     + ["%s %s\n" 
+0001aa20: 2520 2863 6f6d 6d65 6e74 5f70 7265 6669  % (comment_prefi
+0001aa30: 782c 2073 2920 666f 7220 7320 696e 2063  x, s) for s in c
+0001aa40: 6f6e 7465 6e74 5d0a 2020 2020 2020 2020  ontent].        
+0001aa50: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa70: 2020 2b20 225c 6e22 0a20 2020 2020 2020    + "\n".       
+0001aa80: 2020 2020 2020 2020 2029 0a20 2020 2065           ).    e
+0001aa90: 7863 6570 7420 4f53 4572 726f 7220 6173  xcept OSError as
+0001aaa0: 2065 7863 3a0a 2020 2020 2020 2020 6966   exc:.        if
+0001aab0: 2022 4469 736b 2071 756f 7461 2220 696e   "Disk quota" in
+0001aac0: 2073 7472 2865 7863 293a 0a20 2020 2020   str(exc):.     
+0001aad0: 2020 2020 2020 2070 7269 6e74 2822 6c6f         print("lo
+0001aae0: 675f 7275 6e74 696d 655f 696e 666f 5f74  g_runtime_info_t
+0001aaf0: 6f5f 6469 723a 2045 7272 6f72 2c20 6361  o_dir: Error, ca
+0001ab00: 6e6e 6f74 2077 7269 7465 3a20 2573 2220  nnot write: %s" 
+0001ab10: 2520 6578 6329 0a20 2020 2020 2020 2065  % exc).        e
+0001ab20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001ab30: 2072 6169 7365 0a0a 0a64 6566 2073 686f   raise...def sho
+0001ab40: 756c 645f 7772 6974 655f 746f 5f64 6973  uld_write_to_dis
+0001ab50: 6b28 636f 6e66 6967 293a 0a20 2020 2022  k(config):.    "
+0001ab60: 2222 0a20 2020 203a 7061 7261 6d20 7265  "".    :param re
+0001ab70: 7475 726e 6e2e 636f 6e66 6967 2e43 6f6e  turnn.config.Con
+0001ab80: 6669 6720 636f 6e66 6967 3a0a 2020 2020  fig config:.    
+0001ab90: 3a72 7479 7065 3a20 626f 6f6c 0a20 2020  :rtype: bool.   
+0001aba0: 2022 2222 0a20 2020 2069 6620 636f 6e66   """.    if conf
+0001abb0: 6967 2e69 735f 7472 7565 2822 7573 655f  ig.is_true("use_
+0001abc0: 686f 726f 766f 6422 293a 0a20 2020 2020  horovod"):.     
+0001abd0: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
+0001abe0: 6e20 5079 5061 636b 6167 6552 6571 7569  n PyPackageRequi
+0001abf0: 7265 6d65 6e74 732c 5079 556e 7265 736f  rements,PyUnreso
+0001ac00: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
+0001ac10: 2020 2020 2020 2069 6d70 6f72 7420 686f         import ho
+0001ac20: 726f 766f 642e 7465 6e73 6f72 666c 6f77  rovod.tensorflow
+0001ac30: 2061 7320 6876 640a 0a20 2020 2020 2020   as hvd..       
+0001ac40: 2069 6620 6876 642e 7261 6e6b 2829 2021   if hvd.rank() !
+0001ac50: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001ac60: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001ac70: 2020 6966 2063 6f6e 6669 672e 6973 5f74    if config.is_t
+0001ac80: 7275 6528 2264 7279 5f72 756e 2229 3a0a  rue("dry_run"):.
+0001ac90: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001aca0: 616c 7365 0a20 2020 2072 6574 7572 6e20  alse.    return 
+0001acb0: 5472 7565 0a0a 0a5f 6465 6661 756c 745f  True..._default_
+0001acc0: 676c 6f62 616c 5f69 6e66 5f76 616c 7565  global_inf_value
+0001acd0: 203d 2066 6c6f 6174 2822 696e 6622 290a   = float("inf").
+0001ace0: 0a0a 6465 6620 6765 745f 676c 6f62 616c  ..def get_global
+0001acf0: 5f69 6e66 5f76 616c 7565 2829 202d 3e20  _inf_value() -> 
+0001ad00: 666c 6f61 743a 0a20 2020 2022 2222 0a20  float:.    """. 
+0001ad10: 2020 203a 7265 7475 726e 3a20 666c 6f61     :return: floa
+0001ad20: 7428 2269 6e66 2229 2062 7920 6465 6661  t("inf") by defa
+0001ad30: 756c 742c 2062 7574 2074 7269 6573 2074  ult, but tries t
+0001ad40: 6f20 7265 6164 2060 696e 665f 7661 6c75  o read `inf_valu
+0001ad50: 6560 2066 726f 6d20 7468 6520 676c 6f62  e` from the glob
+0001ad60: 616c 2063 6f6e 6669 670a 2020 2020 2222  al config.    ""
+0001ad70: 220a 2020 2020 6672 6f6d 2072 6574 7572  ".    from retur
+0001ad80: 6e6e 2e63 6f6e 6669 6720 696d 706f 7274  nn.config import
+0001ad90: 2067 6574 5f67 6c6f 6261 6c5f 636f 6e66   get_global_conf
+0001ada0: 6967 0a0a 2020 2020 636f 6e66 6967 203d  ig..    config =
+0001adb0: 2067 6574 5f67 6c6f 6261 6c5f 636f 6e66   get_global_conf
+0001adc0: 6967 2872 6169 7365 5f65 7863 6570 7469  ig(raise_excepti
+0001add0: 6f6e 3d46 616c 7365 290a 2020 2020 6966  on=False).    if
+0001ade0: 206e 6f74 2063 6f6e 6669 673a 0a20 2020   not config:.   
+0001adf0: 2020 2020 2072 6574 7572 6e20 5f64 6566       return _def
+0001ae00: 6175 6c74 5f67 6c6f 6261 6c5f 696e 665f  ault_global_inf_
+0001ae10: 7661 6c75 650a 2020 2020 7265 7475 726e  value.    return
+0001ae20: 2063 6f6e 6669 672e 666c 6f61 7428 2269   config.float("i
+0001ae30: 6e66 5f76 616c 7565 222c 205f 6465 6661  nf_value", _defa
+0001ae40: 756c 745f 676c 6f62 616c 5f69 6e66 5f76  ult_global_inf_v
+0001ae50: 616c 7565 290a 0a0a 636c 6173 7320 4e61  alue)...class Na
+0001ae60: 7469 7665 436f 6465 436f 6d70 696c 6572  tiveCodeCompiler
+0001ae70: 286f 626a 6563 7429 3a0a 2020 2020 2222  (object):.    ""
+0001ae80: 220a 2020 2020 4865 6c70 6572 2063 6c61  ".    Helper cla
+0001ae90: 7373 2074 6f20 636f 6d70 696c 6520 6e61  ss to compile na
+0001aea0: 7469 7665 2043 2f43 2b2b 2063 6f64 6520  tive C/C++ code 
+0001aeb0: 6f6e 2d74 6865 2d66 6c79 2e0a 2020 2020  on-the-fly..    
+0001aec0: 2222 220a 0a20 2020 2043 6163 6865 4469  """..    CacheDi
+0001aed0: 724e 616d 6520 3d20 2272 6574 7572 6e6e  rName = "returnn
+0001aee0: 5f6e 6174 6976 6522 0a20 2020 2043 6f6c  _native".    Col
+0001aef0: 6c65 6374 6564 436f 6d70 696c 6572 7320  lectedCompilers 
+0001af00: 3d20 4e6f 6e65 2020 2320 7479 7065 3a20  = None  # type: 
+0001af10: 7479 7069 6e67 2e4f 7074 696f 6e61 6c5b  typing.Optional[
+0001af20: 7479 7069 6e67 2e4c 6973 745b 4e61 7469  typing.List[Nati
+0001af30: 7665 436f 6465 436f 6d70 696c 6572 5d5d  veCodeCompiler]]
+0001af40: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0001af50: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
+0001af60: 2c0a 2020 2020 2020 2020 6261 7365 5f6e  ,.        base_n
+0001af70: 616d 652c 0a20 2020 2020 2020 2063 6f64  ame,.        cod
+0001af80: 655f 7665 7273 696f 6e2c 0a20 2020 2020  e_version,.     
+0001af90: 2020 2063 6f64 652c 0a20 2020 2020 2020     code,.       
+0001afa0: 2069 735f 6370 703d 5472 7565 2c0a 2020   is_cpp=True,.  
+0001afb0: 2020 2020 2020 635f 6d61 6372 6f5f 6465        c_macro_de
+0001afc0: 6669 6e65 733d 4e6f 6e65 2c0a 2020 2020  fines=None,.    
+0001afd0: 2020 2020 6c64 5f66 6c61 6773 3d4e 6f6e      ld_flags=Non
+0001afe0: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
+0001aff0: 6465 5f70 6174 6873 3d28 292c 0a20 2020  de_paths=(),.   
+0001b000: 2020 2020 2069 6e63 6c75 6465 5f64 6570       include_dep
+0001b010: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+0001b020: 7374 6174 6963 5f76 6572 7369 6f6e 5f6e  static_version_n
+0001b030: 616d 653d 4e6f 6e65 2c0a 2020 2020 2020  ame=None,.      
+0001b040: 2020 7368 6f75 6c64 5f63 6c65 616e 7570    should_cleanup
+0001b050: 5f6f 6c64 5f61 6c6c 3d54 7275 652c 0a20  _old_all=True,. 
+0001b060: 2020 2020 2020 2073 686f 756c 645f 636c         should_cl
+0001b070: 6561 6e75 705f 6f6c 645f 6d79 6469 723d  eanup_old_mydir=
+0001b080: 4661 6c73 652c 0a20 2020 2020 2020 2075  False,.        u
+0001b090: 7365 5f63 7878 3131 5f61 6269 3d46 616c  se_cxx11_abi=Fal
+0001b0a0: 7365 2c0a 2020 2020 2020 2020 6c6f 675f  se,.        log_
+0001b0b0: 7374 7265 616d 3d4e 6f6e 652c 0a20 2020  stream=None,.   
+0001b0c0: 2020 2020 2076 6572 626f 7365 3d46 616c       verbose=Fal
+0001b0d0: 7365 2c0a 2020 2020 293a 0a20 2020 2020  se,.    ):.     
+0001b0e0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0001b0f0: 7061 7261 6d20 7374 7220 6261 7365 5f6e  param str base_n
+0001b100: 616d 653a 2062 6173 6520 6e61 6d65 2066  ame: base name f
+0001b110: 6f72 2074 6865 206d 6f64 756c 652c 2065  or the module, e
+0001b120: 2e67 2e20 227a 6572 6f5f 6f75 7422 0a20  .g. "zero_out". 
+0001b130: 2020 2020 2020 203a 7061 7261 6d20 696e         :param in
+0001b140: 747c 7475 706c 655b 696e 745d 2063 6f64  t|tuple[int] cod
+0001b150: 655f 7665 7273 696f 6e3a 2063 6865 636b  e_version: check
+0001b160: 2066 6f72 2074 6865 2063 6163 6865 2077   for the cache w
+0001b170: 6865 7468 6572 2074 6f20 7265 7573 650a  hether to reuse.
+0001b180: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0001b190: 7472 2063 6f64 653a 2074 6865 2073 6f75  tr code: the sou
+0001b1a0: 7263 6520 636f 6465 2069 7473 656c 660a  rce code itself.
+0001b1b0: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
+0001b1c0: 6f6f 6c20 6973 5f63 7070 3a20 6966 2046  ool is_cpp: if F
+0001b1d0: 616c 7365 2c20 4320 6973 2061 7373 756d  alse, C is assum
+0001b1e0: 6564 0a20 2020 2020 2020 203a 7061 7261  ed.        :para
+0001b1f0: 6d20 6469 6374 5b73 7472 2c73 7472 7c69  m dict[str,str|i
+0001b200: 6e74 7c4e 6f6e 655d 7c4e 6f6e 6520 635f  nt|None]|None c_
+0001b210: 6d61 6372 6f5f 6465 6669 6e65 733a 2065  macro_defines: e
+0001b220: 2e67 2e20 7b22 5445 4e53 4f52 464c 4f57  .g. {"TENSORFLOW
+0001b230: 223a 2031 7d0a 2020 2020 2020 2020 3a70  ": 1}.        :p
+0001b240: 6172 616d 206c 6973 745b 7374 725d 7c4e  aram list[str]|N
+0001b250: 6f6e 6520 6c64 5f66 6c61 6773 3a20 652e  one ld_flags: e.
+0001b260: 672e 205b 222d 6c62 6c61 7322 5d0a 2020  g. ["-lblas"].  
+0001b270: 2020 2020 2020 3a70 6172 616d 206c 6973        :param lis
+0001b280: 745b 7374 725d 7c74 7570 6c65 5b73 7472  t[str]|tuple[str
+0001b290: 5d20 696e 636c 7564 655f 7061 7468 733a  ] include_paths:
+0001b2a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001b2b0: 6c69 7374 5b73 7472 5d7c 4e6f 6e65 2069  list[str]|None i
+0001b2c0: 6e63 6c75 6465 5f64 6570 733a 2069 6620  nclude_deps: if 
+0001b2d0: 7072 6f76 6964 6564 2061 6e64 2061 6e20  provided and an 
+0001b2e0: 6578 6973 7469 6e67 206c 6962 2066 696c  existing lib fil
+0001b2f0: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
+0001b300: 6520 7769 6c6c 2063 6865 636b 2069 6620  e will check if 
+0001b310: 616e 7920 6465 7065 6e64 656e 6379 2069  any dependency i
+0001b320: 7320 6e65 7765 720a 2020 2020 2020 2020  s newer.        
+0001b330: 2020 2020 616e 6420 7765 206e 6565 6420      and we need 
+0001b340: 746f 2072 6563 6f6d 7069 6c65 2e20 7765  to recompile. we
+0001b350: 2063 6f75 6c64 2061 6c73 6f20 646f 2069   could also do i
+0001b360: 7420 6175 746f 6d61 7469 6361 6c6c 7920  t automatically 
+0001b370: 7669 6120 2d4d 4420 6275 7420 7468 6174  via -MD but that
+0001b380: 2073 6565 6d73 206f 7665 726b 696c 6c20   seems overkill 
+0001b390: 616e 6420 746f 6f20 736c 6f77 2e0a 2020  and too slow..  
+0001b3a0: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+0001b3b0: 7c4e 6f6e 6520 7374 6174 6963 5f76 6572  |None static_ver
+0001b3c0: 7369 6f6e 5f6e 616d 653a 206e 6f72 6d61  sion_name: norma
+0001b3d0: 6c6c 792c 2077 6520 7573 6520 2e2e 2e2f  lly, we use .../
+0001b3e0: 6261 7365 5f6e 616d 652f 6861 7368 2061  base_name/hash a
+0001b3f0: 7320 7468 6520 6469 720a 2020 2020 2020  s the dir.      
+0001b400: 2020 2020 2020 6275 7420 7468 6973 2077        but this w
+0001b410: 6f75 6c64 2075 7365 202e 2e2e 2f62 6173  ould use .../bas
+0001b420: 655f 6e61 6d65 2f73 7461 7469 635f 7665  e_name/static_ve
+0001b430: 7273 696f 6e5f 6e61 6d65 2e0a 2020 2020  rsion_name..    
+0001b440: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
+0001b450: 7368 6f75 6c64 5f63 6c65 616e 7570 5f6f  should_cleanup_o
+0001b460: 6c64 5f61 6c6c 3a20 7768 6574 6865 7220  ld_all: whether 
+0001b470: 7765 2073 686f 756c 6420 6c6f 6f6b 2069  we should look i
+0001b480: 6e20 7468 6520 6361 6368 6520 6469 720a  n the cache dir.
+0001b490: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001b4a0: 6368 6563 6b20 616c 6c20 6f70 7320 6966  check all ops if
+0001b4b0: 2077 6520 6361 6e20 6465 6c65 7465 2073   we can delete s
+0001b4c0: 6f6d 6520 6f6c 6420 6f6e 6573 2077 6869  ome old ones whi
+0001b4d0: 6368 2061 7265 206f 6c64 6572 2074 6861  ch are older tha
+0001b4e0: 6e20 736f 6d65 206c 696d 6974 0a20 2020  n some limit.   
+0001b4f0: 2020 2020 2020 2020 2028 7365 6c66 2e5f           (self._
+0001b500: 636c 6561 6e75 705f 7469 6d65 5f6c 696d  cleanup_time_lim
+0001b510: 6974 5f64 6179 7329 0a20 2020 2020 2020  it_days).       
+0001b520: 203a 7061 7261 6d20 626f 6f6c 2073 686f   :param bool sho
+0001b530: 756c 645f 636c 6561 6e75 705f 6f6c 645f  uld_cleanup_old_
+0001b540: 6d79 6469 723a 2077 6865 7468 6572 2077  mydir: whether w
+0001b550: 6520 7368 6f75 6c64 2064 656c 6574 6520  e should delete 
+0001b560: 6f75 7220 6f70 2064 6972 2062 6566 6f72  our op dir befor
+0001b570: 6520 7765 2063 6f6d 7069 6c65 2074 6865  e we compile the
+0001b580: 7265 2e0a 2020 2020 2020 2020 3a70 6172  re..        :par
+0001b590: 616d 2074 7970 696e 672e 5465 7874 494f  am typing.TextIO
+0001b5a0: 7c4e 6f6e 6520 6c6f 675f 7374 7265 616d  |None log_stream
+0001b5b0: 3a20 6669 6c65 2073 7472 6561 6d20 666f  : file stream fo
+0001b5c0: 7220 7072 696e 7420 7374 6174 656d 656e  r print statemen
+0001b5d0: 7473 0a20 2020 2020 2020 203a 7061 7261  ts.        :para
+0001b5e0: 6d20 626f 6f6c 2076 6572 626f 7365 3a20  m bool verbose: 
+0001b5f0: 6265 2073 6c69 6768 746c 7920 6d6f 7265  be slightly more
+0001b600: 2076 6572 626f 7365 0a20 2020 2020 2020   verbose.       
+0001b610: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0001b620: 7365 6c66 2e43 6f6c 6c65 6374 6564 436f  self.CollectedCo
+0001b630: 6d70 696c 6572 7320 6973 206e 6f74 204e  mpilers is not N
+0001b640: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001b650: 2073 656c 662e 436f 6c6c 6563 7465 6443   self.CollectedC
+0001b660: 6f6d 7069 6c65 7273 2e61 7070 656e 6428  ompilers.append(
+0001b670: 7365 6c66 290a 2020 2020 2020 2020 7365  self).        se
+0001b680: 6c66 2e76 6572 626f 7365 203d 2076 6572  lf.verbose = ver
+0001b690: 626f 7365 0a20 2020 2020 2020 2073 656c  bose.        sel
+0001b6a0: 662e 6361 6368 655f 6469 7220 3d20 2225  f.cache_dir = "%
+0001b6b0: 732f 2573 2220 2520 2867 6574 5f63 6163  s/%s" % (get_cac
+0001b6c0: 6865 5f64 6972 2829 2c20 7365 6c66 2e43  he_dir(), self.C
+0001b6d0: 6163 6865 4469 724e 616d 6529 0a20 2020  acheDirName).   
+0001b6e0: 2020 2020 2073 656c 662e 5f69 6e63 6c75       self._inclu
+0001b6f0: 6465 5f70 6174 6873 203d 206c 6973 7428  de_paths = list(
+0001b700: 696e 636c 7564 655f 7061 7468 7329 0a20  include_paths). 
+0001b710: 2020 2020 2020 2073 656c 662e 6261 7365         self.base
+0001b720: 5f6e 616d 6520 3d20 6261 7365 5f6e 616d  _name = base_nam
+0001b730: 650a 2020 2020 2020 2020 7365 6c66 2e63  e.        self.c
+0001b740: 6f64 655f 7665 7273 696f 6e20 3d20 636f  ode_version = co
+0001b750: 6465 5f76 6572 7369 6f6e 0a20 2020 2020  de_version.     
+0001b760: 2020 2073 656c 662e 636f 6465 203d 2063     self.code = c
+0001b770: 6f64 650a 2020 2020 2020 2020 7365 6c66  ode.        self
+0001b780: 2e69 735f 6370 7020 3d20 6973 5f63 7070  .is_cpp = is_cpp
+0001b790: 0a20 2020 2020 2020 2073 656c 662e 635f  .        self.c_
+0001b7a0: 6d61 6372 6f5f 6465 6669 6e65 7320 3d20  macro_defines = 
+0001b7b0: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+0001b7c0: 6e20 2863 5f6d 6163 726f 5f64 6566 696e  n (c_macro_defin
+0001b7d0: 6573 206f 7220 7b7d 292e 6974 656d 7328  es or {}).items(
+0001b7e0: 2920 6966 2076 2069 7320 6e6f 7420 4e6f  ) if v is not No
+0001b7f0: 6e65 7d0a 2020 2020 2020 2020 7365 6c66  ne}.        self
+0001b800: 2e6c 645f 666c 6167 7320 3d20 6c64 5f66  .ld_flags = ld_f
+0001b810: 6c61 6773 206f 7220 5b5d 0a20 2020 2020  lags or [].     
+0001b820: 2020 2073 656c 662e 696e 636c 7564 655f     self.include_
+0001b830: 6465 7073 203d 2069 6e63 6c75 6465 5f64  deps = include_d
+0001b840: 6570 730a 2020 2020 2020 2020 7365 6c66  eps.        self
+0001b850: 2e73 7461 7469 635f 7665 7273 696f 6e5f  .static_version_
+0001b860: 6e61 6d65 203d 2073 7461 7469 635f 7665  name = static_ve
+0001b870: 7273 696f 6e5f 6e61 6d65 0a20 2020 2020  rsion_name.     
+0001b880: 2020 2073 656c 662e 5f63 6f64 655f 6861     self._code_ha
+0001b890: 7368 203d 2073 656c 662e 5f6d 616b 655f  sh = self._make_
+0001b8a0: 636f 6465 5f68 6173 6828 290a 2020 2020  code_hash().    
+0001b8b0: 2020 2020 7365 6c66 2e5f 696e 666f 5f64      self._info_d
+0001b8c0: 6963 7420 3d20 7365 6c66 2e5f 6d61 6b65  ict = self._make
+0001b8d0: 5f69 6e66 6f5f 6469 6374 2829 0a20 2020  _info_dict().   
+0001b8e0: 2020 2020 2073 656c 662e 5f68 6173 6820       self._hash 
+0001b8f0: 3d20 7365 6c66 2e5f 6d61 6b65 5f68 6173  = self._make_has
+0001b900: 6828 290a 2020 2020 2020 2020 7365 6c66  h().        self
+0001b910: 2e5f 6374 7970 6573 5f6c 6962 203d 204e  ._ctypes_lib = N
+0001b920: 6f6e 650a 2020 2020 2020 2020 6966 2073  one.        if s
+0001b930: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
+0001b940: 645f 616c 6c3a 0a20 2020 2020 2020 2020  d_all:.         
+0001b950: 2020 2073 656c 662e 5f63 6c65 616e 7570     self._cleanup
+0001b960: 5f6f 6c64 2829 0a20 2020 2020 2020 2073  _old().        s
+0001b970: 656c 662e 5f73 686f 756c 645f 636c 6561  elf._should_clea
+0001b980: 6e75 705f 6f6c 645f 6d79 6469 7220 3d20  nup_old_mydir = 
+0001b990: 7368 6f75 6c64 5f63 6c65 616e 7570 5f6f  should_cleanup_o
+0001b9a0: 6c64 5f6d 7964 6972 0a20 2020 2020 2020  ld_mydir.       
+0001b9b0: 2073 656c 662e 7573 655f 6378 7831 315f   self.use_cxx11_
+0001b9c0: 6162 6920 3d20 7573 655f 6378 7831 315f  abi = use_cxx11_
+0001b9d0: 6162 690a 2020 2020 2020 2020 7365 6c66  abi.        self
+0001b9e0: 2e5f 6c6f 675f 7374 7265 616d 203d 206c  ._log_stream = l
+0001b9f0: 6f67 5f73 7472 6561 6d0a 2020 2020 2020  og_stream.      
+0001ba00: 2020 6966 2073 656c 662e 7665 7262 6f73    if self.verbos
+0001ba10: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0001ba20: 7269 6e74 2822 2573 3a20 2572 2220 2520  rint("%s: %r" % 
+0001ba30: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
+0001ba40: 5f5f 6e61 6d65 5f5f 2c20 7365 6c66 292c  __name__, self),
+0001ba50: 2066 696c 653d 6c6f 675f 7374 7265 616d   file=log_stream
+0001ba60: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
+0001ba70: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+0001ba80: 2020 2072 6574 7572 6e20 223c 2573 2025     return "<%s %
+0001ba90: 7220 696e 2025 723e 2220 2520 2873 656c  r in %r>" % (sel
+0001baa0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
+0001bab0: 6d65 5f5f 2c20 7365 6c66 2e62 6173 655f  me__, self.base_
+0001bac0: 6e61 6d65 2c20 7365 6c66 2e5f 6d6f 645f  name, self._mod_
+0001bad0: 7061 7468 290a 0a20 2020 2040 7072 6f70  path)..    @prop
+0001bae0: 6572 7479 0a20 2020 2064 6566 205f 6d6f  erty.    def _mo
+0001baf0: 645f 7061 7468 2873 656c 6629 3a0a 2020  d_path(self):.  
+0001bb00: 2020 2020 2020 7265 7475 726e 2022 2573        return "%s
+0001bb10: 2f25 732f 2573 2220 2520 2873 656c 662e  /%s/%s" % (self.
+0001bb20: 6361 6368 655f 6469 722c 2073 656c 662e  cache_dir, self.
+0001bb30: 6261 7365 5f6e 616d 652c 2073 656c 662e  base_name, self.
+0001bb40: 7374 6174 6963 5f76 6572 7369 6f6e 5f6e  static_version_n
+0001bb50: 616d 6520 6f72 2073 656c 662e 5f68 6173  ame or self._has
+0001bb60: 685b 3a31 305d 290a 0a20 2020 2040 7072  h[:10])..    @pr
+0001bb70: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
+0001bb80: 696e 666f 5f66 696c 656e 616d 6528 7365  info_filename(se
+0001bb90: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001bba0: 7572 6e20 2225 732f 696e 666f 2e70 7922  urn "%s/info.py"
+0001bbb0: 2025 2028 7365 6c66 2e5f 6d6f 645f 7061   % (self._mod_pa
+0001bbc0: 7468 2c29 0a0a 2020 2020 4070 726f 7065  th,)..    @prope
+0001bbd0: 7274 790a 2020 2020 6465 6620 5f73 6f5f  rty.    def _so_
+0001bbe0: 6669 6c65 6e61 6d65 2873 656c 6629 3a0a  filename(self):.
+0001bbf0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0001bc00: 2573 2f25 732e 736f 2220 2520 2873 656c  %s/%s.so" % (sel
+0001bc10: 662e 5f6d 6f64 5f70 6174 682c 2073 656c  f._mod_path, sel
+0001bc20: 662e 6261 7365 5f6e 616d 6529 0a0a 2020  f.base_name)..  
+0001bc30: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+0001bc40: 6465 6620 5f63 5f66 696c 656e 616d 6528  def _c_filename(
+0001bc50: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+0001bc60: 6620 7365 6c66 2e69 735f 6370 703a 0a20  f self.is_cpp:. 
+0001bc70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001bc80: 6e20 2225 732f 2573 2e63 6322 2025 2028  n "%s/%s.cc" % (
+0001bc90: 7365 6c66 2e5f 6d6f 645f 7061 7468 2c20  self._mod_path, 
+0001bca0: 7365 6c66 2e62 6173 655f 6e61 6d65 290a  self.base_name).
+0001bcb0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0001bcc0: 2573 2f25 732e 6322 2025 2028 7365 6c66  %s/%s.c" % (self
+0001bcd0: 2e5f 6d6f 645f 7061 7468 2c20 7365 6c66  ._mod_path, self
+0001bce0: 2e62 6173 655f 6e61 6d65 290a 0a20 2020  .base_name)..   
+0001bcf0: 205f 636c 6561 6e75 705f 7469 6d65 5f6c   _cleanup_time_l
+0001bd00: 696d 6974 5f64 6179 7320 3d20 3630 0a0a  imit_days = 60..
+0001bd10: 2020 2020 6465 6620 5f63 6c65 616e 7570      def _cleanup
+0001bd20: 5f6f 6c64 2873 656c 6629 3a0a 2020 2020  _old(self):.    
+0001bd30: 2020 2020 6d6f 645f 7061 7468 203d 2073      mod_path = s
+0001bd40: 656c 662e 5f6d 6f64 5f70 6174 6820 2023  elf._mod_path  #
+0001bd50: 202e 2e2e 2f62 6173 655f 6e61 6d65 2f68   .../base_name/h
+0001bd60: 6173 680a 2020 2020 2020 2020 6261 7365  ash.        base
+0001bd70: 5f6d 6f64 5f70 6174 6820 3d20 6f73 2e70  _mod_path = os.p
+0001bd80: 6174 682e 6469 726e 616d 6528 6d6f 645f  ath.dirname(mod_
+0001bd90: 7061 7468 2920 2023 202e 2e2e 2f62 6173  path)  # .../bas
+0001bda0: 655f 6e61 6d65 0a20 2020 2020 2020 206d  e_name.        m
+0001bdb0: 795f 6d6f 645f 7061 7468 5f6e 616d 6520  y_mod_path_name 
+0001bdc0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+0001bdd0: 6d65 286d 6f64 5f70 6174 6829 0a20 2020  me(mod_path).   
+0001bde0: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+0001bdf0: 6174 682e 6578 6973 7473 2862 6173 655f  ath.exists(base_
+0001be00: 6d6f 645f 7061 7468 293a 0a20 2020 2020  mod_path):.     
+0001be10: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+0001be20: 2020 2020 2020 696d 706f 7274 2074 696d        import tim
+0001be30: 650a 0a20 2020 2020 2020 2063 6c65 616e  e..        clean
+0001be40: 7570 5f74 696d 655f 6c69 6d69 745f 7365  up_time_limit_se
+0001be50: 6373 203d 2073 656c 662e 5f63 6c65 616e  cs = self._clean
+0001be60: 7570 5f74 696d 655f 6c69 6d69 745f 6461  up_time_limit_da
+0001be70: 7973 202a 2032 3420 2a20 3630 202a 2036  ys * 24 * 60 * 6
+0001be80: 300a 2020 2020 2020 2020 666f 7220 7020  0.        for p 
+0001be90: 696e 206f 732e 6c69 7374 6469 7228 6261  in os.listdir(ba
+0001bea0: 7365 5f6d 6f64 5f70 6174 6829 3a0a 2020  se_mod_path):.  
+0001beb0: 2020 2020 2020 2020 2020 6966 2070 203d            if p =
+0001bec0: 3d20 6d79 5f6d 6f64 5f70 6174 685f 6e61  = my_mod_path_na
+0001bed0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0001bee0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001bef0: 2020 2020 2020 2020 2066 756c 6c5f 6469           full_di
+0001bf00: 725f 7061 7468 203d 2022 2573 2f25 7322  r_path = "%s/%s"
+0001bf10: 2025 2028 6261 7365 5f6d 6f64 5f70 6174   % (base_mod_pat
+0001bf20: 682c 2070 290a 2020 2020 2020 2020 2020  h, p).          
+0001bf30: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+0001bf40: 2e69 7364 6972 2866 756c 6c5f 6469 725f  .isdir(full_dir_
+0001bf50: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+0001bf60: 2020 2020 2020 2063 6f6e 7469 6e75 6520         continue 
+0001bf70: 2023 2069 676e 6f72 6520 666f 7220 6e6f   # ignore for no
+0001bf80: 770a 2020 2020 2020 2020 2020 2020 6c6f  w.            lo
+0001bf90: 636b 203d 204c 6f63 6b46 696c 6528 6675  ck = LockFile(fu
+0001bfa0: 6c6c 5f64 6972 5f70 6174 6829 0a20 2020  ll_dir_path).   
+0001bfb0: 2020 2020 2020 2020 2069 6620 6c6f 636b           if lock
+0001bfc0: 2e69 735f 6c6f 636b 6564 2829 3a0a 2020  .is_locked():.  
+0001bfd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001bfe0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0001bff0: 2020 206c 6f63 6b2e 6d61 7962 655f 7265     lock.maybe_re
+0001c000: 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66 696c  move_old_lockfil
+0001c010: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+0001c020: 696e 666f 5f70 6174 6820 3d20 2225 732f  info_path = "%s/
+0001c030: 696e 666f 2e70 7922 2025 2066 756c 6c5f  info.py" % full_
+0001c040: 6469 725f 7061 7468 0a20 2020 2020 2020  dir_path.       
+0001c050: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+0001c060: 6174 682e 6578 6973 7473 2869 6e66 6f5f  ath.exists(info_
+0001c070: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+0001c080: 2020 2020 2020 2073 656c 662e 5f63 6c65         self._cle
+0001c090: 616e 7570 5f6f 6c64 5f70 6174 6828 6675  anup_old_path(fu
+0001c0a0: 6c6c 5f64 6972 5f70 6174 682c 2072 6561  ll_dir_path, rea
+0001c0b0: 736f 6e3d 2263 6f72 7275 7074 2064 6972  son="corrupt dir
+0001c0c0: 2c20 6d69 7373 696e 6720 696e 666f 2e70  , missing info.p
+0001c0d0: 7922 290a 2020 2020 2020 2020 2020 2020  y").            
+0001c0e0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001c0f0: 2020 2020 2020 2020 2073 6f5f 7061 7468           so_path
+0001c100: 203d 2022 2573 2f25 732e 736f 2220 2520   = "%s/%s.so" % 
+0001c110: 2866 756c 6c5f 6469 725f 7061 7468 2c20  (full_dir_path, 
+0001c120: 7365 6c66 2e62 6173 655f 6e61 6d65 290a  self.base_name).
+0001c130: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001c140: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+0001c150: 7328 736f 5f70 6174 6829 3a0a 2020 2020  s(so_path):.    
+0001c160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001c170: 2e5f 636c 6561 6e75 705f 6f6c 645f 7061  ._cleanup_old_pa
+0001c180: 7468 2866 756c 6c5f 6469 725f 7061 7468  th(full_dir_path
+0001c190: 2c20 7265 6173 6f6e 3d22 636f 7272 7570  , reason="corrup
+0001c1a0: 7420 6469 722c 206d 6973 7369 6e67 2073  t dir, missing s
+0001c1b0: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
+0001c1c0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001c1d0: 2020 2020 2020 2020 2064 7420 3d20 7469           dt = ti
+0001c1e0: 6d65 2e74 696d 6528 2920 2d20 6f73 2e70  me.time() - os.p
+0001c1f0: 6174 682e 6765 746d 7469 6d65 2873 6f5f  ath.getmtime(so_
+0001c200: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+0001c210: 2020 6966 2064 7420 3e20 636c 6561 6e75    if dt > cleanu
+0001c220: 705f 7469 6d65 5f6c 696d 6974 5f73 6563  p_time_limit_sec
+0001c230: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001c240: 2020 2073 656c 662e 5f63 6c65 616e 7570     self._cleanup
+0001c250: 5f6f 6c64 5f70 6174 6828 6675 6c6c 5f64  _old_path(full_d
+0001c260: 6972 5f70 6174 682c 2072 6561 736f 6e3d  ir_path, reason=
+0001c270: 2225 7320 6f6c 6422 2025 2068 6d73 2864  "%s old" % hms(d
+0001c280: 7429 290a 0a20 2020 2064 6566 205f 636c  t))..    def _cl
+0001c290: 6561 6e75 705f 6f6c 645f 7061 7468 2873  eanup_old_path(s
+0001c2a0: 656c 662c 2070 2c20 7265 6173 6f6e 293a  elf, p, reason):
+0001c2b0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+0001c2c0: 2573 2064 656c 6574 6520 6f6c 642c 2025  %s delete old, %
+0001c2d0: 733a 2025 7322 2025 2028 7365 6c66 2e5f  s: %s" % (self._
+0001c2e0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+0001c2f0: 5f2c 2072 6561 736f 6e2c 2070 2929 0a20  _, reason, p)). 
+0001c300: 2020 2020 2020 2061 7373 6572 7420 6f73         assert os
+0001c310: 2e70 6174 682e 6578 6973 7473 2870 290a  .path.exists(p).
+0001c320: 2020 2020 2020 2020 696d 706f 7274 2073          import s
+0001c330: 6875 7469 6c0a 0a20 2020 2020 2020 2074  hutil..        t
+0001c340: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001c350: 7368 7574 696c 2e72 6d74 7265 6528 7029  shutil.rmtree(p)
+0001c360: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001c370: 4f53 4572 726f 7220 6173 2065 7863 3a0a  OSError as exc:.
+0001c380: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001c390: 7428 2225 7320 6465 6c65 7465 2065 7863  t("%s delete exc
+0001c3a0: 6570 7469 6f6e 2028 2573 292e 2057 696c  eption (%s). Wil
+0001c3b0: 6c20 6967 6e6f 7265 2061 6e64 2074 7279  l ignore and try
+0001c3c0: 2074 6f20 636f 6e74 696e 7565 2061 6e79   to continue any
+0001c3d0: 7761 792e 2220 2520 2873 656c 662e 5f5f  way." % (self.__
+0001c3e0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001c3f0: 2c20 6578 6329 290a 0a20 2020 2064 6566  , exc))..    def
+0001c400: 205f 6c6f 6164 5f69 6e66 6f28 7365 6c66   _load_info(self
+0001c410: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001c420: 2020 2020 2020 203a 7274 7970 653a 2064         :rtype: d
+0001c430: 6963 745b 7374 725d 7c4e 6f6e 650a 2020  ict[str]|None.  
+0001c440: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001c450: 2020 6669 6c65 6e61 6d65 203d 2073 656c    filename = sel
+0001c460: 662e 5f69 6e66 6f5f 6669 6c65 6e61 6d65  f._info_filename
+0001c470: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001c480: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+0001c490: 696c 656e 616d 6529 3a0a 2020 2020 2020  ilename):.      
+0001c4a0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001c4b0: 650a 2020 2020 2020 2020 7320 3d20 6f70  e.        s = op
+0001c4c0: 656e 2866 696c 656e 616d 6529 2e72 6561  en(filename).rea
+0001c4d0: 6428 290a 2020 2020 2020 2020 7265 7320  d().        res 
+0001c4e0: 3d20 6576 616c 2873 290a 2020 2020 2020  = eval(s).      
+0001c4f0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+0001c500: 6e63 6528 7265 732c 2064 6963 7429 0a20  nce(res, dict). 
+0001c510: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0001c520: 730a 0a20 2020 205f 7265 6c65 7661 6e74  s..    _relevant
+0001c530: 5f69 6e66 6f5f 6b65 7973 203d 2028 2263  _info_keys = ("c
+0001c540: 6f64 655f 7665 7273 696f 6e22 2c20 2263  ode_version", "c
+0001c550: 6f64 655f 6861 7368 222c 2022 635f 6d61  ode_hash", "c_ma
+0001c560: 6372 6f5f 6465 6669 6e65 7322 2c20 226c  cro_defines", "l
+0001c570: 645f 666c 6167 7322 2c20 2263 6f6d 7069  d_flags", "compi
+0001c580: 6c65 725f 6269 6e22 290a 0a20 2020 2064  ler_bin")..    d
+0001c590: 6566 205f 6d61 6b65 5f69 6e66 6f5f 6469  ef _make_info_di
+0001c5a0: 6374 2873 656c 6629 3a0a 2020 2020 2020  ct(self):.      
+0001c5b0: 2020 2222 220a 2020 2020 2020 2020 3a72    """.        :r
+0001c5c0: 7479 7065 3a20 6469 6374 5b73 7472 5d0a  type: dict[str].
+0001c5d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001c5e0: 2020 2020 7265 7475 726e 207b 0a20 2020      return {.   
+0001c5f0: 2020 2020 2020 2020 2022 6261 7365 5f6e           "base_n
+0001c600: 616d 6522 3a20 7365 6c66 2e62 6173 655f  ame": self.base_
+0001c610: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+0001c620: 2020 2269 6e63 6c75 6465 5f70 6174 6873    "include_paths
+0001c630: 223a 2073 656c 662e 5f69 6e63 6c75 6465  ": self._include
+0001c640: 5f70 6174 6873 2c0a 2020 2020 2020 2020  _paths,.        
+0001c650: 2020 2020 2263 6f64 655f 7665 7273 696f      "code_versio
+0001c660: 6e22 3a20 7365 6c66 2e63 6f64 655f 7665  n": self.code_ve
+0001c670: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
+0001c680: 2020 2022 636f 6465 5f68 6173 6822 3a20     "code_hash": 
+0001c690: 7365 6c66 2e5f 636f 6465 5f68 6173 682c  self._code_hash,
+0001c6a0: 0a20 2020 2020 2020 2020 2020 2022 635f  .            "c_
+0001c6b0: 6d61 6372 6f5f 6465 6669 6e65 7322 3a20  macro_defines": 
+0001c6c0: 7365 6c66 2e63 5f6d 6163 726f 5f64 6566  self.c_macro_def
+0001c6d0: 696e 6573 2c0a 2020 2020 2020 2020 2020  ines,.          
+0001c6e0: 2020 226c 645f 666c 6167 7322 3a20 7365    "ld_flags": se
+0001c6f0: 6c66 2e6c 645f 666c 6167 732c 0a20 2020  lf.ld_flags,.   
+0001c700: 2020 2020 2020 2020 2022 636f 6d70 696c           "compil
+0001c710: 6572 5f62 696e 223a 2073 656c 662e 5f67  er_bin": self._g
+0001c720: 6574 5f63 6f6d 7069 6c65 725f 6269 6e28  et_compiler_bin(
+0001c730: 292c 0a20 2020 2020 2020 207d 0a0a 2020  ),.        }..  
+0001c740: 2020 6465 6620 5f6d 616b 655f 636f 6465    def _make_code
+0001c750: 5f68 6173 6828 7365 6c66 293a 0a20 2020  _hash(self):.   
+0001c760: 2020 2020 2069 6d70 6f72 7420 6861 7368       import hash
+0001c770: 6c69 620a 0a20 2020 2020 2020 2068 203d  lib..        h =
+0001c780: 2068 6173 686c 6962 2e6d 6435 2829 0a20   hashlib.md5(). 
+0001c790: 2020 2020 2020 2068 2e75 7064 6174 6528         h.update(
+0001c7a0: 7365 6c66 2e63 6f64 652e 656e 636f 6465  self.code.encode
+0001c7b0: 2822 7574 6638 2229 290a 2020 2020 2020  ("utf8")).      
+0001c7c0: 2020 7265 7475 726e 2068 2e68 6578 6469    return h.hexdi
+0001c7d0: 6765 7374 2829 0a0a 2020 2020 6465 6620  gest()..    def 
+0001c7e0: 5f6d 616b 655f 6861 7368 2873 656c 6629  _make_hash(self)
+0001c7f0: 3a0a 2020 2020 2020 2020 696d 706f 7274  :.        import
+0001c800: 2068 6173 686c 6962 0a0a 2020 2020 2020   hashlib..      
+0001c810: 2020 6820 3d20 6861 7368 6c69 622e 6d64    h = hashlib.md
+0001c820: 3528 290a 2020 2020 2020 2020 682e 7570  5().        h.up
+0001c830: 6461 7465 2822 7b22 2e65 6e63 6f64 6528  date("{".encode(
+0001c840: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
+0001c850: 2066 6f72 206b 6579 2069 6e20 7365 6c66   for key in self
+0001c860: 2e5f 7265 6c65 7661 6e74 5f69 6e66 6f5f  ._relevant_info_
+0001c870: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
+0001c880: 2020 682e 7570 6461 7465 2828 2225 733a    h.update(("%s:
+0001c890: 7b25 737d 2220 2520 286b 6579 2c20 7365  {%s}" % (key, se
+0001c8a0: 6c66 2e5f 696e 666f 5f64 6963 745b 6b65  lf._info_dict[ke
+0001c8b0: 795d 2929 2e65 6e63 6f64 6528 2275 7466  y])).encode("utf
+0001c8c0: 3822 2929 0a20 2020 2020 2020 2068 2e75  8")).        h.u
+0001c8d0: 7064 6174 6528 227d 222e 656e 636f 6465  pdate("}".encode
+0001c8e0: 2822 7574 6638 2229 290a 2020 2020 2020  ("utf8")).      
+0001c8f0: 2020 7265 7475 726e 2068 2e68 6578 6469    return h.hexdi
+0001c900: 6765 7374 2829 0a0a 2020 2020 6465 6620  gest()..    def 
+0001c910: 5f73 6176 655f 696e 666f 2873 656c 6629  _save_info(self)
+0001c920: 3a0a 2020 2020 2020 2020 6669 6c65 6e61  :.        filena
+0001c930: 6d65 203d 2073 656c 662e 5f69 6e66 6f5f  me = self._info_
+0001c940: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
+0001c950: 2077 6974 6820 6f70 656e 2866 696c 656e   with open(filen
+0001c960: 616d 652c 2022 7722 2920 6173 2066 3a0a  ame, "w") as f:.
+0001c970: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0001c980: 6974 6528 2225 735c 6e22 2025 2062 6574  ite("%s\n" % bet
+0001c990: 7465 725f 7265 7072 2873 656c 662e 5f69  ter_repr(self._i
+0001c9a0: 6e66 6f5f 6469 6374 2929 0a0a 2020 2020  nfo_dict))..    
+0001c9b0: 6465 6620 5f6e 6565 645f 7265 636f 6d70  def _need_recomp
+0001c9c0: 696c 6528 7365 6c66 293a 0a20 2020 2020  ile(self):.     
+0001c9d0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0001c9e0: 7274 7970 653a 2062 6f6f 6c0a 2020 2020  rtype: bool.    
+0001c9f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001ca00: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+0001ca10: 7869 7374 7328 7365 6c66 2e5f 736f 5f66  xists(self._so_f
+0001ca20: 696c 656e 616d 6529 3a0a 2020 2020 2020  ilename):.      
+0001ca30: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0001ca40: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
+0001ca50: 662e 696e 636c 7564 655f 6465 7073 3a0a  f.include_deps:.
+0001ca60: 2020 2020 2020 2020 2020 2020 736f 5f6d              so_m
+0001ca70: 7469 6d65 203d 206f 732e 7061 7468 2e67  time = os.path.g
+0001ca80: 6574 6d74 696d 6528 7365 6c66 2e5f 736f  etmtime(self._so
+0001ca90: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+0001caa0: 2020 2020 2020 2066 6f72 2066 6e20 696e         for fn in
+0001cab0: 2073 656c 662e 696e 636c 7564 655f 6465   self.include_de
+0001cac0: 7073 3a0a 2020 2020 2020 2020 2020 2020  ps:.            
+0001cad0: 2020 2020 6966 206f 732e 7061 7468 2e67      if os.path.g
+0001cae0: 6574 6d74 696d 6528 666e 2920 3e20 736f  etmtime(fn) > so
+0001caf0: 5f6d 7469 6d65 3a0a 2020 2020 2020 2020  _mtime:.        
+0001cb00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001cb10: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+0001cb20: 6f6c 645f 696e 666f 203d 2073 656c 662e  old_info = self.
+0001cb30: 5f6c 6f61 645f 696e 666f 2829 0a20 2020  _load_info().   
+0001cb40: 2020 2020 206e 6577 5f69 6e66 6f20 3d20       new_info = 
+0001cb50: 7365 6c66 2e5f 6d61 6b65 5f69 6e66 6f5f  self._make_info_
+0001cb60: 6469 6374 2829 0a20 2020 2020 2020 2069  dict().        i
+0001cb70: 6620 6e6f 7420 6f6c 645f 696e 666f 3a0a  f not old_info:.
+0001cb80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001cb90: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+0001cba0: 2320 5468 6520 6861 7368 2061 6c72 6561  # The hash alrea
+0001cbb0: 6479 206d 6174 6368 6564 2062 7574 2076  dy matched but v
+0001cbc0: 6572 7920 756e 6c69 6b65 6c79 2c20 7468  ery unlikely, th
+0001cbd0: 6973 2063 6f75 6c64 2062 6520 6120 636f  is could be a co
+0001cbe0: 6c6c 6973 696f 6e2e 0a20 2020 2020 2020  llision..       
+0001cbf0: 2023 2041 6e79 7761 792c 206a 7573 7420   # Anyway, just 
+0001cc00: 646f 2074 6869 7320 7665 7279 2063 6865  do this very che
+0001cc10: 6170 2063 6865 636b 2e0a 2020 2020 2020  ap check..      
+0001cc20: 2020 666f 7220 6b65 7920 696e 2073 656c    for key in sel
+0001cc30: 662e 5f72 656c 6576 616e 745f 696e 666f  f._relevant_info
+0001cc40: 5f6b 6579 733a 0a20 2020 2020 2020 2020  _keys:.         
+0001cc50: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
+0001cc60: 206f 6c64 5f69 6e66 6f3a 0a20 2020 2020   old_info:.     
+0001cc70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001cc80: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
+0001cc90: 2020 2069 6620 6f6c 645f 696e 666f 5b6b     if old_info[k
+0001cca0: 6579 5d20 213d 206e 6577 5f69 6e66 6f5b  ey] != new_info[
+0001ccb0: 6b65 795d 3a0a 2020 2020 2020 2020 2020  key]:.          
+0001ccc0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0001ccd0: 650a 2020 2020 2020 2020 2320 4966 206e  e.        # If n
+0001cce0: 6f20 636f 6465 2076 6572 7369 6f6e 2069  o code version i
+0001ccf0: 7320 7072 6f76 6964 6564 2c20 7765 2063  s provided, we c
+0001cd00: 6f75 6c64 2061 6c73 6f20 6368 6563 6b20  ould also check 
+0001cd10: 7468 6520 636f 6465 2069 7473 656c 6620  the code itself 
+0001cd20: 6e6f 772e 0a20 2020 2020 2020 2023 2042  now..        # B
+0001cd30: 7574 2049 2074 6869 6e6b 2074 6869 7320  ut I think this 
+0001cd40: 6973 206f 7665 726b 696c 6c2e 0a20 2020  is overkill..   
+0001cd50: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001cd60: 650a 0a20 2020 2064 6566 205f 6d61 7962  e..    def _mayb
+0001cd70: 655f 636f 6d70 696c 6528 7365 6c66 293a  e_compile(self):
+0001cd80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001cd90: 2020 2020 204f 6e20 7375 6363 6573 7366       On successf
+0001cda0: 756c 2072 6574 7572 6e2c 2073 656c 662e  ul return, self.
+0001cdb0: 5f73 6f5f 6669 6c65 6e61 6d65 2073 686f  _so_filename sho
+0001cdc0: 756c 6420 6578 6973 7420 616e 6420 6265  uld exist and be
+0001cdd0: 2075 702d 746f 2d64 6174 652e 0a20 2020   up-to-date..   
+0001cde0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001cdf0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6e65   if not self._ne
+0001ce00: 6564 5f72 6563 6f6d 7069 6c65 2829 3a0a  ed_recompile():.
+0001ce10: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001ce20: 656c 662e 7665 7262 6f73 653a 0a20 2020  elf.verbose:.   
+0001ce30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001ce40: 6e74 2822 2573 3a20 4e6f 206e 6565 6420  nt("%s: No need 
+0001ce50: 746f 2072 6563 6f6d 7069 6c65 3a20 2573  to recompile: %s
+0001ce60: 2220 2520 2873 656c 662e 5f5f 636c 6173  " % (self.__clas
+0001ce70: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365  s__.__name__, se
+0001ce80: 6c66 2e5f 736f 5f66 696c 656e 616d 6529  lf._so_filename)
+0001ce90: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0001cea0: 546f 7563 6820 6974 2073 6f20 7468 6174  Touch it so that
+0001ceb0: 2077 6520 6361 6e20 7365 6520 7468 6174   we can see that
+0001cec0: 2077 6520 7573 6564 2069 7420 7265 6365   we used it rece
+0001ced0: 6e74 6c79 2e0a 2020 2020 2020 2020 2020  ntly..          
+0001cee0: 2020 6f73 2e75 7469 6d65 2873 656c 662e    os.utime(self.
+0001cef0: 5f69 6e66 6f5f 6669 6c65 6e61 6d65 2c20  _info_filename, 
+0001cf00: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+0001cf10: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+0001cf20: 206c 6f63 6b20 3d20 4c6f 636b 4669 6c65   lock = LockFile
+0001cf30: 2873 656c 662e 5f6d 6f64 5f70 6174 6829  (self._mod_path)
+0001cf40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001cf50: 7365 6c66 2e5f 6e65 6564 5f72 6563 6f6d  self._need_recom
+0001cf60: 7069 6c65 2829 3a20 2023 2063 6865 636b  pile():  # check
+0001cf70: 2061 6761 696e 0a20 2020 2020 2020 2020   again.         
+0001cf80: 2020 2069 6620 7365 6c66 2e76 6572 626f     if self.verbo
+0001cf90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001cfa0: 2020 2020 7072 696e 7428 2225 733a 204e      print("%s: N
+0001cfb0: 6f20 6e65 6564 2074 6f20 7265 636f 6d70  o need to recomp
+0001cfc0: 696c 6520 6166 7465 7220 7765 2077 6169  ile after we wai
+0001cfd0: 7465 643a 2025 7322 2025 2028 7365 6c66  ted: %s" % (self
+0001cfe0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+0001cff0: 655f 5f2c 2073 656c 662e 5f73 6f5f 6669  e__, self._so_fi
+0001d000: 6c65 6e61 6d65 2929 0a20 2020 2020 2020  lename)).       
+0001d010: 2020 2020 206f 732e 7574 696d 6528 7365       os.utime(se
+0001d020: 6c66 2e5f 696e 666f 5f66 696c 656e 616d  lf._info_filenam
+0001d030: 652c 204e 6f6e 6529 0a20 2020 2020 2020  e, None).       
+0001d040: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0001d050: 2020 2020 6966 2073 656c 662e 5f73 686f      if self._sho
+0001d060: 756c 645f 636c 6561 6e75 705f 6f6c 645f  uld_cleanup_old_
+0001d070: 6d79 6469 7220 616e 6420 6e6f 7420 6c6f  mydir and not lo
+0001d080: 636b 2e69 735f 6c6f 636b 6564 2829 3a0a  ck.is_locked():.
+0001d090: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0001d0a0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+0001d0b0: 6c66 2e5f 6d6f 645f 7061 7468 293a 0a20  lf._mod_path):. 
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001d0d0: 656c 662e 5f63 6c65 616e 7570 5f6f 6c64  elf._cleanup_old
+0001d0e0: 5f70 6174 6828 7365 6c66 2e5f 6d6f 645f  _path(self._mod_
+0001d0f0: 7061 7468 2c20 7265 6173 6f6e 3d22 6e65  path, reason="ne
+0001d100: 6564 2072 6563 6f6d 7069 6c65 2229 0a20  ed recompile"). 
+0001d110: 2020 2020 2020 2077 6974 6820 6c6f 636b         with lock
+0001d120: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001d130: 6c66 2e5f 6d61 7962 655f 636f 6d70 696c  lf._maybe_compil
+0001d140: 655f 696e 6e65 7228 290a 0a20 2020 2064  e_inner()..    d
+0001d150: 6566 205f 6765 745f 636f 6d70 696c 6572  ef _get_compiler
+0001d160: 5f62 696e 2873 656c 6629 3a0a 2020 2020  _bin(self):.    
+0001d170: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001d180: 3a72 7479 7065 3a20 7374 720a 2020 2020  :rtype: str.    
+0001d190: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001d1a0: 6966 2073 656c 662e 6973 5f63 7070 3a0a  if self.is_cpp:.
+0001d1b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001d1c0: 726e 2022 672b 2b22 0a20 2020 2020 2020  rn "g++".       
+0001d1d0: 2072 6574 7572 6e20 2267 6363 220a 0a20   return "gcc".. 
+0001d1e0: 2020 2064 6566 205f 7472 616e 7366 6f72     def _transfor
+0001d1f0: 6d5f 636f 6d70 696c 6572 5f6f 7074 7328  m_compiler_opts(
+0001d200: 7365 6c66 2c20 6f70 7473 293a 0a20 2020  self, opts):.   
+0001d210: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001d220: 203a 7061 7261 6d20 6c69 7374 5b73 7472   :param list[str
+0001d230: 5d20 6f70 7473 3a0a 2020 2020 2020 2020  ] opts:.        
+0001d240: 3a72 7479 7065 3a20 6c69 7374 5b73 7472  :rtype: list[str
+0001d250: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
+0001d260: 2020 2020 2020 7265 7475 726e 206f 7074        return opt
+0001d270: 730a 0a20 2020 2064 6566 205f 6578 7472  s..    def _extr
+0001d280: 615f 636f 6d6d 6f6e 5f6f 7074 7328 7365  a_common_opts(se
+0001d290: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0001d2a0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+0001d2b0: 206c 6973 745b 7374 725d 0a20 2020 2020   list[str].     
+0001d2c0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0001d2d0: 6620 7365 6c66 2e69 735f 6370 703a 0a20  f self.is_cpp:. 
+0001d2e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001d2f0: 6e20 5b22 2d73 7464 3d63 2b2b 3131 225d  n ["-std=c++11"]
+0001d300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001d310: 5b5d 0a0a 2020 2020 4063 6c61 7373 6d65  []..    @classme
+0001d320: 7468 6f64 0a20 2020 2064 6566 205f 7472  thod.    def _tr
+0001d330: 616e 7366 6f72 6d5f 6c64 5f66 6c61 6728  ansform_ld_flag(
+0001d340: 636c 732c 206f 7074 293a 0a20 2020 2020  cls, opt):.     
+0001d350: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0001d360: 7061 7261 6d20 7374 7220 6f70 743a 0a20  param str opt:. 
+0001d370: 2020 2020 2020 203a 7274 7970 653a 2073         :rtype: s
+0001d380: 7472 0a20 2020 2020 2020 2022 2222 0a20  tr.        """. 
+0001d390: 2020 2020 2020 2069 6620 7379 732e 706c         if sys.pl
+0001d3a0: 6174 666f 726d 203d 3d20 2264 6172 7769  atform == "darwi
+0001d3b0: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
+0001d3c0: 2320 4974 2073 6565 6d73 2073 6f6d 6520  # It seems some 
+0001d3d0: 7665 7273 696f 6e73 206f 6620 4d61 634f  versions of MacO
+0001d3e0: 5320 6c64 2063 616e 6e6f 7420 6861 6e64  S ld cannot hand
+0001d3f0: 6c65 2074 6865 2060 2d6c 3a66 696c 656e  le the `-l:filen
+0001d400: 616d 6560 2061 7267 756d 656e 7420 636f  ame` argument co
+0001d410: 7272 6563 746c 792e 0a20 2020 2020 2020  rrectly..       
+0001d420: 2020 2020 2023 2045 2e67 2e20 5465 6e73       # E.g. Tens
+0001d430: 6f72 466c 6f77 2031 2e31 3420 696e 636f  orFlow 1.14 inco
+0001d440: 7272 6563 746c 7920 7573 6573 2074 6869  rrectly uses thi
+0001d450: 732e 0a20 2020 2020 2020 2020 2020 2023  s..            #
+0001d460: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+0001d470: 636f 6d2f 7465 6e73 6f72 666c 6f77 2f74  com/tensorflow/t
+0001d480: 656e 736f 7266 6c6f 772f 6973 7375 6573  ensorflow/issues
+0001d490: 2f33 3035 3634 0a20 2020 2020 2020 2020  /30564.         
+0001d4a0: 2020 2069 6620 6f70 742e 7374 6172 7473     if opt.starts
+0001d4b0: 7769 7468 2822 2d6c 3a6c 6962 2229 2061  with("-l:lib") a
+0001d4c0: 6e64 206f 7074 2e65 6e64 7377 6974 6828  nd opt.endswith(
+0001d4d0: 222e 6479 6c69 6222 293a 0a20 2020 2020  ".dylib"):.     
+0001d4e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001d4f0: 6e20 222d 6c25 7322 2025 206f 7074 5b6c  n "-l%s" % opt[l
+0001d500: 656e 2822 2d6c 3a6c 6962 2229 203a 202d  en("-l:lib") : -
+0001d510: 6c65 6e28 222e 6479 6c69 6222 295d 0a20  len(".dylib")]. 
+0001d520: 2020 2020 2020 2072 6574 7572 6e20 6f70         return op
+0001d530: 740a 0a20 2020 2064 6566 205f 6d61 7962  t..    def _mayb
+0001d540: 655f 636f 6d70 696c 655f 696e 6e65 7228  e_compile_inner(
+0001d550: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
+0001d560: 2044 6972 6563 746f 7279 2073 686f 756c   Directory shoul
+0001d570: 6420 6265 2063 7265 6174 6564 2062 7920  d be created by 
+0001d580: 7468 6520 6c6f 636b 696e 6720 6d65 6368  the locking mech
+0001d590: 616e 6973 6d2e 0a20 2020 2020 2020 2061  anism..        a
+0001d5a0: 7373 6572 7420 6f73 2e70 6174 682e 6578  ssert os.path.ex
+0001d5b0: 6973 7473 2873 656c 662e 5f6d 6f64 5f70  ists(self._mod_p
+0001d5c0: 6174 6829 0a20 2020 2020 2020 2077 6974  ath).        wit
+0001d5d0: 6820 6f70 656e 2873 656c 662e 5f63 5f66  h open(self._c_f
+0001d5e0: 696c 656e 616d 652c 2022 7722 2920 6173  ilename, "w") as
+0001d5f0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+0001d600: 662e 7772 6974 6528 7365 6c66 2e63 6f64  f.write(self.cod
+0001d610: 6529 0a20 2020 2020 2020 2063 6f6d 6d6f  e).        commo
+0001d620: 6e5f 6f70 7473 203d 205b 222d 7368 6172  n_opts = ["-shar
+0001d630: 6564 222c 2022 2d4f 3222 5d0a 2020 2020  ed", "-O2"].    
+0001d640: 2020 2020 636f 6d6d 6f6e 5f6f 7074 7320      common_opts 
+0001d650: 2b3d 2073 656c 662e 5f65 7874 7261 5f63  += self._extra_c
+0001d660: 6f6d 6d6f 6e5f 6f70 7473 2829 0a20 2020  ommon_opts().   
+0001d670: 2020 2020 2069 6620 7379 732e 706c 6174       if sys.plat
+0001d680: 666f 726d 203d 3d20 2264 6172 7769 6e22  form == "darwin"
+0001d690: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0001d6a0: 6d6d 6f6e 5f6f 7074 7320 2b3d 205b 222d  mmon_opts += ["-
+0001d6b0: 756e 6465 6669 6e65 6422 2c20 2264 796e  undefined", "dyn
+0001d6c0: 616d 6963 5f6c 6f6f 6b75 7022 5d0a 2020  amic_lookup"].  
+0001d6d0: 2020 2020 2020 666f 7220 696e 636c 7564        for includ
+0001d6e0: 655f 7061 7468 2069 6e20 7365 6c66 2e5f  e_path in self._
+0001d6f0: 696e 636c 7564 655f 7061 7468 733a 0a20  include_paths:. 
+0001d700: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
+0001d710: 6e5f 6f70 7473 202b 3d20 5b22 2d49 222c  n_opts += ["-I",
+0001d720: 2069 6e63 6c75 6465 5f70 6174 685d 0a20   include_path]. 
+0001d730: 2020 2020 2020 2063 6f6d 7069 6c65 725f         compiler_
+0001d740: 6f70 7473 203d 205b 222d 6650 4943 222c  opts = ["-fPIC",
+0001d750: 2022 2d76 225d 0a20 2020 2020 2020 2063   "-v"].        c
+0001d760: 6f6d 6d6f 6e5f 6f70 7473 202b 3d20 7365  ommon_opts += se
+0001d770: 6c66 2e5f 7472 616e 7366 6f72 6d5f 636f  lf._transform_co
+0001d780: 6d70 696c 6572 5f6f 7074 7328 636f 6d70  mpiler_opts(comp
+0001d790: 696c 6572 5f6f 7074 7329 0a20 2020 2020  iler_opts).     
+0001d7a0: 2020 2063 6f6d 6d6f 6e5f 6f70 7473 202b     common_opts +
+0001d7b0: 3d20 5b22 2d44 5f47 4c49 4243 5858 5f55  = ["-D_GLIBCXX_U
+0001d7c0: 5345 5f43 5858 3131 5f41 4249 3d25 6922  SE_CXX11_ABI=%i"
+0001d7d0: 2025 2028 3120 6966 2073 656c 662e 7573   % (1 if self.us
+0001d7e0: 655f 6378 7831 315f 6162 6920 656c 7365  e_cxx11_abi else
+0001d7f0: 2030 295d 0a20 2020 2020 2020 2063 6f6d   0)].        com
+0001d800: 6d6f 6e5f 6f70 7473 202b 3d20 5b22 2d44  mon_opts += ["-D
+0001d810: 2573 3d25 7322 2025 2069 7465 6d20 666f  %s=%s" % item fo
+0001d820: 7220 6974 656d 2069 6e20 736f 7274 6564  r item in sorted
+0001d830: 2873 656c 662e 635f 6d61 6372 6f5f 6465  (self.c_macro_de
+0001d840: 6669 6e65 732e 6974 656d 7328 2929 5d0a  fines.items())].
+0001d850: 2020 2020 2020 2020 636f 6d6d 6f6e 5f6f          common_o
+0001d860: 7074 7320 2b3d 205b 222d 6722 5d0a 2020  pts += ["-g"].  
+0001d870: 2020 2020 2020 6f70 7473 203d 2063 6f6d        opts = com
+0001d880: 6d6f 6e5f 6f70 7473 202b 205b 7365 6c66  mon_opts + [self
+0001d890: 2e5f 635f 6669 6c65 6e61 6d65 2c20 222d  ._c_filename, "-
+0001d8a0: 6f22 2c20 7365 6c66 2e5f 736f 5f66 696c  o", self._so_fil
+0001d8b0: 656e 616d 655d 0a20 2020 2020 2020 206f  ename].        o
+0001d8c0: 7074 7320 2b3d 206c 6973 7428 6d61 7028  pts += list(map(
+0001d8d0: 7365 6c66 2e5f 7472 616e 7366 6f72 6d5f  self._transform_
+0001d8e0: 6c64 5f66 6c61 672c 2073 656c 662e 6c64  ld_flag, self.ld
+0001d8f0: 5f66 6c61 6773 2929 0a20 2020 2020 2020  _flags)).       
+0001d900: 2063 6d64 5f62 696e 203d 2073 656c 662e   cmd_bin = self.
+0001d910: 5f67 6574 5f63 6f6d 7069 6c65 725f 6269  _get_compiler_bi
+0001d920: 6e28 290a 2020 2020 2020 2020 636d 645f  n().        cmd_
+0001d930: 6172 6773 203d 205b 636d 645f 6269 6e5d  args = [cmd_bin]
+0001d940: 202b 206f 7074 730a 2020 2020 2020 2020   + opts.        
+0001d950: 6672 6f6d 2073 7562 7072 6f63 6573 7320  from subprocess 
+0001d960: 696d 706f 7274 2050 6f70 656e 2c20 5049  import Popen, PI
+0001d970: 5045 2c20 5354 444f 5554 2c20 4361 6c6c  PE, STDOUT, Call
+0001d980: 6564 5072 6f63 6573 7345 7272 6f72 0a0a  edProcessError..
+0001d990: 2020 2020 2020 2020 7072 696e 7428 2225          print("%
+0001d9a0: 7320 6361 6c6c 3a20 2573 2220 2520 2873  s call: %s" % (s
+0001d9b0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+0001d9c0: 6e61 6d65 5f5f 2c20 2220 222e 6a6f 696e  name__, " ".join
+0001d9d0: 2863 6d64 5f61 7267 7329 292c 2066 696c  (cmd_args)), fil
+0001d9e0: 653d 7365 6c66 2e5f 6c6f 675f 7374 7265  e=self._log_stre
+0001d9f0: 616d 290a 2020 2020 2020 2020 7072 6f63  am).        proc
+0001da00: 203d 2050 6f70 656e 2863 6d64 5f61 7267   = Popen(cmd_arg
+0001da10: 732c 2063 7764 3d73 656c 662e 5f6d 6f64  s, cwd=self._mod
+0001da20: 5f70 6174 682c 2073 7464 6f75 743d 5049  _path, stdout=PI
+0001da30: 5045 2c20 7374 6465 7272 3d53 5444 4f55  PE, stderr=STDOU
+0001da40: 5429 0a20 2020 2020 2020 2073 7464 6f75  T).        stdou
+0001da50: 742c 2073 7464 6572 7220 3d20 7072 6f63  t, stderr = proc
+0001da60: 2e63 6f6d 6d75 6e69 6361 7465 2829 0a20  .communicate(). 
+0001da70: 2020 2020 2020 2061 7373 6572 7420 7374         assert st
+0001da80: 6465 7272 2069 7320 4e6f 6e65 2020 2320  derr is None  # 
+0001da90: 7368 6f75 6c64 206f 6e6c 7920 6861 7665  should only have
+0001daa0: 2073 7464 6f75 740a 2020 2020 2020 2020   stdout.        
+0001dab0: 6966 2070 726f 632e 7265 7475 726e 636f  if proc.returnco
+0001dac0: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
+0001dad0: 2020 2020 2070 7269 6e74 2822 2573 3a20       print("%s: 
+0001dae0: 2573 2066 6169 6c65 642e 2220 2520 2873  %s failed." % (s
+0001daf0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+0001db00: 6e61 6d65 5f5f 2c20 636d 645f 6269 6e29  name__, cmd_bin)
+0001db10: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0001db20: 696e 7428 224f 7269 6769 6e61 6c20 7374  int("Original st
+0001db30: 646f 7574 2f73 7464 6572 723a 2229 0a20  dout/stderr:"). 
+0001db40: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001db50: 2873 7464 6f75 742e 6465 636f 6465 2822  (stdout.decode("
+0001db60: 7574 6638 2229 290a 2020 2020 2020 2020  utf8")).        
+0001db70: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
+0001db80: 2020 2020 2020 2020 6966 2063 6d64 5f62          if cmd_b
+0001db90: 696e 2e65 6e64 7377 6974 6828 222f 6e76  in.endswith("/nv
+0001dba0: 6363 2229 2061 6e64 2062 2265 7272 6f72  cc") and b"error
+0001dbb0: 3a20 636f 6e73 7465 7870 7220 6675 6e63  : constexpr func
+0001dbc0: 7469 6f6e 2072 6574 7572 6e20 6973 206e  tion return is n
+0001dbd0: 6f6e 2d63 6f6e 7374 616e 7422 2069 6e20  on-constant" in 
+0001dbe0: 7374 646f 7574 3a0a 2020 2020 2020 2020  stdout:.        
+0001dbf0: 2020 2020 2020 2020 7072 696e 7428 2254          print("T
+0001dc00: 6869 7320 6d69 6768 7420 6265 2074 6865  his might be the
+0001dc10: 2065 7272 6f72 3a20 6874 7470 733a 2f2f   error: https://
+0001dc20: 6769 7468 7562 2e63 6f6d 2f74 656e 736f  github.com/tenso
+0001dc30: 7266 6c6f 772f 7465 6e73 6f72 666c 6f77  rflow/tensorflow
+0001dc40: 2f69 7373 7565 732f 3232 3736 3622 290a  /issues/22766").
+0001dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc60: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
+0001dc70: 2020 2020 6966 2063 6d64 5f62 696e 2e65      if cmd_bin.e
+0001dc80: 6e64 7377 6974 6828 222f 6e76 6363 2229  ndswith("/nvcc")
+0001dc90: 2061 6e64 2062 2267 6363 2076 6572 7369   and b"gcc versi
+0001dca0: 6f6e 7320 6c61 7465 7220 7468 616e 2220  ons later than" 
+0001dcb0: 696e 2073 7464 6f75 743a 0a20 2020 2020  in stdout:.     
+0001dcc0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001dcd0: 2822 596f 7572 2047 4343 2076 6572 7369  ("Your GCC versi
+0001dce0: 6f6e 206d 6967 6874 2062 6520 746f 6f20  on might be too 
+0001dcf0: 6e65 772e 2054 6869 7320 6973 2061 2070  new. This is a p
+0001dd00: 726f 626c 656d 2077 6974 6820 736f 6d65  roblem with some
+0001dd10: 206e 7663 6320 7665 7273 696f 6e73 2e22   nvcc versions."
+0001dd20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dd30: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
+0001dd40: 2020 2020 2020 7261 6973 6520 4361 6c6c        raise Call
+0001dd50: 6564 5072 6f63 6573 7345 7272 6f72 2872  edProcessError(r
+0001dd60: 6574 7572 6e63 6f64 653d 7072 6f63 2e72  eturncode=proc.r
+0001dd70: 6574 7572 6e63 6f64 652c 2063 6d64 3d63  eturncode, cmd=c
+0001dd80: 6d64 5f61 7267 7329 0a20 2020 2020 2020  md_args).       
+0001dd90: 2061 7373 6572 7420 6f73 2e70 6174 682e   assert os.path.
+0001dda0: 6578 6973 7473 2873 656c 662e 5f73 6f5f  exists(self._so_
+0001ddb0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+0001ddc0: 2020 7769 7468 206f 7065 6e28 2225 732f    with open("%s/
+0001ddd0: 636f 6d70 696c 652e 6c6f 6722 2025 2073  compile.log" % s
+0001dde0: 656c 662e 5f6d 6f64 5f70 6174 682c 2022  elf._mod_path, "
+0001ddf0: 7762 2229 2061 7320 663a 0a20 2020 2020  wb") as f:.     
+0001de00: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
+0001de10: 6572 626f 7365 3a0a 2020 2020 2020 2020  erbose:.        
+0001de20: 2020 2020 2020 2020 7072 696e 7428 2225          print("%
+0001de30: 733a 2077 7269 7465 2063 6f6d 7069 6c65  s: write compile
+0001de40: 206c 6f67 2074 6f3a 2025 7322 2025 2028   log to: %s" % (
+0001de50: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
+0001de60: 5f6e 616d 655f 5f2c 2066 2e6e 616d 6529  _name__, f.name)
+0001de70: 290a 2020 2020 2020 2020 2020 2020 662e  ).            f.
+0001de80: 7772 6974 6528 2822 2b20 2573 5c6e 2220  write(("+ %s\n" 
+0001de90: 2520 2220 222e 6a6f 696e 2863 6d64 5f61  % " ".join(cmd_a
+0001dea0: 7267 7329 292e 656e 636f 6465 2822 7574  rgs)).encode("ut
+0001deb0: 6638 2229 290a 2020 2020 2020 2020 2020  f8")).          
+0001dec0: 2020 662e 7772 6974 6528 7374 646f 7574    f.write(stdout
+0001ded0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+0001dee0: 7361 7665 5f69 6e66 6f28 290a 2020 2020  save_info().    
+0001def0: 2020 2020 6173 7365 7274 206e 6f74 2073      assert not s
+0001df00: 656c 662e 5f6e 6565 645f 7265 636f 6d70  elf._need_recomp
+0001df10: 696c 6528 290a 0a20 2020 2064 6566 206c  ile()..    def l
+0001df20: 6f61 645f 6c69 625f 6374 7970 6573 2873  oad_lib_ctypes(s
+0001df30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001df40: 220a 2020 2020 2020 2020 3a72 7479 7065  ".        :rtype
+0001df50: 3a20 6374 7970 6573 2e43 444c 4c0a 2020  : ctypes.CDLL.  
+0001df60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001df70: 2020 6966 2073 656c 662e 5f63 7479 7065    if self._ctype
+0001df80: 735f 6c69 623a 0a20 2020 2020 2020 2020  s_lib:.         
+0001df90: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0001dfa0: 6374 7970 6573 5f6c 6962 0a20 2020 2020  ctypes_lib.     
+0001dfb0: 2020 2073 656c 662e 5f6d 6179 6265 5f63     self._maybe_c
+0001dfc0: 6f6d 7069 6c65 2829 0a20 2020 2020 2020  ompile().       
+0001dfd0: 2069 6d70 6f72 7420 6374 7970 6573 0a0a   import ctypes..
+0001dfe0: 2020 2020 2020 2020 7365 6c66 2e5f 6374          self._ct
+0001dff0: 7970 6573 5f6c 6962 203d 2063 7479 7065  ypes_lib = ctype
+0001e000: 732e 6364 6c6c 2e4c 6f61 644c 6962 7261  s.cdll.LoadLibra
+0001e010: 7279 2873 656c 662e 5f73 6f5f 6669 6c65  ry(self._so_file
+0001e020: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
+0001e030: 7475 726e 2073 656c 662e 5f63 7479 7065  turn self._ctype
+0001e040: 735f 6c69 620a 0a20 2020 2064 6566 2067  s_lib..    def g
+0001e050: 6574 5f6c 6962 5f66 696c 656e 616d 6528  et_lib_filename(
+0001e060: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0001e070: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
+0001e080: 653a 2073 7472 0a20 2020 2020 2020 2022  e: str.        "
+0001e090: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0001e0a0: 5f6d 6179 6265 5f63 6f6d 7069 6c65 2829  _maybe_compile()
+0001e0b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001e0c0: 7365 6c66 2e5f 736f 5f66 696c 656e 616d  self._so_filenam
+0001e0d0: 650a 0a0a 2320 5365 6520 3a66 756e 633a  e...# See :func:
+0001e0e0: 606d 6179 6265 5f72 6573 7461 7274 5f72  `maybe_restart_r
+0001e0f0: 6574 7572 6e6e 5f77 6974 685f 6174 666f  eturnn_with_atfo
+0001e100: 726b 5f70 6174 6368 6020 6265 6c6f 7720  rk_patch` below 
+0001e110: 666f 7220 7768 7920 796f 7520 6d69 6768  for why you migh
+0001e120: 7420 7761 6e74 2074 6f20 7573 6520 7468  t want to use th
+0001e130: 6973 2e0a 5f63 5f63 6f64 655f 7061 7463  is.._c_code_patc
+0001e140: 685f 6174 666f 726b 203d 2022 2222 0a23  h_atfork = """.#
+0001e150: 6465 6669 6e65 205f 474e 555f 534f 5552  define _GNU_SOUR
+0001e160: 4345 0a23 696e 636c 7564 6520 3c73 6368  CE.#include <sch
+0001e170: 6564 2e68 3e0a 2369 6e63 6c75 6465 203c  ed.h>.#include <
+0001e180: 7369 676e 616c 2e68 3e0a 2369 6e63 6c75  signal.h>.#inclu
+0001e190: 6465 203c 7379 732f 7379 7363 616c 6c2e  de <sys/syscall.
+0001e1a0: 683e 0a23 696e 636c 7564 6520 3c73 7464  h>.#include <std
+0001e1b0: 696f 2e68 3e0a 2369 6e63 6c75 6465 203c  io.h>.#include <
+0001e1c0: 7374 646c 6962 2e68 3e0a 2369 6e63 6c75  stdlib.h>.#inclu
+0001e1d0: 6465 203c 756e 6973 7464 2e68 3e0a 0a2f  de <unistd.h>../
+0001e1e0: 2f20 6874 7470 733a 2f2f 7374 6163 6b6f  / https://stacko
+0001e1f0: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
+0001e200: 7469 6f6e 732f 3436 3834 3534 3936 2f6c  tions/46845496/l
+0001e210: 642d 7072 656c 6f61 642d 616e 642d 6c69  d-preload-and-li
+0001e220: 6e6b 6167 650a 2f2f 2068 7474 7073 3a2f  nkage.// https:/
+0001e230: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
+0001e240: 6f6d 2f71 7565 7374 696f 6e73 2f34 3638  om/questions/468
+0001e250: 3130 3539 372f 666f 726b 6578 6563 2d77  10597/forkexec-w
+0001e260: 6974 686f 7574 2d61 7466 6f72 6b2d 6861  ithout-atfork-ha
+0001e270: 6e64 6c65 7273 0a0a 696e 7420 7074 6872  ndlers..int pthr
+0001e280: 6561 645f 6174 666f 726b 2876 6f69 6420  ead_atfork(void 
+0001e290: 282a 7072 6570 6172 6529 2876 6f69 6429  (*prepare)(void)
+0001e2a0: 2c20 766f 6964 2028 2a70 6172 656e 7429  , void (*parent)
+0001e2b0: 2876 6f69 6429 2c20 766f 6964 2028 2a63  (void), void (*c
+0001e2c0: 6869 6c64 2928 766f 6964 2929 207b 0a20  hild)(void)) {. 
+0001e2d0: 2070 7269 6e74 6628 2249 676e 6f72 696e   printf("Ignorin
+0001e2e0: 6720 7074 6872 6561 645f 6174 666f 726b  g pthread_atfork
+0001e2f0: 2063 616c 6c21 5c5c 6e22 293b 0a20 2066   call!\\n");.  f
+0001e300: 666c 7573 6828 7374 646f 7574 293b 0a20  flush(stdout);. 
+0001e310: 2072 6574 7572 6e20 303b 0a7d 0a0a 696e   return 0;.}..in
+0001e320: 7420 5f5f 7265 6769 7374 6572 5f61 7466  t __register_atf
+0001e330: 6f72 6b28 766f 6964 2028 2a70 7265 7061  ork(void (*prepa
+0001e340: 7265 2928 766f 6964 292c 2076 6f69 6420  re)(void), void 
+0001e350: 282a 7061 7265 6e74 2928 766f 6964 292c  (*parent)(void),
+0001e360: 2076 6f69 6420 282a 6368 696c 6429 2876   void (*child)(v
+0001e370: 6f69 6429 2920 7b0a 2020 7072 696e 7466  oid)) {.  printf
+0001e380: 2822 4967 6e6f 7269 6e67 205f 5f72 6567  ("Ignoring __reg
+0001e390: 6973 7465 725f 6174 666f 726b 2063 616c  ister_atfork cal
+0001e3a0: 6c21 5c5c 6e22 293b 0a20 2066 666c 7573  l!\\n");.  fflus
+0001e3b0: 6828 7374 646f 7574 293b 0a20 2072 6574  h(stdout);.  ret
+0001e3c0: 7572 6e20 303b 0a7d 0a0a 2f2f 2041 6e6f  urn 0;.}..// Ano
+0001e3d0: 7468 6572 2077 6179 2074 6f20 6967 6e6f  ther way to igno
+0001e3e0: 7265 2061 7466 6f72 6b20 6861 6e64 6c65  re atfork handle
+0001e3f0: 7273 3a20 4f76 6572 7269 6465 2066 6f72  rs: Override for
+0001e400: 6b2e 0a23 6966 6465 6620 5f5f 6c69 6e75  k..#ifdef __linu
+0001e410: 785f 5f20 2f2f 206f 6e6c 7920 776f 726b  x__ // only work
+0001e420: 7320 6f6e 204c 696e 7578 2063 7572 7265  s on Linux curre
+0001e430: 6e74 6c79 0a70 6964 5f74 2066 6f72 6b28  ntly.pid_t fork(
+0001e440: 766f 6964 2920 7b0a 2020 7265 7475 726e  void) {.  return
+0001e450: 2073 7973 6361 6c6c 2853 5953 5f63 6c6f   syscall(SYS_clo
+0001e460: 6e65 2c20 5349 4743 484c 442c 2030 293b  ne, SIGCHLD, 0);
+0001e470: 0a7d 0a23 656e 6469 660a 0a5f 5f61 7474  .}.#endif..__att
+0001e480: 7269 6275 7465 5f5f 2828 636f 6e73 7472  ribute__((constr
+0001e490: 7563 746f 7229 290a 766f 6964 2070 6174  uctor)).void pat
+0001e4a0: 6368 5f61 7466 6f72 6b5f 696e 6974 2829  ch_atfork_init()
+0001e4b0: 207b 0a20 2073 6574 656e 7628 225f 5f52   {.  setenv("__R
+0001e4c0: 4554 5552 4e4e 5f41 5446 4f52 4b5f 5041  ETURNN_ATFORK_PA
+0001e4d0: 5443 4845 4422 2c20 2231 222c 2031 293b  TCHED", "1", 1);
+0001e4e0: 0a7d 0a22 2222 0a0a 0a64 6566 2067 6574  .}."""...def get
+0001e4f0: 5f70 6174 6368 5f61 7466 6f72 6b5f 6c69  _patch_atfork_li
+0001e500: 6228 293a 0a20 2020 2022 2222 0a20 2020  b():.    """.   
+0001e510: 203a 7265 7475 726e 3a20 7061 7468 2074   :return: path t
+0001e520: 6f20 6f75 7220 7061 7463 685f 6174 666f  o our patch_atfo
+0001e530: 726b 206c 6962 2e20 7365 6520 3a66 756e  rk lib. see :fun
+0001e540: 633a 606d 6179 6265 5f72 6573 7461 7274  c:`maybe_restart
+0001e550: 5f72 6574 7572 6e6e 5f77 6974 685f 6174  _returnn_with_at
+0001e560: 666f 726b 5f70 6174 6368 600a 2020 2020  fork_patch`.    
+0001e570: 3a72 7479 7065 3a20 7374 720a 2020 2020  :rtype: str.    
+0001e580: 2222 220a 2020 2020 6e61 7469 7665 203d  """.    native =
+0001e590: 204e 6174 6976 6543 6f64 6543 6f6d 7069   NativeCodeCompi
+0001e5a0: 6c65 7228 6261 7365 5f6e 616d 653d 2270  ler(base_name="p
+0001e5b0: 6174 6368 5f61 7466 6f72 6b22 2c20 636f  atch_atfork", co
+0001e5c0: 6465 5f76 6572 7369 6f6e 3d32 2c20 636f  de_version=2, co
+0001e5d0: 6465 3d5f 635f 636f 6465 5f70 6174 6368  de=_c_code_patch
+0001e5e0: 5f61 7466 6f72 6b2c 2069 735f 6370 703d  _atfork, is_cpp=
+0001e5f0: 4661 6c73 6529 0a20 2020 2066 6e20 3d20  False).    fn = 
+0001e600: 6e61 7469 7665 2e67 6574 5f6c 6962 5f66  native.get_lib_f
+0001e610: 696c 656e 616d 6528 290a 2020 2020 7265  ilename().    re
+0001e620: 7475 726e 2066 6e0a 0a0a 6465 6620 7265  turn fn...def re
+0001e630: 7374 6172 745f 7265 7475 726e 6e28 293a  start_returnn():
+0001e640: 0a20 2020 2022 2222 0a20 2020 2052 6573  .    """.    Res
+0001e650: 7461 7274 7320 5245 5455 524e 4e2e 0a20  tarts RETURNN.. 
+0001e660: 2020 2022 2222 0a20 2020 206c 6f67 2e66     """.    log.f
+0001e670: 6c75 7368 2829 0a20 2020 2073 7973 2e73  lush().    sys.s
+0001e680: 7464 6f75 742e 666c 7573 6828 290a 2020  tdout.flush().  
+0001e690: 2020 7379 732e 7374 6465 7272 2e66 6c75    sys.stderr.flu
+0001e6a0: 7368 2829 0a20 2020 2023 2068 7474 7073  sh().    # https
+0001e6b0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
+0001e6c0: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f37  .com/questions/7
+0001e6d0: 3233 3335 3930 342f 7369 6d70 6c65 2d77  2335904/simple-w
+0001e6e0: 6179 2d74 6f2d 7265 7374 6172 742d 6170  ay-to-restart-ap
+0001e6f0: 706c 6963 6174 696f 6e0a 2020 2020 636c  plication.    cl
+0001e700: 6f73 655f 616c 6c5f 6664 735f 6578 6365  ose_all_fds_exce
+0001e710: 7074 287b 302c 2031 2c20 327d 290a 2020  pt({0, 1, 2}).  
+0001e720: 2020 6f73 2e65 7865 6376 2873 7973 2e65    os.execv(sys.e
+0001e730: 7865 6375 7461 626c 652c 205b 7379 732e  xecutable, [sys.
+0001e740: 6578 6563 7574 6162 6c65 5d20 2b20 7379  executable] + sy
+0001e750: 732e 6172 6776 290a 2020 2020 7261 6973  s.argv).    rais
+0001e760: 6520 4578 6365 7074 696f 6e28 2272 6573  e Exception("res
+0001e770: 7461 7274 5f72 6574 7572 6e6e 3a20 6578  tart_returnn: ex
+0001e780: 6563 7620 6661 696c 6564 2229 0a0a 0a64  ecv failed")...d
+0001e790: 6566 206d 6179 6265 5f72 6573 7461 7274  ef maybe_restart
+0001e7a0: 5f72 6574 7572 6e6e 5f77 6974 685f 6174  _returnn_with_at
+0001e7b0: 666f 726b 5f70 6174 6368 2829 3a0a 2020  fork_patch():.  
+0001e7c0: 2020 2222 220a 2020 2020 5768 6174 2077    """.    What w
+0001e7d0: 6520 7761 6e74 3a20 7375 6270 726f 6365  e want: subproce
+0001e7e0: 7373 2e50 6f70 656e 2074 6f20 616c 7761  ss.Popen to alwa
+0001e7f0: 7973 2077 6f72 6b2e 0a20 2020 2050 726f  ys work..    Pro
+0001e800: 626c 656d 3a20 4974 2075 7365 7320 666f  blem: It uses fo
+0001e810: 726b 2b65 7865 6320 696e 7465 726e 616c  rk+exec internal
+0001e820: 6c79 2069 6e20 7375 6270 726f 6365 7373  ly in subprocess
+0001e830: 5f66 6f72 6b5f 6578 6563 2c20 7669 6120  _fork_exec, via 
+0001e840: 5f70 6f73 6978 7375 6270 726f 6365 7373  _posixsubprocess
+0001e850: 2e66 6f72 6b5f 6578 6563 2e0a 2020 2020  .fork_exec..    
+0001e860: 5468 6174 2069 7320 6120 7072 6f62 6c65  That is a proble
+0001e870: 6d20 6265 6361 7573 6520 666f 726b 2063  m because fork c
+0001e880: 616e 2074 7269 6767 6572 2061 6e79 2061  an trigger any a
+0001e890: 7466 6f72 6b20 6861 6e64 6c65 7273 2072  tfork handlers r
+0001e8a0: 6567 6973 7465 7265 6420 7669 6120 7074  egistered via pt
+0001e8b0: 6872 6561 645f 6174 666f 726b 2c0a 2020  hread_atfork,.  
+0001e8c0: 2020 616e 6420 7468 6f73 6520 6361 6e20    and those can 
+0001e8d0: 6372 6173 682f 6465 6164 6c6f 636b 2069  crash/deadlock i
+0001e8e0: 6e20 736f 6d65 2063 6173 6573 2e0a 0a20  n some cases... 
+0001e8f0: 2020 2068 7474 7073 3a2f 2f67 6974 6875     https://githu
+0001e900: 622e 636f 6d2f 7465 6e73 6f72 666c 6f77  b.com/tensorflow
+0001e910: 2f74 656e 736f 7266 6c6f 772f 6973 7375  /tensorflow/issu
+0001e920: 6573 2f31 3338 3032 0a20 2020 2068 7474  es/13802.    htt
+0001e930: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0001e940: 7869 616e 7969 2f4f 7065 6e42 4c41 532f  xianyi/OpenBLAS/
+0001e950: 6973 7375 6573 2f32 3430 0a20 2020 2068  issues/240.    h
+0001e960: 7474 7073 3a2f 2f74 7261 632e 7361 6765  ttps://trac.sage
+0001e970: 6d61 7468 2e6f 7267 2f74 6963 6b65 742f  math.org/ticket/
+0001e980: 3232 3032 310a 2020 2020 6874 7470 733a  22021.    https:
+0001e990: 2f2f 6275 6773 2e70 7974 686f 6e2e 6f72  //bugs.python.or
+0001e9a0: 672f 6973 7375 6533 3138 3134 0a20 2020  g/issue31814.   
+0001e9b0: 2068 7474 7073 3a2f 2f73 7461 636b 6f76   https://stackov
+0001e9c0: 6572 666c 6f77 2e63 6f6d 2f71 7565 7374  erflow.com/quest
+0001e9d0: 696f 6e73 2f34 3638 3435 3439 362f 6c64  ions/46845496/ld
+0001e9e0: 2d70 7265 6c6f 6164 2d61 6e64 2d6c 696e  -preload-and-lin
+0001e9f0: 6b61 6765 0a20 2020 2068 7474 7073 3a2f  kage.    https:/
+0001ea00: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
+0001ea10: 6f6d 2f71 7565 7374 696f 6e73 2f34 3638  om/questions/468
+0001ea20: 3130 3539 372f 666f 726b 6578 6563 2d77  10597/forkexec-w
+0001ea30: 6974 686f 7574 2d61 7466 6f72 6b2d 6861  ithout-atfork-ha
+0001ea40: 6e64 6c65 7273 0a0a 2020 2020 5468 6520  ndlers..    The 
+0001ea50: 736f 6c75 7469 6f6e 2068 6572 653a 204a  solution here: J
+0001ea60: 7573 7420 6f76 6572 7269 6465 2070 7468  ust override pth
+0001ea70: 7265 6164 5f61 7466 6f72 6b2c 2076 6961  read_atfork, via
+0001ea80: 204c 445f 5052 454c 4f41 442e 0a20 2020   LD_PRELOAD..   
+0001ea90: 204e 6f74 6520 7468 6174 2069 6e20 736f   Note that in so
+0001eaa0: 6d65 2063 6173 6573 2c20 7468 6973 2069  me cases, this i
+0001eab0: 7320 6e6f 7420 656e 6f75 6768 2028 7365  s not enough (se
+0001eac0: 6520 7468 6520 534f 2064 6973 6375 7373  e the SO discuss
+0001ead0: 696f 6e29 2c0a 2020 2020 736f 2077 6520  ion),.    so we 
+0001eae0: 616c 736f 206f 7665 7277 7269 7465 2066  also overwrite f
+0001eaf0: 6f72 6b20 6974 7365 6c66 2e0a 2020 2020  ork itself..    
+0001eb00: 5365 6520 616c 736f 2074 6573 7473 2f74  See also tests/t
+0001eb10: 6573 745f 666f 726b 5f65 7865 632e 7079  est_fork_exec.py
+0001eb20: 2066 6f72 2061 2064 656d 6f2e 0a20 2020   for a demo..   
+0001eb30: 2022 2222 0a20 2020 2069 6620 6f73 2e65   """.    if os.e
+0001eb40: 6e76 6972 6f6e 2e67 6574 2822 5f5f 5245  nviron.get("__RE
+0001eb50: 5455 524e 4e5f 4154 464f 524b 5f50 4154  TURNN_ATFORK_PAT
+0001eb60: 4348 4544 2229 203d 3d20 2231 223a 0a20  CHED") == "1":. 
+0001eb70: 2020 2020 2020 2070 7269 6e74 2822 5275         print("Ru
+0001eb80: 6e6e 696e 6720 7769 7468 2070 6174 6368  nning with patch
+0001eb90: 6564 2061 7466 6f72 6b2e 2229 0a20 2020  ed atfork.").   
+0001eba0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0001ebb0: 6966 206f 732e 656e 7669 726f 6e2e 6765  if os.environ.ge
+0001ebc0: 7428 225f 5f52 4554 5552 4e4e 5f54 5259  t("__RETURNN_TRY
+0001ebd0: 5f41 5446 4f52 4b5f 5041 5443 4845 4422  _ATFORK_PATCHED"
+0001ebe0: 2920 3d3d 2022 3122 3a0a 2020 2020 2020  ) == "1":.      
+0001ebf0: 2020 7072 696e 7428 2250 6174 6368 696e    print("Patchin
+0001ec00: 6720 6174 666f 726b 2064 6964 206e 6f74  g atfork did not
+0001ec10: 2077 6f72 6b21 2057 696c 6c20 636f 6e74   work! Will cont
+0001ec20: 696e 7565 2061 6e79 7761 792e 2229 0a20  inue anyway."). 
+0001ec30: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+0001ec40: 2020 6c69 6220 3d20 6765 745f 7061 7463    lib = get_patc
+0001ec50: 685f 6174 666f 726b 5f6c 6962 2829 0a20  h_atfork_lib(). 
+0001ec60: 2020 2065 6e76 203d 206f 732e 656e 7669     env = os.envi
+0001ec70: 726f 6e2e 636f 7079 2829 0a20 2020 2065  ron.copy().    e
+0001ec80: 6e76 5b22 4459 4c44 5f49 4e53 4552 545f  nv["DYLD_INSERT_
+0001ec90: 4c49 4252 4152 4945 5322 2069 6620 7379  LIBRARIES" if sy
+0001eca0: 732e 706c 6174 666f 726d 203d 3d20 2264  s.platform == "d
+0001ecb0: 6172 7769 6e22 2065 6c73 6520 224c 445f  arwin" else "LD_
+0001ecc0: 5052 454c 4f41 4422 5d20 3d20 6c69 620a  PRELOAD"] = lib.
+0001ecd0: 2020 2020 656e 765b 225f 5f52 4554 5552      env["__RETUR
+0001ece0: 4e4e 5f54 5259 5f41 5446 4f52 4b5f 5041  NN_TRY_ATFORK_PA
+0001ecf0: 5443 4845 4422 5d20 3d20 2231 220a 2020  TCHED"] = "1".  
+0001ed00: 2020 7072 696e 7428 2252 6573 7461 7274    print("Restart
+0001ed10: 696e 6720 5265 7475 726e 6e20 7769 7468  ing Returnn with
+0001ed20: 2061 7466 6f72 6b20 7061 7463 682e 2e2e   atfork patch...
+0001ed30: 222c 2073 7973 2e65 7865 6375 7461 626c  ", sys.executabl
+0001ed40: 652c 2073 7973 2e61 7267 7629 0a20 2020  e, sys.argv).   
+0001ed50: 2073 7973 2e73 7464 6f75 742e 666c 7573   sys.stdout.flus
+0001ed60: 6828 290a 2020 2020 6f73 2e65 7865 6376  h().    os.execv
+0001ed70: 7065 2873 7973 2e65 7865 6375 7461 626c  pe(sys.executabl
+0001ed80: 652c 205b 7379 732e 6578 6563 7574 6162  e, [sys.executab
+0001ed90: 6c65 5d20 2b20 7379 732e 6172 6776 2c20  le] + sys.argv, 
+0001eda0: 656e 7629 0a20 2020 2070 7269 6e74 2822  env).    print("
+0001edb0: 6578 6563 7670 6520 6469 6420 6e6f 7420  execvpe did not 
+0001edc0: 776f 726b 3f22 290a 0a0a 6465 6620 636c  work?")...def cl
+0001edd0: 6f73 655f 616c 6c5f 6664 735f 6578 6365  ose_all_fds_exce
+0001ede0: 7074 2865 7863 6570 745f 6664 7329 3a0a  pt(except_fds):.
+0001edf0: 2020 2020 2222 220a 2020 2020 4361 6c6c      """.    Call
+0001ee00: 7320 6f73 2e63 6c6f 7365 7261 6e67 6520  s os.closerange 
+0001ee10: 6578 6365 7074 2066 6f72 2074 6865 2067  except for the g
+0001ee20: 6976 656e 2066 6473 2e0a 2020 2020 436f  iven fds..    Co
+0001ee30: 6465 2061 646f 7074 6564 2061 6e64 2065  de adopted and e
+0001ee40: 7874 656e 6465 6420 6672 6f6d 206d 756c  xtended from mul
+0001ee50: 7469 7072 6f63 6573 7369 6e67 2e75 7469  tiprocessing.uti
+0001ee60: 6c2e 636c 6f73 655f 616c 6c5f 6664 735f  l.close_all_fds_
+0001ee70: 6578 6365 7074 2e0a 0a20 2020 203a 7061  except...    :pa
+0001ee80: 7261 6d20 7479 7069 6e67 2e43 6f6c 6c65  ram typing.Colle
+0001ee90: 6374 696f 6e5b 696e 745d 2065 7863 6570  ction[int] excep
+0001eea0: 745f 6664 733a 2075 7375 616c 6c79 2061  t_fds: usually a
+0001eeb0: 7420 6c65 6173 7420 7b30 2c31 2c32 7d0a  t least {0,1,2}.
+0001eec0: 2020 2020 2222 220a 2020 2020 2320 6e6f      """.    # no
+0001eed0: 696e 7370 6563 7469 6f6e 2050 7942 726f  inspection PyBro
+0001eee0: 6164 4578 6365 7074 696f 6e0a 2020 2020  adException.    
+0001eef0: 7472 793a 0a20 2020 2020 2020 206d 6178  try:.        max
+0001ef00: 5f66 6420 3d20 6f73 2e73 7973 636f 6e66  _fd = os.sysconf
+0001ef10: 2822 5343 5f4f 5045 4e5f 4d41 5822 290a  ("SC_OPEN_MAX").
+0001ef20: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0001ef30: 7469 6f6e 3a0a 2020 2020 2020 2020 6d61  tion:.        ma
+0001ef40: 785f 6664 203d 2032 3536 0a0a 2020 2020  x_fd = 256..    
+0001ef50: 6578 6365 7074 5f66 6473 203d 2073 6f72  except_fds = sor
+0001ef60: 7465 6428 6c69 7374 2865 7863 6570 745f  ted(list(except_
+0001ef70: 6664 7329 202b 205b 2d31 2c20 6d61 785f  fds) + [-1, max_
+0001ef80: 6664 5d29 0a20 2020 2061 7373 6572 7420  fd]).    assert 
+0001ef90: 6578 6365 7074 5f66 6473 5b30 5d20 3d3d  except_fds[0] ==
+0001efa0: 202d 3120 616e 6420 6578 6365 7074 5f66   -1 and except_f
+0001efb0: 6473 5b2d 315d 203d 3d20 6d61 785f 6664  ds[-1] == max_fd
+0001efc0: 2c20 2266 6420 696e 7661 6c69 6422 0a0a  , "fd invalid"..
+0001efd0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0001efe0: 6765 286c 656e 2865 7863 6570 745f 6664  ge(len(except_fd
+0001eff0: 7329 202d 2031 293a 0a20 2020 2020 2020  s) - 1):.       
+0001f000: 2069 6620 6578 6365 7074 5f66 6473 5b69   if except_fds[i
+0001f010: 5d20 2b20 3120 3c20 6578 6365 7074 5f66  ] + 1 < except_f
+0001f020: 6473 5b69 202b 2031 5d3a 0a20 2020 2020  ds[i + 1]:.     
+0001f030: 2020 2020 2020 206f 732e 636c 6f73 6572         os.closer
+0001f040: 616e 6765 2865 7863 6570 745f 6664 735b  ange(except_fds[
+0001f050: 695d 202b 2031 2c20 6578 6365 7074 5f66  i] + 1, except_f
+0001f060: 6473 5b69 202b 2031 5d29 0a0a 0a63 6c61  ds[i + 1])...cla
+0001f070: 7373 2053 7461 7473 3a0a 2020 2020 2222  ss Stats:.    ""
+0001f080: 220a 2020 2020 436f 6c6c 6563 7473 206d  ".    Collects m
+0001f090: 6561 6e20 616e 6420 7661 7269 616e 6365  ean and variance
+0001f0a0: 2c20 7275 6e6e 696e 6720 6176 6572 6167  , running averag
+0001f0b0: 652e 0a0a 2020 2020 6874 7470 733a 2f2f  e...    https://
+0001f0c0: 656e 2e77 696b 6970 6564 6961 2e6f 7267  en.wikipedia.org
+0001f0d0: 2f77 696b 692f 416c 676f 7269 7468 6d73  /wiki/Algorithms
+0001f0e0: 5f66 6f72 5f63 616c 6375 6c61 7469 6e67  _for_calculating
+0001f0f0: 5f76 6172 6961 6e63 650a 2020 2020 2222  _variance.    ""
+0001f100: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+0001f110: 745f 5f28 7365 6c66 2c20 666f 726d 6174  t__(self, format
+0001f120: 5f73 7472 3d4e 6f6e 6529 3a0a 2020 2020  _str=None):.    
+0001f130: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001f140: 3a70 6172 616d 204e 6f6e 657c 2828 666c  :param None|((fl
+0001f150: 6f61 747c 6e75 6d70 792e 6e64 6172 7261  oat|numpy.ndarra
+0001f160: 7929 2d3e 7374 7229 2066 6f72 6d61 745f  y)->str) format_
+0001f170: 7374 723a 0a20 2020 2020 2020 2022 2222  str:.        """
+0001f180: 0a20 2020 2020 2020 2073 656c 662e 666f  .        self.fo
+0001f190: 726d 6174 5f73 7472 203d 2066 6f72 6d61  rmat_str = forma
+0001f1a0: 745f 7374 7220 6f72 2073 7472 0a20 2020  t_str or str.   
+0001f1b0: 2020 2020 2073 656c 662e 6d65 616e 203d       self.mean =
+0001f1c0: 2030 2e30 0a20 2020 2020 2020 2073 656c   0.0.        sel
+0001f1d0: 662e 6d65 616e 5f73 7120 3d20 302e 300a  f.mean_sq = 0.0.
+0001f1e0: 2020 2020 2020 2020 7365 6c66 2e76 6172          self.var
+0001f1f0: 203d 2030 2e30 0a20 2020 2020 2020 2073   = 0.0.        s
+0001f200: 656c 662e 6d69 6e20 3d20 4e6f 6e65 0a20  elf.min = None. 
+0001f210: 2020 2020 2020 2073 656c 662e 6d61 7820         self.max 
+0001f220: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+0001f230: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
+0001f240: 656e 203d 2030 0a20 2020 2020 2020 2073  en = 0.        s
+0001f250: 656c 662e 6e75 6d5f 7365 7173 203d 2030  elf.num_seqs = 0
+0001f260: 0a0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
+0001f270: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+0001f280: 2069 6620 7365 6c66 2e6e 756d 5f73 6571   if self.num_seq
+0001f290: 7320 3e20 303a 0a20 2020 2020 2020 2020  s > 0:.         
+0001f2a0: 2020 2069 6620 7365 6c66 2e6e 756d 5f73     if self.num_s
+0001f2b0: 6571 7320 3d3d 2073 656c 662e 746f 7461  eqs == self.tota
+0001f2c0: 6c5f 6461 7461 5f6c 656e 3a0a 2020 2020  l_data_len:.    
+0001f2d0: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+0001f2e0: 615f 7374 7220 3d20 2261 7667 5f64 6174  a_str = "avg_dat
+0001f2f0: 615f 6c65 6e3d 3122 0a20 2020 2020 2020  a_len=1".       
+0001f300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001f310: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+0001f320: 5f73 7472 203d 2022 746f 7461 6c5f 6461  _str = "total_da
+0001f330: 7461 5f6c 656e 3d25 692c 2061 7667 5f64  ta_len=%i, avg_d
+0001f340: 6174 615f 6c65 6e3d 2566 2220 2520 280a  ata_len=%f" % (.
+0001f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f360: 2020 2020 7365 6c66 2e74 6f74 616c 5f64      self.total_d
+0001f370: 6174 615f 6c65 6e2c 0a20 2020 2020 2020  ata_len,.       
+0001f380: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
+0001f390: 6174 2873 656c 662e 746f 7461 6c5f 6461  at(self.total_da
+0001f3a0: 7461 5f6c 656e 2920 2f20 7365 6c66 2e6e  ta_len) / self.n
+0001f3b0: 756d 5f73 6571 732c 0a20 2020 2020 2020  um_seqs,.       
+0001f3c0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001f3d0: 2020 2020 2020 2072 6574 7572 6e20 2253         return "S
+0001f3e0: 7461 7473 286d 6561 6e3d 2573 2c20 7374  tats(mean=%s, st
+0001f3f0: 645f 6465 763d 2573 2c20 6d69 6e3d 2573  d_dev=%s, min=%s
+0001f400: 2c20 6d61 783d 2573 2c20 6e75 6d5f 7365  , max=%s, num_se
+0001f410: 7173 3d25 692c 2025 7329 2220 2520 280a  qs=%i, %s)" % (.
+0001f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f430: 7365 6c66 2e66 6f72 6d61 745f 7374 7228  self.format_str(
+0001f440: 7365 6c66 2e67 6574 5f6d 6561 6e28 2929  self.get_mean())
+0001f450: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f460: 2020 7365 6c66 2e66 6f72 6d61 745f 7374    self.format_st
+0001f470: 7228 7365 6c66 2e67 6574 5f73 7464 5f64  r(self.get_std_d
+0001f480: 6576 2829 292c 0a20 2020 2020 2020 2020  ev()),.         
+0001f490: 2020 2020 2020 2073 656c 662e 666f 726d         self.form
+0001f4a0: 6174 5f73 7472 2873 656c 662e 6d69 6e29  at_str(self.min)
+0001f4b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f4c0: 2020 7365 6c66 2e66 6f72 6d61 745f 7374    self.format_st
+0001f4d0: 7228 7365 6c66 2e6d 6178 292c 0a20 2020  r(self.max),.   
+0001f4e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001f4f0: 662e 6e75 6d5f 7365 7173 2c0a 2020 2020  f.num_seqs,.    
+0001f500: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+0001f510: 615f 7374 722c 0a20 2020 2020 2020 2020  a_str,.         
+0001f520: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+0001f530: 7572 6e20 2253 7461 7473 286e 756d 5f73  urn "Stats(num_s
+0001f540: 6571 733d 3029 220a 0a20 2020 2064 6566  eqs=0)"..    def
+0001f550: 2063 6f6c 6c65 6374 2873 656c 662c 2064   collect(self, d
+0001f560: 6174 6129 3a0a 2020 2020 2020 2020 2222  ata):.        ""
+0001f570: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+0001f580: 206e 756d 7079 2e6e 6461 7272 6179 7c6c   numpy.ndarray|l
+0001f590: 6973 745b 696e 745d 7c6c 6973 745b 666c  ist[int]|list[fl
+0001f5a0: 6f61 745d 2064 6174 613a 2073 6861 7065  oat] data: shape
+0001f5b0: 2028 7469 6d65 2c20 6469 6d29 206f 7220   (time, dim) or 
+0001f5c0: 2874 696d 652c 290a 2020 2020 2020 2020  (time,).        
+0001f5d0: 2222 220a 2020 2020 2020 2020 696d 706f  """.        impo
+0001f5e0: 7274 206e 756d 7079 0a0a 2020 2020 2020  rt numpy..      
+0001f5f0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001f600: 6461 7461 2c20 286c 6973 742c 2074 7570  data, (list, tup
+0001f610: 6c65 2929 3a0a 2020 2020 2020 2020 2020  le)):.          
+0001f620: 2020 6461 7461 203d 206e 756d 7079 2e61    data = numpy.a
+0001f630: 7272 6179 2864 6174 6129 0a20 2020 2020  rray(data).     
+0001f640: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
+0001f650: 616e 6365 2864 6174 612c 206e 756d 7079  ance(data, numpy
+0001f660: 2e6e 6461 7272 6179 290a 2020 2020 2020  .ndarray).      
+0001f670: 2020 6173 7365 7274 2064 6174 612e 6e64    assert data.nd
+0001f680: 696d 203e 3d20 310a 2020 2020 2020 2020  im >= 1.        
+0001f690: 6966 2064 6174 612e 7368 6170 655b 305d  if data.shape[0]
+0001f6a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0001f6b0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001f6c0: 2020 7365 6c66 2e6e 756d 5f73 6571 7320    self.num_seqs 
+0001f6d0: 2b3d 2031 0a20 2020 2020 2020 2064 6174  += 1.        dat
+0001f6e0: 615f 6d69 6e20 3d20 6e75 6d70 792e 6d69  a_min = numpy.mi
+0001f6f0: 6e28 6461 7461 2c20 6178 6973 3d30 290a  n(data, axis=0).
+0001f700: 2020 2020 2020 2020 6461 7461 5f6d 6178          data_max
+0001f710: 203d 206e 756d 7079 2e6d 6178 2864 6174   = numpy.max(dat
+0001f720: 612c 2061 7869 733d 3029 0a20 2020 2020  a, axis=0).     
+0001f730: 2020 2069 6620 7365 6c66 2e6d 696e 2069     if self.min i
+0001f740: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001f750: 2020 2020 7365 6c66 2e6d 696e 203d 2064      self.min = d
+0001f760: 6174 615f 6d69 6e0a 2020 2020 2020 2020  ata_min.        
+0001f770: 2020 2020 7365 6c66 2e6d 6178 203d 2064      self.max = d
+0001f780: 6174 615f 6d61 780a 2020 2020 2020 2020  ata_max.        
+0001f790: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001f7a0: 2020 7365 6c66 2e6d 696e 203d 206e 756d    self.min = num
+0001f7b0: 7079 2e6d 696e 696d 756d 2873 656c 662e  py.minimum(self.
+0001f7c0: 6d69 6e2c 2064 6174 615f 6d69 6e29 0a20  min, data_min). 
+0001f7d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001f7e0: 6d61 7820 3d20 6e75 6d70 792e 6d61 7869  max = numpy.maxi
+0001f7f0: 6d75 6d28 7365 6c66 2e6d 6178 2c20 6461  mum(self.max, da
+0001f800: 7461 5f6d 6178 290a 2020 2020 2020 2020  ta_max).        
+0001f810: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
+0001f820: 656e 203d 2073 656c 662e 746f 7461 6c5f  en = self.total_
+0001f830: 6461 7461 5f6c 656e 202b 2064 6174 612e  data_len + data.
+0001f840: 7368 6170 655b 305d 0a20 2020 2020 2020  shape[0].       
+0001f850: 206d 6561 6e5f 6469 6666 203d 206e 756d   mean_diff = num
+0001f860: 7079 2e6d 6561 6e28 6461 7461 2c20 6178  py.mean(data, ax
+0001f870: 6973 3d30 2920 2d20 7365 6c66 2e6d 6561  is=0) - self.mea
+0001f880: 6e0a 2020 2020 2020 2020 6d5f 6120 3d20  n.        m_a = 
+0001f890: 7365 6c66 2e76 6172 202a 2073 656c 662e  self.var * self.
+0001f8a0: 746f 7461 6c5f 6461 7461 5f6c 656e 0a20  total_data_len. 
+0001f8b0: 2020 2020 2020 206d 5f62 203d 206e 756d         m_b = num
+0001f8c0: 7079 2e76 6172 2864 6174 612c 2061 7869  py.var(data, axi
+0001f8d0: 733d 3029 202a 2064 6174 612e 7368 6170  s=0) * data.shap
+0001f8e0: 655b 305d 0a20 2020 2020 2020 206d 3220  e[0].        m2 
+0001f8f0: 3d20 6d5f 6120 2b20 6d5f 6220 2b20 6d65  = m_a + m_b + me
+0001f900: 616e 5f64 6966 662a 2a32 202a 2073 656c  an_diff**2 * sel
+0001f910: 662e 746f 7461 6c5f 6461 7461 5f6c 656e  f.total_data_len
+0001f920: 202a 2064 6174 612e 7368 6170 655b 305d   * data.shape[0]
+0001f930: 202f 206e 6577 5f74 6f74 616c 5f64 6174   / new_total_dat
+0001f940: 615f 6c65 6e0a 2020 2020 2020 2020 7365  a_len.        se
+0001f950: 6c66 2e76 6172 203d 206d 3220 2f20 6e65  lf.var = m2 / ne
+0001f960: 775f 746f 7461 6c5f 6461 7461 5f6c 656e  w_total_data_len
+0001f970: 0a20 2020 2020 2020 2064 6174 615f 7375  .        data_su
+0001f980: 6d20 3d20 6e75 6d70 792e 7375 6d28 6461  m = numpy.sum(da
+0001f990: 7461 2c20 6178 6973 3d30 290a 2020 2020  ta, axis=0).    
+0001f9a0: 2020 2020 6465 6c74 6120 3d20 6461 7461      delta = data
+0001f9b0: 5f73 756d 202d 2073 656c 662e 6d65 616e  _sum - self.mean
+0001f9c0: 202a 2064 6174 612e 7368 6170 655b 305d   * data.shape[0]
+0001f9d0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
+0001f9e0: 616e 202b 3d20 6465 6c74 6120 2f20 6e65  an += delta / ne
+0001f9f0: 775f 746f 7461 6c5f 6461 7461 5f6c 656e  w_total_data_len
+0001fa00: 0a20 2020 2020 2020 2064 656c 7461 5f73  .        delta_s
+0001fa10: 7120 3d20 6e75 6d70 792e 7375 6d28 6461  q = numpy.sum(da
+0001fa20: 7461 202a 2064 6174 612c 2061 7869 733d  ta * data, axis=
+0001fa30: 3029 202d 2073 656c 662e 6d65 616e 5f73  0) - self.mean_s
+0001fa40: 7120 2a20 6461 7461 2e73 6861 7065 5b30  q * data.shape[0
+0001fa50: 5d0a 2020 2020 2020 2020 7365 6c66 2e6d  ].        self.m
+0001fa60: 6561 6e5f 7371 202b 3d20 6465 6c74 615f  ean_sq += delta_
+0001fa70: 7371 202f 206e 6577 5f74 6f74 616c 5f64  sq / new_total_d
+0001fa80: 6174 615f 6c65 6e0a 2020 2020 2020 2020  ata_len.        
+0001fa90: 7365 6c66 2e74 6f74 616c 5f64 6174 615f  self.total_data_
+0001faa0: 6c65 6e20 3d20 6e65 775f 746f 7461 6c5f  len = new_total_
+0001fab0: 6461 7461 5f6c 656e 0a0a 2020 2020 6465  data_len..    de
+0001fac0: 6620 6765 745f 6d65 616e 2873 656c 6629  f get_mean(self)
+0001fad0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001fae0: 2020 2020 2020 3a72 6574 7572 6e3a 206d        :return: m
+0001faf0: 6561 6e2c 2073 6861 7065 2028 6469 6d2c  ean, shape (dim,
+0001fb00: 290a 2020 2020 2020 2020 3a72 7479 7065  ).        :rtype
+0001fb10: 3a20 6e75 6d70 792e 6e64 6172 7261 790a  : numpy.ndarray.
+0001fb20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001fb30: 2020 2020 6173 7365 7274 2073 656c 662e      assert self.
+0001fb40: 6e75 6d5f 7365 7173 203e 2030 0a20 2020  num_seqs > 0.   
+0001fb50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001fb60: 2e6d 6561 6e0a 0a20 2020 2064 6566 2067  .mean..    def g
+0001fb70: 6574 5f73 7464 5f64 6576 2873 656c 6629  et_std_dev(self)
+0001fb80: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001fb90: 2020 2020 2020 3a72 6574 7572 6e3a 2073        :return: s
+0001fba0: 7464 2064 6576 2c20 7368 6170 6520 2864  td dev, shape (d
+0001fbb0: 696d 2c29 0a20 2020 2020 2020 203a 7274  im,).        :rt
+0001fbc0: 7970 653a 206e 756d 7079 2e6e 6461 7272  ype: numpy.ndarr
+0001fbd0: 6179 0a20 2020 2020 2020 2022 2222 0a20  ay.        """. 
+0001fbe0: 2020 2020 2020 2069 6d70 6f72 7420 6e75         import nu
+0001fbf0: 6d70 790a 0a20 2020 2020 2020 2061 7373  mpy..        ass
+0001fc00: 6572 7420 7365 6c66 2e6e 756d 5f73 6571  ert self.num_seq
+0001fc10: 7320 3e20 300a 2020 2020 2020 2020 7265  s > 0.        re
+0001fc20: 7475 726e 206e 756d 7079 2e73 7172 7428  turn numpy.sqrt(
+0001fc30: 7365 6c66 2e76 6172 290a 2020 2020 2020  self.var).      
+0001fc40: 2020 2320 7265 7475 726e 206e 756d 7079    # return numpy
+0001fc50: 2e73 7172 7428 7365 6c66 2e6d 6561 6e5f  .sqrt(self.mean_
+0001fc60: 7371 202d 2073 656c 662e 6d65 616e 202a  sq - self.mean *
+0001fc70: 2073 656c 662e 6d65 616e 290a 0a20 2020   self.mean)..   
+0001fc80: 2064 6566 2064 756d 7028 7365 6c66 2c20   def dump(self, 
+0001fc90: 6f75 7470 7574 5f66 696c 655f 7072 6566  output_file_pref
+0001fca0: 6978 3d4e 6f6e 652c 2073 7472 6561 6d3d  ix=None, stream=
+0001fcb0: 4e6f 6e65 2c20 7374 7265 616d 5f70 7265  None, stream_pre
+0001fcc0: 6669 783d 2222 293a 0a20 2020 2020 2020  fix=""):.       
+0001fcd0: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
+0001fce0: 7261 6d20 7374 727c 4e6f 6e65 206f 7574  ram str|None out
+0001fcf0: 7075 745f 6669 6c65 5f70 7265 6669 783a  put_file_prefix:
+0001fd00: 2069 6620 6769 7665 6e2c 2077 696c 6c20   if given, will 
+0001fd10: 6e75 6d70 792e 7361 7665 7478 7420 6d65  numpy.savetxt me
+0001fd20: 616e 7c73 7464 5f64 6576 2074 6f20 6469  an|std_dev to di
+0001fd30: 736b 0a20 2020 2020 2020 203a 7061 7261  sk.        :para
+0001fd40: 6d20 7374 7220 7374 7265 616d 5f70 7265  m str stream_pre
+0001fd50: 6669 783a 0a20 2020 2020 2020 203a 7061  fix:.        :pa
+0001fd60: 7261 6d20 696f 2e54 6578 7449 4f42 6173  ram io.TextIOBas
+0001fd70: 6520 7374 7265 616d 3a20 7379 732e 7374  e stream: sys.st
+0001fd80: 646f 7574 2062 7920 6465 6661 756c 740a  dout by default.
+0001fd90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001fda0: 2020 2020 6966 2073 7472 6561 6d20 6973      if stream is
+0001fdb0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001fdc0: 2020 2073 7472 6561 6d20 3d20 7379 732e     stream = sys.
+0001fdd0: 7374 646f 7574 0a20 2020 2020 2020 2069  stdout.        i
+0001fde0: 6d70 6f72 7420 6e75 6d70 790a 0a20 2020  mport numpy..   
+0001fdf0: 2020 2020 2070 7269 6e74 2822 2573 5374       print("%sSt
+0001fe00: 6174 733a 2220 2520 7374 7265 616d 5f70  ats:" % stream_p
+0001fe10: 7265 6669 782c 2066 696c 653d 7374 7265  refix, file=stre
+0001fe20: 616d 290a 2020 2020 2020 2020 6966 2073  am).        if s
+0001fe30: 656c 662e 6e75 6d5f 7365 7173 2021 3d20  elf.num_seqs != 
+0001fe40: 7365 6c66 2e74 6f74 616c 5f64 6174 615f  self.total_data_
+0001fe50: 6c65 6e3a 0a20 2020 2020 2020 2020 2020  len:.           
+0001fe60: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+0001fe70: 2020 2020 2020 2020 2220 2025 6920 7365          "  %i se
+0001fe80: 7173 2c20 2569 2074 6f74 616c 2066 7261  qs, %i total fra
+0001fe90: 6d65 732c 2025 6620 6176 6572 6167 6520  mes, %f average 
+0001fea0: 6672 616d 6573 220a 2020 2020 2020 2020  frames".        
+0001feb0: 2020 2020 2020 2020 2520 2873 656c 662e          % (self.
+0001fec0: 6e75 6d5f 7365 7173 2c20 7365 6c66 2e74  num_seqs, self.t
+0001fed0: 6f74 616c 5f64 6174 615f 6c65 6e2c 2073  otal_data_len, s
+0001fee0: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
+0001fef0: 656e 202f 2066 6c6f 6174 2873 656c 662e  en / float(self.
+0001ff00: 6e75 6d5f 7365 7173 2929 2c0a 2020 2020  num_seqs)),.    
+0001ff10: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0001ff20: 3d73 7472 6561 6d2c 0a20 2020 2020 2020  =stream,.       
+0001ff30: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+0001ff40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001ff50: 2070 7269 6e74 2822 2020 2569 2073 6571   print("  %i seq
+0001ff60: 7322 2025 2028 7365 6c66 2e6e 756d 5f73  s" % (self.num_s
+0001ff70: 6571 732c 292c 2066 696c 653d 7374 7265  eqs,), file=stre
+0001ff80: 616d 290a 2020 2020 2020 2020 7072 696e  am).        prin
+0001ff90: 7428 2220 204d 6561 6e3a 2025 7322 2025  t("  Mean: %s" %
+0001ffa0: 2028 7365 6c66 2e66 6f72 6d61 745f 7374   (self.format_st
+0001ffb0: 7228 7365 6c66 2e67 6574 5f6d 6561 6e28  r(self.get_mean(
+0001ffc0: 2929 2c29 2c20 6669 6c65 3d73 7472 6561  )),), file=strea
+0001ffd0: 6d29 0a20 2020 2020 2020 2070 7269 6e74  m).        print
+0001ffe0: 2822 2020 5374 6420 6465 763a 2025 7322  ("  Std dev: %s"
+0001fff0: 2025 2028 7365 6c66 2e66 6f72 6d61 745f   % (self.format_
+00020000: 7374 7228 7365 6c66 2e67 6574 5f73 7464  str(self.get_std
+00020010: 5f64 6576 2829 292c 292c 2066 696c 653d  _dev()),), file=
+00020020: 7374 7265 616d 290a 2020 2020 2020 2020  stream).        
+00020030: 7072 696e 7428 2220 204d 696e 2f6d 6178  print("  Min/max
+00020040: 3a20 2573 202f 2025 7322 2025 2028 7365  : %s / %s" % (se
+00020050: 6c66 2e66 6f72 6d61 745f 7374 7228 7365  lf.format_str(se
+00020060: 6c66 2e6d 696e 292c 2073 656c 662e 666f  lf.min), self.fo
+00020070: 726d 6174 5f73 7472 2873 656c 662e 6d61  rmat_str(self.ma
+00020080: 7829 292c 2066 696c 653d 7374 7265 616d  x)), file=stream
+00020090: 290a 2020 2020 2020 2020 2320 7072 696e  ).        # prin
+000200a0: 7428 2253 7464 2064 6576 2028 6e61 6976  t("Std dev (naiv
+000200b0: 6529 3a20 2573 2220 2520 6e75 6d70 792e  e): %s" % numpy.
+000200c0: 7371 7274 2873 656c 662e 6d65 616e 5f73  sqrt(self.mean_s
+000200d0: 7120 2d20 7365 6c66 2e6d 6561 6e20 2a20  q - self.mean * 
+000200e0: 7365 6c66 2e6d 6561 6e29 2c20 6669 6c65  self.mean), file
+000200f0: 3d73 7472 6561 6d29 0a20 2020 2020 2020  =stream).       
+00020100: 2069 6620 6f75 7470 7574 5f66 696c 655f   if output_file_
+00020110: 7072 6566 6978 3a0a 2020 2020 2020 2020  prefix:.        
+00020120: 2020 2020 7072 696e 7428 2220 2057 7269      print("  Wri
+00020130: 7465 206d 6561 6e2f 7374 642d 6465 7620  te mean/std-dev 
+00020140: 746f 2025 732e 286d 6561 6e7c 7374 645f  to %s.(mean|std_
+00020150: 6465 7629 2e74 7874 2e22 2025 2028 6f75  dev).txt." % (ou
+00020160: 7470 7574 5f66 696c 655f 7072 6566 6978  tput_file_prefix
+00020170: 2c29 2c20 6669 6c65 3d73 7472 6561 6d29  ,), file=stream)
+00020180: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+00020190: 7079 2e73 6176 6574 7874 2822 2573 2e6d  py.savetxt("%s.m
+000201a0: 6561 6e2e 7478 7422 2025 206f 7574 7075  ean.txt" % outpu
+000201b0: 745f 6669 6c65 5f70 7265 6669 782c 2073  t_file_prefix, s
+000201c0: 656c 662e 6765 745f 6d65 616e 2829 290a  elf.get_mean()).
+000201d0: 2020 2020 2020 2020 2020 2020 6e75 6d70              nump
+000201e0: 792e 7361 7665 7478 7428 2225 732e 7374  y.savetxt("%s.st
+000201f0: 645f 6465 762e 7478 7422 2025 206f 7574  d_dev.txt" % out
+00020200: 7075 745f 6669 6c65 5f70 7265 6669 782c  put_file_prefix,
+00020210: 2073 656c 662e 6765 745f 7374 645f 6465   self.get_std_de
+00020220: 7628 2929 0a0a 0a64 6566 2069 735f 6e61  v())...def is_na
+00020230: 6d65 6474 7570 6c65 2863 6c73 293a 0a20  medtuple(cls):. 
+00020240: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+00020250: 6d20 5420 636c 733a 2074 7570 6c65 2c20  m T cls: tuple, 
+00020260: 6c69 7374 206f 7220 6e61 6d65 6474 7570  list or namedtup
+00020270: 6c65 2074 7970 650a 2020 2020 3a72 6574  le type.    :ret
+00020280: 7572 6e3a 2077 6865 7468 6572 2063 6c73  urn: whether cls
+00020290: 2069 7320 6120 6e61 6d65 6474 7570 6c65   is a namedtuple
+000202a0: 2074 7970 650a 2020 2020 3a72 7479 7065   type.    :rtype
+000202b0: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
+000202c0: 2020 2072 6574 7572 6e20 6973 7375 6263     return issubc
+000202d0: 6c61 7373 2863 6c73 2c20 7475 706c 6529  lass(cls, tuple)
+000202e0: 2061 6e64 2063 6c73 2069 7320 6e6f 7420   and cls is not 
+000202f0: 7475 706c 650a 0a0a 6465 6620 6d61 6b65  tuple...def make
+00020300: 5f73 6571 5f6f 665f 7479 7065 2863 6c73  _seq_of_type(cls
+00020310: 2c20 7365 7129 3a0a 2020 2020 2222 220a  , seq):.    """.
+00020320: 2020 2020 3a70 6172 616d 2074 7970 655b      :param type[
+00020330: 545d 2063 6c73 3a20 652e 672e 2074 7570  T] cls: e.g. tup
+00020340: 6c65 2c20 6c69 7374 206f 7220 6e61 6d65  le, list or name
+00020350: 6474 7570 6c65 0a20 2020 203a 7061 7261  dtuple.    :para
+00020360: 6d20 6c69 7374 7c74 7570 6c65 7c54 2073  m list|tuple|T s
+00020370: 6571 3a0a 2020 2020 3a72 6574 7572 6e3a  eq:.    :return:
+00020380: 2063 6c73 2873 6571 2920 6f72 2063 6c73   cls(seq) or cls
+00020390: 282a 7365 7129 0a20 2020 203a 7274 7970  (*seq).    :rtyp
+000203a0: 653a 2054 7c6c 6973 747c 7475 706c 650a  e: T|list|tuple.
+000203b0: 2020 2020 2222 220a 2020 2020 6173 7365      """.    asse
+000203c0: 7274 2069 7373 7562 636c 6173 7328 636c  rt issubclass(cl
+000203d0: 732c 2028 6c69 7374 2c20 7475 706c 6529  s, (list, tuple)
+000203e0: 290a 2020 2020 6966 2069 735f 6e61 6d65  ).    if is_name
+000203f0: 6474 7570 6c65 2863 6c73 293a 0a20 2020  dtuple(cls):.   
+00020400: 2020 2020 2072 6574 7572 6e20 636c 7328       return cls(
+00020410: 2a73 6571 2920 2023 206e 6f71 610a 2020  *seq)  # noqa.  
+00020420: 2020 7265 7475 726e 2063 6c73 2873 6571    return cls(seq
+00020430: 2920 2023 206e 6f71 610a 0a0a 6465 6620  )  # noqa...def 
+00020440: 656e 7375 7265 5f6c 6973 745f 6f66 5f74  ensure_list_of_t
+00020450: 7970 6528 6c73 2c20 7479 7065 5f29 3a0a  ype(ls, type_):.
+00020460: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+00020470: 616d 206c 6973 7420 6c73 3a0a 2020 2020  am list ls:.    
+00020480: 3a70 6172 616d 2028 2829 2d3e 5429 7c74  :param (()->T)|t
+00020490: 7970 655b 545d 2074 7970 655f 3a20 7479  ype[T] type_: ty
+000204a0: 7065 206f 6620 696e 7374 616e 6365 7320  pe of instances 
+000204b0: 6f66 2060 6c73 602e 0a20 2020 2020 204e  of `ls`..      N
+000204c0: 6f74 6520 7468 6520 7374 7261 6e67 6520  ote the strange 
+000204d0: 7479 7065 2068 6572 6520 696e 2074 6865  type here in the
+000204e0: 2064 6f63 7374 7269 6e67 2069 7320 6475   docstring is du
+000204f0: 6520 746f 2073 6f6d 6520 5079 4368 6172  e to some PyChar
+00020500: 6d20 7479 7065 2069 6e66 6572 656e 6365  m type inference
+00020510: 2070 726f 626c 656d 730a 2020 2020 2020   problems.      
+00020520: 2868 7474 7073 3a2f 2f79 6f75 7472 6163  (https://youtrac
+00020530: 6b2e 6a65 7462 7261 696e 732e 636f 6d2f  k.jetbrains.com/
+00020540: 6973 7375 652f 5059 2d35 3038 3238 292e  issue/PY-50828).
+00020550: 0a20 2020 203a 7274 7970 653a 206c 6973  .    :rtype: lis
+00020560: 745b 545d 0a20 2020 2022 2222 0a20 2020  t[T].    """.   
+00020570: 2061 7373 6572 7420 616c 6c28 6973 696e   assert all(isin
+00020580: 7374 616e 6365 2865 6c65 6d2c 2074 7970  stance(elem, typ
+00020590: 655f 2920 666f 7220 656c 656d 2069 6e20  e_) for elem in 
+000205a0: 6c73 290a 2020 2020 7265 7475 726e 206c  ls).    return l
+000205b0: 730a 0a0a 4063 6f6e 7465 7874 6c69 622e  s...@contextlib.
+000205c0: 636f 6e74 6578 746d 616e 6167 6572 0a64  contextmanager.d
+000205d0: 6566 2064 756d 6d79 5f6e 6f6f 705f 6374  ef dummy_noop_ct
+000205e0: 7828 293a 0a20 2020 2022 2222 0a20 2020  x():.    """.   
+000205f0: 2050 726f 7669 6465 7320 6120 6e6f 2d6f   Provides a no-o
+00020600: 7020 636f 6e74 6578 7420 6d61 6e61 6765  p context manage
+00020610: 722e 0a20 2020 2022 2222 0a20 2020 2079  r..    """.    y
+00020620: 6965 6c64 204e 6f6e 650a 0a0a 6465 6620  ield None...def 
+00020630: 5f67 6574 5f6e 6772 616d 7328 7365 676d  _get_ngrams(segm
+00020640: 656e 742c 206d 6178 5f6f 7264 6572 293a  ent, max_order):
+00020650: 0a20 2020 2022 2222 4578 7472 6163 7473  .    """Extracts
+00020660: 2061 6c6c 206e 2d67 7261 6d73 2075 7074   all n-grams upt
+00020670: 6f20 6120 6769 7665 6e20 6d61 7869 6d75  o a given maximu
+00020680: 6d20 6f72 6465 7220 6672 6f6d 2061 6e20  m order from an 
+00020690: 696e 7075 7420 7365 676d 656e 742e 0a20  input segment.. 
+000206a0: 2020 2043 6f64 6520 6164 6170 7465 6420     Code adapted 
+000206b0: 6672 6f6d 2047 6f6f 676c 6520 5465 6e73  from Google Tens
+000206c0: 6f72 3254 656e 736f 722e 0a0a 2020 2020  or2Tensor...    
+000206d0: 4172 6773 3a0a 2020 2020 2020 7365 676d  Args:.      segm
+000206e0: 656e 7420 286c 6973 745b 696e 745d 7c6c  ent (list[int]|l
+000206f0: 6973 745b 7374 725d 293a 2074 6578 7420  ist[str]): text 
+00020700: 7365 676d 656e 7420 6672 6f6d 2077 6869  segment from whi
+00020710: 6368 206e 2d67 7261 6d73 2077 696c 6c20  ch n-grams will 
+00020720: 6265 2065 7874 7261 6374 6564 2e0a 2020  be extracted..  
+00020730: 2020 2020 6d61 785f 6f72 6465 7220 2869      max_order (i
+00020740: 6e74 293a 206d 6178 696d 756d 206c 656e  nt): maximum len
+00020750: 6774 6820 696e 2074 6f6b 656e 7320 6f66  gth in tokens of
+00020760: 2074 6865 206e 2d67 7261 6d73 2072 6574   the n-grams ret
+00020770: 7572 6e65 6420 6279 2074 6869 730a 2020  urned by this.  
+00020780: 2020 2020 2020 2020 6d65 7468 6f64 732e          methods.
+00020790: 0a0a 2020 2020 5265 7475 726e 733a 0a20  ..    Returns:. 
+000207a0: 2020 2020 2054 6865 2043 6f75 6e74 6572       The Counter
+000207b0: 2063 6f6e 7461 696e 696e 6720 616c 6c20   containing all 
+000207c0: 6e2d 6772 616d 7320 7570 746f 206d 6178  n-grams upto max
+000207d0: 5f6f 7264 6572 2069 6e20 7365 676d 656e  _order in segmen
+000207e0: 740a 2020 2020 2020 7769 7468 2061 2063  t.      with a c
+000207f0: 6f75 6e74 206f 6620 686f 7720 6d61 6e79  ount of how many
+00020800: 2074 696d 6573 2065 6163 6820 6e2d 6772   times each n-gr
+00020810: 616d 206f 6363 7572 7265 642e 0a20 2020  am occurred..   
+00020820: 2022 2222 0a20 2020 2069 6d70 6f72 7420   """.    import 
+00020830: 636f 6c6c 6563 7469 6f6e 730a 0a20 2020  collections..   
+00020840: 206e 6772 616d 5f63 6f75 6e74 7320 3d20   ngram_counts = 
+00020850: 636f 6c6c 6563 7469 6f6e 732e 436f 756e  collections.Coun
+00020860: 7465 7228 290a 2020 2020 666f 7220 6f72  ter().    for or
+00020870: 6465 7220 696e 2072 616e 6765 2831 2c20  der in range(1, 
+00020880: 6d61 785f 6f72 6465 7220 2b20 3129 3a0a  max_order + 1):.
+00020890: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000208a0: 2072 616e 6765 2830 2c20 6c65 6e28 7365   range(0, len(se
+000208b0: 676d 656e 7429 202d 206f 7264 6572 202b  gment) - order +
+000208c0: 2031 293a 0a20 2020 2020 2020 2020 2020   1):.           
+000208d0: 206e 6772 616d 203d 2074 7570 6c65 2873   ngram = tuple(s
+000208e0: 6567 6d65 6e74 5b69 203a 2069 202b 206f  egment[i : i + o
+000208f0: 7264 6572 5d29 0a20 2020 2020 2020 2020  rder]).         
+00020900: 2020 206e 6772 616d 5f63 6f75 6e74 735b     ngram_counts[
+00020910: 6e67 7261 6d5d 202b 3d20 310a 2020 2020  ngram] += 1.    
+00020920: 7265 7475 726e 206e 6772 616d 5f63 6f75  return ngram_cou
+00020930: 6e74 730a 0a0a 6465 6620 636f 6d70 7574  nts...def comput
+00020940: 655f 626c 6575 2872 6566 6572 656e 6365  e_bleu(reference
+00020950: 5f63 6f72 7075 732c 2074 7261 6e73 6c61  _corpus, transla
+00020960: 7469 6f6e 5f63 6f72 7075 732c 206d 6178  tion_corpus, max
+00020970: 5f6f 7264 6572 3d34 2c20 7573 655f 6270  _order=4, use_bp
+00020980: 3d54 7275 6529 3a0a 2020 2020 2222 2243  =True):.    """C
+00020990: 6f6d 7075 7465 7320 424c 4555 2073 636f  omputes BLEU sco
+000209a0: 7265 206f 6620 7472 616e 736c 6174 6564  re of translated
+000209b0: 2073 6567 6d65 6e74 7320 6167 6169 6e73   segments agains
+000209c0: 7420 6f6e 6520 6f72 206d 6f72 6520 7265  t one or more re
+000209d0: 6665 7265 6e63 6573 2e0a 2020 2020 436f  ferences..    Co
+000209e0: 6465 2061 6461 7074 6564 2066 726f 6d20  de adapted from 
+000209f0: 476f 6f67 6c65 2054 656e 736f 7232 5465  Google Tensor2Te
+00020a00: 6e73 6f72 2e0a 0a20 2020 2041 7267 733a  nsor...    Args:
+00020a10: 0a20 2020 2020 2072 6566 6572 656e 6365  .      reference
+00020a20: 5f63 6f72 7075 7320 286c 6973 745b 6c69  _corpus (list[li
+00020a30: 7374 5b69 6e74 5d7c 6c69 7374 5b73 7472  st[int]|list[str
+00020a40: 5d5d 293a 206c 6973 7420 6f66 2072 6566  ]]): list of ref
+00020a50: 6572 656e 6365 7320 666f 7220 6561 6368  erences for each
+00020a60: 2074 7261 6e73 6c61 7469 6f6e 2e20 4561   translation. Ea
+00020a70: 6368 0a20 2020 2020 2020 2020 2072 6566  ch.          ref
+00020a80: 6572 656e 6365 2073 686f 756c 6420 6265  erence should be
+00020a90: 2074 6f6b 656e 697a 6564 2069 6e74 6f20   tokenized into 
+00020aa0: 6120 6c69 7374 206f 6620 746f 6b65 6e73  a list of tokens
+00020ab0: 2e0a 2020 2020 2020 7472 616e 736c 6174  ..      translat
+00020ac0: 696f 6e5f 636f 7270 7573 2028 6c69 7374  ion_corpus (list
+00020ad0: 5b6c 6973 745b 696e 745d 7c6c 6973 745b  [list[int]|list[
+00020ae0: 7374 725d 5d29 3a20 6c69 7374 206f 6620  str]]): list of 
+00020af0: 7472 616e 736c 6174 696f 6e73 2074 6f20  translations to 
+00020b00: 7363 6f72 652e 2045 6163 6820 7472 616e  score. Each tran
+00020b10: 736c 6174 696f 6e0a 2020 2020 2020 2020  slation.        
+00020b20: 2020 7368 6f75 6c64 2062 6520 746f 6b65    should be toke
+00020b30: 6e69 7a65 6420 696e 746f 2061 206c 6973  nized into a lis
+00020b40: 7420 6f66 2074 6f6b 656e 732e 0a20 2020  t of tokens..   
+00020b50: 2020 206d 6178 5f6f 7264 6572 2028 696e     max_order (in
+00020b60: 7429 3a20 4d61 7869 6d75 6d20 6e2d 6772  t): Maximum n-gr
+00020b70: 616d 206f 7264 6572 2074 6f20 7573 6520  am order to use 
+00020b80: 7768 656e 2063 6f6d 7075 7469 6e67 2042  when computing B
+00020b90: 4c45 5520 7363 6f72 652e 0a20 2020 2020  LEU score..     
+00020ba0: 2075 7365 5f62 7020 2862 6f6f 6c29 3a20   use_bp (bool): 
+00020bb0: 626f 6f6c 6561 6e2c 2077 6865 7468 6572  boolean, whether
+00020bc0: 2074 6f20 6170 706c 7920 6272 6576 6974   to apply brevit
+00020bd0: 7920 7065 6e61 6c74 792e 0a0a 2020 2020  y penalty...    
+00020be0: 5265 7475 726e 733a 0a20 2020 2020 2042  Returns:.      B
+00020bf0: 4c45 5520 7363 6f72 652e 0a20 2020 2022  LEU score..    "
+00020c00: 2222 0a20 2020 2069 6d70 6f72 7420 6d61  "".    import ma
+00020c10: 7468 0a0a 2020 2020 7265 6665 7265 6e63  th..    referenc
+00020c20: 655f 6c65 6e67 7468 203d 2030 0a20 2020  e_length = 0.   
+00020c30: 2074 7261 6e73 6c61 7469 6f6e 5f6c 656e   translation_len
+00020c40: 6774 6820 3d20 300a 2020 2020 6270 203d  gth = 0.    bp =
+00020c50: 2031 2e30 0a20 2020 2067 656f 5f6d 6561   1.0.    geo_mea
+00020c60: 6e20 3d20 300a 0a20 2020 206d 6174 6368  n = 0..    match
+00020c70: 6573 5f62 795f 6f72 6465 7220 3d20 5b30  es_by_order = [0
+00020c80: 5d20 2a20 6d61 785f 6f72 6465 720a 2020  ] * max_order.  
+00020c90: 2020 706f 7373 6962 6c65 5f6d 6174 6368    possible_match
+00020ca0: 6573 5f62 795f 6f72 6465 7220 3d20 5b30  es_by_order = [0
+00020cb0: 5d20 2a20 6d61 785f 6f72 6465 720a 0a20  ] * max_order.. 
+00020cc0: 2020 2066 6f72 2028 7265 6665 7265 6e63     for (referenc
+00020cd0: 6573 2c20 7472 616e 736c 6174 696f 6e73  es, translations
+00020ce0: 2920 696e 207a 6970 2872 6566 6572 656e  ) in zip(referen
+00020cf0: 6365 5f63 6f72 7075 732c 2074 7261 6e73  ce_corpus, trans
+00020d00: 6c61 7469 6f6e 5f63 6f72 7075 7329 3a0a  lation_corpus):.
+00020d10: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+00020d20: 655f 6c65 6e67 7468 202b 3d20 6c65 6e28  e_length += len(
+00020d30: 7265 6665 7265 6e63 6573 290a 2020 2020  references).    
+00020d40: 2020 2020 7472 616e 736c 6174 696f 6e5f      translation_
+00020d50: 6c65 6e67 7468 202b 3d20 6c65 6e28 7472  length += len(tr
+00020d60: 616e 736c 6174 696f 6e73 290a 2020 2020  anslations).    
+00020d70: 2020 2020 7265 665f 6e67 7261 6d5f 636f      ref_ngram_co
+00020d80: 756e 7473 203d 205f 6765 745f 6e67 7261  unts = _get_ngra
+00020d90: 6d73 2872 6566 6572 656e 6365 732c 206d  ms(references, m
+00020da0: 6178 5f6f 7264 6572 290a 2020 2020 2020  ax_order).      
+00020db0: 2020 7472 616e 736c 6174 696f 6e5f 6e67    translation_ng
+00020dc0: 7261 6d5f 636f 756e 7473 203d 205f 6765  ram_counts = _ge
+00020dd0: 745f 6e67 7261 6d73 2874 7261 6e73 6c61  t_ngrams(transla
+00020de0: 7469 6f6e 732c 206d 6178 5f6f 7264 6572  tions, max_order
+00020df0: 290a 0a20 2020 2020 2020 206f 7665 726c  )..        overl
+00020e00: 6170 203d 207b 6e67 7261 6d3a 206d 696e  ap = {ngram: min
+00020e10: 2863 6f75 6e74 2c20 7472 616e 736c 6174  (count, translat
+00020e20: 696f 6e5f 6e67 7261 6d5f 636f 756e 7473  ion_ngram_counts
+00020e30: 5b6e 6772 616d 5d29 2066 6f72 206e 6772  [ngram]) for ngr
+00020e40: 616d 2c20 636f 756e 7420 696e 2072 6566  am, count in ref
+00020e50: 5f6e 6772 616d 5f63 6f75 6e74 732e 6974  _ngram_counts.it
+00020e60: 656d 7328 297d 0a0a 2020 2020 2020 2020  ems()}..        
+00020e70: 666f 7220 6e67 7261 6d20 696e 206f 7665  for ngram in ove
+00020e80: 726c 6170 3a0a 2020 2020 2020 2020 2020  rlap:.          
+00020e90: 2020 6d61 7463 6865 735f 6279 5f6f 7264    matches_by_ord
+00020ea0: 6572 5b6c 656e 286e 6772 616d 2920 2d20  er[len(ngram) - 
+00020eb0: 315d 202b 3d20 6f76 6572 6c61 705b 6e67  1] += overlap[ng
+00020ec0: 7261 6d5d 0a20 2020 2020 2020 2066 6f72  ram].        for
+00020ed0: 206e 6772 616d 2069 6e20 7472 616e 736c   ngram in transl
+00020ee0: 6174 696f 6e5f 6e67 7261 6d5f 636f 756e  ation_ngram_coun
+00020ef0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00020f00: 706f 7373 6962 6c65 5f6d 6174 6368 6573  possible_matches
+00020f10: 5f62 795f 6f72 6465 725b 6c65 6e28 6e67  _by_order[len(ng
+00020f20: 7261 6d29 202d 2031 5d20 2b3d 2074 7261  ram) - 1] += tra
+00020f30: 6e73 6c61 7469 6f6e 5f6e 6772 616d 5f63  nslation_ngram_c
+00020f40: 6f75 6e74 735b 6e67 7261 6d5d 0a0a 2020  ounts[ngram]..  
+00020f50: 2020 7072 6563 6973 696f 6e73 203d 205b    precisions = [
+00020f60: 302e 305d 202a 206d 6178 5f6f 7264 6572  0.0] * max_order
+00020f70: 0a20 2020 2073 6d6f 6f74 6820 3d20 312e  .    smooth = 1.
+00020f80: 300a 2020 2020 666f 7220 6920 696e 2072  0.    for i in r
+00020f90: 616e 6765 2830 2c20 6d61 785f 6f72 6465  ange(0, max_orde
+00020fa0: 7229 3a0a 2020 2020 2020 2020 6966 2070  r):.        if p
+00020fb0: 6f73 7369 626c 655f 6d61 7463 6865 735f  ossible_matches_
+00020fc0: 6279 5f6f 7264 6572 5b69 5d20 3e20 303a  by_order[i] > 0:
+00020fd0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00020fe0: 6369 7369 6f6e 735b 695d 203d 206d 6174  cisions[i] = mat
+00020ff0: 6368 6573 5f62 795f 6f72 6465 725b 695d  ches_by_order[i]
+00021000: 202f 2070 6f73 7369 626c 655f 6d61 7463   / possible_matc
+00021010: 6865 735f 6279 5f6f 7264 6572 5b69 5d0a  hes_by_order[i].
+00021020: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00021030: 6174 6368 6573 5f62 795f 6f72 6465 725b  atches_by_order[
+00021040: 695d 203e 2030 3a0a 2020 2020 2020 2020  i] > 0:.        
+00021050: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
+00021060: 6e73 5b69 5d20 3d20 6d61 7463 6865 735f  ns[i] = matches_
+00021070: 6279 5f6f 7264 6572 5b69 5d20 2f20 706f  by_order[i] / po
+00021080: 7373 6962 6c65 5f6d 6174 6368 6573 5f62  ssible_matches_b
+00021090: 795f 6f72 6465 725b 695d 0a20 2020 2020  y_order[i].     
+000210a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000210b0: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
+000210c0: 6f74 6820 2a3d 2032 0a20 2020 2020 2020  oth *= 2.       
+000210d0: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
+000210e0: 6f6e 735b 695d 203d 2031 2e30 202f 2028  ons[i] = 1.0 / (
+000210f0: 736d 6f6f 7468 202a 2070 6f73 7369 626c  smooth * possibl
+00021100: 655f 6d61 7463 6865 735f 6279 5f6f 7264  e_matches_by_ord
+00021110: 6572 5b69 5d29 0a20 2020 2020 2020 2065  er[i]).        e
+00021120: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00021130: 2070 7265 6369 7369 6f6e 735b 695d 203d   precisions[i] =
+00021140: 2030 2e30 0a0a 2020 2020 6966 206d 6178   0.0..    if max
+00021150: 2870 7265 6369 7369 6f6e 7329 203e 2030  (precisions) > 0
+00021160: 3a0a 2020 2020 2020 2020 705f 6c6f 675f  :.        p_log_
+00021170: 7375 6d20 3d20 7375 6d28 6d61 7468 2e6c  sum = sum(math.l
+00021180: 6f67 2870 2920 666f 7220 7020 696e 2070  og(p) for p in p
+00021190: 7265 6369 7369 6f6e 7320 6966 2070 290a  recisions if p).
+000211a0: 2020 2020 2020 2020 6765 6f5f 6d65 616e          geo_mean
+000211b0: 203d 206d 6174 682e 6578 7028 705f 6c6f   = math.exp(p_lo
+000211c0: 675f 7375 6d20 2f20 6d61 785f 6f72 6465  g_sum / max_orde
+000211d0: 7229 0a0a 2020 2020 6966 2075 7365 5f62  r)..    if use_b
+000211e0: 703a 0a20 2020 2020 2020 2072 6174 696f  p:.        ratio
+000211f0: 203d 2074 7261 6e73 6c61 7469 6f6e 5f6c   = translation_l
+00021200: 656e 6774 6820 2f20 7265 6665 7265 6e63  ength / referenc
+00021210: 655f 6c65 6e67 7468 0a20 2020 2020 2020  e_length.       
+00021220: 2069 6620 7261 7469 6f20 3c20 3165 2d33   if ratio < 1e-3
+00021230: 303a 0a20 2020 2020 2020 2020 2020 2062  0:.            b
+00021240: 7020 3d20 302e 300a 2020 2020 2020 2020  p = 0.0.        
+00021250: 656c 6966 2072 6174 696f 203c 2031 2e30  elif ratio < 1.0
+00021260: 3a0a 2020 2020 2020 2020 2020 2020 6270  :.            bp
+00021270: 203d 206d 6174 682e 6578 7028 3120 2d20   = math.exp(1 - 
+00021280: 312e 3020 2f20 7261 7469 6f29 0a20 2020  1.0 / ratio).   
+00021290: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000212a0: 2020 2020 2020 2062 7020 3d20 312e 300a         bp = 1.0.
+000212b0: 2020 2020 626c 6575 203d 2067 656f 5f6d      bleu = geo_m
+000212c0: 6561 6e20 2a20 6270 0a20 2020 2072 6574  ean * bp.    ret
+000212d0: 7572 6e20 6e70 2e66 6c6f 6174 3332 2862  urn np.float32(b
+000212e0: 6c65 7529 0a0a 0a23 206e 6f69 6e73 7065  leu)...# noinspe
+000212f0: 6374 696f 6e20 5079 5061 636b 6167 6552  ction PyPackageR
+00021300: 6571 7569 7265 6d65 6e74 730a 6465 6620  equirements.def 
+00021310: 6d6f 6e6b 6579 6669 785f 676c 6962 2829  monkeyfix_glib()
+00021320: 3a0a 2020 2020 2222 220a 2020 2020 4669  :.    """.    Fi
+00021330: 7865 7320 736f 6d65 2073 7475 7069 6420  xes some stupid 
+00021340: 6275 6773 2073 7563 6820 7468 6174 2053  bugs such that S
+00021350: 4947 494e 5420 6973 206e 6f74 2077 6f72  IGINT is not wor
+00021360: 6b69 6e67 2e0a 2020 2020 5468 6973 2069  king..    This i
+00021370: 7320 7573 6564 2062 7920 6175 6469 6f72  s used by audior
+00021380: 6561 642c 2061 6e64 2069 6e64 6972 6563  ead, and indirec
+00021390: 746c 7920 6279 206c 6962 726f 7361 2066  tly by librosa f
+000213a0: 6f72 206c 6f61 6469 6e67 2061 7564 696f  or loading audio
+000213b0: 2e0a 2020 2020 6874 7470 733a 2f2f 7374  ..    https://st
+000213c0: 6163 6b6f 7665 7266 6c6f 772e 636f 6d2f  ackoverflow.com/
+000213d0: 7175 6573 7469 6f6e 732f 3136 3431 3038  questions/164108
+000213e0: 3532 2f0a 2020 2020 5365 6520 616c 736f  52/.    See also
+000213f0: 203a 6675 6e63 3a60 6d6f 6e6b 6579 7061   :func:`monkeypa
+00021400: 7463 685f 6175 6469 6f72 6561 6460 2e0a  tch_audioread`..
+00021410: 2020 2020 2222 220a 2020 2020 7472 793a      """.    try:
+00021420: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00021430: 6769 0a20 2020 2065 7863 6570 7420 496d  gi.    except Im
+00021440: 706f 7274 4572 726f 723a 0a20 2020 2020  portError:.     
+00021450: 2020 2072 6574 7572 6e0a 2020 2020 7472     return.    tr
+00021460: 793a 0a20 2020 2020 2020 2066 726f 6d20  y:.        from 
+00021470: 6769 2e72 6570 6f73 6974 6f72 7920 696d  gi.repository im
+00021480: 706f 7274 2047 4c69 620a 2020 2020 6578  port GLib.    ex
+00021490: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
+000214a0: 3a0a 2020 2020 2020 2020 2320 6e6f 696e  :.        # noin
+000214b0: 7370 6563 7469 6f6e 2050 7955 6e72 6573  spection PyUnres
+000214c0: 6f6c 7665 6452 6566 6572 656e 6365 730a  olvedReferences.
+000214d0: 2020 2020 2020 2020 6672 6f6d 2067 692e          from gi.
+000214e0: 6f76 6572 7269 6465 7320 696d 706f 7274  overrides import
+000214f0: 2047 4c69 620a 2020 2020 2320 446f 206e   GLib.    # Do n
+00021500: 6f74 6869 6e67 2e0a 2020 2020 2320 5468  othing..    # Th
+00021510: 6520 6f72 6967 696e 616c 2062 6568 6176  e original behav
+00021520: 696f 7220 776f 756c 6420 696e 7374 616c  ior would instal
+00021530: 6c20 6120 5349 4749 4e54 2068 616e 646c  l a SIGINT handl
+00021540: 6572 2077 6869 6368 2063 616c 6c73 2047  er which calls G
+00021550: 4c69 622e 4d61 696e 4c6f 6f70 2e71 7569  Lib.MainLoop.qui
+00021560: 7428 292c 0a20 2020 2023 2061 6e64 2074  t(),.    # and t
+00021570: 6865 6e20 7265 7261 6973 6520 6120 4b65  hen reraise a Ke
+00021580: 7962 6f61 7264 496e 7465 7272 7570 7420  yboardInterrupt 
+00021590: 696e 2074 6861 7420 7468 7265 6164 2e0a  in that thread..
+000215a0: 2020 2020 2320 486f 7765 7665 722c 2077      # However, w
+000215b0: 6520 7761 6e74 2061 6e64 2065 7870 6563  e want and expec
+000215c0: 7420 746f 2067 6574 2074 6865 204b 6579  t to get the Key
+000215d0: 626f 6172 6449 6e74 6572 7275 7074 2069  boardInterrupt i
+000215e0: 6e20 7468 6520 6d61 696e 2074 6872 6561  n the main threa
+000215f0: 642e 0a20 2020 2047 4c69 622e 4d61 696e  d..    GLib.Main
+00021600: 4c6f 6f70 2e5f 5f69 6e69 745f 5f20 3d20  Loop.__init__ = 
+00021610: 6c61 6d62 6461 202a 6172 6773 2c20 2a2a  lambda *args, **
+00021620: 6b77 6172 6773 3a20 4e6f 6e65 0a0a 0a64  kwargs: None...d
+00021630: 6566 206d 6f6e 6b65 7970 6174 6368 5f61  ef monkeypatch_a
+00021640: 7564 696f 7265 6164 2829 3a0a 2020 2020  udioread():.    
+00021650: 2222 220a 2020 2020 6175 6469 6f72 6561  """.    audiorea
+00021660: 6420 646f 6573 206e 6f74 2062 6568 6176  d does not behav
+00021670: 6520 6f70 7469 6d61 6c20 696e 2073 6f6d  e optimal in som
+00021680: 6520 6361 7365 732e 0a20 2020 2045 2e67  e cases..    E.g
+00021690: 2e20 6561 6368 2063 616c 6c20 746f 205f  . each call to _
+000216a0: 6361 5f61 7661 696c 6162 6c65 2829 2074  ca_available() t
+000216b0: 616b 6573 2071 7569 7465 206c 6f6e 6720  akes quite long 
+000216c0: 6265 6361 7573 6520 6f66 2074 6865 2063  because of the c
+000216d0: 7479 7065 732e 7574 696c 2e66 696e 645f  types.util.find_
+000216e0: 6c69 6272 6172 7920 7573 6167 652e 0a20  library usage.. 
+000216f0: 2020 2057 6520 7769 6c6c 2070 6174 6368     We will patch
+00021700: 2074 6869 732e 0a0a 2020 2020 486f 7765   this...    Howe
+00021710: 7665 722c 2074 6865 2072 6563 6f6d 6d65  ver, the recomme
+00021720: 6e64 6174 696f 6e20 776f 756c 6420 6265  ndation would be
+00021730: 2074 6f20 6e6f 7420 7573 6520 6175 6469   to not use audi
+00021740: 6f72 6561 6420 286c 6962 726f 7361 2e6c  oread (librosa.l
+00021750: 6f61 6429 2e0a 2020 2020 6175 6469 6f72  oad)..    audior
+00021760: 6561 6420 7573 6573 2047 7374 7265 616d  ead uses Gstream
+00021770: 6572 2061 7320 6120 6261 636b 656e 6420  er as a backend 
+00021780: 6279 2064 6566 6175 6c74 2063 7572 7265  by default curre
+00021790: 6e74 6c79 2028 6f6e 204c 696e 7578 292e  ntly (on Linux).
+000217a0: 0a20 2020 2047 7374 7265 616d 6572 2068  .    Gstreamer h
+000217b0: 6173 206d 756c 7469 706c 6520 6973 7375  as multiple issu
+000217c0: 6573 2e20 5365 6520 616c 736f 203a 6675  es. See also :fu
+000217d0: 6e63 3a60 6d6f 6e6b 6579 6669 785f 676c  nc:`monkeyfix_gl
+000217e0: 6962 602c 2061 6e64 2068 6572 6520 666f  ib`, and here fo
+000217f0: 7220 6469 7363 7573 7369 6f6e 3a0a 2020  r discussion:.  
+00021800: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
+00021810: 2e63 6f6d 2f62 6565 7462 6f78 2f61 7564  .com/beetbox/aud
+00021820: 696f 7265 6164 2f69 7373 7565 732f 3632  ioread/issues/62
+00021830: 0a20 2020 2068 7474 7073 3a2f 2f67 6974  .    https://git
+00021840: 6875 622e 636f 6d2f 6265 6574 626f 782f  hub.com/beetbox/
+00021850: 6175 6469 6f72 6561 642f 6973 7375 6573  audioread/issues
+00021860: 2f36 330a 0a20 2020 2049 6e73 7465 6164  /63..    Instead
+00021870: 2c20 7573 6520 5079 536f 756e 6446 696c  , use PySoundFil
+00021880: 652c 2077 6869 6368 2069 7320 616c 736f  e, which is also
+00021890: 2066 6173 7465 722e 2053 6565 2068 6572   faster. See her
+000218a0: 6520 666f 7220 6469 7363 7573 7369 6f6e  e for discussion
+000218b0: 733a 0a20 2020 2068 7474 7073 3a2f 2f67  s:.    https://g
+000218c0: 6974 6875 622e 636f 6d2f 6265 6574 626f  ithub.com/beetbo
+000218d0: 782f 6175 6469 6f72 6561 642f 6973 7375  x/audioread/issu
+000218e0: 6573 2f36 340a 2020 2020 6874 7470 733a  es/64.    https:
+000218f0: 2f2f 6769 7468 7562 2e63 6f6d 2f6c 6962  //github.com/lib
+00021900: 726f 7361 2f6c 6962 726f 7361 2f69 7373  rosa/librosa/iss
+00021910: 7565 732f 3638 310a 2020 2020 2222 220a  ues/681.    """.
+00021920: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00021930: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
+00021940: 5079 5061 636b 6167 6552 6571 7569 7265  PyPackageRequire
+00021950: 6d65 6e74 730a 2020 2020 2020 2020 696d  ments.        im
+00021960: 706f 7274 2061 7564 696f 7265 6164 0a20  port audioread. 
+00021970: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
+00021980: 4572 726f 723a 0a20 2020 2020 2020 2072  Error:.        r
+00021990: 6574 7572 6e0a 2020 2020 2320 6e6f 696e  eturn.    # noin
+000219a0: 7370 6563 7469 6f6e 2050 7950 726f 7465  spection PyProte
+000219b0: 6374 6564 4d65 6d62 6572 0a20 2020 2072  ctedMember.    r
+000219c0: 6573 203d 2061 7564 696f 7265 6164 2e5f  es = audioread._
+000219d0: 6361 5f61 7661 696c 6162 6c65 2829 0a20  ca_available(). 
+000219e0: 2020 2061 7564 696f 7265 6164 2e5f 6361     audioread._ca
+000219f0: 5f61 7661 696c 6162 6c65 203d 206c 616d  _available = lam
+00021a00: 6264 613a 2072 6573 0a0a 0a5f 6366 5f63  bda: res..._cf_c
+00021a10: 6163 6865 203d 207b 7d0a 5f63 665f 6d73  ache = {}._cf_ms
+00021a20: 675f 7072 696e 7465 6420 3d20 4661 6c73  g_printed = Fals
+00021a30: 650a 0a0a 6465 6620 6366 2866 696c 656e  e...def cf(filen
+00021a40: 616d 6529 3a0a 2020 2020 2222 220a 2020  ame):.    """.  
+00021a50: 2020 4361 6368 6520 6d61 6e61 6765 722e    Cache manager.
+00021a60: 2069 3620 7370 6563 6966 6963 2e0a 0a20   i6 specific... 
+00021a70: 2020 203a 7265 7475 726e 3a20 6669 6c65     :return: file
+00021a80: 6e61 6d65 0a20 2020 203a 7274 7970 653a  name.    :rtype:
+00021a90: 2073 7472 0a20 2020 2022 2222 0a20 2020   str.    """.   
+00021aa0: 2067 6c6f 6261 6c20 5f63 665f 6d73 675f   global _cf_msg_
+00021ab0: 7072 696e 7465 640a 2020 2020 696d 706f  printed.    impo
+00021ac0: 7274 206f 730a 2020 2020 6672 6f6d 2073  rt os.    from s
+00021ad0: 7562 7072 6f63 6573 7320 696d 706f 7274  ubprocess import
+00021ae0: 2063 6865 636b 5f6f 7574 7075 740a 0a20   check_output.. 
+00021af0: 2020 2069 6620 6669 6c65 6e61 6d65 2069     if filename i
+00021b00: 6e20 5f63 665f 6361 6368 653a 0a20 2020  n _cf_cache:.   
+00021b10: 2020 2020 2072 6574 7572 6e20 5f63 665f       return _cf_
+00021b20: 6361 6368 655b 6669 6c65 6e61 6d65 5d0a  cache[filename].
+00021b30: 2020 2020 6465 6275 675f 6d6f 6465 203d      debug_mode =
+00021b40: 2069 6e74 286f 732e 656e 7669 726f 6e2e   int(os.environ.
+00021b50: 6765 7428 2244 4542 5547 222c 2030 2929  get("DEBUG", 0))
+00021b60: 0a20 2020 2069 6620 6465 6275 675f 6d6f  .    if debug_mo
+00021b70: 6465 206f 7220 6765 745f 686f 7374 6e61  de or get_hostna
+00021b80: 6d65 2829 203d 3d20 2263 6c75 7374 6572  me() == "cluster
+00021b90: 2d63 6e2d 3231 3122 206f 7220 6e6f 7420  -cn-211" or not 
+00021ba0: 6973 5f72 756e 6e69 6e67 5f6f 6e5f 636c  is_running_on_cl
+00021bb0: 7573 7465 7228 293a 0a20 2020 2020 2020  uster():.       
+00021bc0: 2069 6620 6e6f 7420 5f63 665f 6d73 675f   if not _cf_msg_
+00021bd0: 7072 696e 7465 643a 0a20 2020 2020 2020  printed:.       
+00021be0: 2020 2020 2070 7269 6e74 2822 4361 6368       print("Cach
+00021bf0: 6520 6d61 6e61 6765 723a 206e 6f74 2075  e manager: not u
+00021c00: 7365 642c 2075 7365 206c 6f63 616c 2066  sed, use local f
+00021c10: 696c 653a 2025 7320 2864 6973 6361 7264  ile: %s (discard
+00021c20: 2066 7572 7468 6572 206d 6573 7361 6765   further message
+00021c30: 7329 2220 2520 6669 6c65 6e61 6d65 290a  s)" % filename).
+00021c40: 2020 2020 2020 2020 2020 2020 5f63 665f              _cf_
+00021c50: 6d73 675f 7072 696e 7465 6420 3d20 5472  msg_printed = Tr
+00021c60: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+00021c70: 6e20 6669 6c65 6e61 6d65 2020 2320 666f  n filename  # fo
+00021c80: 7220 6465 6275 6767 696e 670a 2020 2020  r debugging.    
+00021c90: 7472 793a 0a20 2020 2020 2020 2063 6163  try:.        cac
+00021ca0: 6865 645f 666e 203d 2063 6865 636b 5f6f  hed_fn = check_o
+00021cb0: 7574 7075 7428 5b22 6366 222c 2066 696c  utput(["cf", fil
+00021cc0: 656e 616d 655d 292e 7374 7269 7028 292e  ename]).strip().
+00021cd0: 6465 636f 6465 2822 7574 6638 2229 0a20  decode("utf8"). 
+00021ce0: 2020 2065 7863 6570 7420 4361 6c6c 6564     except Called
+00021cf0: 5072 6f63 6573 7345 7272 6f72 3a0a 2020  ProcessError:.  
+00021d00: 2020 2020 2020 6966 206e 6f74 205f 6366        if not _cf
+00021d10: 5f6d 7367 5f70 7269 6e74 6564 3a0a 2020  _msg_printed:.  
+00021d20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00021d30: 2243 6163 6865 206d 616e 6167 6572 3a20  "Cache manager: 
+00021d40: 4572 726f 7220 6f63 6375 7272 6564 2c20  Error occurred, 
+00021d50: 7573 696e 6720 6c6f 6361 6c20 6669 6c65  using local file
+00021d60: 2229 0a20 2020 2020 2020 2020 2020 205f  ").            _
+00021d70: 6366 5f6d 7367 5f70 7269 6e74 6564 203d  cf_msg_printed =
+00021d80: 2054 7275 650a 2020 2020 2020 2020 7265   True.        re
+00021d90: 7475 726e 2066 696c 656e 616d 650a 2020  turn filename.  
+00021da0: 2020 6173 7365 7274 206f 732e 7061 7468    assert os.path
+00021db0: 2e65 7869 7374 7328 6361 6368 6564 5f66  .exists(cached_f
+00021dc0: 6e29 0a20 2020 205f 6366 5f63 6163 6865  n).    _cf_cache
+00021dd0: 5b66 696c 656e 616d 655d 203d 2063 6163  [filename] = cac
+00021de0: 6865 645f 666e 0a20 2020 2072 6574 7572  hed_fn.    retur
+00021df0: 6e20 6361 6368 6564 5f66 6e0a 0a0a 6465  n cached_fn...de
+00021e00: 6620 6269 6e61 7279 5f73 6561 7263 685f  f binary_search_
+00021e10: 616e 7928 636d 702c 206c 6f77 2c20 6869  any(cmp, low, hi
+00021e20: 6768 293a 0a20 2020 2022 2222 0a20 2020  gh):.    """.   
+00021e30: 2042 696e 6172 7920 7365 6172 6368 2066   Binary search f
+00021e40: 6f72 2061 2063 7573 746f 6d20 636f 6d70  or a custom comp
+00021e50: 6172 6520 6675 6e63 7469 6f6e 2e0a 0a20  are function... 
+00021e60: 2020 203a 7061 7261 6d20 2869 6e74 292d     :param (int)-
+00021e70: 3e69 6e74 2063 6d70 3a20 652e 672e 2063  >int cmp: e.g. c
+00021e80: 6d70 2869 6478 2920 3d3d 2063 6f6d 7061  mp(idx) == compa
+00021e90: 7265 2861 7272 6179 5b69 6478 5d2c 206b  re(array[idx], k
+00021ea0: 6579 290a 2020 2020 3a70 6172 616d 2069  ey).    :param i
+00021eb0: 6e74 206c 6f77 3a20 696e 636c 7573 6976  nt low: inclusiv
+00021ec0: 650a 2020 2020 3a70 6172 616d 2069 6e74  e.    :param int
+00021ed0: 2068 6967 683a 2065 7863 6c75 7369 7665   high: exclusive
+00021ee0: 0a20 2020 203a 7274 7970 653a 2069 6e74  .    :rtype: int
+00021ef0: 7c4e 6f6e 650a 2020 2020 2222 220a 2020  |None.    """.  
+00021f00: 2020 7768 696c 6520 6c6f 7720 3c20 6869    while low < hi
+00021f10: 6768 3a0a 2020 2020 2020 2020 6d69 6420  gh:.        mid 
+00021f20: 3d20 286c 6f77 202b 2068 6967 6829 202f  = (low + high) /
+00021f30: 2f20 320a 2020 2020 2020 2020 7220 3d20  / 2.        r = 
+00021f40: 636d 7028 6d69 6429 0a20 2020 2020 2020  cmp(mid).       
+00021f50: 2069 6620 7220 3c20 303a 0a20 2020 2020   if r < 0:.     
+00021f60: 2020 2020 2020 206c 6f77 203d 206d 6964         low = mid
+00021f70: 202b 2031 0a20 2020 2020 2020 2065 6c69   + 1.        eli
+00021f80: 6620 7220 3e20 303a 0a20 2020 2020 2020  f r > 0:.       
+00021f90: 2020 2020 2068 6967 6820 3d20 6d69 640a       high = mid.
+00021fa0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00021fb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00021fc0: 206d 6964 0a20 2020 2072 6574 7572 6e20   mid.    return 
+00021fd0: 6c6f 770a 0a0a 6465 6620 6765 6e65 7269  low...def generi
+00021fe0: 635f 696d 706f 7274 5f6d 6f64 756c 6528  c_import_module(
+00021ff0: 6669 6c65 6e61 6d65 293a 0a20 2020 2022  filename):.    "
+00022000: 2222 0a20 2020 203a 7061 7261 6d20 7374  "".    :param st
+00022010: 7220 6669 6c65 6e61 6d65 3a0a 2020 2020  r filename:.    
+00022020: 2020 5765 2074 7279 2074 6f20 6265 2063    We try to be c
+00022030: 6c65 7665 7220 6162 6f75 7420 6669 6c65  lever about file
+00022040: 6e61 6d65 2e0a 2020 2020 2020 4966 2069  name..      If i
+00022050: 7420 6c6f 6f6b 7320 6c69 6b65 2061 206d  t looks like a m
+00022060: 6f64 756c 6520 6e61 6d65 2c20 6a75 7374  odule name, just
+00022070: 2064 6f20 696d 706f 7274 6c69 622e 696d   do importlib.im
+00022080: 706f 7274 5f6d 6f64 756c 652e 0a20 2020  port_module..   
+00022090: 2020 2049 6620 6974 206c 6f6f 6b73 206c     If it looks l
+000220a0: 696b 6520 6120 6669 6c65 6e61 6d65 2c20  ike a filename, 
+000220b0: 7365 6172 6368 2066 6f72 2061 2062 6173  search for a bas
+000220c0: 6520 7061 7468 2028 7768 6963 6820 646f  e path (which do
+000220d0: 6573 206e 6f74 2068 6176 6520 5f5f 696e  es not have __in
+000220e0: 6974 5f5f 2e70 7929 2c0a 2020 2020 2020  it__.py),.      
+000220f0: 6164 6420 7468 6174 2070 6174 6820 746f  add that path to
+00022100: 2073 7973 2e70 6174 6820 6966 206e 6565   sys.path if nee
+00022110: 6465 642c 2061 6e64 2069 6d70 6f72 7420  ded, and import 
+00022120: 7468 6520 7265 6d61 696e 696e 6720 7768  the remaining wh
+00022130: 6572 6520 222f 2220 6973 2072 6570 6c61  ere "/" is repla
+00022140: 6365 6420 6279 2022 2e22 0a20 2020 2020  ced by ".".     
+00022150: 2061 6e64 2074 6865 2066 696c 6520 6578   and the file ex
+00022160: 7465 6e73 696f 6e20 6973 2072 656d 6f76  tension is remov
+00022170: 6564 2e0a 2020 2020 3a72 6574 7572 6e3a  ed..    :return:
+00022180: 2074 6865 206d 6f64 756c 650a 2020 2020   the module.    
+00022190: 3a72 7479 7065 3a20 7479 7065 732e 4d6f  :rtype: types.Mo
+000221a0: 6475 6c65 5479 7065 0a20 2020 2022 2222  duleType.    """
+000221b0: 0a20 2020 2061 7373 6572 7420 6669 6c65  .    assert file
+000221c0: 6e61 6d65 0a20 2020 2069 6d70 6f72 7420  name.    import 
+000221d0: 696d 706f 7274 6c69 620a 0a20 2020 2069  importlib..    i
+000221e0: 6620 222f 2220 6e6f 7420 696e 2066 696c  f "/" not in fil
+000221f0: 656e 616d 653a 0a20 2020 2020 2020 2072  ename:.        r
+00022200: 6574 7572 6e20 696d 706f 7274 6c69 622e  eturn importlib.
+00022210: 696d 706f 7274 5f6d 6f64 756c 6528 6669  import_module(fi
+00022220: 6c65 6e61 6d65 290a 2020 2020 7072 6566  lename).    pref
+00022230: 6978 5f64 6972 203d 2022 220a 2020 2020  ix_dir = "".    
+00022240: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00022250: 7869 7374 7328 6669 6c65 6e61 6d65 293a  xists(filename):
+00022260: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00022270: 6669 6c65 6e61 6d65 5b30 5d20 213d 2022  filename[0] != "
+00022280: 2f22 0a20 2020 2020 2020 2023 204d 6179  /".        # May
+00022290: 6265 2072 656c 6174 6976 6520 746f 2052  be relative to R
+000222a0: 6574 7572 6e6e 3f0a 2020 2020 2020 2020  eturnn?.        
+000222b0: 7072 6566 6978 5f64 6972 203d 2022 2573  prefix_dir = "%s
+000222c0: 2f22 2025 2072 6574 7572 6e6e 5f72 6f6f  /" % returnn_roo
+000222d0: 745f 6469 720a 2020 2020 6173 7365 7274  t_dir.    assert
+000222e0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000222f0: 7072 6566 6978 5f64 6972 202b 2066 696c  prefix_dir + fil
+00022300: 656e 616d 6529 0a20 2020 2061 7373 6572  ename).    asser
+00022310: 7420 6669 6c65 6e61 6d65 2e65 6e64 7377  t filename.endsw
+00022320: 6974 6828 222e 7079 2229 206f 7220 6f73  ith(".py") or os
+00022330: 2e70 6174 682e 6973 6469 7228 7072 6566  .path.isdir(pref
+00022340: 6978 5f64 6972 202b 2066 696c 656e 616d  ix_dir + filenam
+00022350: 6529 0a20 2020 2064 6972 7320 3d20 6669  e).    dirs = fi
+00022360: 6c65 6e61 6d65 2e73 706c 6974 2822 2f22  lename.split("/"
+00022370: 290a 2020 2020 6469 7273 2c20 6261 7365  ).    dirs, base
+00022380: 5f66 6e20 3d20 6469 7273 5b3a 2d31 5d2c  _fn = dirs[:-1],
+00022390: 2064 6972 735b 2d31 5d0a 2020 2020 6173   dirs[-1].    as
+000223a0: 7365 7274 206c 656e 2864 6972 7329 203e  sert len(dirs) >
+000223b0: 3d20 310a 2020 2020 666f 7220 6920 696e  = 1.    for i in
+000223c0: 2072 6576 6572 7365 6428 7261 6e67 6528   reversed(range(
+000223d0: 6c65 6e28 6469 7273 2929 293a 0a20 2020  len(dirs))):.   
+000223e0: 2020 2020 2064 203d 2070 7265 6669 785f       d = prefix_
+000223f0: 6469 7220 2b20 222f 222e 6a6f 696e 2864  dir + "/".join(d
+00022400: 6972 735b 3a20 6920 2b20 315d 290a 2020  irs[: i + 1]).  
+00022410: 2020 2020 2020 6173 7365 7274 206f 732e        assert os.
+00022420: 7061 7468 2e69 7364 6972 2864 290a 2020  path.isdir(d).  
+00022430: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00022440: 2e65 7869 7374 7328 2225 732f 5f5f 696e  .exists("%s/__in
+00022450: 6974 5f5f 2e70 7922 2025 2064 293a 0a20  it__.py" % d):. 
+00022460: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00022470: 6e75 650a 2020 2020 2020 2020 6966 2064  nue.        if d
+00022480: 206e 6f74 2069 6e20 7379 732e 7061 7468   not in sys.path
+00022490: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+000224a0: 732e 7061 7468 2e61 7070 656e 6428 6429  s.path.append(d)
+000224b0: 0a20 2020 2020 2020 206d 203d 2022 2e22  .        m = "."
+000224c0: 2e6a 6f69 6e28 6469 7273 5b69 202b 2031  .join(dirs[i + 1
+000224d0: 203a 5d20 2b20 5b62 6173 655f 666e 5d29   :] + [base_fn])
+000224e0: 0a20 2020 2020 2020 2069 6620 6261 7365  .        if base
+000224f0: 5f66 6e2e 656e 6473 7769 7468 2822 2e70  _fn.endswith(".p
+00022500: 7922 293a 0a20 2020 2020 2020 2020 2020  y"):.           
+00022510: 206d 203d 206d 5b3a 2d33 5d0a 2020 2020   m = m[:-3].    
+00022520: 2020 2020 7265 7475 726e 2069 6d70 6f72      return impor
+00022530: 746c 6962 2e69 6d70 6f72 745f 6d6f 6475  tlib.import_modu
+00022540: 6c65 286d 290a 2020 2020 7261 6973 6520  le(m).    raise 
+00022550: 5661 6c75 6545 7272 6f72 2822 6361 6e6e  ValueError("cann
+00022560: 6f74 2066 6967 7572 6520 6f75 7420 6261  ot figure out ba
+00022570: 7365 206d 6f64 756c 6520 7061 7468 2066  se module path f
+00022580: 726f 6d20 2572 2220 2520 6669 6c65 6e61  rom %r" % filena
+00022590: 6d65 290a 0a0a 6465 6620 736f 6674 6d61  me)...def softma
+000225a0: 7828 782c 2061 7869 733d 4e6f 6e65 293a  x(x, axis=None):
+000225b0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+000225c0: 7261 6d20 6e75 6d70 792e 6e64 6172 7261  ram numpy.ndarra
+000225d0: 7920 783a 0a20 2020 203a 7061 7261 6d20  y x:.    :param 
+000225e0: 696e 747c 4e6f 6e65 2061 7869 733a 0a20  int|None axis:. 
+000225f0: 2020 203a 7274 7970 653a 206e 756d 7079     :rtype: numpy
+00022600: 2e6e 6461 7272 6179 0a20 2020 2022 2222  .ndarray.    """
+00022610: 0a20 2020 2069 6d70 6f72 7420 6e75 6d70  .    import nump
+00022620: 790a 0a20 2020 2065 5f78 203d 206e 756d  y..    e_x = num
+00022630: 7079 2e65 7870 2878 202d 206e 756d 7079  py.exp(x - numpy
+00022640: 2e6d 6178 2878 2c20 6178 6973 3d61 7869  .max(x, axis=axi
+00022650: 732c 206b 6565 7064 696d 733d 5472 7565  s, keepdims=True
+00022660: 2929 0a20 2020 2072 6574 7572 6e20 655f  )).    return e_
+00022670: 7820 2f20 6e75 6d70 792e 7375 6d28 655f  x / numpy.sum(e_
+00022680: 782c 2061 7869 733d 6178 6973 2c20 6b65  x, axis=axis, ke
+00022690: 6570 6469 6d73 3d54 7275 6529 0a0a 0a64  epdims=True)...d
+000226a0: 6566 2063 6f6c 6c65 6374 5f70 726f 635f  ef collect_proc_
+000226b0: 6d61 7073 5f65 7865 635f 6669 6c65 7328  maps_exec_files(
+000226c0: 293a 0a20 2020 2022 2222 0a20 2020 2043  ):.    """.    C
+000226d0: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
+000226e0: 726b 7320 6f6e 204c 696e 7578 2e2e 2e0a  rks on Linux....
+000226f0: 0a20 2020 203a 7265 7475 726e 3a20 6c69  .    :return: li
+00022700: 7374 206f 6620 6d61 7070 6564 2065 7865  st of mapped exe
+00022710: 6375 7461 626c 6573 2028 6c69 6273 290a  cutables (libs).
+00022720: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
+00022730: 5b73 7472 5d0a 2020 2020 2222 220a 2020  [str].    """.  
+00022740: 2020 696d 706f 7274 2072 650a 0a20 2020    import re..   
+00022750: 2070 6964 203d 206f 732e 6765 7470 6964   pid = os.getpid
+00022760: 2829 0a20 2020 2066 6e73 203d 205b 5d0a  ().    fns = [].
+00022770: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+00022780: 6f70 656e 2822 2f70 726f 632f 2569 2f6d  open("/proc/%i/m
+00022790: 6170 7322 2025 2070 6964 2c20 2272 2229  aps" % pid, "r")
+000227a0: 2e72 6561 6428 292e 7370 6c69 746c 696e  .read().splitlin
+000227b0: 6573 2829 3a20 2023 2066 6f72 2065 6163  es():  # for eac
+000227c0: 6820 6d61 7070 6564 2072 6567 696f 6e0a  h mapped region.
+000227d0: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
+000227e0: 2f2f 7374 6163 6b6f 7665 7266 6c6f 772e  //stackoverflow.
+000227f0: 636f 6d2f 7175 6573 7469 6f6e 732f 3134  com/questions/14
+00022800: 3031 3335 392f 756e 6465 7273 7461 6e64  01359/understand
+00022810: 696e 672d 6c69 6e75 782d 7072 6f63 2d69  ing-linux-proc-i
+00022820: 642d 6d61 7073 0a20 2020 2020 2020 2023  d-maps.        #
+00022830: 2061 6464 7265 7373 2020 2020 2020 2020   address        
+00022840: 2020 2070 6572 6d73 206f 6666 7365 7420     perms offset 
+00022850: 2064 6576 2020 2069 6e6f 6465 2020 2070   dev   inode   p
+00022860: 6174 686e 616d 650a 2020 2020 2020 2020  athname.        
+00022870: 2320 452e 672e 3a0a 2020 2020 2020 2020  # E.g.:.        
+00022880: 2320 3766 6632 6465 3931 6330 3030 2d37  # 7ff2de91c000-7
+00022890: 6666 3264 6539 3165 3030 3020 7277 2d70  ff2de91e000 rw-p
+000228a0: 2030 3031 3763 3030 3020 3038 3a30 3220   0017c000 08:02 
+000228b0: 3739 3438 3434 2020 2020 2020 2020 2020  794844          
+000228c0: 2020 2020 2020 2020 2020 202f 7573 722f             /usr/
+000228d0: 6c69 622f 7838 365f 3634 2d6c 696e 7578  lib/x86_64-linux
+000228e0: 2d67 6e75 2f6c 6962 7374 6463 2b2e 2e2e  -gnu/libstdc+...
+000228f0: 0a20 2020 2020 2020 206d 203d 2072 652e  .        m = re.
+00022900: 6d61 7463 6828 0a20 2020 2020 2020 2020  match(.         
+00022910: 2020 2072 225e 285b 302d 3941 2d46 612d     r"^([0-9A-Fa-
+00022920: 665d 2b29 2d28 5b30 2d39 412d 4661 2d66  f]+)-([0-9A-Fa-f
+00022930: 5d2b 295c 732b 285b 7277 7870 735c 2d5d  ]+)\s+([rwxps\-]
+00022940: 2b29 5c73 2b28 5b30 2d39 412d 4661 2d66  +)\s+([0-9A-Fa-f
+00022950: 5d2b 295c 732b 285b 302d 3941 2d46 612d  ]+)\s+([0-9A-Fa-
+00022960: 663a 5d2b 295c 732b 285b 302d 395d 2b29  f:]+)\s+([0-9]+)
+00022970: 5c73 2a28 2e2a 2924 222c 206c 696e 650a  \s*(.*)$", line.
+00022980: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022990: 2020 6173 7365 7274 206d 2c20 226e 6f20    assert m, "no 
+000229a0: 6d61 7463 6820 666f 7220 2572 2220 2520  match for %r" % 
+000229b0: 6c69 6e65 0a20 2020 2020 2020 2061 6464  line.        add
+000229c0: 7265 7373 5f73 7461 7274 2c20 6164 6472  ress_start, addr
+000229d0: 6573 735f 656e 642c 2070 6572 6d73 2c20  ess_end, perms, 
+000229e0: 6f66 6673 6574 2c20 6465 762c 2069 5f6e  offset, dev, i_n
+000229f0: 6f64 652c 2070 6174 685f 6e61 6d65 203d  ode, path_name =
+00022a00: 206d 2e67 726f 7570 7328 290a 2020 2020   m.groups().    
+00022a10: 2020 2020 6966 2022 7822 206e 6f74 2069      if "x" not i
+00022a20: 6e20 7065 726d 733a 0a20 2020 2020 2020  n perms:.       
+00022a30: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00022a40: 2020 2020 2020 6966 206e 6f74 2070 6174        if not pat
+00022a50: 685f 6e61 6d65 206f 7220 7061 7468 5f6e  h_name or path_n
+00022a60: 616d 652e 7374 6172 7473 7769 7468 2822  ame.startswith("
+00022a70: 5b22 2920 6f72 2022 2864 656c 6574 6564  [") or "(deleted
+00022a80: 2922 2069 6e20 7061 7468 5f6e 616d 653a  )" in path_name:
+00022a90: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00022aa0: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
+00022ab0: 2070 6174 685f 6e61 6d65 206e 6f74 2069   path_name not i
+00022ac0: 6e20 666e 733a 0a20 2020 2020 2020 2020  n fns:.         
+00022ad0: 2020 2066 6e73 2e61 7070 656e 6428 7061     fns.append(pa
+00022ae0: 7468 5f6e 616d 6529 0a20 2020 2072 6574  th_name).    ret
+00022af0: 7572 6e20 666e 730a 0a0a 6465 6620 6669  urn fns...def fi
+00022b00: 6e64 5f73 796d 5f69 6e5f 6578 6563 2866  nd_sym_in_exec(f
+00022b10: 6e2c 2073 796d 293a 0a20 2020 2022 2222  n, sym):.    """
+00022b20: 0a20 2020 2055 7365 7320 6060 6f62 6a64  .    Uses ``objd
+00022b30: 756d 7060 6020 746f 206c 6973 7420 6176  ump`` to list av
+00022b40: 6169 6c61 626c 6520 7379 6d62 6f6c 732c  ailable symbols,
+00022b50: 2061 6e64 2066 696c 7465 7273 2074 6865   and filters the
+00022b60: 6d20 6279 2074 6865 2067 6976 656e 2060  m by the given `
+00022b70: 6073 796d 6060 2e0a 0a20 2020 203a 7061  `sym``...    :pa
+00022b80: 7261 6d20 7374 7220 666e 3a20 7061 7468  ram str fn: path
+00022b90: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
+00022ba0: 7379 6d3a 0a20 2020 203a 7265 7475 726e  sym:.    :return
+00022bb0: 3a20 6d61 7463 6865 6420 6f75 742c 206f  : matched out, o
+00022bc0: 7220 4e6f 6e65 0a20 2020 203a 7274 7970  r None.    :rtyp
+00022bd0: 653a 2073 7472 7c4e 6f6e 650a 2020 2020  e: str|None.    
+00022be0: 2222 220a 2020 2020 6672 6f6d 2073 7562  """.    from sub
+00022bf0: 7072 6f63 6573 7320 696d 706f 7274 2043  process import C
+00022c00: 616c 6c65 6450 726f 6365 7373 4572 726f  alledProcessErro
+00022c10: 720a 0a20 2020 206f 626a 6475 6d70 203d  r..    objdump =
+00022c20: 2022 6f62 6a64 756d 7020 2d54 220a 2020   "objdump -T".  
+00022c30: 2020 6966 2073 7973 2e70 6c61 7466 6f72    if sys.platfor
+00022c40: 6d20 3d3d 2022 6461 7277 696e 223a 0a20  m == "darwin":. 
+00022c50: 2020 2020 2020 206f 626a 6475 6d70 203d         objdump =
+00022c60: 2022 6f74 6f6f 6c20 2d49 4847 7622 0a20   "otool -IHGv". 
+00022c70: 2020 2073 6865 6c6c 5f63 6d64 203d 2022     shell_cmd = "
+00022c80: 2573 2025 7320 7c20 6772 6570 2025 7322  %s %s | grep %s"
+00022c90: 2025 2028 6f62 6a64 756d 702c 2066 6e2c   % (objdump, fn,
+00022ca0: 2073 796d 290a 2020 2020 7472 793a 0a20   sym).    try:. 
+00022cb0: 2020 2020 2020 206f 7574 203d 2073 7973         out = sys
+00022cc0: 5f65 7865 635f 6f75 7428 7368 656c 6c5f  _exec_out(shell_
+00022cd0: 636d 642c 2073 6865 6c6c 3d54 7275 6529  cmd, shell=True)
+00022ce0: 0a20 2020 2065 7863 6570 7420 4361 6c6c  .    except Call
+00022cf0: 6564 5072 6f63 6573 7345 7272 6f72 3a20  edProcessError: 
+00022d00: 2023 206e 6f6e 6520 666f 756e 640a 2020   # none found.  
+00022d10: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00022d20: 650a 2020 2020 6173 7365 7274 2069 7369  e.    assert isi
+00022d30: 6e73 7461 6e63 6528 6f75 742c 2028 7374  nstance(out, (st
+00022d40: 722c 2075 6e69 636f 6465 2929 0a20 2020  r, unicode)).   
+00022d50: 206f 7574 5f6c 6e73 203d 206f 7574 2e73   out_lns = out.s
+00022d60: 706c 6974 6c69 6e65 7328 290a 2020 2020  plitlines().    
+00022d70: 6f75 745f 6c6e 7320 3d20 5b6c 6e20 666f  out_lns = [ln fo
+00022d80: 7220 6c6e 2069 6e20 6f75 745f 6c6e 7320  r ln in out_lns 
+00022d90: 6966 2022 2e74 6578 7422 2069 6e20 6c6e  if ".text" in ln
+00022da0: 5d20 2023 2073 6565 206f 626a 6475 6d70  ]  # see objdump
+00022db0: 0a20 2020 206f 7574 5f6c 6e73 203d 205b  .    out_lns = [
+00022dc0: 6c6e 2066 6f72 206c 6e20 696e 206f 7574  ln for ln in out
+00022dd0: 5f6c 6e73 2069 6620 7379 6d20 696e 206c  _lns if sym in l
+00022de0: 6e2e 7370 6c69 7428 295d 0a20 2020 2069  n.split()].    i
+00022df0: 6620 6e6f 7420 6f75 745f 6c6e 733a 0a20  f not out_lns:. 
+00022e00: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00022e10: 6e65 0a20 2020 2072 6574 7572 6e20 2246  ne.    return "F
+00022e20: 6f75 6e64 2025 7220 696e 2025 723a 5c6e  ound %r in %r:\n
+00022e30: 2573 2220 2520 2873 796d 2c20 666e 2c20  %s" % (sym, fn, 
+00022e40: 225c 6e22 2e6a 6f69 6e28 6f75 745f 6c6e  "\n".join(out_ln
+00022e50: 7329 290a 0a0a 6465 6620 6475 6d6d 795f  s))...def dummy_
+00022e60: 6e75 6d70 795f 6765 6d6d 5f63 616c 6c28  numpy_gemm_call(
+00022e70: 293a 0a20 2020 2022 2222 0a20 2020 204a  ):.    """.    J
+00022e80: 7573 7420 7065 7266 6f72 6d73 2073 6f6d  ust performs som
+00022e90: 6520 4745 4d4d 2063 616c 6c20 7669 6120  e GEMM call via 
+00022ea0: 4e75 6d70 792e 0a20 2020 2054 6869 7320  Numpy..    This 
+00022eb0: 6d61 6b65 7320 7375 7265 2074 6861 7420  makes sure that 
+00022ec0: 7468 6520 424c 4153 206c 6962 7261 7279  the BLAS library
+00022ed0: 2069 7320 6c6f 6164 6564 2e0a 2020 2020   is loaded..    
+00022ee0: 2222 220a 2020 2020 696d 706f 7274 206e  """.    import n
+00022ef0: 756d 7079 0a0a 2020 2020 6120 3d20 6e75  umpy..    a = nu
+00022f00: 6d70 792e 7261 6e64 6f6d 2e72 616e 646e  mpy.random.randn
+00022f10: 2835 2c20 3329 2e61 7374 7970 6528 6e75  (5, 3).astype(nu
+00022f20: 6d70 792e 666c 6f61 7433 3229 0a20 2020  mpy.float32).   
+00022f30: 2062 203d 206e 756d 7079 2e72 616e 646f   b = numpy.rando
+00022f40: 6d2e 7261 6e64 6e28 332c 2037 292e 6173  m.randn(3, 7).as
+00022f50: 7479 7065 286e 756d 7079 2e66 6c6f 6174  type(numpy.float
+00022f60: 3332 290a 2020 2020 6320 3d20 6e75 6d70  32).    c = nump
+00022f70: 792e 646f 7428 612c 2062 290a 2020 2020  y.dot(a, b).    
+00022f80: 6173 7365 7274 206e 756d 7079 2e69 7366  assert numpy.isf
+00022f90: 696e 6974 6528 6329 2e61 6c6c 2829 0a0a  inite(c).all()..
+00022fa0: 0a5f 6669 6e64 5f73 6765 6d6d 5f6c 6962  ._find_sgemm_lib
+00022fb0: 5f66 726f 6d5f 7275 6e74 696d 655f 6361  _from_runtime_ca
+00022fc0: 6368 6564 203d 204e 6f6e 650a 0a0a 6465  ched = None...de
+00022fd0: 6620 6669 6e64 5f73 6765 6d6d 5f6c 6962  f find_sgemm_lib
+00022fe0: 735f 6672 6f6d 5f72 756e 7469 6d65 2829  s_from_runtime()
+00022ff0: 3a0a 2020 2020 2222 220a 2020 2020 4c6f  :.    """.    Lo
+00023000: 6f6b 7320 7468 726f 7567 6820 616c 6c20  oks through all 
+00023010: 6c69 6273 2076 6961 203a 6675 6e63 3a60  libs via :func:`
+00023020: 636f 6c6c 6563 745f 7072 6f63 5f6d 6170  collect_proc_map
+00023030: 735f 6578 6563 5f66 696c 6573 602c 0a20  s_exec_files`,. 
+00023040: 2020 2061 6e64 2073 6561 7263 6865 7320     and searches 
+00023050: 666f 7220 616c 6c20 7768 6963 6820 6861  for all which ha
+00023060: 7665 2074 6865 2060 6073 6765 6d6d 6060  ve the ``sgemm``
+00023070: 2073 796d 626f 6c2e 0a20 2020 2043 7572   symbol..    Cur
+00023080: 7265 6e74 6c79 206f 6e6c 7920 776f 726b  rently only work
+00023090: 7320 6f6e 204c 696e 7578 2028 6265 6361  s on Linux (beca
+000230a0: 7573 6520 636f 6c6c 6563 745f 7072 6f63  use collect_proc
+000230b0: 5f6d 6170 735f 6578 6563 5f66 696c 6573  _maps_exec_files
+000230c0: 292e 0a0a 2020 2020 3a72 6574 7572 6e3a  )...    :return:
+000230d0: 206c 6973 7420 6f66 206c 6962 7320 2874   list of libs (t
+000230e0: 6865 6972 2070 6174 6829 0a20 2020 203a  heir path).    :
+000230f0: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
+00023100: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00023110: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00023120: 7473 2822 2f70 726f 6322 293a 0a20 2020  ts("/proc"):.   
+00023130: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00023140: 0a20 2020 2067 6c6f 6261 6c20 5f66 696e  .    global _fin
+00023150: 645f 7367 656d 6d5f 6c69 625f 6672 6f6d  d_sgemm_lib_from
+00023160: 5f72 756e 7469 6d65 5f63 6163 6865 640a  _runtime_cached.
+00023170: 2020 2020 6966 205f 6669 6e64 5f73 6765      if _find_sge
+00023180: 6d6d 5f6c 6962 5f66 726f 6d5f 7275 6e74  mm_lib_from_runt
+00023190: 696d 655f 6361 6368 6564 2069 7320 6e6f  ime_cached is no
+000231a0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000231b0: 7265 7475 726e 205f 6669 6e64 5f73 6765  return _find_sge
+000231c0: 6d6d 5f6c 6962 5f66 726f 6d5f 7275 6e74  mm_lib_from_runt
+000231d0: 696d 655f 6361 6368 6564 0a20 2020 2064  ime_cached.    d
+000231e0: 756d 6d79 5f6e 756d 7079 5f67 656d 6d5f  ummy_numpy_gemm_
+000231f0: 6361 6c6c 2829 2020 2320 6d61 6b65 2073  call()  # make s
+00023200: 7572 6520 7468 6174 204e 756d 7079 2069  ure that Numpy i
+00023210: 7320 6c6f 6164 6564 2061 6e64 204e 756d  s loaded and Num
+00023220: 7079 2073 6765 6d6d 2069 7320 6176 6169  py sgemm is avai
+00023230: 6c61 626c 650a 2020 2020 666e 7320 3d20  lable.    fns = 
+00023240: 636f 6c6c 6563 745f 7072 6f63 5f6d 6170  collect_proc_map
+00023250: 735f 6578 6563 5f66 696c 6573 2829 0a20  s_exec_files(). 
+00023260: 2020 2066 6e73 5f77 6974 685f 7367 656d     fns_with_sgem
+00023270: 6d20 3d20 5b5d 0a20 2020 2066 6f72 2066  m = [].    for f
+00023280: 6e20 696e 2066 6e73 3a0a 2020 2020 2020  n in fns:.      
+00023290: 2020 6f75 7420 3d20 6669 6e64 5f73 796d    out = find_sym
+000232a0: 5f69 6e5f 6578 6563 2866 6e2c 2022 7367  _in_exec(fn, "sg
+000232b0: 656d 6d5f 2229 0a20 2020 2020 2020 2069  emm_").        i
+000232c0: 6620 6f75 743a 0a20 2020 2020 2020 2020  f out:.         
+000232d0: 2020 2066 6e73 5f77 6974 685f 7367 656d     fns_with_sgem
+000232e0: 6d2e 6170 7065 6e64 2866 6e29 0a20 2020  m.append(fn).   
+000232f0: 205f 6669 6e64 5f73 6765 6d6d 5f6c 6962   _find_sgemm_lib
+00023300: 5f66 726f 6d5f 7275 6e74 696d 655f 6361  _from_runtime_ca
+00023310: 6368 6564 203d 2066 6e73 5f77 6974 685f  ched = fns_with_
+00023320: 7367 656d 6d0a 2020 2020 7265 7475 726e  sgemm.    return
+00023330: 2066 6e73 5f77 6974 685f 7367 656d 6d0a   fns_with_sgemm.
+00023340: 0a0a 5f66 696e 645f 6c69 6263 7564 6172  .._find_libcudar
+00023350: 745f 6672 6f6d 5f72 756e 7469 6d65 5f63  t_from_runtime_c
+00023360: 6163 6865 6420 3d20 4e6f 6e65 0a0a 0a64  ached = None...d
+00023370: 6566 2066 696e 645f 6c69 6263 7564 6172  ef find_libcudar
+00023380: 745f 6672 6f6d 5f72 756e 7469 6d65 2829  t_from_runtime()
+00023390: 3a0a 2020 2020 2222 220a 2020 2020 4c6f  :.    """.    Lo
+000233a0: 6f6b 7320 7468 726f 7567 6820 616c 6c20  oks through all 
+000233b0: 6c69 6273 2076 6961 203a 6675 6e63 3a60  libs via :func:`
+000233c0: 636f 6c6c 6563 745f 7072 6f63 5f6d 6170  collect_proc_map
+000233d0: 735f 6578 6563 5f66 696c 6573 602c 0a20  s_exec_files`,. 
+000233e0: 2020 2061 6e64 2073 6561 7263 6865 7320     and searches 
+000233f0: 666f 7220 616c 6c20 7768 6963 6820 6861  for all which ha
+00023400: 7665 2074 6865 2060 6073 6765 6d6d 6060  ve the ``sgemm``
+00023410: 2073 796d 626f 6c2e 0a20 2020 2043 7572   symbol..    Cur
+00023420: 7265 6e74 6c79 206f 6e6c 7920 776f 726b  rently only work
+00023430: 7320 6f6e 204c 696e 7578 2028 6265 6361  s on Linux (beca
+00023440: 7573 6520 636f 6c6c 6563 745f 7072 6f63  use collect_proc
+00023450: 5f6d 6170 735f 6578 6563 5f66 696c 6573  _maps_exec_files
+00023460: 292e 0a0a 2020 2020 3a72 6574 7572 6e3a  )...    :return:
+00023470: 206c 6973 7420 6f66 206c 6962 7320 2874   list of libs (t
+00023480: 6865 6972 2070 6174 6829 0a20 2020 203a  heir path).    :
+00023490: 7274 7970 653a 2073 7472 7c4e 6f6e 650a  rtype: str|None.
+000234a0: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
+000234b0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+000234c0: 7328 222f 7072 6f63 2229 3a0a 2020 2020  s("/proc"):.    
+000234d0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+000234e0: 2020 2020 676c 6f62 616c 205f 6669 6e64      global _find
+000234f0: 5f6c 6962 6375 6461 7274 5f66 726f 6d5f  _libcudart_from_
+00023500: 7275 6e74 696d 655f 6361 6368 6564 0a20  runtime_cached. 
+00023510: 2020 2069 6620 5f66 696e 645f 6c69 6263     if _find_libc
+00023520: 7564 6172 745f 6672 6f6d 5f72 756e 7469  udart_from_runti
+00023530: 6d65 5f63 6163 6865 6420 6973 206e 6f74  me_cached is not
+00023540: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+00023550: 6574 7572 6e20 5f66 696e 645f 6c69 6263  eturn _find_libc
+00023560: 7564 6172 745f 6672 6f6d 5f72 756e 7469  udart_from_runti
+00023570: 6d65 5f63 6163 6865 645b 305d 0a20 2020  me_cached[0].   
+00023580: 2066 6e73 203d 2063 6f6c 6c65 6374 5f70   fns = collect_p
+00023590: 726f 635f 6d61 7073 5f65 7865 635f 6669  roc_maps_exec_fi
+000235a0: 6c65 7328 290a 2020 2020 666f 7220 666e  les().    for fn
+000235b0: 2069 6e20 666e 733a 0a20 2020 2020 2020   in fns:.       
+000235c0: 2069 6620 7265 2e6d 6174 6368 2822 2e2a   if re.match(".*
+000235d0: 2f6c 6962 6375 6461 7274 5c5c 2e73 6f28  /libcudart\\.so(
+000235e0: 5c5c 2e2e 2a29 3f22 2c20 666e 293a 0a20  \\..*)?", fn):. 
+000235f0: 2020 2020 2020 2020 2020 205f 6669 6e64             _find
+00023600: 5f6c 6962 6375 6461 7274 5f66 726f 6d5f  _libcudart_from_
+00023610: 7275 6e74 696d 655f 6361 6368 6564 203d  runtime_cached =
+00023620: 205b 666e 5d0a 2020 2020 2020 2020 2020   [fn].          
+00023630: 2020 7265 7475 726e 2066 6e0a 2020 2020    return fn.    
+00023640: 5f66 696e 645f 6c69 6263 7564 6172 745f  _find_libcudart_
+00023650: 6672 6f6d 5f72 756e 7469 6d65 5f63 6163  from_runtime_cac
+00023660: 6865 6420 3d20 5b4e 6f6e 655d 0a20 2020  hed = [None].   
+00023670: 2072 6574 7572 6e20 4e6f 6e65 0a          return None.
```

### Comparing `returnn-1.20230509.160323/returnn/util/better_exchook.py` & `returnn-1.20230509.190819/returnn/util/better_exchook.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/bpe.py` & `returnn-1.20230509.190819/returnn/util/bpe.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/debug.py` & `returnn-1.20230509.190819/returnn/util/debug.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/debug_helpers.py` & `returnn-1.20230509.190819/returnn/util/debug_helpers.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/fsa.py` & `returnn-1.20230509.190819/returnn/util/fsa.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/literal_py_to_pickle.py` & `returnn-1.20230509.190819/returnn/util/literal_py_to_pickle.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/pprint.py` & `returnn-1.20230509.190819/returnn/util/pprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/py-to-pickle.cpp` & `returnn-1.20230509.190819/returnn/util/py-to-pickle.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/sig_proc.py` & `returnn-1.20230509.190819/returnn/util/sig_proc.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn/util/task_system.py` & `returnn-1.20230509.190819/returnn/util/task_system.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/returnn.egg-info/PKG-INFO` & `returnn-1.20230509.190819/returnn.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: returnn
-Version: 1.20230509.160323
+Version: 1.20230509.190819
 Summary: The RWTH extensible training framework for universal recurrent neural networks
 Home-page: https://github.com/rwth-i6/returnn/
 Author: Albert Zeyer
 Author-email: albzey@gmail.com
 License: RETURNN license
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `returnn-1.20230509.160323/returnn.egg-info/SOURCES.txt` & `returnn-1.20230509.190819/returnn.egg-info/SOURCES.txt`

 * *Files 0% similar despite different names*

```diff
@@ -357,14 +357,15 @@
 tools/debug-plot-search-scores.py
 tools/dump-dataset-raw-strings.py
 tools/dump-dataset.py
 tools/dump-forward-stats.py
 tools/dump-forward.py
 tools/dump-network-json.py
 tools/dump-pickle.py
+tools/export_to_onnx.py
 tools/extract_state_tying_from_dataset.py
 tools/get-attention-weights.py
 tools/get-best-model-epoch.py
 tools/hdf_dump.py
 tools/hdf_dump_translation_dataset.py
 tools/import-blocks-mt-model.py
 tools/import-t2t-mt-model.py
```

### Comparing `returnn-1.20230509.160323/setup.py` & `returnn-1.20230509.190819/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/DummySprintExec.py` & `returnn-1.20230509.190819/tests/DummySprintExec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/PyCharm-inspection-profile.xml` & `returnn-1.20230509.190819/tests/PyCharm-inspection-profile.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/PyCharm.idea/codeStyleSettings.xml` & `returnn-1.20230509.190819/tests/PyCharm.idea/codeStyleSettings.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml` & `returnn-1.20230509.190819/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/_set_num_threads1.py` & `returnn-1.20230509.190819/tests/_set_num_threads1.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/_setup_test_env.py` & `returnn-1.20230509.190819/tests/_setup_test_env.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/bpe-unicode-demo.codes` & `returnn-1.20230509.190819/tests/bpe-unicode-demo.codes`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/bpe-unicode-demo.vocab` & `returnn-1.20230509.190819/tests/bpe-unicode-demo.vocab`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/lexicon_opt.isyms` & `returnn-1.20230509.190819/tests/lexicon_opt.isyms`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/lexicon_opt.jpg` & `returnn-1.20230509.190819/tests/lexicon_opt.jpg`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/lint_common.py` & `returnn-1.20230509.190819/tests/lint_common.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/pycharm-inspect.py` & `returnn-1.20230509.190819/tests/pycharm-inspect.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/pylint.py` & `returnn-1.20230509.190819/tests/pylint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/returnn-as-framework.py` & `returnn-1.20230509.190819/tests/returnn-as-framework.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/rf_utils.py` & `returnn-1.20230509.190819/tests/rf_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/spelling.dic` & `returnn-1.20230509.190819/tests/spelling.dic`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_Config.py` & `returnn-1.20230509.190819/tests/test_Config.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_Dataset.py` & `returnn-1.20230509.190819/tests/test_Dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_Fsa.py` & `returnn-1.20230509.190819/tests/test_Fsa.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_GeneratingDataset.py` & `returnn-1.20230509.190819/tests/test_GeneratingDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_HDFDataset.py` & `returnn-1.20230509.190819/tests/test_HDFDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_LearningRateControl.py` & `returnn-1.20230509.190819/tests/test_LearningRateControl.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_Log.py` & `returnn-1.20230509.190819/tests/test_Log.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_MultiProcDataset.py` & `returnn-1.20230509.190819/tests/test_MultiProcDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_PTDataset.py` & `returnn-1.20230509.190819/tests/test_PTDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_Pretrain.py` & `returnn-1.20230509.190819/tests/test_Pretrain.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_ResNet.py` & `returnn-1.20230509.190819/tests/test_ResNet.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_SprintDataset.py` & `returnn-1.20230509.190819/tests/test_SprintDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_SprintInterface.py` & `returnn-1.20230509.190819/tests/test_SprintInterface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFEngine.py` & `returnn-1.20230509.190819/tests/test_TFEngine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFNativeOp.py` & `returnn-1.20230509.190819/tests/test_TFNativeOp.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFNetworkLayer.py` & `returnn-1.20230509.190819/tests/test_TFNetworkLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFNetworkRecLayer.py` & `returnn-1.20230509.190819/tests/test_TFNetworkRecLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFNetworkSigProcLayer.py` & `returnn-1.20230509.190819/tests/test_TFNetworkSigProcLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFUpdater.py` & `returnn-1.20230509.190819/tests/test_TFUpdater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TFUtil.py` & `returnn-1.20230509.190819/tests/test_TFUtil.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TF_determinism.py` & `returnn-1.20230509.190819/tests/test_TF_determinism.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TaskSystem.py` & `returnn-1.20230509.190819/tests/test_TaskSystem.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TaskSystem_SharedMem.py` & `returnn-1.20230509.190819/tests/test_TaskSystem_SharedMem.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_TranslationDataset.py` & `returnn-1.20230509.190819/tests/test_TranslationDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_Util.py` & `returnn-1.20230509.190819/tests/test_Util.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_demos.py` & `returnn-1.20230509.190819/tests/test_demos.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_fork_exec.py` & `returnn-1.20230509.190819/tests/test_fork_exec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_hdf_dump.py` & `returnn-1.20230509.190819/tests/test_hdf_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_array.py` & `returnn-1.20230509.190819/tests/test_rf_array.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_attention.py` & `returnn-1.20230509.190819/tests/test_rf_attention.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_base.py` & `returnn-1.20230509.190819/tests/test_rf_base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_cond.py` & `returnn-1.20230509.190819/tests/test_rf_cond.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_container.py` & `returnn-1.20230509.190819/tests/test_rf_container.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_conv.py` & `returnn-1.20230509.190819/tests/test_rf_conv.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_encoder_conformer.py` & `returnn-1.20230509.190819/tests/test_rf_encoder_conformer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_math.py` & `returnn-1.20230509.190819/tests/test_rf_math.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_normalization.py` & `returnn-1.20230509.190819/tests/test_rf_normalization.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_rec.py` & `returnn-1.20230509.190819/tests/test_rf_rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_rf_signal.py` & `returnn-1.20230509.190819/tests/test_rf_signal.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_tensor.py` & `returnn-1.20230509.190819/tests/test_tensor.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_tools.py` & `returnn-1.20230509.190819/tests/test_tools.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_torch_frontend.py` & `returnn-1.20230509.190819/tests/test_torch_frontend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tests/test_torch_internal_frontend.py` & `returnn-1.20230509.190819/tests/test_torch_internal_frontend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/analyze-dataset-batches.py` & `returnn-1.20230509.190819/tools/analyze-dataset-batches.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/bliss-collect-seq-lens.py` & `returnn-1.20230509.190819/tools/bliss-collect-seq-lens.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/bliss-dump-text.py` & `returnn-1.20230509.190819/tools/bliss-dump-text.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/bliss-get-segment-names.py` & `returnn-1.20230509.190819/tools/bliss-get-segment-names.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/bliss-to-ogg-zip.py` & `returnn-1.20230509.190819/tools/bliss-to-ogg-zip.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/bpe-create-lexicon.py` & `returnn-1.20230509.190819/tools/bpe-create-lexicon.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/calculate-word-error-rate.py` & `returnn-1.20230509.190819/tools/calculate-word-error-rate.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/cleanup-old-models.py` & `returnn-1.20230509.190819/tools/cleanup-old-models.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/collect-orth-symbols.py` & `returnn-1.20230509.190819/tools/collect-orth-symbols.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/collect-words.py` & `returnn-1.20230509.190819/tools/collect-words.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/compile_native_op.py` & `returnn-1.20230509.190819/tools/compile_native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/compile_tf_graph.py` & `returnn-1.20230509.190819/tools/compile_tf_graph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/debug-dump-search-scores.py` & `returnn-1.20230509.190819/tools/debug-dump-search-scores.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/debug-plot-search-scores.py` & `returnn-1.20230509.190819/tools/debug-plot-search-scores.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/dump-dataset-raw-strings.py` & `returnn-1.20230509.190819/tools/dump-dataset-raw-strings.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/dump-dataset.py` & `returnn-1.20230509.190819/tools/dump-dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/dump-forward-stats.py` & `returnn-1.20230509.190819/tools/dump-forward-stats.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/dump-forward.py` & `returnn-1.20230509.190819/tools/dump-forward.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/dump-network-json.py` & `returnn-1.20230509.190819/tools/dump-network-json.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/dump-pickle.py` & `returnn-1.20230509.190819/tools/dump-pickle.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/extract_state_tying_from_dataset.py` & `returnn-1.20230509.190819/tools/extract_state_tying_from_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/get-attention-weights.py` & `returnn-1.20230509.190819/tools/get-attention-weights.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/get-best-model-epoch.py` & `returnn-1.20230509.190819/tools/get-best-model-epoch.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/hdf_dump.py` & `returnn-1.20230509.190819/tools/hdf_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/hdf_dump_translation_dataset.py` & `returnn-1.20230509.190819/tools/hdf_dump_translation_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/import-blocks-mt-model.py` & `returnn-1.20230509.190819/tools/import-blocks-mt-model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/import-t2t-mt-model.py` & `returnn-1.20230509.190819/tools/import-t2t-mt-model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/Makefile` & `returnn-1.20230509.190819/tools/lattice_rescorer/Makefile`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/README.md` & `returnn-1.20230509.190819/tools/lattice_rescorer/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/example/README.md` & `returnn-1.20230509.190819/tools/lattice_rescorer/example/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config` & `returnn-1.20230509.190819/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config` & `returnn-1.20230509.190819/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/example/rescore_lattice.sh` & `returnn-1.20230509.190819/tools/lattice_rescorer/example/rescore_lattice.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/file.h` & `returnn-1.20230509.190819/tools/lattice_rescorer/file.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.cc` & `returnn-1.20230509.190819/tools/lattice_rescorer/htklatticerescorer.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.h` & `returnn-1.20230509.190819/tools/lattice_rescorer/htklatticerescorer.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/main.cc` & `returnn-1.20230509.190819/tools/lattice_rescorer/main.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/rescorer.h` & `returnn-1.20230509.190819/tools/lattice_rescorer/rescorer.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.cc` & `returnn-1.20230509.190819/tools/lattice_rescorer/vocabulary.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.h` & `returnn-1.20230509.190819/tools/lattice_rescorer/vocabulary.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/tf_avg_checkpoints.py` & `returnn-1.20230509.190819/tools/tf_avg_checkpoints.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/tf_inspect_checkpoint.py` & `returnn-1.20230509.190819/tools/tf_inspect_checkpoint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230509.160323/tools/tf_inspect_summary_log.py` & `returnn-1.20230509.190819/tools/tf_inspect_summary_log.py`

 * *Files identical despite different names*

