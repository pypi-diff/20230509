# Comparing `tmp/returnn-1.20230508.105629.tar.gz` & `tmp/returnn-1.20230509.160323.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/returnn-1.20230508.105629.tar", last modified: Mon May  8 09:07:36 2023, max compression
+gzip compressed data, was "dist/returnn-1.20230509.160323.tar", last modified: Tue May  9 14:27:16 2023, max compression
```

## Comparing `returnn-1.20230508.105629.tar` & `returnn-1.20230509.160323.tar`

### file list

```diff
@@ -1,440 +1,440 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/
--rw-r--r--   0 runner    (1001) docker     (123)      198 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/.editorconfig
--rw-r--r--   0 runner    (1001) docker     (123)      526 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)      828 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/.gitmodules
--rw-r--r--   0 runner    (1001) docker     (123)       79 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/.kateconfig
--rw-r--r--   0 runner    (1001) docker     (123)     8556 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/CHANGELOG.md
--rw-r--r--   0 runner    (1001) docker     (123)      704 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/CODEOWNERS
--rw-r--r--   0 runner    (1001) docker     (123)     4880 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/CONTRIBUTING.md
--rw-r--r--   0 runner    (1001) docker     (123)    10244 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      579 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/README.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)       77 2023-05-08 09:07:35.000000 returnn-1.20230508.105629/_setup_info_generated.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/
--rw-r--r--   0 runner    (1001) docker     (123)    36006 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/12AX.cluster_map
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/_setup_returnn_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-fwd.config
--rw-r--r--   0 runner    (1001) docker     (123)     2703 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-horovod-mpi.py
--rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-horovod-mpi.py.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)      264 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-horovod-mpi.sh
--rw-r--r--   0 runner    (1001) docker     (123)     1756 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-hyper-param-tuning.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     2396 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-iter-dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3635 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-list-devices.py
--rw-r--r--   0 runner    (1001) docker     (123)     2848 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-lua-torch-layer.config
--rw-r--r--   0 runner    (1001) docker     (123)      487 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-pretrain.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     2331 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-record-and-push-to-webserver.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1950 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-returnn-as-framework.py
--rw-r--r--   0 runner    (1001) docker     (123)     3040 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-rf.config
--rw-r--r--   0 runner    (1001) docker     (123)     2331 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-rhn-enwik8.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     1378 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-sprint-interface.py
--rw-r--r--   0 runner    (1001) docker     (123)     3147 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-att-copy.config
--rw-r--r--   0 runner    (1001) docker     (123)     2428 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-attention.config
--rw-r--r--   0 runner    (1001) docker     (123)     1481 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-chunking-blstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-contribrnn-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     3073 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-enc-dec.config
--rwxr-xr-x   0 runner    (1001) docker     (123)    11615 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-hard-att-copy.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     7287 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-lstm-benchmark.py
--rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-maxgradnorm-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1413 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-native-lstm-lowmem.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-native-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-native-lstm2.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1075 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-native-lstm2.12ax.tuned.config
--rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-neural-transducer.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1825 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-rec-explicit-lstm.config
--rw-r--r--   0 runner    (1001) docker     (123)     1202 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-rec-explicit-rnn.config
--rw-r--r--   0 runner    (1001) docker     (123)     2018 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-rec-self-att.config
--rw-r--r--   0 runner    (1001) docker     (123)     5188 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-search-compiled-graph.py
--rw-r--r--   0 runner    (1001) docker     (123)     1430 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-tf-vanilla-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     4818 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-timit-lstm-ctc.config
--rw-r--r--   0 runner    (1001) docker     (123)     2855 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-torch.config
--rw-r--r--   0 runner    (1001) docker     (123)      766 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo-upd-mult-model.lstm.12ax.config
--rwxr-xr-x   0 runner    (1001) docker     (123)      651 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/demo.sh
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/
--rwxr-xr-x   0 runner    (1001) docker     (123)    43239 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png
--rwxr-xr-x   0 runner    (1001) docker     (123)    43552 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/a01-007-04.png
--rwxr-xr-x   0 runner    (1001) docker     (123)    45111 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/a01-007-06.png
--rw-r--r--   0 runner    (1001) docker     (123)     1709 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/README.txt
--rw-r--r--   0 runner    (1001) docker     (123)      158 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/chars.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1896 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/config_demo
--rw-r--r--   0 runner    (1001) docker     (123)     1981 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/config_fwd
--rw-r--r--   0 runner    (1001) docker     (123)     1983 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/config_real
--rwxr-xr-x   0 runner    (1001) docker     (123)    10194 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/create_IAM_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      749 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/decode.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/features/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/features/raw/
--rw-r--r--   0 runner    (1001) docker     (123)   248580 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/features/raw/demo.h5
--rwxr-xr-x   0 runner    (1001) docker     (123)       86 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      235 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/lines.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/split/
--rw-r--r--   0 runner    (1001) docker     (123)     2712 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/split/eval.txt
--rw-r--r--   0 runner    (1001) docker     (123)    69536 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/split/train.txt
--rw-r--r--   0 runner    (1001) docker     (123)      934 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/IAM/split/valid.txt
--rw-r--r--   0 runner    (1001) docker     (123)      230 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/artificial/
--rwxr-xr-x   0 runner    (1001) docker     (123)     2804 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial/create_test_h5.py
--rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial/forwardconfig
--rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial/trainconfig
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/
--rwxr-xr-x   0 runner    (1001) docker     (123)     2966 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/create_test_h5.py
--rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/forwardconfig
--rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/trainconfig
--rw-r--r--   0 runner    (1001) docker     (123)      463 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)       18 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/requirements.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/
--rw-r--r--   0 runner    (1001) docker     (123)     1012 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    24324 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/__main__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/__old_mod_loader__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4659 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/__setup__.py
--rw-r--r--   0 runner    (1001) docker     (123)    24267 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/config.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/datasets/
--rw-r--r--   0 runner    (1001) docker     (123)      390 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    18032 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/audio.py
--rw-r--r--   0 runner    (1001) docker     (123)    62931 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/bundle_file.py
--rw-r--r--   0 runner    (1001) docker     (123)    24892 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/cached.py
--rw-r--r--   0 runner    (1001) docker     (123)    11658 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/cached2.py
--rw-r--r--   0 runner    (1001) docker     (123)    94213 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/generating.py
--rw-r--r--   0 runner    (1001) docker     (123)    65113 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/hdf.py
--rw-r--r--   0 runner    (1001) docker     (123)    85120 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/lm.py
--rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/map.py
--rw-r--r--   0 runner    (1001) docker     (123)    75821 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/meta.py
--rw-r--r--   0 runner    (1001) docker     (123)    11167 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/multi_proc.py
--rw-r--r--   0 runner    (1001) docker     (123)    14596 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/normalization_data.py
--rw-r--r--   0 runner    (1001) docker     (123)     5291 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/numpy_dump.py
--rw-r--r--   0 runner    (1001) docker     (123)     9127 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/raw_wav.py
--rw-r--r--   0 runner    (1001) docker     (123)    56015 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/sprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    17608 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/stereo.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/datasets/util/
--rw-r--r--   0 runner    (1001) docker     (123)       52 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    23915 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/util/feature_extraction.py
--rw-r--r--   0 runner    (1001) docker     (123)    20445 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/datasets/util/vocabulary.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/engine/
--rw-r--r--   0 runner    (1001) docker     (123)      228 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/engine/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9325 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/engine/base.py
--rw-r--r--   0 runner    (1001) docker     (123)     9912 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/engine/batch.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/
--rw-r--r--   0 runner    (1001) docker     (123)     4005 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4024 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/
--rw-r--r--   0 runner    (1001) docker     (123)       65 2023-05-08 09:07:10.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/.git
--rw-r--r--   0 runner    (1001) docker     (123)        6 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1448 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/README.md
--rw-r--r--   0 runner    (1001) docker     (123)    13770 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/aligner.gif
--rw-r--r--   0 runner    (1001) docker     (123)    51077 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/check.png
--rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/core.cu
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/core.h
--rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/core_cpu.cpp
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/
--rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)       70 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     2089 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     3485 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp
--rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h
--rw-r--r--   0 runner    (1001) docker     (123)       28 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/requirements.txt
--rw-r--r--   0 runner    (1001) docker     (123)     2079 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/
--rw-r--r--   0 runner    (1001) docker     (123)     2885 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6961 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py
--rw-r--r--   0 runner    (1001) docker     (123)     4141 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/ref_rna.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/
--rw-r--r--   0 runner    (1001) docker     (123)     6150 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/
--rw-r--r--   0 runner    (1001) docker     (123)     1693 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc
--rw-r--r--   0 runner    (1001) docker     (123)     6030 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/
--rw-r--r--   0 runner    (1001) docker     (123)     2076 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-05-08 09:07:13.000000 returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/test.cpp
--rw-r--r--   0 runner    (1001) docker     (123)      135 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     1239 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8479 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/edit.py
--rw-r--r--   0 runner    (1001) docker     (123)    19826 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/reroute.py
--rw-r--r--   0 runner    (1001) docker     (123)    29772 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/select.py
--rw-r--r--   0 runner    (1001) docker     (123)    26578 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/subgraph.py
--rw-r--r--   0 runner    (1001) docker     (123)    30380 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/transform.py
--rw-r--r--   0 runner    (1001) docker     (123)    18727 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/extern/graph_editor/util.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/frontend/
--rw-r--r--   0 runner    (1001) docker     (123)     1260 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    37689 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/_numpy_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5127 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17465 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/array_.py
--rw-r--r--   0 runner    (1001) docker     (123)    20833 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/attention.py
--rw-r--r--   0 runner    (1001) docker     (123)     1023 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/cond.py
--rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/const.py
--rw-r--r--   0 runner    (1001) docker     (123)     6015 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/container.py
--rw-r--r--   0 runner    (1001) docker     (123)      413 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/control_flow_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)    22357 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/conv.py
--rw-r--r--   0 runner    (1001) docker     (123)      519 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/device.py
--rw-r--r--   0 runner    (1001) docker     (123)     3538 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/dims.py
--rw-r--r--   0 runner    (1001) docker     (123)     3334 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/dropout.py
--rw-r--r--   0 runner    (1001) docker     (123)      964 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/dtype.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/frontend/encoder/
--rw-r--r--   0 runner    (1001) docker     (123)       17 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/encoder/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2109 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/encoder/base.py
--rw-r--r--   0 runner    (1001) docker     (123)    15428 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/encoder/conformer.py
--rw-r--r--   0 runner    (1001) docker     (123)      330 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/gradient.py
--rw-r--r--   0 runner    (1001) docker     (123)     5855 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/init.py
--rw-r--r--   0 runner    (1001) docker     (123)     2147 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/linear.py
--rw-r--r--   0 runner    (1001) docker     (123)      808 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/loop.py
--rw-r--r--   0 runner    (1001) docker     (123)     1898 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/loss.py
--rw-r--r--   0 runner    (1001) docker     (123)    13440 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/math_.py
--rw-r--r--   0 runner    (1001) docker     (123)     1945 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/matmul.py
--rw-r--r--   0 runner    (1001) docker     (123)     9877 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/module.py
--rw-r--r--   0 runner    (1001) docker     (123)     9687 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/normalization.py
--rw-r--r--   0 runner    (1001) docker     (123)     7158 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/parameter.py
--rw-r--r--   0 runner    (1001) docker     (123)    10723 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/rand.py
--rw-r--r--   0 runner    (1001) docker     (123)     2374 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/rec.py
--rw-r--r--   0 runner    (1001) docker     (123)     4750 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/reduce.py
--rw-r--r--   0 runner    (1001) docker     (123)    12245 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/run_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)     9385 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/signal.py
--rw-r--r--   0 runner    (1001) docker     (123)     2188 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/state.py
--rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/frontend/types.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/import_/
--rw-r--r--   0 runner    (1001) docker     (123)      243 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/import_/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8148 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/import_/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    13961 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/import_/git.py
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/import_/import_.py
--rw-r--r--   0 runner    (1001) docker     (123)    33063 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/learning_rate_control.py
--rw-r--r--   0 runner    (1001) docker     (123)    11738 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/log.py
--rw-r--r--   0 runner    (1001) docker     (123)    35760 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/native_op.cpp
--rw-r--r--   0 runner    (1001) docker     (123)   244393 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/native_op.py
--rw-r--r--   0 runner    (1001) docker     (123)    23542 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/pretrain.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/sprint/
--rw-r--r--   0 runner    (1001) docker     (123)       64 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/sprint/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    31545 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/sprint/cache.py
--rw-r--r--   0 runner    (1001) docker     (123)    31137 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/sprint/control.py
--rw-r--r--   0 runner    (1001) docker     (123)    23313 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/sprint/error_signals.py
--rw-r--r--   0 runner    (1001) docker     (123)    12305 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/sprint/extern_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    36475 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/sprint/interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/tensor/
--rw-r--r--   0 runner    (1001) docker     (123)      501 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    99004 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/_dim_extra.py
--rw-r--r--   0 runner    (1001) docker     (123)   157144 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/_tensor_extra.py
--rw-r--r--   0 runner    (1001) docker     (123)      643 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/_tensor_mixin_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     4890 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/_tensor_op_overloads.py
--rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/control_flow_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)     3884 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/dim.py
--rw-r--r--   0 runner    (1001) docker     (123)     1884 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/marked_dim.py
--rw-r--r--   0 runner    (1001) docker     (123)     7491 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/tensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     4187 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tensor/tensor_dict.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/tf/
--rw-r--r--   0 runner    (1001) docker     (123)       88 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1632 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/compat.py
--rw-r--r--   0 runner    (1001) docker     (123)    36852 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/data_pipeline.py
--rw-r--r--   0 runner    (1001) docker     (123)    15108 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/distributed.py
--rw-r--r--   0 runner    (1001) docker     (123)   151443 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/engine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/
--rw-r--r--   0 runner    (1001) docker     (123)      452 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    37861 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     3702 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    14297 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/cond.py
--rw-r--r--   0 runner    (1001) docker     (123)     4304 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/config_entry_points.py
--rw-r--r--   0 runner    (1001) docker     (123)      888 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/debug_eager_mode.py
--rw-r--r--   0 runner    (1001) docker     (123)     5712 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/dims.py
--rw-r--r--   0 runner    (1001) docker     (123)    71987 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/layer.py
--rw-r--r--   0 runner    (1001) docker     (123)    15829 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/make_layer.py
--rw-r--r--   0 runner    (1001) docker     (123)     5107 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/parameter_assign.py
--rw-r--r--   0 runner    (1001) docker     (123)     2239 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_layers/prev_tensor_ref.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/tf/frontend_low_level/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_low_level/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20261 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/frontend_low_level/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5404 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/horovod.py
--rw-r--r--   0 runner    (1001) docker     (123)    31611 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/hyper_param_tuning.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/tf/layers/
--rw-r--r--   0 runner    (1001) docker     (123)       72 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   149447 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/base.py
--rw-r--r--   0 runner    (1001) docker     (123)   585273 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)   539812 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/rec.py
--rw-r--r--   0 runner    (1001) docker     (123)    21515 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/segmental_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    52409 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/signal_processing.py
--rw-r--r--   0 runner    (1001) docker     (123)    11239 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/layers/variable.py
--rw-r--r--   0 runner    (1001) docker     (123)    79733 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/native_op.py
--rw-r--r--   0 runner    (1001) docker     (123)   222320 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/network.py
--rw-r--r--   0 runner    (1001) docker     (123)     5471 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/sprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    71410 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/updater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/tf/util/
--rw-r--r--   0 runner    (1001) docker     (123)       92 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   296804 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/util/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)    28839 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/util/data.py
--rw-r--r--   0 runner    (1001) docker     (123)    17333 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/util/ken_lm.py
--rw-r--r--   0 runner    (1001) docker     (123)    11277 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/tf/util/open_fst.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/torch/
--rw-r--r--   0 runner    (1001) docker     (123)       85 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       24 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/torch/data/
--rw-r--r--   0 runner    (1001) docker     (123)      132 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9483 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/data/pipeline.py
--rw-r--r--   0 runner    (1001) docker     (123)     5410 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/data/returnn_dataset_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/data/tensor_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/engine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/torch/frontend/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/frontend/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    60006 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/frontend/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     1830 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/frontend/_rand.py
--rw-r--r--   0 runner    (1001) docker     (123)     2714 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/frontend/bridge.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/torch/functional/
--rw-r--r--   0 runner    (1001) docker     (123)      193 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/functional/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       26 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/functional/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11449 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/torch/updater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn/util/
--rw-r--r--   0 runner    (1001) docker     (123)      336 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   144924 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)    59572 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/better_exchook.py
--rw-r--r--   0 runner    (1001) docker     (123)    17977 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/bpe.py
--rw-r--r--   0 runner    (1001) docker     (123)    15987 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/debug.py
--rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/debug_helpers.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    59177 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/fsa.py
--rw-r--r--   0 runner    (1001) docker     (123)     2009 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/literal_py_to_pickle.py
--rw-r--r--   0 runner    (1001) docker     (123)     8131 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/pprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    14846 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/py-to-pickle.cpp
--rw-r--r--   0 runner    (1001) docker     (123)      277 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/py_compat.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     7273 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/sig_proc.py
--rw-r--r--   0 runner    (1001) docker     (123)    27230 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/returnn/util/task_system.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    12268 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/returnn.egg-info/top_level.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)      461 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/rnn.py
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     4159 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tests/
--rwxr-xr-x   0 runner    (1001) docker     (123)     3392 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/DummySprintExec.py
--rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm-inspection-profile.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tests/PyCharm.idea/
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/.name
--rw-r--r--   0 runner    (1001) docker     (123)      512 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/codeStyleSettings.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tests/PyCharm.idea/codeStyles/
--rw-r--r--   0 runner    (1001) docker     (123)      328 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/codeStyles/Project.xml
--rw-r--r--   0 runner    (1001) docker     (123)      142 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/codeStyles/codeStyleConfig.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tests/PyCharm.idea/inspectionProfiles/
--rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml
--rw-r--r--   0 runner    (1001) docker     (123)      181 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/inspectionProfiles/profiles_settings.xml
--rw-r--r--   0 runner    (1001) docker     (123)      318 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/misc.xml
--rw-r--r--   0 runner    (1001) docker     (123)      267 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/modules.xml
--rw-r--r--   0 runner    (1001) docker     (123)      417 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/returnn.iml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tests/PyCharm.idea/scopes/
--rw-r--r--   0 runner    (1001) docker     (123)      139 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/PyCharm.idea/scopes/scope_settings.xml
--rw-r--r--   0 runner    (1001) docker     (123)      871 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/_set_num_threads1.py
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/_setup_returnn_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     8833 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/_setup_test_env.py
--rw-r--r--   0 runner    (1001) docker     (123)      794 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/bpe-unicode-demo.codes
--rw-r--r--   0 runner    (1001) docker     (123)     2205 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/bpe-unicode-demo.vocab
--rw-r--r--   0 runner    (1001) docker     (123)      386 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/lexicon_opt.fst
--rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/lexicon_opt.isyms
--rw-r--r--   0 runner    (1001) docker     (123)    34282 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/lexicon_opt.jpg
--rw-r--r--   0 runner    (1001) docker     (123)       41 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/lexicon_opt.osyms
--rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/lint_common.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    29203 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/pycharm-inspect.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2960 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/pylint.py
--rw-r--r--   0 runner    (1001) docker     (123)     2963 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/returnn-as-framework.py
--rw-r--r--   0 runner    (1001) docker     (123)    11619 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/rf_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      617 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/spelling.dic
--rw-r--r--   0 runner    (1001) docker     (123)     7845 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_Config.py
--rw-r--r--   0 runner    (1001) docker     (123)    18921 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_Dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    13634 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_Fsa.py
--rw-r--r--   0 runner    (1001) docker     (123)     8904 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_GeneratingDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    32796 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_HDFDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    10326 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_LearningRateControl.py
--rw-r--r--   0 runner    (1001) docker     (123)     7187 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_Log.py
--rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_MultiProcDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3333 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_PTDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     2465 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_Pretrain.py
--rw-r--r--   0 runner    (1001) docker     (123)    21403 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_ResNet.py
--rw-r--r--   0 runner    (1001) docker     (123)     5014 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_SprintDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3330 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_SprintInterface.py
--rw-r--r--   0 runner    (1001) docker     (123)   238053 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFEngine.py
--rw-r--r--   0 runner    (1001) docker     (123)   135453 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFNativeOp.py
--rw-r--r--   0 runner    (1001) docker     (123)   551354 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFNetworkLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)   549696 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFNetworkRecLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    14485 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFNetworkSigProcLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    20440 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFUpdater.py
--rw-r--r--   0 runner    (1001) docker     (123)   187644 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TFUtil.py
--rw-r--r--   0 runner    (1001) docker     (123)     3082 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TF_determinism.py
--rw-r--r--   0 runner    (1001) docker     (123)     2156 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TaskSystem.py
--rw-r--r--   0 runner    (1001) docker     (123)     5088 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TaskSystem_SharedMem.py
--rw-r--r--   0 runner    (1001) docker     (123)     9378 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_TranslationDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_Util.py
--rw-r--r--   0 runner    (1001) docker     (123)    10578 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_demos.py
--rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_fork_exec.py
--rw-r--r--   0 runner    (1001) docker     (123)     2893 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_hdf_dump.py
--rw-r--r--   0 runner    (1001) docker     (123)     4725 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_array.py
--rw-r--r--   0 runner    (1001) docker     (123)     4491 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_attention.py
--rw-r--r--   0 runner    (1001) docker     (123)     7608 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     9490 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_cond.py
--rw-r--r--   0 runner    (1001) docker     (123)     4591 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_container.py
--rw-r--r--   0 runner    (1001) docker     (123)    10228 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_conv.py
--rw-r--r--   0 runner    (1001) docker     (123)     1963 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_encoder_conformer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2312 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_math.py
--rw-r--r--   0 runner    (1001) docker     (123)     1933 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_normalization.py
--rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_rec.py
--rw-r--r--   0 runner    (1001) docker     (123)     1052 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_rf_signal.py
--rw-r--r--   0 runner    (1001) docker     (123)     1135 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_tensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     8435 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)    15594 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_torch_frontend.py
--rw-r--r--   0 runner    (1001) docker     (123)    15534 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tests/test_torch_internal_frontend.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tools/
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/_setup_returnn_env.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     9650 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/analyze-dataset-batches.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3943 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/bliss-collect-seq-lens.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      780 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/bliss-dump-text.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6608 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/bliss-get-segment-names.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    18221 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/bliss-to-ogg-zip.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5644 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/bpe-create-lexicon.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    10532 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/calculate-word-error-rate.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1759 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/cleanup-old-models.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    10783 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/collect-orth-symbols.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6801 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/collect-words.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     4395 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/compile_native_op.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    81620 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/compile_tf_graph.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     8500 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/debug-dump-search-scores.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    47001 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/debug-plot-search-scores.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6048 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/dump-dataset-raw-strings.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    12524 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/dump-dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5770 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/dump-forward-stats.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2576 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/dump-forward.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1596 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/dump-network-json.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      719 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/dump-pickle.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    16425 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/extract_state_tying_from_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    14986 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/get-attention-weights.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2936 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/get-best-model-epoch.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3900 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/hdf_dump.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    19622 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/hdf_dump_translation_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    49563 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/import-blocks-mt-model.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    31498 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/import-t2t-mt-model.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tools/lattice_rescorer/
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     2254 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/Makefile
--rw-r--r--   0 runner    (1001) docker     (123)     7825 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/
--rw-r--r--   0 runner    (1001) docker     (123)     1282 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      100 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/libs_list
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-08 09:07:36.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/network.040/
--rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config
--rw-r--r--   0 runner    (1001) docker     (123)     6110 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config
--rwxr-xr-x   0 runner    (1001) docker     (123)      800 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/rescore_lattice.sh
--rw-r--r--   0 runner    (1001) docker     (123)      296 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/state_vars_list
--rw-r--r--   0 runner    (1001) docker     (123)      155 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/example/tensor_names_list
--rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/file.h
--rw-r--r--   0 runner    (1001) docker     (123)    26055 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/htklatticerescorer.cc
--rw-r--r--   0 runner    (1001) docker     (123)    10856 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/htklatticerescorer.h
--rw-r--r--   0 runner    (1001) docker     (123)    12488 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/main.cc
--rw-r--r--   0 runner    (1001) docker     (123)     2184 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/rescorer.h
--rw-r--r--   0 runner    (1001) docker     (123)     5563 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/vocabulary.cc
--rw-r--r--   0 runner    (1001) docker     (123)     3023 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/lattice_rescorer/vocabulary.h
--rwxr-xr-x   0 runner    (1001) docker     (123)     5438 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/tf_avg_checkpoints.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6269 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/tf_inspect_checkpoint.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1288 2023-05-08 09:07:09.000000 returnn-1.20230508.105629/tools/tf_inspect_summary_log.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/
+-rw-r--r--   0 runner    (1001) docker     (123)      198 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.editorconfig
+-rw-r--r--   0 runner    (1001) docker     (123)      526 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)      828 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.gitmodules
+-rw-r--r--   0 runner    (1001) docker     (123)       79 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/.kateconfig
+-rw-r--r--   0 runner    (1001) docker     (123)     8556 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/CHANGELOG.md
+-rw-r--r--   0 runner    (1001) docker     (123)      704 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/CODEOWNERS
+-rw-r--r--   0 runner    (1001) docker     (123)     4880 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/CONTRIBUTING.md
+-rw-r--r--   0 runner    (1001) docker     (123)    10244 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      579 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/README.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)       77 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/_setup_info_generated.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/
+-rw-r--r--   0 runner    (1001) docker     (123)    36006 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/12AX.cluster_map
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/_setup_returnn_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-fwd.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2703 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-horovod-mpi.py
+-rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-horovod-mpi.py.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)      264 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-horovod-mpi.sh
+-rw-r--r--   0 runner    (1001) docker     (123)     1756 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-hyper-param-tuning.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2396 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-iter-dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3635 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-list-devices.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2848 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-lua-torch-layer.config
+-rw-r--r--   0 runner    (1001) docker     (123)      487 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-pretrain.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2331 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-record-and-push-to-webserver.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1950 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-returnn-as-framework.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3040 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-rf.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2331 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-rhn-enwik8.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1378 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-sprint-interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3147 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-att-copy.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2428 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-attention.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1481 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-chunking-blstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-contribrnn-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     3073 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-enc-dec.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)    11615 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-hard-att-copy.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7287 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-lstm-benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-maxgradnorm-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1413 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm-lowmem.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1075 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.tuned.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-neural-transducer.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1825 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-rec-explicit-lstm.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1202 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-rec-explicit-rnn.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2018 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-rec-self-att.config
+-rw-r--r--   0 runner    (1001) docker     (123)     5188 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-search-compiled-graph.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1430 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-tf-vanilla-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     4818 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-timit-lstm-ctc.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2855 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-torch.config
+-rw-r--r--   0 runner    (1001) docker     (123)      766 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo-upd-mult-model.lstm.12ax.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)      651 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/demo.sh
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/
+-rwxr-xr-x   0 runner    (1001) docker     (123)    43239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)    43552 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-04.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)    45111 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-06.png
+-rw-r--r--   0 runner    (1001) docker     (123)     1709 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/README.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      158 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/chars.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1896 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/config_demo
+-rw-r--r--   0 runner    (1001) docker     (123)     1981 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/config_fwd
+-rw-r--r--   0 runner    (1001) docker     (123)     1983 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/config_real
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10194 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/create_IAM_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      749 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/decode.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/features/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/features/raw/
+-rw-r--r--   0 runner    (1001) docker     (123)   248580 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/features/raw/demo.h5
+-rwxr-xr-x   0 runner    (1001) docker     (123)       86 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      235 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/lines.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/
+-rw-r--r--   0 runner    (1001) docker     (123)     2712 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/eval.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    69536 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/train.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      934 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/IAM/split/valid.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      230 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2804 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/create_test_h5.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/forwardconfig
+-rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial/trainconfig
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2966 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/create_test_h5.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/forwardconfig
+-rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/trainconfig
+-rw-r--r--   0 runner    (1001) docker     (123)      463 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)       18 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/requirements.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/
+-rw-r--r--   0 runner    (1001) docker     (123)     1012 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24324 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__main__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__old_mod_loader__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4659 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/__setup__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24267 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/config.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/datasets/
+-rw-r--r--   0 runner    (1001) docker     (123)      390 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18032 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/audio.py
+-rw-r--r--   0 runner    (1001) docker     (123)    62931 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/bundle_file.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24892 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/cached.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11658 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/cached2.py
+-rw-r--r--   0 runner    (1001) docker     (123)    94213 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/generating.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65113 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/hdf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    85120 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/lm.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/map.py
+-rw-r--r--   0 runner    (1001) docker     (123)    75821 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/meta.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11167 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/multi_proc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14596 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/normalization_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5291 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/numpy_dump.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9127 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/raw_wav.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56015 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/sprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17608 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/stereo.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/datasets/util/
+-rw-r--r--   0 runner    (1001) docker     (123)       52 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23915 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/util/feature_extraction.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20445 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/datasets/util/vocabulary.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/engine/
+-rw-r--r--   0 runner    (1001) docker     (123)      228 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/engine/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9325 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/engine/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9912 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/engine/batch.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/
+-rw-r--r--   0 runner    (1001) docker     (123)     4005 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4024 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/
+-rw-r--r--   0 runner    (1001) docker     (123)       65 2023-05-09 14:26:47.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/.git
+-rw-r--r--   0 runner    (1001) docker     (123)        6 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1448 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)    13770 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/aligner.gif
+-rw-r--r--   0 runner    (1001) docker     (123)    51077 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/check.png
+-rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.cu
+-rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.h
+-rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core_cpu.cpp
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/
+-rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)       70 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     2089 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     3485 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu
+-rw-r--r--   0 runner    (1001) docker     (123)      975 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h
+-rw-r--r--   0 runner    (1001) docker     (123)       28 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/requirements.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     2079 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/
+-rw-r--r--   0 runner    (1001) docker     (123)     2885 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6961 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4141 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/ref_rna.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/
+-rw-r--r--   0 runner    (1001) docker     (123)     6150 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/
+-rw-r--r--   0 runner    (1001) docker     (123)     1693 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     6030 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/
+-rw-r--r--   0 runner    (1001) docker     (123)     2076 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-05-09 14:26:52.000000 returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/test.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)      135 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8479 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/edit.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19826 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/reroute.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29772 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/select.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26578 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/subgraph.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30380 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/transform.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18727 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/extern/graph_editor/util.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/frontend/
+-rw-r--r--   0 runner    (1001) docker     (123)     1260 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37689 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/_numpy_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5127 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17465 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/array_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20833 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1023 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/cond.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/const.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6015 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/container.py
+-rw-r--r--   0 runner    (1001) docker     (123)      413 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/control_flow_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22357 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)      519 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/device.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3538 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/dims.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3334 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/dropout.py
+-rw-r--r--   0 runner    (1001) docker     (123)      964 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/dtype.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/frontend/encoder/
+-rw-r--r--   0 runner    (1001) docker     (123)       17 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/encoder/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2109 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/encoder/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15428 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/encoder/conformer.py
+-rw-r--r--   0 runner    (1001) docker     (123)      330 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/gradient.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5855 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/init.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2147 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/linear.py
+-rw-r--r--   0 runner    (1001) docker     (123)      808 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/loop.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1898 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/loss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13440 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/math_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1945 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/matmul.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9877 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/module.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9687 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/normalization.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7158 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/parameter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10723 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/rand.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2374 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4750 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/reduce.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12245 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/run_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9385 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/signal.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2188 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/state.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/frontend/types.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/import_/
+-rw-r--r--   0 runner    (1001) docker     (123)      243 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8148 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13961 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/git.py
+-rw-r--r--   0 runner    (1001) docker     (123)      798 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/import_/import_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    33063 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/learning_rate_control.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11738 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/log.py
+-rw-r--r--   0 runner    (1001) docker     (123)    35760 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/native_op.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)   244393 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/native_op.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23542 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/pretrain.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/sprint/
+-rw-r--r--   0 runner    (1001) docker     (123)       64 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31545 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31137 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/control.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23313 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/error_signals.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12305 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/extern_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36475 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/sprint/interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tensor/
+-rw-r--r--   0 runner    (1001) docker     (123)      501 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    99004 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_dim_extra.py
+-rw-r--r--   0 runner    (1001) docker     (123)   157144 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_tensor_extra.py
+-rw-r--r--   0 runner    (1001) docker     (123)      643 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_tensor_mixin_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4890 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/_tensor_op_overloads.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/control_flow_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3884 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/dim.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1884 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/marked_dim.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7491 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/tensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4187 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tensor/tensor_dict.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/
+-rw-r--r--   0 runner    (1001) docker     (123)       88 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1632 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36852 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/data_pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15108 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/distributed.py
+-rw-r--r--   0 runner    (1001) docker     (123)   151443 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/engine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/
+-rw-r--r--   0 runner    (1001) docker     (123)      452 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37861 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3702 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14297 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/cond.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4304 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/config_entry_points.py
+-rw-r--r--   0 runner    (1001) docker     (123)      888 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/debug_eager_mode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5712 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/dims.py
+-rw-r--r--   0 runner    (1001) docker     (123)    71987 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/layer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15829 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/make_layer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5107 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/parameter_assign.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_layers/prev_tensor_ref.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/frontend_low_level/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_low_level/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20261 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/frontend_low_level/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5404 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/horovod.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31611 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/hyper_param_tuning.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/layers/
+-rw-r--r--   0 runner    (1001) docker     (123)       72 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   149447 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)   585273 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)   539812 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21515 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/segmental_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52409 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/signal_processing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11239 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/layers/variable.py
+-rw-r--r--   0 runner    (1001) docker     (123)    79733 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/native_op.py
+-rw-r--r--   0 runner    (1001) docker     (123)   222320 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/network.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5471 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/sprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    71410 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/updater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/tf/util/
+-rw-r--r--   0 runner    (1001) docker     (123)       92 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   296804 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28839 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17333 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/ken_lm.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11277 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/tf/util/open_fst.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/
+-rw-r--r--   0 runner    (1001) docker     (123)       85 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       24 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      132 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9483 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5410 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/returnn_dataset_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/data/tensor_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/engine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/frontend/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    60006 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1830 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/_rand.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2714 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/frontend/bridge.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/torch/functional/
+-rw-r--r--   0 runner    (1001) docker     (123)      193 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/functional/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       26 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/functional/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11449 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/torch/updater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      336 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   144927 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    59572 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/better_exchook.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17977 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/bpe.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15987 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/debug.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/debug_helpers.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    59177 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/fsa.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2009 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/literal_py_to_pickle.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8131 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/pprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14846 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/py-to-pickle.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)      277 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/py_compat.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7273 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/sig_proc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27230 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/returnn/util/task_system.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    12268 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/returnn.egg-info/top_level.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)      461 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/rnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     4159 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3392 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/DummySprintExec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm-inspection-profile.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/
+-rw-r--r--   0 runner    (1001) docker     (123)       47 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/.name
+-rw-r--r--   0 runner    (1001) docker     (123)      512 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyleSettings.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyles/
+-rw-r--r--   0 runner    (1001) docker     (123)      328 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyles/Project.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      142 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/codeStyles/codeStyleConfig.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/
+-rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/profiles_settings.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      318 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/misc.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      267 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/modules.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      417 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/returnn.iml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tests/PyCharm.idea/scopes/
+-rw-r--r--   0 runner    (1001) docker     (123)      139 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/PyCharm.idea/scopes/scope_settings.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      871 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/_set_num_threads1.py
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/_setup_returnn_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8833 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/_setup_test_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)      794 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/bpe-unicode-demo.codes
+-rw-r--r--   0 runner    (1001) docker     (123)     2205 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/bpe-unicode-demo.vocab
+-rw-r--r--   0 runner    (1001) docker     (123)      386 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.fst
+-rw-r--r--   0 runner    (1001) docker     (123)      520 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.isyms
+-rw-r--r--   0 runner    (1001) docker     (123)    34282 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.jpg
+-rw-r--r--   0 runner    (1001) docker     (123)       41 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lexicon_opt.osyms
+-rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/lint_common.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    29203 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/pycharm-inspect.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2960 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/pylint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2963 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/returnn-as-framework.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11619 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/rf_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      617 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/spelling.dic
+-rw-r--r--   0 runner    (1001) docker     (123)     7845 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Config.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18921 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    13634 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Fsa.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8904 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_GeneratingDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32796 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_HDFDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10326 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_LearningRateControl.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7187 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Log.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_MultiProcDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3333 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_PTDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2465 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Pretrain.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21403 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_ResNet.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5014 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_SprintDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3330 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_SprintInterface.py
+-rw-r--r--   0 runner    (1001) docker     (123)   238053 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFEngine.py
+-rw-r--r--   0 runner    (1001) docker     (123)   135453 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNativeOp.py
+-rw-r--r--   0 runner    (1001) docker     (123)   551354 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNetworkLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)   549696 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNetworkRecLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14485 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFNetworkSigProcLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20440 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFUpdater.py
+-rw-r--r--   0 runner    (1001) docker     (123)   187644 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TFUtil.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3082 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TF_determinism.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2156 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TaskSystem.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5088 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TaskSystem_SharedMem.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9378 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_TranslationDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_Util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10578 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_demos.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_fork_exec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2893 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_hdf_dump.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4725 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_array.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4491 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7608 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9490 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_cond.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4591 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_container.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10228 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1963 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_encoder_conformer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2312 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_math.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1933 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_normalization.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1052 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_rf_signal.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1135 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_tensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8435 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15594 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_torch_frontend.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15534 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tests/test_torch_internal_frontend.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/_setup_returnn_env.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     9650 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/analyze-dataset-batches.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3943 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-collect-seq-lens.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      780 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-dump-text.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6608 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-get-segment-names.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    18221 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bliss-to-ogg-zip.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5644 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/bpe-create-lexicon.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10532 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/calculate-word-error-rate.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1759 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/cleanup-old-models.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10783 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/collect-orth-symbols.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6801 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/collect-words.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     4395 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/compile_native_op.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    81620 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/compile_tf_graph.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     8500 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/debug-dump-search-scores.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    47001 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/debug-plot-search-scores.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6048 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-dataset-raw-strings.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    12524 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5770 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-forward-stats.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2576 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-forward.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1596 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-network-json.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      719 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/dump-pickle.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    16425 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/extract_state_tying_from_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    14986 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/get-attention-weights.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2936 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/get-best-model-epoch.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3900 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/hdf_dump.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    19622 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/hdf_dump_translation_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    49563 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/import-blocks-mt-model.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    31498 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/import-t2t-mt-model.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/lattice_rescorer/
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     2254 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/Makefile
+-rw-r--r--   0 runner    (1001) docker     (123)     7825 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/
+-rw-r--r--   0 runner    (1001) docker     (123)     1282 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      100 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/libs_list
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-09 14:27:16.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/
+-rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config
+-rw-r--r--   0 runner    (1001) docker     (123)     6110 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)      800 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/rescore_lattice.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      296 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/state_vars_list
+-rw-r--r--   0 runner    (1001) docker     (123)      155 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/example/tensor_names_list
+-rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/file.h
+-rw-r--r--   0 runner    (1001) docker     (123)    26055 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.cc
+-rw-r--r--   0 runner    (1001) docker     (123)    10856 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.h
+-rw-r--r--   0 runner    (1001) docker     (123)    12488 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/main.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     2184 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/rescorer.h
+-rw-r--r--   0 runner    (1001) docker     (123)     5563 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     3023 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.h
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5438 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/tf_avg_checkpoints.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6269 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/tf_inspect_checkpoint.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1288 2023-05-09 14:26:45.000000 returnn-1.20230509.160323/tools/tf_inspect_summary_log.py
```

### Comparing `returnn-1.20230508.105629/.gitignore` & `returnn-1.20230509.160323/.gitignore`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/.gitmodules` & `returnn-1.20230509.160323/.gitmodules`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/CHANGELOG.md` & `returnn-1.20230509.160323/CHANGELOG.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/CODEOWNERS` & `returnn-1.20230509.160323/CODEOWNERS`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/CONTRIBUTING.md` & `returnn-1.20230509.160323/CONTRIBUTING.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/LICENSE` & `returnn-1.20230509.160323/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/MANIFEST.in` & `returnn-1.20230509.160323/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/PKG-INFO` & `returnn-1.20230509.160323/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: returnn
-Version: 1.20230508.105629
+Version: 1.20230509.160323
 Summary: The RWTH extensible training framework for universal recurrent neural networks
 Home-page: https://github.com/rwth-i6/returnn/
 Author: Albert Zeyer
 Author-email: albzey@gmail.com
 License: RETURNN license
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `returnn-1.20230508.105629/README.rst` & `returnn-1.20230509.160323/README.rst`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/__init__.py` & `returnn-1.20230509.160323/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/12AX.cluster_map` & `returnn-1.20230509.160323/demos/12AX.cluster_map`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-fwd.config` & `returnn-1.20230509.160323/demos/demo-fwd.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-horovod-mpi.py` & `returnn-1.20230509.160323/demos/demo-horovod-mpi.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-horovod-mpi.py.sh` & `returnn-1.20230509.160323/demos/demo-horovod-mpi.py.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-hyper-param-tuning.config` & `returnn-1.20230509.160323/demos/demo-hyper-param-tuning.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-iter-dataset.py` & `returnn-1.20230509.160323/demos/demo-iter-dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-list-devices.py` & `returnn-1.20230509.160323/demos/demo-list-devices.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-lua-torch-layer.config` & `returnn-1.20230509.160323/demos/demo-lua-torch-layer.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-record-and-push-to-webserver.py` & `returnn-1.20230509.160323/demos/demo-record-and-push-to-webserver.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-returnn-as-framework.py` & `returnn-1.20230509.160323/demos/demo-returnn-as-framework.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-rf.config` & `returnn-1.20230509.160323/demos/demo-rf.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-rhn-enwik8.config` & `returnn-1.20230509.160323/demos/demo-rhn-enwik8.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-sprint-interface.py` & `returnn-1.20230509.160323/demos/demo-sprint-interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-att-copy.config` & `returnn-1.20230509.160323/demos/demo-tf-att-copy.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-attention.config` & `returnn-1.20230509.160323/demos/demo-tf-attention.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-chunking-blstm.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-chunking-blstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-contribrnn-lstm.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-contribrnn-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-enc-dec.config` & `returnn-1.20230509.160323/demos/demo-tf-enc-dec.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-hard-att-copy.config` & `returnn-1.20230509.160323/demos/demo-tf-hard-att-copy.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-lstm-benchmark.py` & `returnn-1.20230509.160323/demos/demo-tf-lstm-benchmark.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-maxgradnorm-lstm.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-maxgradnorm-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-native-lstm-lowmem.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-native-lstm-lowmem.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-native-lstm.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-native-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-native-lstm2.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-native-lstm2.12ax.tuned.config` & `returnn-1.20230509.160323/demos/demo-tf-native-lstm2.12ax.tuned.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-neural-transducer.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-neural-transducer.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-rec-explicit-lstm.config` & `returnn-1.20230509.160323/demos/demo-tf-rec-explicit-lstm.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-rec-explicit-rnn.config` & `returnn-1.20230509.160323/demos/demo-tf-rec-explicit-rnn.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-rec-self-att.config` & `returnn-1.20230509.160323/demos/demo-tf-rec-self-att.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-search-compiled-graph.py` & `returnn-1.20230509.160323/demos/demo-tf-search-compiled-graph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-tf-vanilla-lstm.12ax.config` & `returnn-1.20230509.160323/demos/demo-tf-vanilla-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-timit-lstm-ctc.config` & `returnn-1.20230509.160323/demos/demo-timit-lstm-ctc.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-torch.config` & `returnn-1.20230509.160323/demos/demo-torch.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo-upd-mult-model.lstm.12ax.config` & `returnn-1.20230509.160323/demos/demo-upd-mult-model.lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/demo.sh` & `returnn-1.20230509.160323/demos/demo.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png` & `returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/a01-007-04.png` & `returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-04.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/IAM_lines/a01-007-06.png` & `returnn-1.20230509.160323/demos/mdlstm/IAM/IAM_lines/a01-007-06.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/README.txt` & `returnn-1.20230509.160323/demos/mdlstm/IAM/README.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/config_demo` & `returnn-1.20230509.160323/demos/mdlstm/IAM/config_demo`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/config_fwd` & `returnn-1.20230509.160323/demos/mdlstm/IAM/config_fwd`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/config_real` & `returnn-1.20230509.160323/demos/mdlstm/IAM/config_real`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/create_IAM_dataset.py` & `returnn-1.20230509.160323/demos/mdlstm/IAM/create_IAM_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/decode.py` & `returnn-1.20230509.160323/demos/mdlstm/IAM/decode.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/features/raw/demo.h5` & `returnn-1.20230509.160323/demos/mdlstm/IAM/features/raw/demo.h5`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/split/eval.txt` & `returnn-1.20230509.160323/demos/mdlstm/IAM/split/eval.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/split/train.txt` & `returnn-1.20230509.160323/demos/mdlstm/IAM/split/train.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/IAM/split/valid.txt` & `returnn-1.20230509.160323/demos/mdlstm/IAM/split/valid.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/artificial/create_test_h5.py` & `returnn-1.20230509.160323/demos/mdlstm/artificial/create_test_h5.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/artificial/forwardconfig` & `returnn-1.20230509.160323/demos/mdlstm/artificial/forwardconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/artificial/trainconfig` & `returnn-1.20230509.160323/demos/mdlstm/artificial/trainconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/create_test_h5.py` & `returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/create_test_h5.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/forwardconfig` & `returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/forwardconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/demos/mdlstm/artificial_rgb/trainconfig` & `returnn-1.20230509.160323/demos/mdlstm/artificial_rgb/trainconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/__init__.py` & `returnn-1.20230509.160323/returnn/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/__main__.py` & `returnn-1.20230509.160323/returnn/__main__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/__old_mod_loader__.py` & `returnn-1.20230509.160323/returnn/__old_mod_loader__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/__setup__.py` & `returnn-1.20230509.160323/returnn/__setup__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/config.py` & `returnn-1.20230509.160323/returnn/config.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/audio.py` & `returnn-1.20230509.160323/returnn/datasets/audio.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/basic.py` & `returnn-1.20230509.160323/returnn/datasets/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/bundle_file.py` & `returnn-1.20230509.160323/returnn/datasets/bundle_file.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/cached.py` & `returnn-1.20230509.160323/returnn/datasets/cached.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/cached2.py` & `returnn-1.20230509.160323/returnn/datasets/cached2.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/generating.py` & `returnn-1.20230509.160323/returnn/datasets/generating.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/hdf.py` & `returnn-1.20230509.160323/returnn/datasets/hdf.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/lm.py` & `returnn-1.20230509.160323/returnn/datasets/lm.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/map.py` & `returnn-1.20230509.160323/returnn/datasets/map.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/meta.py` & `returnn-1.20230509.160323/returnn/datasets/meta.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/multi_proc.py` & `returnn-1.20230509.160323/returnn/datasets/multi_proc.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/normalization_data.py` & `returnn-1.20230509.160323/returnn/datasets/normalization_data.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/numpy_dump.py` & `returnn-1.20230509.160323/returnn/datasets/numpy_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/raw_wav.py` & `returnn-1.20230509.160323/returnn/datasets/raw_wav.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/sprint.py` & `returnn-1.20230509.160323/returnn/datasets/sprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/stereo.py` & `returnn-1.20230509.160323/returnn/datasets/stereo.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/util/feature_extraction.py` & `returnn-1.20230509.160323/returnn/datasets/util/feature_extraction.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/datasets/util/vocabulary.py` & `returnn-1.20230509.160323/returnn/datasets/util/vocabulary.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/engine/base.py` & `returnn-1.20230509.160323/returnn/engine/base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/engine/batch.py` & `returnn-1.20230509.160323/returnn/engine/batch.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/__init__.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/__main__.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/__main__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/LICENSE` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/README.md` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/aligner.gif` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/aligner.gif`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/check.png` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/check.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/core.cu` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.cu`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/core.h` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/core_cpu.cpp` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/core_cpu.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/ref_rna.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/ref_rna.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/WarpRna/warp-rna/test.cpp` & `returnn-1.20230509.160323/returnn/extern/WarpRna/warp-rna/test.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/__init__.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/edit.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/edit.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/reroute.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/reroute.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/select.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/select.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/subgraph.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/subgraph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/transform.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/transform.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/extern/graph_editor/util.py` & `returnn-1.20230509.160323/returnn/extern/graph_editor/util.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/__init__.py` & `returnn-1.20230509.160323/returnn/frontend/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/_backend.py` & `returnn-1.20230509.160323/returnn/frontend/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/_numpy_backend.py` & `returnn-1.20230509.160323/returnn/frontend/_numpy_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/_utils.py` & `returnn-1.20230509.160323/returnn/frontend/_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/array_.py` & `returnn-1.20230509.160323/returnn/frontend/array_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/attention.py` & `returnn-1.20230509.160323/returnn/frontend/attention.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/cond.py` & `returnn-1.20230509.160323/returnn/frontend/cond.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/const.py` & `returnn-1.20230509.160323/returnn/frontend/const.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/container.py` & `returnn-1.20230509.160323/returnn/frontend/container.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/conv.py` & `returnn-1.20230509.160323/returnn/frontend/conv.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/device.py` & `returnn-1.20230509.160323/returnn/frontend/device.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/dims.py` & `returnn-1.20230509.160323/returnn/frontend/dims.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/dropout.py` & `returnn-1.20230509.160323/returnn/frontend/dropout.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/dtype.py` & `returnn-1.20230509.160323/returnn/frontend/dtype.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/encoder/base.py` & `returnn-1.20230509.160323/returnn/frontend/encoder/base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/encoder/conformer.py` & `returnn-1.20230509.160323/returnn/frontend/encoder/conformer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/init.py` & `returnn-1.20230509.160323/returnn/frontend/init.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/linear.py` & `returnn-1.20230509.160323/returnn/frontend/linear.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/loop.py` & `returnn-1.20230509.160323/returnn/frontend/loop.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/loss.py` & `returnn-1.20230509.160323/returnn/frontend/loss.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/math_.py` & `returnn-1.20230509.160323/returnn/frontend/math_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/matmul.py` & `returnn-1.20230509.160323/returnn/frontend/matmul.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/module.py` & `returnn-1.20230509.160323/returnn/frontend/module.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/normalization.py` & `returnn-1.20230509.160323/returnn/frontend/normalization.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/parameter.py` & `returnn-1.20230509.160323/returnn/frontend/parameter.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/rand.py` & `returnn-1.20230509.160323/returnn/frontend/rand.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/rec.py` & `returnn-1.20230509.160323/returnn/frontend/rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/reduce.py` & `returnn-1.20230509.160323/returnn/frontend/reduce.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/run_ctx.py` & `returnn-1.20230509.160323/returnn/frontend/run_ctx.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/signal.py` & `returnn-1.20230509.160323/returnn/frontend/signal.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/state.py` & `returnn-1.20230509.160323/returnn/frontend/state.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/frontend/types.py` & `returnn-1.20230509.160323/returnn/frontend/types.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/import_/common.py` & `returnn-1.20230509.160323/returnn/import_/common.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/import_/git.py` & `returnn-1.20230509.160323/returnn/import_/git.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/import_/import_.py` & `returnn-1.20230509.160323/returnn/import_/import_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/learning_rate_control.py` & `returnn-1.20230509.160323/returnn/learning_rate_control.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/log.py` & `returnn-1.20230509.160323/returnn/log.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/native_op.cpp` & `returnn-1.20230509.160323/returnn/native_op.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/native_op.py` & `returnn-1.20230509.160323/returnn/native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/pretrain.py` & `returnn-1.20230509.160323/returnn/pretrain.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/sprint/cache.py` & `returnn-1.20230509.160323/returnn/sprint/cache.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/sprint/control.py` & `returnn-1.20230509.160323/returnn/sprint/control.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/sprint/error_signals.py` & `returnn-1.20230509.160323/returnn/sprint/error_signals.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/sprint/extern_interface.py` & `returnn-1.20230509.160323/returnn/sprint/extern_interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/sprint/interface.py` & `returnn-1.20230509.160323/returnn/sprint/interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/_dim_extra.py` & `returnn-1.20230509.160323/returnn/tensor/_dim_extra.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/_tensor_extra.py` & `returnn-1.20230509.160323/returnn/tensor/_tensor_extra.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/_tensor_mixin_base.py` & `returnn-1.20230509.160323/returnn/tensor/_tensor_mixin_base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/_tensor_op_overloads.py` & `returnn-1.20230509.160323/returnn/tensor/_tensor_op_overloads.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/control_flow_ctx.py` & `returnn-1.20230509.160323/returnn/tensor/control_flow_ctx.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/dim.py` & `returnn-1.20230509.160323/returnn/tensor/dim.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/marked_dim.py` & `returnn-1.20230509.160323/returnn/tensor/marked_dim.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/tensor.py` & `returnn-1.20230509.160323/returnn/tensor/tensor.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tensor/tensor_dict.py` & `returnn-1.20230509.160323/returnn/tensor/tensor_dict.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/compat.py` & `returnn-1.20230509.160323/returnn/tf/compat.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/data_pipeline.py` & `returnn-1.20230509.160323/returnn/tf/data_pipeline.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/distributed.py` & `returnn-1.20230509.160323/returnn/tf/distributed.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/engine.py` & `returnn-1.20230509.160323/returnn/tf/engine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/_backend.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/_utils.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/cond.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/cond.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/config_entry_points.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/config_entry_points.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/debug_eager_mode.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/debug_eager_mode.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/dims.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/dims.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/layer.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/layer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/make_layer.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/make_layer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/parameter_assign.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/parameter_assign.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_layers/prev_tensor_ref.py` & `returnn-1.20230509.160323/returnn/tf/frontend_layers/prev_tensor_ref.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/frontend_low_level/_backend.py` & `returnn-1.20230509.160323/returnn/tf/frontend_low_level/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/horovod.py` & `returnn-1.20230509.160323/returnn/tf/horovod.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/hyper_param_tuning.py` & `returnn-1.20230509.160323/returnn/tf/hyper_param_tuning.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/layers/base.py` & `returnn-1.20230509.160323/returnn/tf/layers/base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/layers/basic.py` & `returnn-1.20230509.160323/returnn/tf/layers/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/layers/rec.py` & `returnn-1.20230509.160323/returnn/tf/layers/rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/layers/segmental_model.py` & `returnn-1.20230509.160323/returnn/tf/layers/segmental_model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/layers/signal_processing.py` & `returnn-1.20230509.160323/returnn/tf/layers/signal_processing.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/layers/variable.py` & `returnn-1.20230509.160323/returnn/tf/layers/variable.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/native_op.py` & `returnn-1.20230509.160323/returnn/tf/native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/network.py` & `returnn-1.20230509.160323/returnn/tf/network.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/sprint.py` & `returnn-1.20230509.160323/returnn/tf/sprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/updater.py` & `returnn-1.20230509.160323/returnn/tf/updater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/util/basic.py` & `returnn-1.20230509.160323/returnn/tf/util/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/util/data.py` & `returnn-1.20230509.160323/returnn/tf/util/data.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/util/ken_lm.py` & `returnn-1.20230509.160323/returnn/tf/util/ken_lm.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/tf/util/open_fst.py` & `returnn-1.20230509.160323/returnn/tf/util/open_fst.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/data/pipeline.py` & `returnn-1.20230509.160323/returnn/torch/data/pipeline.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/data/returnn_dataset_wrapper.py` & `returnn-1.20230509.160323/returnn/torch/data/returnn_dataset_wrapper.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/data/tensor_utils.py` & `returnn-1.20230509.160323/returnn/torch/data/tensor_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/engine.py` & `returnn-1.20230509.160323/returnn/torch/engine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/frontend/_backend.py` & `returnn-1.20230509.160323/returnn/torch/frontend/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/frontend/_rand.py` & `returnn-1.20230509.160323/returnn/torch/frontend/_rand.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/frontend/bridge.py` & `returnn-1.20230509.160323/returnn/torch/frontend/bridge.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/torch/updater.py` & `returnn-1.20230509.160323/returnn/torch/updater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/basic.py` & `returnn-1.20230509.160323/returnn/util/basic.py`

 * *Files 0% similar despite different names*

```diff
@@ -3121,5938 +3121,5938 @@
 0000c300: 6179 206c 733a 0a20 2020 203a 7274 7970  ay ls:.    :rtyp
 0000c310: 653a 2054 7c69 6e74 7c66 6c6f 6174 0a20  e: T|int|float. 
 0000c320: 2020 2022 2222 0a20 2020 2069 6620 6c65     """.    if le
 0000c330: 6e28 6c73 2920 3d3d 2030 3a0a 2020 2020  n(ls) == 0:.    
 0000c340: 2020 2020 7265 7475 726e 2031 0a20 2020      return 1.   
 0000c350: 2078 203d 206c 735b 305d 0a20 2020 2066   x = ls[0].    f
 0000c360: 6f72 2079 2069 6e20 6c73 5b31 3a5d 3a0a  or y in ls[1:]:.
-0000c370: 2020 2020 2020 2020 7820 2a3d 2079 0a20          x *= y. 
-0000c380: 2020 2072 6574 7572 6e20 780a 0a0a 6465     return x...de
-0000c390: 6620 7061 7273 655f 6f72 7468 6f67 7261  f parse_orthogra
-0000c3a0: 7068 795f 696e 746f 5f73 796d 626f 6c73  phy_into_symbols
-0000c3b0: 280a 2020 2020 6f72 7468 6f67 7261 7068  (.    orthograph
-0000c3c0: 792c 2075 7070 6572 5f63 6173 655f 7370  y, upper_case_sp
-0000c3d0: 6563 6961 6c3d 5472 7565 2c20 776f 7264  ecial=True, word
-0000c3e0: 5f62 6173 6564 3d46 616c 7365 2c20 7371  _based=False, sq
-0000c3f0: 7561 7265 5f62 7261 636b 6574 735f 666f  uare_brackets_fo
-0000c400: 725f 7370 6563 6961 6c73 3d54 7275 650a  r_specials=True.
-0000c410: 293a 0a20 2020 2022 2222 0a20 2020 2046  ):.    """.    F
-0000c420: 6f72 2053 7065 6563 682e 0a20 2020 2045  or Speech..    E
-0000c430: 7861 6d70 6c65 3a0a 2020 2020 2020 6f72  xample:.      or
-0000c440: 7468 6f67 7261 7068 7920 3d20 2268 656c  thography = "hel
-0000c450: 6c6f 205b 4845 5349 5441 5449 4f4e 5d20  lo [HESITATION] 
-0000c460: 7468 6572 6520 220a 2020 2020 2020 7769  there ".      wi
-0000c470: 7468 2077 6f72 645f 6261 7365 6420 3d3d  th word_based ==
-0000c480: 2046 616c 7365 3a20 7265 7475 726e 7320   False: returns 
-0000c490: 6c69 7374 2822 6865 6c6c 6f20 2229 202b  list("hello ") +
-0000c4a0: 205b 225b 4845 5349 5441 5449 4f4e 5d22   ["[HESITATION]"
-0000c4b0: 5d20 2b20 6c69 7374 2822 2074 6865 7265  ] + list(" there
-0000c4c0: 2022 292e 0a20 2020 2020 2077 6974 6820   ")..      with 
-0000c4d0: 776f 7264 5f62 6173 6564 203d 3d20 5472  word_based == Tr
-0000c4e0: 7565 3a20 7265 7475 726e 7320 5b22 6865  ue: returns ["he
-0000c4f0: 6c6c 6f22 2c20 225b 4845 5349 5441 5449  llo", "[HESITATI
-0000c500: 4f4e 5d22 2c20 2274 6865 7265 225d 0a20  ON]", "there"]. 
-0000c510: 2020 204e 6f20 7072 652f 706f 7374 2d70     No pre/post-p
-0000c520: 726f 6365 7373 696e 6720 7375 6368 2061  rocessing such a
-0000c530: 733a 0a20 2020 2053 7061 6365 7320 6172  s:.    Spaces ar
-0000c540: 6520 6b65 7074 2061 732d 6973 2e20 4e6f  e kept as-is. No
-0000c550: 2073 7472 6970 7069 6e67 2061 7420 6265   stripping at be
-0000c560: 6769 6e2f 656e 642e 2028 452e 672e 2074  gin/end. (E.g. t
-0000c570: 7261 696c 696e 6720 7370 6163 6573 2061  railing spaces a
-0000c580: 7265 206e 6f74 2072 656d 6f76 6564 2e29  re not removed.)
-0000c590: 0a20 2020 204e 6f20 746f 6c6f 7765 722f  .    No tolower/
-0000c5a0: 746f 7570 7065 722e 0a20 2020 2044 6f65  toupper..    Doe
-0000c5b0: 736e 2774 2061 6464 205b 4245 4749 4e5d  sn't add [BEGIN]
-0000c5c0: 2f5b 454e 445d 2073 796d 626f 6c73 206f  /[END] symbols o
-0000c5d0: 7220 736f 2e0a 2020 2020 416e 7920 7375  r so..    Any su
-0000c5e0: 6368 206f 7065 7261 7469 6f6e 7320 7368  ch operations sh
-0000c5f0: 6f75 6c64 2062 6520 646f 6e65 2065 7870  ould be done exp
-0000c600: 6c69 6369 746c 7920 696e 2061 6e20 6164  licitly in an ad
-0000c610: 6469 7469 6f6e 616c 2066 756e 6374 696f  ditional functio
-0000c620: 6e2e 0a20 2020 2041 6e79 7468 696e 6720  n..    Anything 
-0000c630: 696e 205b 5d2d 6272 6163 6b65 7473 2061  in []-brackets a
-0000c640: 7265 206d 6561 6e74 2061 7320 7370 6563  re meant as spec
-0000c650: 6961 6c2d 7379 6d62 6f6c 732e 0a20 2020  ial-symbols..   
-0000c660: 2041 6c73 6f20 7365 6520 7061 7273 655f   Also see parse_
-0000c670: 6f72 7468 6f67 7261 7068 7928 2920 7768  orthography() wh
-0000c680: 6963 6820 696e 636c 7564 6573 2073 6f6d  ich includes som
-0000c690: 6520 7072 6570 726f 6365 7373 696e 672e  e preprocessing.
-0000c6a0: 0a0a 2020 2020 3a70 6172 616d 2073 7472  ..    :param str
-0000c6b0: 206f 7274 686f 6772 6170 6879 3a20 6578   orthography: ex
-0000c6c0: 616d 706c 653a 2022 6865 6c6c 6f20 5b48  ample: "hello [H
-0000c6d0: 4553 4954 4154 494f 4e5d 2074 6865 7265  ESITATION] there
-0000c6e0: 2022 0a20 2020 203a 7061 7261 6d20 626f   ".    :param bo
-0000c6f0: 6f6c 2075 7070 6572 5f63 6173 655f 7370  ol upper_case_sp
-0000c700: 6563 6961 6c3a 2077 6865 7468 6572 2074  ecial: whether t
-0000c710: 6865 2073 7065 6369 616c 2073 796d 626f  he special symbo
-0000c720: 6c73 2061 7265 2061 6c77 6179 7320 6d61  ls are always ma
-0000c730: 6465 2075 7070 6572 2063 6173 650a 2020  de upper case.  
-0000c740: 2020 3a70 6172 616d 2062 6f6f 6c20 776f    :param bool wo
-0000c750: 7264 5f62 6173 6564 3a20 7768 6574 6865  rd_based: whethe
-0000c760: 7220 7765 2073 706c 6974 206f 6e20 7370  r we split on sp
-0000c770: 6163 6520 616e 6420 7265 7475 726e 2066  ace and return f
-0000c780: 756c 6c20 776f 7264 730a 2020 2020 3a70  ull words.    :p
-0000c790: 6172 616d 2062 6f6f 6c20 7371 7561 7265  aram bool square
-0000c7a0: 5f62 7261 636b 6574 735f 666f 725f 7370  _brackets_for_sp
-0000c7b0: 6563 6961 6c73 3a20 6861 6e64 6c65 2022  ecials: handle "
-0000c7c0: 5b2e 2e2e 5d22 0a20 2020 203a 7274 7970  [...]".    :rtyp
-0000c7d0: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
-0000c7e0: 2022 2222 0a20 2020 2072 6574 203d 205b   """.    ret = [
-0000c7f0: 5d0a 2020 2020 696e 5f73 7065 6369 616c  ].    in_special
-0000c800: 203d 2030 0a20 2020 2066 6f72 2063 2069   = 0.    for c i
-0000c810: 6e20 6f72 7468 6f67 7261 7068 793a 0a20  n orthography:. 
-0000c820: 2020 2020 2020 2069 6620 696e 5f73 7065         if in_spe
-0000c830: 6369 616c 3a0a 2020 2020 2020 2020 2020  cial:.          
-0000c840: 2020 6966 2063 203d 3d20 225b 223a 2020    if c == "[":  
-0000c850: 2320 7370 6563 6961 6c2d 7370 6563 6961  # special-specia
-0000c860: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-0000c870: 2020 696e 5f73 7065 6369 616c 202b 3d20    in_special += 
-0000c880: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0000c890: 2020 7265 745b 2d31 5d20 2b3d 2022 5b22    ret[-1] += "["
-0000c8a0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000c8b0: 6620 6320 3d3d 2022 5d22 3a0a 2020 2020  f c == "]":.    
-0000c8c0: 2020 2020 2020 2020 2020 2020 696e 5f73              in_s
-0000c8d0: 7065 6369 616c 202d 3d20 310a 2020 2020  pecial -= 1.    
-0000c8e0: 2020 2020 2020 2020 2020 2020 7265 745b              ret[
-0000c8f0: 2d31 5d20 2b3d 2022 5d22 0a20 2020 2020  -1] += "]".     
-0000c900: 2020 2020 2020 2065 6c69 6620 7570 7065         elif uppe
-0000c910: 725f 6361 7365 5f73 7065 6369 616c 3a0a  r_case_special:.
-0000c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c930: 7265 745b 2d31 5d20 2b3d 2063 2e75 7070  ret[-1] += c.upp
-0000c940: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-0000c950: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000c960: 2020 2020 2020 2072 6574 5b2d 315d 202b         ret[-1] +
-0000c970: 3d20 630a 2020 2020 2020 2020 656c 7365  = c.        else
-0000c980: 3a20 2023 206e 6f74 2069 6e5f 7370 6563  :  # not in_spec
-0000c990: 6961 6c0a 2020 2020 2020 2020 2020 2020  ial.            
-0000c9a0: 6966 2073 7175 6172 655f 6272 6163 6b65  if square_bracke
-0000c9b0: 7473 5f66 6f72 5f73 7065 6369 616c 7320  ts_for_specials 
-0000c9c0: 616e 6420 6320 3d3d 2022 5b22 3a0a 2020  and c == "[":.  
-0000c9d0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0000c9e0: 5f73 7065 6369 616c 203d 2031 0a20 2020  _special = 1.   
-0000c9f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000ca00: 202b 3d20 5b22 5b22 5d0a 2020 2020 2020   += ["["].      
-0000ca10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000ca20: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-0000ca30: 6f72 645f 6261 7365 643a 0a20 2020 2020  ord_based:.     
-0000ca40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000ca50: 6620 632e 6973 7370 6163 6528 293a 0a20  f c.isspace():. 
-0000ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca70: 2020 2020 2020 2072 6574 202b 3d20 5b22         ret += ["
-0000ca80: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-0000ca90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000c370: 2020 2020 2020 2020 7820 3d20 7820 2a20          x = x * 
+0000c380: 790a 2020 2020 7265 7475 726e 2078 0a0a  y.    return x..
+0000c390: 0a64 6566 2070 6172 7365 5f6f 7274 686f  .def parse_ortho
+0000c3a0: 6772 6170 6879 5f69 6e74 6f5f 7379 6d62  graphy_into_symb
+0000c3b0: 6f6c 7328 0a20 2020 206f 7274 686f 6772  ols(.    orthogr
+0000c3c0: 6170 6879 2c20 7570 7065 725f 6361 7365  aphy, upper_case
+0000c3d0: 5f73 7065 6369 616c 3d54 7275 652c 2077  _special=True, w
+0000c3e0: 6f72 645f 6261 7365 643d 4661 6c73 652c  ord_based=False,
+0000c3f0: 2073 7175 6172 655f 6272 6163 6b65 7473   square_brackets
+0000c400: 5f66 6f72 5f73 7065 6369 616c 733d 5472  _for_specials=Tr
+0000c410: 7565 0a29 3a0a 2020 2020 2222 220a 2020  ue.):.    """.  
+0000c420: 2020 466f 7220 5370 6565 6368 2e0a 2020    For Speech..  
+0000c430: 2020 4578 616d 706c 653a 0a20 2020 2020    Example:.     
+0000c440: 206f 7274 686f 6772 6170 6879 203d 2022   orthography = "
+0000c450: 6865 6c6c 6f20 5b48 4553 4954 4154 494f  hello [HESITATIO
+0000c460: 4e5d 2074 6865 7265 2022 0a20 2020 2020  N] there ".     
+0000c470: 2077 6974 6820 776f 7264 5f62 6173 6564   with word_based
+0000c480: 203d 3d20 4661 6c73 653a 2072 6574 7572   == False: retur
+0000c490: 6e73 206c 6973 7428 2268 656c 6c6f 2022  ns list("hello "
+0000c4a0: 2920 2b20 5b22 5b48 4553 4954 4154 494f  ) + ["[HESITATIO
+0000c4b0: 4e5d 225d 202b 206c 6973 7428 2220 7468  N]"] + list(" th
+0000c4c0: 6572 6520 2229 2e0a 2020 2020 2020 7769  ere ")..      wi
+0000c4d0: 7468 2077 6f72 645f 6261 7365 6420 3d3d  th word_based ==
+0000c4e0: 2054 7275 653a 2072 6574 7572 6e73 205b   True: returns [
+0000c4f0: 2268 656c 6c6f 222c 2022 5b48 4553 4954  "hello", "[HESIT
+0000c500: 4154 494f 4e5d 222c 2022 7468 6572 6522  ATION]", "there"
+0000c510: 5d0a 2020 2020 4e6f 2070 7265 2f70 6f73  ].    No pre/pos
+0000c520: 742d 7072 6f63 6573 7369 6e67 2073 7563  t-processing suc
+0000c530: 6820 6173 3a0a 2020 2020 5370 6163 6573  h as:.    Spaces
+0000c540: 2061 7265 206b 6570 7420 6173 2d69 732e   are kept as-is.
+0000c550: 204e 6f20 7374 7269 7070 696e 6720 6174   No stripping at
+0000c560: 2062 6567 696e 2f65 6e64 2e20 2845 2e67   begin/end. (E.g
+0000c570: 2e20 7472 6169 6c69 6e67 2073 7061 6365  . trailing space
+0000c580: 7320 6172 6520 6e6f 7420 7265 6d6f 7665  s are not remove
+0000c590: 642e 290a 2020 2020 4e6f 2074 6f6c 6f77  d.).    No tolow
+0000c5a0: 6572 2f74 6f75 7070 6572 2e0a 2020 2020  er/toupper..    
+0000c5b0: 446f 6573 6e27 7420 6164 6420 5b42 4547  Doesn't add [BEG
+0000c5c0: 494e 5d2f 5b45 4e44 5d20 7379 6d62 6f6c  IN]/[END] symbol
+0000c5d0: 7320 6f72 2073 6f2e 0a20 2020 2041 6e79  s or so..    Any
+0000c5e0: 2073 7563 6820 6f70 6572 6174 696f 6e73   such operations
+0000c5f0: 2073 686f 756c 6420 6265 2064 6f6e 6520   should be done 
+0000c600: 6578 706c 6963 6974 6c79 2069 6e20 616e  explicitly in an
+0000c610: 2061 6464 6974 696f 6e61 6c20 6675 6e63   additional func
+0000c620: 7469 6f6e 2e0a 2020 2020 416e 7974 6869  tion..    Anythi
+0000c630: 6e67 2069 6e20 5b5d 2d62 7261 636b 6574  ng in []-bracket
+0000c640: 7320 6172 6520 6d65 616e 7420 6173 2073  s are meant as s
+0000c650: 7065 6369 616c 2d73 796d 626f 6c73 2e0a  pecial-symbols..
+0000c660: 2020 2020 416c 736f 2073 6565 2070 6172      Also see par
+0000c670: 7365 5f6f 7274 686f 6772 6170 6879 2829  se_orthography()
+0000c680: 2077 6869 6368 2069 6e63 6c75 6465 7320   which includes 
+0000c690: 736f 6d65 2070 7265 7072 6f63 6573 7369  some preprocessi
+0000c6a0: 6e67 2e0a 0a20 2020 203a 7061 7261 6d20  ng...    :param 
+0000c6b0: 7374 7220 6f72 7468 6f67 7261 7068 793a  str orthography:
+0000c6c0: 2065 7861 6d70 6c65 3a20 2268 656c 6c6f   example: "hello
+0000c6d0: 205b 4845 5349 5441 5449 4f4e 5d20 7468   [HESITATION] th
+0000c6e0: 6572 6520 220a 2020 2020 3a70 6172 616d  ere ".    :param
+0000c6f0: 2062 6f6f 6c20 7570 7065 725f 6361 7365   bool upper_case
+0000c700: 5f73 7065 6369 616c 3a20 7768 6574 6865  _special: whethe
+0000c710: 7220 7468 6520 7370 6563 6961 6c20 7379  r the special sy
+0000c720: 6d62 6f6c 7320 6172 6520 616c 7761 7973  mbols are always
+0000c730: 206d 6164 6520 7570 7065 7220 6361 7365   made upper case
+0000c740: 0a20 2020 203a 7061 7261 6d20 626f 6f6c  .    :param bool
+0000c750: 2077 6f72 645f 6261 7365 643a 2077 6865   word_based: whe
+0000c760: 7468 6572 2077 6520 7370 6c69 7420 6f6e  ther we split on
+0000c770: 2073 7061 6365 2061 6e64 2072 6574 7572   space and retur
+0000c780: 6e20 6675 6c6c 2077 6f72 6473 0a20 2020  n full words.   
+0000c790: 203a 7061 7261 6d20 626f 6f6c 2073 7175   :param bool squ
+0000c7a0: 6172 655f 6272 6163 6b65 7473 5f66 6f72  are_brackets_for
+0000c7b0: 5f73 7065 6369 616c 733a 2068 616e 646c  _specials: handl
+0000c7c0: 6520 225b 2e2e 2e5d 220a 2020 2020 3a72  e "[...]".    :r
+0000c7d0: 7479 7065 3a20 6c69 7374 5b73 7472 5d0a  type: list[str].
+0000c7e0: 2020 2020 2222 220a 2020 2020 7265 7420      """.    ret 
+0000c7f0: 3d20 5b5d 0a20 2020 2069 6e5f 7370 6563  = [].    in_spec
+0000c800: 6961 6c20 3d20 300a 2020 2020 666f 7220  ial = 0.    for 
+0000c810: 6320 696e 206f 7274 686f 6772 6170 6879  c in orthography
+0000c820: 3a0a 2020 2020 2020 2020 6966 2069 6e5f  :.        if in_
+0000c830: 7370 6563 6961 6c3a 0a20 2020 2020 2020  special:.       
+0000c840: 2020 2020 2069 6620 6320 3d3d 2022 5b22       if c == "["
+0000c850: 3a20 2023 2073 7065 6369 616c 2d73 7065  :  # special-spe
+0000c860: 6369 616c 0a20 2020 2020 2020 2020 2020  cial.           
+0000c870: 2020 2020 2069 6e5f 7370 6563 6961 6c20       in_special 
+0000c880: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0000c890: 2020 2020 2072 6574 5b2d 315d 202b 3d20       ret[-1] += 
+0000c8a0: 225b 220a 2020 2020 2020 2020 2020 2020  "[".            
+0000c8b0: 656c 6966 2063 203d 3d20 225d 223a 0a20  elif c == "]":. 
+0000c8c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c8d0: 6e5f 7370 6563 6961 6c20 2d3d 2031 0a20  n_special -= 1. 
+0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000c8f0: 6574 5b2d 315d 202b 3d20 225d 220a 2020  et[-1] += "]".  
+0000c900: 2020 2020 2020 2020 2020 656c 6966 2075            elif u
+0000c910: 7070 6572 5f63 6173 655f 7370 6563 6961  pper_case_specia
+0000c920: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
+0000c930: 2020 2072 6574 5b2d 315d 202b 3d20 632e     ret[-1] += c.
+0000c940: 7570 7065 7228 290a 2020 2020 2020 2020  upper().        
+0000c950: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c960: 2020 2020 2020 2020 2020 7265 745b 2d31            ret[-1
+0000c970: 5d20 2b3d 2063 0a20 2020 2020 2020 2065  ] += c.        e
+0000c980: 6c73 653a 2020 2320 6e6f 7420 696e 5f73  lse:  # not in_s
+0000c990: 7065 6369 616c 0a20 2020 2020 2020 2020  pecial.         
+0000c9a0: 2020 2069 6620 7371 7561 7265 5f62 7261     if square_bra
+0000c9b0: 636b 6574 735f 666f 725f 7370 6563 6961  ckets_for_specia
+0000c9c0: 6c73 2061 6e64 2063 203d 3d20 225b 223a  ls and c == "[":
+0000c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9e0: 2069 6e5f 7370 6563 6961 6c20 3d20 310a   in_special = 1.
+0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca00: 7265 7420 2b3d 205b 225b 225d 0a20 2020  ret += ["["].   
+0000ca10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000ca20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ca30: 6620 776f 7264 5f62 6173 6564 3a0a 2020  f word_based:.  
+0000ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca50: 2020 6966 2063 2e69 7373 7061 6365 2829    if c.isspace()
+0000ca60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ca70: 2020 2020 2020 2020 2020 7265 7420 2b3d            ret +=
+0000ca80: 205b 2222 5d0a 2020 2020 2020 2020 2020   [""].          
+0000ca90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cab0: 2020 2020 2069 6620 6e6f 7420 7265 743a       if not ret:
-0000cac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cad0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000cae0: 202b 3d20 5b22 225d 0a20 2020 2020 2020   += [""].       
+0000cab0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+0000cac0: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
+0000cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cae0: 7265 7420 2b3d 205b 2222 5d0a 2020 2020  ret += [""].    
 0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb00: 2072 6574 5b2d 315d 202b 3d20 630a 2020   ret[-1] += c.  
-0000cb10: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000cb20: 7365 3a20 2023 206e 6f74 2077 6f72 645f  se:  # not word_
-0000cb30: 6261 7365 640a 2020 2020 2020 2020 2020  based.          
-0000cb40: 2020 2020 2020 2020 2020 7265 7420 2b3d            ret +=
-0000cb50: 2063 0a20 2020 2072 6574 7572 6e20 7265   c.    return re
-0000cb60: 740a 0a0a 6465 6620 7061 7273 655f 6f72  t...def parse_or
-0000cb70: 7468 6f67 7261 7068 7928 0a20 2020 206f  thography(.    o
-0000cb80: 7274 686f 6772 6170 6879 2c20 7072 6566  rthography, pref
-0000cb90: 6978 3d28 292c 2070 6f73 7466 6978 3d28  ix=(), postfix=(
-0000cba0: 225b 454e 445d 222c 292c 2072 656d 6f76  "[END]",), remov
-0000cbb0: 655f 6368 6172 733d 2228 297b 7d22 2c20  e_chars="(){}", 
-0000cbc0: 636f 6c6c 6170 7365 5f73 7061 6365 733d  collapse_spaces=
-0000cbd0: 5472 7565 2c20 6669 6e61 6c5f 7374 7269  True, final_stri
-0000cbe0: 703d 5472 7565 2c20 2a2a 6b77 6172 6773  p=True, **kwargs
-0000cbf0: 0a29 3a0a 2020 2020 2222 220a 2020 2020  .):.    """.    
-0000cc00: 466f 7220 5370 6565 6368 2e20 4675 6c6c  For Speech. Full
-0000cc10: 2070 726f 6365 7373 696e 672e 0a20 2020   processing..   
-0000cc20: 2045 7861 6d70 6c65 3a0a 2020 2020 2020   Example:.      
-0000cc30: 6f72 7468 6f67 7261 7068 7920 3d20 2268  orthography = "h
-0000cc40: 656c 6c6f 205b 4845 5349 5441 5449 4f4e  ello [HESITATION
-0000cc50: 5d20 7468 6572 6520 220a 2020 2020 2020  ] there ".      
-0000cc60: 7769 7468 2077 6f72 645f 6261 7365 6420  with word_based 
-0000cc70: 3d3d 2046 616c 7365 3a20 7265 7475 726e  == False: return
-0000cc80: 7320 6c69 7374 2822 6865 6c6c 6f20 2229  s list("hello ")
-0000cc90: 202b 205b 225b 4845 5349 5441 5449 4f4e   + ["[HESITATION
-0000cca0: 5d22 5d20 2b20 6c69 7374 2822 2074 6865  ]"] + list(" the
-0000ccb0: 7265 2229 202b 205b 225b 454e 445d 225d  re") + ["[END]"]
-0000ccc0: 0a20 2020 2020 2077 6974 6820 776f 7264  .      with word
-0000ccd0: 5f62 6173 6564 203d 3d20 5472 7565 3a20  _based == True: 
-0000cce0: 7265 7475 726e 7320 5b22 6865 6c6c 6f22  returns ["hello"
-0000ccf0: 2c20 225b 4845 5349 5441 5449 4f4e 5d22  , "[HESITATION]"
-0000cd00: 2c20 2274 6865 7265 222c 2022 5b45 4e44  , "there", "[END
-0000cd10: 5d22 5d0a 2020 2020 446f 6573 2073 6f6d  ]"].    Does som
-0000cd20: 6520 7072 6570 726f 6365 7373 696e 6720  e preprocessing 
-0000cd30: 6f6e 206f 7274 686f 6772 6170 6879 2061  on orthography a
-0000cd40: 6e64 2074 6865 6e20 7061 7373 6573 2069  nd then passes i
-0000cd50: 7420 6f6e 2074 6f20 7061 7273 655f 6f72  t on to parse_or
-0000cd60: 7468 6f67 7261 7068 795f 696e 746f 5f73  thography_into_s
-0000cd70: 796d 626f 6c73 2829 2e0a 0a20 2020 203a  ymbols()...    :
-0000cd80: 7061 7261 6d20 7374 7220 6f72 7468 6f67  param str orthog
-0000cd90: 7261 7068 793a 2065 2e67 2e20 2268 656c  raphy: e.g. "hel
-0000cda0: 6c6f 205b 4845 5349 5441 5449 4f4e 5d20  lo [HESITATION] 
-0000cdb0: 7468 6572 6520 220a 2020 2020 3a70 6172  there ".    :par
-0000cdc0: 616d 206c 6973 745b 7374 725d 2070 7265  am list[str] pre
-0000cdd0: 6669 783a 2077 696c 6c20 6164 6420 7468  fix: will add th
-0000cde0: 6973 2070 7265 6669 780a 2020 2020 3a70  is prefix.    :p
-0000cdf0: 6172 616d 206c 6973 745b 7374 725d 2070  aram list[str] p
-0000ce00: 6f73 7466 6978 3a20 7769 6c6c 2061 6464  ostfix: will add
-0000ce10: 2074 6869 7320 706f 7374 6669 780a 2020   this postfix.  
-0000ce20: 2020 3a70 6172 616d 2073 7472 2072 656d    :param str rem
-0000ce30: 6f76 655f 6368 6172 733a 2074 686f 7365  ove_chars: those
-0000ce40: 2063 6861 7273 2077 696c 6c20 6a75 7374   chars will just
-0000ce50: 2062 6520 7265 6d6f 7665 6420 6174 2074   be removed at t
-0000ce60: 6865 2062 6567 696e 6e69 6e67 0a20 2020  he beginning.   
-0000ce70: 203a 7061 7261 6d20 626f 6f6c 2063 6f6c   :param bool col
-0000ce80: 6c61 7073 655f 7370 6163 6573 3a20 7768  lapse_spaces: wh
-0000ce90: 6574 6865 7220 6d75 6c74 6970 6c65 2073  ether multiple s
-0000cea0: 7061 6365 7320 616e 6420 7461 6273 2061  paces and tabs a
-0000ceb0: 7265 2063 6f6c 6c61 7073 6564 2069 6e74  re collapsed int
-0000cec0: 6f20 6120 7369 6e67 6c65 2073 7061 6365  o a single space
-0000ced0: 0a20 2020 203a 7061 7261 6d20 626f 6f6c  .    :param bool
-0000cee0: 2066 696e 616c 5f73 7472 6970 3a20 7768   final_strip: wh
-0000cef0: 6574 6865 7220 7765 2073 7472 6970 206c  ether we strip l
-0000cf00: 6566 7420 616e 6420 7269 6768 740a 2020  eft and right.  
-0000cf10: 2020 3a70 6172 616d 206b 7761 7267 733a    :param kwargs:
-0000cf20: 2070 6173 7365 6420 6f6e 2074 6f20 7061   passed on to pa
-0000cf30: 7273 655f 6f72 7468 6f67 7261 7068 795f  rse_orthography_
-0000cf40: 696e 746f 5f73 796d 626f 6c73 2829 0a20  into_symbols(). 
-0000cf50: 2020 203a 7274 7970 653a 206c 6973 745b     :rtype: list[
-0000cf60: 7374 725d 0a20 2020 2022 2222 0a20 2020  str].    """.   
-0000cf70: 2066 6f72 2063 2069 6e20 7265 6d6f 7665   for c in remove
-0000cf80: 5f63 6861 7273 3a0a 2020 2020 2020 2020  _chars:.        
-0000cf90: 6f72 7468 6f67 7261 7068 7920 3d20 6f72  orthography = or
-0000cfa0: 7468 6f67 7261 7068 792e 7265 706c 6163  thography.replac
-0000cfb0: 6528 632c 2022 2229 0a20 2020 2069 6620  e(c, "").    if 
-0000cfc0: 636f 6c6c 6170 7365 5f73 7061 6365 733a  collapse_spaces:
-0000cfd0: 0a20 2020 2020 2020 206f 7274 686f 6772  .        orthogr
-0000cfe0: 6170 6879 203d 2022 2022 2e6a 6f69 6e28  aphy = " ".join(
-0000cff0: 6f72 7468 6f67 7261 7068 792e 7370 6c69  orthography.spli
-0000d000: 7428 2929 0a20 2020 2069 6620 6669 6e61  t()).    if fina
-0000d010: 6c5f 7374 7269 703a 0a20 2020 2020 2020  l_strip:.       
-0000d020: 206f 7274 686f 6772 6170 6879 203d 206f   orthography = o
-0000d030: 7274 686f 6772 6170 6879 2e73 7472 6970  rthography.strip
-0000d040: 2829 0a20 2020 2072 6574 7572 6e20 6c69  ().    return li
-0000d050: 7374 2870 7265 6669 7829 202b 2070 6172  st(prefix) + par
-0000d060: 7365 5f6f 7274 686f 6772 6170 6879 5f69  se_orthography_i
-0000d070: 6e74 6f5f 7379 6d62 6f6c 7328 6f72 7468  nto_symbols(orth
-0000d080: 6f67 7261 7068 792c 202a 2a6b 7761 7267  ography, **kwarg
-0000d090: 7329 202b 206c 6973 7428 706f 7374 6669  s) + list(postfi
-0000d0a0: 7829 0a0a 0a64 6566 206a 736f 6e5f 7265  x)...def json_re
-0000d0b0: 6d6f 7665 5f63 6f6d 6d65 6e74 7328 7374  move_comments(st
-0000d0c0: 7269 6e67 2c20 7374 7269 705f 7370 6163  ring, strip_spac
-0000d0d0: 653d 5472 7565 293a 0a20 2020 2022 2222  e=True):.    """
-0000d0e0: 0a20 2020 203a 7479 7065 2073 7472 696e  .    :type strin
-0000d0f0: 673a 2073 7472 0a20 2020 203a 7061 7261  g: str.    :para
-0000d100: 6d20 626f 6f6c 2073 7472 6970 5f73 7061  m bool strip_spa
-0000d110: 6365 3a0a 2020 2020 3a72 7479 7065 3a20  ce:.    :rtype: 
-0000d120: 7374 720a 0a20 2020 2076 6961 2068 7474  str..    via htt
-0000d130: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-0000d140: 6765 7469 6679 2f4a 534f 4e2e 6d69 6e69  getify/JSON.mini
-0000d150: 6679 2f62 6c6f 622f 6d61 7374 6572 2f6d  fy/blob/master/m
-0000d160: 696e 6966 795f 6a73 6f6e 2e70 792c 0a20  inify_json.py,. 
-0000d170: 2020 2062 7920 4765 7261 6c64 2053 746f     by Gerald Sto
-0000d180: 7265 722c 2050 7261 6479 756e 2053 2e20  rer, Pradyun S. 
-0000d190: 4765 6461 6d2c 206d 6f64 6966 6965 6420  Gedam, modified 
-0000d1a0: 6279 2075 732e 0a20 2020 2022 2222 0a20  by us..    """. 
-0000d1b0: 2020 2074 6f6b 656e 697a 6572 203d 2072     tokenizer = r
-0000d1c0: 652e 636f 6d70 696c 6528 2722 7c28 2f5c  e.compile('"|(/\
-0000d1d0: 5c2a 297c 285c 5c2a 2f29 7c28 2f2f 297c  \*)|(\\*/)|(//)|
-0000d1e0: 5c6e 7c5c 7227 290a 2020 2020 656e 645f  \n|\r').    end_
-0000d1f0: 736c 6173 6865 735f 7265 203d 2072 652e  slashes_re = re.
-0000d200: 636f 6d70 696c 6528 7222 285c 5c29 2a24  compile(r"(\\)*$
-0000d210: 2229 0a0a 2020 2020 696e 5f73 7472 696e  ")..    in_strin
-0000d220: 6720 3d20 4661 6c73 650a 2020 2020 696e  g = False.    in
-0000d230: 5f6d 756c 7469 203d 2046 616c 7365 0a20  _multi = False. 
-0000d240: 2020 2069 6e5f 7369 6e67 6c65 203d 2046     in_single = F
-0000d250: 616c 7365 0a0a 2020 2020 6e65 775f 7374  alse..    new_st
-0000d260: 7220 3d20 5b5d 0a20 2020 2069 6e64 6578  r = [].    index
-0000d270: 203d 2030 0a0a 2020 2020 666f 7220 6d61   = 0..    for ma
-0000d280: 7463 6820 696e 2072 652e 6669 6e64 6974  tch in re.findit
-0000d290: 6572 2874 6f6b 656e 697a 6572 2c20 7374  er(tokenizer, st
-0000d2a0: 7269 6e67 293a 0a0a 2020 2020 2020 2020  ring):..        
-0000d2b0: 6966 206e 6f74 2028 696e 5f6d 756c 7469  if not (in_multi
-0000d2c0: 206f 7220 696e 5f73 696e 676c 6529 3a0a   or in_single):.
-0000d2d0: 2020 2020 2020 2020 2020 2020 746d 7020              tmp 
-0000d2e0: 3d20 7374 7269 6e67 5b69 6e64 6578 203a  = string[index :
-0000d2f0: 206d 6174 6368 2e73 7461 7274 2829 5d0a   match.start()].
-0000d300: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000d310: 6f74 2069 6e5f 7374 7269 6e67 2061 6e64  ot in_string and
-0000d320: 2073 7472 6970 5f73 7061 6365 3a0a 2020   strip_space:.  
-0000d330: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000d340: 7265 706c 6163 6520 7768 6974 6520 7370  replace white sp
-0000d350: 6163 6520 6173 2064 6566 696e 6564 2069  ace as defined i
-0000d360: 6e20 7374 616e 6461 7264 0a20 2020 2020  n standard.     
-0000d370: 2020 2020 2020 2020 2020 2074 6d70 203d             tmp =
-0000d380: 2072 652e 7375 6228 225b 205c 745c 6e5c   re.sub("[ \t\n\
-0000d390: 725d 2b22 2c20 2222 2c20 746d 7029 0a20  r]+", "", tmp). 
-0000d3a0: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
-0000d3b0: 7472 2e61 7070 656e 6428 746d 7029 0a0a  tr.append(tmp)..
-0000d3c0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-0000d3d0: 6d61 7463 682e 656e 6428 290a 2020 2020  match.end().    
-0000d3e0: 2020 2020 7661 6c20 3d20 6d61 7463 682e      val = match.
-0000d3f0: 6772 6f75 7028 290a 0a20 2020 2020 2020  group()..       
-0000d400: 2069 6620 7661 6c20 3d3d 2027 2227 2061   if val == '"' a
-0000d410: 6e64 206e 6f74 2028 696e 5f6d 756c 7469  nd not (in_multi
-0000d420: 206f 7220 696e 5f73 696e 676c 6529 3a0a   or in_single):.
-0000d430: 2020 2020 2020 2020 2020 2020 6573 6361              esca
-0000d440: 7065 6420 3d20 656e 645f 736c 6173 6865  ped = end_slashe
-0000d450: 735f 7265 2e73 6561 7263 6828 7374 7269  s_re.search(stri
-0000d460: 6e67 2c20 302c 206d 6174 6368 2e73 7461  ng, 0, match.sta
-0000d470: 7274 2829 290a 0a20 2020 2020 2020 2020  rt())..         
-0000d480: 2020 2023 2073 7461 7274 206f 6620 7374     # start of st
-0000d490: 7269 6e67 206f 7220 756e 6573 6361 7065  ring or unescape
-0000d4a0: 6420 7175 6f74 6520 6368 6172 6163 7465  d quote characte
-0000d4b0: 7220 746f 2065 6e64 2073 7472 696e 670a  r to end string.
-0000d4c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000d4d0: 6f74 2069 6e5f 7374 7269 6e67 206f 7220  ot in_string or 
-0000d4e0: 2865 7363 6170 6564 2069 7320 4e6f 6e65  (escaped is None
-0000d4f0: 206f 7220 6c65 6e28 6573 6361 7065 642e   or len(escaped.
-0000d500: 6772 6f75 7028 2929 2025 2032 203d 3d20  group()) % 2 == 
-0000d510: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
-0000d520: 2020 2020 696e 5f73 7472 696e 6720 3d20      in_string = 
-0000d530: 6e6f 7420 696e 5f73 7472 696e 670a 2020  not in_string.  
-0000d540: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-0000d550: 2d3d 2031 2020 2320 696e 636c 7564 6520  -= 1  # include 
-0000d560: 2220 6368 6172 6163 7465 7220 696e 206e  " character in n
-0000d570: 6578 7420 6361 7463 680a 2020 2020 2020  ext catch.      
-0000d580: 2020 656c 6966 206e 6f74 2028 696e 5f73    elif not (in_s
-0000d590: 7472 696e 6720 6f72 2069 6e5f 6d75 6c74  tring or in_mult
-0000d5a0: 6920 6f72 2069 6e5f 7369 6e67 6c65 293a  i or in_single):
-0000d5b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d5c0: 7661 6c20 3d3d 2022 2f2a 223a 0a20 2020  val == "/*":.   
-0000d5d0: 2020 2020 2020 2020 2020 2020 2069 6e5f               in_
-0000d5e0: 6d75 6c74 6920 3d20 5472 7565 0a20 2020  multi = True.   
-0000d5f0: 2020 2020 2020 2020 2065 6c69 6620 7661           elif va
-0000d600: 6c20 3d3d 2022 2f2f 223a 0a20 2020 2020  l == "//":.     
-0000d610: 2020 2020 2020 2020 2020 2069 6e5f 7369             in_si
-0000d620: 6e67 6c65 203d 2054 7275 650a 2020 2020  ngle = True.    
-0000d630: 2020 2020 656c 6966 2076 616c 203d 3d20      elif val == 
-0000d640: 222a 2f22 2061 6e64 2069 6e5f 6d75 6c74  "*/" and in_mult
-0000d650: 6920 616e 6420 6e6f 7420 2869 6e5f 7374  i and not (in_st
-0000d660: 7269 6e67 206f 7220 696e 5f73 696e 676c  ring or in_singl
-0000d670: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000d680: 696e 5f6d 756c 7469 203d 2046 616c 7365  in_multi = False
-0000d690: 0a20 2020 2020 2020 2065 6c69 6620 7661  .        elif va
-0000d6a0: 6c20 696e 2022 5c72 5c6e 2220 616e 6420  l in "\r\n" and 
-0000d6b0: 6e6f 7420 2869 6e5f 6d75 6c74 6920 6f72  not (in_multi or
-0000d6c0: 2069 6e5f 7374 7269 6e67 2920 616e 6420   in_string) and 
-0000d6d0: 696e 5f73 696e 676c 653a 0a20 2020 2020  in_single:.     
-0000d6e0: 2020 2020 2020 2069 6e5f 7369 6e67 6c65         in_single
-0000d6f0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0000d700: 2065 6c69 6620 6e6f 7420 2828 696e 5f6d   elif not ((in_m
-0000d710: 756c 7469 206f 7220 696e 5f73 696e 676c  ulti or in_singl
-0000d720: 6529 206f 7220 2876 616c 2069 6e20 2220  e) or (val in " 
-0000d730: 5c72 5c6e 5c74 2220 616e 6420 7374 7269  \r\n\t" and stri
-0000d740: 705f 7370 6163 6529 293a 0a20 2020 2020  p_space)):.     
-0000d750: 2020 2020 2020 206e 6577 5f73 7472 2e61         new_str.a
-0000d760: 7070 656e 6428 7661 6c29 0a0a 2020 2020  ppend(val)..    
-0000d770: 6e65 775f 7374 722e 6170 7065 6e64 2873  new_str.append(s
-0000d780: 7472 696e 675b 696e 6465 783a 5d29 0a20  tring[index:]). 
-0000d790: 2020 2072 6574 7572 6e20 2222 2e6a 6f69     return "".joi
-0000d7a0: 6e28 6e65 775f 7374 7229 0a0a 0a64 6566  n(new_str)...def
-0000d7b0: 205f 7079 325f 756e 6963 6f64 655f 746f   _py2_unicode_to
-0000d7c0: 5f73 7472 5f72 6563 7572 7369 7665 2873  _str_recursive(s
-0000d7d0: 293a 0a20 2020 2022 2222 0a20 2020 2054  ):.    """.    T
-0000d7e0: 6869 7320 6973 2073 7570 706f 7365 6420  his is supposed 
-0000d7f0: 746f 2062 6520 7275 6e20 7769 7468 2050  to be run with P
-0000d800: 7974 686f 6e20 322e 0a20 2020 2041 6c73  ython 2..    Als
-0000d810: 6f20 7365 6520 3a66 756e 633a 6061 735f  o see :func:`as_
-0000d820: 7374 7260 2061 6e64 203a 6675 6e63 3a60  str` and :func:`
-0000d830: 7079 325f 7574 6638 5f73 7472 5f74 6f5f  py2_utf8_str_to_
-0000d840: 756e 6963 6f64 6560 2e0a 0a20 2020 203a  unicode`...    :
-0000d850: 7061 7261 6d20 7374 727c 756e 6963 6f64  param str|unicod
-0000d860: 6520 733a 206f 7220 616e 7920 7265 6375  e s: or any recu
-0000d870: 7273 6976 6520 7374 7275 6374 7572 6520  rsive structure 
-0000d880: 7375 6368 2061 7320 6469 6374 2c20 6c69  such as dict, li
-0000d890: 7374 2c20 7475 706c 650a 2020 2020 3a72  st, tuple.    :r
-0000d8a0: 6574 7572 6e3a 2050 7974 686f 6e20 3220  eturn: Python 2 
-0000d8b0: 7374 7220 2869 7320 6c69 6b65 2050 7974  str (is like Pyt
-0000d8c0: 686f 6e20 3320 5554 462d 3820 666f 726d  hon 3 UTF-8 form
-0000d8d0: 6174 7465 6420 6279 7465 7329 0a20 2020  atted bytes).   
-0000d8e0: 203a 7274 7970 653a 2073 7472 0a20 2020   :rtype: str.   
-0000d8f0: 2022 2222 0a20 2020 2069 6620 6973 696e   """.    if isin
-0000d900: 7374 616e 6365 2873 2c20 6469 6374 293a  stance(s, dict):
-0000d910: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d920: 7b5f 7079 325f 756e 6963 6f64 655f 746f  {_py2_unicode_to
-0000d930: 5f73 7472 5f72 6563 7572 7369 7665 286b  _str_recursive(k
-0000d940: 6579 293a 205f 7079 325f 756e 6963 6f64  ey): _py2_unicod
-0000d950: 655f 746f 5f73 7472 5f72 6563 7572 7369  e_to_str_recursi
-0000d960: 7665 2876 616c 7565 2920 666f 7220 6b65  ve(value) for ke
-0000d970: 792c 2076 616c 7565 2069 6e20 732e 6974  y, value in s.it
-0000d980: 656d 7328 297d 0a20 2020 2065 6c69 6620  ems()}.    elif 
-0000d990: 6973 696e 7374 616e 6365 2873 2c20 286c  isinstance(s, (l
-0000d9a0: 6973 742c 2074 7570 6c65 2929 3a0a 2020  ist, tuple)):.  
-0000d9b0: 2020 2020 2020 7265 7475 726e 206d 616b        return mak
-0000d9c0: 655f 7365 715f 6f66 5f74 7970 6528 7479  e_seq_of_type(ty
-0000d9d0: 7065 2873 292c 205b 5f70 7932 5f75 6e69  pe(s), [_py2_uni
-0000d9e0: 636f 6465 5f74 6f5f 7374 725f 7265 6375  code_to_str_recu
-0000d9f0: 7273 6976 6528 656c 656d 656e 7429 2066  rsive(element) f
-0000da00: 6f72 2065 6c65 6d65 6e74 2069 6e20 735d  or element in s]
-0000da10: 290a 2020 2020 656c 6966 2069 7369 6e73  ).    elif isins
-0000da20: 7461 6e63 6528 732c 2075 6e69 636f 6465  tance(s, unicode
-0000da30: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000da40: 6e20 732e 656e 636f 6465 2822 7574 662d  n s.encode("utf-
-0000da50: 3822 2920 2023 2050 7974 686f 6e20 3220  8")  # Python 2 
-0000da60: 7374 722c 2050 7974 686f 6e20 3320 6279  str, Python 3 by
-0000da70: 7465 730a 2020 2020 656c 7365 3a0a 2020  tes.    else:.  
-0000da80: 2020 2020 2020 7265 7475 726e 2073 0a0a        return s..
-0000da90: 0a64 6566 206c 6f61 645f 6a73 6f6e 2866  .def load_json(f
-0000daa0: 696c 656e 616d 653d 4e6f 6e65 2c20 636f  ilename=None, co
-0000dab0: 6e74 656e 743d 4e6f 6e65 293a 0a20 2020  ntent=None):.   
-0000dac0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-0000dad0: 7374 727c 4e6f 6e65 2066 696c 656e 616d  str|None filenam
-0000dae0: 653a 0a20 2020 203a 7061 7261 6d20 7374  e:.    :param st
-0000daf0: 727c 4e6f 6e65 2063 6f6e 7465 6e74 3a0a  r|None content:.
-0000db00: 2020 2020 3a72 7479 7065 3a20 6469 6374      :rtype: dict
-0000db10: 5b73 7472 5d0a 2020 2020 2222 220a 2020  [str].    """.  
-0000db20: 2020 6966 2063 6f6e 7465 6e74 3a0a 2020    if content:.  
-0000db30: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-0000db40: 2066 696c 656e 616d 650a 2020 2020 656c   filename.    el
-0000db50: 7365 3a0a 2020 2020 2020 2020 636f 6e74  se:.        cont
-0000db60: 656e 7420 3d20 6f70 656e 2866 696c 656e  ent = open(filen
-0000db70: 616d 6529 2e72 6561 6428 290a 2020 2020  ame).read().    
-0000db80: 696d 706f 7274 206a 736f 6e0a 0a20 2020  import json..   
-0000db90: 2063 6f6e 7465 6e74 203d 206a 736f 6e5f   content = json_
-0000dba0: 7265 6d6f 7665 5f63 6f6d 6d65 6e74 7328  remove_comments(
-0000dbb0: 636f 6e74 656e 7429 0a20 2020 2074 7279  content).    try
-0000dbc0: 3a0a 2020 2020 2020 2020 6a73 6f6e 5f63  :.        json_c
-0000dbd0: 6f6e 7465 6e74 203d 206a 736f 6e2e 6c6f  ontent = json.lo
-0000dbe0: 6164 7328 636f 6e74 656e 7429 0a20 2020  ads(content).   
-0000dbf0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-0000dc00: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-0000dc10: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000dc20: 2822 636f 6e66 6967 206c 6f6f 6b73 206c  ("config looks l
-0000dc30: 696b 6520 4a53 4f4e 2062 7574 2069 6e76  ike JSON but inv
-0000dc40: 616c 6964 206a 736f 6e20 636f 6e74 656e  alid json conten
-0000dc50: 742c 2025 7222 2025 2065 290a 2020 2020  t, %r" % e).    
-0000dc60: 6966 206e 6f74 2050 5933 3a0a 2020 2020  if not PY3:.    
-0000dc70: 2020 2020 6a73 6f6e 5f63 6f6e 7465 6e74      json_content
-0000dc80: 203d 205f 7079 325f 756e 6963 6f64 655f   = _py2_unicode_
-0000dc90: 746f 5f73 7472 5f72 6563 7572 7369 7665  to_str_recursive
-0000dca0: 286a 736f 6e5f 636f 6e74 656e 7429 0a20  (json_content). 
-0000dcb0: 2020 2072 6574 7572 6e20 6a73 6f6e 5f63     return json_c
-0000dcc0: 6f6e 7465 6e74 0a0a 0a63 6c61 7373 204e  ontent...class N
-0000dcd0: 756d 6265 7273 4469 6374 3a0a 2020 2020  umbersDict:.    
-0000dce0: 2222 220a 2020 2020 4974 2773 206d 6f73  """.    It's mos
-0000dcf0: 746c 7920 6c69 6b65 2064 6963 745b 7374  tly like dict[st
-0000dd00: 722c 666c 6f61 747c 696e 745d 2026 2073  r,float|int] & s
-0000dd10: 6f6d 6520 6f70 7469 6f6e 616c 2062 726f  ome optional bro
-0000dd20: 6164 6361 7374 2064 6566 6175 6c74 2076  adcast default v
-0000dd30: 616c 7565 2e0a 2020 2020 4974 2069 6d70  alue..    It imp
-0000dd40: 6c65 6d65 6e74 7320 7468 6520 7374 616e  lements the stan
-0000dd50: 6461 7264 206d 6174 6820 6269 6e20 6f70  dard math bin op
-0000dd60: 7320 696e 2061 2073 7472 6169 6768 742d  s in a straight-
-0000dd70: 666f 7277 6172 6420 7761 792e 0a20 2020  forward way..   
-0000dd80: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-0000dd90: 696e 6974 5f5f 2873 656c 662c 2061 7574  init__(self, aut
-0000dda0: 6f5f 636f 6e76 6572 743d 4e6f 6e65 2c20  o_convert=None, 
-0000ddb0: 6e75 6d62 6572 735f 6469 6374 3d4e 6f6e  numbers_dict=Non
-0000ddc0: 652c 2062 726f 6164 6361 7374 5f76 616c  e, broadcast_val
-0000ddd0: 7565 3d4e 6f6e 6529 3a0a 2020 2020 2020  ue=None):.      
-0000dde0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-0000ddf0: 6172 616d 2064 6963 747c 4e75 6d62 6572  aram dict|Number
-0000de00: 7344 6963 747c 5420 6175 746f 5f63 6f6e  sDict|T auto_con
-0000de10: 7665 7274 3a20 6669 7273 7420 6172 6775  vert: first argu
-0000de20: 6d65 6e74 2c20 736f 2074 6861 7420 7765  ment, so that we
-0000de30: 2063 616e 2061 7574 6f6d 6174 6963 616c   can automatical
-0000de40: 6c79 2063 6f6e 7665 7274 2f63 6f70 790a  ly convert/copy.
-0000de50: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
-0000de60: 6963 7420 6e75 6d62 6572 735f 6469 6374  ict numbers_dict
-0000de70: 3a0a 2020 2020 2020 2020 3a70 6172 616d  :.        :param
-0000de80: 2054 2062 726f 6164 6361 7374 5f76 616c   T broadcast_val
-0000de90: 7565 3a0a 2020 2020 2020 2020 2222 220a  ue:.        """.
-0000dea0: 2020 2020 2020 2020 6966 2061 7574 6f5f          if auto_
-0000deb0: 636f 6e76 6572 7420 6973 206e 6f74 204e  convert is not N
-0000dec0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000ded0: 2061 7373 6572 7420 6272 6f61 6463 6173   assert broadcas
-0000dee0: 745f 7661 6c75 6520 6973 204e 6f6e 650a  t_value is None.
-0000def0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0000df00: 7274 206e 756d 6265 7273 5f64 6963 7420  rt numbers_dict 
-0000df10: 6973 204e 6f6e 650a 2020 2020 2020 2020  is None.        
-0000df20: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000df30: 6528 6175 746f 5f63 6f6e 7665 7274 2c20  e(auto_convert, 
-0000df40: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-0000df50: 2020 2020 2020 206e 756d 6265 7273 5f64         numbers_d
-0000df60: 6963 7420 3d20 6175 746f 5f63 6f6e 7665  ict = auto_conve
-0000df70: 7274 0a20 2020 2020 2020 2020 2020 2065  rt.            e
-0000df80: 6c69 6620 6973 696e 7374 616e 6365 2861  lif isinstance(a
-0000df90: 7574 6f5f 636f 6e76 6572 742c 204e 756d  uto_convert, Num
-0000dfa0: 6265 7273 4469 6374 293a 0a20 2020 2020  bersDict):.     
-0000dfb0: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
-0000dfc0: 7273 5f64 6963 7420 3d20 6175 746f 5f63  rs_dict = auto_c
-0000dfd0: 6f6e 7665 7274 2e64 6963 740a 2020 2020  onvert.dict.    
-0000dfe0: 2020 2020 2020 2020 2020 2020 6272 6f61              broa
-0000dff0: 6463 6173 745f 7661 6c75 6520 3d20 6175  dcast_value = au
-0000e000: 746f 5f63 6f6e 7665 7274 2e76 616c 7565  to_convert.value
-0000e010: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000e020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000e030: 2020 2062 726f 6164 6361 7374 5f76 616c     broadcast_val
-0000e040: 7565 203d 2061 7574 6f5f 636f 6e76 6572  ue = auto_conver
-0000e050: 740a 2020 2020 2020 2020 6966 206e 756d  t.        if num
-0000e060: 6265 7273 5f64 6963 7420 6973 204e 6f6e  bers_dict is Non
-0000e070: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
-0000e080: 756d 6265 7273 5f64 6963 7420 3d20 7b7d  umbers_dict = {}
-0000e090: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000e0a0: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
-0000e0b0: 7273 5f64 6963 7420 3d20 6469 6374 286e  rs_dict = dict(n
-0000e0c0: 756d 6265 7273 5f64 6963 7429 2020 2320  umbers_dict)  # 
-0000e0d0: 666f 7263 6520 636f 7079 0a0a 2020 2020  force copy..    
-0000e0e0: 2020 2020 7365 6c66 2e64 6963 7420 3d20      self.dict = 
-0000e0f0: 6e75 6d62 6572 735f 6469 6374 0a20 2020  numbers_dict.   
-0000e100: 2020 2020 2073 656c 662e 7661 6c75 6520       self.value 
-0000e110: 3d20 6272 6f61 6463 6173 745f 7661 6c75  = broadcast_valu
-0000e120: 650a 2020 2020 2020 2020 7365 6c66 2e6d  e.        self.m
-0000e130: 6178 203d 2073 656c 662e 5f6d 6178 5f65  ax = self._max_e
-0000e140: 7272 6f72 0a0a 2020 2020 6465 6620 636f  rror..    def co
-0000e150: 7079 2873 656c 6629 3a0a 2020 2020 2020  py(self):.      
-0000e160: 2020 2222 220a 2020 2020 2020 2020 3a72    """.        :r
-0000e170: 7479 7065 3a20 4e75 6d62 6572 7344 6963  type: NumbersDic
-0000e180: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-0000e190: 2020 2020 2020 7265 7475 726e 204e 756d        return Num
-0000e1a0: 6265 7273 4469 6374 2873 656c 6629 0a0a  bersDict(self)..
-0000e1b0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0000e1c0: 0a20 2020 2064 6566 2063 6f6e 7374 616e  .    def constan
-0000e1d0: 745f 6c69 6b65 2863 6c73 2c20 636f 6e73  t_like(cls, cons
-0000e1e0: 745f 6e75 6d62 6572 2c20 6e75 6d62 6572  t_number, number
-0000e1f0: 735f 6469 6374 293a 0a20 2020 2020 2020  s_dict):.       
-0000e200: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
-0000e210: 7261 6d20 696e 747c 666c 6f61 747c 6f62  ram int|float|ob
-0000e220: 6a65 6374 2063 6f6e 7374 5f6e 756d 6265  ject const_numbe
-0000e230: 723a 0a20 2020 2020 2020 203a 7061 7261  r:.        :para
-0000e240: 6d20 4e75 6d62 6572 7344 6963 7420 6e75  m NumbersDict nu
-0000e250: 6d62 6572 735f 6469 6374 3a0a 2020 2020  mbers_dict:.    
-0000e260: 2020 2020 3a72 6574 7572 6e3a 204e 756d      :return: Num
-0000e270: 6265 7273 4469 6374 2077 6974 6820 7361  bersDict with sa
-0000e280: 6d65 206b 6579 7320 6173 206e 756d 6265  me keys as numbe
-0000e290: 7273 5f64 6963 740a 2020 2020 2020 2020  rs_dict.        
-0000e2a0: 3a72 7479 7065 3a20 4e75 6d62 6572 7344  :rtype: NumbersD
-0000e2b0: 6963 740a 2020 2020 2020 2020 2222 220a  ict.        """.
-0000e2c0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0000e2d0: 756d 6265 7273 4469 6374 280a 2020 2020  umbersDict(.    
-0000e2e0: 2020 2020 2020 2020 6272 6f61 6463 6173          broadcas
-0000e2f0: 745f 7661 6c75 653d 636f 6e73 745f 6e75  t_value=const_nu
-0000e300: 6d62 6572 2069 6620 286e 756d 6265 7273  mber if (numbers
-0000e310: 5f64 6963 742e 7661 6c75 6520 6973 206e  _dict.value is n
-0000e320: 6f74 204e 6f6e 6529 2065 6c73 6520 4e6f  ot None) else No
-0000e330: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0000e340: 6e75 6d62 6572 735f 6469 6374 3d7b 6b3a  numbers_dict={k:
-0000e350: 2063 6f6e 7374 5f6e 756d 6265 7220 666f   const_number fo
-0000e360: 7220 6b20 696e 206e 756d 6265 7273 5f64  r k in numbers_d
-0000e370: 6963 742e 6469 6374 2e6b 6579 7328 297d  ict.dict.keys()}
-0000e380: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000e390: 2064 6566 2063 6f70 795f 6c69 6b65 2873   def copy_like(s
-0000e3a0: 656c 662c 206e 756d 6265 7273 5f64 6963  elf, numbers_dic
-0000e3b0: 7429 3a0a 2020 2020 2020 2020 2222 220a  t):.        """.
-0000e3c0: 2020 2020 2020 2020 3a70 6172 616d 204e          :param N
-0000e3d0: 756d 6265 7273 4469 6374 206e 756d 6265  umbersDict numbe
-0000e3e0: 7273 5f64 6963 743a 0a20 2020 2020 2020  rs_dict:.       
-0000e3f0: 203a 7265 7475 726e 3a20 636f 7079 206f   :return: copy o
-0000e400: 6620 7365 6c66 2077 6974 6820 7361 6d65  f self with same
-0000e410: 206b 6579 7320 6173 206e 756d 6265 7273   keys as numbers
-0000e420: 5f64 6963 7420 6173 2066 6172 2061 7320  _dict as far as 
-0000e430: 7765 2068 6176 6520 7468 656d 0a20 2020  we have them.   
-0000e440: 2020 2020 203a 7274 7970 653a 204e 756d       :rtype: Num
-0000e450: 6265 7273 4469 6374 0a20 2020 2020 2020  bersDict.       
-0000e460: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0000e470: 7365 6c66 2e76 616c 7565 2069 7320 6e6f  self.value is no
-0000e480: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000e490: 2020 2020 7265 7475 726e 204e 756d 6265      return Numbe
-0000e4a0: 7273 4469 6374 280a 2020 2020 2020 2020  rsDict(.        
-0000e4b0: 2020 2020 2020 2020 6272 6f61 6463 6173          broadcas
-0000e4c0: 745f 7661 6c75 653d 7365 6c66 2e76 616c  t_value=self.val
-0000e4d0: 7565 2069 6620 286e 756d 6265 7273 5f64  ue if (numbers_d
-0000e4e0: 6963 742e 7661 6c75 6520 6973 206e 6f74  ict.value is not
-0000e4f0: 204e 6f6e 6529 2065 6c73 6520 4e6f 6e65   None) else None
-0000e500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e510: 2020 6e75 6d62 6572 735f 6469 6374 3d7b    numbers_dict={
-0000e520: 6b3a 2073 656c 665b 6b5d 2066 6f72 206b  k: self[k] for k
-0000e530: 2069 6e20 6e75 6d62 6572 735f 6469 6374   in numbers_dict
-0000e540: 2e64 6963 742e 6b65 7973 2829 7d2c 0a20  .dict.keys()},. 
-0000e550: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000e560: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000e570: 2020 2020 2020 2072 6574 7572 6e20 4e75         return Nu
-0000e580: 6d62 6572 7344 6963 7428 0a20 2020 2020  mbersDict(.     
-0000e590: 2020 2020 2020 2020 2020 2062 726f 6164             broad
-0000e5a0: 6361 7374 5f76 616c 7565 3d4e 6f6e 652c  cast_value=None,
-0000e5b0: 206e 756d 6265 7273 5f64 6963 743d 7b6b   numbers_dict={k
-0000e5c0: 3a20 7365 6c66 5b6b 5d20 666f 7220 6b20  : self[k] for k 
-0000e5d0: 696e 206e 756d 6265 7273 5f64 6963 742e  in numbers_dict.
-0000e5e0: 6469 6374 2e6b 6579 7328 2920 6966 206b  dict.keys() if k
-0000e5f0: 2069 6e20 7365 6c66 2e64 6963 747d 0a20   in self.dict}. 
-0000e600: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000e610: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000e620: 6465 6620 6b65 7973 5f73 6574 2873 656c  def keys_set(sel
-0000e630: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0000e640: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-0000e650: 7365 745b 7374 725d 0a20 2020 2020 2020  set[str].       
-0000e660: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0000e670: 7572 6e20 7365 7428 7365 6c66 2e64 6963  urn set(self.dic
-0000e680: 742e 6b65 7973 2829 290a 0a20 2020 2064  t.keys())..    d
-0000e690: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-0000e6a0: 656c 662c 206b 6579 293a 0a20 2020 2020  elf, key):.     
-0000e6b0: 2020 2069 6620 7365 6c66 2e76 616c 7565     if self.value
-0000e6c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000e6d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000e6e0: 2073 656c 662e 6469 6374 2e67 6574 286b   self.dict.get(k
-0000e6f0: 6579 2c20 7365 6c66 2e76 616c 7565 290a  ey, self.value).
-0000e700: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000e710: 656c 662e 6469 6374 5b6b 6579 5d0a 0a20  elf.dict[key].. 
-0000e720: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
-0000e730: 5f5f 2873 656c 662c 206b 6579 2c20 7661  __(self, key, va
-0000e740: 6c75 6529 3a0a 2020 2020 2020 2020 7365  lue):.        se
-0000e750: 6c66 2e64 6963 745b 6b65 795d 203d 2076  lf.dict[key] = v
-0000e760: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
-0000e770: 6465 6c69 7465 6d5f 5f28 7365 6c66 2c20  delitem__(self, 
-0000e780: 6b65 7929 3a0a 2020 2020 2020 2020 6465  key):.        de
-0000e790: 6c20 7365 6c66 2e64 6963 745b 6b65 795d  l self.dict[key]
-0000e7a0: 0a0a 2020 2020 6465 6620 6765 7428 7365  ..    def get(se
-0000e7b0: 6c66 2c20 6b65 792c 2064 6566 6175 6c74  lf, key, default
-0000e7c0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000e7d0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-0000e7e0: 616d 2073 7472 206b 6579 3a0a 2020 2020  am str key:.    
-0000e7f0: 2020 2020 3a70 6172 616d 2054 2064 6566      :param T def
-0000e800: 6175 6c74 3a0a 2020 2020 2020 2020 3a72  ault:.        :r
-0000e810: 7479 7065 3a20 6f62 6a65 6374 7c54 0a20  type: object|T. 
-0000e820: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000e830: 2020 2023 204b 6565 7020 636f 6e73 6973     # Keep consis
-0000e840: 7465 6e74 2077 6974 6820 7365 6c66 2e5f  tent with self._
-0000e850: 5f67 6574 5f69 7465 6d5f 5f2e 2049 6620  _get_item__. If 
-0000e860: 7365 6c66 2e76 616c 7565 2069 7320 7365  self.value is se
-0000e870: 742c 2074 6869 7320 7769 6c6c 2061 6c77  t, this will alw
-0000e880: 6179 7320 6265 2074 6865 2064 6566 6175  ays be the defau
-0000e890: 6c74 2076 616c 7565 2e0a 2020 2020 2020  lt value..      
-0000e8a0: 2020 7265 7475 726e 2073 656c 662e 6469    return self.di
-0000e8b0: 6374 2e67 6574 286b 6579 2c20 7365 6c66  ct.get(key, self
-0000e8c0: 2e76 616c 7565 2069 6620 7365 6c66 2e76  .value if self.v
-0000e8d0: 616c 7565 2069 7320 6e6f 7420 4e6f 6e65  alue is not None
-0000e8e0: 2065 6c73 6520 6465 6661 756c 7429 0a0a   else default)..
-0000e8f0: 2020 2020 6465 6620 706f 7028 7365 6c66      def pop(self
-0000e900: 2c20 6b65 792c 202a 6172 6773 293a 0a20  , key, *args):. 
-0000e910: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000e920: 2020 203a 7061 7261 6d20 7374 7220 6b65     :param str ke
-0000e930: 793a 0a20 2020 2020 2020 203a 7061 7261  y:.        :para
-0000e940: 6d20 5420 6172 6773 3a20 6465 6661 756c  m T args: defaul
-0000e950: 742c 206f 7220 6e6f 740a 2020 2020 2020  t, or not.      
-0000e960: 2020 3a72 7479 7065 3a20 6f62 6a65 6374    :rtype: object
-0000e970: 7c54 0a20 2020 2020 2020 2022 2222 0a20  |T.        """. 
-0000e980: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000e990: 6c66 2e64 6963 742e 706f 7028 6b65 792c  lf.dict.pop(key,
-0000e9a0: 202a 6172 6773 290a 0a20 2020 2064 6566   *args)..    def
-0000e9b0: 205f 5f69 7465 725f 5f28 7365 6c66 293a   __iter__(self):
-0000e9c0: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
-0000e9d0: 6361 6e20 706f 7465 6e74 6961 6c6c 7920  can potentially 
-0000e9e0: 6361 7573 6520 636f 6e66 7573 696f 6e2e  cause confusion.
-0000e9f0: 2053 6f20 656e 666f 7263 6520 6578 706c   So enforce expl
-0000ea00: 6963 6974 6e65 7373 2e0a 2020 2020 2020  icitness..      
-0000ea10: 2020 2320 466f 7220 6120 6469 6374 2c20    # For a dict, 
-0000ea20: 7765 2077 6f75 6c64 2072 6574 7572 6e20  we would return 
-0000ea30: 7468 6520 6469 6374 206b 6579 7320 6865  the dict keys he
-0000ea40: 7265 2e0a 2020 2020 2020 2020 2320 416c  re..        # Al
-0000ea50: 736f 2c20 6d61 7828 7365 6c66 2920 776f  so, max(self) wo
-0000ea60: 756c 6420 7265 7375 6c74 2069 6e20 6120  uld result in a 
-0000ea70: 6361 6c6c 2074 6f20 7365 6c66 2e5f 5f69  call to self.__i
-0000ea80: 7465 725f 5f28 292c 0a20 2020 2020 2020  ter__(),.       
-0000ea90: 2023 2077 6869 6368 2077 6f75 6c64 206f   # which would o
-0000eaa0: 6e6c 7920 6d61 6b65 2073 656e 7365 2066  nly make sense f
-0000eab0: 6f72 206f 7572 2076 616c 7565 732c 206e  or our values, n
-0000eac0: 6f74 2074 6865 2064 6963 7420 6b65 7973  ot the dict keys
-0000ead0: 2e0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
-0000eae0: 4578 6365 7074 696f 6e28 2225 732e 5f5f  Exception("%s.__
-0000eaf0: 6974 6572 5f5f 2069 7320 756e 6465 6669  iter__ is undefi
-0000eb00: 6e65 6422 2025 2073 656c 662e 5f5f 636c  ned" % self.__cl
-0000eb10: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 290a  ass__.__name__).
-0000eb20: 0a20 2020 2064 6566 206b 6579 7328 7365  .    def keys(se
-0000eb30: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000eb40: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0000eb50: 2073 6574 5b73 7472 5d0a 2020 2020 2020   set[str].      
-0000eb60: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0000eb70: 7475 726e 2073 656c 662e 6469 6374 2e6b  turn self.dict.k
-0000eb80: 6579 7328 290a 0a20 2020 2064 6566 2076  eys()..    def v
-0000eb90: 616c 7565 7328 7365 6c66 293a 0a20 2020  alues(self):.   
-0000eba0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000ebb0: 203a 7274 7970 653a 206c 6973 745b 6f62   :rtype: list[ob
-0000ebc0: 6a65 6374 5d0a 2020 2020 2020 2020 2222  ject].        ""
-0000ebd0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000ebe0: 206c 6973 7428 7365 6c66 2e64 6963 742e   list(self.dict.
-0000ebf0: 7661 6c75 6573 2829 2920 2b20 285b 7365  values()) + ([se
-0000ec00: 6c66 2e76 616c 7565 5d20 6966 2073 656c  lf.value] if sel
-0000ec10: 662e 7661 6c75 6520 6973 206e 6f74 204e  f.value is not N
-0000ec20: 6f6e 6520 656c 7365 205b 5d29 0a0a 2020  one else [])..  
-0000ec30: 2020 6465 6620 6974 656d 7328 7365 6c66    def items(self
-0000ec40: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000ec50: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0000ec60: 6469 6374 2069 7465 6d73 2e20 7468 6973  dict items. this
-0000ec70: 2065 7863 6c75 6465 7320 7365 6c66 2e76   excludes self.v
-0000ec80: 616c 7565 0a20 2020 2020 2020 203a 7274  alue.        :rt
-0000ec90: 7970 653a 2073 7472 5b28 7374 722c 6f62  ype: str[(str,ob
-0000eca0: 6a65 6374 295d 0a20 2020 2020 2020 2022  ject)].        "
-0000ecb0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000ecc0: 6e20 7365 6c66 2e64 6963 742e 6974 656d  n self.dict.item
-0000ecd0: 7328 290a 0a20 2020 2064 6566 2068 6173  s()..    def has
-0000ece0: 5f76 616c 7565 7328 7365 6c66 293a 0a20  _values(self):. 
-0000ecf0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000ed00: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
-0000ed10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000ed20: 2020 2020 7265 7475 726e 2062 6f6f 6c28      return bool(
-0000ed30: 7365 6c66 2e64 6963 7429 206f 7220 7365  self.dict) or se
-0000ed40: 6c66 2e76 616c 7565 2069 7320 6e6f 7420  lf.value is not 
-0000ed50: 4e6f 6e65 0a0a 2020 2020 6465 6620 756e  None..    def un
-0000ed60: 6172 795f 6f70 2873 656c 662c 206f 7029  ary_op(self, op)
-0000ed70: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000ed80: 2020 2020 2020 3a70 6172 616d 2028 5429        :param (T)
-0000ed90: 2d3e 5432 206f 703a 0a20 2020 2020 2020  ->T2 op:.       
-0000eda0: 203a 7265 7475 726e 3a20 6e65 7720 4e75   :return: new Nu
-0000edb0: 6d62 6572 7344 6963 742c 2077 6865 7265  mbersDict, where
-0000edc0: 2060 606f 7060 6020 6973 2061 7070 6c69   ``op`` is appli
-0000edd0: 6564 206f 6e20 616c 6c20 7661 6c75 6573  ed on all values
-0000ede0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0000edf0: 204e 756d 6265 7273 4469 6374 0a20 2020   NumbersDict.   
-0000ee00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000ee10: 2072 6573 203d 204e 756d 6265 7273 4469   res = NumbersDi
-0000ee20: 6374 2829 0a20 2020 2020 2020 2069 6620  ct().        if 
-0000ee30: 7365 6c66 2e76 616c 7565 2069 7320 6e6f  self.value is no
-0000ee40: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000ee50: 2020 2020 7265 732e 7661 6c75 6520 3d20      res.value = 
-0000ee60: 6f70 2873 656c 662e 7661 6c75 6529 0a20  op(self.value). 
-0000ee70: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-0000ee80: 696e 2073 656c 662e 6469 6374 2e69 7465  in self.dict.ite
-0000ee90: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000eea0: 2020 7265 732e 6469 6374 5b6b 5d20 3d20    res.dict[k] = 
-0000eeb0: 6f70 2876 290a 2020 2020 2020 2020 7265  op(v).        re
-0000eec0: 7475 726e 2072 6573 0a0a 2020 2020 4063  turn res..    @c
-0000eed0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000eee0: 6566 2062 696e 5f6f 705f 7363 616c 6172  ef bin_op_scalar
-0000eef0: 5f6f 7074 696f 6e61 6c28 636c 732c 2073  _optional(cls, s
-0000ef00: 656c 662c 206f 7468 6572 2c20 7a65 726f  elf, other, zero
-0000ef10: 2c20 6f70 293a 0a20 2020 2020 2020 2022  , op):.        "
-0000ef20: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-0000ef30: 6d20 5420 7365 6c66 3a0a 2020 2020 2020  m T self:.      
-0000ef40: 2020 3a70 6172 616d 2054 206f 7468 6572    :param T other
-0000ef50: 3a0a 2020 2020 2020 2020 3a70 6172 616d  :.        :param
-0000ef60: 2054 207a 6572 6f3a 0a20 2020 2020 2020   T zero:.       
-0000ef70: 203a 7061 7261 6d20 2854 2c54 292d 3e54   :param (T,T)->T
-0000ef80: 206f 703a 0a20 2020 2020 2020 203a 7274   op:.        :rt
-0000ef90: 7970 653a 2054 0a20 2020 2020 2020 2022  ype: T.        "
-0000efa0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-0000efb0: 6c66 2069 7320 4e6f 6e65 2061 6e64 206f  lf is None and o
-0000efc0: 7468 6572 2069 7320 4e6f 6e65 3a0a 2020  ther is None:.  
-0000efd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000efe0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-0000eff0: 2073 656c 6620 6973 204e 6f6e 653a 0a20   self is None:. 
-0000f000: 2020 2020 2020 2020 2020 2073 656c 6620             self 
-0000f010: 3d20 7a65 726f 0a20 2020 2020 2020 2069  = zero.        i
-0000f020: 6620 6f74 6865 7220 6973 204e 6f6e 653a  f other is None:
-0000f030: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-0000f040: 6572 203d 207a 6572 6f0a 2020 2020 2020  er = zero.      
-0000f050: 2020 7265 7475 726e 206f 7028 7365 6c66    return op(self
-0000f060: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
-0000f070: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000f080: 6566 2062 696e 5f6f 7028 636c 732c 2073  ef bin_op(cls, s
-0000f090: 656c 662c 206f 7468 6572 2c20 6f70 2c20  elf, other, op, 
-0000f0a0: 7a65 726f 2c20 7265 7375 6c74 3d4e 6f6e  zero, result=Non
-0000f0b0: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-0000f0c0: 2020 2020 2020 2020 3a70 6172 616d 204e          :param N
-0000f0d0: 756d 6265 7273 4469 6374 7c69 6e74 7c66  umbersDict|int|f
-0000f0e0: 6c6f 6174 7c54 2073 656c 663a 0a20 2020  loat|T self:.   
-0000f0f0: 2020 2020 203a 7061 7261 6d20 4e75 6d62       :param Numb
-0000f100: 6572 7344 6963 747c 696e 747c 666c 6f61  ersDict|int|floa
-0000f110: 747c 5420 6f74 6865 723a 0a20 2020 2020  t|T other:.     
-0000f120: 2020 203a 7061 7261 6d20 2854 2c54 292d     :param (T,T)-
-0000f130: 3e54 206f 703a 0a20 2020 2020 2020 203a  >T op:.        :
-0000f140: 7061 7261 6d20 5420 7a65 726f 3a0a 2020  param T zero:.  
-0000f150: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
-0000f160: 6265 7273 4469 6374 7c4e 6f6e 6520 7265  bersDict|None re
-0000f170: 7375 6c74 3a0a 2020 2020 2020 2020 3a72  sult:.        :r
-0000f180: 7479 7065 3a20 4e75 6d62 6572 7344 6963  type: NumbersDic
-0000f190: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-0000f1a0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0000f1b0: 6e73 7461 6e63 6528 7365 6c66 2c20 4e75  nstance(self, Nu
-0000f1c0: 6d62 6572 7344 6963 7429 3a0a 2020 2020  mbersDict):.    
-0000f1d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000f1e0: 7461 6e63 6528 6f74 6865 722c 204e 756d  tance(other, Num
-0000f1f0: 6265 7273 4469 6374 293a 0a20 2020 2020  bersDict):.     
-0000f200: 2020 2020 2020 2020 2020 2073 656c 6620             self 
-0000f210: 3d20 4e75 6d62 6572 7344 6963 742e 636f  = NumbersDict.co
-0000f220: 6e73 7461 6e74 5f6c 696b 6528 7365 6c66  nstant_like(self
-0000f230: 2c20 6e75 6d62 6572 735f 6469 6374 3d6f  , numbers_dict=o
-0000f240: 7468 6572 290a 2020 2020 2020 2020 2020  ther).          
-0000f250: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f260: 2020 2020 2020 2020 7365 6c66 203d 204e          self = N
-0000f270: 756d 6265 7273 4469 6374 2873 656c 6629  umbersDict(self)
-0000f280: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000f290: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
-0000f2a0: 2c20 4e75 6d62 6572 7344 6963 7429 3a0a  , NumbersDict):.
-0000f2b0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-0000f2c0: 7220 3d20 4e75 6d62 6572 7344 6963 742e  r = NumbersDict.
-0000f2d0: 636f 6e73 7461 6e74 5f6c 696b 6528 6f74  constant_like(ot
-0000f2e0: 6865 722c 206e 756d 6265 7273 5f64 6963  her, numbers_dic
-0000f2f0: 743d 7365 6c66 290a 2020 2020 2020 2020  t=self).        
-0000f300: 6966 2072 6573 756c 7420 6973 204e 6f6e  if result is Non
-0000f310: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000f320: 6573 756c 7420 3d20 4e75 6d62 6572 7344  esult = NumbersD
-0000f330: 6963 7428 290a 2020 2020 2020 2020 6173  ict().        as
-0000f340: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-0000f350: 7265 7375 6c74 2c20 4e75 6d62 6572 7344  result, NumbersD
-0000f360: 6963 7429 0a20 2020 2020 2020 2066 6f72  ict).        for
-0000f370: 206b 2069 6e20 7365 6c66 2e6b 6579 735f   k in self.keys_
-0000f380: 7365 7420 7c20 6f74 6865 722e 6b65 7973  set | other.keys
-0000f390: 5f73 6574 3a0a 2020 2020 2020 2020 2020  _set:.          
-0000f3a0: 2020 7265 7375 6c74 5b6b 5d20 3d20 636c    result[k] = cl
-0000f3b0: 732e 6269 6e5f 6f70 5f73 6361 6c61 725f  s.bin_op_scalar_
-0000f3c0: 6f70 7469 6f6e 616c 2873 656c 662e 6765  optional(self.ge
-0000f3d0: 7428 6b2c 204e 6f6e 6529 2c20 6f74 6865  t(k, None), othe
-0000f3e0: 722e 6765 7428 6b2c 204e 6f6e 6529 2c20  r.get(k, None), 
-0000f3f0: 7a65 726f 3d7a 6572 6f2c 206f 703d 6f70  zero=zero, op=op
-0000f400: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0000f410: 2e76 616c 7565 203d 2063 6c73 2e62 696e  .value = cls.bin
-0000f420: 5f6f 705f 7363 616c 6172 5f6f 7074 696f  _op_scalar_optio
-0000f430: 6e61 6c28 7365 6c66 2e76 616c 7565 2c20  nal(self.value, 
-0000f440: 6f74 6865 722e 7661 6c75 652c 207a 6572  other.value, zer
-0000f450: 6f3d 7a65 726f 2c20 6f70 3d6f 7029 0a20  o=zero, op=op). 
-0000f460: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000f470: 7375 6c74 0a0a 2020 2020 6465 6620 5f5f  sult..    def __
-0000f480: 6164 645f 5f28 7365 6c66 2c20 6f74 6865  add__(self, othe
-0000f490: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-0000f4a0: 726e 2073 656c 662e 6269 6e5f 6f70 2873  rn self.bin_op(s
-0000f4b0: 656c 662c 206f 7468 6572 2c20 6f70 3d6c  elf, other, op=l
-0000f4c0: 616d 6264 6120 612c 2062 3a20 6120 2b20  ambda a, b: a + 
-0000f4d0: 622c 207a 6572 6f3d 3029 0a0a 2020 2020  b, zero=0)..    
-0000f4e0: 5f5f 7261 6464 5f5f 203d 205f 5f61 6464  __radd__ = __add
-0000f4f0: 5f5f 0a0a 2020 2020 6465 6620 5f5f 6961  __..    def __ia
-0000f500: 6464 5f5f 2873 656c 662c 206f 7468 6572  dd__(self, other
-0000f510: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000f520: 6e20 7365 6c66 2e62 696e 5f6f 7028 7365  n self.bin_op(se
-0000f530: 6c66 2c20 6f74 6865 722c 206f 703d 6c61  lf, other, op=la
-0000f540: 6d62 6461 2061 2c20 623a 2061 202b 2062  mbda a, b: a + b
-0000f550: 2c20 7a65 726f 3d30 2c20 7265 7375 6c74  , zero=0, result
-0000f560: 3d73 656c 6629 0a0a 2020 2020 6465 6620  =self)..    def 
-0000f570: 5f5f 7375 625f 5f28 7365 6c66 2c20 6f74  __sub__(self, ot
-0000f580: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-0000f590: 7475 726e 2073 656c 662e 6269 6e5f 6f70  turn self.bin_op
-0000f5a0: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
-0000f5b0: 3d6c 616d 6264 6120 612c 2062 3a20 6120  =lambda a, b: a 
-0000f5c0: 2d20 622c 207a 6572 6f3d 3029 0a0a 2020  - b, zero=0)..  
-0000f5d0: 2020 6465 6620 5f5f 7273 7562 5f5f 2873    def __rsub__(s
-0000f5e0: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-0000f5f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000f600: 2e62 696e 5f6f 7028 7365 6c66 2c20 6f74  .bin_op(self, ot
-0000f610: 6865 722c 206f 703d 6c61 6d62 6461 2061  her, op=lambda a
-0000f620: 2c20 623a 2062 202d 2061 2c20 7a65 726f  , b: b - a, zero
-0000f630: 3d30 290a 0a20 2020 2064 6566 205f 5f69  =0)..    def __i
-0000f640: 7375 625f 5f28 7365 6c66 2c20 6f74 6865  sub__(self, othe
-0000f650: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-0000f660: 726e 2073 656c 662e 6269 6e5f 6f70 2873  rn self.bin_op(s
-0000f670: 656c 662c 206f 7468 6572 2c20 6f70 3d6c  elf, other, op=l
-0000f680: 616d 6264 6120 612c 2062 3a20 6120 2d20  ambda a, b: a - 
-0000f690: 622c 207a 6572 6f3d 302c 2072 6573 756c  b, zero=0, resul
-0000f6a0: 743d 7365 6c66 290a 0a20 2020 2064 6566  t=self)..    def
-0000f6b0: 205f 5f6d 756c 5f5f 2873 656c 662c 206f   __mul__(self, o
-0000f6c0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-0000f6d0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
-0000f6e0: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000f6f0: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
-0000f700: 202a 2062 2c20 7a65 726f 3d31 290a 0a20   * b, zero=1).. 
-0000f710: 2020 205f 5f72 6d75 6c5f 5f20 3d20 5f5f     __rmul__ = __
-0000f720: 6d75 6c5f 5f0a 0a20 2020 2064 6566 205f  mul__..    def _
-0000f730: 5f69 6d75 6c5f 5f28 7365 6c66 2c20 6f74  _imul__(self, ot
-0000f740: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-0000f750: 7475 726e 2073 656c 662e 6269 6e5f 6f70  turn self.bin_op
-0000f760: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
-0000f770: 3d6c 616d 6264 6120 612c 2062 3a20 6120  =lambda a, b: a 
-0000f780: 2a20 622c 207a 6572 6f3d 312c 2072 6573  * b, zero=1, res
-0000f790: 756c 743d 7365 6c66 290a 0a20 2020 2064  ult=self)..    d
-0000f7a0: 6566 205f 5f64 6976 5f5f 2873 656c 662c  ef __div__(self,
-0000f7b0: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-0000f7c0: 2072 6574 7572 6e20 7365 6c66 2e62 696e   return self.bin
-0000f7d0: 5f6f 7028 7365 6c66 2c20 6f74 6865 722c  _op(self, other,
-0000f7e0: 206f 703d 6c61 6d62 6461 2061 2c20 623a   op=lambda a, b:
-0000f7f0: 2061 202f 2062 2c20 7a65 726f 3d31 290a   a / b, zero=1).
-0000f800: 0a20 2020 205f 5f72 6469 765f 5f20 3d20  .    __rdiv__ = 
-0000f810: 5f5f 6469 765f 5f0a 2020 2020 5f5f 7472  __div__.    __tr
-0000f820: 7565 6469 765f 5f20 3d20 5f5f 6469 765f  uediv__ = __div_
-0000f830: 5f0a 0a20 2020 2064 6566 205f 5f69 6469  _..    def __idi
-0000f840: 765f 5f28 7365 6c66 2c20 6f74 6865 7229  v__(self, other)
-0000f850: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000f860: 2073 656c 662e 6269 6e5f 6f70 2873 656c   self.bin_op(sel
-0000f870: 662c 206f 7468 6572 2c20 6f70 3d6c 616d  f, other, op=lam
-0000f880: 6264 6120 612c 2062 3a20 6120 2f20 622c  bda a, b: a / b,
-0000f890: 207a 6572 6f3d 312c 2072 6573 756c 743d   zero=1, result=
-0000f8a0: 7365 6c66 290a 0a20 2020 205f 5f69 7472  self)..    __itr
-0000f8b0: 7565 6469 765f 5f20 3d20 5f5f 6964 6976  uediv__ = __idiv
-0000f8c0: 5f5f 0a0a 2020 2020 6465 6620 5f5f 666c  __..    def __fl
-0000f8d0: 6f6f 7264 6976 5f5f 2873 656c 662c 206f  oordiv__(self, o
-0000f8e0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-0000f8f0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
-0000f900: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000f910: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
-0000f920: 202f 2f20 622c 207a 6572 6f3d 3129 0a0a   // b, zero=1)..
-0000f930: 2020 2020 6465 6620 5f5f 6966 6c6f 6f72      def __ifloor
-0000f940: 6469 765f 5f28 7365 6c66 2c20 6f74 6865  div__(self, othe
-0000f950: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-0000f960: 726e 2073 656c 662e 6269 6e5f 6f70 2873  rn self.bin_op(s
-0000f970: 656c 662c 206f 7468 6572 2c20 6f70 3d6c  elf, other, op=l
-0000f980: 616d 6264 6120 612c 2062 3a20 6120 2f2f  ambda a, b: a //
-0000f990: 2062 2c20 7a65 726f 3d31 2c20 7265 7375   b, zero=1, resu
-0000f9a0: 6c74 3d73 656c 6629 0a0a 2020 2020 6465  lt=self)..    de
-0000f9b0: 6620 5f5f 6e65 675f 5f28 7365 6c66 293a  f __neg__(self):
-0000f9c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000f9d0: 7365 6c66 2e75 6e61 7279 5f6f 7028 6f70  self.unary_op(op
-0000f9e0: 3d6c 616d 6264 6120 613a 202d 6129 0a0a  =lambda a: -a)..
-0000f9f0: 2020 2020 6465 6620 5f5f 626f 6f6c 5f5f      def __bool__
-0000fa00: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000fa10: 7265 7475 726e 2061 6e79 2873 656c 662e  return any(self.
-0000fa20: 7661 6c75 6573 2829 290a 0a20 2020 205f  values())..    _
-0000fa30: 5f6e 6f6e 7a65 726f 5f5f 203d 205f 5f62  _nonzero__ = __b
-0000fa40: 6f6f 6c5f 5f20 2023 2050 7974 686f 6e20  ool__  # Python 
-0000fa50: 320a 0a20 2020 2064 6566 2065 6c65 6d5f  2..    def elem_
-0000fa60: 6571 2873 656c 662c 206f 7468 6572 2c20  eq(self, other, 
-0000fa70: 7265 7375 6c74 5f77 6974 685f 6465 6661  result_with_defa
-0000fa80: 756c 743d 5472 7565 293a 0a20 2020 2020  ult=True):.     
-0000fa90: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
-0000faa0: 6c65 6d65 6e74 2d77 6973 6520 6571 7561  lement-wise equa
-0000fab0: 6c69 7479 2063 6865 636b 2077 6974 6820  lity check with 
-0000fac0: 6f74 6865 722e 0a20 2020 2020 2020 204e  other..        N
-0000fad0: 6f74 6520 6162 6f75 7420 6272 6f61 6463  ote about broadc
-0000fae0: 6173 7420 6465 6661 756c 7420 7661 6c75  ast default valu
-0000faf0: 653a 2043 6f6e 7369 6465 7220 736f 6d65  e: Consider some
-0000fb00: 206b 6579 2077 6869 6368 2069 7320 6e65   key which is ne
-0000fb10: 6974 6865 7220 696e 2073 656c 6620 6e6f  ither in self no
-0000fb20: 7220 696e 206f 7468 6572 2e0a 2020 2020  r in other..    
-0000fb30: 2020 2020 2020 5468 6973 206d 6561 6e73        This means
-0000fb40: 2074 6861 7420 7365 6c66 5b6b 6579 5d20   that self[key] 
-0000fb50: 3d3d 2073 656c 662e 6465 6661 756c 742c  == self.default,
-0000fb60: 206f 7468 6572 5b6b 6579 5d20 3d3d 206f   other[key] == o
-0000fb70: 7468 6572 2e64 6566 6175 6c74 2e0a 2020  ther.default..  
-0000fb80: 2020 2020 2020 2020 5468 7573 2c20 696e          Thus, in
-0000fb90: 2063 6173 6520 7468 6174 2073 656c 662e   case that self.
-0000fba0: 6465 6661 756c 7420 213d 206f 7468 6572  default != other
-0000fbb0: 2e64 6566 6175 6c74 2c20 7765 2067 6574  .default, we get
-0000fbc0: 2072 6573 2e64 6566 6175 6c74 203d 3d20   res.default == 
-0000fbd0: 4661 6c73 652e 0a20 2020 2020 2020 2020  False..         
-0000fbe0: 2054 6865 6e2c 2061 6c6c 2872 6573 2e76   Then, all(res.v
-0000fbf0: 616c 7565 7328 2929 203d 3d20 4661 6c73  alues()) == Fals
-0000fc00: 652c 2065 7665 6e20 7768 656e 2061 6c6c  e, even when all
-0000fc10: 206f 7468 6572 2076 616c 7565 7320 6172   other values ar
-0000fc20: 6520 5472 7565 2e0a 2020 2020 2020 2020  e True..        
-0000fc30: 2020 5468 6973 2069 7320 736f 6d65 7469    This is someti
-0000fc40: 6d65 7320 6e6f 7420 7768 6174 2077 6520  mes not what we 
-0000fc50: 7761 6e74 2e0a 2020 2020 2020 2020 2020  want..          
-0000fc60: 596f 7520 6361 6e20 636f 6e74 726f 6c20  You can control 
-0000fc70: 7468 6520 6265 6861 7669 6f72 2076 6961  the behavior via
-0000fc80: 2072 6573 756c 745f 7769 7468 5f64 6566   result_with_def
-0000fc90: 6175 6c74 2e0a 0a20 2020 2020 2020 203a  ault...        :
-0000fca0: 7061 7261 6d20 4e75 6d62 6572 7344 6963  param NumbersDic
-0000fcb0: 747c 5420 6f74 6865 723a 0a20 2020 2020  t|T other:.     
-0000fcc0: 2020 203a 7061 7261 6d20 626f 6f6c 2072     :param bool r
-0000fcd0: 6573 756c 745f 7769 7468 5f64 6566 6175  esult_with_defau
-0000fce0: 6c74 3a0a 2020 2020 2020 2020 3a72 7479  lt:.        :rty
-0000fcf0: 7065 3a20 4e75 6d62 6572 7344 6963 740a  pe: NumbersDict.
-0000fd00: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000fd10: 2020 2020 2064 6566 206f 7028 612c 2062       def op(a, b
-0000fd20: 293a 0a20 2020 2020 2020 2020 2020 2022  ):.            "
-0000fd30: 2222 0a20 2020 2020 2020 2020 2020 203a  "".            :
-0000fd40: 7061 7261 6d20 613a 0a20 2020 2020 2020  param a:.       
-0000fd50: 2020 2020 203a 7061 7261 6d20 623a 0a20       :param b:. 
-0000fd60: 2020 2020 2020 2020 2020 203a 7274 7970             :rtyp
-0000fd70: 653a 2062 6f6f 6c7c 4e6f 6e65 0a20 2020  e: bool|None.   
-0000fd80: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
-0000fd90: 2020 2020 2020 2020 2069 6620 6120 6973           if a is
-0000fda0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000fdb0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000fdc0: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
-0000fdd0: 6620 6220 6973 204e 6f6e 653a 0a20 2020  f b is None:.   
-0000fde0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000fdf0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000fe00: 2020 2020 2072 6574 7572 6e20 6120 3d3d       return a ==
-0000fe10: 2062 0a0a 2020 2020 2020 2020 7265 7320   b..        res 
-0000fe20: 3d20 7365 6c66 2e62 696e 5f6f 7028 7365  = self.bin_op(se
-0000fe30: 6c66 2c20 6f74 6865 722c 206f 703d 6f70  lf, other, op=op
-0000fe40: 2c20 7a65 726f 3d4e 6f6e 6529 0a20 2020  , zero=None).   
-0000fe50: 2020 2020 2069 6620 6e6f 7420 7265 7375       if not resu
-0000fe60: 6c74 5f77 6974 685f 6465 6661 756c 743a  lt_with_default:
-0000fe70: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000fe80: 2e76 616c 7565 203d 204e 6f6e 650a 2020  .value = None.  
-0000fe90: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0000fea0: 0a0a 2020 2020 6465 6620 5f5f 6571 5f5f  ..    def __eq__
-0000feb0: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
-0000fec0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000fed0: 2020 203a 7061 7261 6d20 4e75 6d62 6572     :param Number
-0000fee0: 7344 6963 747c 5420 6f74 6865 723a 0a20  sDict|T other:. 
-0000fef0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0000ff00: 7768 6574 6865 7220 7365 6c66 203d 3d20  whether self == 
-0000ff10: 6f74 6865 7220 656c 656d 7769 7365 2e20  other elemwise. 
-0000ff20: 7365 6520 7365 6c66 2e65 6c65 6d5f 6571  see self.elem_eq
-0000ff30: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0000ff40: 2062 6f6f 6c0a 2020 2020 2020 2020 2222   bool.        ""
-0000ff50: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000ff60: 2061 6c6c 2873 656c 662e 656c 656d 5f65   all(self.elem_e
-0000ff70: 7128 6f74 6865 7229 2e76 616c 7565 7328  q(other).values(
-0000ff80: 2929 0a0a 2020 2020 6465 6620 5f5f 6e65  ))..    def __ne
-0000ff90: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-0000ffa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ffb0: 2020 2020 203a 7061 7261 6d20 4e75 6d62       :param Numb
-0000ffc0: 6572 7344 6963 747c 5420 6f74 6865 723a  ersDict|T other:
-0000ffd0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0000ffe0: 3a20 6e6f 7420 2873 656c 6620 3d3d 206f  : not (self == o
-0000fff0: 7468 6572 290a 2020 2020 2020 2020 3a72  ther).        :r
-00010000: 7479 7065 3a20 626f 6f6c 0a20 2020 2020  type: bool.     
-00010010: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00010020: 6574 7572 6e20 6e6f 7420 2873 656c 6620  eturn not (self 
-00010030: 3d3d 206f 7468 6572 290a 0a20 2020 2064  == other)..    d
-00010040: 6566 205f 5f63 6d70 5f5f 2873 656c 662c  ef __cmp__(self,
-00010050: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00010060: 2023 2054 6865 7265 2069 7320 6e6f 2067   # There is no g
-00010070: 6f6f 6420 7374 7261 6967 6874 2d66 6f72  ood straight-for
-00010080: 7761 7264 2069 6d70 6c65 6d65 6e74 6174  ward implementat
-00010090: 696f 6e0a 2020 2020 2020 2020 2320 616e  ion.        # an
-000100a0: 6420 6974 2077 6f75 6c64 206a 7573 7420  d it would just 
-000100b0: 636f 6e66 7573 652e 0a20 2020 2020 2020  confuse..       
-000100c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-000100d0: 2822 2573 2e5f 5f63 6d70 5f5f 2069 7320  ("%s.__cmp__ is 
-000100e0: 756e 6465 6669 6e65 6422 2025 2073 656c  undefined" % sel
-000100f0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-00010100: 6d65 5f5f 290a 0a20 2020 2064 6566 2061  me__)..    def a
-00010110: 6e79 5f63 6f6d 7061 7265 2873 656c 662c  ny_compare(self,
-00010120: 206f 7468 6572 2c20 636d 7029 3a0a 2020   other, cmp):.  
-00010130: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010140: 2020 3a70 6172 616d 204e 756d 6265 7273    :param Numbers
-00010150: 4469 6374 206f 7468 6572 3a0a 2020 2020  Dict other:.    
-00010160: 2020 2020 3a70 6172 616d 2028 286f 626a      :param ((obj
-00010170: 6563 742c 6f62 6a65 6374 292d 3e54 7275  ect,object)->Tru
-00010180: 6529 2063 6d70 3a0a 2020 2020 2020 2020  e) cmp:.        
-00010190: 3a72 7479 7065 3a20 5472 7565 0a20 2020  :rtype: True.   
-000101a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000101b0: 2066 6f72 206b 6579 2069 6e20 7365 6c66   for key in self
-000101c0: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-000101d0: 2020 2020 2069 6620 6b65 7920 696e 206f       if key in o
-000101e0: 7468 6572 2e6b 6579 7328 293a 0a20 2020  ther.keys():.   
-000101f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010200: 636d 7028 7365 6c66 5b6b 6579 5d2c 206f  cmp(self[key], o
-00010210: 7468 6572 5b6b 6579 5d29 3a0a 2020 2020  ther[key]):.    
+0000cb00: 2020 2020 7265 745b 2d31 5d20 2b3d 2063      ret[-1] += c
+0000cb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cb20: 2065 6c73 653a 2020 2320 6e6f 7420 776f   else:  # not wo
+0000cb30: 7264 5f62 6173 6564 0a20 2020 2020 2020  rd_based.       
+0000cb40: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000cb50: 202b 3d20 630a 2020 2020 7265 7475 726e   += c.    return
+0000cb60: 2072 6574 0a0a 0a64 6566 2070 6172 7365   ret...def parse
+0000cb70: 5f6f 7274 686f 6772 6170 6879 280a 2020  _orthography(.  
+0000cb80: 2020 6f72 7468 6f67 7261 7068 792c 2070    orthography, p
+0000cb90: 7265 6669 783d 2829 2c20 706f 7374 6669  refix=(), postfi
+0000cba0: 783d 2822 5b45 4e44 5d22 2c29 2c20 7265  x=("[END]",), re
+0000cbb0: 6d6f 7665 5f63 6861 7273 3d22 2829 7b7d  move_chars="(){}
+0000cbc0: 222c 2063 6f6c 6c61 7073 655f 7370 6163  ", collapse_spac
+0000cbd0: 6573 3d54 7275 652c 2066 696e 616c 5f73  es=True, final_s
+0000cbe0: 7472 6970 3d54 7275 652c 202a 2a6b 7761  trip=True, **kwa
+0000cbf0: 7267 730a 293a 0a20 2020 2022 2222 0a20  rgs.):.    """. 
+0000cc00: 2020 2046 6f72 2053 7065 6563 682e 2046     For Speech. F
+0000cc10: 756c 6c20 7072 6f63 6573 7369 6e67 2e0a  ull processing..
+0000cc20: 2020 2020 4578 616d 706c 653a 0a20 2020      Example:.   
+0000cc30: 2020 206f 7274 686f 6772 6170 6879 203d     orthography =
+0000cc40: 2022 6865 6c6c 6f20 5b48 4553 4954 4154   "hello [HESITAT
+0000cc50: 494f 4e5d 2074 6865 7265 2022 0a20 2020  ION] there ".   
+0000cc60: 2020 2077 6974 6820 776f 7264 5f62 6173     with word_bas
+0000cc70: 6564 203d 3d20 4661 6c73 653a 2072 6574  ed == False: ret
+0000cc80: 7572 6e73 206c 6973 7428 2268 656c 6c6f  urns list("hello
+0000cc90: 2022 2920 2b20 5b22 5b48 4553 4954 4154   ") + ["[HESITAT
+0000cca0: 494f 4e5d 225d 202b 206c 6973 7428 2220  ION]"] + list(" 
+0000ccb0: 7468 6572 6522 2920 2b20 5b22 5b45 4e44  there") + ["[END
+0000ccc0: 5d22 5d0a 2020 2020 2020 7769 7468 2077  ]"].      with w
+0000ccd0: 6f72 645f 6261 7365 6420 3d3d 2054 7275  ord_based == Tru
+0000cce0: 653a 2072 6574 7572 6e73 205b 2268 656c  e: returns ["hel
+0000ccf0: 6c6f 222c 2022 5b48 4553 4954 4154 494f  lo", "[HESITATIO
+0000cd00: 4e5d 222c 2022 7468 6572 6522 2c20 225b  N]", "there", "[
+0000cd10: 454e 445d 225d 0a20 2020 2044 6f65 7320  END]"].    Does 
+0000cd20: 736f 6d65 2070 7265 7072 6f63 6573 7369  some preprocessi
+0000cd30: 6e67 206f 6e20 6f72 7468 6f67 7261 7068  ng on orthograph
+0000cd40: 7920 616e 6420 7468 656e 2070 6173 7365  y and then passe
+0000cd50: 7320 6974 206f 6e20 746f 2070 6172 7365  s it on to parse
+0000cd60: 5f6f 7274 686f 6772 6170 6879 5f69 6e74  _orthography_int
+0000cd70: 6f5f 7379 6d62 6f6c 7328 292e 0a0a 2020  o_symbols()...  
+0000cd80: 2020 3a70 6172 616d 2073 7472 206f 7274    :param str ort
+0000cd90: 686f 6772 6170 6879 3a20 652e 672e 2022  hography: e.g. "
+0000cda0: 6865 6c6c 6f20 5b48 4553 4954 4154 494f  hello [HESITATIO
+0000cdb0: 4e5d 2074 6865 7265 2022 0a20 2020 203a  N] there ".    :
+0000cdc0: 7061 7261 6d20 6c69 7374 5b73 7472 5d20  param list[str] 
+0000cdd0: 7072 6566 6978 3a20 7769 6c6c 2061 6464  prefix: will add
+0000cde0: 2074 6869 7320 7072 6566 6978 0a20 2020   this prefix.   
+0000cdf0: 203a 7061 7261 6d20 6c69 7374 5b73 7472   :param list[str
+0000ce00: 5d20 706f 7374 6669 783a 2077 696c 6c20  ] postfix: will 
+0000ce10: 6164 6420 7468 6973 2070 6f73 7466 6978  add this postfix
+0000ce20: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
+0000ce30: 7265 6d6f 7665 5f63 6861 7273 3a20 7468  remove_chars: th
+0000ce40: 6f73 6520 6368 6172 7320 7769 6c6c 206a  ose chars will j
+0000ce50: 7573 7420 6265 2072 656d 6f76 6564 2061  ust be removed a
+0000ce60: 7420 7468 6520 6265 6769 6e6e 696e 670a  t the beginning.
+0000ce70: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
+0000ce80: 636f 6c6c 6170 7365 5f73 7061 6365 733a  collapse_spaces:
+0000ce90: 2077 6865 7468 6572 206d 756c 7469 706c   whether multipl
+0000cea0: 6520 7370 6163 6573 2061 6e64 2074 6162  e spaces and tab
+0000ceb0: 7320 6172 6520 636f 6c6c 6170 7365 6420  s are collapsed 
+0000cec0: 696e 746f 2061 2073 696e 676c 6520 7370  into a single sp
+0000ced0: 6163 650a 2020 2020 3a70 6172 616d 2062  ace.    :param b
+0000cee0: 6f6f 6c20 6669 6e61 6c5f 7374 7269 703a  ool final_strip:
+0000cef0: 2077 6865 7468 6572 2077 6520 7374 7269   whether we stri
+0000cf00: 7020 6c65 6674 2061 6e64 2072 6967 6874  p left and right
+0000cf10: 0a20 2020 203a 7061 7261 6d20 6b77 6172  .    :param kwar
+0000cf20: 6773 3a20 7061 7373 6564 206f 6e20 746f  gs: passed on to
+0000cf30: 2070 6172 7365 5f6f 7274 686f 6772 6170   parse_orthograp
+0000cf40: 6879 5f69 6e74 6f5f 7379 6d62 6f6c 7328  hy_into_symbols(
+0000cf50: 290a 2020 2020 3a72 7479 7065 3a20 6c69  ).    :rtype: li
+0000cf60: 7374 5b73 7472 5d0a 2020 2020 2222 220a  st[str].    """.
+0000cf70: 2020 2020 666f 7220 6320 696e 2072 656d      for c in rem
+0000cf80: 6f76 655f 6368 6172 733a 0a20 2020 2020  ove_chars:.     
+0000cf90: 2020 206f 7274 686f 6772 6170 6879 203d     orthography =
+0000cfa0: 206f 7274 686f 6772 6170 6879 2e72 6570   orthography.rep
+0000cfb0: 6c61 6365 2863 2c20 2222 290a 2020 2020  lace(c, "").    
+0000cfc0: 6966 2063 6f6c 6c61 7073 655f 7370 6163  if collapse_spac
+0000cfd0: 6573 3a0a 2020 2020 2020 2020 6f72 7468  es:.        orth
+0000cfe0: 6f67 7261 7068 7920 3d20 2220 222e 6a6f  ography = " ".jo
+0000cff0: 696e 286f 7274 686f 6772 6170 6879 2e73  in(orthography.s
+0000d000: 706c 6974 2829 290a 2020 2020 6966 2066  plit()).    if f
+0000d010: 696e 616c 5f73 7472 6970 3a0a 2020 2020  inal_strip:.    
+0000d020: 2020 2020 6f72 7468 6f67 7261 7068 7920      orthography 
+0000d030: 3d20 6f72 7468 6f67 7261 7068 792e 7374  = orthography.st
+0000d040: 7269 7028 290a 2020 2020 7265 7475 726e  rip().    return
+0000d050: 206c 6973 7428 7072 6566 6978 2920 2b20   list(prefix) + 
+0000d060: 7061 7273 655f 6f72 7468 6f67 7261 7068  parse_orthograph
+0000d070: 795f 696e 746f 5f73 796d 626f 6c73 286f  y_into_symbols(o
+0000d080: 7274 686f 6772 6170 6879 2c20 2a2a 6b77  rthography, **kw
+0000d090: 6172 6773 2920 2b20 6c69 7374 2870 6f73  args) + list(pos
+0000d0a0: 7466 6978 290a 0a0a 6465 6620 6a73 6f6e  tfix)...def json
+0000d0b0: 5f72 656d 6f76 655f 636f 6d6d 656e 7473  _remove_comments
+0000d0c0: 2873 7472 696e 672c 2073 7472 6970 5f73  (string, strip_s
+0000d0d0: 7061 6365 3d54 7275 6529 3a0a 2020 2020  pace=True):.    
+0000d0e0: 2222 220a 2020 2020 3a74 7970 6520 7374  """.    :type st
+0000d0f0: 7269 6e67 3a20 7374 720a 2020 2020 3a70  ring: str.    :p
+0000d100: 6172 616d 2062 6f6f 6c20 7374 7269 705f  aram bool strip_
+0000d110: 7370 6163 653a 0a20 2020 203a 7274 7970  space:.    :rtyp
+0000d120: 653a 2073 7472 0a0a 2020 2020 7669 6120  e: str..    via 
+0000d130: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+0000d140: 6f6d 2f67 6574 6966 792f 4a53 4f4e 2e6d  om/getify/JSON.m
+0000d150: 696e 6966 792f 626c 6f62 2f6d 6173 7465  inify/blob/maste
+0000d160: 722f 6d69 6e69 6679 5f6a 736f 6e2e 7079  r/minify_json.py
+0000d170: 2c0a 2020 2020 6279 2047 6572 616c 6420  ,.    by Gerald 
+0000d180: 5374 6f72 6572 2c20 5072 6164 7975 6e20  Storer, Pradyun 
+0000d190: 532e 2047 6564 616d 2c20 6d6f 6469 6669  S. Gedam, modifi
+0000d1a0: 6564 2062 7920 7573 2e0a 2020 2020 2222  ed by us..    ""
+0000d1b0: 220a 2020 2020 746f 6b65 6e69 7a65 7220  ".    tokenizer 
+0000d1c0: 3d20 7265 2e63 6f6d 7069 6c65 2827 227c  = re.compile('"|
+0000d1d0: 282f 5c5c 2a29 7c28 5c5c 2a2f 297c 282f  (/\\*)|(\\*/)|(/
+0000d1e0: 2f29 7c5c 6e7c 5c72 2729 0a20 2020 2065  /)|\n|\r').    e
+0000d1f0: 6e64 5f73 6c61 7368 6573 5f72 6520 3d20  nd_slashes_re = 
+0000d200: 7265 2e63 6f6d 7069 6c65 2872 2228 5c5c  re.compile(r"(\\
+0000d210: 292a 2422 290a 0a20 2020 2069 6e5f 7374  )*$")..    in_st
+0000d220: 7269 6e67 203d 2046 616c 7365 0a20 2020  ring = False.   
+0000d230: 2069 6e5f 6d75 6c74 6920 3d20 4661 6c73   in_multi = Fals
+0000d240: 650a 2020 2020 696e 5f73 696e 676c 6520  e.    in_single 
+0000d250: 3d20 4661 6c73 650a 0a20 2020 206e 6577  = False..    new
+0000d260: 5f73 7472 203d 205b 5d0a 2020 2020 696e  _str = [].    in
+0000d270: 6465 7820 3d20 300a 0a20 2020 2066 6f72  dex = 0..    for
+0000d280: 206d 6174 6368 2069 6e20 7265 2e66 696e   match in re.fin
+0000d290: 6469 7465 7228 746f 6b65 6e69 7a65 722c  diter(tokenizer,
+0000d2a0: 2073 7472 696e 6729 3a0a 0a20 2020 2020   string):..     
+0000d2b0: 2020 2069 6620 6e6f 7420 2869 6e5f 6d75     if not (in_mu
+0000d2c0: 6c74 6920 6f72 2069 6e5f 7369 6e67 6c65  lti or in_single
+0000d2d0: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+0000d2e0: 6d70 203d 2073 7472 696e 675b 696e 6465  mp = string[inde
+0000d2f0: 7820 3a20 6d61 7463 682e 7374 6172 7428  x : match.start(
+0000d300: 295d 0a20 2020 2020 2020 2020 2020 2069  )].            i
+0000d310: 6620 6e6f 7420 696e 5f73 7472 696e 6720  f not in_string 
+0000d320: 616e 6420 7374 7269 705f 7370 6163 653a  and strip_space:
+0000d330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d340: 2023 2072 6570 6c61 6365 2077 6869 7465   # replace white
+0000d350: 2073 7061 6365 2061 7320 6465 6669 6e65   space as define
+0000d360: 6420 696e 2073 7461 6e64 6172 640a 2020  d in standard.  
+0000d370: 2020 2020 2020 2020 2020 2020 2020 746d                tm
+0000d380: 7020 3d20 7265 2e73 7562 2822 5b20 5c74  p = re.sub("[ \t
+0000d390: 5c6e 5c72 5d2b 222c 2022 222c 2074 6d70  \n\r]+", "", tmp
+0000d3a0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+0000d3b0: 775f 7374 722e 6170 7065 6e64 2874 6d70  w_str.append(tmp
+0000d3c0: 290a 0a20 2020 2020 2020 2069 6e64 6578  )..        index
+0000d3d0: 203d 206d 6174 6368 2e65 6e64 2829 0a20   = match.end(). 
+0000d3e0: 2020 2020 2020 2076 616c 203d 206d 6174         val = mat
+0000d3f0: 6368 2e67 726f 7570 2829 0a0a 2020 2020  ch.group()..    
+0000d400: 2020 2020 6966 2076 616c 203d 3d20 2722      if val == '"
+0000d410: 2720 616e 6420 6e6f 7420 2869 6e5f 6d75  ' and not (in_mu
+0000d420: 6c74 6920 6f72 2069 6e5f 7369 6e67 6c65  lti or in_single
+0000d430: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
+0000d440: 7363 6170 6564 203d 2065 6e64 5f73 6c61  scaped = end_sla
+0000d450: 7368 6573 5f72 652e 7365 6172 6368 2873  shes_re.search(s
+0000d460: 7472 696e 672c 2030 2c20 6d61 7463 682e  tring, 0, match.
+0000d470: 7374 6172 7428 2929 0a0a 2020 2020 2020  start())..      
+0000d480: 2020 2020 2020 2320 7374 6172 7420 6f66        # start of
+0000d490: 2073 7472 696e 6720 6f72 2075 6e65 7363   string or unesc
+0000d4a0: 6170 6564 2071 756f 7465 2063 6861 7261  aped quote chara
+0000d4b0: 6374 6572 2074 6f20 656e 6420 7374 7269  cter to end stri
+0000d4c0: 6e67 0a20 2020 2020 2020 2020 2020 2069  ng.            i
+0000d4d0: 6620 6e6f 7420 696e 5f73 7472 696e 6720  f not in_string 
+0000d4e0: 6f72 2028 6573 6361 7065 6420 6973 204e  or (escaped is N
+0000d4f0: 6f6e 6520 6f72 206c 656e 2865 7363 6170  one or len(escap
+0000d500: 6564 2e67 726f 7570 2829 2920 2520 3220  ed.group()) % 2 
+0000d510: 3d3d 2030 293a 0a20 2020 2020 2020 2020  == 0):.         
+0000d520: 2020 2020 2020 2069 6e5f 7374 7269 6e67         in_string
+0000d530: 203d 206e 6f74 2069 6e5f 7374 7269 6e67   = not in_string
+0000d540: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0000d550: 6578 202d 3d20 3120 2023 2069 6e63 6c75  ex -= 1  # inclu
+0000d560: 6465 2022 2063 6861 7261 6374 6572 2069  de " character i
+0000d570: 6e20 6e65 7874 2063 6174 6368 0a20 2020  n next catch.   
+0000d580: 2020 2020 2065 6c69 6620 6e6f 7420 2869       elif not (i
+0000d590: 6e5f 7374 7269 6e67 206f 7220 696e 5f6d  n_string or in_m
+0000d5a0: 756c 7469 206f 7220 696e 5f73 696e 676c  ulti or in_singl
+0000d5b0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0000d5c0: 6966 2076 616c 203d 3d20 222f 2a22 3a0a  if val == "/*":.
+0000d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5e0: 696e 5f6d 756c 7469 203d 2054 7275 650a  in_multi = True.
+0000d5f0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000d600: 2076 616c 203d 3d20 222f 2f22 3a0a 2020   val == "//":.  
+0000d610: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000d620: 5f73 696e 676c 6520 3d20 5472 7565 0a20  _single = True. 
+0000d630: 2020 2020 2020 2065 6c69 6620 7661 6c20         elif val 
+0000d640: 3d3d 2022 2a2f 2220 616e 6420 696e 5f6d  == "*/" and in_m
+0000d650: 756c 7469 2061 6e64 206e 6f74 2028 696e  ulti and not (in
+0000d660: 5f73 7472 696e 6720 6f72 2069 6e5f 7369  _string or in_si
+0000d670: 6e67 6c65 293a 0a20 2020 2020 2020 2020  ngle):.         
+0000d680: 2020 2069 6e5f 6d75 6c74 6920 3d20 4661     in_multi = Fa
+0000d690: 6c73 650a 2020 2020 2020 2020 656c 6966  lse.        elif
+0000d6a0: 2076 616c 2069 6e20 225c 725c 6e22 2061   val in "\r\n" a
+0000d6b0: 6e64 206e 6f74 2028 696e 5f6d 756c 7469  nd not (in_multi
+0000d6c0: 206f 7220 696e 5f73 7472 696e 6729 2061   or in_string) a
+0000d6d0: 6e64 2069 6e5f 7369 6e67 6c65 3a0a 2020  nd in_single:.  
+0000d6e0: 2020 2020 2020 2020 2020 696e 5f73 696e            in_sin
+0000d6f0: 676c 6520 3d20 4661 6c73 650a 2020 2020  gle = False.    
+0000d700: 2020 2020 656c 6966 206e 6f74 2028 2869      elif not ((i
+0000d710: 6e5f 6d75 6c74 6920 6f72 2069 6e5f 7369  n_multi or in_si
+0000d720: 6e67 6c65 2920 6f72 2028 7661 6c20 696e  ngle) or (val in
+0000d730: 2022 205c 725c 6e5c 7422 2061 6e64 2073   " \r\n\t" and s
+0000d740: 7472 6970 5f73 7061 6365 2929 3a0a 2020  trip_space)):.  
+0000d750: 2020 2020 2020 2020 2020 6e65 775f 7374            new_st
+0000d760: 722e 6170 7065 6e64 2876 616c 290a 0a20  r.append(val).. 
+0000d770: 2020 206e 6577 5f73 7472 2e61 7070 656e     new_str.appen
+0000d780: 6428 7374 7269 6e67 5b69 6e64 6578 3a5d  d(string[index:]
+0000d790: 290a 2020 2020 7265 7475 726e 2022 222e  ).    return "".
+0000d7a0: 6a6f 696e 286e 6577 5f73 7472 290a 0a0a  join(new_str)...
+0000d7b0: 6465 6620 5f70 7932 5f75 6e69 636f 6465  def _py2_unicode
+0000d7c0: 5f74 6f5f 7374 725f 7265 6375 7273 6976  _to_str_recursiv
+0000d7d0: 6528 7329 3a0a 2020 2020 2222 220a 2020  e(s):.    """.  
+0000d7e0: 2020 5468 6973 2069 7320 7375 7070 6f73    This is suppos
+0000d7f0: 6564 2074 6f20 6265 2072 756e 2077 6974  ed to be run wit
+0000d800: 6820 5079 7468 6f6e 2032 2e0a 2020 2020  h Python 2..    
+0000d810: 416c 736f 2073 6565 203a 6675 6e63 3a60  Also see :func:`
+0000d820: 6173 5f73 7472 6020 616e 6420 3a66 756e  as_str` and :fun
+0000d830: 633a 6070 7932 5f75 7466 385f 7374 725f  c:`py2_utf8_str_
+0000d840: 746f 5f75 6e69 636f 6465 602e 0a0a 2020  to_unicode`...  
+0000d850: 2020 3a70 6172 616d 2073 7472 7c75 6e69    :param str|uni
+0000d860: 636f 6465 2073 3a20 6f72 2061 6e79 2072  code s: or any r
+0000d870: 6563 7572 7369 7665 2073 7472 7563 7475  ecursive structu
+0000d880: 7265 2073 7563 6820 6173 2064 6963 742c  re such as dict,
+0000d890: 206c 6973 742c 2074 7570 6c65 0a20 2020   list, tuple.   
+0000d8a0: 203a 7265 7475 726e 3a20 5079 7468 6f6e   :return: Python
+0000d8b0: 2032 2073 7472 2028 6973 206c 696b 6520   2 str (is like 
+0000d8c0: 5079 7468 6f6e 2033 2055 5446 2d38 2066  Python 3 UTF-8 f
+0000d8d0: 6f72 6d61 7474 6564 2062 7974 6573 290a  ormatted bytes).
+0000d8e0: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
+0000d8f0: 2020 2020 2222 220a 2020 2020 6966 2069      """.    if i
+0000d900: 7369 6e73 7461 6e63 6528 732c 2064 6963  sinstance(s, dic
+0000d910: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
+0000d920: 726e 207b 5f70 7932 5f75 6e69 636f 6465  rn {_py2_unicode
+0000d930: 5f74 6f5f 7374 725f 7265 6375 7273 6976  _to_str_recursiv
+0000d940: 6528 6b65 7929 3a20 5f70 7932 5f75 6e69  e(key): _py2_uni
+0000d950: 636f 6465 5f74 6f5f 7374 725f 7265 6375  code_to_str_recu
+0000d960: 7273 6976 6528 7661 6c75 6529 2066 6f72  rsive(value) for
+0000d970: 206b 6579 2c20 7661 6c75 6520 696e 2073   key, value in s
+0000d980: 2e69 7465 6d73 2829 7d0a 2020 2020 656c  .items()}.    el
+0000d990: 6966 2069 7369 6e73 7461 6e63 6528 732c  if isinstance(s,
+0000d9a0: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
+0000d9b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d9c0: 6d61 6b65 5f73 6571 5f6f 665f 7479 7065  make_seq_of_type
+0000d9d0: 2874 7970 6528 7329 2c20 5b5f 7079 325f  (type(s), [_py2_
+0000d9e0: 756e 6963 6f64 655f 746f 5f73 7472 5f72  unicode_to_str_r
+0000d9f0: 6563 7572 7369 7665 2865 6c65 6d65 6e74  ecursive(element
+0000da00: 2920 666f 7220 656c 656d 656e 7420 696e  ) for element in
+0000da10: 2073 5d29 0a20 2020 2065 6c69 6620 6973   s]).    elif is
+0000da20: 696e 7374 616e 6365 2873 2c20 756e 6963  instance(s, unic
+0000da30: 6f64 6529 3a0a 2020 2020 2020 2020 7265  ode):.        re
+0000da40: 7475 726e 2073 2e65 6e63 6f64 6528 2275  turn s.encode("u
+0000da50: 7466 2d38 2229 2020 2320 5079 7468 6f6e  tf-8")  # Python
+0000da60: 2032 2073 7472 2c20 5079 7468 6f6e 2033   2 str, Python 3
+0000da70: 2062 7974 6573 0a20 2020 2065 6c73 653a   bytes.    else:
+0000da80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000da90: 730a 0a0a 6465 6620 6c6f 6164 5f6a 736f  s...def load_jso
+0000daa0: 6e28 6669 6c65 6e61 6d65 3d4e 6f6e 652c  n(filename=None,
+0000dab0: 2063 6f6e 7465 6e74 3d4e 6f6e 6529 3a0a   content=None):.
+0000dac0: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+0000dad0: 616d 2073 7472 7c4e 6f6e 6520 6669 6c65  am str|None file
+0000dae0: 6e61 6d65 3a0a 2020 2020 3a70 6172 616d  name:.    :param
+0000daf0: 2073 7472 7c4e 6f6e 6520 636f 6e74 656e   str|None conten
+0000db00: 743a 0a20 2020 203a 7274 7970 653a 2064  t:.    :rtype: d
+0000db10: 6963 745b 7374 725d 0a20 2020 2022 2222  ict[str].    """
+0000db20: 0a20 2020 2069 6620 636f 6e74 656e 743a  .    if content:
+0000db30: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0000db40: 6e6f 7420 6669 6c65 6e61 6d65 0a20 2020  not filename.   
+0000db50: 2065 6c73 653a 0a20 2020 2020 2020 2063   else:.        c
+0000db60: 6f6e 7465 6e74 203d 206f 7065 6e28 6669  ontent = open(fi
+0000db70: 6c65 6e61 6d65 292e 7265 6164 2829 0a20  lename).read(). 
+0000db80: 2020 2069 6d70 6f72 7420 6a73 6f6e 0a0a     import json..
+0000db90: 2020 2020 636f 6e74 656e 7420 3d20 6a73      content = js
+0000dba0: 6f6e 5f72 656d 6f76 655f 636f 6d6d 656e  on_remove_commen
+0000dbb0: 7473 2863 6f6e 7465 6e74 290a 2020 2020  ts(content).    
+0000dbc0: 7472 793a 0a20 2020 2020 2020 206a 736f  try:.        jso
+0000dbd0: 6e5f 636f 6e74 656e 7420 3d20 6a73 6f6e  n_content = json
+0000dbe0: 2e6c 6f61 6473 2863 6f6e 7465 6e74 290a  .loads(content).
+0000dbf0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+0000dc00: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0000dc10: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0000dc20: 696f 6e28 2263 6f6e 6669 6720 6c6f 6f6b  ion("config look
+0000dc30: 7320 6c69 6b65 204a 534f 4e20 6275 7420  s like JSON but 
+0000dc40: 696e 7661 6c69 6420 6a73 6f6e 2063 6f6e  invalid json con
+0000dc50: 7465 6e74 2c20 2572 2220 2520 6529 0a20  tent, %r" % e). 
+0000dc60: 2020 2069 6620 6e6f 7420 5059 333a 0a20     if not PY3:. 
+0000dc70: 2020 2020 2020 206a 736f 6e5f 636f 6e74         json_cont
+0000dc80: 656e 7420 3d20 5f70 7932 5f75 6e69 636f  ent = _py2_unico
+0000dc90: 6465 5f74 6f5f 7374 725f 7265 6375 7273  de_to_str_recurs
+0000dca0: 6976 6528 6a73 6f6e 5f63 6f6e 7465 6e74  ive(json_content
+0000dcb0: 290a 2020 2020 7265 7475 726e 206a 736f  ).    return jso
+0000dcc0: 6e5f 636f 6e74 656e 740a 0a0a 636c 6173  n_content...clas
+0000dcd0: 7320 4e75 6d62 6572 7344 6963 743a 0a20  s NumbersDict:. 
+0000dce0: 2020 2022 2222 0a20 2020 2049 7427 7320     """.    It's 
+0000dcf0: 6d6f 7374 6c79 206c 696b 6520 6469 6374  mostly like dict
+0000dd00: 5b73 7472 2c66 6c6f 6174 7c69 6e74 5d20  [str,float|int] 
+0000dd10: 2620 736f 6d65 206f 7074 696f 6e61 6c20  & some optional 
+0000dd20: 6272 6f61 6463 6173 7420 6465 6661 756c  broadcast defaul
+0000dd30: 7420 7661 6c75 652e 0a20 2020 2049 7420  t value..    It 
+0000dd40: 696d 706c 656d 656e 7473 2074 6865 2073  implements the s
+0000dd50: 7461 6e64 6172 6420 6d61 7468 2062 696e  tandard math bin
+0000dd60: 206f 7073 2069 6e20 6120 7374 7261 6967   ops in a straig
+0000dd70: 6874 2d66 6f72 7761 7264 2077 6179 2e0a  ht-forward way..
+0000dd80: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+0000dd90: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0000dda0: 6175 746f 5f63 6f6e 7665 7274 3d4e 6f6e  auto_convert=Non
+0000ddb0: 652c 206e 756d 6265 7273 5f64 6963 743d  e, numbers_dict=
+0000ddc0: 4e6f 6e65 2c20 6272 6f61 6463 6173 745f  None, broadcast_
+0000ddd0: 7661 6c75 653d 4e6f 6e65 293a 0a20 2020  value=None):.   
+0000dde0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ddf0: 203a 7061 7261 6d20 6469 6374 7c4e 756d   :param dict|Num
+0000de00: 6265 7273 4469 6374 7c54 2061 7574 6f5f  bersDict|T auto_
+0000de10: 636f 6e76 6572 743a 2066 6972 7374 2061  convert: first a
+0000de20: 7267 756d 656e 742c 2073 6f20 7468 6174  rgument, so that
+0000de30: 2077 6520 6361 6e20 6175 746f 6d61 7469   we can automati
+0000de40: 6361 6c6c 7920 636f 6e76 6572 742f 636f  cally convert/co
+0000de50: 7079 0a20 2020 2020 2020 203a 7061 7261  py.        :para
+0000de60: 6d20 6469 6374 206e 756d 6265 7273 5f64  m dict numbers_d
+0000de70: 6963 743a 0a20 2020 2020 2020 203a 7061  ict:.        :pa
+0000de80: 7261 6d20 5420 6272 6f61 6463 6173 745f  ram T broadcast_
+0000de90: 7661 6c75 653a 0a20 2020 2020 2020 2022  value:.        "
+0000dea0: 2222 0a20 2020 2020 2020 2069 6620 6175  "".        if au
+0000deb0: 746f 5f63 6f6e 7665 7274 2069 7320 6e6f  to_convert is no
+0000dec0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000ded0: 2020 2020 6173 7365 7274 2062 726f 6164      assert broad
+0000dee0: 6361 7374 5f76 616c 7565 2069 7320 4e6f  cast_value is No
+0000def0: 6e65 0a20 2020 2020 2020 2020 2020 2061  ne.            a
+0000df00: 7373 6572 7420 6e75 6d62 6572 735f 6469  ssert numbers_di
+0000df10: 6374 2069 7320 4e6f 6e65 0a20 2020 2020  ct is None.     
+0000df20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000df30: 616e 6365 2861 7574 6f5f 636f 6e76 6572  ance(auto_conver
+0000df40: 742c 2064 6963 7429 3a0a 2020 2020 2020  t, dict):.      
+0000df50: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+0000df60: 735f 6469 6374 203d 2061 7574 6f5f 636f  s_dict = auto_co
+0000df70: 6e76 6572 740a 2020 2020 2020 2020 2020  nvert.          
+0000df80: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0000df90: 6528 6175 746f 5f63 6f6e 7665 7274 2c20  e(auto_convert, 
+0000dfa0: 4e75 6d62 6572 7344 6963 7429 3a0a 2020  NumbersDict):.  
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
+0000dfc0: 6d62 6572 735f 6469 6374 203d 2061 7574  mbers_dict = aut
+0000dfd0: 6f5f 636f 6e76 6572 742e 6469 6374 0a20  o_convert.dict. 
+0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000dff0: 726f 6164 6361 7374 5f76 616c 7565 203d  roadcast_value =
+0000e000: 2061 7574 6f5f 636f 6e76 6572 742e 7661   auto_convert.va
+0000e010: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+0000e020: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e030: 2020 2020 2020 6272 6f61 6463 6173 745f        broadcast_
+0000e040: 7661 6c75 6520 3d20 6175 746f 5f63 6f6e  value = auto_con
+0000e050: 7665 7274 0a20 2020 2020 2020 2069 6620  vert.        if 
+0000e060: 6e75 6d62 6572 735f 6469 6374 2069 7320  numbers_dict is 
+0000e070: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000e080: 2020 6e75 6d62 6572 735f 6469 6374 203d    numbers_dict =
+0000e090: 207b 7d0a 2020 2020 2020 2020 656c 7365   {}.        else
+0000e0a0: 3a0a 2020 2020 2020 2020 2020 2020 6e75  :.            nu
+0000e0b0: 6d62 6572 735f 6469 6374 203d 2064 6963  mbers_dict = dic
+0000e0c0: 7428 6e75 6d62 6572 735f 6469 6374 2920  t(numbers_dict) 
+0000e0d0: 2023 2066 6f72 6365 2063 6f70 790a 0a20   # force copy.. 
+0000e0e0: 2020 2020 2020 2073 656c 662e 6469 6374         self.dict
+0000e0f0: 203d 206e 756d 6265 7273 5f64 6963 740a   = numbers_dict.
+0000e100: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
+0000e110: 7565 203d 2062 726f 6164 6361 7374 5f76  ue = broadcast_v
+0000e120: 616c 7565 0a20 2020 2020 2020 2073 656c  alue.        sel
+0000e130: 662e 6d61 7820 3d20 7365 6c66 2e5f 6d61  f.max = self._ma
+0000e140: 785f 6572 726f 720a 0a20 2020 2064 6566  x_error..    def
+0000e150: 2063 6f70 7928 7365 6c66 293a 0a20 2020   copy(self):.   
+0000e160: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e170: 203a 7274 7970 653a 204e 756d 6265 7273   :rtype: Numbers
+0000e180: 4469 6374 0a20 2020 2020 2020 2022 2222  Dict.        """
+0000e190: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e1a0: 4e75 6d62 6572 7344 6963 7428 7365 6c66  NumbersDict(self
+0000e1b0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+0000e1c0: 686f 640a 2020 2020 6465 6620 636f 6e73  hod.    def cons
+0000e1d0: 7461 6e74 5f6c 696b 6528 636c 732c 2063  tant_like(cls, c
+0000e1e0: 6f6e 7374 5f6e 756d 6265 722c 206e 756d  onst_number, num
+0000e1f0: 6265 7273 5f64 6963 7429 3a0a 2020 2020  bers_dict):.    
+0000e200: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e210: 3a70 6172 616d 2069 6e74 7c66 6c6f 6174  :param int|float
+0000e220: 7c6f 626a 6563 7420 636f 6e73 745f 6e75  |object const_nu
+0000e230: 6d62 6572 3a0a 2020 2020 2020 2020 3a70  mber:.        :p
+0000e240: 6172 616d 204e 756d 6265 7273 4469 6374  aram NumbersDict
+0000e250: 206e 756d 6265 7273 5f64 6963 743a 0a20   numbers_dict:. 
+0000e260: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0000e270: 4e75 6d62 6572 7344 6963 7420 7769 7468  NumbersDict with
+0000e280: 2073 616d 6520 6b65 7973 2061 7320 6e75   same keys as nu
+0000e290: 6d62 6572 735f 6469 6374 0a20 2020 2020  mbers_dict.     
+0000e2a0: 2020 203a 7274 7970 653a 204e 756d 6265     :rtype: Numbe
+0000e2b0: 7273 4469 6374 0a20 2020 2020 2020 2022  rsDict.        "
+0000e2c0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000e2d0: 6e20 4e75 6d62 6572 7344 6963 7428 0a20  n NumbersDict(. 
+0000e2e0: 2020 2020 2020 2020 2020 2062 726f 6164             broad
+0000e2f0: 6361 7374 5f76 616c 7565 3d63 6f6e 7374  cast_value=const
+0000e300: 5f6e 756d 6265 7220 6966 2028 6e75 6d62  _number if (numb
+0000e310: 6572 735f 6469 6374 2e76 616c 7565 2069  ers_dict.value i
+0000e320: 7320 6e6f 7420 4e6f 6e65 2920 656c 7365  s not None) else
+0000e330: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0000e340: 2020 206e 756d 6265 7273 5f64 6963 743d     numbers_dict=
+0000e350: 7b6b 3a20 636f 6e73 745f 6e75 6d62 6572  {k: const_number
+0000e360: 2066 6f72 206b 2069 6e20 6e75 6d62 6572   for k in number
+0000e370: 735f 6469 6374 2e64 6963 742e 6b65 7973  s_dict.dict.keys
+0000e380: 2829 7d2c 0a20 2020 2020 2020 2029 0a0a  ()},.        )..
+0000e390: 2020 2020 6465 6620 636f 7079 5f6c 696b      def copy_lik
+0000e3a0: 6528 7365 6c66 2c20 6e75 6d62 6572 735f  e(self, numbers_
+0000e3b0: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+0000e3c0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+0000e3d0: 6d20 4e75 6d62 6572 7344 6963 7420 6e75  m NumbersDict nu
+0000e3e0: 6d62 6572 735f 6469 6374 3a0a 2020 2020  mbers_dict:.    
+0000e3f0: 2020 2020 3a72 6574 7572 6e3a 2063 6f70      :return: cop
+0000e400: 7920 6f66 2073 656c 6620 7769 7468 2073  y of self with s
+0000e410: 616d 6520 6b65 7973 2061 7320 6e75 6d62  ame keys as numb
+0000e420: 6572 735f 6469 6374 2061 7320 6661 7220  ers_dict as far 
+0000e430: 6173 2077 6520 6861 7665 2074 6865 6d0a  as we have them.
+0000e440: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+0000e450: 4e75 6d62 6572 7344 6963 740a 2020 2020  NumbersDict.    
+0000e460: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e470: 6966 2073 656c 662e 7661 6c75 6520 6973  if self.value is
+0000e480: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000e490: 2020 2020 2020 2072 6574 7572 6e20 4e75         return Nu
+0000e4a0: 6d62 6572 7344 6963 7428 0a20 2020 2020  mbersDict(.     
+0000e4b0: 2020 2020 2020 2020 2020 2062 726f 6164             broad
+0000e4c0: 6361 7374 5f76 616c 7565 3d73 656c 662e  cast_value=self.
+0000e4d0: 7661 6c75 6520 6966 2028 6e75 6d62 6572  value if (number
+0000e4e0: 735f 6469 6374 2e76 616c 7565 2069 7320  s_dict.value is 
+0000e4f0: 6e6f 7420 4e6f 6e65 2920 656c 7365 204e  not None) else N
+0000e500: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0000e510: 2020 2020 206e 756d 6265 7273 5f64 6963       numbers_dic
+0000e520: 743d 7b6b 3a20 7365 6c66 5b6b 5d20 666f  t={k: self[k] fo
+0000e530: 7220 6b20 696e 206e 756d 6265 7273 5f64  r k in numbers_d
+0000e540: 6963 742e 6469 6374 2e6b 6579 7328 297d  ict.dict.keys()}
+0000e550: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000e560: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000e570: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e580: 204e 756d 6265 7273 4469 6374 280a 2020   NumbersDict(.  
+0000e590: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0000e5a0: 6f61 6463 6173 745f 7661 6c75 653d 4e6f  oadcast_value=No
+0000e5b0: 6e65 2c20 6e75 6d62 6572 735f 6469 6374  ne, numbers_dict
+0000e5c0: 3d7b 6b3a 2073 656c 665b 6b5d 2066 6f72  ={k: self[k] for
+0000e5d0: 206b 2069 6e20 6e75 6d62 6572 735f 6469   k in numbers_di
+0000e5e0: 6374 2e64 6963 742e 6b65 7973 2829 2069  ct.dict.keys() i
+0000e5f0: 6620 6b20 696e 2073 656c 662e 6469 6374  f k in self.dict
+0000e600: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
+0000e610: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0000e620: 2020 2064 6566 206b 6579 735f 7365 7428     def keys_set(
+0000e630: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000e640: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
+0000e650: 653a 2073 6574 5b73 7472 5d0a 2020 2020  e: set[str].    
+0000e660: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e670: 7265 7475 726e 2073 6574 2873 656c 662e  return set(self.
+0000e680: 6469 6374 2e6b 6579 7328 2929 0a0a 2020  dict.keys())..  
+0000e690: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
+0000e6a0: 5f28 7365 6c66 2c20 6b65 7929 3a0a 2020  _(self, key):.  
+0000e6b0: 2020 2020 2020 6966 2073 656c 662e 7661        if self.va
+0000e6c0: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
+0000e6d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000e6e0: 7572 6e20 7365 6c66 2e64 6963 742e 6765  urn self.dict.ge
+0000e6f0: 7428 6b65 792c 2073 656c 662e 7661 6c75  t(key, self.valu
+0000e700: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+0000e710: 6e20 7365 6c66 2e64 6963 745b 6b65 795d  n self.dict[key]
+0000e720: 0a0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
+0000e730: 7465 6d5f 5f28 7365 6c66 2c20 6b65 792c  tem__(self, key,
+0000e740: 2076 616c 7565 293a 0a20 2020 2020 2020   value):.       
+0000e750: 2073 656c 662e 6469 6374 5b6b 6579 5d20   self.dict[key] 
+0000e760: 3d20 7661 6c75 650a 0a20 2020 2064 6566  = value..    def
+0000e770: 205f 5f64 656c 6974 656d 5f5f 2873 656c   __delitem__(sel
+0000e780: 662c 206b 6579 293a 0a20 2020 2020 2020  f, key):.       
+0000e790: 2064 656c 2073 656c 662e 6469 6374 5b6b   del self.dict[k
+0000e7a0: 6579 5d0a 0a20 2020 2064 6566 2067 6574  ey]..    def get
+0000e7b0: 2873 656c 662c 206b 6579 2c20 6465 6661  (self, key, defa
+0000e7c0: 756c 743d 4e6f 6e65 293a 0a20 2020 2020  ult=None):.     
+0000e7d0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0000e7e0: 7061 7261 6d20 7374 7220 6b65 793a 0a20  param str key:. 
+0000e7f0: 2020 2020 2020 203a 7061 7261 6d20 5420         :param T 
+0000e800: 6465 6661 756c 743a 0a20 2020 2020 2020  default:.       
+0000e810: 203a 7274 7970 653a 206f 626a 6563 747c   :rtype: object|
+0000e820: 540a 2020 2020 2020 2020 2222 220a 2020  T.        """.  
+0000e830: 2020 2020 2020 2320 4b65 6570 2063 6f6e        # Keep con
+0000e840: 7369 7374 656e 7420 7769 7468 2073 656c  sistent with sel
+0000e850: 662e 5f5f 6765 745f 6974 656d 5f5f 2e20  f.__get_item__. 
+0000e860: 4966 2073 656c 662e 7661 6c75 6520 6973  If self.value is
+0000e870: 2073 6574 2c20 7468 6973 2077 696c 6c20   set, this will 
+0000e880: 616c 7761 7973 2062 6520 7468 6520 6465  always be the de
+0000e890: 6661 756c 7420 7661 6c75 652e 0a20 2020  fault value..   
+0000e8a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000e8b0: 2e64 6963 742e 6765 7428 6b65 792c 2073  .dict.get(key, s
+0000e8c0: 656c 662e 7661 6c75 6520 6966 2073 656c  elf.value if sel
+0000e8d0: 662e 7661 6c75 6520 6973 206e 6f74 204e  f.value is not N
+0000e8e0: 6f6e 6520 656c 7365 2064 6566 6175 6c74  one else default
+0000e8f0: 290a 0a20 2020 2064 6566 2070 6f70 2873  )..    def pop(s
+0000e900: 656c 662c 206b 6579 2c20 2a61 7267 7329  elf, key, *args)
+0000e910: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e920: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+0000e930: 206b 6579 3a0a 2020 2020 2020 2020 3a70   key:.        :p
+0000e940: 6172 616d 2054 2061 7267 733a 2064 6566  aram T args: def
+0000e950: 6175 6c74 2c20 6f72 206e 6f74 0a20 2020  ault, or not.   
+0000e960: 2020 2020 203a 7274 7970 653a 206f 626a       :rtype: obj
+0000e970: 6563 747c 540a 2020 2020 2020 2020 2222  ect|T.        ""
+0000e980: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0000e990: 2073 656c 662e 6469 6374 2e70 6f70 286b   self.dict.pop(k
+0000e9a0: 6579 2c20 2a61 7267 7329 0a0a 2020 2020  ey, *args)..    
+0000e9b0: 6465 6620 5f5f 6974 6572 5f5f 2873 656c  def __iter__(sel
+0000e9c0: 6629 3a0a 2020 2020 2020 2020 2320 5468  f):.        # Th
+0000e9d0: 6973 2063 616e 2070 6f74 656e 7469 616c  is can potential
+0000e9e0: 6c79 2063 6175 7365 2063 6f6e 6675 7369  ly cause confusi
+0000e9f0: 6f6e 2e20 536f 2065 6e66 6f72 6365 2065  on. So enforce e
+0000ea00: 7870 6c69 6369 746e 6573 732e 0a20 2020  xplicitness..   
+0000ea10: 2020 2020 2023 2046 6f72 2061 2064 6963       # For a dic
+0000ea20: 742c 2077 6520 776f 756c 6420 7265 7475  t, we would retu
+0000ea30: 726e 2074 6865 2064 6963 7420 6b65 7973  rn the dict keys
+0000ea40: 2068 6572 652e 0a20 2020 2020 2020 2023   here..        #
+0000ea50: 2041 6c73 6f2c 206d 6178 2873 656c 6629   Also, max(self)
+0000ea60: 2077 6f75 6c64 2072 6573 756c 7420 696e   would result in
+0000ea70: 2061 2063 616c 6c20 746f 2073 656c 662e   a call to self.
+0000ea80: 5f5f 6974 6572 5f5f 2829 2c0a 2020 2020  __iter__(),.    
+0000ea90: 2020 2020 2320 7768 6963 6820 776f 756c      # which woul
+0000eaa0: 6420 6f6e 6c79 206d 616b 6520 7365 6e73  d only make sens
+0000eab0: 6520 666f 7220 6f75 7220 7661 6c75 6573  e for our values
+0000eac0: 2c20 6e6f 7420 7468 6520 6469 6374 206b  , not the dict k
+0000ead0: 6579 732e 0a20 2020 2020 2020 2072 6169  eys..        rai
+0000eae0: 7365 2045 7863 6570 7469 6f6e 2822 2573  se Exception("%s
+0000eaf0: 2e5f 5f69 7465 725f 5f20 6973 2075 6e64  .__iter__ is und
+0000eb00: 6566 696e 6564 2220 2520 7365 6c66 2e5f  efined" % self._
+0000eb10: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+0000eb20: 5f29 0a0a 2020 2020 6465 6620 6b65 7973  _)..    def keys
+0000eb30: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000eb40: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
+0000eb50: 7065 3a20 7365 745b 7374 725d 0a20 2020  pe: set[str].   
+0000eb60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000eb70: 2072 6574 7572 6e20 7365 6c66 2e64 6963   return self.dic
+0000eb80: 742e 6b65 7973 2829 0a0a 2020 2020 6465  t.keys()..    de
+0000eb90: 6620 7661 6c75 6573 2873 656c 6629 3a0a  f values(self):.
+0000eba0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ebb0: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
+0000ebc0: 5b6f 626a 6563 745d 0a20 2020 2020 2020  [object].       
+0000ebd0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+0000ebe0: 7572 6e20 6c69 7374 2873 656c 662e 6469  urn list(self.di
+0000ebf0: 6374 2e76 616c 7565 7328 2929 202b 2028  ct.values()) + (
+0000ec00: 5b73 656c 662e 7661 6c75 655d 2069 6620  [self.value] if 
+0000ec10: 7365 6c66 2e76 616c 7565 2069 7320 6e6f  self.value is no
+0000ec20: 7420 4e6f 6e65 2065 6c73 6520 5b5d 290a  t None else []).
+0000ec30: 0a20 2020 2064 6566 2069 7465 6d73 2873  .    def items(s
+0000ec40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000ec50: 220a 2020 2020 2020 2020 3a72 6574 7572  ".        :retur
+0000ec60: 6e3a 2064 6963 7420 6974 656d 732e 2074  n: dict items. t
+0000ec70: 6869 7320 6578 636c 7564 6573 2073 656c  his excludes sel
+0000ec80: 662e 7661 6c75 650a 2020 2020 2020 2020  f.value.        
+0000ec90: 3a72 7479 7065 3a20 7374 725b 2873 7472  :rtype: str[(str
+0000eca0: 2c6f 626a 6563 7429 5d0a 2020 2020 2020  ,object)].      
+0000ecb0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000ecc0: 7475 726e 2073 656c 662e 6469 6374 2e69  turn self.dict.i
+0000ecd0: 7465 6d73 2829 0a0a 2020 2020 6465 6620  tems()..    def 
+0000ece0: 6861 735f 7661 6c75 6573 2873 656c 6629  has_values(self)
+0000ecf0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000ed00: 2020 2020 2020 3a72 7479 7065 3a20 626f        :rtype: bo
+0000ed10: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
+0000ed20: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
+0000ed30: 6f6c 2873 656c 662e 6469 6374 2920 6f72  ol(self.dict) or
+0000ed40: 2073 656c 662e 7661 6c75 6520 6973 206e   self.value is n
+0000ed50: 6f74 204e 6f6e 650a 0a20 2020 2064 6566  ot None..    def
+0000ed60: 2075 6e61 7279 5f6f 7028 7365 6c66 2c20   unary_op(self, 
+0000ed70: 6f70 293a 0a20 2020 2020 2020 2022 2222  op):.        """
+0000ed80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000ed90: 2854 292d 3e54 3220 6f70 3a0a 2020 2020  (T)->T2 op:.    
+0000eda0: 2020 2020 3a72 6574 7572 6e3a 206e 6577      :return: new
+0000edb0: 204e 756d 6265 7273 4469 6374 2c20 7768   NumbersDict, wh
+0000edc0: 6572 6520 6060 6f70 6060 2069 7320 6170  ere ``op`` is ap
+0000edd0: 706c 6965 6420 6f6e 2061 6c6c 2076 616c  plied on all val
+0000ede0: 7565 730a 2020 2020 2020 2020 3a72 7479  ues.        :rty
+0000edf0: 7065 3a20 4e75 6d62 6572 7344 6963 740a  pe: NumbersDict.
+0000ee00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ee10: 2020 2020 7265 7320 3d20 4e75 6d62 6572      res = Number
+0000ee20: 7344 6963 7428 290a 2020 2020 2020 2020  sDict().        
+0000ee30: 6966 2073 656c 662e 7661 6c75 6520 6973  if self.value is
+0000ee40: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000ee50: 2020 2020 2020 2072 6573 2e76 616c 7565         res.value
+0000ee60: 203d 206f 7028 7365 6c66 2e76 616c 7565   = op(self.value
+0000ee70: 290a 2020 2020 2020 2020 666f 7220 6b2c  ).        for k,
+0000ee80: 2076 2069 6e20 7365 6c66 2e64 6963 742e   v in self.dict.
+0000ee90: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0000eea0: 2020 2020 2072 6573 2e64 6963 745b 6b5d       res.dict[k]
+0000eeb0: 203d 206f 7028 7629 0a20 2020 2020 2020   = op(v).       
+0000eec0: 2072 6574 7572 6e20 7265 730a 0a20 2020   return res..   
+0000eed0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0000eee0: 2020 6465 6620 6269 6e5f 6f70 5f73 6361    def bin_op_sca
+0000eef0: 6c61 725f 6f70 7469 6f6e 616c 2863 6c73  lar_optional(cls
+0000ef00: 2c20 7365 6c66 2c20 6f74 6865 722c 207a  , self, other, z
+0000ef10: 6572 6f2c 206f 7029 3a0a 2020 2020 2020  ero, op):.      
+0000ef20: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+0000ef30: 6172 616d 2054 2073 656c 663a 0a20 2020  aram T self:.   
+0000ef40: 2020 2020 203a 7061 7261 6d20 5420 6f74       :param T ot
+0000ef50: 6865 723a 0a20 2020 2020 2020 203a 7061  her:.        :pa
+0000ef60: 7261 6d20 5420 7a65 726f 3a0a 2020 2020  ram T zero:.    
+0000ef70: 2020 2020 3a70 6172 616d 2028 542c 5429      :param (T,T)
+0000ef80: 2d3e 5420 6f70 3a0a 2020 2020 2020 2020  ->T op:.        
+0000ef90: 3a72 7479 7065 3a20 540a 2020 2020 2020  :rtype: T.      
+0000efa0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000efb0: 2073 656c 6620 6973 204e 6f6e 6520 616e   self is None an
+0000efc0: 6420 6f74 6865 7220 6973 204e 6f6e 653a  d other is None:
+0000efd0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000efe0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0000eff0: 2069 6620 7365 6c66 2069 7320 4e6f 6e65   if self is None
+0000f000: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000f010: 6c66 203d 207a 6572 6f0a 2020 2020 2020  lf = zero.      
+0000f020: 2020 6966 206f 7468 6572 2069 7320 4e6f    if other is No
+0000f030: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000f040: 6f74 6865 7220 3d20 7a65 726f 0a20 2020  other = zero.   
+0000f050: 2020 2020 2072 6574 7572 6e20 6f70 2873       return op(s
+0000f060: 656c 662c 206f 7468 6572 290a 0a20 2020  elf, other)..   
+0000f070: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0000f080: 2020 6465 6620 6269 6e5f 6f70 2863 6c73    def bin_op(cls
+0000f090: 2c20 7365 6c66 2c20 6f74 6865 722c 206f  , self, other, o
+0000f0a0: 702c 207a 6572 6f2c 2072 6573 756c 743d  p, zero, result=
+0000f0b0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+0000f0c0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+0000f0d0: 6d20 4e75 6d62 6572 7344 6963 747c 696e  m NumbersDict|in
+0000f0e0: 747c 666c 6f61 747c 5420 7365 6c66 3a0a  t|float|T self:.
+0000f0f0: 2020 2020 2020 2020 3a70 6172 616d 204e          :param N
+0000f100: 756d 6265 7273 4469 6374 7c69 6e74 7c66  umbersDict|int|f
+0000f110: 6c6f 6174 7c54 206f 7468 6572 3a0a 2020  loat|T other:.  
+0000f120: 2020 2020 2020 3a70 6172 616d 2028 542c        :param (T,
+0000f130: 5429 2d3e 5420 6f70 3a0a 2020 2020 2020  T)->T op:.      
+0000f140: 2020 3a70 6172 616d 2054 207a 6572 6f3a    :param T zero:
+0000f150: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000f160: 4e75 6d62 6572 7344 6963 747c 4e6f 6e65  NumbersDict|None
+0000f170: 2072 6573 756c 743a 0a20 2020 2020 2020   result:.       
+0000f180: 203a 7274 7970 653a 204e 756d 6265 7273   :rtype: Numbers
+0000f190: 4469 6374 0a20 2020 2020 2020 2022 2222  Dict.        """
+0000f1a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000f1b0: 6973 696e 7374 616e 6365 2873 656c 662c  isinstance(self,
+0000f1c0: 204e 756d 6265 7273 4469 6374 293a 0a20   NumbersDict):. 
+0000f1d0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000f1e0: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
+0000f1f0: 4e75 6d62 6572 7344 6963 7429 3a0a 2020  NumbersDict):.  
+0000f200: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f210: 6c66 203d 204e 756d 6265 7273 4469 6374  lf = NumbersDict
+0000f220: 2e63 6f6e 7374 616e 745f 6c69 6b65 2873  .constant_like(s
+0000f230: 656c 662c 206e 756d 6265 7273 5f64 6963  elf, numbers_dic
+0000f240: 743d 6f74 6865 7229 0a20 2020 2020 2020  t=other).       
+0000f250: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000f260: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+0000f270: 3d20 4e75 6d62 6572 7344 6963 7428 7365  = NumbersDict(se
+0000f280: 6c66 290a 2020 2020 2020 2020 6966 206e  lf).        if n
+0000f290: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
+0000f2a0: 6865 722c 204e 756d 6265 7273 4469 6374  her, NumbersDict
+0000f2b0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+0000f2c0: 7468 6572 203d 204e 756d 6265 7273 4469  ther = NumbersDi
+0000f2d0: 6374 2e63 6f6e 7374 616e 745f 6c69 6b65  ct.constant_like
+0000f2e0: 286f 7468 6572 2c20 6e75 6d62 6572 735f  (other, numbers_
+0000f2f0: 6469 6374 3d73 656c 6629 0a20 2020 2020  dict=self).     
+0000f300: 2020 2069 6620 7265 7375 6c74 2069 7320     if result is 
+0000f310: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000f320: 2020 7265 7375 6c74 203d 204e 756d 6265    result = Numbe
+0000f330: 7273 4469 6374 2829 0a20 2020 2020 2020  rsDict().       
+0000f340: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
+0000f350: 6365 2872 6573 756c 742c 204e 756d 6265  ce(result, Numbe
+0000f360: 7273 4469 6374 290a 2020 2020 2020 2020  rsDict).        
+0000f370: 666f 7220 6b20 696e 2073 656c 662e 6b65  for k in self.ke
+0000f380: 7973 5f73 6574 207c 206f 7468 6572 2e6b  ys_set | other.k
+0000f390: 6579 735f 7365 743a 0a20 2020 2020 2020  eys_set:.       
+0000f3a0: 2020 2020 2072 6573 756c 745b 6b5d 203d       result[k] =
+0000f3b0: 2063 6c73 2e62 696e 5f6f 705f 7363 616c   cls.bin_op_scal
+0000f3c0: 6172 5f6f 7074 696f 6e61 6c28 7365 6c66  ar_optional(self
+0000f3d0: 2e67 6574 286b 2c20 4e6f 6e65 292c 206f  .get(k, None), o
+0000f3e0: 7468 6572 2e67 6574 286b 2c20 4e6f 6e65  ther.get(k, None
+0000f3f0: 292c 207a 6572 6f3d 7a65 726f 2c20 6f70  ), zero=zero, op
+0000f400: 3d6f 7029 0a20 2020 2020 2020 2072 6573  =op).        res
+0000f410: 756c 742e 7661 6c75 6520 3d20 636c 732e  ult.value = cls.
+0000f420: 6269 6e5f 6f70 5f73 6361 6c61 725f 6f70  bin_op_scalar_op
+0000f430: 7469 6f6e 616c 2873 656c 662e 7661 6c75  tional(self.valu
+0000f440: 652c 206f 7468 6572 2e76 616c 7565 2c20  e, other.value, 
+0000f450: 7a65 726f 3d7a 6572 6f2c 206f 703d 6f70  zero=zero, op=op
+0000f460: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000f470: 2072 6573 756c 740a 0a20 2020 2064 6566   result..    def
+0000f480: 205f 5f61 6464 5f5f 2873 656c 662c 206f   __add__(self, o
+0000f490: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+0000f4a0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
+0000f4b0: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
+0000f4c0: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
+0000f4d0: 202b 2062 2c20 7a65 726f 3d30 290a 0a20   + b, zero=0).. 
+0000f4e0: 2020 205f 5f72 6164 645f 5f20 3d20 5f5f     __radd__ = __
+0000f4f0: 6164 645f 5f0a 0a20 2020 2064 6566 205f  add__..    def _
+0000f500: 5f69 6164 645f 5f28 7365 6c66 2c20 6f74  _iadd__(self, ot
+0000f510: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
+0000f520: 7475 726e 2073 656c 662e 6269 6e5f 6f70  turn self.bin_op
+0000f530: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
+0000f540: 3d6c 616d 6264 6120 612c 2062 3a20 6120  =lambda a, b: a 
+0000f550: 2b20 622c 207a 6572 6f3d 302c 2072 6573  + b, zero=0, res
+0000f560: 756c 743d 7365 6c66 290a 0a20 2020 2064  ult=self)..    d
+0000f570: 6566 205f 5f73 7562 5f5f 2873 656c 662c  ef __sub__(self,
+0000f580: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+0000f590: 2072 6574 7572 6e20 7365 6c66 2e62 696e   return self.bin
+0000f5a0: 5f6f 7028 7365 6c66 2c20 6f74 6865 722c  _op(self, other,
+0000f5b0: 206f 703d 6c61 6d62 6461 2061 2c20 623a   op=lambda a, b:
+0000f5c0: 2061 202d 2062 2c20 7a65 726f 3d30 290a   a - b, zero=0).
+0000f5d0: 0a20 2020 2064 6566 205f 5f72 7375 625f  .    def __rsub_
+0000f5e0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+0000f5f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000f600: 656c 662e 6269 6e5f 6f70 2873 656c 662c  elf.bin_op(self,
+0000f610: 206f 7468 6572 2c20 6f70 3d6c 616d 6264   other, op=lambd
+0000f620: 6120 612c 2062 3a20 6220 2d20 612c 207a  a a, b: b - a, z
+0000f630: 6572 6f3d 3029 0a0a 2020 2020 6465 6620  ero=0)..    def 
+0000f640: 5f5f 6973 7562 5f5f 2873 656c 662c 206f  __isub__(self, o
+0000f650: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+0000f660: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
+0000f670: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
+0000f680: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
+0000f690: 202d 2062 2c20 7a65 726f 3d30 2c20 7265   - b, zero=0, re
+0000f6a0: 7375 6c74 3d73 656c 6629 0a0a 2020 2020  sult=self)..    
+0000f6b0: 6465 6620 5f5f 6d75 6c5f 5f28 7365 6c66  def __mul__(self
+0000f6c0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+0000f6d0: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
+0000f6e0: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
+0000f6f0: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
+0000f700: 3a20 6120 2a20 622c 207a 6572 6f3d 3129  : a * b, zero=1)
+0000f710: 0a0a 2020 2020 5f5f 726d 756c 5f5f 203d  ..    __rmul__ =
+0000f720: 205f 5f6d 756c 5f5f 0a0a 2020 2020 6465   __mul__..    de
+0000f730: 6620 5f5f 696d 756c 5f5f 2873 656c 662c  f __imul__(self,
+0000f740: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+0000f750: 2072 6574 7572 6e20 7365 6c66 2e62 696e   return self.bin
+0000f760: 5f6f 7028 7365 6c66 2c20 6f74 6865 722c  _op(self, other,
+0000f770: 206f 703d 6c61 6d62 6461 2061 2c20 623a   op=lambda a, b:
+0000f780: 2061 202a 2062 2c20 7a65 726f 3d31 2c20   a * b, zero=1, 
+0000f790: 7265 7375 6c74 3d73 656c 6629 0a0a 2020  result=self)..  
+0000f7a0: 2020 6465 6620 5f5f 6469 765f 5f28 7365    def __div__(se
+0000f7b0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+0000f7c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000f7d0: 6269 6e5f 6f70 2873 656c 662c 206f 7468  bin_op(self, oth
+0000f7e0: 6572 2c20 6f70 3d6c 616d 6264 6120 612c  er, op=lambda a,
+0000f7f0: 2062 3a20 6120 2f20 622c 207a 6572 6f3d   b: a / b, zero=
+0000f800: 3129 0a0a 2020 2020 5f5f 7264 6976 5f5f  1)..    __rdiv__
+0000f810: 203d 205f 5f64 6976 5f5f 0a20 2020 205f   = __div__.    _
+0000f820: 5f74 7275 6564 6976 5f5f 203d 205f 5f64  _truediv__ = __d
+0000f830: 6976 5f5f 0a0a 2020 2020 6465 6620 5f5f  iv__..    def __
+0000f840: 6964 6976 5f5f 2873 656c 662c 206f 7468  idiv__(self, oth
+0000f850: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+0000f860: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
+0000f870: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
+0000f880: 6c61 6d62 6461 2061 2c20 623a 2061 202f  lambda a, b: a /
+0000f890: 2062 2c20 7a65 726f 3d31 2c20 7265 7375   b, zero=1, resu
+0000f8a0: 6c74 3d73 656c 6629 0a0a 2020 2020 5f5f  lt=self)..    __
+0000f8b0: 6974 7275 6564 6976 5f5f 203d 205f 5f69  itruediv__ = __i
+0000f8c0: 6469 765f 5f0a 0a20 2020 2064 6566 205f  div__..    def _
+0000f8d0: 5f66 6c6f 6f72 6469 765f 5f28 7365 6c66  _floordiv__(self
+0000f8e0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+0000f8f0: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
+0000f900: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
+0000f910: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
+0000f920: 3a20 6120 2f2f 2062 2c20 7a65 726f 3d31  : a // b, zero=1
+0000f930: 290a 0a20 2020 2064 6566 205f 5f69 666c  )..    def __ifl
+0000f940: 6f6f 7264 6976 5f5f 2873 656c 662c 206f  oordiv__(self, o
+0000f950: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+0000f960: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
+0000f970: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
+0000f980: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
+0000f990: 202f 2f20 622c 207a 6572 6f3d 312c 2072   // b, zero=1, r
+0000f9a0: 6573 756c 743d 7365 6c66 290a 0a20 2020  esult=self)..   
+0000f9b0: 2064 6566 205f 5f6e 6567 5f5f 2873 656c   def __neg__(sel
+0000f9c0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0000f9d0: 726e 2073 656c 662e 756e 6172 795f 6f70  rn self.unary_op
+0000f9e0: 286f 703d 6c61 6d62 6461 2061 3a20 2d61  (op=lambda a: -a
+0000f9f0: 290a 0a20 2020 2064 6566 205f 5f62 6f6f  )..    def __boo
+0000fa00: 6c5f 5f28 7365 6c66 293a 0a20 2020 2020  l__(self):.     
+0000fa10: 2020 2072 6574 7572 6e20 616e 7928 7365     return any(se
+0000fa20: 6c66 2e76 616c 7565 7328 2929 0a0a 2020  lf.values())..  
+0000fa30: 2020 5f5f 6e6f 6e7a 6572 6f5f 5f20 3d20    __nonzero__ = 
+0000fa40: 5f5f 626f 6f6c 5f5f 2020 2320 5079 7468  __bool__  # Pyth
+0000fa50: 6f6e 2032 0a0a 2020 2020 6465 6620 656c  on 2..    def el
+0000fa60: 656d 5f65 7128 7365 6c66 2c20 6f74 6865  em_eq(self, othe
+0000fa70: 722c 2072 6573 756c 745f 7769 7468 5f64  r, result_with_d
+0000fa80: 6566 6175 6c74 3d54 7275 6529 3a0a 2020  efault=True):.  
+0000fa90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000faa0: 2020 456c 656d 656e 742d 7769 7365 2065    Element-wise e
+0000fab0: 7175 616c 6974 7920 6368 6563 6b20 7769  quality check wi
+0000fac0: 7468 206f 7468 6572 2e0a 2020 2020 2020  th other..      
+0000fad0: 2020 4e6f 7465 2061 626f 7574 2062 726f    Note about bro
+0000fae0: 6164 6361 7374 2064 6566 6175 6c74 2076  adcast default v
+0000faf0: 616c 7565 3a20 436f 6e73 6964 6572 2073  alue: Consider s
+0000fb00: 6f6d 6520 6b65 7920 7768 6963 6820 6973  ome key which is
+0000fb10: 206e 6569 7468 6572 2069 6e20 7365 6c66   neither in self
+0000fb20: 206e 6f72 2069 6e20 6f74 6865 722e 0a20   nor in other.. 
+0000fb30: 2020 2020 2020 2020 2054 6869 7320 6d65           This me
+0000fb40: 616e 7320 7468 6174 2073 656c 665b 6b65  ans that self[ke
+0000fb50: 795d 203d 3d20 7365 6c66 2e64 6566 6175  y] == self.defau
+0000fb60: 6c74 2c20 6f74 6865 725b 6b65 795d 203d  lt, other[key] =
+0000fb70: 3d20 6f74 6865 722e 6465 6661 756c 742e  = other.default.
+0000fb80: 0a20 2020 2020 2020 2020 2054 6875 732c  .          Thus,
+0000fb90: 2069 6e20 6361 7365 2074 6861 7420 7365   in case that se
+0000fba0: 6c66 2e64 6566 6175 6c74 2021 3d20 6f74  lf.default != ot
+0000fbb0: 6865 722e 6465 6661 756c 742c 2077 6520  her.default, we 
+0000fbc0: 6765 7420 7265 732e 6465 6661 756c 7420  get res.default 
+0000fbd0: 3d3d 2046 616c 7365 2e0a 2020 2020 2020  == False..      
+0000fbe0: 2020 2020 5468 656e 2c20 616c 6c28 7265      Then, all(re
+0000fbf0: 732e 7661 6c75 6573 2829 2920 3d3d 2046  s.values()) == F
+0000fc00: 616c 7365 2c20 6576 656e 2077 6865 6e20  alse, even when 
+0000fc10: 616c 6c20 6f74 6865 7220 7661 6c75 6573  all other values
+0000fc20: 2061 7265 2054 7275 652e 0a20 2020 2020   are True..     
+0000fc30: 2020 2020 2054 6869 7320 6973 2073 6f6d       This is som
+0000fc40: 6574 696d 6573 206e 6f74 2077 6861 7420  etimes not what 
+0000fc50: 7765 2077 616e 742e 0a20 2020 2020 2020  we want..       
+0000fc60: 2020 2059 6f75 2063 616e 2063 6f6e 7472     You can contr
+0000fc70: 6f6c 2074 6865 2062 6568 6176 696f 7220  ol the behavior 
+0000fc80: 7669 6120 7265 7375 6c74 5f77 6974 685f  via result_with_
+0000fc90: 6465 6661 756c 742e 0a0a 2020 2020 2020  default...      
+0000fca0: 2020 3a70 6172 616d 204e 756d 6265 7273    :param Numbers
+0000fcb0: 4469 6374 7c54 206f 7468 6572 3a0a 2020  Dict|T other:.  
+0000fcc0: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
+0000fcd0: 6c20 7265 7375 6c74 5f77 6974 685f 6465  l result_with_de
+0000fce0: 6661 756c 743a 0a20 2020 2020 2020 203a  fault:.        :
+0000fcf0: 7274 7970 653a 204e 756d 6265 7273 4469  rtype: NumbersDi
+0000fd00: 6374 0a20 2020 2020 2020 2022 2222 0a0a  ct.        """..
+0000fd10: 2020 2020 2020 2020 6465 6620 6f70 2861          def op(a
+0000fd20: 2c20 6229 3a0a 2020 2020 2020 2020 2020  , b):.          
+0000fd30: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
+0000fd40: 2020 3a70 6172 616d 2061 3a0a 2020 2020    :param a:.    
+0000fd50: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
+0000fd60: 3a0a 2020 2020 2020 2020 2020 2020 3a72  :.            :r
+0000fd70: 7479 7065 3a20 626f 6f6c 7c4e 6f6e 650a  type: bool|None.
+0000fd80: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+0000fd90: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0000fda0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000fdb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fdc0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000fdd0: 2020 6966 2062 2069 7320 4e6f 6e65 3a0a    if b is None:.
+0000fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdf0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+0000fe00: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+0000fe10: 203d 3d20 620a 0a20 2020 2020 2020 2072   == b..        r
+0000fe20: 6573 203d 2073 656c 662e 6269 6e5f 6f70  es = self.bin_op
+0000fe30: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
+0000fe40: 3d6f 702c 207a 6572 6f3d 4e6f 6e65 290a  =op, zero=None).
+0000fe50: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+0000fe60: 6573 756c 745f 7769 7468 5f64 6566 6175  esult_with_defau
+0000fe70: 6c74 3a0a 2020 2020 2020 2020 2020 2020  lt:.            
+0000fe80: 7265 732e 7661 6c75 6520 3d20 4e6f 6e65  res.value = None
+0000fe90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000fea0: 7265 730a 0a20 2020 2064 6566 205f 5f65  res..    def __e
+0000feb0: 715f 5f28 7365 6c66 2c20 6f74 6865 7229  q__(self, other)
+0000fec0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000fed0: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
+0000fee0: 6265 7273 4469 6374 7c54 206f 7468 6572  bersDict|T other
+0000fef0: 3a0a 2020 2020 2020 2020 3a72 6574 7572  :.        :retur
+0000ff00: 6e3a 2077 6865 7468 6572 2073 656c 6620  n: whether self 
+0000ff10: 3d3d 206f 7468 6572 2065 6c65 6d77 6973  == other elemwis
+0000ff20: 652e 2073 6565 2073 656c 662e 656c 656d  e. see self.elem
+0000ff30: 5f65 710a 2020 2020 2020 2020 3a72 7479  _eq.        :rty
+0000ff40: 7065 3a20 626f 6f6c 0a20 2020 2020 2020  pe: bool.       
+0000ff50: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+0000ff60: 7572 6e20 616c 6c28 7365 6c66 2e65 6c65  urn all(self.ele
+0000ff70: 6d5f 6571 286f 7468 6572 292e 7661 6c75  m_eq(other).valu
+0000ff80: 6573 2829 290a 0a20 2020 2064 6566 205f  es())..    def _
+0000ff90: 5f6e 655f 5f28 7365 6c66 2c20 6f74 6865  _ne__(self, othe
+0000ffa0: 7229 3a0a 2020 2020 2020 2020 2222 220a  r):.        """.
+0000ffb0: 2020 2020 2020 2020 3a70 6172 616d 204e          :param N
+0000ffc0: 756d 6265 7273 4469 6374 7c54 206f 7468  umbersDict|T oth
+0000ffd0: 6572 3a0a 2020 2020 2020 2020 3a72 6574  er:.        :ret
+0000ffe0: 7572 6e3a 206e 6f74 2028 7365 6c66 203d  urn: not (self =
+0000fff0: 3d20 6f74 6865 7229 0a20 2020 2020 2020  = other).       
+00010000: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+00010010: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010020: 2020 7265 7475 726e 206e 6f74 2028 7365    return not (se
+00010030: 6c66 203d 3d20 6f74 6865 7229 0a0a 2020  lf == other)..  
+00010040: 2020 6465 6620 5f5f 636d 705f 5f28 7365    def __cmp__(se
+00010050: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+00010060: 2020 2020 2320 5468 6572 6520 6973 206e      # There is n
+00010070: 6f20 676f 6f64 2073 7472 6169 6768 742d  o good straight-
+00010080: 666f 7277 6172 6420 696d 706c 656d 656e  forward implemen
+00010090: 7461 7469 6f6e 0a20 2020 2020 2020 2023  tation.        #
+000100a0: 2061 6e64 2069 7420 776f 756c 6420 6a75   and it would ju
+000100b0: 7374 2063 6f6e 6675 7365 2e0a 2020 2020  st confuse..    
+000100c0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+000100d0: 696f 6e28 2225 732e 5f5f 636d 705f 5f20  ion("%s.__cmp__ 
+000100e0: 6973 2075 6e64 6566 696e 6564 2220 2520  is undefined" % 
+000100f0: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
+00010100: 5f6e 616d 655f 5f29 0a0a 2020 2020 6465  _name__)..    de
+00010110: 6620 616e 795f 636f 6d70 6172 6528 7365  f any_compare(se
+00010120: 6c66 2c20 6f74 6865 722c 2063 6d70 293a  lf, other, cmp):
+00010130: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010140: 2020 2020 203a 7061 7261 6d20 4e75 6d62       :param Numb
+00010150: 6572 7344 6963 7420 6f74 6865 723a 0a20  ersDict other:. 
+00010160: 2020 2020 2020 203a 7061 7261 6d20 2828         :param ((
+00010170: 6f62 6a65 6374 2c6f 626a 6563 7429 2d3e  object,object)->
+00010180: 5472 7565 2920 636d 703a 0a20 2020 2020  True) cmp:.     
+00010190: 2020 203a 7274 7970 653a 2054 7275 650a     :rtype: True.
+000101a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000101b0: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
+000101c0: 656c 662e 6b65 7973 2829 3a0a 2020 2020  elf.keys():.    
+000101d0: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
+000101e0: 6e20 6f74 6865 722e 6b65 7973 2829 3a0a  n other.keys():.
+000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010200: 6966 2063 6d70 2873 656c 665b 6b65 795d  if cmp(self[key]
+00010210: 2c20 6f74 6865 725b 6b65 795d 293a 0a20  , other[key]):. 
 00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010230: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
-00010240: 2020 2020 2020 2020 656c 6966 206f 7468          elif oth
-00010250: 6572 2e76 616c 7565 2069 7320 6e6f 7420  er.value is not 
-00010260: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00010270: 2020 2020 2020 6966 2063 6d70 2873 656c        if cmp(sel
-00010280: 665b 6b65 795d 2c20 6f74 6865 722e 7661  f[key], other.va
-00010290: 6c75 6529 3a0a 2020 2020 2020 2020 2020  lue):.          
-000102a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000102b0: 2054 7275 650a 2020 2020 2020 2020 6966   True.        if
-000102c0: 2073 656c 662e 7661 6c75 6520 6973 206e   self.value is n
-000102d0: 6f74 204e 6f6e 6520 616e 6420 6f74 6865  ot None and othe
-000102e0: 722e 7661 6c75 6520 6973 206e 6f74 204e  r.value is not N
-000102f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00010300: 2069 6620 636d 7028 7365 6c66 2e76 616c   if cmp(self.val
-00010310: 7565 2c20 6f74 6865 722e 7661 6c75 6529  ue, other.value)
-00010320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010330: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-00010340: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00010350: 7365 0a0a 2020 2020 4073 7461 7469 636d  se..    @staticm
-00010360: 6574 686f 640a 2020 2020 6465 6620 5f6d  ethod.    def _m
-00010370: 6178 282a 6172 6773 293a 0a20 2020 2020  ax(*args):.     
-00010380: 2020 2061 7267 7320 3d20 5b61 2066 6f72     args = [a for
-00010390: 2061 2069 6e20 6172 6773 2069 6620 6120   a in args if a 
-000103a0: 6973 206e 6f74 204e 6f6e 655d 0a20 2020  is not None].   
-000103b0: 2020 2020 2069 6620 6e6f 7420 6172 6773       if not args
-000103c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000103d0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-000103e0: 2020 6966 206c 656e 2861 7267 7329 203d    if len(args) =
-000103f0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00010400: 2072 6574 7572 6e20 6172 6773 5b30 5d0a   return args[0].
-00010410: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00010420: 6178 282a 6172 6773 290a 0a20 2020 2040  ax(*args)..    @
-00010430: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-00010440: 2064 6566 205f 6d69 6e28 2a61 7267 7329   def _min(*args)
-00010450: 3a0a 2020 2020 2020 2020 6172 6773 203d  :.        args =
-00010460: 205b 6120 666f 7220 6120 696e 2061 7267   [a for a in arg
-00010470: 7320 6966 2061 2069 7320 6e6f 7420 4e6f  s if a is not No
-00010480: 6e65 5d0a 2020 2020 2020 2020 6966 206e  ne].        if n
-00010490: 6f74 2061 7267 733a 0a20 2020 2020 2020  ot args:.       
-000104a0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000104b0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-000104c0: 6172 6773 2920 3d3d 2031 3a0a 2020 2020  args) == 1:.    
-000104d0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-000104e0: 7267 735b 305d 0a20 2020 2020 2020 2072  rgs[0].        r
-000104f0: 6574 7572 6e20 6d69 6e28 2a61 7267 7329  eturn min(*args)
-00010500: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00010510: 6f64 0a20 2020 2064 6566 206d 6178 2863  od.    def max(c
-00010520: 6c73 2c20 6974 656d 7329 3a0a 2020 2020  ls, items):.    
-00010530: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00010540: 456c 656d 656e 742d 7769 7365 206d 6178  Element-wise max
-00010550: 696d 756d 2066 6f72 2069 7465 6d20 696e  imum for item in
-00010560: 2069 7465 6d73 2e0a 2020 2020 2020 2020   items..        
-00010570: 3a70 6172 616d 206c 6973 745b 4e75 6d62  :param list[Numb
-00010580: 6572 7344 6963 747c 696e 747c 666c 6f61  ersDict|int|floa
-00010590: 745d 2069 7465 6d73 3a0a 2020 2020 2020  t] items:.      
-000105a0: 2020 3a72 7479 7065 3a20 4e75 6d62 6572    :rtype: Number
-000105b0: 7344 6963 740a 2020 2020 2020 2020 2222  sDict.        ""
-000105c0: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
-000105d0: 2069 7465 6d73 0a20 2020 2020 2020 2069   items.        i
-000105e0: 6620 6c65 6e28 6974 656d 7329 203d 3d20  f len(items) == 
-000105f0: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
-00010600: 6574 7572 6e20 4e75 6d62 6572 7344 6963  eturn NumbersDic
-00010610: 7428 6974 656d 735b 305d 290a 2020 2020  t(items[0]).    
-00010620: 2020 2020 6966 206c 656e 2869 7465 6d73      if len(items
-00010630: 2920 3d3d 2032 3a0a 2020 2020 2020 2020  ) == 2:.        
-00010640: 2020 2020 7265 7475 726e 2063 6c73 2e62      return cls.b
-00010650: 696e 5f6f 7028 6974 656d 735b 305d 2c20  in_op(items[0], 
-00010660: 6974 656d 735b 315d 2c20 6f70 3d63 6c73  items[1], op=cls
-00010670: 2e5f 6d61 782c 207a 6572 6f3d 4e6f 6e65  ._max, zero=None
-00010680: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00010690: 2063 6c73 2e6d 6178 285b 6974 656d 735b   cls.max([items[
-000106a0: 305d 2c20 636c 732e 6d61 7828 6974 656d  0], cls.max(item
-000106b0: 735b 313a 5d29 5d29 0a0a 2020 2020 4063  s[1:])])..    @c
-000106c0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000106d0: 6566 206d 696e 2863 6c73 2c20 6974 656d  ef min(cls, item
-000106e0: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-000106f0: 2020 2020 2020 2020 456c 656d 656e 742d          Element-
-00010700: 7769 7365 206d 696e 696d 756d 2066 6f72  wise minimum for
-00010710: 2069 7465 6d20 696e 2069 7465 6d73 2e0a   item in items..
-00010720: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-00010730: 6973 745b 4e75 6d62 6572 7344 6963 747c  ist[NumbersDict|
-00010740: 696e 747c 666c 6f61 745d 2069 7465 6d73  int|float] items
-00010750: 3a0a 2020 2020 2020 2020 3a72 7479 7065  :.        :rtype
-00010760: 3a20 4e75 6d62 6572 7344 6963 740a 2020  : NumbersDict.  
-00010770: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010780: 2020 6173 7365 7274 2069 7465 6d73 0a20    assert items. 
-00010790: 2020 2020 2020 2069 6620 6c65 6e28 6974         if len(it
-000107a0: 656d 7329 203d 3d20 313a 0a20 2020 2020  ems) == 1:.     
-000107b0: 2020 2020 2020 2072 6574 7572 6e20 4e75         return Nu
-000107c0: 6d62 6572 7344 6963 7428 6974 656d 735b  mbersDict(items[
-000107d0: 305d 290a 2020 2020 2020 2020 6966 206c  0]).        if l
-000107e0: 656e 2869 7465 6d73 2920 3d3d 2032 3a0a  en(items) == 2:.
-000107f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00010800: 726e 2063 6c73 2e62 696e 5f6f 7028 6974  rn cls.bin_op(it
-00010810: 656d 735b 305d 2c20 6974 656d 735b 315d  ems[0], items[1]
-00010820: 2c20 6f70 3d63 6c73 2e5f 6d69 6e2c 207a  , op=cls._min, z
-00010830: 6572 6f3d 4e6f 6e65 290a 2020 2020 2020  ero=None).      
-00010840: 2020 7265 7475 726e 2063 6c73 2e6d 696e    return cls.min
-00010850: 285b 6974 656d 735b 305d 2c20 636c 732e  ([items[0], cls.
-00010860: 6d69 6e28 6974 656d 735b 313a 5d29 5d29  min(items[1:])])
-00010870: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00010880: 686f 640a 2020 2020 6465 6620 5f6d 6178  hod.    def _max
-00010890: 5f65 7272 6f72 2829 3a0a 2020 2020 2020  _error():.      
-000108a0: 2020 2320 5769 6c6c 2072 6570 6c61 6365    # Will replace
-000108b0: 2073 656c 662e 6d61 7820 666f 7220 6561   self.max for ea
-000108c0: 6368 2069 6e73 7461 6e63 652e 2054 6f20  ch instance. To 
-000108d0: 6265 2073 7572 6520 7468 6174 2077 6520  be sure that we 
-000108e0: 646f 6e27 7420 636f 6e66 7573 6520 6974  don't confuse it
-000108f0: 2077 6974 6820 7365 6c66 2e6d 6178 5f76   with self.max_v
-00010900: 616c 7565 2e0a 2020 2020 2020 2020 7261  alue..        ra
-00010910: 6973 6520 4578 6365 7074 696f 6e28 2255  ise Exception("U
-00010920: 7365 206d 6178 5f76 616c 7565 2069 6e73  se max_value ins
-00010930: 7465 6164 2e22 290a 0a20 2020 2064 6566  tead.")..    def
-00010940: 206d 6178 5f76 616c 7565 2873 656c 6629   max_value(self)
-00010950: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010960: 2020 2020 2020 4d61 7869 6d75 6d20 6f66        Maximum of
-00010970: 206f 7572 2076 616c 7565 732e 0a20 2020   our values..   
-00010980: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010990: 2072 6574 7572 6e20 6d61 7828 7365 6c66   return max(self
-000109a0: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
-000109b0: 6465 6620 6d69 6e5f 7661 6c75 6528 7365  def min_value(se
-000109c0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000109d0: 0a20 2020 2020 2020 204d 696e 696d 756d  .        Minimum
-000109e0: 206f 6620 6f75 7220 7661 6c75 6573 2e0a   of our values..
-000109f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010a00: 2020 2020 7265 7475 726e 206d 696e 2873      return min(s
-00010a10: 656c 662e 7661 6c75 6573 2829 290a 0a20  elf.values()).. 
-00010a20: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-00010a30: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
-00010a40: 6620 7365 6c66 2e76 616c 7565 2069 7320  f self.value is 
-00010a50: 4e6f 6e65 2061 6e64 206e 6f74 2073 656c  None and not sel
-00010a60: 662e 6469 6374 3a0a 2020 2020 2020 2020  f.dict:.        
-00010a70: 2020 2020 7265 7475 726e 2022 2573 2829      return "%s()
-00010a80: 2220 2520 7365 6c66 2e5f 5f63 6c61 7373  " % self.__class
-00010a90: 5f5f 2e5f 5f6e 616d 655f 5f0a 2020 2020  __.__name__.    
-00010aa0: 2020 2020 6966 2073 656c 662e 7661 6c75      if self.valu
-00010ab0: 6520 6973 204e 6f6e 6520 616e 6420 7365  e is None and se
-00010ac0: 6c66 2e64 6963 743a 0a20 2020 2020 2020  lf.dict:.       
-00010ad0: 2020 2020 2072 6574 7572 6e20 2225 7328       return "%s(
-00010ae0: 2572 2922 2025 2028 7365 6c66 2e5f 5f63  %r)" % (self.__c
-00010af0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
-00010b00: 2073 656c 662e 6469 6374 290a 2020 2020   self.dict).    
-00010b10: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00010b20: 6469 6374 2061 6e64 2073 656c 662e 7661  dict and self.va
-00010b30: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
-00010b40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00010b50: 7572 6e20 2225 7328 2572 2922 2025 2028  urn "%s(%r)" % (
-00010b60: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-00010b70: 5f6e 616d 655f 5f2c 2073 656c 662e 7661  _name__, self.va
-00010b80: 6c75 6529 0a20 2020 2020 2020 2072 6574  lue).        ret
-00010b90: 7572 6e20 2225 7328 6e75 6d62 6572 735f  urn "%s(numbers_
-00010ba0: 6469 6374 3d25 722c 2062 726f 6164 6361  dict=%r, broadca
-00010bb0: 7374 5f76 616c 7565 3d25 7229 2220 2520  st_value=%r)" % 
-00010bc0: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
-00010bd0: 5f5f 6e61 6d65 5f5f 2c20 7365 6c66 2e64  __name__, self.d
-00010be0: 6963 742c 2073 656c 662e 7661 6c75 6529  ict, self.value)
-00010bf0: 0a0a 0a64 6566 2063 6f6c 6c65 6374 5f63  ...def collect_c
-00010c00: 6c61 7373 5f69 6e69 745f 6b77 6172 6773  lass_init_kwargs
-00010c10: 2863 6c73 2c20 6f6e 6c79 5f77 6974 685f  (cls, only_with_
-00010c20: 6465 6661 756c 743d 4661 6c73 6529 3a0a  default=False):.
-00010c30: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-00010c40: 616d 2074 7970 6520 636c 733a 2063 6c61  am type cls: cla
-00010c50: 7373 2c20 7768 6572 6520 6974 2061 7373  ss, where it ass
-00010c60: 756d 6573 2074 6861 7420 6b77 6172 6773  umes that kwargs
-00010c70: 2061 7265 2070 6173 7365 6420 6f6e 2074   are passed on t
-00010c80: 6f20 6261 7365 2063 6c61 7373 6573 0a20  o base classes. 
-00010c90: 2020 203a 7061 7261 6d20 626f 6f6c 206f     :param bool o
-00010ca0: 6e6c 795f 7769 7468 5f64 6566 6175 6c74  nly_with_default
-00010cb0: 3a20 6966 2067 6976 656e 2077 696c 6c20  : if given will 
-00010cc0: 6f6e 6c79 2072 6574 7572 6e20 7468 6520  only return the 
-00010cd0: 6b77 6172 6773 2077 6974 6820 6465 6661  kwargs with defa
-00010ce0: 756c 7420 7661 6c75 6573 0a20 2020 203a  ult values.    :
-00010cf0: 7265 7475 726e 3a20 7365 7420 6966 206e  return: set if n
-00010d00: 6f74 2077 6974 685f 6465 6661 756c 742c  ot with_default,
-00010d10: 206f 7468 6572 7769 7365 2074 6865 2064   otherwise the d
-00010d20: 6963 7420 746f 2074 6865 2064 6566 6175  ict to the defau
-00010d30: 6c74 2076 616c 7565 730a 2020 2020 3a72  lt values.    :r
-00010d40: 7479 7065 3a20 6c69 7374 5b73 7472 5d20  type: list[str] 
-00010d50: 7c20 6469 6374 5b73 7472 5d0a 2020 2020  | dict[str].    
-00010d60: 2222 220a 2020 2020 6672 6f6d 2063 6f6c  """.    from col
-00010d70: 6c65 6374 696f 6e73 2069 6d70 6f72 7420  lections import 
-00010d80: 4f72 6465 7265 6444 6963 740a 0a20 2020  OrderedDict..   
-00010d90: 2069 6620 6f6e 6c79 5f77 6974 685f 6465   if only_with_de
-00010da0: 6661 756c 743a 0a20 2020 2020 2020 206b  fault:.        k
-00010db0: 7761 7267 7320 3d20 4f72 6465 7265 6444  wargs = OrderedD
-00010dc0: 6963 7428 290a 2020 2020 656c 7365 3a0a  ict().    else:.
-00010dd0: 2020 2020 2020 2020 6b77 6172 6773 203d          kwargs =
-00010de0: 205b 5d0a 2020 2020 666f 7220 636c 735f   [].    for cls_
-00010df0: 2069 6e20 696e 7370 6563 742e 6765 746d   in inspect.getm
-00010e00: 726f 2863 6c73 293a 0a20 2020 2020 2020  ro(cls):.       
-00010e10: 2023 2043 6865 636b 2050 7974 686f 6e20   # Check Python 
-00010e20: 6675 6e63 7469 6f6e 2e20 436f 756c 6420  function. Could 
-00010e30: 6265 2062 7569 6c74 696e 2066 756e 6320  be builtin func 
-00010e40: 6f72 2073 6f2e 2050 7974 686f 6e20 3220  or so. Python 2 
-00010e50: 6765 7461 7267 7370 6563 2064 6f65 7320  getargspec does 
-00010e60: 6e6f 7420 776f 726b 2069 6e20 7468 6174  not work in that
-00010e70: 2063 6173 652e 0a20 2020 2020 2020 2069   case..        i
-00010e80: 6620 6e6f 7420 696e 7370 6563 742e 6973  f not inspect.is
-00010e90: 6d65 7468 6f64 2863 6c73 5f2e 5f5f 696e  method(cls_.__in
-00010ea0: 6974 5f5f 2920 616e 6420 6e6f 7420 696e  it__) and not in
-00010eb0: 7370 6563 742e 6973 6675 6e63 7469 6f6e  spect.isfunction
-00010ec0: 2863 6c73 5f2e 5f5f 696e 6974 5f5f 293a  (cls_.__init__):
-00010ed0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00010ee0: 7469 6e75 650a 2020 2020 2020 2020 6172  tinue.        ar
-00010ef0: 675f 7370 6563 203d 2067 6574 6172 6773  g_spec = getargs
-00010f00: 7065 6328 636c 735f 2e5f 5f69 6e69 745f  pec(cls_.__init_
-00010f10: 5f29 0a20 2020 2020 2020 2061 7267 7320  _).        args 
-00010f20: 3d20 6172 675f 7370 6563 2e61 7267 735b  = arg_spec.args[
-00010f30: 313a 5d20 2023 2066 6972 7374 2061 7267  1:]  # first arg
-00010f40: 2069 7320 7365 6c66 2c20 6967 6e6f 7265   is self, ignore
-00010f50: 0a20 2020 2020 2020 2069 6620 6f6e 6c79  .        if only
-00010f60: 5f77 6974 685f 6465 6661 756c 743a 0a20  _with_default:. 
-00010f70: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
-00010f80: 675f 7370 6563 2e64 6566 6175 6c74 733a  g_spec.defaults:
-00010f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010fa0: 2061 7373 6572 7420 6c65 6e28 6172 675f   assert len(arg_
-00010fb0: 7370 6563 2e64 6566 6175 6c74 7329 203c  spec.defaults) <
-00010fc0: 3d20 6c65 6e28 6172 6773 290a 2020 2020  = len(args).    
-00010fd0: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00010fe0: 203d 2061 7267 735b 6c65 6e28 6172 6773   = args[len(args
-00010ff0: 2920 2d20 6c65 6e28 6172 675f 7370 6563  ) - len(arg_spec
-00011000: 2e64 6566 6175 6c74 7329 203a 5d0a 2020  .defaults) :].  
-00011010: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00011020: 7365 7274 206c 656e 2861 7267 5f73 7065  sert len(arg_spe
-00011030: 632e 6465 6661 756c 7473 2920 3d3d 206c  c.defaults) == l
-00011040: 656e 2861 7267 7329 2c20 6172 675f 7370  en(args), arg_sp
-00011050: 6563 0a20 2020 2020 2020 2020 2020 2020  ec.             
-00011060: 2020 2066 6f72 2061 7267 2c20 6465 6661     for arg, defa
-00011070: 756c 7420 696e 207a 6970 2861 7267 732c  ult in zip(args,
-00011080: 2061 7267 5f73 7065 632e 6465 6661 756c   arg_spec.defaul
-00011090: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
-000110a0: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-000110b0: 6172 675d 203d 2064 6566 6175 6c74 0a20  arg] = default. 
-000110c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000110d0: 2020 2020 2020 2020 2066 6f72 2061 7267           for arg
-000110e0: 2069 6e20 6172 6773 3a0a 2020 2020 2020   in args:.      
-000110f0: 2020 2020 2020 2020 2020 6966 2061 7267            if arg
-00011100: 206e 6f74 2069 6e20 6b77 6172 6773 3a0a   not in kwargs:.
-00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011120: 2020 2020 6b77 6172 6773 2e61 7070 656e      kwargs.appen
-00011130: 6428 6172 6729 0a20 2020 2072 6574 7572  d(arg).    retur
-00011140: 6e20 6b77 6172 6773 0a0a 0a64 6566 2067  n kwargs...def g
-00011150: 6574 6172 6773 7065 6328 6675 6e63 293a  etargspec(func):
-00011160: 0a20 2020 2022 2222 0a20 2020 203a 6675  .    """.    :fu
-00011170: 6e63 3a60 696e 7370 6563 742e 6765 7466  nc:`inspect.getf
-00011180: 756c 6c61 7267 7370 6563 6020 6f72 2060  ullargspec` or `
-00011190: 696e 7370 6563 742e 6765 7461 7267 7370  inspect.getargsp
-000111a0: 6563 6020 2850 7974 686f 6e20 3229 0a0a  ec` (Python 2)..
-000111b0: 2020 2020 3a70 6172 616d 2066 756e 633a      :param func:
-000111c0: 0a20 2020 203a 7265 7475 726e 3a20 4675  .    :return: Fu
-000111d0: 6c6c 4172 6753 7065 630a 2020 2020 2222  llArgSpec.    ""
-000111e0: 220a 2020 2020 6966 2050 5933 3a0a 2020  ".    if PY3:.  
-000111f0: 2020 2020 2020 7265 7475 726e 2069 6e73        return ins
-00011200: 7065 6374 2e67 6574 6675 6c6c 6172 6773  pect.getfullargs
-00011210: 7065 6328 6675 6e63 290a 2020 2020 656c  pec(func).    el
-00011220: 7365 3a0a 2020 2020 2020 2020 2320 6e6f  se:.        # no
-00011230: 696e 7370 6563 7469 6f6e 2050 7944 6570  inspection PyDep
-00011240: 7265 6361 7469 6f6e 0a20 2020 2020 2020  recation.       
-00011250: 2072 6574 7572 6e20 696e 7370 6563 742e   return inspect.
-00011260: 6765 7461 7267 7370 6563 2866 756e 6329  getargspec(func)
-00011270: 0a0a 0a64 6566 2063 6f6c 6c65 6374 5f6d  ...def collect_m
-00011280: 616e 6461 746f 7279 5f63 6c61 7373 5f69  andatory_class_i
-00011290: 6e69 745f 6b77 6172 6773 2863 6c73 293a  nit_kwargs(cls):
-000112a0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-000112b0: 7261 6d20 7479 7065 2063 6c73 3a0a 2020  ram type cls:.  
-000112c0: 2020 3a72 6574 7572 6e3a 206c 6973 7420    :return: list 
-000112d0: 6f66 206b 7761 7267 7320 7768 6963 6820  of kwargs which 
-000112e0: 6861 7665 206e 6f20 6465 6661 756c 742c  have no default,
-000112f0: 2069 2e65 2e20 7768 6963 6820 6d75 7374   i.e. which must
-00011300: 2062 6520 7072 6f76 6964 6564 0a20 2020   be provided.   
-00011310: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
-00011320: 725d 0a20 2020 2022 2222 0a20 2020 2061  r].    """.    a
-00011330: 6c6c 5f6b 7761 7267 7320 3d20 636f 6c6c  ll_kwargs = coll
-00011340: 6563 745f 636c 6173 735f 696e 6974 5f6b  ect_class_init_k
-00011350: 7761 7267 7328 636c 732c 206f 6e6c 795f  wargs(cls, only_
-00011360: 7769 7468 5f64 6566 6175 6c74 3d46 616c  with_default=Fal
-00011370: 7365 290a 2020 2020 6465 6661 756c 745f  se).    default_
-00011380: 6b77 6172 6773 203d 2063 6f6c 6c65 6374  kwargs = collect
-00011390: 5f63 6c61 7373 5f69 6e69 745f 6b77 6172  _class_init_kwar
-000113a0: 6773 2863 6c73 2c20 6f6e 6c79 5f77 6974  gs(cls, only_wit
-000113b0: 685f 6465 6661 756c 743d 5472 7565 290a  h_default=True).
-000113c0: 2020 2020 6d61 6e64 6174 6f72 795f 6b77      mandatory_kw
-000113d0: 6172 6773 203d 205b 5d0a 2020 2020 666f  args = [].    fo
-000113e0: 7220 6172 6720 696e 2061 6c6c 5f6b 7761  r arg in all_kwa
-000113f0: 7267 733a 0a20 2020 2020 2020 2069 6620  rgs:.        if 
-00011400: 6172 6720 6e6f 7420 696e 2064 6566 6175  arg not in defau
-00011410: 6c74 5f6b 7761 7267 733a 0a20 2020 2020  lt_kwargs:.     
-00011420: 2020 2020 2020 206d 616e 6461 746f 7279         mandatory
-00011430: 5f6b 7761 7267 732e 6170 7065 6e64 2861  _kwargs.append(a
-00011440: 7267 290a 2020 2020 7265 7475 726e 206d  rg).    return m
-00011450: 616e 6461 746f 7279 5f6b 7761 7267 730a  andatory_kwargs.
-00011460: 0a0a 6465 6620 6865 6c70 5f6f 6e5f 7479  ..def help_on_ty
-00011470: 7065 5f65 7272 6f72 5f77 726f 6e67 5f61  pe_error_wrong_a
-00011480: 7267 7328 636c 732c 206b 7761 7267 7329  rgs(cls, kwargs)
-00011490: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-000114a0: 6172 616d 2074 7970 6520 636c 733a 0a20  aram type cls:. 
-000114b0: 2020 203a 7061 7261 6d20 6c69 7374 5b73     :param list[s
-000114c0: 7472 5d20 6b77 6172 6773 3a0a 2020 2020  tr] kwargs:.    
-000114d0: 2222 220a 2020 2020 6d61 6e64 6174 6f72  """.    mandator
-000114e0: 795f 6172 6773 203d 2063 6f6c 6c65 6374  y_args = collect
-000114f0: 5f6d 616e 6461 746f 7279 5f63 6c61 7373  _mandatory_class
-00011500: 5f69 6e69 745f 6b77 6172 6773 2863 6c73  _init_kwargs(cls
-00011510: 290a 2020 2020 666f 7220 6172 6720 696e  ).    for arg in
-00011520: 206b 7761 7267 733a 0a20 2020 2020 2020   kwargs:.       
-00011530: 2069 6620 6172 6720 696e 206d 616e 6461   if arg in manda
-00011540: 746f 7279 5f61 7267 733a 0a20 2020 2020  tory_args:.     
-00011550: 2020 2020 2020 206d 616e 6461 746f 7279         mandatory
-00011560: 5f61 7267 732e 7265 6d6f 7665 2861 7267  _args.remove(arg
-00011570: 290a 2020 2020 616c 6c5f 6b77 6172 6773  ).    all_kwargs
-00011580: 203d 2063 6f6c 6c65 6374 5f63 6c61 7373   = collect_class
-00011590: 5f69 6e69 745f 6b77 6172 6773 2863 6c73  _init_kwargs(cls
-000115a0: 290a 2020 2020 756e 6b6e 6f77 6e5f 6172  ).    unknown_ar
-000115b0: 6773 203d 205b 5d0a 2020 2020 666f 7220  gs = [].    for 
-000115c0: 6172 6720 696e 206b 7761 7267 733a 0a20  arg in kwargs:. 
-000115d0: 2020 2020 2020 2069 6620 6172 6720 6e6f         if arg no
-000115e0: 7420 696e 2061 6c6c 5f6b 7761 7267 733a  t in all_kwargs:
-000115f0: 0a20 2020 2020 2020 2020 2020 2075 6e6b  .            unk
-00011600: 6e6f 776e 5f61 7267 732e 6170 7065 6e64  nown_args.append
-00011610: 2861 7267 290a 2020 2020 6966 206d 616e  (arg).    if man
-00011620: 6461 746f 7279 5f61 7267 7320 6f72 2075  datory_args or u
-00011630: 6e6b 6e6f 776e 5f61 7267 733a 0a20 2020  nknown_args:.   
-00011640: 2020 2020 2070 7269 6e74 2822 4172 6773       print("Args
-00011650: 206d 6973 6d61 7463 683f 204d 6973 7369   mismatch? Missi
-00011660: 6e67 2061 7265 2025 722c 2075 6e6b 6e6f  ng are %r, unkno
-00011670: 776e 7320 6172 6520 2572 2e20 4b77 6172  wns are %r. Kwar
-00011680: 6773 2025 722e 2220 2520 286d 616e 6461  gs %r." % (manda
-00011690: 746f 7279 5f61 7267 732c 2075 6e6b 6e6f  tory_args, unkno
-000116a0: 776e 5f61 7267 732c 206b 7761 7267 7329  wn_args, kwargs)
-000116b0: 290a 0a0a 6465 6620 6375 7374 6f6d 5f65  )...def custom_e
-000116c0: 7865 6328 736f 7572 6365 2c20 736f 7572  xec(source, sour
-000116d0: 6365 5f66 696c 656e 616d 652c 2075 7365  ce_filename, use
-000116e0: 725f 6e73 2c20 7573 6572 5f67 6c6f 6261  r_ns, user_globa
-000116f0: 6c5f 6e73 293a 0a20 2020 2022 2222 0a20  l_ns):.    """. 
-00011700: 2020 203a 7061 7261 6d20 7374 7220 736f     :param str so
-00011710: 7572 6365 3a0a 2020 2020 3a70 6172 616d  urce:.    :param
-00011720: 2073 7472 2073 6f75 7263 655f 6669 6c65   str source_file
-00011730: 6e61 6d65 3a0a 2020 2020 3a70 6172 616d  name:.    :param
-00011740: 2064 6963 745b 7374 725d 2075 7365 725f   dict[str] user_
-00011750: 6e73 3a0a 2020 2020 3a70 6172 616d 2064  ns:.    :param d
-00011760: 6963 745b 7374 725d 2075 7365 725f 676c  ict[str] user_gl
-00011770: 6f62 616c 5f6e 733a 0a20 2020 203a 7265  obal_ns:.    :re
-00011780: 7475 726e 3a20 6e6f 7468 696e 670a 2020  turn: nothing.  
-00011790: 2020 2222 220a 2020 2020 6966 206e 6f74    """.    if not
-000117a0: 2073 6f75 7263 652e 656e 6473 7769 7468   source.endswith
-000117b0: 2822 5c6e 2229 3a0a 2020 2020 2020 2020  ("\n"):.        
-000117c0: 736f 7572 6365 202b 3d20 225c 6e22 0a20  source += "\n". 
-000117d0: 2020 2063 6f20 3d20 636f 6d70 696c 6528     co = compile(
-000117e0: 736f 7572 6365 2c20 736f 7572 6365 5f66  source, source_f
-000117f0: 696c 656e 616d 652c 2022 6578 6563 2229  ilename, "exec")
-00011800: 0a20 2020 2075 7365 725f 676c 6f62 616c  .    user_global
-00011810: 5f6e 735b 225f 5f70 6163 6b61 6765 5f5f  _ns["__package__
-00011820: 225d 203d 2022 7265 7475 726e 6e22 2020  "] = "returnn"  
-00011830: 2320 696d 706f 7274 616e 7420 736f 2074  # important so t
-00011840: 6861 7420 696d 706f 7274 7320 776f 726b  hat imports work
-00011850: 0a20 2020 2065 7661 6c28 636f 2c20 7573  .    eval(co, us
-00011860: 6572 5f67 6c6f 6261 6c5f 6e73 2c20 7573  er_global_ns, us
-00011870: 6572 5f6e 7329 0a0a 0a63 6c61 7373 2046  er_ns)...class F
-00011880: 726f 7a65 6e44 6963 7428 6469 6374 293a  rozenDict(dict):
-00011890: 0a20 2020 2022 2222 0a20 2020 2046 726f  .    """.    Fro
-000118a0: 7a65 6e20 6469 6374 2e0a 2020 2020 2222  zen dict..    ""
-000118b0: 220a 0a20 2020 2064 6566 205f 5f73 6574  "..    def __set
-000118c0: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-000118d0: 2c20 7661 6c75 6529 3a0a 2020 2020 2020  , value):.      
-000118e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000118f0: 6f72 2822 4672 6f7a 656e 4469 6374 2063  or("FrozenDict c
-00011900: 616e 6e6f 7420 6265 206d 6f64 6966 6965  annot be modifie
-00011910: 6422 290a 0a20 2020 2064 6566 205f 5f68  d")..    def __h
-00011920: 6173 685f 5f28 7365 6c66 293a 0a20 2020  ash__(self):.   
-00011930: 2020 2020 2072 6574 7572 6e20 6861 7368       return hash
-00011940: 2874 7570 6c65 2873 6f72 7465 6428 7365  (tuple(sorted(se
-00011950: 6c66 2e69 7465 6d73 2829 2929 290a 0a0a  lf.items())))...
-00011960: 6465 6620 6d61 6b65 5f68 6173 6861 626c  def make_hashabl
-00011970: 6528 6f62 6a29 3a0a 2020 2020 2222 220a  e(obj):.    """.
-00011980: 2020 2020 5468 6561 6e6f 206e 6565 6473      Theano needs
-00011990: 2068 6173 6861 626c 6520 6f62 6a65 6374   hashable object
-000119a0: 7320 696e 2073 6f6d 6520 6361 7365 732c  s in some cases,
-000119b0: 2065 2e67 2e20 7468 6520 7072 6f70 6572   e.g. the proper
-000119c0: 7469 6573 206f 6620 4f70 732e 0a20 2020  ties of Ops..   
-000119d0: 2054 6869 7320 636f 6e76 6572 7473 2061   This converts a
-000119e0: 6c6c 206f 626a 6563 7473 2061 7320 7375  ll objects as su
-000119f0: 6368 2c20 692e 652e 2069 6e74 6f20 696d  ch, i.e. into im
-00011a00: 6d75 7461 626c 6520 6672 6f7a 656e 2074  mutable frozen t
-00011a10: 7970 6573 2e0a 0a20 2020 203a 7061 7261  ypes...    :para
-00011a20: 6d20 547c 6469 6374 7c6c 6973 747c 7475  m T|dict|list|tu
-00011a30: 706c 6520 6f62 6a3a 0a20 2020 203a 7274  ple obj:.    :rt
-00011a40: 7970 653a 2054 7c46 726f 7a65 6e44 6963  ype: T|FrozenDic
-00011a50: 747c 7475 706c 650a 2020 2020 2222 220a  t|tuple.    """.
-00011a60: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00011a70: 6528 6f62 6a2c 2064 6963 7429 3a0a 2020  e(obj, dict):.  
-00011a80: 2020 2020 2020 7265 7475 726e 2046 726f        return Fro
-00011a90: 7a65 6e44 6963 7428 5b6d 616b 655f 6861  zenDict([make_ha
-00011aa0: 7368 6162 6c65 2869 7465 6d29 2066 6f72  shable(item) for
-00011ab0: 2069 7465 6d20 696e 206f 626a 2e69 7465   item in obj.ite
-00011ac0: 6d73 2829 5d29 0a20 2020 2069 6620 6973  ms()]).    if is
-00011ad0: 696e 7374 616e 6365 286f 626a 2c20 286c  instance(obj, (l
-00011ae0: 6973 742c 2074 7570 6c65 2929 3a0a 2020  ist, tuple)):.  
-00011af0: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
-00011b00: 6c65 285b 6d61 6b65 5f68 6173 6861 626c  le([make_hashabl
-00011b10: 6528 6974 656d 2920 666f 7220 6974 656d  e(item) for item
-00011b20: 2069 6e20 6f62 6a5d 290a 2020 2020 6966   in obj]).    if
-00011b30: 2069 7369 6e73 7461 6e63 6528 6f62 6a2c   isinstance(obj,
-00011b40: 2028 7374 722c 2075 6e69 636f 6465 2c20   (str, unicode, 
-00011b50: 666c 6f61 742c 2069 6e74 2c20 6c6f 6e67  float, int, long
-00011b60: 2929 3a0a 2020 2020 2020 2020 7265 7475  )):.        retu
-00011b70: 726e 206f 626a 0a20 2020 2069 6620 6f62  rn obj.    if ob
-00011b80: 6a20 6973 204e 6f6e 653a 0a20 2020 2020  j is None:.     
-00011b90: 2020 2072 6574 7572 6e20 6f62 6a0a 2020     return obj.  
-00011ba0: 2020 6966 2022 7465 6e73 6f72 666c 6f77    if "tensorflow
-00011bb0: 2220 696e 2073 7973 2e6d 6f64 756c 6573  " in sys.modules
-00011bc0: 3a0a 2020 2020 2020 2020 696d 706f 7274  :.        import
-00011bd0: 2074 656e 736f 7266 6c6f 7720 6173 2074   tensorflow as t
-00011be0: 660a 0a20 2020 2020 2020 2069 6620 6973  f..        if is
-00011bf0: 696e 7374 616e 6365 286f 626a 2c20 7466  instance(obj, tf
-00011c00: 2e54 656e 736f 7229 3a0a 2020 2020 2020  .Tensor):.      
-00011c10: 2020 2020 2020 7265 7475 726e 2052 6566        return Ref
-00011c20: 4964 4571 286f 626a 290a 2020 2020 6173  IdEq(obj).    as
-00011c30: 7365 7274 2046 616c 7365 2c20 2264 6f6e  sert False, "don
-00011c40: 2774 206b 6e6f 7720 686f 7720 746f 206d  't know how to m
-00011c50: 616b 6520 6861 7368 6162 6c65 3a20 2572  ake hashable: %r
-00011c60: 2028 2572 2922 2025 2028 6f62 6a2c 2074   (%r)" % (obj, t
-00011c70: 7970 6528 6f62 6a29 290a 0a0a 636c 6173  ype(obj))...clas
-00011c80: 7320 5265 6649 6445 7128 4765 6e65 7269  s RefIdEq(Generi
-00011c90: 635b 545d 293a 0a20 2020 2022 2222 0a20  c[T]):.    """. 
-00011ca0: 2020 2052 6566 6572 656e 6365 2074 6f20     Reference to 
-00011cb0: 736f 6d65 206f 626a 6563 7420 2865 2e67  some object (e.g
-00011cc0: 2e20 742e 6654 656e 736f 7229 2c20 6275  . t.fTensor), bu
-00011cd0: 7420 7468 6973 206f 626a 6563 7420 6973  t this object is
-00011ce0: 2061 6c77 6179 7320 6861 7368 6162 6c65   always hashable
-00011cf0: 2c0a 2020 2020 616e 6420 7573 6573 2074  ,.    and uses t
-00011d00: 6865 2060 6964 6020 6f66 2074 6865 2066  he `id` of the f
-00011d10: 756e 6374 696f 6e20 666f 7220 7468 6520  unction for the 
-00011d20: 6861 7368 2061 6e64 2065 7175 616c 6974  hash and equalit
-00011d30: 792e 0a0a 2020 2020 2849 6e20 6361 7365  y...    (In case
-00011d40: 206f 6620 7466 2e54 656e 736f 722c 2074   of tf.Tensor, t
-00011d50: 6869 7320 6973 2066 6f72 2063 6f6d 7061  his is for compa
-00011d60: 7469 6269 6c69 7479 0a20 2020 2020 6265  tibility.     be
-00011d70: 6361 7573 6520 7466 2e54 656e 736f 722e  cause tf.Tensor.
-00011d80: 7265 6628 2920 7761 7320 6e6f 7420 6176  ref() was not av
-00011d90: 6169 6c61 626c 6520 696e 2065 6172 6c69  ailable in earli
-00011da0: 6572 2054 4620 7665 7273 696f 6e73 2e0a  er TF versions..
-00011db0: 2020 2020 2048 6f77 6576 6572 2c20 7765       However, we
-00011dc0: 2061 6c73 6f20 6e65 6564 2074 6869 7320   also need this 
-00011dd0: 666f 7220 3a63 6c61 7373 3a60 4469 6374  for :class:`Dict
-00011de0: 5265 664b 6579 7360 2e29 0a20 2020 2022  RefKeys`.).    "
-00011df0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00011e00: 6974 5f5f 2873 656c 662c 206f 626a 3a20  it__(self, obj: 
-00011e10: 5429 3a0a 2020 2020 2020 2020 2222 220a  T):.        """.
-00011e20: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00011e30: 626a 3a20 666f 7220 6578 616d 706c 6520  bj: for example 
-00011e40: 7466 2e54 656e 736f 720a 2020 2020 2020  tf.Tensor.      
-00011e50: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-00011e60: 6c66 2e6f 626a 203d 206f 626a 0a0a 2020  lf.obj = obj..  
-00011e70: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
-00011e80: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00011e90: 7475 726e 2022 5465 6e73 6f72 5265 667b  turn "TensorRef{
-00011ea0: 2572 7d22 2025 2073 656c 662e 6f62 6a0a  %r}" % self.obj.
-00011eb0: 0a20 2020 2064 6566 205f 5f65 715f 5f28  .    def __eq__(
-00011ec0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-00011ed0: 2020 2020 2020 6966 206f 7468 6572 2069        if other i
-00011ee0: 7320 4e6f 6e65 206f 7220 6e6f 7420 6973  s None or not is
-00011ef0: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
-00011f00: 5265 6649 6445 7129 3a0a 2020 2020 2020  RefIdEq):.      
-00011f10: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00011f20: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
-00011f30: 6e20 7365 6c66 2e6f 626a 2069 7320 6f74  n self.obj is ot
-00011f40: 6865 722e 6f62 6a0a 0a20 2020 2064 6566  her.obj..    def
-00011f50: 205f 5f6e 655f 5f28 7365 6c66 2c20 6f74   __ne__(self, ot
-00011f60: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-00011f70: 7475 726e 206e 6f74 2073 656c 662e 5f5f  turn not self.__
-00011f80: 6571 5f5f 286f 7468 6572 290a 0a20 2020  eq__(other)..   
-00011f90: 2064 6566 205f 5f68 6173 685f 5f28 7365   def __hash__(se
-00011fa0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00011fb0: 7572 6e20 6964 2873 656c 662e 6f62 6a29  urn id(self.obj)
-00011fc0: 0a0a 0a63 6c61 7373 2044 6963 7452 6566  ...class DictRef
-00011fd0: 4b65 7973 2847 656e 6572 6963 5b4b 2c20  Keys(Generic[K, 
-00011fe0: 565d 293a 0a20 2020 2022 2222 0a20 2020  V]):.    """.   
-00011ff0: 204c 696b 6520 6064 6963 7460 2c20 6275   Like `dict`, bu
-00012000: 7420 6861 7368 2061 6e64 2065 7175 616c  t hash and equal
-00012010: 6974 7920 6f66 2074 6865 206b 6579 730a  ity of the keys.
-00012020: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00012030: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
-00012040: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00012050: 203d 207b 7d20 2023 2074 7970 653a 2044   = {}  # type: D
-00012060: 6963 745b 5265 6649 6445 715b 4b5d 2c20  ict[RefIdEq[K], 
-00012070: 565d 0a0a 2020 2020 6465 6620 5f5f 7265  V]..    def __re
-00012080: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
-00012090: 2020 2020 7265 7475 726e 2022 4469 6374      return "Dict
-000120a0: 5265 664b 6579 7328 2573 2922 2025 2022  RefKeys(%s)" % "
-000120b0: 2c20 222e 6a6f 696e 285b 2225 723a 2025  , ".join(["%r: %
-000120c0: 7222 2025 2028 6b2c 2076 2920 666f 7220  r" % (k, v) for 
-000120d0: 286b 2c20 7629 2069 6e20 7365 6c66 2e69  (k, v) in self.i
-000120e0: 7465 6d73 2829 5d29 0a0a 2020 2020 6465  tems()])..    de
-000120f0: 6620 6974 656d 7328 7365 6c66 2920 2d3e  f items(self) ->
-00012100: 2049 7465 7261 626c 655b 5475 706c 655b   Iterable[Tuple[
-00012110: 4b2c 2056 5d5d 3a0a 2020 2020 2020 2020  K, V]]:.        
-00012120: 2222 2269 7465 6d73 2222 220a 2020 2020  """items""".    
-00012130: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-00012140: 7365 6c66 2e5f 642e 6974 656d 7328 293a  self._d.items():
-00012150: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
-00012160: 6c64 206b 2e6f 626a 2c20 760a 0a20 2020  ld k.obj, v..   
-00012170: 2064 6566 206b 6579 7328 7365 6c66 2920   def keys(self) 
-00012180: 2d3e 2049 7465 7261 626c 655b 4b5d 3a0a  -> Iterable[K]:.
-00012190: 2020 2020 2020 2020 2222 226b 6579 7322          """keys"
-000121a0: 2222 0a20 2020 2020 2020 2066 6f72 206b  "".        for k
-000121b0: 2069 6e20 7365 6c66 2e5f 642e 6b65 7973   in self._d.keys
-000121c0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000121d0: 7969 656c 6420 6b2e 6f62 6a0a 0a20 2020  yield k.obj..   
-000121e0: 2064 6566 2076 616c 7565 7328 7365 6c66   def values(self
-000121f0: 2920 2d3e 2049 7465 7261 626c 655b 565d  ) -> Iterable[V]
-00012200: 3a0a 2020 2020 2020 2020 2222 2276 616c  :.        """val
-00012210: 7565 7322 2222 0a20 2020 2020 2020 2066  ues""".        f
-00012220: 6f72 2076 2069 6e20 7365 6c66 2e5f 642e  or v in self._d.
-00012230: 7661 6c75 6573 2829 3a0a 2020 2020 2020  values():.      
-00012240: 2020 2020 2020 7969 656c 6420 760a 0a20        yield v.. 
-00012250: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
-00012260: 5f5f 2873 656c 662c 2069 7465 6d3a 204b  __(self, item: K
-00012270: 2920 2d3e 2056 3a0a 2020 2020 2020 2020  ) -> V:.        
-00012280: 7265 7475 726e 2073 656c 662e 5f64 5b52  return self._d[R
-00012290: 6566 4964 4571 2869 7465 6d29 5d0a 0a20  efIdEq(item)].. 
-000122a0: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
-000122b0: 5f5f 2873 656c 662c 206b 6579 3a20 4b2c  __(self, key: K,
-000122c0: 2076 616c 7565 3a20 5629 3a0a 2020 2020   value: V):.    
-000122d0: 2020 2020 7365 6c66 2e5f 645b 5265 6649      self._d[RefI
-000122e0: 6445 7128 6b65 7929 5d20 3d20 7661 6c75  dEq(key)] = valu
-000122f0: 650a 0a20 2020 2064 6566 205f 5f63 6f6e  e..    def __con
-00012300: 7461 696e 735f 5f28 7365 6c66 2c20 6974  tains__(self, it
-00012310: 656d 3a20 4b29 3a0a 2020 2020 2020 2020  em: K):.        
-00012320: 7265 7475 726e 2052 6566 4964 4571 2869  return RefIdEq(i
-00012330: 7465 6d29 2069 6e20 7365 6c66 2e5f 640a  tem) in self._d.
-00012340: 0a0a 6465 6620 6d61 6b65 5f64 6c6c 5f6e  ..def make_dll_n
-00012350: 616d 6528 6261 7365 6e61 6d65 293a 0a20  ame(basename):. 
-00012360: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00012370: 6d20 7374 7220 6261 7365 6e61 6d65 3a0a  m str basename:.
-00012380: 2020 2020 3a72 6574 7572 6e3a 2065 2e67      :return: e.g
-00012390: 2e20 226c 6962 2573 2e73 6f22 2025 2062  . "lib%s.so" % b
-000123a0: 6173 656e 616d 652c 2064 6570 656e 6469  asename, dependi
-000123b0: 6e67 206f 6e20 7379 732e 706c 6174 666f  ng on sys.platfo
-000123c0: 726d 0a20 2020 203a 7274 7970 653a 2073  rm.    :rtype: s
-000123d0: 7472 0a20 2020 2022 2222 0a20 2020 2069  tr.    """.    i
-000123e0: 6620 7379 732e 706c 6174 666f 726d 203d  f sys.platform =
-000123f0: 3d20 2264 6172 7769 6e22 3a0a 2020 2020  = "darwin":.    
-00012400: 2020 2020 7265 7475 726e 2022 6c69 6225      return "lib%
-00012410: 732e 6479 6c69 6222 2025 2062 6173 656e  s.dylib" % basen
-00012420: 616d 650a 2020 2020 656c 6966 2073 7973  ame.    elif sys
-00012430: 2e70 6c61 7466 6f72 6d20 3d3d 2022 7769  .platform == "wi
-00012440: 6e33 3222 3a0a 2020 2020 2020 2020 7265  n32":.        re
-00012450: 7475 726e 2022 2573 2e64 6c6c 2220 2520  turn "%s.dll" % 
-00012460: 6261 7365 6e61 6d65 0a20 2020 2065 6c73  basename.    els
-00012470: 653a 2020 2320 4c69 6e75 782c 2055 6e69  e:  # Linux, Uni
-00012480: 780a 2020 2020 2020 2020 7265 7475 726e  x.        return
-00012490: 2022 6c69 6225 732e 736f 2220 2520 6261   "lib%s.so" % ba
-000124a0: 7365 6e61 6d65 0a0a 0a64 6566 2065 7363  sename...def esc
-000124b0: 6170 655f 635f 7374 7228 7329 3a0a 2020  ape_c_str(s):.  
-000124c0: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
-000124d0: 2073 7472 2073 3a0a 2020 2020 3a72 6574   str s:.    :ret
-000124e0: 7572 6e3a 2043 2d65 7363 6170 6564 2073  urn: C-escaped s
-000124f0: 7472 0a20 2020 203a 7274 7970 653a 2073  tr.    :rtype: s
-00012500: 7472 0a20 2020 2022 2222 0a20 2020 2072  tr.    """.    r
-00012510: 6574 7572 6e20 2722 2573 2227 2025 2073  eturn '"%s"' % s
-00012520: 2e72 6570 6c61 6365 2822 5c5c 5c5c 222c  .replace("\\\\",
-00012530: 2022 5c5c 2229 2e72 6570 6c61 6365 2822   "\\").replace("
-00012540: 5c6e 222c 2022 5c5c 6e22 292e 7265 706c  \n", "\\n").repl
-00012550: 6163 6528 2722 272c 2027 5c5c 2227 292e  ace('"', '\\"').
-00012560: 7265 706c 6163 6528 2227 222c 2022 5c5c  replace("'", "\\
-00012570: 2722 290a 0a0a 6465 6620 6174 7472 5f63  '")...def attr_c
-00012580: 6861 696e 2862 6173 652c 2061 7474 7269  hain(base, attri
-00012590: 6273 293a 0a20 2020 2022 2222 0a20 2020  bs):.    """.   
-000125a0: 203a 7061 7261 6d20 6f62 6a65 6374 2062   :param object b
-000125b0: 6173 653a 0a20 2020 203a 7061 7261 6d20  ase:.    :param 
-000125c0: 6c69 7374 5b73 7472 5d7c 7475 706c 655b  list[str]|tuple[
-000125d0: 7374 725d 7c73 7472 2061 7474 7269 6273  str]|str attribs
-000125e0: 3a0a 2020 2020 3a72 6574 7572 6e3a 2067  :.    :return: g
-000125f0: 6574 6174 7472 2867 6574 6174 7472 286f  etattr(getattr(o
-00012600: 626a 6563 742c 2061 7474 7269 6273 5b30  bject, attribs[0
-00012610: 5d29 2c20 6174 7472 6962 735b 315d 2920  ]), attribs[1]) 
-00012620: 2e2e 2e0a 2020 2020 3a72 7479 7065 3a20  ....    :rtype: 
-00012630: 6f62 6a65 6374 0a20 2020 2022 2222 0a20  object.    """. 
-00012640: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00012650: 616e 6365 2861 7474 7269 6273 2c20 286c  ance(attribs, (l
-00012660: 6973 742c 2074 7570 6c65 2929 3a0a 2020  ist, tuple)):.  
-00012670: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-00012680: 6e73 7461 6e63 6528 6174 7472 6962 732c  nstance(attribs,
-00012690: 2073 7472 290a 2020 2020 2020 2020 6174   str).        at
-000126a0: 7472 6962 7320 3d20 5b61 7474 7269 6273  tribs = [attribs
-000126b0: 5d0a 2020 2020 656c 7365 3a0a 2020 2020  ].    else:.    
-000126c0: 2020 2020 6174 7472 6962 7320 3d20 6c69      attribs = li
-000126d0: 7374 2861 7474 7269 6273 290a 2020 2020  st(attribs).    
-000126e0: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-000126f0: 656e 2861 7474 7269 6273 2929 3a0a 2020  en(attribs)):.  
-00012700: 2020 2020 2020 6261 7365 203d 2067 6574        base = get
-00012710: 6174 7472 2862 6173 652c 2061 7474 7269  attr(base, attri
-00012720: 6273 5b69 5d29 0a20 2020 2072 6574 7572  bs[i]).    retur
-00012730: 6e20 6261 7365 0a0a 0a64 6566 2074 6f5f  n base...def to_
-00012740: 626f 6f6c 2876 293a 0a20 2020 2022 2222  bool(v):.    """
-00012750: 0a20 2020 203a 7061 7261 6d20 696e 747c  .    :param int|
-00012760: 666c 6f61 747c 7374 7220 763a 2069 6620  float|str v: if 
-00012770: 6974 2069 7320 6120 7374 7269 6e67 2c20  it is a string, 
-00012780: 6974 2073 686f 756c 6420 7265 7072 6573  it should repres
-00012790: 656e 7420 736f 6d65 2069 6e74 6567 6572  ent some integer
-000127a0: 2c20 6f72 2061 6c74 6572 6e61 7469 7665  , or alternative
-000127b0: 6c79 2022 7472 7565 2220 6f72 2022 6661  ly "true" or "fa
-000127c0: 6c73 6522 0a20 2020 203a 7274 7970 653a  lse".    :rtype:
-000127d0: 2062 6f6f 6c0a 2020 2020 2222 220a 2020   bool.    """.  
-000127e0: 2020 7472 793a 0a20 2020 2020 2020 2072    try:.        r
-000127f0: 6574 7572 6e20 626f 6f6c 2869 6e74 2876  eturn bool(int(v
-00012800: 2929 0a20 2020 2065 7863 6570 7420 5661  )).    except Va
-00012810: 6c75 6545 7272 6f72 3a0a 2020 2020 2020  lueError:.      
-00012820: 2020 7061 7373 0a20 2020 2069 6620 6973    pass.    if is
-00012830: 696e 7374 616e 6365 2876 2c20 2873 7472  instance(v, (str
-00012840: 2c20 756e 6963 6f64 6529 293a 0a20 2020  , unicode)):.   
-00012850: 2020 2020 2076 203d 2076 2e6c 6f77 6572       v = v.lower
-00012860: 2829 0a20 2020 2020 2020 2069 6620 7620  ().        if v 
-00012870: 696e 205b 2274 7275 6522 2c20 2279 6573  in ["true", "yes
-00012880: 222c 2022 6f6e 222c 2022 3122 5d3a 0a20  ", "on", "1"]:. 
-00012890: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000128a0: 6e20 5472 7565 0a20 2020 2020 2020 2069  n True.        i
-000128b0: 6620 7620 696e 205b 2266 616c 7365 222c  f v in ["false",
-000128c0: 2022 6e6f 222c 2022 6f66 6622 2c20 2230   "no", "off", "0
-000128d0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-000128e0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-000128f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00012900: 7228 2274 6f5f 626f 6f6c 2063 616e 6e6f  r("to_bool canno
-00012910: 7420 6861 6e64 6c65 2025 7222 2025 2076  t handle %r" % v
-00012920: 290a 0a0a 6465 6620 6173 5f73 7472 2873  )...def as_str(s
-00012930: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00012940: 7061 7261 6d20 7374 727c 756e 6963 6f64  param str|unicod
-00012950: 657c 6279 7465 7320 733a 0a20 2020 203a  e|bytes s:.    :
-00012960: 7274 7970 653a 2073 7472 7c75 6e69 636f  rtype: str|unico
-00012970: 6465 0a20 2020 2022 2222 0a20 2020 2069  de.    """.    i
-00012980: 6620 6973 696e 7374 616e 6365 2873 2c20  f isinstance(s, 
-00012990: 7374 7229 206f 7220 2275 6e69 636f 6465  str) or "unicode
-000129a0: 2220 696e 2073 7472 2874 7970 6528 7329  " in str(type(s)
-000129b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000129c0: 6e20 730a 2020 2020 6966 2069 7369 6e73  n s.    if isins
-000129d0: 7461 6e63 6528 732c 2062 7974 6573 2920  tance(s, bytes) 
-000129e0: 6f72 2069 7369 6e73 7461 6e63 6528 732c  or isinstance(s,
-000129f0: 2075 6e69 636f 6465 293a 0a20 2020 2020   unicode):.     
-00012a00: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
-00012a10: 6e20 5079 556e 7265 736f 6c76 6564 5265  n PyUnresolvedRe
-00012a20: 6665 7265 6e63 6573 0a20 2020 2020 2020  ferences.       
-00012a30: 2072 6574 7572 6e20 732e 6465 636f 6465   return s.decode
-00012a40: 2822 7574 6638 2229 0a20 2020 2061 7373  ("utf8").    ass
-00012a50: 6572 7420 4661 6c73 652c 2022 756e 6b6e  ert False, "unkn
-00012a60: 6f77 6e20 7479 7065 2025 7322 2025 2074  own type %s" % t
-00012a70: 7970 6528 7329 0a0a 0a64 6566 2070 7932  ype(s)...def py2
-00012a80: 5f75 7466 385f 7374 725f 746f 5f75 6e69  _utf8_str_to_uni
-00012a90: 636f 6465 2873 293a 0a20 2020 2022 2222  code(s):.    """
-00012aa0: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
-00012ab0: 733a 2065 2e67 2e20 7468 6520 7374 7269  s: e.g. the stri
-00012ac0: 6e67 206c 6974 6572 616c 2022 c3a4 c3b6  ng literal "....
-00012ad0: c3bc 2220 696e 2050 7974 686f 6e20 3320  .." in Python 3 
-00012ae0: 6973 2063 6f72 7265 6374 2c20 6275 7420  is correct, but 
-00012af0: 696e 2050 7974 686f 6e20 3220 6974 2073  in Python 2 it s
-00012b00: 686f 756c 6420 6861 7665 2062 6565 6e20  hould have been 
-00012b10: 7522 c3a4 c3b6 c3bc 222c 0a20 2020 2020  u"......",.     
-00012b20: 2062 7574 206a 7573 7420 7573 696e 6720   but just using 
-00012b30: 22c3 a4c3 b6c3 bc22 2077 696c 6c20 6163  "......" will ac
-00012b40: 7475 616c 6c79 2062 6520 7468 6520 7261  tually be the ra
-00012b50: 7720 7574 6638 2062 7974 6520 7365 7175  w utf8 byte sequ
-00012b60: 656e 6365 2e0a 2020 2020 2020 5468 6973  ence..      This
-00012b70: 2063 616e 2068 6170 7065 6e20 7768 656e   can happen when
-00012b80: 2079 6f75 2065 7661 6c28 2920 736f 6d65   you eval() some
-00012b90: 2073 7472 696e 672e 0a20 2020 2020 2057   string..      W
-00012ba0: 6520 6173 7375 6d65 2074 6861 7420 796f  e assume that yo
-00012bb0: 7520 6172 6520 7573 696e 6720 5079 7468  u are using Pyth
-00012bc0: 6f6e 2032 2c20 616e 6420 676f 7420 7468  on 2, and got th
-00012bd0: 6520 7374 7269 6e67 2028 6e6f 7420 756e  e string (not un
-00012be0: 6963 6f64 6520 6f62 6a65 6374 2920 22c3  icode object) ".
-00012bf0: a4c3 b6c3 bc22 2c20 6f72 206d 6179 6265  .....", or maybe
-00012c00: 2022 6162 6322 2e0a 2020 2020 2020 416c   "abc"..      Al
-00012c10: 736f 2073 6565 203a 6675 6e63 3a60 5f70  so see :func:`_p
-00012c20: 7932 5f75 6e69 636f 6465 5f74 6f5f 7374  y2_unicode_to_st
-00012c30: 725f 7265 6375 7273 6976 6560 2061 6e64  r_recursive` and
-00012c40: 203a 6675 6e63 3a60 6173 5f73 7472 602e   :func:`as_str`.
-00012c50: 0a20 2020 203a 7265 7475 726e 3a20 6966  .    :return: if
-00012c60: 2069 7420 6973 2069 6e64 6565 6420 756e   it is indeed un
-00012c70: 6963 6f64 652c 2069 7420 7769 6c6c 2072  icode, it will r
-00012c80: 6574 7572 6e20 7468 6520 756e 6963 6f64  eturn the unicod
-00012c90: 6520 6f62 6a65 6374 2c20 6f74 6865 7277  e object, otherw
-00012ca0: 6973 6520 6974 206b 6565 7073 2074 6865  ise it keeps the
-00012cb0: 2073 7472 696e 670a 2020 2020 3a72 7479   string.    :rty
-00012cc0: 7065 3a20 7374 727c 756e 6963 6f64 650a  pe: str|unicode.
-00012cd0: 2020 2020 2222 220a 2020 2020 6173 7365      """.    asse
-00012ce0: 7274 206e 6f74 2050 5933 0a20 2020 2061  rt not PY3.    a
-00012cf0: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00012d00: 2873 2c20 7374 7229 0a20 2020 2074 7279  (s, str).    try
-00012d10: 3a0a 2020 2020 2020 2020 2320 6e6f 696e  :.        # noin
-00012d20: 7370 6563 7469 6f6e 2050 7955 6e72 6573  spection PyUnres
-00012d30: 6f6c 7665 6452 6566 6572 656e 6365 730a  olvedReferences.
-00012d40: 2020 2020 2020 2020 732e 6465 636f 6465          s.decode
-00012d50: 2822 6173 6369 6922 290a 2020 2020 2020  ("ascii").      
-00012d60: 2020 7265 7475 726e 2073 0a20 2020 2065    return s.    e
-00012d70: 7863 6570 7420 556e 6963 6f64 6544 6563  xcept UnicodeDec
-00012d80: 6f64 6545 7272 6f72 3a0a 2020 2020 2020  odeError:.      
-00012d90: 2020 7061 7373 0a20 2020 2023 206e 6f69    pass.    # noi
-00012da0: 6e73 7065 6374 696f 6e20 5079 556e 7265  nspection PyUnre
-00012db0: 736f 6c76 6564 5265 6665 7265 6e63 6573  solvedReferences
-00012dc0: 0a20 2020 2072 6574 7572 6e20 732e 6465  .    return s.de
-00012dd0: 636f 6465 2822 7574 6638 2229 0a0a 0a64  code("utf8")...d
-00012de0: 6566 2075 6e69 636f 6465 5f74 6f5f 7374  ef unicode_to_st
-00012df0: 7228 7329 3a0a 2020 2020 2222 220a 2020  r(s):.    """.  
-00012e00: 2020 5468 6520 6265 6861 7669 6f72 2069    The behavior i
-00012e10: 7320 6469 6666 6572 656e 7420 6465 7065  s different depe
-00012e20: 6e64 696e 6720 6f6e 2050 7974 686f 6e20  nding on Python 
-00012e30: 3220 6f72 2050 7974 686f 6e20 332e 2049  2 or Python 3. I
-00012e40: 6e20 616c 6c20 6361 7365 732c 2074 6865  n all cases, the
-00012e50: 2072 6574 7572 6e65 6420 7479 7065 2069   returned type i
-00012e60: 7320 6120 7374 7220 6f62 6a65 6374 2e0a  s a str object..
-00012e70: 2020 2020 5079 7468 6f6e 2032 3a0a 2020      Python 2:.  
-00012e80: 2020 2020 5765 2072 6574 7572 6e20 7468      We return th
-00012e90: 6520 7574 6638 2065 6e63 6f64 6564 2073  e utf8 encoded s
-00012ea0: 7472 2028 7768 6963 6820 6973 206c 696b  tr (which is lik
-00012eb0: 6520 5079 7468 6f6e 2033 2062 7974 6573  e Python 3 bytes
-00012ec0: 2c20 6f72 2066 6f72 2041 5343 4949 2c20  , or for ASCII, 
-00012ed0: 7468 6572 6520 6973 206e 6f20 6469 6666  there is no diff
-00012ee0: 6572 656e 6365 292e 0a20 2020 2050 7974  erence)..    Pyt
-00012ef0: 686f 6e20 333a 0a20 2020 2020 2057 6520  hon 3:.      We 
-00012f00: 7265 7475 726e 2061 2073 7472 206f 626a  return a str obj
-00012f10: 6563 742e 0a20 2020 204e 6f74 6520 7468  ect..    Note th
-00012f20: 6174 2074 6869 7320 6675 6e63 7469 6f6e  at this function
-00012f30: 2070 726f 6261 626c 7920 646f 6573 206e   probably does n
-00012f40: 6f74 206d 616b 6520 6d75 6368 2073 656e  ot make much sen
-00012f50: 7365 2e0a 2020 2020 4974 206d 6967 6874  se..    It might
-00012f60: 2062 6520 7573 6564 2077 6865 6e20 7468   be used when th
-00012f70: 6572 6520 6973 206f 7468 6572 2063 6f64  ere is other cod
-00012f80: 6520 7768 6963 6820 6578 7065 6374 7320  e which expects 
-00012f90: 6120 7374 7220 6f62 6a65 6374 2c20 6e6f  a str object, no
-00012fa0: 206d 6174 7465 7220 6966 2050 7974 686f   matter if Pytho
-00012fb0: 6e20 3220 6f72 2050 7974 686f 6e20 332e  n 2 or Python 3.
-00012fc0: 0a20 2020 2049 6e20 5079 7468 6f6e 2032  .    In Python 2
-00012fd0: 2c20 6120 7374 7220 6f62 6a65 6374 206f  , a str object o
-00012fe0: 6674 656e 2068 6f6c 6473 2055 5446 3820  ften holds UTF8 
-00012ff0: 7465 7874 2c20 736f 2074 6865 2062 6568  text, so the beh
-00013000: 6176 696f 7220 6f66 2074 6869 7320 6675  avior of this fu
-00013010: 6e63 7469 6f6e 2069 7320 6669 6e65 2074  nction is fine t
-00013020: 6865 6e2e 0a20 2020 2041 6c73 6f20 7365  hen..    Also se
-00013030: 6520 3a66 756e 633a 6061 735f 7374 7260  e :func:`as_str`
-00013040: 2e0a 0a20 2020 203a 7061 7261 6d20 7374  ...    :param st
-00013050: 727c 756e 6963 6f64 657c 6279 7465 7320  r|unicode|bytes 
-00013060: 733a 0a20 2020 203a 7274 7970 653a 2073  s:.    :rtype: s
-00013070: 7472 0a20 2020 2022 2222 0a20 2020 2069  tr.    """.    i
-00013080: 6620 5059 3320 616e 6420 6973 696e 7374  f PY3 and isinst
-00013090: 616e 6365 2873 2c20 6279 7465 7329 3a0a  ance(s, bytes):.
-000130a0: 2020 2020 2020 2020 7320 3d20 732e 6465          s = s.de
-000130b0: 636f 6465 2822 7574 6638 2229 0a20 2020  code("utf8").   
-000130c0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
-000130d0: 7374 616e 6365 2873 2c20 7374 7229 0a20  stance(s, str). 
-000130e0: 2020 2069 6620 6e6f 7420 5059 3320 616e     if not PY3 an
-000130f0: 6420 6973 696e 7374 616e 6365 2873 2c20  d isinstance(s, 
-00013100: 756e 6963 6f64 6529 3a0a 2020 2020 2020  unicode):.      
-00013110: 2020 7320 3d20 732e 656e 636f 6465 2822    s = s.encode("
-00013120: 7574 6638 2229 0a20 2020 2020 2020 2061  utf8").        a
-00013130: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00013140: 2873 2c20 7374 7229 0a20 2020 2061 7373  (s, str).    ass
-00013150: 6572 7420 6973 696e 7374 616e 6365 2873  ert isinstance(s
-00013160: 2c20 7374 7229 0a20 2020 2072 6574 7572  , str).    retur
-00013170: 6e20 730a 0a0a 6465 6620 6465 6570 636f  n s...def deepco
-00013180: 7079 2878 2c20 7374 6f70 5f74 7970 6573  py(x, stop_types
-00013190: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
-000131a0: 2020 2020 5369 6d70 6c65 7220 7661 7269      Simpler vari
-000131b0: 616e 7420 6f66 2063 6f70 792e 6465 6570  ant of copy.deep
-000131c0: 636f 7079 2829 2e0a 2020 2020 5368 6f75  copy()..    Shou
-000131d0: 6c64 2068 616e 646c 6520 736f 6d65 2065  ld handle some e
-000131e0: 6467 6520 6361 7365 7320 6173 2077 656c  dge cases as wel
-000131f0: 6c2c 206c 696b 6520 636f 7079 696e 6720  l, like copying 
-00013200: 6d6f 6475 6c65 2072 6566 6572 656e 6365  module reference
-00013210: 732e 0a0a 2020 2020 3a70 6172 616d 2054  s...    :param T
-00013220: 2078 3a20 616e 2061 7262 6974 7261 7279   x: an arbitrary
-00013230: 206f 626a 6563 740a 2020 2020 3a70 6172   object.    :par
-00013240: 616d 206c 6973 745b 7479 7065 5d7c 4e6f  am list[type]|No
-00013250: 6e65 2073 746f 705f 7479 7065 733a 206f  ne stop_types: o
-00013260: 626a 6563 7473 206f 6620 7468 6573 6520  bjects of these 
-00013270: 7479 7065 7320 7769 6c6c 206e 6f74 2062  types will not b
-00013280: 6520 6465 6570 2d63 6f70 6965 642c 206f  e deep-copied, o
-00013290: 6e6c 7920 7468 6520 7265 6665 7265 6e63  nly the referenc
-000132a0: 6520 6973 2070 6173 7365 640a 2020 2020  e is passed.    
-000132b0: 3a72 7479 7065 3a20 540a 2020 2020 2222  :rtype: T.    ""
-000132c0: 220a 2020 2020 2320 5365 6520 616c 736f  ".    # See also
-000132d0: 2063 6c61 7373 2050 6963 6b6c 6572 2066   class Pickler f
-000132e0: 726f 6d20 5461 736b 5379 7374 656d 2e0a  rom TaskSystem..
-000132f0: 2020 2020 2320 4f72 3a20 6874 7470 733a      # Or: https:
-00013300: 2f2f 6d61 696c 2e70 7974 686f 6e2e 6f72  //mail.python.or
-00013310: 672f 7069 7065 726d 6169 6c2f 7079 7468  g/pipermail/pyth
-00013320: 6f6e 2d69 6465 6173 2f32 3031 332d 4a75  on-ideas/2013-Ju
-00013330: 6c79 2f30 3231 3935 392e 6874 6d6c 0a20  ly/021959.html. 
-00013340: 2020 2066 726f 6d20 2e74 6173 6b5f 7379     from .task_sy
-00013350: 7374 656d 2069 6d70 6f72 7420 5069 636b  stem import Pick
-00013360: 6c65 722c 2055 6e70 6963 6b6c 6572 0a0a  ler, Unpickler..
-00013370: 2020 2020 7065 7273 6973 7465 6e74 5f6d      persistent_m
-00013380: 656d 6f20 3d20 7b7d 2020 2320 6964 202d  emo = {}  # id -
-00013390: 3e20 6f62 6a0a 0a20 2020 2064 6566 2070  > obj..    def p
-000133a0: 6572 7369 7374 656e 745f 6964 286f 626a  ersistent_id(obj
-000133b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000133c0: 2020 2020 2020 203a 7061 7261 6d20 6f62         :param ob
-000133d0: 6a65 6374 206f 626a 3a0a 2020 2020 2020  ject obj:.      
-000133e0: 2020 3a72 7479 7065 3a20 696e 747c 4e6f    :rtype: int|No
-000133f0: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-00013400: 2020 2020 2020 2069 6620 7374 6f70 5f74         if stop_t
-00013410: 7970 6573 2061 6e64 2069 7369 6e73 7461  ypes and isinsta
-00013420: 6e63 6528 6f62 6a2c 2074 7570 6c65 2873  nce(obj, tuple(s
-00013430: 746f 705f 7479 7065 7329 293a 0a20 2020  top_types)):.   
-00013440: 2020 2020 2020 2020 2070 6572 7369 7374           persist
-00013450: 656e 745f 6d65 6d6f 5b69 6428 6f62 6a29  ent_memo[id(obj)
-00013460: 5d20 3d20 6f62 6a0a 2020 2020 2020 2020  ] = obj.        
-00013470: 2020 2020 7265 7475 726e 2069 6428 6f62      return id(ob
-00013480: 6a29 0a20 2020 2020 2020 2072 6574 7572  j).        retur
-00013490: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
-000134a0: 7069 636b 6c65 5f64 756d 7073 286f 626a  pickle_dumps(obj
-000134b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000134c0: 2020 2020 2020 203a 7061 7261 6d20 6f62         :param ob
-000134d0: 6a65 6374 206f 626a 3a0a 2020 2020 2020  ject obj:.      
-000134e0: 2020 3a72 7479 7065 3a20 6279 7465 730a    :rtype: bytes.
-000134f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013500: 2020 2020 7369 6f20 3d20 4279 7465 7349      sio = BytesI
-00013510: 4f28 290a 2020 2020 2020 2020 7020 3d20  O().        p = 
-00013520: 5069 636b 6c65 7228 7369 6f29 0a20 2020  Pickler(sio).   
-00013530: 2020 2020 2070 2e70 6572 7369 7374 656e       p.persisten
-00013540: 745f 6964 203d 2070 6572 7369 7374 656e  t_id = persisten
-00013550: 745f 6964 0a20 2020 2020 2020 2070 2e64  t_id.        p.d
-00013560: 756d 7028 6f62 6a29 0a20 2020 2020 2020  ump(obj).       
-00013570: 2072 6574 7572 6e20 7369 6f2e 6765 7476   return sio.getv
-00013580: 616c 7565 2829 0a0a 2020 2020 2320 6e6f  alue()..    # no
-00013590: 696e 7370 6563 7469 6f6e 2050 7953 6861  inspection PySha
-000135a0: 646f 7769 6e67 4e61 6d65 730a 2020 2020  dowingNames.    
-000135b0: 6465 6620 7069 636b 6c65 5f6c 6f61 6473  def pickle_loads
-000135c0: 2873 293a 0a20 2020 2020 2020 2022 2222  (s):.        """
-000135d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000135e0: 6279 7465 7320 733a 0a20 2020 2020 2020  bytes s:.       
-000135f0: 203a 7274 7970 653a 206f 626a 6563 740a   :rtype: object.
-00013600: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013610: 2020 2020 7020 3d20 556e 7069 636b 6c65      p = Unpickle
-00013620: 7228 4279 7465 7349 4f28 7329 290a 2020  r(BytesIO(s)).  
-00013630: 2020 2020 2020 702e 7065 7273 6973 7465        p.persiste
-00013640: 6e74 5f6c 6f61 6420 3d20 7065 7273 6973  nt_load = persis
-00013650: 7465 6e74 5f6d 656d 6f2e 5f5f 6765 7469  tent_memo.__geti
-00013660: 7465 6d5f 5f0a 2020 2020 2020 2020 7265  tem__.        re
-00013670: 7475 726e 2070 2e6c 6f61 6428 290a 0a20  turn p.load().. 
-00013680: 2020 2073 203d 2070 6963 6b6c 655f 6475     s = pickle_du
-00013690: 6d70 7328 7829 0a20 2020 2063 203d 2070  mps(x).    c = p
-000136a0: 6963 6b6c 655f 6c6f 6164 7328 7329 0a20  ickle_loads(s). 
-000136b0: 2020 2072 6574 7572 6e20 630a 0a0a 6465     return c...de
-000136c0: 6620 6c6f 6164 5f74 7874 5f76 6563 746f  f load_txt_vecto
-000136d0: 7228 6669 6c65 6e61 6d65 293a 0a20 2020  r(filename):.   
-000136e0: 2022 2222 0a20 2020 2045 7870 6563 7420   """.    Expect 
-000136f0: 6c69 6e65 2d62 6173 6564 2074 6578 7420  line-based text 
-00013700: 656e 636f 6469 6e67 2069 6e20 6669 6c65  encoding in file
-00013710: 2e0a 2020 2020 5765 2061 6c73 6f20 7375  ..    We also su
-00013720: 7070 6f72 7420 5370 7269 6e74 2058 4d4c  pport Sprint XML
-00013730: 2066 6f72 6d61 742c 2077 6869 6368 2068   format, which h
-00013740: 6173 2073 6f6d 6520 6164 6469 7469 6f6e  as some addition
-00013750: 616c 2078 6d6c 2068 6561 6465 7220 616e  al xml header an
-00013760: 6420 666f 6f74 6572 2c0a 2020 2020 7768  d footer,.    wh
-00013770: 6963 6820 7765 2077 696c 6c20 6a75 7374  ich we will just
-00013780: 2073 7472 6970 2061 7761 792e 0a0a 2020   strip away...  
-00013790: 2020 3a70 6172 616d 2073 7472 2066 696c    :param str fil
-000137a0: 656e 616d 653a 0a20 2020 203a 7274 7970  ename:.    :rtyp
-000137b0: 653a 206c 6973 745b 666c 6f61 745d 0a20  e: list[float]. 
-000137c0: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-000137d0: 6e20 5b66 6c6f 6174 286c 696e 6529 2066  n [float(line) f
-000137e0: 6f72 206c 696e 6520 696e 206f 7065 6e28  or line in open(
-000137f0: 6669 6c65 6e61 6d65 292e 7265 6164 2829  filename).read()
-00013800: 2e73 706c 6974 6c69 6e65 7328 2920 6966  .splitlines() if
-00013810: 206c 696e 6520 616e 6420 6e6f 7420 6c69   line and not li
-00013820: 6e65 2e73 7461 7274 7377 6974 6828 223c  ne.startswith("<
-00013830: 2229 5d0a 0a0a 636c 6173 7320 436f 6c6c  ")]...class Coll
-00013840: 6563 7469 6f6e 5265 6164 4368 6563 6b43  ectionReadCheckC
-00013850: 6f76 6572 6564 3a0a 2020 2020 2222 220a  overed:.    """.
-00013860: 2020 2020 5772 6170 7320 6172 6f75 6e64      Wraps around
-00013870: 2061 2064 6963 742e 2049 7420 6b65 6570   a dict. It keep
-00013880: 7320 7472 6163 6b20 6162 6f75 7420 616c  s track about al
-00013890: 6c20 7468 6520 6b65 7973 2077 6869 6368  l the keys which
-000138a0: 2077 6572 6520 7265 6164 2066 726f 6d20   were read from 
-000138b0: 7468 6520 6469 6374 2e0a 2020 2020 5669  the dict..    Vi
-000138c0: 6120 3a66 756e 633a 6061 7373 6572 745f  a :func:`assert_
-000138d0: 616c 6c5f 7265 6164 602c 2079 6f75 2063  all_read`, you c
-000138e0: 616e 2063 6865 636b 2074 6861 7420 7468  an check that th
-000138f0: 6572 6520 6172 6520 6e6f 206b 6579 7320  ere are no keys 
-00013900: 696e 2074 6865 2064 6963 7420 7768 6963  in the dict whic
-00013910: 6820 7765 7265 206e 6f74 2072 6561 642e  h were not read.
-00013920: 0a20 2020 2054 6865 2075 7361 6765 2069  .    The usage i
-00013930: 7320 666f 7220 636f 6e66 6967 2064 6963  s for config dic
-00013940: 7420 6f70 7469 6f6e 732c 2077 6865 7265  t options, where
-00013950: 2074 6865 2075 7365 7220 6861 7320 7370   the user has sp
-00013960: 6563 6966 6965 6420 6120 7261 6e67 6520  ecified a range 
-00013970: 6f66 206f 7074 696f 6e73 2c0a 2020 2020  of options,.    
-00013980: 616e 6420 7768 6572 6520 696e 2074 6865  and where in the
-00013990: 2063 6f64 6520 7468 6572 6520 6973 2075   code there is u
-000139a0: 7375 616c 6c79 2061 2064 6566 6175 6c74  sually a default
-000139b0: 2066 6f72 2065 7665 7279 206e 6f6e 2d73   for every non-s
-000139c0: 7065 6369 6669 6564 206f 7074 696f 6e2c  pecified option,
-000139d0: 0a20 2020 2074 6f20 6368 6563 6b20 7768  .    to check wh
-000139e0: 6574 6865 7220 616c 6c20 7468 6520 7573  ether all the us
-000139f0: 6572 2d73 7065 6369 6669 6564 206f 7074  er-specified opt
-00013a00: 696f 6e73 2061 7265 2061 6c73 6f20 7573  ions are also us
-00013a10: 6564 2028 6d61 7962 6520 7468 6520 7573  ed (maybe the us
-00013a20: 6572 206d 6164 6520 6120 7479 706f 292e  er made a typo).
-00013a30: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00013a40: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00013a50: 2063 6f6c 6c65 6374 696f 6e2c 2074 7275   collection, tru
-00013a60: 7468 5f76 616c 7565 3d4e 6f6e 6529 3a0a  th_value=None):.
-00013a70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013a80: 2020 2020 3a70 6172 616d 2064 6963 745b      :param dict[
-00013a90: 7374 725d 2063 6f6c 6c65 6374 696f 6e3a  str] collection:
-00013aa0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00013ab0: 4e6f 6e65 7c62 6f6f 6c20 7472 7574 685f  None|bool truth_
-00013ac0: 7661 6c75 653a 206e 6f74 653a 2063 6865  value: note: che
-00013ad0: 636b 2065 7870 6c69 6369 746c 7920 666f  ck explicitly fo
-00013ae0: 7220 7365 6c66 2e74 7275 7468 5f76 616c  r self.truth_val
-00013af0: 7565 2c20 626f 6f6c 2873 656c 6629 2069  ue, bool(self) i
-00013b00: 7320 6e6f 7420 7468 6520 7361 6d65 210a  s not the same!.
-00013b10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013b20: 2020 2020 7365 6c66 2e63 6f6c 6c65 6374      self.collect
-00013b30: 696f 6e20 3d20 636f 6c6c 6563 7469 6f6e  ion = collection
-00013b40: 0a20 2020 2020 2020 2069 6620 7472 7574  .        if trut
-00013b50: 685f 7661 6c75 6520 6973 204e 6f6e 653a  h_value is None:
-00013b60: 0a20 2020 2020 2020 2020 2020 2074 7275  .            tru
-00013b70: 7468 5f76 616c 7565 203d 2062 6f6f 6c28  th_value = bool(
-00013b80: 7365 6c66 2e63 6f6c 6c65 6374 696f 6e29  self.collection)
-00013b90: 0a20 2020 2020 2020 2073 656c 662e 7472  .        self.tr
-00013ba0: 7574 685f 7661 6c75 6520 3d20 7472 7574  uth_value = trut
-00013bb0: 685f 7661 6c75 650a 2020 2020 2020 2020  h_value.        
-00013bc0: 7365 6c66 2e67 6f74 5f69 7465 6d73 203d  self.got_items =
-00013bd0: 2073 6574 2829 0a0a 2020 2020 6465 6620   set()..    def 
-00013be0: 5f5f 7265 7072 5f5f 2873 656c 6629 3a0a  __repr__(self):.
-00013bf0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00013c00: 2573 2825 722c 2074 7275 7468 5f76 616c  %s(%r, truth_val
-00013c10: 7565 3d25 7229 2220 2520 2873 656c 662e  ue=%r)" % (self.
-00013c20: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-00013c30: 5f5f 2c20 7365 6c66 2e63 6f6c 6c65 6374  __, self.collect
-00013c40: 696f 6e2c 2073 656c 662e 7472 7574 685f  ion, self.truth_
-00013c50: 7661 6c75 6529 0a0a 2020 2020 4063 6c61  value)..    @cla
-00013c60: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00013c70: 2066 726f 6d5f 626f 6f6c 5f6f 725f 6469   from_bool_or_di
-00013c80: 6374 2863 6c73 2c20 7661 6c75 6529 3a0a  ct(cls, value):.
-00013c90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013ca0: 2020 2020 3a70 6172 616d 2062 6f6f 6c7c      :param bool|
-00013cb0: 6469 6374 5b73 7472 5d20 7661 6c75 653a  dict[str] value:
-00013cc0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-00013cd0: 2043 6f6c 6c65 6374 696f 6e52 6561 6443   CollectionReadC
-00013ce0: 6865 636b 436f 7665 7265 640a 2020 2020  heckCovered.    
-00013cf0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00013d00: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
-00013d10: 6c75 652c 2062 6f6f 6c29 3a0a 2020 2020  lue, bool):.    
-00013d20: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00013d30: 6c73 2863 6f6c 6c65 6374 696f 6e3d 7b7d  ls(collection={}
-00013d40: 2c20 7472 7574 685f 7661 6c75 653d 7661  , truth_value=va
-00013d50: 6c75 6529 0a20 2020 2020 2020 2069 6620  lue).        if 
-00013d60: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-00013d70: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
-00013d80: 2020 2020 2072 6574 7572 6e20 636c 7328       return cls(
-00013d90: 636f 6c6c 6563 7469 6f6e 3d76 616c 7565  collection=value
-00013da0: 290a 2020 2020 2020 2020 7261 6973 6520  ).        raise 
-00013db0: 5479 7065 4572 726f 7228 2269 6e76 616c  TypeError("inval
-00013dc0: 6964 2074 7970 653a 2025 7322 2025 2074  id type: %s" % t
-00013dd0: 7970 6528 7661 6c75 6529 290a 0a20 2020  ype(value))..   
-00013de0: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-00013df0: 2873 656c 662c 2069 7465 6d29 3a0a 2020  (self, item):.  
-00013e00: 2020 2020 2020 7265 7320 3d20 7365 6c66        res = self
-00013e10: 2e63 6f6c 6c65 6374 696f 6e5b 6974 656d  .collection[item
-00013e20: 5d0a 2020 2020 2020 2020 7365 6c66 2e67  ].        self.g
-00013e30: 6f74 5f69 7465 6d73 2e61 6464 2869 7465  ot_items.add(ite
-00013e40: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
-00013e50: 6e20 7265 730a 0a20 2020 2064 6566 2067  n res..    def g
-00013e60: 6574 2873 656c 662c 2069 7465 6d2c 2064  et(self, item, d
-00013e70: 6566 6175 6c74 3d4e 6f6e 6529 3a0a 2020  efault=None):.  
-00013e80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013e90: 2020 3a70 6172 616d 2073 7472 2069 7465    :param str ite
-00013ea0: 6d3a 0a20 2020 2020 2020 203a 7061 7261  m:.        :para
-00013eb0: 6d20 5420 6465 6661 756c 743a 0a20 2020  m T default:.   
-00013ec0: 2020 2020 203a 7274 7970 653a 2054 7c74       :rtype: T|t
-00013ed0: 7970 696e 672e 416e 797c 4e6f 6e65 0a20  yping.Any|None. 
-00013ee0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013ef0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00013f00: 2020 2020 7265 7475 726e 2073 656c 665b      return self[
-00013f10: 6974 656d 5d0a 2020 2020 2020 2020 6578  item].        ex
-00013f20: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
-00013f30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013f40: 6e20 6465 6661 756c 740a 0a20 2020 2064  n default..    d
-00013f50: 6566 205f 5f62 6f6f 6c5f 5f28 7365 6c66  ef __bool__(self
-00013f60: 293a 2020 2320 5079 7468 6f6e 2033 0a20  ):  # Python 3. 
-00013f70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00013f80: 6c66 2e74 7275 7468 5f76 616c 7565 0a0a  lf.truth_value..
-00013f90: 2020 2020 5f5f 6e6f 6e7a 6572 6f5f 5f20      __nonzero__ 
-00013fa0: 3d20 5f5f 626f 6f6c 5f5f 2020 2320 5079  = __bool__  # Py
-00013fb0: 7468 6f6e 2032 0a0a 2020 2020 6465 6620  thon 2..    def 
-00013fc0: 5f5f 6c65 6e5f 5f28 7365 6c66 293a 0a20  __len__(self):. 
-00013fd0: 2020 2020 2020 2072 6574 7572 6e20 6c65         return le
-00013fe0: 6e28 7365 6c66 2e63 6f6c 6c65 6374 696f  n(self.collectio
-00013ff0: 6e29 0a0a 2020 2020 6465 6620 5f5f 6974  n)..    def __it
-00014000: 6572 5f5f 2873 656c 6629 3a0a 2020 2020  er__(self):.    
-00014010: 2020 2020 666f 7220 6b20 696e 2073 656c      for k in sel
-00014020: 662e 636f 6c6c 6563 7469 6f6e 3a0a 2020  f.collection:.  
-00014030: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-00014040: 7365 6c66 5b6b 5d0a 0a20 2020 2064 6566  self[k]..    def
-00014050: 2061 7373 6572 745f 616c 6c5f 7265 6164   assert_all_read
-00014060: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00014070: 2222 220a 2020 2020 2020 2020 4173 7365  """.        Asse
-00014080: 7274 7320 7468 6174 2061 6c6c 2069 7465  rts that all ite
-00014090: 6d73 2068 6176 6520 6265 656e 2072 6561  ms have been rea
-000140a0: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-000140b0: 2020 2020 2020 2072 656d 6169 6e69 6e67         remaining
-000140c0: 203d 2073 6574 2873 656c 662e 636f 6c6c   = set(self.coll
-000140d0: 6563 7469 6f6e 292e 6469 6666 6572 656e  ection).differen
-000140e0: 6365 2873 656c 662e 676f 745f 6974 656d  ce(self.got_item
-000140f0: 7329 0a20 2020 2020 2020 2061 7373 6572  s).        asser
-00014100: 7420 6e6f 7420 7265 6d61 696e 696e 672c  t not remaining,
-00014110: 2022 5468 6520 6b65 7973 2025 7220 7765   "The keys %r we
-00014120: 7265 206e 6f74 2072 6561 6420 696e 2074  re not read in t
-00014130: 6865 2063 6f6c 6c65 6374 696f 6e20 2572  he collection %r
-00014140: 2e22 2025 2028 7265 6d61 696e 696e 672c  ." % (remaining,
-00014150: 2073 656c 662e 636f 6c6c 6563 7469 6f6e   self.collection
-00014160: 290a 0a0a 6465 6620 7768 6963 6828 7072  )...def which(pr
-00014170: 6f67 7261 6d29 3a0a 2020 2020 2222 220a  ogram):.    """.
-00014180: 2020 2020 4669 6e64 7320 6070 726f 6772      Finds `progr
-00014190: 616d 6020 696e 2073 6f6d 6520 6f66 2074  am` in some of t
-000141a0: 6865 2064 6972 7320 6f66 2074 6865 2050  he dirs of the P
-000141b0: 4154 4820 656e 7620 7661 722e 0a0a 2020  ATH env var...  
-000141c0: 2020 3a70 6172 616d 2073 7472 2070 726f    :param str pro
-000141d0: 6772 616d 3a20 652e 672e 2022 7079 7468  gram: e.g. "pyth
-000141e0: 6f6e 220a 2020 2020 3a72 6574 7572 6e3a  on".    :return:
-000141f0: 2066 756c 6c20 7061 7468 2c20 652e 672e   full path, e.g.
-00014200: 2022 2f75 7372 2f62 696e 2f70 7974 686f   "/usr/bin/pytho
-00014210: 6e22 2c20 6f72 204e 6f6e 650a 2020 2020  n", or None.    
-00014220: 3a72 7479 7065 3a20 7374 727c 4e6f 6e65  :rtype: str|None
-00014230: 0a20 2020 2022 2222 0a20 2020 2023 206e  .    """.    # n
-00014240: 6f69 6e73 7065 6374 696f 6e20 5079 5368  oinspection PySh
-00014250: 6164 6f77 696e 674e 616d 6573 0a20 2020  adowingNames.   
-00014260: 2064 6566 2069 735f 6578 6528 7061 7468   def is_exe(path
-00014270: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00014280: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00014290: 7220 7061 7468 3a0a 2020 2020 2020 2020  r path:.        
-000142a0: 3a72 7479 7065 3a20 7374 720a 2020 2020  :rtype: str.    
-000142b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000142c0: 7265 7475 726e 206f 732e 7061 7468 2e69  return os.path.i
-000142d0: 7366 696c 6528 7061 7468 2920 616e 6420  sfile(path) and 
-000142e0: 6f73 2e61 6363 6573 7328 7061 7468 2c20  os.access(path, 
-000142f0: 6f73 2e58 5f4f 4b29 0a0a 2020 2020 6670  os.X_OK)..    fp
-00014300: 6174 682c 2066 6e61 6d65 203d 206f 732e  ath, fname = os.
-00014310: 7061 7468 2e73 706c 6974 2870 726f 6772  path.split(progr
-00014320: 616d 290a 2020 2020 6966 2066 7061 7468  am).    if fpath
-00014330: 3a0a 2020 2020 2020 2020 6966 2069 735f  :.        if is_
-00014340: 6578 6528 7072 6f67 7261 6d29 3a0a 2020  exe(program):.  
-00014350: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00014360: 2070 726f 6772 616d 0a20 2020 2065 6c73   program.    els
-00014370: 653a 0a20 2020 2020 2020 2066 6f72 2070  e:.        for p
-00014380: 6174 6820 696e 206f 732e 656e 7669 726f  ath in os.enviro
-00014390: 6e5b 2250 4154 4822 5d2e 7370 6c69 7428  n["PATH"].split(
-000143a0: 6f73 2e70 6174 6873 6570 293a 0a20 2020  os.pathsep):.   
-000143b0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-000143c0: 7061 7468 2e73 7472 6970 2827 2227 290a  path.strip('"').
-000143d0: 2020 2020 2020 2020 2020 2020 6578 655f              exe_
-000143e0: 6669 6c65 203d 206f 732e 7061 7468 2e6a  file = os.path.j
-000143f0: 6f69 6e28 7061 7468 2c20 7072 6f67 7261  oin(path, progra
-00014400: 6d29 0a20 2020 2020 2020 2020 2020 2069  m).            i
-00014410: 6620 6973 5f65 7865 2865 7865 5f66 696c  f is_exe(exe_fil
-00014420: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00014430: 2020 2020 7265 7475 726e 2065 7865 5f66      return exe_f
-00014440: 696c 650a 0a20 2020 2072 6574 7572 6e20  ile..    return 
-00014450: 4e6f 6e65 0a0a 0a64 6566 2077 6869 6368  None...def which
-00014460: 5f70 6970 2829 3a0a 2020 2020 2222 220a  _pip():.    """.
-00014470: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
-00014480: 2020 2020 3a72 6574 7572 6e3a 2070 6174      :return: pat
-00014490: 6820 746f 2070 6970 2066 6f72 2074 6865  h to pip for the
-000144a0: 2063 7572 7265 6e74 2050 7974 686f 6e20   current Python 
-000144b0: 656e 760a 2020 2020 2222 220a 2020 2020  env.    """.    
-000144c0: 2320 4265 666f 7265 2077 6520 6c6f 6f6b  # Before we look
-000144d0: 2061 6e79 7768 6572 6520 696e 2050 4154   anywhere in PAT
-000144e0: 482c 2063 6865 636b 2069 6620 7468 6572  H, check if ther
-000144f0: 6520 6973 2073 6f6d 6520 7069 7020 616c  e is some pip al
-00014500: 6f6e 6773 6964 6520 746f 2074 6865 2050  ongside to the P
-00014510: 7974 686f 6e20 6578 6563 7574 6162 6c65  ython executable
-00014520: 2e0a 2020 2020 2320 5468 6973 206d 6967  ..    # This mig
-00014530: 6874 2062 6520 6d6f 7265 2072 656c 6961  ht be more relia
-00014540: 626c 652e 0a20 2020 2070 7920 3d20 7379  ble..    py = sy
-00014550: 732e 6578 6563 7574 6162 6c65 0a20 2020  s.executable.   
-00014560: 2064 6972 5f6e 616d 652c 2062 6173 656e   dir_name, basen
-00014570: 616d 6520 3d20 7079 2e72 7370 6c69 7428  ame = py.rsplit(
-00014580: 222f 222c 2031 290a 2020 2020 6966 2062  "/", 1).    if b
-00014590: 6173 656e 616d 652e 7374 6172 7473 7769  asename.startswi
-000145a0: 7468 2822 7079 7468 6f6e 2229 3a0a 2020  th("python"):.  
-000145b0: 2020 2020 2020 706f 7374 6669 7820 3d20        postfix = 
-000145c0: 6261 7365 6e61 6d65 5b6c 656e 2822 7079  basename[len("py
-000145d0: 7468 6f6e 2229 203a 5d0a 2020 2020 2020  thon") :].      
-000145e0: 2020 7069 705f 7061 7468 203d 2022 2573    pip_path = "%s
-000145f0: 2f70 6970 2573 2220 2520 2864 6972 5f6e  /pip%s" % (dir_n
-00014600: 616d 652c 2070 6f73 7466 6978 290a 2020  ame, postfix).  
-00014610: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00014620: 2e65 7869 7374 7328 7069 705f 7061 7468  .exists(pip_path
-00014630: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00014640: 6574 7572 6e20 7069 705f 7061 7468 0a20  eturn pip_path. 
-00014650: 2020 2023 2047 656e 6572 6963 2066 616c     # Generic fal
-00014660: 6c62 6163 6b2e 0a20 2020 2070 6970 5f70  lback..    pip_p
-00014670: 6174 6820 3d20 7768 6963 6828 2270 6970  ath = which("pip
-00014680: 2229 0a20 2020 2072 6574 7572 6e20 7069  ").    return pi
-00014690: 705f 7061 7468 0a0a 0a64 6566 2070 6970  p_path...def pip
-000146a0: 5f69 6e73 7461 6c6c 282a 706b 675f 6e61  _install(*pkg_na
-000146b0: 6d65 7329 3a0a 2020 2020 2222 220a 2020  mes):.    """.  
-000146c0: 2020 496e 7374 616c 6c20 7061 636b 6167    Install packag
-000146d0: 6573 2076 6961 2070 6970 2066 6f72 2074  es via pip for t
-000146e0: 6865 2063 7572 7265 6e74 2050 7974 686f  he current Pytho
-000146f0: 6e20 656e 762e 0a0a 2020 2020 3a70 6172  n env...    :par
-00014700: 616d 2073 7472 2070 6b67 5f6e 616d 6573  am str pkg_names
-00014710: 3a0a 2020 2020 2222 220a 2020 2020 7079  :.    """.    py
-00014720: 203d 2073 7973 2e65 7865 6375 7461 626c   = sys.executabl
-00014730: 650a 2020 2020 7069 705f 7061 7468 203d  e.    pip_path =
-00014740: 2077 6869 6368 5f70 6970 2829 0a20 2020   which_pip().   
-00014750: 2070 7269 6e74 2822 5069 7020 696e 7374   print("Pip inst
-00014760: 616c 6c22 2c20 2a70 6b67 5f6e 616d 6573  all", *pkg_names
-00014770: 290a 2020 2020 696e 5f76 6972 7475 616c  ).    in_virtual
-00014780: 5f65 6e76 203d 2068 6173 6174 7472 2873  _env = hasattr(s
-00014790: 7973 2c20 2272 6561 6c5f 7072 6566 6978  ys, "real_prefix
-000147a0: 2229 2020 2320 6874 7470 733a 2f2f 7374  ")  # https://st
-000147b0: 6163 6b6f 7665 7266 6c6f 772e 636f 6d2f  ackoverflow.com/
-000147c0: 7175 6573 7469 6f6e 732f 3138 3731 3534  questions/187154
-000147d0: 392f 0a20 2020 2063 6d64 203d 205b 7079  9/.    cmd = [py
-000147e0: 2c20 7069 705f 7061 7468 2c20 2269 6e73  , pip_path, "ins
-000147f0: 7461 6c6c 225d 0a20 2020 2069 6620 6e6f  tall"].    if no
-00014800: 7420 696e 5f76 6972 7475 616c 5f65 6e76  t in_virtual_env
-00014810: 3a0a 2020 2020 2020 2020 636d 6420 2b3d  :.        cmd +=
-00014820: 205b 222d 2d75 7365 7222 5d0a 2020 2020   ["--user"].    
-00014830: 636d 6420 2b3d 206c 6973 7428 706b 675f  cmd += list(pkg_
-00014840: 6e61 6d65 7329 0a20 2020 2070 7269 6e74  names).    print
-00014850: 2822 2420 2573 2220 2520 2220 222e 6a6f  ("$ %s" % " ".jo
-00014860: 696e 2863 6d64 2929 0a20 2020 2073 7562  in(cmd)).    sub
-00014870: 7072 6f63 6573 732e 6368 6563 6b5f 6361  process.check_ca
-00014880: 6c6c 2863 6d64 2c20 6377 643d 222f 2229  ll(cmd, cwd="/")
-00014890: 0a20 2020 205f 7069 705f 696e 7374 616c  .    _pip_instal
-000148a0: 6c65 645f 7061 636b 6167 6573 2e63 6c65  led_packages.cle
-000148b0: 6172 2829 2020 2320 666f 7263 6520 7265  ar()  # force re
-000148c0: 6c6f 6164 0a0a 0a5f 7069 705f 696e 7374  load..._pip_inst
-000148d0: 616c 6c65 645f 7061 636b 6167 6573 203d  alled_packages =
-000148e0: 2073 6574 2829 0a0a 0a64 6566 2070 6970   set()...def pip
-000148f0: 5f63 6865 636b 5f69 735f 696e 7374 616c  _check_is_instal
-00014900: 6c65 6428 706b 675f 6e61 6d65 293a 0a20  led(pkg_name):. 
-00014910: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00014920: 6d20 7374 7220 706b 675f 6e61 6d65 3a20  m str pkg_name: 
-00014930: 7769 7468 6f75 7420 7665 7273 696f 6e2c  without version,
-00014940: 2065 2e67 2e20 6a75 7374 2022 7465 6e73   e.g. just "tens
-00014950: 6f72 666c 6f77 222c 206f 7220 7769 7468  orflow", or with
-00014960: 2076 6572 7369 6f6e 2c20 652e 672e 2022   version, e.g. "
-00014970: 7465 6e73 6f72 666c 6f77 3d3d 312e 322e  tensorflow==1.2.
-00014980: 3322 0a20 2020 203a 7274 7970 653a 2062  3".    :rtype: b
-00014990: 6f6f 6c0a 2020 2020 2222 220a 2020 2020  ool.    """.    
-000149a0: 6966 206e 6f74 205f 7069 705f 696e 7374  if not _pip_inst
-000149b0: 616c 6c65 645f 7061 636b 6167 6573 3a0a  alled_packages:.
-000149c0: 2020 2020 2020 2020 7079 203d 2073 7973          py = sys
-000149d0: 2e65 7865 6375 7461 626c 650a 2020 2020  .executable.    
-000149e0: 2020 2020 7069 705f 7061 7468 203d 2077      pip_path = w
-000149f0: 6869 6368 5f70 6970 2829 0a20 2020 2020  hich_pip().     
-00014a00: 2020 2063 6d64 203d 205b 7079 2c20 7069     cmd = [py, pi
-00014a10: 705f 7061 7468 2c20 2266 7265 657a 6522  p_path, "freeze"
-00014a20: 5d0a 2020 2020 2020 2020 666f 7220 6c69  ].        for li
-00014a30: 6e65 2069 6e20 7379 735f 6578 6563 5f6f  ne in sys_exec_o
-00014a40: 7574 282a 636d 6429 2e73 706c 6974 6c69  ut(*cmd).splitli
-00014a50: 6e65 7328 293a 0a20 2020 2020 2020 2020  nes():.         
-00014a60: 2020 2069 6620 6c69 6e65 2061 6e64 2022     if line and "
-00014a70: 3d3d 2220 696e 206c 696e 653a 0a20 2020  ==" in line:.   
-00014a80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014a90: 223d 3d22 206e 6f74 2069 6e20 706b 675f  "==" not in pkg_
-00014aa0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-00014ab0: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
-00014ac0: 206c 696e 655b 3a20 6c69 6e65 2e69 6e64   line[: line.ind
-00014ad0: 6578 2822 3d3d 2229 5d0a 2020 2020 2020  ex("==")].      
-00014ae0: 2020 2020 2020 2020 2020 5f70 6970 5f69            _pip_i
-00014af0: 6e73 7461 6c6c 6564 5f70 6163 6b61 6765  nstalled_package
-00014b00: 732e 6164 6428 6c69 6e65 290a 2020 2020  s.add(line).    
-00014b10: 7265 7475 726e 2070 6b67 5f6e 616d 6520  return pkg_name 
-00014b20: 696e 205f 7069 705f 696e 7374 616c 6c65  in _pip_installe
-00014b30: 645f 7061 636b 6167 6573 0a0a 0a5f 6f72  d_packages..._or
-00014b40: 6967 696e 616c 5f65 7865 6376 203d 204e  iginal_execv = N
-00014b50: 6f6e 650a 5f6f 7269 6769 6e61 6c5f 6578  one._original_ex
-00014b60: 6563 7665 203d 204e 6f6e 650a 5f6f 7269  ecve = None._ori
-00014b70: 6769 6e61 6c5f 6578 6563 7670 6520 3d20  ginal_execvpe = 
-00014b80: 4e6f 6e65 0a0a 0a64 6566 206f 7665 7277  None...def overw
-00014b90: 7269 7465 5f6f 735f 6578 6563 2870 7265  rite_os_exec(pre
-00014ba0: 6669 785f 6172 6773 293a 0a20 2020 2022  fix_args):.    "
-00014bb0: 2222 0a20 2020 203a 7061 7261 6d20 6c69  "".    :param li
-00014bc0: 7374 5b73 7472 5d20 7072 6566 6978 5f61  st[str] prefix_a
-00014bd0: 7267 733a 0a20 2020 2022 2222 0a20 2020  rgs:.    """.   
-00014be0: 2067 6c6f 6261 6c20 5f6f 7269 6769 6e61   global _origina
-00014bf0: 6c5f 6578 6563 762c 205f 6f72 6967 696e  l_execv, _origin
-00014c00: 616c 5f65 7865 6376 652c 205f 6f72 6967  al_execve, _orig
-00014c10: 696e 616c 5f65 7865 6376 7065 0a20 2020  inal_execvpe.   
-00014c20: 2069 6620 6e6f 7420 5f6f 7269 6769 6e61   if not _origina
-00014c30: 6c5f 6578 6563 763a 0a20 2020 2020 2020  l_execv:.       
-00014c40: 205f 6f72 6967 696e 616c 5f65 7865 6376   _original_execv
-00014c50: 203d 206f 732e 6578 6563 760a 2020 2020   = os.execv.    
-00014c60: 6966 206e 6f74 205f 6f72 6967 696e 616c  if not _original
-00014c70: 5f65 7865 6376 653a 0a20 2020 2020 2020  _execve:.       
-00014c80: 205f 6f72 6967 696e 616c 5f65 7865 6376   _original_execv
-00014c90: 6520 3d20 6f73 2e65 7865 6376 650a 2020  e = os.execve.  
-00014ca0: 2020 6966 206e 6f74 205f 6f72 6967 696e    if not _origin
-00014cb0: 616c 5f65 7865 6376 7065 3a0a 2020 2020  al_execvpe:.    
-00014cc0: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
-00014cd0: 6f6e 2050 7950 726f 7465 6374 6564 4d65  on PyProtectedMe
-00014ce0: 6d62 6572 2c50 7955 6e72 6573 6f6c 7665  mber,PyUnresolve
-00014cf0: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
-00014d00: 2020 2020 5f6f 7269 6769 6e61 6c5f 6578      _original_ex
-00014d10: 6563 7670 6520 3d20 6f73 2e5f 6578 6563  ecvpe = os._exec
-00014d20: 7670 650a 0a20 2020 2023 206e 6f69 6e73  vpe..    # noins
-00014d30: 7065 6374 696f 6e20 5079 556e 7573 6564  pection PyUnused
-00014d40: 4c6f 6361 6c0a 2020 2020 6465 6620 7772  Local.    def wr
-00014d50: 6170 7065 645f 6578 6563 7670 6528 6669  apped_execvpe(fi
-00014d60: 6c65 2c20 6172 6773 2c20 656e 763d 4e6f  le, args, env=No
-00014d70: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00014d80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00014d90: 6669 6c65 3a0a 2020 2020 2020 2020 3a70  file:.        :p
-00014da0: 6172 616d 206c 6973 745b 7374 725d 7c74  aram list[str]|t
-00014db0: 7570 6c65 5b73 7472 5d20 6172 6773 3a0a  uple[str] args:.
-00014dc0: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
-00014dd0: 6963 745b 7374 725d 2065 6e76 3a0a 2020  ict[str] env:.  
-00014de0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014df0: 2020 6e65 775f 6172 6773 203d 2070 7265    new_args = pre
-00014e00: 6669 785f 6172 6773 202b 205b 7768 6963  fix_args + [whic
-00014e10: 6828 6172 6773 5b30 5d29 5d20 2b20 6172  h(args[0])] + ar
-00014e20: 6773 5b31 3a5d 0a20 2020 2020 2020 2073  gs[1:].        s
-00014e30: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00014e40: 2224 2025 735c 6e22 2025 2022 2022 2e6a  "$ %s\n" % " ".j
-00014e50: 6f69 6e28 6e65 775f 6172 6773 2929 0a20  oin(new_args)). 
-00014e60: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-00014e70: 722e 666c 7573 6828 290a 2020 2020 2020  r.flush().      
-00014e80: 2020 5f6f 7269 6769 6e61 6c5f 6578 6563    _original_exec
-00014e90: 7670 6528 6669 6c65 3d70 7265 6669 785f  vpe(file=prefix_
-00014ea0: 6172 6773 5b30 5d2c 2061 7267 733d 6e65  args[0], args=ne
-00014eb0: 775f 6172 6773 2c20 656e 763d 656e 7629  w_args, env=env)
-00014ec0: 0a0a 2020 2020 6465 6620 6578 6563 7628  ..    def execv(
-00014ed0: 7061 7468 2c20 6172 6773 293a 0a20 2020  path, args):.   
-00014ee0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014ef0: 203a 7061 7261 6d20 7374 7220 7061 7468   :param str path
-00014f00: 3a0a 2020 2020 2020 2020 3a70 6172 616d  :.        :param
-00014f10: 206c 6973 745b 7374 725d 7c74 7570 6c65   list[str]|tuple
-00014f20: 5b73 7472 5d20 6172 6773 3a0a 2020 2020  [str] args:.    
-00014f30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014f40: 6966 2061 7267 735b 3a20 6c65 6e28 7072  if args[: len(pr
-00014f50: 6566 6978 5f61 7267 7329 5d20 3d3d 2070  efix_args)] == p
-00014f60: 7265 6669 785f 6172 6773 3a0a 2020 2020  refix_args:.    
-00014f70: 2020 2020 2020 2020 5f6f 7269 6769 6e61          _origina
-00014f80: 6c5f 6578 6563 7628 7061 7468 2c20 6172  l_execv(path, ar
-00014f90: 6773 290a 2020 2020 2020 2020 656c 7365  gs).        else
-00014fa0: 3a0a 2020 2020 2020 2020 2020 2020 7772  :.            wr
-00014fb0: 6170 7065 645f 6578 6563 7670 6528 7061  apped_execvpe(pa
-00014fc0: 7468 2c20 6172 6773 290a 0a20 2020 2064  th, args)..    d
-00014fd0: 6566 2065 7865 6376 6528 7061 7468 2c20  ef execve(path, 
-00014fe0: 6172 6773 2c20 656e 7629 3a0a 2020 2020  args, env):.    
-00014ff0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015000: 3a70 6172 616d 2073 7472 2070 6174 683a  :param str path:
-00015010: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00015020: 6c69 7374 5b73 7472 5d7c 7475 706c 655b  list[str]|tuple[
-00015030: 7374 725d 2061 7267 733a 0a20 2020 2020  str] args:.     
-00015040: 2020 203a 7061 7261 6d20 6469 6374 5b73     :param dict[s
-00015050: 7472 5d20 656e 763a 0a20 2020 2020 2020  tr] env:.       
-00015060: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00015070: 6172 6773 5b3a 206c 656e 2870 7265 6669  args[: len(prefi
-00015080: 785f 6172 6773 295d 203d 3d20 7072 6566  x_args)] == pref
-00015090: 6978 5f61 7267 733a 0a20 2020 2020 2020  ix_args:.       
-000150a0: 2020 2020 205f 6f72 6967 696e 616c 5f65       _original_e
-000150b0: 7865 6376 6528 7061 7468 2c20 6172 6773  xecve(path, args
-000150c0: 2c20 656e 7629 0a20 2020 2020 2020 2065  , env).        e
-000150d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000150e0: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
-000150f0: 2870 6174 682c 2061 7267 732c 2065 6e76  (path, args, env
-00015100: 290a 0a20 2020 2064 6566 2065 7865 636c  )..    def execl
-00015110: 2866 696c 652c 202a 6172 6773 293a 0a20  (file, *args):. 
-00015120: 2020 2020 2020 2022 2222 6578 6563 6c28         """execl(
-00015130: 6669 6c65 2c20 2a61 7267 7329 0a0a 2020  file, *args)..  
-00015140: 2020 2020 2020 4578 6563 7574 6520 7468        Execute th
-00015150: 6520 6578 6563 7574 6162 6c65 2066 696c  e executable fil
-00015160: 6520 7769 7468 2061 7267 756d 656e 7420  e with argument 
-00015170: 6c69 7374 2061 7267 732c 2072 6570 6c61  list args, repla
-00015180: 6369 6e67 2074 6865 0a20 2020 2020 2020  cing the.       
-00015190: 2063 7572 7265 6e74 2070 726f 6365 7373   current process
-000151a0: 2e22 2222 0a20 2020 2020 2020 206f 732e  .""".        os.
-000151b0: 6578 6563 7628 6669 6c65 2c20 6172 6773  execv(file, args
-000151c0: 290a 0a20 2020 2064 6566 2065 7865 636c  )..    def execl
-000151d0: 6528 6669 6c65 2c20 2a61 7267 7329 3a0a  e(file, *args):.
-000151e0: 2020 2020 2020 2020 2222 2265 7865 636c          """execl
-000151f0: 6528 6669 6c65 2c20 2a61 7267 732c 2065  e(file, *args, e
-00015200: 6e76 290a 0a20 2020 2020 2020 2045 7865  nv)..        Exe
-00015210: 6375 7465 2074 6865 2065 7865 6375 7461  cute the executa
-00015220: 626c 6520 6669 6c65 2077 6974 6820 6172  ble file with ar
-00015230: 6775 6d65 6e74 206c 6973 7420 6172 6773  gument list args
-00015240: 2061 6e64 0a20 2020 2020 2020 2065 6e76   and.        env
-00015250: 6972 6f6e 6d65 6e74 2065 6e76 2c20 7265  ironment env, re
-00015260: 706c 6163 696e 6720 7468 6520 6375 7272  placing the curr
-00015270: 656e 7420 7072 6f63 6573 732e 2222 220a  ent process.""".
-00015280: 2020 2020 2020 2020 656e 7620 3d20 6172          env = ar
-00015290: 6773 5b2d 315d 0a20 2020 2020 2020 206f  gs[-1].        o
-000152a0: 732e 6578 6563 7665 2866 696c 652c 2061  s.execve(file, a
-000152b0: 7267 735b 3a2d 315d 2c20 656e 7629 0a0a  rgs[:-1], env)..
-000152c0: 2020 2020 6465 6620 6578 6563 6c70 2866      def execlp(f
-000152d0: 696c 652c 202a 6172 6773 293a 0a20 2020  ile, *args):.   
-000152e0: 2020 2020 2022 2222 6578 6563 6c70 2866       """execlp(f
-000152f0: 696c 652c 202a 6172 6773 290a 0a20 2020  ile, *args)..   
-00015300: 2020 2020 2045 7865 6375 7465 2074 6865       Execute the
-00015310: 2065 7865 6375 7461 626c 6520 6669 6c65   executable file
-00015320: 2028 7768 6963 6820 6973 2073 6561 7263   (which is searc
-00015330: 6865 6420 666f 7220 616c 6f6e 6720 2450  hed for along $P
-00015340: 4154 4829 0a20 2020 2020 2020 2077 6974  ATH).        wit
-00015350: 6820 6172 6775 6d65 6e74 206c 6973 7420  h argument list 
-00015360: 6172 6773 2c20 7265 706c 6163 696e 6720  args, replacing 
-00015370: 7468 6520 6375 7272 656e 7420 7072 6f63  the current proc
-00015380: 6573 732e 2222 220a 2020 2020 2020 2020  ess.""".        
-00015390: 6f73 2e65 7865 6376 7028 6669 6c65 2c20  os.execvp(file, 
-000153a0: 6172 6773 290a 0a20 2020 2064 6566 2065  args)..    def e
-000153b0: 7865 636c 7065 2866 696c 652c 202a 6172  xeclpe(file, *ar
-000153c0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-000153d0: 6578 6563 6c70 6528 6669 6c65 2c20 2a61  execlpe(file, *a
-000153e0: 7267 732c 2065 6e76 290a 0a20 2020 2020  rgs, env)..     
-000153f0: 2020 2045 7865 6375 7465 2074 6865 2065     Execute the e
-00015400: 7865 6375 7461 626c 6520 6669 6c65 2028  xecutable file (
-00015410: 7768 6963 6820 6973 2073 6561 7263 6865  which is searche
-00015420: 6420 666f 7220 616c 6f6e 6720 2450 4154  d for along $PAT
-00015430: 4829 0a20 2020 2020 2020 2077 6974 6820  H).        with 
-00015440: 6172 6775 6d65 6e74 206c 6973 7420 6172  argument list ar
-00015450: 6773 2061 6e64 2065 6e76 6972 6f6e 6d65  gs and environme
-00015460: 6e74 2065 6e76 2c20 7265 706c 6163 696e  nt env, replacin
-00015470: 6720 7468 6520 6375 7272 656e 740a 2020  g the current.  
-00015480: 2020 2020 2020 7072 6f63 6573 732e 2222        process.""
-00015490: 220a 2020 2020 2020 2020 656e 7620 3d20  ".        env = 
-000154a0: 6172 6773 5b2d 315d 0a20 2020 2020 2020  args[-1].       
-000154b0: 206f 732e 6578 6563 7670 6528 6669 6c65   os.execvpe(file
-000154c0: 2c20 6172 6773 5b3a 2d31 5d2c 2065 6e76  , args[:-1], env
-000154d0: 290a 0a20 2020 2064 6566 2065 7865 6376  )..    def execv
-000154e0: 7028 6669 6c65 2c20 6172 6773 293a 0a20  p(file, args):. 
-000154f0: 2020 2020 2020 2022 2222 6578 6563 7670         """execvp
-00015500: 2866 696c 652c 2061 7267 7329 0a0a 2020  (file, args)..  
-00015510: 2020 2020 2020 4578 6563 7574 6520 7468        Execute th
-00015520: 6520 6578 6563 7574 6162 6c65 2066 696c  e executable fil
-00015530: 6520 2877 6869 6368 2069 7320 7365 6172  e (which is sear
-00015540: 6368 6564 2066 6f72 2061 6c6f 6e67 2024  ched for along $
-00015550: 5041 5448 290a 2020 2020 2020 2020 7769  PATH).        wi
-00015560: 7468 2061 7267 756d 656e 7420 6c69 7374  th argument list
-00015570: 2061 7267 732c 2072 6570 6c61 6369 6e67   args, replacing
-00015580: 2074 6865 2063 7572 7265 6e74 2070 726f   the current pro
-00015590: 6365 7373 2e0a 2020 2020 2020 2020 6172  cess..        ar
-000155a0: 6773 206d 6179 2062 6520 6120 6c69 7374  gs may be a list
-000155b0: 206f 7220 7475 706c 6520 6f66 2073 7472   or tuple of str
-000155c0: 696e 6773 2e22 2222 0a20 2020 2020 2020  ings.""".       
-000155d0: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
-000155e0: 2866 696c 652c 2061 7267 7329 0a0a 2020  (file, args)..  
-000155f0: 2020 6465 6620 6578 6563 7670 6528 6669    def execvpe(fi
-00015600: 6c65 2c20 6172 6773 2c20 656e 7629 3a0a  le, args, env):.
-00015610: 2020 2020 2020 2020 2222 2265 7865 6376          """execv
-00015620: 7065 2866 696c 652c 2061 7267 732c 2065  pe(file, args, e
-00015630: 6e76 290a 0a20 2020 2020 2020 2045 7865  nv)..        Exe
-00015640: 6375 7465 2074 6865 2065 7865 6375 7461  cute the executa
-00015650: 626c 6520 6669 6c65 2028 7768 6963 6820  ble file (which 
-00015660: 6973 2073 6561 7263 6865 6420 666f 7220  is searched for 
-00015670: 616c 6f6e 6720 2450 4154 4829 0a20 2020  along $PATH).   
-00015680: 2020 2020 2077 6974 6820 6172 6775 6d65       with argume
-00015690: 6e74 206c 6973 7420 6172 6773 2061 6e64  nt list args and
-000156a0: 2065 6e76 6972 6f6e 6d65 6e74 2065 6e76   environment env
-000156b0: 202c 2072 6570 6c61 6369 6e67 2074 6865   , replacing the
-000156c0: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
-000156d0: 2070 726f 6365 7373 2e0a 2020 2020 2020   process..      
-000156e0: 2020 6172 6773 206d 6179 2062 6520 6120    args may be a 
-000156f0: 6c69 7374 206f 7220 7475 706c 6520 6f66  list or tuple of
-00015700: 2073 7472 696e 6773 2e22 2222 0a20 2020   strings.""".   
-00015710: 2020 2020 2077 7261 7070 6564 5f65 7865       wrapped_exe
-00015720: 6376 7065 2866 696c 652c 2061 7267 732c  cvpe(file, args,
-00015730: 2065 6e76 290a 0a20 2020 206f 732e 6578   env)..    os.ex
-00015740: 6563 7620 3d20 6578 6563 760a 2020 2020  ecv = execv.    
-00015750: 6f73 2e65 7865 6376 6520 3d20 6578 6563  os.execve = exec
-00015760: 7665 0a20 2020 206f 732e 6578 6563 6c20  ve.    os.execl 
-00015770: 3d20 6578 6563 6c0a 2020 2020 6f73 2e65  = execl.    os.e
-00015780: 7865 636c 6520 3d20 6578 6563 6c65 0a20  xecle = execle. 
-00015790: 2020 206f 732e 6578 6563 6c70 203d 2065     os.execlp = e
-000157a0: 7865 636c 700a 2020 2020 6f73 2e65 7865  xeclp.    os.exe
-000157b0: 636c 7065 203d 2065 7865 636c 7065 0a20  clpe = execlpe. 
-000157c0: 2020 206f 732e 6578 6563 7670 203d 2065     os.execvp = e
-000157d0: 7865 6376 700a 2020 2020 6f73 2e65 7865  xecvp.    os.exe
-000157e0: 6376 7065 203d 2065 7865 6376 7065 0a20  cvpe = execvpe. 
-000157f0: 2020 206f 732e 5f65 7865 6376 7065 203d     os._execvpe =
-00015800: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
-00015810: 0a0a 0a64 6566 2067 6574 5f6c 7362 5f72  ...def get_lsb_r
-00015820: 656c 6561 7365 2829 3a0a 2020 2020 2222  elease():.    ""
-00015830: 220a 2020 2020 3a72 6574 7572 6e3a 2060  ".    :return: `
-00015840: 602f 6574 632f 6c73 622d 7265 6c65 6173  `/etc/lsb-releas
-00015850: 6560 6020 7061 7273 6564 2061 7320 6120  e`` parsed as a 
-00015860: 6469 6374 0a20 2020 203a 7274 7970 653a  dict.    :rtype:
-00015870: 2064 6963 745b 7374 722c 7374 725d 0a20   dict[str,str]. 
-00015880: 2020 2022 2222 0a20 2020 2064 203d 207b     """.    d = {
-00015890: 7d0a 2020 2020 666f 7220 6c69 6e65 2069  }.    for line i
-000158a0: 6e20 6f70 656e 2822 2f65 7463 2f6c 7362  n open("/etc/lsb
-000158b0: 2d72 656c 6561 7365 2229 2e72 6561 6428  -release").read(
-000158c0: 292e 7370 6c69 746c 696e 6573 2829 3a0a  ).splitlines():.
-000158d0: 2020 2020 2020 2020 6b2c 2076 203d 206c          k, v = l
-000158e0: 696e 652e 7370 6c69 7428 223d 222c 2031  ine.split("=", 1
-000158f0: 290a 2020 2020 2020 2020 6966 2076 5b30  ).        if v[0
-00015900: 5d20 3d3d 2076 5b2d 315d 203d 3d20 2722  ] == v[-1] == '"
-00015910: 273a 0a20 2020 2020 2020 2020 2020 2076  ':.            v
-00015920: 203d 2076 5b31 3a2d 315d 0a20 2020 2020   = v[1:-1].     
-00015930: 2020 2064 5b6b 5d20 3d20 760a 2020 2020     d[k] = v.    
-00015940: 7265 7475 726e 2064 0a0a 0a64 6566 2067  return d...def g
-00015950: 6574 5f75 6275 6e74 755f 6d61 6a6f 725f  et_ubuntu_major_
-00015960: 7665 7273 696f 6e28 293a 0a20 2020 2022  version():.    "
-00015970: 2222 0a20 2020 203a 7274 7970 653a 2069  "".    :rtype: i
-00015980: 6e74 7c4e 6f6e 650a 2020 2020 2222 220a  nt|None.    """.
-00015990: 2020 2020 6420 3d20 6765 745f 6c73 625f      d = get_lsb_
-000159a0: 7265 6c65 6173 6528 290a 2020 2020 6966  release().    if
-000159b0: 2064 5b22 4449 5354 5249 425f 4944 225d   d["DISTRIB_ID"]
-000159c0: 2021 3d20 2255 6275 6e74 7522 3a0a 2020   != "Ubuntu":.  
-000159d0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-000159e0: 650a 2020 2020 7265 7475 726e 2069 6e74  e.    return int
-000159f0: 2866 6c6f 6174 2864 5b22 4449 5354 5249  (float(d["DISTRI
-00015a00: 425f 5245 4c45 4153 4522 5d29 290a 0a0a  B_RELEASE"]))...
-00015a10: 6465 6620 6175 746f 5f70 7265 6669 785f  def auto_prefix_
-00015a20: 6f73 5f65 7865 635f 7072 6566 6978 5f75  os_exec_prefix_u
-00015a30: 6275 6e74 7528 7072 6566 6978 5f61 7267  buntu(prefix_arg
-00015a40: 732c 2075 6275 6e74 755f 6d69 6e5f 7665  s, ubuntu_min_ve
-00015a50: 7273 696f 6e3d 3136 293a 0a20 2020 2022  rsion=16):.    "
-00015a60: 2222 0a20 2020 203a 7061 7261 6d20 6c69  "".    :param li
-00015a70: 7374 5b73 7472 5d20 7072 6566 6978 5f61  st[str] prefix_a
-00015a80: 7267 733a 0a20 2020 203a 7061 7261 6d20  rgs:.    :param 
-00015a90: 696e 7420 7562 756e 7475 5f6d 696e 5f76  int ubuntu_min_v
-00015aa0: 6572 7369 6f6e 3a0a 0a20 2020 2045 7861  ersion:..    Exa
-00015ab0: 6d70 6c65 2075 7361 6765 3a0a 2020 2020  mple usage:.    
-00015ac0: 2020 6175 746f 5f70 7265 6669 785f 6f73    auto_prefix_os
-00015ad0: 5f65 7865 635f 7072 6566 6978 5f75 6275  _exec_prefix_ubu
-00015ae0: 6e74 7528 5b22 2f75 2f7a 6579 6572 2f74  ntu(["/u/zeyer/t
-00015af0: 6f6f 6c73 2f67 6c69 6263 3231 372f 6c64  ools/glibc217/ld
-00015b00: 2d6c 696e 7578 2d78 3836 2d36 342e 736f  -linux-x86-64.so
-00015b10: 2e32 225d 290a 2020 2020 2222 220a 2020  .2"]).    """.  
-00015b20: 2020 7562 756e 7475 5f76 6572 7369 6f6e    ubuntu_version
-00015b30: 203d 2067 6574 5f75 6275 6e74 755f 6d61   = get_ubuntu_ma
-00015b40: 6a6f 725f 7665 7273 696f 6e28 290a 2020  jor_version().  
-00015b50: 2020 6966 2075 6275 6e74 755f 7665 7273    if ubuntu_vers
-00015b60: 696f 6e20 6973 204e 6f6e 653a 0a20 2020  ion is None:.   
-00015b70: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00015b80: 6966 2075 6275 6e74 755f 7665 7273 696f  if ubuntu_versio
-00015b90: 6e20 3e3d 2075 6275 6e74 755f 6d69 6e5f  n >= ubuntu_min_
-00015ba0: 7665 7273 696f 6e3a 0a20 2020 2020 2020  version:.       
-00015bb0: 2072 6574 7572 6e0a 2020 2020 7072 696e   return.    prin
-00015bc0: 7428 2259 6f75 2061 7265 2072 756e 6e69  t("You are runni
-00015bd0: 6e67 2055 6275 6e74 7520 2569 2c20 7468  ng Ubuntu %i, th
-00015be0: 7573 2077 6520 7072 6566 6978 2061 6c6c  us we prefix all
-00015bf0: 206f 732e 6578 6563 2077 6974 6820 2573   os.exec with %s
-00015c00: 2e22 2025 2028 7562 756e 7475 5f76 6572  ." % (ubuntu_ver
-00015c10: 7369 6f6e 2c20 7072 6566 6978 5f61 7267  sion, prefix_arg
-00015c20: 7329 290a 2020 2020 6173 7365 7274 206f  s)).    assert o
-00015c30: 732e 7061 7468 2e65 7869 7374 7328 7072  s.path.exists(pr
-00015c40: 6566 6978 5f61 7267 735b 305d 290a 2020  efix_args[0]).  
-00015c50: 2020 6f76 6572 7772 6974 655f 6f73 5f65    overwrite_os_e
-00015c60: 7865 6328 7072 6566 6978 5f61 7267 733d  xec(prefix_args=
-00015c70: 7072 6566 6978 5f61 7267 7329 0a0a 0a64  prefix_args)...d
-00015c80: 6566 2063 6c65 616e 7570 5f65 6e76 5f76  ef cleanup_env_v
-00015c90: 6172 5f70 6174 6828 656e 765f 7661 722c  ar_path(env_var,
-00015ca0: 2070 6174 685f 7072 6566 6978 293a 0a20   path_prefix):. 
-00015cb0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00015cc0: 6d20 7374 7220 656e 765f 7661 723a 2065  m str env_var: e
-00015cd0: 2e67 2e20 224c 445f 4c49 4252 4152 595f  .g. "LD_LIBRARY_
-00015ce0: 5041 5448 220a 2020 2020 3a70 6172 616d  PATH".    :param
-00015cf0: 2073 7472 2070 6174 685f 7072 6566 6978   str path_prefix
-00015d00: 3a0a 0a20 2020 2057 696c 6c20 7265 6d6f  :..    Will remo
-00015d10: 7665 2061 6c6c 2070 6174 6873 2069 6e20  ve all paths in 
-00015d20: 6f73 2e65 6e76 6972 6f6e 5b65 6e76 5f76  os.environ[env_v
-00015d30: 6172 5d20 7768 6963 6820 6172 6520 7072  ar] which are pr
-00015d40: 6566 6978 6564 2077 6974 6820 7061 7468  efixed with path
-00015d50: 5f70 7265 6669 782e 0a20 2020 2022 2222  _prefix..    """
-00015d60: 0a20 2020 2069 6620 656e 765f 7661 7220  .    if env_var 
-00015d70: 6e6f 7420 696e 206f 732e 656e 7669 726f  not in os.enviro
-00015d80: 6e3a 0a20 2020 2020 2020 2072 6574 7572  n:.        retur
-00015d90: 6e0a 2020 2020 7073 203d 206f 732e 656e  n.    ps = os.en
-00015da0: 7669 726f 6e5b 656e 765f 7661 725d 2e73  viron[env_var].s
-00015db0: 706c 6974 2822 3a22 290a 0a20 2020 2064  plit(":")..    d
-00015dc0: 6566 2066 2870 293a 0a20 2020 2020 2020  ef f(p):.       
-00015dd0: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
-00015de0: 7261 6d20 7374 7220 703a 0a20 2020 2020  ram str p:.     
-00015df0: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
-00015e00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015e10: 2020 2020 6966 2070 203d 3d20 7061 7468      if p == path
-00015e20: 5f70 7265 6669 7820 6f72 2070 2e73 7461  _prefix or p.sta
-00015e30: 7274 7377 6974 6828 7061 7468 5f70 7265  rtswith(path_pre
-00015e40: 6669 7820 2b20 222f 2229 3a0a 2020 2020  fix + "/"):.    
-00015e50: 2020 2020 2020 2020 7072 696e 7428 2252          print("R
-00015e60: 656d 6f76 696e 6720 2573 2066 726f 6d20  emoving %s from 
-00015e70: 2573 2e22 2025 2028 702c 2065 6e76 5f76  %s." % (p, env_v
-00015e80: 6172 2929 0a20 2020 2020 2020 2020 2020  ar)).           
-00015e90: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00015ea0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00015eb0: 650a 0a20 2020 2070 7320 3d20 6669 6c74  e..    ps = filt
-00015ec0: 6572 2866 2c20 7073 290a 2020 2020 6f73  er(f, ps).    os
-00015ed0: 2e65 6e76 6972 6f6e 5b65 6e76 5f76 6172  .environ[env_var
-00015ee0: 5d20 3d20 223a 222e 6a6f 696e 2870 7329  ] = ":".join(ps)
-00015ef0: 0a0a 0a64 6566 2067 6574 5f6c 6f67 696e  ...def get_login
-00015f00: 5f75 7365 726e 616d 6528 293a 0a20 2020  _username():.   
-00015f10: 2022 2222 0a20 2020 203a 7274 7970 653a   """.    :rtype:
-00015f20: 2073 7472 0a20 2020 203a 7265 7475 726e   str.    :return
-00015f30: 3a20 7468 6520 7573 6572 6e61 6d65 206f  : the username o
-00015f40: 6620 7468 6520 6375 7272 656e 7420 7573  f the current us
-00015f50: 6572 2e0a 2020 2020 5573 6520 7468 6973  er..    Use this
-00015f60: 2061 7320 6120 7265 706c 6163 656d 656e   as a replacemen
-00015f70: 7420 666f 7220 6f73 2e67 6574 6c6f 6769  t for os.getlogi
-00015f80: 6e28 292e 0a20 2020 2022 2222 0a20 2020  n()..    """.   
-00015f90: 2069 6d70 6f72 7420 6f73 0a0a 2020 2020   import os..    
-00015fa0: 6966 2073 7973 2e70 6c61 7466 6f72 6d20  if sys.platform 
-00015fb0: 3d3d 2022 7769 6e33 3222 3a0a 2020 2020  == "win32":.    
-00015fc0: 2020 2020 7265 7475 726e 206f 732e 6765      return os.ge
-00015fd0: 746c 6f67 696e 2829 0a20 2020 2069 6d70  tlogin().    imp
-00015fe0: 6f72 7420 7077 640a 0a20 2020 2074 7279  ort pwd..    try
-00015ff0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00016000: 2070 7764 2e67 6574 7077 7569 6428 6f73   pwd.getpwuid(os
-00016010: 2e67 6574 7569 6428 2929 5b30 5d0a 2020  .getuid())[0].  
-00016020: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00016030: 723a 0a20 2020 2020 2020 2023 2070 7764  r:.        # pwd
-00016040: 2e67 6574 7077 7569 6428 2920 6361 6e20  .getpwuid() can 
-00016050: 7468 726f 7720 4b65 7945 7272 6f72 3a20  throw KeyError: 
-00016060: 2767 6574 7077 7569 6428 293a 2075 6964  'getpwuid(): uid
-00016070: 206e 6f74 2066 6f75 6e64 3a20 3132 3334   not found: 1234
-00016080: 3527 0a20 2020 2020 2020 2023 2074 6869  5'.        # thi
-00016090: 7320 6361 6e20 6861 7070 656e 2065 2e67  s can happen e.g
-000160a0: 2e20 696e 2061 2064 6f63 6b65 7220 656e  . in a docker en
-000160b0: 7669 726f 6e6d 656e 7420 7769 7468 206d  vironment with m
-000160c0: 6170 7065 6420 7569 6473 2075 6e6b 6e6f  apped uids unkno
-000160d0: 776e 2074 6f20 7468 6520 646f 636b 6572  wn to the docker
-000160e0: 204f 530a 2020 2020 2020 2020 7265 7475   OS.        retu
-000160f0: 726e 2073 7472 286f 732e 6765 7475 6964  rn str(os.getuid
-00016100: 2829 290a 0a0a 6465 6620 6765 745f 7465  ())...def get_te
-00016110: 6d70 5f64 6972 2829 3a0a 2020 2020 2222  mp_dir():.    ""
-00016120: 220a 2020 2020 3a72 7479 7065 3a20 7374  ".    :rtype: st
-00016130: 720a 2020 2020 3a72 6574 7572 6e3a 2065  r.    :return: e
-00016140: 2e67 2e20 222f 746d 702f 2455 5345 524e  .g. "/tmp/$USERN
-00016150: 414d 4522 0a20 2020 2022 2222 0a20 2020  AME".    """.   
-00016160: 2075 7365 726e 616d 6520 3d20 6765 745f   username = get_
-00016170: 6c6f 6769 6e5f 7573 6572 6e61 6d65 2829  login_username()
-00016180: 0a20 2020 2066 6f72 2065 6e76 6e61 6d65  .    for envname
-00016190: 2069 6e20 5b22 544d 5044 4952 222c 2022   in ["TMPDIR", "
-000161a0: 5445 4d50 222c 2022 544d 5022 5d3a 0a20  TEMP", "TMP"]:. 
-000161b0: 2020 2020 2020 2064 6972 6e61 6d65 203d         dirname =
-000161c0: 206f 732e 6765 7465 6e76 2865 6e76 6e61   os.getenv(envna
-000161d0: 6d65 290a 2020 2020 2020 2020 6966 2064  me).        if d
-000161e0: 6972 6e61 6d65 3a0a 2020 2020 2020 2020  irname:.        
-000161f0: 2020 2020 7265 7475 726e 2022 2573 2f25      return "%s/%
-00016200: 7322 2025 2028 6469 726e 616d 652c 2075  s" % (dirname, u
-00016210: 7365 726e 616d 6529 0a20 2020 2023 202f  sername).    # /
-00016220: 7661 722f 746d 7020 7368 6f75 6c64 2062  var/tmp should b
-00016230: 6520 6d6f 7265 2070 6572 7369 7374 656e  e more persisten
-00016240: 7420 7468 616e 202f 746d 7020 7573 7561  t than /tmp usua
-00016250: 6c6c 792e 0a20 2020 2069 6620 6f73 2e70  lly..    if os.p
-00016260: 6174 682e 6578 6973 7473 2822 2f76 6172  ath.exists("/var
-00016270: 2f74 6d70 2229 3a0a 2020 2020 2020 2020  /tmp"):.        
-00016280: 7265 7475 726e 2022 2f76 6172 2f74 6d70  return "/var/tmp
-00016290: 2f25 7322 2025 2075 7365 726e 616d 650a  /%s" % username.
-000162a0: 2020 2020 7265 7475 726e 2022 2f74 6d70      return "/tmp
-000162b0: 2f25 7322 2025 2075 7365 726e 616d 650a  /%s" % username.
-000162c0: 0a0a 6465 6620 6765 745f 6361 6368 655f  ..def get_cache_
-000162d0: 6469 7228 293a 0a20 2020 2022 2222 0a20  dir():.    """. 
-000162e0: 2020 203a 7265 7475 726e 3a20 7573 6564     :return: used
-000162f0: 2074 6f20 6361 6368 6520 6e6f 6e2d 6372   to cache non-cr
-00016300: 6974 6963 616c 2074 6869 6e67 732e 2062  itical things. b
-00016310: 7920 6465 6661 756c 7420 6765 745f 7465  y default get_te
-00016320: 6d70 5f64 6972 2e20 756e 6c65 7373 2079  mp_dir. unless y
-00016330: 6f75 2064 6566 696e 6520 656e 7620 5245  ou define env RE
-00016340: 5455 524e 4e5f 4341 4348 455f 4449 520a  TURNN_CACHE_DIR.
-00016350: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
-00016360: 2020 2020 2222 220a 2020 2020 6966 2022      """.    if "
-00016370: 5245 5455 524e 4e5f 4341 4348 455f 4449  RETURNN_CACHE_DI
-00016380: 5222 2069 6e20 6f73 2e65 6e76 6972 6f6e  R" in os.environ
-00016390: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000163a0: 206f 732e 656e 7669 726f 6e5b 2252 4554   os.environ["RET
-000163b0: 5552 4e4e 5f43 4143 4845 5f44 4952 225d  URNN_CACHE_DIR"]
-000163c0: 0a20 2020 2072 6574 7572 6e20 6765 745f  .    return get_
-000163d0: 7465 6d70 5f64 6972 2829 0a0a 0a63 6c61  temp_dir()...cla
-000163e0: 7373 204c 6f63 6b46 696c 6528 6f62 6a65  ss LockFile(obje
-000163f0: 6374 293a 0a20 2020 2022 2222 0a20 2020  ct):.    """.   
-00016400: 2053 696d 706c 6520 6c6f 636b 2066 696c   Simple lock fil
-00016410: 652e 0a20 2020 2022 2222 0a0a 2020 2020  e..    """..    
-00016420: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00016430: 662c 2064 6972 6563 746f 7279 2c20 6e61  f, directory, na
-00016440: 6d65 3d22 6c6f 636b 5f66 696c 6522 2c20  me="lock_file", 
-00016450: 6c6f 636b 5f74 696d 656f 7574 3d31 202a  lock_timeout=1 *
-00016460: 2036 3020 2a20 3630 293a 0a20 2020 2020   60 * 60):.     
-00016470: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-00016480: 7061 7261 6d20 7374 7220 6469 7265 6374  param str direct
-00016490: 6f72 793a 0a20 2020 2020 2020 203a 7061  ory:.        :pa
-000164a0: 7261 6d20 696e 747c 666c 6f61 7420 6c6f  ram int|float lo
-000164b0: 636b 5f74 696d 656f 7574 3a20 696e 2073  ck_timeout: in s
-000164c0: 6563 6f6e 6473 0a20 2020 2020 2020 2022  econds.        "
-000164d0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-000164e0: 6469 7265 6374 6f72 7920 3d20 6469 7265  directory = dire
-000164f0: 6374 6f72 790a 2020 2020 2020 2020 7365  ctory.        se
-00016500: 6c66 2e6e 616d 6520 3d20 6e61 6d65 0a20  lf.name = name. 
-00016510: 2020 2020 2020 2073 656c 662e 6664 203d         self.fd =
-00016520: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-00016530: 6c66 2e6c 6f63 6b5f 7469 6d65 6f75 7420  lf.lock_timeout 
-00016540: 3d20 6c6f 636b 5f74 696d 656f 7574 0a20  = lock_timeout. 
-00016550: 2020 2020 2020 2073 656c 662e 6c6f 636b         self.lock
-00016560: 6669 6c65 203d 2022 2573 2f25 7322 2025  file = "%s/%s" %
-00016570: 2028 6469 7265 6374 6f72 792c 206e 616d   (directory, nam
-00016580: 6529 0a0a 2020 2020 6465 6620 6973 5f6f  e)..    def is_o
-00016590: 6c64 5f6c 6f63 6b66 696c 6528 7365 6c66  ld_lockfile(self
-000165a0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000165b0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-000165c0: 5768 6574 6865 7220 7468 6572 6520 6973  Whether there is
-000165d0: 2061 6e20 6578 6973 7469 6e67 206c 6f63   an existing loc
-000165e0: 6b20 6669 6c65 2061 6e64 2074 6865 2065  k file and the e
-000165f0: 7869 7374 696e 6720 6c6f 636b 2066 696c  xisting lock fil
-00016600: 6520 6973 206f 6c64 2e0a 2020 2020 2020  e is old..      
-00016610: 2020 3a72 7479 7065 3a20 626f 6f6c 0a20    :rtype: bool. 
-00016620: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016630: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00016640: 2020 2020 6d74 696d 6520 3d20 6f73 2e70      mtime = os.p
-00016650: 6174 682e 6765 746d 7469 6d65 2873 656c  ath.getmtime(sel
-00016660: 662e 6c6f 636b 6669 6c65 290a 2020 2020  f.lockfile).    
-00016670: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
-00016680: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00016690: 6d74 696d 6520 3d20 4e6f 6e65 0a20 2020  mtime = None.   
-000166a0: 2020 2020 2069 6620 6d74 696d 6520 616e       if mtime an
-000166b0: 6420 2861 6273 2874 696d 652e 7469 6d65  d (abs(time.time
-000166c0: 2829 202d 206d 7469 6d65 2920 3e20 7365  () - mtime) > se
-000166d0: 6c66 2e6c 6f63 6b5f 7469 6d65 6f75 7429  lf.lock_timeout)
-000166e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000166f0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-00016700: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-00016710: 2020 2020 6465 6620 6d61 7962 655f 7265      def maybe_re
-00016720: 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66 696c  move_old_lockfil
-00016730: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00016740: 2022 2222 0a20 2020 2020 2020 2052 656d   """.        Rem
-00016750: 6f76 6573 2061 6e20 6578 6973 7469 6e67  oves an existing
-00016760: 206f 6c64 206c 6f63 6b66 696c 652c 2069   old lockfile, i
-00016770: 6620 7468 6572 6520 6973 206f 6e65 2e0a  f there is one..
-00016780: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016790: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000167a0: 6973 5f6f 6c64 5f6c 6f63 6b66 696c 6528  is_old_lockfile(
-000167b0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000167c0: 6574 7572 6e0a 2020 2020 2020 2020 7072  eturn.        pr
-000167d0: 696e 7428 2252 656d 6f76 696e 6720 6f6c  int("Removing ol
-000167e0: 6420 6c6f 636b 6669 6c65 2025 7220 2870  d lockfile %r (p
-000167f0: 726f 6261 626c 7920 6372 6173 6865 6420  robably crashed 
-00016800: 7072 6f63 292e 2220 2520 7365 6c66 2e6c  proc)." % self.l
-00016810: 6f63 6b66 696c 6529 0a20 2020 2020 2020  ockfile).       
-00016820: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00016830: 2020 6f73 2e72 656d 6f76 6528 7365 6c66    os.remove(self
-00016840: 2e6c 6f63 6b66 696c 6529 0a20 2020 2020  .lockfile).     
-00016850: 2020 2065 7863 6570 7420 4f53 4572 726f     except OSErro
-00016860: 7220 6173 2065 7863 3a0a 2020 2020 2020  r as exc:.      
-00016870: 2020 2020 2020 7072 696e 7428 2252 656d        print("Rem
-00016880: 6f76 6520 6c6f 636b 6669 6c65 2065 7863  ove lockfile exc
-00016890: 6570 7469 6f6e 2025 722e 2049 676e 6f72  eption %r. Ignor
-000168a0: 696e 6720 6974 2e22 2025 2065 7863 290a  ing it." % exc).
-000168b0: 0a20 2020 2064 6566 2069 735f 6c6f 636b  .    def is_lock
-000168c0: 6564 2873 656c 6629 3a0a 2020 2020 2020  ed(self):.      
-000168d0: 2020 2222 220a 2020 2020 2020 2020 3a72    """.        :r
-000168e0: 6574 7572 6e3a 2077 6865 7468 6572 2074  eturn: whether t
-000168f0: 6865 7265 2069 7320 616e 2061 6374 6976  here is an activ
-00016900: 6520 286e 6f74 206f 6c64 2920 6c6f 636b  e (not old) lock
-00016910: 6669 6c65 0a20 2020 2020 2020 203a 7274  file.        :rt
-00016920: 7970 653a 2062 6f6f 6c0a 2020 2020 2020  ype: bool.      
-00016930: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00016940: 2073 656c 662e 6973 5f6f 6c64 5f6c 6f63   self.is_old_loc
-00016950: 6b66 696c 6528 293a 0a20 2020 2020 2020  kfile():.       
-00016960: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00016970: 650a 2020 2020 2020 2020 7472 793a 0a20  e.        try:. 
-00016980: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00016990: 6e20 6f73 2e70 6174 682e 6578 6973 7473  n os.path.exists
-000169a0: 2873 656c 662e 6c6f 636b 6669 6c65 290a  (self.lockfile).
-000169b0: 2020 2020 2020 2020 6578 6365 7074 204f          except O
-000169c0: 5345 7272 6f72 3a0a 2020 2020 2020 2020  SError:.        
-000169d0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000169e0: 0a0a 2020 2020 6465 6620 6c6f 636b 2873  ..    def lock(s
-000169f0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00016a00: 220a 2020 2020 2020 2020 4163 7175 6972  ".        Acquir
-00016a10: 6573 2074 6865 206c 6f63 6b2e 0a20 2020  es the lock..   
-00016a20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016a30: 2069 6d70 6f72 7420 7469 6d65 0a20 2020   import time.   
-00016a40: 2020 2020 2069 6d70 6f72 7420 6572 726e       import errn
-00016a50: 6f0a 0a20 2020 2020 2020 2077 6169 745f  o..        wait_
-00016a60: 636f 756e 7420 3d20 300a 2020 2020 2020  count = 0.      
-00016a70: 2020 7768 696c 6520 5472 7565 3a0a 2020    while True:.  
-00016a80: 2020 2020 2020 2020 2020 2320 5472 7920            # Try 
-00016a90: 746f 2063 7265 6174 6520 6469 7265 6374  to create direct
-00016aa0: 6f72 7920 6966 2069 7420 646f 6573 206e  ory if it does n
-00016ab0: 6f74 2065 7869 7374 2e0a 2020 2020 2020  ot exist..      
-00016ac0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00016ad0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-00016ae0: 6b65 6469 7273 2873 656c 662e 6469 7265  kedirs(self.dire
-00016af0: 6374 6f72 7929 0a20 2020 2020 2020 2020  ctory).         
-00016b00: 2020 2065 7863 6570 7420 4f53 4572 726f     except OSErro
-00016b10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00016b20: 2020 2070 6173 7320 2023 2049 676e 6f72     pass  # Ignor
-00016b30: 6520 616e 7920 6572 726f 7273 2e0a 2020  e any errors..  
-00016b40: 2020 2020 2020 2020 2020 2320 4e6f 7720            # Now 
-00016b50: 7472 7920 746f 2063 7265 6174 6520 7468  try to create th
-00016b60: 6520 6c6f 636b 2e0a 2020 2020 2020 2020  e lock..        
-00016b70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00016b80: 2020 2020 2020 2020 2073 656c 662e 6664           self.fd
-00016b90: 203d 206f 732e 6f70 656e 2873 656c 662e   = os.open(self.
-00016ba0: 6c6f 636b 6669 6c65 2c20 6f73 2e4f 5f43  lockfile, os.O_C
-00016bb0: 5245 4154 207c 206f 732e 4f5f 4558 434c  REAT | os.O_EXCL
-00016bc0: 207c 206f 732e 4f5f 5244 5752 290a 2020   | os.O_RDWR).  
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016be0: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-00016bf0: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-00016c00: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
-00016c10: 2020 2020 2020 2020 2320 506f 7373 6962          # Possib
-00016c20: 6c65 2065 7272 6f72 733a 0a20 2020 2020  le errors:.     
-00016c30: 2020 2020 2020 2020 2020 2023 2045 4e4f             # ENO
-00016c40: 454e 5420 284e 6f20 7375 6368 2066 696c  ENT (No such fil
-00016c50: 6520 6f72 2064 6972 6563 746f 7279 292c  e or directory),
-00016c60: 2065 2e67 2e20 6966 2074 6865 2064 6972   e.g. if the dir
-00016c70: 6563 746f 7279 2077 6173 2064 656c 6574  ectory was delet
-00016c80: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-00016c90: 2020 2020 2320 4545 5849 5354 2028 4669      # EEXIST (Fi
-00016ca0: 6c65 2065 7869 7374 7329 2c20 6966 2074  le exists), if t
-00016cb0: 6865 206c 6f63 6b20 616c 7265 6164 7920  he lock already 
-00016cc0: 6578 6973 7473 2e0a 2020 2020 2020 2020  exists..        
-00016cd0: 2020 2020 2020 2020 6966 2065 7863 2e65          if exc.e
-00016ce0: 7272 6e6f 206e 6f74 2069 6e20 5b65 7272  rrno not in [err
-00016cf0: 6e6f 2e45 4e4f 454e 542c 2065 7272 6e6f  no.ENOENT, errno
-00016d00: 2e45 4558 4953 545d 3a0a 2020 2020 2020  .EEXIST]:.      
-00016d10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00016d20: 6973 6520 2023 204f 7468 6572 2065 7272  ise  # Other err
-00016d30: 6f72 2c20 736f 2072 6572 6169 7365 2e0a  or, so reraise..
-00016d40: 2020 2020 2020 2020 2020 2020 2320 5765              # We
-00016d50: 2064 6964 206e 6f74 2067 6574 2074 6865   did not get the
-00016d60: 206c 6f63 6b2e 0a20 2020 2020 2020 2020   lock..         
-00016d70: 2020 2023 2043 6865 636b 2069 6620 6974     # Check if it
-00016d80: 2069 7320 6120 7265 616c 6c79 206f 6c64   is a really old
-00016d90: 206f 6e65 2e0a 2020 2020 2020 2020 2020   one..          
-00016da0: 2020 7365 6c66 2e6d 6179 6265 5f72 656d    self.maybe_rem
-00016db0: 6f76 655f 6f6c 645f 6c6f 636b 6669 6c65  ove_old_lockfile
-00016dc0: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-00016dd0: 2057 6169 7420 6120 6269 742c 2061 6e64   Wait a bit, and
-00016de0: 2074 6865 6e20 7265 7472 792e 0a20 2020   then retry..   
-00016df0: 2020 2020 2020 2020 2074 696d 652e 736c           time.sl
-00016e00: 6565 7028 3129 0a20 2020 2020 2020 2020  eep(1).         
-00016e10: 2020 2077 6169 745f 636f 756e 7420 2b3d     wait_count +=
-00016e20: 2031 0a20 2020 2020 2020 2020 2020 2069   1.            i
-00016e30: 6620 7761 6974 5f63 6f75 6e74 203d 3d20  f wait_count == 
-00016e40: 3130 3a0a 2020 2020 2020 2020 2020 2020  10:.            
-00016e50: 2020 2020 7072 696e 7428 2257 6169 7469      print("Waiti
-00016e60: 6e67 2066 6f72 206c 6f63 6b2d 6669 6c65  ng for lock-file
-00016e70: 3a20 2573 2220 2520 7365 6c66 2e6c 6f63  : %s" % self.loc
-00016e80: 6b66 696c 6529 0a0a 2020 2020 6465 6620  kfile)..    def 
-00016e90: 756e 6c6f 636b 2873 656c 6629 3a0a 2020  unlock(self):.  
-00016ea0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016eb0: 2020 5265 6c65 6173 6573 2074 6865 206c    Releases the l
-00016ec0: 6f63 6b2e 0a20 2020 2020 2020 2022 2222  ock..        """
-00016ed0: 0a20 2020 2020 2020 206f 732e 636c 6f73  .        os.clos
-00016ee0: 6528 7365 6c66 2e66 6429 0a20 2020 2020  e(self.fd).     
-00016ef0: 2020 206f 732e 7265 6d6f 7665 2873 656c     os.remove(sel
-00016f00: 662e 6c6f 636b 6669 6c65 290a 0a20 2020  f.lockfile)..   
-00016f10: 2064 6566 205f 5f65 6e74 6572 5f5f 2873   def __enter__(s
-00016f20: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-00016f30: 6c66 2e6c 6f63 6b28 290a 0a20 2020 2064  lf.lock()..    d
-00016f40: 6566 205f 5f65 7869 745f 5f28 7365 6c66  ef __exit__(self
-00016f50: 2c20 6578 635f 7479 7065 2c20 6578 635f  , exc_type, exc_
-00016f60: 7661 6c2c 2065 7863 5f74 6229 3a0a 2020  val, exc_tb):.  
-00016f70: 2020 2020 2020 7365 6c66 2e75 6e6c 6f63        self.unloc
-00016f80: 6b28 290a 0a0a 6465 6620 7374 725f 6973  k()...def str_is
-00016f90: 5f6e 756d 6265 7228 7329 3a0a 2020 2020  _number(s):.    
-00016fa0: 2222 220a 2020 2020 3a70 6172 616d 2073  """.    :param s
-00016fb0: 7472 2073 3a20 652e 672e 2022 3122 2c20  tr s: e.g. "1", 
-00016fc0: 222e 3322 206f 7220 2278 220a 2020 2020  ".3" or "x".    
-00016fd0: 3a72 6574 7572 6e3a 2077 6865 7468 6572  :return: whether
-00016fe0: 2073 2063 616e 2062 6520 6361 7374 6564   s can be casted
-00016ff0: 2074 6f20 666c 6f61 7420 6f72 2069 6e74   to float or int
-00017000: 0a20 2020 203a 7274 7970 653a 2062 6f6f  .    :rtype: boo
-00017010: 6c0a 2020 2020 2222 220a 2020 2020 7472  l.    """.    tr
-00017020: 793a 0a20 2020 2020 2020 2066 6c6f 6174  y:.        float
-00017030: 2873 290a 2020 2020 2020 2020 7265 7475  (s).        retu
-00017040: 726e 2054 7275 650a 2020 2020 6578 6365  rn True.    exce
-00017050: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
-00017060: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00017070: 6c73 650a 0a0a 6465 6620 736f 7274 6564  lse...def sorted
-00017080: 5f76 616c 7565 735f 6672 6f6d 5f64 6963  _values_from_dic
-00017090: 7428 6429 3a0a 2020 2020 2222 220a 2020  t(d):.    """.  
-000170a0: 2020 3a70 6172 616d 2064 6963 745b 542c    :param dict[T,
-000170b0: 565d 2064 3a0a 2020 2020 3a72 7479 7065  V] d:.    :rtype
-000170c0: 3a20 6c69 7374 5b56 5d0a 2020 2020 2222  : list[V].    ""
-000170d0: 220a 2020 2020 6173 7365 7274 2069 7369  ".    assert isi
-000170e0: 6e73 7461 6e63 6528 642c 2064 6963 7429  nstance(d, dict)
-000170f0: 0a20 2020 2072 6574 7572 6e20 5b76 2066  .    return [v f
-00017100: 6f72 2028 6b2c 2076 2920 696e 2073 6f72  or (k, v) in sor
-00017110: 7465 6428 642e 6974 656d 7328 2929 5d0a  ted(d.items())].
-00017120: 0a0a 6465 6620 6469 6374 5f7a 6970 286b  ..def dict_zip(k
-00017130: 6579 732c 2076 616c 7565 7329 3a0a 2020  eys, values):.  
-00017140: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
-00017150: 206c 6973 745b 545d 206b 6579 733a 0a20   list[T] keys:. 
-00017160: 2020 203a 7061 7261 6d20 6c69 7374 5b56     :param list[V
-00017170: 5d20 7661 6c75 6573 3a0a 2020 2020 3a72  ] values:.    :r
-00017180: 7479 7065 3a20 6469 6374 5b54 2c56 5d0a  type: dict[T,V].
-00017190: 2020 2020 2222 220a 2020 2020 6173 7365      """.    asse
-000171a0: 7274 206c 656e 286b 6579 7329 203d 3d20  rt len(keys) == 
-000171b0: 6c65 6e28 7661 6c75 6573 290a 2020 2020  len(values).    
-000171c0: 7265 7475 726e 2064 6963 7428 7a69 7028  return dict(zip(
-000171d0: 6b65 7973 2c20 7661 6c75 6573 2929 0a0a  keys, values))..
-000171e0: 0a64 6566 2070 6172 7365 5f6c 645f 636f  .def parse_ld_co
-000171f0: 6e66 5f66 696c 6528 666e 293a 0a20 2020  nf_file(fn):.   
-00017200: 2022 2222 0a20 2020 2056 6961 2068 7474   """.    Via htt
-00017210: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-00017220: 616c 6265 7274 7a2f 7379 7374 656d 2d74  albertz/system-t
-00017230: 6f6f 6c73 2f62 6c6f 622f 6d61 7374 6572  ools/blob/master
-00017240: 2f62 696e 2f66 696e 642d 6c69 622d 696e  /bin/find-lib-in
-00017250: 2d70 6174 682e 7079 2e0a 0a20 2020 203a  -path.py...    :
-00017260: 7061 7261 6d20 7374 7220 666e 3a20 652e  param str fn: e.
-00017270: 672e 2022 2f65 7463 2f6c 642e 736f 2e63  g. "/etc/ld.so.c
-00017280: 6f6e 6622 0a20 2020 203a 7265 7475 726e  onf".    :return
-00017290: 3a20 6c69 7374 206f 6620 7061 7468 7320  : list of paths 
-000172a0: 666f 7220 6c69 6273 0a20 2020 203a 7274  for libs.    :rt
-000172b0: 7970 653a 206c 6973 745b 7374 725d 0a20  ype: list[str]. 
-000172c0: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-000172d0: 676c 6f62 2069 6d70 6f72 7420 676c 6f62  glob import glob
-000172e0: 0a0a 2020 2020 7061 7468 7320 3d20 5b5d  ..    paths = []
-000172f0: 0a20 2020 2066 6f72 206c 696e 6520 696e  .    for line in
-00017300: 206f 7065 6e28 666e 292e 7265 6164 2829   open(fn).read()
-00017310: 2e73 706c 6974 6c69 6e65 7328 293a 0a20  .splitlines():. 
-00017320: 2020 2020 2020 206c 696e 6520 3d20 6c69         line = li
-00017330: 6e65 2e73 7472 6970 2829 0a20 2020 2020  ne.strip().     
-00017340: 2020 2069 6620 6e6f 7420 6c69 6e65 3a0a     if not line:.
-00017350: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00017360: 696e 7565 0a20 2020 2020 2020 2069 6620  inue.        if 
-00017370: 6c69 6e65 2e73 7461 7274 7377 6974 6828  line.startswith(
-00017380: 2223 2229 3a0a 2020 2020 2020 2020 2020  "#"):.          
-00017390: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-000173a0: 2020 2069 6620 6c69 6e65 2e73 7461 7274     if line.start
-000173b0: 7377 6974 6828 2269 6e63 6c75 6465 2022  swith("include "
-000173c0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-000173d0: 6f72 2073 7562 5f66 6e20 696e 2067 6c6f  or sub_fn in glo
-000173e0: 6228 6c69 6e65 5b6c 656e 2822 696e 636c  b(line[len("incl
-000173f0: 7564 6520 2229 203a 5d29 3a0a 2020 2020  ude ") :]):.    
-00017400: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00017410: 732e 6578 7465 6e64 2870 6172 7365 5f6c  s.extend(parse_l
-00017420: 645f 636f 6e66 5f66 696c 6528 7375 625f  d_conf_file(sub_
-00017430: 666e 2929 0a20 2020 2020 2020 2020 2020  fn)).           
-00017440: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00017450: 2020 7061 7468 732e 6170 7065 6e64 286c    paths.append(l
-00017460: 696e 6529 0a20 2020 2072 6574 7572 6e20  ine).    return 
-00017470: 7061 7468 730a 0a0a 6465 6620 6765 745f  paths...def get_
-00017480: 6c64 5f70 6174 6873 2829 3a0a 2020 2020  ld_paths():.    
-00017490: 2222 220a 2020 2020 546f 2062 6520 7665  """.    To be ve
-000174a0: 7279 2063 6f72 7265 6374 2c20 7365 6520  ry correct, see 
-000174b0: 6d61 6e2d 7061 6765 206f 6620 6c64 2e73  man-page of ld.s
-000174c0: 6f2e 0a20 2020 2041 6e64 2068 6572 653a  o..    And here:
-000174d0: 2068 7474 7073 3a2f 2f75 6e69 782e 7374   https://unix.st
-000174e0: 6163 6b65 7863 6861 6e67 652e 636f 6d2f  ackexchange.com/
-000174f0: 7175 6573 7469 6f6e 732f 3335 3432 3935  questions/354295
-00017500: 2f77 6861 742d 6973 2d74 6865 2d64 6566  /what-is-the-def
-00017510: 6175 6c74 2d76 616c 7565 2d6f 662d 6c64  ault-value-of-ld
-00017520: 2d6c 6962 7261 7279 2d70 6174 682f 3335  -library-path/35
-00017530: 3432 3936 0a20 2020 2053 686f 7274 2076  4296.    Short v
-00017540: 6572 7369 6f6e 2c20 6e6f 7420 7370 6563  ersion, not spec
-00017550: 6966 6963 2074 6f20 616e 2065 7865 6375  ific to an execu
-00017560: 7461 626c 652c 2069 6e20 7468 6973 206f  table, in this o
-00017570: 7264 6572 3a0a 2020 2020 2d20 4c44 5f4c  rder:.    - LD_L
-00017580: 4942 5241 5259 5f50 4154 480a 2020 2020  IBRARY_PATH.    
-00017590: 2d20 2f65 7463 2f6c 642e 736f 2e63 6163  - /etc/ld.so.cac
-000175a0: 6865 2028 696e 7374 6561 6420 7765 2077  he (instead we w
-000175b0: 696c 6c20 7061 7273 6520 2f65 7463 2f6c  ill parse /etc/l
-000175c0: 642e 736f 2e63 6f6e 6629 0a20 2020 202d  d.so.conf).    -
-000175d0: 202f 6c69 622c 202f 7573 722f 6c69 6220   /lib, /usr/lib 
-000175e0: 286f 7220 6d61 7962 6520 2f6c 6962 3634  (or maybe /lib64
-000175f0: 2c20 2f75 7372 2f6c 6962 3634 290a 2020  , /usr/lib64).  
-00017600: 2020 5669 6120 6874 7470 733a 2f2f 6769    Via https://gi
-00017610: 7468 7562 2e63 6f6d 2f61 6c62 6572 747a  thub.com/albertz
-00017620: 2f73 7973 7465 6d2d 746f 6f6c 732f 626c  /system-tools/bl
-00017630: 6f62 2f6d 6173 7465 722f 6269 6e2f 6669  ob/master/bin/fi
-00017640: 6e64 2d6c 6962 2d69 6e2d 7061 7468 2e70  nd-lib-in-path.p
-00017650: 792e 0a0a 2020 2020 3a72 7479 7065 3a20  y...    :rtype: 
-00017660: 6c69 7374 5b73 7472 5d0a 2020 2020 3a72  list[str].    :r
-00017670: 6574 7572 6e3a 206c 6973 7420 6f66 2070  eturn: list of p
-00017680: 6174 6873 2074 6f20 7365 6172 6368 2066  aths to search f
-00017690: 6f72 206c 6962 7320 282a 2e73 6f20 6669  or libs (*.so fi
-000176a0: 6c65 7329 0a20 2020 2022 2222 0a20 2020  les).    """.   
-000176b0: 2070 6174 6873 203d 205b 5d0a 2020 2020   paths = [].    
-000176c0: 6966 2022 4c44 5f4c 4942 5241 5259 5f50  if "LD_LIBRARY_P
-000176d0: 4154 4822 2069 6e20 6f73 2e65 6e76 6972  ATH" in os.envir
-000176e0: 6f6e 3a0a 2020 2020 2020 2020 7061 7468  on:.        path
-000176f0: 732e 6578 7465 6e64 286f 732e 656e 7669  s.extend(os.envi
-00017700: 726f 6e5b 224c 445f 4c49 4252 4152 595f  ron["LD_LIBRARY_
-00017710: 5041 5448 225d 2e73 706c 6974 2822 3a22  PATH"].split(":"
-00017720: 2929 0a20 2020 2069 6620 6f73 2e70 6174  )).    if os.pat
-00017730: 682e 6578 6973 7473 2822 2f65 7463 2f6c  h.exists("/etc/l
-00017740: 642e 736f 2e63 6f6e 6622 293a 0a20 2020  d.so.conf"):.   
-00017750: 2020 2020 2070 6174 6873 2e65 7874 656e       paths.exten
-00017760: 6428 7061 7273 655f 6c64 5f63 6f6e 665f  d(parse_ld_conf_
-00017770: 6669 6c65 2822 2f65 7463 2f6c 642e 736f  file("/etc/ld.so
-00017780: 2e63 6f6e 6622 2929 0a20 2020 2070 6174  .conf")).    pat
-00017790: 6873 2e65 7874 656e 6428 5b22 2f6c 6962  hs.extend(["/lib
-000177a0: 222c 2022 2f75 7372 2f6c 6962 222c 2022  ", "/usr/lib", "
-000177b0: 2f6c 6962 3634 222c 2022 2f75 7372 2f6c  /lib64", "/usr/l
-000177c0: 6962 3634 225d 290a 2020 2020 7265 7475  ib64"]).    retu
-000177d0: 726e 2070 6174 6873 0a0a 0a64 6566 2066  rn paths...def f
-000177e0: 696e 645f 6c69 6228 6c69 625f 6e61 6d65  ind_lib(lib_name
-000177f0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00017800: 7061 7261 6d20 7374 7220 6c69 625f 6e61  param str lib_na
-00017810: 6d65 3a20 7769 7468 6f75 7420 706f 7374  me: without post
-00017820: 6669 782f 7072 6566 6978 2c20 652e 672e  fix/prefix, e.g.
-00017830: 2022 6375 6461 7274 2220 6f72 2022 626c   "cudart" or "bl
-00017840: 6173 220a 2020 2020 3a72 6574 7572 6e3a  as".    :return:
-00017850: 2072 6574 7572 6e73 2066 756c 6c20 7061   returns full pa
-00017860: 7468 2074 6f20 6c69 6220 6f72 204e 6f6e  th to lib or Non
-00017870: 650a 2020 2020 3a72 7479 7065 3a20 7374  e.    :rtype: st
-00017880: 727c 4e6f 6e65 0a20 2020 2022 2222 0a20  r|None.    """. 
-00017890: 2020 2069 6620 7379 732e 706c 6174 666f     if sys.platfo
-000178a0: 726d 203d 3d20 2264 6172 7769 6e22 3a0a  rm == "darwin":.
-000178b0: 2020 2020 2020 2020 7072 6566 6978 203d          prefix =
-000178c0: 2022 6c69 6222 0a20 2020 2020 2020 2070   "lib".        p
-000178d0: 6f73 7466 6978 203d 2022 2e64 796c 6962  ostfix = ".dylib
-000178e0: 220a 2020 2020 656c 6966 2073 7973 2e70  ".    elif sys.p
-000178f0: 6c61 7466 6f72 6d20 3d3d 2022 7769 6e33  latform == "win3
-00017900: 3222 3a0a 2020 2020 2020 2020 7072 6566  2":.        pref
-00017910: 6978 203d 2022 220a 2020 2020 2020 2020  ix = "".        
-00017920: 706f 7374 6669 7820 3d20 222e 646c 6c22  postfix = ".dll"
-00017930: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00017940: 2020 2070 7265 6669 7820 3d20 226c 6962     prefix = "lib
-00017950: 220a 2020 2020 2020 2020 706f 7374 6669  ".        postfi
-00017960: 7820 3d20 222e 736f 220a 2020 2020 666f  x = ".so".    fo
-00017970: 7220 7061 7468 2069 6e20 6765 745f 6c64  r path in get_ld
-00017980: 5f70 6174 6873 2829 3a0a 2020 2020 2020  _paths():.      
-00017990: 2020 666e 203d 2022 2573 2f25 7325 7325    fn = "%s/%s%s%
-000179a0: 7322 2025 2028 7061 7468 2c20 7072 6566  s" % (path, pref
-000179b0: 6978 2c20 6c69 625f 6e61 6d65 2c20 706f  ix, lib_name, po
-000179c0: 7374 6669 7829 0a20 2020 2020 2020 2069  stfix).        i
-000179d0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-000179e0: 2866 6e29 3a0a 2020 2020 2020 2020 2020  (fn):.          
-000179f0: 2020 7265 7475 726e 2066 6e0a 2020 2020    return fn.    
-00017a00: 7265 7475 726e 204e 6f6e 650a 0a0a 6465  return None...de
-00017a10: 6620 7265 6164 5f73 6765 5f6e 756d 5f70  f read_sge_num_p
-00017a20: 726f 6373 286a 6f62 5f69 643d 4e6f 6e65  rocs(job_id=None
-00017a30: 293a 0a20 2020 2022 2222 0a20 2020 2046  ):.    """.    F
-00017a40: 726f 6d20 7468 6520 5375 6e20 4772 6964  rom the Sun Grid
-00017a50: 2045 6e67 696e 6520 2853 4745 292c 2072   Engine (SGE), r
-00017a60: 6561 6473 2074 6865 206e 756d 5f70 726f  eads the num_pro
-00017a70: 6320 7365 7474 696e 6720 666f 7220 6120  c setting for a 
-00017a80: 7061 7274 6963 756c 6172 206a 6f62 2e0a  particular job..
-00017a90: 2020 2020 4966 206a 6f62 5f69 6420 6973      If job_id is
-00017aa0: 206e 6f74 2070 726f 7669 6465 6420 616e   not provided an
-00017ab0: 6420 7468 6520 4a4f 425f 4944 2065 6e76  d the JOB_ID env
-00017ac0: 2069 7320 7365 742c 2069 7420 7769 6c6c   is set, it will
-00017ad0: 2075 7365 2074 6861 7420 696e 7374 6561   use that instea
-00017ae0: 6420 2869 2e65 2e20 6974 2075 7365 7320  d (i.e. it uses 
-00017af0: 7468 6520 6375 7272 656e 7420 6a6f 6229  the current job)
-00017b00: 2e0a 2020 2020 5468 6973 2063 616c 6c73  ..    This calls
-00017b10: 2071 7374 6174 2074 6f20 6669 6775 7265   qstat to figure
-00017b20: 206f 7574 2074 6869 7320 7365 7474 696e   out this settin
-00017b30: 672e 2054 6865 7265 2061 7265 206d 756c  g. There are mul
-00017b40: 7469 706c 6520 7761 7973 2074 6869 7320  tiple ways this 
-00017b50: 6361 6e20 676f 2077 726f 6e67 2c0a 2020  can go wrong,.  
-00017b60: 2020 736f 2062 6574 7465 7220 6361 7463    so better catc
-00017b70: 6820 616e 7920 6578 6365 7074 696f 6e2e  h any exception.
-00017b80: 0a0a 2020 2020 3a70 6172 616d 2069 6e74  ..    :param int
-00017b90: 7c4e 6f6e 6520 6a6f 625f 6964 3a0a 2020  |None job_id:.  
-00017ba0: 2020 3a72 6574 7572 6e3a 206e 756d 5f70    :return: num_p
-00017bb0: 726f 630a 2020 2020 3a72 7479 7065 3a20  roc.    :rtype: 
-00017bc0: 696e 747c 4e6f 6e65 0a20 2020 2022 2222  int|None.    """
-00017bd0: 0a20 2020 2069 6620 6e6f 7420 6a6f 625f  .    if not job_
-00017be0: 6964 3a0a 2020 2020 2020 2020 6966 206e  id:.        if n
-00017bf0: 6f74 206f 732e 656e 7669 726f 6e2e 6765  ot os.environ.ge
-00017c00: 7428 2253 4745 5f52 4f4f 5422 293a 0a20  t("SGE_ROOT"):. 
-00017c10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017c20: 6e20 4e6f 6e65 0a20 2020 2020 2020 2074  n None.        t
-00017c30: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00017c40: 2320 7169 6e74 2e70 7920 6d69 6768 7420  # qint.py might 
-00017c50: 6f76 6572 7772 6974 6520 4a4f 425f 4944  overwrite JOB_ID
-00017c60: 2062 7574 2073 6574 7320 5347 455f 4a4f   but sets SGE_JO
-00017c70: 425f 4944 2069 6e73 7465 6164 2e0a 2020  B_ID instead..  
-00017c80: 2020 2020 2020 2020 2020 6a6f 625f 6964            job_id
-00017c90: 203d 2069 6e74 286f 732e 656e 7669 726f   = int(os.enviro
-00017ca0: 6e2e 6765 7428 2253 4745 5f4a 4f42 5f49  n.get("SGE_JOB_I
-00017cb0: 4422 2920 6f72 206f 732e 656e 7669 726f  D") or os.enviro
-00017cc0: 6e2e 6765 7428 224a 4f42 5f49 4422 2920  n.get("JOB_ID") 
-00017cd0: 6f72 2030 290a 2020 2020 2020 2020 6578  or 0).        ex
-00017ce0: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
-00017cf0: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
-00017d00: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-00017d10: 696f 6e28 2272 6561 645f 7367 655f 6e75  ion("read_sge_nu
-00017d20: 6d5f 7072 6f63 733a 2025 722c 2069 6e76  m_procs: %r, inv
-00017d30: 616c 6964 204a 4f42 5f49 443a 2025 7222  alid JOB_ID: %r"
-00017d40: 2025 2028 6578 632c 206f 732e 656e 7669   % (exc, os.envi
-00017d50: 726f 6e2e 6765 7428 224a 4f42 5f49 4422  ron.get("JOB_ID"
-00017d60: 2929 290a 2020 2020 2020 2020 6966 206e  ))).        if n
-00017d70: 6f74 206a 6f62 5f69 643a 0a20 2020 2020  ot job_id:.     
-00017d80: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00017d90: 6e65 0a20 2020 2066 726f 6d20 7375 6270  ne.    from subp
-00017da0: 726f 6365 7373 2069 6d70 6f72 7420 506f  rocess import Po
-00017db0: 7065 6e2c 2050 4950 452c 2043 616c 6c65  pen, PIPE, Calle
-00017dc0: 6450 726f 6365 7373 4572 726f 720a 0a20  dProcessError.. 
-00017dd0: 2020 2073 6765 5f63 6d64 203d 205b 2271     sge_cmd = ["q
-00017de0: 7374 6174 222c 2022 2d6a 222c 2073 7472  stat", "-j", str
-00017df0: 286a 6f62 5f69 6429 5d0a 2020 2020 7072  (job_id)].    pr
-00017e00: 6f63 203d 2050 6f70 656e 2873 6765 5f63  oc = Popen(sge_c
-00017e10: 6d64 2c20 7374 646f 7574 3d50 4950 4529  md, stdout=PIPE)
-00017e20: 0a20 2020 2073 7464 6f75 742c 205f 203d  .    stdout, _ =
-00017e30: 2070 726f 632e 636f 6d6d 756e 6963 6174   proc.communicat
-00017e40: 6528 290a 2020 2020 6966 2070 726f 632e  e().    if proc.
-00017e50: 7265 7475 726e 636f 6465 3a0a 2020 2020  returncode:.    
-00017e60: 2020 2020 7261 6973 6520 4361 6c6c 6564      raise Called
-00017e70: 5072 6f63 6573 7345 7272 6f72 2870 726f  ProcessError(pro
-00017e80: 632e 7265 7475 726e 636f 6465 2c20 7367  c.returncode, sg
-00017e90: 655f 636d 642c 2073 7464 6f75 7429 0a20  e_cmd, stdout). 
-00017ea0: 2020 2073 7464 6f75 7420 3d20 7374 646f     stdout = stdo
-00017eb0: 7574 2e64 6563 6f64 6528 2275 7466 3822  ut.decode("utf8"
-00017ec0: 290a 2020 2020 6c73 203d 205b 0a20 2020  ).    ls = [.   
-00017ed0: 2020 2020 206c 696e 655b 6c65 6e28 2268       line[len("h
-00017ee0: 6172 6420 7265 736f 7572 6365 5f6c 6973  ard resource_lis
-00017ef0: 743a 2229 203a 5d2e 7374 7269 7028 290a  t:") :].strip().
-00017f00: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
-00017f10: 2069 6e20 7374 646f 7574 2e73 706c 6974   in stdout.split
-00017f20: 6c69 6e65 7328 290a 2020 2020 2020 2020  lines().        
-00017f30: 6966 206c 696e 652e 7374 6172 7473 7769  if line.startswi
-00017f40: 7468 2822 6861 7264 2072 6573 6f75 7263  th("hard resourc
-00017f50: 655f 6c69 7374 3a22 290a 2020 2020 5d0a  e_list:").    ].
-00017f60: 2020 2020 6173 7365 7274 206c 656e 286c      assert len(l
-00017f70: 7329 203d 3d20 310a 2020 2020 6f70 7473  s) == 1.    opts
-00017f80: 203d 2064 6963 7428 5b6f 7074 2e73 706c   = dict([opt.spl
-00017f90: 6974 2822 3d22 2c20 3129 2066 6f72 206f  it("=", 1) for o
-00017fa0: 7074 2069 6e20 6c73 5b30 5d2e 7370 6c69  pt in ls[0].spli
-00017fb0: 7428 222c 2229 5d29 2020 2320 6e6f 7161  t(",")])  # noqa
-00017fc0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00017fd0: 2020 7265 7475 726e 2069 6e74 286f 7074    return int(opt
-00017fe0: 735b 226e 756d 5f70 726f 6322 5d29 0a20  s["num_proc"]). 
-00017ff0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-00018000: 7272 6f72 2061 7320 6578 633a 0a20 2020  rror as exc:.   
-00018010: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-00018020: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00018030: 2020 2272 6561 645f 7367 655f 6e75 6d5f    "read_sge_num_
-00018040: 7072 6f63 733a 2025 722c 2069 6e76 616c  procs: %r, inval
-00018050: 6964 206e 756d 5f70 726f 6320 2572 2066  id num_proc %r f
-00018060: 6f72 206a 6f62 2069 6420 2569 2e5c 6e6c  or job id %i.\nl
-00018070: 696e 653a 2025 7222 0a20 2020 2020 2020  ine: %r".       
-00018080: 2020 2020 2025 2028 6578 632c 206f 7074       % (exc, opt
-00018090: 735b 226e 756d 5f70 726f 6322 5d2c 206a  s["num_proc"], j
-000180a0: 6f62 5f69 642c 206c 735b 305d 290a 2020  ob_id, ls[0]).  
-000180b0: 2020 2020 2020 290a 0a0a 6465 6620 6765        )...def ge
-000180c0: 745f 6e75 6d62 6572 5f61 7661 696c 6162  t_number_availab
-000180d0: 6c65 5f63 7075 7328 293a 0a20 2020 2022  le_cpus():.    "
-000180e0: 2222 0a20 2020 203a 7265 7475 726e 3a20  "".    :return: 
-000180f0: 6e75 6d62 6572 206f 6620 6176 6169 6c61  number of availa
-00018100: 626c 6520 4350 5573 2c20 6966 2077 6520  ble CPUs, if we 
-00018110: 6361 6e20 6669 6775 7265 2069 7420 6f75  can figure it ou
-00018120: 740a 2020 2020 3a72 7479 7065 3a20 696e  t.    :rtype: in
-00018130: 747c 4e6f 6e65 0a20 2020 2022 2222 0a20  t|None.    """. 
-00018140: 2020 2069 6620 6861 7361 7474 7228 6f73     if hasattr(os
-00018150: 2c20 2273 6368 6564 5f67 6574 6166 6669  , "sched_getaffi
-00018160: 6e69 7479 2229 3a20 2023 2050 7974 686f  nity"):  # Pytho
-00018170: 6e20 3e3d 332e 340a 2020 2020 2020 2020  n >=3.4.        
-00018180: 7265 7475 726e 206c 656e 286f 732e 7363  return len(os.sc
-00018190: 6865 645f 6765 7461 6666 696e 6974 7928  hed_getaffinity(
-000181a0: 3029 290a 2020 2020 7472 793a 0a20 2020  0)).    try:.   
-000181b0: 2020 2020 2023 206e 6f69 6e73 7065 6374       # noinspect
-000181c0: 696f 6e20 5079 5061 636b 6167 6552 6571  ion PyPackageReq
-000181d0: 7569 7265 6d65 6e74 732c 5079 556e 7265  uirements,PyUnre
-000181e0: 736f 6c76 6564 5265 6665 7265 6e63 6573  solvedReferences
-000181f0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-00018200: 7073 7574 696c 0a0a 2020 2020 2020 2020  psutil..        
-00018210: 7072 6f63 203d 2070 7375 7469 6c2e 5072  proc = psutil.Pr
-00018220: 6f63 6573 7328 290a 2020 2020 2020 2020  ocess().        
-00018230: 6966 2068 6173 6174 7472 2870 726f 632c  if hasattr(proc,
-00018240: 2022 6370 755f 6166 6669 6e69 7479 2229   "cpu_affinity")
-00018250: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018260: 7475 726e 206c 656e 2870 726f 632e 6370  turn len(proc.cp
-00018270: 755f 6166 6669 6e69 7479 2829 290a 2020  u_affinity()).  
-00018280: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
-00018290: 7272 6f72 3a0a 2020 2020 2020 2020 7061  rror:.        pa
-000182a0: 7373 0a20 2020 2069 6620 6861 7361 7474  ss.    if hasatt
-000182b0: 7228 6f73 2c20 2273 7973 636f 6e66 2229  r(os, "sysconf")
-000182c0: 2061 6e64 2022 5343 5f4e 5052 4f43 4553   and "SC_NPROCES
-000182d0: 534f 5253 5f4f 4e4c 4e22 2069 6e20 6f73  SORS_ONLN" in os
-000182e0: 2e73 7973 636f 6e66 5f6e 616d 6573 3a0a  .sysconf_names:.
-000182f0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00018300: 732e 7379 7363 6f6e 6628 2253 435f 4e50  s.sysconf("SC_NP
-00018310: 524f 4345 5353 4f52 535f 4f4e 4c4e 2229  ROCESSORS_ONLN")
-00018320: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
-00018330: 6f73 2c20 2263 7075 5f63 6f75 6e74 2229  os, "cpu_count")
-00018340: 3a20 2023 2050 7974 686f 6e20 3e3d 332e  :  # Python >=3.
-00018350: 340a 2020 2020 2020 2020 7265 7475 726e  4.        return
-00018360: 206f 732e 6370 755f 636f 756e 7428 2920   os.cpu_count() 
-00018370: 2023 206e 6f74 2071 7569 7465 2063 6f72   # not quite cor
-00018380: 7265 6374 3b20 7468 6174 2061 7265 2061  rect; that are a
-00018390: 6c6c 2069 6e20 7468 6520 7379 7374 656d  ll in the system
-000183a0: 0a20 2020 2072 6574 7572 6e20 4e6f 6e65  .    return None
-000183b0: 0a0a 0a64 6566 2067 7565 7373 5f72 6571  ...def guess_req
-000183c0: 7565 7374 6564 5f6d 6178 5f6e 756d 5f74  uested_max_num_t
-000183d0: 6872 6561 6473 286c 6f67 5f66 696c 653d  hreads(log_file=
-000183e0: 4e6f 6e65 2c20 6661 6c6c 6261 636b 5f6e  None, fallback_n
-000183f0: 756d 5f63 7075 733d 5472 7565 293a 0a20  um_cpus=True):. 
-00018400: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00018410: 6d20 696f 2e46 696c 6520 6c6f 675f 6669  m io.File log_fi
-00018420: 6c65 3a0a 2020 2020 3a70 6172 616d 2062  le:.    :param b
-00018430: 6f6f 6c20 6661 6c6c 6261 636b 5f6e 756d  ool fallback_num
-00018440: 5f63 7075 733a 0a20 2020 203a 7274 7970  _cpus:.    :rtyp
-00018450: 653a 2069 6e74 7c4e 6f6e 650a 2020 2020  e: int|None.    
-00018460: 2222 220a 2020 2020 7472 793a 0a20 2020  """.    try:.   
-00018470: 2020 2020 2073 6765 5f6e 756d 5f70 726f       sge_num_pro
-00018480: 6373 203d 2072 6561 645f 7367 655f 6e75  cs = read_sge_nu
-00018490: 6d5f 7072 6f63 7328 290a 2020 2020 6578  m_procs().    ex
-000184a0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-000184b0: 7320 6578 633a 0a20 2020 2020 2020 2069  s exc:.        i
-000184c0: 6620 6c6f 675f 6669 6c65 3a0a 2020 2020  f log_file:.    
-000184d0: 2020 2020 2020 2020 7072 696e 7428 2245          print("E
-000184e0: 7272 6f72 2077 6869 6c65 2067 6574 7469  rror while getti
-000184f0: 6e67 2053 4745 206e 756d 5f70 726f 633a  ng SGE num_proc:
-00018500: 2025 7222 2025 2065 7863 2c20 6669 6c65   %r" % exc, file
-00018510: 3d6c 6f67 5f66 696c 6529 0a20 2020 2065  =log_file).    e
-00018520: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
-00018530: 7367 655f 6e75 6d5f 7072 6f63 733a 0a20  sge_num_procs:. 
-00018540: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
-00018550: 675f 6669 6c65 3a0a 2020 2020 2020 2020  g_file:.        
-00018560: 2020 2020 2020 2020 7072 696e 7428 2255          print("U
-00018570: 7365 206e 756d 5f74 6872 6561 6473 3d25  se num_threads=%
-00018580: 6920 2862 7574 206d 696e 2032 2920 7669  i (but min 2) vi
-00018590: 6120 5347 4520 6e75 6d5f 7072 6f63 2e22  a SGE num_proc."
-000185a0: 2025 2073 6765 5f6e 756d 5f70 726f 6373   % sge_num_procs
-000185b0: 2c20 6669 6c65 3d6c 6f67 5f66 696c 6529  , file=log_file)
-000185c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000185d0: 7572 6e20 6d61 7828 7367 655f 6e75 6d5f  urn max(sge_num_
-000185e0: 7072 6f63 732c 2032 290a 2020 2020 6f6d  procs, 2).    om
-000185f0: 705f 6e75 6d5f 7468 7265 6164 7320 3d20  p_num_threads = 
-00018600: 696e 7428 6f73 2e65 6e76 6972 6f6e 2e67  int(os.environ.g
-00018610: 6574 2822 4f4d 505f 4e55 4d5f 5448 5245  et("OMP_NUM_THRE
-00018620: 4144 5322 2920 6f72 2030 290a 2020 2020  ADS") or 0).    
-00018630: 6966 206f 6d70 5f6e 756d 5f74 6872 6561  if omp_num_threa
-00018640: 6473 3a0a 2020 2020 2020 2020 2320 4d69  ds:.        # Mi
-00018650: 6e69 6d75 6d20 6f66 2032 2074 6872 6561  nimum of 2 threa
-00018660: 6473 2c20 7368 6f75 6c64 206e 6f74 2068  ds, should not h
-00018670: 7572 742e 0a20 2020 2020 2020 2069 6620  urt..        if 
-00018680: 6c6f 675f 6669 6c65 3a0a 2020 2020 2020  log_file:.      
-00018690: 2020 2020 2020 7072 696e 7428 2255 7365        print("Use
-000186a0: 206e 756d 5f74 6872 6561 6473 3d25 6920   num_threads=%i 
-000186b0: 2862 7574 206d 696e 2032 2920 7669 6120  (but min 2) via 
-000186c0: 4f4d 505f 4e55 4d5f 5448 5245 4144 532e  OMP_NUM_THREADS.
-000186d0: 2220 2520 6f6d 705f 6e75 6d5f 7468 7265  " % omp_num_thre
-000186e0: 6164 732c 2066 696c 653d 6c6f 675f 6669  ads, file=log_fi
-000186f0: 6c65 290a 2020 2020 2020 2020 7265 7475  le).        retu
-00018700: 726e 206d 6178 286f 6d70 5f6e 756d 5f74  rn max(omp_num_t
-00018710: 6872 6561 6473 2c20 3229 0a20 2020 2069  hreads, 2).    i
-00018720: 6620 6661 6c6c 6261 636b 5f6e 756d 5f63  f fallback_num_c
-00018730: 7075 733a 0a20 2020 2020 2020 2072 6574  pus:.        ret
-00018740: 7572 6e20 6765 745f 6e75 6d62 6572 5f61  urn get_number_a
-00018750: 7661 696c 6162 6c65 5f63 7075 7328 290a  vailable_cpus().
-00018760: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00018770: 0a0a 5468 6561 6e6f 466c 6167 7320 3d20  ..TheanoFlags = 
-00018780: 7b0a 2020 2020 6b65 793a 2076 616c 7565  {.    key: value
-00018790: 2066 6f72 2028 6b65 792c 2076 616c 7565   for (key, value
-000187a0: 2920 696e 205b 732e 7370 6c69 7428 223d  ) in [s.split("=
-000187b0: 222c 2031 2920 666f 7220 7320 696e 206f  ", 1) for s in o
-000187c0: 732e 656e 7669 726f 6e2e 6765 7428 2254  s.environ.get("T
-000187d0: 4845 414e 4f5f 464c 4147 5322 2c20 2222  HEANO_FLAGS", ""
-000187e0: 292e 7370 6c69 7428 222c 2229 2069 6620  ).split(",") if 
-000187f0: 735d 0a7d 0a0a 0a64 6566 205f 636f 6e73  s].}...def _cons
-00018800: 6964 6572 5f63 6865 636b 5f66 6f72 5f67  ider_check_for_g
-00018810: 7075 2829 3a0a 2020 2020 2222 220a 2020  pu():.    """.  
-00018820: 2020 5468 6572 6520 6172 6520 6361 7365    There are case
-00018830: 7320 7768 6572 6520 6e76 6964 6961 2d73  s where nvidia-s
-00018840: 6d69 2063 6f75 6c64 2068 616e 672e 0a20  mi could hang.. 
-00018850: 2020 2028 416e 7920 7265 6164 206f 6620     (Any read of 
-00018860: 2f70 726f 632f 6d6f 6475 6c65 7320 6d69  /proc/modules mi
-00018870: 6768 7420 6861 6e67 2069 6e20 7468 6174  ght hang in that
-00018880: 2063 6173 652c 206d 6179 6265 2063 6175   case, maybe cau
-00018890: 7365 640a 2020 2020 2062 7920 7472 7969  sed.     by tryi
-000188a0: 6e67 2074 6f20 606d 6f64 7072 6f62 6520  ng to `modprobe 
-000188b0: 6e76 6964 6961 6020 746f 2063 6865 636b  nvidia` to check
-000188c0: 2069 6620 7468 6572 6520 6973 2061 204e   if there is a N
-000188d0: 7669 6469 6120 6361 7264 2e29 0a20 2020  vidia card.).   
-000188e0: 2054 6869 7320 736f 6d65 7469 6d65 7320   This sometimes 
-000188f0: 6861 7070 656e 7320 696e 206f 7572 2053  happens in our S
-00018900: 4745 2063 6c75 7374 6572 206f 6e20 6e6f  GE cluster on no
-00018910: 6465 7320 7769 7468 6f75 7420 4e76 6964  des without Nvid
-00018920: 6961 2063 6172 6473 2e0a 2020 2020 4d61  ia cards..    Ma
-00018930: 7962 6520 6974 2773 2061 6c73 6f20 6120  ybe it's also a 
-00018940: 4c69 6e75 7820 4b65 726e 656c 2062 7567  Linux Kernel bug
-00018950: 2e0a 2020 2020 416e 7977 6179 2c20 6a75  ..    Anyway, ju
-00018960: 7374 2061 766f 6964 2061 6e79 2073 7563  st avoid any suc
-00018970: 6820 6368 6563 6b20 6966 2077 6520 646f  h check if we do
-00018980: 6e27 7420 6173 6b65 6420 666f 7220 6120  n't asked for a 
-00018990: 4750 552e 0a0a 2020 2020 3a72 7479 7065  GPU...    :rtype
-000189a0: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
-000189b0: 2020 2069 6620 2264 6576 6963 6522 2069     if "device" i
-000189c0: 6e20 5468 6561 6e6f 466c 6167 733a 0a20  n TheanoFlags:. 
-000189d0: 2020 2020 2020 2064 6576 203d 2054 6865         dev = The
-000189e0: 616e 6f46 6c61 6773 5b22 6465 7669 6365  anoFlags["device
-000189f0: 225d 0a20 2020 2020 2020 2069 6620 6465  "].        if de
-00018a00: 762e 7374 6172 7473 7769 7468 2822 6770  v.startswith("gp
-00018a10: 7522 2920 6f72 2064 6576 2e73 7461 7274  u") or dev.start
-00018a20: 7377 6974 6828 2263 7564 6122 293a 0a20  swith("cuda"):. 
-00018a30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00018a40: 6e20 5472 7565 0a20 2020 2020 2020 2023  n True.        #
-00018a50: 2054 4845 414e 4f5f 464c 4147 5320 7769   THEANO_FLAGS wi
-00018a60: 6c6c 206f 7665 7277 7269 7465 2074 6869  ll overwrite thi
-00018a70: 7320 636f 6e66 6967 206f 7074 696f 6e2e  s config option.
-00018a80: 2053 6565 2072 6e6e 2e69 6e69 7444 6576   See rnn.initDev
-00018a90: 6963 6573 2829 2e0a 2020 2020 2020 2020  ices()..        
-00018aa0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00018ab0: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
-00018ac0: 5079 4272 6f61 6445 7863 6570 7469 6f6e  PyBroadException
-00018ad0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00018ae0: 2020 6672 6f6d 2072 6574 7572 6e6e 2e63    from returnn.c
-00018af0: 6f6e 6669 6720 696d 706f 7274 2067 6574  onfig import get
-00018b00: 5f67 6c6f 6261 6c5f 636f 6e66 6967 0a0a  _global_config..
-00018b10: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
-00018b20: 2067 6574 5f67 6c6f 6261 6c5f 636f 6e66   get_global_conf
-00018b30: 6967 2829 0a20 2020 2065 7863 6570 7420  ig().    except 
-00018b40: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00018b50: 2020 2063 6f6e 6669 6720 3d20 4e6f 6e65     config = None
-00018b60: 0a20 2020 2069 6620 636f 6e66 6967 3a0a  .    if config:.
-00018b70: 2020 2020 2020 2020 666f 7220 6465 7620          for dev 
-00018b80: 696e 2063 6f6e 6669 672e 6c69 7374 2822  in config.list("
-00018b90: 6465 7669 6365 222c 205b 5d29 3a0a 2020  device", []):.  
-00018ba0: 2020 2020 2020 2020 2020 6966 2064 6576            if dev
-00018bb0: 2e73 7461 7274 7377 6974 6828 2267 7075  .startswith("gpu
-00018bc0: 2229 206f 7220 6465 762e 7374 6172 7473  ") or dev.starts
-00018bd0: 7769 7468 2822 6375 6461 2229 3a0a 2020  with("cuda"):.  
-00018be0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018bf0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-00018c00: 2020 2020 2020 6966 2064 6576 203d 3d20        if dev == 
-00018c10: 2261 6c6c 223a 0a20 2020 2020 2020 2020  "all":.         
-00018c20: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00018c30: 7565 0a20 2020 2072 6574 7572 6e20 4661  ue.    return Fa
-00018c40: 6c73 650a 0a0a 6465 6620 6765 745f 6770  lse...def get_gp
-00018c50: 755f 6e61 6d65 7328 293a 0a20 2020 2022  u_names():.    "
-00018c60: 2222 0a20 2020 203a 7274 7970 653a 206c  "".    :rtype: l
-00018c70: 6973 745b 7374 725d 0a20 2020 2022 2222  ist[str].    """
-00018c80: 0a20 2020 2069 6620 6e6f 7420 5f63 6f6e  .    if not _con
-00018c90: 7369 6465 725f 6368 6563 6b5f 666f 725f  sider_check_for_
-00018ca0: 6770 7528 293a 0a20 2020 2020 2020 2072  gpu():.        r
-00018cb0: 6574 7572 6e20 5b5d 0a20 2020 2069 6620  eturn [].    if 
-00018cc0: 6f73 2e6e 616d 6520 3d3d 2022 6e74 223a  os.name == "nt":
-00018cd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00018ce0: 2247 6546 6f72 6365 2047 5458 2037 3730  "GeForce GTX 770
-00018cf0: 2220 2023 2054 4f44 4f0a 2020 2020 656c  "  # TODO.    el
-00018d00: 6966 2073 7973 2e70 6c61 7466 6f72 6d20  if sys.platform 
-00018d10: 3d3d 2022 6461 7277 696e 223a 0a20 2020  == "darwin":.   
-00018d20: 2020 2020 2023 2054 4f44 4f20 7061 7273       # TODO pars
-00018d30: 6520 7669 6120 786d 6c20 6f75 7470 7574  e via xml output
-00018d40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00018d50: 7379 735f 636d 645f 6f75 745f 6c69 6e65  sys_cmd_out_line
-00018d60: 7328 0a20 2020 2020 2020 2020 2020 2022  s(.            "
-00018d70: 7379 7374 656d 5f70 726f 6669 6c65 7220  system_profiler 
-00018d80: 5350 4469 7370 6c61 7973 4461 7461 5479  SPDisplaysDataTy
-00018d90: 7065 207c 2022 0a20 2020 2020 2020 2020  pe | ".         
-00018da0: 2020 2022 6772 6570 2027 4368 6970 7365     "grep 'Chipse
-00018db0: 7420 4d6f 6465 6c3a 204e 5649 4449 4127  t Model: NVIDIA'
-00018dc0: 207c 2022 0a20 2020 2020 2020 2020 2020   | ".           
-00018dd0: 2022 7365 6420 2773 2f2e 2a43 6869 7073   "sed 's/.*Chips
-00018de0: 6574 204d 6f64 656c 3a20 4e56 4944 4941  et Model: NVIDIA
-00018df0: 202a 2f2f 3b73 2f20 2a24 2f2f 2722 0a20   *//;s/ *$//'". 
-00018e00: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-00018e10: 653a 0a20 2020 2020 2020 2074 7279 3a0a  e:.        try:.
-00018e20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00018e30: 726e 2073 7973 5f63 6d64 5f6f 7574 5f6c  rn sys_cmd_out_l
-00018e40: 696e 6573 2822 6e76 6964 6961 2d73 6d69  ines("nvidia-smi
-00018e50: 202d 4c20 7c20 6375 7420 2d64 2027 2827   -L | cut -d '('
-00018e60: 202d 6620 3120 7c20 6375 7420 2d64 2027   -f 1 | cut -d '
-00018e70: 2027 202d 6620 332d 207c 2073 6564 202d   ' -f 3- | sed -
-00018e80: 6520 2773 2f5c 5c20 242f 2f27 2229 0a20  e 's/\\ $//'"). 
-00018e90: 2020 2020 2020 2065 7863 6570 7420 4361         except Ca
-00018ea0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00018eb0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018ec0: 7475 726e 205b 5d0a 0a0a 6465 6620 5f67  turn []...def _g
-00018ed0: 6574 5f6e 756d 5f67 7075 5f64 6576 6963  et_num_gpu_devic
-00018ee0: 6573 2829 3a0a 2020 2020 2222 220a 2020  es():.    """.  
-00018ef0: 2020 3a72 6574 7572 6e3a 2063 7075 2c67    :return: cpu,g
-00018f00: 7075 0a20 2020 203a 7274 7970 653a 2028  pu.    :rtype: (
-00018f10: 696e 742c 696e 7429 0a20 2020 2022 2222  int,int).    """
-00018f20: 0a20 2020 2069 6620 6f73 2e6e 616d 6520  .    if os.name 
-00018f30: 3d3d 2022 6e74 223a 0a20 2020 2020 2020  == "nt":.       
-00018f40: 2072 6574 7572 6e20 312c 2031 2020 2320   return 1, 1  # 
-00018f50: 544f 444f 0a20 2020 2065 6c69 6620 7379  TODO.    elif sy
-00018f60: 732e 706c 6174 666f 726d 203d 3d20 2264  s.platform == "d
-00018f70: 6172 7769 6e22 3a0a 2020 2020 2020 2020  arwin":.        
-00018f80: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00018f90: 2020 2020 2069 6e74 2873 7973 5f63 6d64       int(sys_cmd
-00018fa0: 5f6f 7574 5f6c 696e 6573 2822 7379 7363  _out_lines("sysc
-00018fb0: 746c 202d 6120 7c20 6772 6570 206d 6163  tl -a | grep mac
-00018fc0: 6864 6570 2e63 7075 2e63 6f72 655f 636f  hdep.cpu.core_co
-00018fd0: 756e 7420 7c20 6177 6b20 277b 7072 696e  unt | awk '{prin
-00018fe0: 7420 2432 7d27 2229 5b30 5d29 2c0a 2020  t $2}'")[0]),.  
-00018ff0: 2020 2020 2020 2020 2020 6c65 6e28 7379            len(sy
-00019000: 735f 636d 645f 6f75 745f 6c69 6e65 7328  s_cmd_out_lines(
-00019010: 2273 7973 7465 6d5f 7072 6f66 696c 6572  "system_profiler
-00019020: 2053 5044 6973 706c 6179 7344 6174 6154   SPDisplaysDataT
-00019030: 7970 6520 7c20 6772 6570 2027 4368 6970  ype | grep 'Chip
-00019040: 7365 7420 4d6f 6465 6c3a 204e 5649 4449  set Model: NVIDI
-00019050: 4127 207c 2063 6174 2229 292c 0a20 2020  A' | cat")),.   
-00019060: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
-00019070: 0a20 2020 2020 2020 206e 756d 5f63 7075  .        num_cpu
-00019080: 7320 3d20 6c65 6e28 7379 735f 636d 645f  s = len(sys_cmd_
-00019090: 6f75 745f 6c69 6e65 7328 2263 6174 202f  out_lines("cat /
-000190a0: 7072 6f63 2f63 7075 696e 666f 207c 2067  proc/cpuinfo | g
-000190b0: 7265 7020 7072 6f63 6573 736f 7222 2929  rep processor"))
-000190c0: 206f 7220 310a 2020 2020 2020 2020 6e75   or 1.        nu
-000190d0: 6d5f 6770 7573 203d 2030 0a20 2020 2020  m_gpus = 0.     
-000190e0: 2020 2069 6620 5f63 6f6e 7369 6465 725f     if _consider_
-000190f0: 6368 6563 6b5f 666f 725f 6770 7528 293a  check_for_gpu():
-00019100: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00019110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019120: 2020 6e75 6d5f 6770 7573 203d 206c 656e    num_gpus = len
-00019130: 2873 7973 5f63 6d64 5f6f 7574 5f6c 696e  (sys_cmd_out_lin
-00019140: 6573 2822 6e76 6964 6961 2d73 6d69 202d  es("nvidia-smi -
-00019150: 4c22 2929 0a20 2020 2020 2020 2020 2020  L")).           
-00019160: 2065 7863 6570 7420 4361 6c6c 6564 5072   except CalledPr
-00019170: 6f63 6573 7345 7272 6f72 3a0a 2020 2020  ocessError:.    
-00019180: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00019190: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000191a0: 6e75 6d5f 6370 7573 2c20 6e75 6d5f 6770  num_cpus, num_gp
-000191b0: 7573 0a0a 0a5f 6e75 6d5f 6465 7669 6365  us..._num_device
-000191c0: 7320 3d20 4e6f 6e65 0a0a 0a64 6566 2067  s = None...def g
-000191d0: 6574 5f6e 756d 5f67 7075 5f64 6576 6963  et_num_gpu_devic
-000191e0: 6573 2829 3a0a 2020 2020 2222 220a 2020  es():.    """.  
-000191f0: 2020 3a72 6574 7572 6e3a 2028 6370 7520    :return: (cpu 
-00019200: 636f 756e 742c 2067 7075 2063 6f75 6e74  count, gpu count
-00019210: 290a 2020 2020 3a72 7479 7065 3a20 2869  ).    :rtype: (i
-00019220: 6e74 2c20 696e 7429 0a20 2020 2022 2222  nt, int).    """
-00019230: 0a20 2020 2067 6c6f 6261 6c20 5f6e 756d  .    global _num
-00019240: 5f64 6576 6963 6573 0a20 2020 2069 6620  _devices.    if 
-00019250: 5f6e 756d 5f64 6576 6963 6573 2069 7320  _num_devices is 
-00019260: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00019270: 2020 7265 7475 726e 205f 6e75 6d5f 6465    return _num_de
-00019280: 7669 6365 730a 2020 2020 5f6e 756d 5f64  vices.    _num_d
-00019290: 6576 6963 6573 203d 205f 6765 745f 6e75  evices = _get_nu
-000192a0: 6d5f 6770 755f 6465 7669 6365 7328 290a  m_gpu_devices().
-000192b0: 2020 2020 7265 7475 726e 205f 6e75 6d5f      return _num_
-000192c0: 6465 7669 6365 730a 0a0a 6465 6620 6861  devices...def ha
-000192d0: 7665 5f67 7075 2829 3a0a 2020 2020 2222  ve_gpu():.    ""
-000192e0: 220a 2020 2020 3a72 7479 7065 3a20 626f  ".    :rtype: bo
-000192f0: 6f6c 0a20 2020 2022 2222 0a20 2020 2063  ol.    """.    c
-00019300: 7075 732c 2067 7075 7320 3d20 6765 745f  pus, gpus = get_
-00019310: 6e75 6d5f 6770 755f 6465 7669 6365 7328  num_gpu_devices(
-00019320: 290a 2020 2020 7265 7475 726e 2067 7075  ).    return gpu
-00019330: 7320 3e20 300a 0a0a 6465 6620 7472 795f  s > 0...def try_
-00019340: 616e 645f 6967 6e6f 7265 5f65 7863 6570  and_ignore_excep
-00019350: 7469 6f6e 2866 293a 0a20 2020 2022 2222  tion(f):.    """
-00019360: 0a20 2020 2043 616c 6c73 2060 6066 6060  .    Calls ``f``
-00019370: 2c20 616e 6420 6967 6e6f 7265 7320 616e  , and ignores an
-00019380: 7920 6578 6365 7074 696f 6e2e 0a0a 2020  y exception...  
-00019390: 2020 3a70 6172 616d 2028 292d 3e54 2066    :param ()->T f
-000193a0: 3a0a 2020 2020 3a72 6574 7572 6e3a 2077  :.    :return: w
-000193b0: 6861 7465 7665 7220 6060 6660 6020 7265  hatever ``f`` re
-000193c0: 7475 726e 732c 206f 7220 4e6f 6e65 0a20  turns, or None. 
-000193d0: 2020 203a 7274 7970 653a 2054 7c4e 6f6e     :rtype: T|Non
-000193e0: 650a 2020 2020 2222 220a 2020 2020 7472  e.    """.    tr
-000193f0: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
-00019400: 6e20 6628 290a 2020 2020 6578 6365 7074  n f().    except
-00019410: 2045 7863 6570 7469 6f6e 2061 7320 6578   Exception as ex
-00019420: 633a 0a20 2020 2020 2020 2070 7269 6e74  c:.        print
-00019430: 2822 7472 795f 616e 645f 6967 6e6f 7265  ("try_and_ignore
-00019440: 5f65 7863 6570 7469 6f6e 3a20 2572 2066  _exception: %r f
-00019450: 6169 6c65 643a 2025 7322 2025 2028 662c  ailed: %s" % (f,
-00019460: 2065 7863 2929 0a20 2020 2020 2020 2073   exc)).        s
-00019470: 7973 2e65 7863 6570 7468 6f6f 6b28 2a73  ys.excepthook(*s
-00019480: 7973 2e65 7863 5f69 6e66 6f28 2929 0a20  ys.exc_info()). 
-00019490: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000194a0: 6e65 0a0a 0a64 6566 2074 7279 5f67 6574  ne...def try_get
-000194b0: 5f73 7461 636b 5f66 7261 6d65 2864 6570  _stack_frame(dep
-000194c0: 7468 3d31 293a 0a20 2020 2022 2222 0a20  th=1):.    """. 
-000194d0: 2020 203a 7061 7261 6d20 696e 7420 6465     :param int de
-000194e0: 7074 683a 0a20 2020 203a 7274 7970 653a  pth:.    :rtype:
-000194f0: 2074 7970 6573 2e46 7261 6d65 5479 7065   types.FrameType
-00019500: 7c4e 6f6e 650a 2020 2020 3a72 6574 7572  |None.    :retur
-00019510: 6e3a 2063 616c 6c65 7220 6675 6e63 7469  n: caller functi
-00019520: 6f6e 206e 616d 652e 2074 6869 7320 6973  on name. this is
-00019530: 206a 7573 7420 666f 7220 6465 6275 6767   just for debugg
-00019540: 696e 670a 2020 2020 2222 220a 2020 2020  ing.    """.    
-00019550: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
-00019560: 7942 726f 6164 4578 6365 7074 696f 6e0a  yBroadException.
-00019570: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00019580: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
-00019590: 5079 5072 6f74 6563 7465 644d 656d 6265  PyProtectedMembe
-000195a0: 722c 5079 556e 7265 736f 6c76 6564 5265  r,PyUnresolvedRe
-000195b0: 6665 7265 6e63 6573 0a20 2020 2020 2020  ferences.       
-000195c0: 2066 7261 6d65 203d 2073 7973 2e5f 6765   frame = sys._ge
-000195d0: 7466 7261 6d65 2864 6570 7468 202b 2031  tframe(depth + 1
-000195e0: 2920 2023 206f 6e65 206d 6f72 6520 746f  )  # one more to
-000195f0: 2063 6f75 6e74 206f 7572 7365 6c76 6573   count ourselves
-00019600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019610: 6672 616d 650a 2020 2020 6578 6365 7074  frame.    except
-00019620: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00019630: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00019640: 0a0a 6465 6620 7472 795f 6765 745f 6361  ..def try_get_ca
-00019650: 6c6c 6572 5f6e 616d 6528 6465 7074 683d  ller_name(depth=
-00019660: 312c 2066 616c 6c62 6163 6b3d 4e6f 6e65  1, fallback=None
-00019670: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00019680: 7061 7261 6d20 696e 7420 6465 7074 683a  param int depth:
-00019690: 0a20 2020 203a 7061 7261 6d20 7374 727c  .    :param str|
-000196a0: 4e6f 6e65 2066 616c 6c62 6163 6b3a 2074  None fallback: t
-000196b0: 6869 7320 6973 2072 6574 7572 6e65 6420  his is returned 
-000196c0: 6966 2077 6520 6661 696c 2066 6f72 2073  if we fail for s
-000196d0: 6f6d 6520 7265 6173 6f6e 0a20 2020 203a  ome reason.    :
-000196e0: 7274 7970 653a 2073 7472 7c4e 6f6e 650a  rtype: str|None.
-000196f0: 2020 2020 3a72 6574 7572 6e3a 2063 616c      :return: cal
-00019700: 6c65 7220 6675 6e63 7469 6f6e 206e 616d  ler function nam
-00019710: 652e 2074 6869 7320 6973 206a 7573 7420  e. this is just 
-00019720: 666f 7220 6465 6275 6767 696e 670a 2020  for debugging.  
-00019730: 2020 2222 220a 2020 2020 6672 616d 6520    """.    frame 
-00019740: 3d20 7472 795f 6765 745f 7374 6163 6b5f  = try_get_stack_
-00019750: 6672 616d 6528 6465 7074 6820 2b20 3129  frame(depth + 1)
-00019760: 2020 2320 6f6e 6520 6d6f 7265 2074 6f20    # one more to 
-00019770: 636f 756e 7420 6f75 7273 656c 7665 730a  count ourselves.
-00019780: 2020 2020 6966 2066 7261 6d65 3a0a 2020      if frame:.  
-00019790: 2020 2020 2020 6672 6f6d 202e 6265 7474        from .bett
-000197a0: 6572 5f65 7863 686f 6f6b 2069 6d70 6f72  er_exchook impor
-000197b0: 7420 6765 745f 6675 6e63 5f73 7472 5f66  t get_func_str_f
-000197c0: 726f 6d5f 636f 6465 5f6f 626a 6563 740a  rom_code_object.
-000197d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000197e0: 6765 745f 6675 6e63 5f73 7472 5f66 726f  get_func_str_fro
-000197f0: 6d5f 636f 6465 5f6f 626a 6563 7428 6672  m_code_object(fr
-00019800: 616d 652e 665f 636f 6465 290a 2020 2020  ame.f_code).    
-00019810: 7265 7475 726e 2066 616c 6c62 6163 6b0a  return fallback.
-00019820: 0a0a 636c 6173 7320 496e 6669 6e69 7465  ..class Infinite
-00019830: 5265 6375 7273 696f 6e44 6574 6563 7465  RecursionDetecte
-00019840: 6428 4578 6365 7074 696f 6e29 3a0a 2020  d(Exception):.  
-00019850: 2020 2222 220a 2020 2020 5261 6973 6564    """.    Raised
-00019860: 2077 6865 6e20 616e 2069 6e66 696e 6974   when an infinit
-00019870: 6520 7265 6375 7273 696f 6e20 6973 2064  e recursion is d
-00019880: 6574 6563 7465 642c 2062 7920 6775 6172  etected, by guar
-00019890: 645f 696e 6669 6e69 7465 5f72 6563 7572  d_infinite_recur
-000198a0: 7369 6f6e 2e0a 2020 2020 2222 220a 0a0a  sion..    """...
-000198b0: 5f67 7561 7264 5f69 6e66 696e 6974 655f  _guard_infinite_
-000198c0: 7265 6375 7273 696f 6e5f 6361 6368 6520  recursion_cache 
-000198d0: 3d20 7468 7265 6164 696e 672e 6c6f 6361  = threading.loca
-000198e0: 6c28 290a 0a0a 4063 6f6e 7465 7874 6c69  l()...@contextli
-000198f0: 622e 636f 6e74 6578 746d 616e 6167 6572  b.contextmanager
-00019900: 0a64 6566 2067 7561 7264 5f69 6e66 696e  .def guard_infin
-00019910: 6974 655f 7265 6375 7273 696f 6e28 2a61  ite_recursion(*a
-00019920: 7267 7329 3a0a 2020 2020 2222 220a 2020  rgs):.    """.  
-00019930: 2020 5265 6769 7374 6572 7320 6172 6773    Registers args
-00019940: 2028 636f 756c 6420 6265 2066 756e 6320   (could be func 
-00019950: 2b20 6172 6773 2920 696e 2073 6f6d 6520  + args) in some 
-00019960: 6361 6368 652e 0a20 2020 2049 6620 7468  cache..    If th
-00019970: 6f73 6520 6172 6773 2061 7265 2061 6c72  ose args are alr
-00019980: 6561 6479 2069 6e20 7468 6520 6361 6368  eady in the cach
-00019990: 652c 2069 7420 7769 6c6c 2072 6169 7365  e, it will raise
-000199a0: 2061 6e20 6578 6365 7074 696f 6e2e 0a0a   an exception...
-000199b0: 2020 2020 4974 2077 696c 6c20 7573 6520      It will use 
-000199c0: 7468 6520 6964 206f 6620 7468 6520 6172  the id of the ar
-000199d0: 6773 2061 7320 6b65 7920 616e 6420 6e6f  gs as key and no
-000199e0: 7420 7573 6520 616e 7920 6861 7368 696e  t use any hashin
-000199f0: 670a 2020 2020 746f 2061 6c6c 6f77 2074  g.    to allow t
-00019a00: 6861 7420 6775 6172 645f 696e 6669 6e69  hat guard_infini
-00019a10: 7465 5f72 6563 7572 7369 6f6e 2063 616e  te_recursion can
-00019a20: 2062 6520 7573 6564 0a20 2020 2074 6f20   be used.    to 
-00019a30: 6775 6172 6420 6375 7374 6f6d 205f 5f68  guard custom __h
-00019a40: 6173 685f 5f20 696d 706c 656d 656e 7461  ash__ implementa
-00019a50: 7469 6f6e 7320 6173 2077 656c 6c2e 0a20  tions as well.. 
-00019a60: 2020 2022 2222 0a20 2020 2069 6620 6e6f     """.    if no
-00019a70: 7420 6172 6773 3a0a 2020 2020 2020 2020  t args:.        
-00019a80: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00019a90: 2822 6775 6172 645f 696e 6669 6e69 7465  ("guard_infinite
-00019aa0: 5f72 6563 7572 7369 6f6e 206e 6565 6473  _recursion needs
-00019ab0: 2061 7420 6c65 6173 7420 6f6e 6520 6172   at least one ar
-00019ac0: 6722 290a 2020 2020 6b65 7920 3d20 7475  g").    key = tu
-00019ad0: 706c 6528 6964 2861 7267 2920 666f 7220  ple(id(arg) for 
-00019ae0: 6172 6720 696e 2061 7267 7329 0a20 2020  arg in args).   
-00019af0: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00019b00: 5f67 7561 7264 5f69 6e66 696e 6974 655f  _guard_infinite_
-00019b10: 7265 6375 7273 696f 6e5f 6361 6368 652c  recursion_cache,
-00019b20: 2022 6361 6368 6522 293a 0a20 2020 2020   "cache"):.     
-00019b30: 2020 205f 6775 6172 645f 696e 6669 6e69     _guard_infini
-00019b40: 7465 5f72 6563 7572 7369 6f6e 5f63 6163  te_recursion_cac
-00019b50: 6865 2e63 6163 6865 203d 2073 6574 2829  he.cache = set()
-00019b60: 0a20 2020 2069 6620 6b65 7920 696e 205f  .    if key in _
-00019b70: 6775 6172 645f 696e 6669 6e69 7465 5f72  guard_infinite_r
-00019b80: 6563 7572 7369 6f6e 5f63 6163 6865 2e63  ecursion_cache.c
-00019b90: 6163 6865 3a0a 2020 2020 2020 2020 7261  ache:.        ra
-00019ba0: 6973 6520 496e 6669 6e69 7465 5265 6375  ise InfiniteRecu
-00019bb0: 7273 696f 6e44 6574 6563 7465 6428 2269  rsionDetected("i
-00019bc0: 6e66 696e 6974 6520 7265 6375 7273 696f  nfinite recursio
-00019bd0: 6e20 6465 7465 6374 6564 2229 0a20 2020  n detected").   
-00019be0: 205f 6775 6172 645f 696e 6669 6e69 7465   _guard_infinite
-00019bf0: 5f72 6563 7572 7369 6f6e 5f63 6163 6865  _recursion_cache
-00019c00: 2e63 6163 6865 2e61 6464 286b 6579 290a  .cache.add(key).
-00019c10: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00019c20: 2079 6965 6c64 0a20 2020 2066 696e 616c   yield.    final
-00019c30: 6c79 3a0a 2020 2020 2020 2020 5f67 7561  ly:.        _gua
-00019c40: 7264 5f69 6e66 696e 6974 655f 7265 6375  rd_infinite_recu
-00019c50: 7273 696f 6e5f 6361 6368 652e 6361 6368  rsion_cache.cach
-00019c60: 652e 7265 6d6f 7665 286b 6579 290a 0a0a  e.remove(key)...
-00019c70: 6465 6620 6361 6d65 6c5f 6361 7365 5f74  def camel_case_t
-00019c80: 6f5f 736e 616b 655f 6361 7365 286e 616d  o_snake_case(nam
-00019c90: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-00019ca0: 3a70 6172 616d 2073 7472 206e 616d 653a  :param str name:
-00019cb0: 2065 2e67 2e20 2243 616d 656c 4361 7365   e.g. "CamelCase
-00019cc0: 220a 2020 2020 3a72 6574 7572 6e3a 2065  ".    :return: e
-00019cd0: 2e67 2e20 2263 616d 656c 5f63 6173 6522  .g. "camel_case"
-00019ce0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
-00019cf0: 0a20 2020 2022 2222 0a20 2020 2073 3120  .    """.    s1 
-00019d00: 3d20 7265 2e73 7562 2822 282e 2928 5b41  = re.sub("(.)([A
-00019d10: 2d5a 5d5b 612d 7a5d 2b29 222c 2072 225c  -Z][a-z]+)", r"\
-00019d20: 315f 5c32 222c 206e 616d 6529 0a20 2020  1_\2", name).   
-00019d30: 2072 6574 7572 6e20 7265 2e73 7562 2822   return re.sub("
-00019d40: 285b 612d 7a30 2d39 5d29 285b 412d 5a5d  ([a-z0-9])([A-Z]
-00019d50: 2922 2c20 7222 5c31 5f5c 3222 2c20 7331  )", r"\1_\2", s1
-00019d60: 292e 6c6f 7765 7228 290a 0a0a 6465 6620  ).lower()...def 
-00019d70: 6765 745f 686f 7374 6e61 6d65 2829 3a0a  get_hostname():.
-00019d80: 2020 2020 2222 220a 2020 2020 3a72 6574      """.    :ret
-00019d90: 7572 6e3a 2065 2e67 2e20 2263 6c75 7374  urn: e.g. "clust
-00019da0: 6572 2d63 6e2d 3231 3122 0a20 2020 203a  er-cn-211".    :
-00019db0: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
-00019dc0: 2222 0a20 2020 2023 2063 6865 636b 5f6f  "".    # check_o
-00019dd0: 7574 7075 7428 5b22 686f 7374 6e61 6d65  utput(["hostname
-00019de0: 225d 292e 7374 7269 7028 292e 6465 636f  "]).strip().deco
-00019df0: 6465 2822 7574 6638 2229 0a20 2020 2069  de("utf8").    i
-00019e00: 6d70 6f72 7420 736f 636b 6574 0a0a 2020  mport socket..  
-00019e10: 2020 7265 7475 726e 2073 6f63 6b65 742e    return socket.
-00019e20: 6765 7468 6f73 746e 616d 6528 290a 0a0a  gethostname()...
-00019e30: 6465 6620 6973 5f72 756e 6e69 6e67 5f6f  def is_running_o
-00019e40: 6e5f 636c 7573 7465 7228 293a 0a20 2020  n_cluster():.   
-00019e50: 2022 2222 0a20 2020 203a 7265 7475 726e   """.    :return
-00019e60: 3a20 6936 2073 7065 6369 6669 632e 2057  : i6 specific. W
-00019e70: 6865 7468 6572 2077 6520 7275 6e20 6f6e  hether we run on
-00019e80: 2073 6f6d 6520 6f66 2074 6865 2063 6c75   some of the clu
-00019e90: 7374 6572 206e 6f64 6573 2e0a 2020 2020  ster nodes..    
-00019ea0: 3a72 7479 7065 3a20 626f 6f6c 0a20 2020  :rtype: bool.   
-00019eb0: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
-00019ec0: 6765 745f 686f 7374 6e61 6d65 2829 2e73  get_hostname().s
-00019ed0: 7461 7274 7377 6974 6828 2263 6c75 7374  tartswith("clust
-00019ee0: 6572 2d63 6e2d 2229 206f 7220 6765 745f  er-cn-") or get_
-00019ef0: 686f 7374 6e61 6d65 2829 2e73 7461 7274  hostname().start
-00019f00: 7377 6974 6828 2263 6e2d 2229 0a0a 0a73  swith("cn-")...s
-00019f10: 7461 7274 5f74 696d 6520 3d20 7469 6d65  tart_time = time
-00019f20: 2e74 696d 6528 290a 0a0a 6465 6620 6765  .time()...def ge
-00019f30: 745f 7574 635f 7374 6172 745f 7469 6d65  t_utc_start_time
-00019f40: 5f66 696c 656e 616d 655f 7061 7274 2829  _filename_part()
-00019f50: 3a0a 2020 2020 2222 220a 2020 2020 3a72  :.    """.    :r
-00019f60: 6574 7572 6e3a 2073 7472 696e 6720 7768  eturn: string wh
-00019f70: 6963 6820 6361 6e20 6265 2075 7365 6420  ich can be used 
-00019f80: 6173 2070 6172 7420 6f66 2061 2066 696c  as part of a fil
-00019f90: 656e 616d 652c 2077 6869 6368 2072 6570  ename, which rep
-00019fa0: 7265 7365 6e74 7320 7468 6520 7374 6172  resents the star
-00019fb0: 7420 7469 6d65 206f 6620 5245 5455 524e  t time of RETURN
-00019fc0: 4e20 696e 2055 5443 0a20 2020 203a 7274  N in UTC.    :rt
-00019fd0: 7970 653a 2073 7472 0a20 2020 2022 2222  ype: str.    """
-00019fe0: 0a20 2020 2072 6574 7572 6e20 7469 6d65  .    return time
-00019ff0: 2e73 7472 6674 696d 6528 2225 592d 256d  .strftime("%Y-%m
-0001a000: 2d25 642d 2548 2d25 4d2d 2553 222c 2074  -%d-%H-%M-%S", t
-0001a010: 696d 652e 676d 7469 6d65 2873 7461 7274  ime.gmtime(start
-0001a020: 5f74 696d 6529 290a 0a0a 6465 6620 6d61  _time))...def ma
-0001a030: 7962 655f 6d61 6b65 5f64 6972 7328 6469  ybe_make_dirs(di
-0001a040: 726e 616d 6529 3a0a 2020 2020 2222 220a  rname):.    """.
-0001a050: 2020 2020 4372 6561 7465 7320 7468 6520      Creates the 
-0001a060: 6469 7265 6374 6f72 7920 6966 2069 7420  directory if it 
-0001a070: 646f 6573 206e 6f74 2079 6574 2065 7869  does not yet exi
-0001a080: 7374 2e0a 0a20 2020 203a 7061 7261 6d20  st...    :param 
-0001a090: 7374 7220 6469 726e 616d 653a 2054 6865  str dirname: The
-0001a0a0: 2070 6174 6820 6f66 2074 6865 2064 6972   path of the dir
-0001a0b0: 6563 746f 7279 0a20 2020 2022 2222 0a20  ectory.    """. 
-0001a0c0: 2020 2069 6d70 6f72 7420 6f73 0a0a 2020     import os..  
-0001a0d0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-0001a0e0: 2e65 7869 7374 7328 6469 726e 616d 6529  .exists(dirname)
-0001a0f0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-0001a100: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-0001a110: 6b65 6469 7273 2864 6972 6e61 6d65 290a  kedirs(dirname).
-0001a120: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-0001a130: 7863 6570 7469 6f6e 2061 7320 6578 633a  xception as exc:
-0001a140: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001a150: 6e74 2822 6d61 7962 655f 6372 6561 7465  nt("maybe_create
-0001a160: 5f66 6f6c 6465 723a 2065 7863 6570 7469  _folder: excepti
-0001a170: 6f6e 2063 7265 6174 696e 6720 6469 723a  on creating dir:
-0001a180: 222c 2065 7863 290a 2020 2020 2020 2020  ", exc).        
-0001a190: 2020 2020 2320 4d61 7962 6520 6120 636f      # Maybe a co
-0001a1a0: 6e63 7572 7265 6e74 2070 726f 6365 7373  ncurrent process
-0001a1b0: 2c20 652e 672e 2074 662e 636f 6d70 6174  , e.g. tf.compat
-0001a1c0: 2e76 312e 7375 6d6d 6172 792e 4669 6c65  .v1.summary.File
-0001a1d0: 5772 6974 6572 2063 7265 6174 6564 2069  Writer created i
-0001a1e0: 7420 696e 2074 6865 206d 6561 6e2d 7768  t in the mean-wh
-0001a1f0: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
-0001a200: 2023 2073 6f20 7468 656e 2069 7420 776f   # so then it wo
-0001a210: 756c 6420 6265 206f 6b20 6e6f 7720 6966  uld be ok now if
-0001a220: 2069 7420 6578 6973 7473 2c20 6275 7420   it exists, but 
-0001a230: 6661 696c 2069 6620 6974 2064 6f65 7320  fail if it does 
-0001a240: 6e6f 7420 6578 6973 742e 0a20 2020 2020  not exist..     
-0001a250: 2020 2020 2020 2061 7373 6572 7420 6f73         assert os
-0001a260: 2e70 6174 682e 6578 6973 7473 2864 6972  .path.exists(dir
-0001a270: 6e61 6d65 290a 0a0a 6465 6620 6c6f 675f  name)...def log_
-0001a280: 7275 6e74 696d 655f 696e 666f 5f74 6f5f  runtime_info_to_
-0001a290: 6469 7228 7061 7468 2c20 636f 6e66 6967  dir(path, config
-0001a2a0: 293a 0a20 2020 2022 2222 0a20 2020 2054  ):.    """.    T
-0001a2b0: 6869 7320 7769 6c6c 2077 7269 7465 206d  his will write m
-0001a2c0: 756c 7469 706c 6520 6c6f 6767 696e 6720  ultiple logging 
-0001a2d0: 696e 666f 726d 6174 696f 6e20 696e 746f  information into
-0001a2e0: 2074 6865 2070 6174 682e 0a20 2020 2049   the path..    I
-0001a2f0: 7420 7769 6c6c 2063 7265 6174 6520 7265  t will create re
-0001a300: 7475 726e 6e2e 2a2e 6c6f 6720 7769 7468  turnn.*.log with
-0001a310: 2073 6f6d 6520 6d65 7461 2069 6e66 6f72   some meta infor
-0001a320: 6d61 7469 6f6e 2c0a 2020 2020 6173 2077  mation,.    as w
-0001a330: 656c 6c20 6173 2063 6f70 7920 7468 6520  ell as copy the 
-0001a340: 7573 6564 2063 6f6e 6669 6720 6669 6c65  used config file
-0001a350: 2e0a 0a20 2020 203a 7061 7261 6d20 7374  ...    :param st
-0001a360: 7220 7061 7468 3a20 6469 7265 6374 6f72  r path: director
-0001a370: 7920 7061 7468 0a20 2020 203a 7061 7261  y path.    :para
-0001a380: 6d20 7265 7475 726e 6e2e 636f 6e66 6967  m returnn.config
-0001a390: 2e43 6f6e 6669 6720 636f 6e66 6967 3a0a  .Config config:.
-0001a3a0: 2020 2020 2222 220a 2020 2020 696d 706f      """.    impo
-0001a3b0: 7274 206f 730a 2020 2020 696d 706f 7274  rt os.    import
-0001a3c0: 2073 7973 0a20 2020 2069 6d70 6f72 7420   sys.    import 
-0001a3d0: 7368 7574 696c 0a20 2020 2066 726f 6d20  shutil.    from 
-0001a3e0: 7265 7475 726e 6e2e 636f 6e66 6967 2069  returnn.config i
-0001a3f0: 6d70 6f72 7420 436f 6e66 6967 0a0a 2020  mport Config..  
-0001a400: 2020 7472 793a 0a20 2020 2020 2020 2068    try:.        h
-0001a410: 6f73 746e 616d 6520 3d20 6765 745f 686f  ostname = get_ho
-0001a420: 7374 6e61 6d65 2829 0a20 2020 2020 2020  stname().       
-0001a430: 2063 6f6e 7465 6e74 203d 205b 0a20 2020   content = [.   
-0001a440: 2020 2020 2020 2020 2022 5469 6d65 3a20           "Time: 
-0001a450: 2573 2220 2520 7469 6d65 2e73 7472 6674  %s" % time.strft
-0001a460: 696d 6528 2225 592d 256d 2d25 6420 2548  ime("%Y-%m-%d %H
-0001a470: 3a25 4d3a 2553 222c 2074 696d 652e 676d  :%M:%S", time.gm
-0001a480: 7469 6d65 2873 7461 7274 5f74 696d 6529  time(start_time)
-0001a490: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
-0001a4a0: 4361 6c6c 3a20 2573 2220 2520 2873 7973  Call: %s" % (sys
-0001a4b0: 2e61 7267 762c 292c 0a20 2020 2020 2020  .argv,),.       
-0001a4c0: 2020 2020 2022 5061 7468 3a20 2573 2220       "Path: %s" 
-0001a4d0: 2520 286f 732e 6765 7463 7764 2829 2c29  % (os.getcwd(),)
-0001a4e0: 2c0a 2020 2020 2020 2020 2020 2020 2248  ,.            "H
-0001a4f0: 6f73 746e 616d 653a 2025 7322 2025 2067  ostname: %s" % g
-0001a500: 6574 5f68 6f73 746e 616d 6528 292c 0a20  et_hostname(),. 
-0001a510: 2020 2020 2020 2020 2020 2022 5049 443a             "PID:
-0001a520: 2025 6922 2025 206f 732e 6765 7470 6964   %i" % os.getpid
-0001a530: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0001a540: 2252 6574 7572 6e6e 3a20 2573 2220 2520  "Returnn: %s" % 
-0001a550: 2864 6573 6372 6962 655f 7265 7475 726e  (describe_return
-0001a560: 6e5f 7665 7273 696f 6e28 292c 292c 0a20  n_version(),),. 
-0001a570: 2020 2020 2020 2020 2020 2022 5465 6e73             "Tens
-0001a580: 6f72 466c 6f77 3a20 2573 2220 2520 2864  orFlow: %s" % (d
-0001a590: 6573 6372 6962 655f 7465 6e73 6f72 666c  escribe_tensorfl
-0001a5a0: 6f77 5f76 6572 7369 6f6e 2829 2c29 2c0a  ow_version(),),.
-0001a5b0: 2020 2020 2020 2020 2020 2020 2243 6f6e              "Con
-0001a5c0: 6669 6720 6669 6c65 733a 2025 7322 2025  fig files: %s" %
-0001a5d0: 2028 636f 6e66 6967 2e66 696c 6573 2c29   (config.files,)
-0001a5e0: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
-0001a5f0: 2020 2020 6d61 7962 655f 6d61 6b65 5f64      maybe_make_d
-0001a600: 6972 7328 7061 7468 290a 2020 2020 2020  irs(path).      
-0001a610: 2020 6c6f 675f 666e 203d 2022 2573 2f72    log_fn = "%s/r
-0001a620: 6574 7572 6e6e 2e25 732e 2573 2e25 692e  eturnn.%s.%s.%i.
-0001a630: 6c6f 6722 2025 2028 7061 7468 2c20 6765  log" % (path, ge
-0001a640: 745f 7574 635f 7374 6172 745f 7469 6d65  t_utc_start_time
-0001a650: 5f66 696c 656e 616d 655f 7061 7274 2829  _filename_part()
-0001a660: 2c20 686f 7374 6e61 6d65 2c20 6f73 2e67  , hostname, os.g
-0001a670: 6574 7069 6428 2929 0a20 2020 2020 2020  etpid()).       
-0001a680: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-0001a690: 6578 6973 7473 286c 6f67 5f66 6e29 3a0a  exists(log_fn):.
-0001a6a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001a6b0: 206f 7065 6e28 6c6f 675f 666e 2c20 2277   open(log_fn, "w
-0001a6c0: 2229 2061 7320 663a 0a20 2020 2020 2020  ") as f:.       
-0001a6d0: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-0001a6e0: 2822 5265 7475 726e 6e20 6c6f 6720 6669  ("Returnn log fi
-0001a6f0: 6c65 3a5c 6e22 202b 2022 222e 6a6f 696e  le:\n" + "".join
-0001a700: 285b 2225 735c 6e22 2025 2073 2066 6f72  (["%s\n" % s for
-0001a710: 2073 2069 6e20 636f 6e74 656e 745d 2920   s in content]) 
-0001a720: 2b20 225c 6e22 290a 2020 2020 2020 2020  + "\n").        
-0001a730: 666f 7220 666e 2069 6e20 636f 6e66 6967  for fn in config
-0001a740: 2e66 696c 6573 3a0a 2020 2020 2020 2020  .files:.        
-0001a750: 2020 2020 6261 7365 5f66 6e20 3d20 6f73      base_fn = os
-0001a760: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
-0001a770: 6e29 0a20 2020 2020 2020 2020 2020 2074  n).            t
-0001a780: 6172 6765 745f 666e 203d 2022 2573 2f25  arget_fn = "%s/%
-0001a790: 7322 2025 2028 7061 7468 2c20 6261 7365  s" % (path, base
-0001a7a0: 5f66 6e29 0a20 2020 2020 2020 2020 2020  _fn).           
-0001a7b0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-0001a7c0: 7473 2874 6172 6765 745f 666e 293a 0a20  ts(target_fn):. 
-0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001a7e0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0001a7f0: 2020 2020 7368 7574 696c 2e63 6f70 7928      shutil.copy(
-0001a800: 666e 2c20 7461 7267 6574 5f66 6e29 0a20  fn, target_fn). 
-0001a810: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0001a820: 675f 7479 7065 203d 2043 6f6e 6669 672e  g_type = Config.
-0001a830: 6765 745f 636f 6e66 6967 5f66 696c 655f  get_config_file_
-0001a840: 7479 7065 2866 6e29 0a20 2020 2020 2020  type(fn).       
-0001a850: 2020 2020 2063 6f6d 6d65 6e74 5f70 7265       comment_pre
-0001a860: 6669 7820 3d20 2223 220a 2020 2020 2020  fix = "#".      
-0001a870: 2020 2020 2020 6966 2063 6f6e 6669 675f        if config_
-0001a880: 7479 7065 203d 3d20 226a 7322 3a0a 2020  type == "js":.  
-0001a890: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001a8a0: 6d6d 656e 745f 7072 6566 6978 203d 2022  mment_prefix = "
-0001a8b0: 2f2f 220a 2020 2020 2020 2020 2020 2020  //".            
-0001a8c0: 7769 7468 206f 7065 6e28 7461 7267 6574  with open(target
-0001a8d0: 5f66 6e2c 2022 6122 2920 6173 2066 3a0a  _fn, "a") as f:.
-0001a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8f0: 662e 7772 6974 6528 0a20 2020 2020 2020  f.write(.       
-0001a900: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
-0001a910: 5c6e 5c6e 220a 2020 2020 2020 2020 2020  \n\n".          
-0001a920: 2020 2020 2020 2020 2020 2b20 2222 2e6a            + "".j
-0001a930: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-0001a940: 2020 2020 2020 2020 2020 2020 205b 2225               ["%
-0001a950: 7320 436f 6e66 6967 2d66 696c 6520 636f  s Config-file co
-0001a960: 7069 6564 2066 6f72 206c 6f67 6769 6e67  pied for logging
-0001a970: 2070 7572 706f 7365 2062 7920 5265 7475   purpose by Retu
-0001a980: 726e 6e2e 5c6e 2220 2520 636f 6d6d 656e  rnn.\n" % commen
-0001a990: 745f 7072 6566 6978 5d0a 2020 2020 2020  t_prefix].      
+00010230: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+00010240: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00010250: 6f74 6865 722e 7661 6c75 6520 6973 206e  other.value is n
+00010260: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00010270: 2020 2020 2020 2020 2069 6620 636d 7028           if cmp(
+00010280: 7365 6c66 5b6b 6579 5d2c 206f 7468 6572  self[key], other
+00010290: 2e76 616c 7565 293a 0a20 2020 2020 2020  .value):.       
+000102a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000102b0: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+000102c0: 2069 6620 7365 6c66 2e76 616c 7565 2069   if self.value i
+000102d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206f  s not None and o
+000102e0: 7468 6572 2e76 616c 7565 2069 7320 6e6f  ther.value is no
+000102f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00010300: 2020 2020 6966 2063 6d70 2873 656c 662e      if cmp(self.
+00010310: 7661 6c75 652c 206f 7468 6572 2e76 616c  value, other.val
+00010320: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
+00010330: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00010340: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00010350: 4661 6c73 650a 0a20 2020 2040 7374 6174  False..    @stat
+00010360: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00010370: 205f 6d61 7828 2a61 7267 7329 3a0a 2020   _max(*args):.  
+00010380: 2020 2020 2020 6172 6773 203d 205b 6120        args = [a 
+00010390: 666f 7220 6120 696e 2061 7267 7320 6966  for a in args if
+000103a0: 2061 2069 7320 6e6f 7420 4e6f 6e65 5d0a   a is not None].
+000103b0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
+000103c0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000103d0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+000103e0: 2020 2020 2069 6620 6c65 6e28 6172 6773       if len(args
+000103f0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00010400: 2020 2020 7265 7475 726e 2061 7267 735b      return args[
+00010410: 305d 0a20 2020 2020 2020 2072 6574 7572  0].        retur
+00010420: 6e20 6d61 7828 2a61 7267 7329 0a0a 2020  n max(*args)..  
+00010430: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00010440: 2020 2020 6465 6620 5f6d 696e 282a 6172      def _min(*ar
+00010450: 6773 293a 0a20 2020 2020 2020 2061 7267  gs):.        arg
+00010460: 7320 3d20 5b61 2066 6f72 2061 2069 6e20  s = [a for a in 
+00010470: 6172 6773 2069 6620 6120 6973 206e 6f74  args if a is not
+00010480: 204e 6f6e 655d 0a20 2020 2020 2020 2069   None].        i
+00010490: 6620 6e6f 7420 6172 6773 3a0a 2020 2020  f not args:.    
+000104a0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+000104b0: 6f6e 650a 2020 2020 2020 2020 6966 206c  one.        if l
+000104c0: 656e 2861 7267 7329 203d 3d20 313a 0a20  en(args) == 1:. 
+000104d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000104e0: 6e20 6172 6773 5b30 5d0a 2020 2020 2020  n args[0].      
+000104f0: 2020 7265 7475 726e 206d 696e 282a 6172    return min(*ar
+00010500: 6773 290a 0a20 2020 2040 636c 6173 736d  gs)..    @classm
+00010510: 6574 686f 640a 2020 2020 6465 6620 6d61  ethod.    def ma
+00010520: 7828 636c 732c 2069 7465 6d73 293a 0a20  x(cls, items):. 
+00010530: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00010540: 2020 2045 6c65 6d65 6e74 2d77 6973 6520     Element-wise 
+00010550: 6d61 7869 6d75 6d20 666f 7220 6974 656d  maximum for item
+00010560: 2069 6e20 6974 656d 732e 0a20 2020 2020   in items..     
+00010570: 2020 203a 7061 7261 6d20 6c69 7374 5b4e     :param list[N
+00010580: 756d 6265 7273 4469 6374 7c69 6e74 7c66  umbersDict|int|f
+00010590: 6c6f 6174 5d20 6974 656d 733a 0a20 2020  loat] items:.   
+000105a0: 2020 2020 203a 7274 7970 653a 204e 756d       :rtype: Num
+000105b0: 6265 7273 4469 6374 0a20 2020 2020 2020  bersDict.       
+000105c0: 2022 2222 0a20 2020 2020 2020 2061 7373   """.        ass
+000105d0: 6572 7420 6974 656d 730a 2020 2020 2020  ert items.      
+000105e0: 2020 6966 206c 656e 2869 7465 6d73 2920    if len(items) 
+000105f0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00010600: 2020 7265 7475 726e 204e 756d 6265 7273    return Numbers
+00010610: 4469 6374 2869 7465 6d73 5b30 5d29 0a20  Dict(items[0]). 
+00010620: 2020 2020 2020 2069 6620 6c65 6e28 6974         if len(it
+00010630: 656d 7329 203d 3d20 323a 0a20 2020 2020  ems) == 2:.     
+00010640: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+00010650: 732e 6269 6e5f 6f70 2869 7465 6d73 5b30  s.bin_op(items[0
+00010660: 5d2c 2069 7465 6d73 5b31 5d2c 206f 703d  ], items[1], op=
+00010670: 636c 732e 5f6d 6178 2c20 7a65 726f 3d4e  cls._max, zero=N
+00010680: 6f6e 6529 0a20 2020 2020 2020 2072 6574  one).        ret
+00010690: 7572 6e20 636c 732e 6d61 7828 5b69 7465  urn cls.max([ite
+000106a0: 6d73 5b30 5d2c 2063 6c73 2e6d 6178 2869  ms[0], cls.max(i
+000106b0: 7465 6d73 5b31 3a5d 295d 290a 0a20 2020  tems[1:])])..   
+000106c0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+000106d0: 2020 6465 6620 6d69 6e28 636c 732c 2069    def min(cls, i
+000106e0: 7465 6d73 293a 0a20 2020 2020 2020 2022  tems):.        "
+000106f0: 2222 0a20 2020 2020 2020 2045 6c65 6d65  "".        Eleme
+00010700: 6e74 2d77 6973 6520 6d69 6e69 6d75 6d20  nt-wise minimum 
+00010710: 666f 7220 6974 656d 2069 6e20 6974 656d  for item in item
+00010720: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00010730: 6d20 6c69 7374 5b4e 756d 6265 7273 4469  m list[NumbersDi
+00010740: 6374 7c69 6e74 7c66 6c6f 6174 5d20 6974  ct|int|float] it
+00010750: 656d 733a 0a20 2020 2020 2020 203a 7274  ems:.        :rt
+00010760: 7970 653a 204e 756d 6265 7273 4469 6374  ype: NumbersDict
+00010770: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010780: 2020 2020 2061 7373 6572 7420 6974 656d       assert item
+00010790: 730a 2020 2020 2020 2020 6966 206c 656e  s.        if len
+000107a0: 2869 7465 6d73 2920 3d3d 2031 3a0a 2020  (items) == 1:.  
+000107b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000107c0: 204e 756d 6265 7273 4469 6374 2869 7465   NumbersDict(ite
+000107d0: 6d73 5b30 5d29 0a20 2020 2020 2020 2069  ms[0]).        i
+000107e0: 6620 6c65 6e28 6974 656d 7329 203d 3d20  f len(items) == 
+000107f0: 323a 0a20 2020 2020 2020 2020 2020 2072  2:.            r
+00010800: 6574 7572 6e20 636c 732e 6269 6e5f 6f70  eturn cls.bin_op
+00010810: 2869 7465 6d73 5b30 5d2c 2069 7465 6d73  (items[0], items
+00010820: 5b31 5d2c 206f 703d 636c 732e 5f6d 696e  [1], op=cls._min
+00010830: 2c20 7a65 726f 3d4e 6f6e 6529 0a20 2020  , zero=None).   
+00010840: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
+00010850: 6d69 6e28 5b69 7465 6d73 5b30 5d2c 2063  min([items[0], c
+00010860: 6c73 2e6d 696e 2869 7465 6d73 5b31 3a5d  ls.min(items[1:]
+00010870: 295d 290a 0a20 2020 2040 7374 6174 6963  )])..    @static
+00010880: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00010890: 6d61 785f 6572 726f 7228 293a 0a20 2020  max_error():.   
+000108a0: 2020 2020 2023 2057 696c 6c20 7265 706c       # Will repl
+000108b0: 6163 6520 7365 6c66 2e6d 6178 2066 6f72  ace self.max for
+000108c0: 2065 6163 6820 696e 7374 616e 6365 2e20   each instance. 
+000108d0: 546f 2062 6520 7375 7265 2074 6861 7420  To be sure that 
+000108e0: 7765 2064 6f6e 2774 2063 6f6e 6675 7365  we don't confuse
+000108f0: 2069 7420 7769 7468 2073 656c 662e 6d61   it with self.ma
+00010900: 785f 7661 6c75 652e 0a20 2020 2020 2020  x_value..       
+00010910: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00010920: 2822 5573 6520 6d61 785f 7661 6c75 6520  ("Use max_value 
+00010930: 696e 7374 6561 642e 2229 0a0a 2020 2020  instead.")..    
+00010940: 6465 6620 6d61 785f 7661 6c75 6528 7365  def max_value(se
+00010950: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00010960: 0a20 2020 2020 2020 204d 6178 696d 756d  .        Maximum
+00010970: 206f 6620 6f75 7220 7661 6c75 6573 2e0a   of our values..
+00010980: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010990: 2020 2020 7265 7475 726e 206d 6178 2873      return max(s
+000109a0: 656c 662e 7661 6c75 6573 2829 290a 0a20  elf.values()).. 
+000109b0: 2020 2064 6566 206d 696e 5f76 616c 7565     def min_value
+000109c0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000109d0: 2222 220a 2020 2020 2020 2020 4d69 6e69  """.        Mini
+000109e0: 6d75 6d20 6f66 206f 7572 2076 616c 7565  mum of our value
+000109f0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00010a00: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
+00010a10: 6e28 7365 6c66 2e76 616c 7565 7328 2929  n(self.values())
+00010a20: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+00010a30: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00010a40: 2020 6966 2073 656c 662e 7661 6c75 6520    if self.value 
+00010a50: 6973 204e 6f6e 6520 616e 6420 6e6f 7420  is None and not 
+00010a60: 7365 6c66 2e64 6963 743a 0a20 2020 2020  self.dict:.     
+00010a70: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
+00010a80: 7328 2922 2025 2073 656c 662e 5f5f 636c  s()" % self.__cl
+00010a90: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 0a20  ass__.__name__. 
+00010aa0: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
+00010ab0: 616c 7565 2069 7320 4e6f 6e65 2061 6e64  alue is None and
+00010ac0: 2073 656c 662e 6469 6374 3a0a 2020 2020   self.dict:.    
+00010ad0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00010ae0: 2573 2825 7229 2220 2520 2873 656c 662e  %s(%r)" % (self.
+00010af0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00010b00: 5f5f 2c20 7365 6c66 2e64 6963 7429 0a20  __, self.dict). 
+00010b10: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00010b20: 6c66 2e64 6963 7420 616e 6420 7365 6c66  lf.dict and self
+00010b30: 2e76 616c 7565 2069 7320 6e6f 7420 4e6f  .value is not No
+00010b40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00010b50: 7265 7475 726e 2022 2573 2825 7229 2220  return "%s(%r)" 
+00010b60: 2520 2873 656c 662e 5f5f 636c 6173 735f  % (self.__class_
+00010b70: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365 6c66  _.__name__, self
+00010b80: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
+00010b90: 7265 7475 726e 2022 2573 286e 756d 6265  return "%s(numbe
+00010ba0: 7273 5f64 6963 743d 2572 2c20 6272 6f61  rs_dict=%r, broa
+00010bb0: 6463 6173 745f 7661 6c75 653d 2572 2922  dcast_value=%r)"
+00010bc0: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
+00010bd0: 5f5f 2e5f 5f6e 616d 655f 5f2c 2073 656c  __.__name__, sel
+00010be0: 662e 6469 6374 2c20 7365 6c66 2e76 616c  f.dict, self.val
+00010bf0: 7565 290a 0a0a 6465 6620 636f 6c6c 6563  ue)...def collec
+00010c00: 745f 636c 6173 735f 696e 6974 5f6b 7761  t_class_init_kwa
+00010c10: 7267 7328 636c 732c 206f 6e6c 795f 7769  rgs(cls, only_wi
+00010c20: 7468 5f64 6566 6175 6c74 3d46 616c 7365  th_default=False
+00010c30: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00010c40: 7061 7261 6d20 7479 7065 2063 6c73 3a20  param type cls: 
+00010c50: 636c 6173 732c 2077 6865 7265 2069 7420  class, where it 
+00010c60: 6173 7375 6d65 7320 7468 6174 206b 7761  assumes that kwa
+00010c70: 7267 7320 6172 6520 7061 7373 6564 206f  rgs are passed o
+00010c80: 6e20 746f 2062 6173 6520 636c 6173 7365  n to base classe
+00010c90: 730a 2020 2020 3a70 6172 616d 2062 6f6f  s.    :param boo
+00010ca0: 6c20 6f6e 6c79 5f77 6974 685f 6465 6661  l only_with_defa
+00010cb0: 756c 743a 2069 6620 6769 7665 6e20 7769  ult: if given wi
+00010cc0: 6c6c 206f 6e6c 7920 7265 7475 726e 2074  ll only return t
+00010cd0: 6865 206b 7761 7267 7320 7769 7468 2064  he kwargs with d
+00010ce0: 6566 6175 6c74 2076 616c 7565 730a 2020  efault values.  
+00010cf0: 2020 3a72 6574 7572 6e3a 2073 6574 2069    :return: set i
+00010d00: 6620 6e6f 7420 7769 7468 5f64 6566 6175  f not with_defau
+00010d10: 6c74 2c20 6f74 6865 7277 6973 6520 7468  lt, otherwise th
+00010d20: 6520 6469 6374 2074 6f20 7468 6520 6465  e dict to the de
+00010d30: 6661 756c 7420 7661 6c75 6573 0a20 2020  fault values.   
+00010d40: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
+00010d50: 725d 207c 2064 6963 745b 7374 725d 0a20  r] | dict[str]. 
+00010d60: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
+00010d70: 636f 6c6c 6563 7469 6f6e 7320 696d 706f  collections impo
+00010d80: 7274 204f 7264 6572 6564 4469 6374 0a0a  rt OrderedDict..
+00010d90: 2020 2020 6966 206f 6e6c 795f 7769 7468      if only_with
+00010da0: 5f64 6566 6175 6c74 3a0a 2020 2020 2020  _default:.      
+00010db0: 2020 6b77 6172 6773 203d 204f 7264 6572    kwargs = Order
+00010dc0: 6564 4469 6374 2829 0a20 2020 2065 6c73  edDict().    els
+00010dd0: 653a 0a20 2020 2020 2020 206b 7761 7267  e:.        kwarg
+00010de0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2063  s = [].    for c
+00010df0: 6c73 5f20 696e 2069 6e73 7065 6374 2e67  ls_ in inspect.g
+00010e00: 6574 6d72 6f28 636c 7329 3a0a 2020 2020  etmro(cls):.    
+00010e10: 2020 2020 2320 4368 6563 6b20 5079 7468      # Check Pyth
+00010e20: 6f6e 2066 756e 6374 696f 6e2e 2043 6f75  on function. Cou
+00010e30: 6c64 2062 6520 6275 696c 7469 6e20 6675  ld be builtin fu
+00010e40: 6e63 206f 7220 736f 2e20 5079 7468 6f6e  nc or so. Python
+00010e50: 2032 2067 6574 6172 6773 7065 6320 646f   2 getargspec do
+00010e60: 6573 206e 6f74 2077 6f72 6b20 696e 2074  es not work in t
+00010e70: 6861 7420 6361 7365 2e0a 2020 2020 2020  hat case..      
+00010e80: 2020 6966 206e 6f74 2069 6e73 7065 6374    if not inspect
+00010e90: 2e69 736d 6574 686f 6428 636c 735f 2e5f  .ismethod(cls_._
+00010ea0: 5f69 6e69 745f 5f29 2061 6e64 206e 6f74  _init__) and not
+00010eb0: 2069 6e73 7065 6374 2e69 7366 756e 6374   inspect.isfunct
+00010ec0: 696f 6e28 636c 735f 2e5f 5f69 6e69 745f  ion(cls_.__init_
+00010ed0: 5f29 3a0a 2020 2020 2020 2020 2020 2020  _):.            
+00010ee0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00010ef0: 2061 7267 5f73 7065 6320 3d20 6765 7461   arg_spec = geta
+00010f00: 7267 7370 6563 2863 6c73 5f2e 5f5f 696e  rgspec(cls_.__in
+00010f10: 6974 5f5f 290a 2020 2020 2020 2020 6172  it__).        ar
+00010f20: 6773 203d 2061 7267 5f73 7065 632e 6172  gs = arg_spec.ar
+00010f30: 6773 5b31 3a5d 2020 2320 6669 7273 7420  gs[1:]  # first 
+00010f40: 6172 6720 6973 2073 656c 662c 2069 676e  arg is self, ign
+00010f50: 6f72 650a 2020 2020 2020 2020 6966 206f  ore.        if o
+00010f60: 6e6c 795f 7769 7468 5f64 6566 6175 6c74  nly_with_default
+00010f70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00010f80: 2061 7267 5f73 7065 632e 6465 6661 756c   arg_spec.defaul
+00010f90: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00010fa0: 2020 2020 6173 7365 7274 206c 656e 2861      assert len(a
+00010fb0: 7267 5f73 7065 632e 6465 6661 756c 7473  rg_spec.defaults
+00010fc0: 2920 3c3d 206c 656e 2861 7267 7329 0a20  ) <= len(args). 
+00010fd0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00010fe0: 7267 7320 3d20 6172 6773 5b6c 656e 2861  rgs = args[len(a
+00010ff0: 7267 7329 202d 206c 656e 2861 7267 5f73  rgs) - len(arg_s
+00011000: 7065 632e 6465 6661 756c 7473 2920 3a5d  pec.defaults) :]
+00011010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011020: 2061 7373 6572 7420 6c65 6e28 6172 675f   assert len(arg_
+00011030: 7370 6563 2e64 6566 6175 6c74 7329 203d  spec.defaults) =
+00011040: 3d20 6c65 6e28 6172 6773 292c 2061 7267  = len(args), arg
+00011050: 5f73 7065 630a 2020 2020 2020 2020 2020  _spec.          
+00011060: 2020 2020 2020 666f 7220 6172 672c 2064        for arg, d
+00011070: 6566 6175 6c74 2069 6e20 7a69 7028 6172  efault in zip(ar
+00011080: 6773 2c20 6172 675f 7370 6563 2e64 6566  gs, arg_spec.def
+00011090: 6175 6c74 7329 3a0a 2020 2020 2020 2020  aults):.        
+000110a0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+000110b0: 6773 5b61 7267 5d20 3d20 6465 6661 756c  gs[arg] = defaul
+000110c0: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
+000110d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000110e0: 6172 6720 696e 2061 7267 733a 0a20 2020  arg in args:.   
+000110f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011100: 6172 6720 6e6f 7420 696e 206b 7761 7267  arg not in kwarg
+00011110: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00011120: 2020 2020 2020 206b 7761 7267 732e 6170         kwargs.ap
+00011130: 7065 6e64 2861 7267 290a 2020 2020 7265  pend(arg).    re
+00011140: 7475 726e 206b 7761 7267 730a 0a0a 6465  turn kwargs...de
+00011150: 6620 6765 7461 7267 7370 6563 2866 756e  f getargspec(fun
+00011160: 6329 3a0a 2020 2020 2222 220a 2020 2020  c):.    """.    
+00011170: 3a66 756e 633a 6069 6e73 7065 6374 2e67  :func:`inspect.g
+00011180: 6574 6675 6c6c 6172 6773 7065 6360 206f  etfullargspec` o
+00011190: 7220 6069 6e73 7065 6374 2e67 6574 6172  r `inspect.getar
+000111a0: 6773 7065 6360 2028 5079 7468 6f6e 2032  gspec` (Python 2
+000111b0: 290a 0a20 2020 203a 7061 7261 6d20 6675  )..    :param fu
+000111c0: 6e63 3a0a 2020 2020 3a72 6574 7572 6e3a  nc:.    :return:
+000111d0: 2046 756c 6c41 7267 5370 6563 0a20 2020   FullArgSpec.   
+000111e0: 2022 2222 0a20 2020 2069 6620 5059 333a   """.    if PY3:
+000111f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011200: 696e 7370 6563 742e 6765 7466 756c 6c61  inspect.getfulla
+00011210: 7267 7370 6563 2866 756e 6329 0a20 2020  rgspec(func).   
+00011220: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
+00011230: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00011240: 4465 7072 6563 6174 696f 6e0a 2020 2020  Deprecation.    
+00011250: 2020 2020 7265 7475 726e 2069 6e73 7065      return inspe
+00011260: 6374 2e67 6574 6172 6773 7065 6328 6675  ct.getargspec(fu
+00011270: 6e63 290a 0a0a 6465 6620 636f 6c6c 6563  nc)...def collec
+00011280: 745f 6d61 6e64 6174 6f72 795f 636c 6173  t_mandatory_clas
+00011290: 735f 696e 6974 5f6b 7761 7267 7328 636c  s_init_kwargs(cl
+000112a0: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+000112b0: 3a70 6172 616d 2074 7970 6520 636c 733a  :param type cls:
+000112c0: 0a20 2020 203a 7265 7475 726e 3a20 6c69  .    :return: li
+000112d0: 7374 206f 6620 6b77 6172 6773 2077 6869  st of kwargs whi
+000112e0: 6368 2068 6176 6520 6e6f 2064 6566 6175  ch have no defau
+000112f0: 6c74 2c20 692e 652e 2077 6869 6368 206d  lt, i.e. which m
+00011300: 7573 7420 6265 2070 726f 7669 6465 640a  ust be provided.
+00011310: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
+00011320: 5b73 7472 5d0a 2020 2020 2222 220a 2020  [str].    """.  
+00011330: 2020 616c 6c5f 6b77 6172 6773 203d 2063    all_kwargs = c
+00011340: 6f6c 6c65 6374 5f63 6c61 7373 5f69 6e69  ollect_class_ini
+00011350: 745f 6b77 6172 6773 2863 6c73 2c20 6f6e  t_kwargs(cls, on
+00011360: 6c79 5f77 6974 685f 6465 6661 756c 743d  ly_with_default=
+00011370: 4661 6c73 6529 0a20 2020 2064 6566 6175  False).    defau
+00011380: 6c74 5f6b 7761 7267 7320 3d20 636f 6c6c  lt_kwargs = coll
+00011390: 6563 745f 636c 6173 735f 696e 6974 5f6b  ect_class_init_k
+000113a0: 7761 7267 7328 636c 732c 206f 6e6c 795f  wargs(cls, only_
+000113b0: 7769 7468 5f64 6566 6175 6c74 3d54 7275  with_default=Tru
+000113c0: 6529 0a20 2020 206d 616e 6461 746f 7279  e).    mandatory
+000113d0: 5f6b 7761 7267 7320 3d20 5b5d 0a20 2020  _kwargs = [].   
+000113e0: 2066 6f72 2061 7267 2069 6e20 616c 6c5f   for arg in all_
+000113f0: 6b77 6172 6773 3a0a 2020 2020 2020 2020  kwargs:.        
+00011400: 6966 2061 7267 206e 6f74 2069 6e20 6465  if arg not in de
+00011410: 6661 756c 745f 6b77 6172 6773 3a0a 2020  fault_kwargs:.  
+00011420: 2020 2020 2020 2020 2020 6d61 6e64 6174            mandat
+00011430: 6f72 795f 6b77 6172 6773 2e61 7070 656e  ory_kwargs.appen
+00011440: 6428 6172 6729 0a20 2020 2072 6574 7572  d(arg).    retur
+00011450: 6e20 6d61 6e64 6174 6f72 795f 6b77 6172  n mandatory_kwar
+00011460: 6773 0a0a 0a64 6566 2068 656c 705f 6f6e  gs...def help_on
+00011470: 5f74 7970 655f 6572 726f 725f 7772 6f6e  _type_error_wron
+00011480: 675f 6172 6773 2863 6c73 2c20 6b77 6172  g_args(cls, kwar
+00011490: 6773 293a 0a20 2020 2022 2222 0a20 2020  gs):.    """.   
+000114a0: 203a 7061 7261 6d20 7479 7065 2063 6c73   :param type cls
+000114b0: 3a0a 2020 2020 3a70 6172 616d 206c 6973  :.    :param lis
+000114c0: 745b 7374 725d 206b 7761 7267 733a 0a20  t[str] kwargs:. 
+000114d0: 2020 2022 2222 0a20 2020 206d 616e 6461     """.    manda
+000114e0: 746f 7279 5f61 7267 7320 3d20 636f 6c6c  tory_args = coll
+000114f0: 6563 745f 6d61 6e64 6174 6f72 795f 636c  ect_mandatory_cl
+00011500: 6173 735f 696e 6974 5f6b 7761 7267 7328  ass_init_kwargs(
+00011510: 636c 7329 0a20 2020 2066 6f72 2061 7267  cls).    for arg
+00011520: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
+00011530: 2020 2020 6966 2061 7267 2069 6e20 6d61      if arg in ma
+00011540: 6e64 6174 6f72 795f 6172 6773 3a0a 2020  ndatory_args:.  
+00011550: 2020 2020 2020 2020 2020 6d61 6e64 6174            mandat
+00011560: 6f72 795f 6172 6773 2e72 656d 6f76 6528  ory_args.remove(
+00011570: 6172 6729 0a20 2020 2061 6c6c 5f6b 7761  arg).    all_kwa
+00011580: 7267 7320 3d20 636f 6c6c 6563 745f 636c  rgs = collect_cl
+00011590: 6173 735f 696e 6974 5f6b 7761 7267 7328  ass_init_kwargs(
+000115a0: 636c 7329 0a20 2020 2075 6e6b 6e6f 776e  cls).    unknown
+000115b0: 5f61 7267 7320 3d20 5b5d 0a20 2020 2066  _args = [].    f
+000115c0: 6f72 2061 7267 2069 6e20 6b77 6172 6773  or arg in kwargs
+000115d0: 3a0a 2020 2020 2020 2020 6966 2061 7267  :.        if arg
+000115e0: 206e 6f74 2069 6e20 616c 6c5f 6b77 6172   not in all_kwar
+000115f0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00011600: 756e 6b6e 6f77 6e5f 6172 6773 2e61 7070  unknown_args.app
+00011610: 656e 6428 6172 6729 0a20 2020 2069 6620  end(arg).    if 
+00011620: 6d61 6e64 6174 6f72 795f 6172 6773 206f  mandatory_args o
+00011630: 7220 756e 6b6e 6f77 6e5f 6172 6773 3a0a  r unknown_args:.
+00011640: 2020 2020 2020 2020 7072 696e 7428 2241          print("A
+00011650: 7267 7320 6d69 736d 6174 6368 3f20 4d69  rgs mismatch? Mi
+00011660: 7373 696e 6720 6172 6520 2572 2c20 756e  ssing are %r, un
+00011670: 6b6e 6f77 6e73 2061 7265 2025 722e 204b  knowns are %r. K
+00011680: 7761 7267 7320 2572 2e22 2025 2028 6d61  wargs %r." % (ma
+00011690: 6e64 6174 6f72 795f 6172 6773 2c20 756e  ndatory_args, un
+000116a0: 6b6e 6f77 6e5f 6172 6773 2c20 6b77 6172  known_args, kwar
+000116b0: 6773 2929 0a0a 0a64 6566 2063 7573 746f  gs))...def custo
+000116c0: 6d5f 6578 6563 2873 6f75 7263 652c 2073  m_exec(source, s
+000116d0: 6f75 7263 655f 6669 6c65 6e61 6d65 2c20  ource_filename, 
+000116e0: 7573 6572 5f6e 732c 2075 7365 725f 676c  user_ns, user_gl
+000116f0: 6f62 616c 5f6e 7329 3a0a 2020 2020 2222  obal_ns):.    ""
+00011700: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
+00011710: 2073 6f75 7263 653a 0a20 2020 203a 7061   source:.    :pa
+00011720: 7261 6d20 7374 7220 736f 7572 6365 5f66  ram str source_f
+00011730: 696c 656e 616d 653a 0a20 2020 203a 7061  ilename:.    :pa
+00011740: 7261 6d20 6469 6374 5b73 7472 5d20 7573  ram dict[str] us
+00011750: 6572 5f6e 733a 0a20 2020 203a 7061 7261  er_ns:.    :para
+00011760: 6d20 6469 6374 5b73 7472 5d20 7573 6572  m dict[str] user
+00011770: 5f67 6c6f 6261 6c5f 6e73 3a0a 2020 2020  _global_ns:.    
+00011780: 3a72 6574 7572 6e3a 206e 6f74 6869 6e67  :return: nothing
+00011790: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000117a0: 6e6f 7420 736f 7572 6365 2e65 6e64 7377  not source.endsw
+000117b0: 6974 6828 225c 6e22 293a 0a20 2020 2020  ith("\n"):.     
+000117c0: 2020 2073 6f75 7263 6520 2b3d 2022 5c6e     source += "\n
+000117d0: 220a 2020 2020 636f 203d 2063 6f6d 7069  ".    co = compi
+000117e0: 6c65 2873 6f75 7263 652c 2073 6f75 7263  le(source, sourc
+000117f0: 655f 6669 6c65 6e61 6d65 2c20 2265 7865  e_filename, "exe
+00011800: 6322 290a 2020 2020 7573 6572 5f67 6c6f  c").    user_glo
+00011810: 6261 6c5f 6e73 5b22 5f5f 7061 636b 6167  bal_ns["__packag
+00011820: 655f 5f22 5d20 3d20 2272 6574 7572 6e6e  e__"] = "returnn
+00011830: 2220 2023 2069 6d70 6f72 7461 6e74 2073  "  # important s
+00011840: 6f20 7468 6174 2069 6d70 6f72 7473 2077  o that imports w
+00011850: 6f72 6b0a 2020 2020 6576 616c 2863 6f2c  ork.    eval(co,
+00011860: 2075 7365 725f 676c 6f62 616c 5f6e 732c   user_global_ns,
+00011870: 2075 7365 725f 6e73 290a 0a0a 636c 6173   user_ns)...clas
+00011880: 7320 4672 6f7a 656e 4469 6374 2864 6963  s FrozenDict(dic
+00011890: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
+000118a0: 4672 6f7a 656e 2064 6963 742e 0a20 2020  Frozen dict..   
+000118b0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+000118c0: 7365 7469 7465 6d5f 5f28 7365 6c66 2c20  setitem__(self, 
+000118d0: 6b65 792c 2076 616c 7565 293a 0a20 2020  key, value):.   
+000118e0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000118f0: 4572 726f 7228 2246 726f 7a65 6e44 6963  Error("FrozenDic
+00011900: 7420 6361 6e6e 6f74 2062 6520 6d6f 6469  t cannot be modi
+00011910: 6669 6564 2229 0a0a 2020 2020 6465 6620  fied")..    def 
+00011920: 5f5f 6861 7368 5f5f 2873 656c 6629 3a0a  __hash__(self):.
+00011930: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+00011940: 6173 6828 7475 706c 6528 736f 7274 6564  ash(tuple(sorted
+00011950: 2873 656c 662e 6974 656d 7328 2929 2929  (self.items())))
+00011960: 0a0a 0a64 6566 206d 616b 655f 6861 7368  ...def make_hash
+00011970: 6162 6c65 286f 626a 293a 0a20 2020 2022  able(obj):.    "
+00011980: 2222 0a20 2020 2054 6865 616e 6f20 6e65  "".    Theano ne
+00011990: 6564 7320 6861 7368 6162 6c65 206f 626a  eds hashable obj
+000119a0: 6563 7473 2069 6e20 736f 6d65 2063 6173  ects in some cas
+000119b0: 6573 2c20 652e 672e 2074 6865 2070 726f  es, e.g. the pro
+000119c0: 7065 7274 6965 7320 6f66 204f 7073 2e0a  perties of Ops..
+000119d0: 2020 2020 5468 6973 2063 6f6e 7665 7274      This convert
+000119e0: 7320 616c 6c20 6f62 6a65 6374 7320 6173  s all objects as
+000119f0: 2073 7563 682c 2069 2e65 2e20 696e 746f   such, i.e. into
+00011a00: 2069 6d6d 7574 6162 6c65 2066 726f 7a65   immutable froze
+00011a10: 6e20 7479 7065 732e 0a0a 2020 2020 3a70  n types...    :p
+00011a20: 6172 616d 2054 7c64 6963 747c 6c69 7374  aram T|dict|list
+00011a30: 7c74 7570 6c65 206f 626a 3a0a 2020 2020  |tuple obj:.    
+00011a40: 3a72 7479 7065 3a20 547c 4672 6f7a 656e  :rtype: T|Frozen
+00011a50: 4469 6374 7c74 7570 6c65 0a20 2020 2022  Dict|tuple.    "
+00011a60: 2222 0a20 2020 2069 6620 6973 696e 7374  "".    if isinst
+00011a70: 616e 6365 286f 626a 2c20 6469 6374 293a  ance(obj, dict):
+00011a80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011a90: 4672 6f7a 656e 4469 6374 285b 6d61 6b65  FrozenDict([make
+00011aa0: 5f68 6173 6861 626c 6528 6974 656d 2920  _hashable(item) 
+00011ab0: 666f 7220 6974 656d 2069 6e20 6f62 6a2e  for item in obj.
+00011ac0: 6974 656d 7328 295d 290a 2020 2020 6966  items()]).    if
+00011ad0: 2069 7369 6e73 7461 6e63 6528 6f62 6a2c   isinstance(obj,
+00011ae0: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
+00011af0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011b00: 7475 706c 6528 5b6d 616b 655f 6861 7368  tuple([make_hash
+00011b10: 6162 6c65 2869 7465 6d29 2066 6f72 2069  able(item) for i
+00011b20: 7465 6d20 696e 206f 626a 5d29 0a20 2020  tem in obj]).   
+00011b30: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+00011b40: 626a 2c20 2873 7472 2c20 756e 6963 6f64  bj, (str, unicod
+00011b50: 652c 2066 6c6f 6174 2c20 696e 742c 206c  e, float, int, l
+00011b60: 6f6e 6729 293a 0a20 2020 2020 2020 2072  ong)):.        r
+00011b70: 6574 7572 6e20 6f62 6a0a 2020 2020 6966  eturn obj.    if
+00011b80: 206f 626a 2069 7320 4e6f 6e65 3a0a 2020   obj is None:.  
+00011b90: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
+00011ba0: 0a20 2020 2069 6620 2274 656e 736f 7266  .    if "tensorf
+00011bb0: 6c6f 7722 2069 6e20 7379 732e 6d6f 6475  low" in sys.modu
+00011bc0: 6c65 733a 0a20 2020 2020 2020 2069 6d70  les:.        imp
+00011bd0: 6f72 7420 7465 6e73 6f72 666c 6f77 2061  ort tensorflow a
+00011be0: 7320 7466 0a0a 2020 2020 2020 2020 6966  s tf..        if
+00011bf0: 2069 7369 6e73 7461 6e63 6528 6f62 6a2c   isinstance(obj,
+00011c00: 2074 662e 5465 6e73 6f72 293a 0a20 2020   tf.Tensor):.   
+00011c10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011c20: 5265 6649 6445 7128 6f62 6a29 0a20 2020  RefIdEq(obj).   
+00011c30: 2061 7373 6572 7420 4661 6c73 652c 2022   assert False, "
+00011c40: 646f 6e27 7420 6b6e 6f77 2068 6f77 2074  don't know how t
+00011c50: 6f20 6d61 6b65 2068 6173 6861 626c 653a  o make hashable:
+00011c60: 2025 7220 2825 7229 2220 2520 286f 626a   %r (%r)" % (obj
+00011c70: 2c20 7479 7065 286f 626a 2929 0a0a 0a63  , type(obj))...c
+00011c80: 6c61 7373 2052 6566 4964 4571 2847 656e  lass RefIdEq(Gen
+00011c90: 6572 6963 5b54 5d29 3a0a 2020 2020 2222  eric[T]):.    ""
+00011ca0: 220a 2020 2020 5265 6665 7265 6e63 6520  ".    Reference 
+00011cb0: 746f 2073 6f6d 6520 6f62 6a65 6374 2028  to some object (
+00011cc0: 652e 672e 2074 2e66 5465 6e73 6f72 292c  e.g. t.fTensor),
+00011cd0: 2062 7574 2074 6869 7320 6f62 6a65 6374   but this object
+00011ce0: 2069 7320 616c 7761 7973 2068 6173 6861   is always hasha
+00011cf0: 626c 652c 0a20 2020 2061 6e64 2075 7365  ble,.    and use
+00011d00: 7320 7468 6520 6069 6460 206f 6620 7468  s the `id` of th
+00011d10: 6520 6675 6e63 7469 6f6e 2066 6f72 2074  e function for t
+00011d20: 6865 2068 6173 6820 616e 6420 6571 7561  he hash and equa
+00011d30: 6c69 7479 2e0a 0a20 2020 2028 496e 2063  lity...    (In c
+00011d40: 6173 6520 6f66 2074 662e 5465 6e73 6f72  ase of tf.Tensor
+00011d50: 2c20 7468 6973 2069 7320 666f 7220 636f  , this is for co
+00011d60: 6d70 6174 6962 696c 6974 790a 2020 2020  mpatibility.    
+00011d70: 2062 6563 6175 7365 2074 662e 5465 6e73   because tf.Tens
+00011d80: 6f72 2e72 6566 2829 2077 6173 206e 6f74  or.ref() was not
+00011d90: 2061 7661 696c 6162 6c65 2069 6e20 6561   available in ea
+00011da0: 726c 6965 7220 5446 2076 6572 7369 6f6e  rlier TF version
+00011db0: 732e 0a20 2020 2020 486f 7765 7665 722c  s..     However,
+00011dc0: 2077 6520 616c 736f 206e 6565 6420 7468   we also need th
+00011dd0: 6973 2066 6f72 203a 636c 6173 733a 6044  is for :class:`D
+00011de0: 6963 7452 6566 4b65 7973 602e 290a 2020  ictRefKeys`.).  
+00011df0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00011e00: 5f69 6e69 745f 5f28 7365 6c66 2c20 6f62  _init__(self, ob
+00011e10: 6a3a 2054 293a 0a20 2020 2020 2020 2022  j: T):.        "
+00011e20: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+00011e30: 6d20 6f62 6a3a 2066 6f72 2065 7861 6d70  m obj: for examp
+00011e40: 6c65 2074 662e 5465 6e73 6f72 0a20 2020  le tf.Tensor.   
+00011e50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00011e60: 2073 656c 662e 6f62 6a20 3d20 6f62 6a0a   self.obj = obj.
+00011e70: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
+00011e80: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00011e90: 2072 6574 7572 6e20 2254 656e 736f 7252   return "TensorR
+00011ea0: 6566 7b25 727d 2220 2520 7365 6c66 2e6f  ef{%r}" % self.o
+00011eb0: 626a 0a0a 2020 2020 6465 6620 5f5f 6571  bj..    def __eq
+00011ec0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+00011ed0: 0a20 2020 2020 2020 2069 6620 6f74 6865  .        if othe
+00011ee0: 7220 6973 204e 6f6e 6520 6f72 206e 6f74  r is None or not
+00011ef0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+00011f00: 722c 2052 6566 4964 4571 293a 0a20 2020  r, RefIdEq):.   
+00011f10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011f20: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+00011f30: 7475 726e 2073 656c 662e 6f62 6a20 6973  turn self.obj is
+00011f40: 206f 7468 6572 2e6f 626a 0a0a 2020 2020   other.obj..    
+00011f50: 6465 6620 5f5f 6e65 5f5f 2873 656c 662c  def __ne__(self,
+00011f60: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+00011f70: 2072 6574 7572 6e20 6e6f 7420 7365 6c66   return not self
+00011f80: 2e5f 5f65 715f 5f28 6f74 6865 7229 0a0a  .__eq__(other)..
+00011f90: 2020 2020 6465 6620 5f5f 6861 7368 5f5f      def __hash__
+00011fa0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00011fb0: 7265 7475 726e 2069 6428 7365 6c66 2e6f  return id(self.o
+00011fc0: 626a 290a 0a0a 636c 6173 7320 4469 6374  bj)...class Dict
+00011fd0: 5265 664b 6579 7328 4765 6e65 7269 635b  RefKeys(Generic[
+00011fe0: 4b2c 2056 5d29 3a0a 2020 2020 2222 220a  K, V]):.    """.
+00011ff0: 2020 2020 4c69 6b65 2060 6469 6374 602c      Like `dict`,
+00012000: 2062 7574 2068 6173 6820 616e 6420 6571   but hash and eq
+00012010: 7561 6c69 7479 206f 6620 7468 6520 6b65  uality of the ke
+00012020: 7973 0a20 2020 2022 2222 0a0a 2020 2020  ys.    """..    
+00012030: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00012040: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00012050: 2e5f 6420 3d20 7b7d 2020 2320 7479 7065  ._d = {}  # type
+00012060: 3a20 4469 6374 5b52 6566 4964 4571 5b4b  : Dict[RefIdEq[K
+00012070: 5d2c 2056 5d0a 0a20 2020 2064 6566 205f  ], V]..    def _
+00012080: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
+00012090: 2020 2020 2020 2072 6574 7572 6e20 2244         return "D
+000120a0: 6963 7452 6566 4b65 7973 2825 7329 2220  ictRefKeys(%s)" 
+000120b0: 2520 222c 2022 2e6a 6f69 6e28 5b22 2572  % ", ".join(["%r
+000120c0: 3a20 2572 2220 2520 286b 2c20 7629 2066  : %r" % (k, v) f
+000120d0: 6f72 2028 6b2c 2076 2920 696e 2073 656c  or (k, v) in sel
+000120e0: 662e 6974 656d 7328 295d 290a 0a20 2020  f.items()])..   
+000120f0: 2064 6566 2069 7465 6d73 2873 656c 6629   def items(self)
+00012100: 202d 3e20 4974 6572 6162 6c65 5b54 7570   -> Iterable[Tup
+00012110: 6c65 5b4b 2c20 565d 5d3a 0a20 2020 2020  le[K, V]]:.     
+00012120: 2020 2022 2222 6974 656d 7322 2222 0a20     """items""". 
+00012130: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+00012140: 696e 2073 656c 662e 5f64 2e69 7465 6d73  in self._d.items
+00012150: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00012160: 7969 656c 6420 6b2e 6f62 6a2c 2076 0a0a  yield k.obj, v..
+00012170: 2020 2020 6465 6620 6b65 7973 2873 656c      def keys(sel
+00012180: 6629 202d 3e20 4974 6572 6162 6c65 5b4b  f) -> Iterable[K
+00012190: 5d3a 0a20 2020 2020 2020 2022 2222 6b65  ]:.        """ke
+000121a0: 7973 2222 220a 2020 2020 2020 2020 666f  ys""".        fo
+000121b0: 7220 6b20 696e 2073 656c 662e 5f64 2e6b  r k in self._d.k
+000121c0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
+000121d0: 2020 2079 6965 6c64 206b 2e6f 626a 0a0a     yield k.obj..
+000121e0: 2020 2020 6465 6620 7661 6c75 6573 2873      def values(s
+000121f0: 656c 6629 202d 3e20 4974 6572 6162 6c65  elf) -> Iterable
+00012200: 5b56 5d3a 0a20 2020 2020 2020 2022 2222  [V]:.        """
+00012210: 7661 6c75 6573 2222 220a 2020 2020 2020  values""".      
+00012220: 2020 666f 7220 7620 696e 2073 656c 662e    for v in self.
+00012230: 5f64 2e76 616c 7565 7328 293a 0a20 2020  _d.values():.   
+00012240: 2020 2020 2020 2020 2079 6965 6c64 2076           yield v
+00012250: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+00012260: 7465 6d5f 5f28 7365 6c66 2c20 6974 656d  tem__(self, item
+00012270: 3a20 4b29 202d 3e20 563a 0a20 2020 2020  : K) -> V:.     
+00012280: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00012290: 645b 5265 6649 6445 7128 6974 656d 295d  d[RefIdEq(item)]
+000122a0: 0a0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
+000122b0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 793a  tem__(self, key:
+000122c0: 204b 2c20 7661 6c75 653a 2056 293a 0a20   K, value: V):. 
+000122d0: 2020 2020 2020 2073 656c 662e 5f64 5b52         self._d[R
+000122e0: 6566 4964 4571 286b 6579 295d 203d 2076  efIdEq(key)] = v
+000122f0: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
+00012300: 636f 6e74 6169 6e73 5f5f 2873 656c 662c  contains__(self,
+00012310: 2069 7465 6d3a 204b 293a 0a20 2020 2020   item: K):.     
+00012320: 2020 2072 6574 7572 6e20 5265 6649 6445     return RefIdE
+00012330: 7128 6974 656d 2920 696e 2073 656c 662e  q(item) in self.
+00012340: 5f64 0a0a 0a64 6566 206d 616b 655f 646c  _d...def make_dl
+00012350: 6c5f 6e61 6d65 2862 6173 656e 616d 6529  l_name(basename)
+00012360: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00012370: 6172 616d 2073 7472 2062 6173 656e 616d  aram str basenam
+00012380: 653a 0a20 2020 203a 7265 7475 726e 3a20  e:.    :return: 
+00012390: 652e 672e 2022 6c69 6225 732e 736f 2220  e.g. "lib%s.so" 
+000123a0: 2520 6261 7365 6e61 6d65 2c20 6465 7065  % basename, depe
+000123b0: 6e64 696e 6720 6f6e 2073 7973 2e70 6c61  nding on sys.pla
+000123c0: 7466 6f72 6d0a 2020 2020 3a72 7479 7065  tform.    :rtype
+000123d0: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
+000123e0: 2020 6966 2073 7973 2e70 6c61 7466 6f72    if sys.platfor
+000123f0: 6d20 3d3d 2022 6461 7277 696e 223a 0a20  m == "darwin":. 
+00012400: 2020 2020 2020 2072 6574 7572 6e20 226c         return "l
+00012410: 6962 2573 2e64 796c 6962 2220 2520 6261  ib%s.dylib" % ba
+00012420: 7365 6e61 6d65 0a20 2020 2065 6c69 6620  sename.    elif 
+00012430: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
+00012440: 2277 696e 3332 223a 0a20 2020 2020 2020  "win32":.       
+00012450: 2072 6574 7572 6e20 2225 732e 646c 6c22   return "%s.dll"
+00012460: 2025 2062 6173 656e 616d 650a 2020 2020   % basename.    
+00012470: 656c 7365 3a20 2023 204c 696e 7578 2c20  else:  # Linux, 
+00012480: 556e 6978 0a20 2020 2020 2020 2072 6574  Unix.        ret
+00012490: 7572 6e20 226c 6962 2573 2e73 6f22 2025  urn "lib%s.so" %
+000124a0: 2062 6173 656e 616d 650a 0a0a 6465 6620   basename...def 
+000124b0: 6573 6361 7065 5f63 5f73 7472 2873 293a  escape_c_str(s):
+000124c0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+000124d0: 7261 6d20 7374 7220 733a 0a20 2020 203a  ram str s:.    :
+000124e0: 7265 7475 726e 3a20 432d 6573 6361 7065  return: C-escape
+000124f0: 6420 7374 720a 2020 2020 3a72 7479 7065  d str.    :rtype
+00012500: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
+00012510: 2020 7265 7475 726e 2027 2225 7322 2720    return '"%s"' 
+00012520: 2520 732e 7265 706c 6163 6528 225c 5c5c  % s.replace("\\\
+00012530: 5c22 2c20 225c 5c22 292e 7265 706c 6163  \", "\\").replac
+00012540: 6528 225c 6e22 2c20 225c 5c6e 2229 2e72  e("\n", "\\n").r
+00012550: 6570 6c61 6365 2827 2227 2c20 275c 5c22  eplace('"', '\\"
+00012560: 2729 2e72 6570 6c61 6365 2822 2722 2c20  ').replace("'", 
+00012570: 225c 5c27 2229 0a0a 0a64 6566 2061 7474  "\\'")...def att
+00012580: 725f 6368 6169 6e28 6261 7365 2c20 6174  r_chain(base, at
+00012590: 7472 6962 7329 3a0a 2020 2020 2222 220a  tribs):.    """.
+000125a0: 2020 2020 3a70 6172 616d 206f 626a 6563      :param objec
+000125b0: 7420 6261 7365 3a0a 2020 2020 3a70 6172  t base:.    :par
+000125c0: 616d 206c 6973 745b 7374 725d 7c74 7570  am list[str]|tup
+000125d0: 6c65 5b73 7472 5d7c 7374 7220 6174 7472  le[str]|str attr
+000125e0: 6962 733a 0a20 2020 203a 7265 7475 726e  ibs:.    :return
+000125f0: 3a20 6765 7461 7474 7228 6765 7461 7474  : getattr(getatt
+00012600: 7228 6f62 6a65 6374 2c20 6174 7472 6962  r(object, attrib
+00012610: 735b 305d 292c 2061 7474 7269 6273 5b31  s[0]), attribs[1
+00012620: 5d29 202e 2e2e 0a20 2020 203a 7274 7970  ]) ....    :rtyp
+00012630: 653a 206f 626a 6563 740a 2020 2020 2222  e: object.    ""
+00012640: 220a 2020 2020 6966 206e 6f74 2069 7369  ".    if not isi
+00012650: 6e73 7461 6e63 6528 6174 7472 6962 732c  nstance(attribs,
+00012660: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
+00012670: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00012680: 6973 696e 7374 616e 6365 2861 7474 7269  isinstance(attri
+00012690: 6273 2c20 7374 7229 0a20 2020 2020 2020  bs, str).       
+000126a0: 2061 7474 7269 6273 203d 205b 6174 7472   attribs = [attr
+000126b0: 6962 735d 0a20 2020 2065 6c73 653a 0a20  ibs].    else:. 
+000126c0: 2020 2020 2020 2061 7474 7269 6273 203d         attribs =
+000126d0: 206c 6973 7428 6174 7472 6962 7329 0a20   list(attribs). 
+000126e0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000126f0: 6528 6c65 6e28 6174 7472 6962 7329 293a  e(len(attribs)):
+00012700: 0a20 2020 2020 2020 2062 6173 6520 3d20  .        base = 
+00012710: 6765 7461 7474 7228 6261 7365 2c20 6174  getattr(base, at
+00012720: 7472 6962 735b 695d 290a 2020 2020 7265  tribs[i]).    re
+00012730: 7475 726e 2062 6173 650a 0a0a 6465 6620  turn base...def 
+00012740: 746f 5f62 6f6f 6c28 7629 3a0a 2020 2020  to_bool(v):.    
+00012750: 2222 220a 2020 2020 3a70 6172 616d 2069  """.    :param i
+00012760: 6e74 7c66 6c6f 6174 7c73 7472 2076 3a20  nt|float|str v: 
+00012770: 6966 2069 7420 6973 2061 2073 7472 696e  if it is a strin
+00012780: 672c 2069 7420 7368 6f75 6c64 2072 6570  g, it should rep
+00012790: 7265 7365 6e74 2073 6f6d 6520 696e 7465  resent some inte
+000127a0: 6765 722c 206f 7220 616c 7465 726e 6174  ger, or alternat
+000127b0: 6976 656c 7920 2274 7275 6522 206f 7220  ively "true" or 
+000127c0: 2266 616c 7365 220a 2020 2020 3a72 7479  "false".    :rty
+000127d0: 7065 3a20 626f 6f6c 0a20 2020 2022 2222  pe: bool.    """
+000127e0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+000127f0: 2020 7265 7475 726e 2062 6f6f 6c28 696e    return bool(in
+00012800: 7428 7629 290a 2020 2020 6578 6365 7074  t(v)).    except
+00012810: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
+00012820: 2020 2020 2070 6173 730a 2020 2020 6966       pass.    if
+00012830: 2069 7369 6e73 7461 6e63 6528 762c 2028   isinstance(v, (
+00012840: 7374 722c 2075 6e69 636f 6465 2929 3a0a  str, unicode)):.
+00012850: 2020 2020 2020 2020 7620 3d20 762e 6c6f          v = v.lo
+00012860: 7765 7228 290a 2020 2020 2020 2020 6966  wer().        if
+00012870: 2076 2069 6e20 5b22 7472 7565 222c 2022   v in ["true", "
+00012880: 7965 7322 2c20 226f 6e22 2c20 2231 225d  yes", "on", "1"]
+00012890: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000128a0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+000128b0: 2020 6966 2076 2069 6e20 5b22 6661 6c73    if v in ["fals
+000128c0: 6522 2c20 226e 6f22 2c20 226f 6666 222c  e", "no", "off",
+000128d0: 2022 3022 5d3a 0a20 2020 2020 2020 2020   "0"]:.         
+000128e0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000128f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00012900: 7272 6f72 2822 746f 5f62 6f6f 6c20 6361  rror("to_bool ca
+00012910: 6e6e 6f74 2068 616e 646c 6520 2572 2220  nnot handle %r" 
+00012920: 2520 7629 0a0a 0a64 6566 2061 735f 7374  % v)...def as_st
+00012930: 7228 7329 3a0a 2020 2020 2222 220a 2020  r(s):.    """.  
+00012940: 2020 3a70 6172 616d 2073 7472 7c75 6e69    :param str|uni
+00012950: 636f 6465 7c62 7974 6573 2073 3a0a 2020  code|bytes s:.  
+00012960: 2020 3a72 7479 7065 3a20 7374 727c 756e    :rtype: str|un
+00012970: 6963 6f64 650a 2020 2020 2222 220a 2020  icode.    """.  
+00012980: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00012990: 732c 2073 7472 2920 6f72 2022 756e 6963  s, str) or "unic
+000129a0: 6f64 6522 2069 6e20 7374 7228 7479 7065  ode" in str(type
+000129b0: 2873 2929 3a0a 2020 2020 2020 2020 7265  (s)):.        re
+000129c0: 7475 726e 2073 0a20 2020 2069 6620 6973  turn s.    if is
+000129d0: 696e 7374 616e 6365 2873 2c20 6279 7465  instance(s, byte
+000129e0: 7329 206f 7220 6973 696e 7374 616e 6365  s) or isinstance
+000129f0: 2873 2c20 756e 6963 6f64 6529 3a0a 2020  (s, unicode):.  
+00012a00: 2020 2020 2020 2320 6e6f 696e 7370 6563        # noinspec
+00012a10: 7469 6f6e 2050 7955 6e72 6573 6f6c 7665  tion PyUnresolve
+00012a20: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
+00012a30: 2020 2020 7265 7475 726e 2073 2e64 6563      return s.dec
+00012a40: 6f64 6528 2275 7466 3822 290a 2020 2020  ode("utf8").    
+00012a50: 6173 7365 7274 2046 616c 7365 2c20 2275  assert False, "u
+00012a60: 6e6b 6e6f 776e 2074 7970 6520 2573 2220  nknown type %s" 
+00012a70: 2520 7479 7065 2873 290a 0a0a 6465 6620  % type(s)...def 
+00012a80: 7079 325f 7574 6638 5f73 7472 5f74 6f5f  py2_utf8_str_to_
+00012a90: 756e 6963 6f64 6528 7329 3a0a 2020 2020  unicode(s):.    
+00012aa0: 2222 220a 2020 2020 3a70 6172 616d 2073  """.    :param s
+00012ab0: 7472 2073 3a20 652e 672e 2074 6865 2073  tr s: e.g. the s
+00012ac0: 7472 696e 6720 6c69 7465 7261 6c20 22c3  tring literal ".
+00012ad0: a4c3 b6c3 bc22 2069 6e20 5079 7468 6f6e  ....." in Python
+00012ae0: 2033 2069 7320 636f 7272 6563 742c 2062   3 is correct, b
+00012af0: 7574 2069 6e20 5079 7468 6f6e 2032 2069  ut in Python 2 i
+00012b00: 7420 7368 6f75 6c64 2068 6176 6520 6265  t should have be
+00012b10: 656e 2075 22c3 a4c3 b6c3 bc22 2c0a 2020  en u"......",.  
+00012b20: 2020 2020 6275 7420 6a75 7374 2075 7369      but just usi
+00012b30: 6e67 2022 c3a4 c3b6 c3bc 2220 7769 6c6c  ng "......" will
+00012b40: 2061 6374 7561 6c6c 7920 6265 2074 6865   actually be the
+00012b50: 2072 6177 2075 7466 3820 6279 7465 2073   raw utf8 byte s
+00012b60: 6571 7565 6e63 652e 0a20 2020 2020 2054  equence..      T
+00012b70: 6869 7320 6361 6e20 6861 7070 656e 2077  his can happen w
+00012b80: 6865 6e20 796f 7520 6576 616c 2829 2073  hen you eval() s
+00012b90: 6f6d 6520 7374 7269 6e67 2e0a 2020 2020  ome string..    
+00012ba0: 2020 5765 2061 7373 756d 6520 7468 6174    We assume that
+00012bb0: 2079 6f75 2061 7265 2075 7369 6e67 2050   you are using P
+00012bc0: 7974 686f 6e20 322c 2061 6e64 2067 6f74  ython 2, and got
+00012bd0: 2074 6865 2073 7472 696e 6720 286e 6f74   the string (not
+00012be0: 2075 6e69 636f 6465 206f 626a 6563 7429   unicode object)
+00012bf0: 2022 c3a4 c3b6 c3bc 222c 206f 7220 6d61   "......", or ma
+00012c00: 7962 6520 2261 6263 222e 0a20 2020 2020  ybe "abc"..     
+00012c10: 2041 6c73 6f20 7365 6520 3a66 756e 633a   Also see :func:
+00012c20: 605f 7079 325f 756e 6963 6f64 655f 746f  `_py2_unicode_to
+00012c30: 5f73 7472 5f72 6563 7572 7369 7665 6020  _str_recursive` 
+00012c40: 616e 6420 3a66 756e 633a 6061 735f 7374  and :func:`as_st
+00012c50: 7260 2e0a 2020 2020 3a72 6574 7572 6e3a  r`..    :return:
+00012c60: 2069 6620 6974 2069 7320 696e 6465 6564   if it is indeed
+00012c70: 2075 6e69 636f 6465 2c20 6974 2077 696c   unicode, it wil
+00012c80: 6c20 7265 7475 726e 2074 6865 2075 6e69  l return the uni
+00012c90: 636f 6465 206f 626a 6563 742c 206f 7468  code object, oth
+00012ca0: 6572 7769 7365 2069 7420 6b65 6570 7320  erwise it keeps 
+00012cb0: 7468 6520 7374 7269 6e67 0a20 2020 203a  the string.    :
+00012cc0: 7274 7970 653a 2073 7472 7c75 6e69 636f  rtype: str|unico
+00012cd0: 6465 0a20 2020 2022 2222 0a20 2020 2061  de.    """.    a
+00012ce0: 7373 6572 7420 6e6f 7420 5059 330a 2020  ssert not PY3.  
+00012cf0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+00012d00: 6e63 6528 732c 2073 7472 290a 2020 2020  nce(s, str).    
+00012d10: 7472 793a 0a20 2020 2020 2020 2023 206e  try:.        # n
+00012d20: 6f69 6e73 7065 6374 696f 6e20 5079 556e  oinspection PyUn
+00012d30: 7265 736f 6c76 6564 5265 6665 7265 6e63  resolvedReferenc
+00012d40: 6573 0a20 2020 2020 2020 2073 2e64 6563  es.        s.dec
+00012d50: 6f64 6528 2261 7363 6969 2229 0a20 2020  ode("ascii").   
+00012d60: 2020 2020 2072 6574 7572 6e20 730a 2020       return s.  
+00012d70: 2020 6578 6365 7074 2055 6e69 636f 6465    except Unicode
+00012d80: 4465 636f 6465 4572 726f 723a 0a20 2020  DecodeError:.   
+00012d90: 2020 2020 2070 6173 730a 2020 2020 2320       pass.    # 
+00012da0: 6e6f 696e 7370 6563 7469 6f6e 2050 7955  noinspection PyU
+00012db0: 6e72 6573 6f6c 7665 6452 6566 6572 656e  nresolvedReferen
+00012dc0: 6365 730a 2020 2020 7265 7475 726e 2073  ces.    return s
+00012dd0: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
+00012de0: 0a0a 6465 6620 756e 6963 6f64 655f 746f  ..def unicode_to
+00012df0: 5f73 7472 2873 293a 0a20 2020 2022 2222  _str(s):.    """
+00012e00: 0a20 2020 2054 6865 2062 6568 6176 696f  .    The behavio
+00012e10: 7220 6973 2064 6966 6665 7265 6e74 2064  r is different d
+00012e20: 6570 656e 6469 6e67 206f 6e20 5079 7468  epending on Pyth
+00012e30: 6f6e 2032 206f 7220 5079 7468 6f6e 2033  on 2 or Python 3
+00012e40: 2e20 496e 2061 6c6c 2063 6173 6573 2c20  . In all cases, 
+00012e50: 7468 6520 7265 7475 726e 6564 2074 7970  the returned typ
+00012e60: 6520 6973 2061 2073 7472 206f 626a 6563  e is a str objec
+00012e70: 742e 0a20 2020 2050 7974 686f 6e20 323a  t..    Python 2:
+00012e80: 0a20 2020 2020 2057 6520 7265 7475 726e  .      We return
+00012e90: 2074 6865 2075 7466 3820 656e 636f 6465   the utf8 encode
+00012ea0: 6420 7374 7220 2877 6869 6368 2069 7320  d str (which is 
+00012eb0: 6c69 6b65 2050 7974 686f 6e20 3320 6279  like Python 3 by
+00012ec0: 7465 732c 206f 7220 666f 7220 4153 4349  tes, or for ASCI
+00012ed0: 492c 2074 6865 7265 2069 7320 6e6f 2064  I, there is no d
+00012ee0: 6966 6665 7265 6e63 6529 2e0a 2020 2020  ifference)..    
+00012ef0: 5079 7468 6f6e 2033 3a0a 2020 2020 2020  Python 3:.      
+00012f00: 5765 2072 6574 7572 6e20 6120 7374 7220  We return a str 
+00012f10: 6f62 6a65 6374 2e0a 2020 2020 4e6f 7465  object..    Note
+00012f20: 2074 6861 7420 7468 6973 2066 756e 6374   that this funct
+00012f30: 696f 6e20 7072 6f62 6162 6c79 2064 6f65  ion probably doe
+00012f40: 7320 6e6f 7420 6d61 6b65 206d 7563 6820  s not make much 
+00012f50: 7365 6e73 652e 0a20 2020 2049 7420 6d69  sense..    It mi
+00012f60: 6768 7420 6265 2075 7365 6420 7768 656e  ght be used when
+00012f70: 2074 6865 7265 2069 7320 6f74 6865 7220   there is other 
+00012f80: 636f 6465 2077 6869 6368 2065 7870 6563  code which expec
+00012f90: 7473 2061 2073 7472 206f 626a 6563 742c  ts a str object,
+00012fa0: 206e 6f20 6d61 7474 6572 2069 6620 5079   no matter if Py
+00012fb0: 7468 6f6e 2032 206f 7220 5079 7468 6f6e  thon 2 or Python
+00012fc0: 2033 2e0a 2020 2020 496e 2050 7974 686f   3..    In Pytho
+00012fd0: 6e20 322c 2061 2073 7472 206f 626a 6563  n 2, a str objec
+00012fe0: 7420 6f66 7465 6e20 686f 6c64 7320 5554  t often holds UT
+00012ff0: 4638 2074 6578 742c 2073 6f20 7468 6520  F8 text, so the 
+00013000: 6265 6861 7669 6f72 206f 6620 7468 6973  behavior of this
+00013010: 2066 756e 6374 696f 6e20 6973 2066 696e   function is fin
+00013020: 6520 7468 656e 2e0a 2020 2020 416c 736f  e then..    Also
+00013030: 2073 6565 203a 6675 6e63 3a60 6173 5f73   see :func:`as_s
+00013040: 7472 602e 0a0a 2020 2020 3a70 6172 616d  tr`...    :param
+00013050: 2073 7472 7c75 6e69 636f 6465 7c62 7974   str|unicode|byt
+00013060: 6573 2073 3a0a 2020 2020 3a72 7479 7065  es s:.    :rtype
+00013070: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
+00013080: 2020 6966 2050 5933 2061 6e64 2069 7369    if PY3 and isi
+00013090: 6e73 7461 6e63 6528 732c 2062 7974 6573  nstance(s, bytes
+000130a0: 293a 0a20 2020 2020 2020 2073 203d 2073  ):.        s = s
+000130b0: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
+000130c0: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
+000130d0: 7369 6e73 7461 6e63 6528 732c 2073 7472  sinstance(s, str
+000130e0: 290a 2020 2020 6966 206e 6f74 2050 5933  ).    if not PY3
+000130f0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00013100: 732c 2075 6e69 636f 6465 293a 0a20 2020  s, unicode):.   
+00013110: 2020 2020 2073 203d 2073 2e65 6e63 6f64       s = s.encod
+00013120: 6528 2275 7466 3822 290a 2020 2020 2020  e("utf8").      
+00013130: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+00013140: 6e63 6528 732c 2073 7472 290a 2020 2020  nce(s, str).    
+00013150: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+00013160: 6528 732c 2073 7472 290a 2020 2020 7265  e(s, str).    re
+00013170: 7475 726e 2073 0a0a 0a64 6566 2064 6565  turn s...def dee
+00013180: 7063 6f70 7928 782c 2073 746f 705f 7479  pcopy(x, stop_ty
+00013190: 7065 733d 4e6f 6e65 293a 0a20 2020 2022  pes=None):.    "
+000131a0: 2222 0a20 2020 2053 696d 706c 6572 2076  "".    Simpler v
+000131b0: 6172 6961 6e74 206f 6620 636f 7079 2e64  ariant of copy.d
+000131c0: 6565 7063 6f70 7928 292e 0a20 2020 2053  eepcopy()..    S
+000131d0: 686f 756c 6420 6861 6e64 6c65 2073 6f6d  hould handle som
+000131e0: 6520 6564 6765 2063 6173 6573 2061 7320  e edge cases as 
+000131f0: 7765 6c6c 2c20 6c69 6b65 2063 6f70 7969  well, like copyi
+00013200: 6e67 206d 6f64 756c 6520 7265 6665 7265  ng module refere
+00013210: 6e63 6573 2e0a 0a20 2020 203a 7061 7261  nces...    :para
+00013220: 6d20 5420 783a 2061 6e20 6172 6269 7472  m T x: an arbitr
+00013230: 6172 7920 6f62 6a65 6374 0a20 2020 203a  ary object.    :
+00013240: 7061 7261 6d20 6c69 7374 5b74 7970 655d  param list[type]
+00013250: 7c4e 6f6e 6520 7374 6f70 5f74 7970 6573  |None stop_types
+00013260: 3a20 6f62 6a65 6374 7320 6f66 2074 6865  : objects of the
+00013270: 7365 2074 7970 6573 2077 696c 6c20 6e6f  se types will no
+00013280: 7420 6265 2064 6565 702d 636f 7069 6564  t be deep-copied
+00013290: 2c20 6f6e 6c79 2074 6865 2072 6566 6572  , only the refer
+000132a0: 656e 6365 2069 7320 7061 7373 6564 0a20  ence is passed. 
+000132b0: 2020 203a 7274 7970 653a 2054 0a20 2020     :rtype: T.   
+000132c0: 2022 2222 0a20 2020 2023 2053 6565 2061   """.    # See a
+000132d0: 6c73 6f20 636c 6173 7320 5069 636b 6c65  lso class Pickle
+000132e0: 7220 6672 6f6d 2054 6173 6b53 7973 7465  r from TaskSyste
+000132f0: 6d2e 0a20 2020 2023 204f 723a 2068 7474  m..    # Or: htt
+00013300: 7073 3a2f 2f6d 6169 6c2e 7079 7468 6f6e  ps://mail.python
+00013310: 2e6f 7267 2f70 6970 6572 6d61 696c 2f70  .org/pipermail/p
+00013320: 7974 686f 6e2d 6964 6561 732f 3230 3133  ython-ideas/2013
+00013330: 2d4a 756c 792f 3032 3139 3539 2e68 746d  -July/021959.htm
+00013340: 6c0a 2020 2020 6672 6f6d 202e 7461 736b  l.    from .task
+00013350: 5f73 7973 7465 6d20 696d 706f 7274 2050  _system import P
+00013360: 6963 6b6c 6572 2c20 556e 7069 636b 6c65  ickler, Unpickle
+00013370: 720a 0a20 2020 2070 6572 7369 7374 656e  r..    persisten
+00013380: 745f 6d65 6d6f 203d 207b 7d20 2023 2069  t_memo = {}  # i
+00013390: 6420 2d3e 206f 626a 0a0a 2020 2020 6465  d -> obj..    de
+000133a0: 6620 7065 7273 6973 7465 6e74 5f69 6428  f persistent_id(
+000133b0: 6f62 6a29 3a0a 2020 2020 2020 2020 2222  obj):.        ""
+000133c0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+000133d0: 206f 626a 6563 7420 6f62 6a3a 0a20 2020   object obj:.   
+000133e0: 2020 2020 203a 7274 7970 653a 2069 6e74       :rtype: int
+000133f0: 7c4e 6f6e 650a 2020 2020 2020 2020 2222  |None.        ""
+00013400: 220a 2020 2020 2020 2020 6966 2073 746f  ".        if sto
+00013410: 705f 7479 7065 7320 616e 6420 6973 696e  p_types and isin
+00013420: 7374 616e 6365 286f 626a 2c20 7475 706c  stance(obj, tupl
+00013430: 6528 7374 6f70 5f74 7970 6573 2929 3a0a  e(stop_types)):.
+00013440: 2020 2020 2020 2020 2020 2020 7065 7273              pers
+00013450: 6973 7465 6e74 5f6d 656d 6f5b 6964 286f  istent_memo[id(o
+00013460: 626a 295d 203d 206f 626a 0a20 2020 2020  bj)] = obj.     
+00013470: 2020 2020 2020 2072 6574 7572 6e20 6964         return id
+00013480: 286f 626a 290a 2020 2020 2020 2020 7265  (obj).        re
+00013490: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
+000134a0: 6566 2070 6963 6b6c 655f 6475 6d70 7328  ef pickle_dumps(
+000134b0: 6f62 6a29 3a0a 2020 2020 2020 2020 2222  obj):.        ""
+000134c0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+000134d0: 206f 626a 6563 7420 6f62 6a3a 0a20 2020   object obj:.   
+000134e0: 2020 2020 203a 7274 7970 653a 2062 7974       :rtype: byt
+000134f0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
+00013500: 2020 2020 2020 2073 696f 203d 2042 7974         sio = Byt
+00013510: 6573 494f 2829 0a20 2020 2020 2020 2070  esIO().        p
+00013520: 203d 2050 6963 6b6c 6572 2873 696f 290a   = Pickler(sio).
+00013530: 2020 2020 2020 2020 702e 7065 7273 6973          p.persis
+00013540: 7465 6e74 5f69 6420 3d20 7065 7273 6973  tent_id = persis
+00013550: 7465 6e74 5f69 640a 2020 2020 2020 2020  tent_id.        
+00013560: 702e 6475 6d70 286f 626a 290a 2020 2020  p.dump(obj).    
+00013570: 2020 2020 7265 7475 726e 2073 696f 2e67      return sio.g
+00013580: 6574 7661 6c75 6528 290a 0a20 2020 2023  etvalue()..    #
+00013590: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+000135a0: 5368 6164 6f77 696e 674e 616d 6573 0a20  ShadowingNames. 
+000135b0: 2020 2064 6566 2070 6963 6b6c 655f 6c6f     def pickle_lo
+000135c0: 6164 7328 7329 3a0a 2020 2020 2020 2020  ads(s):.        
+000135d0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+000135e0: 616d 2062 7974 6573 2073 3a0a 2020 2020  am bytes s:.    
+000135f0: 2020 2020 3a72 7479 7065 3a20 6f62 6a65      :rtype: obje
+00013600: 6374 0a20 2020 2020 2020 2022 2222 0a20  ct.        """. 
+00013610: 2020 2020 2020 2070 203d 2055 6e70 6963         p = Unpic
+00013620: 6b6c 6572 2842 7974 6573 494f 2873 2929  kler(BytesIO(s))
+00013630: 0a20 2020 2020 2020 2070 2e70 6572 7369  .        p.persi
+00013640: 7374 656e 745f 6c6f 6164 203d 2070 6572  stent_load = per
+00013650: 7369 7374 656e 745f 6d65 6d6f 2e5f 5f67  sistent_memo.__g
+00013660: 6574 6974 656d 5f5f 0a20 2020 2020 2020  etitem__.       
+00013670: 2072 6574 7572 6e20 702e 6c6f 6164 2829   return p.load()
+00013680: 0a0a 2020 2020 7320 3d20 7069 636b 6c65  ..    s = pickle
+00013690: 5f64 756d 7073 2878 290a 2020 2020 6320  _dumps(x).    c 
+000136a0: 3d20 7069 636b 6c65 5f6c 6f61 6473 2873  = pickle_loads(s
+000136b0: 290a 2020 2020 7265 7475 726e 2063 0a0a  ).    return c..
+000136c0: 0a64 6566 206c 6f61 645f 7478 745f 7665  .def load_txt_ve
+000136d0: 6374 6f72 2866 696c 656e 616d 6529 3a0a  ctor(filename):.
+000136e0: 2020 2020 2222 220a 2020 2020 4578 7065      """.    Expe
+000136f0: 6374 206c 696e 652d 6261 7365 6420 7465  ct line-based te
+00013700: 7874 2065 6e63 6f64 696e 6720 696e 2066  xt encoding in f
+00013710: 696c 652e 0a20 2020 2057 6520 616c 736f  ile..    We also
+00013720: 2073 7570 706f 7274 2053 7072 696e 7420   support Sprint 
+00013730: 584d 4c20 666f 726d 6174 2c20 7768 6963  XML format, whic
+00013740: 6820 6861 7320 736f 6d65 2061 6464 6974  h has some addit
+00013750: 696f 6e61 6c20 786d 6c20 6865 6164 6572  ional xml header
+00013760: 2061 6e64 2066 6f6f 7465 722c 0a20 2020   and footer,.   
+00013770: 2077 6869 6368 2077 6520 7769 6c6c 206a   which we will j
+00013780: 7573 7420 7374 7269 7020 6177 6179 2e0a  ust strip away..
+00013790: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
+000137a0: 6669 6c65 6e61 6d65 3a0a 2020 2020 3a72  filename:.    :r
+000137b0: 7479 7065 3a20 6c69 7374 5b66 6c6f 6174  type: list[float
+000137c0: 5d0a 2020 2020 2222 220a 2020 2020 7265  ].    """.    re
+000137d0: 7475 726e 205b 666c 6f61 7428 6c69 6e65  turn [float(line
+000137e0: 2920 666f 7220 6c69 6e65 2069 6e20 6f70  ) for line in op
+000137f0: 656e 2866 696c 656e 616d 6529 2e72 6561  en(filename).rea
+00013800: 6428 292e 7370 6c69 746c 696e 6573 2829  d().splitlines()
+00013810: 2069 6620 6c69 6e65 2061 6e64 206e 6f74   if line and not
+00013820: 206c 696e 652e 7374 6172 7473 7769 7468   line.startswith
+00013830: 2822 3c22 295d 0a0a 0a63 6c61 7373 2043  ("<")]...class C
+00013840: 6f6c 6c65 6374 696f 6e52 6561 6443 6865  ollectionReadChe
+00013850: 636b 436f 7665 7265 643a 0a20 2020 2022  ckCovered:.    "
+00013860: 2222 0a20 2020 2057 7261 7073 2061 726f  "".    Wraps aro
+00013870: 756e 6420 6120 6469 6374 2e20 4974 206b  und a dict. It k
+00013880: 6565 7073 2074 7261 636b 2061 626f 7574  eeps track about
+00013890: 2061 6c6c 2074 6865 206b 6579 7320 7768   all the keys wh
+000138a0: 6963 6820 7765 7265 2072 6561 6420 6672  ich were read fr
+000138b0: 6f6d 2074 6865 2064 6963 742e 0a20 2020  om the dict..   
+000138c0: 2056 6961 203a 6675 6e63 3a60 6173 7365   Via :func:`asse
+000138d0: 7274 5f61 6c6c 5f72 6561 6460 2c20 796f  rt_all_read`, yo
+000138e0: 7520 6361 6e20 6368 6563 6b20 7468 6174  u can check that
+000138f0: 2074 6865 7265 2061 7265 206e 6f20 6b65   there are no ke
+00013900: 7973 2069 6e20 7468 6520 6469 6374 2077  ys in the dict w
+00013910: 6869 6368 2077 6572 6520 6e6f 7420 7265  hich were not re
+00013920: 6164 2e0a 2020 2020 5468 6520 7573 6167  ad..    The usag
+00013930: 6520 6973 2066 6f72 2063 6f6e 6669 6720  e is for config 
+00013940: 6469 6374 206f 7074 696f 6e73 2c20 7768  dict options, wh
+00013950: 6572 6520 7468 6520 7573 6572 2068 6173  ere the user has
+00013960: 2073 7065 6369 6669 6564 2061 2072 616e   specified a ran
+00013970: 6765 206f 6620 6f70 7469 6f6e 732c 0a20  ge of options,. 
+00013980: 2020 2061 6e64 2077 6865 7265 2069 6e20     and where in 
+00013990: 7468 6520 636f 6465 2074 6865 7265 2069  the code there i
+000139a0: 7320 7573 7561 6c6c 7920 6120 6465 6661  s usually a defa
+000139b0: 756c 7420 666f 7220 6576 6572 7920 6e6f  ult for every no
+000139c0: 6e2d 7370 6563 6966 6965 6420 6f70 7469  n-specified opti
+000139d0: 6f6e 2c0a 2020 2020 746f 2063 6865 636b  on,.    to check
+000139e0: 2077 6865 7468 6572 2061 6c6c 2074 6865   whether all the
+000139f0: 2075 7365 722d 7370 6563 6966 6965 6420   user-specified 
+00013a00: 6f70 7469 6f6e 7320 6172 6520 616c 736f  options are also
+00013a10: 2075 7365 6420 286d 6179 6265 2074 6865   used (maybe the
+00013a20: 2075 7365 7220 6d61 6465 2061 2074 7970   user made a typ
+00013a30: 6f29 2e0a 2020 2020 2222 220a 0a20 2020  o)..    """..   
+00013a40: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00013a50: 6c66 2c20 636f 6c6c 6563 7469 6f6e 2c20  lf, collection, 
+00013a60: 7472 7574 685f 7661 6c75 653d 4e6f 6e65  truth_value=None
+00013a70: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00013a80: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
+00013a90: 6374 5b73 7472 5d20 636f 6c6c 6563 7469  ct[str] collecti
+00013aa0: 6f6e 3a0a 2020 2020 2020 2020 3a70 6172  on:.        :par
+00013ab0: 616d 204e 6f6e 657c 626f 6f6c 2074 7275  am None|bool tru
+00013ac0: 7468 5f76 616c 7565 3a20 6e6f 7465 3a20  th_value: note: 
+00013ad0: 6368 6563 6b20 6578 706c 6963 6974 6c79  check explicitly
+00013ae0: 2066 6f72 2073 656c 662e 7472 7574 685f   for self.truth_
+00013af0: 7661 6c75 652c 2062 6f6f 6c28 7365 6c66  value, bool(self
+00013b00: 2920 6973 206e 6f74 2074 6865 2073 616d  ) is not the sam
+00013b10: 6521 0a20 2020 2020 2020 2022 2222 0a20  e!.        """. 
+00013b20: 2020 2020 2020 2073 656c 662e 636f 6c6c         self.coll
+00013b30: 6563 7469 6f6e 203d 2063 6f6c 6c65 6374  ection = collect
+00013b40: 696f 6e0a 2020 2020 2020 2020 6966 2074  ion.        if t
+00013b50: 7275 7468 5f76 616c 7565 2069 7320 4e6f  ruth_value is No
+00013b60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00013b70: 7472 7574 685f 7661 6c75 6520 3d20 626f  truth_value = bo
+00013b80: 6f6c 2873 656c 662e 636f 6c6c 6563 7469  ol(self.collecti
+00013b90: 6f6e 290a 2020 2020 2020 2020 7365 6c66  on).        self
+00013ba0: 2e74 7275 7468 5f76 616c 7565 203d 2074  .truth_value = t
+00013bb0: 7275 7468 5f76 616c 7565 0a20 2020 2020  ruth_value.     
+00013bc0: 2020 2073 656c 662e 676f 745f 6974 656d     self.got_item
+00013bd0: 7320 3d20 7365 7428 290a 0a20 2020 2064  s = set()..    d
+00013be0: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+00013bf0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00013c00: 6e20 2225 7328 2572 2c20 7472 7574 685f  n "%s(%r, truth_
+00013c10: 7661 6c75 653d 2572 2922 2025 2028 7365  value=%r)" % (se
+00013c20: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+00013c30: 616d 655f 5f2c 2073 656c 662e 636f 6c6c  ame__, self.coll
+00013c40: 6563 7469 6f6e 2c20 7365 6c66 2e74 7275  ection, self.tru
+00013c50: 7468 5f76 616c 7565 290a 0a20 2020 2040  th_value)..    @
+00013c60: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00013c70: 6465 6620 6672 6f6d 5f62 6f6f 6c5f 6f72  def from_bool_or
+00013c80: 5f64 6963 7428 636c 732c 2076 616c 7565  _dict(cls, value
+00013c90: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00013ca0: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
+00013cb0: 6f6c 7c64 6963 745b 7374 725d 2076 616c  ol|dict[str] val
+00013cc0: 7565 3a0a 2020 2020 2020 2020 3a72 7479  ue:.        :rty
+00013cd0: 7065 3a20 436f 6c6c 6563 7469 6f6e 5265  pe: CollectionRe
+00013ce0: 6164 4368 6563 6b43 6f76 6572 6564 0a20  adCheckCovered. 
+00013cf0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013d00: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00013d10: 2876 616c 7565 2c20 626f 6f6c 293a 0a20  (value, bool):. 
+00013d20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00013d30: 6e20 636c 7328 636f 6c6c 6563 7469 6f6e  n cls(collection
+00013d40: 3d7b 7d2c 2074 7275 7468 5f76 616c 7565  ={}, truth_value
+00013d50: 3d76 616c 7565 290a 2020 2020 2020 2020  =value).        
+00013d60: 6966 2069 7369 6e73 7461 6e63 6528 7661  if isinstance(va
+00013d70: 6c75 652c 2064 6963 7429 3a0a 2020 2020  lue, dict):.    
+00013d80: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00013d90: 6c73 2863 6f6c 6c65 6374 696f 6e3d 7661  ls(collection=va
+00013da0: 6c75 6529 0a20 2020 2020 2020 2072 6169  lue).        rai
+00013db0: 7365 2054 7970 6545 7272 6f72 2822 696e  se TypeError("in
+00013dc0: 7661 6c69 6420 7479 7065 3a20 2573 2220  valid type: %s" 
+00013dd0: 2520 7479 7065 2876 616c 7565 2929 0a0a  % type(value))..
+00013de0: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+00013df0: 6d5f 5f28 7365 6c66 2c20 6974 656d 293a  m__(self, item):
+00013e00: 0a20 2020 2020 2020 2072 6573 203d 2073  .        res = s
+00013e10: 656c 662e 636f 6c6c 6563 7469 6f6e 5b69  elf.collection[i
+00013e20: 7465 6d5d 0a20 2020 2020 2020 2073 656c  tem].        sel
+00013e30: 662e 676f 745f 6974 656d 732e 6164 6428  f.got_items.add(
+00013e40: 6974 656d 290a 2020 2020 2020 2020 7265  item).        re
+00013e50: 7475 726e 2072 6573 0a0a 2020 2020 6465  turn res..    de
+00013e60: 6620 6765 7428 7365 6c66 2c20 6974 656d  f get(self, item
+00013e70: 2c20 6465 6661 756c 743d 4e6f 6e65 293a  , default=None):
+00013e80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013e90: 2020 2020 203a 7061 7261 6d20 7374 7220       :param str 
+00013ea0: 6974 656d 3a0a 2020 2020 2020 2020 3a70  item:.        :p
+00013eb0: 6172 616d 2054 2064 6566 6175 6c74 3a0a  aram T default:.
+00013ec0: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+00013ed0: 547c 7479 7069 6e67 2e41 6e79 7c4e 6f6e  T|typing.Any|Non
+00013ee0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00013ef0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00013f00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00013f10: 6c66 5b69 7465 6d5d 0a20 2020 2020 2020  lf[item].       
+00013f20: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+00013f30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00013f40: 7475 726e 2064 6566 6175 6c74 0a0a 2020  turn default..  
+00013f50: 2020 6465 6620 5f5f 626f 6f6c 5f5f 2873    def __bool__(s
+00013f60: 656c 6629 3a20 2023 2050 7974 686f 6e20  elf):  # Python 
+00013f70: 330a 2020 2020 2020 2020 7265 7475 726e  3.        return
+00013f80: 2073 656c 662e 7472 7574 685f 7661 6c75   self.truth_valu
+00013f90: 650a 0a20 2020 205f 5f6e 6f6e 7a65 726f  e..    __nonzero
+00013fa0: 5f5f 203d 205f 5f62 6f6f 6c5f 5f20 2023  __ = __bool__  #
+00013fb0: 2050 7974 686f 6e20 320a 0a20 2020 2064   Python 2..    d
+00013fc0: 6566 205f 5f6c 656e 5f5f 2873 656c 6629  ef __len__(self)
+00013fd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00013fe0: 206c 656e 2873 656c 662e 636f 6c6c 6563   len(self.collec
+00013ff0: 7469 6f6e 290a 0a20 2020 2064 6566 205f  tion)..    def _
+00014000: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
+00014010: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+00014020: 7365 6c66 2e63 6f6c 6c65 6374 696f 6e3a  self.collection:
+00014030: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
+00014040: 6c64 2073 656c 665b 6b5d 0a0a 2020 2020  ld self[k]..    
+00014050: 6465 6620 6173 7365 7274 5f61 6c6c 5f72  def assert_all_r
+00014060: 6561 6428 7365 6c66 293a 0a20 2020 2020  ead(self):.     
+00014070: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
+00014080: 7373 6572 7473 2074 6861 7420 616c 6c20  sserts that all 
+00014090: 6974 656d 7320 6861 7665 2062 6565 6e20  items have been 
+000140a0: 7265 6164 2e0a 2020 2020 2020 2020 2222  read..        ""
+000140b0: 220a 2020 2020 2020 2020 7265 6d61 696e  ".        remain
+000140c0: 696e 6720 3d20 7365 7428 7365 6c66 2e63  ing = set(self.c
+000140d0: 6f6c 6c65 6374 696f 6e29 2e64 6966 6665  ollection).diffe
+000140e0: 7265 6e63 6528 7365 6c66 2e67 6f74 5f69  rence(self.got_i
+000140f0: 7465 6d73 290a 2020 2020 2020 2020 6173  tems).        as
+00014100: 7365 7274 206e 6f74 2072 656d 6169 6e69  sert not remaini
+00014110: 6e67 2c20 2254 6865 206b 6579 7320 2572  ng, "The keys %r
+00014120: 2077 6572 6520 6e6f 7420 7265 6164 2069   were not read i
+00014130: 6e20 7468 6520 636f 6c6c 6563 7469 6f6e  n the collection
+00014140: 2025 722e 2220 2520 2872 656d 6169 6e69   %r." % (remaini
+00014150: 6e67 2c20 7365 6c66 2e63 6f6c 6c65 6374  ng, self.collect
+00014160: 696f 6e29 0a0a 0a64 6566 2077 6869 6368  ion)...def which
+00014170: 2870 726f 6772 616d 293a 0a20 2020 2022  (program):.    "
+00014180: 2222 0a20 2020 2046 696e 6473 2060 7072  "".    Finds `pr
+00014190: 6f67 7261 6d60 2069 6e20 736f 6d65 206f  ogram` in some o
+000141a0: 6620 7468 6520 6469 7273 206f 6620 7468  f the dirs of th
+000141b0: 6520 5041 5448 2065 6e76 2076 6172 2e0a  e PATH env var..
+000141c0: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
+000141d0: 7072 6f67 7261 6d3a 2065 2e67 2e20 2270  program: e.g. "p
+000141e0: 7974 686f 6e22 0a20 2020 203a 7265 7475  ython".    :retu
+000141f0: 726e 3a20 6675 6c6c 2070 6174 682c 2065  rn: full path, e
+00014200: 2e67 2e20 222f 7573 722f 6269 6e2f 7079  .g. "/usr/bin/py
+00014210: 7468 6f6e 222c 206f 7220 4e6f 6e65 0a20  thon", or None. 
+00014220: 2020 203a 7274 7970 653a 2073 7472 7c4e     :rtype: str|N
+00014230: 6f6e 650a 2020 2020 2222 220a 2020 2020  one.    """.    
+00014240: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
+00014250: 7953 6861 646f 7769 6e67 4e61 6d65 730a  yShadowingNames.
+00014260: 2020 2020 6465 6620 6973 5f65 7865 2870      def is_exe(p
+00014270: 6174 6829 3a0a 2020 2020 2020 2020 2222  ath):.        ""
+00014280: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+00014290: 2073 7472 2070 6174 683a 0a20 2020 2020   str path:.     
+000142a0: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
+000142b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000142c0: 2020 2072 6574 7572 6e20 6f73 2e70 6174     return os.pat
+000142d0: 682e 6973 6669 6c65 2870 6174 6829 2061  h.isfile(path) a
+000142e0: 6e64 206f 732e 6163 6365 7373 2870 6174  nd os.access(pat
+000142f0: 682c 206f 732e 585f 4f4b 290a 0a20 2020  h, os.X_OK)..   
+00014300: 2066 7061 7468 2c20 666e 616d 6520 3d20   fpath, fname = 
+00014310: 6f73 2e70 6174 682e 7370 6c69 7428 7072  os.path.split(pr
+00014320: 6f67 7261 6d29 0a20 2020 2069 6620 6670  ogram).    if fp
+00014330: 6174 683a 0a20 2020 2020 2020 2069 6620  ath:.        if 
+00014340: 6973 5f65 7865 2870 726f 6772 616d 293a  is_exe(program):
+00014350: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014360: 7572 6e20 7072 6f67 7261 6d0a 2020 2020  urn program.    
+00014370: 656c 7365 3a0a 2020 2020 2020 2020 666f  else:.        fo
+00014380: 7220 7061 7468 2069 6e20 6f73 2e65 6e76  r path in os.env
+00014390: 6972 6f6e 5b22 5041 5448 225d 2e73 706c  iron["PATH"].spl
+000143a0: 6974 286f 732e 7061 7468 7365 7029 3a0a  it(os.pathsep):.
+000143b0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+000143c0: 203d 2070 6174 682e 7374 7269 7028 2722   = path.strip('"
+000143d0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
+000143e0: 7865 5f66 696c 6520 3d20 6f73 2e70 6174  xe_file = os.pat
+000143f0: 682e 6a6f 696e 2870 6174 682c 2070 726f  h.join(path, pro
+00014400: 6772 616d 290a 2020 2020 2020 2020 2020  gram).          
+00014410: 2020 6966 2069 735f 6578 6528 6578 655f    if is_exe(exe_
+00014420: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+00014430: 2020 2020 2020 2072 6574 7572 6e20 6578         return ex
+00014440: 655f 6669 6c65 0a0a 2020 2020 7265 7475  e_file..    retu
+00014450: 726e 204e 6f6e 650a 0a0a 6465 6620 7768  rn None...def wh
+00014460: 6963 685f 7069 7028 293a 0a20 2020 2022  ich_pip():.    "
+00014470: 2222 0a20 2020 203a 7274 7970 653a 2073  "".    :rtype: s
+00014480: 7472 0a20 2020 203a 7265 7475 726e 3a20  tr.    :return: 
+00014490: 7061 7468 2074 6f20 7069 7020 666f 7220  path to pip for 
+000144a0: 7468 6520 6375 7272 656e 7420 5079 7468  the current Pyth
+000144b0: 6f6e 2065 6e76 0a20 2020 2022 2222 0a20  on env.    """. 
+000144c0: 2020 2023 2042 6566 6f72 6520 7765 206c     # Before we l
+000144d0: 6f6f 6b20 616e 7977 6865 7265 2069 6e20  ook anywhere in 
+000144e0: 5041 5448 2c20 6368 6563 6b20 6966 2074  PATH, check if t
+000144f0: 6865 7265 2069 7320 736f 6d65 2070 6970  here is some pip
+00014500: 2061 6c6f 6e67 7369 6465 2074 6f20 7468   alongside to th
+00014510: 6520 5079 7468 6f6e 2065 7865 6375 7461  e Python executa
+00014520: 626c 652e 0a20 2020 2023 2054 6869 7320  ble..    # This 
+00014530: 6d69 6768 7420 6265 206d 6f72 6520 7265  might be more re
+00014540: 6c69 6162 6c65 2e0a 2020 2020 7079 203d  liable..    py =
+00014550: 2073 7973 2e65 7865 6375 7461 626c 650a   sys.executable.
+00014560: 2020 2020 6469 725f 6e61 6d65 2c20 6261      dir_name, ba
+00014570: 7365 6e61 6d65 203d 2070 792e 7273 706c  sename = py.rspl
+00014580: 6974 2822 2f22 2c20 3129 0a20 2020 2069  it("/", 1).    i
+00014590: 6620 6261 7365 6e61 6d65 2e73 7461 7274  f basename.start
+000145a0: 7377 6974 6828 2270 7974 686f 6e22 293a  swith("python"):
+000145b0: 0a20 2020 2020 2020 2070 6f73 7466 6978  .        postfix
+000145c0: 203d 2062 6173 656e 616d 655b 6c65 6e28   = basename[len(
+000145d0: 2270 7974 686f 6e22 2920 3a5d 0a20 2020  "python") :].   
+000145e0: 2020 2020 2070 6970 5f70 6174 6820 3d20       pip_path = 
+000145f0: 2225 732f 7069 7025 7322 2025 2028 6469  "%s/pip%s" % (di
+00014600: 725f 6e61 6d65 2c20 706f 7374 6669 7829  r_name, postfix)
+00014610: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00014620: 6174 682e 6578 6973 7473 2870 6970 5f70  ath.exists(pip_p
+00014630: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00014640: 2020 7265 7475 726e 2070 6970 5f70 6174    return pip_pat
+00014650: 680a 2020 2020 2320 4765 6e65 7269 6320  h.    # Generic 
+00014660: 6661 6c6c 6261 636b 2e0a 2020 2020 7069  fallback..    pi
+00014670: 705f 7061 7468 203d 2077 6869 6368 2822  p_path = which("
+00014680: 7069 7022 290a 2020 2020 7265 7475 726e  pip").    return
+00014690: 2070 6970 5f70 6174 680a 0a0a 6465 6620   pip_path...def 
+000146a0: 7069 705f 696e 7374 616c 6c28 2a70 6b67  pip_install(*pkg
+000146b0: 5f6e 616d 6573 293a 0a20 2020 2022 2222  _names):.    """
+000146c0: 0a20 2020 2049 6e73 7461 6c6c 2070 6163  .    Install pac
+000146d0: 6b61 6765 7320 7669 6120 7069 7020 666f  kages via pip fo
+000146e0: 7220 7468 6520 6375 7272 656e 7420 5079  r the current Py
+000146f0: 7468 6f6e 2065 6e76 2e0a 0a20 2020 203a  thon env...    :
+00014700: 7061 7261 6d20 7374 7220 706b 675f 6e61  param str pkg_na
+00014710: 6d65 733a 0a20 2020 2022 2222 0a20 2020  mes:.    """.   
+00014720: 2070 7920 3d20 7379 732e 6578 6563 7574   py = sys.execut
+00014730: 6162 6c65 0a20 2020 2070 6970 5f70 6174  able.    pip_pat
+00014740: 6820 3d20 7768 6963 685f 7069 7028 290a  h = which_pip().
+00014750: 2020 2020 7072 696e 7428 2250 6970 2069      print("Pip i
+00014760: 6e73 7461 6c6c 222c 202a 706b 675f 6e61  nstall", *pkg_na
+00014770: 6d65 7329 0a20 2020 2069 6e5f 7669 7274  mes).    in_virt
+00014780: 7561 6c5f 656e 7620 3d20 6861 7361 7474  ual_env = hasatt
+00014790: 7228 7379 732c 2022 7265 616c 5f70 7265  r(sys, "real_pre
+000147a0: 6669 7822 2920 2023 2068 7474 7073 3a2f  fix")  # https:/
+000147b0: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
+000147c0: 6f6d 2f71 7565 7374 696f 6e73 2f31 3837  om/questions/187
+000147d0: 3135 3439 2f0a 2020 2020 636d 6420 3d20  1549/.    cmd = 
+000147e0: 5b70 792c 2070 6970 5f70 6174 682c 2022  [py, pip_path, "
+000147f0: 696e 7374 616c 6c22 5d0a 2020 2020 6966  install"].    if
+00014800: 206e 6f74 2069 6e5f 7669 7274 7561 6c5f   not in_virtual_
+00014810: 656e 763a 0a20 2020 2020 2020 2063 6d64  env:.        cmd
+00014820: 202b 3d20 5b22 2d2d 7573 6572 225d 0a20   += ["--user"]. 
+00014830: 2020 2063 6d64 202b 3d20 6c69 7374 2870     cmd += list(p
+00014840: 6b67 5f6e 616d 6573 290a 2020 2020 7072  kg_names).    pr
+00014850: 696e 7428 2224 2025 7322 2025 2022 2022  int("$ %s" % " "
+00014860: 2e6a 6f69 6e28 636d 6429 290a 2020 2020  .join(cmd)).    
+00014870: 7375 6270 726f 6365 7373 2e63 6865 636b  subprocess.check
+00014880: 5f63 616c 6c28 636d 642c 2063 7764 3d22  _call(cmd, cwd="
+00014890: 2f22 290a 2020 2020 5f70 6970 5f69 6e73  /").    _pip_ins
+000148a0: 7461 6c6c 6564 5f70 6163 6b61 6765 732e  talled_packages.
+000148b0: 636c 6561 7228 2920 2023 2066 6f72 6365  clear()  # force
+000148c0: 2072 656c 6f61 640a 0a0a 5f70 6970 5f69   reload..._pip_i
+000148d0: 6e73 7461 6c6c 6564 5f70 6163 6b61 6765  nstalled_package
+000148e0: 7320 3d20 7365 7428 290a 0a0a 6465 6620  s = set()...def 
+000148f0: 7069 705f 6368 6563 6b5f 6973 5f69 6e73  pip_check_is_ins
+00014900: 7461 6c6c 6564 2870 6b67 5f6e 616d 6529  talled(pkg_name)
+00014910: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00014920: 6172 616d 2073 7472 2070 6b67 5f6e 616d  aram str pkg_nam
+00014930: 653a 2077 6974 686f 7574 2076 6572 7369  e: without versi
+00014940: 6f6e 2c20 652e 672e 206a 7573 7420 2274  on, e.g. just "t
+00014950: 656e 736f 7266 6c6f 7722 2c20 6f72 2077  ensorflow", or w
+00014960: 6974 6820 7665 7273 696f 6e2c 2065 2e67  ith version, e.g
+00014970: 2e20 2274 656e 736f 7266 6c6f 773d 3d31  . "tensorflow==1
+00014980: 2e32 2e33 220a 2020 2020 3a72 7479 7065  .2.3".    :rtype
+00014990: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
+000149a0: 2020 2069 6620 6e6f 7420 5f70 6970 5f69     if not _pip_i
+000149b0: 6e73 7461 6c6c 6564 5f70 6163 6b61 6765  nstalled_package
+000149c0: 733a 0a20 2020 2020 2020 2070 7920 3d20  s:.        py = 
+000149d0: 7379 732e 6578 6563 7574 6162 6c65 0a20  sys.executable. 
+000149e0: 2020 2020 2020 2070 6970 5f70 6174 6820         pip_path 
+000149f0: 3d20 7768 6963 685f 7069 7028 290a 2020  = which_pip().  
+00014a00: 2020 2020 2020 636d 6420 3d20 5b70 792c        cmd = [py,
+00014a10: 2070 6970 5f70 6174 682c 2022 6672 6565   pip_path, "free
+00014a20: 7a65 225d 0a20 2020 2020 2020 2066 6f72  ze"].        for
+00014a30: 206c 696e 6520 696e 2073 7973 5f65 7865   line in sys_exe
+00014a40: 635f 6f75 7428 2a63 6d64 292e 7370 6c69  c_out(*cmd).spli
+00014a50: 746c 696e 6573 2829 3a0a 2020 2020 2020  tlines():.      
+00014a60: 2020 2020 2020 6966 206c 696e 6520 616e        if line an
+00014a70: 6420 223d 3d22 2069 6e20 6c69 6e65 3a0a  d "==" in line:.
+00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a90: 6966 2022 3d3d 2220 6e6f 7420 696e 2070  if "==" not in p
+00014aa0: 6b67 5f6e 616d 653a 0a20 2020 2020 2020  kg_name:.       
+00014ab0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+00014ac0: 6520 3d20 6c69 6e65 5b3a 206c 696e 652e  e = line[: line.
+00014ad0: 696e 6465 7828 223d 3d22 295d 0a20 2020  index("==")].   
+00014ae0: 2020 2020 2020 2020 2020 2020 205f 7069               _pi
+00014af0: 705f 696e 7374 616c 6c65 645f 7061 636b  p_installed_pack
+00014b00: 6167 6573 2e61 6464 286c 696e 6529 0a20  ages.add(line). 
+00014b10: 2020 2072 6574 7572 6e20 706b 675f 6e61     return pkg_na
+00014b20: 6d65 2069 6e20 5f70 6970 5f69 6e73 7461  me in _pip_insta
+00014b30: 6c6c 6564 5f70 6163 6b61 6765 730a 0a0a  lled_packages...
+00014b40: 5f6f 7269 6769 6e61 6c5f 6578 6563 7620  _original_execv 
+00014b50: 3d20 4e6f 6e65 0a5f 6f72 6967 696e 616c  = None._original
+00014b60: 5f65 7865 6376 6520 3d20 4e6f 6e65 0a5f  _execve = None._
+00014b70: 6f72 6967 696e 616c 5f65 7865 6376 7065  original_execvpe
+00014b80: 203d 204e 6f6e 650a 0a0a 6465 6620 6f76   = None...def ov
+00014b90: 6572 7772 6974 655f 6f73 5f65 7865 6328  erwrite_os_exec(
+00014ba0: 7072 6566 6978 5f61 7267 7329 3a0a 2020  prefix_args):.  
+00014bb0: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+00014bc0: 206c 6973 745b 7374 725d 2070 7265 6669   list[str] prefi
+00014bd0: 785f 6172 6773 3a0a 2020 2020 2222 220a  x_args:.    """.
+00014be0: 2020 2020 676c 6f62 616c 205f 6f72 6967      global _orig
+00014bf0: 696e 616c 5f65 7865 6376 2c20 5f6f 7269  inal_execv, _ori
+00014c00: 6769 6e61 6c5f 6578 6563 7665 2c20 5f6f  ginal_execve, _o
+00014c10: 7269 6769 6e61 6c5f 6578 6563 7670 650a  riginal_execvpe.
+00014c20: 2020 2020 6966 206e 6f74 205f 6f72 6967      if not _orig
+00014c30: 696e 616c 5f65 7865 6376 3a0a 2020 2020  inal_execv:.    
+00014c40: 2020 2020 5f6f 7269 6769 6e61 6c5f 6578      _original_ex
+00014c50: 6563 7620 3d20 6f73 2e65 7865 6376 0a20  ecv = os.execv. 
+00014c60: 2020 2069 6620 6e6f 7420 5f6f 7269 6769     if not _origi
+00014c70: 6e61 6c5f 6578 6563 7665 3a0a 2020 2020  nal_execve:.    
+00014c80: 2020 2020 5f6f 7269 6769 6e61 6c5f 6578      _original_ex
+00014c90: 6563 7665 203d 206f 732e 6578 6563 7665  ecve = os.execve
+00014ca0: 0a20 2020 2069 6620 6e6f 7420 5f6f 7269  .    if not _ori
+00014cb0: 6769 6e61 6c5f 6578 6563 7670 653a 0a20  ginal_execvpe:. 
+00014cc0: 2020 2020 2020 2023 206e 6f69 6e73 7065         # noinspe
+00014cd0: 6374 696f 6e20 5079 5072 6f74 6563 7465  ction PyProtecte
+00014ce0: 644d 656d 6265 722c 5079 556e 7265 736f  dMember,PyUnreso
+00014cf0: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
+00014d00: 2020 2020 2020 205f 6f72 6967 696e 616c         _original
+00014d10: 5f65 7865 6376 7065 203d 206f 732e 5f65  _execvpe = os._e
+00014d20: 7865 6376 7065 0a0a 2020 2020 2320 6e6f  xecvpe..    # no
+00014d30: 696e 7370 6563 7469 6f6e 2050 7955 6e75  inspection PyUnu
+00014d40: 7365 644c 6f63 616c 0a20 2020 2064 6566  sedLocal.    def
+00014d50: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
+00014d60: 2866 696c 652c 2061 7267 732c 2065 6e76  (file, args, env
+00014d70: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00014d80: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+00014d90: 616d 2066 696c 653a 0a20 2020 2020 2020  am file:.       
+00014da0: 203a 7061 7261 6d20 6c69 7374 5b73 7472   :param list[str
+00014db0: 5d7c 7475 706c 655b 7374 725d 2061 7267  ]|tuple[str] arg
+00014dc0: 733a 0a20 2020 2020 2020 203a 7061 7261  s:.        :para
+00014dd0: 6d20 6469 6374 5b73 7472 5d20 656e 763a  m dict[str] env:
+00014de0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014df0: 2020 2020 206e 6577 5f61 7267 7320 3d20       new_args = 
+00014e00: 7072 6566 6978 5f61 7267 7320 2b20 5b77  prefix_args + [w
+00014e10: 6869 6368 2861 7267 735b 305d 295d 202b  hich(args[0])] +
+00014e20: 2061 7267 735b 313a 5d0a 2020 2020 2020   args[1:].      
+00014e30: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
+00014e40: 7465 2822 2420 2573 5c6e 2220 2520 2220  te("$ %s\n" % " 
+00014e50: 222e 6a6f 696e 286e 6577 5f61 7267 7329  ".join(new_args)
+00014e60: 290a 2020 2020 2020 2020 7379 732e 7374  ).        sys.st
+00014e70: 6465 7272 2e66 6c75 7368 2829 0a20 2020  derr.flush().   
+00014e80: 2020 2020 205f 6f72 6967 696e 616c 5f65       _original_e
+00014e90: 7865 6376 7065 2866 696c 653d 7072 6566  xecvpe(file=pref
+00014ea0: 6978 5f61 7267 735b 305d 2c20 6172 6773  ix_args[0], args
+00014eb0: 3d6e 6577 5f61 7267 732c 2065 6e76 3d65  =new_args, env=e
+00014ec0: 6e76 290a 0a20 2020 2064 6566 2065 7865  nv)..    def exe
+00014ed0: 6376 2870 6174 682c 2061 7267 7329 3a0a  cv(path, args):.
+00014ee0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014ef0: 2020 2020 3a70 6172 616d 2073 7472 2070      :param str p
+00014f00: 6174 683a 0a20 2020 2020 2020 203a 7061  ath:.        :pa
+00014f10: 7261 6d20 6c69 7374 5b73 7472 5d7c 7475  ram list[str]|tu
+00014f20: 706c 655b 7374 725d 2061 7267 733a 0a20  ple[str] args:. 
+00014f30: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014f40: 2020 2069 6620 6172 6773 5b3a 206c 656e     if args[: len
+00014f50: 2870 7265 6669 785f 6172 6773 295d 203d  (prefix_args)] =
+00014f60: 3d20 7072 6566 6978 5f61 7267 733a 0a20  = prefix_args:. 
+00014f70: 2020 2020 2020 2020 2020 205f 6f72 6967             _orig
+00014f80: 696e 616c 5f65 7865 6376 2870 6174 682c  inal_execv(path,
+00014f90: 2061 7267 7329 0a20 2020 2020 2020 2065   args).        e
+00014fa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00014fb0: 2077 7261 7070 6564 5f65 7865 6376 7065   wrapped_execvpe
+00014fc0: 2870 6174 682c 2061 7267 7329 0a0a 2020  (path, args)..  
+00014fd0: 2020 6465 6620 6578 6563 7665 2870 6174    def execve(pat
+00014fe0: 682c 2061 7267 732c 2065 6e76 293a 0a20  h, args, env):. 
+00014ff0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00015000: 2020 203a 7061 7261 6d20 7374 7220 7061     :param str pa
+00015010: 7468 3a0a 2020 2020 2020 2020 3a70 6172  th:.        :par
+00015020: 616d 206c 6973 745b 7374 725d 7c74 7570  am list[str]|tup
+00015030: 6c65 5b73 7472 5d20 6172 6773 3a0a 2020  le[str] args:.  
+00015040: 2020 2020 2020 3a70 6172 616d 2064 6963        :param dic
+00015050: 745b 7374 725d 2065 6e76 3a0a 2020 2020  t[str] env:.    
+00015060: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015070: 6966 2061 7267 735b 3a20 6c65 6e28 7072  if args[: len(pr
+00015080: 6566 6978 5f61 7267 7329 5d20 3d3d 2070  efix_args)] == p
+00015090: 7265 6669 785f 6172 6773 3a0a 2020 2020  refix_args:.    
+000150a0: 2020 2020 2020 2020 5f6f 7269 6769 6e61          _origina
+000150b0: 6c5f 6578 6563 7665 2870 6174 682c 2061  l_execve(path, a
+000150c0: 7267 732c 2065 6e76 290a 2020 2020 2020  rgs, env).      
+000150d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000150e0: 2020 2020 7772 6170 7065 645f 6578 6563      wrapped_exec
+000150f0: 7670 6528 7061 7468 2c20 6172 6773 2c20  vpe(path, args, 
+00015100: 656e 7629 0a0a 2020 2020 6465 6620 6578  env)..    def ex
+00015110: 6563 6c28 6669 6c65 2c20 2a61 7267 7329  ecl(file, *args)
+00015120: 3a0a 2020 2020 2020 2020 2222 2265 7865  :.        """exe
+00015130: 636c 2866 696c 652c 202a 6172 6773 290a  cl(file, *args).
+00015140: 0a20 2020 2020 2020 2045 7865 6375 7465  .        Execute
+00015150: 2074 6865 2065 7865 6375 7461 626c 6520   the executable 
+00015160: 6669 6c65 2077 6974 6820 6172 6775 6d65  file with argume
+00015170: 6e74 206c 6973 7420 6172 6773 2c20 7265  nt list args, re
+00015180: 706c 6163 696e 6720 7468 650a 2020 2020  placing the.    
+00015190: 2020 2020 6375 7272 656e 7420 7072 6f63      current proc
+000151a0: 6573 732e 2222 220a 2020 2020 2020 2020  ess.""".        
+000151b0: 6f73 2e65 7865 6376 2866 696c 652c 2061  os.execv(file, a
+000151c0: 7267 7329 0a0a 2020 2020 6465 6620 6578  rgs)..    def ex
+000151d0: 6563 6c65 2866 696c 652c 202a 6172 6773  ecle(file, *args
+000151e0: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
+000151f0: 6563 6c65 2866 696c 652c 202a 6172 6773  ecle(file, *args
+00015200: 2c20 656e 7629 0a0a 2020 2020 2020 2020  , env)..        
+00015210: 4578 6563 7574 6520 7468 6520 6578 6563  Execute the exec
+00015220: 7574 6162 6c65 2066 696c 6520 7769 7468  utable file with
+00015230: 2061 7267 756d 656e 7420 6c69 7374 2061   argument list a
+00015240: 7267 7320 616e 640a 2020 2020 2020 2020  rgs and.        
+00015250: 656e 7669 726f 6e6d 656e 7420 656e 762c  environment env,
+00015260: 2072 6570 6c61 6369 6e67 2074 6865 2063   replacing the c
+00015270: 7572 7265 6e74 2070 726f 6365 7373 2e22  urrent process."
+00015280: 2222 0a20 2020 2020 2020 2065 6e76 203d  "".        env =
+00015290: 2061 7267 735b 2d31 5d0a 2020 2020 2020   args[-1].      
+000152a0: 2020 6f73 2e65 7865 6376 6528 6669 6c65    os.execve(file
+000152b0: 2c20 6172 6773 5b3a 2d31 5d2c 2065 6e76  , args[:-1], env
+000152c0: 290a 0a20 2020 2064 6566 2065 7865 636c  )..    def execl
+000152d0: 7028 6669 6c65 2c20 2a61 7267 7329 3a0a  p(file, *args):.
+000152e0: 2020 2020 2020 2020 2222 2265 7865 636c          """execl
+000152f0: 7028 6669 6c65 2c20 2a61 7267 7329 0a0a  p(file, *args)..
+00015300: 2020 2020 2020 2020 4578 6563 7574 6520          Execute 
+00015310: 7468 6520 6578 6563 7574 6162 6c65 2066  the executable f
+00015320: 696c 6520 2877 6869 6368 2069 7320 7365  ile (which is se
+00015330: 6172 6368 6564 2066 6f72 2061 6c6f 6e67  arched for along
+00015340: 2024 5041 5448 290a 2020 2020 2020 2020   $PATH).        
+00015350: 7769 7468 2061 7267 756d 656e 7420 6c69  with argument li
+00015360: 7374 2061 7267 732c 2072 6570 6c61 6369  st args, replaci
+00015370: 6e67 2074 6865 2063 7572 7265 6e74 2070  ng the current p
+00015380: 726f 6365 7373 2e22 2222 0a20 2020 2020  rocess.""".     
+00015390: 2020 206f 732e 6578 6563 7670 2866 696c     os.execvp(fil
+000153a0: 652c 2061 7267 7329 0a0a 2020 2020 6465  e, args)..    de
+000153b0: 6620 6578 6563 6c70 6528 6669 6c65 2c20  f execlpe(file, 
+000153c0: 2a61 7267 7329 3a0a 2020 2020 2020 2020  *args):.        
+000153d0: 2222 2265 7865 636c 7065 2866 696c 652c  """execlpe(file,
+000153e0: 202a 6172 6773 2c20 656e 7629 0a0a 2020   *args, env)..  
+000153f0: 2020 2020 2020 4578 6563 7574 6520 7468        Execute th
+00015400: 6520 6578 6563 7574 6162 6c65 2066 696c  e executable fil
+00015410: 6520 2877 6869 6368 2069 7320 7365 6172  e (which is sear
+00015420: 6368 6564 2066 6f72 2061 6c6f 6e67 2024  ched for along $
+00015430: 5041 5448 290a 2020 2020 2020 2020 7769  PATH).        wi
+00015440: 7468 2061 7267 756d 656e 7420 6c69 7374  th argument list
+00015450: 2061 7267 7320 616e 6420 656e 7669 726f   args and enviro
+00015460: 6e6d 656e 7420 656e 762c 2072 6570 6c61  nment env, repla
+00015470: 6369 6e67 2074 6865 2063 7572 7265 6e74  cing the current
+00015480: 0a20 2020 2020 2020 2070 726f 6365 7373  .        process
+00015490: 2e22 2222 0a20 2020 2020 2020 2065 6e76  .""".        env
+000154a0: 203d 2061 7267 735b 2d31 5d0a 2020 2020   = args[-1].    
+000154b0: 2020 2020 6f73 2e65 7865 6376 7065 2866      os.execvpe(f
+000154c0: 696c 652c 2061 7267 735b 3a2d 315d 2c20  ile, args[:-1], 
+000154d0: 656e 7629 0a0a 2020 2020 6465 6620 6578  env)..    def ex
+000154e0: 6563 7670 2866 696c 652c 2061 7267 7329  ecvp(file, args)
+000154f0: 3a0a 2020 2020 2020 2020 2222 2265 7865  :.        """exe
+00015500: 6376 7028 6669 6c65 2c20 6172 6773 290a  cvp(file, args).
+00015510: 0a20 2020 2020 2020 2045 7865 6375 7465  .        Execute
+00015520: 2074 6865 2065 7865 6375 7461 626c 6520   the executable 
+00015530: 6669 6c65 2028 7768 6963 6820 6973 2073  file (which is s
+00015540: 6561 7263 6865 6420 666f 7220 616c 6f6e  earched for alon
+00015550: 6720 2450 4154 4829 0a20 2020 2020 2020  g $PATH).       
+00015560: 2077 6974 6820 6172 6775 6d65 6e74 206c   with argument l
+00015570: 6973 7420 6172 6773 2c20 7265 706c 6163  ist args, replac
+00015580: 696e 6720 7468 6520 6375 7272 656e 7420  ing the current 
+00015590: 7072 6f63 6573 732e 0a20 2020 2020 2020  process..       
+000155a0: 2061 7267 7320 6d61 7920 6265 2061 206c   args may be a l
+000155b0: 6973 7420 6f72 2074 7570 6c65 206f 6620  ist or tuple of 
+000155c0: 7374 7269 6e67 732e 2222 220a 2020 2020  strings.""".    
+000155d0: 2020 2020 7772 6170 7065 645f 6578 6563      wrapped_exec
+000155e0: 7670 6528 6669 6c65 2c20 6172 6773 290a  vpe(file, args).
+000155f0: 0a20 2020 2064 6566 2065 7865 6376 7065  .    def execvpe
+00015600: 2866 696c 652c 2061 7267 732c 2065 6e76  (file, args, env
+00015610: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
+00015620: 6563 7670 6528 6669 6c65 2c20 6172 6773  ecvpe(file, args
+00015630: 2c20 656e 7629 0a0a 2020 2020 2020 2020  , env)..        
+00015640: 4578 6563 7574 6520 7468 6520 6578 6563  Execute the exec
+00015650: 7574 6162 6c65 2066 696c 6520 2877 6869  utable file (whi
+00015660: 6368 2069 7320 7365 6172 6368 6564 2066  ch is searched f
+00015670: 6f72 2061 6c6f 6e67 2024 5041 5448 290a  or along $PATH).
+00015680: 2020 2020 2020 2020 7769 7468 2061 7267          with arg
+00015690: 756d 656e 7420 6c69 7374 2061 7267 7320  ument list args 
+000156a0: 616e 6420 656e 7669 726f 6e6d 656e 7420  and environment 
+000156b0: 656e 7620 2c20 7265 706c 6163 696e 6720  env , replacing 
+000156c0: 7468 650a 2020 2020 2020 2020 6375 7272  the.        curr
+000156d0: 656e 7420 7072 6f63 6573 732e 0a20 2020  ent process..   
+000156e0: 2020 2020 2061 7267 7320 6d61 7920 6265       args may be
+000156f0: 2061 206c 6973 7420 6f72 2074 7570 6c65   a list or tuple
+00015700: 206f 6620 7374 7269 6e67 732e 2222 220a   of strings.""".
+00015710: 2020 2020 2020 2020 7772 6170 7065 645f          wrapped_
+00015720: 6578 6563 7670 6528 6669 6c65 2c20 6172  execvpe(file, ar
+00015730: 6773 2c20 656e 7629 0a0a 2020 2020 6f73  gs, env)..    os
+00015740: 2e65 7865 6376 203d 2065 7865 6376 0a20  .execv = execv. 
+00015750: 2020 206f 732e 6578 6563 7665 203d 2065     os.execve = e
+00015760: 7865 6376 650a 2020 2020 6f73 2e65 7865  xecve.    os.exe
+00015770: 636c 203d 2065 7865 636c 0a20 2020 206f  cl = execl.    o
+00015780: 732e 6578 6563 6c65 203d 2065 7865 636c  s.execle = execl
+00015790: 650a 2020 2020 6f73 2e65 7865 636c 7020  e.    os.execlp 
+000157a0: 3d20 6578 6563 6c70 0a20 2020 206f 732e  = execlp.    os.
+000157b0: 6578 6563 6c70 6520 3d20 6578 6563 6c70  execlpe = execlp
+000157c0: 650a 2020 2020 6f73 2e65 7865 6376 7020  e.    os.execvp 
+000157d0: 3d20 6578 6563 7670 0a20 2020 206f 732e  = execvp.    os.
+000157e0: 6578 6563 7670 6520 3d20 6578 6563 7670  execvpe = execvp
+000157f0: 650a 2020 2020 6f73 2e5f 6578 6563 7670  e.    os._execvp
+00015800: 6520 3d20 7772 6170 7065 645f 6578 6563  e = wrapped_exec
+00015810: 7670 650a 0a0a 6465 6620 6765 745f 6c73  vpe...def get_ls
+00015820: 625f 7265 6c65 6173 6528 293a 0a20 2020  b_release():.   
+00015830: 2022 2222 0a20 2020 203a 7265 7475 726e   """.    :return
+00015840: 3a20 6060 2f65 7463 2f6c 7362 2d72 656c  : ``/etc/lsb-rel
+00015850: 6561 7365 6060 2070 6172 7365 6420 6173  ease`` parsed as
+00015860: 2061 2064 6963 740a 2020 2020 3a72 7479   a dict.    :rty
+00015870: 7065 3a20 6469 6374 5b73 7472 2c73 7472  pe: dict[str,str
+00015880: 5d0a 2020 2020 2222 220a 2020 2020 6420  ].    """.    d 
+00015890: 3d20 7b7d 0a20 2020 2066 6f72 206c 696e  = {}.    for lin
+000158a0: 6520 696e 206f 7065 6e28 222f 6574 632f  e in open("/etc/
+000158b0: 6c73 622d 7265 6c65 6173 6522 292e 7265  lsb-release").re
+000158c0: 6164 2829 2e73 706c 6974 6c69 6e65 7328  ad().splitlines(
+000158d0: 293a 0a20 2020 2020 2020 206b 2c20 7620  ):.        k, v 
+000158e0: 3d20 6c69 6e65 2e73 706c 6974 2822 3d22  = line.split("="
+000158f0: 2c20 3129 0a20 2020 2020 2020 2069 6620  , 1).        if 
+00015900: 765b 305d 203d 3d20 765b 2d31 5d20 3d3d  v[0] == v[-1] ==
+00015910: 2027 2227 3a0a 2020 2020 2020 2020 2020   '"':.          
+00015920: 2020 7620 3d20 765b 313a 2d31 5d0a 2020    v = v[1:-1].  
+00015930: 2020 2020 2020 645b 6b5d 203d 2076 0a20        d[k] = v. 
+00015940: 2020 2072 6574 7572 6e20 640a 0a0a 6465     return d...de
+00015950: 6620 6765 745f 7562 756e 7475 5f6d 616a  f get_ubuntu_maj
+00015960: 6f72 5f76 6572 7369 6f6e 2829 3a0a 2020  or_version():.  
+00015970: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
+00015980: 3a20 696e 747c 4e6f 6e65 0a20 2020 2022  : int|None.    "
+00015990: 2222 0a20 2020 2064 203d 2067 6574 5f6c  "".    d = get_l
+000159a0: 7362 5f72 656c 6561 7365 2829 0a20 2020  sb_release().   
+000159b0: 2069 6620 645b 2244 4953 5452 4942 5f49   if d["DISTRIB_I
+000159c0: 4422 5d20 213d 2022 5562 756e 7475 223a  D"] != "Ubuntu":
+000159d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000159e0: 4e6f 6e65 0a20 2020 2072 6574 7572 6e20  None.    return 
+000159f0: 696e 7428 666c 6f61 7428 645b 2244 4953  int(float(d["DIS
+00015a00: 5452 4942 5f52 454c 4541 5345 225d 2929  TRIB_RELEASE"]))
+00015a10: 0a0a 0a64 6566 2061 7574 6f5f 7072 6566  ...def auto_pref
+00015a20: 6978 5f6f 735f 6578 6563 5f70 7265 6669  ix_os_exec_prefi
+00015a30: 785f 7562 756e 7475 2870 7265 6669 785f  x_ubuntu(prefix_
+00015a40: 6172 6773 2c20 7562 756e 7475 5f6d 696e  args, ubuntu_min
+00015a50: 5f76 6572 7369 6f6e 3d31 3629 3a0a 2020  _version=16):.  
+00015a60: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+00015a70: 206c 6973 745b 7374 725d 2070 7265 6669   list[str] prefi
+00015a80: 785f 6172 6773 3a0a 2020 2020 3a70 6172  x_args:.    :par
+00015a90: 616d 2069 6e74 2075 6275 6e74 755f 6d69  am int ubuntu_mi
+00015aa0: 6e5f 7665 7273 696f 6e3a 0a0a 2020 2020  n_version:..    
+00015ab0: 4578 616d 706c 6520 7573 6167 653a 0a20  Example usage:. 
+00015ac0: 2020 2020 2061 7574 6f5f 7072 6566 6978       auto_prefix
+00015ad0: 5f6f 735f 6578 6563 5f70 7265 6669 785f  _os_exec_prefix_
+00015ae0: 7562 756e 7475 285b 222f 752f 7a65 7965  ubuntu(["/u/zeye
+00015af0: 722f 746f 6f6c 732f 676c 6962 6332 3137  r/tools/glibc217
+00015b00: 2f6c 642d 6c69 6e75 782d 7838 362d 3634  /ld-linux-x86-64
+00015b10: 2e73 6f2e 3222 5d29 0a20 2020 2022 2222  .so.2"]).    """
+00015b20: 0a20 2020 2075 6275 6e74 755f 7665 7273  .    ubuntu_vers
+00015b30: 696f 6e20 3d20 6765 745f 7562 756e 7475  ion = get_ubuntu
+00015b40: 5f6d 616a 6f72 5f76 6572 7369 6f6e 2829  _major_version()
+00015b50: 0a20 2020 2069 6620 7562 756e 7475 5f76  .    if ubuntu_v
+00015b60: 6572 7369 6f6e 2069 7320 4e6f 6e65 3a0a  ersion is None:.
+00015b70: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00015b80: 2020 2069 6620 7562 756e 7475 5f76 6572     if ubuntu_ver
+00015b90: 7369 6f6e 203e 3d20 7562 756e 7475 5f6d  sion >= ubuntu_m
+00015ba0: 696e 5f76 6572 7369 6f6e 3a0a 2020 2020  in_version:.    
+00015bb0: 2020 2020 7265 7475 726e 0a20 2020 2070      return.    p
+00015bc0: 7269 6e74 2822 596f 7520 6172 6520 7275  rint("You are ru
+00015bd0: 6e6e 696e 6720 5562 756e 7475 2025 692c  nning Ubuntu %i,
+00015be0: 2074 6875 7320 7765 2070 7265 6669 7820   thus we prefix 
+00015bf0: 616c 6c20 6f73 2e65 7865 6320 7769 7468  all os.exec with
+00015c00: 2025 732e 2220 2520 2875 6275 6e74 755f   %s." % (ubuntu_
+00015c10: 7665 7273 696f 6e2c 2070 7265 6669 785f  version, prefix_
+00015c20: 6172 6773 2929 0a20 2020 2061 7373 6572  args)).    asser
+00015c30: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00015c40: 2870 7265 6669 785f 6172 6773 5b30 5d29  (prefix_args[0])
+00015c50: 0a20 2020 206f 7665 7277 7269 7465 5f6f  .    overwrite_o
+00015c60: 735f 6578 6563 2870 7265 6669 785f 6172  s_exec(prefix_ar
+00015c70: 6773 3d70 7265 6669 785f 6172 6773 290a  gs=prefix_args).
+00015c80: 0a0a 6465 6620 636c 6561 6e75 705f 656e  ..def cleanup_en
+00015c90: 765f 7661 725f 7061 7468 2865 6e76 5f76  v_var_path(env_v
+00015ca0: 6172 2c20 7061 7468 5f70 7265 6669 7829  ar, path_prefix)
+00015cb0: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00015cc0: 6172 616d 2073 7472 2065 6e76 5f76 6172  aram str env_var
+00015cd0: 3a20 652e 672e 2022 4c44 5f4c 4942 5241  : e.g. "LD_LIBRA
+00015ce0: 5259 5f50 4154 4822 0a20 2020 203a 7061  RY_PATH".    :pa
+00015cf0: 7261 6d20 7374 7220 7061 7468 5f70 7265  ram str path_pre
+00015d00: 6669 783a 0a0a 2020 2020 5769 6c6c 2072  fix:..    Will r
+00015d10: 656d 6f76 6520 616c 6c20 7061 7468 7320  emove all paths 
+00015d20: 696e 206f 732e 656e 7669 726f 6e5b 656e  in os.environ[en
+00015d30: 765f 7661 725d 2077 6869 6368 2061 7265  v_var] which are
+00015d40: 2070 7265 6669 7865 6420 7769 7468 2070   prefixed with p
+00015d50: 6174 685f 7072 6566 6978 2e0a 2020 2020  ath_prefix..    
+00015d60: 2222 220a 2020 2020 6966 2065 6e76 5f76  """.    if env_v
+00015d70: 6172 206e 6f74 2069 6e20 6f73 2e65 6e76  ar not in os.env
+00015d80: 6972 6f6e 3a0a 2020 2020 2020 2020 7265  iron:.        re
+00015d90: 7475 726e 0a20 2020 2070 7320 3d20 6f73  turn.    ps = os
+00015da0: 2e65 6e76 6972 6f6e 5b65 6e76 5f76 6172  .environ[env_var
+00015db0: 5d2e 7370 6c69 7428 223a 2229 0a0a 2020  ].split(":")..  
+00015dc0: 2020 6465 6620 6628 7029 3a0a 2020 2020    def f(p):.    
+00015dd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015de0: 3a70 6172 616d 2073 7472 2070 3a0a 2020  :param str p:.  
+00015df0: 2020 2020 2020 3a72 7479 7065 3a20 626f        :rtype: bo
+00015e00: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
+00015e10: 2020 2020 2020 2069 6620 7020 3d3d 2070         if p == p
+00015e20: 6174 685f 7072 6566 6978 206f 7220 702e  ath_prefix or p.
+00015e30: 7374 6172 7473 7769 7468 2870 6174 685f  startswith(path_
+00015e40: 7072 6566 6978 202b 2022 2f22 293a 0a20  prefix + "/"):. 
+00015e50: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00015e60: 2822 5265 6d6f 7669 6e67 2025 7320 6672  ("Removing %s fr
+00015e70: 6f6d 2025 732e 2220 2520 2870 2c20 656e  om %s." % (p, en
+00015e80: 765f 7661 7229 290a 2020 2020 2020 2020  v_var)).        
+00015e90: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00015ea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015eb0: 5472 7565 0a0a 2020 2020 7073 203d 2066  True..    ps = f
+00015ec0: 696c 7465 7228 662c 2070 7329 0a20 2020  ilter(f, ps).   
+00015ed0: 206f 732e 656e 7669 726f 6e5b 656e 765f   os.environ[env_
+00015ee0: 7661 725d 203d 2022 3a22 2e6a 6f69 6e28  var] = ":".join(
+00015ef0: 7073 290a 0a0a 6465 6620 6765 745f 6c6f  ps)...def get_lo
+00015f00: 6769 6e5f 7573 6572 6e61 6d65 2829 3a0a  gin_username():.
+00015f10: 2020 2020 2222 220a 2020 2020 3a72 7479      """.    :rty
+00015f20: 7065 3a20 7374 720a 2020 2020 3a72 6574  pe: str.    :ret
+00015f30: 7572 6e3a 2074 6865 2075 7365 726e 616d  urn: the usernam
+00015f40: 6520 6f66 2074 6865 2063 7572 7265 6e74  e of the current
+00015f50: 2075 7365 722e 0a20 2020 2055 7365 2074   user..    Use t
+00015f60: 6869 7320 6173 2061 2072 6570 6c61 6365  his as a replace
+00015f70: 6d65 6e74 2066 6f72 206f 732e 6765 746c  ment for os.getl
+00015f80: 6f67 696e 2829 2e0a 2020 2020 2222 220a  ogin()..    """.
+00015f90: 2020 2020 696d 706f 7274 206f 730a 0a20      import os.. 
+00015fa0: 2020 2069 6620 7379 732e 706c 6174 666f     if sys.platfo
+00015fb0: 726d 203d 3d20 2277 696e 3332 223a 0a20  rm == "win32":. 
+00015fc0: 2020 2020 2020 2072 6574 7572 6e20 6f73         return os
+00015fd0: 2e67 6574 6c6f 6769 6e28 290a 2020 2020  .getlogin().    
+00015fe0: 696d 706f 7274 2070 7764 0a0a 2020 2020  import pwd..    
+00015ff0: 7472 793a 0a20 2020 2020 2020 2072 6574  try:.        ret
+00016000: 7572 6e20 7077 642e 6765 7470 7775 6964  urn pwd.getpwuid
+00016010: 286f 732e 6765 7475 6964 2829 295b 305d  (os.getuid())[0]
+00016020: 0a20 2020 2065 7863 6570 7420 4b65 7945  .    except KeyE
+00016030: 7272 6f72 3a0a 2020 2020 2020 2020 2320  rror:.        # 
+00016040: 7077 642e 6765 7470 7775 6964 2829 2063  pwd.getpwuid() c
+00016050: 616e 2074 6872 6f77 204b 6579 4572 726f  an throw KeyErro
+00016060: 723a 2027 6765 7470 7775 6964 2829 3a20  r: 'getpwuid(): 
+00016070: 7569 6420 6e6f 7420 666f 756e 643a 2031  uid not found: 1
+00016080: 3233 3435 270a 2020 2020 2020 2020 2320  2345'.        # 
+00016090: 7468 6973 2063 616e 2068 6170 7065 6e20  this can happen 
+000160a0: 652e 672e 2069 6e20 6120 646f 636b 6572  e.g. in a docker
+000160b0: 2065 6e76 6972 6f6e 6d65 6e74 2077 6974   environment wit
+000160c0: 6820 6d61 7070 6564 2075 6964 7320 756e  h mapped uids un
+000160d0: 6b6e 6f77 6e20 746f 2074 6865 2064 6f63  known to the doc
+000160e0: 6b65 7220 4f53 0a20 2020 2020 2020 2072  ker OS.        r
+000160f0: 6574 7572 6e20 7374 7228 6f73 2e67 6574  eturn str(os.get
+00016100: 7569 6428 2929 0a0a 0a64 6566 2067 6574  uid())...def get
+00016110: 5f74 656d 705f 6469 7228 293a 0a20 2020  _temp_dir():.   
+00016120: 2022 2222 0a20 2020 203a 7274 7970 653a   """.    :rtype:
+00016130: 2073 7472 0a20 2020 203a 7265 7475 726e   str.    :return
+00016140: 3a20 652e 672e 2022 2f74 6d70 2f24 5553  : e.g. "/tmp/$US
+00016150: 4552 4e41 4d45 220a 2020 2020 2222 220a  ERNAME".    """.
+00016160: 2020 2020 7573 6572 6e61 6d65 203d 2067      username = g
+00016170: 6574 5f6c 6f67 696e 5f75 7365 726e 616d  et_login_usernam
+00016180: 6528 290a 2020 2020 666f 7220 656e 766e  e().    for envn
+00016190: 616d 6520 696e 205b 2254 4d50 4449 5222  ame in ["TMPDIR"
+000161a0: 2c20 2254 454d 5022 2c20 2254 4d50 225d  , "TEMP", "TMP"]
+000161b0: 3a0a 2020 2020 2020 2020 6469 726e 616d  :.        dirnam
+000161c0: 6520 3d20 6f73 2e67 6574 656e 7628 656e  e = os.getenv(en
+000161d0: 766e 616d 6529 0a20 2020 2020 2020 2069  vname).        i
+000161e0: 6620 6469 726e 616d 653a 0a20 2020 2020  f dirname:.     
+000161f0: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
+00016200: 732f 2573 2220 2520 2864 6972 6e61 6d65  s/%s" % (dirname
+00016210: 2c20 7573 6572 6e61 6d65 290a 2020 2020  , username).    
+00016220: 2320 2f76 6172 2f74 6d70 2073 686f 756c  # /var/tmp shoul
+00016230: 6420 6265 206d 6f72 6520 7065 7273 6973  d be more persis
+00016240: 7465 6e74 2074 6861 6e20 2f74 6d70 2075  tent than /tmp u
+00016250: 7375 616c 6c79 2e0a 2020 2020 6966 206f  sually..    if o
+00016260: 732e 7061 7468 2e65 7869 7374 7328 222f  s.path.exists("/
+00016270: 7661 722f 746d 7022 293a 0a20 2020 2020  var/tmp"):.     
+00016280: 2020 2072 6574 7572 6e20 222f 7661 722f     return "/var/
+00016290: 746d 702f 2573 2220 2520 7573 6572 6e61  tmp/%s" % userna
+000162a0: 6d65 0a20 2020 2072 6574 7572 6e20 222f  me.    return "/
+000162b0: 746d 702f 2573 2220 2520 7573 6572 6e61  tmp/%s" % userna
+000162c0: 6d65 0a0a 0a64 6566 2067 6574 5f63 6163  me...def get_cac
+000162d0: 6865 5f64 6972 2829 3a0a 2020 2020 2222  he_dir():.    ""
+000162e0: 220a 2020 2020 3a72 6574 7572 6e3a 2075  ".    :return: u
+000162f0: 7365 6420 746f 2063 6163 6865 206e 6f6e  sed to cache non
+00016300: 2d63 7269 7469 6361 6c20 7468 696e 6773  -critical things
+00016310: 2e20 6279 2064 6566 6175 6c74 2067 6574  . by default get
+00016320: 5f74 656d 705f 6469 722e 2075 6e6c 6573  _temp_dir. unles
+00016330: 7320 796f 7520 6465 6669 6e65 2065 6e76  s you define env
+00016340: 2052 4554 5552 4e4e 5f43 4143 4845 5f44   RETURNN_CACHE_D
+00016350: 4952 0a20 2020 203a 7274 7970 653a 2073  IR.    :rtype: s
+00016360: 7472 0a20 2020 2022 2222 0a20 2020 2069  tr.    """.    i
+00016370: 6620 2252 4554 5552 4e4e 5f43 4143 4845  f "RETURNN_CACHE
+00016380: 5f44 4952 2220 696e 206f 732e 656e 7669  _DIR" in os.envi
+00016390: 726f 6e3a 0a20 2020 2020 2020 2072 6574  ron:.        ret
+000163a0: 7572 6e20 6f73 2e65 6e76 6972 6f6e 5b22  urn os.environ["
+000163b0: 5245 5455 524e 4e5f 4341 4348 455f 4449  RETURNN_CACHE_DI
+000163c0: 5222 5d0a 2020 2020 7265 7475 726e 2067  R"].    return g
+000163d0: 6574 5f74 656d 705f 6469 7228 290a 0a0a  et_temp_dir()...
+000163e0: 636c 6173 7320 4c6f 636b 4669 6c65 286f  class LockFile(o
+000163f0: 626a 6563 7429 3a0a 2020 2020 2222 220a  bject):.    """.
+00016400: 2020 2020 5369 6d70 6c65 206c 6f63 6b20      Simple lock 
+00016410: 6669 6c65 2e0a 2020 2020 2222 220a 0a20  file..    """.. 
+00016420: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00016430: 7365 6c66 2c20 6469 7265 6374 6f72 792c  self, directory,
+00016440: 206e 616d 653d 226c 6f63 6b5f 6669 6c65   name="lock_file
+00016450: 222c 206c 6f63 6b5f 7469 6d65 6f75 743d  ", lock_timeout=
+00016460: 3120 2a20 3630 202a 2036 3029 3a0a 2020  1 * 60 * 60):.  
+00016470: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016480: 2020 3a70 6172 616d 2073 7472 2064 6972    :param str dir
+00016490: 6563 746f 7279 3a0a 2020 2020 2020 2020  ectory:.        
+000164a0: 3a70 6172 616d 2069 6e74 7c66 6c6f 6174  :param int|float
+000164b0: 206c 6f63 6b5f 7469 6d65 6f75 743a 2069   lock_timeout: i
+000164c0: 6e20 7365 636f 6e64 730a 2020 2020 2020  n seconds.      
+000164d0: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+000164e0: 6c66 2e64 6972 6563 746f 7279 203d 2064  lf.directory = d
+000164f0: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
+00016500: 2073 656c 662e 6e61 6d65 203d 206e 616d   self.name = nam
+00016510: 650a 2020 2020 2020 2020 7365 6c66 2e66  e.        self.f
+00016520: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
+00016530: 2073 656c 662e 6c6f 636b 5f74 696d 656f   self.lock_timeo
+00016540: 7574 203d 206c 6f63 6b5f 7469 6d65 6f75  ut = lock_timeou
+00016550: 740a 2020 2020 2020 2020 7365 6c66 2e6c  t.        self.l
+00016560: 6f63 6b66 696c 6520 3d20 2225 732f 2573  ockfile = "%s/%s
+00016570: 2220 2520 2864 6972 6563 746f 7279 2c20  " % (directory, 
+00016580: 6e61 6d65 290a 0a20 2020 2064 6566 2069  name)..    def i
+00016590: 735f 6f6c 645f 6c6f 636b 6669 6c65 2873  s_old_lockfile(s
+000165a0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+000165b0: 220a 2020 2020 2020 2020 3a72 6574 7572  ".        :retur
+000165c0: 6e3a 2057 6865 7468 6572 2074 6865 7265  n: Whether there
+000165d0: 2069 7320 616e 2065 7869 7374 696e 6720   is an existing 
+000165e0: 6c6f 636b 2066 696c 6520 616e 6420 7468  lock file and th
+000165f0: 6520 6578 6973 7469 6e67 206c 6f63 6b20  e existing lock 
+00016600: 6669 6c65 2069 7320 6f6c 642e 0a20 2020  file is old..   
+00016610: 2020 2020 203a 7274 7970 653a 2062 6f6f       :rtype: boo
+00016620: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+00016630: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00016640: 2020 2020 2020 206d 7469 6d65 203d 206f         mtime = o
+00016650: 732e 7061 7468 2e67 6574 6d74 696d 6528  s.path.getmtime(
+00016660: 7365 6c66 2e6c 6f63 6b66 696c 6529 0a20  self.lockfile). 
+00016670: 2020 2020 2020 2065 7863 6570 7420 4f53         except OS
+00016680: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00016690: 2020 206d 7469 6d65 203d 204e 6f6e 650a     mtime = None.
+000166a0: 2020 2020 2020 2020 6966 206d 7469 6d65          if mtime
+000166b0: 2061 6e64 2028 6162 7328 7469 6d65 2e74   and (abs(time.t
+000166c0: 696d 6528 2920 2d20 6d74 696d 6529 203e  ime() - mtime) >
+000166d0: 2073 656c 662e 6c6f 636b 5f74 696d 656f   self.lock_timeo
+000166e0: 7574 293a 0a20 2020 2020 2020 2020 2020  ut):.           
+000166f0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+00016700: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00016710: 650a 0a20 2020 2064 6566 206d 6179 6265  e..    def maybe
+00016720: 5f72 656d 6f76 655f 6f6c 645f 6c6f 636b  _remove_old_lock
+00016730: 6669 6c65 2873 656c 6629 3a0a 2020 2020  file(self):.    
+00016740: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016750: 5265 6d6f 7665 7320 616e 2065 7869 7374  Removes an exist
+00016760: 696e 6720 6f6c 6420 6c6f 636b 6669 6c65  ing old lockfile
+00016770: 2c20 6966 2074 6865 7265 2069 7320 6f6e  , if there is on
+00016780: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+00016790: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+000167a0: 6c66 2e69 735f 6f6c 645f 6c6f 636b 6669  lf.is_old_lockfi
+000167b0: 6c65 2829 3a0a 2020 2020 2020 2020 2020  le():.          
+000167c0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+000167d0: 2070 7269 6e74 2822 5265 6d6f 7669 6e67   print("Removing
+000167e0: 206f 6c64 206c 6f63 6b66 696c 6520 2572   old lockfile %r
+000167f0: 2028 7072 6f62 6162 6c79 2063 7261 7368   (probably crash
+00016800: 6564 2070 726f 6329 2e22 2025 2073 656c  ed proc)." % sel
+00016810: 662e 6c6f 636b 6669 6c65 290a 2020 2020  f.lockfile).    
+00016820: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00016830: 2020 2020 206f 732e 7265 6d6f 7665 2873       os.remove(s
+00016840: 656c 662e 6c6f 636b 6669 6c65 290a 2020  elf.lockfile).  
+00016850: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
+00016860: 7272 6f72 2061 7320 6578 633a 0a20 2020  rror as exc:.   
+00016870: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00016880: 5265 6d6f 7665 206c 6f63 6b66 696c 6520  Remove lockfile 
+00016890: 6578 6365 7074 696f 6e20 2572 2e20 4967  exception %r. Ig
+000168a0: 6e6f 7269 6e67 2069 742e 2220 2520 6578  noring it." % ex
+000168b0: 6329 0a0a 2020 2020 6465 6620 6973 5f6c  c)..    def is_l
+000168c0: 6f63 6b65 6428 7365 6c66 293a 0a20 2020  ocked(self):.   
+000168d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000168e0: 203a 7265 7475 726e 3a20 7768 6574 6865   :return: whethe
+000168f0: 7220 7468 6572 6520 6973 2061 6e20 6163  r there is an ac
+00016900: 7469 7665 2028 6e6f 7420 6f6c 6429 206c  tive (not old) l
+00016910: 6f63 6b66 696c 650a 2020 2020 2020 2020  ockfile.        
+00016920: 3a72 7479 7065 3a20 626f 6f6c 0a20 2020  :rtype: bool.   
+00016930: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016940: 2069 6620 7365 6c66 2e69 735f 6f6c 645f   if self.is_old_
+00016950: 6c6f 636b 6669 6c65 2829 3a0a 2020 2020  lockfile():.    
+00016960: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00016970: 616c 7365 0a20 2020 2020 2020 2074 7279  alse.        try
+00016980: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00016990: 7475 726e 206f 732e 7061 7468 2e65 7869  turn os.path.exi
+000169a0: 7374 7328 7365 6c66 2e6c 6f63 6b66 696c  sts(self.lockfil
+000169b0: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
+000169c0: 7420 4f53 4572 726f 723a 0a20 2020 2020  t OSError:.     
+000169d0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000169e0: 6c73 650a 0a20 2020 2064 6566 206c 6f63  lse..    def loc
+000169f0: 6b28 7365 6c66 293a 0a20 2020 2020 2020  k(self):.       
+00016a00: 2022 2222 0a20 2020 2020 2020 2041 6371   """.        Acq
+00016a10: 7569 7265 7320 7468 6520 6c6f 636b 2e0a  uires the lock..
+00016a20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016a30: 2020 2020 696d 706f 7274 2074 696d 650a      import time.
+00016a40: 2020 2020 2020 2020 696d 706f 7274 2065          import e
+00016a50: 7272 6e6f 0a0a 2020 2020 2020 2020 7761  rrno..        wa
+00016a60: 6974 5f63 6f75 6e74 203d 2030 0a20 2020  it_count = 0.   
+00016a70: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+00016a80: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+00016a90: 7279 2074 6f20 6372 6561 7465 2064 6972  ry to create dir
+00016aa0: 6563 746f 7279 2069 6620 6974 2064 6f65  ectory if it doe
+00016ab0: 7320 6e6f 7420 6578 6973 742e 0a20 2020  s not exist..   
+00016ac0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00016ad0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+00016ae0: 2e6d 616b 6564 6972 7328 7365 6c66 2e64  .makedirs(self.d
+00016af0: 6972 6563 746f 7279 290a 2020 2020 2020  irectory).      
+00016b00: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
+00016b10: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00016b20: 2020 2020 2020 7061 7373 2020 2320 4967        pass  # Ig
+00016b30: 6e6f 7265 2061 6e79 2065 7272 6f72 732e  nore any errors.
+00016b40: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
+00016b50: 6f77 2074 7279 2074 6f20 6372 6561 7465  ow try to create
+00016b60: 2074 6865 206c 6f63 6b2e 0a20 2020 2020   the lock..     
+00016b70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00016b80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016b90: 2e66 6420 3d20 6f73 2e6f 7065 6e28 7365  .fd = os.open(se
+00016ba0: 6c66 2e6c 6f63 6b66 696c 652c 206f 732e  lf.lockfile, os.
+00016bb0: 4f5f 4352 4541 5420 7c20 6f73 2e4f 5f45  O_CREAT | os.O_E
+00016bc0: 5843 4c20 7c20 6f73 2e4f 5f52 4457 5229  XCL | os.O_RDWR)
+00016bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016be0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+00016bf0: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+00016c00: 6f72 2061 7320 6578 633a 0a20 2020 2020  or as exc:.     
+00016c10: 2020 2020 2020 2020 2020 2023 2050 6f73             # Pos
+00016c20: 7369 626c 6520 6572 726f 7273 3a0a 2020  sible errors:.  
+00016c30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00016c40: 454e 4f45 4e54 2028 4e6f 2073 7563 6820  ENOENT (No such 
+00016c50: 6669 6c65 206f 7220 6469 7265 6374 6f72  file or director
+00016c60: 7929 2c20 652e 672e 2069 6620 7468 6520  y), e.g. if the 
+00016c70: 6469 7265 6374 6f72 7920 7761 7320 6465  directory was de
+00016c80: 6c65 7465 642e 0a20 2020 2020 2020 2020  leted..         
+00016c90: 2020 2020 2020 2023 2045 4558 4953 5420         # EEXIST 
+00016ca0: 2846 696c 6520 6578 6973 7473 292c 2069  (File exists), i
+00016cb0: 6620 7468 6520 6c6f 636b 2061 6c72 6561  f the lock alrea
+00016cc0: 6479 2065 7869 7374 732e 0a20 2020 2020  dy exists..     
+00016cd0: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
+00016ce0: 632e 6572 726e 6f20 6e6f 7420 696e 205b  c.errno not in [
+00016cf0: 6572 726e 6f2e 454e 4f45 4e54 2c20 6572  errno.ENOENT, er
+00016d00: 726e 6f2e 4545 5849 5354 5d3a 0a20 2020  rno.EEXIST]:.   
+00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d20: 2072 6169 7365 2020 2320 4f74 6865 7220   raise  # Other 
+00016d30: 6572 726f 722c 2073 6f20 7265 7261 6973  error, so rerais
+00016d40: 652e 0a20 2020 2020 2020 2020 2020 2023  e..            #
+00016d50: 2057 6520 6469 6420 6e6f 7420 6765 7420   We did not get 
+00016d60: 7468 6520 6c6f 636b 2e0a 2020 2020 2020  the lock..      
+00016d70: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+00016d80: 2069 7420 6973 2061 2072 6561 6c6c 7920   it is a really 
+00016d90: 6f6c 6420 6f6e 652e 0a20 2020 2020 2020  old one..       
+00016da0: 2020 2020 2073 656c 662e 6d61 7962 655f       self.maybe_
+00016db0: 7265 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66  remove_old_lockf
+00016dc0: 696c 6528 290a 2020 2020 2020 2020 2020  ile().          
+00016dd0: 2020 2320 5761 6974 2061 2062 6974 2c20    # Wait a bit, 
+00016de0: 616e 6420 7468 656e 2072 6574 7279 2e0a  and then retry..
+00016df0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00016e00: 2e73 6c65 6570 2831 290a 2020 2020 2020  .sleep(1).      
+00016e10: 2020 2020 2020 7761 6974 5f63 6f75 6e74        wait_count
+00016e20: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00016e30: 2020 6966 2077 6169 745f 636f 756e 7420    if wait_count 
+00016e40: 3d3d 2031 303a 0a20 2020 2020 2020 2020  == 10:.         
+00016e50: 2020 2020 2020 2070 7269 6e74 2822 5761         print("Wa
+00016e60: 6974 696e 6720 666f 7220 6c6f 636b 2d66  iting for lock-f
+00016e70: 696c 653a 2025 7322 2025 2073 656c 662e  ile: %s" % self.
+00016e80: 6c6f 636b 6669 6c65 290a 0a20 2020 2064  lockfile)..    d
+00016e90: 6566 2075 6e6c 6f63 6b28 7365 6c66 293a  ef unlock(self):
+00016ea0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00016eb0: 2020 2020 2052 656c 6561 7365 7320 7468       Releases th
+00016ec0: 6520 6c6f 636b 2e0a 2020 2020 2020 2020  e lock..        
+00016ed0: 2222 220a 2020 2020 2020 2020 6f73 2e63  """.        os.c
+00016ee0: 6c6f 7365 2873 656c 662e 6664 290a 2020  lose(self.fd).  
+00016ef0: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
+00016f00: 7365 6c66 2e6c 6f63 6b66 696c 6529 0a0a  self.lockfile)..
+00016f10: 2020 2020 6465 6620 5f5f 656e 7465 725f      def __enter_
+00016f20: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00016f30: 2073 656c 662e 6c6f 636b 2829 0a0a 2020   self.lock()..  
+00016f40: 2020 6465 6620 5f5f 6578 6974 5f5f 2873    def __exit__(s
+00016f50: 656c 662c 2065 7863 5f74 7970 652c 2065  elf, exc_type, e
+00016f60: 7863 5f76 616c 2c20 6578 635f 7462 293a  xc_val, exc_tb):
+00016f70: 0a20 2020 2020 2020 2073 656c 662e 756e  .        self.un
+00016f80: 6c6f 636b 2829 0a0a 0a64 6566 2073 7472  lock()...def str
+00016f90: 5f69 735f 6e75 6d62 6572 2873 293a 0a20  _is_number(s):. 
+00016fa0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+00016fb0: 6d20 7374 7220 733a 2065 2e67 2e20 2231  m str s: e.g. "1
+00016fc0: 222c 2022 2e33 2220 6f72 2022 7822 0a20  ", ".3" or "x". 
+00016fd0: 2020 203a 7265 7475 726e 3a20 7768 6574     :return: whet
+00016fe0: 6865 7220 7320 6361 6e20 6265 2063 6173  her s can be cas
+00016ff0: 7465 6420 746f 2066 6c6f 6174 206f 7220  ted to float or 
+00017000: 696e 740a 2020 2020 3a72 7479 7065 3a20  int.    :rtype: 
+00017010: 626f 6f6c 0a20 2020 2022 2222 0a20 2020  bool.    """.   
+00017020: 2074 7279 3a0a 2020 2020 2020 2020 666c   try:.        fl
+00017030: 6f61 7428 7329 0a20 2020 2020 2020 2072  oat(s).        r
+00017040: 6574 7572 6e20 5472 7565 0a20 2020 2065  eturn True.    e
+00017050: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00017060: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00017070: 2046 616c 7365 0a0a 0a64 6566 2073 6f72   False...def sor
+00017080: 7465 645f 7661 6c75 6573 5f66 726f 6d5f  ted_values_from_
+00017090: 6469 6374 2864 293a 0a20 2020 2022 2222  dict(d):.    """
+000170a0: 0a20 2020 203a 7061 7261 6d20 6469 6374  .    :param dict
+000170b0: 5b54 2c56 5d20 643a 0a20 2020 203a 7274  [T,V] d:.    :rt
+000170c0: 7970 653a 206c 6973 745b 565d 0a20 2020  ype: list[V].   
+000170d0: 2022 2222 0a20 2020 2061 7373 6572 7420   """.    assert 
+000170e0: 6973 696e 7374 616e 6365 2864 2c20 6469  isinstance(d, di
+000170f0: 6374 290a 2020 2020 7265 7475 726e 205b  ct).    return [
+00017100: 7620 666f 7220 286b 2c20 7629 2069 6e20  v for (k, v) in 
+00017110: 736f 7274 6564 2864 2e69 7465 6d73 2829  sorted(d.items()
+00017120: 295d 0a0a 0a64 6566 2064 6963 745f 7a69  )]...def dict_zi
+00017130: 7028 6b65 7973 2c20 7661 6c75 6573 293a  p(keys, values):
+00017140: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00017150: 7261 6d20 6c69 7374 5b54 5d20 6b65 7973  ram list[T] keys
+00017160: 3a0a 2020 2020 3a70 6172 616d 206c 6973  :.    :param lis
+00017170: 745b 565d 2076 616c 7565 733a 0a20 2020  t[V] values:.   
+00017180: 203a 7274 7970 653a 2064 6963 745b 542c   :rtype: dict[T,
+00017190: 565d 0a20 2020 2022 2222 0a20 2020 2061  V].    """.    a
+000171a0: 7373 6572 7420 6c65 6e28 6b65 7973 2920  ssert len(keys) 
+000171b0: 3d3d 206c 656e 2876 616c 7565 7329 0a20  == len(values). 
+000171c0: 2020 2072 6574 7572 6e20 6469 6374 287a     return dict(z
+000171d0: 6970 286b 6579 732c 2076 616c 7565 7329  ip(keys, values)
+000171e0: 290a 0a0a 6465 6620 7061 7273 655f 6c64  )...def parse_ld
+000171f0: 5f63 6f6e 665f 6669 6c65 2866 6e29 3a0a  _conf_file(fn):.
+00017200: 2020 2020 2222 220a 2020 2020 5669 6120      """.    Via 
+00017210: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+00017220: 6f6d 2f61 6c62 6572 747a 2f73 7973 7465  om/albertz/syste
+00017230: 6d2d 746f 6f6c 732f 626c 6f62 2f6d 6173  m-tools/blob/mas
+00017240: 7465 722f 6269 6e2f 6669 6e64 2d6c 6962  ter/bin/find-lib
+00017250: 2d69 6e2d 7061 7468 2e70 792e 0a0a 2020  -in-path.py...  
+00017260: 2020 3a70 6172 616d 2073 7472 2066 6e3a    :param str fn:
+00017270: 2065 2e67 2e20 222f 6574 632f 6c64 2e73   e.g. "/etc/ld.s
+00017280: 6f2e 636f 6e66 220a 2020 2020 3a72 6574  o.conf".    :ret
+00017290: 7572 6e3a 206c 6973 7420 6f66 2070 6174  urn: list of pat
+000172a0: 6873 2066 6f72 206c 6962 730a 2020 2020  hs for libs.    
+000172b0: 3a72 7479 7065 3a20 6c69 7374 5b73 7472  :rtype: list[str
+000172c0: 5d0a 2020 2020 2222 220a 2020 2020 6672  ].    """.    fr
+000172d0: 6f6d 2067 6c6f 6220 696d 706f 7274 2067  om glob import g
+000172e0: 6c6f 620a 0a20 2020 2070 6174 6873 203d  lob..    paths =
+000172f0: 205b 5d0a 2020 2020 666f 7220 6c69 6e65   [].    for line
+00017300: 2069 6e20 6f70 656e 2866 6e29 2e72 6561   in open(fn).rea
+00017310: 6428 292e 7370 6c69 746c 696e 6573 2829  d().splitlines()
+00017320: 3a0a 2020 2020 2020 2020 6c69 6e65 203d  :.        line =
+00017330: 206c 696e 652e 7374 7269 7028 290a 2020   line.strip().  
+00017340: 2020 2020 2020 6966 206e 6f74 206c 696e        if not lin
+00017350: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00017360: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00017370: 6966 206c 696e 652e 7374 6172 7473 7769  if line.startswi
+00017380: 7468 2822 2322 293a 0a20 2020 2020 2020  th("#"):.       
+00017390: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+000173a0: 2020 2020 2020 6966 206c 696e 652e 7374        if line.st
+000173b0: 6172 7473 7769 7468 2822 696e 636c 7564  artswith("includ
+000173c0: 6520 2229 3a0a 2020 2020 2020 2020 2020  e "):.          
+000173d0: 2020 666f 7220 7375 625f 666e 2069 6e20    for sub_fn in 
+000173e0: 676c 6f62 286c 696e 655b 6c65 6e28 2269  glob(line[len("i
+000173f0: 6e63 6c75 6465 2022 2920 3a5d 293a 0a20  nclude ") :]):. 
+00017400: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017410: 6174 6873 2e65 7874 656e 6428 7061 7273  aths.extend(pars
+00017420: 655f 6c64 5f63 6f6e 665f 6669 6c65 2873  e_ld_conf_file(s
+00017430: 7562 5f66 6e29 290a 2020 2020 2020 2020  ub_fn)).        
+00017440: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00017450: 2020 2020 2070 6174 6873 2e61 7070 656e       paths.appen
+00017460: 6428 6c69 6e65 290a 2020 2020 7265 7475  d(line).    retu
+00017470: 726e 2070 6174 6873 0a0a 0a64 6566 2067  rn paths...def g
+00017480: 6574 5f6c 645f 7061 7468 7328 293a 0a20  et_ld_paths():. 
+00017490: 2020 2022 2222 0a20 2020 2054 6f20 6265     """.    To be
+000174a0: 2076 6572 7920 636f 7272 6563 742c 2073   very correct, s
+000174b0: 6565 206d 616e 2d70 6167 6520 6f66 206c  ee man-page of l
+000174c0: 642e 736f 2e0a 2020 2020 416e 6420 6865  d.so..    And he
+000174d0: 7265 3a20 6874 7470 733a 2f2f 756e 6978  re: https://unix
+000174e0: 2e73 7461 636b 6578 6368 616e 6765 2e63  .stackexchange.c
+000174f0: 6f6d 2f71 7565 7374 696f 6e73 2f33 3534  om/questions/354
+00017500: 3239 352f 7768 6174 2d69 732d 7468 652d  295/what-is-the-
+00017510: 6465 6661 756c 742d 7661 6c75 652d 6f66  default-value-of
+00017520: 2d6c 642d 6c69 6272 6172 792d 7061 7468  -ld-library-path
+00017530: 2f33 3534 3239 360a 2020 2020 5368 6f72  /354296.    Shor
+00017540: 7420 7665 7273 696f 6e2c 206e 6f74 2073  t version, not s
+00017550: 7065 6369 6669 6320 746f 2061 6e20 6578  pecific to an ex
+00017560: 6563 7574 6162 6c65 2c20 696e 2074 6869  ecutable, in thi
+00017570: 7320 6f72 6465 723a 0a20 2020 202d 204c  s order:.    - L
+00017580: 445f 4c49 4252 4152 595f 5041 5448 0a20  D_LIBRARY_PATH. 
+00017590: 2020 202d 202f 6574 632f 6c64 2e73 6f2e     - /etc/ld.so.
+000175a0: 6361 6368 6520 2869 6e73 7465 6164 2077  cache (instead w
+000175b0: 6520 7769 6c6c 2070 6172 7365 202f 6574  e will parse /et
+000175c0: 632f 6c64 2e73 6f2e 636f 6e66 290a 2020  c/ld.so.conf).  
+000175d0: 2020 2d20 2f6c 6962 2c20 2f75 7372 2f6c    - /lib, /usr/l
+000175e0: 6962 2028 6f72 206d 6179 6265 202f 6c69  ib (or maybe /li
+000175f0: 6236 342c 202f 7573 722f 6c69 6236 3429  b64, /usr/lib64)
+00017600: 0a20 2020 2056 6961 2068 7474 7073 3a2f  .    Via https:/
+00017610: 2f67 6974 6875 622e 636f 6d2f 616c 6265  /github.com/albe
+00017620: 7274 7a2f 7379 7374 656d 2d74 6f6f 6c73  rtz/system-tools
+00017630: 2f62 6c6f 622f 6d61 7374 6572 2f62 696e  /blob/master/bin
+00017640: 2f66 696e 642d 6c69 622d 696e 2d70 6174  /find-lib-in-pat
+00017650: 682e 7079 2e0a 0a20 2020 203a 7274 7970  h.py...    :rtyp
+00017660: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
+00017670: 203a 7265 7475 726e 3a20 6c69 7374 206f   :return: list o
+00017680: 6620 7061 7468 7320 746f 2073 6561 7263  f paths to searc
+00017690: 6820 666f 7220 6c69 6273 2028 2a2e 736f  h for libs (*.so
+000176a0: 2066 696c 6573 290a 2020 2020 2222 220a   files).    """.
+000176b0: 2020 2020 7061 7468 7320 3d20 5b5d 0a20      paths = []. 
+000176c0: 2020 2069 6620 224c 445f 4c49 4252 4152     if "LD_LIBRAR
+000176d0: 595f 5041 5448 2220 696e 206f 732e 656e  Y_PATH" in os.en
+000176e0: 7669 726f 6e3a 0a20 2020 2020 2020 2070  viron:.        p
+000176f0: 6174 6873 2e65 7874 656e 6428 6f73 2e65  aths.extend(os.e
+00017700: 6e76 6972 6f6e 5b22 4c44 5f4c 4942 5241  nviron["LD_LIBRA
+00017710: 5259 5f50 4154 4822 5d2e 7370 6c69 7428  RY_PATH"].split(
+00017720: 223a 2229 290a 2020 2020 6966 206f 732e  ":")).    if os.
+00017730: 7061 7468 2e65 7869 7374 7328 222f 6574  path.exists("/et
+00017740: 632f 6c64 2e73 6f2e 636f 6e66 2229 3a0a  c/ld.so.conf"):.
+00017750: 2020 2020 2020 2020 7061 7468 732e 6578          paths.ex
+00017760: 7465 6e64 2870 6172 7365 5f6c 645f 636f  tend(parse_ld_co
+00017770: 6e66 5f66 696c 6528 222f 6574 632f 6c64  nf_file("/etc/ld
+00017780: 2e73 6f2e 636f 6e66 2229 290a 2020 2020  .so.conf")).    
+00017790: 7061 7468 732e 6578 7465 6e64 285b 222f  paths.extend(["/
+000177a0: 6c69 6222 2c20 222f 7573 722f 6c69 6222  lib", "/usr/lib"
+000177b0: 2c20 222f 6c69 6236 3422 2c20 222f 7573  , "/lib64", "/us
+000177c0: 722f 6c69 6236 3422 5d29 0a20 2020 2072  r/lib64"]).    r
+000177d0: 6574 7572 6e20 7061 7468 730a 0a0a 6465  eturn paths...de
+000177e0: 6620 6669 6e64 5f6c 6962 286c 6962 5f6e  f find_lib(lib_n
+000177f0: 616d 6529 3a0a 2020 2020 2222 220a 2020  ame):.    """.  
+00017800: 2020 3a70 6172 616d 2073 7472 206c 6962    :param str lib
+00017810: 5f6e 616d 653a 2077 6974 686f 7574 2070  _name: without p
+00017820: 6f73 7466 6978 2f70 7265 6669 782c 2065  ostfix/prefix, e
+00017830: 2e67 2e20 2263 7564 6172 7422 206f 7220  .g. "cudart" or 
+00017840: 2262 6c61 7322 0a20 2020 203a 7265 7475  "blas".    :retu
+00017850: 726e 3a20 7265 7475 726e 7320 6675 6c6c  rn: returns full
+00017860: 2070 6174 6820 746f 206c 6962 206f 7220   path to lib or 
+00017870: 4e6f 6e65 0a20 2020 203a 7274 7970 653a  None.    :rtype:
+00017880: 2073 7472 7c4e 6f6e 650a 2020 2020 2222   str|None.    ""
+00017890: 220a 2020 2020 6966 2073 7973 2e70 6c61  ".    if sys.pla
+000178a0: 7466 6f72 6d20 3d3d 2022 6461 7277 696e  tform == "darwin
+000178b0: 223a 0a20 2020 2020 2020 2070 7265 6669  ":.        prefi
+000178c0: 7820 3d20 226c 6962 220a 2020 2020 2020  x = "lib".      
+000178d0: 2020 706f 7374 6669 7820 3d20 222e 6479    postfix = ".dy
+000178e0: 6c69 6222 0a20 2020 2065 6c69 6620 7379  lib".    elif sy
+000178f0: 732e 706c 6174 666f 726d 203d 3d20 2277  s.platform == "w
+00017900: 696e 3332 223a 0a20 2020 2020 2020 2070  in32":.        p
+00017910: 7265 6669 7820 3d20 2222 0a20 2020 2020  refix = "".     
+00017920: 2020 2070 6f73 7466 6978 203d 2022 2e64     postfix = ".d
+00017930: 6c6c 220a 2020 2020 656c 7365 3a0a 2020  ll".    else:.  
+00017940: 2020 2020 2020 7072 6566 6978 203d 2022        prefix = "
+00017950: 6c69 6222 0a20 2020 2020 2020 2070 6f73  lib".        pos
+00017960: 7466 6978 203d 2022 2e73 6f22 0a20 2020  tfix = ".so".   
+00017970: 2066 6f72 2070 6174 6820 696e 2067 6574   for path in get
+00017980: 5f6c 645f 7061 7468 7328 293a 0a20 2020  _ld_paths():.   
+00017990: 2020 2020 2066 6e20 3d20 2225 732f 2573       fn = "%s/%s
+000179a0: 2573 2573 2220 2520 2870 6174 682c 2070  %s%s" % (path, p
+000179b0: 7265 6669 782c 206c 6962 5f6e 616d 652c  refix, lib_name,
+000179c0: 2070 6f73 7466 6978 290a 2020 2020 2020   postfix).      
+000179d0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+000179e0: 7374 7328 666e 293a 0a20 2020 2020 2020  sts(fn):.       
+000179f0: 2020 2020 2072 6574 7572 6e20 666e 0a20       return fn. 
+00017a00: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+00017a10: 0a64 6566 2072 6561 645f 7367 655f 6e75  .def read_sge_nu
+00017a20: 6d5f 7072 6f63 7328 6a6f 625f 6964 3d4e  m_procs(job_id=N
+00017a30: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+00017a40: 2020 4672 6f6d 2074 6865 2053 756e 2047    From the Sun G
+00017a50: 7269 6420 456e 6769 6e65 2028 5347 4529  rid Engine (SGE)
+00017a60: 2c20 7265 6164 7320 7468 6520 6e75 6d5f  , reads the num_
+00017a70: 7072 6f63 2073 6574 7469 6e67 2066 6f72  proc setting for
+00017a80: 2061 2070 6172 7469 6375 6c61 7220 6a6f   a particular jo
+00017a90: 622e 0a20 2020 2049 6620 6a6f 625f 6964  b..    If job_id
+00017aa0: 2069 7320 6e6f 7420 7072 6f76 6964 6564   is not provided
+00017ab0: 2061 6e64 2074 6865 204a 4f42 5f49 4420   and the JOB_ID 
+00017ac0: 656e 7620 6973 2073 6574 2c20 6974 2077  env is set, it w
+00017ad0: 696c 6c20 7573 6520 7468 6174 2069 6e73  ill use that ins
+00017ae0: 7465 6164 2028 692e 652e 2069 7420 7573  tead (i.e. it us
+00017af0: 6573 2074 6865 2063 7572 7265 6e74 206a  es the current j
+00017b00: 6f62 292e 0a20 2020 2054 6869 7320 6361  ob)..    This ca
+00017b10: 6c6c 7320 7173 7461 7420 746f 2066 6967  lls qstat to fig
+00017b20: 7572 6520 6f75 7420 7468 6973 2073 6574  ure out this set
+00017b30: 7469 6e67 2e20 5468 6572 6520 6172 6520  ting. There are 
+00017b40: 6d75 6c74 6970 6c65 2077 6179 7320 7468  multiple ways th
+00017b50: 6973 2063 616e 2067 6f20 7772 6f6e 672c  is can go wrong,
+00017b60: 0a20 2020 2073 6f20 6265 7474 6572 2063  .    so better c
+00017b70: 6174 6368 2061 6e79 2065 7863 6570 7469  atch any excepti
+00017b80: 6f6e 2e0a 0a20 2020 203a 7061 7261 6d20  on...    :param 
+00017b90: 696e 747c 4e6f 6e65 206a 6f62 5f69 643a  int|None job_id:
+00017ba0: 0a20 2020 203a 7265 7475 726e 3a20 6e75  .    :return: nu
+00017bb0: 6d5f 7072 6f63 0a20 2020 203a 7274 7970  m_proc.    :rtyp
+00017bc0: 653a 2069 6e74 7c4e 6f6e 650a 2020 2020  e: int|None.    
+00017bd0: 2222 220a 2020 2020 6966 206e 6f74 206a  """.    if not j
+00017be0: 6f62 5f69 643a 0a20 2020 2020 2020 2069  ob_id:.        i
+00017bf0: 6620 6e6f 7420 6f73 2e65 6e76 6972 6f6e  f not os.environ
+00017c00: 2e67 6574 2822 5347 455f 524f 4f54 2229  .get("SGE_ROOT")
+00017c10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00017c20: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+00017c30: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00017c40: 2020 2023 2071 696e 742e 7079 206d 6967     # qint.py mig
+00017c50: 6874 206f 7665 7277 7269 7465 204a 4f42  ht overwrite JOB
+00017c60: 5f49 4420 6275 7420 7365 7473 2053 4745  _ID but sets SGE
+00017c70: 5f4a 4f42 5f49 4420 696e 7374 6561 642e  _JOB_ID instead.
+00017c80: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
+00017c90: 5f69 6420 3d20 696e 7428 6f73 2e65 6e76  _id = int(os.env
+00017ca0: 6972 6f6e 2e67 6574 2822 5347 455f 4a4f  iron.get("SGE_JO
+00017cb0: 425f 4944 2229 206f 7220 6f73 2e65 6e76  B_ID") or os.env
+00017cc0: 6972 6f6e 2e67 6574 2822 4a4f 425f 4944  iron.get("JOB_ID
+00017cd0: 2229 206f 7220 3029 0a20 2020 2020 2020  ") or 0).       
+00017ce0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00017cf0: 6f72 2061 7320 6578 633a 0a20 2020 2020  or as exc:.     
+00017d00: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+00017d10: 6570 7469 6f6e 2822 7265 6164 5f73 6765  eption("read_sge
+00017d20: 5f6e 756d 5f70 726f 6373 3a20 2572 2c20  _num_procs: %r, 
+00017d30: 696e 7661 6c69 6420 4a4f 425f 4944 3a20  invalid JOB_ID: 
+00017d40: 2572 2220 2520 2865 7863 2c20 6f73 2e65  %r" % (exc, os.e
+00017d50: 6e76 6972 6f6e 2e67 6574 2822 4a4f 425f  nviron.get("JOB_
+00017d60: 4944 2229 2929 0a20 2020 2020 2020 2069  ID"))).        i
+00017d70: 6620 6e6f 7420 6a6f 625f 6964 3a0a 2020  f not job_id:.  
+00017d80: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00017d90: 204e 6f6e 650a 2020 2020 6672 6f6d 2073   None.    from s
+00017da0: 7562 7072 6f63 6573 7320 696d 706f 7274  ubprocess import
+00017db0: 2050 6f70 656e 2c20 5049 5045 2c20 4361   Popen, PIPE, Ca
+00017dc0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
+00017dd0: 0a0a 2020 2020 7367 655f 636d 6420 3d20  ..    sge_cmd = 
+00017de0: 5b22 7173 7461 7422 2c20 222d 6a22 2c20  ["qstat", "-j", 
+00017df0: 7374 7228 6a6f 625f 6964 295d 0a20 2020  str(job_id)].   
+00017e00: 2070 726f 6320 3d20 506f 7065 6e28 7367   proc = Popen(sg
+00017e10: 655f 636d 642c 2073 7464 6f75 743d 5049  e_cmd, stdout=PI
+00017e20: 5045 290a 2020 2020 7374 646f 7574 2c20  PE).    stdout, 
+00017e30: 5f20 3d20 7072 6f63 2e63 6f6d 6d75 6e69  _ = proc.communi
+00017e40: 6361 7465 2829 0a20 2020 2069 6620 7072  cate().    if pr
+00017e50: 6f63 2e72 6574 7572 6e63 6f64 653a 0a20  oc.returncode:. 
+00017e60: 2020 2020 2020 2072 6169 7365 2043 616c         raise Cal
+00017e70: 6c65 6450 726f 6365 7373 4572 726f 7228  ledProcessError(
+00017e80: 7072 6f63 2e72 6574 7572 6e63 6f64 652c  proc.returncode,
+00017e90: 2073 6765 5f63 6d64 2c20 7374 646f 7574   sge_cmd, stdout
+00017ea0: 290a 2020 2020 7374 646f 7574 203d 2073  ).    stdout = s
+00017eb0: 7464 6f75 742e 6465 636f 6465 2822 7574  tdout.decode("ut
+00017ec0: 6638 2229 0a20 2020 206c 7320 3d20 5b0a  f8").    ls = [.
+00017ed0: 2020 2020 2020 2020 6c69 6e65 5b6c 656e          line[len
+00017ee0: 2822 6861 7264 2072 6573 6f75 7263 655f  ("hard resource_
+00017ef0: 6c69 7374 3a22 2920 3a5d 2e73 7472 6970  list:") :].strip
+00017f00: 2829 0a20 2020 2020 2020 2066 6f72 206c  ().        for l
+00017f10: 696e 6520 696e 2073 7464 6f75 742e 7370  ine in stdout.sp
+00017f20: 6c69 746c 696e 6573 2829 0a20 2020 2020  litlines().     
+00017f30: 2020 2069 6620 6c69 6e65 2e73 7461 7274     if line.start
+00017f40: 7377 6974 6828 2268 6172 6420 7265 736f  swith("hard reso
+00017f50: 7572 6365 5f6c 6973 743a 2229 0a20 2020  urce_list:").   
+00017f60: 205d 0a20 2020 2061 7373 6572 7420 6c65   ].    assert le
+00017f70: 6e28 6c73 2920 3d3d 2031 0a20 2020 206f  n(ls) == 1.    o
+00017f80: 7074 7320 3d20 6469 6374 285b 6f70 742e  pts = dict([opt.
+00017f90: 7370 6c69 7428 223d 222c 2031 2920 666f  split("=", 1) fo
+00017fa0: 7220 6f70 7420 696e 206c 735b 305d 2e73  r opt in ls[0].s
+00017fb0: 706c 6974 2822 2c22 295d 2920 2023 206e  plit(",")])  # n
+00017fc0: 6f71 610a 2020 2020 7472 793a 0a20 2020  oqa.    try:.   
+00017fd0: 2020 2020 2072 6574 7572 6e20 696e 7428       return int(
+00017fe0: 6f70 7473 5b22 6e75 6d5f 7072 6f63 225d  opts["num_proc"]
+00017ff0: 290a 2020 2020 6578 6365 7074 2056 616c  ).    except Val
+00018000: 7565 4572 726f 7220 6173 2065 7863 3a0a  ueError as exc:.
+00018010: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00018020: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00018030: 2020 2020 2022 7265 6164 5f73 6765 5f6e       "read_sge_n
+00018040: 756d 5f70 726f 6373 3a20 2572 2c20 696e  um_procs: %r, in
+00018050: 7661 6c69 6420 6e75 6d5f 7072 6f63 2025  valid num_proc %
+00018060: 7220 666f 7220 6a6f 6220 6964 2025 692e  r for job id %i.
+00018070: 5c6e 6c69 6e65 3a20 2572 220a 2020 2020  \nline: %r".    
+00018080: 2020 2020 2020 2020 2520 2865 7863 2c20          % (exc, 
+00018090: 6f70 7473 5b22 6e75 6d5f 7072 6f63 225d  opts["num_proc"]
+000180a0: 2c20 6a6f 625f 6964 2c20 6c73 5b30 5d29  , job_id, ls[0])
+000180b0: 0a20 2020 2020 2020 2029 0a0a 0a64 6566  .        )...def
+000180c0: 2067 6574 5f6e 756d 6265 725f 6176 6169   get_number_avai
+000180d0: 6c61 626c 655f 6370 7573 2829 3a0a 2020  lable_cpus():.  
+000180e0: 2020 2222 220a 2020 2020 3a72 6574 7572    """.    :retur
+000180f0: 6e3a 206e 756d 6265 7220 6f66 2061 7661  n: number of ava
+00018100: 696c 6162 6c65 2043 5055 732c 2069 6620  ilable CPUs, if 
+00018110: 7765 2063 616e 2066 6967 7572 6520 6974  we can figure it
+00018120: 206f 7574 0a20 2020 203a 7274 7970 653a   out.    :rtype:
+00018130: 2069 6e74 7c4e 6f6e 650a 2020 2020 2222   int|None.    ""
+00018140: 220a 2020 2020 6966 2068 6173 6174 7472  ".    if hasattr
+00018150: 286f 732c 2022 7363 6865 645f 6765 7461  (os, "sched_geta
+00018160: 6666 696e 6974 7922 293a 2020 2320 5079  ffinity"):  # Py
+00018170: 7468 6f6e 203e 3d33 2e34 0a20 2020 2020  thon >=3.4.     
+00018180: 2020 2072 6574 7572 6e20 6c65 6e28 6f73     return len(os
+00018190: 2e73 6368 6564 5f67 6574 6166 6669 6e69  .sched_getaffini
+000181a0: 7479 2830 2929 0a20 2020 2074 7279 3a0a  ty(0)).    try:.
+000181b0: 2020 2020 2020 2020 2320 6e6f 696e 7370          # noinsp
+000181c0: 6563 7469 6f6e 2050 7950 6163 6b61 6765  ection PyPackage
+000181d0: 5265 7175 6972 656d 656e 7473 2c50 7955  Requirements,PyU
+000181e0: 6e72 6573 6f6c 7665 6452 6566 6572 656e  nresolvedReferen
+000181f0: 6365 730a 2020 2020 2020 2020 696d 706f  ces.        impo
+00018200: 7274 2070 7375 7469 6c0a 0a20 2020 2020  rt psutil..     
+00018210: 2020 2070 726f 6320 3d20 7073 7574 696c     proc = psutil
+00018220: 2e50 726f 6365 7373 2829 0a20 2020 2020  .Process().     
+00018230: 2020 2069 6620 6861 7361 7474 7228 7072     if hasattr(pr
+00018240: 6f63 2c20 2263 7075 5f61 6666 696e 6974  oc, "cpu_affinit
+00018250: 7922 293a 0a20 2020 2020 2020 2020 2020  y"):.           
+00018260: 2072 6574 7572 6e20 6c65 6e28 7072 6f63   return len(proc
+00018270: 2e63 7075 5f61 6666 696e 6974 7928 2929  .cpu_affinity())
+00018280: 0a20 2020 2065 7863 6570 7420 496d 706f  .    except Impo
+00018290: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
+000182a0: 2070 6173 730a 2020 2020 6966 2068 6173   pass.    if has
+000182b0: 6174 7472 286f 732c 2022 7379 7363 6f6e  attr(os, "syscon
+000182c0: 6622 2920 616e 6420 2253 435f 4e50 524f  f") and "SC_NPRO
+000182d0: 4345 5353 4f52 535f 4f4e 4c4e 2220 696e  CESSORS_ONLN" in
+000182e0: 206f 732e 7379 7363 6f6e 665f 6e61 6d65   os.sysconf_name
+000182f0: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
+00018300: 6e20 6f73 2e73 7973 636f 6e66 2822 5343  n os.sysconf("SC
+00018310: 5f4e 5052 4f43 4553 534f 5253 5f4f 4e4c  _NPROCESSORS_ONL
+00018320: 4e22 290a 2020 2020 6966 2068 6173 6174  N").    if hasat
+00018330: 7472 286f 732c 2022 6370 755f 636f 756e  tr(os, "cpu_coun
+00018340: 7422 293a 2020 2320 5079 7468 6f6e 203e  t"):  # Python >
+00018350: 3d33 2e34 0a20 2020 2020 2020 2072 6574  =3.4.        ret
+00018360: 7572 6e20 6f73 2e63 7075 5f63 6f75 6e74  urn os.cpu_count
+00018370: 2829 2020 2320 6e6f 7420 7175 6974 6520  ()  # not quite 
+00018380: 636f 7272 6563 743b 2074 6861 7420 6172  correct; that ar
+00018390: 6520 616c 6c20 696e 2074 6865 2073 7973  e all in the sys
+000183a0: 7465 6d0a 2020 2020 7265 7475 726e 204e  tem.    return N
+000183b0: 6f6e 650a 0a0a 6465 6620 6775 6573 735f  one...def guess_
+000183c0: 7265 7175 6573 7465 645f 6d61 785f 6e75  requested_max_nu
+000183d0: 6d5f 7468 7265 6164 7328 6c6f 675f 6669  m_threads(log_fi
+000183e0: 6c65 3d4e 6f6e 652c 2066 616c 6c62 6163  le=None, fallbac
+000183f0: 6b5f 6e75 6d5f 6370 7573 3d54 7275 6529  k_num_cpus=True)
+00018400: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00018410: 6172 616d 2069 6f2e 4669 6c65 206c 6f67  aram io.File log
+00018420: 5f66 696c 653a 0a20 2020 203a 7061 7261  _file:.    :para
+00018430: 6d20 626f 6f6c 2066 616c 6c62 6163 6b5f  m bool fallback_
+00018440: 6e75 6d5f 6370 7573 3a0a 2020 2020 3a72  num_cpus:.    :r
+00018450: 7479 7065 3a20 696e 747c 4e6f 6e65 0a20  type: int|None. 
+00018460: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
+00018470: 2020 2020 2020 2020 7367 655f 6e75 6d5f          sge_num_
+00018480: 7072 6f63 7320 3d20 7265 6164 5f73 6765  procs = read_sge
+00018490: 5f6e 756d 5f70 726f 6373 2829 0a20 2020  _num_procs().   
+000184a0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+000184b0: 6e20 6173 2065 7863 3a0a 2020 2020 2020  n as exc:.      
+000184c0: 2020 6966 206c 6f67 5f66 696c 653a 0a20    if log_file:. 
+000184d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000184e0: 2822 4572 726f 7220 7768 696c 6520 6765  ("Error while ge
+000184f0: 7474 696e 6720 5347 4520 6e75 6d5f 7072  tting SGE num_pr
+00018500: 6f63 3a20 2572 2220 2520 6578 632c 2066  oc: %r" % exc, f
+00018510: 696c 653d 6c6f 675f 6669 6c65 290a 2020  ile=log_file).  
+00018520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00018530: 6966 2073 6765 5f6e 756d 5f70 726f 6373  if sge_num_procs
+00018540: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00018550: 206c 6f67 5f66 696c 653a 0a20 2020 2020   log_file:.     
+00018560: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00018570: 2822 5573 6520 6e75 6d5f 7468 7265 6164  ("Use num_thread
+00018580: 733d 2569 2028 6275 7420 6d69 6e20 3229  s=%i (but min 2)
+00018590: 2076 6961 2053 4745 206e 756d 5f70 726f   via SGE num_pro
+000185a0: 632e 2220 2520 7367 655f 6e75 6d5f 7072  c." % sge_num_pr
+000185b0: 6f63 732c 2066 696c 653d 6c6f 675f 6669  ocs, file=log_fi
+000185c0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+000185d0: 7265 7475 726e 206d 6178 2873 6765 5f6e  return max(sge_n
+000185e0: 756d 5f70 726f 6373 2c20 3229 0a20 2020  um_procs, 2).   
+000185f0: 206f 6d70 5f6e 756d 5f74 6872 6561 6473   omp_num_threads
+00018600: 203d 2069 6e74 286f 732e 656e 7669 726f   = int(os.enviro
+00018610: 6e2e 6765 7428 224f 4d50 5f4e 554d 5f54  n.get("OMP_NUM_T
+00018620: 4852 4541 4453 2229 206f 7220 3029 0a20  HREADS") or 0). 
+00018630: 2020 2069 6620 6f6d 705f 6e75 6d5f 7468     if omp_num_th
+00018640: 7265 6164 733a 0a20 2020 2020 2020 2023  reads:.        #
+00018650: 204d 696e 696d 756d 206f 6620 3220 7468   Minimum of 2 th
+00018660: 7265 6164 732c 2073 686f 756c 6420 6e6f  reads, should no
+00018670: 7420 6875 7274 2e0a 2020 2020 2020 2020  t hurt..        
+00018680: 6966 206c 6f67 5f66 696c 653a 0a20 2020  if log_file:.   
+00018690: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000186a0: 5573 6520 6e75 6d5f 7468 7265 6164 733d  Use num_threads=
+000186b0: 2569 2028 6275 7420 6d69 6e20 3229 2076  %i (but min 2) v
+000186c0: 6961 204f 4d50 5f4e 554d 5f54 4852 4541  ia OMP_NUM_THREA
+000186d0: 4453 2e22 2025 206f 6d70 5f6e 756d 5f74  DS." % omp_num_t
+000186e0: 6872 6561 6473 2c20 6669 6c65 3d6c 6f67  hreads, file=log
+000186f0: 5f66 696c 6529 0a20 2020 2020 2020 2072  _file).        r
+00018700: 6574 7572 6e20 6d61 7828 6f6d 705f 6e75  eturn max(omp_nu
+00018710: 6d5f 7468 7265 6164 732c 2032 290a 2020  m_threads, 2).  
+00018720: 2020 6966 2066 616c 6c62 6163 6b5f 6e75    if fallback_nu
+00018730: 6d5f 6370 7573 3a0a 2020 2020 2020 2020  m_cpus:.        
+00018740: 7265 7475 726e 2067 6574 5f6e 756d 6265  return get_numbe
+00018750: 725f 6176 6169 6c61 626c 655f 6370 7573  r_available_cpus
+00018760: 2829 0a20 2020 2072 6574 7572 6e20 4e6f  ().    return No
+00018770: 6e65 0a0a 0a54 6865 616e 6f46 6c61 6773  ne...TheanoFlags
+00018780: 203d 207b 0a20 2020 206b 6579 3a20 7661   = {.    key: va
+00018790: 6c75 6520 666f 7220 286b 6579 2c20 7661  lue for (key, va
+000187a0: 6c75 6529 2069 6e20 5b73 2e73 706c 6974  lue) in [s.split
+000187b0: 2822 3d22 2c20 3129 2066 6f72 2073 2069  ("=", 1) for s i
+000187c0: 6e20 6f73 2e65 6e76 6972 6f6e 2e67 6574  n os.environ.get
+000187d0: 2822 5448 4541 4e4f 5f46 4c41 4753 222c  ("THEANO_FLAGS",
+000187e0: 2022 2229 2e73 706c 6974 2822 2c22 2920   "").split(",") 
+000187f0: 6966 2073 5d0a 7d0a 0a0a 6465 6620 5f63  if s].}...def _c
+00018800: 6f6e 7369 6465 725f 6368 6563 6b5f 666f  onsider_check_fo
+00018810: 725f 6770 7528 293a 0a20 2020 2022 2222  r_gpu():.    """
+00018820: 0a20 2020 2054 6865 7265 2061 7265 2063  .    There are c
+00018830: 6173 6573 2077 6865 7265 206e 7669 6469  ases where nvidi
+00018840: 612d 736d 6920 636f 756c 6420 6861 6e67  a-smi could hang
+00018850: 2e0a 2020 2020 2841 6e79 2072 6561 6420  ..    (Any read 
+00018860: 6f66 202f 7072 6f63 2f6d 6f64 756c 6573  of /proc/modules
+00018870: 206d 6967 6874 2068 616e 6720 696e 2074   might hang in t
+00018880: 6861 7420 6361 7365 2c20 6d61 7962 6520  hat case, maybe 
+00018890: 6361 7573 6564 0a20 2020 2020 6279 2074  caused.     by t
+000188a0: 7279 696e 6720 746f 2060 6d6f 6470 726f  rying to `modpro
+000188b0: 6265 206e 7669 6469 6160 2074 6f20 6368  be nvidia` to ch
+000188c0: 6563 6b20 6966 2074 6865 7265 2069 7320  eck if there is 
+000188d0: 6120 4e76 6964 6961 2063 6172 642e 290a  a Nvidia card.).
+000188e0: 2020 2020 5468 6973 2073 6f6d 6574 696d      This sometim
+000188f0: 6573 2068 6170 7065 6e73 2069 6e20 6f75  es happens in ou
+00018900: 7220 5347 4520 636c 7573 7465 7220 6f6e  r SGE cluster on
+00018910: 206e 6f64 6573 2077 6974 686f 7574 204e   nodes without N
+00018920: 7669 6469 6120 6361 7264 732e 0a20 2020  vidia cards..   
+00018930: 204d 6179 6265 2069 7427 7320 616c 736f   Maybe it's also
+00018940: 2061 204c 696e 7578 204b 6572 6e65 6c20   a Linux Kernel 
+00018950: 6275 672e 0a20 2020 2041 6e79 7761 792c  bug..    Anyway,
+00018960: 206a 7573 7420 6176 6f69 6420 616e 7920   just avoid any 
+00018970: 7375 6368 2063 6865 636b 2069 6620 7765  such check if we
+00018980: 2064 6f6e 2774 2061 736b 6564 2066 6f72   don't asked for
+00018990: 2061 2047 5055 2e0a 0a20 2020 203a 7274   a GPU...    :rt
+000189a0: 7970 653a 2062 6f6f 6c0a 2020 2020 2222  ype: bool.    ""
+000189b0: 220a 2020 2020 6966 2022 6465 7669 6365  ".    if "device
+000189c0: 2220 696e 2054 6865 616e 6f46 6c61 6773  " in TheanoFlags
+000189d0: 3a0a 2020 2020 2020 2020 6465 7620 3d20  :.        dev = 
+000189e0: 5468 6561 6e6f 466c 6167 735b 2264 6576  TheanoFlags["dev
+000189f0: 6963 6522 5d0a 2020 2020 2020 2020 6966  ice"].        if
+00018a00: 2064 6576 2e73 7461 7274 7377 6974 6828   dev.startswith(
+00018a10: 2267 7075 2229 206f 7220 6465 762e 7374  "gpu") or dev.st
+00018a20: 6172 7473 7769 7468 2822 6375 6461 2229  artswith("cuda")
+00018a30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00018a40: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+00018a50: 2020 2320 5448 4541 4e4f 5f46 4c41 4753    # THEANO_FLAGS
+00018a60: 2077 696c 6c20 6f76 6572 7772 6974 6520   will overwrite 
+00018a70: 7468 6973 2063 6f6e 6669 6720 6f70 7469  this config opti
+00018a80: 6f6e 2e20 5365 6520 726e 6e2e 696e 6974  on. See rnn.init
+00018a90: 4465 7669 6365 7328 292e 0a20 2020 2020  Devices()..     
+00018aa0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00018ab0: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
+00018ac0: 6f6e 2050 7942 726f 6164 4578 6365 7074  on PyBroadExcept
+00018ad0: 696f 6e0a 2020 2020 7472 793a 0a20 2020  ion.    try:.   
+00018ae0: 2020 2020 2066 726f 6d20 7265 7475 726e       from return
+00018af0: 6e2e 636f 6e66 6967 2069 6d70 6f72 7420  n.config import 
+00018b00: 6765 745f 676c 6f62 616c 5f63 6f6e 6669  get_global_confi
+00018b10: 670a 0a20 2020 2020 2020 2063 6f6e 6669  g..        confi
+00018b20: 6720 3d20 6765 745f 676c 6f62 616c 5f63  g = get_global_c
+00018b30: 6f6e 6669 6728 290a 2020 2020 6578 6365  onfig().    exce
+00018b40: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
+00018b50: 2020 2020 2020 636f 6e66 6967 203d 204e        config = N
+00018b60: 6f6e 650a 2020 2020 6966 2063 6f6e 6669  one.    if confi
+00018b70: 673a 0a20 2020 2020 2020 2066 6f72 2064  g:.        for d
+00018b80: 6576 2069 6e20 636f 6e66 6967 2e6c 6973  ev in config.lis
+00018b90: 7428 2264 6576 6963 6522 2c20 5b5d 293a  t("device", []):
+00018ba0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00018bb0: 6465 762e 7374 6172 7473 7769 7468 2822  dev.startswith("
+00018bc0: 6770 7522 2920 6f72 2064 6576 2e73 7461  gpu") or dev.sta
+00018bd0: 7274 7377 6974 6828 2263 7564 6122 293a  rtswith("cuda"):
+00018be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018bf0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+00018c00: 2020 2020 2020 2020 2069 6620 6465 7620           if dev 
+00018c10: 3d3d 2022 616c 6c22 3a0a 2020 2020 2020  == "all":.      
+00018c20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018c30: 2054 7275 650a 2020 2020 7265 7475 726e   True.    return
+00018c40: 2046 616c 7365 0a0a 0a64 6566 2067 6574   False...def get
+00018c50: 5f67 7075 5f6e 616d 6573 2829 3a0a 2020  _gpu_names():.  
+00018c60: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
+00018c70: 3a20 6c69 7374 5b73 7472 5d0a 2020 2020  : list[str].    
+00018c80: 2222 220a 2020 2020 6966 206e 6f74 205f  """.    if not _
+00018c90: 636f 6e73 6964 6572 5f63 6865 636b 5f66  consider_check_f
+00018ca0: 6f72 5f67 7075 2829 3a0a 2020 2020 2020  or_gpu():.      
+00018cb0: 2020 7265 7475 726e 205b 5d0a 2020 2020    return [].    
+00018cc0: 6966 206f 732e 6e61 6d65 203d 3d20 226e  if os.name == "n
+00018cd0: 7422 3a0a 2020 2020 2020 2020 7265 7475  t":.        retu
+00018ce0: 726e 2022 4765 466f 7263 6520 4754 5820  rn "GeForce GTX 
+00018cf0: 3737 3022 2020 2320 544f 444f 0a20 2020  770"  # TODO.   
+00018d00: 2065 6c69 6620 7379 732e 706c 6174 666f   elif sys.platfo
+00018d10: 726d 203d 3d20 2264 6172 7769 6e22 3a0a  rm == "darwin":.
+00018d20: 2020 2020 2020 2020 2320 544f 444f 2070          # TODO p
+00018d30: 6172 7365 2076 6961 2078 6d6c 206f 7574  arse via xml out
+00018d40: 7075 740a 2020 2020 2020 2020 7265 7475  put.        retu
+00018d50: 726e 2073 7973 5f63 6d64 5f6f 7574 5f6c  rn sys_cmd_out_l
+00018d60: 696e 6573 280a 2020 2020 2020 2020 2020  ines(.          
+00018d70: 2020 2273 7973 7465 6d5f 7072 6f66 696c    "system_profil
+00018d80: 6572 2053 5044 6973 706c 6179 7344 6174  er SPDisplaysDat
+00018d90: 6154 7970 6520 7c20 220a 2020 2020 2020  aType | ".      
+00018da0: 2020 2020 2020 2267 7265 7020 2743 6869        "grep 'Chi
+00018db0: 7073 6574 204d 6f64 656c 3a20 4e56 4944  pset Model: NVID
+00018dc0: 4941 2720 7c20 220a 2020 2020 2020 2020  IA' | ".        
+00018dd0: 2020 2020 2273 6564 2027 732f 2e2a 4368      "sed 's/.*Ch
+00018de0: 6970 7365 7420 4d6f 6465 6c3a 204e 5649  ipset Model: NVI
+00018df0: 4449 4120 2a2f 2f3b 732f 202a 242f 2f27  DIA *//;s/ *$//'
+00018e00: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00018e10: 656c 7365 3a0a 2020 2020 2020 2020 7472  else:.        tr
+00018e20: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00018e30: 6574 7572 6e20 7379 735f 636d 645f 6f75  eturn sys_cmd_ou
+00018e40: 745f 6c69 6e65 7328 226e 7669 6469 612d  t_lines("nvidia-
+00018e50: 736d 6920 2d4c 207c 2063 7574 202d 6420  smi -L | cut -d 
+00018e60: 2728 2720 2d66 2031 207c 2063 7574 202d  '(' -f 1 | cut -
+00018e70: 6420 2720 2720 2d66 2033 2d20 7c20 7365  d ' ' -f 3- | se
+00018e80: 6420 2d65 2027 732f 5c5c 2024 2f2f 2722  d -e 's/\\ $//'"
+00018e90: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00018ea0: 2043 616c 6c65 6450 726f 6365 7373 4572   CalledProcessEr
+00018eb0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00018ec0: 2072 6574 7572 6e20 5b5d 0a0a 0a64 6566   return []...def
+00018ed0: 205f 6765 745f 6e75 6d5f 6770 755f 6465   _get_num_gpu_de
+00018ee0: 7669 6365 7328 293a 0a20 2020 2022 2222  vices():.    """
+00018ef0: 0a20 2020 203a 7265 7475 726e 3a20 6370  .    :return: cp
+00018f00: 752c 6770 750a 2020 2020 3a72 7479 7065  u,gpu.    :rtype
+00018f10: 3a20 2869 6e74 2c69 6e74 290a 2020 2020  : (int,int).    
+00018f20: 2222 220a 2020 2020 6966 206f 732e 6e61  """.    if os.na
+00018f30: 6d65 203d 3d20 226e 7422 3a0a 2020 2020  me == "nt":.    
+00018f40: 2020 2020 7265 7475 726e 2031 2c20 3120      return 1, 1 
+00018f50: 2023 2054 4f44 4f0a 2020 2020 656c 6966   # TODO.    elif
+00018f60: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
+00018f70: 2022 6461 7277 696e 223a 0a20 2020 2020   "darwin":.     
+00018f80: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+00018f90: 2020 2020 2020 2020 696e 7428 7379 735f          int(sys_
+00018fa0: 636d 645f 6f75 745f 6c69 6e65 7328 2273  cmd_out_lines("s
+00018fb0: 7973 6374 6c20 2d61 207c 2067 7265 7020  ysctl -a | grep 
+00018fc0: 6d61 6368 6465 702e 6370 752e 636f 7265  machdep.cpu.core
+00018fd0: 5f63 6f75 6e74 207c 2061 776b 2027 7b70  _count | awk '{p
+00018fe0: 7269 6e74 2024 327d 2722 295b 305d 292c  rint $2}'")[0]),
+00018ff0: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
+00019000: 2873 7973 5f63 6d64 5f6f 7574 5f6c 696e  (sys_cmd_out_lin
+00019010: 6573 2822 7379 7374 656d 5f70 726f 6669  es("system_profi
+00019020: 6c65 7220 5350 4469 7370 6c61 7973 4461  ler SPDisplaysDa
+00019030: 7461 5479 7065 207c 2067 7265 7020 2743  taType | grep 'C
+00019040: 6869 7073 6574 204d 6f64 656c 3a20 4e56  hipset Model: NV
+00019050: 4944 4941 2720 7c20 6361 7422 2929 2c0a  IDIA' | cat")),.
+00019060: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
+00019070: 7365 3a0a 2020 2020 2020 2020 6e75 6d5f  se:.        num_
+00019080: 6370 7573 203d 206c 656e 2873 7973 5f63  cpus = len(sys_c
+00019090: 6d64 5f6f 7574 5f6c 696e 6573 2822 6361  md_out_lines("ca
+000190a0: 7420 2f70 726f 632f 6370 7569 6e66 6f20  t /proc/cpuinfo 
+000190b0: 7c20 6772 6570 2070 726f 6365 7373 6f72  | grep processor
+000190c0: 2229 2920 6f72 2031 0a20 2020 2020 2020  ")) or 1.       
+000190d0: 206e 756d 5f67 7075 7320 3d20 300a 2020   num_gpus = 0.  
+000190e0: 2020 2020 2020 6966 205f 636f 6e73 6964        if _consid
+000190f0: 6572 5f63 6865 636b 5f66 6f72 5f67 7075  er_check_for_gpu
+00019100: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00019110: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00019120: 2020 2020 206e 756d 5f67 7075 7320 3d20       num_gpus = 
+00019130: 6c65 6e28 7379 735f 636d 645f 6f75 745f  len(sys_cmd_out_
+00019140: 6c69 6e65 7328 226e 7669 6469 612d 736d  lines("nvidia-sm
+00019150: 6920 2d4c 2229 290a 2020 2020 2020 2020  i -L")).        
+00019160: 2020 2020 6578 6365 7074 2043 616c 6c65      except Calle
+00019170: 6450 726f 6365 7373 4572 726f 723a 0a20  dProcessError:. 
+00019180: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019190: 6173 730a 2020 2020 2020 2020 7265 7475  ass.        retu
+000191a0: 726e 206e 756d 5f63 7075 732c 206e 756d  rn num_cpus, num
+000191b0: 5f67 7075 730a 0a0a 5f6e 756d 5f64 6576  _gpus..._num_dev
+000191c0: 6963 6573 203d 204e 6f6e 650a 0a0a 6465  ices = None...de
+000191d0: 6620 6765 745f 6e75 6d5f 6770 755f 6465  f get_num_gpu_de
+000191e0: 7669 6365 7328 293a 0a20 2020 2022 2222  vices():.    """
+000191f0: 0a20 2020 203a 7265 7475 726e 3a20 2863  .    :return: (c
+00019200: 7075 2063 6f75 6e74 2c20 6770 7520 636f  pu count, gpu co
+00019210: 756e 7429 0a20 2020 203a 7274 7970 653a  unt).    :rtype:
+00019220: 2028 696e 742c 2069 6e74 290a 2020 2020   (int, int).    
+00019230: 2222 220a 2020 2020 676c 6f62 616c 205f  """.    global _
+00019240: 6e75 6d5f 6465 7669 6365 730a 2020 2020  num_devices.    
+00019250: 6966 205f 6e75 6d5f 6465 7669 6365 7320  if _num_devices 
+00019260: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00019270: 2020 2020 2072 6574 7572 6e20 5f6e 756d       return _num
+00019280: 5f64 6576 6963 6573 0a20 2020 205f 6e75  _devices.    _nu
+00019290: 6d5f 6465 7669 6365 7320 3d20 5f67 6574  m_devices = _get
+000192a0: 5f6e 756d 5f67 7075 5f64 6576 6963 6573  _num_gpu_devices
+000192b0: 2829 0a20 2020 2072 6574 7572 6e20 5f6e  ().    return _n
+000192c0: 756d 5f64 6576 6963 6573 0a0a 0a64 6566  um_devices...def
+000192d0: 2068 6176 655f 6770 7528 293a 0a20 2020   have_gpu():.   
+000192e0: 2022 2222 0a20 2020 203a 7274 7970 653a   """.    :rtype:
+000192f0: 2062 6f6f 6c0a 2020 2020 2222 220a 2020   bool.    """.  
+00019300: 2020 6370 7573 2c20 6770 7573 203d 2067    cpus, gpus = g
+00019310: 6574 5f6e 756d 5f67 7075 5f64 6576 6963  et_num_gpu_devic
+00019320: 6573 2829 0a20 2020 2072 6574 7572 6e20  es().    return 
+00019330: 6770 7573 203e 2030 0a0a 0a64 6566 2074  gpus > 0...def t
+00019340: 7279 5f61 6e64 5f69 676e 6f72 655f 6578  ry_and_ignore_ex
+00019350: 6365 7074 696f 6e28 6629 3a0a 2020 2020  ception(f):.    
+00019360: 2222 220a 2020 2020 4361 6c6c 7320 6060  """.    Calls ``
+00019370: 6660 602c 2061 6e64 2069 676e 6f72 6573  f``, and ignores
+00019380: 2061 6e79 2065 7863 6570 7469 6f6e 2e0a   any exception..
+00019390: 0a20 2020 203a 7061 7261 6d20 2829 2d3e  .    :param ()->
+000193a0: 5420 663a 0a20 2020 203a 7265 7475 726e  T f:.    :return
+000193b0: 3a20 7768 6174 6576 6572 2060 6066 6060  : whatever ``f``
+000193c0: 2072 6574 7572 6e73 2c20 6f72 204e 6f6e   returns, or Non
+000193d0: 650a 2020 2020 3a72 7479 7065 3a20 547c  e.    :rtype: T|
+000193e0: 4e6f 6e65 0a20 2020 2022 2222 0a20 2020  None.    """.   
+000193f0: 2074 7279 3a0a 2020 2020 2020 2020 7265   try:.        re
+00019400: 7475 726e 2066 2829 0a20 2020 2065 7863  turn f().    exc
+00019410: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00019420: 2065 7863 3a0a 2020 2020 2020 2020 7072   exc:.        pr
+00019430: 696e 7428 2274 7279 5f61 6e64 5f69 676e  int("try_and_ign
+00019440: 6f72 655f 6578 6365 7074 696f 6e3a 2025  ore_exception: %
+00019450: 7220 6661 696c 6564 3a20 2573 2220 2520  r failed: %s" % 
+00019460: 2866 2c20 6578 6329 290a 2020 2020 2020  (f, exc)).      
+00019470: 2020 7379 732e 6578 6365 7074 686f 6f6b    sys.excepthook
+00019480: 282a 7379 732e 6578 635f 696e 666f 2829  (*sys.exc_info()
+00019490: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000194a0: 204e 6f6e 650a 0a0a 6465 6620 7472 795f   None...def try_
+000194b0: 6765 745f 7374 6163 6b5f 6672 616d 6528  get_stack_frame(
+000194c0: 6465 7074 683d 3129 3a0a 2020 2020 2222  depth=1):.    ""
+000194d0: 220a 2020 2020 3a70 6172 616d 2069 6e74  ".    :param int
+000194e0: 2064 6570 7468 3a0a 2020 2020 3a72 7479   depth:.    :rty
+000194f0: 7065 3a20 7479 7065 732e 4672 616d 6554  pe: types.FrameT
+00019500: 7970 657c 4e6f 6e65 0a20 2020 203a 7265  ype|None.    :re
+00019510: 7475 726e 3a20 6361 6c6c 6572 2066 756e  turn: caller fun
+00019520: 6374 696f 6e20 6e61 6d65 2e20 7468 6973  ction name. this
+00019530: 2069 7320 6a75 7374 2066 6f72 2064 6562   is just for deb
+00019540: 7567 6769 6e67 0a20 2020 2022 2222 0a20  ugging.    """. 
+00019550: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
+00019560: 6e20 5079 4272 6f61 6445 7863 6570 7469  n PyBroadExcepti
+00019570: 6f6e 0a20 2020 2074 7279 3a0a 2020 2020  on.    try:.    
+00019580: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
+00019590: 6f6e 2050 7950 726f 7465 6374 6564 4d65  on PyProtectedMe
+000195a0: 6d62 6572 2c50 7955 6e72 6573 6f6c 7665  mber,PyUnresolve
+000195b0: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
+000195c0: 2020 2020 6672 616d 6520 3d20 7379 732e      frame = sys.
+000195d0: 5f67 6574 6672 616d 6528 6465 7074 6820  _getframe(depth 
+000195e0: 2b20 3129 2020 2320 6f6e 6520 6d6f 7265  + 1)  # one more
+000195f0: 2074 6f20 636f 756e 7420 6f75 7273 656c   to count oursel
+00019600: 7665 730a 2020 2020 2020 2020 7265 7475  ves.        retu
+00019610: 726e 2066 7261 6d65 0a20 2020 2065 7863  rn frame.    exc
+00019620: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00019630: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00019640: 6e65 0a0a 0a64 6566 2074 7279 5f67 6574  ne...def try_get
+00019650: 5f63 616c 6c65 725f 6e61 6d65 2864 6570  _caller_name(dep
+00019660: 7468 3d31 2c20 6661 6c6c 6261 636b 3d4e  th=1, fallback=N
+00019670: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+00019680: 2020 3a70 6172 616d 2069 6e74 2064 6570    :param int dep
+00019690: 7468 3a0a 2020 2020 3a70 6172 616d 2073  th:.    :param s
+000196a0: 7472 7c4e 6f6e 6520 6661 6c6c 6261 636b  tr|None fallback
+000196b0: 3a20 7468 6973 2069 7320 7265 7475 726e  : this is return
+000196c0: 6564 2069 6620 7765 2066 6169 6c20 666f  ed if we fail fo
+000196d0: 7220 736f 6d65 2072 6561 736f 6e0a 2020  r some reason.  
+000196e0: 2020 3a72 7479 7065 3a20 7374 727c 4e6f    :rtype: str|No
+000196f0: 6e65 0a20 2020 203a 7265 7475 726e 3a20  ne.    :return: 
+00019700: 6361 6c6c 6572 2066 756e 6374 696f 6e20  caller function 
+00019710: 6e61 6d65 2e20 7468 6973 2069 7320 6a75  name. this is ju
+00019720: 7374 2066 6f72 2064 6562 7567 6769 6e67  st for debugging
+00019730: 0a20 2020 2022 2222 0a20 2020 2066 7261  .    """.    fra
+00019740: 6d65 203d 2074 7279 5f67 6574 5f73 7461  me = try_get_sta
+00019750: 636b 5f66 7261 6d65 2864 6570 7468 202b  ck_frame(depth +
+00019760: 2031 2920 2023 206f 6e65 206d 6f72 6520   1)  # one more 
+00019770: 746f 2063 6f75 6e74 206f 7572 7365 6c76  to count ourselv
+00019780: 6573 0a20 2020 2069 6620 6672 616d 653a  es.    if frame:
+00019790: 0a20 2020 2020 2020 2066 726f 6d20 2e62  .        from .b
+000197a0: 6574 7465 725f 6578 6368 6f6f 6b20 696d  etter_exchook im
+000197b0: 706f 7274 2067 6574 5f66 756e 635f 7374  port get_func_st
+000197c0: 725f 6672 6f6d 5f63 6f64 655f 6f62 6a65  r_from_code_obje
+000197d0: 6374 0a0a 2020 2020 2020 2020 7265 7475  ct..        retu
+000197e0: 726e 2067 6574 5f66 756e 635f 7374 725f  rn get_func_str_
+000197f0: 6672 6f6d 5f63 6f64 655f 6f62 6a65 6374  from_code_object
+00019800: 2866 7261 6d65 2e66 5f63 6f64 6529 0a20  (frame.f_code). 
+00019810: 2020 2072 6574 7572 6e20 6661 6c6c 6261     return fallba
+00019820: 636b 0a0a 0a63 6c61 7373 2049 6e66 696e  ck...class Infin
+00019830: 6974 6552 6563 7572 7369 6f6e 4465 7465  iteRecursionDete
+00019840: 6374 6564 2845 7863 6570 7469 6f6e 293a  cted(Exception):
+00019850: 0a20 2020 2022 2222 0a20 2020 2052 6169  .    """.    Rai
+00019860: 7365 6420 7768 656e 2061 6e20 696e 6669  sed when an infi
+00019870: 6e69 7465 2072 6563 7572 7369 6f6e 2069  nite recursion i
+00019880: 7320 6465 7465 6374 6564 2c20 6279 2067  s detected, by g
+00019890: 7561 7264 5f69 6e66 696e 6974 655f 7265  uard_infinite_re
+000198a0: 6375 7273 696f 6e2e 0a20 2020 2022 2222  cursion..    """
+000198b0: 0a0a 0a5f 6775 6172 645f 696e 6669 6e69  ..._guard_infini
+000198c0: 7465 5f72 6563 7572 7369 6f6e 5f63 6163  te_recursion_cac
+000198d0: 6865 203d 2074 6872 6561 6469 6e67 2e6c  he = threading.l
+000198e0: 6f63 616c 2829 0a0a 0a40 636f 6e74 6578  ocal()...@contex
+000198f0: 746c 6962 2e63 6f6e 7465 7874 6d61 6e61  tlib.contextmana
+00019900: 6765 720a 6465 6620 6775 6172 645f 696e  ger.def guard_in
+00019910: 6669 6e69 7465 5f72 6563 7572 7369 6f6e  finite_recursion
+00019920: 282a 6172 6773 293a 0a20 2020 2022 2222  (*args):.    """
+00019930: 0a20 2020 2052 6567 6973 7465 7273 2061  .    Registers a
+00019940: 7267 7320 2863 6f75 6c64 2062 6520 6675  rgs (could be fu
+00019950: 6e63 202b 2061 7267 7329 2069 6e20 736f  nc + args) in so
+00019960: 6d65 2063 6163 6865 2e0a 2020 2020 4966  me cache..    If
+00019970: 2074 686f 7365 2061 7267 7320 6172 6520   those args are 
+00019980: 616c 7265 6164 7920 696e 2074 6865 2063  already in the c
+00019990: 6163 6865 2c20 6974 2077 696c 6c20 7261  ache, it will ra
+000199a0: 6973 6520 616e 2065 7863 6570 7469 6f6e  ise an exception
+000199b0: 2e0a 0a20 2020 2049 7420 7769 6c6c 2075  ...    It will u
+000199c0: 7365 2074 6865 2069 6420 6f66 2074 6865  se the id of the
+000199d0: 2061 7267 7320 6173 206b 6579 2061 6e64   args as key and
+000199e0: 206e 6f74 2075 7365 2061 6e79 2068 6173   not use any has
+000199f0: 6869 6e67 0a20 2020 2074 6f20 616c 6c6f  hing.    to allo
+00019a00: 7720 7468 6174 2067 7561 7264 5f69 6e66  w that guard_inf
+00019a10: 696e 6974 655f 7265 6375 7273 696f 6e20  inite_recursion 
+00019a20: 6361 6e20 6265 2075 7365 640a 2020 2020  can be used.    
+00019a30: 746f 2067 7561 7264 2063 7573 746f 6d20  to guard custom 
+00019a40: 5f5f 6861 7368 5f5f 2069 6d70 6c65 6d65  __hash__ impleme
+00019a50: 6e74 6174 696f 6e73 2061 7320 7765 6c6c  ntations as well
+00019a60: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
+00019a70: 206e 6f74 2061 7267 733a 0a20 2020 2020   not args:.     
+00019a80: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00019a90: 726f 7228 2267 7561 7264 5f69 6e66 696e  ror("guard_infin
+00019aa0: 6974 655f 7265 6375 7273 696f 6e20 6e65  ite_recursion ne
+00019ab0: 6564 7320 6174 206c 6561 7374 206f 6e65  eds at least one
+00019ac0: 2061 7267 2229 0a20 2020 206b 6579 203d   arg").    key =
+00019ad0: 2074 7570 6c65 2869 6428 6172 6729 2066   tuple(id(arg) f
+00019ae0: 6f72 2061 7267 2069 6e20 6172 6773 290a  or arg in args).
+00019af0: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
+00019b00: 7472 285f 6775 6172 645f 696e 6669 6e69  tr(_guard_infini
+00019b10: 7465 5f72 6563 7572 7369 6f6e 5f63 6163  te_recursion_cac
+00019b20: 6865 2c20 2263 6163 6865 2229 3a0a 2020  he, "cache"):.  
+00019b30: 2020 2020 2020 5f67 7561 7264 5f69 6e66        _guard_inf
+00019b40: 696e 6974 655f 7265 6375 7273 696f 6e5f  inite_recursion_
+00019b50: 6361 6368 652e 6361 6368 6520 3d20 7365  cache.cache = se
+00019b60: 7428 290a 2020 2020 6966 206b 6579 2069  t().    if key i
+00019b70: 6e20 5f67 7561 7264 5f69 6e66 696e 6974  n _guard_infinit
+00019b80: 655f 7265 6375 7273 696f 6e5f 6361 6368  e_recursion_cach
+00019b90: 652e 6361 6368 653a 0a20 2020 2020 2020  e.cache:.       
+00019ba0: 2072 6169 7365 2049 6e66 696e 6974 6552   raise InfiniteR
+00019bb0: 6563 7572 7369 6f6e 4465 7465 6374 6564  ecursionDetected
+00019bc0: 2822 696e 6669 6e69 7465 2072 6563 7572  ("infinite recur
+00019bd0: 7369 6f6e 2064 6574 6563 7465 6422 290a  sion detected").
+00019be0: 2020 2020 5f67 7561 7264 5f69 6e66 696e      _guard_infin
+00019bf0: 6974 655f 7265 6375 7273 696f 6e5f 6361  ite_recursion_ca
+00019c00: 6368 652e 6361 6368 652e 6164 6428 6b65  che.cache.add(ke
+00019c10: 7929 0a20 2020 2074 7279 3a0a 2020 2020  y).    try:.    
+00019c20: 2020 2020 7969 656c 640a 2020 2020 6669      yield.    fi
+00019c30: 6e61 6c6c 793a 0a20 2020 2020 2020 205f  nally:.        _
+00019c40: 6775 6172 645f 696e 6669 6e69 7465 5f72  guard_infinite_r
+00019c50: 6563 7572 7369 6f6e 5f63 6163 6865 2e63  ecursion_cache.c
+00019c60: 6163 6865 2e72 656d 6f76 6528 6b65 7929  ache.remove(key)
+00019c70: 0a0a 0a64 6566 2063 616d 656c 5f63 6173  ...def camel_cas
+00019c80: 655f 746f 5f73 6e61 6b65 5f63 6173 6528  e_to_snake_case(
+00019c90: 6e61 6d65 293a 0a20 2020 2022 2222 0a20  name):.    """. 
+00019ca0: 2020 203a 7061 7261 6d20 7374 7220 6e61     :param str na
+00019cb0: 6d65 3a20 652e 672e 2022 4361 6d65 6c43  me: e.g. "CamelC
+00019cc0: 6173 6522 0a20 2020 203a 7265 7475 726e  ase".    :return
+00019cd0: 3a20 652e 672e 2022 6361 6d65 6c5f 6361  : e.g. "camel_ca
+00019ce0: 7365 220a 2020 2020 3a72 7479 7065 3a20  se".    :rtype: 
+00019cf0: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
+00019d00: 7331 203d 2072 652e 7375 6228 2228 2e29  s1 = re.sub("(.)
+00019d10: 285b 412d 5a5d 5b61 2d7a 5d2b 2922 2c20  ([A-Z][a-z]+)", 
+00019d20: 7222 5c31 5f5c 3222 2c20 6e61 6d65 290a  r"\1_\2", name).
+00019d30: 2020 2020 7265 7475 726e 2072 652e 7375      return re.su
+00019d40: 6228 2228 5b61 2d7a 302d 395d 2928 5b41  b("([a-z0-9])([A
+00019d50: 2d5a 5d29 222c 2072 225c 315f 5c32 222c  -Z])", r"\1_\2",
+00019d60: 2073 3129 2e6c 6f77 6572 2829 0a0a 0a64   s1).lower()...d
+00019d70: 6566 2067 6574 5f68 6f73 746e 616d 6528  ef get_hostname(
+00019d80: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00019d90: 7265 7475 726e 3a20 652e 672e 2022 636c  return: e.g. "cl
+00019da0: 7573 7465 722d 636e 2d32 3131 220a 2020  uster-cn-211".  
+00019db0: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+00019dc0: 2020 2222 220a 2020 2020 2320 6368 6563    """.    # chec
+00019dd0: 6b5f 6f75 7470 7574 285b 2268 6f73 746e  k_output(["hostn
+00019de0: 616d 6522 5d29 2e73 7472 6970 2829 2e64  ame"]).strip().d
+00019df0: 6563 6f64 6528 2275 7466 3822 290a 2020  ecode("utf8").  
+00019e00: 2020 696d 706f 7274 2073 6f63 6b65 740a    import socket.
+00019e10: 0a20 2020 2072 6574 7572 6e20 736f 636b  .    return sock
+00019e20: 6574 2e67 6574 686f 7374 6e61 6d65 2829  et.gethostname()
+00019e30: 0a0a 0a64 6566 2069 735f 7275 6e6e 696e  ...def is_runnin
+00019e40: 675f 6f6e 5f63 6c75 7374 6572 2829 3a0a  g_on_cluster():.
+00019e50: 2020 2020 2222 220a 2020 2020 3a72 6574      """.    :ret
+00019e60: 7572 6e3a 2069 3620 7370 6563 6966 6963  urn: i6 specific
+00019e70: 2e20 5768 6574 6865 7220 7765 2072 756e  . Whether we run
+00019e80: 206f 6e20 736f 6d65 206f 6620 7468 6520   on some of the 
+00019e90: 636c 7573 7465 7220 6e6f 6465 732e 0a20  cluster nodes.. 
+00019ea0: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
+00019eb0: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
+00019ec0: 726e 2067 6574 5f68 6f73 746e 616d 6528  rn get_hostname(
+00019ed0: 292e 7374 6172 7473 7769 7468 2822 636c  ).startswith("cl
+00019ee0: 7573 7465 722d 636e 2d22 2920 6f72 2067  uster-cn-") or g
+00019ef0: 6574 5f68 6f73 746e 616d 6528 292e 7374  et_hostname().st
+00019f00: 6172 7473 7769 7468 2822 636e 2d22 290a  artswith("cn-").
+00019f10: 0a0a 7374 6172 745f 7469 6d65 203d 2074  ..start_time = t
+00019f20: 696d 652e 7469 6d65 2829 0a0a 0a64 6566  ime.time()...def
+00019f30: 2067 6574 5f75 7463 5f73 7461 7274 5f74   get_utc_start_t
+00019f40: 696d 655f 6669 6c65 6e61 6d65 5f70 6172  ime_filename_par
+00019f50: 7428 293a 0a20 2020 2022 2222 0a20 2020  t():.    """.   
+00019f60: 203a 7265 7475 726e 3a20 7374 7269 6e67   :return: string
+00019f70: 2077 6869 6368 2063 616e 2062 6520 7573   which can be us
+00019f80: 6564 2061 7320 7061 7274 206f 6620 6120  ed as part of a 
+00019f90: 6669 6c65 6e61 6d65 2c20 7768 6963 6820  filename, which 
+00019fa0: 7265 7072 6573 656e 7473 2074 6865 2073  represents the s
+00019fb0: 7461 7274 2074 696d 6520 6f66 2052 4554  tart time of RET
+00019fc0: 5552 4e4e 2069 6e20 5554 430a 2020 2020  URNN in UTC.    
+00019fd0: 3a72 7479 7065 3a20 7374 720a 2020 2020  :rtype: str.    
+00019fe0: 2222 220a 2020 2020 7265 7475 726e 2074  """.    return t
+00019ff0: 696d 652e 7374 7266 7469 6d65 2822 2559  ime.strftime("%Y
+0001a000: 2d25 6d2d 2564 2d25 482d 254d 2d25 5322  -%m-%d-%H-%M-%S"
+0001a010: 2c20 7469 6d65 2e67 6d74 696d 6528 7374  , time.gmtime(st
+0001a020: 6172 745f 7469 6d65 2929 0a0a 0a64 6566  art_time))...def
+0001a030: 206d 6179 6265 5f6d 616b 655f 6469 7273   maybe_make_dirs
+0001a040: 2864 6972 6e61 6d65 293a 0a20 2020 2022  (dirname):.    "
+0001a050: 2222 0a20 2020 2043 7265 6174 6573 2074  "".    Creates t
+0001a060: 6865 2064 6972 6563 746f 7279 2069 6620  he directory if 
+0001a070: 6974 2064 6f65 7320 6e6f 7420 7965 7420  it does not yet 
+0001a080: 6578 6973 742e 0a0a 2020 2020 3a70 6172  exist...    :par
+0001a090: 616d 2073 7472 2064 6972 6e61 6d65 3a20  am str dirname: 
+0001a0a0: 5468 6520 7061 7468 206f 6620 7468 6520  The path of the 
+0001a0b0: 6469 7265 6374 6f72 790a 2020 2020 2222  directory.    ""
+0001a0c0: 220a 2020 2020 696d 706f 7274 206f 730a  ".    import os.
+0001a0d0: 0a20 2020 2069 6620 6e6f 7420 6f73 2e70  .    if not os.p
+0001a0e0: 6174 682e 6578 6973 7473 2864 6972 6e61  ath.exists(dirna
+0001a0f0: 6d65 293a 0a20 2020 2020 2020 2074 7279  me):.        try
+0001a100: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+0001a110: 2e6d 616b 6564 6972 7328 6469 726e 616d  .makedirs(dirnam
+0001a120: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
+0001a130: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0001a140: 7863 3a0a 2020 2020 2020 2020 2020 2020  xc:.            
+0001a150: 7072 696e 7428 226d 6179 6265 5f63 7265  print("maybe_cre
+0001a160: 6174 655f 666f 6c64 6572 3a20 6578 6365  ate_folder: exce
+0001a170: 7074 696f 6e20 6372 6561 7469 6e67 2064  ption creating d
+0001a180: 6972 3a22 2c20 6578 6329 0a20 2020 2020  ir:", exc).     
+0001a190: 2020 2020 2020 2023 204d 6179 6265 2061         # Maybe a
+0001a1a0: 2063 6f6e 6375 7272 656e 7420 7072 6f63   concurrent proc
+0001a1b0: 6573 732c 2065 2e67 2e20 7466 2e63 6f6d  ess, e.g. tf.com
+0001a1c0: 7061 742e 7631 2e73 756d 6d61 7279 2e46  pat.v1.summary.F
+0001a1d0: 696c 6557 7269 7465 7220 6372 6561 7465  ileWriter create
+0001a1e0: 6420 6974 2069 6e20 7468 6520 6d65 616e  d it in the mean
+0001a1f0: 2d77 6869 6c65 2c0a 2020 2020 2020 2020  -while,.        
+0001a200: 2020 2020 2320 736f 2074 6865 6e20 6974      # so then it
+0001a210: 2077 6f75 6c64 2062 6520 6f6b 206e 6f77   would be ok now
+0001a220: 2069 6620 6974 2065 7869 7374 732c 2062   if it exists, b
+0001a230: 7574 2066 6169 6c20 6966 2069 7420 646f  ut fail if it do
+0001a240: 6573 206e 6f74 2065 7869 7374 2e0a 2020  es not exist..  
+0001a250: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0001a260: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0001a270: 6469 726e 616d 6529 0a0a 0a64 6566 206c  dirname)...def l
+0001a280: 6f67 5f72 756e 7469 6d65 5f69 6e66 6f5f  og_runtime_info_
+0001a290: 746f 5f64 6972 2870 6174 682c 2063 6f6e  to_dir(path, con
+0001a2a0: 6669 6729 3a0a 2020 2020 2222 220a 2020  fig):.    """.  
+0001a2b0: 2020 5468 6973 2077 696c 6c20 7772 6974    This will writ
+0001a2c0: 6520 6d75 6c74 6970 6c65 206c 6f67 6769  e multiple loggi
+0001a2d0: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2069  ng information i
+0001a2e0: 6e74 6f20 7468 6520 7061 7468 2e0a 2020  nto the path..  
+0001a2f0: 2020 4974 2077 696c 6c20 6372 6561 7465    It will create
+0001a300: 2072 6574 7572 6e6e 2e2a 2e6c 6f67 2077   returnn.*.log w
+0001a310: 6974 6820 736f 6d65 206d 6574 6120 696e  ith some meta in
+0001a320: 666f 726d 6174 696f 6e2c 0a20 2020 2061  formation,.    a
+0001a330: 7320 7765 6c6c 2061 7320 636f 7079 2074  s well as copy t
+0001a340: 6865 2075 7365 6420 636f 6e66 6967 2066  he used config f
+0001a350: 696c 652e 0a0a 2020 2020 3a70 6172 616d  ile...    :param
+0001a360: 2073 7472 2070 6174 683a 2064 6972 6563   str path: direc
+0001a370: 746f 7279 2070 6174 680a 2020 2020 3a70  tory path.    :p
+0001a380: 6172 616d 2072 6574 7572 6e6e 2e63 6f6e  aram returnn.con
+0001a390: 6669 672e 436f 6e66 6967 2063 6f6e 6669  fig.Config confi
+0001a3a0: 673a 0a20 2020 2022 2222 0a20 2020 2069  g:.    """.    i
+0001a3b0: 6d70 6f72 7420 6f73 0a20 2020 2069 6d70  mport os.    imp
+0001a3c0: 6f72 7420 7379 730a 2020 2020 696d 706f  ort sys.    impo
+0001a3d0: 7274 2073 6875 7469 6c0a 2020 2020 6672  rt shutil.    fr
+0001a3e0: 6f6d 2072 6574 7572 6e6e 2e63 6f6e 6669  om returnn.confi
+0001a3f0: 6720 696d 706f 7274 2043 6f6e 6669 670a  g import Config.
+0001a400: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0001a410: 2020 686f 7374 6e61 6d65 203d 2067 6574    hostname = get
+0001a420: 5f68 6f73 746e 616d 6528 290a 2020 2020  _hostname().    
+0001a430: 2020 2020 636f 6e74 656e 7420 3d20 5b0a      content = [.
+0001a440: 2020 2020 2020 2020 2020 2020 2254 696d              "Tim
+0001a450: 653a 2025 7322 2025 2074 696d 652e 7374  e: %s" % time.st
+0001a460: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
+0001a470: 2025 483a 254d 3a25 5322 2c20 7469 6d65   %H:%M:%S", time
+0001a480: 2e67 6d74 696d 6528 7374 6172 745f 7469  .gmtime(start_ti
+0001a490: 6d65 2929 2c0a 2020 2020 2020 2020 2020  me)),.          
+0001a4a0: 2020 2243 616c 6c3a 2025 7322 2025 2028    "Call: %s" % (
+0001a4b0: 7379 732e 6172 6776 2c29 2c0a 2020 2020  sys.argv,),.    
+0001a4c0: 2020 2020 2020 2020 2250 6174 683a 2025          "Path: %
+0001a4d0: 7322 2025 2028 6f73 2e67 6574 6377 6428  s" % (os.getcwd(
+0001a4e0: 292c 292c 0a20 2020 2020 2020 2020 2020  ),),.           
+0001a4f0: 2022 486f 7374 6e61 6d65 3a20 2573 2220   "Hostname: %s" 
+0001a500: 2520 6765 745f 686f 7374 6e61 6d65 2829  % get_hostname()
+0001a510: 2c0a 2020 2020 2020 2020 2020 2020 2250  ,.            "P
+0001a520: 4944 3a20 2569 2220 2520 6f73 2e67 6574  ID: %i" % os.get
+0001a530: 7069 6428 292c 0a20 2020 2020 2020 2020  pid(),.         
+0001a540: 2020 2022 5265 7475 726e 6e3a 2025 7322     "Returnn: %s"
+0001a550: 2025 2028 6465 7363 7269 6265 5f72 6574   % (describe_ret
+0001a560: 7572 6e6e 5f76 6572 7369 6f6e 2829 2c29  urnn_version(),)
+0001a570: 2c0a 2020 2020 2020 2020 2020 2020 2254  ,.            "T
+0001a580: 656e 736f 7246 6c6f 773a 2025 7322 2025  ensorFlow: %s" %
+0001a590: 2028 6465 7363 7269 6265 5f74 656e 736f   (describe_tenso
+0001a5a0: 7266 6c6f 775f 7665 7273 696f 6e28 292c  rflow_version(),
+0001a5b0: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
+0001a5c0: 436f 6e66 6967 2066 696c 6573 3a20 2573  Config files: %s
+0001a5d0: 2220 2520 2863 6f6e 6669 672e 6669 6c65  " % (config.file
+0001a5e0: 732c 292c 0a20 2020 2020 2020 205d 0a20  s,),.        ]. 
+0001a5f0: 2020 2020 2020 206d 6179 6265 5f6d 616b         maybe_mak
+0001a600: 655f 6469 7273 2870 6174 6829 0a20 2020  e_dirs(path).   
+0001a610: 2020 2020 206c 6f67 5f66 6e20 3d20 2225       log_fn = "%
+0001a620: 732f 7265 7475 726e 6e2e 2573 2e25 732e  s/returnn.%s.%s.
+0001a630: 2569 2e6c 6f67 2220 2520 2870 6174 682c  %i.log" % (path,
+0001a640: 2067 6574 5f75 7463 5f73 7461 7274 5f74   get_utc_start_t
+0001a650: 696d 655f 6669 6c65 6e61 6d65 5f70 6172  ime_filename_par
+0001a660: 7428 292c 2068 6f73 746e 616d 652c 206f  t(), hostname, o
+0001a670: 732e 6765 7470 6964 2829 290a 2020 2020  s.getpid()).    
+0001a680: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+0001a690: 7468 2e65 7869 7374 7328 6c6f 675f 666e  th.exists(log_fn
+0001a6a0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+0001a6b0: 6974 6820 6f70 656e 286c 6f67 5f66 6e2c  ith open(log_fn,
+0001a6c0: 2022 7722 2920 6173 2066 3a0a 2020 2020   "w") as f:.    
+0001a6d0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0001a6e0: 6974 6528 2252 6574 7572 6e6e 206c 6f67  ite("Returnn log
+0001a6f0: 2066 696c 653a 5c6e 2220 2b20 2222 2e6a   file:\n" + "".j
+0001a700: 6f69 6e28 5b22 2573 5c6e 2220 2520 7320  oin(["%s\n" % s 
+0001a710: 666f 7220 7320 696e 2063 6f6e 7465 6e74  for s in content
+0001a720: 5d29 202b 2022 5c6e 2229 0a20 2020 2020  ]) + "\n").     
+0001a730: 2020 2066 6f72 2066 6e20 696e 2063 6f6e     for fn in con
+0001a740: 6669 672e 6669 6c65 733a 0a20 2020 2020  fig.files:.     
+0001a750: 2020 2020 2020 2062 6173 655f 666e 203d         base_fn =
+0001a760: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+0001a770: 6528 666e 290a 2020 2020 2020 2020 2020  e(fn).          
+0001a780: 2020 7461 7267 6574 5f66 6e20 3d20 2225    target_fn = "%
+0001a790: 732f 2573 2220 2520 2870 6174 682c 2062  s/%s" % (path, b
+0001a7a0: 6173 655f 666e 290a 2020 2020 2020 2020  ase_fn).        
+0001a7b0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+0001a7c0: 7869 7374 7328 7461 7267 6574 5f66 6e29  xists(target_fn)
+0001a7d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a7e0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001a7f0: 2020 2020 2020 2073 6875 7469 6c2e 636f         shutil.co
+0001a800: 7079 2866 6e2c 2074 6172 6765 745f 666e  py(fn, target_fn
+0001a810: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+0001a820: 6e66 6967 5f74 7970 6520 3d20 436f 6e66  nfig_type = Conf
+0001a830: 6967 2e67 6574 5f63 6f6e 6669 675f 6669  ig.get_config_fi
+0001a840: 6c65 5f74 7970 6528 666e 290a 2020 2020  le_type(fn).    
+0001a850: 2020 2020 2020 2020 636f 6d6d 656e 745f          comment_
+0001a860: 7072 6566 6978 203d 2022 2322 0a20 2020  prefix = "#".   
+0001a870: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+0001a880: 6967 5f74 7970 6520 3d3d 2022 6a73 223a  ig_type == "js":
+0001a890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a8a0: 2063 6f6d 6d65 6e74 5f70 7265 6669 7820   comment_prefix 
+0001a8b0: 3d20 222f 2f22 0a20 2020 2020 2020 2020  = "//".         
+0001a8c0: 2020 2077 6974 6820 6f70 656e 2874 6172     with open(tar
+0001a8d0: 6765 745f 666e 2c20 2261 2229 2061 7320  get_fn, "a") as 
+0001a8e0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0001a8f0: 2020 2066 2e77 7269 7465 280a 2020 2020     f.write(.    
+0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a910: 225c 6e5c 6e5c 6e22 0a20 2020 2020 2020  "\n\n\n".       
+0001a920: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0001a930: 222e 6a6f 696e 280a 2020 2020 2020 2020  ".join(.        
+0001a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a950: 5b22 2573 2043 6f6e 6669 672d 6669 6c65  ["%s Config-file
+0001a960: 2063 6f70 6965 6420 666f 7220 6c6f 6767   copied for logg
+0001a970: 696e 6720 7075 7270 6f73 6520 6279 2052  ing purpose by R
+0001a980: 6574 7572 6e6e 2e5c 6e22 2025 2063 6f6d  eturnn.\n" % com
+0001a990: 6d65 6e74 5f70 7265 6669 785d 0a20 2020  ment_prefix].   
 0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9b0: 2020 2b20 5b22 2573 2025 735c 6e22 2025    + ["%s %s\n" %
-0001a9c0: 2028 636f 6d6d 656e 745f 7072 6566 6978   (comment_prefix
-0001a9d0: 2c20 7329 2066 6f72 2073 2069 6e20 636f  , s) for s in co
-0001a9e0: 6e74 656e 745d 0a20 2020 2020 2020 2020  ntent].         
-0001a9f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001a9b0: 2020 2020 202b 205b 2225 7320 2573 5c6e       + ["%s %s\n
+0001a9c0: 2220 2520 2863 6f6d 6d65 6e74 5f70 7265  " % (comment_pre
+0001a9d0: 6669 782c 2073 2920 666f 7220 7320 696e  fix, s) for s in
+0001a9e0: 2063 6f6e 7465 6e74 5d0a 2020 2020 2020   content].      
+0001a9f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
 0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa10: 202b 2022 5c6e 220a 2020 2020 2020 2020   + "\n".        
-0001aa20: 2020 2020 2020 2020 290a 2020 2020 6578          ).    ex
-0001aa30: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
-0001aa40: 6578 633a 0a20 2020 2020 2020 2069 6620  exc:.        if 
-0001aa50: 2244 6973 6b20 7175 6f74 6122 2069 6e20  "Disk quota" in 
-0001aa60: 7374 7228 6578 6329 3a0a 2020 2020 2020  str(exc):.      
-0001aa70: 2020 2020 2020 7072 696e 7428 226c 6f67        print("log
-0001aa80: 5f72 756e 7469 6d65 5f69 6e66 6f5f 746f  _runtime_info_to
-0001aa90: 5f64 6972 3a20 4572 726f 722c 2063 616e  _dir: Error, can
-0001aaa0: 6e6f 7420 7772 6974 653a 2025 7322 2025  not write: %s" %
-0001aab0: 2065 7863 290a 2020 2020 2020 2020 656c   exc).        el
-0001aac0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001aad0: 7261 6973 650a 0a0a 6465 6620 7368 6f75  raise...def shou
-0001aae0: 6c64 5f77 7269 7465 5f74 6f5f 6469 736b  ld_write_to_disk
-0001aaf0: 2863 6f6e 6669 6729 3a0a 2020 2020 2222  (config):.    ""
-0001ab00: 220a 2020 2020 3a70 6172 616d 2072 6574  ".    :param ret
-0001ab10: 7572 6e6e 2e63 6f6e 6669 672e 436f 6e66  urnn.config.Conf
-0001ab20: 6967 2063 6f6e 6669 673a 0a20 2020 203a  ig config:.    :
-0001ab30: 7274 7970 653a 2062 6f6f 6c0a 2020 2020  rtype: bool.    
-0001ab40: 2222 220a 2020 2020 6966 2063 6f6e 6669  """.    if confi
-0001ab50: 672e 6973 5f74 7275 6528 2275 7365 5f68  g.is_true("use_h
-0001ab60: 6f72 6f76 6f64 2229 3a0a 2020 2020 2020  orovod"):.      
-0001ab70: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
-0001ab80: 2050 7950 6163 6b61 6765 5265 7175 6972   PyPackageRequir
-0001ab90: 656d 656e 7473 2c50 7955 6e72 6573 6f6c  ements,PyUnresol
-0001aba0: 7665 6452 6566 6572 656e 6365 730a 2020  vedReferences.  
-0001abb0: 2020 2020 2020 696d 706f 7274 2068 6f72        import hor
-0001abc0: 6f76 6f64 2e74 656e 736f 7266 6c6f 7720  ovod.tensorflow 
-0001abd0: 6173 2068 7664 0a0a 2020 2020 2020 2020  as hvd..        
-0001abe0: 6966 2068 7664 2e72 616e 6b28 2920 213d  if hvd.rank() !=
-0001abf0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0001ac00: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-0001ac10: 2069 6620 636f 6e66 6967 2e69 735f 7472   if config.is_tr
-0001ac20: 7565 2822 6472 795f 7275 6e22 293a 0a20  ue("dry_run"):. 
-0001ac30: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0001ac40: 6c73 650a 2020 2020 7265 7475 726e 2054  lse.    return T
-0001ac50: 7275 650a 0a0a 5f64 6566 6175 6c74 5f67  rue..._default_g
-0001ac60: 6c6f 6261 6c5f 696e 665f 7661 6c75 6520  lobal_inf_value 
-0001ac70: 3d20 666c 6f61 7428 2269 6e66 2229 0a0a  = float("inf")..
-0001ac80: 0a64 6566 2067 6574 5f67 6c6f 6261 6c5f  .def get_global_
-0001ac90: 696e 665f 7661 6c75 6528 2920 2d3e 2066  inf_value() -> f
-0001aca0: 6c6f 6174 3a0a 2020 2020 2222 220a 2020  loat:.    """.  
-0001acb0: 2020 3a72 6574 7572 6e3a 2066 6c6f 6174    :return: float
-0001acc0: 2822 696e 6622 2920 6279 2064 6566 6175  ("inf") by defau
-0001acd0: 6c74 2c20 6275 7420 7472 6965 7320 746f  lt, but tries to
-0001ace0: 2072 6561 6420 6069 6e66 5f76 616c 7565   read `inf_value
-0001acf0: 6020 6672 6f6d 2074 6865 2067 6c6f 6261  ` from the globa
-0001ad00: 6c20 636f 6e66 6967 0a20 2020 2022 2222  l config.    """
-0001ad10: 0a20 2020 2066 726f 6d20 7265 7475 726e  .    from return
-0001ad20: 6e2e 636f 6e66 6967 2069 6d70 6f72 7420  n.config import 
-0001ad30: 6765 745f 676c 6f62 616c 5f63 6f6e 6669  get_global_confi
-0001ad40: 670a 0a20 2020 2063 6f6e 6669 6720 3d20  g..    config = 
-0001ad50: 6765 745f 676c 6f62 616c 5f63 6f6e 6669  get_global_confi
-0001ad60: 6728 7261 6973 655f 6578 6365 7074 696f  g(raise_exceptio
-0001ad70: 6e3d 4661 6c73 6529 0a20 2020 2069 6620  n=False).    if 
-0001ad80: 6e6f 7420 636f 6e66 6967 3a0a 2020 2020  not config:.    
-0001ad90: 2020 2020 7265 7475 726e 205f 6465 6661      return _defa
-0001ada0: 756c 745f 676c 6f62 616c 5f69 6e66 5f76  ult_global_inf_v
-0001adb0: 616c 7565 0a20 2020 2072 6574 7572 6e20  alue.    return 
-0001adc0: 636f 6e66 6967 2e66 6c6f 6174 2822 696e  config.float("in
-0001add0: 665f 7661 6c75 6522 2c20 5f64 6566 6175  f_value", _defau
-0001ade0: 6c74 5f67 6c6f 6261 6c5f 696e 665f 7661  lt_global_inf_va
-0001adf0: 6c75 6529 0a0a 0a63 6c61 7373 204e 6174  lue)...class Nat
-0001ae00: 6976 6543 6f64 6543 6f6d 7069 6c65 7228  iveCodeCompiler(
-0001ae10: 6f62 6a65 6374 293a 0a20 2020 2022 2222  object):.    """
-0001ae20: 0a20 2020 2048 656c 7065 7220 636c 6173  .    Helper clas
-0001ae30: 7320 746f 2063 6f6d 7069 6c65 206e 6174  s to compile nat
-0001ae40: 6976 6520 432f 432b 2b20 636f 6465 206f  ive C/C++ code o
-0001ae50: 6e2d 7468 652d 666c 792e 0a20 2020 2022  n-the-fly..    "
-0001ae60: 2222 0a0a 2020 2020 4361 6368 6544 6972  ""..    CacheDir
-0001ae70: 4e61 6d65 203d 2022 7265 7475 726e 6e5f  Name = "returnn_
-0001ae80: 6e61 7469 7665 220a 2020 2020 436f 6c6c  native".    Coll
-0001ae90: 6563 7465 6443 6f6d 7069 6c65 7273 203d  ectedCompilers =
-0001aea0: 204e 6f6e 6520 2023 2074 7970 653a 2074   None  # type: t
-0001aeb0: 7970 696e 672e 4f70 7469 6f6e 616c 5b74  yping.Optional[t
-0001aec0: 7970 696e 672e 4c69 7374 5b4e 6174 6976  yping.List[Nativ
-0001aed0: 6543 6f64 6543 6f6d 7069 6c65 725d 5d0a  eCodeCompiler]].
-0001aee0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0001aef0: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
-0001af00: 0a20 2020 2020 2020 2062 6173 655f 6e61  .        base_na
-0001af10: 6d65 2c0a 2020 2020 2020 2020 636f 6465  me,.        code
-0001af20: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
-0001af30: 2020 636f 6465 2c0a 2020 2020 2020 2020    code,.        
-0001af40: 6973 5f63 7070 3d54 7275 652c 0a20 2020  is_cpp=True,.   
-0001af50: 2020 2020 2063 5f6d 6163 726f 5f64 6566       c_macro_def
-0001af60: 696e 6573 3d4e 6f6e 652c 0a20 2020 2020  ines=None,.     
-0001af70: 2020 206c 645f 666c 6167 733d 4e6f 6e65     ld_flags=None
-0001af80: 2c0a 2020 2020 2020 2020 696e 636c 7564  ,.        includ
-0001af90: 655f 7061 7468 733d 2829 2c0a 2020 2020  e_paths=(),.    
-0001afa0: 2020 2020 696e 636c 7564 655f 6465 7073      include_deps
-0001afb0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2073  =None,.        s
-0001afc0: 7461 7469 635f 7665 7273 696f 6e5f 6e61  tatic_version_na
-0001afd0: 6d65 3d4e 6f6e 652c 0a20 2020 2020 2020  me=None,.       
-0001afe0: 2073 686f 756c 645f 636c 6561 6e75 705f   should_cleanup_
-0001aff0: 6f6c 645f 616c 6c3d 5472 7565 2c0a 2020  old_all=True,.  
-0001b000: 2020 2020 2020 7368 6f75 6c64 5f63 6c65        should_cle
-0001b010: 616e 7570 5f6f 6c64 5f6d 7964 6972 3d46  anup_old_mydir=F
-0001b020: 616c 7365 2c0a 2020 2020 2020 2020 7573  alse,.        us
-0001b030: 655f 6378 7831 315f 6162 693d 4661 6c73  e_cxx11_abi=Fals
-0001b040: 652c 0a20 2020 2020 2020 206c 6f67 5f73  e,.        log_s
-0001b050: 7472 6561 6d3d 4e6f 6e65 2c0a 2020 2020  tream=None,.    
-0001b060: 2020 2020 7665 7262 6f73 653d 4661 6c73      verbose=Fals
-0001b070: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-0001b080: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-0001b090: 6172 616d 2073 7472 2062 6173 655f 6e61  aram str base_na
-0001b0a0: 6d65 3a20 6261 7365 206e 616d 6520 666f  me: base name fo
-0001b0b0: 7220 7468 6520 6d6f 6475 6c65 2c20 652e  r the module, e.
-0001b0c0: 672e 2022 7a65 726f 5f6f 7574 220a 2020  g. "zero_out".  
-0001b0d0: 2020 2020 2020 3a70 6172 616d 2069 6e74        :param int
-0001b0e0: 7c74 7570 6c65 5b69 6e74 5d20 636f 6465  |tuple[int] code
-0001b0f0: 5f76 6572 7369 6f6e 3a20 6368 6563 6b20  _version: check 
-0001b100: 666f 7220 7468 6520 6361 6368 6520 7768  for the cache wh
-0001b110: 6574 6865 7220 746f 2072 6575 7365 0a20  ether to reuse. 
-0001b120: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-0001b130: 7220 636f 6465 3a20 7468 6520 736f 7572  r code: the sour
-0001b140: 6365 2063 6f64 6520 6974 7365 6c66 0a20  ce code itself. 
-0001b150: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
-0001b160: 6f6c 2069 735f 6370 703a 2069 6620 4661  ol is_cpp: if Fa
-0001b170: 6c73 652c 2043 2069 7320 6173 7375 6d65  lse, C is assume
-0001b180: 640a 2020 2020 2020 2020 3a70 6172 616d  d.        :param
-0001b190: 2064 6963 745b 7374 722c 7374 727c 696e   dict[str,str|in
-0001b1a0: 747c 4e6f 6e65 5d7c 4e6f 6e65 2063 5f6d  t|None]|None c_m
-0001b1b0: 6163 726f 5f64 6566 696e 6573 3a20 652e  acro_defines: e.
-0001b1c0: 672e 207b 2254 454e 534f 5246 4c4f 5722  g. {"TENSORFLOW"
-0001b1d0: 3a20 317d 0a20 2020 2020 2020 203a 7061  : 1}.        :pa
-0001b1e0: 7261 6d20 6c69 7374 5b73 7472 5d7c 4e6f  ram list[str]|No
-0001b1f0: 6e65 206c 645f 666c 6167 733a 2065 2e67  ne ld_flags: e.g
-0001b200: 2e20 5b22 2d6c 626c 6173 225d 0a20 2020  . ["-lblas"].   
-0001b210: 2020 2020 203a 7061 7261 6d20 6c69 7374       :param list
-0001b220: 5b73 7472 5d7c 7475 706c 655b 7374 725d  [str]|tuple[str]
-0001b230: 2069 6e63 6c75 6465 5f70 6174 6873 3a0a   include_paths:.
-0001b240: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-0001b250: 6973 745b 7374 725d 7c4e 6f6e 6520 696e  ist[str]|None in
-0001b260: 636c 7564 655f 6465 7073 3a20 6966 2070  clude_deps: if p
-0001b270: 726f 7669 6465 6420 616e 6420 616e 2065  rovided and an e
-0001b280: 7869 7374 696e 6720 6c69 6220 6669 6c65  xisting lib file
-0001b290: 2c0a 2020 2020 2020 2020 2020 2020 7765  ,.            we
-0001b2a0: 2077 696c 6c20 6368 6563 6b20 6966 2061   will check if a
-0001b2b0: 6e79 2064 6570 656e 6465 6e63 7920 6973  ny dependency is
-0001b2c0: 206e 6577 6572 0a20 2020 2020 2020 2020   newer.         
-0001b2d0: 2020 2061 6e64 2077 6520 6e65 6564 2074     and we need t
-0001b2e0: 6f20 7265 636f 6d70 696c 652e 2077 6520  o recompile. we 
-0001b2f0: 636f 756c 6420 616c 736f 2064 6f20 6974  could also do it
-0001b300: 2061 7574 6f6d 6174 6963 616c 6c79 2076   automatically v
-0001b310: 6961 202d 4d44 2062 7574 2074 6861 7420  ia -MD but that 
-0001b320: 7365 656d 7320 6f76 6572 6b69 6c6c 2061  seems overkill a
-0001b330: 6e64 2074 6f6f 2073 6c6f 772e 0a20 2020  nd too slow..   
-0001b340: 2020 2020 203a 7061 7261 6d20 7374 727c       :param str|
-0001b350: 4e6f 6e65 2073 7461 7469 635f 7665 7273  None static_vers
-0001b360: 696f 6e5f 6e61 6d65 3a20 6e6f 726d 616c  ion_name: normal
-0001b370: 6c79 2c20 7765 2075 7365 202e 2e2e 2f62  ly, we use .../b
-0001b380: 6173 655f 6e61 6d65 2f68 6173 6820 6173  ase_name/hash as
-0001b390: 2074 6865 2064 6972 0a20 2020 2020 2020   the dir.       
-0001b3a0: 2020 2020 2062 7574 2074 6869 7320 776f       but this wo
-0001b3b0: 756c 6420 7573 6520 2e2e 2e2f 6261 7365  uld use .../base
-0001b3c0: 5f6e 616d 652f 7374 6174 6963 5f76 6572  _name/static_ver
-0001b3d0: 7369 6f6e 5f6e 616d 652e 0a20 2020 2020  sion_name..     
-0001b3e0: 2020 203a 7061 7261 6d20 626f 6f6c 2073     :param bool s
-0001b3f0: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
-0001b400: 645f 616c 6c3a 2077 6865 7468 6572 2077  d_all: whether w
-0001b410: 6520 7368 6f75 6c64 206c 6f6f 6b20 696e  e should look in
-0001b420: 2074 6865 2063 6163 6865 2064 6972 0a20   the cache dir. 
-0001b430: 2020 2020 2020 2020 2020 2061 6e64 2063             and c
-0001b440: 6865 636b 2061 6c6c 206f 7073 2069 6620  heck all ops if 
-0001b450: 7765 2063 616e 2064 656c 6574 6520 736f  we can delete so
-0001b460: 6d65 206f 6c64 206f 6e65 7320 7768 6963  me old ones whic
-0001b470: 6820 6172 6520 6f6c 6465 7220 7468 616e  h are older than
-0001b480: 2073 6f6d 6520 6c69 6d69 740a 2020 2020   some limit.    
-0001b490: 2020 2020 2020 2020 2873 656c 662e 5f63          (self._c
-0001b4a0: 6c65 616e 7570 5f74 696d 655f 6c69 6d69  leanup_time_limi
-0001b4b0: 745f 6461 7973 290a 2020 2020 2020 2020  t_days).        
-0001b4c0: 3a70 6172 616d 2062 6f6f 6c20 7368 6f75  :param bool shou
-0001b4d0: 6c64 5f63 6c65 616e 7570 5f6f 6c64 5f6d  ld_cleanup_old_m
-0001b4e0: 7964 6972 3a20 7768 6574 6865 7220 7765  ydir: whether we
-0001b4f0: 2073 686f 756c 6420 6465 6c65 7465 206f   should delete o
-0001b500: 7572 206f 7020 6469 7220 6265 666f 7265  ur op dir before
-0001b510: 2077 6520 636f 6d70 696c 6520 7468 6572   we compile ther
-0001b520: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0001b530: 6d20 7479 7069 6e67 2e54 6578 7449 4f7c  m typing.TextIO|
-0001b540: 4e6f 6e65 206c 6f67 5f73 7472 6561 6d3a  None log_stream:
-0001b550: 2066 696c 6520 7374 7265 616d 2066 6f72   file stream for
-0001b560: 2070 7269 6e74 2073 7461 7465 6d65 6e74   print statement
-0001b570: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
-0001b580: 2062 6f6f 6c20 7665 7262 6f73 653a 2062   bool verbose: b
-0001b590: 6520 736c 6967 6874 6c79 206d 6f72 6520  e slightly more 
-0001b5a0: 7665 7262 6f73 650a 2020 2020 2020 2020  verbose.        
-0001b5b0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0001b5c0: 656c 662e 436f 6c6c 6563 7465 6443 6f6d  elf.CollectedCom
-0001b5d0: 7069 6c65 7273 2069 7320 6e6f 7420 4e6f  pilers is not No
-0001b5e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001b5f0: 7365 6c66 2e43 6f6c 6c65 6374 6564 436f  self.CollectedCo
-0001b600: 6d70 696c 6572 732e 6170 7065 6e64 2873  mpilers.append(s
-0001b610: 656c 6629 0a20 2020 2020 2020 2073 656c  elf).        sel
-0001b620: 662e 7665 7262 6f73 6520 3d20 7665 7262  f.verbose = verb
-0001b630: 6f73 650a 2020 2020 2020 2020 7365 6c66  ose.        self
-0001b640: 2e63 6163 6865 5f64 6972 203d 2022 2573  .cache_dir = "%s
-0001b650: 2f25 7322 2025 2028 6765 745f 6361 6368  /%s" % (get_cach
-0001b660: 655f 6469 7228 292c 2073 656c 662e 4361  e_dir(), self.Ca
-0001b670: 6368 6544 6972 4e61 6d65 290a 2020 2020  cheDirName).    
-0001b680: 2020 2020 7365 6c66 2e5f 696e 636c 7564      self._includ
-0001b690: 655f 7061 7468 7320 3d20 6c69 7374 2869  e_paths = list(i
-0001b6a0: 6e63 6c75 6465 5f70 6174 6873 290a 2020  nclude_paths).  
-0001b6b0: 2020 2020 2020 7365 6c66 2e62 6173 655f        self.base_
-0001b6c0: 6e61 6d65 203d 2062 6173 655f 6e61 6d65  name = base_name
-0001b6d0: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0001b6e0: 6465 5f76 6572 7369 6f6e 203d 2063 6f64  de_version = cod
-0001b6f0: 655f 7665 7273 696f 6e0a 2020 2020 2020  e_version.      
-0001b700: 2020 7365 6c66 2e63 6f64 6520 3d20 636f    self.code = co
-0001b710: 6465 0a20 2020 2020 2020 2073 656c 662e  de.        self.
-0001b720: 6973 5f63 7070 203d 2069 735f 6370 700a  is_cpp = is_cpp.
-0001b730: 2020 2020 2020 2020 7365 6c66 2e63 5f6d          self.c_m
-0001b740: 6163 726f 5f64 6566 696e 6573 203d 207b  acro_defines = {
-0001b750: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-0001b760: 2028 635f 6d61 6372 6f5f 6465 6669 6e65   (c_macro_define
-0001b770: 7320 6f72 207b 7d29 2e69 7465 6d73 2829  s or {}).items()
-0001b780: 2069 6620 7620 6973 206e 6f74 204e 6f6e   if v is not Non
-0001b790: 657d 0a20 2020 2020 2020 2073 656c 662e  e}.        self.
-0001b7a0: 6c64 5f66 6c61 6773 203d 206c 645f 666c  ld_flags = ld_fl
-0001b7b0: 6167 7320 6f72 205b 5d0a 2020 2020 2020  ags or [].      
-0001b7c0: 2020 7365 6c66 2e69 6e63 6c75 6465 5f64    self.include_d
-0001b7d0: 6570 7320 3d20 696e 636c 7564 655f 6465  eps = include_de
-0001b7e0: 7073 0a20 2020 2020 2020 2073 656c 662e  ps.        self.
-0001b7f0: 7374 6174 6963 5f76 6572 7369 6f6e 5f6e  static_version_n
-0001b800: 616d 6520 3d20 7374 6174 6963 5f76 6572  ame = static_ver
-0001b810: 7369 6f6e 5f6e 616d 650a 2020 2020 2020  sion_name.      
-0001b820: 2020 7365 6c66 2e5f 636f 6465 5f68 6173    self._code_has
-0001b830: 6820 3d20 7365 6c66 2e5f 6d61 6b65 5f63  h = self._make_c
-0001b840: 6f64 655f 6861 7368 2829 0a20 2020 2020  ode_hash().     
-0001b850: 2020 2073 656c 662e 5f69 6e66 6f5f 6469     self._info_di
-0001b860: 6374 203d 2073 656c 662e 5f6d 616b 655f  ct = self._make_
-0001b870: 696e 666f 5f64 6963 7428 290a 2020 2020  info_dict().    
-0001b880: 2020 2020 7365 6c66 2e5f 6861 7368 203d      self._hash =
-0001b890: 2073 656c 662e 5f6d 616b 655f 6861 7368   self._make_hash
-0001b8a0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0001b8b0: 5f63 7479 7065 735f 6c69 6220 3d20 4e6f  _ctypes_lib = No
-0001b8c0: 6e65 0a20 2020 2020 2020 2069 6620 7368  ne.        if sh
-0001b8d0: 6f75 6c64 5f63 6c65 616e 7570 5f6f 6c64  ould_cleanup_old
-0001b8e0: 5f61 6c6c 3a0a 2020 2020 2020 2020 2020  _all:.          
-0001b8f0: 2020 7365 6c66 2e5f 636c 6561 6e75 705f    self._cleanup_
-0001b900: 6f6c 6428 290a 2020 2020 2020 2020 7365  old().        se
-0001b910: 6c66 2e5f 7368 6f75 6c64 5f63 6c65 616e  lf._should_clean
-0001b920: 7570 5f6f 6c64 5f6d 7964 6972 203d 2073  up_old_mydir = s
-0001b930: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
-0001b940: 645f 6d79 6469 720a 2020 2020 2020 2020  d_mydir.        
-0001b950: 7365 6c66 2e75 7365 5f63 7878 3131 5f61  self.use_cxx11_a
-0001b960: 6269 203d 2075 7365 5f63 7878 3131 5f61  bi = use_cxx11_a
-0001b970: 6269 0a20 2020 2020 2020 2073 656c 662e  bi.        self.
-0001b980: 5f6c 6f67 5f73 7472 6561 6d20 3d20 6c6f  _log_stream = lo
-0001b990: 675f 7374 7265 616d 0a20 2020 2020 2020  g_stream.       
-0001b9a0: 2069 6620 7365 6c66 2e76 6572 626f 7365   if self.verbose
-0001b9b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0001b9c0: 696e 7428 2225 733a 2025 7222 2025 2028  int("%s: %r" % (
-0001b9d0: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-0001b9e0: 5f6e 616d 655f 5f2c 2073 656c 6629 2c20  _name__, self), 
-0001b9f0: 6669 6c65 3d6c 6f67 5f73 7472 6561 6d29  file=log_stream)
-0001ba00: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-0001ba10: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-0001ba20: 2020 7265 7475 726e 2022 3c25 7320 2572    return "<%s %r
-0001ba30: 2069 6e20 2572 3e22 2025 2028 7365 6c66   in %r>" % (self
-0001ba40: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0001ba50: 655f 5f2c 2073 656c 662e 6261 7365 5f6e  e__, self.base_n
-0001ba60: 616d 652c 2073 656c 662e 5f6d 6f64 5f70  ame, self._mod_p
-0001ba70: 6174 6829 0a0a 2020 2020 4070 726f 7065  ath)..    @prope
-0001ba80: 7274 790a 2020 2020 6465 6620 5f6d 6f64  rty.    def _mod
-0001ba90: 5f70 6174 6828 7365 6c66 293a 0a20 2020  _path(self):.   
-0001baa0: 2020 2020 2072 6574 7572 6e20 2225 732f       return "%s/
-0001bab0: 2573 2f25 7322 2025 2028 7365 6c66 2e63  %s/%s" % (self.c
-0001bac0: 6163 6865 5f64 6972 2c20 7365 6c66 2e62  ache_dir, self.b
-0001bad0: 6173 655f 6e61 6d65 2c20 7365 6c66 2e73  ase_name, self.s
-0001bae0: 7461 7469 635f 7665 7273 696f 6e5f 6e61  tatic_version_na
-0001baf0: 6d65 206f 7220 7365 6c66 2e5f 6861 7368  me or self._hash
-0001bb00: 5b3a 3130 5d29 0a0a 2020 2020 4070 726f  [:10])..    @pro
-0001bb10: 7065 7274 790a 2020 2020 6465 6620 5f69  perty.    def _i
-0001bb20: 6e66 6f5f 6669 6c65 6e61 6d65 2873 656c  nfo_filename(sel
-0001bb30: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-0001bb40: 726e 2022 2573 2f69 6e66 6f2e 7079 2220  rn "%s/info.py" 
-0001bb50: 2520 2873 656c 662e 5f6d 6f64 5f70 6174  % (self._mod_pat
-0001bb60: 682c 290a 0a20 2020 2040 7072 6f70 6572  h,)..    @proper
-0001bb70: 7479 0a20 2020 2064 6566 205f 736f 5f66  ty.    def _so_f
-0001bb80: 696c 656e 616d 6528 7365 6c66 293a 0a20  ilename(self):. 
-0001bb90: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
-0001bba0: 732f 2573 2e73 6f22 2025 2028 7365 6c66  s/%s.so" % (self
-0001bbb0: 2e5f 6d6f 645f 7061 7468 2c20 7365 6c66  ._mod_path, self
-0001bbc0: 2e62 6173 655f 6e61 6d65 290a 0a20 2020  .base_name)..   
-0001bbd0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-0001bbe0: 6566 205f 635f 6669 6c65 6e61 6d65 2873  ef _c_filename(s
-0001bbf0: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
-0001bc00: 2073 656c 662e 6973 5f63 7070 3a0a 2020   self.is_cpp:.  
-0001bc10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001bc20: 2022 2573 2f25 732e 6363 2220 2520 2873   "%s/%s.cc" % (s
-0001bc30: 656c 662e 5f6d 6f64 5f70 6174 682c 2073  elf._mod_path, s
-0001bc40: 656c 662e 6261 7365 5f6e 616d 6529 0a20  elf.base_name). 
-0001bc50: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
-0001bc60: 732f 2573 2e63 2220 2520 2873 656c 662e  s/%s.c" % (self.
-0001bc70: 5f6d 6f64 5f70 6174 682c 2073 656c 662e  _mod_path, self.
-0001bc80: 6261 7365 5f6e 616d 6529 0a0a 2020 2020  base_name)..    
-0001bc90: 5f63 6c65 616e 7570 5f74 696d 655f 6c69  _cleanup_time_li
-0001bca0: 6d69 745f 6461 7973 203d 2036 300a 0a20  mit_days = 60.. 
-0001bcb0: 2020 2064 6566 205f 636c 6561 6e75 705f     def _cleanup_
-0001bcc0: 6f6c 6428 7365 6c66 293a 0a20 2020 2020  old(self):.     
-0001bcd0: 2020 206d 6f64 5f70 6174 6820 3d20 7365     mod_path = se
-0001bce0: 6c66 2e5f 6d6f 645f 7061 7468 2020 2320  lf._mod_path  # 
-0001bcf0: 2e2e 2e2f 6261 7365 5f6e 616d 652f 6861  .../base_name/ha
-0001bd00: 7368 0a20 2020 2020 2020 2062 6173 655f  sh.        base_
-0001bd10: 6d6f 645f 7061 7468 203d 206f 732e 7061  mod_path = os.pa
-0001bd20: 7468 2e64 6972 6e61 6d65 286d 6f64 5f70  th.dirname(mod_p
-0001bd30: 6174 6829 2020 2320 2e2e 2e2f 6261 7365  ath)  # .../base
-0001bd40: 5f6e 616d 650a 2020 2020 2020 2020 6d79  _name.        my
-0001bd50: 5f6d 6f64 5f70 6174 685f 6e61 6d65 203d  _mod_path_name =
-0001bd60: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-0001bd70: 6528 6d6f 645f 7061 7468 290a 2020 2020  e(mod_path).    
-0001bd80: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001bd90: 7468 2e65 7869 7374 7328 6261 7365 5f6d  th.exists(base_m
-0001bda0: 6f64 5f70 6174 6829 3a0a 2020 2020 2020  od_path):.      
-0001bdb0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0001bdc0: 2020 2020 2069 6d70 6f72 7420 7469 6d65       import time
-0001bdd0: 0a0a 2020 2020 2020 2020 636c 6561 6e75  ..        cleanu
-0001bde0: 705f 7469 6d65 5f6c 696d 6974 5f73 6563  p_time_limit_sec
-0001bdf0: 7320 3d20 7365 6c66 2e5f 636c 6561 6e75  s = self._cleanu
-0001be00: 705f 7469 6d65 5f6c 696d 6974 5f64 6179  p_time_limit_day
-0001be10: 7320 2a20 3234 202a 2036 3020 2a20 3630  s * 24 * 60 * 60
-0001be20: 0a20 2020 2020 2020 2066 6f72 2070 2069  .        for p i
-0001be30: 6e20 6f73 2e6c 6973 7464 6972 2862 6173  n os.listdir(bas
-0001be40: 655f 6d6f 645f 7061 7468 293a 0a20 2020  e_mod_path):.   
-0001be50: 2020 2020 2020 2020 2069 6620 7020 3d3d           if p ==
-0001be60: 206d 795f 6d6f 645f 7061 7468 5f6e 616d   my_mod_path_nam
-0001be70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001be80: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001be90: 2020 2020 2020 2020 6675 6c6c 5f64 6972          full_dir
-0001bea0: 5f70 6174 6820 3d20 2225 732f 2573 2220  _path = "%s/%s" 
-0001beb0: 2520 2862 6173 655f 6d6f 645f 7061 7468  % (base_mod_path
-0001bec0: 2c20 7029 0a20 2020 2020 2020 2020 2020  , p).           
-0001bed0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-0001bee0: 6973 6469 7228 6675 6c6c 5f64 6972 5f70  isdir(full_dir_p
-0001bef0: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-0001bf00: 2020 2020 2020 636f 6e74 696e 7565 2020        continue  
-0001bf10: 2320 6967 6e6f 7265 2066 6f72 206e 6f77  # ignore for now
-0001bf20: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-0001bf30: 6b20 3d20 4c6f 636b 4669 6c65 2866 756c  k = LockFile(ful
-0001bf40: 6c5f 6469 725f 7061 7468 290a 2020 2020  l_dir_path).    
-0001bf50: 2020 2020 2020 2020 6966 206c 6f63 6b2e          if lock.
-0001bf60: 6973 5f6c 6f63 6b65 6428 293a 0a20 2020  is_locked():.   
-0001bf70: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001bf80: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-0001bf90: 2020 6c6f 636b 2e6d 6179 6265 5f72 656d    lock.maybe_rem
-0001bfa0: 6f76 655f 6f6c 645f 6c6f 636b 6669 6c65  ove_old_lockfile
-0001bfb0: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
-0001bfc0: 6e66 6f5f 7061 7468 203d 2022 2573 2f69  nfo_path = "%s/i
-0001bfd0: 6e66 6f2e 7079 2220 2520 6675 6c6c 5f64  nfo.py" % full_d
-0001bfe0: 6972 5f70 6174 680a 2020 2020 2020 2020  ir_path.        
-0001bff0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001c000: 7468 2e65 7869 7374 7328 696e 666f 5f70  th.exists(info_p
-0001c010: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-0001c020: 2020 2020 2020 7365 6c66 2e5f 636c 6561        self._clea
-0001c030: 6e75 705f 6f6c 645f 7061 7468 2866 756c  nup_old_path(ful
-0001c040: 6c5f 6469 725f 7061 7468 2c20 7265 6173  l_dir_path, reas
-0001c050: 6f6e 3d22 636f 7272 7570 7420 6469 722c  on="corrupt dir,
-0001c060: 206d 6973 7369 6e67 2069 6e66 6f2e 7079   missing info.py
-0001c070: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001c080: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001c090: 2020 2020 2020 2020 736f 5f70 6174 6820          so_path 
-0001c0a0: 3d20 2225 732f 2573 2e73 6f22 2025 2028  = "%s/%s.so" % (
-0001c0b0: 6675 6c6c 5f64 6972 5f70 6174 682c 2073  full_dir_path, s
-0001c0c0: 656c 662e 6261 7365 5f6e 616d 6529 0a20  elf.base_name). 
-0001c0d0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001c0e0: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-0001c0f0: 2873 6f5f 7061 7468 293a 0a20 2020 2020  (so_path):.     
-0001c100: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001c110: 5f63 6c65 616e 7570 5f6f 6c64 5f70 6174  _cleanup_old_pat
-0001c120: 6828 6675 6c6c 5f64 6972 5f70 6174 682c  h(full_dir_path,
-0001c130: 2072 6561 736f 6e3d 2263 6f72 7275 7074   reason="corrupt
-0001c140: 2064 6972 2c20 6d69 7373 696e 6720 736f   dir, missing so
-0001c150: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001c160: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001c170: 2020 2020 2020 2020 6474 203d 2074 696d          dt = tim
-0001c180: 652e 7469 6d65 2829 202d 206f 732e 7061  e.time() - os.pa
-0001c190: 7468 2e67 6574 6d74 696d 6528 736f 5f70  th.getmtime(so_p
-0001c1a0: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-0001c1b0: 2069 6620 6474 203e 2063 6c65 616e 7570   if dt > cleanup
-0001c1c0: 5f74 696d 655f 6c69 6d69 745f 7365 6373  _time_limit_secs
-0001c1d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c1e0: 2020 7365 6c66 2e5f 636c 6561 6e75 705f    self._cleanup_
-0001c1f0: 6f6c 645f 7061 7468 2866 756c 6c5f 6469  old_path(full_di
-0001c200: 725f 7061 7468 2c20 7265 6173 6f6e 3d22  r_path, reason="
-0001c210: 2573 206f 6c64 2220 2520 686d 7328 6474  %s old" % hms(dt
-0001c220: 2929 0a0a 2020 2020 6465 6620 5f63 6c65  ))..    def _cle
-0001c230: 616e 7570 5f6f 6c64 5f70 6174 6828 7365  anup_old_path(se
-0001c240: 6c66 2c20 702c 2072 6561 736f 6e29 3a0a  lf, p, reason):.
-0001c250: 2020 2020 2020 2020 7072 696e 7428 2225          print("%
-0001c260: 7320 6465 6c65 7465 206f 6c64 2c20 2573  s delete old, %s
-0001c270: 3a20 2573 2220 2520 2873 656c 662e 5f5f  : %s" % (self.__
-0001c280: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0001c290: 2c20 7265 6173 6f6e 2c20 7029 290a 2020  , reason, p)).  
-0001c2a0: 2020 2020 2020 6173 7365 7274 206f 732e        assert os.
-0001c2b0: 7061 7468 2e65 7869 7374 7328 7029 0a20  path.exists(p). 
-0001c2c0: 2020 2020 2020 2069 6d70 6f72 7420 7368         import sh
-0001c2d0: 7574 696c 0a0a 2020 2020 2020 2020 7472  util..        tr
-0001c2e0: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-0001c2f0: 6875 7469 6c2e 726d 7472 6565 2870 290a  hutil.rmtree(p).
-0001c300: 2020 2020 2020 2020 6578 6365 7074 204f          except O
-0001c310: 5345 7272 6f72 2061 7320 6578 633a 0a20  SError as exc:. 
-0001c320: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0001c330: 2822 2573 2064 656c 6574 6520 6578 6365  ("%s delete exce
-0001c340: 7074 696f 6e20 2825 7329 2e20 5769 6c6c  ption (%s). Will
-0001c350: 2069 676e 6f72 6520 616e 6420 7472 7920   ignore and try 
-0001c360: 746f 2063 6f6e 7469 6e75 6520 616e 7977  to continue anyw
-0001c370: 6179 2e22 2025 2028 7365 6c66 2e5f 5f63  ay." % (self.__c
-0001c380: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
-0001c390: 2065 7863 2929 0a0a 2020 2020 6465 6620   exc))..    def 
-0001c3a0: 5f6c 6f61 645f 696e 666f 2873 656c 6629  _load_info(self)
-0001c3b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001c3c0: 2020 2020 2020 3a72 7479 7065 3a20 6469        :rtype: di
-0001c3d0: 6374 5b73 7472 5d7c 4e6f 6e65 0a20 2020  ct[str]|None.   
-0001c3e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c3f0: 2066 696c 656e 616d 6520 3d20 7365 6c66   filename = self
-0001c400: 2e5f 696e 666f 5f66 696c 656e 616d 650a  ._info_filename.
-0001c410: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-0001c420: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
-0001c430: 6c65 6e61 6d65 293a 0a20 2020 2020 2020  lename):.       
-0001c440: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001c450: 0a20 2020 2020 2020 2073 203d 206f 7065  .        s = ope
-0001c460: 6e28 6669 6c65 6e61 6d65 292e 7265 6164  n(filename).read
-0001c470: 2829 0a20 2020 2020 2020 2072 6573 203d  ().        res =
-0001c480: 2065 7661 6c28 7329 0a20 2020 2020 2020   eval(s).       
-0001c490: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-0001c4a0: 6365 2872 6573 2c20 6469 6374 290a 2020  ce(res, dict).  
-0001c4b0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0001c4c0: 0a0a 2020 2020 5f72 656c 6576 616e 745f  ..    _relevant_
-0001c4d0: 696e 666f 5f6b 6579 7320 3d20 2822 636f  info_keys = ("co
-0001c4e0: 6465 5f76 6572 7369 6f6e 222c 2022 636f  de_version", "co
-0001c4f0: 6465 5f68 6173 6822 2c20 2263 5f6d 6163  de_hash", "c_mac
-0001c500: 726f 5f64 6566 696e 6573 222c 2022 6c64  ro_defines", "ld
-0001c510: 5f66 6c61 6773 222c 2022 636f 6d70 696c  _flags", "compil
-0001c520: 6572 5f62 696e 2229 0a0a 2020 2020 6465  er_bin")..    de
-0001c530: 6620 5f6d 616b 655f 696e 666f 5f64 6963  f _make_info_dic
-0001c540: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-0001c550: 2022 2222 0a20 2020 2020 2020 203a 7274   """.        :rt
-0001c560: 7970 653a 2064 6963 745b 7374 725d 0a20  ype: dict[str]. 
-0001c570: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001c580: 2020 2072 6574 7572 6e20 7b0a 2020 2020     return {.    
-0001c590: 2020 2020 2020 2020 2262 6173 655f 6e61          "base_na
-0001c5a0: 6d65 223a 2073 656c 662e 6261 7365 5f6e  me": self.base_n
-0001c5b0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-0001c5c0: 2022 696e 636c 7564 655f 7061 7468 7322   "include_paths"
-0001c5d0: 3a20 7365 6c66 2e5f 696e 636c 7564 655f  : self._include_
-0001c5e0: 7061 7468 732c 0a20 2020 2020 2020 2020  paths,.         
-0001c5f0: 2020 2022 636f 6465 5f76 6572 7369 6f6e     "code_version
-0001c600: 223a 2073 656c 662e 636f 6465 5f76 6572  ": self.code_ver
-0001c610: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
-0001c620: 2020 2263 6f64 655f 6861 7368 223a 2073    "code_hash": s
-0001c630: 656c 662e 5f63 6f64 655f 6861 7368 2c0a  elf._code_hash,.
-0001c640: 2020 2020 2020 2020 2020 2020 2263 5f6d              "c_m
-0001c650: 6163 726f 5f64 6566 696e 6573 223a 2073  acro_defines": s
-0001c660: 656c 662e 635f 6d61 6372 6f5f 6465 6669  elf.c_macro_defi
-0001c670: 6e65 732c 0a20 2020 2020 2020 2020 2020  nes,.           
-0001c680: 2022 6c64 5f66 6c61 6773 223a 2073 656c   "ld_flags": sel
-0001c690: 662e 6c64 5f66 6c61 6773 2c0a 2020 2020  f.ld_flags,.    
-0001c6a0: 2020 2020 2020 2020 2263 6f6d 7069 6c65          "compile
-0001c6b0: 725f 6269 6e22 3a20 7365 6c66 2e5f 6765  r_bin": self._ge
-0001c6c0: 745f 636f 6d70 696c 6572 5f62 696e 2829  t_compiler_bin()
-0001c6d0: 2c0a 2020 2020 2020 2020 7d0a 0a20 2020  ,.        }..   
-0001c6e0: 2064 6566 205f 6d61 6b65 5f63 6f64 655f   def _make_code_
-0001c6f0: 6861 7368 2873 656c 6629 3a0a 2020 2020  hash(self):.    
-0001c700: 2020 2020 696d 706f 7274 2068 6173 686c      import hashl
-0001c710: 6962 0a0a 2020 2020 2020 2020 6820 3d20  ib..        h = 
-0001c720: 6861 7368 6c69 622e 6d64 3528 290a 2020  hashlib.md5().  
-0001c730: 2020 2020 2020 682e 7570 6461 7465 2873        h.update(s
-0001c740: 656c 662e 636f 6465 2e65 6e63 6f64 6528  elf.code.encode(
-0001c750: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
-0001c760: 2072 6574 7572 6e20 682e 6865 7864 6967   return h.hexdig
-0001c770: 6573 7428 290a 0a20 2020 2064 6566 205f  est()..    def _
-0001c780: 6d61 6b65 5f68 6173 6828 7365 6c66 293a  make_hash(self):
-0001c790: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0001c7a0: 6861 7368 6c69 620a 0a20 2020 2020 2020  hashlib..       
-0001c7b0: 2068 203d 2068 6173 686c 6962 2e6d 6435   h = hashlib.md5
-0001c7c0: 2829 0a20 2020 2020 2020 2068 2e75 7064  ().        h.upd
-0001c7d0: 6174 6528 227b 222e 656e 636f 6465 2822  ate("{".encode("
-0001c7e0: 7574 6638 2229 290a 2020 2020 2020 2020  utf8")).        
-0001c7f0: 666f 7220 6b65 7920 696e 2073 656c 662e  for key in self.
-0001c800: 5f72 656c 6576 616e 745f 696e 666f 5f6b  _relevant_info_k
-0001c810: 6579 733a 0a20 2020 2020 2020 2020 2020  eys:.           
-0001c820: 2068 2e75 7064 6174 6528 2822 2573 3a7b   h.update(("%s:{
-0001c830: 2573 7d22 2025 2028 6b65 792c 2073 656c  %s}" % (key, sel
-0001c840: 662e 5f69 6e66 6f5f 6469 6374 5b6b 6579  f._info_dict[key
-0001c850: 5d29 292e 656e 636f 6465 2822 7574 6638  ])).encode("utf8
-0001c860: 2229 290a 2020 2020 2020 2020 682e 7570  ")).        h.up
-0001c870: 6461 7465 2822 7d22 2e65 6e63 6f64 6528  date("}".encode(
-0001c880: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
-0001c890: 2072 6574 7572 6e20 682e 6865 7864 6967   return h.hexdig
-0001c8a0: 6573 7428 290a 0a20 2020 2064 6566 205f  est()..    def _
-0001c8b0: 7361 7665 5f69 6e66 6f28 7365 6c66 293a  save_info(self):
-0001c8c0: 0a20 2020 2020 2020 2066 696c 656e 616d  .        filenam
-0001c8d0: 6520 3d20 7365 6c66 2e5f 696e 666f 5f66  e = self._info_f
-0001c8e0: 696c 656e 616d 650a 2020 2020 2020 2020  ilename.        
-0001c8f0: 7769 7468 206f 7065 6e28 6669 6c65 6e61  with open(filena
-0001c900: 6d65 2c20 2277 2229 2061 7320 663a 0a20  me, "w") as f:. 
-0001c910: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-0001c920: 7465 2822 2573 5c6e 2220 2520 6265 7474  te("%s\n" % bett
-0001c930: 6572 5f72 6570 7228 7365 6c66 2e5f 696e  er_repr(self._in
-0001c940: 666f 5f64 6963 7429 290a 0a20 2020 2064  fo_dict))..    d
-0001c950: 6566 205f 6e65 6564 5f72 6563 6f6d 7069  ef _need_recompi
-0001c960: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
-0001c970: 2020 2222 220a 2020 2020 2020 2020 3a72    """.        :r
-0001c980: 7479 7065 3a20 626f 6f6c 0a20 2020 2020  type: bool.     
-0001c990: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001c9a0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-0001c9b0: 6973 7473 2873 656c 662e 5f73 6f5f 6669  ists(self._so_fi
-0001c9c0: 6c65 6e61 6d65 293a 0a20 2020 2020 2020  lename):.       
-0001c9d0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001c9e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001c9f0: 2e69 6e63 6c75 6465 5f64 6570 733a 0a20  .include_deps:. 
-0001ca00: 2020 2020 2020 2020 2020 2073 6f5f 6d74             so_mt
-0001ca10: 696d 6520 3d20 6f73 2e70 6174 682e 6765  ime = os.path.ge
-0001ca20: 746d 7469 6d65 2873 656c 662e 5f73 6f5f  tmtime(self._so_
-0001ca30: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-0001ca40: 2020 2020 2020 666f 7220 666e 2069 6e20        for fn in 
-0001ca50: 7365 6c66 2e69 6e63 6c75 6465 5f64 6570  self.include_dep
-0001ca60: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001ca70: 2020 2069 6620 6f73 2e70 6174 682e 6765     if os.path.ge
-0001ca80: 746d 7469 6d65 2866 6e29 203e 2073 6f5f  tmtime(fn) > so_
-0001ca90: 6d74 696d 653a 0a20 2020 2020 2020 2020  mtime:.         
-0001caa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001cab0: 6e20 5472 7565 0a20 2020 2020 2020 206f  n True.        o
-0001cac0: 6c64 5f69 6e66 6f20 3d20 7365 6c66 2e5f  ld_info = self._
-0001cad0: 6c6f 6164 5f69 6e66 6f28 290a 2020 2020  load_info().    
-0001cae0: 2020 2020 6e65 775f 696e 666f 203d 2073      new_info = s
-0001caf0: 656c 662e 5f6d 616b 655f 696e 666f 5f64  elf._make_info_d
-0001cb00: 6963 7428 290a 2020 2020 2020 2020 6966  ict().        if
-0001cb10: 206e 6f74 206f 6c64 5f69 6e66 6f3a 0a20   not old_info:. 
-0001cb20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001cb30: 6e20 5472 7565 0a20 2020 2020 2020 2023  n True.        #
-0001cb40: 2054 6865 2068 6173 6820 616c 7265 6164   The hash alread
-0001cb50: 7920 6d61 7463 6865 6420 6275 7420 7665  y matched but ve
-0001cb60: 7279 2075 6e6c 696b 656c 792c 2074 6869  ry unlikely, thi
-0001cb70: 7320 636f 756c 6420 6265 2061 2063 6f6c  s could be a col
-0001cb80: 6c69 7369 6f6e 2e0a 2020 2020 2020 2020  lision..        
-0001cb90: 2320 416e 7977 6179 2c20 6a75 7374 2064  # Anyway, just d
-0001cba0: 6f20 7468 6973 2076 6572 7920 6368 6561  o this very chea
-0001cbb0: 7020 6368 6563 6b2e 0a20 2020 2020 2020  p check..       
-0001cbc0: 2066 6f72 206b 6579 2069 6e20 7365 6c66   for key in self
-0001cbd0: 2e5f 7265 6c65 7661 6e74 5f69 6e66 6f5f  ._relevant_info_
-0001cbe0: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
-0001cbf0: 2020 6966 206b 6579 206e 6f74 2069 6e20    if key not in 
-0001cc00: 6f6c 645f 696e 666f 3a0a 2020 2020 2020  old_info:.      
-0001cc10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001cc20: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0001cc30: 2020 6966 206f 6c64 5f69 6e66 6f5b 6b65    if old_info[ke
-0001cc40: 795d 2021 3d20 6e65 775f 696e 666f 5b6b  y] != new_info[k
-0001cc50: 6579 5d3a 0a20 2020 2020 2020 2020 2020  ey]:.           
-0001cc60: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001cc70: 0a20 2020 2020 2020 2023 2049 6620 6e6f  .        # If no
-0001cc80: 2063 6f64 6520 7665 7273 696f 6e20 6973   code version is
-0001cc90: 2070 726f 7669 6465 642c 2077 6520 636f   provided, we co
-0001cca0: 756c 6420 616c 736f 2063 6865 636b 2074  uld also check t
-0001ccb0: 6865 2063 6f64 6520 6974 7365 6c66 206e  he code itself n
-0001ccc0: 6f77 2e0a 2020 2020 2020 2020 2320 4275  ow..        # Bu
-0001ccd0: 7420 4920 7468 696e 6b20 7468 6973 2069  t I think this i
-0001cce0: 7320 6f76 6572 6b69 6c6c 2e0a 2020 2020  s overkill..    
-0001ccf0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001cd00: 0a0a 2020 2020 6465 6620 5f6d 6179 6265  ..    def _maybe
-0001cd10: 5f63 6f6d 7069 6c65 2873 656c 6629 3a0a  _compile(self):.
-0001cd20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001cd30: 2020 2020 4f6e 2073 7563 6365 7373 6675      On successfu
-0001cd40: 6c20 7265 7475 726e 2c20 7365 6c66 2e5f  l return, self._
-0001cd50: 736f 5f66 696c 656e 616d 6520 7368 6f75  so_filename shou
-0001cd60: 6c64 2065 7869 7374 2061 6e64 2062 6520  ld exist and be 
-0001cd70: 7570 2d74 6f2d 6461 7465 2e0a 2020 2020  up-to-date..    
-0001cd80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001cd90: 6966 206e 6f74 2073 656c 662e 5f6e 6565  if not self._nee
-0001cda0: 645f 7265 636f 6d70 696c 6528 293a 0a20  d_recompile():. 
-0001cdb0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0001cdc0: 6c66 2e76 6572 626f 7365 3a0a 2020 2020  lf.verbose:.    
-0001cdd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001cde0: 7428 2225 733a 204e 6f20 6e65 6564 2074  t("%s: No need t
-0001cdf0: 6f20 7265 636f 6d70 696c 653a 2025 7322  o recompile: %s"
-0001ce00: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
-0001ce10: 5f5f 2e5f 5f6e 616d 655f 5f2c 2073 656c  __.__name__, sel
-0001ce20: 662e 5f73 6f5f 6669 6c65 6e61 6d65 2929  f._so_filename))
-0001ce30: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0001ce40: 6f75 6368 2069 7420 736f 2074 6861 7420  ouch it so that 
-0001ce50: 7765 2063 616e 2073 6565 2074 6861 7420  we can see that 
-0001ce60: 7765 2075 7365 6420 6974 2072 6563 656e  we used it recen
-0001ce70: 746c 792e 0a20 2020 2020 2020 2020 2020  tly..           
-0001ce80: 206f 732e 7574 696d 6528 7365 6c66 2e5f   os.utime(self._
-0001ce90: 696e 666f 5f66 696c 656e 616d 652c 204e  info_filename, N
-0001cea0: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-0001ceb0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-0001cec0: 6c6f 636b 203d 204c 6f63 6b46 696c 6528  lock = LockFile(
-0001ced0: 7365 6c66 2e5f 6d6f 645f 7061 7468 290a  self._mod_path).
-0001cee0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0001cef0: 656c 662e 5f6e 6565 645f 7265 636f 6d70  elf._need_recomp
-0001cf00: 696c 6528 293a 2020 2320 6368 6563 6b20  ile():  # check 
-0001cf10: 6167 6169 6e0a 2020 2020 2020 2020 2020  again.          
-0001cf20: 2020 6966 2073 656c 662e 7665 7262 6f73    if self.verbos
-0001cf30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001cf40: 2020 2070 7269 6e74 2822 2573 3a20 4e6f     print("%s: No
-0001cf50: 206e 6565 6420 746f 2072 6563 6f6d 7069   need to recompi
-0001cf60: 6c65 2061 6674 6572 2077 6520 7761 6974  le after we wait
-0001cf70: 6564 3a20 2573 2220 2520 2873 656c 662e  ed: %s" % (self.
-0001cf80: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001cf90: 5f5f 2c20 7365 6c66 2e5f 736f 5f66 696c  __, self._so_fil
-0001cfa0: 656e 616d 6529 290a 2020 2020 2020 2020  ename)).        
-0001cfb0: 2020 2020 6f73 2e75 7469 6d65 2873 656c      os.utime(sel
-0001cfc0: 662e 5f69 6e66 6f5f 6669 6c65 6e61 6d65  f._info_filename
-0001cfd0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0001cfe0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001cff0: 2020 2069 6620 7365 6c66 2e5f 7368 6f75     if self._shou
-0001d000: 6c64 5f63 6c65 616e 7570 5f6f 6c64 5f6d  ld_cleanup_old_m
-0001d010: 7964 6972 2061 6e64 206e 6f74 206c 6f63  ydir and not loc
-0001d020: 6b2e 6973 5f6c 6f63 6b65 6428 293a 0a20  k.is_locked():. 
-0001d030: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-0001d040: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-0001d050: 662e 5f6d 6f64 5f70 6174 6829 3a0a 2020  f._mod_path):.  
-0001d060: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001d070: 6c66 2e5f 636c 6561 6e75 705f 6f6c 645f  lf._cleanup_old_
-0001d080: 7061 7468 2873 656c 662e 5f6d 6f64 5f70  path(self._mod_p
-0001d090: 6174 682c 2072 6561 736f 6e3d 226e 6565  ath, reason="nee
-0001d0a0: 6420 7265 636f 6d70 696c 6522 290a 2020  d recompile").  
-0001d0b0: 2020 2020 2020 7769 7468 206c 6f63 6b3a        with lock:
-0001d0c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001d0d0: 662e 5f6d 6179 6265 5f63 6f6d 7069 6c65  f._maybe_compile
-0001d0e0: 5f69 6e6e 6572 2829 0a0a 2020 2020 6465  _inner()..    de
-0001d0f0: 6620 5f67 6574 5f63 6f6d 7069 6c65 725f  f _get_compiler_
-0001d100: 6269 6e28 7365 6c66 293a 0a20 2020 2020  bin(self):.     
-0001d110: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-0001d120: 7274 7970 653a 2073 7472 0a20 2020 2020  rtype: str.     
-0001d130: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001d140: 6620 7365 6c66 2e69 735f 6370 703a 0a20  f self.is_cpp:. 
-0001d150: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001d160: 6e20 2267 2b2b 220a 2020 2020 2020 2020  n "g++".        
-0001d170: 7265 7475 726e 2022 6763 6322 0a0a 2020  return "gcc"..  
-0001d180: 2020 6465 6620 5f74 7261 6e73 666f 726d    def _transform
-0001d190: 5f63 6f6d 7069 6c65 725f 6f70 7473 2873  _compiler_opts(s
-0001d1a0: 656c 662c 206f 7074 7329 3a0a 2020 2020  elf, opts):.    
-0001d1b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001d1c0: 3a70 6172 616d 206c 6973 745b 7374 725d  :param list[str]
-0001d1d0: 206f 7074 733a 0a20 2020 2020 2020 203a   opts:.        :
-0001d1e0: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
-0001d1f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001d200: 2020 2020 2072 6574 7572 6e20 6f70 7473       return opts
-0001d210: 0a0a 2020 2020 6465 6620 5f65 7874 7261  ..    def _extra
-0001d220: 5f63 6f6d 6d6f 6e5f 6f70 7473 2873 656c  _common_opts(sel
-0001d230: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0001d240: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-0001d250: 6c69 7374 5b73 7472 5d0a 2020 2020 2020  list[str].      
-0001d260: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-0001d270: 2073 656c 662e 6973 5f63 7070 3a0a 2020   self.is_cpp:.  
-0001d280: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001d290: 205b 222d 7374 643d 632b 2b31 3122 5d0a   ["-std=c++11"].
-0001d2a0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-0001d2b0: 5d0a 0a20 2020 2040 636c 6173 736d 6574  ]..    @classmet
-0001d2c0: 686f 640a 2020 2020 6465 6620 5f74 7261  hod.    def _tra
-0001d2d0: 6e73 666f 726d 5f6c 645f 666c 6167 2863  nsform_ld_flag(c
-0001d2e0: 6c73 2c20 6f70 7429 3a0a 2020 2020 2020  ls, opt):.      
-0001d2f0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-0001d300: 6172 616d 2073 7472 206f 7074 3a0a 2020  aram str opt:.  
-0001d310: 2020 2020 2020 3a72 7479 7065 3a20 7374        :rtype: st
-0001d320: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
-0001d330: 2020 2020 2020 6966 2073 7973 2e70 6c61        if sys.pla
-0001d340: 7466 6f72 6d20 3d3d 2022 6461 7277 696e  tform == "darwin
-0001d350: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
-0001d360: 2049 7420 7365 656d 7320 736f 6d65 2076   It seems some v
-0001d370: 6572 7369 6f6e 7320 6f66 204d 6163 4f53  ersions of MacOS
-0001d380: 206c 6420 6361 6e6e 6f74 2068 616e 646c   ld cannot handl
-0001d390: 6520 7468 6520 602d 6c3a 6669 6c65 6e61  e the `-l:filena
-0001d3a0: 6d65 6020 6172 6775 6d65 6e74 2063 6f72  me` argument cor
-0001d3b0: 7265 6374 6c79 2e0a 2020 2020 2020 2020  rectly..        
-0001d3c0: 2020 2020 2320 452e 672e 2054 656e 736f      # E.g. Tenso
-0001d3d0: 7246 6c6f 7720 312e 3134 2069 6e63 6f72  rFlow 1.14 incor
-0001d3e0: 7265 6374 6c79 2075 7365 7320 7468 6973  rectly uses this
-0001d3f0: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0001d400: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0001d410: 6f6d 2f74 656e 736f 7266 6c6f 772f 7465  om/tensorflow/te
-0001d420: 6e73 6f72 666c 6f77 2f69 7373 7565 732f  nsorflow/issues/
-0001d430: 3330 3536 340a 2020 2020 2020 2020 2020  30564.          
-0001d440: 2020 6966 206f 7074 2e73 7461 7274 7377    if opt.startsw
-0001d450: 6974 6828 222d 6c3a 6c69 6222 2920 616e  ith("-l:lib") an
-0001d460: 6420 6f70 742e 656e 6473 7769 7468 2822  d opt.endswith("
-0001d470: 2e64 796c 6962 2229 3a0a 2020 2020 2020  .dylib"):.      
-0001d480: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001d490: 2022 2d6c 2573 2220 2520 6f70 745b 6c65   "-l%s" % opt[le
-0001d4a0: 6e28 222d 6c3a 6c69 6222 2920 3a20 2d6c  n("-l:lib") : -l
-0001d4b0: 656e 2822 2e64 796c 6962 2229 5d0a 2020  en(".dylib")].  
-0001d4c0: 2020 2020 2020 7265 7475 726e 206f 7074        return opt
-0001d4d0: 0a0a 2020 2020 6465 6620 5f6d 6179 6265  ..    def _maybe
-0001d4e0: 5f63 6f6d 7069 6c65 5f69 6e6e 6572 2873  _compile_inner(s
-0001d4f0: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
-0001d500: 4469 7265 6374 6f72 7920 7368 6f75 6c64  Directory should
-0001d510: 2062 6520 6372 6561 7465 6420 6279 2074   be created by t
-0001d520: 6865 206c 6f63 6b69 6e67 206d 6563 6861  he locking mecha
-0001d530: 6e69 736d 2e0a 2020 2020 2020 2020 6173  nism..        as
-0001d540: 7365 7274 206f 732e 7061 7468 2e65 7869  sert os.path.exi
-0001d550: 7374 7328 7365 6c66 2e5f 6d6f 645f 7061  sts(self._mod_pa
-0001d560: 7468 290a 2020 2020 2020 2020 7769 7468  th).        with
-0001d570: 206f 7065 6e28 7365 6c66 2e5f 635f 6669   open(self._c_fi
-0001d580: 6c65 6e61 6d65 2c20 2277 2229 2061 7320  lename, "w") as 
-0001d590: 663a 0a20 2020 2020 2020 2020 2020 2066  f:.            f
-0001d5a0: 2e77 7269 7465 2873 656c 662e 636f 6465  .write(self.code
-0001d5b0: 290a 2020 2020 2020 2020 636f 6d6d 6f6e  ).        common
-0001d5c0: 5f6f 7074 7320 3d20 5b22 2d73 6861 7265  _opts = ["-share
-0001d5d0: 6422 2c20 222d 4f32 225d 0a20 2020 2020  d", "-O2"].     
-0001d5e0: 2020 2063 6f6d 6d6f 6e5f 6f70 7473 202b     common_opts +
-0001d5f0: 3d20 7365 6c66 2e5f 6578 7472 615f 636f  = self._extra_co
-0001d600: 6d6d 6f6e 5f6f 7074 7328 290a 2020 2020  mmon_opts().    
-0001d610: 2020 2020 6966 2073 7973 2e70 6c61 7466      if sys.platf
-0001d620: 6f72 6d20 3d3d 2022 6461 7277 696e 223a  orm == "darwin":
-0001d630: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0001d640: 6d6f 6e5f 6f70 7473 202b 3d20 5b22 2d75  mon_opts += ["-u
-0001d650: 6e64 6566 696e 6564 222c 2022 6479 6e61  ndefined", "dyna
-0001d660: 6d69 635f 6c6f 6f6b 7570 225d 0a20 2020  mic_lookup"].   
-0001d670: 2020 2020 2066 6f72 2069 6e63 6c75 6465       for include
-0001d680: 5f70 6174 6820 696e 2073 656c 662e 5f69  _path in self._i
-0001d690: 6e63 6c75 6465 5f70 6174 6873 3a0a 2020  nclude_paths:.  
-0001d6a0: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
-0001d6b0: 5f6f 7074 7320 2b3d 205b 222d 4922 2c20  _opts += ["-I", 
-0001d6c0: 696e 636c 7564 655f 7061 7468 5d0a 2020  include_path].  
-0001d6d0: 2020 2020 2020 636f 6d70 696c 6572 5f6f        compiler_o
-0001d6e0: 7074 7320 3d20 5b22 2d66 5049 4322 2c20  pts = ["-fPIC", 
-0001d6f0: 222d 7622 5d0a 2020 2020 2020 2020 636f  "-v"].        co
-0001d700: 6d6d 6f6e 5f6f 7074 7320 2b3d 2073 656c  mmon_opts += sel
-0001d710: 662e 5f74 7261 6e73 666f 726d 5f63 6f6d  f._transform_com
-0001d720: 7069 6c65 725f 6f70 7473 2863 6f6d 7069  piler_opts(compi
-0001d730: 6c65 725f 6f70 7473 290a 2020 2020 2020  ler_opts).      
-0001d740: 2020 636f 6d6d 6f6e 5f6f 7074 7320 2b3d    common_opts +=
-0001d750: 205b 222d 445f 474c 4942 4358 585f 5553   ["-D_GLIBCXX_US
-0001d760: 455f 4358 5831 315f 4142 493d 2569 2220  E_CXX11_ABI=%i" 
-0001d770: 2520 2831 2069 6620 7365 6c66 2e75 7365  % (1 if self.use
-0001d780: 5f63 7878 3131 5f61 6269 2065 6c73 6520  _cxx11_abi else 
-0001d790: 3029 5d0a 2020 2020 2020 2020 636f 6d6d  0)].        comm
-0001d7a0: 6f6e 5f6f 7074 7320 2b3d 205b 222d 4425  on_opts += ["-D%
-0001d7b0: 733d 2573 2220 2520 6974 656d 2066 6f72  s=%s" % item for
-0001d7c0: 2069 7465 6d20 696e 2073 6f72 7465 6428   item in sorted(
-0001d7d0: 7365 6c66 2e63 5f6d 6163 726f 5f64 6566  self.c_macro_def
-0001d7e0: 696e 6573 2e69 7465 6d73 2829 295d 0a20  ines.items())]. 
-0001d7f0: 2020 2020 2020 2063 6f6d 6d6f 6e5f 6f70         common_op
-0001d800: 7473 202b 3d20 5b22 2d67 225d 0a20 2020  ts += ["-g"].   
-0001d810: 2020 2020 206f 7074 7320 3d20 636f 6d6d       opts = comm
-0001d820: 6f6e 5f6f 7074 7320 2b20 5b73 656c 662e  on_opts + [self.
-0001d830: 5f63 5f66 696c 656e 616d 652c 2022 2d6f  _c_filename, "-o
-0001d840: 222c 2073 656c 662e 5f73 6f5f 6669 6c65  ", self._so_file
-0001d850: 6e61 6d65 5d0a 2020 2020 2020 2020 6f70  name].        op
-0001d860: 7473 202b 3d20 6c69 7374 286d 6170 2873  ts += list(map(s
-0001d870: 656c 662e 5f74 7261 6e73 666f 726d 5f6c  elf._transform_l
-0001d880: 645f 666c 6167 2c20 7365 6c66 2e6c 645f  d_flag, self.ld_
-0001d890: 666c 6167 7329 290a 2020 2020 2020 2020  flags)).        
-0001d8a0: 636d 645f 6269 6e20 3d20 7365 6c66 2e5f  cmd_bin = self._
-0001d8b0: 6765 745f 636f 6d70 696c 6572 5f62 696e  get_compiler_bin
-0001d8c0: 2829 0a20 2020 2020 2020 2063 6d64 5f61  ().        cmd_a
-0001d8d0: 7267 7320 3d20 5b63 6d64 5f62 696e 5d20  rgs = [cmd_bin] 
-0001d8e0: 2b20 6f70 7473 0a20 2020 2020 2020 2066  + opts.        f
-0001d8f0: 726f 6d20 7375 6270 726f 6365 7373 2069  rom subprocess i
-0001d900: 6d70 6f72 7420 506f 7065 6e2c 2050 4950  mport Popen, PIP
-0001d910: 452c 2053 5444 4f55 542c 2043 616c 6c65  E, STDOUT, Calle
-0001d920: 6450 726f 6365 7373 4572 726f 720a 0a20  dProcessError.. 
-0001d930: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
-0001d940: 2063 616c 6c3a 2025 7322 2025 2028 7365   call: %s" % (se
-0001d950: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
-0001d960: 616d 655f 5f2c 2022 2022 2e6a 6f69 6e28  ame__, " ".join(
-0001d970: 636d 645f 6172 6773 2929 2c20 6669 6c65  cmd_args)), file
-0001d980: 3d73 656c 662e 5f6c 6f67 5f73 7472 6561  =self._log_strea
-0001d990: 6d29 0a20 2020 2020 2020 2070 726f 6320  m).        proc 
-0001d9a0: 3d20 506f 7065 6e28 636d 645f 6172 6773  = Popen(cmd_args
-0001d9b0: 2c20 6377 643d 7365 6c66 2e5f 6d6f 645f  , cwd=self._mod_
-0001d9c0: 7061 7468 2c20 7374 646f 7574 3d50 4950  path, stdout=PIP
-0001d9d0: 452c 2073 7464 6572 723d 5354 444f 5554  E, stderr=STDOUT
-0001d9e0: 290a 2020 2020 2020 2020 7374 646f 7574  ).        stdout
-0001d9f0: 2c20 7374 6465 7272 203d 2070 726f 632e  , stderr = proc.
-0001da00: 636f 6d6d 756e 6963 6174 6528 290a 2020  communicate().  
-0001da10: 2020 2020 2020 6173 7365 7274 2073 7464        assert std
-0001da20: 6572 7220 6973 204e 6f6e 6520 2023 2073  err is None  # s
-0001da30: 686f 756c 6420 6f6e 6c79 2068 6176 6520  hould only have 
-0001da40: 7374 646f 7574 0a20 2020 2020 2020 2069  stdout.        i
-0001da50: 6620 7072 6f63 2e72 6574 7572 6e63 6f64  f proc.returncod
-0001da60: 6520 213d 2030 3a0a 2020 2020 2020 2020  e != 0:.        
-0001da70: 2020 2020 7072 696e 7428 2225 733a 2025      print("%s: %
-0001da80: 7320 6661 696c 6564 2e22 2025 2028 7365  s failed." % (se
-0001da90: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
-0001daa0: 616d 655f 5f2c 2063 6d64 5f62 696e 2929  ame__, cmd_bin))
-0001dab0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001dac0: 6e74 2822 4f72 6967 696e 616c 2073 7464  nt("Original std
-0001dad0: 6f75 742f 7374 6465 7272 3a22 290a 2020  out/stderr:").  
-0001dae0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001daf0: 7374 646f 7574 2e64 6563 6f64 6528 2275  stdout.decode("u
-0001db00: 7466 3822 2929 0a20 2020 2020 2020 2020  tf8")).         
-0001db10: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
-0001db20: 2020 2020 2020 2069 6620 636d 645f 6269         if cmd_bi
-0001db30: 6e2e 656e 6473 7769 7468 2822 2f6e 7663  n.endswith("/nvc
-0001db40: 6322 2920 616e 6420 6222 6572 726f 723a  c") and b"error:
-0001db50: 2063 6f6e 7374 6578 7072 2066 756e 6374   constexpr funct
-0001db60: 696f 6e20 7265 7475 726e 2069 7320 6e6f  ion return is no
-0001db70: 6e2d 636f 6e73 7461 6e74 2220 696e 2073  n-constant" in s
-0001db80: 7464 6f75 743a 0a20 2020 2020 2020 2020  tdout:.         
-0001db90: 2020 2020 2020 2070 7269 6e74 2822 5468         print("Th
-0001dba0: 6973 206d 6967 6874 2062 6520 7468 6520  is might be the 
-0001dbb0: 6572 726f 723a 2068 7474 7073 3a2f 2f67  error: https://g
-0001dbc0: 6974 6875 622e 636f 6d2f 7465 6e73 6f72  ithub.com/tensor
-0001dbd0: 666c 6f77 2f74 656e 736f 7266 6c6f 772f  flow/tensorflow/
-0001dbe0: 6973 7375 6573 2f32 3237 3636 2229 0a20  issues/22766"). 
-0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001dc00: 7269 6e74 2829 0a20 2020 2020 2020 2020  rint().         
-0001dc10: 2020 2069 6620 636d 645f 6269 6e2e 656e     if cmd_bin.en
-0001dc20: 6473 7769 7468 2822 2f6e 7663 6322 2920  dswith("/nvcc") 
-0001dc30: 616e 6420 6222 6763 6320 7665 7273 696f  and b"gcc versio
-0001dc40: 6e73 206c 6174 6572 2074 6861 6e22 2069  ns later than" i
-0001dc50: 6e20 7374 646f 7574 3a0a 2020 2020 2020  n stdout:.      
-0001dc60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001dc70: 2259 6f75 7220 4743 4320 7665 7273 696f  "Your GCC versio
-0001dc80: 6e20 6d69 6768 7420 6265 2074 6f6f 206e  n might be too n
-0001dc90: 6577 2e20 5468 6973 2069 7320 6120 7072  ew. This is a pr
-0001dca0: 6f62 6c65 6d20 7769 7468 2073 6f6d 6520  oblem with some 
-0001dcb0: 6e76 6363 2076 6572 7369 6f6e 732e 2229  nvcc versions.")
-0001dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dcd0: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-0001dce0: 2020 2020 2072 6169 7365 2043 616c 6c65       raise Calle
-0001dcf0: 6450 726f 6365 7373 4572 726f 7228 7265  dProcessError(re
-0001dd00: 7475 726e 636f 6465 3d70 726f 632e 7265  turncode=proc.re
-0001dd10: 7475 726e 636f 6465 2c20 636d 643d 636d  turncode, cmd=cm
-0001dd20: 645f 6172 6773 290a 2020 2020 2020 2020  d_args).        
-0001dd30: 6173 7365 7274 206f 732e 7061 7468 2e65  assert os.path.e
-0001dd40: 7869 7374 7328 7365 6c66 2e5f 736f 5f66  xists(self._so_f
-0001dd50: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-0001dd60: 2077 6974 6820 6f70 656e 2822 2573 2f63   with open("%s/c
-0001dd70: 6f6d 7069 6c65 2e6c 6f67 2220 2520 7365  ompile.log" % se
-0001dd80: 6c66 2e5f 6d6f 645f 7061 7468 2c20 2277  lf._mod_path, "w
-0001dd90: 6222 2920 6173 2066 3a0a 2020 2020 2020  b") as f:.      
-0001dda0: 2020 2020 2020 6966 2073 656c 662e 7665        if self.ve
-0001ddb0: 7262 6f73 653a 0a20 2020 2020 2020 2020  rbose:.         
-0001ddc0: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
-0001ddd0: 3a20 7772 6974 6520 636f 6d70 696c 6520  : write compile 
-0001dde0: 6c6f 6720 746f 3a20 2573 2220 2520 2873  log to: %s" % (s
-0001ddf0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
-0001de00: 6e61 6d65 5f5f 2c20 662e 6e61 6d65 2929  name__, f.name))
-0001de10: 0a20 2020 2020 2020 2020 2020 2066 2e77  .            f.w
-0001de20: 7269 7465 2828 222b 2025 735c 6e22 2025  rite(("+ %s\n" %
-0001de30: 2022 2022 2e6a 6f69 6e28 636d 645f 6172   " ".join(cmd_ar
-0001de40: 6773 2929 2e65 6e63 6f64 6528 2275 7466  gs)).encode("utf
-0001de50: 3822 2929 0a20 2020 2020 2020 2020 2020  8")).           
-0001de60: 2066 2e77 7269 7465 2873 7464 6f75 7429   f.write(stdout)
-0001de70: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-0001de80: 6176 655f 696e 666f 2829 0a20 2020 2020  ave_info().     
-0001de90: 2020 2061 7373 6572 7420 6e6f 7420 7365     assert not se
-0001dea0: 6c66 2e5f 6e65 6564 5f72 6563 6f6d 7069  lf._need_recompi
-0001deb0: 6c65 2829 0a0a 2020 2020 6465 6620 6c6f  le()..    def lo
-0001dec0: 6164 5f6c 6962 5f63 7479 7065 7328 7365  ad_lib_ctypes(se
-0001ded0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001dee0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0001def0: 2063 7479 7065 732e 4344 4c4c 0a20 2020   ctypes.CDLL.   
-0001df00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001df10: 2069 6620 7365 6c66 2e5f 6374 7970 6573   if self._ctypes
-0001df20: 5f6c 6962 3a0a 2020 2020 2020 2020 2020  _lib:.          
-0001df30: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-0001df40: 7479 7065 735f 6c69 620a 2020 2020 2020  types_lib.      
-0001df50: 2020 7365 6c66 2e5f 6d61 7962 655f 636f    self._maybe_co
-0001df60: 6d70 696c 6528 290a 2020 2020 2020 2020  mpile().        
-0001df70: 696d 706f 7274 2063 7479 7065 730a 0a20  import ctypes.. 
-0001df80: 2020 2020 2020 2073 656c 662e 5f63 7479         self._cty
-0001df90: 7065 735f 6c69 6220 3d20 6374 7970 6573  pes_lib = ctypes
-0001dfa0: 2e63 646c 6c2e 4c6f 6164 4c69 6272 6172  .cdll.LoadLibrar
-0001dfb0: 7928 7365 6c66 2e5f 736f 5f66 696c 656e  y(self._so_filen
-0001dfc0: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
-0001dfd0: 7572 6e20 7365 6c66 2e5f 6374 7970 6573  urn self._ctypes
-0001dfe0: 5f6c 6962 0a0a 2020 2020 6465 6620 6765  _lib..    def ge
-0001dff0: 745f 6c69 625f 6669 6c65 6e61 6d65 2873  t_lib_filename(s
-0001e000: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0001e010: 220a 2020 2020 2020 2020 3a72 7479 7065  ".        :rtype
-0001e020: 3a20 7374 720a 2020 2020 2020 2020 2222  : str.        ""
-0001e030: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
-0001e040: 6d61 7962 655f 636f 6d70 696c 6528 290a  maybe_compile().
-0001e050: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001e060: 656c 662e 5f73 6f5f 6669 6c65 6e61 6d65  elf._so_filename
-0001e070: 0a0a 0a23 2053 6565 203a 6675 6e63 3a60  ...# See :func:`
-0001e080: 6d61 7962 655f 7265 7374 6172 745f 7265  maybe_restart_re
-0001e090: 7475 726e 6e5f 7769 7468 5f61 7466 6f72  turnn_with_atfor
-0001e0a0: 6b5f 7061 7463 6860 2062 656c 6f77 2066  k_patch` below f
-0001e0b0: 6f72 2077 6879 2079 6f75 206d 6967 6874  or why you might
-0001e0c0: 2077 616e 7420 746f 2075 7365 2074 6869   want to use thi
-0001e0d0: 732e 0a5f 635f 636f 6465 5f70 6174 6368  s.._c_code_patch
-0001e0e0: 5f61 7466 6f72 6b20 3d20 2222 220a 2364  _atfork = """.#d
-0001e0f0: 6566 696e 6520 5f47 4e55 5f53 4f55 5243  efine _GNU_SOURC
-0001e100: 450a 2369 6e63 6c75 6465 203c 7363 6865  E.#include <sche
-0001e110: 642e 683e 0a23 696e 636c 7564 6520 3c73  d.h>.#include <s
-0001e120: 6967 6e61 6c2e 683e 0a23 696e 636c 7564  ignal.h>.#includ
-0001e130: 6520 3c73 7973 2f73 7973 6361 6c6c 2e68  e <sys/syscall.h
-0001e140: 3e0a 2369 6e63 6c75 6465 203c 7374 6469  >.#include <stdi
-0001e150: 6f2e 683e 0a23 696e 636c 7564 6520 3c73  o.h>.#include <s
-0001e160: 7464 6c69 622e 683e 0a23 696e 636c 7564  tdlib.h>.#includ
-0001e170: 6520 3c75 6e69 7374 642e 683e 0a0a 2f2f  e <unistd.h>..//
-0001e180: 2068 7474 7073 3a2f 2f73 7461 636b 6f76   https://stackov
-0001e190: 6572 666c 6f77 2e63 6f6d 2f71 7565 7374  erflow.com/quest
-0001e1a0: 696f 6e73 2f34 3638 3435 3439 362f 6c64  ions/46845496/ld
-0001e1b0: 2d70 7265 6c6f 6164 2d61 6e64 2d6c 696e  -preload-and-lin
-0001e1c0: 6b61 6765 0a2f 2f20 6874 7470 733a 2f2f  kage.// https://
-0001e1d0: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
-0001e1e0: 6d2f 7175 6573 7469 6f6e 732f 3436 3831  m/questions/4681
-0001e1f0: 3035 3937 2f66 6f72 6b65 7865 632d 7769  0597/forkexec-wi
-0001e200: 7468 6f75 742d 6174 666f 726b 2d68 616e  thout-atfork-han
-0001e210: 646c 6572 730a 0a69 6e74 2070 7468 7265  dlers..int pthre
-0001e220: 6164 5f61 7466 6f72 6b28 766f 6964 2028  ad_atfork(void (
-0001e230: 2a70 7265 7061 7265 2928 766f 6964 292c  *prepare)(void),
-0001e240: 2076 6f69 6420 282a 7061 7265 6e74 2928   void (*parent)(
-0001e250: 766f 6964 292c 2076 6f69 6420 282a 6368  void), void (*ch
-0001e260: 696c 6429 2876 6f69 6429 2920 7b0a 2020  ild)(void)) {.  
-0001e270: 7072 696e 7466 2822 4967 6e6f 7269 6e67  printf("Ignoring
-0001e280: 2070 7468 7265 6164 5f61 7466 6f72 6b20   pthread_atfork 
-0001e290: 6361 6c6c 215c 5c6e 2229 3b0a 2020 6666  call!\\n");.  ff
-0001e2a0: 6c75 7368 2873 7464 6f75 7429 3b0a 2020  lush(stdout);.  
-0001e2b0: 7265 7475 726e 2030 3b0a 7d0a 0a69 6e74  return 0;.}..int
-0001e2c0: 205f 5f72 6567 6973 7465 725f 6174 666f   __register_atfo
-0001e2d0: 726b 2876 6f69 6420 282a 7072 6570 6172  rk(void (*prepar
-0001e2e0: 6529 2876 6f69 6429 2c20 766f 6964 2028  e)(void), void (
-0001e2f0: 2a70 6172 656e 7429 2876 6f69 6429 2c20  *parent)(void), 
-0001e300: 766f 6964 2028 2a63 6869 6c64 2928 766f  void (*child)(vo
-0001e310: 6964 2929 207b 0a20 2070 7269 6e74 6628  id)) {.  printf(
-0001e320: 2249 676e 6f72 696e 6720 5f5f 7265 6769  "Ignoring __regi
-0001e330: 7374 6572 5f61 7466 6f72 6b20 6361 6c6c  ster_atfork call
-0001e340: 215c 5c6e 2229 3b0a 2020 6666 6c75 7368  !\\n");.  fflush
-0001e350: 2873 7464 6f75 7429 3b0a 2020 7265 7475  (stdout);.  retu
-0001e360: 726e 2030 3b0a 7d0a 0a2f 2f20 416e 6f74  rn 0;.}..// Anot
-0001e370: 6865 7220 7761 7920 746f 2069 676e 6f72  her way to ignor
-0001e380: 6520 6174 666f 726b 2068 616e 646c 6572  e atfork handler
-0001e390: 733a 204f 7665 7272 6964 6520 666f 726b  s: Override fork
-0001e3a0: 2e0a 2369 6664 6566 205f 5f6c 696e 7578  ..#ifdef __linux
-0001e3b0: 5f5f 202f 2f20 6f6e 6c79 2077 6f72 6b73  __ // only works
-0001e3c0: 206f 6e20 4c69 6e75 7820 6375 7272 656e   on Linux curren
-0001e3d0: 746c 790a 7069 645f 7420 666f 726b 2876  tly.pid_t fork(v
-0001e3e0: 6f69 6429 207b 0a20 2072 6574 7572 6e20  oid) {.  return 
-0001e3f0: 7379 7363 616c 6c28 5359 535f 636c 6f6e  syscall(SYS_clon
-0001e400: 652c 2053 4947 4348 4c44 2c20 3029 3b0a  e, SIGCHLD, 0);.
-0001e410: 7d0a 2365 6e64 6966 0a0a 5f5f 6174 7472  }.#endif..__attr
-0001e420: 6962 7574 655f 5f28 2863 6f6e 7374 7275  ibute__((constru
-0001e430: 6374 6f72 2929 0a76 6f69 6420 7061 7463  ctor)).void patc
-0001e440: 685f 6174 666f 726b 5f69 6e69 7428 2920  h_atfork_init() 
-0001e450: 7b0a 2020 7365 7465 6e76 2822 5f5f 5245  {.  setenv("__RE
-0001e460: 5455 524e 4e5f 4154 464f 524b 5f50 4154  TURNN_ATFORK_PAT
-0001e470: 4348 4544 222c 2022 3122 2c20 3129 3b0a  CHED", "1", 1);.
-0001e480: 7d0a 2222 220a 0a0a 6465 6620 6765 745f  }."""...def get_
-0001e490: 7061 7463 685f 6174 666f 726b 5f6c 6962  patch_atfork_lib
-0001e4a0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-0001e4b0: 3a72 6574 7572 6e3a 2070 6174 6820 746f  :return: path to
-0001e4c0: 206f 7572 2070 6174 6368 5f61 7466 6f72   our patch_atfor
-0001e4d0: 6b20 6c69 622e 2073 6565 203a 6675 6e63  k lib. see :func
-0001e4e0: 3a60 6d61 7962 655f 7265 7374 6172 745f  :`maybe_restart_
-0001e4f0: 7265 7475 726e 6e5f 7769 7468 5f61 7466  returnn_with_atf
-0001e500: 6f72 6b5f 7061 7463 6860 0a20 2020 203a  ork_patch`.    :
-0001e510: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
-0001e520: 2222 0a20 2020 206e 6174 6976 6520 3d20  "".    native = 
-0001e530: 4e61 7469 7665 436f 6465 436f 6d70 696c  NativeCodeCompil
-0001e540: 6572 2862 6173 655f 6e61 6d65 3d22 7061  er(base_name="pa
-0001e550: 7463 685f 6174 666f 726b 222c 2063 6f64  tch_atfork", cod
-0001e560: 655f 7665 7273 696f 6e3d 322c 2063 6f64  e_version=2, cod
-0001e570: 653d 5f63 5f63 6f64 655f 7061 7463 685f  e=_c_code_patch_
-0001e580: 6174 666f 726b 2c20 6973 5f63 7070 3d46  atfork, is_cpp=F
-0001e590: 616c 7365 290a 2020 2020 666e 203d 206e  alse).    fn = n
-0001e5a0: 6174 6976 652e 6765 745f 6c69 625f 6669  ative.get_lib_fi
-0001e5b0: 6c65 6e61 6d65 2829 0a20 2020 2072 6574  lename().    ret
-0001e5c0: 7572 6e20 666e 0a0a 0a64 6566 2072 6573  urn fn...def res
-0001e5d0: 7461 7274 5f72 6574 7572 6e6e 2829 3a0a  tart_returnn():.
-0001e5e0: 2020 2020 2222 220a 2020 2020 5265 7374      """.    Rest
-0001e5f0: 6172 7473 2052 4554 5552 4e4e 2e0a 2020  arts RETURNN..  
-0001e600: 2020 2222 220a 2020 2020 6c6f 672e 666c    """.    log.fl
-0001e610: 7573 6828 290a 2020 2020 7379 732e 7374  ush().    sys.st
-0001e620: 646f 7574 2e66 6c75 7368 2829 0a20 2020  dout.flush().   
-0001e630: 2073 7973 2e73 7464 6572 722e 666c 7573   sys.stderr.flus
-0001e640: 6828 290a 2020 2020 2320 6874 7470 733a  h().    # https:
-0001e650: 2f2f 7374 6163 6b6f 7665 7266 6c6f 772e  //stackoverflow.
-0001e660: 636f 6d2f 7175 6573 7469 6f6e 732f 3732  com/questions/72
-0001e670: 3333 3539 3034 2f73 696d 706c 652d 7761  335904/simple-wa
-0001e680: 792d 746f 2d72 6573 7461 7274 2d61 7070  y-to-restart-app
-0001e690: 6c69 6361 7469 6f6e 0a20 2020 2063 6c6f  lication.    clo
-0001e6a0: 7365 5f61 6c6c 5f66 6473 5f65 7863 6570  se_all_fds_excep
-0001e6b0: 7428 7b30 2c20 312c 2032 7d29 0a20 2020  t({0, 1, 2}).   
-0001e6c0: 206f 732e 6578 6563 7628 7379 732e 6578   os.execv(sys.ex
-0001e6d0: 6563 7574 6162 6c65 2c20 5b73 7973 2e65  ecutable, [sys.e
-0001e6e0: 7865 6375 7461 626c 655d 202b 2073 7973  xecutable] + sys
-0001e6f0: 2e61 7267 7629 0a20 2020 2072 6169 7365  .argv).    raise
-0001e700: 2045 7863 6570 7469 6f6e 2822 7265 7374   Exception("rest
-0001e710: 6172 745f 7265 7475 726e 6e3a 2065 7865  art_returnn: exe
-0001e720: 6376 2066 6169 6c65 6422 290a 0a0a 6465  cv failed")...de
-0001e730: 6620 6d61 7962 655f 7265 7374 6172 745f  f maybe_restart_
-0001e740: 7265 7475 726e 6e5f 7769 7468 5f61 7466  returnn_with_atf
-0001e750: 6f72 6b5f 7061 7463 6828 293a 0a20 2020  ork_patch():.   
-0001e760: 2022 2222 0a20 2020 2057 6861 7420 7765   """.    What we
-0001e770: 2077 616e 743a 2073 7562 7072 6f63 6573   want: subproces
-0001e780: 732e 506f 7065 6e20 746f 2061 6c77 6179  s.Popen to alway
-0001e790: 7320 776f 726b 2e0a 2020 2020 5072 6f62  s work..    Prob
-0001e7a0: 6c65 6d3a 2049 7420 7573 6573 2066 6f72  lem: It uses for
-0001e7b0: 6b2b 6578 6563 2069 6e74 6572 6e61 6c6c  k+exec internall
-0001e7c0: 7920 696e 2073 7562 7072 6f63 6573 735f  y in subprocess_
-0001e7d0: 666f 726b 5f65 7865 632c 2076 6961 205f  fork_exec, via _
-0001e7e0: 706f 7369 7873 7562 7072 6f63 6573 732e  posixsubprocess.
-0001e7f0: 666f 726b 5f65 7865 632e 0a20 2020 2054  fork_exec..    T
-0001e800: 6861 7420 6973 2061 2070 726f 626c 656d  hat is a problem
-0001e810: 2062 6563 6175 7365 2066 6f72 6b20 6361   because fork ca
-0001e820: 6e20 7472 6967 6765 7220 616e 7920 6174  n trigger any at
-0001e830: 666f 726b 2068 616e 646c 6572 7320 7265  fork handlers re
-0001e840: 6769 7374 6572 6564 2076 6961 2070 7468  gistered via pth
-0001e850: 7265 6164 5f61 7466 6f72 6b2c 0a20 2020  read_atfork,.   
-0001e860: 2061 6e64 2074 686f 7365 2063 616e 2063   and those can c
-0001e870: 7261 7368 2f64 6561 646c 6f63 6b20 696e  rash/deadlock in
-0001e880: 2073 6f6d 6520 6361 7365 732e 0a0a 2020   some cases...  
-0001e890: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-0001e8a0: 2e63 6f6d 2f74 656e 736f 7266 6c6f 772f  .com/tensorflow/
-0001e8b0: 7465 6e73 6f72 666c 6f77 2f69 7373 7565  tensorflow/issue
-0001e8c0: 732f 3133 3830 320a 2020 2020 6874 7470  s/13802.    http
-0001e8d0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f78  s://github.com/x
-0001e8e0: 6961 6e79 692f 4f70 656e 424c 4153 2f69  ianyi/OpenBLAS/i
-0001e8f0: 7373 7565 732f 3234 300a 2020 2020 6874  ssues/240.    ht
-0001e900: 7470 733a 2f2f 7472 6163 2e73 6167 656d  tps://trac.sagem
-0001e910: 6174 682e 6f72 672f 7469 636b 6574 2f32  ath.org/ticket/2
-0001e920: 3230 3231 0a20 2020 2068 7474 7073 3a2f  2021.    https:/
-0001e930: 2f62 7567 732e 7079 7468 6f6e 2e6f 7267  /bugs.python.org
-0001e940: 2f69 7373 7565 3331 3831 340a 2020 2020  /issue31814.    
-0001e950: 6874 7470 733a 2f2f 7374 6163 6b6f 7665  https://stackove
-0001e960: 7266 6c6f 772e 636f 6d2f 7175 6573 7469  rflow.com/questi
-0001e970: 6f6e 732f 3436 3834 3534 3936 2f6c 642d  ons/46845496/ld-
-0001e980: 7072 656c 6f61 642d 616e 642d 6c69 6e6b  preload-and-link
-0001e990: 6167 650a 2020 2020 6874 7470 733a 2f2f  age.    https://
-0001e9a0: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
-0001e9b0: 6d2f 7175 6573 7469 6f6e 732f 3436 3831  m/questions/4681
-0001e9c0: 3035 3937 2f66 6f72 6b65 7865 632d 7769  0597/forkexec-wi
-0001e9d0: 7468 6f75 742d 6174 666f 726b 2d68 616e  thout-atfork-han
-0001e9e0: 646c 6572 730a 0a20 2020 2054 6865 2073  dlers..    The s
-0001e9f0: 6f6c 7574 696f 6e20 6865 7265 3a20 4a75  olution here: Ju
-0001ea00: 7374 206f 7665 7272 6964 6520 7074 6872  st override pthr
-0001ea10: 6561 645f 6174 666f 726b 2c20 7669 6120  ead_atfork, via 
-0001ea20: 4c44 5f50 5245 4c4f 4144 2e0a 2020 2020  LD_PRELOAD..    
-0001ea30: 4e6f 7465 2074 6861 7420 696e 2073 6f6d  Note that in som
-0001ea40: 6520 6361 7365 732c 2074 6869 7320 6973  e cases, this is
-0001ea50: 206e 6f74 2065 6e6f 7567 6820 2873 6565   not enough (see
-0001ea60: 2074 6865 2053 4f20 6469 7363 7573 7369   the SO discussi
-0001ea70: 6f6e 292c 0a20 2020 2073 6f20 7765 2061  on),.    so we a
-0001ea80: 6c73 6f20 6f76 6572 7772 6974 6520 666f  lso overwrite fo
-0001ea90: 726b 2069 7473 656c 662e 0a20 2020 2053  rk itself..    S
-0001eaa0: 6565 2061 6c73 6f20 7465 7374 732f 7465  ee also tests/te
-0001eab0: 7374 5f66 6f72 6b5f 6578 6563 2e70 7920  st_fork_exec.py 
-0001eac0: 666f 7220 6120 6465 6d6f 2e0a 2020 2020  for a demo..    
-0001ead0: 2222 220a 2020 2020 6966 206f 732e 656e  """.    if os.en
-0001eae0: 7669 726f 6e2e 6765 7428 225f 5f52 4554  viron.get("__RET
-0001eaf0: 5552 4e4e 5f41 5446 4f52 4b5f 5041 5443  URNN_ATFORK_PATC
-0001eb00: 4845 4422 2920 3d3d 2022 3122 3a0a 2020  HED") == "1":.  
-0001eb10: 2020 2020 2020 7072 696e 7428 2252 756e        print("Run
-0001eb20: 6e69 6e67 2077 6974 6820 7061 7463 6865  ning with patche
-0001eb30: 6420 6174 666f 726b 2e22 290a 2020 2020  d atfork.").    
-0001eb40: 2020 2020 7265 7475 726e 0a20 2020 2069      return.    i
-0001eb50: 6620 6f73 2e65 6e76 6972 6f6e 2e67 6574  f os.environ.get
-0001eb60: 2822 5f5f 5245 5455 524e 4e5f 5452 595f  ("__RETURNN_TRY_
-0001eb70: 4154 464f 524b 5f50 4154 4348 4544 2229  ATFORK_PATCHED")
-0001eb80: 203d 3d20 2231 223a 0a20 2020 2020 2020   == "1":.       
-0001eb90: 2070 7269 6e74 2822 5061 7463 6869 6e67   print("Patching
-0001eba0: 2061 7466 6f72 6b20 6469 6420 6e6f 7420   atfork did not 
-0001ebb0: 776f 726b 2120 5769 6c6c 2063 6f6e 7469  work! Will conti
-0001ebc0: 6e75 6520 616e 7977 6179 2e22 290a 2020  nue anyway.").  
-0001ebd0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0001ebe0: 206c 6962 203d 2067 6574 5f70 6174 6368   lib = get_patch
-0001ebf0: 5f61 7466 6f72 6b5f 6c69 6228 290a 2020  _atfork_lib().  
-0001ec00: 2020 656e 7620 3d20 6f73 2e65 6e76 6972    env = os.envir
-0001ec10: 6f6e 2e63 6f70 7928 290a 2020 2020 656e  on.copy().    en
-0001ec20: 765b 2244 594c 445f 494e 5345 5254 5f4c  v["DYLD_INSERT_L
-0001ec30: 4942 5241 5249 4553 2220 6966 2073 7973  IBRARIES" if sys
-0001ec40: 2e70 6c61 7466 6f72 6d20 3d3d 2022 6461  .platform == "da
-0001ec50: 7277 696e 2220 656c 7365 2022 4c44 5f50  rwin" else "LD_P
-0001ec60: 5245 4c4f 4144 225d 203d 206c 6962 0a20  RELOAD"] = lib. 
-0001ec70: 2020 2065 6e76 5b22 5f5f 5245 5455 524e     env["__RETURN
-0001ec80: 4e5f 5452 595f 4154 464f 524b 5f50 4154  N_TRY_ATFORK_PAT
-0001ec90: 4348 4544 225d 203d 2022 3122 0a20 2020  CHED"] = "1".   
-0001eca0: 2070 7269 6e74 2822 5265 7374 6172 7469   print("Restarti
-0001ecb0: 6e67 2052 6574 7572 6e6e 2077 6974 6820  ng Returnn with 
-0001ecc0: 6174 666f 726b 2070 6174 6368 2e2e 2e22  atfork patch..."
-0001ecd0: 2c20 7379 732e 6578 6563 7574 6162 6c65  , sys.executable
-0001ece0: 2c20 7379 732e 6172 6776 290a 2020 2020  , sys.argv).    
-0001ecf0: 7379 732e 7374 646f 7574 2e66 6c75 7368  sys.stdout.flush
-0001ed00: 2829 0a20 2020 206f 732e 6578 6563 7670  ().    os.execvp
-0001ed10: 6528 7379 732e 6578 6563 7574 6162 6c65  e(sys.executable
-0001ed20: 2c20 5b73 7973 2e65 7865 6375 7461 626c  , [sys.executabl
-0001ed30: 655d 202b 2073 7973 2e61 7267 762c 2065  e] + sys.argv, e
-0001ed40: 6e76 290a 2020 2020 7072 696e 7428 2265  nv).    print("e
-0001ed50: 7865 6376 7065 2064 6964 206e 6f74 2077  xecvpe did not w
-0001ed60: 6f72 6b3f 2229 0a0a 0a64 6566 2063 6c6f  ork?")...def clo
-0001ed70: 7365 5f61 6c6c 5f66 6473 5f65 7863 6570  se_all_fds_excep
-0001ed80: 7428 6578 6365 7074 5f66 6473 293a 0a20  t(except_fds):. 
-0001ed90: 2020 2022 2222 0a20 2020 2043 616c 6c73     """.    Calls
-0001eda0: 206f 732e 636c 6f73 6572 616e 6765 2065   os.closerange e
-0001edb0: 7863 6570 7420 666f 7220 7468 6520 6769  xcept for the gi
-0001edc0: 7665 6e20 6664 732e 0a20 2020 2043 6f64  ven fds..    Cod
-0001edd0: 6520 6164 6f70 7465 6420 616e 6420 6578  e adopted and ex
-0001ede0: 7465 6e64 6564 2066 726f 6d20 6d75 6c74  tended from mult
-0001edf0: 6970 726f 6365 7373 696e 672e 7574 696c  iprocessing.util
-0001ee00: 2e63 6c6f 7365 5f61 6c6c 5f66 6473 5f65  .close_all_fds_e
-0001ee10: 7863 6570 742e 0a0a 2020 2020 3a70 6172  xcept...    :par
-0001ee20: 616d 2074 7970 696e 672e 436f 6c6c 6563  am typing.Collec
-0001ee30: 7469 6f6e 5b69 6e74 5d20 6578 6365 7074  tion[int] except
-0001ee40: 5f66 6473 3a20 7573 7561 6c6c 7920 6174  _fds: usually at
-0001ee50: 206c 6561 7374 207b 302c 312c 327d 0a20   least {0,1,2}. 
-0001ee60: 2020 2022 2222 0a20 2020 2023 206e 6f69     """.    # noi
-0001ee70: 6e73 7065 6374 696f 6e20 5079 4272 6f61  nspection PyBroa
-0001ee80: 6445 7863 6570 7469 6f6e 0a20 2020 2074  dException.    t
-0001ee90: 7279 3a0a 2020 2020 2020 2020 6d61 785f  ry:.        max_
-0001eea0: 6664 203d 206f 732e 7379 7363 6f6e 6628  fd = os.sysconf(
-0001eeb0: 2253 435f 4f50 454e 5f4d 4158 2229 0a20  "SC_OPEN_MAX"). 
-0001eec0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0001eed0: 696f 6e3a 0a20 2020 2020 2020 206d 6178  ion:.        max
-0001eee0: 5f66 6420 3d20 3235 360a 0a20 2020 2065  _fd = 256..    e
-0001eef0: 7863 6570 745f 6664 7320 3d20 736f 7274  xcept_fds = sort
-0001ef00: 6564 286c 6973 7428 6578 6365 7074 5f66  ed(list(except_f
-0001ef10: 6473 2920 2b20 5b2d 312c 206d 6178 5f66  ds) + [-1, max_f
-0001ef20: 645d 290a 2020 2020 6173 7365 7274 2065  d]).    assert e
-0001ef30: 7863 6570 745f 6664 735b 305d 203d 3d20  xcept_fds[0] == 
-0001ef40: 2d31 2061 6e64 2065 7863 6570 745f 6664  -1 and except_fd
-0001ef50: 735b 2d31 5d20 3d3d 206d 6178 5f66 642c  s[-1] == max_fd,
-0001ef60: 2022 6664 2069 6e76 616c 6964 220a 0a20   "fd invalid".. 
-0001ef70: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0001ef80: 6528 6c65 6e28 6578 6365 7074 5f66 6473  e(len(except_fds
-0001ef90: 2920 2d20 3129 3a0a 2020 2020 2020 2020  ) - 1):.        
-0001efa0: 6966 2065 7863 6570 745f 6664 735b 695d  if except_fds[i]
-0001efb0: 202b 2031 203c 2065 7863 6570 745f 6664   + 1 < except_fd
-0001efc0: 735b 6920 2b20 315d 3a0a 2020 2020 2020  s[i + 1]:.      
-0001efd0: 2020 2020 2020 6f73 2e63 6c6f 7365 7261        os.closera
-0001efe0: 6e67 6528 6578 6365 7074 5f66 6473 5b69  nge(except_fds[i
-0001eff0: 5d20 2b20 312c 2065 7863 6570 745f 6664  ] + 1, except_fd
-0001f000: 735b 6920 2b20 315d 290a 0a0a 636c 6173  s[i + 1])...clas
-0001f010: 7320 5374 6174 733a 0a20 2020 2022 2222  s Stats:.    """
-0001f020: 0a20 2020 2043 6f6c 6c65 6374 7320 6d65  .    Collects me
-0001f030: 616e 2061 6e64 2076 6172 6961 6e63 652c  an and variance,
-0001f040: 2072 756e 6e69 6e67 2061 7665 7261 6765   running average
-0001f050: 2e0a 0a20 2020 2068 7474 7073 3a2f 2f65  ...    https://e
-0001f060: 6e2e 7769 6b69 7065 6469 612e 6f72 672f  n.wikipedia.org/
-0001f070: 7769 6b69 2f41 6c67 6f72 6974 686d 735f  wiki/Algorithms_
-0001f080: 666f 725f 6361 6c63 756c 6174 696e 675f  for_calculating_
-0001f090: 7661 7269 616e 6365 0a20 2020 2022 2222  variance.    """
-0001f0a0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0001f0b0: 5f5f 2873 656c 662c 2066 6f72 6d61 745f  __(self, format_
-0001f0c0: 7374 723d 4e6f 6e65 293a 0a20 2020 2020  str=None):.     
-0001f0d0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-0001f0e0: 7061 7261 6d20 4e6f 6e65 7c28 2866 6c6f  param None|((flo
-0001f0f0: 6174 7c6e 756d 7079 2e6e 6461 7272 6179  at|numpy.ndarray
-0001f100: 292d 3e73 7472 2920 666f 726d 6174 5f73  )->str) format_s
-0001f110: 7472 3a0a 2020 2020 2020 2020 2222 220a  tr:.        """.
-0001f120: 2020 2020 2020 2020 7365 6c66 2e66 6f72          self.for
-0001f130: 6d61 745f 7374 7220 3d20 666f 726d 6174  mat_str = format
-0001f140: 5f73 7472 206f 7220 7374 720a 2020 2020  _str or str.    
-0001f150: 2020 2020 7365 6c66 2e6d 6561 6e20 3d20      self.mean = 
-0001f160: 302e 300a 2020 2020 2020 2020 7365 6c66  0.0.        self
-0001f170: 2e6d 6561 6e5f 7371 203d 2030 2e30 0a20  .mean_sq = 0.0. 
-0001f180: 2020 2020 2020 2073 656c 662e 7661 7220         self.var 
-0001f190: 3d20 302e 300a 2020 2020 2020 2020 7365  = 0.0.        se
-0001f1a0: 6c66 2e6d 696e 203d 204e 6f6e 650a 2020  lf.min = None.  
-0001f1b0: 2020 2020 2020 7365 6c66 2e6d 6178 203d        self.max =
-0001f1c0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-0001f1d0: 6c66 2e74 6f74 616c 5f64 6174 615f 6c65  lf.total_data_le
-0001f1e0: 6e20 3d20 300a 2020 2020 2020 2020 7365  n = 0.        se
-0001f1f0: 6c66 2e6e 756d 5f73 6571 7320 3d20 300a  lf.num_seqs = 0.
-0001f200: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
-0001f210: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001f220: 6966 2073 656c 662e 6e75 6d5f 7365 7173  if self.num_seqs
-0001f230: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0001f240: 2020 6966 2073 656c 662e 6e75 6d5f 7365    if self.num_se
-0001f250: 7173 203d 3d20 7365 6c66 2e74 6f74 616c  qs == self.total
-0001f260: 5f64 6174 615f 6c65 6e3a 0a20 2020 2020  _data_len:.     
-0001f270: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-0001f280: 5f73 7472 203d 2022 6176 675f 6461 7461  _str = "avg_data
-0001f290: 5f6c 656e 3d31 220a 2020 2020 2020 2020  _len=1".        
-0001f2a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001f2b0: 2020 2020 2020 2020 2020 6578 7472 615f            extra_
-0001f2c0: 7374 7220 3d20 2274 6f74 616c 5f64 6174  str = "total_dat
-0001f2d0: 615f 6c65 6e3d 2569 2c20 6176 675f 6461  a_len=%i, avg_da
-0001f2e0: 7461 5f6c 656e 3d25 6622 2025 2028 0a20  ta_len=%f" % (. 
-0001f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f300: 2020 2073 656c 662e 746f 7461 6c5f 6461     self.total_da
-0001f310: 7461 5f6c 656e 2c0a 2020 2020 2020 2020  ta_len,.        
-0001f320: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
-0001f330: 7428 7365 6c66 2e74 6f74 616c 5f64 6174  t(self.total_dat
-0001f340: 615f 6c65 6e29 202f 2073 656c 662e 6e75  a_len) / self.nu
-0001f350: 6d5f 7365 7173 2c0a 2020 2020 2020 2020  m_seqs,.        
-0001f360: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001f370: 2020 2020 2020 7265 7475 726e 2022 5374        return "St
-0001f380: 6174 7328 6d65 616e 3d25 732c 2073 7464  ats(mean=%s, std
-0001f390: 5f64 6576 3d25 732c 206d 696e 3d25 732c  _dev=%s, min=%s,
-0001f3a0: 206d 6178 3d25 732c 206e 756d 5f73 6571   max=%s, num_seq
-0001f3b0: 733d 2569 2c20 2573 2922 2025 2028 0a20  s=%i, %s)" % (. 
-0001f3c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f3d0: 656c 662e 666f 726d 6174 5f73 7472 2873  elf.format_str(s
-0001f3e0: 656c 662e 6765 745f 6d65 616e 2829 292c  elf.get_mean()),
-0001f3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f400: 2073 656c 662e 666f 726d 6174 5f73 7472   self.format_str
-0001f410: 2873 656c 662e 6765 745f 7374 645f 6465  (self.get_std_de
-0001f420: 7628 2929 2c0a 2020 2020 2020 2020 2020  v()),.          
-0001f430: 2020 2020 2020 7365 6c66 2e66 6f72 6d61        self.forma
-0001f440: 745f 7374 7228 7365 6c66 2e6d 696e 292c  t_str(self.min),
-0001f450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f460: 2073 656c 662e 666f 726d 6174 5f73 7472   self.format_str
-0001f470: 2873 656c 662e 6d61 7829 2c0a 2020 2020  (self.max),.    
-0001f480: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001f490: 2e6e 756d 5f73 6571 732c 0a20 2020 2020  .num_seqs,.     
-0001f4a0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-0001f4b0: 5f73 7472 2c0a 2020 2020 2020 2020 2020  _str,.          
-0001f4c0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0001f4d0: 726e 2022 5374 6174 7328 6e75 6d5f 7365  rn "Stats(num_se
-0001f4e0: 7173 3d30 2922 0a0a 2020 2020 6465 6620  qs=0)"..    def 
-0001f4f0: 636f 6c6c 6563 7428 7365 6c66 2c20 6461  collect(self, da
-0001f500: 7461 293a 0a20 2020 2020 2020 2022 2222  ta):.        """
-0001f510: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001f520: 6e75 6d70 792e 6e64 6172 7261 797c 6c69  numpy.ndarray|li
-0001f530: 7374 5b69 6e74 5d7c 6c69 7374 5b66 6c6f  st[int]|list[flo
-0001f540: 6174 5d20 6461 7461 3a20 7368 6170 6520  at] data: shape 
-0001f550: 2874 696d 652c 2064 696d 2920 6f72 2028  (time, dim) or (
-0001f560: 7469 6d65 2c29 0a20 2020 2020 2020 2022  time,).        "
-0001f570: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
-0001f580: 7420 6e75 6d70 790a 0a20 2020 2020 2020  t numpy..       
-0001f590: 2069 6620 6973 696e 7374 616e 6365 2864   if isinstance(d
-0001f5a0: 6174 612c 2028 6c69 7374 2c20 7475 706c  ata, (list, tupl
-0001f5b0: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
-0001f5c0: 2064 6174 6120 3d20 6e75 6d70 792e 6172   data = numpy.ar
-0001f5d0: 7261 7928 6461 7461 290a 2020 2020 2020  ray(data).      
-0001f5e0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-0001f5f0: 6e63 6528 6461 7461 2c20 6e75 6d70 792e  nce(data, numpy.
-0001f600: 6e64 6172 7261 7929 0a20 2020 2020 2020  ndarray).       
-0001f610: 2061 7373 6572 7420 6461 7461 2e6e 6469   assert data.ndi
-0001f620: 6d20 3e3d 2031 0a20 2020 2020 2020 2069  m >= 1.        i
-0001f630: 6620 6461 7461 2e73 6861 7065 5b30 5d20  f data.shape[0] 
-0001f640: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0001f650: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-0001f660: 2073 656c 662e 6e75 6d5f 7365 7173 202b   self.num_seqs +
-0001f670: 3d20 310a 2020 2020 2020 2020 6461 7461  = 1.        data
-0001f680: 5f6d 696e 203d 206e 756d 7079 2e6d 696e  _min = numpy.min
-0001f690: 2864 6174 612c 2061 7869 733d 3029 0a20  (data, axis=0). 
-0001f6a0: 2020 2020 2020 2064 6174 615f 6d61 7820         data_max 
-0001f6b0: 3d20 6e75 6d70 792e 6d61 7828 6461 7461  = numpy.max(data
-0001f6c0: 2c20 6178 6973 3d30 290a 2020 2020 2020  , axis=0).      
-0001f6d0: 2020 6966 2073 656c 662e 6d69 6e20 6973    if self.min is
-0001f6e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001f6f0: 2020 2073 656c 662e 6d69 6e20 3d20 6461     self.min = da
-0001f700: 7461 5f6d 696e 0a20 2020 2020 2020 2020  ta_min.         
-0001f710: 2020 2073 656c 662e 6d61 7820 3d20 6461     self.max = da
-0001f720: 7461 5f6d 6178 0a20 2020 2020 2020 2065  ta_max.        e
-0001f730: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001f740: 2073 656c 662e 6d69 6e20 3d20 6e75 6d70   self.min = nump
-0001f750: 792e 6d69 6e69 6d75 6d28 7365 6c66 2e6d  y.minimum(self.m
-0001f760: 696e 2c20 6461 7461 5f6d 696e 290a 2020  in, data_min).  
-0001f770: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0001f780: 6178 203d 206e 756d 7079 2e6d 6178 696d  ax = numpy.maxim
-0001f790: 756d 2873 656c 662e 6d61 782c 2064 6174  um(self.max, dat
-0001f7a0: 615f 6d61 7829 0a20 2020 2020 2020 206e  a_max).        n
-0001f7b0: 6577 5f74 6f74 616c 5f64 6174 615f 6c65  ew_total_data_le
-0001f7c0: 6e20 3d20 7365 6c66 2e74 6f74 616c 5f64  n = self.total_d
-0001f7d0: 6174 615f 6c65 6e20 2b20 6461 7461 2e73  ata_len + data.s
-0001f7e0: 6861 7065 5b30 5d0a 2020 2020 2020 2020  hape[0].        
-0001f7f0: 6d65 616e 5f64 6966 6620 3d20 6e75 6d70  mean_diff = nump
-0001f800: 792e 6d65 616e 2864 6174 612c 2061 7869  y.mean(data, axi
-0001f810: 733d 3029 202d 2073 656c 662e 6d65 616e  s=0) - self.mean
-0001f820: 0a20 2020 2020 2020 206d 5f61 203d 2073  .        m_a = s
-0001f830: 656c 662e 7661 7220 2a20 7365 6c66 2e74  elf.var * self.t
-0001f840: 6f74 616c 5f64 6174 615f 6c65 6e0a 2020  otal_data_len.  
-0001f850: 2020 2020 2020 6d5f 6220 3d20 6e75 6d70        m_b = nump
-0001f860: 792e 7661 7228 6461 7461 2c20 6178 6973  y.var(data, axis
-0001f870: 3d30 2920 2a20 6461 7461 2e73 6861 7065  =0) * data.shape
-0001f880: 5b30 5d0a 2020 2020 2020 2020 6d32 203d  [0].        m2 =
-0001f890: 206d 5f61 202b 206d 5f62 202b 206d 6561   m_a + m_b + mea
-0001f8a0: 6e5f 6469 6666 2a2a 3220 2a20 7365 6c66  n_diff**2 * self
-0001f8b0: 2e74 6f74 616c 5f64 6174 615f 6c65 6e20  .total_data_len 
-0001f8c0: 2a20 6461 7461 2e73 6861 7065 5b30 5d20  * data.shape[0] 
-0001f8d0: 2f20 6e65 775f 746f 7461 6c5f 6461 7461  / new_total_data
-0001f8e0: 5f6c 656e 0a20 2020 2020 2020 2073 656c  _len.        sel
-0001f8f0: 662e 7661 7220 3d20 6d32 202f 206e 6577  f.var = m2 / new
-0001f900: 5f74 6f74 616c 5f64 6174 615f 6c65 6e0a  _total_data_len.
-0001f910: 2020 2020 2020 2020 6461 7461 5f73 756d          data_sum
-0001f920: 203d 206e 756d 7079 2e73 756d 2864 6174   = numpy.sum(dat
-0001f930: 612c 2061 7869 733d 3029 0a20 2020 2020  a, axis=0).     
-0001f940: 2020 2064 656c 7461 203d 2064 6174 615f     delta = data_
-0001f950: 7375 6d20 2d20 7365 6c66 2e6d 6561 6e20  sum - self.mean 
-0001f960: 2a20 6461 7461 2e73 6861 7065 5b30 5d0a  * data.shape[0].
-0001f970: 2020 2020 2020 2020 7365 6c66 2e6d 6561          self.mea
-0001f980: 6e20 2b3d 2064 656c 7461 202f 206e 6577  n += delta / new
-0001f990: 5f74 6f74 616c 5f64 6174 615f 6c65 6e0a  _total_data_len.
-0001f9a0: 2020 2020 2020 2020 6465 6c74 615f 7371          delta_sq
-0001f9b0: 203d 206e 756d 7079 2e73 756d 2864 6174   = numpy.sum(dat
-0001f9c0: 6120 2a20 6461 7461 2c20 6178 6973 3d30  a * data, axis=0
-0001f9d0: 2920 2d20 7365 6c66 2e6d 6561 6e5f 7371  ) - self.mean_sq
-0001f9e0: 202a 2064 6174 612e 7368 6170 655b 305d   * data.shape[0]
-0001f9f0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-0001fa00: 616e 5f73 7120 2b3d 2064 656c 7461 5f73  an_sq += delta_s
-0001fa10: 7120 2f20 6e65 775f 746f 7461 6c5f 6461  q / new_total_da
-0001fa20: 7461 5f6c 656e 0a20 2020 2020 2020 2073  ta_len.        s
-0001fa30: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
-0001fa40: 656e 203d 206e 6577 5f74 6f74 616c 5f64  en = new_total_d
-0001fa50: 6174 615f 6c65 6e0a 0a20 2020 2064 6566  ata_len..    def
-0001fa60: 2067 6574 5f6d 6561 6e28 7365 6c66 293a   get_mean(self):
-0001fa70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001fa80: 2020 2020 203a 7265 7475 726e 3a20 6d65       :return: me
-0001fa90: 616e 2c20 7368 6170 6520 2864 696d 2c29  an, shape (dim,)
-0001faa0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0001fab0: 206e 756d 7079 2e6e 6461 7272 6179 0a20   numpy.ndarray. 
-0001fac0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001fad0: 2020 2061 7373 6572 7420 7365 6c66 2e6e     assert self.n
-0001fae0: 756d 5f73 6571 7320 3e20 300a 2020 2020  um_seqs > 0.    
-0001faf0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001fb00: 6d65 616e 0a0a 2020 2020 6465 6620 6765  mean..    def ge
-0001fb10: 745f 7374 645f 6465 7628 7365 6c66 293a  t_std_dev(self):
-0001fb20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001fb30: 2020 2020 203a 7265 7475 726e 3a20 7374       :return: st
-0001fb40: 6420 6465 762c 2073 6861 7065 2028 6469  d dev, shape (di
-0001fb50: 6d2c 290a 2020 2020 2020 2020 3a72 7479  m,).        :rty
-0001fb60: 7065 3a20 6e75 6d70 792e 6e64 6172 7261  pe: numpy.ndarra
-0001fb70: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-0001fb80: 2020 2020 2020 696d 706f 7274 206e 756d        import num
-0001fb90: 7079 0a0a 2020 2020 2020 2020 6173 7365  py..        asse
-0001fba0: 7274 2073 656c 662e 6e75 6d5f 7365 7173  rt self.num_seqs
-0001fbb0: 203e 2030 0a20 2020 2020 2020 2072 6574   > 0.        ret
-0001fbc0: 7572 6e20 6e75 6d70 792e 7371 7274 2873  urn numpy.sqrt(s
-0001fbd0: 656c 662e 7661 7229 0a20 2020 2020 2020  elf.var).       
-0001fbe0: 2023 2072 6574 7572 6e20 6e75 6d70 792e   # return numpy.
-0001fbf0: 7371 7274 2873 656c 662e 6d65 616e 5f73  sqrt(self.mean_s
-0001fc00: 7120 2d20 7365 6c66 2e6d 6561 6e20 2a20  q - self.mean * 
-0001fc10: 7365 6c66 2e6d 6561 6e29 0a0a 2020 2020  self.mean)..    
-0001fc20: 6465 6620 6475 6d70 2873 656c 662c 206f  def dump(self, o
-0001fc30: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
-0001fc40: 783d 4e6f 6e65 2c20 7374 7265 616d 3d4e  x=None, stream=N
-0001fc50: 6f6e 652c 2073 7472 6561 6d5f 7072 6566  one, stream_pref
-0001fc60: 6978 3d22 2229 3a0a 2020 2020 2020 2020  ix=""):.        
-0001fc70: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-0001fc80: 616d 2073 7472 7c4e 6f6e 6520 6f75 7470  am str|None outp
-0001fc90: 7574 5f66 696c 655f 7072 6566 6978 3a20  ut_file_prefix: 
-0001fca0: 6966 2067 6976 656e 2c20 7769 6c6c 206e  if given, will n
-0001fcb0: 756d 7079 2e73 6176 6574 7874 206d 6561  umpy.savetxt mea
-0001fcc0: 6e7c 7374 645f 6465 7620 746f 2064 6973  n|std_dev to dis
-0001fcd0: 6b0a 2020 2020 2020 2020 3a70 6172 616d  k.        :param
-0001fce0: 2073 7472 2073 7472 6561 6d5f 7072 6566   str stream_pref
-0001fcf0: 6978 3a0a 2020 2020 2020 2020 3a70 6172  ix:.        :par
-0001fd00: 616d 2069 6f2e 5465 7874 494f 4261 7365  am io.TextIOBase
-0001fd10: 2073 7472 6561 6d3a 2073 7973 2e73 7464   stream: sys.std
-0001fd20: 6f75 7420 6279 2064 6566 6175 6c74 0a20  out by default. 
-0001fd30: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001fd40: 2020 2069 6620 7374 7265 616d 2069 7320     if stream is 
-0001fd50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001fd60: 2020 7374 7265 616d 203d 2073 7973 2e73    stream = sys.s
-0001fd70: 7464 6f75 740a 2020 2020 2020 2020 696d  tdout.        im
-0001fd80: 706f 7274 206e 756d 7079 0a0a 2020 2020  port numpy..    
-0001fd90: 2020 2020 7072 696e 7428 2225 7353 7461      print("%sSta
-0001fda0: 7473 3a22 2025 2073 7472 6561 6d5f 7072  ts:" % stream_pr
-0001fdb0: 6566 6978 2c20 6669 6c65 3d73 7472 6561  efix, file=strea
-0001fdc0: 6d29 0a20 2020 2020 2020 2069 6620 7365  m).        if se
-0001fdd0: 6c66 2e6e 756d 5f73 6571 7320 213d 2073  lf.num_seqs != s
-0001fde0: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
-0001fdf0: 656e 3a0a 2020 2020 2020 2020 2020 2020  en:.            
-0001fe00: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0001fe10: 2020 2020 2020 2022 2020 2569 2073 6571         "  %i seq
-0001fe20: 732c 2025 6920 746f 7461 6c20 6672 616d  s, %i total fram
-0001fe30: 6573 2c20 2566 2061 7665 7261 6765 2066  es, %f average f
-0001fe40: 7261 6d65 7322 0a20 2020 2020 2020 2020  rames".         
-0001fe50: 2020 2020 2020 2025 2028 7365 6c66 2e6e         % (self.n
-0001fe60: 756d 5f73 6571 732c 2073 656c 662e 746f  um_seqs, self.to
-0001fe70: 7461 6c5f 6461 7461 5f6c 656e 2c20 7365  tal_data_len, se
-0001fe80: 6c66 2e74 6f74 616c 5f64 6174 615f 6c65  lf.total_data_le
-0001fe90: 6e20 2f20 666c 6f61 7428 7365 6c66 2e6e  n / float(self.n
-0001fea0: 756d 5f73 6571 7329 292c 0a20 2020 2020  um_seqs)),.     
-0001feb0: 2020 2020 2020 2020 2020 2066 696c 653d             file=
-0001fec0: 7374 7265 616d 2c0a 2020 2020 2020 2020  stream,.        
-0001fed0: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-0001fee0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001fef0: 7072 696e 7428 2220 2025 6920 7365 7173  print("  %i seqs
-0001ff00: 2220 2520 2873 656c 662e 6e75 6d5f 7365  " % (self.num_se
-0001ff10: 7173 2c29 2c20 6669 6c65 3d73 7472 6561  qs,), file=strea
-0001ff20: 6d29 0a20 2020 2020 2020 2070 7269 6e74  m).        print
-0001ff30: 2822 2020 4d65 616e 3a20 2573 2220 2520  ("  Mean: %s" % 
-0001ff40: 2873 656c 662e 666f 726d 6174 5f73 7472  (self.format_str
-0001ff50: 2873 656c 662e 6765 745f 6d65 616e 2829  (self.get_mean()
-0001ff60: 292c 292c 2066 696c 653d 7374 7265 616d  ),), file=stream
-0001ff70: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0001ff80: 2220 2053 7464 2064 6576 3a20 2573 2220  "  Std dev: %s" 
-0001ff90: 2520 2873 656c 662e 666f 726d 6174 5f73  % (self.format_s
-0001ffa0: 7472 2873 656c 662e 6765 745f 7374 645f  tr(self.get_std_
-0001ffb0: 6465 7628 2929 2c29 2c20 6669 6c65 3d73  dev()),), file=s
-0001ffc0: 7472 6561 6d29 0a20 2020 2020 2020 2070  tream).        p
-0001ffd0: 7269 6e74 2822 2020 4d69 6e2f 6d61 783a  rint("  Min/max:
-0001ffe0: 2025 7320 2f20 2573 2220 2520 2873 656c   %s / %s" % (sel
-0001fff0: 662e 666f 726d 6174 5f73 7472 2873 656c  f.format_str(sel
-00020000: 662e 6d69 6e29 2c20 7365 6c66 2e66 6f72  f.min), self.for
-00020010: 6d61 745f 7374 7228 7365 6c66 2e6d 6178  mat_str(self.max
-00020020: 2929 2c20 6669 6c65 3d73 7472 6561 6d29  )), file=stream)
-00020030: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
-00020040: 2822 5374 6420 6465 7620 286e 6169 7665  ("Std dev (naive
-00020050: 293a 2025 7322 2025 206e 756d 7079 2e73  ): %s" % numpy.s
-00020060: 7172 7428 7365 6c66 2e6d 6561 6e5f 7371  qrt(self.mean_sq
-00020070: 202d 2073 656c 662e 6d65 616e 202a 2073   - self.mean * s
-00020080: 656c 662e 6d65 616e 292c 2066 696c 653d  elf.mean), file=
-00020090: 7374 7265 616d 290a 2020 2020 2020 2020  stream).        
-000200a0: 6966 206f 7574 7075 745f 6669 6c65 5f70  if output_file_p
-000200b0: 7265 6669 783a 0a20 2020 2020 2020 2020  refix:.         
-000200c0: 2020 2070 7269 6e74 2822 2020 5772 6974     print("  Writ
-000200d0: 6520 6d65 616e 2f73 7464 2d64 6576 2074  e mean/std-dev t
-000200e0: 6f20 2573 2e28 6d65 616e 7c73 7464 5f64  o %s.(mean|std_d
-000200f0: 6576 292e 7478 742e 2220 2520 286f 7574  ev).txt." % (out
-00020100: 7075 745f 6669 6c65 5f70 7265 6669 782c  put_file_prefix,
-00020110: 292c 2066 696c 653d 7374 7265 616d 290a  ), file=stream).
-00020120: 2020 2020 2020 2020 2020 2020 6e75 6d70              nump
-00020130: 792e 7361 7665 7478 7428 2225 732e 6d65  y.savetxt("%s.me
-00020140: 616e 2e74 7874 2220 2520 6f75 7470 7574  an.txt" % output
-00020150: 5f66 696c 655f 7072 6566 6978 2c20 7365  _file_prefix, se
-00020160: 6c66 2e67 6574 5f6d 6561 6e28 2929 0a20  lf.get_mean()). 
-00020170: 2020 2020 2020 2020 2020 206e 756d 7079             numpy
-00020180: 2e73 6176 6574 7874 2822 2573 2e73 7464  .savetxt("%s.std
-00020190: 5f64 6576 2e74 7874 2220 2520 6f75 7470  _dev.txt" % outp
-000201a0: 7574 5f66 696c 655f 7072 6566 6978 2c20  ut_file_prefix, 
-000201b0: 7365 6c66 2e67 6574 5f73 7464 5f64 6576  self.get_std_dev
-000201c0: 2829 290a 0a0a 6465 6620 6973 5f6e 616d  ())...def is_nam
-000201d0: 6564 7475 706c 6528 636c 7329 3a0a 2020  edtuple(cls):.  
-000201e0: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
-000201f0: 2054 2063 6c73 3a20 7475 706c 652c 206c   T cls: tuple, l
-00020200: 6973 7420 6f72 206e 616d 6564 7475 706c  ist or namedtupl
-00020210: 6520 7479 7065 0a20 2020 203a 7265 7475  e type.    :retu
-00020220: 726e 3a20 7768 6574 6865 7220 636c 7320  rn: whether cls 
-00020230: 6973 2061 206e 616d 6564 7475 706c 6520  is a namedtuple 
-00020240: 7479 7065 0a20 2020 203a 7274 7970 653a  type.    :rtype:
-00020250: 2062 6f6f 6c0a 2020 2020 2222 220a 2020   bool.    """.  
-00020260: 2020 7265 7475 726e 2069 7373 7562 636c    return issubcl
-00020270: 6173 7328 636c 732c 2074 7570 6c65 2920  ass(cls, tuple) 
-00020280: 616e 6420 636c 7320 6973 206e 6f74 2074  and cls is not t
-00020290: 7570 6c65 0a0a 0a64 6566 206d 616b 655f  uple...def make_
-000202a0: 7365 715f 6f66 5f74 7970 6528 636c 732c  seq_of_type(cls,
-000202b0: 2073 6571 293a 0a20 2020 2022 2222 0a20   seq):.    """. 
-000202c0: 2020 203a 7061 7261 6d20 7479 7065 5b54     :param type[T
-000202d0: 5d20 636c 733a 2065 2e67 2e20 7475 706c  ] cls: e.g. tupl
-000202e0: 652c 206c 6973 7420 6f72 206e 616d 6564  e, list or named
-000202f0: 7475 706c 650a 2020 2020 3a70 6172 616d  tuple.    :param
-00020300: 206c 6973 747c 7475 706c 657c 5420 7365   list|tuple|T se
-00020310: 713a 0a20 2020 203a 7265 7475 726e 3a20  q:.    :return: 
-00020320: 636c 7328 7365 7129 206f 7220 636c 7328  cls(seq) or cls(
-00020330: 2a73 6571 290a 2020 2020 3a72 7479 7065  *seq).    :rtype
-00020340: 3a20 547c 6c69 7374 7c74 7570 6c65 0a20  : T|list|tuple. 
-00020350: 2020 2022 2222 0a20 2020 2061 7373 6572     """.    asser
-00020360: 7420 6973 7375 6263 6c61 7373 2863 6c73  t issubclass(cls
-00020370: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00020380: 0a20 2020 2069 6620 6973 5f6e 616d 6564  .    if is_named
-00020390: 7475 706c 6528 636c 7329 3a0a 2020 2020  tuple(cls):.    
-000203a0: 2020 2020 7265 7475 726e 2063 6c73 282a      return cls(*
-000203b0: 7365 7129 2020 2320 6e6f 7161 0a20 2020  seq)  # noqa.   
-000203c0: 2072 6574 7572 6e20 636c 7328 7365 7129   return cls(seq)
-000203d0: 2020 2320 6e6f 7161 0a0a 0a64 6566 2065    # noqa...def e
-000203e0: 6e73 7572 655f 6c69 7374 5f6f 665f 7479  nsure_list_of_ty
-000203f0: 7065 286c 732c 2074 7970 655f 293a 0a20  pe(ls, type_):. 
-00020400: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00020410: 6d20 6c69 7374 206c 733a 0a20 2020 203a  m list ls:.    :
-00020420: 7061 7261 6d20 2828 292d 3e54 297c 7479  param (()->T)|ty
-00020430: 7065 5b54 5d20 7479 7065 5f3a 2074 7970  pe[T] type_: typ
-00020440: 6520 6f66 2069 6e73 7461 6e63 6573 206f  e of instances o
-00020450: 6620 606c 7360 2e0a 2020 2020 2020 4e6f  f `ls`..      No
-00020460: 7465 2074 6865 2073 7472 616e 6765 2074  te the strange t
-00020470: 7970 6520 6865 7265 2069 6e20 7468 6520  ype here in the 
-00020480: 646f 6373 7472 696e 6720 6973 2064 7565  docstring is due
-00020490: 2074 6f20 736f 6d65 2050 7943 6861 726d   to some PyCharm
-000204a0: 2074 7970 6520 696e 6665 7265 6e63 6520   type inference 
-000204b0: 7072 6f62 6c65 6d73 0a20 2020 2020 2028  problems.      (
-000204c0: 6874 7470 733a 2f2f 796f 7574 7261 636b  https://youtrack
-000204d0: 2e6a 6574 6272 6169 6e73 2e63 6f6d 2f69  .jetbrains.com/i
-000204e0: 7373 7565 2f50 592d 3530 3832 3829 2e0a  ssue/PY-50828)..
-000204f0: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
-00020500: 5b54 5d0a 2020 2020 2222 220a 2020 2020  [T].    """.    
-00020510: 6173 7365 7274 2061 6c6c 2869 7369 6e73  assert all(isins
-00020520: 7461 6e63 6528 656c 656d 2c20 7479 7065  tance(elem, type
-00020530: 5f29 2066 6f72 2065 6c65 6d20 696e 206c  _) for elem in l
-00020540: 7329 0a20 2020 2072 6574 7572 6e20 6c73  s).    return ls
-00020550: 0a0a 0a40 636f 6e74 6578 746c 6962 2e63  ...@contextlib.c
-00020560: 6f6e 7465 7874 6d61 6e61 6765 720a 6465  ontextmanager.de
-00020570: 6620 6475 6d6d 795f 6e6f 6f70 5f63 7478  f dummy_noop_ctx
-00020580: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00020590: 5072 6f76 6964 6573 2061 206e 6f2d 6f70  Provides a no-op
-000205a0: 2063 6f6e 7465 7874 206d 616e 6167 6572   context manager
-000205b0: 2e0a 2020 2020 2222 220a 2020 2020 7969  ..    """.    yi
-000205c0: 656c 6420 4e6f 6e65 0a0a 0a64 6566 205f  eld None...def _
-000205d0: 6765 745f 6e67 7261 6d73 2873 6567 6d65  get_ngrams(segme
-000205e0: 6e74 2c20 6d61 785f 6f72 6465 7229 3a0a  nt, max_order):.
-000205f0: 2020 2020 2222 2245 7874 7261 6374 7320      """Extracts 
-00020600: 616c 6c20 6e2d 6772 616d 7320 7570 746f  all n-grams upto
-00020610: 2061 2067 6976 656e 206d 6178 696d 756d   a given maximum
-00020620: 206f 7264 6572 2066 726f 6d20 616e 2069   order from an i
-00020630: 6e70 7574 2073 6567 6d65 6e74 2e0a 2020  nput segment..  
-00020640: 2020 436f 6465 2061 6461 7074 6564 2066    Code adapted f
-00020650: 726f 6d20 476f 6f67 6c65 2054 656e 736f  rom Google Tenso
-00020660: 7232 5465 6e73 6f72 2e0a 0a20 2020 2041  r2Tensor...    A
-00020670: 7267 733a 0a20 2020 2020 2073 6567 6d65  rgs:.      segme
-00020680: 6e74 2028 6c69 7374 5b69 6e74 5d7c 6c69  nt (list[int]|li
-00020690: 7374 5b73 7472 5d29 3a20 7465 7874 2073  st[str]): text s
-000206a0: 6567 6d65 6e74 2066 726f 6d20 7768 6963  egment from whic
-000206b0: 6820 6e2d 6772 616d 7320 7769 6c6c 2062  h n-grams will b
-000206c0: 6520 6578 7472 6163 7465 642e 0a20 2020  e extracted..   
-000206d0: 2020 206d 6178 5f6f 7264 6572 2028 696e     max_order (in
-000206e0: 7429 3a20 6d61 7869 6d75 6d20 6c65 6e67  t): maximum leng
-000206f0: 7468 2069 6e20 746f 6b65 6e73 206f 6620  th in tokens of 
-00020700: 7468 6520 6e2d 6772 616d 7320 7265 7475  the n-grams retu
-00020710: 726e 6564 2062 7920 7468 6973 0a20 2020  rned by this.   
-00020720: 2020 2020 2020 206d 6574 686f 6473 2e0a         methods..
-00020730: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
-00020740: 2020 2020 5468 6520 436f 756e 7465 7220      The Counter 
-00020750: 636f 6e74 6169 6e69 6e67 2061 6c6c 206e  containing all n
-00020760: 2d67 7261 6d73 2075 7074 6f20 6d61 785f  -grams upto max_
-00020770: 6f72 6465 7220 696e 2073 6567 6d65 6e74  order in segment
-00020780: 0a20 2020 2020 2077 6974 6820 6120 636f  .      with a co
-00020790: 756e 7420 6f66 2068 6f77 206d 616e 7920  unt of how many 
-000207a0: 7469 6d65 7320 6561 6368 206e 2d67 7261  times each n-gra
-000207b0: 6d20 6f63 6375 7272 6564 2e0a 2020 2020  m occurred..    
-000207c0: 2222 220a 2020 2020 696d 706f 7274 2063  """.    import c
-000207d0: 6f6c 6c65 6374 696f 6e73 0a0a 2020 2020  ollections..    
-000207e0: 6e67 7261 6d5f 636f 756e 7473 203d 2063  ngram_counts = c
-000207f0: 6f6c 6c65 6374 696f 6e73 2e43 6f75 6e74  ollections.Count
-00020800: 6572 2829 0a20 2020 2066 6f72 206f 7264  er().    for ord
-00020810: 6572 2069 6e20 7261 6e67 6528 312c 206d  er in range(1, m
-00020820: 6178 5f6f 7264 6572 202b 2031 293a 0a20  ax_order + 1):. 
-00020830: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00020840: 7261 6e67 6528 302c 206c 656e 2873 6567  range(0, len(seg
-00020850: 6d65 6e74 2920 2d20 6f72 6465 7220 2b20  ment) - order + 
-00020860: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-00020870: 6e67 7261 6d20 3d20 7475 706c 6528 7365  ngram = tuple(se
-00020880: 676d 656e 745b 6920 3a20 6920 2b20 6f72  gment[i : i + or
-00020890: 6465 725d 290a 2020 2020 2020 2020 2020  der]).          
-000208a0: 2020 6e67 7261 6d5f 636f 756e 7473 5b6e    ngram_counts[n
-000208b0: 6772 616d 5d20 2b3d 2031 0a20 2020 2072  gram] += 1.    r
-000208c0: 6574 7572 6e20 6e67 7261 6d5f 636f 756e  eturn ngram_coun
-000208d0: 7473 0a0a 0a64 6566 2063 6f6d 7075 7465  ts...def compute
-000208e0: 5f62 6c65 7528 7265 6665 7265 6e63 655f  _bleu(reference_
-000208f0: 636f 7270 7573 2c20 7472 616e 736c 6174  corpus, translat
-00020900: 696f 6e5f 636f 7270 7573 2c20 6d61 785f  ion_corpus, max_
-00020910: 6f72 6465 723d 342c 2075 7365 5f62 703d  order=4, use_bp=
-00020920: 5472 7565 293a 0a20 2020 2022 2222 436f  True):.    """Co
-00020930: 6d70 7574 6573 2042 4c45 5520 7363 6f72  mputes BLEU scor
-00020940: 6520 6f66 2074 7261 6e73 6c61 7465 6420  e of translated 
-00020950: 7365 676d 656e 7473 2061 6761 696e 7374  segments against
-00020960: 206f 6e65 206f 7220 6d6f 7265 2072 6566   one or more ref
-00020970: 6572 656e 6365 732e 0a20 2020 2043 6f64  erences..    Cod
-00020980: 6520 6164 6170 7465 6420 6672 6f6d 2047  e adapted from G
-00020990: 6f6f 676c 6520 5465 6e73 6f72 3254 656e  oogle Tensor2Ten
-000209a0: 736f 722e 0a0a 2020 2020 4172 6773 3a0a  sor...    Args:.
-000209b0: 2020 2020 2020 7265 6665 7265 6e63 655f        reference_
-000209c0: 636f 7270 7573 2028 6c69 7374 5b6c 6973  corpus (list[lis
-000209d0: 745b 696e 745d 7c6c 6973 745b 7374 725d  t[int]|list[str]
-000209e0: 5d29 3a20 6c69 7374 206f 6620 7265 6665  ]): list of refe
-000209f0: 7265 6e63 6573 2066 6f72 2065 6163 6820  rences for each 
-00020a00: 7472 616e 736c 6174 696f 6e2e 2045 6163  translation. Eac
-00020a10: 680a 2020 2020 2020 2020 2020 7265 6665  h.          refe
-00020a20: 7265 6e63 6520 7368 6f75 6c64 2062 6520  rence should be 
-00020a30: 746f 6b65 6e69 7a65 6420 696e 746f 2061  tokenized into a
-00020a40: 206c 6973 7420 6f66 2074 6f6b 656e 732e   list of tokens.
-00020a50: 0a20 2020 2020 2074 7261 6e73 6c61 7469  .      translati
-00020a60: 6f6e 5f63 6f72 7075 7320 286c 6973 745b  on_corpus (list[
-00020a70: 6c69 7374 5b69 6e74 5d7c 6c69 7374 5b73  list[int]|list[s
-00020a80: 7472 5d5d 293a 206c 6973 7420 6f66 2074  tr]]): list of t
-00020a90: 7261 6e73 6c61 7469 6f6e 7320 746f 2073  ranslations to s
-00020aa0: 636f 7265 2e20 4561 6368 2074 7261 6e73  core. Each trans
-00020ab0: 6c61 7469 6f6e 0a20 2020 2020 2020 2020  lation.         
-00020ac0: 2073 686f 756c 6420 6265 2074 6f6b 656e   should be token
-00020ad0: 697a 6564 2069 6e74 6f20 6120 6c69 7374  ized into a list
-00020ae0: 206f 6620 746f 6b65 6e73 2e0a 2020 2020   of tokens..    
-00020af0: 2020 6d61 785f 6f72 6465 7220 2869 6e74    max_order (int
-00020b00: 293a 204d 6178 696d 756d 206e 2d67 7261  ): Maximum n-gra
-00020b10: 6d20 6f72 6465 7220 746f 2075 7365 2077  m order to use w
-00020b20: 6865 6e20 636f 6d70 7574 696e 6720 424c  hen computing BL
-00020b30: 4555 2073 636f 7265 2e0a 2020 2020 2020  EU score..      
-00020b40: 7573 655f 6270 2028 626f 6f6c 293a 2062  use_bp (bool): b
-00020b50: 6f6f 6c65 616e 2c20 7768 6574 6865 7220  oolean, whether 
-00020b60: 746f 2061 7070 6c79 2062 7265 7669 7479  to apply brevity
-00020b70: 2070 656e 616c 7479 2e0a 0a20 2020 2052   penalty...    R
-00020b80: 6574 7572 6e73 3a0a 2020 2020 2020 424c  eturns:.      BL
-00020b90: 4555 2073 636f 7265 2e0a 2020 2020 2222  EU score..    ""
-00020ba0: 220a 2020 2020 696d 706f 7274 206d 6174  ".    import mat
-00020bb0: 680a 0a20 2020 2072 6566 6572 656e 6365  h..    reference
-00020bc0: 5f6c 656e 6774 6820 3d20 300a 2020 2020  _length = 0.    
-00020bd0: 7472 616e 736c 6174 696f 6e5f 6c65 6e67  translation_leng
-00020be0: 7468 203d 2030 0a20 2020 2062 7020 3d20  th = 0.    bp = 
-00020bf0: 312e 300a 2020 2020 6765 6f5f 6d65 616e  1.0.    geo_mean
-00020c00: 203d 2030 0a0a 2020 2020 6d61 7463 6865   = 0..    matche
-00020c10: 735f 6279 5f6f 7264 6572 203d 205b 305d  s_by_order = [0]
-00020c20: 202a 206d 6178 5f6f 7264 6572 0a20 2020   * max_order.   
-00020c30: 2070 6f73 7369 626c 655f 6d61 7463 6865   possible_matche
-00020c40: 735f 6279 5f6f 7264 6572 203d 205b 305d  s_by_order = [0]
-00020c50: 202a 206d 6178 5f6f 7264 6572 0a0a 2020   * max_order..  
-00020c60: 2020 666f 7220 2872 6566 6572 656e 6365    for (reference
-00020c70: 732c 2074 7261 6e73 6c61 7469 6f6e 7329  s, translations)
-00020c80: 2069 6e20 7a69 7028 7265 6665 7265 6e63   in zip(referenc
-00020c90: 655f 636f 7270 7573 2c20 7472 616e 736c  e_corpus, transl
-00020ca0: 6174 696f 6e5f 636f 7270 7573 293a 0a20  ation_corpus):. 
-00020cb0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00020cc0: 5f6c 656e 6774 6820 2b3d 206c 656e 2872  _length += len(r
-00020cd0: 6566 6572 656e 6365 7329 0a20 2020 2020  eferences).     
-00020ce0: 2020 2074 7261 6e73 6c61 7469 6f6e 5f6c     translation_l
-00020cf0: 656e 6774 6820 2b3d 206c 656e 2874 7261  ength += len(tra
-00020d00: 6e73 6c61 7469 6f6e 7329 0a20 2020 2020  nslations).     
-00020d10: 2020 2072 6566 5f6e 6772 616d 5f63 6f75     ref_ngram_cou
-00020d20: 6e74 7320 3d20 5f67 6574 5f6e 6772 616d  nts = _get_ngram
-00020d30: 7328 7265 6665 7265 6e63 6573 2c20 6d61  s(references, ma
-00020d40: 785f 6f72 6465 7229 0a20 2020 2020 2020  x_order).       
-00020d50: 2074 7261 6e73 6c61 7469 6f6e 5f6e 6772   translation_ngr
-00020d60: 616d 5f63 6f75 6e74 7320 3d20 5f67 6574  am_counts = _get
-00020d70: 5f6e 6772 616d 7328 7472 616e 736c 6174  _ngrams(translat
-00020d80: 696f 6e73 2c20 6d61 785f 6f72 6465 7229  ions, max_order)
-00020d90: 0a0a 2020 2020 2020 2020 6f76 6572 6c61  ..        overla
-00020da0: 7020 3d20 7b6e 6772 616d 3a20 6d69 6e28  p = {ngram: min(
-00020db0: 636f 756e 742c 2074 7261 6e73 6c61 7469  count, translati
-00020dc0: 6f6e 5f6e 6772 616d 5f63 6f75 6e74 735b  on_ngram_counts[
-00020dd0: 6e67 7261 6d5d 2920 666f 7220 6e67 7261  ngram]) for ngra
-00020de0: 6d2c 2063 6f75 6e74 2069 6e20 7265 665f  m, count in ref_
-00020df0: 6e67 7261 6d5f 636f 756e 7473 2e69 7465  ngram_counts.ite
-00020e00: 6d73 2829 7d0a 0a20 2020 2020 2020 2066  ms()}..        f
-00020e10: 6f72 206e 6772 616d 2069 6e20 6f76 6572  or ngram in over
-00020e20: 6c61 703a 0a20 2020 2020 2020 2020 2020  lap:.           
-00020e30: 206d 6174 6368 6573 5f62 795f 6f72 6465   matches_by_orde
-00020e40: 725b 6c65 6e28 6e67 7261 6d29 202d 2031  r[len(ngram) - 1
-00020e50: 5d20 2b3d 206f 7665 726c 6170 5b6e 6772  ] += overlap[ngr
-00020e60: 616d 5d0a 2020 2020 2020 2020 666f 7220  am].        for 
-00020e70: 6e67 7261 6d20 696e 2074 7261 6e73 6c61  ngram in transla
-00020e80: 7469 6f6e 5f6e 6772 616d 5f63 6f75 6e74  tion_ngram_count
-00020e90: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00020ea0: 6f73 7369 626c 655f 6d61 7463 6865 735f  ossible_matches_
-00020eb0: 6279 5f6f 7264 6572 5b6c 656e 286e 6772  by_order[len(ngr
-00020ec0: 616d 2920 2d20 315d 202b 3d20 7472 616e  am) - 1] += tran
-00020ed0: 736c 6174 696f 6e5f 6e67 7261 6d5f 636f  slation_ngram_co
-00020ee0: 756e 7473 5b6e 6772 616d 5d0a 0a20 2020  unts[ngram]..   
-00020ef0: 2070 7265 6369 7369 6f6e 7320 3d20 5b30   precisions = [0
-00020f00: 2e30 5d20 2a20 6d61 785f 6f72 6465 720a  .0] * max_order.
-00020f10: 2020 2020 736d 6f6f 7468 203d 2031 2e30      smooth = 1.0
-00020f20: 0a20 2020 2066 6f72 2069 2069 6e20 7261  .    for i in ra
-00020f30: 6e67 6528 302c 206d 6178 5f6f 7264 6572  nge(0, max_order
-00020f40: 293a 0a20 2020 2020 2020 2069 6620 706f  ):.        if po
-00020f50: 7373 6962 6c65 5f6d 6174 6368 6573 5f62  ssible_matches_b
-00020f60: 795f 6f72 6465 725b 695d 203e 2030 3a0a  y_order[i] > 0:.
-00020f70: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-00020f80: 6973 696f 6e73 5b69 5d20 3d20 6d61 7463  isions[i] = matc
-00020f90: 6865 735f 6279 5f6f 7264 6572 5b69 5d20  hes_by_order[i] 
-00020fa0: 2f20 706f 7373 6962 6c65 5f6d 6174 6368  / possible_match
-00020fb0: 6573 5f62 795f 6f72 6465 725b 695d 0a20  es_by_order[i]. 
-00020fc0: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
-00020fd0: 7463 6865 735f 6279 5f6f 7264 6572 5b69  tches_by_order[i
-00020fe0: 5d20 3e20 303a 0a20 2020 2020 2020 2020  ] > 0:.         
-00020ff0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00021000: 735b 695d 203d 206d 6174 6368 6573 5f62  s[i] = matches_b
-00021010: 795f 6f72 6465 725b 695d 202f 2070 6f73  y_order[i] / pos
-00021020: 7369 626c 655f 6d61 7463 6865 735f 6279  sible_matches_by
-00021030: 5f6f 7264 6572 5b69 5d0a 2020 2020 2020  _order[i].      
-00021040: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00021050: 2020 2020 2020 2020 2020 2020 736d 6f6f              smoo
-00021060: 7468 202a 3d20 320a 2020 2020 2020 2020  th *= 2.        
-00021070: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-00021080: 6e73 5b69 5d20 3d20 312e 3020 2f20 2873  ns[i] = 1.0 / (s
-00021090: 6d6f 6f74 6820 2a20 706f 7373 6962 6c65  mooth * possible
-000210a0: 5f6d 6174 6368 6573 5f62 795f 6f72 6465  _matches_by_orde
-000210b0: 725b 695d 290a 2020 2020 2020 2020 656c  r[i]).        el
-000210c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000210d0: 7072 6563 6973 696f 6e73 5b69 5d20 3d20  precisions[i] = 
-000210e0: 302e 300a 0a20 2020 2069 6620 6d61 7828  0.0..    if max(
-000210f0: 7072 6563 6973 696f 6e73 2920 3e20 303a  precisions) > 0:
-00021100: 0a20 2020 2020 2020 2070 5f6c 6f67 5f73  .        p_log_s
-00021110: 756d 203d 2073 756d 286d 6174 682e 6c6f  um = sum(math.lo
-00021120: 6728 7029 2066 6f72 2070 2069 6e20 7072  g(p) for p in pr
-00021130: 6563 6973 696f 6e73 2069 6620 7029 0a20  ecisions if p). 
-00021140: 2020 2020 2020 2067 656f 5f6d 6561 6e20         geo_mean 
-00021150: 3d20 6d61 7468 2e65 7870 2870 5f6c 6f67  = math.exp(p_log
-00021160: 5f73 756d 202f 206d 6178 5f6f 7264 6572  _sum / max_order
-00021170: 290a 0a20 2020 2069 6620 7573 655f 6270  )..    if use_bp
-00021180: 3a0a 2020 2020 2020 2020 7261 7469 6f20  :.        ratio 
-00021190: 3d20 7472 616e 736c 6174 696f 6e5f 6c65  = translation_le
-000211a0: 6e67 7468 202f 2072 6566 6572 656e 6365  ngth / reference
-000211b0: 5f6c 656e 6774 680a 2020 2020 2020 2020  _length.        
-000211c0: 6966 2072 6174 696f 203c 2031 652d 3330  if ratio < 1e-30
-000211d0: 3a0a 2020 2020 2020 2020 2020 2020 6270  :.            bp
-000211e0: 203d 2030 2e30 0a20 2020 2020 2020 2065   = 0.0.        e
-000211f0: 6c69 6620 7261 7469 6f20 3c20 312e 303a  lif ratio < 1.0:
-00021200: 0a20 2020 2020 2020 2020 2020 2062 7020  .            bp 
-00021210: 3d20 6d61 7468 2e65 7870 2831 202d 2031  = math.exp(1 - 1
-00021220: 2e30 202f 2072 6174 696f 290a 2020 2020  .0 / ratio).    
-00021230: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00021240: 2020 2020 2020 6270 203d 2031 2e30 0a20        bp = 1.0. 
-00021250: 2020 2062 6c65 7520 3d20 6765 6f5f 6d65     bleu = geo_me
-00021260: 616e 202a 2062 700a 2020 2020 7265 7475  an * bp.    retu
-00021270: 726e 206e 702e 666c 6f61 7433 3228 626c  rn np.float32(bl
-00021280: 6575 290a 0a0a 2320 6e6f 696e 7370 6563  eu)...# noinspec
-00021290: 7469 6f6e 2050 7950 6163 6b61 6765 5265  tion PyPackageRe
-000212a0: 7175 6972 656d 656e 7473 0a64 6566 206d  quirements.def m
-000212b0: 6f6e 6b65 7966 6978 5f67 6c69 6228 293a  onkeyfix_glib():
-000212c0: 0a20 2020 2022 2222 0a20 2020 2046 6978  .    """.    Fix
-000212d0: 6573 2073 6f6d 6520 7374 7570 6964 2062  es some stupid b
-000212e0: 7567 7320 7375 6368 2074 6861 7420 5349  ugs such that SI
-000212f0: 4749 4e54 2069 7320 6e6f 7420 776f 726b  GINT is not work
-00021300: 696e 672e 0a20 2020 2054 6869 7320 6973  ing..    This is
-00021310: 2075 7365 6420 6279 2061 7564 696f 7265   used by audiore
-00021320: 6164 2c20 616e 6420 696e 6469 7265 6374  ad, and indirect
-00021330: 6c79 2062 7920 6c69 6272 6f73 6120 666f  ly by librosa fo
-00021340: 7220 6c6f 6164 696e 6720 6175 6469 6f2e  r loading audio.
-00021350: 0a20 2020 2068 7474 7073 3a2f 2f73 7461  .    https://sta
-00021360: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
-00021370: 7565 7374 696f 6e73 2f31 3634 3130 3835  uestions/1641085
-00021380: 322f 0a20 2020 2053 6565 2061 6c73 6f20  2/.    See also 
-00021390: 3a66 756e 633a 606d 6f6e 6b65 7970 6174  :func:`monkeypat
-000213a0: 6368 5f61 7564 696f 7265 6164 602e 0a20  ch_audioread`.. 
-000213b0: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
-000213c0: 2020 2020 2020 2020 696d 706f 7274 2067          import g
-000213d0: 690a 2020 2020 6578 6365 7074 2049 6d70  i.    except Imp
-000213e0: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
-000213f0: 2020 7265 7475 726e 0a20 2020 2074 7279    return.    try
-00021400: 3a0a 2020 2020 2020 2020 6672 6f6d 2067  :.        from g
-00021410: 692e 7265 706f 7369 746f 7279 2069 6d70  i.repository imp
-00021420: 6f72 7420 474c 6962 0a20 2020 2065 7863  ort GLib.    exc
-00021430: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
-00021440: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
-00021450: 7065 6374 696f 6e20 5079 556e 7265 736f  pection PyUnreso
-00021460: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
-00021470: 2020 2020 2020 2066 726f 6d20 6769 2e6f         from gi.o
-00021480: 7665 7272 6964 6573 2069 6d70 6f72 7420  verrides import 
-00021490: 474c 6962 0a20 2020 2023 2044 6f20 6e6f  GLib.    # Do no
-000214a0: 7468 696e 672e 0a20 2020 2023 2054 6865  thing..    # The
-000214b0: 206f 7269 6769 6e61 6c20 6265 6861 7669   original behavi
-000214c0: 6f72 2077 6f75 6c64 2069 6e73 7461 6c6c  or would install
-000214d0: 2061 2053 4947 494e 5420 6861 6e64 6c65   a SIGINT handle
-000214e0: 7220 7768 6963 6820 6361 6c6c 7320 474c  r which calls GL
-000214f0: 6962 2e4d 6169 6e4c 6f6f 702e 7175 6974  ib.MainLoop.quit
-00021500: 2829 2c0a 2020 2020 2320 616e 6420 7468  (),.    # and th
-00021510: 656e 2072 6572 6169 7365 2061 204b 6579  en reraise a Key
-00021520: 626f 6172 6449 6e74 6572 7275 7074 2069  boardInterrupt i
-00021530: 6e20 7468 6174 2074 6872 6561 642e 0a20  n that thread.. 
-00021540: 2020 2023 2048 6f77 6576 6572 2c20 7765     # However, we
-00021550: 2077 616e 7420 616e 6420 6578 7065 6374   want and expect
-00021560: 2074 6f20 6765 7420 7468 6520 4b65 7962   to get the Keyb
-00021570: 6f61 7264 496e 7465 7272 7570 7420 696e  oardInterrupt in
-00021580: 2074 6865 206d 6169 6e20 7468 7265 6164   the main thread
-00021590: 2e0a 2020 2020 474c 6962 2e4d 6169 6e4c  ..    GLib.MainL
-000215a0: 6f6f 702e 5f5f 696e 6974 5f5f 203d 206c  oop.__init__ = l
-000215b0: 616d 6264 6120 2a61 7267 732c 202a 2a6b  ambda *args, **k
-000215c0: 7761 7267 733a 204e 6f6e 650a 0a0a 6465  wargs: None...de
-000215d0: 6620 6d6f 6e6b 6579 7061 7463 685f 6175  f monkeypatch_au
-000215e0: 6469 6f72 6561 6428 293a 0a20 2020 2022  dioread():.    "
-000215f0: 2222 0a20 2020 2061 7564 696f 7265 6164  "".    audioread
-00021600: 2064 6f65 7320 6e6f 7420 6265 6861 7665   does not behave
-00021610: 206f 7074 696d 616c 2069 6e20 736f 6d65   optimal in some
-00021620: 2063 6173 6573 2e0a 2020 2020 452e 672e   cases..    E.g.
-00021630: 2065 6163 6820 6361 6c6c 2074 6f20 5f63   each call to _c
-00021640: 615f 6176 6169 6c61 626c 6528 2920 7461  a_available() ta
-00021650: 6b65 7320 7175 6974 6520 6c6f 6e67 2062  kes quite long b
-00021660: 6563 6175 7365 206f 6620 7468 6520 6374  ecause of the ct
-00021670: 7970 6573 2e75 7469 6c2e 6669 6e64 5f6c  ypes.util.find_l
-00021680: 6962 7261 7279 2075 7361 6765 2e0a 2020  ibrary usage..  
-00021690: 2020 5765 2077 696c 6c20 7061 7463 6820    We will patch 
-000216a0: 7468 6973 2e0a 0a20 2020 2048 6f77 6576  this...    Howev
-000216b0: 6572 2c20 7468 6520 7265 636f 6d6d 656e  er, the recommen
-000216c0: 6461 7469 6f6e 2077 6f75 6c64 2062 6520  dation would be 
-000216d0: 746f 206e 6f74 2075 7365 2061 7564 696f  to not use audio
-000216e0: 7265 6164 2028 6c69 6272 6f73 612e 6c6f  read (librosa.lo
-000216f0: 6164 292e 0a20 2020 2061 7564 696f 7265  ad)..    audiore
-00021700: 6164 2075 7365 7320 4773 7472 6561 6d65  ad uses Gstreame
-00021710: 7220 6173 2061 2062 6163 6b65 6e64 2062  r as a backend b
-00021720: 7920 6465 6661 756c 7420 6375 7272 656e  y default curren
-00021730: 746c 7920 286f 6e20 4c69 6e75 7829 2e0a  tly (on Linux)..
-00021740: 2020 2020 4773 7472 6561 6d65 7220 6861      Gstreamer ha
-00021750: 7320 6d75 6c74 6970 6c65 2069 7373 7565  s multiple issue
-00021760: 732e 2053 6565 2061 6c73 6f20 3a66 756e  s. See also :fun
-00021770: 633a 606d 6f6e 6b65 7966 6978 5f67 6c69  c:`monkeyfix_gli
-00021780: 6260 2c20 616e 6420 6865 7265 2066 6f72  b`, and here for
-00021790: 2064 6973 6375 7373 696f 6e3a 0a20 2020   discussion:.   
-000217a0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-000217b0: 636f 6d2f 6265 6574 626f 782f 6175 6469  com/beetbox/audi
-000217c0: 6f72 6561 642f 6973 7375 6573 2f36 320a  oread/issues/62.
-000217d0: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
-000217e0: 7562 2e63 6f6d 2f62 6565 7462 6f78 2f61  ub.com/beetbox/a
-000217f0: 7564 696f 7265 6164 2f69 7373 7565 732f  udioread/issues/
-00021800: 3633 0a0a 2020 2020 496e 7374 6561 642c  63..    Instead,
-00021810: 2075 7365 2050 7953 6f75 6e64 4669 6c65   use PySoundFile
-00021820: 2c20 7768 6963 6820 6973 2061 6c73 6f20  , which is also 
-00021830: 6661 7374 6572 2e20 5365 6520 6865 7265  faster. See here
-00021840: 2066 6f72 2064 6973 6375 7373 696f 6e73   for discussions
-00021850: 3a0a 2020 2020 6874 7470 733a 2f2f 6769  :.    https://gi
-00021860: 7468 7562 2e63 6f6d 2f62 6565 7462 6f78  thub.com/beetbox
-00021870: 2f61 7564 696f 7265 6164 2f69 7373 7565  /audioread/issue
-00021880: 732f 3634 0a20 2020 2068 7474 7073 3a2f  s/64.    https:/
-00021890: 2f67 6974 6875 622e 636f 6d2f 6c69 6272  /github.com/libr
-000218a0: 6f73 612f 6c69 6272 6f73 612f 6973 7375  osa/librosa/issu
-000218b0: 6573 2f36 3831 0a20 2020 2022 2222 0a20  es/681.    """. 
-000218c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000218d0: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
-000218e0: 7950 6163 6b61 6765 5265 7175 6972 656d  yPackageRequirem
-000218f0: 656e 7473 0a20 2020 2020 2020 2069 6d70  ents.        imp
-00021900: 6f72 7420 6175 6469 6f72 6561 640a 2020  ort audioread.  
-00021910: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
-00021920: 7272 6f72 3a0a 2020 2020 2020 2020 7265  rror:.        re
-00021930: 7475 726e 0a20 2020 2023 206e 6f69 6e73  turn.    # noins
-00021940: 7065 6374 696f 6e20 5079 5072 6f74 6563  pection PyProtec
-00021950: 7465 644d 656d 6265 720a 2020 2020 7265  tedMember.    re
-00021960: 7320 3d20 6175 6469 6f72 6561 642e 5f63  s = audioread._c
-00021970: 615f 6176 6169 6c61 626c 6528 290a 2020  a_available().  
-00021980: 2020 6175 6469 6f72 6561 642e 5f63 615f    audioread._ca_
-00021990: 6176 6169 6c61 626c 6520 3d20 6c61 6d62  available = lamb
-000219a0: 6461 3a20 7265 730a 0a0a 5f63 665f 6361  da: res..._cf_ca
-000219b0: 6368 6520 3d20 7b7d 0a5f 6366 5f6d 7367  che = {}._cf_msg
-000219c0: 5f70 7269 6e74 6564 203d 2046 616c 7365  _printed = False
-000219d0: 0a0a 0a64 6566 2063 6628 6669 6c65 6e61  ...def cf(filena
-000219e0: 6d65 293a 0a20 2020 2022 2222 0a20 2020  me):.    """.   
-000219f0: 2043 6163 6865 206d 616e 6167 6572 2e20   Cache manager. 
-00021a00: 6936 2073 7065 6369 6669 632e 0a0a 2020  i6 specific...  
-00021a10: 2020 3a72 6574 7572 6e3a 2066 696c 656e    :return: filen
-00021a20: 616d 650a 2020 2020 3a72 7479 7065 3a20  ame.    :rtype: 
-00021a30: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
-00021a40: 676c 6f62 616c 205f 6366 5f6d 7367 5f70  global _cf_msg_p
-00021a50: 7269 6e74 6564 0a20 2020 2069 6d70 6f72  rinted.    impor
-00021a60: 7420 6f73 0a20 2020 2066 726f 6d20 7375  t os.    from su
-00021a70: 6270 726f 6365 7373 2069 6d70 6f72 7420  bprocess import 
-00021a80: 6368 6563 6b5f 6f75 7470 7574 0a0a 2020  check_output..  
-00021a90: 2020 6966 2066 696c 656e 616d 6520 696e    if filename in
-00021aa0: 205f 6366 5f63 6163 6865 3a0a 2020 2020   _cf_cache:.    
-00021ab0: 2020 2020 7265 7475 726e 205f 6366 5f63      return _cf_c
-00021ac0: 6163 6865 5b66 696c 656e 616d 655d 0a20  ache[filename]. 
-00021ad0: 2020 2064 6562 7567 5f6d 6f64 6520 3d20     debug_mode = 
-00021ae0: 696e 7428 6f73 2e65 6e76 6972 6f6e 2e67  int(os.environ.g
-00021af0: 6574 2822 4445 4255 4722 2c20 3029 290a  et("DEBUG", 0)).
-00021b00: 2020 2020 6966 2064 6562 7567 5f6d 6f64      if debug_mod
-00021b10: 6520 6f72 2067 6574 5f68 6f73 746e 616d  e or get_hostnam
-00021b20: 6528 2920 3d3d 2022 636c 7573 7465 722d  e() == "cluster-
-00021b30: 636e 2d32 3131 2220 6f72 206e 6f74 2069  cn-211" or not i
-00021b40: 735f 7275 6e6e 696e 675f 6f6e 5f63 6c75  s_running_on_clu
-00021b50: 7374 6572 2829 3a0a 2020 2020 2020 2020  ster():.        
-00021b60: 6966 206e 6f74 205f 6366 5f6d 7367 5f70  if not _cf_msg_p
-00021b70: 7269 6e74 6564 3a0a 2020 2020 2020 2020  rinted:.        
-00021b80: 2020 2020 7072 696e 7428 2243 6163 6865      print("Cache
-00021b90: 206d 616e 6167 6572 3a20 6e6f 7420 7573   manager: not us
-00021ba0: 6564 2c20 7573 6520 6c6f 6361 6c20 6669  ed, use local fi
-00021bb0: 6c65 3a20 2573 2028 6469 7363 6172 6420  le: %s (discard 
-00021bc0: 6675 7274 6865 7220 6d65 7373 6167 6573  further messages
-00021bd0: 2922 2025 2066 696c 656e 616d 6529 0a20  )" % filename). 
-00021be0: 2020 2020 2020 2020 2020 205f 6366 5f6d             _cf_m
-00021bf0: 7367 5f70 7269 6e74 6564 203d 2054 7275  sg_printed = Tru
-00021c00: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00021c10: 2066 696c 656e 616d 6520 2023 2066 6f72   filename  # for
-00021c20: 2064 6562 7567 6769 6e67 0a20 2020 2074   debugging.    t
-00021c30: 7279 3a0a 2020 2020 2020 2020 6361 6368  ry:.        cach
-00021c40: 6564 5f66 6e20 3d20 6368 6563 6b5f 6f75  ed_fn = check_ou
-00021c50: 7470 7574 285b 2263 6622 2c20 6669 6c65  tput(["cf", file
-00021c60: 6e61 6d65 5d29 2e73 7472 6970 2829 2e64  name]).strip().d
-00021c70: 6563 6f64 6528 2275 7466 3822 290a 2020  ecode("utf8").  
-00021c80: 2020 6578 6365 7074 2043 616c 6c65 6450    except CalledP
-00021c90: 726f 6365 7373 4572 726f 723a 0a20 2020  rocessError:.   
-00021ca0: 2020 2020 2069 6620 6e6f 7420 5f63 665f       if not _cf_
-00021cb0: 6d73 675f 7072 696e 7465 643a 0a20 2020  msg_printed:.   
-00021cc0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00021cd0: 4361 6368 6520 6d61 6e61 6765 723a 2045  Cache manager: E
-00021ce0: 7272 6f72 206f 6363 7572 7265 642c 2075  rror occurred, u
-00021cf0: 7369 6e67 206c 6f63 616c 2066 696c 6522  sing local file"
-00021d00: 290a 2020 2020 2020 2020 2020 2020 5f63  ).            _c
-00021d10: 665f 6d73 675f 7072 696e 7465 6420 3d20  f_msg_printed = 
-00021d20: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-00021d30: 7572 6e20 6669 6c65 6e61 6d65 0a20 2020  urn filename.   
-00021d40: 2061 7373 6572 7420 6f73 2e70 6174 682e   assert os.path.
-00021d50: 6578 6973 7473 2863 6163 6865 645f 666e  exists(cached_fn
-00021d60: 290a 2020 2020 5f63 665f 6361 6368 655b  ).    _cf_cache[
-00021d70: 6669 6c65 6e61 6d65 5d20 3d20 6361 6368  filename] = cach
-00021d80: 6564 5f66 6e0a 2020 2020 7265 7475 726e  ed_fn.    return
-00021d90: 2063 6163 6865 645f 666e 0a0a 0a64 6566   cached_fn...def
-00021da0: 2062 696e 6172 795f 7365 6172 6368 5f61   binary_search_a
-00021db0: 6e79 2863 6d70 2c20 6c6f 772c 2068 6967  ny(cmp, low, hig
-00021dc0: 6829 3a0a 2020 2020 2222 220a 2020 2020  h):.    """.    
-00021dd0: 4269 6e61 7279 2073 6561 7263 6820 666f  Binary search fo
-00021de0: 7220 6120 6375 7374 6f6d 2063 6f6d 7061  r a custom compa
-00021df0: 7265 2066 756e 6374 696f 6e2e 0a0a 2020  re function...  
-00021e00: 2020 3a70 6172 616d 2028 696e 7429 2d3e    :param (int)->
-00021e10: 696e 7420 636d 703a 2065 2e67 2e20 636d  int cmp: e.g. cm
-00021e20: 7028 6964 7829 203d 3d20 636f 6d70 6172  p(idx) == compar
-00021e30: 6528 6172 7261 795b 6964 785d 2c20 6b65  e(array[idx], ke
-00021e40: 7929 0a20 2020 203a 7061 7261 6d20 696e  y).    :param in
-00021e50: 7420 6c6f 773a 2069 6e63 6c75 7369 7665  t low: inclusive
-00021e60: 0a20 2020 203a 7061 7261 6d20 696e 7420  .    :param int 
-00021e70: 6869 6768 3a20 6578 636c 7573 6976 650a  high: exclusive.
-00021e80: 2020 2020 3a72 7479 7065 3a20 696e 747c      :rtype: int|
-00021e90: 4e6f 6e65 0a20 2020 2022 2222 0a20 2020  None.    """.   
-00021ea0: 2077 6869 6c65 206c 6f77 203c 2068 6967   while low < hig
-00021eb0: 683a 0a20 2020 2020 2020 206d 6964 203d  h:.        mid =
-00021ec0: 2028 6c6f 7720 2b20 6869 6768 2920 2f2f   (low + high) //
-00021ed0: 2032 0a20 2020 2020 2020 2072 203d 2063   2.        r = c
-00021ee0: 6d70 286d 6964 290a 2020 2020 2020 2020  mp(mid).        
-00021ef0: 6966 2072 203c 2030 3a0a 2020 2020 2020  if r < 0:.      
-00021f00: 2020 2020 2020 6c6f 7720 3d20 6d69 6420        low = mid 
-00021f10: 2b20 310a 2020 2020 2020 2020 656c 6966  + 1.        elif
-00021f20: 2072 203e 2030 3a0a 2020 2020 2020 2020   r > 0:.        
-00021f30: 2020 2020 6869 6768 203d 206d 6964 0a20      high = mid. 
-00021f40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00021f50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00021f60: 6d69 640a 2020 2020 7265 7475 726e 206c  mid.    return l
-00021f70: 6f77 0a0a 0a64 6566 2067 656e 6572 6963  ow...def generic
-00021f80: 5f69 6d70 6f72 745f 6d6f 6475 6c65 2866  _import_module(f
-00021f90: 696c 656e 616d 6529 3a0a 2020 2020 2222  ilename):.    ""
-00021fa0: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
-00021fb0: 2066 696c 656e 616d 653a 0a20 2020 2020   filename:.     
-00021fc0: 2057 6520 7472 7920 746f 2062 6520 636c   We try to be cl
-00021fd0: 6576 6572 2061 626f 7574 2066 696c 656e  ever about filen
-00021fe0: 616d 652e 0a20 2020 2020 2049 6620 6974  ame..      If it
-00021ff0: 206c 6f6f 6b73 206c 696b 6520 6120 6d6f   looks like a mo
-00022000: 6475 6c65 206e 616d 652c 206a 7573 7420  dule name, just 
-00022010: 646f 2069 6d70 6f72 746c 6962 2e69 6d70  do importlib.imp
-00022020: 6f72 745f 6d6f 6475 6c65 2e0a 2020 2020  ort_module..    
-00022030: 2020 4966 2069 7420 6c6f 6f6b 7320 6c69    If it looks li
-00022040: 6b65 2061 2066 696c 656e 616d 652c 2073  ke a filename, s
-00022050: 6561 7263 6820 666f 7220 6120 6261 7365  earch for a base
-00022060: 2070 6174 6820 2877 6869 6368 2064 6f65   path (which doe
-00022070: 7320 6e6f 7420 6861 7665 205f 5f69 6e69  s not have __ini
-00022080: 745f 5f2e 7079 292c 0a20 2020 2020 2061  t__.py),.      a
-00022090: 6464 2074 6861 7420 7061 7468 2074 6f20  dd that path to 
-000220a0: 7379 732e 7061 7468 2069 6620 6e65 6564  sys.path if need
-000220b0: 6564 2c20 616e 6420 696d 706f 7274 2074  ed, and import t
-000220c0: 6865 2072 656d 6169 6e69 6e67 2077 6865  he remaining whe
-000220d0: 7265 2022 2f22 2069 7320 7265 706c 6163  re "/" is replac
-000220e0: 6564 2062 7920 222e 220a 2020 2020 2020  ed by ".".      
-000220f0: 616e 6420 7468 6520 6669 6c65 2065 7874  and the file ext
-00022100: 656e 7369 6f6e 2069 7320 7265 6d6f 7665  ension is remove
-00022110: 642e 0a20 2020 203a 7265 7475 726e 3a20  d..    :return: 
-00022120: 7468 6520 6d6f 6475 6c65 0a20 2020 203a  the module.    :
-00022130: 7274 7970 653a 2074 7970 6573 2e4d 6f64  rtype: types.Mod
-00022140: 756c 6554 7970 650a 2020 2020 2222 220a  uleType.    """.
-00022150: 2020 2020 6173 7365 7274 2066 696c 656e      assert filen
-00022160: 616d 650a 2020 2020 696d 706f 7274 2069  ame.    import i
-00022170: 6d70 6f72 746c 6962 0a0a 2020 2020 6966  mportlib..    if
-00022180: 2022 2f22 206e 6f74 2069 6e20 6669 6c65   "/" not in file
-00022190: 6e61 6d65 3a0a 2020 2020 2020 2020 7265  name:.        re
-000221a0: 7475 726e 2069 6d70 6f72 746c 6962 2e69  turn importlib.i
-000221b0: 6d70 6f72 745f 6d6f 6475 6c65 2866 696c  mport_module(fil
-000221c0: 656e 616d 6529 0a20 2020 2070 7265 6669  ename).    prefi
-000221d0: 785f 6469 7220 3d20 2222 0a20 2020 2069  x_dir = "".    i
-000221e0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-000221f0: 6973 7473 2866 696c 656e 616d 6529 3a0a  ists(filename):.
-00022200: 2020 2020 2020 2020 6173 7365 7274 2066          assert f
-00022210: 696c 656e 616d 655b 305d 2021 3d20 222f  ilename[0] != "/
-00022220: 220a 2020 2020 2020 2020 2320 4d61 7962  ".        # Mayb
-00022230: 6520 7265 6c61 7469 7665 2074 6f20 5265  e relative to Re
-00022240: 7475 726e 6e3f 0a20 2020 2020 2020 2070  turnn?.        p
-00022250: 7265 6669 785f 6469 7220 3d20 2225 732f  refix_dir = "%s/
-00022260: 2220 2520 7265 7475 726e 6e5f 726f 6f74  " % returnn_root
-00022270: 5f64 6972 0a20 2020 2061 7373 6572 7420  _dir.    assert 
-00022280: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-00022290: 7265 6669 785f 6469 7220 2b20 6669 6c65  refix_dir + file
-000222a0: 6e61 6d65 290a 2020 2020 6173 7365 7274  name).    assert
-000222b0: 2066 696c 656e 616d 652e 656e 6473 7769   filename.endswi
-000222c0: 7468 2822 2e70 7922 2920 6f72 206f 732e  th(".py") or os.
-000222d0: 7061 7468 2e69 7364 6972 2870 7265 6669  path.isdir(prefi
-000222e0: 785f 6469 7220 2b20 6669 6c65 6e61 6d65  x_dir + filename
-000222f0: 290a 2020 2020 6469 7273 203d 2066 696c  ).    dirs = fil
-00022300: 656e 616d 652e 7370 6c69 7428 222f 2229  ename.split("/")
-00022310: 0a20 2020 2064 6972 732c 2062 6173 655f  .    dirs, base_
-00022320: 666e 203d 2064 6972 735b 3a2d 315d 2c20  fn = dirs[:-1], 
-00022330: 6469 7273 5b2d 315d 0a20 2020 2061 7373  dirs[-1].    ass
-00022340: 6572 7420 6c65 6e28 6469 7273 2920 3e3d  ert len(dirs) >=
-00022350: 2031 0a20 2020 2066 6f72 2069 2069 6e20   1.    for i in 
-00022360: 7265 7665 7273 6564 2872 616e 6765 286c  reversed(range(l
-00022370: 656e 2864 6972 7329 2929 3a0a 2020 2020  en(dirs))):.    
-00022380: 2020 2020 6420 3d20 7072 6566 6978 5f64      d = prefix_d
-00022390: 6972 202b 2022 2f22 2e6a 6f69 6e28 6469  ir + "/".join(di
-000223a0: 7273 5b3a 2069 202b 2031 5d29 0a20 2020  rs[: i + 1]).   
-000223b0: 2020 2020 2061 7373 6572 7420 6f73 2e70       assert os.p
-000223c0: 6174 682e 6973 6469 7228 6429 0a20 2020  ath.isdir(d).   
-000223d0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-000223e0: 6578 6973 7473 2822 2573 2f5f 5f69 6e69  exists("%s/__ini
-000223f0: 745f 5f2e 7079 2220 2520 6429 3a0a 2020  t__.py" % d):.  
-00022400: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00022410: 7565 0a20 2020 2020 2020 2069 6620 6420  ue.        if d 
-00022420: 6e6f 7420 696e 2073 7973 2e70 6174 683a  not in sys.path:
-00022430: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
-00022440: 2e70 6174 682e 6170 7065 6e64 2864 290a  .path.append(d).
-00022450: 2020 2020 2020 2020 6d20 3d20 222e 222e          m = ".".
-00022460: 6a6f 696e 2864 6972 735b 6920 2b20 3120  join(dirs[i + 1 
-00022470: 3a5d 202b 205b 6261 7365 5f66 6e5d 290a  :] + [base_fn]).
-00022480: 2020 2020 2020 2020 6966 2062 6173 655f          if base_
-00022490: 666e 2e65 6e64 7377 6974 6828 222e 7079  fn.endswith(".py
-000224a0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-000224b0: 6d20 3d20 6d5b 3a2d 335d 0a20 2020 2020  m = m[:-3].     
-000224c0: 2020 2072 6574 7572 6e20 696d 706f 7274     return import
-000224d0: 6c69 622e 696d 706f 7274 5f6d 6f64 756c  lib.import_modul
-000224e0: 6528 6d29 0a20 2020 2072 6169 7365 2056  e(m).    raise V
-000224f0: 616c 7565 4572 726f 7228 2263 616e 6e6f  alueError("canno
-00022500: 7420 6669 6775 7265 206f 7574 2062 6173  t figure out bas
-00022510: 6520 6d6f 6475 6c65 2070 6174 6820 6672  e module path fr
-00022520: 6f6d 2025 7222 2025 2066 696c 656e 616d  om %r" % filenam
-00022530: 6529 0a0a 0a64 6566 2073 6f66 746d 6178  e)...def softmax
-00022540: 2878 2c20 6178 6973 3d4e 6f6e 6529 3a0a  (x, axis=None):.
-00022550: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-00022560: 616d 206e 756d 7079 2e6e 6461 7272 6179  am numpy.ndarray
-00022570: 2078 3a0a 2020 2020 3a70 6172 616d 2069   x:.    :param i
-00022580: 6e74 7c4e 6f6e 6520 6178 6973 3a0a 2020  nt|None axis:.  
-00022590: 2020 3a72 7479 7065 3a20 6e75 6d70 792e    :rtype: numpy.
-000225a0: 6e64 6172 7261 790a 2020 2020 2222 220a  ndarray.    """.
-000225b0: 2020 2020 696d 706f 7274 206e 756d 7079      import numpy
-000225c0: 0a0a 2020 2020 655f 7820 3d20 6e75 6d70  ..    e_x = nump
-000225d0: 792e 6578 7028 7820 2d20 6e75 6d70 792e  y.exp(x - numpy.
-000225e0: 6d61 7828 782c 2061 7869 733d 6178 6973  max(x, axis=axis
-000225f0: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
-00022600: 290a 2020 2020 7265 7475 726e 2065 5f78  ).    return e_x
-00022610: 202f 206e 756d 7079 2e73 756d 2865 5f78   / numpy.sum(e_x
-00022620: 2c20 6178 6973 3d61 7869 732c 206b 6565  , axis=axis, kee
-00022630: 7064 696d 733d 5472 7565 290a 0a0a 6465  pdims=True)...de
-00022640: 6620 636f 6c6c 6563 745f 7072 6f63 5f6d  f collect_proc_m
-00022650: 6170 735f 6578 6563 5f66 696c 6573 2829  aps_exec_files()
-00022660: 3a0a 2020 2020 2222 220a 2020 2020 4375  :.    """.    Cu
-00022670: 7272 656e 746c 7920 6f6e 6c79 2077 6f72  rrently only wor
-00022680: 6b73 206f 6e20 4c69 6e75 782e 2e2e 0a0a  ks on Linux.....
-00022690: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
-000226a0: 7420 6f66 206d 6170 7065 6420 6578 6563  t of mapped exec
-000226b0: 7574 6162 6c65 7320 286c 6962 7329 0a20  utables (libs). 
-000226c0: 2020 203a 7274 7970 653a 206c 6973 745b     :rtype: list[
-000226d0: 7374 725d 0a20 2020 2022 2222 0a20 2020  str].    """.   
-000226e0: 2069 6d70 6f72 7420 7265 0a0a 2020 2020   import re..    
-000226f0: 7069 6420 3d20 6f73 2e67 6574 7069 6428  pid = os.getpid(
-00022700: 290a 2020 2020 666e 7320 3d20 5b5d 0a20  ).    fns = []. 
-00022710: 2020 2066 6f72 206c 696e 6520 696e 206f     for line in o
-00022720: 7065 6e28 222f 7072 6f63 2f25 692f 6d61  pen("/proc/%i/ma
-00022730: 7073 2220 2520 7069 642c 2022 7222 292e  ps" % pid, "r").
-00022740: 7265 6164 2829 2e73 706c 6974 6c69 6e65  read().splitline
-00022750: 7328 293a 2020 2320 666f 7220 6561 6368  s():  # for each
-00022760: 206d 6170 7065 6420 7265 6769 6f6e 0a20   mapped region. 
-00022770: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
-00022780: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
-00022790: 6f6d 2f71 7565 7374 696f 6e73 2f31 3430  om/questions/140
-000227a0: 3133 3539 2f75 6e64 6572 7374 616e 6469  1359/understandi
-000227b0: 6e67 2d6c 696e 7578 2d70 726f 632d 6964  ng-linux-proc-id
-000227c0: 2d6d 6170 730a 2020 2020 2020 2020 2320  -maps.        # 
-000227d0: 6164 6472 6573 7320 2020 2020 2020 2020  address         
-000227e0: 2020 7065 726d 7320 6f66 6673 6574 2020    perms offset  
-000227f0: 6465 7620 2020 696e 6f64 6520 2020 7061  dev   inode   pa
-00022800: 7468 6e61 6d65 0a20 2020 2020 2020 2023  thname.        #
-00022810: 2045 2e67 2e3a 0a20 2020 2020 2020 2023   E.g.:.        #
-00022820: 2037 6666 3264 6539 3163 3030 302d 3766   7ff2de91c000-7f
-00022830: 6632 6465 3931 6530 3030 2072 772d 7020  f2de91e000 rw-p 
-00022840: 3030 3137 6330 3030 2030 383a 3032 2037  0017c000 08:02 7
-00022850: 3934 3834 3420 2020 2020 2020 2020 2020  94844           
-00022860: 2020 2020 2020 2020 2020 2f75 7372 2f6c            /usr/l
-00022870: 6962 2f78 3836 5f36 342d 6c69 6e75 782d  ib/x86_64-linux-
-00022880: 676e 752f 6c69 6273 7464 632b 2e2e 2e0a  gnu/libstdc+....
-00022890: 2020 2020 2020 2020 6d20 3d20 7265 2e6d          m = re.m
-000228a0: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
-000228b0: 2020 7222 5e28 5b30 2d39 412d 4661 2d66    r"^([0-9A-Fa-f
-000228c0: 5d2b 292d 285b 302d 3941 2d46 612d 665d  ]+)-([0-9A-Fa-f]
-000228d0: 2b29 5c73 2b28 5b72 7778 7073 5c2d 5d2b  +)\s+([rwxps\-]+
-000228e0: 295c 732b 285b 302d 3941 2d46 612d 665d  )\s+([0-9A-Fa-f]
-000228f0: 2b29 5c73 2b28 5b30 2d39 412d 4661 2d66  +)\s+([0-9A-Fa-f
-00022900: 3a5d 2b29 5c73 2b28 5b30 2d39 5d2b 295c  :]+)\s+([0-9]+)\
-00022910: 732a 282e 2a29 2422 2c20 6c69 6e65 0a20  s*(.*)$", line. 
-00022920: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00022930: 2061 7373 6572 7420 6d2c 2022 6e6f 206d   assert m, "no m
-00022940: 6174 6368 2066 6f72 2025 7222 2025 206c  atch for %r" % l
-00022950: 696e 650a 2020 2020 2020 2020 6164 6472  ine.        addr
-00022960: 6573 735f 7374 6172 742c 2061 6464 7265  ess_start, addre
-00022970: 7373 5f65 6e64 2c20 7065 726d 732c 206f  ss_end, perms, o
-00022980: 6666 7365 742c 2064 6576 2c20 695f 6e6f  ffset, dev, i_no
-00022990: 6465 2c20 7061 7468 5f6e 616d 6520 3d20  de, path_name = 
-000229a0: 6d2e 6772 6f75 7073 2829 0a20 2020 2020  m.groups().     
-000229b0: 2020 2069 6620 2278 2220 6e6f 7420 696e     if "x" not in
-000229c0: 2070 6572 6d73 3a0a 2020 2020 2020 2020   perms:.        
-000229d0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-000229e0: 2020 2020 2069 6620 6e6f 7420 7061 7468       if not path
-000229f0: 5f6e 616d 6520 6f72 2070 6174 685f 6e61  _name or path_na
-00022a00: 6d65 2e73 7461 7274 7377 6974 6828 225b  me.startswith("[
-00022a10: 2229 206f 7220 2228 6465 6c65 7465 6429  ") or "(deleted)
-00022a20: 2220 696e 2070 6174 685f 6e61 6d65 3a0a  " in path_name:.
-00022a30: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00022a40: 696e 7565 0a20 2020 2020 2020 2069 6620  inue.        if 
-00022a50: 7061 7468 5f6e 616d 6520 6e6f 7420 696e  path_name not in
-00022a60: 2066 6e73 3a0a 2020 2020 2020 2020 2020   fns:.          
-00022a70: 2020 666e 732e 6170 7065 6e64 2870 6174    fns.append(pat
-00022a80: 685f 6e61 6d65 290a 2020 2020 7265 7475  h_name).    retu
-00022a90: 726e 2066 6e73 0a0a 0a64 6566 2066 696e  rn fns...def fin
-00022aa0: 645f 7379 6d5f 696e 5f65 7865 6328 666e  d_sym_in_exec(fn
-00022ab0: 2c20 7379 6d29 3a0a 2020 2020 2222 220a  , sym):.    """.
-00022ac0: 2020 2020 5573 6573 2060 606f 626a 6475      Uses ``objdu
-00022ad0: 6d70 6060 2074 6f20 6c69 7374 2061 7661  mp`` to list ava
-00022ae0: 696c 6162 6c65 2073 796d 626f 6c73 2c20  ilable symbols, 
-00022af0: 616e 6420 6669 6c74 6572 7320 7468 656d  and filters them
-00022b00: 2062 7920 7468 6520 6769 7665 6e20 6060   by the given ``
-00022b10: 7379 6d60 602e 0a0a 2020 2020 3a70 6172  sym``...    :par
-00022b20: 616d 2073 7472 2066 6e3a 2070 6174 680a  am str fn: path.
-00022b30: 2020 2020 3a70 6172 616d 2073 7472 2073      :param str s
-00022b40: 796d 3a0a 2020 2020 3a72 6574 7572 6e3a  ym:.    :return:
-00022b50: 206d 6174 6368 6564 206f 7574 2c20 6f72   matched out, or
-00022b60: 204e 6f6e 650a 2020 2020 3a72 7479 7065   None.    :rtype
-00022b70: 3a20 7374 727c 4e6f 6e65 0a20 2020 2022  : str|None.    "
-00022b80: 2222 0a20 2020 2066 726f 6d20 7375 6270  "".    from subp
-00022b90: 726f 6365 7373 2069 6d70 6f72 7420 4361  rocess import Ca
-00022ba0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00022bb0: 0a0a 2020 2020 6f62 6a64 756d 7020 3d20  ..    objdump = 
-00022bc0: 226f 626a 6475 6d70 202d 5422 0a20 2020  "objdump -T".   
-00022bd0: 2069 6620 7379 732e 706c 6174 666f 726d   if sys.platform
-00022be0: 203d 3d20 2264 6172 7769 6e22 3a0a 2020   == "darwin":.  
-00022bf0: 2020 2020 2020 6f62 6a64 756d 7020 3d20        objdump = 
-00022c00: 226f 746f 6f6c 202d 4948 4776 220a 2020  "otool -IHGv".  
-00022c10: 2020 7368 656c 6c5f 636d 6420 3d20 2225    shell_cmd = "%
-00022c20: 7320 2573 207c 2067 7265 7020 2573 2220  s %s | grep %s" 
-00022c30: 2520 286f 626a 6475 6d70 2c20 666e 2c20  % (objdump, fn, 
-00022c40: 7379 6d29 0a20 2020 2074 7279 3a0a 2020  sym).    try:.  
-00022c50: 2020 2020 2020 6f75 7420 3d20 7379 735f        out = sys_
-00022c60: 6578 6563 5f6f 7574 2873 6865 6c6c 5f63  exec_out(shell_c
-00022c70: 6d64 2c20 7368 656c 6c3d 5472 7565 290a  md, shell=True).
-00022c80: 2020 2020 6578 6365 7074 2043 616c 6c65      except Calle
-00022c90: 6450 726f 6365 7373 4572 726f 723a 2020  dProcessError:  
-00022ca0: 2320 6e6f 6e65 2066 6f75 6e64 0a20 2020  # none found.   
-00022cb0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00022cc0: 0a20 2020 2061 7373 6572 7420 6973 696e  .    assert isin
-00022cd0: 7374 616e 6365 286f 7574 2c20 2873 7472  stance(out, (str
-00022ce0: 2c20 756e 6963 6f64 6529 290a 2020 2020  , unicode)).    
-00022cf0: 6f75 745f 6c6e 7320 3d20 6f75 742e 7370  out_lns = out.sp
-00022d00: 6c69 746c 696e 6573 2829 0a20 2020 206f  litlines().    o
-00022d10: 7574 5f6c 6e73 203d 205b 6c6e 2066 6f72  ut_lns = [ln for
-00022d20: 206c 6e20 696e 206f 7574 5f6c 6e73 2069   ln in out_lns i
-00022d30: 6620 222e 7465 7874 2220 696e 206c 6e5d  f ".text" in ln]
-00022d40: 2020 2320 7365 6520 6f62 6a64 756d 700a    # see objdump.
-00022d50: 2020 2020 6f75 745f 6c6e 7320 3d20 5b6c      out_lns = [l
-00022d60: 6e20 666f 7220 6c6e 2069 6e20 6f75 745f  n for ln in out_
-00022d70: 6c6e 7320 6966 2073 796d 2069 6e20 6c6e  lns if sym in ln
-00022d80: 2e73 706c 6974 2829 5d0a 2020 2020 6966  .split()].    if
-00022d90: 206e 6f74 206f 7574 5f6c 6e73 3a0a 2020   not out_lns:.  
-00022da0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00022db0: 650a 2020 2020 7265 7475 726e 2022 466f  e.    return "Fo
-00022dc0: 756e 6420 2572 2069 6e20 2572 3a5c 6e25  und %r in %r:\n%
-00022dd0: 7322 2025 2028 7379 6d2c 2066 6e2c 2022  s" % (sym, fn, "
-00022de0: 5c6e 222e 6a6f 696e 286f 7574 5f6c 6e73  \n".join(out_lns
-00022df0: 2929 0a0a 0a64 6566 2064 756d 6d79 5f6e  ))...def dummy_n
-00022e00: 756d 7079 5f67 656d 6d5f 6361 6c6c 2829  umpy_gemm_call()
-00022e10: 3a0a 2020 2020 2222 220a 2020 2020 4a75  :.    """.    Ju
-00022e20: 7374 2070 6572 666f 726d 7320 736f 6d65  st performs some
-00022e30: 2047 454d 4d20 6361 6c6c 2076 6961 204e   GEMM call via N
-00022e40: 756d 7079 2e0a 2020 2020 5468 6973 206d  umpy..    This m
-00022e50: 616b 6573 2073 7572 6520 7468 6174 2074  akes sure that t
-00022e60: 6865 2042 4c41 5320 6c69 6272 6172 7920  he BLAS library 
-00022e70: 6973 206c 6f61 6465 642e 0a20 2020 2022  is loaded..    "
-00022e80: 2222 0a20 2020 2069 6d70 6f72 7420 6e75  "".    import nu
-00022e90: 6d70 790a 0a20 2020 2061 203d 206e 756d  mpy..    a = num
-00022ea0: 7079 2e72 616e 646f 6d2e 7261 6e64 6e28  py.random.randn(
-00022eb0: 352c 2033 292e 6173 7479 7065 286e 756d  5, 3).astype(num
-00022ec0: 7079 2e66 6c6f 6174 3332 290a 2020 2020  py.float32).    
-00022ed0: 6220 3d20 6e75 6d70 792e 7261 6e64 6f6d  b = numpy.random
-00022ee0: 2e72 616e 646e 2833 2c20 3729 2e61 7374  .randn(3, 7).ast
-00022ef0: 7970 6528 6e75 6d70 792e 666c 6f61 7433  ype(numpy.float3
-00022f00: 3229 0a20 2020 2063 203d 206e 756d 7079  2).    c = numpy
-00022f10: 2e64 6f74 2861 2c20 6229 0a20 2020 2061  .dot(a, b).    a
-00022f20: 7373 6572 7420 6e75 6d70 792e 6973 6669  ssert numpy.isfi
-00022f30: 6e69 7465 2863 292e 616c 6c28 290a 0a0a  nite(c).all()...
-00022f40: 5f66 696e 645f 7367 656d 6d5f 6c69 625f  _find_sgemm_lib_
-00022f50: 6672 6f6d 5f72 756e 7469 6d65 5f63 6163  from_runtime_cac
-00022f60: 6865 6420 3d20 4e6f 6e65 0a0a 0a64 6566  hed = None...def
-00022f70: 2066 696e 645f 7367 656d 6d5f 6c69 6273   find_sgemm_libs
-00022f80: 5f66 726f 6d5f 7275 6e74 696d 6528 293a  _from_runtime():
-00022f90: 0a20 2020 2022 2222 0a20 2020 204c 6f6f  .    """.    Loo
-00022fa0: 6b73 2074 6872 6f75 6768 2061 6c6c 206c  ks through all l
-00022fb0: 6962 7320 7669 6120 3a66 756e 633a 6063  ibs via :func:`c
-00022fc0: 6f6c 6c65 6374 5f70 726f 635f 6d61 7073  ollect_proc_maps
-00022fd0: 5f65 7865 635f 6669 6c65 7360 2c0a 2020  _exec_files`,.  
-00022fe0: 2020 616e 6420 7365 6172 6368 6573 2066    and searches f
-00022ff0: 6f72 2061 6c6c 2077 6869 6368 2068 6176  or all which hav
-00023000: 6520 7468 6520 6060 7367 656d 6d60 6020  e the ``sgemm`` 
-00023010: 7379 6d62 6f6c 2e0a 2020 2020 4375 7272  symbol..    Curr
-00023020: 656e 746c 7920 6f6e 6c79 2077 6f72 6b73  ently only works
-00023030: 206f 6e20 4c69 6e75 7820 2862 6563 6175   on Linux (becau
-00023040: 7365 2063 6f6c 6c65 6374 5f70 726f 635f  se collect_proc_
-00023050: 6d61 7073 5f65 7865 635f 6669 6c65 7329  maps_exec_files)
-00023060: 2e0a 0a20 2020 203a 7265 7475 726e 3a20  ...    :return: 
-00023070: 6c69 7374 206f 6620 6c69 6273 2028 7468  list of libs (th
-00023080: 6569 7220 7061 7468 290a 2020 2020 3a72  eir path).    :r
-00023090: 7479 7065 3a20 6c69 7374 5b73 7472 5d0a  type: list[str].
-000230a0: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
-000230b0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-000230c0: 7328 222f 7072 6f63 2229 3a0a 2020 2020  s("/proc"):.    
-000230d0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-000230e0: 2020 2020 676c 6f62 616c 205f 6669 6e64      global _find
-000230f0: 5f73 6765 6d6d 5f6c 6962 5f66 726f 6d5f  _sgemm_lib_from_
-00023100: 7275 6e74 696d 655f 6361 6368 6564 0a20  runtime_cached. 
-00023110: 2020 2069 6620 5f66 696e 645f 7367 656d     if _find_sgem
-00023120: 6d5f 6c69 625f 6672 6f6d 5f72 756e 7469  m_lib_from_runti
-00023130: 6d65 5f63 6163 6865 6420 6973 206e 6f74  me_cached is not
-00023140: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-00023150: 6574 7572 6e20 5f66 696e 645f 7367 656d  eturn _find_sgem
-00023160: 6d5f 6c69 625f 6672 6f6d 5f72 756e 7469  m_lib_from_runti
-00023170: 6d65 5f63 6163 6865 640a 2020 2020 6475  me_cached.    du
-00023180: 6d6d 795f 6e75 6d70 795f 6765 6d6d 5f63  mmy_numpy_gemm_c
-00023190: 616c 6c28 2920 2023 206d 616b 6520 7375  all()  # make su
-000231a0: 7265 2074 6861 7420 4e75 6d70 7920 6973  re that Numpy is
-000231b0: 206c 6f61 6465 6420 616e 6420 4e75 6d70   loaded and Nump
-000231c0: 7920 7367 656d 6d20 6973 2061 7661 696c  y sgemm is avail
-000231d0: 6162 6c65 0a20 2020 2066 6e73 203d 2063  able.    fns = c
-000231e0: 6f6c 6c65 6374 5f70 726f 635f 6d61 7073  ollect_proc_maps
-000231f0: 5f65 7865 635f 6669 6c65 7328 290a 2020  _exec_files().  
-00023200: 2020 666e 735f 7769 7468 5f73 6765 6d6d    fns_with_sgemm
-00023210: 203d 205b 5d0a 2020 2020 666f 7220 666e   = [].    for fn
-00023220: 2069 6e20 666e 733a 0a20 2020 2020 2020   in fns:.       
-00023230: 206f 7574 203d 2066 696e 645f 7379 6d5f   out = find_sym_
-00023240: 696e 5f65 7865 6328 666e 2c20 2273 6765  in_exec(fn, "sge
-00023250: 6d6d 5f22 290a 2020 2020 2020 2020 6966  mm_").        if
-00023260: 206f 7574 3a0a 2020 2020 2020 2020 2020   out:.          
-00023270: 2020 666e 735f 7769 7468 5f73 6765 6d6d    fns_with_sgemm
-00023280: 2e61 7070 656e 6428 666e 290a 2020 2020  .append(fn).    
-00023290: 5f66 696e 645f 7367 656d 6d5f 6c69 625f  _find_sgemm_lib_
-000232a0: 6672 6f6d 5f72 756e 7469 6d65 5f63 6163  from_runtime_cac
-000232b0: 6865 6420 3d20 666e 735f 7769 7468 5f73  hed = fns_with_s
-000232c0: 6765 6d6d 0a20 2020 2072 6574 7572 6e20  gemm.    return 
-000232d0: 666e 735f 7769 7468 5f73 6765 6d6d 0a0a  fns_with_sgemm..
-000232e0: 0a5f 6669 6e64 5f6c 6962 6375 6461 7274  ._find_libcudart
-000232f0: 5f66 726f 6d5f 7275 6e74 696d 655f 6361  _from_runtime_ca
-00023300: 6368 6564 203d 204e 6f6e 650a 0a0a 6465  ched = None...de
-00023310: 6620 6669 6e64 5f6c 6962 6375 6461 7274  f find_libcudart
-00023320: 5f66 726f 6d5f 7275 6e74 696d 6528 293a  _from_runtime():
-00023330: 0a20 2020 2022 2222 0a20 2020 204c 6f6f  .    """.    Loo
-00023340: 6b73 2074 6872 6f75 6768 2061 6c6c 206c  ks through all l
-00023350: 6962 7320 7669 6120 3a66 756e 633a 6063  ibs via :func:`c
-00023360: 6f6c 6c65 6374 5f70 726f 635f 6d61 7073  ollect_proc_maps
-00023370: 5f65 7865 635f 6669 6c65 7360 2c0a 2020  _exec_files`,.  
-00023380: 2020 616e 6420 7365 6172 6368 6573 2066    and searches f
-00023390: 6f72 2061 6c6c 2077 6869 6368 2068 6176  or all which hav
-000233a0: 6520 7468 6520 6060 7367 656d 6d60 6020  e the ``sgemm`` 
-000233b0: 7379 6d62 6f6c 2e0a 2020 2020 4375 7272  symbol..    Curr
-000233c0: 656e 746c 7920 6f6e 6c79 2077 6f72 6b73  ently only works
-000233d0: 206f 6e20 4c69 6e75 7820 2862 6563 6175   on Linux (becau
-000233e0: 7365 2063 6f6c 6c65 6374 5f70 726f 635f  se collect_proc_
-000233f0: 6d61 7073 5f65 7865 635f 6669 6c65 7329  maps_exec_files)
-00023400: 2e0a 0a20 2020 203a 7265 7475 726e 3a20  ...    :return: 
-00023410: 6c69 7374 206f 6620 6c69 6273 2028 7468  list of libs (th
-00023420: 6569 7220 7061 7468 290a 2020 2020 3a72  eir path).    :r
-00023430: 7479 7065 3a20 7374 727c 4e6f 6e65 0a20  type: str|None. 
-00023440: 2020 2022 2222 0a20 2020 2069 6620 6e6f     """.    if no
-00023450: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00023460: 2822 2f70 726f 6322 293a 0a20 2020 2020  ("/proc"):.     
-00023470: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-00023480: 2020 2067 6c6f 6261 6c20 5f66 696e 645f     global _find_
-00023490: 6c69 6263 7564 6172 745f 6672 6f6d 5f72  libcudart_from_r
-000234a0: 756e 7469 6d65 5f63 6163 6865 640a 2020  untime_cached.  
-000234b0: 2020 6966 205f 6669 6e64 5f6c 6962 6375    if _find_libcu
-000234c0: 6461 7274 5f66 726f 6d5f 7275 6e74 696d  dart_from_runtim
-000234d0: 655f 6361 6368 6564 2069 7320 6e6f 7420  e_cached is not 
-000234e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
-000234f0: 7475 726e 205f 6669 6e64 5f6c 6962 6375  turn _find_libcu
-00023500: 6461 7274 5f66 726f 6d5f 7275 6e74 696d  dart_from_runtim
-00023510: 655f 6361 6368 6564 5b30 5d0a 2020 2020  e_cached[0].    
-00023520: 666e 7320 3d20 636f 6c6c 6563 745f 7072  fns = collect_pr
-00023530: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
-00023540: 6573 2829 0a20 2020 2066 6f72 2066 6e20  es().    for fn 
-00023550: 696e 2066 6e73 3a0a 2020 2020 2020 2020  in fns:.        
-00023560: 6966 2072 652e 6d61 7463 6828 222e 2a2f  if re.match(".*/
-00023570: 6c69 6263 7564 6172 745c 5c2e 736f 285c  libcudart\\.so(\
-00023580: 5c2e 2e2a 293f 222c 2066 6e29 3a0a 2020  \..*)?", fn):.  
-00023590: 2020 2020 2020 2020 2020 5f66 696e 645f            _find_
-000235a0: 6c69 6263 7564 6172 745f 6672 6f6d 5f72  libcudart_from_r
-000235b0: 756e 7469 6d65 5f63 6163 6865 6420 3d20  untime_cached = 
-000235c0: 5b66 6e5d 0a20 2020 2020 2020 2020 2020  [fn].           
-000235d0: 2072 6574 7572 6e20 666e 0a20 2020 205f   return fn.    _
-000235e0: 6669 6e64 5f6c 6962 6375 6461 7274 5f66  find_libcudart_f
-000235f0: 726f 6d5f 7275 6e74 696d 655f 6361 6368  rom_runtime_cach
-00023600: 6564 203d 205b 4e6f 6e65 5d0a 2020 2020  ed = [None].    
-00023610: 7265 7475 726e 204e 6f6e 650a            return None.
+0001aa10: 2020 2020 2b20 225c 6e22 0a20 2020 2020      + "\n".     
+0001aa20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001aa30: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
+0001aa40: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
+0001aa50: 6966 2022 4469 736b 2071 756f 7461 2220  if "Disk quota" 
+0001aa60: 696e 2073 7472 2865 7863 293a 0a20 2020  in str(exc):.   
+0001aa70: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0001aa80: 6c6f 675f 7275 6e74 696d 655f 696e 666f  log_runtime_info
+0001aa90: 5f74 6f5f 6469 723a 2045 7272 6f72 2c20  _to_dir: Error, 
+0001aaa0: 6361 6e6e 6f74 2077 7269 7465 3a20 2573  cannot write: %s
+0001aab0: 2220 2520 6578 6329 0a20 2020 2020 2020  " % exc).       
+0001aac0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001aad0: 2020 2072 6169 7365 0a0a 0a64 6566 2073     raise...def s
+0001aae0: 686f 756c 645f 7772 6974 655f 746f 5f64  hould_write_to_d
+0001aaf0: 6973 6b28 636f 6e66 6967 293a 0a20 2020  isk(config):.   
+0001ab00: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+0001ab10: 7265 7475 726e 6e2e 636f 6e66 6967 2e43  returnn.config.C
+0001ab20: 6f6e 6669 6720 636f 6e66 6967 3a0a 2020  onfig config:.  
+0001ab30: 2020 3a72 7479 7065 3a20 626f 6f6c 0a20    :rtype: bool. 
+0001ab40: 2020 2022 2222 0a20 2020 2069 6620 636f     """.    if co
+0001ab50: 6e66 6967 2e69 735f 7472 7565 2822 7573  nfig.is_true("us
+0001ab60: 655f 686f 726f 766f 6422 293a 0a20 2020  e_horovod"):.   
+0001ab70: 2020 2020 2023 206e 6f69 6e73 7065 6374       # noinspect
+0001ab80: 696f 6e20 5079 5061 636b 6167 6552 6571  ion PyPackageReq
+0001ab90: 7569 7265 6d65 6e74 732c 5079 556e 7265  uirements,PyUnre
+0001aba0: 736f 6c76 6564 5265 6665 7265 6e63 6573  solvedReferences
+0001abb0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+0001abc0: 686f 726f 766f 642e 7465 6e73 6f72 666c  horovod.tensorfl
+0001abd0: 6f77 2061 7320 6876 640a 0a20 2020 2020  ow as hvd..     
+0001abe0: 2020 2069 6620 6876 642e 7261 6e6b 2829     if hvd.rank()
+0001abf0: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
+0001ac00: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0001ac10: 2020 2020 6966 2063 6f6e 6669 672e 6973      if config.is
+0001ac20: 5f74 7275 6528 2264 7279 5f72 756e 2229  _true("dry_run")
+0001ac30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001ac40: 2046 616c 7365 0a20 2020 2072 6574 7572   False.    retur
+0001ac50: 6e20 5472 7565 0a0a 0a5f 6465 6661 756c  n True..._defaul
+0001ac60: 745f 676c 6f62 616c 5f69 6e66 5f76 616c  t_global_inf_val
+0001ac70: 7565 203d 2066 6c6f 6174 2822 696e 6622  ue = float("inf"
+0001ac80: 290a 0a0a 6465 6620 6765 745f 676c 6f62  )...def get_glob
+0001ac90: 616c 5f69 6e66 5f76 616c 7565 2829 202d  al_inf_value() -
+0001aca0: 3e20 666c 6f61 743a 0a20 2020 2022 2222  > float:.    """
+0001acb0: 0a20 2020 203a 7265 7475 726e 3a20 666c  .    :return: fl
+0001acc0: 6f61 7428 2269 6e66 2229 2062 7920 6465  oat("inf") by de
+0001acd0: 6661 756c 742c 2062 7574 2074 7269 6573  fault, but tries
+0001ace0: 2074 6f20 7265 6164 2060 696e 665f 7661   to read `inf_va
+0001acf0: 6c75 6560 2066 726f 6d20 7468 6520 676c  lue` from the gl
+0001ad00: 6f62 616c 2063 6f6e 6669 670a 2020 2020  obal config.    
+0001ad10: 2222 220a 2020 2020 6672 6f6d 2072 6574  """.    from ret
+0001ad20: 7572 6e6e 2e63 6f6e 6669 6720 696d 706f  urnn.config impo
+0001ad30: 7274 2067 6574 5f67 6c6f 6261 6c5f 636f  rt get_global_co
+0001ad40: 6e66 6967 0a0a 2020 2020 636f 6e66 6967  nfig..    config
+0001ad50: 203d 2067 6574 5f67 6c6f 6261 6c5f 636f   = get_global_co
+0001ad60: 6e66 6967 2872 6169 7365 5f65 7863 6570  nfig(raise_excep
+0001ad70: 7469 6f6e 3d46 616c 7365 290a 2020 2020  tion=False).    
+0001ad80: 6966 206e 6f74 2063 6f6e 6669 673a 0a20  if not config:. 
+0001ad90: 2020 2020 2020 2072 6574 7572 6e20 5f64         return _d
+0001ada0: 6566 6175 6c74 5f67 6c6f 6261 6c5f 696e  efault_global_in
+0001adb0: 665f 7661 6c75 650a 2020 2020 7265 7475  f_value.    retu
+0001adc0: 726e 2063 6f6e 6669 672e 666c 6f61 7428  rn config.float(
+0001add0: 2269 6e66 5f76 616c 7565 222c 205f 6465  "inf_value", _de
+0001ade0: 6661 756c 745f 676c 6f62 616c 5f69 6e66  fault_global_inf
+0001adf0: 5f76 616c 7565 290a 0a0a 636c 6173 7320  _value)...class 
+0001ae00: 4e61 7469 7665 436f 6465 436f 6d70 696c  NativeCodeCompil
+0001ae10: 6572 286f 626a 6563 7429 3a0a 2020 2020  er(object):.    
+0001ae20: 2222 220a 2020 2020 4865 6c70 6572 2063  """.    Helper c
+0001ae30: 6c61 7373 2074 6f20 636f 6d70 696c 6520  lass to compile 
+0001ae40: 6e61 7469 7665 2043 2f43 2b2b 2063 6f64  native C/C++ cod
+0001ae50: 6520 6f6e 2d74 6865 2d66 6c79 2e0a 2020  e on-the-fly..  
+0001ae60: 2020 2222 220a 0a20 2020 2043 6163 6865    """..    Cache
+0001ae70: 4469 724e 616d 6520 3d20 2272 6574 7572  DirName = "retur
+0001ae80: 6e6e 5f6e 6174 6976 6522 0a20 2020 2043  nn_native".    C
+0001ae90: 6f6c 6c65 6374 6564 436f 6d70 696c 6572  ollectedCompiler
+0001aea0: 7320 3d20 4e6f 6e65 2020 2320 7479 7065  s = None  # type
+0001aeb0: 3a20 7479 7069 6e67 2e4f 7074 696f 6e61  : typing.Optiona
+0001aec0: 6c5b 7479 7069 6e67 2e4c 6973 745b 4e61  l[typing.List[Na
+0001aed0: 7469 7665 436f 6465 436f 6d70 696c 6572  tiveCodeCompiler
+0001aee0: 5d5d 0a0a 2020 2020 6465 6620 5f5f 696e  ]]..    def __in
+0001aef0: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
+0001af00: 6c66 2c0a 2020 2020 2020 2020 6261 7365  lf,.        base
+0001af10: 5f6e 616d 652c 0a20 2020 2020 2020 2063  _name,.        c
+0001af20: 6f64 655f 7665 7273 696f 6e2c 0a20 2020  ode_version,.   
+0001af30: 2020 2020 2063 6f64 652c 0a20 2020 2020       code,.     
+0001af40: 2020 2069 735f 6370 703d 5472 7565 2c0a     is_cpp=True,.
+0001af50: 2020 2020 2020 2020 635f 6d61 6372 6f5f          c_macro_
+0001af60: 6465 6669 6e65 733d 4e6f 6e65 2c0a 2020  defines=None,.  
+0001af70: 2020 2020 2020 6c64 5f66 6c61 6773 3d4e        ld_flags=N
+0001af80: 6f6e 652c 0a20 2020 2020 2020 2069 6e63  one,.        inc
+0001af90: 6c75 6465 5f70 6174 6873 3d28 292c 0a20  lude_paths=(),. 
+0001afa0: 2020 2020 2020 2069 6e63 6c75 6465 5f64         include_d
+0001afb0: 6570 733d 4e6f 6e65 2c0a 2020 2020 2020  eps=None,.      
+0001afc0: 2020 7374 6174 6963 5f76 6572 7369 6f6e    static_version
+0001afd0: 5f6e 616d 653d 4e6f 6e65 2c0a 2020 2020  _name=None,.    
+0001afe0: 2020 2020 7368 6f75 6c64 5f63 6c65 616e      should_clean
+0001aff0: 7570 5f6f 6c64 5f61 6c6c 3d54 7275 652c  up_old_all=True,
+0001b000: 0a20 2020 2020 2020 2073 686f 756c 645f  .        should_
+0001b010: 636c 6561 6e75 705f 6f6c 645f 6d79 6469  cleanup_old_mydi
+0001b020: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
+0001b030: 2075 7365 5f63 7878 3131 5f61 6269 3d46   use_cxx11_abi=F
+0001b040: 616c 7365 2c0a 2020 2020 2020 2020 6c6f  alse,.        lo
+0001b050: 675f 7374 7265 616d 3d4e 6f6e 652c 0a20  g_stream=None,. 
+0001b060: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
+0001b070: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+0001b080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001b090: 203a 7061 7261 6d20 7374 7220 6261 7365   :param str base
+0001b0a0: 5f6e 616d 653a 2062 6173 6520 6e61 6d65  _name: base name
+0001b0b0: 2066 6f72 2074 6865 206d 6f64 756c 652c   for the module,
+0001b0c0: 2065 2e67 2e20 227a 6572 6f5f 6f75 7422   e.g. "zero_out"
+0001b0d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001b0e0: 696e 747c 7475 706c 655b 696e 745d 2063  int|tuple[int] c
+0001b0f0: 6f64 655f 7665 7273 696f 6e3a 2063 6865  ode_version: che
+0001b100: 636b 2066 6f72 2074 6865 2063 6163 6865  ck for the cache
+0001b110: 2077 6865 7468 6572 2074 6f20 7265 7573   whether to reus
+0001b120: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+0001b130: 2073 7472 2063 6f64 653a 2074 6865 2073   str code: the s
+0001b140: 6f75 7263 6520 636f 6465 2069 7473 656c  ource code itsel
+0001b150: 660a 2020 2020 2020 2020 3a70 6172 616d  f.        :param
+0001b160: 2062 6f6f 6c20 6973 5f63 7070 3a20 6966   bool is_cpp: if
+0001b170: 2046 616c 7365 2c20 4320 6973 2061 7373   False, C is ass
+0001b180: 756d 6564 0a20 2020 2020 2020 203a 7061  umed.        :pa
+0001b190: 7261 6d20 6469 6374 5b73 7472 2c73 7472  ram dict[str,str
+0001b1a0: 7c69 6e74 7c4e 6f6e 655d 7c4e 6f6e 6520  |int|None]|None 
+0001b1b0: 635f 6d61 6372 6f5f 6465 6669 6e65 733a  c_macro_defines:
+0001b1c0: 2065 2e67 2e20 7b22 5445 4e53 4f52 464c   e.g. {"TENSORFL
+0001b1d0: 4f57 223a 2031 7d0a 2020 2020 2020 2020  OW": 1}.        
+0001b1e0: 3a70 6172 616d 206c 6973 745b 7374 725d  :param list[str]
+0001b1f0: 7c4e 6f6e 6520 6c64 5f66 6c61 6773 3a20  |None ld_flags: 
+0001b200: 652e 672e 205b 222d 6c62 6c61 7322 5d0a  e.g. ["-lblas"].
+0001b210: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+0001b220: 6973 745b 7374 725d 7c74 7570 6c65 5b73  ist[str]|tuple[s
+0001b230: 7472 5d20 696e 636c 7564 655f 7061 7468  tr] include_path
+0001b240: 733a 0a20 2020 2020 2020 203a 7061 7261  s:.        :para
+0001b250: 6d20 6c69 7374 5b73 7472 5d7c 4e6f 6e65  m list[str]|None
+0001b260: 2069 6e63 6c75 6465 5f64 6570 733a 2069   include_deps: i
+0001b270: 6620 7072 6f76 6964 6564 2061 6e64 2061  f provided and a
+0001b280: 6e20 6578 6973 7469 6e67 206c 6962 2066  n existing lib f
+0001b290: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
+0001b2a0: 2077 6520 7769 6c6c 2063 6865 636b 2069   we will check i
+0001b2b0: 6620 616e 7920 6465 7065 6e64 656e 6379  f any dependency
+0001b2c0: 2069 7320 6e65 7765 720a 2020 2020 2020   is newer.      
+0001b2d0: 2020 2020 2020 616e 6420 7765 206e 6565        and we nee
+0001b2e0: 6420 746f 2072 6563 6f6d 7069 6c65 2e20  d to recompile. 
+0001b2f0: 7765 2063 6f75 6c64 2061 6c73 6f20 646f  we could also do
+0001b300: 2069 7420 6175 746f 6d61 7469 6361 6c6c   it automaticall
+0001b310: 7920 7669 6120 2d4d 4420 6275 7420 7468  y via -MD but th
+0001b320: 6174 2073 6565 6d73 206f 7665 726b 696c  at seems overkil
+0001b330: 6c20 616e 6420 746f 6f20 736c 6f77 2e0a  l and too slow..
+0001b340: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0001b350: 7472 7c4e 6f6e 6520 7374 6174 6963 5f76  tr|None static_v
+0001b360: 6572 7369 6f6e 5f6e 616d 653a 206e 6f72  ersion_name: nor
+0001b370: 6d61 6c6c 792c 2077 6520 7573 6520 2e2e  mally, we use ..
+0001b380: 2e2f 6261 7365 5f6e 616d 652f 6861 7368  ./base_name/hash
+0001b390: 2061 7320 7468 6520 6469 720a 2020 2020   as the dir.    
+0001b3a0: 2020 2020 2020 2020 6275 7420 7468 6973          but this
+0001b3b0: 2077 6f75 6c64 2075 7365 202e 2e2e 2f62   would use .../b
+0001b3c0: 6173 655f 6e61 6d65 2f73 7461 7469 635f  ase_name/static_
+0001b3d0: 7665 7273 696f 6e5f 6e61 6d65 2e0a 2020  version_name..  
+0001b3e0: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
+0001b3f0: 6c20 7368 6f75 6c64 5f63 6c65 616e 7570  l should_cleanup
+0001b400: 5f6f 6c64 5f61 6c6c 3a20 7768 6574 6865  _old_all: whethe
+0001b410: 7220 7765 2073 686f 756c 6420 6c6f 6f6b  r we should look
+0001b420: 2069 6e20 7468 6520 6361 6368 6520 6469   in the cache di
+0001b430: 720a 2020 2020 2020 2020 2020 2020 616e  r.            an
+0001b440: 6420 6368 6563 6b20 616c 6c20 6f70 7320  d check all ops 
+0001b450: 6966 2077 6520 6361 6e20 6465 6c65 7465  if we can delete
+0001b460: 2073 6f6d 6520 6f6c 6420 6f6e 6573 2077   some old ones w
+0001b470: 6869 6368 2061 7265 206f 6c64 6572 2074  hich are older t
+0001b480: 6861 6e20 736f 6d65 206c 696d 6974 0a20  han some limit. 
+0001b490: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
+0001b4a0: 2e5f 636c 6561 6e75 705f 7469 6d65 5f6c  ._cleanup_time_l
+0001b4b0: 696d 6974 5f64 6179 7329 0a20 2020 2020  imit_days).     
+0001b4c0: 2020 203a 7061 7261 6d20 626f 6f6c 2073     :param bool s
+0001b4d0: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
+0001b4e0: 645f 6d79 6469 723a 2077 6865 7468 6572  d_mydir: whether
+0001b4f0: 2077 6520 7368 6f75 6c64 2064 656c 6574   we should delet
+0001b500: 6520 6f75 7220 6f70 2064 6972 2062 6566  e our op dir bef
+0001b510: 6f72 6520 7765 2063 6f6d 7069 6c65 2074  ore we compile t
+0001b520: 6865 7265 2e0a 2020 2020 2020 2020 3a70  here..        :p
+0001b530: 6172 616d 2074 7970 696e 672e 5465 7874  aram typing.Text
+0001b540: 494f 7c4e 6f6e 6520 6c6f 675f 7374 7265  IO|None log_stre
+0001b550: 616d 3a20 6669 6c65 2073 7472 6561 6d20  am: file stream 
+0001b560: 666f 7220 7072 696e 7420 7374 6174 656d  for print statem
+0001b570: 656e 7473 0a20 2020 2020 2020 203a 7061  ents.        :pa
+0001b580: 7261 6d20 626f 6f6c 2076 6572 626f 7365  ram bool verbose
+0001b590: 3a20 6265 2073 6c69 6768 746c 7920 6d6f  : be slightly mo
+0001b5a0: 7265 2076 6572 626f 7365 0a20 2020 2020  re verbose.     
+0001b5b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0001b5c0: 6620 7365 6c66 2e43 6f6c 6c65 6374 6564  f self.Collected
+0001b5d0: 436f 6d70 696c 6572 7320 6973 206e 6f74  Compilers is not
+0001b5e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001b5f0: 2020 2073 656c 662e 436f 6c6c 6563 7465     self.Collecte
+0001b600: 6443 6f6d 7069 6c65 7273 2e61 7070 656e  dCompilers.appen
+0001b610: 6428 7365 6c66 290a 2020 2020 2020 2020  d(self).        
+0001b620: 7365 6c66 2e76 6572 626f 7365 203d 2076  self.verbose = v
+0001b630: 6572 626f 7365 0a20 2020 2020 2020 2073  erbose.        s
+0001b640: 656c 662e 6361 6368 655f 6469 7220 3d20  elf.cache_dir = 
+0001b650: 2225 732f 2573 2220 2520 2867 6574 5f63  "%s/%s" % (get_c
+0001b660: 6163 6865 5f64 6972 2829 2c20 7365 6c66  ache_dir(), self
+0001b670: 2e43 6163 6865 4469 724e 616d 6529 0a20  .CacheDirName). 
+0001b680: 2020 2020 2020 2073 656c 662e 5f69 6e63         self._inc
+0001b690: 6c75 6465 5f70 6174 6873 203d 206c 6973  lude_paths = lis
+0001b6a0: 7428 696e 636c 7564 655f 7061 7468 7329  t(include_paths)
+0001b6b0: 0a20 2020 2020 2020 2073 656c 662e 6261  .        self.ba
+0001b6c0: 7365 5f6e 616d 6520 3d20 6261 7365 5f6e  se_name = base_n
+0001b6d0: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
+0001b6e0: 2e63 6f64 655f 7665 7273 696f 6e20 3d20  .code_version = 
+0001b6f0: 636f 6465 5f76 6572 7369 6f6e 0a20 2020  code_version.   
+0001b700: 2020 2020 2073 656c 662e 636f 6465 203d       self.code =
+0001b710: 2063 6f64 650a 2020 2020 2020 2020 7365   code.        se
+0001b720: 6c66 2e69 735f 6370 7020 3d20 6973 5f63  lf.is_cpp = is_c
+0001b730: 7070 0a20 2020 2020 2020 2073 656c 662e  pp.        self.
+0001b740: 635f 6d61 6372 6f5f 6465 6669 6e65 7320  c_macro_defines 
+0001b750: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+0001b760: 2069 6e20 2863 5f6d 6163 726f 5f64 6566   in (c_macro_def
+0001b770: 696e 6573 206f 7220 7b7d 292e 6974 656d  ines or {}).item
+0001b780: 7328 2920 6966 2076 2069 7320 6e6f 7420  s() if v is not 
+0001b790: 4e6f 6e65 7d0a 2020 2020 2020 2020 7365  None}.        se
+0001b7a0: 6c66 2e6c 645f 666c 6167 7320 3d20 6c64  lf.ld_flags = ld
+0001b7b0: 5f66 6c61 6773 206f 7220 5b5d 0a20 2020  _flags or [].   
+0001b7c0: 2020 2020 2073 656c 662e 696e 636c 7564       self.includ
+0001b7d0: 655f 6465 7073 203d 2069 6e63 6c75 6465  e_deps = include
+0001b7e0: 5f64 6570 730a 2020 2020 2020 2020 7365  _deps.        se
+0001b7f0: 6c66 2e73 7461 7469 635f 7665 7273 696f  lf.static_versio
+0001b800: 6e5f 6e61 6d65 203d 2073 7461 7469 635f  n_name = static_
+0001b810: 7665 7273 696f 6e5f 6e61 6d65 0a20 2020  version_name.   
+0001b820: 2020 2020 2073 656c 662e 5f63 6f64 655f       self._code_
+0001b830: 6861 7368 203d 2073 656c 662e 5f6d 616b  hash = self._mak
+0001b840: 655f 636f 6465 5f68 6173 6828 290a 2020  e_code_hash().  
+0001b850: 2020 2020 2020 7365 6c66 2e5f 696e 666f        self._info
+0001b860: 5f64 6963 7420 3d20 7365 6c66 2e5f 6d61  _dict = self._ma
+0001b870: 6b65 5f69 6e66 6f5f 6469 6374 2829 0a20  ke_info_dict(). 
+0001b880: 2020 2020 2020 2073 656c 662e 5f68 6173         self._has
+0001b890: 6820 3d20 7365 6c66 2e5f 6d61 6b65 5f68  h = self._make_h
+0001b8a0: 6173 6828 290a 2020 2020 2020 2020 7365  ash().        se
+0001b8b0: 6c66 2e5f 6374 7970 6573 5f6c 6962 203d  lf._ctypes_lib =
+0001b8c0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+0001b8d0: 2073 686f 756c 645f 636c 6561 6e75 705f   should_cleanup_
+0001b8e0: 6f6c 645f 616c 6c3a 0a20 2020 2020 2020  old_all:.       
+0001b8f0: 2020 2020 2073 656c 662e 5f63 6c65 616e       self._clean
+0001b900: 7570 5f6f 6c64 2829 0a20 2020 2020 2020  up_old().       
+0001b910: 2073 656c 662e 5f73 686f 756c 645f 636c   self._should_cl
+0001b920: 6561 6e75 705f 6f6c 645f 6d79 6469 7220  eanup_old_mydir 
+0001b930: 3d20 7368 6f75 6c64 5f63 6c65 616e 7570  = should_cleanup
+0001b940: 5f6f 6c64 5f6d 7964 6972 0a20 2020 2020  _old_mydir.     
+0001b950: 2020 2073 656c 662e 7573 655f 6378 7831     self.use_cxx1
+0001b960: 315f 6162 6920 3d20 7573 655f 6378 7831  1_abi = use_cxx1
+0001b970: 315f 6162 690a 2020 2020 2020 2020 7365  1_abi.        se
+0001b980: 6c66 2e5f 6c6f 675f 7374 7265 616d 203d  lf._log_stream =
+0001b990: 206c 6f67 5f73 7472 6561 6d0a 2020 2020   log_stream.    
+0001b9a0: 2020 2020 6966 2073 656c 662e 7665 7262      if self.verb
+0001b9b0: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
+0001b9c0: 2070 7269 6e74 2822 2573 3a20 2572 2220   print("%s: %r" 
+0001b9d0: 2520 2873 656c 662e 5f5f 636c 6173 735f  % (self.__class_
+0001b9e0: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365 6c66  _.__name__, self
+0001b9f0: 292c 2066 696c 653d 6c6f 675f 7374 7265  ), file=log_stre
+0001ba00: 616d 290a 0a20 2020 2064 6566 205f 5f72  am)..    def __r
+0001ba10: 6570 725f 5f28 7365 6c66 293a 0a20 2020  epr__(self):.   
+0001ba20: 2020 2020 2072 6574 7572 6e20 223c 2573       return "<%s
+0001ba30: 2025 7220 696e 2025 723e 2220 2520 2873   %r in %r>" % (s
+0001ba40: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+0001ba50: 6e61 6d65 5f5f 2c20 7365 6c66 2e62 6173  name__, self.bas
+0001ba60: 655f 6e61 6d65 2c20 7365 6c66 2e5f 6d6f  e_name, self._mo
+0001ba70: 645f 7061 7468 290a 0a20 2020 2040 7072  d_path)..    @pr
+0001ba80: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
+0001ba90: 6d6f 645f 7061 7468 2873 656c 6629 3a0a  mod_path(self):.
+0001baa0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0001bab0: 2573 2f25 732f 2573 2220 2520 2873 656c  %s/%s/%s" % (sel
+0001bac0: 662e 6361 6368 655f 6469 722c 2073 656c  f.cache_dir, sel
+0001bad0: 662e 6261 7365 5f6e 616d 652c 2073 656c  f.base_name, sel
+0001bae0: 662e 7374 6174 6963 5f76 6572 7369 6f6e  f.static_version
+0001baf0: 5f6e 616d 6520 6f72 2073 656c 662e 5f68  _name or self._h
+0001bb00: 6173 685b 3a31 305d 290a 0a20 2020 2040  ash[:10])..    @
+0001bb10: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+0001bb20: 205f 696e 666f 5f66 696c 656e 616d 6528   _info_filename(
+0001bb30: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0001bb40: 6574 7572 6e20 2225 732f 696e 666f 2e70  eturn "%s/info.p
+0001bb50: 7922 2025 2028 7365 6c66 2e5f 6d6f 645f  y" % (self._mod_
+0001bb60: 7061 7468 2c29 0a0a 2020 2020 4070 726f  path,)..    @pro
+0001bb70: 7065 7274 790a 2020 2020 6465 6620 5f73  perty.    def _s
+0001bb80: 6f5f 6669 6c65 6e61 6d65 2873 656c 6629  o_filename(self)
+0001bb90: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001bba0: 2022 2573 2f25 732e 736f 2220 2520 2873   "%s/%s.so" % (s
+0001bbb0: 656c 662e 5f6d 6f64 5f70 6174 682c 2073  elf._mod_path, s
+0001bbc0: 656c 662e 6261 7365 5f6e 616d 6529 0a0a  elf.base_name)..
+0001bbd0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0001bbe0: 2020 6465 6620 5f63 5f66 696c 656e 616d    def _c_filenam
+0001bbf0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001bc00: 2069 6620 7365 6c66 2e69 735f 6370 703a   if self.is_cpp:
+0001bc10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001bc20: 7572 6e20 2225 732f 2573 2e63 6322 2025  urn "%s/%s.cc" %
+0001bc30: 2028 7365 6c66 2e5f 6d6f 645f 7061 7468   (self._mod_path
+0001bc40: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
+0001bc50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001bc60: 2022 2573 2f25 732e 6322 2025 2028 7365   "%s/%s.c" % (se
+0001bc70: 6c66 2e5f 6d6f 645f 7061 7468 2c20 7365  lf._mod_path, se
+0001bc80: 6c66 2e62 6173 655f 6e61 6d65 290a 0a20  lf.base_name).. 
+0001bc90: 2020 205f 636c 6561 6e75 705f 7469 6d65     _cleanup_time
+0001bca0: 5f6c 696d 6974 5f64 6179 7320 3d20 3630  _limit_days = 60
+0001bcb0: 0a0a 2020 2020 6465 6620 5f63 6c65 616e  ..    def _clean
+0001bcc0: 7570 5f6f 6c64 2873 656c 6629 3a0a 2020  up_old(self):.  
+0001bcd0: 2020 2020 2020 6d6f 645f 7061 7468 203d        mod_path =
+0001bce0: 2073 656c 662e 5f6d 6f64 5f70 6174 6820   self._mod_path 
+0001bcf0: 2023 202e 2e2e 2f62 6173 655f 6e61 6d65   # .../base_name
+0001bd00: 2f68 6173 680a 2020 2020 2020 2020 6261  /hash.        ba
+0001bd10: 7365 5f6d 6f64 5f70 6174 6820 3d20 6f73  se_mod_path = os
+0001bd20: 2e70 6174 682e 6469 726e 616d 6528 6d6f  .path.dirname(mo
+0001bd30: 645f 7061 7468 2920 2023 202e 2e2e 2f62  d_path)  # .../b
+0001bd40: 6173 655f 6e61 6d65 0a20 2020 2020 2020  ase_name.       
+0001bd50: 206d 795f 6d6f 645f 7061 7468 5f6e 616d   my_mod_path_nam
+0001bd60: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+0001bd70: 6e61 6d65 286d 6f64 5f70 6174 6829 0a20  name(mod_path). 
+0001bd80: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+0001bd90: 2e70 6174 682e 6578 6973 7473 2862 6173  .path.exists(bas
+0001bda0: 655f 6d6f 645f 7061 7468 293a 0a20 2020  e_mod_path):.   
+0001bdb0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001bdc0: 2020 2020 2020 2020 696d 706f 7274 2074          import t
+0001bdd0: 696d 650a 0a20 2020 2020 2020 2063 6c65  ime..        cle
+0001bde0: 616e 7570 5f74 696d 655f 6c69 6d69 745f  anup_time_limit_
+0001bdf0: 7365 6373 203d 2073 656c 662e 5f63 6c65  secs = self._cle
+0001be00: 616e 7570 5f74 696d 655f 6c69 6d69 745f  anup_time_limit_
+0001be10: 6461 7973 202a 2032 3420 2a20 3630 202a  days * 24 * 60 *
+0001be20: 2036 300a 2020 2020 2020 2020 666f 7220   60.        for 
+0001be30: 7020 696e 206f 732e 6c69 7374 6469 7228  p in os.listdir(
+0001be40: 6261 7365 5f6d 6f64 5f70 6174 6829 3a0a  base_mod_path):.
+0001be50: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0001be60: 203d 3d20 6d79 5f6d 6f64 5f70 6174 685f   == my_mod_path_
+0001be70: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0001be80: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001be90: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+0001bea0: 6469 725f 7061 7468 203d 2022 2573 2f25  dir_path = "%s/%
+0001beb0: 7322 2025 2028 6261 7365 5f6d 6f64 5f70  s" % (base_mod_p
+0001bec0: 6174 682c 2070 290a 2020 2020 2020 2020  ath, p).        
+0001bed0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+0001bee0: 7468 2e69 7364 6972 2866 756c 6c5f 6469  th.isdir(full_di
+0001bef0: 725f 7061 7468 293a 0a20 2020 2020 2020  r_path):.       
+0001bf00: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0001bf10: 6520 2023 2069 676e 6f72 6520 666f 7220  e  # ignore for 
+0001bf20: 6e6f 770a 2020 2020 2020 2020 2020 2020  now.            
+0001bf30: 6c6f 636b 203d 204c 6f63 6b46 696c 6528  lock = LockFile(
+0001bf40: 6675 6c6c 5f64 6972 5f70 6174 6829 0a20  full_dir_path). 
+0001bf50: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
+0001bf60: 636b 2e69 735f 6c6f 636b 6564 2829 3a0a  ck.is_locked():.
+0001bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf80: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001bf90: 2020 2020 206c 6f63 6b2e 6d61 7962 655f       lock.maybe_
+0001bfa0: 7265 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66  remove_old_lockf
+0001bfb0: 696c 6528 290a 2020 2020 2020 2020 2020  ile().          
+0001bfc0: 2020 696e 666f 5f70 6174 6820 3d20 2225    info_path = "%
+0001bfd0: 732f 696e 666f 2e70 7922 2025 2066 756c  s/info.py" % ful
+0001bfe0: 6c5f 6469 725f 7061 7468 0a20 2020 2020  l_dir_path.     
+0001bff0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+0001c000: 2e70 6174 682e 6578 6973 7473 2869 6e66  .path.exists(inf
+0001c010: 6f5f 7061 7468 293a 0a20 2020 2020 2020  o_path):.       
+0001c020: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0001c030: 6c65 616e 7570 5f6f 6c64 5f70 6174 6828  leanup_old_path(
+0001c040: 6675 6c6c 5f64 6972 5f70 6174 682c 2072  full_dir_path, r
+0001c050: 6561 736f 6e3d 2263 6f72 7275 7074 2064  eason="corrupt d
+0001c060: 6972 2c20 6d69 7373 696e 6720 696e 666f  ir, missing info
+0001c070: 2e70 7922 290a 2020 2020 2020 2020 2020  .py").          
+0001c080: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001c090: 2020 2020 2020 2020 2020 2073 6f5f 7061             so_pa
+0001c0a0: 7468 203d 2022 2573 2f25 732e 736f 2220  th = "%s/%s.so" 
+0001c0b0: 2520 2866 756c 6c5f 6469 725f 7061 7468  % (full_dir_path
+0001c0c0: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
+0001c0d0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001c0e0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+0001c0f0: 7374 7328 736f 5f70 6174 6829 3a0a 2020  sts(so_path):.  
+0001c100: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001c110: 6c66 2e5f 636c 6561 6e75 705f 6f6c 645f  lf._cleanup_old_
+0001c120: 7061 7468 2866 756c 6c5f 6469 725f 7061  path(full_dir_pa
+0001c130: 7468 2c20 7265 6173 6f6e 3d22 636f 7272  th, reason="corr
+0001c140: 7570 7420 6469 722c 206d 6973 7369 6e67  upt dir, missing
+0001c150: 2073 6f22 290a 2020 2020 2020 2020 2020   so").          
+0001c160: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001c170: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
+0001c180: 7469 6d65 2e74 696d 6528 2920 2d20 6f73  time.time() - os
+0001c190: 2e70 6174 682e 6765 746d 7469 6d65 2873  .path.getmtime(s
+0001c1a0: 6f5f 7061 7468 290a 2020 2020 2020 2020  o_path).        
+0001c1b0: 2020 2020 6966 2064 7420 3e20 636c 6561      if dt > clea
+0001c1c0: 6e75 705f 7469 6d65 5f6c 696d 6974 5f73  nup_time_limit_s
+0001c1d0: 6563 733a 0a20 2020 2020 2020 2020 2020  ecs:.           
+0001c1e0: 2020 2020 2073 656c 662e 5f63 6c65 616e       self._clean
+0001c1f0: 7570 5f6f 6c64 5f70 6174 6828 6675 6c6c  up_old_path(full
+0001c200: 5f64 6972 5f70 6174 682c 2072 6561 736f  _dir_path, reaso
+0001c210: 6e3d 2225 7320 6f6c 6422 2025 2068 6d73  n="%s old" % hms
+0001c220: 2864 7429 290a 0a20 2020 2064 6566 205f  (dt))..    def _
+0001c230: 636c 6561 6e75 705f 6f6c 645f 7061 7468  cleanup_old_path
+0001c240: 2873 656c 662c 2070 2c20 7265 6173 6f6e  (self, p, reason
+0001c250: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
+0001c260: 2822 2573 2064 656c 6574 6520 6f6c 642c  ("%s delete old,
+0001c270: 2025 733a 2025 7322 2025 2028 7365 6c66   %s: %s" % (self
+0001c280: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+0001c290: 655f 5f2c 2072 6561 736f 6e2c 2070 2929  e__, reason, p))
+0001c2a0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0001c2b0: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
+0001c2c0: 290a 2020 2020 2020 2020 696d 706f 7274  ).        import
+0001c2d0: 2073 6875 7469 6c0a 0a20 2020 2020 2020   shutil..       
+0001c2e0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0001c2f0: 2020 7368 7574 696c 2e72 6d74 7265 6528    shutil.rmtree(
+0001c300: 7029 0a20 2020 2020 2020 2065 7863 6570  p).        excep
+0001c310: 7420 4f53 4572 726f 7220 6173 2065 7863  t OSError as exc
+0001c320: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0001c330: 696e 7428 2225 7320 6465 6c65 7465 2065  int("%s delete e
+0001c340: 7863 6570 7469 6f6e 2028 2573 292e 2057  xception (%s). W
+0001c350: 696c 6c20 6967 6e6f 7265 2061 6e64 2074  ill ignore and t
+0001c360: 7279 2074 6f20 636f 6e74 696e 7565 2061  ry to continue a
+0001c370: 6e79 7761 792e 2220 2520 2873 656c 662e  nyway." % (self.
+0001c380: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001c390: 5f5f 2c20 6578 6329 290a 0a20 2020 2064  __, exc))..    d
+0001c3a0: 6566 205f 6c6f 6164 5f69 6e66 6f28 7365  ef _load_info(se
+0001c3b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0001c3c0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+0001c3d0: 2064 6963 745b 7374 725d 7c4e 6f6e 650a   dict[str]|None.
+0001c3e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001c3f0: 2020 2020 6669 6c65 6e61 6d65 203d 2073      filename = s
+0001c400: 656c 662e 5f69 6e66 6f5f 6669 6c65 6e61  elf._info_filena
+0001c410: 6d65 0a20 2020 2020 2020 2069 6620 6e6f  me.        if no
+0001c420: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+0001c430: 2866 696c 656e 616d 6529 3a0a 2020 2020  (filename):.    
+0001c440: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001c450: 6f6e 650a 2020 2020 2020 2020 7320 3d20  one.        s = 
+0001c460: 6f70 656e 2866 696c 656e 616d 6529 2e72  open(filename).r
+0001c470: 6561 6428 290a 2020 2020 2020 2020 7265  ead().        re
+0001c480: 7320 3d20 6576 616c 2873 290a 2020 2020  s = eval(s).    
+0001c490: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+0001c4a0: 7461 6e63 6528 7265 732c 2064 6963 7429  tance(res, dict)
+0001c4b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001c4c0: 7265 730a 0a20 2020 205f 7265 6c65 7661  res..    _releva
+0001c4d0: 6e74 5f69 6e66 6f5f 6b65 7973 203d 2028  nt_info_keys = (
+0001c4e0: 2263 6f64 655f 7665 7273 696f 6e22 2c20  "code_version", 
+0001c4f0: 2263 6f64 655f 6861 7368 222c 2022 635f  "code_hash", "c_
+0001c500: 6d61 6372 6f5f 6465 6669 6e65 7322 2c20  macro_defines", 
+0001c510: 226c 645f 666c 6167 7322 2c20 2263 6f6d  "ld_flags", "com
+0001c520: 7069 6c65 725f 6269 6e22 290a 0a20 2020  piler_bin")..   
+0001c530: 2064 6566 205f 6d61 6b65 5f69 6e66 6f5f   def _make_info_
+0001c540: 6469 6374 2873 656c 6629 3a0a 2020 2020  dict(self):.    
+0001c550: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001c560: 3a72 7479 7065 3a20 6469 6374 5b73 7472  :rtype: dict[str
+0001c570: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
+0001c580: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
+0001c590: 2020 2020 2020 2020 2020 2022 6261 7365             "base
+0001c5a0: 5f6e 616d 6522 3a20 7365 6c66 2e62 6173  _name": self.bas
+0001c5b0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+0001c5c0: 2020 2020 2269 6e63 6c75 6465 5f70 6174      "include_pat
+0001c5d0: 6873 223a 2073 656c 662e 5f69 6e63 6c75  hs": self._inclu
+0001c5e0: 6465 5f70 6174 6873 2c0a 2020 2020 2020  de_paths,.      
+0001c5f0: 2020 2020 2020 2263 6f64 655f 7665 7273        "code_vers
+0001c600: 696f 6e22 3a20 7365 6c66 2e63 6f64 655f  ion": self.code_
+0001c610: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
+0001c620: 2020 2020 2022 636f 6465 5f68 6173 6822       "code_hash"
+0001c630: 3a20 7365 6c66 2e5f 636f 6465 5f68 6173  : self._code_has
+0001c640: 682c 0a20 2020 2020 2020 2020 2020 2022  h,.            "
+0001c650: 635f 6d61 6372 6f5f 6465 6669 6e65 7322  c_macro_defines"
+0001c660: 3a20 7365 6c66 2e63 5f6d 6163 726f 5f64  : self.c_macro_d
+0001c670: 6566 696e 6573 2c0a 2020 2020 2020 2020  efines,.        
+0001c680: 2020 2020 226c 645f 666c 6167 7322 3a20      "ld_flags": 
+0001c690: 7365 6c66 2e6c 645f 666c 6167 732c 0a20  self.ld_flags,. 
+0001c6a0: 2020 2020 2020 2020 2020 2022 636f 6d70             "comp
+0001c6b0: 696c 6572 5f62 696e 223a 2073 656c 662e  iler_bin": self.
+0001c6c0: 5f67 6574 5f63 6f6d 7069 6c65 725f 6269  _get_compiler_bi
+0001c6d0: 6e28 292c 0a20 2020 2020 2020 207d 0a0a  n(),.        }..
+0001c6e0: 2020 2020 6465 6620 5f6d 616b 655f 636f      def _make_co
+0001c6f0: 6465 5f68 6173 6828 7365 6c66 293a 0a20  de_hash(self):. 
+0001c700: 2020 2020 2020 2069 6d70 6f72 7420 6861         import ha
+0001c710: 7368 6c69 620a 0a20 2020 2020 2020 2068  shlib..        h
+0001c720: 203d 2068 6173 686c 6962 2e6d 6435 2829   = hashlib.md5()
+0001c730: 0a20 2020 2020 2020 2068 2e75 7064 6174  .        h.updat
+0001c740: 6528 7365 6c66 2e63 6f64 652e 656e 636f  e(self.code.enco
+0001c750: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
+0001c760: 2020 2020 7265 7475 726e 2068 2e68 6578      return h.hex
+0001c770: 6469 6765 7374 2829 0a0a 2020 2020 6465  digest()..    de
+0001c780: 6620 5f6d 616b 655f 6861 7368 2873 656c  f _make_hash(sel
+0001c790: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
+0001c7a0: 7274 2068 6173 686c 6962 0a0a 2020 2020  rt hashlib..    
+0001c7b0: 2020 2020 6820 3d20 6861 7368 6c69 622e      h = hashlib.
+0001c7c0: 6d64 3528 290a 2020 2020 2020 2020 682e  md5().        h.
+0001c7d0: 7570 6461 7465 2822 7b22 2e65 6e63 6f64  update("{".encod
+0001c7e0: 6528 2275 7466 3822 2929 0a20 2020 2020  e("utf8")).     
+0001c7f0: 2020 2066 6f72 206b 6579 2069 6e20 7365     for key in se
+0001c800: 6c66 2e5f 7265 6c65 7661 6e74 5f69 6e66  lf._relevant_inf
+0001c810: 6f5f 6b65 7973 3a0a 2020 2020 2020 2020  o_keys:.        
+0001c820: 2020 2020 682e 7570 6461 7465 2828 2225      h.update(("%
+0001c830: 733a 7b25 737d 2220 2520 286b 6579 2c20  s:{%s}" % (key, 
+0001c840: 7365 6c66 2e5f 696e 666f 5f64 6963 745b  self._info_dict[
+0001c850: 6b65 795d 2929 2e65 6e63 6f64 6528 2275  key])).encode("u
+0001c860: 7466 3822 2929 0a20 2020 2020 2020 2068  tf8")).        h
+0001c870: 2e75 7064 6174 6528 227d 222e 656e 636f  .update("}".enco
+0001c880: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
+0001c890: 2020 2020 7265 7475 726e 2068 2e68 6578      return h.hex
+0001c8a0: 6469 6765 7374 2829 0a0a 2020 2020 6465  digest()..    de
+0001c8b0: 6620 5f73 6176 655f 696e 666f 2873 656c  f _save_info(sel
+0001c8c0: 6629 3a0a 2020 2020 2020 2020 6669 6c65  f):.        file
+0001c8d0: 6e61 6d65 203d 2073 656c 662e 5f69 6e66  name = self._inf
+0001c8e0: 6f5f 6669 6c65 6e61 6d65 0a20 2020 2020  o_filename.     
+0001c8f0: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
+0001c900: 656e 616d 652c 2022 7722 2920 6173 2066  ename, "w") as f
+0001c910: 3a0a 2020 2020 2020 2020 2020 2020 662e  :.            f.
+0001c920: 7772 6974 6528 2225 735c 6e22 2025 2062  write("%s\n" % b
+0001c930: 6574 7465 725f 7265 7072 2873 656c 662e  etter_repr(self.
+0001c940: 5f69 6e66 6f5f 6469 6374 2929 0a0a 2020  _info_dict))..  
+0001c950: 2020 6465 6620 5f6e 6565 645f 7265 636f    def _need_reco
+0001c960: 6d70 696c 6528 7365 6c66 293a 0a20 2020  mpile(self):.   
+0001c970: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001c980: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+0001c990: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001c9a0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+0001c9b0: 2e65 7869 7374 7328 7365 6c66 2e5f 736f  .exists(self._so
+0001c9c0: 5f66 696c 656e 616d 6529 3a0a 2020 2020  _filename):.    
+0001c9d0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001c9e0: 7275 650a 2020 2020 2020 2020 6966 2073  rue.        if s
+0001c9f0: 656c 662e 696e 636c 7564 655f 6465 7073  elf.include_deps
+0001ca00: 3a0a 2020 2020 2020 2020 2020 2020 736f  :.            so
+0001ca10: 5f6d 7469 6d65 203d 206f 732e 7061 7468  _mtime = os.path
+0001ca20: 2e67 6574 6d74 696d 6528 7365 6c66 2e5f  .getmtime(self._
+0001ca30: 736f 5f66 696c 656e 616d 6529 0a20 2020  so_filename).   
+0001ca40: 2020 2020 2020 2020 2066 6f72 2066 6e20           for fn 
+0001ca50: 696e 2073 656c 662e 696e 636c 7564 655f  in self.include_
+0001ca60: 6465 7073 3a0a 2020 2020 2020 2020 2020  deps:.          
+0001ca70: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+0001ca80: 2e67 6574 6d74 696d 6528 666e 2920 3e20  .getmtime(fn) > 
+0001ca90: 736f 5f6d 7469 6d65 3a0a 2020 2020 2020  so_mtime:.      
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001cab0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0001cac0: 2020 6f6c 645f 696e 666f 203d 2073 656c    old_info = sel
+0001cad0: 662e 5f6c 6f61 645f 696e 666f 2829 0a20  f._load_info(). 
+0001cae0: 2020 2020 2020 206e 6577 5f69 6e66 6f20         new_info 
+0001caf0: 3d20 7365 6c66 2e5f 6d61 6b65 5f69 6e66  = self._make_inf
+0001cb00: 6f5f 6469 6374 2829 0a20 2020 2020 2020  o_dict().       
+0001cb10: 2069 6620 6e6f 7420 6f6c 645f 696e 666f   if not old_info
+0001cb20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001cb30: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0001cb40: 2020 2320 5468 6520 6861 7368 2061 6c72    # The hash alr
+0001cb50: 6561 6479 206d 6174 6368 6564 2062 7574  eady matched but
+0001cb60: 2076 6572 7920 756e 6c69 6b65 6c79 2c20   very unlikely, 
+0001cb70: 7468 6973 2063 6f75 6c64 2062 6520 6120  this could be a 
+0001cb80: 636f 6c6c 6973 696f 6e2e 0a20 2020 2020  collision..     
+0001cb90: 2020 2023 2041 6e79 7761 792c 206a 7573     # Anyway, jus
+0001cba0: 7420 646f 2074 6869 7320 7665 7279 2063  t do this very c
+0001cbb0: 6865 6170 2063 6865 636b 2e0a 2020 2020  heap check..    
+0001cbc0: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
+0001cbd0: 656c 662e 5f72 656c 6576 616e 745f 696e  elf._relevant_in
+0001cbe0: 666f 5f6b 6579 733a 0a20 2020 2020 2020  fo_keys:.       
+0001cbf0: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+0001cc00: 696e 206f 6c64 5f69 6e66 6f3a 0a20 2020  in old_info:.   
+0001cc10: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001cc20: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+0001cc30: 2020 2020 2069 6620 6f6c 645f 696e 666f       if old_info
+0001cc40: 5b6b 6579 5d20 213d 206e 6577 5f69 6e66  [key] != new_inf
+0001cc50: 6f5b 6b65 795d 3a0a 2020 2020 2020 2020  o[key]:.        
+0001cc60: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001cc70: 7275 650a 2020 2020 2020 2020 2320 4966  rue.        # If
+0001cc80: 206e 6f20 636f 6465 2076 6572 7369 6f6e   no code version
+0001cc90: 2069 7320 7072 6f76 6964 6564 2c20 7765   is provided, we
+0001cca0: 2063 6f75 6c64 2061 6c73 6f20 6368 6563   could also chec
+0001ccb0: 6b20 7468 6520 636f 6465 2069 7473 656c  k the code itsel
+0001ccc0: 6620 6e6f 772e 0a20 2020 2020 2020 2023  f now..        #
+0001ccd0: 2042 7574 2049 2074 6869 6e6b 2074 6869   But I think thi
+0001cce0: 7320 6973 206f 7665 726b 696c 6c2e 0a20  s is overkill.. 
+0001ccf0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0001cd00: 6c73 650a 0a20 2020 2064 6566 205f 6d61  lse..    def _ma
+0001cd10: 7962 655f 636f 6d70 696c 6528 7365 6c66  ybe_compile(self
+0001cd20: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001cd30: 2020 2020 2020 204f 6e20 7375 6363 6573         On succes
+0001cd40: 7366 756c 2072 6574 7572 6e2c 2073 656c  sful return, sel
+0001cd50: 662e 5f73 6f5f 6669 6c65 6e61 6d65 2073  f._so_filename s
+0001cd60: 686f 756c 6420 6578 6973 7420 616e 6420  hould exist and 
+0001cd70: 6265 2075 702d 746f 2d64 6174 652e 0a20  be up-to-date.. 
+0001cd80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001cd90: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+0001cda0: 6e65 6564 5f72 6563 6f6d 7069 6c65 2829  need_recompile()
+0001cdb0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001cdc0: 2073 656c 662e 7665 7262 6f73 653a 0a20   self.verbose:. 
+0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001cde0: 7269 6e74 2822 2573 3a20 4e6f 206e 6565  rint("%s: No nee
+0001cdf0: 6420 746f 2072 6563 6f6d 7069 6c65 3a20  d to recompile: 
+0001ce00: 2573 2220 2520 2873 656c 662e 5f5f 636c  %s" % (self.__cl
+0001ce10: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
+0001ce20: 7365 6c66 2e5f 736f 5f66 696c 656e 616d  self._so_filenam
+0001ce30: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+0001ce40: 2320 546f 7563 6820 6974 2073 6f20 7468  # Touch it so th
+0001ce50: 6174 2077 6520 6361 6e20 7365 6520 7468  at we can see th
+0001ce60: 6174 2077 6520 7573 6564 2069 7420 7265  at we used it re
+0001ce70: 6365 6e74 6c79 2e0a 2020 2020 2020 2020  cently..        
+0001ce80: 2020 2020 6f73 2e75 7469 6d65 2873 656c      os.utime(sel
+0001ce90: 662e 5f69 6e66 6f5f 6669 6c65 6e61 6d65  f._info_filename
+0001cea0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+0001ceb0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+0001cec0: 2020 206c 6f63 6b20 3d20 4c6f 636b 4669     lock = LockFi
+0001ced0: 6c65 2873 656c 662e 5f6d 6f64 5f70 6174  le(self._mod_pat
+0001cee0: 6829 0a20 2020 2020 2020 2069 6620 6e6f  h).        if no
+0001cef0: 7420 7365 6c66 2e5f 6e65 6564 5f72 6563  t self._need_rec
+0001cf00: 6f6d 7069 6c65 2829 3a20 2023 2063 6865  ompile():  # che
+0001cf10: 636b 2061 6761 696e 0a20 2020 2020 2020  ck again.       
+0001cf20: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
+0001cf30: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
+0001cf40: 2020 2020 2020 7072 696e 7428 2225 733a        print("%s:
+0001cf50: 204e 6f20 6e65 6564 2074 6f20 7265 636f   No need to reco
+0001cf60: 6d70 696c 6520 6166 7465 7220 7765 2077  mpile after we w
+0001cf70: 6169 7465 643a 2025 7322 2025 2028 7365  aited: %s" % (se
+0001cf80: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+0001cf90: 616d 655f 5f2c 2073 656c 662e 5f73 6f5f  ame__, self._so_
+0001cfa0: 6669 6c65 6e61 6d65 2929 0a20 2020 2020  filename)).     
+0001cfb0: 2020 2020 2020 206f 732e 7574 696d 6528         os.utime(
+0001cfc0: 7365 6c66 2e5f 696e 666f 5f66 696c 656e  self._info_filen
+0001cfd0: 616d 652c 204e 6f6e 6529 0a20 2020 2020  ame, None).     
+0001cfe0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+0001cff0: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
+0001d000: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
+0001d010: 645f 6d79 6469 7220 616e 6420 6e6f 7420  d_mydir and not 
+0001d020: 6c6f 636b 2e69 735f 6c6f 636b 6564 2829  lock.is_locked()
+0001d030: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001d040: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0001d050: 7365 6c66 2e5f 6d6f 645f 7061 7468 293a  self._mod_path):
+0001d060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d070: 2073 656c 662e 5f63 6c65 616e 7570 5f6f   self._cleanup_o
+0001d080: 6c64 5f70 6174 6828 7365 6c66 2e5f 6d6f  ld_path(self._mo
+0001d090: 645f 7061 7468 2c20 7265 6173 6f6e 3d22  d_path, reason="
+0001d0a0: 6e65 6564 2072 6563 6f6d 7069 6c65 2229  need recompile")
+0001d0b0: 0a20 2020 2020 2020 2077 6974 6820 6c6f  .        with lo
+0001d0c0: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
+0001d0d0: 7365 6c66 2e5f 6d61 7962 655f 636f 6d70  self._maybe_comp
+0001d0e0: 696c 655f 696e 6e65 7228 290a 0a20 2020  ile_inner()..   
+0001d0f0: 2064 6566 205f 6765 745f 636f 6d70 696c   def _get_compil
+0001d100: 6572 5f62 696e 2873 656c 6629 3a0a 2020  er_bin(self):.  
+0001d110: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d120: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+0001d130: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d140: 2020 6966 2073 656c 662e 6973 5f63 7070    if self.is_cpp
+0001d150: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001d160: 7475 726e 2022 672b 2b22 0a20 2020 2020  turn "g++".     
+0001d170: 2020 2072 6574 7572 6e20 2267 6363 220a     return "gcc".
+0001d180: 0a20 2020 2064 6566 205f 7472 616e 7366  .    def _transf
+0001d190: 6f72 6d5f 636f 6d70 696c 6572 5f6f 7074  orm_compiler_opt
+0001d1a0: 7328 7365 6c66 2c20 6f70 7473 293a 0a20  s(self, opts):. 
+0001d1b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001d1c0: 2020 203a 7061 7261 6d20 6c69 7374 5b73     :param list[s
+0001d1d0: 7472 5d20 6f70 7473 3a0a 2020 2020 2020  tr] opts:.      
+0001d1e0: 2020 3a72 7479 7065 3a20 6c69 7374 5b73    :rtype: list[s
+0001d1f0: 7472 5d0a 2020 2020 2020 2020 2222 220a  tr].        """.
+0001d200: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001d210: 7074 730a 0a20 2020 2064 6566 205f 6578  pts..    def _ex
+0001d220: 7472 615f 636f 6d6d 6f6e 5f6f 7074 7328  tra_common_opts(
+0001d230: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0001d240: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
+0001d250: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
+0001d260: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001d270: 2069 6620 7365 6c66 2e69 735f 6370 703a   if self.is_cpp:
+0001d280: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001d290: 7572 6e20 5b22 2d73 7464 3d63 2b2b 3131  urn ["-std=c++11
+0001d2a0: 225d 0a20 2020 2020 2020 2072 6574 7572  "].        retur
+0001d2b0: 6e20 5b5d 0a0a 2020 2020 4063 6c61 7373  n []..    @class
+0001d2c0: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+0001d2d0: 7472 616e 7366 6f72 6d5f 6c64 5f66 6c61  transform_ld_fla
+0001d2e0: 6728 636c 732c 206f 7074 293a 0a20 2020  g(cls, opt):.   
+0001d2f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001d300: 203a 7061 7261 6d20 7374 7220 6f70 743a   :param str opt:
+0001d310: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+0001d320: 2073 7472 0a20 2020 2020 2020 2022 2222   str.        """
+0001d330: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
+0001d340: 706c 6174 666f 726d 203d 3d20 2264 6172  platform == "dar
+0001d350: 7769 6e22 3a0a 2020 2020 2020 2020 2020  win":.          
+0001d360: 2020 2320 4974 2073 6565 6d73 2073 6f6d    # It seems som
+0001d370: 6520 7665 7273 696f 6e73 206f 6620 4d61  e versions of Ma
+0001d380: 634f 5320 6c64 2063 616e 6e6f 7420 6861  cOS ld cannot ha
+0001d390: 6e64 6c65 2074 6865 2060 2d6c 3a66 696c  ndle the `-l:fil
+0001d3a0: 656e 616d 6560 2061 7267 756d 656e 7420  ename` argument 
+0001d3b0: 636f 7272 6563 746c 792e 0a20 2020 2020  correctly..     
+0001d3c0: 2020 2020 2020 2023 2045 2e67 2e20 5465         # E.g. Te
+0001d3d0: 6e73 6f72 466c 6f77 2031 2e31 3420 696e  nsorFlow 1.14 in
+0001d3e0: 636f 7272 6563 746c 7920 7573 6573 2074  correctly uses t
+0001d3f0: 6869 732e 0a20 2020 2020 2020 2020 2020  his..           
+0001d400: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
+0001d410: 622e 636f 6d2f 7465 6e73 6f72 666c 6f77  b.com/tensorflow
+0001d420: 2f74 656e 736f 7266 6c6f 772f 6973 7375  /tensorflow/issu
+0001d430: 6573 2f33 3035 3634 0a20 2020 2020 2020  es/30564.       
+0001d440: 2020 2020 2069 6620 6f70 742e 7374 6172       if opt.star
+0001d450: 7473 7769 7468 2822 2d6c 3a6c 6962 2229  tswith("-l:lib")
+0001d460: 2061 6e64 206f 7074 2e65 6e64 7377 6974   and opt.endswit
+0001d470: 6828 222e 6479 6c69 6222 293a 0a20 2020  h(".dylib"):.   
+0001d480: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001d490: 7572 6e20 222d 6c25 7322 2025 206f 7074  urn "-l%s" % opt
+0001d4a0: 5b6c 656e 2822 2d6c 3a6c 6962 2229 203a  [len("-l:lib") :
+0001d4b0: 202d 6c65 6e28 222e 6479 6c69 6222 295d   -len(".dylib")]
+0001d4c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001d4d0: 6f70 740a 0a20 2020 2064 6566 205f 6d61  opt..    def _ma
+0001d4e0: 7962 655f 636f 6d70 696c 655f 696e 6e65  ybe_compile_inne
+0001d4f0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+0001d500: 2023 2044 6972 6563 746f 7279 2073 686f   # Directory sho
+0001d510: 756c 6420 6265 2063 7265 6174 6564 2062  uld be created b
+0001d520: 7920 7468 6520 6c6f 636b 696e 6720 6d65  y the locking me
+0001d530: 6368 616e 6973 6d2e 0a20 2020 2020 2020  chanism..       
+0001d540: 2061 7373 6572 7420 6f73 2e70 6174 682e   assert os.path.
+0001d550: 6578 6973 7473 2873 656c 662e 5f6d 6f64  exists(self._mod
+0001d560: 5f70 6174 6829 0a20 2020 2020 2020 2077  _path).        w
+0001d570: 6974 6820 6f70 656e 2873 656c 662e 5f63  ith open(self._c
+0001d580: 5f66 696c 656e 616d 652c 2022 7722 2920  _filename, "w") 
+0001d590: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0001d5a0: 2020 662e 7772 6974 6528 7365 6c66 2e63    f.write(self.c
+0001d5b0: 6f64 6529 0a20 2020 2020 2020 2063 6f6d  ode).        com
+0001d5c0: 6d6f 6e5f 6f70 7473 203d 205b 222d 7368  mon_opts = ["-sh
+0001d5d0: 6172 6564 222c 2022 2d4f 3222 5d0a 2020  ared", "-O2"].  
+0001d5e0: 2020 2020 2020 636f 6d6d 6f6e 5f6f 7074        common_opt
+0001d5f0: 7320 2b3d 2073 656c 662e 5f65 7874 7261  s += self._extra
+0001d600: 5f63 6f6d 6d6f 6e5f 6f70 7473 2829 0a20  _common_opts(). 
+0001d610: 2020 2020 2020 2069 6620 7379 732e 706c         if sys.pl
+0001d620: 6174 666f 726d 203d 3d20 2264 6172 7769  atform == "darwi
+0001d630: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
+0001d640: 636f 6d6d 6f6e 5f6f 7074 7320 2b3d 205b  common_opts += [
+0001d650: 222d 756e 6465 6669 6e65 6422 2c20 2264  "-undefined", "d
+0001d660: 796e 616d 6963 5f6c 6f6f 6b75 7022 5d0a  ynamic_lookup"].
+0001d670: 2020 2020 2020 2020 666f 7220 696e 636c          for incl
+0001d680: 7564 655f 7061 7468 2069 6e20 7365 6c66  ude_path in self
+0001d690: 2e5f 696e 636c 7564 655f 7061 7468 733a  ._include_paths:
+0001d6a0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+0001d6b0: 6d6f 6e5f 6f70 7473 202b 3d20 5b22 2d49  mon_opts += ["-I
+0001d6c0: 222c 2069 6e63 6c75 6465 5f70 6174 685d  ", include_path]
+0001d6d0: 0a20 2020 2020 2020 2063 6f6d 7069 6c65  .        compile
+0001d6e0: 725f 6f70 7473 203d 205b 222d 6650 4943  r_opts = ["-fPIC
+0001d6f0: 222c 2022 2d76 225d 0a20 2020 2020 2020  ", "-v"].       
+0001d700: 2063 6f6d 6d6f 6e5f 6f70 7473 202b 3d20   common_opts += 
+0001d710: 7365 6c66 2e5f 7472 616e 7366 6f72 6d5f  self._transform_
+0001d720: 636f 6d70 696c 6572 5f6f 7074 7328 636f  compiler_opts(co
+0001d730: 6d70 696c 6572 5f6f 7074 7329 0a20 2020  mpiler_opts).   
+0001d740: 2020 2020 2063 6f6d 6d6f 6e5f 6f70 7473       common_opts
+0001d750: 202b 3d20 5b22 2d44 5f47 4c49 4243 5858   += ["-D_GLIBCXX
+0001d760: 5f55 5345 5f43 5858 3131 5f41 4249 3d25  _USE_CXX11_ABI=%
+0001d770: 6922 2025 2028 3120 6966 2073 656c 662e  i" % (1 if self.
+0001d780: 7573 655f 6378 7831 315f 6162 6920 656c  use_cxx11_abi el
+0001d790: 7365 2030 295d 0a20 2020 2020 2020 2063  se 0)].        c
+0001d7a0: 6f6d 6d6f 6e5f 6f70 7473 202b 3d20 5b22  ommon_opts += ["
+0001d7b0: 2d44 2573 3d25 7322 2025 2069 7465 6d20  -D%s=%s" % item 
+0001d7c0: 666f 7220 6974 656d 2069 6e20 736f 7274  for item in sort
+0001d7d0: 6564 2873 656c 662e 635f 6d61 6372 6f5f  ed(self.c_macro_
+0001d7e0: 6465 6669 6e65 732e 6974 656d 7328 2929  defines.items())
+0001d7f0: 5d0a 2020 2020 2020 2020 636f 6d6d 6f6e  ].        common
+0001d800: 5f6f 7074 7320 2b3d 205b 222d 6722 5d0a  _opts += ["-g"].
+0001d810: 2020 2020 2020 2020 6f70 7473 203d 2063          opts = c
+0001d820: 6f6d 6d6f 6e5f 6f70 7473 202b 205b 7365  ommon_opts + [se
+0001d830: 6c66 2e5f 635f 6669 6c65 6e61 6d65 2c20  lf._c_filename, 
+0001d840: 222d 6f22 2c20 7365 6c66 2e5f 736f 5f66  "-o", self._so_f
+0001d850: 696c 656e 616d 655d 0a20 2020 2020 2020  ilename].       
+0001d860: 206f 7074 7320 2b3d 206c 6973 7428 6d61   opts += list(ma
+0001d870: 7028 7365 6c66 2e5f 7472 616e 7366 6f72  p(self._transfor
+0001d880: 6d5f 6c64 5f66 6c61 672c 2073 656c 662e  m_ld_flag, self.
+0001d890: 6c64 5f66 6c61 6773 2929 0a20 2020 2020  ld_flags)).     
+0001d8a0: 2020 2063 6d64 5f62 696e 203d 2073 656c     cmd_bin = sel
+0001d8b0: 662e 5f67 6574 5f63 6f6d 7069 6c65 725f  f._get_compiler_
+0001d8c0: 6269 6e28 290a 2020 2020 2020 2020 636d  bin().        cm
+0001d8d0: 645f 6172 6773 203d 205b 636d 645f 6269  d_args = [cmd_bi
+0001d8e0: 6e5d 202b 206f 7074 730a 2020 2020 2020  n] + opts.      
+0001d8f0: 2020 6672 6f6d 2073 7562 7072 6f63 6573    from subproces
+0001d900: 7320 696d 706f 7274 2050 6f70 656e 2c20  s import Popen, 
+0001d910: 5049 5045 2c20 5354 444f 5554 2c20 4361  PIPE, STDOUT, Ca
+0001d920: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
+0001d930: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+0001d940: 2225 7320 6361 6c6c 3a20 2573 2220 2520  "%s call: %s" % 
+0001d950: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
+0001d960: 5f5f 6e61 6d65 5f5f 2c20 2220 222e 6a6f  __name__, " ".jo
+0001d970: 696e 2863 6d64 5f61 7267 7329 292c 2066  in(cmd_args)), f
+0001d980: 696c 653d 7365 6c66 2e5f 6c6f 675f 7374  ile=self._log_st
+0001d990: 7265 616d 290a 2020 2020 2020 2020 7072  ream).        pr
+0001d9a0: 6f63 203d 2050 6f70 656e 2863 6d64 5f61  oc = Popen(cmd_a
+0001d9b0: 7267 732c 2063 7764 3d73 656c 662e 5f6d  rgs, cwd=self._m
+0001d9c0: 6f64 5f70 6174 682c 2073 7464 6f75 743d  od_path, stdout=
+0001d9d0: 5049 5045 2c20 7374 6465 7272 3d53 5444  PIPE, stderr=STD
+0001d9e0: 4f55 5429 0a20 2020 2020 2020 2073 7464  OUT).        std
+0001d9f0: 6f75 742c 2073 7464 6572 7220 3d20 7072  out, stderr = pr
+0001da00: 6f63 2e63 6f6d 6d75 6e69 6361 7465 2829  oc.communicate()
+0001da10: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0001da20: 7374 6465 7272 2069 7320 4e6f 6e65 2020  stderr is None  
+0001da30: 2320 7368 6f75 6c64 206f 6e6c 7920 6861  # should only ha
+0001da40: 7665 2073 7464 6f75 740a 2020 2020 2020  ve stdout.      
+0001da50: 2020 6966 2070 726f 632e 7265 7475 726e    if proc.return
+0001da60: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
+0001da70: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
+0001da80: 3a20 2573 2066 6169 6c65 642e 2220 2520  : %s failed." % 
+0001da90: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
+0001daa0: 5f5f 6e61 6d65 5f5f 2c20 636d 645f 6269  __name__, cmd_bi
+0001dab0: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
+0001dac0: 7072 696e 7428 224f 7269 6769 6e61 6c20  print("Original 
+0001dad0: 7374 646f 7574 2f73 7464 6572 723a 2229  stdout/stderr:")
+0001dae0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001daf0: 6e74 2873 7464 6f75 742e 6465 636f 6465  nt(stdout.decode
+0001db00: 2822 7574 6638 2229 290a 2020 2020 2020  ("utf8")).      
+0001db10: 2020 2020 2020 7072 696e 7428 290a 2020        print().  
+0001db20: 2020 2020 2020 2020 2020 6966 2063 6d64            if cmd
+0001db30: 5f62 696e 2e65 6e64 7377 6974 6828 222f  _bin.endswith("/
+0001db40: 6e76 6363 2229 2061 6e64 2062 2265 7272  nvcc") and b"err
+0001db50: 6f72 3a20 636f 6e73 7465 7870 7220 6675  or: constexpr fu
+0001db60: 6e63 7469 6f6e 2072 6574 7572 6e20 6973  nction return is
+0001db70: 206e 6f6e 2d63 6f6e 7374 616e 7422 2069   non-constant" i
+0001db80: 6e20 7374 646f 7574 3a0a 2020 2020 2020  n stdout:.      
+0001db90: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001dba0: 2254 6869 7320 6d69 6768 7420 6265 2074  "This might be t
+0001dbb0: 6865 2065 7272 6f72 3a20 6874 7470 733a  he error: https:
+0001dbc0: 2f2f 6769 7468 7562 2e63 6f6d 2f74 656e  //github.com/ten
+0001dbd0: 736f 7266 6c6f 772f 7465 6e73 6f72 666c  sorflow/tensorfl
+0001dbe0: 6f77 2f69 7373 7565 732f 3232 3736 3622  ow/issues/22766"
+0001dbf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dc00: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
+0001dc10: 2020 2020 2020 6966 2063 6d64 5f62 696e        if cmd_bin
+0001dc20: 2e65 6e64 7377 6974 6828 222f 6e76 6363  .endswith("/nvcc
+0001dc30: 2229 2061 6e64 2062 2267 6363 2076 6572  ") and b"gcc ver
+0001dc40: 7369 6f6e 7320 6c61 7465 7220 7468 616e  sions later than
+0001dc50: 2220 696e 2073 7464 6f75 743a 0a20 2020  " in stdout:.   
+0001dc60: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001dc70: 6e74 2822 596f 7572 2047 4343 2076 6572  nt("Your GCC ver
+0001dc80: 7369 6f6e 206d 6967 6874 2062 6520 746f  sion might be to
+0001dc90: 6f20 6e65 772e 2054 6869 7320 6973 2061  o new. This is a
+0001dca0: 2070 726f 626c 656d 2077 6974 6820 736f   problem with so
+0001dcb0: 6d65 206e 7663 6320 7665 7273 696f 6e73  me nvcc versions
+0001dcc0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001dcd0: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
+0001dce0: 2020 2020 2020 2020 7261 6973 6520 4361          raise Ca
+0001dcf0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
+0001dd00: 2872 6574 7572 6e63 6f64 653d 7072 6f63  (returncode=proc
+0001dd10: 2e72 6574 7572 6e63 6f64 652c 2063 6d64  .returncode, cmd
+0001dd20: 3d63 6d64 5f61 7267 7329 0a20 2020 2020  =cmd_args).     
+0001dd30: 2020 2061 7373 6572 7420 6f73 2e70 6174     assert os.pat
+0001dd40: 682e 6578 6973 7473 2873 656c 662e 5f73  h.exists(self._s
+0001dd50: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
+0001dd60: 2020 2020 7769 7468 206f 7065 6e28 2225      with open("%
+0001dd70: 732f 636f 6d70 696c 652e 6c6f 6722 2025  s/compile.log" %
+0001dd80: 2073 656c 662e 5f6d 6f64 5f70 6174 682c   self._mod_path,
+0001dd90: 2022 7762 2229 2061 7320 663a 0a20 2020   "wb") as f:.   
+0001dda0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0001ddb0: 2e76 6572 626f 7365 3a0a 2020 2020 2020  .verbose:.      
+0001ddc0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001ddd0: 2225 733a 2077 7269 7465 2063 6f6d 7069  "%s: write compi
+0001dde0: 6c65 206c 6f67 2074 6f3a 2025 7322 2025  le log to: %s" %
+0001ddf0: 2028 7365 6c66 2e5f 5f63 6c61 7373 5f5f   (self.__class__
+0001de00: 2e5f 5f6e 616d 655f 5f2c 2066 2e6e 616d  .__name__, f.nam
+0001de10: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+0001de20: 662e 7772 6974 6528 2822 2b20 2573 5c6e  f.write(("+ %s\n
+0001de30: 2220 2520 2220 222e 6a6f 696e 2863 6d64  " % " ".join(cmd
+0001de40: 5f61 7267 7329 292e 656e 636f 6465 2822  _args)).encode("
+0001de50: 7574 6638 2229 290a 2020 2020 2020 2020  utf8")).        
+0001de60: 2020 2020 662e 7772 6974 6528 7374 646f      f.write(stdo
+0001de70: 7574 290a 2020 2020 2020 2020 7365 6c66  ut).        self
+0001de80: 2e5f 7361 7665 5f69 6e66 6f28 290a 2020  ._save_info().  
+0001de90: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
+0001dea0: 2073 656c 662e 5f6e 6565 645f 7265 636f   self._need_reco
+0001deb0: 6d70 696c 6528 290a 0a20 2020 2064 6566  mpile()..    def
+0001dec0: 206c 6f61 645f 6c69 625f 6374 7970 6573   load_lib_ctypes
+0001ded0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001dee0: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
+0001def0: 7065 3a20 6374 7970 6573 2e43 444c 4c0a  pe: ctypes.CDLL.
+0001df00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001df10: 2020 2020 6966 2073 656c 662e 5f63 7479      if self._cty
+0001df20: 7065 735f 6c69 623a 0a20 2020 2020 2020  pes_lib:.       
+0001df30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001df40: 2e5f 6374 7970 6573 5f6c 6962 0a20 2020  ._ctypes_lib.   
+0001df50: 2020 2020 2073 656c 662e 5f6d 6179 6265       self._maybe
+0001df60: 5f63 6f6d 7069 6c65 2829 0a20 2020 2020  _compile().     
+0001df70: 2020 2069 6d70 6f72 7420 6374 7970 6573     import ctypes
+0001df80: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0001df90: 6374 7970 6573 5f6c 6962 203d 2063 7479  ctypes_lib = cty
+0001dfa0: 7065 732e 6364 6c6c 2e4c 6f61 644c 6962  pes.cdll.LoadLib
+0001dfb0: 7261 7279 2873 656c 662e 5f73 6f5f 6669  rary(self._so_fi
+0001dfc0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+0001dfd0: 7265 7475 726e 2073 656c 662e 5f63 7479  return self._cty
+0001dfe0: 7065 735f 6c69 620a 0a20 2020 2064 6566  pes_lib..    def
+0001dff0: 2067 6574 5f6c 6962 5f66 696c 656e 616d   get_lib_filenam
+0001e000: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001e010: 2022 2222 0a20 2020 2020 2020 203a 7274   """.        :rt
+0001e020: 7970 653a 2073 7472 0a20 2020 2020 2020  ype: str.       
+0001e030: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0001e040: 662e 5f6d 6179 6265 5f63 6f6d 7069 6c65  f._maybe_compile
+0001e050: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+0001e060: 6e20 7365 6c66 2e5f 736f 5f66 696c 656e  n self._so_filen
+0001e070: 616d 650a 0a0a 2320 5365 6520 3a66 756e  ame...# See :fun
+0001e080: 633a 606d 6179 6265 5f72 6573 7461 7274  c:`maybe_restart
+0001e090: 5f72 6574 7572 6e6e 5f77 6974 685f 6174  _returnn_with_at
+0001e0a0: 666f 726b 5f70 6174 6368 6020 6265 6c6f  fork_patch` belo
+0001e0b0: 7720 666f 7220 7768 7920 796f 7520 6d69  w for why you mi
+0001e0c0: 6768 7420 7761 6e74 2074 6f20 7573 6520  ght want to use 
+0001e0d0: 7468 6973 2e0a 5f63 5f63 6f64 655f 7061  this.._c_code_pa
+0001e0e0: 7463 685f 6174 666f 726b 203d 2022 2222  tch_atfork = """
+0001e0f0: 0a23 6465 6669 6e65 205f 474e 555f 534f  .#define _GNU_SO
+0001e100: 5552 4345 0a23 696e 636c 7564 6520 3c73  URCE.#include <s
+0001e110: 6368 6564 2e68 3e0a 2369 6e63 6c75 6465  ched.h>.#include
+0001e120: 203c 7369 676e 616c 2e68 3e0a 2369 6e63   <signal.h>.#inc
+0001e130: 6c75 6465 203c 7379 732f 7379 7363 616c  lude <sys/syscal
+0001e140: 6c2e 683e 0a23 696e 636c 7564 6520 3c73  l.h>.#include <s
+0001e150: 7464 696f 2e68 3e0a 2369 6e63 6c75 6465  tdio.h>.#include
+0001e160: 203c 7374 646c 6962 2e68 3e0a 2369 6e63   <stdlib.h>.#inc
+0001e170: 6c75 6465 203c 756e 6973 7464 2e68 3e0a  lude <unistd.h>.
+0001e180: 0a2f 2f20 6874 7470 733a 2f2f 7374 6163  .// https://stac
+0001e190: 6b6f 7665 7266 6c6f 772e 636f 6d2f 7175  koverflow.com/qu
+0001e1a0: 6573 7469 6f6e 732f 3436 3834 3534 3936  estions/46845496
+0001e1b0: 2f6c 642d 7072 656c 6f61 642d 616e 642d  /ld-preload-and-
+0001e1c0: 6c69 6e6b 6167 650a 2f2f 2068 7474 7073  linkage.// https
+0001e1d0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
+0001e1e0: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f34  .com/questions/4
+0001e1f0: 3638 3130 3539 372f 666f 726b 6578 6563  6810597/forkexec
+0001e200: 2d77 6974 686f 7574 2d61 7466 6f72 6b2d  -without-atfork-
+0001e210: 6861 6e64 6c65 7273 0a0a 696e 7420 7074  handlers..int pt
+0001e220: 6872 6561 645f 6174 666f 726b 2876 6f69  hread_atfork(voi
+0001e230: 6420 282a 7072 6570 6172 6529 2876 6f69  d (*prepare)(voi
+0001e240: 6429 2c20 766f 6964 2028 2a70 6172 656e  d), void (*paren
+0001e250: 7429 2876 6f69 6429 2c20 766f 6964 2028  t)(void), void (
+0001e260: 2a63 6869 6c64 2928 766f 6964 2929 207b  *child)(void)) {
+0001e270: 0a20 2070 7269 6e74 6628 2249 676e 6f72  .  printf("Ignor
+0001e280: 696e 6720 7074 6872 6561 645f 6174 666f  ing pthread_atfo
+0001e290: 726b 2063 616c 6c21 5c5c 6e22 293b 0a20  rk call!\\n");. 
+0001e2a0: 2066 666c 7573 6828 7374 646f 7574 293b   fflush(stdout);
+0001e2b0: 0a20 2072 6574 7572 6e20 303b 0a7d 0a0a  .  return 0;.}..
+0001e2c0: 696e 7420 5f5f 7265 6769 7374 6572 5f61  int __register_a
+0001e2d0: 7466 6f72 6b28 766f 6964 2028 2a70 7265  tfork(void (*pre
+0001e2e0: 7061 7265 2928 766f 6964 292c 2076 6f69  pare)(void), voi
+0001e2f0: 6420 282a 7061 7265 6e74 2928 766f 6964  d (*parent)(void
+0001e300: 292c 2076 6f69 6420 282a 6368 696c 6429  ), void (*child)
+0001e310: 2876 6f69 6429 2920 7b0a 2020 7072 696e  (void)) {.  prin
+0001e320: 7466 2822 4967 6e6f 7269 6e67 205f 5f72  tf("Ignoring __r
+0001e330: 6567 6973 7465 725f 6174 666f 726b 2063  egister_atfork c
+0001e340: 616c 6c21 5c5c 6e22 293b 0a20 2066 666c  all!\\n");.  ffl
+0001e350: 7573 6828 7374 646f 7574 293b 0a20 2072  ush(stdout);.  r
+0001e360: 6574 7572 6e20 303b 0a7d 0a0a 2f2f 2041  eturn 0;.}..// A
+0001e370: 6e6f 7468 6572 2077 6179 2074 6f20 6967  nother way to ig
+0001e380: 6e6f 7265 2061 7466 6f72 6b20 6861 6e64  nore atfork hand
+0001e390: 6c65 7273 3a20 4f76 6572 7269 6465 2066  lers: Override f
+0001e3a0: 6f72 6b2e 0a23 6966 6465 6620 5f5f 6c69  ork..#ifdef __li
+0001e3b0: 6e75 785f 5f20 2f2f 206f 6e6c 7920 776f  nux__ // only wo
+0001e3c0: 726b 7320 6f6e 204c 696e 7578 2063 7572  rks on Linux cur
+0001e3d0: 7265 6e74 6c79 0a70 6964 5f74 2066 6f72  rently.pid_t for
+0001e3e0: 6b28 766f 6964 2920 7b0a 2020 7265 7475  k(void) {.  retu
+0001e3f0: 726e 2073 7973 6361 6c6c 2853 5953 5f63  rn syscall(SYS_c
+0001e400: 6c6f 6e65 2c20 5349 4743 484c 442c 2030  lone, SIGCHLD, 0
+0001e410: 293b 0a7d 0a23 656e 6469 660a 0a5f 5f61  );.}.#endif..__a
+0001e420: 7474 7269 6275 7465 5f5f 2828 636f 6e73  ttribute__((cons
+0001e430: 7472 7563 746f 7229 290a 766f 6964 2070  tructor)).void p
+0001e440: 6174 6368 5f61 7466 6f72 6b5f 696e 6974  atch_atfork_init
+0001e450: 2829 207b 0a20 2073 6574 656e 7628 225f  () {.  setenv("_
+0001e460: 5f52 4554 5552 4e4e 5f41 5446 4f52 4b5f  _RETURNN_ATFORK_
+0001e470: 5041 5443 4845 4422 2c20 2231 222c 2031  PATCHED", "1", 1
+0001e480: 293b 0a7d 0a22 2222 0a0a 0a64 6566 2067  );.}."""...def g
+0001e490: 6574 5f70 6174 6368 5f61 7466 6f72 6b5f  et_patch_atfork_
+0001e4a0: 6c69 6228 293a 0a20 2020 2022 2222 0a20  lib():.    """. 
+0001e4b0: 2020 203a 7265 7475 726e 3a20 7061 7468     :return: path
+0001e4c0: 2074 6f20 6f75 7220 7061 7463 685f 6174   to our patch_at
+0001e4d0: 666f 726b 206c 6962 2e20 7365 6520 3a66  fork lib. see :f
+0001e4e0: 756e 633a 606d 6179 6265 5f72 6573 7461  unc:`maybe_resta
+0001e4f0: 7274 5f72 6574 7572 6e6e 5f77 6974 685f  rt_returnn_with_
+0001e500: 6174 666f 726b 5f70 6174 6368 600a 2020  atfork_patch`.  
+0001e510: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+0001e520: 2020 2222 220a 2020 2020 6e61 7469 7665    """.    native
+0001e530: 203d 204e 6174 6976 6543 6f64 6543 6f6d   = NativeCodeCom
+0001e540: 7069 6c65 7228 6261 7365 5f6e 616d 653d  piler(base_name=
+0001e550: 2270 6174 6368 5f61 7466 6f72 6b22 2c20  "patch_atfork", 
+0001e560: 636f 6465 5f76 6572 7369 6f6e 3d32 2c20  code_version=2, 
+0001e570: 636f 6465 3d5f 635f 636f 6465 5f70 6174  code=_c_code_pat
+0001e580: 6368 5f61 7466 6f72 6b2c 2069 735f 6370  ch_atfork, is_cp
+0001e590: 703d 4661 6c73 6529 0a20 2020 2066 6e20  p=False).    fn 
+0001e5a0: 3d20 6e61 7469 7665 2e67 6574 5f6c 6962  = native.get_lib
+0001e5b0: 5f66 696c 656e 616d 6528 290a 2020 2020  _filename().    
+0001e5c0: 7265 7475 726e 2066 6e0a 0a0a 6465 6620  return fn...def 
+0001e5d0: 7265 7374 6172 745f 7265 7475 726e 6e28  restart_returnn(
+0001e5e0: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
+0001e5f0: 6573 7461 7274 7320 5245 5455 524e 4e2e  estarts RETURNN.
+0001e600: 0a20 2020 2022 2222 0a20 2020 206c 6f67  .    """.    log
+0001e610: 2e66 6c75 7368 2829 0a20 2020 2073 7973  .flush().    sys
+0001e620: 2e73 7464 6f75 742e 666c 7573 6828 290a  .stdout.flush().
+0001e630: 2020 2020 7379 732e 7374 6465 7272 2e66      sys.stderr.f
+0001e640: 6c75 7368 2829 0a20 2020 2023 2068 7474  lush().    # htt
+0001e650: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
+0001e660: 6f77 2e63 6f6d 2f71 7565 7374 696f 6e73  ow.com/questions
+0001e670: 2f37 3233 3335 3930 342f 7369 6d70 6c65  /72335904/simple
+0001e680: 2d77 6179 2d74 6f2d 7265 7374 6172 742d  -way-to-restart-
+0001e690: 6170 706c 6963 6174 696f 6e0a 2020 2020  application.    
+0001e6a0: 636c 6f73 655f 616c 6c5f 6664 735f 6578  close_all_fds_ex
+0001e6b0: 6365 7074 287b 302c 2031 2c20 327d 290a  cept({0, 1, 2}).
+0001e6c0: 2020 2020 6f73 2e65 7865 6376 2873 7973      os.execv(sys
+0001e6d0: 2e65 7865 6375 7461 626c 652c 205b 7379  .executable, [sy
+0001e6e0: 732e 6578 6563 7574 6162 6c65 5d20 2b20  s.executable] + 
+0001e6f0: 7379 732e 6172 6776 290a 2020 2020 7261  sys.argv).    ra
+0001e700: 6973 6520 4578 6365 7074 696f 6e28 2272  ise Exception("r
+0001e710: 6573 7461 7274 5f72 6574 7572 6e6e 3a20  estart_returnn: 
+0001e720: 6578 6563 7620 6661 696c 6564 2229 0a0a  execv failed")..
+0001e730: 0a64 6566 206d 6179 6265 5f72 6573 7461  .def maybe_resta
+0001e740: 7274 5f72 6574 7572 6e6e 5f77 6974 685f  rt_returnn_with_
+0001e750: 6174 666f 726b 5f70 6174 6368 2829 3a0a  atfork_patch():.
+0001e760: 2020 2020 2222 220a 2020 2020 5768 6174      """.    What
+0001e770: 2077 6520 7761 6e74 3a20 7375 6270 726f   we want: subpro
+0001e780: 6365 7373 2e50 6f70 656e 2074 6f20 616c  cess.Popen to al
+0001e790: 7761 7973 2077 6f72 6b2e 0a20 2020 2050  ways work..    P
+0001e7a0: 726f 626c 656d 3a20 4974 2075 7365 7320  roblem: It uses 
+0001e7b0: 666f 726b 2b65 7865 6320 696e 7465 726e  fork+exec intern
+0001e7c0: 616c 6c79 2069 6e20 7375 6270 726f 6365  ally in subproce
+0001e7d0: 7373 5f66 6f72 6b5f 6578 6563 2c20 7669  ss_fork_exec, vi
+0001e7e0: 6120 5f70 6f73 6978 7375 6270 726f 6365  a _posixsubproce
+0001e7f0: 7373 2e66 6f72 6b5f 6578 6563 2e0a 2020  ss.fork_exec..  
+0001e800: 2020 5468 6174 2069 7320 6120 7072 6f62    That is a prob
+0001e810: 6c65 6d20 6265 6361 7573 6520 666f 726b  lem because fork
+0001e820: 2063 616e 2074 7269 6767 6572 2061 6e79   can trigger any
+0001e830: 2061 7466 6f72 6b20 6861 6e64 6c65 7273   atfork handlers
+0001e840: 2072 6567 6973 7465 7265 6420 7669 6120   registered via 
+0001e850: 7074 6872 6561 645f 6174 666f 726b 2c0a  pthread_atfork,.
+0001e860: 2020 2020 616e 6420 7468 6f73 6520 6361      and those ca
+0001e870: 6e20 6372 6173 682f 6465 6164 6c6f 636b  n crash/deadlock
+0001e880: 2069 6e20 736f 6d65 2063 6173 6573 2e0a   in some cases..
+0001e890: 0a20 2020 2068 7474 7073 3a2f 2f67 6974  .    https://git
+0001e8a0: 6875 622e 636f 6d2f 7465 6e73 6f72 666c  hub.com/tensorfl
+0001e8b0: 6f77 2f74 656e 736f 7266 6c6f 772f 6973  ow/tensorflow/is
+0001e8c0: 7375 6573 2f31 3338 3032 0a20 2020 2068  sues/13802.    h
+0001e8d0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0001e8e0: 6d2f 7869 616e 7969 2f4f 7065 6e42 4c41  m/xianyi/OpenBLA
+0001e8f0: 532f 6973 7375 6573 2f32 3430 0a20 2020  S/issues/240.   
+0001e900: 2068 7474 7073 3a2f 2f74 7261 632e 7361   https://trac.sa
+0001e910: 6765 6d61 7468 2e6f 7267 2f74 6963 6b65  gemath.org/ticke
+0001e920: 742f 3232 3032 310a 2020 2020 6874 7470  t/22021.    http
+0001e930: 733a 2f2f 6275 6773 2e70 7974 686f 6e2e  s://bugs.python.
+0001e940: 6f72 672f 6973 7375 6533 3138 3134 0a20  org/issue31814. 
+0001e950: 2020 2068 7474 7073 3a2f 2f73 7461 636b     https://stack
+0001e960: 6f76 6572 666c 6f77 2e63 6f6d 2f71 7565  overflow.com/que
+0001e970: 7374 696f 6e73 2f34 3638 3435 3439 362f  stions/46845496/
+0001e980: 6c64 2d70 7265 6c6f 6164 2d61 6e64 2d6c  ld-preload-and-l
+0001e990: 696e 6b61 6765 0a20 2020 2068 7474 7073  inkage.    https
+0001e9a0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
+0001e9b0: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f34  .com/questions/4
+0001e9c0: 3638 3130 3539 372f 666f 726b 6578 6563  6810597/forkexec
+0001e9d0: 2d77 6974 686f 7574 2d61 7466 6f72 6b2d  -without-atfork-
+0001e9e0: 6861 6e64 6c65 7273 0a0a 2020 2020 5468  handlers..    Th
+0001e9f0: 6520 736f 6c75 7469 6f6e 2068 6572 653a  e solution here:
+0001ea00: 204a 7573 7420 6f76 6572 7269 6465 2070   Just override p
+0001ea10: 7468 7265 6164 5f61 7466 6f72 6b2c 2076  thread_atfork, v
+0001ea20: 6961 204c 445f 5052 454c 4f41 442e 0a20  ia LD_PRELOAD.. 
+0001ea30: 2020 204e 6f74 6520 7468 6174 2069 6e20     Note that in 
+0001ea40: 736f 6d65 2063 6173 6573 2c20 7468 6973  some cases, this
+0001ea50: 2069 7320 6e6f 7420 656e 6f75 6768 2028   is not enough (
+0001ea60: 7365 6520 7468 6520 534f 2064 6973 6375  see the SO discu
+0001ea70: 7373 696f 6e29 2c0a 2020 2020 736f 2077  ssion),.    so w
+0001ea80: 6520 616c 736f 206f 7665 7277 7269 7465  e also overwrite
+0001ea90: 2066 6f72 6b20 6974 7365 6c66 2e0a 2020   fork itself..  
+0001eaa0: 2020 5365 6520 616c 736f 2074 6573 7473    See also tests
+0001eab0: 2f74 6573 745f 666f 726b 5f65 7865 632e  /test_fork_exec.
+0001eac0: 7079 2066 6f72 2061 2064 656d 6f2e 0a20  py for a demo.. 
+0001ead0: 2020 2022 2222 0a20 2020 2069 6620 6f73     """.    if os
+0001eae0: 2e65 6e76 6972 6f6e 2e67 6574 2822 5f5f  .environ.get("__
+0001eaf0: 5245 5455 524e 4e5f 4154 464f 524b 5f50  RETURNN_ATFORK_P
+0001eb00: 4154 4348 4544 2229 203d 3d20 2231 223a  ATCHED") == "1":
+0001eb10: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+0001eb20: 5275 6e6e 696e 6720 7769 7468 2070 6174  Running with pat
+0001eb30: 6368 6564 2061 7466 6f72 6b2e 2229 0a20  ched atfork."). 
+0001eb40: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+0001eb50: 2020 6966 206f 732e 656e 7669 726f 6e2e    if os.environ.
+0001eb60: 6765 7428 225f 5f52 4554 5552 4e4e 5f54  get("__RETURNN_T
+0001eb70: 5259 5f41 5446 4f52 4b5f 5041 5443 4845  RY_ATFORK_PATCHE
+0001eb80: 4422 2920 3d3d 2022 3122 3a0a 2020 2020  D") == "1":.    
+0001eb90: 2020 2020 7072 696e 7428 2250 6174 6368      print("Patch
+0001eba0: 696e 6720 6174 666f 726b 2064 6964 206e  ing atfork did n
+0001ebb0: 6f74 2077 6f72 6b21 2057 696c 6c20 636f  ot work! Will co
+0001ebc0: 6e74 696e 7565 2061 6e79 7761 792e 2229  ntinue anyway.")
+0001ebd0: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
+0001ebe0: 2020 2020 6c69 6220 3d20 6765 745f 7061      lib = get_pa
+0001ebf0: 7463 685f 6174 666f 726b 5f6c 6962 2829  tch_atfork_lib()
+0001ec00: 0a20 2020 2065 6e76 203d 206f 732e 656e  .    env = os.en
+0001ec10: 7669 726f 6e2e 636f 7079 2829 0a20 2020  viron.copy().   
+0001ec20: 2065 6e76 5b22 4459 4c44 5f49 4e53 4552   env["DYLD_INSER
+0001ec30: 545f 4c49 4252 4152 4945 5322 2069 6620  T_LIBRARIES" if 
+0001ec40: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
+0001ec50: 2264 6172 7769 6e22 2065 6c73 6520 224c  "darwin" else "L
+0001ec60: 445f 5052 454c 4f41 4422 5d20 3d20 6c69  D_PRELOAD"] = li
+0001ec70: 620a 2020 2020 656e 765b 225f 5f52 4554  b.    env["__RET
+0001ec80: 5552 4e4e 5f54 5259 5f41 5446 4f52 4b5f  URNN_TRY_ATFORK_
+0001ec90: 5041 5443 4845 4422 5d20 3d20 2231 220a  PATCHED"] = "1".
+0001eca0: 2020 2020 7072 696e 7428 2252 6573 7461      print("Resta
+0001ecb0: 7274 696e 6720 5265 7475 726e 6e20 7769  rting Returnn wi
+0001ecc0: 7468 2061 7466 6f72 6b20 7061 7463 682e  th atfork patch.
+0001ecd0: 2e2e 222c 2073 7973 2e65 7865 6375 7461  ..", sys.executa
+0001ece0: 626c 652c 2073 7973 2e61 7267 7629 0a20  ble, sys.argv). 
+0001ecf0: 2020 2073 7973 2e73 7464 6f75 742e 666c     sys.stdout.fl
+0001ed00: 7573 6828 290a 2020 2020 6f73 2e65 7865  ush().    os.exe
+0001ed10: 6376 7065 2873 7973 2e65 7865 6375 7461  cvpe(sys.executa
+0001ed20: 626c 652c 205b 7379 732e 6578 6563 7574  ble, [sys.execut
+0001ed30: 6162 6c65 5d20 2b20 7379 732e 6172 6776  able] + sys.argv
+0001ed40: 2c20 656e 7629 0a20 2020 2070 7269 6e74  , env).    print
+0001ed50: 2822 6578 6563 7670 6520 6469 6420 6e6f  ("execvpe did no
+0001ed60: 7420 776f 726b 3f22 290a 0a0a 6465 6620  t work?")...def 
+0001ed70: 636c 6f73 655f 616c 6c5f 6664 735f 6578  close_all_fds_ex
+0001ed80: 6365 7074 2865 7863 6570 745f 6664 7329  cept(except_fds)
+0001ed90: 3a0a 2020 2020 2222 220a 2020 2020 4361  :.    """.    Ca
+0001eda0: 6c6c 7320 6f73 2e63 6c6f 7365 7261 6e67  lls os.closerang
+0001edb0: 6520 6578 6365 7074 2066 6f72 2074 6865  e except for the
+0001edc0: 2067 6976 656e 2066 6473 2e0a 2020 2020   given fds..    
+0001edd0: 436f 6465 2061 646f 7074 6564 2061 6e64  Code adopted and
+0001ede0: 2065 7874 656e 6465 6420 6672 6f6d 206d   extended from m
+0001edf0: 756c 7469 7072 6f63 6573 7369 6e67 2e75  ultiprocessing.u
+0001ee00: 7469 6c2e 636c 6f73 655f 616c 6c5f 6664  til.close_all_fd
+0001ee10: 735f 6578 6365 7074 2e0a 0a20 2020 203a  s_except...    :
+0001ee20: 7061 7261 6d20 7479 7069 6e67 2e43 6f6c  param typing.Col
+0001ee30: 6c65 6374 696f 6e5b 696e 745d 2065 7863  lection[int] exc
+0001ee40: 6570 745f 6664 733a 2075 7375 616c 6c79  ept_fds: usually
+0001ee50: 2061 7420 6c65 6173 7420 7b30 2c31 2c32   at least {0,1,2
+0001ee60: 7d0a 2020 2020 2222 220a 2020 2020 2320  }.    """.    # 
+0001ee70: 6e6f 696e 7370 6563 7469 6f6e 2050 7942  noinspection PyB
+0001ee80: 726f 6164 4578 6365 7074 696f 6e0a 2020  roadException.  
+0001ee90: 2020 7472 793a 0a20 2020 2020 2020 206d    try:.        m
+0001eea0: 6178 5f66 6420 3d20 6f73 2e73 7973 636f  ax_fd = os.sysco
+0001eeb0: 6e66 2822 5343 5f4f 5045 4e5f 4d41 5822  nf("SC_OPEN_MAX"
+0001eec0: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
+0001eed0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0001eee0: 6d61 785f 6664 203d 2032 3536 0a0a 2020  max_fd = 256..  
+0001eef0: 2020 6578 6365 7074 5f66 6473 203d 2073    except_fds = s
+0001ef00: 6f72 7465 6428 6c69 7374 2865 7863 6570  orted(list(excep
+0001ef10: 745f 6664 7329 202b 205b 2d31 2c20 6d61  t_fds) + [-1, ma
+0001ef20: 785f 6664 5d29 0a20 2020 2061 7373 6572  x_fd]).    asser
+0001ef30: 7420 6578 6365 7074 5f66 6473 5b30 5d20  t except_fds[0] 
+0001ef40: 3d3d 202d 3120 616e 6420 6578 6365 7074  == -1 and except
+0001ef50: 5f66 6473 5b2d 315d 203d 3d20 6d61 785f  _fds[-1] == max_
+0001ef60: 6664 2c20 2266 6420 696e 7661 6c69 6422  fd, "fd invalid"
+0001ef70: 0a0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
+0001ef80: 616e 6765 286c 656e 2865 7863 6570 745f  ange(len(except_
+0001ef90: 6664 7329 202d 2031 293a 0a20 2020 2020  fds) - 1):.     
+0001efa0: 2020 2069 6620 6578 6365 7074 5f66 6473     if except_fds
+0001efb0: 5b69 5d20 2b20 3120 3c20 6578 6365 7074  [i] + 1 < except
+0001efc0: 5f66 6473 5b69 202b 2031 5d3a 0a20 2020  _fds[i + 1]:.   
+0001efd0: 2020 2020 2020 2020 206f 732e 636c 6f73           os.clos
+0001efe0: 6572 616e 6765 2865 7863 6570 745f 6664  erange(except_fd
+0001eff0: 735b 695d 202b 2031 2c20 6578 6365 7074  s[i] + 1, except
+0001f000: 5f66 6473 5b69 202b 2031 5d29 0a0a 0a63  _fds[i + 1])...c
+0001f010: 6c61 7373 2053 7461 7473 3a0a 2020 2020  lass Stats:.    
+0001f020: 2222 220a 2020 2020 436f 6c6c 6563 7473  """.    Collects
+0001f030: 206d 6561 6e20 616e 6420 7661 7269 616e   mean and varian
+0001f040: 6365 2c20 7275 6e6e 696e 6720 6176 6572  ce, running aver
+0001f050: 6167 652e 0a0a 2020 2020 6874 7470 733a  age...    https:
+0001f060: 2f2f 656e 2e77 696b 6970 6564 6961 2e6f  //en.wikipedia.o
+0001f070: 7267 2f77 696b 692f 416c 676f 7269 7468  rg/wiki/Algorith
+0001f080: 6d73 5f66 6f72 5f63 616c 6375 6c61 7469  ms_for_calculati
+0001f090: 6e67 5f76 6172 6961 6e63 650a 2020 2020  ng_variance.    
+0001f0a0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+0001f0b0: 6e69 745f 5f28 7365 6c66 2c20 666f 726d  nit__(self, form
+0001f0c0: 6174 5f73 7472 3d4e 6f6e 6529 3a0a 2020  at_str=None):.  
+0001f0d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001f0e0: 2020 3a70 6172 616d 204e 6f6e 657c 2828    :param None|((
+0001f0f0: 666c 6f61 747c 6e75 6d70 792e 6e64 6172  float|numpy.ndar
+0001f100: 7261 7929 2d3e 7374 7229 2066 6f72 6d61  ray)->str) forma
+0001f110: 745f 7374 723a 0a20 2020 2020 2020 2022  t_str:.        "
+0001f120: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0001f130: 666f 726d 6174 5f73 7472 203d 2066 6f72  format_str = for
+0001f140: 6d61 745f 7374 7220 6f72 2073 7472 0a20  mat_str or str. 
+0001f150: 2020 2020 2020 2073 656c 662e 6d65 616e         self.mean
+0001f160: 203d 2030 2e30 0a20 2020 2020 2020 2073   = 0.0.        s
+0001f170: 656c 662e 6d65 616e 5f73 7120 3d20 302e  elf.mean_sq = 0.
+0001f180: 300a 2020 2020 2020 2020 7365 6c66 2e76  0.        self.v
+0001f190: 6172 203d 2030 2e30 0a20 2020 2020 2020  ar = 0.0.       
+0001f1a0: 2073 656c 662e 6d69 6e20 3d20 4e6f 6e65   self.min = None
+0001f1b0: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
+0001f1c0: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
+0001f1d0: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
+0001f1e0: 5f6c 656e 203d 2030 0a20 2020 2020 2020  _len = 0.       
+0001f1f0: 2073 656c 662e 6e75 6d5f 7365 7173 203d   self.num_seqs =
+0001f200: 2030 0a0a 2020 2020 6465 6620 5f5f 7374   0..    def __st
+0001f210: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+0001f220: 2020 2069 6620 7365 6c66 2e6e 756d 5f73     if self.num_s
+0001f230: 6571 7320 3e20 303a 0a20 2020 2020 2020  eqs > 0:.       
+0001f240: 2020 2020 2069 6620 7365 6c66 2e6e 756d       if self.num
+0001f250: 5f73 6571 7320 3d3d 2073 656c 662e 746f  _seqs == self.to
+0001f260: 7461 6c5f 6461 7461 5f6c 656e 3a0a 2020  tal_data_len:.  
+0001f270: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001f280: 7472 615f 7374 7220 3d20 2261 7667 5f64  tra_str = "avg_d
+0001f290: 6174 615f 6c65 6e3d 3122 0a20 2020 2020  ata_len=1".     
+0001f2a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f2b0: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0001f2c0: 7261 5f73 7472 203d 2022 746f 7461 6c5f  ra_str = "total_
+0001f2d0: 6461 7461 5f6c 656e 3d25 692c 2061 7667  data_len=%i, avg
+0001f2e0: 5f64 6174 615f 6c65 6e3d 2566 2220 2520  _data_len=%f" % 
+0001f2f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001f300: 2020 2020 2020 7365 6c66 2e74 6f74 616c        self.total
+0001f310: 5f64 6174 615f 6c65 6e2c 0a20 2020 2020  _data_len,.     
+0001f320: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f330: 6c6f 6174 2873 656c 662e 746f 7461 6c5f  loat(self.total_
+0001f340: 6461 7461 5f6c 656e 2920 2f20 7365 6c66  data_len) / self
+0001f350: 2e6e 756d 5f73 6571 732c 0a20 2020 2020  .num_seqs,.     
+0001f360: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001f370: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001f380: 2253 7461 7473 286d 6561 6e3d 2573 2c20  "Stats(mean=%s, 
+0001f390: 7374 645f 6465 763d 2573 2c20 6d69 6e3d  std_dev=%s, min=
+0001f3a0: 2573 2c20 6d61 783d 2573 2c20 6e75 6d5f  %s, max=%s, num_
+0001f3b0: 7365 7173 3d25 692c 2025 7329 2220 2520  seqs=%i, %s)" % 
+0001f3c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001f3d0: 2020 7365 6c66 2e66 6f72 6d61 745f 7374    self.format_st
+0001f3e0: 7228 7365 6c66 2e67 6574 5f6d 6561 6e28  r(self.get_mean(
+0001f3f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+0001f400: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
+0001f410: 7374 7228 7365 6c66 2e67 6574 5f73 7464  str(self.get_std
+0001f420: 5f64 6576 2829 292c 0a20 2020 2020 2020  _dev()),.       
+0001f430: 2020 2020 2020 2020 2073 656c 662e 666f           self.fo
+0001f440: 726d 6174 5f73 7472 2873 656c 662e 6d69  rmat_str(self.mi
+0001f450: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
+0001f460: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
+0001f470: 7374 7228 7365 6c66 2e6d 6178 292c 0a20  str(self.max),. 
+0001f480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001f490: 656c 662e 6e75 6d5f 7365 7173 2c0a 2020  elf.num_seqs,.  
+0001f4a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001f4b0: 7472 615f 7374 722c 0a20 2020 2020 2020  tra_str,.       
+0001f4c0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0001f4d0: 6574 7572 6e20 2253 7461 7473 286e 756d  eturn "Stats(num
+0001f4e0: 5f73 6571 733d 3029 220a 0a20 2020 2064  _seqs=0)"..    d
+0001f4f0: 6566 2063 6f6c 6c65 6374 2873 656c 662c  ef collect(self,
+0001f500: 2064 6174 6129 3a0a 2020 2020 2020 2020   data):.        
+0001f510: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+0001f520: 616d 206e 756d 7079 2e6e 6461 7272 6179  am numpy.ndarray
+0001f530: 7c6c 6973 745b 696e 745d 7c6c 6973 745b  |list[int]|list[
+0001f540: 666c 6f61 745d 2064 6174 613a 2073 6861  float] data: sha
+0001f550: 7065 2028 7469 6d65 2c20 6469 6d29 206f  pe (time, dim) o
+0001f560: 7220 2874 696d 652c 290a 2020 2020 2020  r (time,).      
+0001f570: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
+0001f580: 706f 7274 206e 756d 7079 0a0a 2020 2020  port numpy..    
+0001f590: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001f5a0: 6528 6461 7461 2c20 286c 6973 742c 2074  e(data, (list, t
+0001f5b0: 7570 6c65 2929 3a0a 2020 2020 2020 2020  uple)):.        
+0001f5c0: 2020 2020 6461 7461 203d 206e 756d 7079      data = numpy
+0001f5d0: 2e61 7272 6179 2864 6174 6129 0a20 2020  .array(data).   
+0001f5e0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
+0001f5f0: 7374 616e 6365 2864 6174 612c 206e 756d  stance(data, num
+0001f600: 7079 2e6e 6461 7272 6179 290a 2020 2020  py.ndarray).    
+0001f610: 2020 2020 6173 7365 7274 2064 6174 612e      assert data.
+0001f620: 6e64 696d 203e 3d20 310a 2020 2020 2020  ndim >= 1.      
+0001f630: 2020 6966 2064 6174 612e 7368 6170 655b    if data.shape[
+0001f640: 305d 203d 3d20 303a 0a20 2020 2020 2020  0] == 0:.       
+0001f650: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0001f660: 2020 2020 7365 6c66 2e6e 756d 5f73 6571      self.num_seq
+0001f670: 7320 2b3d 2031 0a20 2020 2020 2020 2064  s += 1.        d
+0001f680: 6174 615f 6d69 6e20 3d20 6e75 6d70 792e  ata_min = numpy.
+0001f690: 6d69 6e28 6461 7461 2c20 6178 6973 3d30  min(data, axis=0
+0001f6a0: 290a 2020 2020 2020 2020 6461 7461 5f6d  ).        data_m
+0001f6b0: 6178 203d 206e 756d 7079 2e6d 6178 2864  ax = numpy.max(d
+0001f6c0: 6174 612c 2061 7869 733d 3029 0a20 2020  ata, axis=0).   
+0001f6d0: 2020 2020 2069 6620 7365 6c66 2e6d 696e       if self.min
+0001f6e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001f6f0: 2020 2020 2020 7365 6c66 2e6d 696e 203d        self.min =
+0001f700: 2064 6174 615f 6d69 6e0a 2020 2020 2020   data_min.      
+0001f710: 2020 2020 2020 7365 6c66 2e6d 6178 203d        self.max =
+0001f720: 2064 6174 615f 6d61 780a 2020 2020 2020   data_max.      
+0001f730: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001f740: 2020 2020 7365 6c66 2e6d 696e 203d 206e      self.min = n
+0001f750: 756d 7079 2e6d 696e 696d 756d 2873 656c  umpy.minimum(sel
+0001f760: 662e 6d69 6e2c 2064 6174 615f 6d69 6e29  f.min, data_min)
+0001f770: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001f780: 662e 6d61 7820 3d20 6e75 6d70 792e 6d61  f.max = numpy.ma
+0001f790: 7869 6d75 6d28 7365 6c66 2e6d 6178 2c20  ximum(self.max, 
+0001f7a0: 6461 7461 5f6d 6178 290a 2020 2020 2020  data_max).      
+0001f7b0: 2020 6e65 775f 746f 7461 6c5f 6461 7461    new_total_data
+0001f7c0: 5f6c 656e 203d 2073 656c 662e 746f 7461  _len = self.tota
+0001f7d0: 6c5f 6461 7461 5f6c 656e 202b 2064 6174  l_data_len + dat
+0001f7e0: 612e 7368 6170 655b 305d 0a20 2020 2020  a.shape[0].     
+0001f7f0: 2020 206d 6561 6e5f 6469 6666 203d 206e     mean_diff = n
+0001f800: 756d 7079 2e6d 6561 6e28 6461 7461 2c20  umpy.mean(data, 
+0001f810: 6178 6973 3d30 2920 2d20 7365 6c66 2e6d  axis=0) - self.m
+0001f820: 6561 6e0a 2020 2020 2020 2020 6d5f 6120  ean.        m_a 
+0001f830: 3d20 7365 6c66 2e76 6172 202a 2073 656c  = self.var * sel
+0001f840: 662e 746f 7461 6c5f 6461 7461 5f6c 656e  f.total_data_len
+0001f850: 0a20 2020 2020 2020 206d 5f62 203d 206e  .        m_b = n
+0001f860: 756d 7079 2e76 6172 2864 6174 612c 2061  umpy.var(data, a
+0001f870: 7869 733d 3029 202a 2064 6174 612e 7368  xis=0) * data.sh
+0001f880: 6170 655b 305d 0a20 2020 2020 2020 206d  ape[0].        m
+0001f890: 3220 3d20 6d5f 6120 2b20 6d5f 6220 2b20  2 = m_a + m_b + 
+0001f8a0: 6d65 616e 5f64 6966 662a 2a32 202a 2073  mean_diff**2 * s
+0001f8b0: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
+0001f8c0: 656e 202a 2064 6174 612e 7368 6170 655b  en * data.shape[
+0001f8d0: 305d 202f 206e 6577 5f74 6f74 616c 5f64  0] / new_total_d
+0001f8e0: 6174 615f 6c65 6e0a 2020 2020 2020 2020  ata_len.        
+0001f8f0: 7365 6c66 2e76 6172 203d 206d 3220 2f20  self.var = m2 / 
+0001f900: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
+0001f910: 656e 0a20 2020 2020 2020 2064 6174 615f  en.        data_
+0001f920: 7375 6d20 3d20 6e75 6d70 792e 7375 6d28  sum = numpy.sum(
+0001f930: 6461 7461 2c20 6178 6973 3d30 290a 2020  data, axis=0).  
+0001f940: 2020 2020 2020 6465 6c74 6120 3d20 6461        delta = da
+0001f950: 7461 5f73 756d 202d 2073 656c 662e 6d65  ta_sum - self.me
+0001f960: 616e 202a 2064 6174 612e 7368 6170 655b  an * data.shape[
+0001f970: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
+0001f980: 6d65 616e 202b 3d20 6465 6c74 6120 2f20  mean += delta / 
+0001f990: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
+0001f9a0: 656e 0a20 2020 2020 2020 2064 656c 7461  en.        delta
+0001f9b0: 5f73 7120 3d20 6e75 6d70 792e 7375 6d28  _sq = numpy.sum(
+0001f9c0: 6461 7461 202a 2064 6174 612c 2061 7869  data * data, axi
+0001f9d0: 733d 3029 202d 2073 656c 662e 6d65 616e  s=0) - self.mean
+0001f9e0: 5f73 7120 2a20 6461 7461 2e73 6861 7065  _sq * data.shape
+0001f9f0: 5b30 5d0a 2020 2020 2020 2020 7365 6c66  [0].        self
+0001fa00: 2e6d 6561 6e5f 7371 202b 3d20 6465 6c74  .mean_sq += delt
+0001fa10: 615f 7371 202f 206e 6577 5f74 6f74 616c  a_sq / new_total
+0001fa20: 5f64 6174 615f 6c65 6e0a 2020 2020 2020  _data_len.      
+0001fa30: 2020 7365 6c66 2e74 6f74 616c 5f64 6174    self.total_dat
+0001fa40: 615f 6c65 6e20 3d20 6e65 775f 746f 7461  a_len = new_tota
+0001fa50: 6c5f 6461 7461 5f6c 656e 0a0a 2020 2020  l_data_len..    
+0001fa60: 6465 6620 6765 745f 6d65 616e 2873 656c  def get_mean(sel
+0001fa70: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0001fa80: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0001fa90: 206d 6561 6e2c 2073 6861 7065 2028 6469   mean, shape (di
+0001faa0: 6d2c 290a 2020 2020 2020 2020 3a72 7479  m,).        :rty
+0001fab0: 7065 3a20 6e75 6d70 792e 6e64 6172 7261  pe: numpy.ndarra
+0001fac0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
+0001fad0: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
+0001fae0: 662e 6e75 6d5f 7365 7173 203e 2030 0a20  f.num_seqs > 0. 
+0001faf0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001fb00: 6c66 2e6d 6561 6e0a 0a20 2020 2064 6566  lf.mean..    def
+0001fb10: 2067 6574 5f73 7464 5f64 6576 2873 656c   get_std_dev(sel
+0001fb20: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0001fb30: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0001fb40: 2073 7464 2064 6576 2c20 7368 6170 6520   std dev, shape 
+0001fb50: 2864 696d 2c29 0a20 2020 2020 2020 203a  (dim,).        :
+0001fb60: 7274 7970 653a 206e 756d 7079 2e6e 6461  rtype: numpy.nda
+0001fb70: 7272 6179 0a20 2020 2020 2020 2022 2222  rray.        """
+0001fb80: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+0001fb90: 6e75 6d70 790a 0a20 2020 2020 2020 2061  numpy..        a
+0001fba0: 7373 6572 7420 7365 6c66 2e6e 756d 5f73  ssert self.num_s
+0001fbb0: 6571 7320 3e20 300a 2020 2020 2020 2020  eqs > 0.        
+0001fbc0: 7265 7475 726e 206e 756d 7079 2e73 7172  return numpy.sqr
+0001fbd0: 7428 7365 6c66 2e76 6172 290a 2020 2020  t(self.var).    
+0001fbe0: 2020 2020 2320 7265 7475 726e 206e 756d      # return num
+0001fbf0: 7079 2e73 7172 7428 7365 6c66 2e6d 6561  py.sqrt(self.mea
+0001fc00: 6e5f 7371 202d 2073 656c 662e 6d65 616e  n_sq - self.mean
+0001fc10: 202a 2073 656c 662e 6d65 616e 290a 0a20   * self.mean).. 
+0001fc20: 2020 2064 6566 2064 756d 7028 7365 6c66     def dump(self
+0001fc30: 2c20 6f75 7470 7574 5f66 696c 655f 7072  , output_file_pr
+0001fc40: 6566 6978 3d4e 6f6e 652c 2073 7472 6561  efix=None, strea
+0001fc50: 6d3d 4e6f 6e65 2c20 7374 7265 616d 5f70  m=None, stream_p
+0001fc60: 7265 6669 783d 2222 293a 0a20 2020 2020  refix=""):.     
+0001fc70: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0001fc80: 7061 7261 6d20 7374 727c 4e6f 6e65 206f  param str|None o
+0001fc90: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
+0001fca0: 783a 2069 6620 6769 7665 6e2c 2077 696c  x: if given, wil
+0001fcb0: 6c20 6e75 6d70 792e 7361 7665 7478 7420  l numpy.savetxt 
+0001fcc0: 6d65 616e 7c73 7464 5f64 6576 2074 6f20  mean|std_dev to 
+0001fcd0: 6469 736b 0a20 2020 2020 2020 203a 7061  disk.        :pa
+0001fce0: 7261 6d20 7374 7220 7374 7265 616d 5f70  ram str stream_p
+0001fcf0: 7265 6669 783a 0a20 2020 2020 2020 203a  refix:.        :
+0001fd00: 7061 7261 6d20 696f 2e54 6578 7449 4f42  param io.TextIOB
+0001fd10: 6173 6520 7374 7265 616d 3a20 7379 732e  ase stream: sys.
+0001fd20: 7374 646f 7574 2062 7920 6465 6661 756c  stdout by defaul
+0001fd30: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+0001fd40: 2020 2020 2020 6966 2073 7472 6561 6d20        if stream 
+0001fd50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001fd60: 2020 2020 2073 7472 6561 6d20 3d20 7379       stream = sy
+0001fd70: 732e 7374 646f 7574 0a20 2020 2020 2020  s.stdout.       
+0001fd80: 2069 6d70 6f72 7420 6e75 6d70 790a 0a20   import numpy.. 
+0001fd90: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
+0001fda0: 5374 6174 733a 2220 2520 7374 7265 616d  Stats:" % stream
+0001fdb0: 5f70 7265 6669 782c 2066 696c 653d 7374  _prefix, file=st
+0001fdc0: 7265 616d 290a 2020 2020 2020 2020 6966  ream).        if
+0001fdd0: 2073 656c 662e 6e75 6d5f 7365 7173 2021   self.num_seqs !
+0001fde0: 3d20 7365 6c66 2e74 6f74 616c 5f64 6174  = self.total_dat
+0001fdf0: 615f 6c65 6e3a 0a20 2020 2020 2020 2020  a_len:.         
+0001fe00: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0001fe10: 2020 2020 2020 2020 2020 2220 2025 6920            "  %i 
+0001fe20: 7365 7173 2c20 2569 2074 6f74 616c 2066  seqs, %i total f
+0001fe30: 7261 6d65 732c 2025 6620 6176 6572 6167  rames, %f averag
+0001fe40: 6520 6672 616d 6573 220a 2020 2020 2020  e frames".      
+0001fe50: 2020 2020 2020 2020 2020 2520 2873 656c            % (sel
+0001fe60: 662e 6e75 6d5f 7365 7173 2c20 7365 6c66  f.num_seqs, self
+0001fe70: 2e74 6f74 616c 5f64 6174 615f 6c65 6e2c  .total_data_len,
+0001fe80: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
+0001fe90: 5f6c 656e 202f 2066 6c6f 6174 2873 656c  _len / float(sel
+0001fea0: 662e 6e75 6d5f 7365 7173 2929 2c0a 2020  f.num_seqs)),.  
+0001feb0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001fec0: 6c65 3d73 7472 6561 6d2c 0a20 2020 2020  le=stream,.     
+0001fed0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001fee0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001fef0: 2020 2070 7269 6e74 2822 2020 2569 2073     print("  %i s
+0001ff00: 6571 7322 2025 2028 7365 6c66 2e6e 756d  eqs" % (self.num
+0001ff10: 5f73 6571 732c 292c 2066 696c 653d 7374  _seqs,), file=st
+0001ff20: 7265 616d 290a 2020 2020 2020 2020 7072  ream).        pr
+0001ff30: 696e 7428 2220 204d 6561 6e3a 2025 7322  int("  Mean: %s"
+0001ff40: 2025 2028 7365 6c66 2e66 6f72 6d61 745f   % (self.format_
+0001ff50: 7374 7228 7365 6c66 2e67 6574 5f6d 6561  str(self.get_mea
+0001ff60: 6e28 2929 2c29 2c20 6669 6c65 3d73 7472  n()),), file=str
+0001ff70: 6561 6d29 0a20 2020 2020 2020 2070 7269  eam).        pri
+0001ff80: 6e74 2822 2020 5374 6420 6465 763a 2025  nt("  Std dev: %
+0001ff90: 7322 2025 2028 7365 6c66 2e66 6f72 6d61  s" % (self.forma
+0001ffa0: 745f 7374 7228 7365 6c66 2e67 6574 5f73  t_str(self.get_s
+0001ffb0: 7464 5f64 6576 2829 292c 292c 2066 696c  td_dev()),), fil
+0001ffc0: 653d 7374 7265 616d 290a 2020 2020 2020  e=stream).      
+0001ffd0: 2020 7072 696e 7428 2220 204d 696e 2f6d    print("  Min/m
+0001ffe0: 6178 3a20 2573 202f 2025 7322 2025 2028  ax: %s / %s" % (
+0001fff0: 7365 6c66 2e66 6f72 6d61 745f 7374 7228  self.format_str(
+00020000: 7365 6c66 2e6d 696e 292c 2073 656c 662e  self.min), self.
+00020010: 666f 726d 6174 5f73 7472 2873 656c 662e  format_str(self.
+00020020: 6d61 7829 292c 2066 696c 653d 7374 7265  max)), file=stre
+00020030: 616d 290a 2020 2020 2020 2020 2320 7072  am).        # pr
+00020040: 696e 7428 2253 7464 2064 6576 2028 6e61  int("Std dev (na
+00020050: 6976 6529 3a20 2573 2220 2520 6e75 6d70  ive): %s" % nump
+00020060: 792e 7371 7274 2873 656c 662e 6d65 616e  y.sqrt(self.mean
+00020070: 5f73 7120 2d20 7365 6c66 2e6d 6561 6e20  _sq - self.mean 
+00020080: 2a20 7365 6c66 2e6d 6561 6e29 2c20 6669  * self.mean), fi
+00020090: 6c65 3d73 7472 6561 6d29 0a20 2020 2020  le=stream).     
+000200a0: 2020 2069 6620 6f75 7470 7574 5f66 696c     if output_fil
+000200b0: 655f 7072 6566 6978 3a0a 2020 2020 2020  e_prefix:.      
+000200c0: 2020 2020 2020 7072 696e 7428 2220 2057        print("  W
+000200d0: 7269 7465 206d 6561 6e2f 7374 642d 6465  rite mean/std-de
+000200e0: 7620 746f 2025 732e 286d 6561 6e7c 7374  v to %s.(mean|st
+000200f0: 645f 6465 7629 2e74 7874 2e22 2025 2028  d_dev).txt." % (
+00020100: 6f75 7470 7574 5f66 696c 655f 7072 6566  output_file_pref
+00020110: 6978 2c29 2c20 6669 6c65 3d73 7472 6561  ix,), file=strea
+00020120: 6d29 0a20 2020 2020 2020 2020 2020 206e  m).            n
+00020130: 756d 7079 2e73 6176 6574 7874 2822 2573  umpy.savetxt("%s
+00020140: 2e6d 6561 6e2e 7478 7422 2025 206f 7574  .mean.txt" % out
+00020150: 7075 745f 6669 6c65 5f70 7265 6669 782c  put_file_prefix,
+00020160: 2073 656c 662e 6765 745f 6d65 616e 2829   self.get_mean()
+00020170: 290a 2020 2020 2020 2020 2020 2020 6e75  ).            nu
+00020180: 6d70 792e 7361 7665 7478 7428 2225 732e  mpy.savetxt("%s.
+00020190: 7374 645f 6465 762e 7478 7422 2025 206f  std_dev.txt" % o
+000201a0: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
+000201b0: 782c 2073 656c 662e 6765 745f 7374 645f  x, self.get_std_
+000201c0: 6465 7628 2929 0a0a 0a64 6566 2069 735f  dev())...def is_
+000201d0: 6e61 6d65 6474 7570 6c65 2863 6c73 293a  namedtuple(cls):
+000201e0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+000201f0: 7261 6d20 5420 636c 733a 2074 7570 6c65  ram T cls: tuple
+00020200: 2c20 6c69 7374 206f 7220 6e61 6d65 6474  , list or namedt
+00020210: 7570 6c65 2074 7970 650a 2020 2020 3a72  uple type.    :r
+00020220: 6574 7572 6e3a 2077 6865 7468 6572 2063  eturn: whether c
+00020230: 6c73 2069 7320 6120 6e61 6d65 6474 7570  ls is a namedtup
+00020240: 6c65 2074 7970 650a 2020 2020 3a72 7479  le type.    :rty
+00020250: 7065 3a20 626f 6f6c 0a20 2020 2022 2222  pe: bool.    """
+00020260: 0a20 2020 2072 6574 7572 6e20 6973 7375  .    return issu
+00020270: 6263 6c61 7373 2863 6c73 2c20 7475 706c  bclass(cls, tupl
+00020280: 6529 2061 6e64 2063 6c73 2069 7320 6e6f  e) and cls is no
+00020290: 7420 7475 706c 650a 0a0a 6465 6620 6d61  t tuple...def ma
+000202a0: 6b65 5f73 6571 5f6f 665f 7479 7065 2863  ke_seq_of_type(c
+000202b0: 6c73 2c20 7365 7129 3a0a 2020 2020 2222  ls, seq):.    ""
+000202c0: 220a 2020 2020 3a70 6172 616d 2074 7970  ".    :param typ
+000202d0: 655b 545d 2063 6c73 3a20 652e 672e 2074  e[T] cls: e.g. t
+000202e0: 7570 6c65 2c20 6c69 7374 206f 7220 6e61  uple, list or na
+000202f0: 6d65 6474 7570 6c65 0a20 2020 203a 7061  medtuple.    :pa
+00020300: 7261 6d20 6c69 7374 7c74 7570 6c65 7c54  ram list|tuple|T
+00020310: 2073 6571 3a0a 2020 2020 3a72 6574 7572   seq:.    :retur
+00020320: 6e3a 2063 6c73 2873 6571 2920 6f72 2063  n: cls(seq) or c
+00020330: 6c73 282a 7365 7129 0a20 2020 203a 7274  ls(*seq).    :rt
+00020340: 7970 653a 2054 7c6c 6973 747c 7475 706c  ype: T|list|tupl
+00020350: 650a 2020 2020 2222 220a 2020 2020 6173  e.    """.    as
+00020360: 7365 7274 2069 7373 7562 636c 6173 7328  sert issubclass(
+00020370: 636c 732c 2028 6c69 7374 2c20 7475 706c  cls, (list, tupl
+00020380: 6529 290a 2020 2020 6966 2069 735f 6e61  e)).    if is_na
+00020390: 6d65 6474 7570 6c65 2863 6c73 293a 0a20  medtuple(cls):. 
+000203a0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+000203b0: 7328 2a73 6571 2920 2023 206e 6f71 610a  s(*seq)  # noqa.
+000203c0: 2020 2020 7265 7475 726e 2063 6c73 2873      return cls(s
+000203d0: 6571 2920 2023 206e 6f71 610a 0a0a 6465  eq)  # noqa...de
+000203e0: 6620 656e 7375 7265 5f6c 6973 745f 6f66  f ensure_list_of
+000203f0: 5f74 7970 6528 6c73 2c20 7479 7065 5f29  _type(ls, type_)
+00020400: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00020410: 6172 616d 206c 6973 7420 6c73 3a0a 2020  aram list ls:.  
+00020420: 2020 3a70 6172 616d 2028 2829 2d3e 5429    :param (()->T)
+00020430: 7c74 7970 655b 545d 2074 7970 655f 3a20  |type[T] type_: 
+00020440: 7479 7065 206f 6620 696e 7374 616e 6365  type of instance
+00020450: 7320 6f66 2060 6c73 602e 0a20 2020 2020  s of `ls`..     
+00020460: 204e 6f74 6520 7468 6520 7374 7261 6e67   Note the strang
+00020470: 6520 7479 7065 2068 6572 6520 696e 2074  e type here in t
+00020480: 6865 2064 6f63 7374 7269 6e67 2069 7320  he docstring is 
+00020490: 6475 6520 746f 2073 6f6d 6520 5079 4368  due to some PyCh
+000204a0: 6172 6d20 7479 7065 2069 6e66 6572 656e  arm type inferen
+000204b0: 6365 2070 726f 626c 656d 730a 2020 2020  ce problems.    
+000204c0: 2020 2868 7474 7073 3a2f 2f79 6f75 7472    (https://youtr
+000204d0: 6163 6b2e 6a65 7462 7261 696e 732e 636f  ack.jetbrains.co
+000204e0: 6d2f 6973 7375 652f 5059 2d35 3038 3238  m/issue/PY-50828
+000204f0: 292e 0a20 2020 203a 7274 7970 653a 206c  )..    :rtype: l
+00020500: 6973 745b 545d 0a20 2020 2022 2222 0a20  ist[T].    """. 
+00020510: 2020 2061 7373 6572 7420 616c 6c28 6973     assert all(is
+00020520: 696e 7374 616e 6365 2865 6c65 6d2c 2074  instance(elem, t
+00020530: 7970 655f 2920 666f 7220 656c 656d 2069  ype_) for elem i
+00020540: 6e20 6c73 290a 2020 2020 7265 7475 726e  n ls).    return
+00020550: 206c 730a 0a0a 4063 6f6e 7465 7874 6c69   ls...@contextli
+00020560: 622e 636f 6e74 6578 746d 616e 6167 6572  b.contextmanager
+00020570: 0a64 6566 2064 756d 6d79 5f6e 6f6f 705f  .def dummy_noop_
+00020580: 6374 7828 293a 0a20 2020 2022 2222 0a20  ctx():.    """. 
+00020590: 2020 2050 726f 7669 6465 7320 6120 6e6f     Provides a no
+000205a0: 2d6f 7020 636f 6e74 6578 7420 6d61 6e61  -op context mana
+000205b0: 6765 722e 0a20 2020 2022 2222 0a20 2020  ger..    """.   
+000205c0: 2079 6965 6c64 204e 6f6e 650a 0a0a 6465   yield None...de
+000205d0: 6620 5f67 6574 5f6e 6772 616d 7328 7365  f _get_ngrams(se
+000205e0: 676d 656e 742c 206d 6178 5f6f 7264 6572  gment, max_order
+000205f0: 293a 0a20 2020 2022 2222 4578 7472 6163  ):.    """Extrac
+00020600: 7473 2061 6c6c 206e 2d67 7261 6d73 2075  ts all n-grams u
+00020610: 7074 6f20 6120 6769 7665 6e20 6d61 7869  pto a given maxi
+00020620: 6d75 6d20 6f72 6465 7220 6672 6f6d 2061  mum order from a
+00020630: 6e20 696e 7075 7420 7365 676d 656e 742e  n input segment.
+00020640: 0a20 2020 2043 6f64 6520 6164 6170 7465  .    Code adapte
+00020650: 6420 6672 6f6d 2047 6f6f 676c 6520 5465  d from Google Te
+00020660: 6e73 6f72 3254 656e 736f 722e 0a0a 2020  nsor2Tensor...  
+00020670: 2020 4172 6773 3a0a 2020 2020 2020 7365    Args:.      se
+00020680: 676d 656e 7420 286c 6973 745b 696e 745d  gment (list[int]
+00020690: 7c6c 6973 745b 7374 725d 293a 2074 6578  |list[str]): tex
+000206a0: 7420 7365 676d 656e 7420 6672 6f6d 2077  t segment from w
+000206b0: 6869 6368 206e 2d67 7261 6d73 2077 696c  hich n-grams wil
+000206c0: 6c20 6265 2065 7874 7261 6374 6564 2e0a  l be extracted..
+000206d0: 2020 2020 2020 6d61 785f 6f72 6465 7220        max_order 
+000206e0: 2869 6e74 293a 206d 6178 696d 756d 206c  (int): maximum l
+000206f0: 656e 6774 6820 696e 2074 6f6b 656e 7320  ength in tokens 
+00020700: 6f66 2074 6865 206e 2d67 7261 6d73 2072  of the n-grams r
+00020710: 6574 7572 6e65 6420 6279 2074 6869 730a  eturned by this.
+00020720: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00020730: 732e 0a0a 2020 2020 5265 7475 726e 733a  s...    Returns:
+00020740: 0a20 2020 2020 2054 6865 2043 6f75 6e74  .      The Count
+00020750: 6572 2063 6f6e 7461 696e 696e 6720 616c  er containing al
+00020760: 6c20 6e2d 6772 616d 7320 7570 746f 206d  l n-grams upto m
+00020770: 6178 5f6f 7264 6572 2069 6e20 7365 676d  ax_order in segm
+00020780: 656e 740a 2020 2020 2020 7769 7468 2061  ent.      with a
+00020790: 2063 6f75 6e74 206f 6620 686f 7720 6d61   count of how ma
+000207a0: 6e79 2074 696d 6573 2065 6163 6820 6e2d  ny times each n-
+000207b0: 6772 616d 206f 6363 7572 7265 642e 0a20  gram occurred.. 
+000207c0: 2020 2022 2222 0a20 2020 2069 6d70 6f72     """.    impor
+000207d0: 7420 636f 6c6c 6563 7469 6f6e 730a 0a20  t collections.. 
+000207e0: 2020 206e 6772 616d 5f63 6f75 6e74 7320     ngram_counts 
+000207f0: 3d20 636f 6c6c 6563 7469 6f6e 732e 436f  = collections.Co
+00020800: 756e 7465 7228 290a 2020 2020 666f 7220  unter().    for 
+00020810: 6f72 6465 7220 696e 2072 616e 6765 2831  order in range(1
+00020820: 2c20 6d61 785f 6f72 6465 7220 2b20 3129  , max_order + 1)
+00020830: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
+00020840: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+00020850: 7365 676d 656e 7429 202d 206f 7264 6572  segment) - order
+00020860: 202b 2031 293a 0a20 2020 2020 2020 2020   + 1):.         
+00020870: 2020 206e 6772 616d 203d 2074 7570 6c65     ngram = tuple
+00020880: 2873 6567 6d65 6e74 5b69 203a 2069 202b  (segment[i : i +
+00020890: 206f 7264 6572 5d29 0a20 2020 2020 2020   order]).       
+000208a0: 2020 2020 206e 6772 616d 5f63 6f75 6e74       ngram_count
+000208b0: 735b 6e67 7261 6d5d 202b 3d20 310a 2020  s[ngram] += 1.  
+000208c0: 2020 7265 7475 726e 206e 6772 616d 5f63    return ngram_c
+000208d0: 6f75 6e74 730a 0a0a 6465 6620 636f 6d70  ounts...def comp
+000208e0: 7574 655f 626c 6575 2872 6566 6572 656e  ute_bleu(referen
+000208f0: 6365 5f63 6f72 7075 732c 2074 7261 6e73  ce_corpus, trans
+00020900: 6c61 7469 6f6e 5f63 6f72 7075 732c 206d  lation_corpus, m
+00020910: 6178 5f6f 7264 6572 3d34 2c20 7573 655f  ax_order=4, use_
+00020920: 6270 3d54 7275 6529 3a0a 2020 2020 2222  bp=True):.    ""
+00020930: 2243 6f6d 7075 7465 7320 424c 4555 2073  "Computes BLEU s
+00020940: 636f 7265 206f 6620 7472 616e 736c 6174  core of translat
+00020950: 6564 2073 6567 6d65 6e74 7320 6167 6169  ed segments agai
+00020960: 6e73 7420 6f6e 6520 6f72 206d 6f72 6520  nst one or more 
+00020970: 7265 6665 7265 6e63 6573 2e0a 2020 2020  references..    
+00020980: 436f 6465 2061 6461 7074 6564 2066 726f  Code adapted fro
+00020990: 6d20 476f 6f67 6c65 2054 656e 736f 7232  m Google Tensor2
+000209a0: 5465 6e73 6f72 2e0a 0a20 2020 2041 7267  Tensor...    Arg
+000209b0: 733a 0a20 2020 2020 2072 6566 6572 656e  s:.      referen
+000209c0: 6365 5f63 6f72 7075 7320 286c 6973 745b  ce_corpus (list[
+000209d0: 6c69 7374 5b69 6e74 5d7c 6c69 7374 5b73  list[int]|list[s
+000209e0: 7472 5d5d 293a 206c 6973 7420 6f66 2072  tr]]): list of r
+000209f0: 6566 6572 656e 6365 7320 666f 7220 6561  eferences for ea
+00020a00: 6368 2074 7261 6e73 6c61 7469 6f6e 2e20  ch translation. 
+00020a10: 4561 6368 0a20 2020 2020 2020 2020 2072  Each.          r
+00020a20: 6566 6572 656e 6365 2073 686f 756c 6420  eference should 
+00020a30: 6265 2074 6f6b 656e 697a 6564 2069 6e74  be tokenized int
+00020a40: 6f20 6120 6c69 7374 206f 6620 746f 6b65  o a list of toke
+00020a50: 6e73 2e0a 2020 2020 2020 7472 616e 736c  ns..      transl
+00020a60: 6174 696f 6e5f 636f 7270 7573 2028 6c69  ation_corpus (li
+00020a70: 7374 5b6c 6973 745b 696e 745d 7c6c 6973  st[list[int]|lis
+00020a80: 745b 7374 725d 5d29 3a20 6c69 7374 206f  t[str]]): list o
+00020a90: 6620 7472 616e 736c 6174 696f 6e73 2074  f translations t
+00020aa0: 6f20 7363 6f72 652e 2045 6163 6820 7472  o score. Each tr
+00020ab0: 616e 736c 6174 696f 6e0a 2020 2020 2020  anslation.      
+00020ac0: 2020 2020 7368 6f75 6c64 2062 6520 746f      should be to
+00020ad0: 6b65 6e69 7a65 6420 696e 746f 2061 206c  kenized into a l
+00020ae0: 6973 7420 6f66 2074 6f6b 656e 732e 0a20  ist of tokens.. 
+00020af0: 2020 2020 206d 6178 5f6f 7264 6572 2028       max_order (
+00020b00: 696e 7429 3a20 4d61 7869 6d75 6d20 6e2d  int): Maximum n-
+00020b10: 6772 616d 206f 7264 6572 2074 6f20 7573  gram order to us
+00020b20: 6520 7768 656e 2063 6f6d 7075 7469 6e67  e when computing
+00020b30: 2042 4c45 5520 7363 6f72 652e 0a20 2020   BLEU score..   
+00020b40: 2020 2075 7365 5f62 7020 2862 6f6f 6c29     use_bp (bool)
+00020b50: 3a20 626f 6f6c 6561 6e2c 2077 6865 7468  : boolean, wheth
+00020b60: 6572 2074 6f20 6170 706c 7920 6272 6576  er to apply brev
+00020b70: 6974 7920 7065 6e61 6c74 792e 0a0a 2020  ity penalty...  
+00020b80: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00020b90: 2042 4c45 5520 7363 6f72 652e 0a20 2020   BLEU score..   
+00020ba0: 2022 2222 0a20 2020 2069 6d70 6f72 7420   """.    import 
+00020bb0: 6d61 7468 0a0a 2020 2020 7265 6665 7265  math..    refere
+00020bc0: 6e63 655f 6c65 6e67 7468 203d 2030 0a20  nce_length = 0. 
+00020bd0: 2020 2074 7261 6e73 6c61 7469 6f6e 5f6c     translation_l
+00020be0: 656e 6774 6820 3d20 300a 2020 2020 6270  ength = 0.    bp
+00020bf0: 203d 2031 2e30 0a20 2020 2067 656f 5f6d   = 1.0.    geo_m
+00020c00: 6561 6e20 3d20 300a 0a20 2020 206d 6174  ean = 0..    mat
+00020c10: 6368 6573 5f62 795f 6f72 6465 7220 3d20  ches_by_order = 
+00020c20: 5b30 5d20 2a20 6d61 785f 6f72 6465 720a  [0] * max_order.
+00020c30: 2020 2020 706f 7373 6962 6c65 5f6d 6174      possible_mat
+00020c40: 6368 6573 5f62 795f 6f72 6465 7220 3d20  ches_by_order = 
+00020c50: 5b30 5d20 2a20 6d61 785f 6f72 6465 720a  [0] * max_order.
+00020c60: 0a20 2020 2066 6f72 2028 7265 6665 7265  .    for (refere
+00020c70: 6e63 6573 2c20 7472 616e 736c 6174 696f  nces, translatio
+00020c80: 6e73 2920 696e 207a 6970 2872 6566 6572  ns) in zip(refer
+00020c90: 656e 6365 5f63 6f72 7075 732c 2074 7261  ence_corpus, tra
+00020ca0: 6e73 6c61 7469 6f6e 5f63 6f72 7075 7329  nslation_corpus)
+00020cb0: 3a0a 2020 2020 2020 2020 7265 6665 7265  :.        refere
+00020cc0: 6e63 655f 6c65 6e67 7468 202b 3d20 6c65  nce_length += le
+00020cd0: 6e28 7265 6665 7265 6e63 6573 290a 2020  n(references).  
+00020ce0: 2020 2020 2020 7472 616e 736c 6174 696f        translatio
+00020cf0: 6e5f 6c65 6e67 7468 202b 3d20 6c65 6e28  n_length += len(
+00020d00: 7472 616e 736c 6174 696f 6e73 290a 2020  translations).  
+00020d10: 2020 2020 2020 7265 665f 6e67 7261 6d5f        ref_ngram_
+00020d20: 636f 756e 7473 203d 205f 6765 745f 6e67  counts = _get_ng
+00020d30: 7261 6d73 2872 6566 6572 656e 6365 732c  rams(references,
+00020d40: 206d 6178 5f6f 7264 6572 290a 2020 2020   max_order).    
+00020d50: 2020 2020 7472 616e 736c 6174 696f 6e5f      translation_
+00020d60: 6e67 7261 6d5f 636f 756e 7473 203d 205f  ngram_counts = _
+00020d70: 6765 745f 6e67 7261 6d73 2874 7261 6e73  get_ngrams(trans
+00020d80: 6c61 7469 6f6e 732c 206d 6178 5f6f 7264  lations, max_ord
+00020d90: 6572 290a 0a20 2020 2020 2020 206f 7665  er)..        ove
+00020da0: 726c 6170 203d 207b 6e67 7261 6d3a 206d  rlap = {ngram: m
+00020db0: 696e 2863 6f75 6e74 2c20 7472 616e 736c  in(count, transl
+00020dc0: 6174 696f 6e5f 6e67 7261 6d5f 636f 756e  ation_ngram_coun
+00020dd0: 7473 5b6e 6772 616d 5d29 2066 6f72 206e  ts[ngram]) for n
+00020de0: 6772 616d 2c20 636f 756e 7420 696e 2072  gram, count in r
+00020df0: 6566 5f6e 6772 616d 5f63 6f75 6e74 732e  ef_ngram_counts.
+00020e00: 6974 656d 7328 297d 0a0a 2020 2020 2020  items()}..      
+00020e10: 2020 666f 7220 6e67 7261 6d20 696e 206f    for ngram in o
+00020e20: 7665 726c 6170 3a0a 2020 2020 2020 2020  verlap:.        
+00020e30: 2020 2020 6d61 7463 6865 735f 6279 5f6f      matches_by_o
+00020e40: 7264 6572 5b6c 656e 286e 6772 616d 2920  rder[len(ngram) 
+00020e50: 2d20 315d 202b 3d20 6f76 6572 6c61 705b  - 1] += overlap[
+00020e60: 6e67 7261 6d5d 0a20 2020 2020 2020 2066  ngram].        f
+00020e70: 6f72 206e 6772 616d 2069 6e20 7472 616e  or ngram in tran
+00020e80: 736c 6174 696f 6e5f 6e67 7261 6d5f 636f  slation_ngram_co
+00020e90: 756e 7473 3a0a 2020 2020 2020 2020 2020  unts:.          
+00020ea0: 2020 706f 7373 6962 6c65 5f6d 6174 6368    possible_match
+00020eb0: 6573 5f62 795f 6f72 6465 725b 6c65 6e28  es_by_order[len(
+00020ec0: 6e67 7261 6d29 202d 2031 5d20 2b3d 2074  ngram) - 1] += t
+00020ed0: 7261 6e73 6c61 7469 6f6e 5f6e 6772 616d  ranslation_ngram
+00020ee0: 5f63 6f75 6e74 735b 6e67 7261 6d5d 0a0a  _counts[ngram]..
+00020ef0: 2020 2020 7072 6563 6973 696f 6e73 203d      precisions =
+00020f00: 205b 302e 305d 202a 206d 6178 5f6f 7264   [0.0] * max_ord
+00020f10: 6572 0a20 2020 2073 6d6f 6f74 6820 3d20  er.    smooth = 
+00020f20: 312e 300a 2020 2020 666f 7220 6920 696e  1.0.    for i in
+00020f30: 2072 616e 6765 2830 2c20 6d61 785f 6f72   range(0, max_or
+00020f40: 6465 7229 3a0a 2020 2020 2020 2020 6966  der):.        if
+00020f50: 2070 6f73 7369 626c 655f 6d61 7463 6865   possible_matche
+00020f60: 735f 6279 5f6f 7264 6572 5b69 5d20 3e20  s_by_order[i] > 
+00020f70: 303a 0a20 2020 2020 2020 2020 2020 2070  0:.            p
+00020f80: 7265 6369 7369 6f6e 735b 695d 203d 206d  recisions[i] = m
+00020f90: 6174 6368 6573 5f62 795f 6f72 6465 725b  atches_by_order[
+00020fa0: 695d 202f 2070 6f73 7369 626c 655f 6d61  i] / possible_ma
+00020fb0: 7463 6865 735f 6279 5f6f 7264 6572 5b69  tches_by_order[i
+00020fc0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00020fd0: 206d 6174 6368 6573 5f62 795f 6f72 6465   matches_by_orde
+00020fe0: 725b 695d 203e 2030 3a0a 2020 2020 2020  r[i] > 0:.      
+00020ff0: 2020 2020 2020 2020 2020 7072 6563 6973            precis
+00021000: 696f 6e73 5b69 5d20 3d20 6d61 7463 6865  ions[i] = matche
+00021010: 735f 6279 5f6f 7264 6572 5b69 5d20 2f20  s_by_order[i] / 
+00021020: 706f 7373 6962 6c65 5f6d 6174 6368 6573  possible_matches
+00021030: 5f62 795f 6f72 6465 725b 695d 0a20 2020  _by_order[i].   
+00021040: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00021050: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00021060: 6d6f 6f74 6820 2a3d 2032 0a20 2020 2020  mooth *= 2.     
+00021070: 2020 2020 2020 2020 2020 2070 7265 6369             preci
+00021080: 7369 6f6e 735b 695d 203d 2031 2e30 202f  sions[i] = 1.0 /
+00021090: 2028 736d 6f6f 7468 202a 2070 6f73 7369   (smooth * possi
+000210a0: 626c 655f 6d61 7463 6865 735f 6279 5f6f  ble_matches_by_o
+000210b0: 7264 6572 5b69 5d29 0a20 2020 2020 2020  rder[i]).       
+000210c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000210d0: 2020 2070 7265 6369 7369 6f6e 735b 695d     precisions[i]
+000210e0: 203d 2030 2e30 0a0a 2020 2020 6966 206d   = 0.0..    if m
+000210f0: 6178 2870 7265 6369 7369 6f6e 7329 203e  ax(precisions) >
+00021100: 2030 3a0a 2020 2020 2020 2020 705f 6c6f   0:.        p_lo
+00021110: 675f 7375 6d20 3d20 7375 6d28 6d61 7468  g_sum = sum(math
+00021120: 2e6c 6f67 2870 2920 666f 7220 7020 696e  .log(p) for p in
+00021130: 2070 7265 6369 7369 6f6e 7320 6966 2070   precisions if p
+00021140: 290a 2020 2020 2020 2020 6765 6f5f 6d65  ).        geo_me
+00021150: 616e 203d 206d 6174 682e 6578 7028 705f  an = math.exp(p_
+00021160: 6c6f 675f 7375 6d20 2f20 6d61 785f 6f72  log_sum / max_or
+00021170: 6465 7229 0a0a 2020 2020 6966 2075 7365  der)..    if use
+00021180: 5f62 703a 0a20 2020 2020 2020 2072 6174  _bp:.        rat
+00021190: 696f 203d 2074 7261 6e73 6c61 7469 6f6e  io = translation
+000211a0: 5f6c 656e 6774 6820 2f20 7265 6665 7265  _length / refere
+000211b0: 6e63 655f 6c65 6e67 7468 0a20 2020 2020  nce_length.     
+000211c0: 2020 2069 6620 7261 7469 6f20 3c20 3165     if ratio < 1e
+000211d0: 2d33 303a 0a20 2020 2020 2020 2020 2020  -30:.           
+000211e0: 2062 7020 3d20 302e 300a 2020 2020 2020   bp = 0.0.      
+000211f0: 2020 656c 6966 2072 6174 696f 203c 2031    elif ratio < 1
+00021200: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
+00021210: 6270 203d 206d 6174 682e 6578 7028 3120  bp = math.exp(1 
+00021220: 2d20 312e 3020 2f20 7261 7469 6f29 0a20  - 1.0 / ratio). 
+00021230: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00021240: 2020 2020 2020 2020 2062 7020 3d20 312e           bp = 1.
+00021250: 300a 2020 2020 626c 6575 203d 2067 656f  0.    bleu = geo
+00021260: 5f6d 6561 6e20 2a20 6270 0a20 2020 2072  _mean * bp.    r
+00021270: 6574 7572 6e20 6e70 2e66 6c6f 6174 3332  eturn np.float32
+00021280: 2862 6c65 7529 0a0a 0a23 206e 6f69 6e73  (bleu)...# noins
+00021290: 7065 6374 696f 6e20 5079 5061 636b 6167  pection PyPackag
+000212a0: 6552 6571 7569 7265 6d65 6e74 730a 6465  eRequirements.de
+000212b0: 6620 6d6f 6e6b 6579 6669 785f 676c 6962  f monkeyfix_glib
+000212c0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+000212d0: 4669 7865 7320 736f 6d65 2073 7475 7069  Fixes some stupi
+000212e0: 6420 6275 6773 2073 7563 6820 7468 6174  d bugs such that
+000212f0: 2053 4947 494e 5420 6973 206e 6f74 2077   SIGINT is not w
+00021300: 6f72 6b69 6e67 2e0a 2020 2020 5468 6973  orking..    This
+00021310: 2069 7320 7573 6564 2062 7920 6175 6469   is used by audi
+00021320: 6f72 6561 642c 2061 6e64 2069 6e64 6972  oread, and indir
+00021330: 6563 746c 7920 6279 206c 6962 726f 7361  ectly by librosa
+00021340: 2066 6f72 206c 6f61 6469 6e67 2061 7564   for loading aud
+00021350: 696f 2e0a 2020 2020 6874 7470 733a 2f2f  io..    https://
+00021360: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
+00021370: 6d2f 7175 6573 7469 6f6e 732f 3136 3431  m/questions/1641
+00021380: 3038 3532 2f0a 2020 2020 5365 6520 616c  0852/.    See al
+00021390: 736f 203a 6675 6e63 3a60 6d6f 6e6b 6579  so :func:`monkey
+000213a0: 7061 7463 685f 6175 6469 6f72 6561 6460  patch_audioread`
+000213b0: 2e0a 2020 2020 2222 220a 2020 2020 7472  ..    """.    tr
+000213c0: 793a 0a20 2020 2020 2020 2069 6d70 6f72  y:.        impor
+000213d0: 7420 6769 0a20 2020 2065 7863 6570 7420  t gi.    except 
+000213e0: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
+000213f0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00021400: 7472 793a 0a20 2020 2020 2020 2066 726f  try:.        fro
+00021410: 6d20 6769 2e72 6570 6f73 6974 6f72 7920  m gi.repository 
+00021420: 696d 706f 7274 2047 4c69 620a 2020 2020  import GLib.    
+00021430: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+00021440: 6f72 3a0a 2020 2020 2020 2020 2320 6e6f  or:.        # no
+00021450: 696e 7370 6563 7469 6f6e 2050 7955 6e72  inspection PyUnr
+00021460: 6573 6f6c 7665 6452 6566 6572 656e 6365  esolvedReference
+00021470: 730a 2020 2020 2020 2020 6672 6f6d 2067  s.        from g
+00021480: 692e 6f76 6572 7269 6465 7320 696d 706f  i.overrides impo
+00021490: 7274 2047 4c69 620a 2020 2020 2320 446f  rt GLib.    # Do
+000214a0: 206e 6f74 6869 6e67 2e0a 2020 2020 2320   nothing..    # 
+000214b0: 5468 6520 6f72 6967 696e 616c 2062 6568  The original beh
+000214c0: 6176 696f 7220 776f 756c 6420 696e 7374  avior would inst
+000214d0: 616c 6c20 6120 5349 4749 4e54 2068 616e  all a SIGINT han
+000214e0: 646c 6572 2077 6869 6368 2063 616c 6c73  dler which calls
+000214f0: 2047 4c69 622e 4d61 696e 4c6f 6f70 2e71   GLib.MainLoop.q
+00021500: 7569 7428 292c 0a20 2020 2023 2061 6e64  uit(),.    # and
+00021510: 2074 6865 6e20 7265 7261 6973 6520 6120   then reraise a 
+00021520: 4b65 7962 6f61 7264 496e 7465 7272 7570  KeyboardInterrup
+00021530: 7420 696e 2074 6861 7420 7468 7265 6164  t in that thread
+00021540: 2e0a 2020 2020 2320 486f 7765 7665 722c  ..    # However,
+00021550: 2077 6520 7761 6e74 2061 6e64 2065 7870   we want and exp
+00021560: 6563 7420 746f 2067 6574 2074 6865 204b  ect to get the K
+00021570: 6579 626f 6172 6449 6e74 6572 7275 7074  eyboardInterrupt
+00021580: 2069 6e20 7468 6520 6d61 696e 2074 6872   in the main thr
+00021590: 6561 642e 0a20 2020 2047 4c69 622e 4d61  ead..    GLib.Ma
+000215a0: 696e 4c6f 6f70 2e5f 5f69 6e69 745f 5f20  inLoop.__init__ 
+000215b0: 3d20 6c61 6d62 6461 202a 6172 6773 2c20  = lambda *args, 
+000215c0: 2a2a 6b77 6172 6773 3a20 4e6f 6e65 0a0a  **kwargs: None..
+000215d0: 0a64 6566 206d 6f6e 6b65 7970 6174 6368  .def monkeypatch
+000215e0: 5f61 7564 696f 7265 6164 2829 3a0a 2020  _audioread():.  
+000215f0: 2020 2222 220a 2020 2020 6175 6469 6f72    """.    audior
+00021600: 6561 6420 646f 6573 206e 6f74 2062 6568  ead does not beh
+00021610: 6176 6520 6f70 7469 6d61 6c20 696e 2073  ave optimal in s
+00021620: 6f6d 6520 6361 7365 732e 0a20 2020 2045  ome cases..    E
+00021630: 2e67 2e20 6561 6368 2063 616c 6c20 746f  .g. each call to
+00021640: 205f 6361 5f61 7661 696c 6162 6c65 2829   _ca_available()
+00021650: 2074 616b 6573 2071 7569 7465 206c 6f6e   takes quite lon
+00021660: 6720 6265 6361 7573 6520 6f66 2074 6865  g because of the
+00021670: 2063 7479 7065 732e 7574 696c 2e66 696e   ctypes.util.fin
+00021680: 645f 6c69 6272 6172 7920 7573 6167 652e  d_library usage.
+00021690: 0a20 2020 2057 6520 7769 6c6c 2070 6174  .    We will pat
+000216a0: 6368 2074 6869 732e 0a0a 2020 2020 486f  ch this...    Ho
+000216b0: 7765 7665 722c 2074 6865 2072 6563 6f6d  wever, the recom
+000216c0: 6d65 6e64 6174 696f 6e20 776f 756c 6420  mendation would 
+000216d0: 6265 2074 6f20 6e6f 7420 7573 6520 6175  be to not use au
+000216e0: 6469 6f72 6561 6420 286c 6962 726f 7361  dioread (librosa
+000216f0: 2e6c 6f61 6429 2e0a 2020 2020 6175 6469  .load)..    audi
+00021700: 6f72 6561 6420 7573 6573 2047 7374 7265  oread uses Gstre
+00021710: 616d 6572 2061 7320 6120 6261 636b 656e  amer as a backen
+00021720: 6420 6279 2064 6566 6175 6c74 2063 7572  d by default cur
+00021730: 7265 6e74 6c79 2028 6f6e 204c 696e 7578  rently (on Linux
+00021740: 292e 0a20 2020 2047 7374 7265 616d 6572  )..    Gstreamer
+00021750: 2068 6173 206d 756c 7469 706c 6520 6973   has multiple is
+00021760: 7375 6573 2e20 5365 6520 616c 736f 203a  sues. See also :
+00021770: 6675 6e63 3a60 6d6f 6e6b 6579 6669 785f  func:`monkeyfix_
+00021780: 676c 6962 602c 2061 6e64 2068 6572 6520  glib`, and here 
+00021790: 666f 7220 6469 7363 7573 7369 6f6e 3a0a  for discussion:.
+000217a0: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
+000217b0: 7562 2e63 6f6d 2f62 6565 7462 6f78 2f61  ub.com/beetbox/a
+000217c0: 7564 696f 7265 6164 2f69 7373 7565 732f  udioread/issues/
+000217d0: 3632 0a20 2020 2068 7474 7073 3a2f 2f67  62.    https://g
+000217e0: 6974 6875 622e 636f 6d2f 6265 6574 626f  ithub.com/beetbo
+000217f0: 782f 6175 6469 6f72 6561 642f 6973 7375  x/audioread/issu
+00021800: 6573 2f36 330a 0a20 2020 2049 6e73 7465  es/63..    Inste
+00021810: 6164 2c20 7573 6520 5079 536f 756e 6446  ad, use PySoundF
+00021820: 696c 652c 2077 6869 6368 2069 7320 616c  ile, which is al
+00021830: 736f 2066 6173 7465 722e 2053 6565 2068  so faster. See h
+00021840: 6572 6520 666f 7220 6469 7363 7573 7369  ere for discussi
+00021850: 6f6e 733a 0a20 2020 2068 7474 7073 3a2f  ons:.    https:/
+00021860: 2f67 6974 6875 622e 636f 6d2f 6265 6574  /github.com/beet
+00021870: 626f 782f 6175 6469 6f72 6561 642f 6973  box/audioread/is
+00021880: 7375 6573 2f36 340a 2020 2020 6874 7470  sues/64.    http
+00021890: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f6c  s://github.com/l
+000218a0: 6962 726f 7361 2f6c 6962 726f 7361 2f69  ibrosa/librosa/i
+000218b0: 7373 7565 732f 3638 310a 2020 2020 2222  ssues/681.    ""
+000218c0: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
+000218d0: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
+000218e0: 6e20 5079 5061 636b 6167 6552 6571 7569  n PyPackageRequi
+000218f0: 7265 6d65 6e74 730a 2020 2020 2020 2020  rements.        
+00021900: 696d 706f 7274 2061 7564 696f 7265 6164  import audioread
+00021910: 0a20 2020 2065 7863 6570 7420 496d 706f  .    except Impo
+00021920: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
+00021930: 2072 6574 7572 6e0a 2020 2020 2320 6e6f   return.    # no
+00021940: 696e 7370 6563 7469 6f6e 2050 7950 726f  inspection PyPro
+00021950: 7465 6374 6564 4d65 6d62 6572 0a20 2020  tectedMember.   
+00021960: 2072 6573 203d 2061 7564 696f 7265 6164   res = audioread
+00021970: 2e5f 6361 5f61 7661 696c 6162 6c65 2829  ._ca_available()
+00021980: 0a20 2020 2061 7564 696f 7265 6164 2e5f  .    audioread._
+00021990: 6361 5f61 7661 696c 6162 6c65 203d 206c  ca_available = l
+000219a0: 616d 6264 613a 2072 6573 0a0a 0a5f 6366  ambda: res..._cf
+000219b0: 5f63 6163 6865 203d 207b 7d0a 5f63 665f  _cache = {}._cf_
+000219c0: 6d73 675f 7072 696e 7465 6420 3d20 4661  msg_printed = Fa
+000219d0: 6c73 650a 0a0a 6465 6620 6366 2866 696c  lse...def cf(fil
+000219e0: 656e 616d 6529 3a0a 2020 2020 2222 220a  ename):.    """.
+000219f0: 2020 2020 4361 6368 6520 6d61 6e61 6765      Cache manage
+00021a00: 722e 2069 3620 7370 6563 6966 6963 2e0a  r. i6 specific..
+00021a10: 0a20 2020 203a 7265 7475 726e 3a20 6669  .    :return: fi
+00021a20: 6c65 6e61 6d65 0a20 2020 203a 7274 7970  lename.    :rtyp
+00021a30: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
+00021a40: 2020 2067 6c6f 6261 6c20 5f63 665f 6d73     global _cf_ms
+00021a50: 675f 7072 696e 7465 640a 2020 2020 696d  g_printed.    im
+00021a60: 706f 7274 206f 730a 2020 2020 6672 6f6d  port os.    from
+00021a70: 2073 7562 7072 6f63 6573 7320 696d 706f   subprocess impo
+00021a80: 7274 2063 6865 636b 5f6f 7574 7075 740a  rt check_output.
+00021a90: 0a20 2020 2069 6620 6669 6c65 6e61 6d65  .    if filename
+00021aa0: 2069 6e20 5f63 665f 6361 6368 653a 0a20   in _cf_cache:. 
+00021ab0: 2020 2020 2020 2072 6574 7572 6e20 5f63         return _c
+00021ac0: 665f 6361 6368 655b 6669 6c65 6e61 6d65  f_cache[filename
+00021ad0: 5d0a 2020 2020 6465 6275 675f 6d6f 6465  ].    debug_mode
+00021ae0: 203d 2069 6e74 286f 732e 656e 7669 726f   = int(os.enviro
+00021af0: 6e2e 6765 7428 2244 4542 5547 222c 2030  n.get("DEBUG", 0
+00021b00: 2929 0a20 2020 2069 6620 6465 6275 675f  )).    if debug_
+00021b10: 6d6f 6465 206f 7220 6765 745f 686f 7374  mode or get_host
+00021b20: 6e61 6d65 2829 203d 3d20 2263 6c75 7374  name() == "clust
+00021b30: 6572 2d63 6e2d 3231 3122 206f 7220 6e6f  er-cn-211" or no
+00021b40: 7420 6973 5f72 756e 6e69 6e67 5f6f 6e5f  t is_running_on_
+00021b50: 636c 7573 7465 7228 293a 0a20 2020 2020  cluster():.     
+00021b60: 2020 2069 6620 6e6f 7420 5f63 665f 6d73     if not _cf_ms
+00021b70: 675f 7072 696e 7465 643a 0a20 2020 2020  g_printed:.     
+00021b80: 2020 2020 2020 2070 7269 6e74 2822 4361         print("Ca
+00021b90: 6368 6520 6d61 6e61 6765 723a 206e 6f74  che manager: not
+00021ba0: 2075 7365 642c 2075 7365 206c 6f63 616c   used, use local
+00021bb0: 2066 696c 653a 2025 7320 2864 6973 6361   file: %s (disca
+00021bc0: 7264 2066 7572 7468 6572 206d 6573 7361  rd further messa
+00021bd0: 6765 7329 2220 2520 6669 6c65 6e61 6d65  ges)" % filename
+00021be0: 290a 2020 2020 2020 2020 2020 2020 5f63  ).            _c
+00021bf0: 665f 6d73 675f 7072 696e 7465 6420 3d20  f_msg_printed = 
+00021c00: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
+00021c10: 7572 6e20 6669 6c65 6e61 6d65 2020 2320  urn filename  # 
+00021c20: 666f 7220 6465 6275 6767 696e 670a 2020  for debugging.  
+00021c30: 2020 7472 793a 0a20 2020 2020 2020 2063    try:.        c
+00021c40: 6163 6865 645f 666e 203d 2063 6865 636b  ached_fn = check
+00021c50: 5f6f 7574 7075 7428 5b22 6366 222c 2066  _output(["cf", f
+00021c60: 696c 656e 616d 655d 292e 7374 7269 7028  ilename]).strip(
+00021c70: 292e 6465 636f 6465 2822 7574 6638 2229  ).decode("utf8")
+00021c80: 0a20 2020 2065 7863 6570 7420 4361 6c6c  .    except Call
+00021c90: 6564 5072 6f63 6573 7345 7272 6f72 3a0a  edProcessError:.
+00021ca0: 2020 2020 2020 2020 6966 206e 6f74 205f          if not _
+00021cb0: 6366 5f6d 7367 5f70 7269 6e74 6564 3a0a  cf_msg_printed:.
+00021cc0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00021cd0: 7428 2243 6163 6865 206d 616e 6167 6572  t("Cache manager
+00021ce0: 3a20 4572 726f 7220 6f63 6375 7272 6564  : Error occurred
+00021cf0: 2c20 7573 696e 6720 6c6f 6361 6c20 6669  , using local fi
+00021d00: 6c65 2229 0a20 2020 2020 2020 2020 2020  le").           
+00021d10: 205f 6366 5f6d 7367 5f70 7269 6e74 6564   _cf_msg_printed
+00021d20: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00021d30: 7265 7475 726e 2066 696c 656e 616d 650a  return filename.
+00021d40: 2020 2020 6173 7365 7274 206f 732e 7061      assert os.pa
+00021d50: 7468 2e65 7869 7374 7328 6361 6368 6564  th.exists(cached
+00021d60: 5f66 6e29 0a20 2020 205f 6366 5f63 6163  _fn).    _cf_cac
+00021d70: 6865 5b66 696c 656e 616d 655d 203d 2063  he[filename] = c
+00021d80: 6163 6865 645f 666e 0a20 2020 2072 6574  ached_fn.    ret
+00021d90: 7572 6e20 6361 6368 6564 5f66 6e0a 0a0a  urn cached_fn...
+00021da0: 6465 6620 6269 6e61 7279 5f73 6561 7263  def binary_searc
+00021db0: 685f 616e 7928 636d 702c 206c 6f77 2c20  h_any(cmp, low, 
+00021dc0: 6869 6768 293a 0a20 2020 2022 2222 0a20  high):.    """. 
+00021dd0: 2020 2042 696e 6172 7920 7365 6172 6368     Binary search
+00021de0: 2066 6f72 2061 2063 7573 746f 6d20 636f   for a custom co
+00021df0: 6d70 6172 6520 6675 6e63 7469 6f6e 2e0a  mpare function..
+00021e00: 0a20 2020 203a 7061 7261 6d20 2869 6e74  .    :param (int
+00021e10: 292d 3e69 6e74 2063 6d70 3a20 652e 672e  )->int cmp: e.g.
+00021e20: 2063 6d70 2869 6478 2920 3d3d 2063 6f6d   cmp(idx) == com
+00021e30: 7061 7265 2861 7272 6179 5b69 6478 5d2c  pare(array[idx],
+00021e40: 206b 6579 290a 2020 2020 3a70 6172 616d   key).    :param
+00021e50: 2069 6e74 206c 6f77 3a20 696e 636c 7573   int low: inclus
+00021e60: 6976 650a 2020 2020 3a70 6172 616d 2069  ive.    :param i
+00021e70: 6e74 2068 6967 683a 2065 7863 6c75 7369  nt high: exclusi
+00021e80: 7665 0a20 2020 203a 7274 7970 653a 2069  ve.    :rtype: i
+00021e90: 6e74 7c4e 6f6e 650a 2020 2020 2222 220a  nt|None.    """.
+00021ea0: 2020 2020 7768 696c 6520 6c6f 7720 3c20      while low < 
+00021eb0: 6869 6768 3a0a 2020 2020 2020 2020 6d69  high:.        mi
+00021ec0: 6420 3d20 286c 6f77 202b 2068 6967 6829  d = (low + high)
+00021ed0: 202f 2f20 320a 2020 2020 2020 2020 7220   // 2.        r 
+00021ee0: 3d20 636d 7028 6d69 6429 0a20 2020 2020  = cmp(mid).     
+00021ef0: 2020 2069 6620 7220 3c20 303a 0a20 2020     if r < 0:.   
+00021f00: 2020 2020 2020 2020 206c 6f77 203d 206d           low = m
+00021f10: 6964 202b 2031 0a20 2020 2020 2020 2065  id + 1.        e
+00021f20: 6c69 6620 7220 3e20 303a 0a20 2020 2020  lif r > 0:.     
+00021f30: 2020 2020 2020 2068 6967 6820 3d20 6d69         high = mi
+00021f40: 640a 2020 2020 2020 2020 656c 7365 3a0a  d.        else:.
+00021f50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00021f60: 726e 206d 6964 0a20 2020 2072 6574 7572  rn mid.    retur
+00021f70: 6e20 6c6f 770a 0a0a 6465 6620 6765 6e65  n low...def gene
+00021f80: 7269 635f 696d 706f 7274 5f6d 6f64 756c  ric_import_modul
+00021f90: 6528 6669 6c65 6e61 6d65 293a 0a20 2020  e(filename):.   
+00021fa0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00021fb0: 7374 7220 6669 6c65 6e61 6d65 3a0a 2020  str filename:.  
+00021fc0: 2020 2020 5765 2074 7279 2074 6f20 6265      We try to be
+00021fd0: 2063 6c65 7665 7220 6162 6f75 7420 6669   clever about fi
+00021fe0: 6c65 6e61 6d65 2e0a 2020 2020 2020 4966  lename..      If
+00021ff0: 2069 7420 6c6f 6f6b 7320 6c69 6b65 2061   it looks like a
+00022000: 206d 6f64 756c 6520 6e61 6d65 2c20 6a75   module name, ju
+00022010: 7374 2064 6f20 696d 706f 7274 6c69 622e  st do importlib.
+00022020: 696d 706f 7274 5f6d 6f64 756c 652e 0a20  import_module.. 
+00022030: 2020 2020 2049 6620 6974 206c 6f6f 6b73       If it looks
+00022040: 206c 696b 6520 6120 6669 6c65 6e61 6d65   like a filename
+00022050: 2c20 7365 6172 6368 2066 6f72 2061 2062  , search for a b
+00022060: 6173 6520 7061 7468 2028 7768 6963 6820  ase path (which 
+00022070: 646f 6573 206e 6f74 2068 6176 6520 5f5f  does not have __
+00022080: 696e 6974 5f5f 2e70 7929 2c0a 2020 2020  init__.py),.    
+00022090: 2020 6164 6420 7468 6174 2070 6174 6820    add that path 
+000220a0: 746f 2073 7973 2e70 6174 6820 6966 206e  to sys.path if n
+000220b0: 6565 6465 642c 2061 6e64 2069 6d70 6f72  eeded, and impor
+000220c0: 7420 7468 6520 7265 6d61 696e 696e 6720  t the remaining 
+000220d0: 7768 6572 6520 222f 2220 6973 2072 6570  where "/" is rep
+000220e0: 6c61 6365 6420 6279 2022 2e22 0a20 2020  laced by ".".   
+000220f0: 2020 2061 6e64 2074 6865 2066 696c 6520     and the file 
+00022100: 6578 7465 6e73 696f 6e20 6973 2072 656d  extension is rem
+00022110: 6f76 6564 2e0a 2020 2020 3a72 6574 7572  oved..    :retur
+00022120: 6e3a 2074 6865 206d 6f64 756c 650a 2020  n: the module.  
+00022130: 2020 3a72 7479 7065 3a20 7479 7065 732e    :rtype: types.
+00022140: 4d6f 6475 6c65 5479 7065 0a20 2020 2022  ModuleType.    "
+00022150: 2222 0a20 2020 2061 7373 6572 7420 6669  "".    assert fi
+00022160: 6c65 6e61 6d65 0a20 2020 2069 6d70 6f72  lename.    impor
+00022170: 7420 696d 706f 7274 6c69 620a 0a20 2020  t importlib..   
+00022180: 2069 6620 222f 2220 6e6f 7420 696e 2066   if "/" not in f
+00022190: 696c 656e 616d 653a 0a20 2020 2020 2020  ilename:.       
+000221a0: 2072 6574 7572 6e20 696d 706f 7274 6c69   return importli
+000221b0: 622e 696d 706f 7274 5f6d 6f64 756c 6528  b.import_module(
+000221c0: 6669 6c65 6e61 6d65 290a 2020 2020 7072  filename).    pr
+000221d0: 6566 6978 5f64 6972 203d 2022 220a 2020  efix_dir = "".  
+000221e0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+000221f0: 2e65 7869 7374 7328 6669 6c65 6e61 6d65  .exists(filename
+00022200: 293a 0a20 2020 2020 2020 2061 7373 6572  ):.        asser
+00022210: 7420 6669 6c65 6e61 6d65 5b30 5d20 213d  t filename[0] !=
+00022220: 2022 2f22 0a20 2020 2020 2020 2023 204d   "/".        # M
+00022230: 6179 6265 2072 656c 6174 6976 6520 746f  aybe relative to
+00022240: 2052 6574 7572 6e6e 3f0a 2020 2020 2020   Returnn?.      
+00022250: 2020 7072 6566 6978 5f64 6972 203d 2022    prefix_dir = "
+00022260: 2573 2f22 2025 2072 6574 7572 6e6e 5f72  %s/" % returnn_r
+00022270: 6f6f 745f 6469 720a 2020 2020 6173 7365  oot_dir.    asse
+00022280: 7274 206f 732e 7061 7468 2e65 7869 7374  rt os.path.exist
+00022290: 7328 7072 6566 6978 5f64 6972 202b 2066  s(prefix_dir + f
+000222a0: 696c 656e 616d 6529 0a20 2020 2061 7373  ilename).    ass
+000222b0: 6572 7420 6669 6c65 6e61 6d65 2e65 6e64  ert filename.end
+000222c0: 7377 6974 6828 222e 7079 2229 206f 7220  swith(".py") or 
+000222d0: 6f73 2e70 6174 682e 6973 6469 7228 7072  os.path.isdir(pr
+000222e0: 6566 6978 5f64 6972 202b 2066 696c 656e  efix_dir + filen
+000222f0: 616d 6529 0a20 2020 2064 6972 7320 3d20  ame).    dirs = 
+00022300: 6669 6c65 6e61 6d65 2e73 706c 6974 2822  filename.split("
+00022310: 2f22 290a 2020 2020 6469 7273 2c20 6261  /").    dirs, ba
+00022320: 7365 5f66 6e20 3d20 6469 7273 5b3a 2d31  se_fn = dirs[:-1
+00022330: 5d2c 2064 6972 735b 2d31 5d0a 2020 2020  ], dirs[-1].    
+00022340: 6173 7365 7274 206c 656e 2864 6972 7329  assert len(dirs)
+00022350: 203e 3d20 310a 2020 2020 666f 7220 6920   >= 1.    for i 
+00022360: 696e 2072 6576 6572 7365 6428 7261 6e67  in reversed(rang
+00022370: 6528 6c65 6e28 6469 7273 2929 293a 0a20  e(len(dirs))):. 
+00022380: 2020 2020 2020 2064 203d 2070 7265 6669         d = prefi
+00022390: 785f 6469 7220 2b20 222f 222e 6a6f 696e  x_dir + "/".join
+000223a0: 2864 6972 735b 3a20 6920 2b20 315d 290a  (dirs[: i + 1]).
+000223b0: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
+000223c0: 732e 7061 7468 2e69 7364 6972 2864 290a  s.path.isdir(d).
+000223d0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000223e0: 7468 2e65 7869 7374 7328 2225 732f 5f5f  th.exists("%s/__
+000223f0: 696e 6974 5f5f 2e70 7922 2025 2064 293a  init__.py" % d):
+00022400: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00022410: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
+00022420: 2064 206e 6f74 2069 6e20 7379 732e 7061   d not in sys.pa
+00022430: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+00022440: 7379 732e 7061 7468 2e61 7070 656e 6428  sys.path.append(
+00022450: 6429 0a20 2020 2020 2020 206d 203d 2022  d).        m = "
+00022460: 2e22 2e6a 6f69 6e28 6469 7273 5b69 202b  .".join(dirs[i +
+00022470: 2031 203a 5d20 2b20 5b62 6173 655f 666e   1 :] + [base_fn
+00022480: 5d29 0a20 2020 2020 2020 2069 6620 6261  ]).        if ba
+00022490: 7365 5f66 6e2e 656e 6473 7769 7468 2822  se_fn.endswith("
+000224a0: 2e70 7922 293a 0a20 2020 2020 2020 2020  .py"):.         
+000224b0: 2020 206d 203d 206d 5b3a 2d33 5d0a 2020     m = m[:-3].  
+000224c0: 2020 2020 2020 7265 7475 726e 2069 6d70        return imp
+000224d0: 6f72 746c 6962 2e69 6d70 6f72 745f 6d6f  ortlib.import_mo
+000224e0: 6475 6c65 286d 290a 2020 2020 7261 6973  dule(m).    rais
+000224f0: 6520 5661 6c75 6545 7272 6f72 2822 6361  e ValueError("ca
+00022500: 6e6e 6f74 2066 6967 7572 6520 6f75 7420  nnot figure out 
+00022510: 6261 7365 206d 6f64 756c 6520 7061 7468  base module path
+00022520: 2066 726f 6d20 2572 2220 2520 6669 6c65   from %r" % file
+00022530: 6e61 6d65 290a 0a0a 6465 6620 736f 6674  name)...def soft
+00022540: 6d61 7828 782c 2061 7869 733d 4e6f 6e65  max(x, axis=None
+00022550: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00022560: 7061 7261 6d20 6e75 6d70 792e 6e64 6172  param numpy.ndar
+00022570: 7261 7920 783a 0a20 2020 203a 7061 7261  ray x:.    :para
+00022580: 6d20 696e 747c 4e6f 6e65 2061 7869 733a  m int|None axis:
+00022590: 0a20 2020 203a 7274 7970 653a 206e 756d  .    :rtype: num
+000225a0: 7079 2e6e 6461 7272 6179 0a20 2020 2022  py.ndarray.    "
+000225b0: 2222 0a20 2020 2069 6d70 6f72 7420 6e75  "".    import nu
+000225c0: 6d70 790a 0a20 2020 2065 5f78 203d 206e  mpy..    e_x = n
+000225d0: 756d 7079 2e65 7870 2878 202d 206e 756d  umpy.exp(x - num
+000225e0: 7079 2e6d 6178 2878 2c20 6178 6973 3d61  py.max(x, axis=a
+000225f0: 7869 732c 206b 6565 7064 696d 733d 5472  xis, keepdims=Tr
+00022600: 7565 2929 0a20 2020 2072 6574 7572 6e20  ue)).    return 
+00022610: 655f 7820 2f20 6e75 6d70 792e 7375 6d28  e_x / numpy.sum(
+00022620: 655f 782c 2061 7869 733d 6178 6973 2c20  e_x, axis=axis, 
+00022630: 6b65 6570 6469 6d73 3d54 7275 6529 0a0a  keepdims=True)..
+00022640: 0a64 6566 2063 6f6c 6c65 6374 5f70 726f  .def collect_pro
+00022650: 635f 6d61 7073 5f65 7865 635f 6669 6c65  c_maps_exec_file
+00022660: 7328 293a 0a20 2020 2022 2222 0a20 2020  s():.    """.   
+00022670: 2043 7572 7265 6e74 6c79 206f 6e6c 7920   Currently only 
+00022680: 776f 726b 7320 6f6e 204c 696e 7578 2e2e  works on Linux..
+00022690: 2e0a 0a20 2020 203a 7265 7475 726e 3a20  ...    :return: 
+000226a0: 6c69 7374 206f 6620 6d61 7070 6564 2065  list of mapped e
+000226b0: 7865 6375 7461 626c 6573 2028 6c69 6273  xecutables (libs
+000226c0: 290a 2020 2020 3a72 7479 7065 3a20 6c69  ).    :rtype: li
+000226d0: 7374 5b73 7472 5d0a 2020 2020 2222 220a  st[str].    """.
+000226e0: 2020 2020 696d 706f 7274 2072 650a 0a20      import re.. 
+000226f0: 2020 2070 6964 203d 206f 732e 6765 7470     pid = os.getp
+00022700: 6964 2829 0a20 2020 2066 6e73 203d 205b  id().    fns = [
+00022710: 5d0a 2020 2020 666f 7220 6c69 6e65 2069  ].    for line i
+00022720: 6e20 6f70 656e 2822 2f70 726f 632f 2569  n open("/proc/%i
+00022730: 2f6d 6170 7322 2025 2070 6964 2c20 2272  /maps" % pid, "r
+00022740: 2229 2e72 6561 6428 292e 7370 6c69 746c  ").read().splitl
+00022750: 696e 6573 2829 3a20 2023 2066 6f72 2065  ines():  # for e
+00022760: 6163 6820 6d61 7070 6564 2072 6567 696f  ach mapped regio
+00022770: 6e0a 2020 2020 2020 2020 2320 6874 7470  n.        # http
+00022780: 733a 2f2f 7374 6163 6b6f 7665 7266 6c6f  s://stackoverflo
+00022790: 772e 636f 6d2f 7175 6573 7469 6f6e 732f  w.com/questions/
+000227a0: 3134 3031 3335 392f 756e 6465 7273 7461  1401359/understa
+000227b0: 6e64 696e 672d 6c69 6e75 782d 7072 6f63  nding-linux-proc
+000227c0: 2d69 642d 6d61 7073 0a20 2020 2020 2020  -id-maps.       
+000227d0: 2023 2061 6464 7265 7373 2020 2020 2020   # address      
+000227e0: 2020 2020 2070 6572 6d73 206f 6666 7365       perms offse
+000227f0: 7420 2064 6576 2020 2069 6e6f 6465 2020  t  dev   inode  
+00022800: 2070 6174 686e 616d 650a 2020 2020 2020   pathname.      
+00022810: 2020 2320 452e 672e 3a0a 2020 2020 2020    # E.g.:.      
+00022820: 2020 2320 3766 6632 6465 3931 6330 3030    # 7ff2de91c000
+00022830: 2d37 6666 3264 6539 3165 3030 3020 7277  -7ff2de91e000 rw
+00022840: 2d70 2030 3031 3763 3030 3020 3038 3a30  -p 0017c000 08:0
+00022850: 3220 3739 3438 3434 2020 2020 2020 2020  2 794844        
+00022860: 2020 2020 2020 2020 2020 2020 202f 7573               /us
+00022870: 722f 6c69 622f 7838 365f 3634 2d6c 696e  r/lib/x86_64-lin
+00022880: 7578 2d67 6e75 2f6c 6962 7374 6463 2b2e  ux-gnu/libstdc+.
+00022890: 2e2e 0a20 2020 2020 2020 206d 203d 2072  ...        m = r
+000228a0: 652e 6d61 7463 6828 0a20 2020 2020 2020  e.match(.       
+000228b0: 2020 2020 2072 225e 285b 302d 3941 2d46       r"^([0-9A-F
+000228c0: 612d 665d 2b29 2d28 5b30 2d39 412d 4661  a-f]+)-([0-9A-Fa
+000228d0: 2d66 5d2b 295c 732b 285b 7277 7870 735c  -f]+)\s+([rwxps\
+000228e0: 2d5d 2b29 5c73 2b28 5b30 2d39 412d 4661  -]+)\s+([0-9A-Fa
+000228f0: 2d66 5d2b 295c 732b 285b 302d 3941 2d46  -f]+)\s+([0-9A-F
+00022900: 612d 663a 5d2b 295c 732b 285b 302d 395d  a-f:]+)\s+([0-9]
+00022910: 2b29 5c73 2a28 2e2a 2924 222c 206c 696e  +)\s*(.*)$", lin
+00022920: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
+00022930: 2020 2020 6173 7365 7274 206d 2c20 226e      assert m, "n
+00022940: 6f20 6d61 7463 6820 666f 7220 2572 2220  o match for %r" 
+00022950: 2520 6c69 6e65 0a20 2020 2020 2020 2061  % line.        a
+00022960: 6464 7265 7373 5f73 7461 7274 2c20 6164  ddress_start, ad
+00022970: 6472 6573 735f 656e 642c 2070 6572 6d73  dress_end, perms
+00022980: 2c20 6f66 6673 6574 2c20 6465 762c 2069  , offset, dev, i
+00022990: 5f6e 6f64 652c 2070 6174 685f 6e61 6d65  _node, path_name
+000229a0: 203d 206d 2e67 726f 7570 7328 290a 2020   = m.groups().  
+000229b0: 2020 2020 2020 6966 2022 7822 206e 6f74        if "x" not
+000229c0: 2069 6e20 7065 726d 733a 0a20 2020 2020   in perms:.     
+000229d0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+000229e0: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+000229f0: 6174 685f 6e61 6d65 206f 7220 7061 7468  ath_name or path
+00022a00: 5f6e 616d 652e 7374 6172 7473 7769 7468  _name.startswith
+00022a10: 2822 5b22 2920 6f72 2022 2864 656c 6574  ("[") or "(delet
+00022a20: 6564 2922 2069 6e20 7061 7468 5f6e 616d  ed)" in path_nam
+00022a30: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00022a40: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00022a50: 6966 2070 6174 685f 6e61 6d65 206e 6f74  if path_name not
+00022a60: 2069 6e20 666e 733a 0a20 2020 2020 2020   in fns:.       
+00022a70: 2020 2020 2066 6e73 2e61 7070 656e 6428       fns.append(
+00022a80: 7061 7468 5f6e 616d 6529 0a20 2020 2072  path_name).    r
+00022a90: 6574 7572 6e20 666e 730a 0a0a 6465 6620  eturn fns...def 
+00022aa0: 6669 6e64 5f73 796d 5f69 6e5f 6578 6563  find_sym_in_exec
+00022ab0: 2866 6e2c 2073 796d 293a 0a20 2020 2022  (fn, sym):.    "
+00022ac0: 2222 0a20 2020 2055 7365 7320 6060 6f62  "".    Uses ``ob
+00022ad0: 6a64 756d 7060 6020 746f 206c 6973 7420  jdump`` to list 
+00022ae0: 6176 6169 6c61 626c 6520 7379 6d62 6f6c  available symbol
+00022af0: 732c 2061 6e64 2066 696c 7465 7273 2074  s, and filters t
+00022b00: 6865 6d20 6279 2074 6865 2067 6976 656e  hem by the given
+00022b10: 2060 6073 796d 6060 2e0a 0a20 2020 203a   ``sym``...    :
+00022b20: 7061 7261 6d20 7374 7220 666e 3a20 7061  param str fn: pa
+00022b30: 7468 0a20 2020 203a 7061 7261 6d20 7374  th.    :param st
+00022b40: 7220 7379 6d3a 0a20 2020 203a 7265 7475  r sym:.    :retu
+00022b50: 726e 3a20 6d61 7463 6865 6420 6f75 742c  rn: matched out,
+00022b60: 206f 7220 4e6f 6e65 0a20 2020 203a 7274   or None.    :rt
+00022b70: 7970 653a 2073 7472 7c4e 6f6e 650a 2020  ype: str|None.  
+00022b80: 2020 2222 220a 2020 2020 6672 6f6d 2073    """.    from s
+00022b90: 7562 7072 6f63 6573 7320 696d 706f 7274  ubprocess import
+00022ba0: 2043 616c 6c65 6450 726f 6365 7373 4572   CalledProcessEr
+00022bb0: 726f 720a 0a20 2020 206f 626a 6475 6d70  ror..    objdump
+00022bc0: 203d 2022 6f62 6a64 756d 7020 2d54 220a   = "objdump -T".
+00022bd0: 2020 2020 6966 2073 7973 2e70 6c61 7466      if sys.platf
+00022be0: 6f72 6d20 3d3d 2022 6461 7277 696e 223a  orm == "darwin":
+00022bf0: 0a20 2020 2020 2020 206f 626a 6475 6d70  .        objdump
+00022c00: 203d 2022 6f74 6f6f 6c20 2d49 4847 7622   = "otool -IHGv"
+00022c10: 0a20 2020 2073 6865 6c6c 5f63 6d64 203d  .    shell_cmd =
+00022c20: 2022 2573 2025 7320 7c20 6772 6570 2025   "%s %s | grep %
+00022c30: 7322 2025 2028 6f62 6a64 756d 702c 2066  s" % (objdump, f
+00022c40: 6e2c 2073 796d 290a 2020 2020 7472 793a  n, sym).    try:
+00022c50: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
+00022c60: 7973 5f65 7865 635f 6f75 7428 7368 656c  ys_exec_out(shel
+00022c70: 6c5f 636d 642c 2073 6865 6c6c 3d54 7275  l_cmd, shell=Tru
+00022c80: 6529 0a20 2020 2065 7863 6570 7420 4361  e).    except Ca
+00022c90: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
+00022ca0: 3a20 2023 206e 6f6e 6520 666f 756e 640a  :  # none found.
+00022cb0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00022cc0: 6f6e 650a 2020 2020 6173 7365 7274 2069  one.    assert i
+00022cd0: 7369 6e73 7461 6e63 6528 6f75 742c 2028  sinstance(out, (
+00022ce0: 7374 722c 2075 6e69 636f 6465 2929 0a20  str, unicode)). 
+00022cf0: 2020 206f 7574 5f6c 6e73 203d 206f 7574     out_lns = out
+00022d00: 2e73 706c 6974 6c69 6e65 7328 290a 2020  .splitlines().  
+00022d10: 2020 6f75 745f 6c6e 7320 3d20 5b6c 6e20    out_lns = [ln 
+00022d20: 666f 7220 6c6e 2069 6e20 6f75 745f 6c6e  for ln in out_ln
+00022d30: 7320 6966 2022 2e74 6578 7422 2069 6e20  s if ".text" in 
+00022d40: 6c6e 5d20 2023 2073 6565 206f 626a 6475  ln]  # see objdu
+00022d50: 6d70 0a20 2020 206f 7574 5f6c 6e73 203d  mp.    out_lns =
+00022d60: 205b 6c6e 2066 6f72 206c 6e20 696e 206f   [ln for ln in o
+00022d70: 7574 5f6c 6e73 2069 6620 7379 6d20 696e  ut_lns if sym in
+00022d80: 206c 6e2e 7370 6c69 7428 295d 0a20 2020   ln.split()].   
+00022d90: 2069 6620 6e6f 7420 6f75 745f 6c6e 733a   if not out_lns:
+00022da0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00022db0: 4e6f 6e65 0a20 2020 2072 6574 7572 6e20  None.    return 
+00022dc0: 2246 6f75 6e64 2025 7220 696e 2025 723a  "Found %r in %r:
+00022dd0: 5c6e 2573 2220 2520 2873 796d 2c20 666e  \n%s" % (sym, fn
+00022de0: 2c20 225c 6e22 2e6a 6f69 6e28 6f75 745f  , "\n".join(out_
+00022df0: 6c6e 7329 290a 0a0a 6465 6620 6475 6d6d  lns))...def dumm
+00022e00: 795f 6e75 6d70 795f 6765 6d6d 5f63 616c  y_numpy_gemm_cal
+00022e10: 6c28 293a 0a20 2020 2022 2222 0a20 2020  l():.    """.   
+00022e20: 204a 7573 7420 7065 7266 6f72 6d73 2073   Just performs s
+00022e30: 6f6d 6520 4745 4d4d 2063 616c 6c20 7669  ome GEMM call vi
+00022e40: 6120 4e75 6d70 792e 0a20 2020 2054 6869  a Numpy..    Thi
+00022e50: 7320 6d61 6b65 7320 7375 7265 2074 6861  s makes sure tha
+00022e60: 7420 7468 6520 424c 4153 206c 6962 7261  t the BLAS libra
+00022e70: 7279 2069 7320 6c6f 6164 6564 2e0a 2020  ry is loaded..  
+00022e80: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
+00022e90: 206e 756d 7079 0a0a 2020 2020 6120 3d20   numpy..    a = 
+00022ea0: 6e75 6d70 792e 7261 6e64 6f6d 2e72 616e  numpy.random.ran
+00022eb0: 646e 2835 2c20 3329 2e61 7374 7970 6528  dn(5, 3).astype(
+00022ec0: 6e75 6d70 792e 666c 6f61 7433 3229 0a20  numpy.float32). 
+00022ed0: 2020 2062 203d 206e 756d 7079 2e72 616e     b = numpy.ran
+00022ee0: 646f 6d2e 7261 6e64 6e28 332c 2037 292e  dom.randn(3, 7).
+00022ef0: 6173 7479 7065 286e 756d 7079 2e66 6c6f  astype(numpy.flo
+00022f00: 6174 3332 290a 2020 2020 6320 3d20 6e75  at32).    c = nu
+00022f10: 6d70 792e 646f 7428 612c 2062 290a 2020  mpy.dot(a, b).  
+00022f20: 2020 6173 7365 7274 206e 756d 7079 2e69    assert numpy.i
+00022f30: 7366 696e 6974 6528 6329 2e61 6c6c 2829  sfinite(c).all()
+00022f40: 0a0a 0a5f 6669 6e64 5f73 6765 6d6d 5f6c  ..._find_sgemm_l
+00022f50: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
+00022f60: 6361 6368 6564 203d 204e 6f6e 650a 0a0a  cached = None...
+00022f70: 6465 6620 6669 6e64 5f73 6765 6d6d 5f6c  def find_sgemm_l
+00022f80: 6962 735f 6672 6f6d 5f72 756e 7469 6d65  ibs_from_runtime
+00022f90: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+00022fa0: 4c6f 6f6b 7320 7468 726f 7567 6820 616c  Looks through al
+00022fb0: 6c20 6c69 6273 2076 6961 203a 6675 6e63  l libs via :func
+00022fc0: 3a60 636f 6c6c 6563 745f 7072 6f63 5f6d  :`collect_proc_m
+00022fd0: 6170 735f 6578 6563 5f66 696c 6573 602c  aps_exec_files`,
+00022fe0: 0a20 2020 2061 6e64 2073 6561 7263 6865  .    and searche
+00022ff0: 7320 666f 7220 616c 6c20 7768 6963 6820  s for all which 
+00023000: 6861 7665 2074 6865 2060 6073 6765 6d6d  have the ``sgemm
+00023010: 6060 2073 796d 626f 6c2e 0a20 2020 2043  `` symbol..    C
+00023020: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
+00023030: 726b 7320 6f6e 204c 696e 7578 2028 6265  rks on Linux (be
+00023040: 6361 7573 6520 636f 6c6c 6563 745f 7072  cause collect_pr
+00023050: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
+00023060: 6573 292e 0a0a 2020 2020 3a72 6574 7572  es)...    :retur
+00023070: 6e3a 206c 6973 7420 6f66 206c 6962 7320  n: list of libs 
+00023080: 2874 6865 6972 2070 6174 6829 0a20 2020  (their path).   
+00023090: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
+000230a0: 725d 0a20 2020 2022 2222 0a20 2020 2069  r].    """.    i
+000230b0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+000230c0: 6973 7473 2822 2f70 726f 6322 293a 0a20  ists("/proc"):. 
+000230d0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000230e0: 6e65 0a20 2020 2067 6c6f 6261 6c20 5f66  ne.    global _f
+000230f0: 696e 645f 7367 656d 6d5f 6c69 625f 6672  ind_sgemm_lib_fr
+00023100: 6f6d 5f72 756e 7469 6d65 5f63 6163 6865  om_runtime_cache
+00023110: 640a 2020 2020 6966 205f 6669 6e64 5f73  d.    if _find_s
+00023120: 6765 6d6d 5f6c 6962 5f66 726f 6d5f 7275  gemm_lib_from_ru
+00023130: 6e74 696d 655f 6361 6368 6564 2069 7320  ntime_cached is 
+00023140: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00023150: 2020 7265 7475 726e 205f 6669 6e64 5f73    return _find_s
+00023160: 6765 6d6d 5f6c 6962 5f66 726f 6d5f 7275  gemm_lib_from_ru
+00023170: 6e74 696d 655f 6361 6368 6564 0a20 2020  ntime_cached.   
+00023180: 2064 756d 6d79 5f6e 756d 7079 5f67 656d   dummy_numpy_gem
+00023190: 6d5f 6361 6c6c 2829 2020 2320 6d61 6b65  m_call()  # make
+000231a0: 2073 7572 6520 7468 6174 204e 756d 7079   sure that Numpy
+000231b0: 2069 7320 6c6f 6164 6564 2061 6e64 204e   is loaded and N
+000231c0: 756d 7079 2073 6765 6d6d 2069 7320 6176  umpy sgemm is av
+000231d0: 6169 6c61 626c 650a 2020 2020 666e 7320  ailable.    fns 
+000231e0: 3d20 636f 6c6c 6563 745f 7072 6f63 5f6d  = collect_proc_m
+000231f0: 6170 735f 6578 6563 5f66 696c 6573 2829  aps_exec_files()
+00023200: 0a20 2020 2066 6e73 5f77 6974 685f 7367  .    fns_with_sg
+00023210: 656d 6d20 3d20 5b5d 0a20 2020 2066 6f72  emm = [].    for
+00023220: 2066 6e20 696e 2066 6e73 3a0a 2020 2020   fn in fns:.    
+00023230: 2020 2020 6f75 7420 3d20 6669 6e64 5f73      out = find_s
+00023240: 796d 5f69 6e5f 6578 6563 2866 6e2c 2022  ym_in_exec(fn, "
+00023250: 7367 656d 6d5f 2229 0a20 2020 2020 2020  sgemm_").       
+00023260: 2069 6620 6f75 743a 0a20 2020 2020 2020   if out:.       
+00023270: 2020 2020 2066 6e73 5f77 6974 685f 7367       fns_with_sg
+00023280: 656d 6d2e 6170 7065 6e64 2866 6e29 0a20  emm.append(fn). 
+00023290: 2020 205f 6669 6e64 5f73 6765 6d6d 5f6c     _find_sgemm_l
+000232a0: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
+000232b0: 6361 6368 6564 203d 2066 6e73 5f77 6974  cached = fns_wit
+000232c0: 685f 7367 656d 6d0a 2020 2020 7265 7475  h_sgemm.    retu
+000232d0: 726e 2066 6e73 5f77 6974 685f 7367 656d  rn fns_with_sgem
+000232e0: 6d0a 0a0a 5f66 696e 645f 6c69 6263 7564  m..._find_libcud
+000232f0: 6172 745f 6672 6f6d 5f72 756e 7469 6d65  art_from_runtime
+00023300: 5f63 6163 6865 6420 3d20 4e6f 6e65 0a0a  _cached = None..
+00023310: 0a64 6566 2066 696e 645f 6c69 6263 7564  .def find_libcud
+00023320: 6172 745f 6672 6f6d 5f72 756e 7469 6d65  art_from_runtime
+00023330: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+00023340: 4c6f 6f6b 7320 7468 726f 7567 6820 616c  Looks through al
+00023350: 6c20 6c69 6273 2076 6961 203a 6675 6e63  l libs via :func
+00023360: 3a60 636f 6c6c 6563 745f 7072 6f63 5f6d  :`collect_proc_m
+00023370: 6170 735f 6578 6563 5f66 696c 6573 602c  aps_exec_files`,
+00023380: 0a20 2020 2061 6e64 2073 6561 7263 6865  .    and searche
+00023390: 7320 666f 7220 616c 6c20 7768 6963 6820  s for all which 
+000233a0: 6861 7665 2074 6865 2060 6073 6765 6d6d  have the ``sgemm
+000233b0: 6060 2073 796d 626f 6c2e 0a20 2020 2043  `` symbol..    C
+000233c0: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
+000233d0: 726b 7320 6f6e 204c 696e 7578 2028 6265  rks on Linux (be
+000233e0: 6361 7573 6520 636f 6c6c 6563 745f 7072  cause collect_pr
+000233f0: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
+00023400: 6573 292e 0a0a 2020 2020 3a72 6574 7572  es)...    :retur
+00023410: 6e3a 206c 6973 7420 6f66 206c 6962 7320  n: list of libs 
+00023420: 2874 6865 6972 2070 6174 6829 0a20 2020  (their path).   
+00023430: 203a 7274 7970 653a 2073 7472 7c4e 6f6e   :rtype: str|Non
+00023440: 650a 2020 2020 2222 220a 2020 2020 6966  e.    """.    if
+00023450: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+00023460: 7374 7328 222f 7072 6f63 2229 3a0a 2020  sts("/proc"):.  
+00023470: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00023480: 650a 2020 2020 676c 6f62 616c 205f 6669  e.    global _fi
+00023490: 6e64 5f6c 6962 6375 6461 7274 5f66 726f  nd_libcudart_fro
+000234a0: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
+000234b0: 0a20 2020 2069 6620 5f66 696e 645f 6c69  .    if _find_li
+000234c0: 6263 7564 6172 745f 6672 6f6d 5f72 756e  bcudart_from_run
+000234d0: 7469 6d65 5f63 6163 6865 6420 6973 206e  time_cached is n
+000234e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000234f0: 2072 6574 7572 6e20 5f66 696e 645f 6c69   return _find_li
+00023500: 6263 7564 6172 745f 6672 6f6d 5f72 756e  bcudart_from_run
+00023510: 7469 6d65 5f63 6163 6865 645b 305d 0a20  time_cached[0]. 
+00023520: 2020 2066 6e73 203d 2063 6f6c 6c65 6374     fns = collect
+00023530: 5f70 726f 635f 6d61 7073 5f65 7865 635f  _proc_maps_exec_
+00023540: 6669 6c65 7328 290a 2020 2020 666f 7220  files().    for 
+00023550: 666e 2069 6e20 666e 733a 0a20 2020 2020  fn in fns:.     
+00023560: 2020 2069 6620 7265 2e6d 6174 6368 2822     if re.match("
+00023570: 2e2a 2f6c 6962 6375 6461 7274 5c5c 2e73  .*/libcudart\\.s
+00023580: 6f28 5c5c 2e2e 2a29 3f22 2c20 666e 293a  o(\\..*)?", fn):
+00023590: 0a20 2020 2020 2020 2020 2020 205f 6669  .            _fi
+000235a0: 6e64 5f6c 6962 6375 6461 7274 5f66 726f  nd_libcudart_fro
+000235b0: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
+000235c0: 203d 205b 666e 5d0a 2020 2020 2020 2020   = [fn].        
+000235d0: 2020 2020 7265 7475 726e 2066 6e0a 2020      return fn.  
+000235e0: 2020 5f66 696e 645f 6c69 6263 7564 6172    _find_libcudar
+000235f0: 745f 6672 6f6d 5f72 756e 7469 6d65 5f63  t_from_runtime_c
+00023600: 6163 6865 6420 3d20 5b4e 6f6e 655d 0a20  ached = [None]. 
+00023610: 2020 2072 6574 7572 6e20 4e6f 6e65 0a       return None.
```

### Comparing `returnn-1.20230508.105629/returnn/util/better_exchook.py` & `returnn-1.20230509.160323/returnn/util/better_exchook.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/bpe.py` & `returnn-1.20230509.160323/returnn/util/bpe.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/debug.py` & `returnn-1.20230509.160323/returnn/util/debug.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/debug_helpers.py` & `returnn-1.20230509.160323/returnn/util/debug_helpers.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/fsa.py` & `returnn-1.20230509.160323/returnn/util/fsa.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/literal_py_to_pickle.py` & `returnn-1.20230509.160323/returnn/util/literal_py_to_pickle.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/pprint.py` & `returnn-1.20230509.160323/returnn/util/pprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/py-to-pickle.cpp` & `returnn-1.20230509.160323/returnn/util/py-to-pickle.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/sig_proc.py` & `returnn-1.20230509.160323/returnn/util/sig_proc.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn/util/task_system.py` & `returnn-1.20230509.160323/returnn/util/task_system.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/returnn.egg-info/PKG-INFO` & `returnn-1.20230509.160323/returnn.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: returnn
-Version: 1.20230508.105629
+Version: 1.20230509.160323
 Summary: The RWTH extensible training framework for universal recurrent neural networks
 Home-page: https://github.com/rwth-i6/returnn/
 Author: Albert Zeyer
 Author-email: albzey@gmail.com
 License: RETURNN license
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `returnn-1.20230508.105629/returnn.egg-info/SOURCES.txt` & `returnn-1.20230509.160323/returnn.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/setup.py` & `returnn-1.20230509.160323/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/DummySprintExec.py` & `returnn-1.20230509.160323/tests/DummySprintExec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/PyCharm-inspection-profile.xml` & `returnn-1.20230509.160323/tests/PyCharm-inspection-profile.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/PyCharm.idea/codeStyleSettings.xml` & `returnn-1.20230509.160323/tests/PyCharm.idea/codeStyleSettings.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml` & `returnn-1.20230509.160323/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/_set_num_threads1.py` & `returnn-1.20230509.160323/tests/_set_num_threads1.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/_setup_test_env.py` & `returnn-1.20230509.160323/tests/_setup_test_env.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/bpe-unicode-demo.codes` & `returnn-1.20230509.160323/tests/bpe-unicode-demo.codes`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/bpe-unicode-demo.vocab` & `returnn-1.20230509.160323/tests/bpe-unicode-demo.vocab`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/lexicon_opt.isyms` & `returnn-1.20230509.160323/tests/lexicon_opt.isyms`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/lexicon_opt.jpg` & `returnn-1.20230509.160323/tests/lexicon_opt.jpg`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/lint_common.py` & `returnn-1.20230509.160323/tests/lint_common.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/pycharm-inspect.py` & `returnn-1.20230509.160323/tests/pycharm-inspect.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/pylint.py` & `returnn-1.20230509.160323/tests/pylint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/returnn-as-framework.py` & `returnn-1.20230509.160323/tests/returnn-as-framework.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/rf_utils.py` & `returnn-1.20230509.160323/tests/rf_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/spelling.dic` & `returnn-1.20230509.160323/tests/spelling.dic`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_Config.py` & `returnn-1.20230509.160323/tests/test_Config.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_Dataset.py` & `returnn-1.20230509.160323/tests/test_Dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_Fsa.py` & `returnn-1.20230509.160323/tests/test_Fsa.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_GeneratingDataset.py` & `returnn-1.20230509.160323/tests/test_GeneratingDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_HDFDataset.py` & `returnn-1.20230509.160323/tests/test_HDFDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_LearningRateControl.py` & `returnn-1.20230509.160323/tests/test_LearningRateControl.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_Log.py` & `returnn-1.20230509.160323/tests/test_Log.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_MultiProcDataset.py` & `returnn-1.20230509.160323/tests/test_MultiProcDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_PTDataset.py` & `returnn-1.20230509.160323/tests/test_PTDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_Pretrain.py` & `returnn-1.20230509.160323/tests/test_Pretrain.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_ResNet.py` & `returnn-1.20230509.160323/tests/test_ResNet.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_SprintDataset.py` & `returnn-1.20230509.160323/tests/test_SprintDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_SprintInterface.py` & `returnn-1.20230509.160323/tests/test_SprintInterface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFEngine.py` & `returnn-1.20230509.160323/tests/test_TFEngine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFNativeOp.py` & `returnn-1.20230509.160323/tests/test_TFNativeOp.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFNetworkLayer.py` & `returnn-1.20230509.160323/tests/test_TFNetworkLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFNetworkRecLayer.py` & `returnn-1.20230509.160323/tests/test_TFNetworkRecLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFNetworkSigProcLayer.py` & `returnn-1.20230509.160323/tests/test_TFNetworkSigProcLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFUpdater.py` & `returnn-1.20230509.160323/tests/test_TFUpdater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TFUtil.py` & `returnn-1.20230509.160323/tests/test_TFUtil.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TF_determinism.py` & `returnn-1.20230509.160323/tests/test_TF_determinism.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TaskSystem.py` & `returnn-1.20230509.160323/tests/test_TaskSystem.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TaskSystem_SharedMem.py` & `returnn-1.20230509.160323/tests/test_TaskSystem_SharedMem.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_TranslationDataset.py` & `returnn-1.20230509.160323/tests/test_TranslationDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_Util.py` & `returnn-1.20230509.160323/tests/test_Util.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_demos.py` & `returnn-1.20230509.160323/tests/test_demos.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_fork_exec.py` & `returnn-1.20230509.160323/tests/test_fork_exec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_hdf_dump.py` & `returnn-1.20230509.160323/tests/test_hdf_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_array.py` & `returnn-1.20230509.160323/tests/test_rf_array.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_attention.py` & `returnn-1.20230509.160323/tests/test_rf_attention.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_base.py` & `returnn-1.20230509.160323/tests/test_rf_base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_cond.py` & `returnn-1.20230509.160323/tests/test_rf_cond.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_container.py` & `returnn-1.20230509.160323/tests/test_rf_container.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_conv.py` & `returnn-1.20230509.160323/tests/test_rf_conv.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_encoder_conformer.py` & `returnn-1.20230509.160323/tests/test_rf_encoder_conformer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_math.py` & `returnn-1.20230509.160323/tests/test_rf_math.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_normalization.py` & `returnn-1.20230509.160323/tests/test_rf_normalization.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_rec.py` & `returnn-1.20230509.160323/tests/test_rf_rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_rf_signal.py` & `returnn-1.20230509.160323/tests/test_rf_signal.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_tensor.py` & `returnn-1.20230509.160323/tests/test_tensor.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_tools.py` & `returnn-1.20230509.160323/tests/test_tools.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_torch_frontend.py` & `returnn-1.20230509.160323/tests/test_torch_frontend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tests/test_torch_internal_frontend.py` & `returnn-1.20230509.160323/tests/test_torch_internal_frontend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/analyze-dataset-batches.py` & `returnn-1.20230509.160323/tools/analyze-dataset-batches.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/bliss-collect-seq-lens.py` & `returnn-1.20230509.160323/tools/bliss-collect-seq-lens.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/bliss-dump-text.py` & `returnn-1.20230509.160323/tools/bliss-dump-text.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/bliss-get-segment-names.py` & `returnn-1.20230509.160323/tools/bliss-get-segment-names.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/bliss-to-ogg-zip.py` & `returnn-1.20230509.160323/tools/bliss-to-ogg-zip.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/bpe-create-lexicon.py` & `returnn-1.20230509.160323/tools/bpe-create-lexicon.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/calculate-word-error-rate.py` & `returnn-1.20230509.160323/tools/calculate-word-error-rate.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/cleanup-old-models.py` & `returnn-1.20230509.160323/tools/cleanup-old-models.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/collect-orth-symbols.py` & `returnn-1.20230509.160323/tools/collect-orth-symbols.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/collect-words.py` & `returnn-1.20230509.160323/tools/collect-words.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/compile_native_op.py` & `returnn-1.20230509.160323/tools/compile_native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/compile_tf_graph.py` & `returnn-1.20230509.160323/tools/compile_tf_graph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/debug-dump-search-scores.py` & `returnn-1.20230509.160323/tools/debug-dump-search-scores.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/debug-plot-search-scores.py` & `returnn-1.20230509.160323/tools/debug-plot-search-scores.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/dump-dataset-raw-strings.py` & `returnn-1.20230509.160323/tools/dump-dataset-raw-strings.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/dump-dataset.py` & `returnn-1.20230509.160323/tools/dump-dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/dump-forward-stats.py` & `returnn-1.20230509.160323/tools/dump-forward-stats.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/dump-forward.py` & `returnn-1.20230509.160323/tools/dump-forward.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/dump-network-json.py` & `returnn-1.20230509.160323/tools/dump-network-json.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/dump-pickle.py` & `returnn-1.20230509.160323/tools/dump-pickle.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/extract_state_tying_from_dataset.py` & `returnn-1.20230509.160323/tools/extract_state_tying_from_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/get-attention-weights.py` & `returnn-1.20230509.160323/tools/get-attention-weights.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/get-best-model-epoch.py` & `returnn-1.20230509.160323/tools/get-best-model-epoch.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/hdf_dump.py` & `returnn-1.20230509.160323/tools/hdf_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/hdf_dump_translation_dataset.py` & `returnn-1.20230509.160323/tools/hdf_dump_translation_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/import-blocks-mt-model.py` & `returnn-1.20230509.160323/tools/import-blocks-mt-model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/import-t2t-mt-model.py` & `returnn-1.20230509.160323/tools/import-t2t-mt-model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/Makefile` & `returnn-1.20230509.160323/tools/lattice_rescorer/Makefile`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/README.md` & `returnn-1.20230509.160323/tools/lattice_rescorer/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/example/README.md` & `returnn-1.20230509.160323/tools/lattice_rescorer/example/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config` & `returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config` & `returnn-1.20230509.160323/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/example/rescore_lattice.sh` & `returnn-1.20230509.160323/tools/lattice_rescorer/example/rescore_lattice.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/file.h` & `returnn-1.20230509.160323/tools/lattice_rescorer/file.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/htklatticerescorer.cc` & `returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/htklatticerescorer.h` & `returnn-1.20230509.160323/tools/lattice_rescorer/htklatticerescorer.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/main.cc` & `returnn-1.20230509.160323/tools/lattice_rescorer/main.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/rescorer.h` & `returnn-1.20230509.160323/tools/lattice_rescorer/rescorer.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/vocabulary.cc` & `returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/lattice_rescorer/vocabulary.h` & `returnn-1.20230509.160323/tools/lattice_rescorer/vocabulary.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/tf_avg_checkpoints.py` & `returnn-1.20230509.160323/tools/tf_avg_checkpoints.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/tf_inspect_checkpoint.py` & `returnn-1.20230509.160323/tools/tf_inspect_checkpoint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230508.105629/tools/tf_inspect_summary_log.py` & `returnn-1.20230509.160323/tools/tf_inspect_summary_log.py`

 * *Files identical despite different names*

